var ale=Object.defineProperty;var FF=e=>{throw TypeError(e)};var ole=(e,t,n)=>t in e?ale(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var wi=(e,t,n)=>ole(e,typeof t!="symbol"?t+"":t,n),d5=(e,t,n)=>t.has(e)||FF("Cannot "+n);var St=(e,t,n)=>(d5(e,t,"read from private field"),n?n.call(e):t.get(e)),qi=(e,t,n)=>t.has(e)?FF("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),ei=(e,t,n,r)=>(d5(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),ya=(e,t,n)=>(d5(e,t,"access private method"),n);var w3=(e,t,n,r)=>({set _(a){ei(e,t,a,n)},get _(){return St(e,t,r)}});function lle(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in e)){const l=Object.getOwnPropertyDescriptor(r,a);l&&Object.defineProperty(e,a,l.get?l:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function n(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(a){if(a.ep)return;a.ep=!0;const l=n(a);fetch(a.href,l)}})();var fp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function UT(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Aq={exports:{}},ok={},Cq={exports:{}},ua={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VT=Symbol.for("react.element"),ule=Symbol.for("react.portal"),cle=Symbol.for("react.fragment"),dle=Symbol.for("react.strict_mode"),hle=Symbol.for("react.profiler"),fle=Symbol.for("react.provider"),ple=Symbol.for("react.context"),mle=Symbol.for("react.forward_ref"),gle=Symbol.for("react.suspense"),_le=Symbol.for("react.memo"),yle=Symbol.for("react.lazy"),BF=Symbol.iterator;function vle(e){return e===null||typeof e!="object"?null:(e=BF&&e[BF]||e["@@iterator"],typeof e=="function"?e:null)}var kq={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Iq=Object.assign,Rq={};function xx(e,t,n){this.props=e,this.context=t,this.refs=Rq,this.updater=n||kq}xx.prototype.isReactComponent={};xx.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};xx.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Mq(){}Mq.prototype=xx.prototype;function B8(e,t,n){this.props=e,this.context=t,this.refs=Rq,this.updater=n||kq}var j8=B8.prototype=new Mq;j8.constructor=B8;Iq(j8,xx.prototype);j8.isPureReactComponent=!0;var jF=Array.isArray,Pq=Object.prototype.hasOwnProperty,U8={current:null},Oq={key:!0,ref:!0,__self:!0,__source:!0};function Lq(e,t,n){var r,a={},l=null,f=null;if(t!=null)for(r in t.ref!==void 0&&(f=t.ref),t.key!==void 0&&(l=""+t.key),t)Pq.call(t,r)&&!Oq.hasOwnProperty(r)&&(a[r]=t[r]);var i=arguments.length-2;if(i===1)a.children=n;else if(1<i){for(var y=Array(i),x=0;x<i;x++)y[x]=arguments[x+2];a.children=y}if(e&&e.defaultProps)for(r in i=e.defaultProps,i)a[r]===void 0&&(a[r]=i[r]);return{$$typeof:VT,type:e,key:l,ref:f,props:a,_owner:U8.current}}function xle(e,t){return{$$typeof:VT,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function V8(e){return typeof e=="object"&&e!==null&&e.$$typeof===VT}function ble(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var UF=/\/+/g;function h5(e,t){return typeof e=="object"&&e!==null&&e.key!=null?ble(""+e.key):t.toString(36)}function v4(e,t,n,r,a){var l=typeof e;(l==="undefined"||l==="boolean")&&(e=null);var f=!1;if(e===null)f=!0;else switch(l){case"string":case"number":f=!0;break;case"object":switch(e.$$typeof){case VT:case ule:f=!0}}if(f)return f=e,a=a(f),e=r===""?"."+h5(f,0):r,jF(a)?(n="",e!=null&&(n=e.replace(UF,"$&/")+"/"),v4(a,t,n,"",function(x){return x})):a!=null&&(V8(a)&&(a=xle(a,n+(!a.key||f&&f.key===a.key?"":(""+a.key).replace(UF,"$&/")+"/")+e)),t.push(a)),1;if(f=0,r=r===""?".":r+":",jF(e))for(var i=0;i<e.length;i++){l=e[i];var y=r+h5(l,i);f+=v4(l,t,n,y,a)}else if(y=vle(e),typeof y=="function")for(e=y.call(e),i=0;!(l=e.next()).done;)l=l.value,y=r+h5(l,i++),f+=v4(l,t,n,y,a);else if(l==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return f}function T3(e,t,n){if(e==null)return e;var r=[],a=0;return v4(e,r,"","",function(l){return t.call(n,l,a++)}),r}function wle(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var zu={current:null},x4={transition:null},Tle={ReactCurrentDispatcher:zu,ReactCurrentBatchConfig:x4,ReactCurrentOwner:U8};function Dq(){throw Error("act(...) is not supported in production builds of React.")}ua.Children={map:T3,forEach:function(e,t,n){T3(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return T3(e,function(){t++}),t},toArray:function(e){return T3(e,function(t){return t})||[]},only:function(e){if(!V8(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ua.Component=xx;ua.Fragment=cle;ua.Profiler=hle;ua.PureComponent=B8;ua.StrictMode=dle;ua.Suspense=gle;ua.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Tle;ua.act=Dq;ua.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Iq({},e.props),a=e.key,l=e.ref,f=e._owner;if(t!=null){if(t.ref!==void 0&&(l=t.ref,f=U8.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(y in t)Pq.call(t,y)&&!Oq.hasOwnProperty(y)&&(r[y]=t[y]===void 0&&i!==void 0?i[y]:t[y])}var y=arguments.length-2;if(y===1)r.children=n;else if(1<y){i=Array(y);for(var x=0;x<y;x++)i[x]=arguments[x+2];r.children=i}return{$$typeof:VT,type:e.type,key:a,ref:l,props:r,_owner:f}};ua.createContext=function(e){return e={$$typeof:ple,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:fle,_context:e},e.Consumer=e};ua.createElement=Lq;ua.createFactory=function(e){var t=Lq.bind(null,e);return t.type=e,t};ua.createRef=function(){return{current:null}};ua.forwardRef=function(e){return{$$typeof:mle,render:e}};ua.isValidElement=V8;ua.lazy=function(e){return{$$typeof:yle,_payload:{_status:-1,_result:e},_init:wle}};ua.memo=function(e,t){return{$$typeof:_le,type:e,compare:t===void 0?null:t}};ua.startTransition=function(e){var t=x4.transition;x4.transition={};try{e()}finally{x4.transition=t}};ua.unstable_act=Dq;ua.useCallback=function(e,t){return zu.current.useCallback(e,t)};ua.useContext=function(e){return zu.current.useContext(e)};ua.useDebugValue=function(){};ua.useDeferredValue=function(e){return zu.current.useDeferredValue(e)};ua.useEffect=function(e,t){return zu.current.useEffect(e,t)};ua.useId=function(){return zu.current.useId()};ua.useImperativeHandle=function(e,t,n){return zu.current.useImperativeHandle(e,t,n)};ua.useInsertionEffect=function(e,t){return zu.current.useInsertionEffect(e,t)};ua.useLayoutEffect=function(e,t){return zu.current.useLayoutEffect(e,t)};ua.useMemo=function(e,t){return zu.current.useMemo(e,t)};ua.useReducer=function(e,t,n){return zu.current.useReducer(e,t,n)};ua.useRef=function(e){return zu.current.useRef(e)};ua.useState=function(e){return zu.current.useState(e)};ua.useSyncExternalStore=function(e,t,n){return zu.current.useSyncExternalStore(e,t,n)};ua.useTransition=function(){return zu.current.useTransition()};ua.version="18.3.1";Cq.exports=ua;var B=Cq.exports;const cs=UT(B),$T=lle({__proto__:null,default:cs},[B]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ele=B,Sle=Symbol.for("react.element"),Ale=Symbol.for("react.fragment"),Cle=Object.prototype.hasOwnProperty,kle=Ele.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ile={key:!0,ref:!0,__self:!0,__source:!0};function Nq(e,t,n){var r,a={},l=null,f=null;n!==void 0&&(l=""+n),t.key!==void 0&&(l=""+t.key),t.ref!==void 0&&(f=t.ref);for(r in t)Cle.call(t,r)&&!Ile.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:Sle,type:e,key:l,ref:f,props:a,_owner:kle.current}}ok.Fragment=Ale;ok.jsx=Nq;ok.jsxs=Nq;Aq.exports=ok;var k=Aq.exports,uM={},zq={exports:{}},Hc={},Fq={exports:{}},Bq={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(nt,pt){var Oe=nt.length;nt.push(pt);e:for(;0<Oe;){var gn=Oe-1>>>1,wt=nt[gn];if(0<a(wt,pt))nt[gn]=pt,nt[Oe]=wt,Oe=gn;else break e}}function n(nt){return nt.length===0?null:nt[0]}function r(nt){if(nt.length===0)return null;var pt=nt[0],Oe=nt.pop();if(Oe!==pt){nt[0]=Oe;e:for(var gn=0,wt=nt.length,Fe=wt>>>1;gn<Fe;){var jt=2*(gn+1)-1,Tn=nt[jt],mn=jt+1,zn=nt[mn];if(0>a(Tn,Oe))mn<wt&&0>a(zn,Tn)?(nt[gn]=zn,nt[mn]=Oe,gn=mn):(nt[gn]=Tn,nt[jt]=Oe,gn=jt);else if(mn<wt&&0>a(zn,Oe))nt[gn]=zn,nt[mn]=Oe,gn=mn;else break e}}return pt}function a(nt,pt){var Oe=nt.sortIndex-pt.sortIndex;return Oe!==0?Oe:nt.id-pt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var f=Date,i=f.now();e.unstable_now=function(){return f.now()-i}}var y=[],x=[],S=1,C=null,P=3,L=!1,F=!1,U=!1,q=typeof setTimeout=="function"?setTimeout:null,G=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function X(nt){for(var pt=n(x);pt!==null;){if(pt.callback===null)r(x);else if(pt.startTime<=nt)r(x),pt.sortIndex=pt.expirationTime,t(y,pt);else break;pt=n(x)}}function ie(nt){if(U=!1,X(nt),!F)if(n(y)!==null)F=!0,Rt(de);else{var pt=n(x);pt!==null&&en(ie,pt.startTime-nt)}}function de(nt,pt){F=!1,U&&(U=!1,G(ve),ve=-1),L=!0;var Oe=P;try{for(X(pt),C=n(y);C!==null&&(!(C.expirationTime>pt)||nt&&!rt());){var gn=C.callback;if(typeof gn=="function"){C.callback=null,P=C.priorityLevel;var wt=gn(C.expirationTime<=pt);pt=e.unstable_now(),typeof wt=="function"?C.callback=wt:C===n(y)&&r(y),X(pt)}else r(y);C=n(y)}if(C!==null)var Fe=!0;else{var jt=n(x);jt!==null&&en(ie,jt.startTime-pt),Fe=!1}return Fe}finally{C=null,P=Oe,L=!1}}var fe=!1,be=null,ve=-1,Je=5,we=-1;function rt(){return!(e.unstable_now()-we<Je)}function He(){if(be!==null){var nt=e.unstable_now();we=nt;var pt=!0;try{pt=be(!0,nt)}finally{pt?ft():(fe=!1,be=null)}}else fe=!1}var ft;if(typeof $=="function")ft=function(){$(He)};else if(typeof MessageChannel<"u"){var Ct=new MessageChannel,Nt=Ct.port2;Ct.port1.onmessage=He,ft=function(){Nt.postMessage(null)}}else ft=function(){q(He,0)};function Rt(nt){be=nt,fe||(fe=!0,ft())}function en(nt,pt){ve=q(function(){nt(e.unstable_now())},pt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(nt){nt.callback=null},e.unstable_continueExecution=function(){F||L||(F=!0,Rt(de))},e.unstable_forceFrameRate=function(nt){0>nt||125<nt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Je=0<nt?Math.floor(1e3/nt):5},e.unstable_getCurrentPriorityLevel=function(){return P},e.unstable_getFirstCallbackNode=function(){return n(y)},e.unstable_next=function(nt){switch(P){case 1:case 2:case 3:var pt=3;break;default:pt=P}var Oe=P;P=pt;try{return nt()}finally{P=Oe}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(nt,pt){switch(nt){case 1:case 2:case 3:case 4:case 5:break;default:nt=3}var Oe=P;P=nt;try{return pt()}finally{P=Oe}},e.unstable_scheduleCallback=function(nt,pt,Oe){var gn=e.unstable_now();switch(typeof Oe=="object"&&Oe!==null?(Oe=Oe.delay,Oe=typeof Oe=="number"&&0<Oe?gn+Oe:gn):Oe=gn,nt){case 1:var wt=-1;break;case 2:wt=250;break;case 5:wt=1073741823;break;case 4:wt=1e4;break;default:wt=5e3}return wt=Oe+wt,nt={id:S++,callback:pt,priorityLevel:nt,startTime:Oe,expirationTime:wt,sortIndex:-1},Oe>gn?(nt.sortIndex=Oe,t(x,nt),n(y)===null&&nt===n(x)&&(U?(G(ve),ve=-1):U=!0,en(ie,Oe-gn))):(nt.sortIndex=wt,t(y,nt),F||L||(F=!0,Rt(de))),nt},e.unstable_shouldYield=rt,e.unstable_wrapCallback=function(nt){var pt=P;return function(){var Oe=P;P=pt;try{return nt.apply(this,arguments)}finally{P=Oe}}}})(Bq);Fq.exports=Bq;var Rle=Fq.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mle=B,Uc=Rle;function ir(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var jq=new Set,q2={};function B_(e,t){$v(e,t),$v(e+"Capture",t)}function $v(e,t){for(q2[e]=t,e=0;e<t.length;e++)jq.add(t[e])}var Ep=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),cM=Object.prototype.hasOwnProperty,Ple=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,VF={},$F={};function Ole(e){return cM.call($F,e)?!0:cM.call(VF,e)?!1:Ple.test(e)?$F[e]=!0:(VF[e]=!0,!1)}function Lle(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Dle(e,t,n,r){if(t===null||typeof t>"u"||Lle(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Fu(e,t,n,r,a,l,f){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=l,this.removeEmptyString=f}var Yl={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Yl[e]=new Fu(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Yl[t]=new Fu(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Yl[e]=new Fu(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Yl[e]=new Fu(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Yl[e]=new Fu(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Yl[e]=new Fu(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Yl[e]=new Fu(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Yl[e]=new Fu(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Yl[e]=new Fu(e,5,!1,e.toLowerCase(),null,!1,!1)});var $8=/[\-:]([a-z])/g;function H8(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace($8,H8);Yl[t]=new Fu(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace($8,H8);Yl[t]=new Fu(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace($8,H8);Yl[t]=new Fu(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Yl[e]=new Fu(e,1,!1,e.toLowerCase(),null,!1,!1)});Yl.xlinkHref=new Fu("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Yl[e]=new Fu(e,1,!1,e.toLowerCase(),null,!0,!0)});function G8(e,t,n,r){var a=Yl.hasOwnProperty(t)?Yl[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Dle(t,n,a,r)&&(n=null),r||a===null?Ole(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=n===null?a.type===3?!1:"":n:(t=a.attributeName,r=a.attributeNamespace,n===null?e.removeAttribute(t):(a=a.type,n=a===3||a===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var zp=Mle.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,E3=Symbol.for("react.element"),ev=Symbol.for("react.portal"),tv=Symbol.for("react.fragment"),q8=Symbol.for("react.strict_mode"),dM=Symbol.for("react.profiler"),Uq=Symbol.for("react.provider"),Vq=Symbol.for("react.context"),Z8=Symbol.for("react.forward_ref"),hM=Symbol.for("react.suspense"),fM=Symbol.for("react.suspense_list"),W8=Symbol.for("react.memo"),Om=Symbol.for("react.lazy"),$q=Symbol.for("react.offscreen"),HF=Symbol.iterator;function Uw(e){return e===null||typeof e!="object"?null:(e=HF&&e[HF]||e["@@iterator"],typeof e=="function"?e:null)}var Bo=Object.assign,f5;function s2(e){if(f5===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);f5=t&&t[1]||""}return`
`+f5+e}var p5=!1;function m5(e,t){if(!e||p5)return"";p5=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(x){var r=x}Reflect.construct(e,[],t)}else{try{t.call()}catch(x){r=x}e.call(t.prototype)}else{try{throw Error()}catch(x){r=x}e()}}catch(x){if(x&&r&&typeof x.stack=="string"){for(var a=x.stack.split(`
`),l=r.stack.split(`
`),f=a.length-1,i=l.length-1;1<=f&&0<=i&&a[f]!==l[i];)i--;for(;1<=f&&0<=i;f--,i--)if(a[f]!==l[i]){if(f!==1||i!==1)do if(f--,i--,0>i||a[f]!==l[i]){var y=`
`+a[f].replace(" at new "," at ");return e.displayName&&y.includes("<anonymous>")&&(y=y.replace("<anonymous>",e.displayName)),y}while(1<=f&&0<=i);break}}}finally{p5=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?s2(e):""}function Nle(e){switch(e.tag){case 5:return s2(e.type);case 16:return s2("Lazy");case 13:return s2("Suspense");case 19:return s2("SuspenseList");case 0:case 2:case 15:return e=m5(e.type,!1),e;case 11:return e=m5(e.type.render,!1),e;case 1:return e=m5(e.type,!0),e;default:return""}}function pM(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case tv:return"Fragment";case ev:return"Portal";case dM:return"Profiler";case q8:return"StrictMode";case hM:return"Suspense";case fM:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Vq:return(e.displayName||"Context")+".Consumer";case Uq:return(e._context.displayName||"Context")+".Provider";case Z8:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case W8:return t=e.displayName||null,t!==null?t:pM(e.type)||"Memo";case Om:t=e._payload,e=e._init;try{return pM(e(t))}catch{}}return null}function zle(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return pM(t);case 8:return t===q8?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function _0(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Hq(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Fle(e){var t=Hq(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var a=n.get,l=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(f){r=""+f,l.call(this,f)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(f){r=""+f},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function S3(e){e._valueTracker||(e._valueTracker=Fle(e))}function Gq(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Hq(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function bA(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function mM(e,t){var n=t.checked;return Bo({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function GF(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=_0(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function qq(e,t){t=t.checked,t!=null&&G8(e,"checked",t,!1)}function gM(e,t){qq(e,t);var n=_0(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?_M(e,t.type,n):t.hasOwnProperty("defaultValue")&&_M(e,t.type,_0(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function qF(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function _M(e,t,n){(t!=="number"||bA(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var a2=Array.isArray;function mv(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+_0(n),t=null,a=0;a<e.length;a++){if(e[a].value===n){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function yM(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ir(91));return Bo({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ZF(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(ir(92));if(a2(n)){if(1<n.length)throw Error(ir(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:_0(n)}}function Zq(e,t){var n=_0(t.value),r=_0(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function WF(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Wq(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function vM(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Wq(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var A3,Xq=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(A3=A3||document.createElement("div"),A3.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=A3.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Z2(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var E2={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ble=["Webkit","ms","Moz","O"];Object.keys(E2).forEach(function(e){Ble.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),E2[t]=E2[e]})});function Yq(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||E2.hasOwnProperty(e)&&E2[e]?(""+t).trim():t+"px"}function Kq(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,a=Yq(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}var jle=Bo({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xM(e,t){if(t){if(jle[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ir(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ir(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ir(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ir(62))}}function bM(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wM=null;function X8(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var TM=null,gv=null,_v=null;function XF(e){if(e=qT(e)){if(typeof TM!="function")throw Error(ir(280));var t=e.stateNode;t&&(t=hk(t),TM(e.stateNode,e.type,t))}}function Qq(e){gv?_v?_v.push(e):_v=[e]:gv=e}function Jq(){if(gv){var e=gv,t=_v;if(_v=gv=null,XF(e),t)for(e=0;e<t.length;e++)XF(t[e])}}function eZ(e,t){return e(t)}function tZ(){}var g5=!1;function nZ(e,t,n){if(g5)return e(t,n);g5=!0;try{return eZ(e,t,n)}finally{g5=!1,(gv!==null||_v!==null)&&(tZ(),Jq())}}function W2(e,t){var n=e.stateNode;if(n===null)return null;var r=hk(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(ir(231,t,typeof n));return n}var EM=!1;if(Ep)try{var Vw={};Object.defineProperty(Vw,"passive",{get:function(){EM=!0}}),window.addEventListener("test",Vw,Vw),window.removeEventListener("test",Vw,Vw)}catch{EM=!1}function Ule(e,t,n,r,a,l,f,i,y){var x=Array.prototype.slice.call(arguments,3);try{t.apply(n,x)}catch(S){this.onError(S)}}var S2=!1,wA=null,TA=!1,SM=null,Vle={onError:function(e){S2=!0,wA=e}};function $le(e,t,n,r,a,l,f,i,y){S2=!1,wA=null,Ule.apply(Vle,arguments)}function Hle(e,t,n,r,a,l,f,i,y){if($le.apply(this,arguments),S2){if(S2){var x=wA;S2=!1,wA=null}else throw Error(ir(198));TA||(TA=!0,SM=x)}}function j_(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function rZ(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function YF(e){if(j_(e)!==e)throw Error(ir(188))}function Gle(e){var t=e.alternate;if(!t){if(t=j_(e),t===null)throw Error(ir(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(a===null)break;var l=a.alternate;if(l===null){if(r=a.return,r!==null){n=r;continue}break}if(a.child===l.child){for(l=a.child;l;){if(l===n)return YF(a),e;if(l===r)return YF(a),t;l=l.sibling}throw Error(ir(188))}if(n.return!==r.return)n=a,r=l;else{for(var f=!1,i=a.child;i;){if(i===n){f=!0,n=a,r=l;break}if(i===r){f=!0,r=a,n=l;break}i=i.sibling}if(!f){for(i=l.child;i;){if(i===n){f=!0,n=l,r=a;break}if(i===r){f=!0,r=l,n=a;break}i=i.sibling}if(!f)throw Error(ir(189))}}if(n.alternate!==r)throw Error(ir(190))}if(n.tag!==3)throw Error(ir(188));return n.stateNode.current===n?e:t}function iZ(e){return e=Gle(e),e!==null?sZ(e):null}function sZ(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=sZ(e);if(t!==null)return t;e=e.sibling}return null}var aZ=Uc.unstable_scheduleCallback,KF=Uc.unstable_cancelCallback,qle=Uc.unstable_shouldYield,Zle=Uc.unstable_requestPaint,Qo=Uc.unstable_now,Wle=Uc.unstable_getCurrentPriorityLevel,Y8=Uc.unstable_ImmediatePriority,oZ=Uc.unstable_UserBlockingPriority,EA=Uc.unstable_NormalPriority,Xle=Uc.unstable_LowPriority,lZ=Uc.unstable_IdlePriority,lk=null,pf=null;function Yle(e){if(pf&&typeof pf.onCommitFiberRoot=="function")try{pf.onCommitFiberRoot(lk,e,void 0,(e.current.flags&128)===128)}catch{}}var fh=Math.clz32?Math.clz32:Jle,Kle=Math.log,Qle=Math.LN2;function Jle(e){return e>>>=0,e===0?32:31-(Kle(e)/Qle|0)|0}var C3=64,k3=4194304;function o2(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function SA(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,a=e.suspendedLanes,l=e.pingedLanes,f=n&268435455;if(f!==0){var i=f&~a;i!==0?r=o2(i):(l&=f,l!==0&&(r=o2(l)))}else f=n&~a,f!==0?r=o2(f):l!==0&&(r=o2(l));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,l=t&-t,a>=l||a===16&&(l&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-fh(t),a=1<<n,r|=e[n],t&=~a;return r}function eue(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tue(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,l=e.pendingLanes;0<l;){var f=31-fh(l),i=1<<f,y=a[f];y===-1?(!(i&n)||i&r)&&(a[f]=eue(i,t)):y<=t&&(e.expiredLanes|=i),l&=~i}}function AM(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function uZ(){var e=C3;return C3<<=1,!(C3&4194240)&&(C3=64),e}function _5(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function HT(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-fh(t),e[t]=n}function nue(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-fh(n),l=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~l}}function K8(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-fh(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var qa=0;function cZ(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var dZ,Q8,hZ,fZ,pZ,CM=!1,I3=[],r0=null,i0=null,s0=null,X2=new Map,Y2=new Map,Um=[],rue="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function QF(e,t){switch(e){case"focusin":case"focusout":r0=null;break;case"dragenter":case"dragleave":i0=null;break;case"mouseover":case"mouseout":s0=null;break;case"pointerover":case"pointerout":X2.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Y2.delete(t.pointerId)}}function $w(e,t,n,r,a,l){return e===null||e.nativeEvent!==l?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:l,targetContainers:[a]},t!==null&&(t=qT(t),t!==null&&Q8(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function iue(e,t,n,r,a){switch(t){case"focusin":return r0=$w(r0,e,t,n,r,a),!0;case"dragenter":return i0=$w(i0,e,t,n,r,a),!0;case"mouseover":return s0=$w(s0,e,t,n,r,a),!0;case"pointerover":var l=a.pointerId;return X2.set(l,$w(X2.get(l)||null,e,t,n,r,a)),!0;case"gotpointercapture":return l=a.pointerId,Y2.set(l,$w(Y2.get(l)||null,e,t,n,r,a)),!0}return!1}function mZ(e){var t=Zg(e.target);if(t!==null){var n=j_(t);if(n!==null){if(t=n.tag,t===13){if(t=rZ(n),t!==null){e.blockedOn=t,pZ(e.priority,function(){hZ(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function b4(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=kM(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);wM=r,n.target.dispatchEvent(r),wM=null}else return t=qT(n),t!==null&&Q8(t),e.blockedOn=n,!1;t.shift()}return!0}function JF(e,t,n){b4(e)&&n.delete(t)}function sue(){CM=!1,r0!==null&&b4(r0)&&(r0=null),i0!==null&&b4(i0)&&(i0=null),s0!==null&&b4(s0)&&(s0=null),X2.forEach(JF),Y2.forEach(JF)}function Hw(e,t){e.blockedOn===t&&(e.blockedOn=null,CM||(CM=!0,Uc.unstable_scheduleCallback(Uc.unstable_NormalPriority,sue)))}function K2(e){function t(a){return Hw(a,e)}if(0<I3.length){Hw(I3[0],e);for(var n=1;n<I3.length;n++){var r=I3[n];r.blockedOn===e&&(r.blockedOn=null)}}for(r0!==null&&Hw(r0,e),i0!==null&&Hw(i0,e),s0!==null&&Hw(s0,e),X2.forEach(t),Y2.forEach(t),n=0;n<Um.length;n++)r=Um[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<Um.length&&(n=Um[0],n.blockedOn===null);)mZ(n),n.blockedOn===null&&Um.shift()}var yv=zp.ReactCurrentBatchConfig,AA=!0;function aue(e,t,n,r){var a=qa,l=yv.transition;yv.transition=null;try{qa=1,J8(e,t,n,r)}finally{qa=a,yv.transition=l}}function oue(e,t,n,r){var a=qa,l=yv.transition;yv.transition=null;try{qa=4,J8(e,t,n,r)}finally{qa=a,yv.transition=l}}function J8(e,t,n,r){if(AA){var a=kM(e,t,n,r);if(a===null)C5(e,t,r,CA,n),QF(e,r);else if(iue(a,e,t,n,r))r.stopPropagation();else if(QF(e,r),t&4&&-1<rue.indexOf(e)){for(;a!==null;){var l=qT(a);if(l!==null&&dZ(l),l=kM(e,t,n,r),l===null&&C5(e,t,r,CA,n),l===a)break;a=l}a!==null&&r.stopPropagation()}else C5(e,t,r,null,n)}}var CA=null;function kM(e,t,n,r){if(CA=null,e=X8(r),e=Zg(e),e!==null)if(t=j_(e),t===null)e=null;else if(n=t.tag,n===13){if(e=rZ(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return CA=e,null}function gZ(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Wle()){case Y8:return 1;case oZ:return 4;case EA:case Xle:return 16;case lZ:return 536870912;default:return 16}default:return 16}}var Km=null,eL=null,w4=null;function _Z(){if(w4)return w4;var e,t=eL,n=t.length,r,a="value"in Km?Km.value:Km.textContent,l=a.length;for(e=0;e<n&&t[e]===a[e];e++);var f=n-e;for(r=1;r<=f&&t[n-r]===a[l-r];r++);return w4=a.slice(e,1<r?1-r:void 0)}function T4(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function R3(){return!0}function eB(){return!1}function Gc(e){function t(n,r,a,l,f){this._reactName=n,this._targetInst=a,this.type=r,this.nativeEvent=l,this.target=f,this.currentTarget=null;for(var i in e)e.hasOwnProperty(i)&&(n=e[i],this[i]=n?n(l):l[i]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?R3:eB,this.isPropagationStopped=eB,this}return Bo(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=R3)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=R3)},persist:function(){},isPersistent:R3}),t}var bx={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tL=Gc(bx),GT=Bo({},bx,{view:0,detail:0}),lue=Gc(GT),y5,v5,Gw,uk=Bo({},GT,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nL,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Gw&&(Gw&&e.type==="mousemove"?(y5=e.screenX-Gw.screenX,v5=e.screenY-Gw.screenY):v5=y5=0,Gw=e),y5)},movementY:function(e){return"movementY"in e?e.movementY:v5}}),tB=Gc(uk),uue=Bo({},uk,{dataTransfer:0}),cue=Gc(uue),due=Bo({},GT,{relatedTarget:0}),x5=Gc(due),hue=Bo({},bx,{animationName:0,elapsedTime:0,pseudoElement:0}),fue=Gc(hue),pue=Bo({},bx,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),mue=Gc(pue),gue=Bo({},bx,{data:0}),nB=Gc(gue),_ue={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yue={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vue={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xue(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=vue[e])?!!t[e]:!1}function nL(){return xue}var bue=Bo({},GT,{key:function(e){if(e.key){var t=_ue[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=T4(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?yue[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nL,charCode:function(e){return e.type==="keypress"?T4(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?T4(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),wue=Gc(bue),Tue=Bo({},uk,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rB=Gc(Tue),Eue=Bo({},GT,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nL}),Sue=Gc(Eue),Aue=Bo({},bx,{propertyName:0,elapsedTime:0,pseudoElement:0}),Cue=Gc(Aue),kue=Bo({},uk,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Iue=Gc(kue),Rue=[9,13,27,32],rL=Ep&&"CompositionEvent"in window,A2=null;Ep&&"documentMode"in document&&(A2=document.documentMode);var Mue=Ep&&"TextEvent"in window&&!A2,yZ=Ep&&(!rL||A2&&8<A2&&11>=A2),iB=" ",sB=!1;function vZ(e,t){switch(e){case"keyup":return Rue.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xZ(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var nv=!1;function Pue(e,t){switch(e){case"compositionend":return xZ(t);case"keypress":return t.which!==32?null:(sB=!0,iB);case"textInput":return e=t.data,e===iB&&sB?null:e;default:return null}}function Oue(e,t){if(nv)return e==="compositionend"||!rL&&vZ(e,t)?(e=_Z(),w4=eL=Km=null,nv=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return yZ&&t.locale!=="ko"?null:t.data;default:return null}}var Lue={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function aB(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Lue[e.type]:t==="textarea"}function bZ(e,t,n,r){Qq(r),t=kA(t,"onChange"),0<t.length&&(n=new tL("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var C2=null,Q2=null;function Due(e){PZ(e,0)}function ck(e){var t=sv(e);if(Gq(t))return e}function Nue(e,t){if(e==="change")return t}var wZ=!1;if(Ep){var b5;if(Ep){var w5="oninput"in document;if(!w5){var oB=document.createElement("div");oB.setAttribute("oninput","return;"),w5=typeof oB.oninput=="function"}b5=w5}else b5=!1;wZ=b5&&(!document.documentMode||9<document.documentMode)}function lB(){C2&&(C2.detachEvent("onpropertychange",TZ),Q2=C2=null)}function TZ(e){if(e.propertyName==="value"&&ck(Q2)){var t=[];bZ(t,Q2,e,X8(e)),nZ(Due,t)}}function zue(e,t,n){e==="focusin"?(lB(),C2=t,Q2=n,C2.attachEvent("onpropertychange",TZ)):e==="focusout"&&lB()}function Fue(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ck(Q2)}function Bue(e,t){if(e==="click")return ck(t)}function jue(e,t){if(e==="input"||e==="change")return ck(t)}function Uue(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var gh=typeof Object.is=="function"?Object.is:Uue;function J2(e,t){if(gh(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!cM.call(t,a)||!gh(e[a],t[a]))return!1}return!0}function uB(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function cB(e,t){var n=uB(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=uB(n)}}function EZ(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?EZ(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function SZ(){for(var e=window,t=bA();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=bA(e.document)}return t}function iL(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Vue(e){var t=SZ(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&EZ(n.ownerDocument.documentElement,n)){if(r!==null&&iL(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=n.textContent.length,l=Math.min(r.start,a);r=r.end===void 0?l:Math.min(r.end,a),!e.extend&&l>r&&(a=r,r=l,l=a),a=cB(n,l);var f=cB(n,r);a&&f&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==f.node||e.focusOffset!==f.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),l>r?(e.addRange(t),e.extend(f.node,f.offset)):(t.setEnd(f.node,f.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var $ue=Ep&&"documentMode"in document&&11>=document.documentMode,rv=null,IM=null,k2=null,RM=!1;function dB(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;RM||rv==null||rv!==bA(r)||(r=rv,"selectionStart"in r&&iL(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),k2&&J2(k2,r)||(k2=r,r=kA(IM,"onSelect"),0<r.length&&(t=new tL("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=rv)))}function M3(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var iv={animationend:M3("Animation","AnimationEnd"),animationiteration:M3("Animation","AnimationIteration"),animationstart:M3("Animation","AnimationStart"),transitionend:M3("Transition","TransitionEnd")},T5={},AZ={};Ep&&(AZ=document.createElement("div").style,"AnimationEvent"in window||(delete iv.animationend.animation,delete iv.animationiteration.animation,delete iv.animationstart.animation),"TransitionEvent"in window||delete iv.transitionend.transition);function dk(e){if(T5[e])return T5[e];if(!iv[e])return e;var t=iv[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in AZ)return T5[e]=t[n];return e}var CZ=dk("animationend"),kZ=dk("animationiteration"),IZ=dk("animationstart"),RZ=dk("transitionend"),MZ=new Map,hB="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function D0(e,t){MZ.set(e,t),B_(t,[e])}for(var E5=0;E5<hB.length;E5++){var S5=hB[E5],Hue=S5.toLowerCase(),Gue=S5[0].toUpperCase()+S5.slice(1);D0(Hue,"on"+Gue)}D0(CZ,"onAnimationEnd");D0(kZ,"onAnimationIteration");D0(IZ,"onAnimationStart");D0("dblclick","onDoubleClick");D0("focusin","onFocus");D0("focusout","onBlur");D0(RZ,"onTransitionEnd");$v("onMouseEnter",["mouseout","mouseover"]);$v("onMouseLeave",["mouseout","mouseover"]);$v("onPointerEnter",["pointerout","pointerover"]);$v("onPointerLeave",["pointerout","pointerover"]);B_("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));B_("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));B_("onBeforeInput",["compositionend","keypress","textInput","paste"]);B_("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));B_("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));B_("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var l2="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),que=new Set("cancel close invalid load scroll toggle".split(" ").concat(l2));function fB(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,Hle(r,t,void 0,e),e.currentTarget=null}function PZ(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var l=void 0;if(t)for(var f=r.length-1;0<=f;f--){var i=r[f],y=i.instance,x=i.currentTarget;if(i=i.listener,y!==l&&a.isPropagationStopped())break e;fB(a,i,x),l=y}else for(f=0;f<r.length;f++){if(i=r[f],y=i.instance,x=i.currentTarget,i=i.listener,y!==l&&a.isPropagationStopped())break e;fB(a,i,x),l=y}}}if(TA)throw e=SM,TA=!1,SM=null,e}function yo(e,t){var n=t[DM];n===void 0&&(n=t[DM]=new Set);var r=e+"__bubble";n.has(r)||(OZ(t,e,2,!1),n.add(r))}function A5(e,t,n){var r=0;t&&(r|=4),OZ(n,e,r,t)}var P3="_reactListening"+Math.random().toString(36).slice(2);function eT(e){if(!e[P3]){e[P3]=!0,jq.forEach(function(n){n!=="selectionchange"&&(que.has(n)||A5(n,!1,e),A5(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[P3]||(t[P3]=!0,A5("selectionchange",!1,t))}}function OZ(e,t,n,r){switch(gZ(t)){case 1:var a=aue;break;case 4:a=oue;break;default:a=J8}n=a.bind(null,t,n,e),a=void 0,!EM||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):a!==void 0?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function C5(e,t,n,r,a){var l=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var f=r.tag;if(f===3||f===4){var i=r.stateNode.containerInfo;if(i===a||i.nodeType===8&&i.parentNode===a)break;if(f===4)for(f=r.return;f!==null;){var y=f.tag;if((y===3||y===4)&&(y=f.stateNode.containerInfo,y===a||y.nodeType===8&&y.parentNode===a))return;f=f.return}for(;i!==null;){if(f=Zg(i),f===null)return;if(y=f.tag,y===5||y===6){r=l=f;continue e}i=i.parentNode}}r=r.return}nZ(function(){var x=l,S=X8(n),C=[];e:{var P=MZ.get(e);if(P!==void 0){var L=tL,F=e;switch(e){case"keypress":if(T4(n)===0)break e;case"keydown":case"keyup":L=wue;break;case"focusin":F="focus",L=x5;break;case"focusout":F="blur",L=x5;break;case"beforeblur":case"afterblur":L=x5;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":L=tB;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":L=cue;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":L=Sue;break;case CZ:case kZ:case IZ:L=fue;break;case RZ:L=Cue;break;case"scroll":L=lue;break;case"wheel":L=Iue;break;case"copy":case"cut":case"paste":L=mue;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":L=rB}var U=(t&4)!==0,q=!U&&e==="scroll",G=U?P!==null?P+"Capture":null:P;U=[];for(var $=x,X;$!==null;){X=$;var ie=X.stateNode;if(X.tag===5&&ie!==null&&(X=ie,G!==null&&(ie=W2($,G),ie!=null&&U.push(tT($,ie,X)))),q)break;$=$.return}0<U.length&&(P=new L(P,F,null,n,S),C.push({event:P,listeners:U}))}}if(!(t&7)){e:{if(P=e==="mouseover"||e==="pointerover",L=e==="mouseout"||e==="pointerout",P&&n!==wM&&(F=n.relatedTarget||n.fromElement)&&(Zg(F)||F[Sp]))break e;if((L||P)&&(P=S.window===S?S:(P=S.ownerDocument)?P.defaultView||P.parentWindow:window,L?(F=n.relatedTarget||n.toElement,L=x,F=F?Zg(F):null,F!==null&&(q=j_(F),F!==q||F.tag!==5&&F.tag!==6)&&(F=null)):(L=null,F=x),L!==F)){if(U=tB,ie="onMouseLeave",G="onMouseEnter",$="mouse",(e==="pointerout"||e==="pointerover")&&(U=rB,ie="onPointerLeave",G="onPointerEnter",$="pointer"),q=L==null?P:sv(L),X=F==null?P:sv(F),P=new U(ie,$+"leave",L,n,S),P.target=q,P.relatedTarget=X,ie=null,Zg(S)===x&&(U=new U(G,$+"enter",F,n,S),U.target=X,U.relatedTarget=q,ie=U),q=ie,L&&F)t:{for(U=L,G=F,$=0,X=U;X;X=B1(X))$++;for(X=0,ie=G;ie;ie=B1(ie))X++;for(;0<$-X;)U=B1(U),$--;for(;0<X-$;)G=B1(G),X--;for(;$--;){if(U===G||G!==null&&U===G.alternate)break t;U=B1(U),G=B1(G)}U=null}else U=null;L!==null&&pB(C,P,L,U,!1),F!==null&&q!==null&&pB(C,q,F,U,!0)}}e:{if(P=x?sv(x):window,L=P.nodeName&&P.nodeName.toLowerCase(),L==="select"||L==="input"&&P.type==="file")var de=Nue;else if(aB(P))if(wZ)de=jue;else{de=Fue;var fe=zue}else(L=P.nodeName)&&L.toLowerCase()==="input"&&(P.type==="checkbox"||P.type==="radio")&&(de=Bue);if(de&&(de=de(e,x))){bZ(C,de,n,S);break e}fe&&fe(e,P,x),e==="focusout"&&(fe=P._wrapperState)&&fe.controlled&&P.type==="number"&&_M(P,"number",P.value)}switch(fe=x?sv(x):window,e){case"focusin":(aB(fe)||fe.contentEditable==="true")&&(rv=fe,IM=x,k2=null);break;case"focusout":k2=IM=rv=null;break;case"mousedown":RM=!0;break;case"contextmenu":case"mouseup":case"dragend":RM=!1,dB(C,n,S);break;case"selectionchange":if($ue)break;case"keydown":case"keyup":dB(C,n,S)}var be;if(rL)e:{switch(e){case"compositionstart":var ve="onCompositionStart";break e;case"compositionend":ve="onCompositionEnd";break e;case"compositionupdate":ve="onCompositionUpdate";break e}ve=void 0}else nv?vZ(e,n)&&(ve="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(ve="onCompositionStart");ve&&(yZ&&n.locale!=="ko"&&(nv||ve!=="onCompositionStart"?ve==="onCompositionEnd"&&nv&&(be=_Z()):(Km=S,eL="value"in Km?Km.value:Km.textContent,nv=!0)),fe=kA(x,ve),0<fe.length&&(ve=new nB(ve,e,null,n,S),C.push({event:ve,listeners:fe}),be?ve.data=be:(be=xZ(n),be!==null&&(ve.data=be)))),(be=Mue?Pue(e,n):Oue(e,n))&&(x=kA(x,"onBeforeInput"),0<x.length&&(S=new nB("onBeforeInput","beforeinput",null,n,S),C.push({event:S,listeners:x}),S.data=be))}PZ(C,t)})}function tT(e,t,n){return{instance:e,listener:t,currentTarget:n}}function kA(e,t){for(var n=t+"Capture",r=[];e!==null;){var a=e,l=a.stateNode;a.tag===5&&l!==null&&(a=l,l=W2(e,n),l!=null&&r.unshift(tT(e,l,a)),l=W2(e,t),l!=null&&r.push(tT(e,l,a))),e=e.return}return r}function B1(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function pB(e,t,n,r,a){for(var l=t._reactName,f=[];n!==null&&n!==r;){var i=n,y=i.alternate,x=i.stateNode;if(y!==null&&y===r)break;i.tag===5&&x!==null&&(i=x,a?(y=W2(n,l),y!=null&&f.unshift(tT(n,y,i))):a||(y=W2(n,l),y!=null&&f.push(tT(n,y,i)))),n=n.return}f.length!==0&&e.push({event:t,listeners:f})}var Zue=/\r\n?/g,Wue=/\u0000|\uFFFD/g;function mB(e){return(typeof e=="string"?e:""+e).replace(Zue,`
`).replace(Wue,"")}function O3(e,t,n){if(t=mB(t),mB(e)!==t&&n)throw Error(ir(425))}function IA(){}var MM=null,PM=null;function OM(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var LM=typeof setTimeout=="function"?setTimeout:void 0,Xue=typeof clearTimeout=="function"?clearTimeout:void 0,gB=typeof Promise=="function"?Promise:void 0,Yue=typeof queueMicrotask=="function"?queueMicrotask:typeof gB<"u"?function(e){return gB.resolve(null).then(e).catch(Kue)}:LM;function Kue(e){setTimeout(function(){throw e})}function k5(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"){if(r===0){e.removeChild(a),K2(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=a}while(n);K2(t)}function a0(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function _B(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var wx=Math.random().toString(36).slice(2),of="__reactFiber$"+wx,nT="__reactProps$"+wx,Sp="__reactContainer$"+wx,DM="__reactEvents$"+wx,Que="__reactListeners$"+wx,Jue="__reactHandles$"+wx;function Zg(e){var t=e[of];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Sp]||n[of]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=_B(e);e!==null;){if(n=e[of])return n;e=_B(e)}return t}e=n,n=e.parentNode}return null}function qT(e){return e=e[of]||e[Sp],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function sv(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ir(33))}function hk(e){return e[nT]||null}var NM=[],av=-1;function N0(e){return{current:e}}function xo(e){0>av||(e.current=NM[av],NM[av]=null,av--)}function ho(e,t){av++,NM[av]=e.current,e.current=t}var y0={},du=N0(y0),ac=N0(!1),g_=y0;function Hv(e,t){var n=e.type.contextTypes;if(!n)return y0;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},l;for(l in n)a[l]=t[l];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function oc(e){return e=e.childContextTypes,e!=null}function RA(){xo(ac),xo(du)}function yB(e,t,n){if(du.current!==y0)throw Error(ir(168));ho(du,t),ho(ac,n)}function LZ(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(ir(108,zle(e)||"Unknown",a));return Bo({},n,r)}function MA(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||y0,g_=du.current,ho(du,e),ho(ac,ac.current),!0}function vB(e,t,n){var r=e.stateNode;if(!r)throw Error(ir(169));n?(e=LZ(e,t,g_),r.__reactInternalMemoizedMergedChildContext=e,xo(ac),xo(du),ho(du,e)):xo(ac),ho(ac,n)}var op=null,fk=!1,I5=!1;function DZ(e){op===null?op=[e]:op.push(e)}function ece(e){fk=!0,DZ(e)}function z0(){if(!I5&&op!==null){I5=!0;var e=0,t=qa;try{var n=op;for(qa=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}op=null,fk=!1}catch(a){throw op!==null&&(op=op.slice(e+1)),aZ(Y8,z0),a}finally{qa=t,I5=!1}}return null}var ov=[],lv=0,PA=null,OA=0,hd=[],fd=0,__=null,pp=1,mp="";function $g(e,t){ov[lv++]=OA,ov[lv++]=PA,PA=e,OA=t}function NZ(e,t,n){hd[fd++]=pp,hd[fd++]=mp,hd[fd++]=__,__=e;var r=pp;e=mp;var a=32-fh(r)-1;r&=~(1<<a),n+=1;var l=32-fh(t)+a;if(30<l){var f=a-a%5;l=(r&(1<<f)-1).toString(32),r>>=f,a-=f,pp=1<<32-fh(t)+a|n<<a|r,mp=l+e}else pp=1<<l|n<<a|r,mp=e}function sL(e){e.return!==null&&($g(e,1),NZ(e,1,0))}function aL(e){for(;e===PA;)PA=ov[--lv],ov[lv]=null,OA=ov[--lv],ov[lv]=null;for(;e===__;)__=hd[--fd],hd[fd]=null,mp=hd[--fd],hd[fd]=null,pp=hd[--fd],hd[fd]=null}var zc=null,Dc=null,ko=!1,dh=null;function zZ(e,t){var n=_d(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function xB(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,zc=e,Dc=a0(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,zc=e,Dc=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=__!==null?{id:pp,overflow:mp}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=_d(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,zc=e,Dc=null,!0):!1;default:return!1}}function zM(e){return(e.mode&1)!==0&&(e.flags&128)===0}function FM(e){if(ko){var t=Dc;if(t){var n=t;if(!xB(e,t)){if(zM(e))throw Error(ir(418));t=a0(n.nextSibling);var r=zc;t&&xB(e,t)?zZ(r,n):(e.flags=e.flags&-4097|2,ko=!1,zc=e)}}else{if(zM(e))throw Error(ir(418));e.flags=e.flags&-4097|2,ko=!1,zc=e}}}function bB(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;zc=e}function L3(e){if(e!==zc)return!1;if(!ko)return bB(e),ko=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!OM(e.type,e.memoizedProps)),t&&(t=Dc)){if(zM(e))throw FZ(),Error(ir(418));for(;t;)zZ(e,t),t=a0(t.nextSibling)}if(bB(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ir(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Dc=a0(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Dc=null}}else Dc=zc?a0(e.stateNode.nextSibling):null;return!0}function FZ(){for(var e=Dc;e;)e=a0(e.nextSibling)}function Gv(){Dc=zc=null,ko=!1}function oL(e){dh===null?dh=[e]:dh.push(e)}var tce=zp.ReactCurrentBatchConfig;function qw(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ir(309));var r=n.stateNode}if(!r)throw Error(ir(147,e));var a=r,l=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===l?t.ref:(t=function(f){var i=a.refs;f===null?delete i[l]:i[l]=f},t._stringRef=l,t)}if(typeof e!="string")throw Error(ir(284));if(!n._owner)throw Error(ir(290,e))}return e}function D3(e,t){throw e=Object.prototype.toString.call(t),Error(ir(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function wB(e){var t=e._init;return t(e._payload)}function BZ(e){function t(G,$){if(e){var X=G.deletions;X===null?(G.deletions=[$],G.flags|=16):X.push($)}}function n(G,$){if(!e)return null;for(;$!==null;)t(G,$),$=$.sibling;return null}function r(G,$){for(G=new Map;$!==null;)$.key!==null?G.set($.key,$):G.set($.index,$),$=$.sibling;return G}function a(G,$){return G=c0(G,$),G.index=0,G.sibling=null,G}function l(G,$,X){return G.index=X,e?(X=G.alternate,X!==null?(X=X.index,X<$?(G.flags|=2,$):X):(G.flags|=2,$)):(G.flags|=1048576,$)}function f(G){return e&&G.alternate===null&&(G.flags|=2),G}function i(G,$,X,ie){return $===null||$.tag!==6?($=N5(X,G.mode,ie),$.return=G,$):($=a($,X),$.return=G,$)}function y(G,$,X,ie){var de=X.type;return de===tv?S(G,$,X.props.children,ie,X.key):$!==null&&($.elementType===de||typeof de=="object"&&de!==null&&de.$$typeof===Om&&wB(de)===$.type)?(ie=a($,X.props),ie.ref=qw(G,$,X),ie.return=G,ie):(ie=R4(X.type,X.key,X.props,null,G.mode,ie),ie.ref=qw(G,$,X),ie.return=G,ie)}function x(G,$,X,ie){return $===null||$.tag!==4||$.stateNode.containerInfo!==X.containerInfo||$.stateNode.implementation!==X.implementation?($=z5(X,G.mode,ie),$.return=G,$):($=a($,X.children||[]),$.return=G,$)}function S(G,$,X,ie,de){return $===null||$.tag!==7?($=u_(X,G.mode,ie,de),$.return=G,$):($=a($,X),$.return=G,$)}function C(G,$,X){if(typeof $=="string"&&$!==""||typeof $=="number")return $=N5(""+$,G.mode,X),$.return=G,$;if(typeof $=="object"&&$!==null){switch($.$$typeof){case E3:return X=R4($.type,$.key,$.props,null,G.mode,X),X.ref=qw(G,null,$),X.return=G,X;case ev:return $=z5($,G.mode,X),$.return=G,$;case Om:var ie=$._init;return C(G,ie($._payload),X)}if(a2($)||Uw($))return $=u_($,G.mode,X,null),$.return=G,$;D3(G,$)}return null}function P(G,$,X,ie){var de=$!==null?$.key:null;if(typeof X=="string"&&X!==""||typeof X=="number")return de!==null?null:i(G,$,""+X,ie);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case E3:return X.key===de?y(G,$,X,ie):null;case ev:return X.key===de?x(G,$,X,ie):null;case Om:return de=X._init,P(G,$,de(X._payload),ie)}if(a2(X)||Uw(X))return de!==null?null:S(G,$,X,ie,null);D3(G,X)}return null}function L(G,$,X,ie,de){if(typeof ie=="string"&&ie!==""||typeof ie=="number")return G=G.get(X)||null,i($,G,""+ie,de);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case E3:return G=G.get(ie.key===null?X:ie.key)||null,y($,G,ie,de);case ev:return G=G.get(ie.key===null?X:ie.key)||null,x($,G,ie,de);case Om:var fe=ie._init;return L(G,$,X,fe(ie._payload),de)}if(a2(ie)||Uw(ie))return G=G.get(X)||null,S($,G,ie,de,null);D3($,ie)}return null}function F(G,$,X,ie){for(var de=null,fe=null,be=$,ve=$=0,Je=null;be!==null&&ve<X.length;ve++){be.index>ve?(Je=be,be=null):Je=be.sibling;var we=P(G,be,X[ve],ie);if(we===null){be===null&&(be=Je);break}e&&be&&we.alternate===null&&t(G,be),$=l(we,$,ve),fe===null?de=we:fe.sibling=we,fe=we,be=Je}if(ve===X.length)return n(G,be),ko&&$g(G,ve),de;if(be===null){for(;ve<X.length;ve++)be=C(G,X[ve],ie),be!==null&&($=l(be,$,ve),fe===null?de=be:fe.sibling=be,fe=be);return ko&&$g(G,ve),de}for(be=r(G,be);ve<X.length;ve++)Je=L(be,G,ve,X[ve],ie),Je!==null&&(e&&Je.alternate!==null&&be.delete(Je.key===null?ve:Je.key),$=l(Je,$,ve),fe===null?de=Je:fe.sibling=Je,fe=Je);return e&&be.forEach(function(rt){return t(G,rt)}),ko&&$g(G,ve),de}function U(G,$,X,ie){var de=Uw(X);if(typeof de!="function")throw Error(ir(150));if(X=de.call(X),X==null)throw Error(ir(151));for(var fe=de=null,be=$,ve=$=0,Je=null,we=X.next();be!==null&&!we.done;ve++,we=X.next()){be.index>ve?(Je=be,be=null):Je=be.sibling;var rt=P(G,be,we.value,ie);if(rt===null){be===null&&(be=Je);break}e&&be&&rt.alternate===null&&t(G,be),$=l(rt,$,ve),fe===null?de=rt:fe.sibling=rt,fe=rt,be=Je}if(we.done)return n(G,be),ko&&$g(G,ve),de;if(be===null){for(;!we.done;ve++,we=X.next())we=C(G,we.value,ie),we!==null&&($=l(we,$,ve),fe===null?de=we:fe.sibling=we,fe=we);return ko&&$g(G,ve),de}for(be=r(G,be);!we.done;ve++,we=X.next())we=L(be,G,ve,we.value,ie),we!==null&&(e&&we.alternate!==null&&be.delete(we.key===null?ve:we.key),$=l(we,$,ve),fe===null?de=we:fe.sibling=we,fe=we);return e&&be.forEach(function(He){return t(G,He)}),ko&&$g(G,ve),de}function q(G,$,X,ie){if(typeof X=="object"&&X!==null&&X.type===tv&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case E3:e:{for(var de=X.key,fe=$;fe!==null;){if(fe.key===de){if(de=X.type,de===tv){if(fe.tag===7){n(G,fe.sibling),$=a(fe,X.props.children),$.return=G,G=$;break e}}else if(fe.elementType===de||typeof de=="object"&&de!==null&&de.$$typeof===Om&&wB(de)===fe.type){n(G,fe.sibling),$=a(fe,X.props),$.ref=qw(G,fe,X),$.return=G,G=$;break e}n(G,fe);break}else t(G,fe);fe=fe.sibling}X.type===tv?($=u_(X.props.children,G.mode,ie,X.key),$.return=G,G=$):(ie=R4(X.type,X.key,X.props,null,G.mode,ie),ie.ref=qw(G,$,X),ie.return=G,G=ie)}return f(G);case ev:e:{for(fe=X.key;$!==null;){if($.key===fe)if($.tag===4&&$.stateNode.containerInfo===X.containerInfo&&$.stateNode.implementation===X.implementation){n(G,$.sibling),$=a($,X.children||[]),$.return=G,G=$;break e}else{n(G,$);break}else t(G,$);$=$.sibling}$=z5(X,G.mode,ie),$.return=G,G=$}return f(G);case Om:return fe=X._init,q(G,$,fe(X._payload),ie)}if(a2(X))return F(G,$,X,ie);if(Uw(X))return U(G,$,X,ie);D3(G,X)}return typeof X=="string"&&X!==""||typeof X=="number"?(X=""+X,$!==null&&$.tag===6?(n(G,$.sibling),$=a($,X),$.return=G,G=$):(n(G,$),$=N5(X,G.mode,ie),$.return=G,G=$),f(G)):n(G,$)}return q}var qv=BZ(!0),jZ=BZ(!1),LA=N0(null),DA=null,uv=null,lL=null;function uL(){lL=uv=DA=null}function cL(e){var t=LA.current;xo(LA),e._currentValue=t}function BM(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function vv(e,t){DA=e,lL=uv=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(sc=!0),e.firstContext=null)}function bd(e){var t=e._currentValue;if(lL!==e)if(e={context:e,memoizedValue:t,next:null},uv===null){if(DA===null)throw Error(ir(308));uv=e,DA.dependencies={lanes:0,firstContext:e}}else uv=uv.next=e;return t}var Wg=null;function dL(e){Wg===null?Wg=[e]:Wg.push(e)}function UZ(e,t,n,r){var a=t.interleaved;return a===null?(n.next=n,dL(t)):(n.next=a.next,a.next=n),t.interleaved=n,Ap(e,r)}function Ap(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Lm=!1;function hL(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function VZ(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function yp(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function o0(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Ca&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Ap(e,n)}return a=r.interleaved,a===null?(t.next=t,dL(r)):(t.next=a.next,a.next=t),r.interleaved=t,Ap(e,n)}function E4(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,K8(e,n)}}function TB(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var a=null,l=null;if(n=n.firstBaseUpdate,n!==null){do{var f={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};l===null?a=l=f:l=l.next=f,n=n.next}while(n!==null);l===null?a=l=t:l=l.next=t}else a=l=t;n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:l,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function NA(e,t,n,r){var a=e.updateQueue;Lm=!1;var l=a.firstBaseUpdate,f=a.lastBaseUpdate,i=a.shared.pending;if(i!==null){a.shared.pending=null;var y=i,x=y.next;y.next=null,f===null?l=x:f.next=x,f=y;var S=e.alternate;S!==null&&(S=S.updateQueue,i=S.lastBaseUpdate,i!==f&&(i===null?S.firstBaseUpdate=x:i.next=x,S.lastBaseUpdate=y))}if(l!==null){var C=a.baseState;f=0,S=x=y=null,i=l;do{var P=i.lane,L=i.eventTime;if((r&P)===P){S!==null&&(S=S.next={eventTime:L,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var F=e,U=i;switch(P=t,L=n,U.tag){case 1:if(F=U.payload,typeof F=="function"){C=F.call(L,C,P);break e}C=F;break e;case 3:F.flags=F.flags&-65537|128;case 0:if(F=U.payload,P=typeof F=="function"?F.call(L,C,P):F,P==null)break e;C=Bo({},C,P);break e;case 2:Lm=!0}}i.callback!==null&&i.lane!==0&&(e.flags|=64,P=a.effects,P===null?a.effects=[i]:P.push(i))}else L={eventTime:L,lane:P,tag:i.tag,payload:i.payload,callback:i.callback,next:null},S===null?(x=S=L,y=C):S=S.next=L,f|=P;if(i=i.next,i===null){if(i=a.shared.pending,i===null)break;P=i,i=P.next,P.next=null,a.lastBaseUpdate=P,a.shared.pending=null}}while(!0);if(S===null&&(y=C),a.baseState=y,a.firstBaseUpdate=x,a.lastBaseUpdate=S,t=a.shared.interleaved,t!==null){a=t;do f|=a.lane,a=a.next;while(a!==t)}else l===null&&(a.shared.lanes=0);v_|=f,e.lanes=f,e.memoizedState=C}}function EB(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=n,typeof a!="function")throw Error(ir(191,a));a.call(r)}}}var ZT={},mf=N0(ZT),rT=N0(ZT),iT=N0(ZT);function Xg(e){if(e===ZT)throw Error(ir(174));return e}function fL(e,t){switch(ho(iT,t),ho(rT,e),ho(mf,ZT),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:vM(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=vM(t,e)}xo(mf),ho(mf,t)}function Zv(){xo(mf),xo(rT),xo(iT)}function $Z(e){Xg(iT.current);var t=Xg(mf.current),n=vM(t,e.type);t!==n&&(ho(rT,e),ho(mf,n))}function pL(e){rT.current===e&&(xo(mf),xo(rT))}var No=N0(0);function zA(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var R5=[];function mL(){for(var e=0;e<R5.length;e++)R5[e]._workInProgressVersionPrimary=null;R5.length=0}var S4=zp.ReactCurrentDispatcher,M5=zp.ReactCurrentBatchConfig,y_=0,Fo=null,bl=null,Ol=null,FA=!1,I2=!1,sT=0,nce=0;function nu(){throw Error(ir(321))}function gL(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!gh(e[n],t[n]))return!1;return!0}function _L(e,t,n,r,a,l){if(y_=l,Fo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,S4.current=e===null||e.memoizedState===null?ace:oce,e=n(r,a),I2){l=0;do{if(I2=!1,sT=0,25<=l)throw Error(ir(301));l+=1,Ol=bl=null,t.updateQueue=null,S4.current=lce,e=n(r,a)}while(I2)}if(S4.current=BA,t=bl!==null&&bl.next!==null,y_=0,Ol=bl=Fo=null,FA=!1,t)throw Error(ir(300));return e}function yL(){var e=sT!==0;return sT=0,e}function Qh(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ol===null?Fo.memoizedState=Ol=e:Ol=Ol.next=e,Ol}function wd(){if(bl===null){var e=Fo.alternate;e=e!==null?e.memoizedState:null}else e=bl.next;var t=Ol===null?Fo.memoizedState:Ol.next;if(t!==null)Ol=t,bl=e;else{if(e===null)throw Error(ir(310));bl=e,e={memoizedState:bl.memoizedState,baseState:bl.baseState,baseQueue:bl.baseQueue,queue:bl.queue,next:null},Ol===null?Fo.memoizedState=Ol=e:Ol=Ol.next=e}return Ol}function aT(e,t){return typeof t=="function"?t(e):t}function P5(e){var t=wd(),n=t.queue;if(n===null)throw Error(ir(311));n.lastRenderedReducer=e;var r=bl,a=r.baseQueue,l=n.pending;if(l!==null){if(a!==null){var f=a.next;a.next=l.next,l.next=f}r.baseQueue=a=l,n.pending=null}if(a!==null){l=a.next,r=r.baseState;var i=f=null,y=null,x=l;do{var S=x.lane;if((y_&S)===S)y!==null&&(y=y.next={lane:0,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null}),r=x.hasEagerState?x.eagerState:e(r,x.action);else{var C={lane:S,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null};y===null?(i=y=C,f=r):y=y.next=C,Fo.lanes|=S,v_|=S}x=x.next}while(x!==null&&x!==l);y===null?f=r:y.next=i,gh(r,t.memoizedState)||(sc=!0),t.memoizedState=r,t.baseState=f,t.baseQueue=y,n.lastRenderedState=r}if(e=n.interleaved,e!==null){a=e;do l=a.lane,Fo.lanes|=l,v_|=l,a=a.next;while(a!==e)}else a===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function O5(e){var t=wd(),n=t.queue;if(n===null)throw Error(ir(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,l=t.memoizedState;if(a!==null){n.pending=null;var f=a=a.next;do l=e(l,f.action),f=f.next;while(f!==a);gh(l,t.memoizedState)||(sc=!0),t.memoizedState=l,t.baseQueue===null&&(t.baseState=l),n.lastRenderedState=l}return[l,r]}function HZ(){}function GZ(e,t){var n=Fo,r=wd(),a=t(),l=!gh(r.memoizedState,a);if(l&&(r.memoizedState=a,sc=!0),r=r.queue,vL(WZ.bind(null,n,r,e),[e]),r.getSnapshot!==t||l||Ol!==null&&Ol.memoizedState.tag&1){if(n.flags|=2048,oT(9,ZZ.bind(null,n,r,a,t),void 0,null),Dl===null)throw Error(ir(349));y_&30||qZ(n,t,a)}return a}function qZ(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=Fo.updateQueue,t===null?(t={lastEffect:null,stores:null},Fo.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function ZZ(e,t,n,r){t.value=n,t.getSnapshot=r,XZ(t)&&YZ(e)}function WZ(e,t,n){return n(function(){XZ(t)&&YZ(e)})}function XZ(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!gh(e,n)}catch{return!0}}function YZ(e){var t=Ap(e,1);t!==null&&ph(t,e,1,-1)}function SB(e){var t=Qh();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:aT,lastRenderedState:e},t.queue=e,e=e.dispatch=sce.bind(null,Fo,e),[t.memoizedState,e]}function oT(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=Fo.updateQueue,t===null?(t={lastEffect:null,stores:null},Fo.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function KZ(){return wd().memoizedState}function A4(e,t,n,r){var a=Qh();Fo.flags|=e,a.memoizedState=oT(1|t,n,void 0,r===void 0?null:r)}function pk(e,t,n,r){var a=wd();r=r===void 0?null:r;var l=void 0;if(bl!==null){var f=bl.memoizedState;if(l=f.destroy,r!==null&&gL(r,f.deps)){a.memoizedState=oT(t,n,l,r);return}}Fo.flags|=e,a.memoizedState=oT(1|t,n,l,r)}function AB(e,t){return A4(8390656,8,e,t)}function vL(e,t){return pk(2048,8,e,t)}function QZ(e,t){return pk(4,2,e,t)}function JZ(e,t){return pk(4,4,e,t)}function eW(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function tW(e,t,n){return n=n!=null?n.concat([e]):null,pk(4,4,eW.bind(null,t,e),n)}function xL(){}function nW(e,t){var n=wd();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&gL(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function rW(e,t){var n=wd();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&gL(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function iW(e,t,n){return y_&21?(gh(n,t)||(n=uZ(),Fo.lanes|=n,v_|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,sc=!0),e.memoizedState=n)}function rce(e,t){var n=qa;qa=n!==0&&4>n?n:4,e(!0);var r=M5.transition;M5.transition={};try{e(!1),t()}finally{qa=n,M5.transition=r}}function sW(){return wd().memoizedState}function ice(e,t,n){var r=u0(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},aW(e))oW(t,n);else if(n=UZ(e,t,n,r),n!==null){var a=Du();ph(n,e,r,a),lW(n,t,r)}}function sce(e,t,n){var r=u0(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(aW(e))oW(t,a);else{var l=e.alternate;if(e.lanes===0&&(l===null||l.lanes===0)&&(l=t.lastRenderedReducer,l!==null))try{var f=t.lastRenderedState,i=l(f,n);if(a.hasEagerState=!0,a.eagerState=i,gh(i,f)){var y=t.interleaved;y===null?(a.next=a,dL(t)):(a.next=y.next,y.next=a),t.interleaved=a;return}}catch{}finally{}n=UZ(e,t,a,r),n!==null&&(a=Du(),ph(n,e,r,a),lW(n,t,r))}}function aW(e){var t=e.alternate;return e===Fo||t!==null&&t===Fo}function oW(e,t){I2=FA=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function lW(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,K8(e,n)}}var BA={readContext:bd,useCallback:nu,useContext:nu,useEffect:nu,useImperativeHandle:nu,useInsertionEffect:nu,useLayoutEffect:nu,useMemo:nu,useReducer:nu,useRef:nu,useState:nu,useDebugValue:nu,useDeferredValue:nu,useTransition:nu,useMutableSource:nu,useSyncExternalStore:nu,useId:nu,unstable_isNewReconciler:!1},ace={readContext:bd,useCallback:function(e,t){return Qh().memoizedState=[e,t===void 0?null:t],e},useContext:bd,useEffect:AB,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,A4(4194308,4,eW.bind(null,t,e),n)},useLayoutEffect:function(e,t){return A4(4194308,4,e,t)},useInsertionEffect:function(e,t){return A4(4,2,e,t)},useMemo:function(e,t){var n=Qh();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Qh();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ice.bind(null,Fo,e),[r.memoizedState,e]},useRef:function(e){var t=Qh();return e={current:e},t.memoizedState=e},useState:SB,useDebugValue:xL,useDeferredValue:function(e){return Qh().memoizedState=e},useTransition:function(){var e=SB(!1),t=e[0];return e=rce.bind(null,e[1]),Qh().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=Fo,a=Qh();if(ko){if(n===void 0)throw Error(ir(407));n=n()}else{if(n=t(),Dl===null)throw Error(ir(349));y_&30||qZ(r,t,n)}a.memoizedState=n;var l={value:n,getSnapshot:t};return a.queue=l,AB(WZ.bind(null,r,l,e),[e]),r.flags|=2048,oT(9,ZZ.bind(null,r,l,n,t),void 0,null),n},useId:function(){var e=Qh(),t=Dl.identifierPrefix;if(ko){var n=mp,r=pp;n=(r&~(1<<32-fh(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=sT++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=nce++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},oce={readContext:bd,useCallback:nW,useContext:bd,useEffect:vL,useImperativeHandle:tW,useInsertionEffect:QZ,useLayoutEffect:JZ,useMemo:rW,useReducer:P5,useRef:KZ,useState:function(){return P5(aT)},useDebugValue:xL,useDeferredValue:function(e){var t=wd();return iW(t,bl.memoizedState,e)},useTransition:function(){var e=P5(aT)[0],t=wd().memoizedState;return[e,t]},useMutableSource:HZ,useSyncExternalStore:GZ,useId:sW,unstable_isNewReconciler:!1},lce={readContext:bd,useCallback:nW,useContext:bd,useEffect:vL,useImperativeHandle:tW,useInsertionEffect:QZ,useLayoutEffect:JZ,useMemo:rW,useReducer:O5,useRef:KZ,useState:function(){return O5(aT)},useDebugValue:xL,useDeferredValue:function(e){var t=wd();return bl===null?t.memoizedState=e:iW(t,bl.memoizedState,e)},useTransition:function(){var e=O5(aT)[0],t=wd().memoizedState;return[e,t]},useMutableSource:HZ,useSyncExternalStore:GZ,useId:sW,unstable_isNewReconciler:!1};function ah(e,t){if(e&&e.defaultProps){t=Bo({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function jM(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:Bo({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var mk={isMounted:function(e){return(e=e._reactInternals)?j_(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Du(),a=u0(e),l=yp(r,a);l.payload=t,n!=null&&(l.callback=n),t=o0(e,l,a),t!==null&&(ph(t,e,a,r),E4(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Du(),a=u0(e),l=yp(r,a);l.tag=1,l.payload=t,n!=null&&(l.callback=n),t=o0(e,l,a),t!==null&&(ph(t,e,a,r),E4(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Du(),r=u0(e),a=yp(n,r);a.tag=2,t!=null&&(a.callback=t),t=o0(e,a,r),t!==null&&(ph(t,e,r,n),E4(t,e,r))}};function CB(e,t,n,r,a,l,f){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,l,f):t.prototype&&t.prototype.isPureReactComponent?!J2(n,r)||!J2(a,l):!0}function uW(e,t,n){var r=!1,a=y0,l=t.contextType;return typeof l=="object"&&l!==null?l=bd(l):(a=oc(t)?g_:du.current,r=t.contextTypes,l=(r=r!=null)?Hv(e,a):y0),t=new t(n,l),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=mk,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=l),t}function kB(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&mk.enqueueReplaceState(t,t.state,null)}function UM(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},hL(e);var l=t.contextType;typeof l=="object"&&l!==null?a.context=bd(l):(l=oc(t)?g_:du.current,a.context=Hv(e,l)),a.state=e.memoizedState,l=t.getDerivedStateFromProps,typeof l=="function"&&(jM(e,t,l,n),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&mk.enqueueReplaceState(a,a.state,null),NA(e,n,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function Wv(e,t){try{var n="",r=t;do n+=Nle(r),r=r.return;while(r);var a=n}catch(l){a=`
Error generating stack: `+l.message+`
`+l.stack}return{value:e,source:t,stack:a,digest:null}}function L5(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function VM(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var uce=typeof WeakMap=="function"?WeakMap:Map;function cW(e,t,n){n=yp(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){UA||(UA=!0,QM=r),VM(e,t)},n}function dW(e,t,n){n=yp(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){VM(e,t)}}var l=e.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(n.callback=function(){VM(e,t),typeof r!="function"&&(l0===null?l0=new Set([this]):l0.add(this));var f=t.stack;this.componentDidCatch(t.value,{componentStack:f!==null?f:""})}),n}function IB(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new uce;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Tce.bind(null,e,t,n),t.then(e,e))}function RB(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function MB(e,t,n,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=yp(-1,1),t.tag=2,o0(n,t,1))),n.lanes|=1),e)}var cce=zp.ReactCurrentOwner,sc=!1;function Iu(e,t,n,r){t.child=e===null?jZ(t,null,n,r):qv(t,e.child,n,r)}function PB(e,t,n,r,a){n=n.render;var l=t.ref;return vv(t,a),r=_L(e,t,n,r,l,a),n=yL(),e!==null&&!sc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Cp(e,t,a)):(ko&&n&&sL(t),t.flags|=1,Iu(e,t,r,a),t.child)}function OB(e,t,n,r,a){if(e===null){var l=n.type;return typeof l=="function"&&!kL(l)&&l.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=l,hW(e,t,l,r,a)):(e=R4(n.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(l=e.child,!(e.lanes&a)){var f=l.memoizedProps;if(n=n.compare,n=n!==null?n:J2,n(f,r)&&e.ref===t.ref)return Cp(e,t,a)}return t.flags|=1,e=c0(l,r),e.ref=t.ref,e.return=t,t.child=e}function hW(e,t,n,r,a){if(e!==null){var l=e.memoizedProps;if(J2(l,r)&&e.ref===t.ref)if(sc=!1,t.pendingProps=r=l,(e.lanes&a)!==0)e.flags&131072&&(sc=!0);else return t.lanes=e.lanes,Cp(e,t,a)}return $M(e,t,n,r,a)}function fW(e,t,n){var r=t.pendingProps,a=r.children,l=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ho(dv,Pc),Pc|=n;else{if(!(n&1073741824))return e=l!==null?l.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ho(dv,Pc),Pc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=l!==null?l.baseLanes:n,ho(dv,Pc),Pc|=r}else l!==null?(r=l.baseLanes|n,t.memoizedState=null):r=n,ho(dv,Pc),Pc|=r;return Iu(e,t,a,n),t.child}function pW(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function $M(e,t,n,r,a){var l=oc(n)?g_:du.current;return l=Hv(t,l),vv(t,a),n=_L(e,t,n,r,l,a),r=yL(),e!==null&&!sc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Cp(e,t,a)):(ko&&r&&sL(t),t.flags|=1,Iu(e,t,n,a),t.child)}function LB(e,t,n,r,a){if(oc(n)){var l=!0;MA(t)}else l=!1;if(vv(t,a),t.stateNode===null)C4(e,t),uW(t,n,r),UM(t,n,r,a),r=!0;else if(e===null){var f=t.stateNode,i=t.memoizedProps;f.props=i;var y=f.context,x=n.contextType;typeof x=="object"&&x!==null?x=bd(x):(x=oc(n)?g_:du.current,x=Hv(t,x));var S=n.getDerivedStateFromProps,C=typeof S=="function"||typeof f.getSnapshotBeforeUpdate=="function";C||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(i!==r||y!==x)&&kB(t,f,r,x),Lm=!1;var P=t.memoizedState;f.state=P,NA(t,r,f,a),y=t.memoizedState,i!==r||P!==y||ac.current||Lm?(typeof S=="function"&&(jM(t,n,S,r),y=t.memoizedState),(i=Lm||CB(t,n,i,r,P,y,x))?(C||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(t.flags|=4194308)):(typeof f.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=y),f.props=r,f.state=y,f.context=x,r=i):(typeof f.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{f=t.stateNode,VZ(e,t),i=t.memoizedProps,x=t.type===t.elementType?i:ah(t.type,i),f.props=x,C=t.pendingProps,P=f.context,y=n.contextType,typeof y=="object"&&y!==null?y=bd(y):(y=oc(n)?g_:du.current,y=Hv(t,y));var L=n.getDerivedStateFromProps;(S=typeof L=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(i!==C||P!==y)&&kB(t,f,r,y),Lm=!1,P=t.memoizedState,f.state=P,NA(t,r,f,a);var F=t.memoizedState;i!==C||P!==F||ac.current||Lm?(typeof L=="function"&&(jM(t,n,L,r),F=t.memoizedState),(x=Lm||CB(t,n,x,r,P,F,y)||!1)?(S||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(r,F,y),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(r,F,y)),typeof f.componentDidUpdate=="function"&&(t.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof f.componentDidUpdate!="function"||i===e.memoizedProps&&P===e.memoizedState||(t.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&P===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=F),f.props=r,f.state=F,f.context=y,r=x):(typeof f.componentDidUpdate!="function"||i===e.memoizedProps&&P===e.memoizedState||(t.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&P===e.memoizedState||(t.flags|=1024),r=!1)}return HM(e,t,n,r,l,a)}function HM(e,t,n,r,a,l){pW(e,t);var f=(t.flags&128)!==0;if(!r&&!f)return a&&vB(t,n,!1),Cp(e,t,l);r=t.stateNode,cce.current=t;var i=f&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&f?(t.child=qv(t,e.child,null,l),t.child=qv(t,null,i,l)):Iu(e,t,i,l),t.memoizedState=r.state,a&&vB(t,n,!0),t.child}function mW(e){var t=e.stateNode;t.pendingContext?yB(e,t.pendingContext,t.pendingContext!==t.context):t.context&&yB(e,t.context,!1),fL(e,t.containerInfo)}function DB(e,t,n,r,a){return Gv(),oL(a),t.flags|=256,Iu(e,t,n,r),t.child}var GM={dehydrated:null,treeContext:null,retryLane:0};function qM(e){return{baseLanes:e,cachePool:null,transitions:null}}function gW(e,t,n){var r=t.pendingProps,a=No.current,l=!1,f=(t.flags&128)!==0,i;if((i=f)||(i=e!==null&&e.memoizedState===null?!1:(a&2)!==0),i?(l=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),ho(No,a&1),e===null)return FM(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(f=r.children,e=r.fallback,l?(r=t.mode,l=t.child,f={mode:"hidden",children:f},!(r&1)&&l!==null?(l.childLanes=0,l.pendingProps=f):l=yk(f,r,0,null),e=u_(e,r,n,null),l.return=t,e.return=t,l.sibling=e,t.child=l,t.child.memoizedState=qM(n),t.memoizedState=GM,e):bL(t,f));if(a=e.memoizedState,a!==null&&(i=a.dehydrated,i!==null))return dce(e,t,f,r,i,a,n);if(l){l=r.fallback,f=t.mode,a=e.child,i=a.sibling;var y={mode:"hidden",children:r.children};return!(f&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=y,t.deletions=null):(r=c0(a,y),r.subtreeFlags=a.subtreeFlags&14680064),i!==null?l=c0(i,l):(l=u_(l,f,n,null),l.flags|=2),l.return=t,r.return=t,r.sibling=l,t.child=r,r=l,l=t.child,f=e.child.memoizedState,f=f===null?qM(n):{baseLanes:f.baseLanes|n,cachePool:null,transitions:f.transitions},l.memoizedState=f,l.childLanes=e.childLanes&~n,t.memoizedState=GM,r}return l=e.child,e=l.sibling,r=c0(l,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function bL(e,t){return t=yk({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function N3(e,t,n,r){return r!==null&&oL(r),qv(t,e.child,null,n),e=bL(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function dce(e,t,n,r,a,l,f){if(n)return t.flags&256?(t.flags&=-257,r=L5(Error(ir(422))),N3(e,t,f,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(l=r.fallback,a=t.mode,r=yk({mode:"visible",children:r.children},a,0,null),l=u_(l,a,f,null),l.flags|=2,r.return=t,l.return=t,r.sibling=l,t.child=r,t.mode&1&&qv(t,e.child,null,f),t.child.memoizedState=qM(f),t.memoizedState=GM,l);if(!(t.mode&1))return N3(e,t,f,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var i=r.dgst;return r=i,l=Error(ir(419)),r=L5(l,r,void 0),N3(e,t,f,r)}if(i=(f&e.childLanes)!==0,sc||i){if(r=Dl,r!==null){switch(f&-f){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|f)?0:a,a!==0&&a!==l.retryLane&&(l.retryLane=a,Ap(e,a),ph(r,e,a,-1))}return CL(),r=L5(Error(ir(421))),N3(e,t,f,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=Ece.bind(null,e),a._reactRetry=t,null):(e=l.treeContext,Dc=a0(a.nextSibling),zc=t,ko=!0,dh=null,e!==null&&(hd[fd++]=pp,hd[fd++]=mp,hd[fd++]=__,pp=e.id,mp=e.overflow,__=t),t=bL(t,r.children),t.flags|=4096,t)}function NB(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),BM(e.return,t,n)}function D5(e,t,n,r,a){var l=e.memoizedState;l===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(l.isBackwards=t,l.rendering=null,l.renderingStartTime=0,l.last=r,l.tail=n,l.tailMode=a)}function _W(e,t,n){var r=t.pendingProps,a=r.revealOrder,l=r.tail;if(Iu(e,t,r.children,n),r=No.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&NB(e,n,t);else if(e.tag===19)NB(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ho(No,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;n!==null;)e=n.alternate,e!==null&&zA(e)===null&&(a=n),n=n.sibling;n=a,n===null?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),D5(t,!1,a,n,l);break;case"backwards":for(n=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&zA(e)===null){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}D5(t,!0,n,null,l);break;case"together":D5(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function C4(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Cp(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),v_|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(ir(153));if(t.child!==null){for(e=t.child,n=c0(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=c0(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function hce(e,t,n){switch(t.tag){case 3:mW(t),Gv();break;case 5:$Z(t);break;case 1:oc(t.type)&&MA(t);break;case 4:fL(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;ho(LA,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(ho(No,No.current&1),t.flags|=128,null):n&t.child.childLanes?gW(e,t,n):(ho(No,No.current&1),e=Cp(e,t,n),e!==null?e.sibling:null);ho(No,No.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return _W(e,t,n);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),ho(No,No.current),r)break;return null;case 22:case 23:return t.lanes=0,fW(e,t,n)}return Cp(e,t,n)}var yW,ZM,vW,xW;yW=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ZM=function(){};vW=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Xg(mf.current);var l=null;switch(n){case"input":a=mM(e,a),r=mM(e,r),l=[];break;case"select":a=Bo({},a,{value:void 0}),r=Bo({},r,{value:void 0}),l=[];break;case"textarea":a=yM(e,a),r=yM(e,r),l=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=IA)}xM(n,r);var f;n=null;for(x in a)if(!r.hasOwnProperty(x)&&a.hasOwnProperty(x)&&a[x]!=null)if(x==="style"){var i=a[x];for(f in i)i.hasOwnProperty(f)&&(n||(n={}),n[f]="")}else x!=="dangerouslySetInnerHTML"&&x!=="children"&&x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(q2.hasOwnProperty(x)?l||(l=[]):(l=l||[]).push(x,null));for(x in r){var y=r[x];if(i=a!=null?a[x]:void 0,r.hasOwnProperty(x)&&y!==i&&(y!=null||i!=null))if(x==="style")if(i){for(f in i)!i.hasOwnProperty(f)||y&&y.hasOwnProperty(f)||(n||(n={}),n[f]="");for(f in y)y.hasOwnProperty(f)&&i[f]!==y[f]&&(n||(n={}),n[f]=y[f])}else n||(l||(l=[]),l.push(x,n)),n=y;else x==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,i=i?i.__html:void 0,y!=null&&i!==y&&(l=l||[]).push(x,y)):x==="children"?typeof y!="string"&&typeof y!="number"||(l=l||[]).push(x,""+y):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&(q2.hasOwnProperty(x)?(y!=null&&x==="onScroll"&&yo("scroll",e),l||i===y||(l=[])):(l=l||[]).push(x,y))}n&&(l=l||[]).push("style",n);var x=l;(t.updateQueue=x)&&(t.flags|=4)}};xW=function(e,t,n,r){n!==r&&(t.flags|=4)};function Zw(e,t){if(!ko)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function ru(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function fce(e,t,n){var r=t.pendingProps;switch(aL(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ru(t),null;case 1:return oc(t.type)&&RA(),ru(t),null;case 3:return r=t.stateNode,Zv(),xo(ac),xo(du),mL(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(L3(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,dh!==null&&(tP(dh),dh=null))),ZM(e,t),ru(t),null;case 5:pL(t);var a=Xg(iT.current);if(n=t.type,e!==null&&t.stateNode!=null)vW(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(ir(166));return ru(t),null}if(e=Xg(mf.current),L3(t)){r=t.stateNode,n=t.type;var l=t.memoizedProps;switch(r[of]=t,r[nT]=l,e=(t.mode&1)!==0,n){case"dialog":yo("cancel",r),yo("close",r);break;case"iframe":case"object":case"embed":yo("load",r);break;case"video":case"audio":for(a=0;a<l2.length;a++)yo(l2[a],r);break;case"source":yo("error",r);break;case"img":case"image":case"link":yo("error",r),yo("load",r);break;case"details":yo("toggle",r);break;case"input":GF(r,l),yo("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!l.multiple},yo("invalid",r);break;case"textarea":ZF(r,l),yo("invalid",r)}xM(n,l),a=null;for(var f in l)if(l.hasOwnProperty(f)){var i=l[f];f==="children"?typeof i=="string"?r.textContent!==i&&(l.suppressHydrationWarning!==!0&&O3(r.textContent,i,e),a=["children",i]):typeof i=="number"&&r.textContent!==""+i&&(l.suppressHydrationWarning!==!0&&O3(r.textContent,i,e),a=["children",""+i]):q2.hasOwnProperty(f)&&i!=null&&f==="onScroll"&&yo("scroll",r)}switch(n){case"input":S3(r),qF(r,l,!0);break;case"textarea":S3(r),WF(r);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(r.onclick=IA)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{f=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Wq(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=f.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=f.createElement(n,{is:r.is}):(e=f.createElement(n),n==="select"&&(f=e,r.multiple?f.multiple=!0:r.size&&(f.size=r.size))):e=f.createElementNS(e,n),e[of]=t,e[nT]=r,yW(e,t,!1,!1),t.stateNode=e;e:{switch(f=bM(n,r),n){case"dialog":yo("cancel",e),yo("close",e),a=r;break;case"iframe":case"object":case"embed":yo("load",e),a=r;break;case"video":case"audio":for(a=0;a<l2.length;a++)yo(l2[a],e);a=r;break;case"source":yo("error",e),a=r;break;case"img":case"image":case"link":yo("error",e),yo("load",e),a=r;break;case"details":yo("toggle",e),a=r;break;case"input":GF(e,r),a=mM(e,r),yo("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=Bo({},r,{value:void 0}),yo("invalid",e);break;case"textarea":ZF(e,r),a=yM(e,r),yo("invalid",e);break;default:a=r}xM(n,a),i=a;for(l in i)if(i.hasOwnProperty(l)){var y=i[l];l==="style"?Kq(e,y):l==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,y!=null&&Xq(e,y)):l==="children"?typeof y=="string"?(n!=="textarea"||y!=="")&&Z2(e,y):typeof y=="number"&&Z2(e,""+y):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(q2.hasOwnProperty(l)?y!=null&&l==="onScroll"&&yo("scroll",e):y!=null&&G8(e,l,y,f))}switch(n){case"input":S3(e),qF(e,r,!1);break;case"textarea":S3(e),WF(e);break;case"option":r.value!=null&&e.setAttribute("value",""+_0(r.value));break;case"select":e.multiple=!!r.multiple,l=r.value,l!=null?mv(e,!!r.multiple,l,!1):r.defaultValue!=null&&mv(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=IA)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return ru(t),null;case 6:if(e&&t.stateNode!=null)xW(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(ir(166));if(n=Xg(iT.current),Xg(mf.current),L3(t)){if(r=t.stateNode,n=t.memoizedProps,r[of]=t,(l=r.nodeValue!==n)&&(e=zc,e!==null))switch(e.tag){case 3:O3(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&O3(r.nodeValue,n,(e.mode&1)!==0)}l&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[of]=t,t.stateNode=r}return ru(t),null;case 13:if(xo(No),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ko&&Dc!==null&&t.mode&1&&!(t.flags&128))FZ(),Gv(),t.flags|=98560,l=!1;else if(l=L3(t),r!==null&&r.dehydrated!==null){if(e===null){if(!l)throw Error(ir(318));if(l=t.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(ir(317));l[of]=t}else Gv(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;ru(t),l=!1}else dh!==null&&(tP(dh),dh=null),l=!0;if(!l)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||No.current&1?wl===0&&(wl=3):CL())),t.updateQueue!==null&&(t.flags|=4),ru(t),null);case 4:return Zv(),ZM(e,t),e===null&&eT(t.stateNode.containerInfo),ru(t),null;case 10:return cL(t.type._context),ru(t),null;case 17:return oc(t.type)&&RA(),ru(t),null;case 19:if(xo(No),l=t.memoizedState,l===null)return ru(t),null;if(r=(t.flags&128)!==0,f=l.rendering,f===null)if(r)Zw(l,!1);else{if(wl!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(f=zA(e),f!==null){for(t.flags|=128,Zw(l,!1),r=f.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)l=n,e=r,l.flags&=14680066,f=l.alternate,f===null?(l.childLanes=0,l.lanes=e,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=f.childLanes,l.lanes=f.lanes,l.child=f.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=f.memoizedProps,l.memoizedState=f.memoizedState,l.updateQueue=f.updateQueue,l.type=f.type,e=f.dependencies,l.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ho(No,No.current&1|2),t.child}e=e.sibling}l.tail!==null&&Qo()>Xv&&(t.flags|=128,r=!0,Zw(l,!1),t.lanes=4194304)}else{if(!r)if(e=zA(f),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Zw(l,!0),l.tail===null&&l.tailMode==="hidden"&&!f.alternate&&!ko)return ru(t),null}else 2*Qo()-l.renderingStartTime>Xv&&n!==1073741824&&(t.flags|=128,r=!0,Zw(l,!1),t.lanes=4194304);l.isBackwards?(f.sibling=t.child,t.child=f):(n=l.last,n!==null?n.sibling=f:t.child=f,l.last=f)}return l.tail!==null?(t=l.tail,l.rendering=t,l.tail=t.sibling,l.renderingStartTime=Qo(),t.sibling=null,n=No.current,ho(No,r?n&1|2:n&1),t):(ru(t),null);case 22:case 23:return AL(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?Pc&1073741824&&(ru(t),t.subtreeFlags&6&&(t.flags|=8192)):ru(t),null;case 24:return null;case 25:return null}throw Error(ir(156,t.tag))}function pce(e,t){switch(aL(t),t.tag){case 1:return oc(t.type)&&RA(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Zv(),xo(ac),xo(du),mL(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return pL(t),null;case 13:if(xo(No),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ir(340));Gv()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return xo(No),null;case 4:return Zv(),null;case 10:return cL(t.type._context),null;case 22:case 23:return AL(),null;case 24:return null;default:return null}}var z3=!1,su=!1,mce=typeof WeakSet=="function"?WeakSet:Set,ii=null;function cv(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){qo(e,t,r)}else n.current=null}function WM(e,t,n){try{n()}catch(r){qo(e,t,r)}}var zB=!1;function gce(e,t){if(MM=AA,e=SZ(),iL(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var a=r.anchorOffset,l=r.focusNode;r=r.focusOffset;try{n.nodeType,l.nodeType}catch{n=null;break e}var f=0,i=-1,y=-1,x=0,S=0,C=e,P=null;t:for(;;){for(var L;C!==n||a!==0&&C.nodeType!==3||(i=f+a),C!==l||r!==0&&C.nodeType!==3||(y=f+r),C.nodeType===3&&(f+=C.nodeValue.length),(L=C.firstChild)!==null;)P=C,C=L;for(;;){if(C===e)break t;if(P===n&&++x===a&&(i=f),P===l&&++S===r&&(y=f),(L=C.nextSibling)!==null)break;C=P,P=C.parentNode}C=L}n=i===-1||y===-1?null:{start:i,end:y}}else n=null}n=n||{start:0,end:0}}else n=null;for(PM={focusedElem:e,selectionRange:n},AA=!1,ii=t;ii!==null;)if(t=ii,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ii=e;else for(;ii!==null;){t=ii;try{var F=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(F!==null){var U=F.memoizedProps,q=F.memoizedState,G=t.stateNode,$=G.getSnapshotBeforeUpdate(t.elementType===t.type?U:ah(t.type,U),q);G.__reactInternalSnapshotBeforeUpdate=$}break;case 3:var X=t.stateNode.containerInfo;X.nodeType===1?X.textContent="":X.nodeType===9&&X.documentElement&&X.removeChild(X.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ir(163))}}catch(ie){qo(t,t.return,ie)}if(e=t.sibling,e!==null){e.return=t.return,ii=e;break}ii=t.return}return F=zB,zB=!1,F}function R2(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var l=a.destroy;a.destroy=void 0,l!==void 0&&WM(t,n,l)}a=a.next}while(a!==r)}}function gk(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function XM(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function bW(e){var t=e.alternate;t!==null&&(e.alternate=null,bW(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[of],delete t[nT],delete t[DM],delete t[Que],delete t[Jue])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function wW(e){return e.tag===5||e.tag===3||e.tag===4}function FB(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||wW(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function YM(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=IA));else if(r!==4&&(e=e.child,e!==null))for(YM(e,t,n),e=e.sibling;e!==null;)YM(e,t,n),e=e.sibling}function KM(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(KM(e,t,n),e=e.sibling;e!==null;)KM(e,t,n),e=e.sibling}var Hl=null,uh=!1;function wm(e,t,n){for(n=n.child;n!==null;)TW(e,t,n),n=n.sibling}function TW(e,t,n){if(pf&&typeof pf.onCommitFiberUnmount=="function")try{pf.onCommitFiberUnmount(lk,n)}catch{}switch(n.tag){case 5:su||cv(n,t);case 6:var r=Hl,a=uh;Hl=null,wm(e,t,n),Hl=r,uh=a,Hl!==null&&(uh?(e=Hl,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Hl.removeChild(n.stateNode));break;case 18:Hl!==null&&(uh?(e=Hl,n=n.stateNode,e.nodeType===8?k5(e.parentNode,n):e.nodeType===1&&k5(e,n),K2(e)):k5(Hl,n.stateNode));break;case 4:r=Hl,a=uh,Hl=n.stateNode.containerInfo,uh=!0,wm(e,t,n),Hl=r,uh=a;break;case 0:case 11:case 14:case 15:if(!su&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var l=a,f=l.destroy;l=l.tag,f!==void 0&&(l&2||l&4)&&WM(n,t,f),a=a.next}while(a!==r)}wm(e,t,n);break;case 1:if(!su&&(cv(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(i){qo(n,t,i)}wm(e,t,n);break;case 21:wm(e,t,n);break;case 22:n.mode&1?(su=(r=su)||n.memoizedState!==null,wm(e,t,n),su=r):wm(e,t,n);break;default:wm(e,t,n)}}function BB(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new mce),t.forEach(function(r){var a=Sce.bind(null,e,r);n.has(r)||(n.add(r),r.then(a,a))})}}function eh(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var a=n[r];try{var l=e,f=t,i=f;e:for(;i!==null;){switch(i.tag){case 5:Hl=i.stateNode,uh=!1;break e;case 3:Hl=i.stateNode.containerInfo,uh=!0;break e;case 4:Hl=i.stateNode.containerInfo,uh=!0;break e}i=i.return}if(Hl===null)throw Error(ir(160));TW(l,f,a),Hl=null,uh=!1;var y=a.alternate;y!==null&&(y.return=null),a.return=null}catch(x){qo(a,t,x)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)EW(t,e),t=t.sibling}function EW(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(eh(t,e),Xh(e),r&4){try{R2(3,e,e.return),gk(3,e)}catch(U){qo(e,e.return,U)}try{R2(5,e,e.return)}catch(U){qo(e,e.return,U)}}break;case 1:eh(t,e),Xh(e),r&512&&n!==null&&cv(n,n.return);break;case 5:if(eh(t,e),Xh(e),r&512&&n!==null&&cv(n,n.return),e.flags&32){var a=e.stateNode;try{Z2(a,"")}catch(U){qo(e,e.return,U)}}if(r&4&&(a=e.stateNode,a!=null)){var l=e.memoizedProps,f=n!==null?n.memoizedProps:l,i=e.type,y=e.updateQueue;if(e.updateQueue=null,y!==null)try{i==="input"&&l.type==="radio"&&l.name!=null&&qq(a,l),bM(i,f);var x=bM(i,l);for(f=0;f<y.length;f+=2){var S=y[f],C=y[f+1];S==="style"?Kq(a,C):S==="dangerouslySetInnerHTML"?Xq(a,C):S==="children"?Z2(a,C):G8(a,S,C,x)}switch(i){case"input":gM(a,l);break;case"textarea":Zq(a,l);break;case"select":var P=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!l.multiple;var L=l.value;L!=null?mv(a,!!l.multiple,L,!1):P!==!!l.multiple&&(l.defaultValue!=null?mv(a,!!l.multiple,l.defaultValue,!0):mv(a,!!l.multiple,l.multiple?[]:"",!1))}a[nT]=l}catch(U){qo(e,e.return,U)}}break;case 6:if(eh(t,e),Xh(e),r&4){if(e.stateNode===null)throw Error(ir(162));a=e.stateNode,l=e.memoizedProps;try{a.nodeValue=l}catch(U){qo(e,e.return,U)}}break;case 3:if(eh(t,e),Xh(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{K2(t.containerInfo)}catch(U){qo(e,e.return,U)}break;case 4:eh(t,e),Xh(e);break;case 13:eh(t,e),Xh(e),a=e.child,a.flags&8192&&(l=a.memoizedState!==null,a.stateNode.isHidden=l,!l||a.alternate!==null&&a.alternate.memoizedState!==null||(EL=Qo())),r&4&&BB(e);break;case 22:if(S=n!==null&&n.memoizedState!==null,e.mode&1?(su=(x=su)||S,eh(t,e),su=x):eh(t,e),Xh(e),r&8192){if(x=e.memoizedState!==null,(e.stateNode.isHidden=x)&&!S&&e.mode&1)for(ii=e,S=e.child;S!==null;){for(C=ii=S;ii!==null;){switch(P=ii,L=P.child,P.tag){case 0:case 11:case 14:case 15:R2(4,P,P.return);break;case 1:cv(P,P.return);var F=P.stateNode;if(typeof F.componentWillUnmount=="function"){r=P,n=P.return;try{t=r,F.props=t.memoizedProps,F.state=t.memoizedState,F.componentWillUnmount()}catch(U){qo(r,n,U)}}break;case 5:cv(P,P.return);break;case 22:if(P.memoizedState!==null){UB(C);continue}}L!==null?(L.return=P,ii=L):UB(C)}S=S.sibling}e:for(S=null,C=e;;){if(C.tag===5){if(S===null){S=C;try{a=C.stateNode,x?(l=a.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(i=C.stateNode,y=C.memoizedProps.style,f=y!=null&&y.hasOwnProperty("display")?y.display:null,i.style.display=Yq("display",f))}catch(U){qo(e,e.return,U)}}}else if(C.tag===6){if(S===null)try{C.stateNode.nodeValue=x?"":C.memoizedProps}catch(U){qo(e,e.return,U)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===e)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===e)break e;for(;C.sibling===null;){if(C.return===null||C.return===e)break e;S===C&&(S=null),C=C.return}S===C&&(S=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:eh(t,e),Xh(e),r&4&&BB(e);break;case 21:break;default:eh(t,e),Xh(e)}}function Xh(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(wW(n)){var r=n;break e}n=n.return}throw Error(ir(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(Z2(a,""),r.flags&=-33);var l=FB(e);KM(e,l,a);break;case 3:case 4:var f=r.stateNode.containerInfo,i=FB(e);YM(e,i,f);break;default:throw Error(ir(161))}}catch(y){qo(e,e.return,y)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function _ce(e,t,n){ii=e,SW(e)}function SW(e,t,n){for(var r=(e.mode&1)!==0;ii!==null;){var a=ii,l=a.child;if(a.tag===22&&r){var f=a.memoizedState!==null||z3;if(!f){var i=a.alternate,y=i!==null&&i.memoizedState!==null||su;i=z3;var x=su;if(z3=f,(su=y)&&!x)for(ii=a;ii!==null;)f=ii,y=f.child,f.tag===22&&f.memoizedState!==null?VB(a):y!==null?(y.return=f,ii=y):VB(a);for(;l!==null;)ii=l,SW(l),l=l.sibling;ii=a,z3=i,su=x}jB(e)}else a.subtreeFlags&8772&&l!==null?(l.return=a,ii=l):jB(e)}}function jB(e){for(;ii!==null;){var t=ii;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:su||gk(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!su)if(n===null)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:ah(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var l=t.updateQueue;l!==null&&EB(t,l,r);break;case 3:var f=t.updateQueue;if(f!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}EB(t,f,n)}break;case 5:var i=t.stateNode;if(n===null&&t.flags&4){n=i;var y=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":y.autoFocus&&n.focus();break;case"img":y.src&&(n.src=y.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var x=t.alternate;if(x!==null){var S=x.memoizedState;if(S!==null){var C=S.dehydrated;C!==null&&K2(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ir(163))}su||t.flags&512&&XM(t)}catch(P){qo(t,t.return,P)}}if(t===e){ii=null;break}if(n=t.sibling,n!==null){n.return=t.return,ii=n;break}ii=t.return}}function UB(e){for(;ii!==null;){var t=ii;if(t===e){ii=null;break}var n=t.sibling;if(n!==null){n.return=t.return,ii=n;break}ii=t.return}}function VB(e){for(;ii!==null;){var t=ii;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{gk(4,t)}catch(y){qo(t,n,y)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(y){qo(t,a,y)}}var l=t.return;try{XM(t)}catch(y){qo(t,l,y)}break;case 5:var f=t.return;try{XM(t)}catch(y){qo(t,f,y)}}}catch(y){qo(t,t.return,y)}if(t===e){ii=null;break}var i=t.sibling;if(i!==null){i.return=t.return,ii=i;break}ii=t.return}}var yce=Math.ceil,jA=zp.ReactCurrentDispatcher,wL=zp.ReactCurrentOwner,vd=zp.ReactCurrentBatchConfig,Ca=0,Dl=null,pl=null,Wl=0,Pc=0,dv=N0(0),wl=0,lT=null,v_=0,_k=0,TL=0,M2=null,ic=null,EL=0,Xv=1/0,ap=null,UA=!1,QM=null,l0=null,F3=!1,Qm=null,VA=0,P2=0,JM=null,k4=-1,I4=0;function Du(){return Ca&6?Qo():k4!==-1?k4:k4=Qo()}function u0(e){return e.mode&1?Ca&2&&Wl!==0?Wl&-Wl:tce.transition!==null?(I4===0&&(I4=uZ()),I4):(e=qa,e!==0||(e=window.event,e=e===void 0?16:gZ(e.type)),e):1}function ph(e,t,n,r){if(50<P2)throw P2=0,JM=null,Error(ir(185));HT(e,n,r),(!(Ca&2)||e!==Dl)&&(e===Dl&&(!(Ca&2)&&(_k|=n),wl===4&&Vm(e,Wl)),lc(e,r),n===1&&Ca===0&&!(t.mode&1)&&(Xv=Qo()+500,fk&&z0()))}function lc(e,t){var n=e.callbackNode;tue(e,t);var r=SA(e,e===Dl?Wl:0);if(r===0)n!==null&&KF(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&KF(n),t===1)e.tag===0?ece($B.bind(null,e)):DZ($B.bind(null,e)),Yue(function(){!(Ca&6)&&z0()}),n=null;else{switch(cZ(r)){case 1:n=Y8;break;case 4:n=oZ;break;case 16:n=EA;break;case 536870912:n=lZ;break;default:n=EA}n=OW(n,AW.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function AW(e,t){if(k4=-1,I4=0,Ca&6)throw Error(ir(327));var n=e.callbackNode;if(xv()&&e.callbackNode!==n)return null;var r=SA(e,e===Dl?Wl:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=$A(e,r);else{t=r;var a=Ca;Ca|=2;var l=kW();(Dl!==e||Wl!==t)&&(ap=null,Xv=Qo()+500,l_(e,t));do try{bce();break}catch(i){CW(e,i)}while(!0);uL(),jA.current=l,Ca=a,pl!==null?t=0:(Dl=null,Wl=0,t=wl)}if(t!==0){if(t===2&&(a=AM(e),a!==0&&(r=a,t=eP(e,a))),t===1)throw n=lT,l_(e,0),Vm(e,r),lc(e,Qo()),n;if(t===6)Vm(e,r);else{if(a=e.current.alternate,!(r&30)&&!vce(a)&&(t=$A(e,r),t===2&&(l=AM(e),l!==0&&(r=l,t=eP(e,l))),t===1))throw n=lT,l_(e,0),Vm(e,r),lc(e,Qo()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(ir(345));case 2:Hg(e,ic,ap);break;case 3:if(Vm(e,r),(r&130023424)===r&&(t=EL+500-Qo(),10<t)){if(SA(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){Du(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=LM(Hg.bind(null,e,ic,ap),t);break}Hg(e,ic,ap);break;case 4:if(Vm(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var f=31-fh(r);l=1<<f,f=t[f],f>a&&(a=f),r&=~l}if(r=a,r=Qo()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*yce(r/1960))-r,10<r){e.timeoutHandle=LM(Hg.bind(null,e,ic,ap),r);break}Hg(e,ic,ap);break;case 5:Hg(e,ic,ap);break;default:throw Error(ir(329))}}}return lc(e,Qo()),e.callbackNode===n?AW.bind(null,e):null}function eP(e,t){var n=M2;return e.current.memoizedState.isDehydrated&&(l_(e,t).flags|=256),e=$A(e,t),e!==2&&(t=ic,ic=n,t!==null&&tP(t)),e}function tP(e){ic===null?ic=e:ic.push.apply(ic,e)}function vce(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var a=n[r],l=a.getSnapshot;a=a.value;try{if(!gh(l(),a))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Vm(e,t){for(t&=~TL,t&=~_k,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-fh(t),r=1<<n;e[n]=-1,t&=~r}}function $B(e){if(Ca&6)throw Error(ir(327));xv();var t=SA(e,0);if(!(t&1))return lc(e,Qo()),null;var n=$A(e,t);if(e.tag!==0&&n===2){var r=AM(e);r!==0&&(t=r,n=eP(e,r))}if(n===1)throw n=lT,l_(e,0),Vm(e,t),lc(e,Qo()),n;if(n===6)throw Error(ir(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Hg(e,ic,ap),lc(e,Qo()),null}function SL(e,t){var n=Ca;Ca|=1;try{return e(t)}finally{Ca=n,Ca===0&&(Xv=Qo()+500,fk&&z0())}}function x_(e){Qm!==null&&Qm.tag===0&&!(Ca&6)&&xv();var t=Ca;Ca|=1;var n=vd.transition,r=qa;try{if(vd.transition=null,qa=1,e)return e()}finally{qa=r,vd.transition=n,Ca=t,!(Ca&6)&&z0()}}function AL(){Pc=dv.current,xo(dv)}function l_(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Xue(n)),pl!==null)for(n=pl.return;n!==null;){var r=n;switch(aL(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&RA();break;case 3:Zv(),xo(ac),xo(du),mL();break;case 5:pL(r);break;case 4:Zv();break;case 13:xo(No);break;case 19:xo(No);break;case 10:cL(r.type._context);break;case 22:case 23:AL()}n=n.return}if(Dl=e,pl=e=c0(e.current,null),Wl=Pc=t,wl=0,lT=null,TL=_k=v_=0,ic=M2=null,Wg!==null){for(t=0;t<Wg.length;t++)if(n=Wg[t],r=n.interleaved,r!==null){n.interleaved=null;var a=r.next,l=n.pending;if(l!==null){var f=l.next;l.next=a,r.next=f}n.pending=r}Wg=null}return e}function CW(e,t){do{var n=pl;try{if(uL(),S4.current=BA,FA){for(var r=Fo.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}FA=!1}if(y_=0,Ol=bl=Fo=null,I2=!1,sT=0,wL.current=null,n===null||n.return===null){wl=1,lT=t,pl=null;break}e:{var l=e,f=n.return,i=n,y=t;if(t=Wl,i.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){var x=y,S=i,C=S.tag;if(!(S.mode&1)&&(C===0||C===11||C===15)){var P=S.alternate;P?(S.updateQueue=P.updateQueue,S.memoizedState=P.memoizedState,S.lanes=P.lanes):(S.updateQueue=null,S.memoizedState=null)}var L=RB(f);if(L!==null){L.flags&=-257,MB(L,f,i,l,t),L.mode&1&&IB(l,x,t),t=L,y=x;var F=t.updateQueue;if(F===null){var U=new Set;U.add(y),t.updateQueue=U}else F.add(y);break e}else{if(!(t&1)){IB(l,x,t),CL();break e}y=Error(ir(426))}}else if(ko&&i.mode&1){var q=RB(f);if(q!==null){!(q.flags&65536)&&(q.flags|=256),MB(q,f,i,l,t),oL(Wv(y,i));break e}}l=y=Wv(y,i),wl!==4&&(wl=2),M2===null?M2=[l]:M2.push(l),l=f;do{switch(l.tag){case 3:l.flags|=65536,t&=-t,l.lanes|=t;var G=cW(l,y,t);TB(l,G);break e;case 1:i=y;var $=l.type,X=l.stateNode;if(!(l.flags&128)&&(typeof $.getDerivedStateFromError=="function"||X!==null&&typeof X.componentDidCatch=="function"&&(l0===null||!l0.has(X)))){l.flags|=65536,t&=-t,l.lanes|=t;var ie=dW(l,i,t);TB(l,ie);break e}}l=l.return}while(l!==null)}RW(n)}catch(de){t=de,pl===n&&n!==null&&(pl=n=n.return);continue}break}while(!0)}function kW(){var e=jA.current;return jA.current=BA,e===null?BA:e}function CL(){(wl===0||wl===3||wl===2)&&(wl=4),Dl===null||!(v_&268435455)&&!(_k&268435455)||Vm(Dl,Wl)}function $A(e,t){var n=Ca;Ca|=2;var r=kW();(Dl!==e||Wl!==t)&&(ap=null,l_(e,t));do try{xce();break}catch(a){CW(e,a)}while(!0);if(uL(),Ca=n,jA.current=r,pl!==null)throw Error(ir(261));return Dl=null,Wl=0,wl}function xce(){for(;pl!==null;)IW(pl)}function bce(){for(;pl!==null&&!qle();)IW(pl)}function IW(e){var t=PW(e.alternate,e,Pc);e.memoizedProps=e.pendingProps,t===null?RW(e):pl=t,wL.current=null}function RW(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=pce(n,t),n!==null){n.flags&=32767,pl=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{wl=6,pl=null;return}}else if(n=fce(n,t,Pc),n!==null){pl=n;return}if(t=t.sibling,t!==null){pl=t;return}pl=t=e}while(t!==null);wl===0&&(wl=5)}function Hg(e,t,n){var r=qa,a=vd.transition;try{vd.transition=null,qa=1,wce(e,t,n,r)}finally{vd.transition=a,qa=r}return null}function wce(e,t,n,r){do xv();while(Qm!==null);if(Ca&6)throw Error(ir(327));n=e.finishedWork;var a=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(ir(177));e.callbackNode=null,e.callbackPriority=0;var l=n.lanes|n.childLanes;if(nue(e,l),e===Dl&&(pl=Dl=null,Wl=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||F3||(F3=!0,OW(EA,function(){return xv(),null})),l=(n.flags&15990)!==0,n.subtreeFlags&15990||l){l=vd.transition,vd.transition=null;var f=qa;qa=1;var i=Ca;Ca|=4,wL.current=null,gce(e,n),EW(n,e),Vue(PM),AA=!!MM,PM=MM=null,e.current=n,_ce(n),Zle(),Ca=i,qa=f,vd.transition=l}else e.current=n;if(F3&&(F3=!1,Qm=e,VA=a),l=e.pendingLanes,l===0&&(l0=null),Yle(n.stateNode),lc(e,Qo()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(UA)throw UA=!1,e=QM,QM=null,e;return VA&1&&e.tag!==0&&xv(),l=e.pendingLanes,l&1?e===JM?P2++:(P2=0,JM=e):P2=0,z0(),null}function xv(){if(Qm!==null){var e=cZ(VA),t=vd.transition,n=qa;try{if(vd.transition=null,qa=16>e?16:e,Qm===null)var r=!1;else{if(e=Qm,Qm=null,VA=0,Ca&6)throw Error(ir(331));var a=Ca;for(Ca|=4,ii=e.current;ii!==null;){var l=ii,f=l.child;if(ii.flags&16){var i=l.deletions;if(i!==null){for(var y=0;y<i.length;y++){var x=i[y];for(ii=x;ii!==null;){var S=ii;switch(S.tag){case 0:case 11:case 15:R2(8,S,l)}var C=S.child;if(C!==null)C.return=S,ii=C;else for(;ii!==null;){S=ii;var P=S.sibling,L=S.return;if(bW(S),S===x){ii=null;break}if(P!==null){P.return=L,ii=P;break}ii=L}}}var F=l.alternate;if(F!==null){var U=F.child;if(U!==null){F.child=null;do{var q=U.sibling;U.sibling=null,U=q}while(U!==null)}}ii=l}}if(l.subtreeFlags&2064&&f!==null)f.return=l,ii=f;else e:for(;ii!==null;){if(l=ii,l.flags&2048)switch(l.tag){case 0:case 11:case 15:R2(9,l,l.return)}var G=l.sibling;if(G!==null){G.return=l.return,ii=G;break e}ii=l.return}}var $=e.current;for(ii=$;ii!==null;){f=ii;var X=f.child;if(f.subtreeFlags&2064&&X!==null)X.return=f,ii=X;else e:for(f=$;ii!==null;){if(i=ii,i.flags&2048)try{switch(i.tag){case 0:case 11:case 15:gk(9,i)}}catch(de){qo(i,i.return,de)}if(i===f){ii=null;break e}var ie=i.sibling;if(ie!==null){ie.return=i.return,ii=ie;break e}ii=i.return}}if(Ca=a,z0(),pf&&typeof pf.onPostCommitFiberRoot=="function")try{pf.onPostCommitFiberRoot(lk,e)}catch{}r=!0}return r}finally{qa=n,vd.transition=t}}return!1}function HB(e,t,n){t=Wv(n,t),t=cW(e,t,1),e=o0(e,t,1),t=Du(),e!==null&&(HT(e,1,t),lc(e,t))}function qo(e,t,n){if(e.tag===3)HB(e,e,n);else for(;t!==null;){if(t.tag===3){HB(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(l0===null||!l0.has(r))){e=Wv(n,e),e=dW(t,e,1),t=o0(t,e,1),e=Du(),t!==null&&(HT(t,1,e),lc(t,e));break}}t=t.return}}function Tce(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=Du(),e.pingedLanes|=e.suspendedLanes&n,Dl===e&&(Wl&n)===n&&(wl===4||wl===3&&(Wl&130023424)===Wl&&500>Qo()-EL?l_(e,0):TL|=n),lc(e,t)}function MW(e,t){t===0&&(e.mode&1?(t=k3,k3<<=1,!(k3&130023424)&&(k3=4194304)):t=1);var n=Du();e=Ap(e,t),e!==null&&(HT(e,t,n),lc(e,n))}function Ece(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),MW(e,n)}function Sce(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(ir(314))}r!==null&&r.delete(t),MW(e,n)}var PW;PW=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||ac.current)sc=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return sc=!1,hce(e,t,n);sc=!!(e.flags&131072)}else sc=!1,ko&&t.flags&1048576&&NZ(t,OA,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;C4(e,t),e=t.pendingProps;var a=Hv(t,du.current);vv(t,n),a=_L(null,t,r,e,a,n);var l=yL();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,oc(r)?(l=!0,MA(t)):l=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,hL(t),a.updater=mk,t.stateNode=a,a._reactInternals=t,UM(t,r,e,n),t=HM(null,t,r,!0,l,n)):(t.tag=0,ko&&l&&sL(t),Iu(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(C4(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=Cce(r),e=ah(r,e),a){case 0:t=$M(null,t,r,e,n);break e;case 1:t=LB(null,t,r,e,n);break e;case 11:t=PB(null,t,r,e,n);break e;case 14:t=OB(null,t,r,ah(r.type,e),n);break e}throw Error(ir(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:ah(r,a),$M(e,t,r,a,n);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:ah(r,a),LB(e,t,r,a,n);case 3:e:{if(mW(t),e===null)throw Error(ir(387));r=t.pendingProps,l=t.memoizedState,a=l.element,VZ(e,t),NA(t,r,null,n);var f=t.memoizedState;if(r=f.element,l.isDehydrated)if(l={element:r,isDehydrated:!1,cache:f.cache,pendingSuspenseBoundaries:f.pendingSuspenseBoundaries,transitions:f.transitions},t.updateQueue.baseState=l,t.memoizedState=l,t.flags&256){a=Wv(Error(ir(423)),t),t=DB(e,t,r,n,a);break e}else if(r!==a){a=Wv(Error(ir(424)),t),t=DB(e,t,r,n,a);break e}else for(Dc=a0(t.stateNode.containerInfo.firstChild),zc=t,ko=!0,dh=null,n=jZ(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Gv(),r===a){t=Cp(e,t,n);break e}Iu(e,t,r,n)}t=t.child}return t;case 5:return $Z(t),e===null&&FM(t),r=t.type,a=t.pendingProps,l=e!==null?e.memoizedProps:null,f=a.children,OM(r,a)?f=null:l!==null&&OM(r,l)&&(t.flags|=32),pW(e,t),Iu(e,t,f,n),t.child;case 6:return e===null&&FM(t),null;case 13:return gW(e,t,n);case 4:return fL(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=qv(t,null,r,n):Iu(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:ah(r,a),PB(e,t,r,a,n);case 7:return Iu(e,t,t.pendingProps,n),t.child;case 8:return Iu(e,t,t.pendingProps.children,n),t.child;case 12:return Iu(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,l=t.memoizedProps,f=a.value,ho(LA,r._currentValue),r._currentValue=f,l!==null)if(gh(l.value,f)){if(l.children===a.children&&!ac.current){t=Cp(e,t,n);break e}}else for(l=t.child,l!==null&&(l.return=t);l!==null;){var i=l.dependencies;if(i!==null){f=l.child;for(var y=i.firstContext;y!==null;){if(y.context===r){if(l.tag===1){y=yp(-1,n&-n),y.tag=2;var x=l.updateQueue;if(x!==null){x=x.shared;var S=x.pending;S===null?y.next=y:(y.next=S.next,S.next=y),x.pending=y}}l.lanes|=n,y=l.alternate,y!==null&&(y.lanes|=n),BM(l.return,n,t),i.lanes|=n;break}y=y.next}}else if(l.tag===10)f=l.type===t.type?null:l.child;else if(l.tag===18){if(f=l.return,f===null)throw Error(ir(341));f.lanes|=n,i=f.alternate,i!==null&&(i.lanes|=n),BM(f,n,t),f=l.sibling}else f=l.child;if(f!==null)f.return=l;else for(f=l;f!==null;){if(f===t){f=null;break}if(l=f.sibling,l!==null){l.return=f.return,f=l;break}f=f.return}l=f}Iu(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,vv(t,n),a=bd(a),r=r(a),t.flags|=1,Iu(e,t,r,n),t.child;case 14:return r=t.type,a=ah(r,t.pendingProps),a=ah(r.type,a),OB(e,t,r,a,n);case 15:return hW(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:ah(r,a),C4(e,t),t.tag=1,oc(r)?(e=!0,MA(t)):e=!1,vv(t,n),uW(t,r,a),UM(t,r,a,n),HM(null,t,r,!0,e,n);case 19:return _W(e,t,n);case 22:return fW(e,t,n)}throw Error(ir(156,t.tag))};function OW(e,t){return aZ(e,t)}function Ace(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _d(e,t,n,r){return new Ace(e,t,n,r)}function kL(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Cce(e){if(typeof e=="function")return kL(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Z8)return 11;if(e===W8)return 14}return 2}function c0(e,t){var n=e.alternate;return n===null?(n=_d(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function R4(e,t,n,r,a,l){var f=2;if(r=e,typeof e=="function")kL(e)&&(f=1);else if(typeof e=="string")f=5;else e:switch(e){case tv:return u_(n.children,a,l,t);case q8:f=8,a|=8;break;case dM:return e=_d(12,n,t,a|2),e.elementType=dM,e.lanes=l,e;case hM:return e=_d(13,n,t,a),e.elementType=hM,e.lanes=l,e;case fM:return e=_d(19,n,t,a),e.elementType=fM,e.lanes=l,e;case $q:return yk(n,a,l,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Uq:f=10;break e;case Vq:f=9;break e;case Z8:f=11;break e;case W8:f=14;break e;case Om:f=16,r=null;break e}throw Error(ir(130,e==null?e:typeof e,""))}return t=_d(f,n,t,a),t.elementType=e,t.type=r,t.lanes=l,t}function u_(e,t,n,r){return e=_d(7,e,r,t),e.lanes=n,e}function yk(e,t,n,r){return e=_d(22,e,r,t),e.elementType=$q,e.lanes=n,e.stateNode={isHidden:!1},e}function N5(e,t,n){return e=_d(6,e,null,t),e.lanes=n,e}function z5(e,t,n){return t=_d(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function kce(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=_5(0),this.expirationTimes=_5(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_5(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function IL(e,t,n,r,a,l,f,i,y){return e=new kce(e,t,n,i,y),t===1?(t=1,l===!0&&(t|=8)):t=0,l=_d(3,null,null,t),e.current=l,l.stateNode=e,l.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},hL(l),e}function Ice(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ev,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function LW(e){if(!e)return y0;e=e._reactInternals;e:{if(j_(e)!==e||e.tag!==1)throw Error(ir(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(oc(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(ir(171))}if(e.tag===1){var n=e.type;if(oc(n))return LZ(e,n,t)}return t}function DW(e,t,n,r,a,l,f,i,y){return e=IL(n,r,!0,e,a,l,f,i,y),e.context=LW(null),n=e.current,r=Du(),a=u0(n),l=yp(r,a),l.callback=t??null,o0(n,l,a),e.current.lanes=a,HT(e,a,r),lc(e,r),e}function vk(e,t,n,r){var a=t.current,l=Du(),f=u0(a);return n=LW(n),t.context===null?t.context=n:t.pendingContext=n,t=yp(l,f),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=o0(a,t,f),e!==null&&(ph(e,a,f,l),E4(e,a,f)),f}function HA(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function GB(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function RL(e,t){GB(e,t),(e=e.alternate)&&GB(e,t)}function Rce(){return null}var NW=typeof reportError=="function"?reportError:function(e){console.error(e)};function ML(e){this._internalRoot=e}xk.prototype.render=ML.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ir(409));vk(e,t,null,null)};xk.prototype.unmount=ML.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;x_(function(){vk(null,e,null,null)}),t[Sp]=null}};function xk(e){this._internalRoot=e}xk.prototype.unstable_scheduleHydration=function(e){if(e){var t=fZ();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Um.length&&t!==0&&t<Um[n].priority;n++);Um.splice(n,0,e),n===0&&mZ(e)}};function PL(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function bk(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function qB(){}function Mce(e,t,n,r,a){if(a){if(typeof r=="function"){var l=r;r=function(){var x=HA(f);l.call(x)}}var f=DW(t,r,e,0,null,!1,!1,"",qB);return e._reactRootContainer=f,e[Sp]=f.current,eT(e.nodeType===8?e.parentNode:e),x_(),f}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var i=r;r=function(){var x=HA(y);i.call(x)}}var y=IL(e,0,!1,null,null,!1,!1,"",qB);return e._reactRootContainer=y,e[Sp]=y.current,eT(e.nodeType===8?e.parentNode:e),x_(function(){vk(t,y,n,r)}),y}function wk(e,t,n,r,a){var l=n._reactRootContainer;if(l){var f=l;if(typeof a=="function"){var i=a;a=function(){var y=HA(f);i.call(y)}}vk(t,f,e,a)}else f=Mce(n,t,e,a,r);return HA(f)}dZ=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=o2(t.pendingLanes);n!==0&&(K8(t,n|1),lc(t,Qo()),!(Ca&6)&&(Xv=Qo()+500,z0()))}break;case 13:x_(function(){var r=Ap(e,1);if(r!==null){var a=Du();ph(r,e,1,a)}}),RL(e,1)}};Q8=function(e){if(e.tag===13){var t=Ap(e,134217728);if(t!==null){var n=Du();ph(t,e,134217728,n)}RL(e,134217728)}};hZ=function(e){if(e.tag===13){var t=u0(e),n=Ap(e,t);if(n!==null){var r=Du();ph(n,e,t,r)}RL(e,t)}};fZ=function(){return qa};pZ=function(e,t){var n=qa;try{return qa=e,t()}finally{qa=n}};TM=function(e,t,n){switch(t){case"input":if(gM(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=hk(r);if(!a)throw Error(ir(90));Gq(r),gM(r,a)}}}break;case"textarea":Zq(e,n);break;case"select":t=n.value,t!=null&&mv(e,!!n.multiple,t,!1)}};eZ=SL;tZ=x_;var Pce={usingClientEntryPoint:!1,Events:[qT,sv,hk,Qq,Jq,SL]},Ww={findFiberByHostInstance:Zg,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Oce={bundleType:Ww.bundleType,version:Ww.version,rendererPackageName:Ww.rendererPackageName,rendererConfig:Ww.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:zp.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=iZ(e),e===null?null:e.stateNode},findFiberByHostInstance:Ww.findFiberByHostInstance||Rce,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var B3=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!B3.isDisabled&&B3.supportsFiber)try{lk=B3.inject(Oce),pf=B3}catch{}}Hc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pce;Hc.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!PL(t))throw Error(ir(200));return Ice(e,t,null,n)};Hc.createRoot=function(e,t){if(!PL(e))throw Error(ir(299));var n=!1,r="",a=NW;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=IL(e,1,!1,null,null,n,!1,r,a),e[Sp]=t.current,eT(e.nodeType===8?e.parentNode:e),new ML(t)};Hc.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ir(188)):(e=Object.keys(e).join(","),Error(ir(268,e)));return e=iZ(t),e=e===null?null:e.stateNode,e};Hc.flushSync=function(e){return x_(e)};Hc.hydrate=function(e,t,n){if(!bk(t))throw Error(ir(200));return wk(null,e,t,!0,n)};Hc.hydrateRoot=function(e,t,n){if(!PL(e))throw Error(ir(405));var r=n!=null&&n.hydratedSources||null,a=!1,l="",f=NW;if(n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(l=n.identifierPrefix),n.onRecoverableError!==void 0&&(f=n.onRecoverableError)),t=DW(t,null,e,1,n??null,a,!1,l,f),e[Sp]=t.current,eT(e),r)for(e=0;e<r.length;e++)n=r[e],a=n._getVersion,a=a(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new xk(t)};Hc.render=function(e,t,n){if(!bk(t))throw Error(ir(200));return wk(null,e,t,!1,n)};Hc.unmountComponentAtNode=function(e){if(!bk(e))throw Error(ir(40));return e._reactRootContainer?(x_(function(){wk(null,null,e,!1,function(){e._reactRootContainer=null,e[Sp]=null})}),!0):!1};Hc.unstable_batchedUpdates=SL;Hc.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!bk(n))throw Error(ir(200));if(e==null||e._reactInternals===void 0)throw Error(ir(38));return wk(e,t,n,!1,r)};Hc.version="18.3.1-next-f1338f8080-20240426";function zW(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(zW)}catch(e){console.error(e)}}zW(),zq.exports=Hc;var WT=zq.exports;const Lce=UT(WT);var ZB=WT;uM.createRoot=ZB.createRoot,uM.hydrateRoot=ZB.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function uT(){return uT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},uT.apply(this,arguments)}var Jm;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Jm||(Jm={}));const WB="popstate";function Dce(e){e===void 0&&(e={});function t(r,a){let{pathname:l,search:f,hash:i}=r.location;return nP("",{pathname:l,search:f,hash:i},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(r,a){return typeof a=="string"?a:GA(a)}return zce(t,n,null,e)}function nl(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function OL(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Nce(){return Math.random().toString(36).substr(2,8)}function XB(e,t){return{usr:e.state,key:e.key,idx:t}}function nP(e,t,n,r){return n===void 0&&(n=null),uT({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Tx(t):t,{state:n,key:t&&t.key||r||Nce()})}function GA(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function Tx(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function zce(e,t,n,r){r===void 0&&(r={});let{window:a=document.defaultView,v5Compat:l=!1}=r,f=a.history,i=Jm.Pop,y=null,x=S();x==null&&(x=0,f.replaceState(uT({},f.state,{idx:x}),""));function S(){return(f.state||{idx:null}).idx}function C(){i=Jm.Pop;let q=S(),G=q==null?null:q-x;x=q,y&&y({action:i,location:U.location,delta:G})}function P(q,G){i=Jm.Push;let $=nP(U.location,q,G);x=S()+1;let X=XB($,x),ie=U.createHref($);try{f.pushState(X,"",ie)}catch(de){if(de instanceof DOMException&&de.name==="DataCloneError")throw de;a.location.assign(ie)}l&&y&&y({action:i,location:U.location,delta:1})}function L(q,G){i=Jm.Replace;let $=nP(U.location,q,G);x=S();let X=XB($,x),ie=U.createHref($);f.replaceState(X,"",ie),l&&y&&y({action:i,location:U.location,delta:0})}function F(q){let G=a.location.origin!=="null"?a.location.origin:a.location.href,$=typeof q=="string"?q:GA(q);return $=$.replace(/ $/,"%20"),nl(G,"No window.location.(origin|href) available to create URL for href: "+$),new URL($,G)}let U={get action(){return i},get location(){return e(a,f)},listen(q){if(y)throw new Error("A history only accepts one active listener");return a.addEventListener(WB,C),y=q,()=>{a.removeEventListener(WB,C),y=null}},createHref(q){return t(a,q)},createURL:F,encodeLocation(q){let G=F(q);return{pathname:G.pathname,search:G.search,hash:G.hash}},push:P,replace:L,go(q){return f.go(q)}};return U}var YB;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(YB||(YB={}));function Fce(e,t,n){return n===void 0&&(n="/"),Bce(e,t,n)}function Bce(e,t,n,r){let a=typeof t=="string"?Tx(t):t,l=LL(a.pathname||"/",n);if(l==null)return null;let f=FW(e);jce(f);let i=null;for(let y=0;i==null&&y<f.length;++y){let x=Qce(l);i=Xce(f[y],x)}return i}function FW(e,t,n,r){t===void 0&&(t=[]),n===void 0&&(n=[]),r===void 0&&(r="");let a=(l,f,i)=>{let y={relativePath:i===void 0?l.path||"":i,caseSensitive:l.caseSensitive===!0,childrenIndex:f,route:l};y.relativePath.startsWith("/")&&(nl(y.relativePath.startsWith(r),'Absolute route path "'+y.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),y.relativePath=y.relativePath.slice(r.length));let x=d0([r,y.relativePath]),S=n.concat(y);l.children&&l.children.length>0&&(nl(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+x+'".')),FW(l.children,t,S,x)),!(l.path==null&&!l.index)&&t.push({path:x,score:Zce(x,l.index),routesMeta:S})};return e.forEach((l,f)=>{var i;if(l.path===""||!((i=l.path)!=null&&i.includes("?")))a(l,f);else for(let y of BW(l.path))a(l,f,y)}),t}function BW(e){let t=e.split("/");if(t.length===0)return[];let[n,...r]=t,a=n.endsWith("?"),l=n.replace(/\?$/,"");if(r.length===0)return a?[l,""]:[l];let f=BW(r.join("/")),i=[];return i.push(...f.map(y=>y===""?l:[l,y].join("/"))),a&&i.push(...f),i.map(y=>e.startsWith("/")&&y===""?"/":y)}function jce(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:Wce(t.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const Uce=/^:[\w-]+$/,Vce=3,$ce=2,Hce=1,Gce=10,qce=-2,KB=e=>e==="*";function Zce(e,t){let n=e.split("/"),r=n.length;return n.some(KB)&&(r+=qce),t&&(r+=$ce),n.filter(a=>!KB(a)).reduce((a,l)=>a+(Uce.test(l)?Vce:l===""?Hce:Gce),r)}function Wce(e,t){return e.length===t.length&&e.slice(0,-1).every((r,a)=>r===t[a])?e[e.length-1]-t[t.length-1]:0}function Xce(e,t,n){let{routesMeta:r}=e,a={},l="/",f=[];for(let i=0;i<r.length;++i){let y=r[i],x=i===r.length-1,S=l==="/"?t:t.slice(l.length)||"/",C=Yce({path:y.relativePath,caseSensitive:y.caseSensitive,end:x},S),P=y.route;if(!C)return null;Object.assign(a,C.params),f.push({params:a,pathname:d0([l,C.pathname]),pathnameBase:rde(d0([l,C.pathnameBase])),route:P}),C.pathnameBase!=="/"&&(l=d0([l,C.pathnameBase]))}return f}function Yce(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=Kce(e.path,e.caseSensitive,e.end),a=t.match(n);if(!a)return null;let l=a[0],f=l.replace(/(.)\/+$/,"$1"),i=a.slice(1);return{params:r.reduce((x,S,C)=>{let{paramName:P,isOptional:L}=S;if(P==="*"){let U=i[C]||"";f=l.slice(0,l.length-U.length).replace(/(.)\/+$/,"$1")}const F=i[C];return L&&!F?x[P]=void 0:x[P]=(F||"").replace(/%2F/g,"/"),x},{}),pathname:l,pathnameBase:f,pattern:e}}function Kce(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),OL(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let r=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,i,y)=>(r.push({paramName:i,isOptional:y!=null}),y?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),r]}function Qce(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return OL(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function LL(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&r!=="/"?null:e.slice(n)||"/"}const Jce=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ede=e=>Jce.test(e);function tde(e,t){t===void 0&&(t="/");let{pathname:n,search:r="",hash:a=""}=typeof e=="string"?Tx(e):e,l;if(n)if(ede(n))l=n;else{if(n.includes("//")){let f=n;n=n.replace(/\/\/+/g,"/"),OL(!1,"Pathnames cannot have embedded double slashes - normalizing "+(f+" -> "+n))}n.startsWith("/")?l=QB(n.substring(1),"/"):l=QB(n,t)}else l=t;return{pathname:l,search:ide(r),hash:sde(a)}}function QB(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?n.length>1&&n.pop():a!=="."&&n.push(a)}),n.length>1?n.join("/"):"/"}function F5(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function nde(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function DL(e,t){let n=nde(e);return t?n.map((r,a)=>a===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function NL(e,t,n,r){r===void 0&&(r=!1);let a;typeof e=="string"?a=Tx(e):(a=uT({},e),nl(!a.pathname||!a.pathname.includes("?"),F5("?","pathname","search",a)),nl(!a.pathname||!a.pathname.includes("#"),F5("#","pathname","hash",a)),nl(!a.search||!a.search.includes("#"),F5("#","search","hash",a)));let l=e===""||a.pathname==="",f=l?"/":a.pathname,i;if(f==null)i=n;else{let C=t.length-1;if(!r&&f.startsWith("..")){let P=f.split("/");for(;P[0]==="..";)P.shift(),C-=1;a.pathname=P.join("/")}i=C>=0?t[C]:"/"}let y=tde(a,i),x=f&&f!=="/"&&f.endsWith("/"),S=(l||f===".")&&n.endsWith("/");return!y.pathname.endsWith("/")&&(x||S)&&(y.pathname+="/"),y}const d0=e=>e.join("/").replace(/\/\/+/g,"/"),rde=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),ide=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,sde=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function ade(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const jW=["post","put","patch","delete"];new Set(jW);const ode=["get",...jW];new Set(ode);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function cT(){return cT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},cT.apply(this,arguments)}const zL=B.createContext(null),lde=B.createContext(null),F0=B.createContext(null),Tk=B.createContext(null),B0=B.createContext({outlet:null,matches:[],isDataRoute:!1}),UW=B.createContext(null);function ude(e,t){let{relative:n}=t===void 0?{}:t;Ex()||nl(!1);let{basename:r,navigator:a}=B.useContext(F0),{hash:l,pathname:f,search:i}=$W(e,{relative:n}),y=f;return r!=="/"&&(y=f==="/"?r:d0([r,f])),a.createHref({pathname:y,search:i,hash:l})}function Ex(){return B.useContext(Tk)!=null}function Sx(){return Ex()||nl(!1),B.useContext(Tk).location}function VW(e){B.useContext(F0).static||B.useLayoutEffect(e)}function XT(){let{isDataRoute:e}=B.useContext(B0);return e?wde():cde()}function cde(){Ex()||nl(!1);let e=B.useContext(zL),{basename:t,future:n,navigator:r}=B.useContext(F0),{matches:a}=B.useContext(B0),{pathname:l}=Sx(),f=JSON.stringify(DL(a,n.v7_relativeSplatPath)),i=B.useRef(!1);return VW(()=>{i.current=!0}),B.useCallback(function(x,S){if(S===void 0&&(S={}),!i.current)return;if(typeof x=="number"){r.go(x);return}let C=NL(x,JSON.parse(f),l,S.relative==="path");e==null&&t!=="/"&&(C.pathname=C.pathname==="/"?t:d0([t,C.pathname])),(S.replace?r.replace:r.push)(C,S.state,S)},[t,r,f,l,e])}function $W(e,t){let{relative:n}=t===void 0?{}:t,{future:r}=B.useContext(F0),{matches:a}=B.useContext(B0),{pathname:l}=Sx(),f=JSON.stringify(DL(a,r.v7_relativeSplatPath));return B.useMemo(()=>NL(e,JSON.parse(f),l,n==="path"),[e,f,l,n])}function dde(e,t){return hde(e,t)}function hde(e,t,n,r){Ex()||nl(!1);let{navigator:a}=B.useContext(F0),{matches:l}=B.useContext(B0),f=l[l.length-1],i=f?f.params:{};f&&f.pathname;let y=f?f.pathnameBase:"/";f&&f.route;let x=Sx(),S;if(t){var C;let q=typeof t=="string"?Tx(t):t;y==="/"||(C=q.pathname)!=null&&C.startsWith(y)||nl(!1),S=q}else S=x;let P=S.pathname||"/",L=P;if(y!=="/"){let q=y.replace(/^\//,"").split("/");L="/"+P.replace(/^\//,"").split("/").slice(q.length).join("/")}let F=Fce(e,{pathname:L}),U=_de(F&&F.map(q=>Object.assign({},q,{params:Object.assign({},i,q.params),pathname:d0([y,a.encodeLocation?a.encodeLocation(q.pathname).pathname:q.pathname]),pathnameBase:q.pathnameBase==="/"?y:d0([y,a.encodeLocation?a.encodeLocation(q.pathnameBase).pathname:q.pathnameBase])})),l,n,r);return t&&U?B.createElement(Tk.Provider,{value:{location:cT({pathname:"/",search:"",hash:"",state:null,key:"default"},S),navigationType:Jm.Pop}},U):U}function fde(){let e=bde(),t=ade(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return B.createElement(B.Fragment,null,B.createElement("h2",null,"Unexpected Application Error!"),B.createElement("h3",{style:{fontStyle:"italic"}},t),n?B.createElement("pre",{style:a},n):null,null)}const pde=B.createElement(fde,null);class mde extends B.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?B.createElement(B0.Provider,{value:this.props.routeContext},B.createElement(UW.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function gde(e){let{routeContext:t,match:n,children:r}=e,a=B.useContext(zL);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),B.createElement(B0.Provider,{value:t},r)}function _de(e,t,n,r){var a;if(t===void 0&&(t=[]),n===void 0&&(n=null),r===void 0&&(r=null),e==null){var l;if(!n)return null;if(n.errors)e=n.matches;else if((l=r)!=null&&l.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let f=e,i=(a=n)==null?void 0:a.errors;if(i!=null){let S=f.findIndex(C=>C.route.id&&(i==null?void 0:i[C.route.id])!==void 0);S>=0||nl(!1),f=f.slice(0,Math.min(f.length,S+1))}let y=!1,x=-1;if(n&&r&&r.v7_partialHydration)for(let S=0;S<f.length;S++){let C=f[S];if((C.route.HydrateFallback||C.route.hydrateFallbackElement)&&(x=S),C.route.id){let{loaderData:P,errors:L}=n,F=C.route.loader&&P[C.route.id]===void 0&&(!L||L[C.route.id]===void 0);if(C.route.lazy||F){y=!0,x>=0?f=f.slice(0,x+1):f=[f[0]];break}}}return f.reduceRight((S,C,P)=>{let L,F=!1,U=null,q=null;n&&(L=i&&C.route.id?i[C.route.id]:void 0,U=C.route.errorElement||pde,y&&(x<0&&P===0?(Tde("route-fallback"),F=!0,q=null):x===P&&(F=!0,q=C.route.hydrateFallbackElement||null)));let G=t.concat(f.slice(0,P+1)),$=()=>{let X;return L?X=U:F?X=q:C.route.Component?X=B.createElement(C.route.Component,null):C.route.element?X=C.route.element:X=S,B.createElement(gde,{match:C,routeContext:{outlet:S,matches:G,isDataRoute:n!=null},children:X})};return n&&(C.route.ErrorBoundary||C.route.errorElement||P===0)?B.createElement(mde,{location:n.location,revalidation:n.revalidation,component:U,error:L,children:$(),routeContext:{outlet:null,matches:G,isDataRoute:!0}}):$()},null)}var HW=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(HW||{}),GW=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(GW||{});function yde(e){let t=B.useContext(zL);return t||nl(!1),t}function vde(e){let t=B.useContext(lde);return t||nl(!1),t}function xde(e){let t=B.useContext(B0);return t||nl(!1),t}function qW(e){let t=xde(),n=t.matches[t.matches.length-1];return n.route.id||nl(!1),n.route.id}function bde(){var e;let t=B.useContext(UW),n=vde(),r=qW();return t!==void 0?t:(e=n.errors)==null?void 0:e[r]}function wde(){let{router:e}=yde(HW.UseNavigateStable),t=qW(GW.UseNavigateStable),n=B.useRef(!1);return VW(()=>{n.current=!0}),B.useCallback(function(a,l){l===void 0&&(l={}),n.current&&(typeof a=="number"?e.navigate(a):e.navigate(a,cT({fromRouteId:t},l)))},[e,t])}const JB={};function Tde(e,t,n){JB[e]||(JB[e]=!0)}function Ede(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Sde(e){let{to:t,replace:n,state:r,relative:a}=e;Ex()||nl(!1);let{future:l,static:f}=B.useContext(F0),{matches:i}=B.useContext(B0),{pathname:y}=Sx(),x=XT(),S=NL(t,DL(i,l.v7_relativeSplatPath),y,a==="path"),C=JSON.stringify(S);return B.useEffect(()=>x(JSON.parse(C),{replace:n,state:r,relative:a}),[x,C,a,n,r]),null}function M4(e){nl(!1)}function Ade(e){let{basename:t="/",children:n=null,location:r,navigationType:a=Jm.Pop,navigator:l,static:f=!1,future:i}=e;Ex()&&nl(!1);let y=t.replace(/^\/*/,"/"),x=B.useMemo(()=>({basename:y,navigator:l,static:f,future:cT({v7_relativeSplatPath:!1},i)}),[y,i,l,f]);typeof r=="string"&&(r=Tx(r));let{pathname:S="/",search:C="",hash:P="",state:L=null,key:F="default"}=r,U=B.useMemo(()=>{let q=LL(S,y);return q==null?null:{location:{pathname:q,search:C,hash:P,state:L,key:F},navigationType:a}},[y,S,C,P,L,F,a]);return U==null?null:B.createElement(F0.Provider,{value:x},B.createElement(Tk.Provider,{children:n,value:U}))}function Cde(e){let{children:t,location:n}=e;return dde(rP(t),n)}new Promise(()=>{});function rP(e,t){t===void 0&&(t=[]);let n=[];return B.Children.forEach(e,(r,a)=>{if(!B.isValidElement(r))return;let l=[...t,a];if(r.type===B.Fragment){n.push.apply(n,rP(r.props.children,l));return}r.type!==M4&&nl(!1),!r.props.index||!r.props.children||nl(!1);let f={id:r.props.id||l.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(f.children=rP(r.props.children,l)),n.push(f)}),n}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function iP(){return iP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},iP.apply(this,arguments)}function kde(e,t){if(e==null)return{};var n={},r=Object.keys(e),a,l;for(l=0;l<r.length;l++)a=r[l],!(t.indexOf(a)>=0)&&(n[a]=e[a]);return n}function Ide(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Rde(e,t){return e.button===0&&(!t||t==="_self")&&!Ide(e)}function sP(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let r=e[n];return t.concat(Array.isArray(r)?r.map(a=>[n,a]):[[n,r]])},[]))}function Mde(e,t){let n=sP(e);return t&&t.forEach((r,a)=>{n.has(a)||t.getAll(a).forEach(l=>{n.append(a,l)})}),n}const Pde=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Ode="6";try{window.__reactRouterVersion=Ode}catch{}const Lde="startTransition",ej=$T[Lde];function Dde(e){let{basename:t,children:n,future:r,window:a}=e,l=B.useRef();l.current==null&&(l.current=Dce({window:a,v5Compat:!0}));let f=l.current,[i,y]=B.useState({action:f.action,location:f.location}),{v7_startTransition:x}=r||{},S=B.useCallback(C=>{x&&ej?ej(()=>y(C)):y(C)},[y,x]);return B.useLayoutEffect(()=>f.listen(S),[f,S]),B.useEffect(()=>Ede(r),[r]),B.createElement(Ade,{basename:t,children:n,location:i.location,navigationType:i.action,navigator:f,future:r})}const Nde=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",zde=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ZW=B.forwardRef(function(t,n){let{onClick:r,relative:a,reloadDocument:l,replace:f,state:i,target:y,to:x,preventScrollReset:S,viewTransition:C}=t,P=kde(t,Pde),{basename:L}=B.useContext(F0),F,U=!1;if(typeof x=="string"&&zde.test(x)&&(F=x,Nde))try{let X=new URL(window.location.href),ie=x.startsWith("//")?new URL(X.protocol+x):new URL(x),de=LL(ie.pathname,L);ie.origin===X.origin&&de!=null?x=de+ie.search+ie.hash:U=!0}catch{}let q=ude(x,{relative:a}),G=Fde(x,{replace:f,state:i,target:y,preventScrollReset:S,relative:a,viewTransition:C});function $(X){r&&r(X),X.defaultPrevented||G(X)}return B.createElement("a",iP({},P,{href:F||q,onClick:U||l?r:$,ref:n,target:y}))});var tj;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(tj||(tj={}));var nj;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(nj||(nj={}));function Fde(e,t){let{target:n,replace:r,state:a,preventScrollReset:l,relative:f,viewTransition:i}=t===void 0?{}:t,y=XT(),x=Sx(),S=$W(e,{relative:f});return B.useCallback(C=>{if(Rde(C,n)){C.preventDefault();let P=r!==void 0?r:GA(x)===GA(S);y(e,{replace:P,state:a,preventScrollReset:l,relative:f,viewTransition:i})}},[x,y,S,r,a,n,e,l,f,i])}function Bde(e){let t=B.useRef(sP(e)),n=B.useRef(!1),r=Sx(),a=B.useMemo(()=>Mde(r.search,n.current?null:t.current),[r.search]),l=XT(),f=B.useCallback((i,y)=>{const x=sP(typeof i=="function"?i(a):i);n.current=!0,l("?"+x,y)},[l,a]);return[a,f]}var YT=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},jde={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},$m,F8,fq,Ude=(fq=class{constructor(){qi(this,$m,jde);qi(this,F8,!1)}setTimeoutProvider(e){ei(this,$m,e)}setTimeout(e,t){return St(this,$m).setTimeout(e,t)}clearTimeout(e){St(this,$m).clearTimeout(e)}setInterval(e,t){return St(this,$m).setInterval(e,t)}clearInterval(e){St(this,$m).clearInterval(e)}},$m=new WeakMap,F8=new WeakMap,fq),Yg=new Ude;function Vde(e){setTimeout(e,0)}var b_=typeof window>"u"||"Deno"in globalThis;function nc(){}function $de(e,t){return typeof e=="function"?e(t):e}function aP(e){return typeof e=="number"&&e>=0&&e!==1/0}function WW(e,t){return Math.max(e+(t||0)-Date.now(),0)}function h0(e,t){return typeof e=="function"?e(t):e}function dd(e,t){return typeof e=="function"?e(t):e}function rj(e,t){const{type:n="all",exact:r,fetchStatus:a,predicate:l,queryKey:f,stale:i}=e;if(f){if(r){if(t.queryHash!==FL(f,t.options))return!1}else if(!hT(t.queryKey,f))return!1}if(n!=="all"){const y=t.isActive();if(n==="active"&&!y||n==="inactive"&&y)return!1}return!(typeof i=="boolean"&&t.isStale()!==i||a&&a!==t.state.fetchStatus||l&&!l(t))}function ij(e,t){const{exact:n,status:r,predicate:a,mutationKey:l}=e;if(l){if(!t.options.mutationKey)return!1;if(n){if(dT(t.options.mutationKey)!==dT(l))return!1}else if(!hT(t.options.mutationKey,l))return!1}return!(r&&t.state.status!==r||a&&!a(t))}function FL(e,t){return((t==null?void 0:t.queryKeyHashFn)||dT)(e)}function dT(e){return JSON.stringify(e,(t,n)=>lP(n)?Object.keys(n).sort().reduce((r,a)=>(r[a]=n[a],r),{}):n)}function hT(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(n=>hT(e[n],t[n])):!1}var Hde=Object.prototype.hasOwnProperty;function XW(e,t){if(e===t)return e;const n=sj(e)&&sj(t);if(!n&&!(lP(e)&&lP(t)))return t;const a=(n?e:Object.keys(e)).length,l=n?t:Object.keys(t),f=l.length,i=n?new Array(f):{};let y=0;for(let x=0;x<f;x++){const S=n?x:l[x],C=e[S],P=t[S];if(C===P){i[S]=C,(n?x<a:Hde.call(e,S))&&y++;continue}if(C===null||P===null||typeof C!="object"||typeof P!="object"){i[S]=P;continue}const L=XW(C,P);i[S]=L,L===C&&y++}return a===f&&y===a?e:i}function oP(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function sj(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function lP(e){if(!aj(e))return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(!aj(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function aj(e){return Object.prototype.toString.call(e)==="[object Object]"}function Gde(e){return new Promise(t=>{Yg.setTimeout(t,e)})}function uP(e,t,n){return typeof n.structuralSharing=="function"?n.structuralSharing(e,t):n.structuralSharing!==!1?XW(e,t):t}function qde(e,t,n=0){const r=[...e,t];return n&&r.length>n?r.slice(1):r}function Zde(e,t,n=0){const r=[t,...e];return n&&r.length>n?r.slice(0,-1):r}var BL=Symbol();function YW(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===BL?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function KW(e,t){return typeof e=="function"?e(...t):!!e}function Wde(e,t,n){let r=!1,a;return Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(a??(a=t()),r||(r=!0,a.aborted?n():a.addEventListener("abort",n,{once:!0})),a)}),e}var Jg,Hm,Mv,pq,Xde=(pq=class extends YT{constructor(){super();qi(this,Jg);qi(this,Hm);qi(this,Mv);ei(this,Mv,t=>{if(!b_&&window.addEventListener){const n=()=>t();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){St(this,Hm)||this.setEventListener(St(this,Mv))}onUnsubscribe(){var t;this.hasListeners()||((t=St(this,Hm))==null||t.call(this),ei(this,Hm,void 0))}setEventListener(t){var n;ei(this,Mv,t),(n=St(this,Hm))==null||n.call(this),ei(this,Hm,t(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(t){St(this,Jg)!==t&&(ei(this,Jg,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(n=>{n(t)})}isFocused(){var t;return typeof St(this,Jg)=="boolean"?St(this,Jg):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},Jg=new WeakMap,Hm=new WeakMap,Mv=new WeakMap,pq),jL=new Xde;function cP(){let e,t;const n=new Promise((a,l)=>{e=a,t=l});n.status="pending",n.catch(()=>{});function r(a){Object.assign(n,a),delete n.resolve,delete n.reject}return n.resolve=a=>{r({status:"fulfilled",value:a}),e(a)},n.reject=a=>{r({status:"rejected",reason:a}),t(a)},n}var Yde=Vde;function Kde(){let e=[],t=0,n=i=>{i()},r=i=>{i()},a=Yde;const l=i=>{t?e.push(i):a(()=>{n(i)})},f=()=>{const i=e;e=[],i.length&&a(()=>{r(()=>{i.forEach(y=>{n(y)})})})};return{batch:i=>{let y;t++;try{y=i()}finally{t--,t||f()}return y},batchCalls:i=>(...y)=>{l(()=>{i(...y)})},schedule:l,setNotifyFunction:i=>{n=i},setBatchNotifyFunction:i=>{r=i},setScheduler:i=>{a=i}}}var ql=Kde(),Pv,Gm,Ov,mq,Qde=(mq=class extends YT{constructor(){super();qi(this,Pv,!0);qi(this,Gm);qi(this,Ov);ei(this,Ov,t=>{if(!b_&&window.addEventListener){const n=()=>t(!0),r=()=>t(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r)}}})}onSubscribe(){St(this,Gm)||this.setEventListener(St(this,Ov))}onUnsubscribe(){var t;this.hasListeners()||((t=St(this,Gm))==null||t.call(this),ei(this,Gm,void 0))}setEventListener(t){var n;ei(this,Ov,t),(n=St(this,Gm))==null||n.call(this),ei(this,Gm,t(this.setOnline.bind(this)))}setOnline(t){St(this,Pv)!==t&&(ei(this,Pv,t),this.listeners.forEach(r=>{r(t)}))}isOnline(){return St(this,Pv)}},Pv=new WeakMap,Gm=new WeakMap,Ov=new WeakMap,mq),qA=new Qde;function Jde(e){return Math.min(1e3*2**e,3e4)}function QW(e){return(e??"online")==="online"?qA.isOnline():!0}var dP=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function JW(e){let t=!1,n=0,r;const a=cP(),l=()=>a.status!=="pending",f=U=>{var q;if(!l()){const G=new dP(U);P(G),(q=e.onCancel)==null||q.call(e,G)}},i=()=>{t=!0},y=()=>{t=!1},x=()=>jL.isFocused()&&(e.networkMode==="always"||qA.isOnline())&&e.canRun(),S=()=>QW(e.networkMode)&&e.canRun(),C=U=>{l()||(r==null||r(),a.resolve(U))},P=U=>{l()||(r==null||r(),a.reject(U))},L=()=>new Promise(U=>{var q;r=G=>{(l()||x())&&U(G)},(q=e.onPause)==null||q.call(e)}).then(()=>{var U;r=void 0,l()||(U=e.onContinue)==null||U.call(e)}),F=()=>{if(l())return;let U;const q=n===0?e.initialPromise:void 0;try{U=q??e.fn()}catch(G){U=Promise.reject(G)}Promise.resolve(U).then(C).catch(G=>{var fe;if(l())return;const $=e.retry??(b_?0:3),X=e.retryDelay??Jde,ie=typeof X=="function"?X(n,G):X,de=$===!0||typeof $=="number"&&n<$||typeof $=="function"&&$(n,G);if(t||!de){P(G);return}n++,(fe=e.onFail)==null||fe.call(e,n,G),Gde(ie).then(()=>x()?void 0:L()).then(()=>{t?P(G):F()})})};return{promise:a,status:()=>a.status,cancel:f,continue:()=>(r==null||r(),a),cancelRetry:i,continueRetry:y,canStart:S,start:()=>(S()?F():L().then(F),a)}}var e_,gq,eX=(gq=class{constructor(){qi(this,e_)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),aP(this.gcTime)&&ei(this,e_,Yg.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(b_?1/0:5*60*1e3))}clearGcTimeout(){St(this,e_)&&(Yg.clearTimeout(St(this,e_)),ei(this,e_,void 0))}},e_=new WeakMap,gq),t_,Lv,cd,n_,Pl,NT,r_,oh,rp,_q,ehe=(_q=class extends eX{constructor(t){super();qi(this,oh);qi(this,t_);qi(this,Lv);qi(this,cd);qi(this,n_);qi(this,Pl);qi(this,NT);qi(this,r_);ei(this,r_,!1),ei(this,NT,t.defaultOptions),this.setOptions(t.options),this.observers=[],ei(this,n_,t.client),ei(this,cd,St(this,n_).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,ei(this,t_,lj(this.options)),this.state=t.state??St(this,t_),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=St(this,Pl))==null?void 0:t.promise}setOptions(t){if(this.options={...St(this,NT),...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=lj(this.options);n.data!==void 0&&(this.setState(oj(n.data,n.dataUpdatedAt)),ei(this,t_,n))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&St(this,cd).remove(this)}setData(t,n){const r=uP(this.state.data,t,this.options);return ya(this,oh,rp).call(this,{data:r,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),r}setState(t,n){ya(this,oh,rp).call(this,{type:"setState",state:t,setStateOptions:n})}cancel(t){var r,a;const n=(r=St(this,Pl))==null?void 0:r.promise;return(a=St(this,Pl))==null||a.cancel(t),n?n.then(nc).catch(nc):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(St(this,t_))}isActive(){return this.observers.some(t=>dd(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===BL||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>h0(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!WW(this.state.dataUpdatedAt,t)}onFocus(){var n;const t=this.observers.find(r=>r.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(n=St(this,Pl))==null||n.continue()}onOnline(){var n;const t=this.observers.find(r=>r.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(n=St(this,Pl))==null||n.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),St(this,cd).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(n=>n!==t),this.observers.length||(St(this,Pl)&&(St(this,r_)?St(this,Pl).cancel({revert:!0}):St(this,Pl).cancelRetry()),this.scheduleGc()),St(this,cd).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ya(this,oh,rp).call(this,{type:"invalidate"})}async fetch(t,n){var y,x,S,C,P,L,F,U,q,G,$,X;if(this.state.fetchStatus!=="idle"&&((y=St(this,Pl))==null?void 0:y.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(St(this,Pl))return St(this,Pl).continueRetry(),St(this,Pl).promise}if(t&&this.setOptions(t),!this.options.queryFn){const ie=this.observers.find(de=>de.options.queryFn);ie&&this.setOptions(ie.options)}const r=new AbortController,a=ie=>{Object.defineProperty(ie,"signal",{enumerable:!0,get:()=>(ei(this,r_,!0),r.signal)})},l=()=>{const ie=YW(this.options,n),fe=(()=>{const be={client:St(this,n_),queryKey:this.queryKey,meta:this.meta};return a(be),be})();return ei(this,r_,!1),this.options.persister?this.options.persister(ie,fe,this):ie(fe)},i=(()=>{const ie={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:St(this,n_),state:this.state,fetchFn:l};return a(ie),ie})();(x=this.options.behavior)==null||x.onFetch(i,this),ei(this,Lv,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((S=i.fetchOptions)==null?void 0:S.meta))&&ya(this,oh,rp).call(this,{type:"fetch",meta:(C=i.fetchOptions)==null?void 0:C.meta}),ei(this,Pl,JW({initialPromise:n==null?void 0:n.initialPromise,fn:i.fetchFn,onCancel:ie=>{ie instanceof dP&&ie.revert&&this.setState({...St(this,Lv),fetchStatus:"idle"}),r.abort()},onFail:(ie,de)=>{ya(this,oh,rp).call(this,{type:"failed",failureCount:ie,error:de})},onPause:()=>{ya(this,oh,rp).call(this,{type:"pause"})},onContinue:()=>{ya(this,oh,rp).call(this,{type:"continue"})},retry:i.options.retry,retryDelay:i.options.retryDelay,networkMode:i.options.networkMode,canRun:()=>!0}));try{const ie=await St(this,Pl).start();if(ie===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(ie),(L=(P=St(this,cd).config).onSuccess)==null||L.call(P,ie,this),(U=(F=St(this,cd).config).onSettled)==null||U.call(F,ie,this.state.error,this),ie}catch(ie){if(ie instanceof dP){if(ie.silent)return St(this,Pl).promise;if(ie.revert){if(this.state.data===void 0)throw ie;return this.state.data}}throw ya(this,oh,rp).call(this,{type:"error",error:ie}),(G=(q=St(this,cd).config).onError)==null||G.call(q,ie,this),(X=($=St(this,cd).config).onSettled)==null||X.call($,this.state.data,ie,this),ie}finally{this.scheduleGc()}}},t_=new WeakMap,Lv=new WeakMap,cd=new WeakMap,n_=new WeakMap,Pl=new WeakMap,NT=new WeakMap,r_=new WeakMap,oh=new WeakSet,rp=function(t){const n=r=>{switch(t.type){case"failed":return{...r,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...tX(r.data,this.options),fetchMeta:t.meta??null};case"success":const a={...r,...oj(t.data,t.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return ei(this,Lv,t.manual?a:void 0),a;case"error":const l=t.error;return{...r,error:l,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:l,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...t.state}}};this.state=n(this.state),ql.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),St(this,cd).notify({query:this,type:"updated",action:t})})},_q);function tX(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:QW(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function oj(e,t){return{data:e,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:!1,status:"success"}}function lj(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,n=t!==void 0,r=n?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var ec,va,zT,Cu,i_,Dv,up,qm,FT,Nv,zv,s_,a_,Zm,Fv,$a,u2,hP,fP,pP,mP,gP,_P,yP,nX,yq,the=(yq=class extends YT{constructor(t,n){super();qi(this,$a);qi(this,ec);qi(this,va);qi(this,zT);qi(this,Cu);qi(this,i_);qi(this,Dv);qi(this,up);qi(this,qm);qi(this,FT);qi(this,Nv);qi(this,zv);qi(this,s_);qi(this,a_);qi(this,Zm);qi(this,Fv,new Set);this.options=n,ei(this,ec,t),ei(this,qm,null),ei(this,up,cP()),this.bindMethods(),this.setOptions(n)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(St(this,va).addObserver(this),uj(St(this,va),this.options)?ya(this,$a,u2).call(this):this.updateResult(),ya(this,$a,mP).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return vP(St(this,va),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return vP(St(this,va),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,ya(this,$a,gP).call(this),ya(this,$a,_P).call(this),St(this,va).removeObserver(this)}setOptions(t){const n=this.options,r=St(this,va);if(this.options=St(this,ec).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof dd(this.options.enabled,St(this,va))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");ya(this,$a,yP).call(this),St(this,va).setOptions(this.options),n._defaulted&&!oP(this.options,n)&&St(this,ec).getQueryCache().notify({type:"observerOptionsUpdated",query:St(this,va),observer:this});const a=this.hasListeners();a&&cj(St(this,va),r,this.options,n)&&ya(this,$a,u2).call(this),this.updateResult(),a&&(St(this,va)!==r||dd(this.options.enabled,St(this,va))!==dd(n.enabled,St(this,va))||h0(this.options.staleTime,St(this,va))!==h0(n.staleTime,St(this,va)))&&ya(this,$a,hP).call(this);const l=ya(this,$a,fP).call(this);a&&(St(this,va)!==r||dd(this.options.enabled,St(this,va))!==dd(n.enabled,St(this,va))||l!==St(this,Zm))&&ya(this,$a,pP).call(this,l)}getOptimisticResult(t){const n=St(this,ec).getQueryCache().build(St(this,ec),t),r=this.createResult(n,t);return rhe(this,r)&&(ei(this,Cu,r),ei(this,Dv,this.options),ei(this,i_,St(this,va).state)),r}getCurrentResult(){return St(this,Cu)}trackResult(t,n){return new Proxy(t,{get:(r,a)=>(this.trackProp(a),n==null||n(a),a==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&St(this,up).status==="pending"&&St(this,up).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(r,a))})}trackProp(t){St(this,Fv).add(t)}getCurrentQuery(){return St(this,va)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const n=St(this,ec).defaultQueryOptions(t),r=St(this,ec).getQueryCache().build(St(this,ec),n);return r.fetch().then(()=>this.createResult(r,n))}fetch(t){return ya(this,$a,u2).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),St(this,Cu)))}createResult(t,n){var Je;const r=St(this,va),a=this.options,l=St(this,Cu),f=St(this,i_),i=St(this,Dv),x=t!==r?t.state:St(this,zT),{state:S}=t;let C={...S},P=!1,L;if(n._optimisticResults){const we=this.hasListeners(),rt=!we&&uj(t,n),He=we&&cj(t,r,n,a);(rt||He)&&(C={...C,...tX(S.data,t.options)}),n._optimisticResults==="isRestoring"&&(C.fetchStatus="idle")}let{error:F,errorUpdatedAt:U,status:q}=C;L=C.data;let G=!1;if(n.placeholderData!==void 0&&L===void 0&&q==="pending"){let we;l!=null&&l.isPlaceholderData&&n.placeholderData===(i==null?void 0:i.placeholderData)?(we=l.data,G=!0):we=typeof n.placeholderData=="function"?n.placeholderData((Je=St(this,zv))==null?void 0:Je.state.data,St(this,zv)):n.placeholderData,we!==void 0&&(q="success",L=uP(l==null?void 0:l.data,we,n),P=!0)}if(n.select&&L!==void 0&&!G)if(l&&L===(f==null?void 0:f.data)&&n.select===St(this,FT))L=St(this,Nv);else try{ei(this,FT,n.select),L=n.select(L),L=uP(l==null?void 0:l.data,L,n),ei(this,Nv,L),ei(this,qm,null)}catch(we){ei(this,qm,we)}St(this,qm)&&(F=St(this,qm),L=St(this,Nv),U=Date.now(),q="error");const $=C.fetchStatus==="fetching",X=q==="pending",ie=q==="error",de=X&&$,fe=L!==void 0,ve={status:q,fetchStatus:C.fetchStatus,isPending:X,isSuccess:q==="success",isError:ie,isInitialLoading:de,isLoading:de,data:L,dataUpdatedAt:C.dataUpdatedAt,error:F,errorUpdatedAt:U,failureCount:C.fetchFailureCount,failureReason:C.fetchFailureReason,errorUpdateCount:C.errorUpdateCount,isFetched:C.dataUpdateCount>0||C.errorUpdateCount>0,isFetchedAfterMount:C.dataUpdateCount>x.dataUpdateCount||C.errorUpdateCount>x.errorUpdateCount,isFetching:$,isRefetching:$&&!X,isLoadingError:ie&&!fe,isPaused:C.fetchStatus==="paused",isPlaceholderData:P,isRefetchError:ie&&fe,isStale:UL(t,n),refetch:this.refetch,promise:St(this,up),isEnabled:dd(n.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const we=ft=>{ve.status==="error"?ft.reject(ve.error):ve.data!==void 0&&ft.resolve(ve.data)},rt=()=>{const ft=ei(this,up,ve.promise=cP());we(ft)},He=St(this,up);switch(He.status){case"pending":t.queryHash===r.queryHash&&we(He);break;case"fulfilled":(ve.status==="error"||ve.data!==He.value)&&rt();break;case"rejected":(ve.status!=="error"||ve.error!==He.reason)&&rt();break}}return ve}updateResult(){const t=St(this,Cu),n=this.createResult(St(this,va),this.options);if(ei(this,i_,St(this,va).state),ei(this,Dv,this.options),St(this,i_).data!==void 0&&ei(this,zv,St(this,va)),oP(n,t))return;ei(this,Cu,n);const r=()=>{if(!t)return!0;const{notifyOnChangeProps:a}=this.options,l=typeof a=="function"?a():a;if(l==="all"||!l&&!St(this,Fv).size)return!0;const f=new Set(l??St(this,Fv));return this.options.throwOnError&&f.add("error"),Object.keys(St(this,Cu)).some(i=>{const y=i;return St(this,Cu)[y]!==t[y]&&f.has(y)})};ya(this,$a,nX).call(this,{listeners:r()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&ya(this,$a,mP).call(this)}},ec=new WeakMap,va=new WeakMap,zT=new WeakMap,Cu=new WeakMap,i_=new WeakMap,Dv=new WeakMap,up=new WeakMap,qm=new WeakMap,FT=new WeakMap,Nv=new WeakMap,zv=new WeakMap,s_=new WeakMap,a_=new WeakMap,Zm=new WeakMap,Fv=new WeakMap,$a=new WeakSet,u2=function(t){ya(this,$a,yP).call(this);let n=St(this,va).fetch(this.options,t);return t!=null&&t.throwOnError||(n=n.catch(nc)),n},hP=function(){ya(this,$a,gP).call(this);const t=h0(this.options.staleTime,St(this,va));if(b_||St(this,Cu).isStale||!aP(t))return;const r=WW(St(this,Cu).dataUpdatedAt,t)+1;ei(this,s_,Yg.setTimeout(()=>{St(this,Cu).isStale||this.updateResult()},r))},fP=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(St(this,va)):this.options.refetchInterval)??!1},pP=function(t){ya(this,$a,_P).call(this),ei(this,Zm,t),!(b_||dd(this.options.enabled,St(this,va))===!1||!aP(St(this,Zm))||St(this,Zm)===0)&&ei(this,a_,Yg.setInterval(()=>{(this.options.refetchIntervalInBackground||jL.isFocused())&&ya(this,$a,u2).call(this)},St(this,Zm)))},mP=function(){ya(this,$a,hP).call(this),ya(this,$a,pP).call(this,ya(this,$a,fP).call(this))},gP=function(){St(this,s_)&&(Yg.clearTimeout(St(this,s_)),ei(this,s_,void 0))},_P=function(){St(this,a_)&&(Yg.clearInterval(St(this,a_)),ei(this,a_,void 0))},yP=function(){const t=St(this,ec).getQueryCache().build(St(this,ec),this.options);if(t===St(this,va))return;const n=St(this,va);ei(this,va,t),ei(this,zT,t.state),this.hasListeners()&&(n==null||n.removeObserver(this),t.addObserver(this))},nX=function(t){ql.batch(()=>{t.listeners&&this.listeners.forEach(n=>{n(St(this,Cu))}),St(this,ec).getQueryCache().notify({query:St(this,va),type:"observerResultsUpdated"})})},yq);function nhe(e,t){return dd(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function uj(e,t){return nhe(e,t)||e.state.data!==void 0&&vP(e,t,t.refetchOnMount)}function vP(e,t,n){if(dd(t.enabled,e)!==!1&&h0(t.staleTime,e)!=="static"){const r=typeof n=="function"?n(e):n;return r==="always"||r!==!1&&UL(e,t)}return!1}function cj(e,t,n,r){return(e!==t||dd(r.enabled,e)===!1)&&(!n.suspense||e.state.status!=="error")&&UL(e,n)}function UL(e,t){return dd(t.enabled,e)!==!1&&e.isStaleByTime(h0(t.staleTime,e))}function rhe(e,t){return!oP(e.getCurrentResult(),t)}function dj(e){return{onFetch:(t,n)=>{var S,C,P,L,F;const r=t.options,a=(P=(C=(S=t.fetchOptions)==null?void 0:S.meta)==null?void 0:C.fetchMore)==null?void 0:P.direction,l=((L=t.state.data)==null?void 0:L.pages)||[],f=((F=t.state.data)==null?void 0:F.pageParams)||[];let i={pages:[],pageParams:[]},y=0;const x=async()=>{let U=!1;const q=X=>{Wde(X,()=>t.signal,()=>U=!0)},G=YW(t.options,t.fetchOptions),$=async(X,ie,de)=>{if(U)return Promise.reject();if(ie==null&&X.pages.length)return Promise.resolve(X);const be=(()=>{const rt={client:t.client,queryKey:t.queryKey,pageParam:ie,direction:de?"backward":"forward",meta:t.options.meta};return q(rt),rt})(),ve=await G(be),{maxPages:Je}=t.options,we=de?Zde:qde;return{pages:we(X.pages,ve,Je),pageParams:we(X.pageParams,ie,Je)}};if(a&&l.length){const X=a==="backward",ie=X?ihe:hj,de={pages:l,pageParams:f},fe=ie(r,de);i=await $(de,fe,X)}else{const X=e??l.length;do{const ie=y===0?f[0]??r.initialPageParam:hj(r,i);if(y>0&&ie==null)break;i=await $(i,ie),y++}while(y<X)}return i};t.options.persister?t.fetchFn=()=>{var U,q;return(q=(U=t.options).persister)==null?void 0:q.call(U,x,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n)}:t.fetchFn=x}}}function hj(e,{pages:t,pageParams:n}){const r=t.length-1;return t.length>0?e.getNextPageParam(t[r],t,n[r],n):void 0}function ihe(e,{pages:t,pageParams:n}){var r;return t.length>0?(r=e.getPreviousPageParam)==null?void 0:r.call(e,t[0],t,n[0],n):void 0}var BT,tf,ku,o_,nf,km,vq,she=(vq=class extends eX{constructor(t){super();qi(this,nf);qi(this,BT);qi(this,tf);qi(this,ku);qi(this,o_);ei(this,BT,t.client),this.mutationId=t.mutationId,ei(this,ku,t.mutationCache),ei(this,tf,[]),this.state=t.state||ahe(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){St(this,tf).includes(t)||(St(this,tf).push(t),this.clearGcTimeout(),St(this,ku).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){ei(this,tf,St(this,tf).filter(n=>n!==t)),this.scheduleGc(),St(this,ku).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){St(this,tf).length||(this.state.status==="pending"?this.scheduleGc():St(this,ku).remove(this))}continue(){var t;return((t=St(this,o_))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var f,i,y,x,S,C,P,L,F,U,q,G,$,X,ie,de,fe,be,ve,Je;const n=()=>{ya(this,nf,km).call(this,{type:"continue"})},r={client:St(this,BT),meta:this.options.meta,mutationKey:this.options.mutationKey};ei(this,o_,JW({fn:()=>this.options.mutationFn?this.options.mutationFn(t,r):Promise.reject(new Error("No mutationFn found")),onFail:(we,rt)=>{ya(this,nf,km).call(this,{type:"failed",failureCount:we,error:rt})},onPause:()=>{ya(this,nf,km).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>St(this,ku).canRun(this)}));const a=this.state.status==="pending",l=!St(this,o_).canStart();try{if(a)n();else{ya(this,nf,km).call(this,{type:"pending",variables:t,isPaused:l}),await((i=(f=St(this,ku).config).onMutate)==null?void 0:i.call(f,t,this,r));const rt=await((x=(y=this.options).onMutate)==null?void 0:x.call(y,t,r));rt!==this.state.context&&ya(this,nf,km).call(this,{type:"pending",context:rt,variables:t,isPaused:l})}const we=await St(this,o_).start();return await((C=(S=St(this,ku).config).onSuccess)==null?void 0:C.call(S,we,t,this.state.context,this,r)),await((L=(P=this.options).onSuccess)==null?void 0:L.call(P,we,t,this.state.context,r)),await((U=(F=St(this,ku).config).onSettled)==null?void 0:U.call(F,we,null,this.state.variables,this.state.context,this,r)),await((G=(q=this.options).onSettled)==null?void 0:G.call(q,we,null,t,this.state.context,r)),ya(this,nf,km).call(this,{type:"success",data:we}),we}catch(we){try{await((X=($=St(this,ku).config).onError)==null?void 0:X.call($,we,t,this.state.context,this,r))}catch(rt){Promise.reject(rt)}try{await((de=(ie=this.options).onError)==null?void 0:de.call(ie,we,t,this.state.context,r))}catch(rt){Promise.reject(rt)}try{await((be=(fe=St(this,ku).config).onSettled)==null?void 0:be.call(fe,void 0,we,this.state.variables,this.state.context,this,r))}catch(rt){Promise.reject(rt)}try{await((Je=(ve=this.options).onSettled)==null?void 0:Je.call(ve,void 0,we,t,this.state.context,r))}catch(rt){Promise.reject(rt)}throw ya(this,nf,km).call(this,{type:"error",error:we}),we}finally{St(this,ku).runNext(this)}}},BT=new WeakMap,tf=new WeakMap,ku=new WeakMap,o_=new WeakMap,nf=new WeakSet,km=function(t){const n=r=>{switch(t.type){case"failed":return{...r,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...r,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:t.error,failureCount:r.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=n(this.state),ql.batch(()=>{St(this,tf).forEach(r=>{r.onMutationUpdate(t)}),St(this,ku).notify({mutation:this,type:"updated",action:t})})},vq);function ahe(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var cp,lh,jT,xq,ohe=(xq=class extends YT{constructor(t={}){super();qi(this,cp);qi(this,lh);qi(this,jT);this.config=t,ei(this,cp,new Set),ei(this,lh,new Map),ei(this,jT,0)}build(t,n,r){const a=new she({client:t,mutationCache:this,mutationId:++w3(this,jT)._,options:t.defaultMutationOptions(n),state:r});return this.add(a),a}add(t){St(this,cp).add(t);const n=j3(t);if(typeof n=="string"){const r=St(this,lh).get(n);r?r.push(t):St(this,lh).set(n,[t])}this.notify({type:"added",mutation:t})}remove(t){if(St(this,cp).delete(t)){const n=j3(t);if(typeof n=="string"){const r=St(this,lh).get(n);if(r)if(r.length>1){const a=r.indexOf(t);a!==-1&&r.splice(a,1)}else r[0]===t&&St(this,lh).delete(n)}}this.notify({type:"removed",mutation:t})}canRun(t){const n=j3(t);if(typeof n=="string"){const r=St(this,lh).get(n),a=r==null?void 0:r.find(l=>l.state.status==="pending");return!a||a===t}else return!0}runNext(t){var r;const n=j3(t);if(typeof n=="string"){const a=(r=St(this,lh).get(n))==null?void 0:r.find(l=>l!==t&&l.state.isPaused);return(a==null?void 0:a.continue())??Promise.resolve()}else return Promise.resolve()}clear(){ql.batch(()=>{St(this,cp).forEach(t=>{this.notify({type:"removed",mutation:t})}),St(this,cp).clear(),St(this,lh).clear()})}getAll(){return Array.from(St(this,cp))}find(t){const n={exact:!0,...t};return this.getAll().find(r=>ij(n,r))}findAll(t={}){return this.getAll().filter(n=>ij(t,n))}notify(t){ql.batch(()=>{this.listeners.forEach(n=>{n(t)})})}resumePausedMutations(){const t=this.getAll().filter(n=>n.state.isPaused);return ql.batch(()=>Promise.all(t.map(n=>n.continue().catch(nc))))}},cp=new WeakMap,lh=new WeakMap,jT=new WeakMap,xq);function j3(e){var t;return(t=e.options.scope)==null?void 0:t.id}var rf,bq,lhe=(bq=class extends YT{constructor(t={}){super();qi(this,rf);this.config=t,ei(this,rf,new Map)}build(t,n,r){const a=n.queryKey,l=n.queryHash??FL(a,n);let f=this.get(l);return f||(f=new ehe({client:t,queryKey:a,queryHash:l,options:t.defaultQueryOptions(n),state:r,defaultOptions:t.getQueryDefaults(a)}),this.add(f)),f}add(t){St(this,rf).has(t.queryHash)||(St(this,rf).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const n=St(this,rf).get(t.queryHash);n&&(t.destroy(),n===t&&St(this,rf).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){ql.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return St(this,rf).get(t)}getAll(){return[...St(this,rf).values()]}find(t){const n={exact:!0,...t};return this.getAll().find(r=>rj(n,r))}findAll(t={}){const n=this.getAll();return Object.keys(t).length>0?n.filter(r=>rj(t,r)):n}notify(t){ql.batch(()=>{this.listeners.forEach(n=>{n(t)})})}onFocus(){ql.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){ql.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},rf=new WeakMap,bq),Ho,Wm,Xm,Bv,jv,Ym,Uv,Vv,wq,uhe=(wq=class{constructor(e={}){qi(this,Ho);qi(this,Wm);qi(this,Xm);qi(this,Bv);qi(this,jv);qi(this,Ym);qi(this,Uv);qi(this,Vv);ei(this,Ho,e.queryCache||new lhe),ei(this,Wm,e.mutationCache||new ohe),ei(this,Xm,e.defaultOptions||{}),ei(this,Bv,new Map),ei(this,jv,new Map),ei(this,Ym,0)}mount(){w3(this,Ym)._++,St(this,Ym)===1&&(ei(this,Uv,jL.subscribe(async e=>{e&&(await this.resumePausedMutations(),St(this,Ho).onFocus())})),ei(this,Vv,qA.subscribe(async e=>{e&&(await this.resumePausedMutations(),St(this,Ho).onOnline())})))}unmount(){var e,t;w3(this,Ym)._--,St(this,Ym)===0&&((e=St(this,Uv))==null||e.call(this),ei(this,Uv,void 0),(t=St(this,Vv))==null||t.call(this),ei(this,Vv,void 0))}isFetching(e){return St(this,Ho).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return St(this,Wm).findAll({...e,status:"pending"}).length}getQueryData(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=St(this,Ho).get(t.queryHash))==null?void 0:n.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=St(this,Ho).build(this,t),r=n.state.data;return r===void 0?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(h0(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(r))}getQueriesData(e){return St(this,Ho).findAll(e).map(({queryKey:t,state:n})=>{const r=n.data;return[t,r]})}setQueryData(e,t,n){const r=this.defaultQueryOptions({queryKey:e}),a=St(this,Ho).get(r.queryHash),l=a==null?void 0:a.state.data,f=$de(t,l);if(f!==void 0)return St(this,Ho).build(this,r).setData(f,{...n,manual:!0})}setQueriesData(e,t,n){return ql.batch(()=>St(this,Ho).findAll(e).map(({queryKey:r})=>[r,this.setQueryData(r,t,n)]))}getQueryState(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=St(this,Ho).get(t.queryHash))==null?void 0:n.state}removeQueries(e){const t=St(this,Ho);ql.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=St(this,Ho);return ql.batch(()=>(n.findAll(e).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},r=ql.batch(()=>St(this,Ho).findAll(e).map(a=>a.cancel(n)));return Promise.all(r).then(nc).catch(nc)}invalidateQueries(e,t={}){return ql.batch(()=>(St(this,Ho).findAll(e).forEach(n=>{n.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},r=ql.batch(()=>St(this,Ho).findAll(e).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let l=a.fetch(void 0,n);return n.throwOnError||(l=l.catch(nc)),a.state.fetchStatus==="paused"?Promise.resolve():l}));return Promise.all(r).then(nc)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=St(this,Ho).build(this,t);return n.isStaleByTime(h0(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(nc).catch(nc)}fetchInfiniteQuery(e){return e.behavior=dj(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(nc).catch(nc)}ensureInfiniteQueryData(e){return e.behavior=dj(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return qA.isOnline()?St(this,Wm).resumePausedMutations():Promise.resolve()}getQueryCache(){return St(this,Ho)}getMutationCache(){return St(this,Wm)}getDefaultOptions(){return St(this,Xm)}setDefaultOptions(e){ei(this,Xm,e)}setQueryDefaults(e,t){St(this,Bv).set(dT(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...St(this,Bv).values()],n={};return t.forEach(r=>{hT(e,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(e,t){St(this,jv).set(dT(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...St(this,jv).values()],n={};return t.forEach(r=>{hT(e,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...St(this,Xm).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=FL(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===BL&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...St(this,Xm).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){St(this,Ho).clear(),St(this,Wm).clear()}},Ho=new WeakMap,Wm=new WeakMap,Xm=new WeakMap,Bv=new WeakMap,jv=new WeakMap,Ym=new WeakMap,Uv=new WeakMap,Vv=new WeakMap,wq),rX=B.createContext(void 0),iX=e=>{const t=B.useContext(rX);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},che=({client:e,children:t})=>(B.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),k.jsx(rX.Provider,{value:e,children:t})),sX=B.createContext(!1),dhe=()=>B.useContext(sX);sX.Provider;function hhe(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var fhe=B.createContext(hhe()),phe=()=>B.useContext(fhe),mhe=(e,t,n)=>{const r=n!=null&&n.state.error&&typeof e.throwOnError=="function"?KW(e.throwOnError,[n.state.error,n]):e.throwOnError;(e.suspense||e.experimental_prefetchInRender||r)&&(t.isReset()||(e.retryOnMount=!1))},ghe=e=>{B.useEffect(()=>{e.clearReset()},[e])},_he=({result:e,errorResetBoundary:t,throwOnError:n,query:r,suspense:a})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(a&&e.data===void 0||KW(n,[e.error,r])),yhe=e=>{if(e.suspense){const n=a=>a==="static"?a:Math.max(a??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...a)=>n(r(...a)):n(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},vhe=(e,t)=>e.isLoading&&e.isFetching&&!t,xhe=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,fj=(e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()});function bhe(e,t,n){var P,L,F,U;const r=dhe(),a=phe(),l=iX(),f=l.defaultQueryOptions(e);(L=(P=l.getDefaultOptions().queries)==null?void 0:P._experimental_beforeQuery)==null||L.call(P,f);const i=l.getQueryCache().get(f.queryHash);f._optimisticResults=r?"isRestoring":"optimistic",yhe(f),mhe(f,a,i),ghe(a);const y=!l.getQueryCache().get(f.queryHash),[x]=B.useState(()=>new t(l,f)),S=x.getOptimisticResult(f),C=!r&&e.subscribed!==!1;if(B.useSyncExternalStore(B.useCallback(q=>{const G=C?x.subscribe(ql.batchCalls(q)):nc;return x.updateResult(),G},[x,C]),()=>x.getCurrentResult(),()=>x.getCurrentResult()),B.useEffect(()=>{x.setOptions(f)},[f,x]),xhe(f,S))throw fj(f,x,a);if(_he({result:S,errorResetBoundary:a,throwOnError:f.throwOnError,query:i,suspense:f.suspense}))throw S.error;if((U=(F=l.getDefaultOptions().queries)==null?void 0:F._experimental_afterQuery)==null||U.call(F,f,S),f.experimental_prefetchInRender&&!b_&&vhe(S,r)){const q=y?fj(f,x,a):i==null?void 0:i.promise;q==null||q.catch(nc).finally(()=>{x.updateResult()})}return f.notifyOnChangeProps?S:x.trackResult(S)}function wh(e,t){return bhe(e,the)}function whe(e){return typeof e=="object"&&e!==null}function The(e,t){if(!!!e)throw new Error("Unexpected invariant triggered.")}const Ehe=/\r\n|[\n\r]/g;function xP(e,t){let n=0,r=1;for(const a of e.body.matchAll(Ehe)){if(typeof a.index=="number"||The(!1),a.index>=t)break;n=a.index+a[0].length,r+=1}return{line:r,column:t+1-n}}function She(e){return aX(e.source,xP(e.source,e.start))}function aX(e,t){const n=e.locationOffset.column-1,r="".padStart(n)+e.body,a=t.line-1,l=e.locationOffset.line-1,f=t.line+l,i=t.line===1?n:0,y=t.column+i,x=`${e.name}:${f}:${y}
`,S=r.split(/\r\n|[\n\r]/g),C=S[a];if(C.length>120){const P=Math.floor(y/80),L=y%80,F=[];for(let U=0;U<C.length;U+=80)F.push(C.slice(U,U+80));return x+pj([[`${f} |`,F[0]],...F.slice(1,P+1).map(U=>["|",U]),["|","^".padStart(L)],["|",F[P+1]]])}return x+pj([[`${f-1} |`,S[a-1]],[`${f} |`,C],["|","^".padStart(y)],[`${f+1} |`,S[a+1]]])}function pj(e){const t=e.filter(([r,a])=>a!==void 0),n=Math.max(...t.map(([r])=>r.length));return t.map(([r,a])=>r.padStart(n)+(a?" "+a:"")).join(`
`)}function Ahe(e){const t=e[0];return t==null||"kind"in t||"length"in t?{nodes:t,source:e[1],positions:e[2],path:e[3],originalError:e[4],extensions:e[5]}:t}class VL extends Error{constructor(t,...n){var r,a,l;const{nodes:f,source:i,positions:y,path:x,originalError:S,extensions:C}=Ahe(n);super(t),this.name="GraphQLError",this.path=x??void 0,this.originalError=S??void 0,this.nodes=mj(Array.isArray(f)?f:f?[f]:void 0);const P=mj((r=this.nodes)===null||r===void 0?void 0:r.map(F=>F.loc).filter(F=>F!=null));this.source=i??(P==null||(a=P[0])===null||a===void 0?void 0:a.source),this.positions=y??(P==null?void 0:P.map(F=>F.start)),this.locations=y&&i?y.map(F=>xP(i,F)):P==null?void 0:P.map(F=>xP(F.source,F.start));const L=whe(S==null?void 0:S.extensions)?S==null?void 0:S.extensions:void 0;this.extensions=(l=C??L)!==null&&l!==void 0?l:Object.create(null),Object.defineProperties(this,{message:{writable:!0,enumerable:!0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),S!=null&&S.stack?Object.defineProperty(this,"stack",{value:S.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,VL):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}get[Symbol.toStringTag](){return"GraphQLError"}toString(){let t=this.message;if(this.nodes)for(const n of this.nodes)n.loc&&(t+=`

`+She(n.loc));else if(this.source&&this.locations)for(const n of this.locations)t+=`

`+aX(this.source,n);return t}toJSON(){const t={message:this.message};return this.locations!=null&&(t.locations=this.locations),this.path!=null&&(t.path=this.path),this.extensions!=null&&Object.keys(this.extensions).length>0&&(t.extensions=this.extensions),t}}function mj(e){return e===void 0||e.length===0?void 0:e}function w_(e,t="unset"){try{return JSON.parse(e)}catch{return t==="unset"?null:t}}var e0=(e=>(e.CRITICAL="critical",e.WARNING="warning",e.INFO="info",e))(e0||{}),oX=(e=>(e.BANNER="banner",e.TOAST="toast",e.SILENT="silent",e.DEV_ONLY="dev_only",e))(oX||{}),U_={COPILOT_ERROR:"CopilotError",COPILOT_API_DISCOVERY_ERROR:"CopilotApiDiscoveryError",COPILOT_REMOTE_ENDPOINT_DISCOVERY_ERROR:"CopilotKitRemoteEndpointDiscoveryError",COPILOT_KIT_AGENT_DISCOVERY_ERROR:"CopilotKitAgentDiscoveryError",COPILOT_KIT_LOW_LEVEL_ERROR:"CopilotKitLowLevelError",CONFIGURATION_ERROR:"ConfigurationError",MISSING_PUBLIC_API_KEY_ERROR:"MissingPublicApiKeyError"},Yv=(e=>(e.NETWORK_ERROR="NETWORK_ERROR",e.NOT_FOUND="NOT_FOUND",e.AGENT_NOT_FOUND="AGENT_NOT_FOUND",e.API_NOT_FOUND="API_NOT_FOUND",e.REMOTE_ENDPOINT_NOT_FOUND="REMOTE_ENDPOINT_NOT_FOUND",e.AUTHENTICATION_ERROR="AUTHENTICATION_ERROR",e.MISUSE="MISUSE",e.UNKNOWN="UNKNOWN",e.VERSION_MISMATCH="VERSION_MISMATCH",e.CONFIGURATION_ERROR="CONFIGURATION_ERROR",e.MISSING_PUBLIC_API_KEY_ERROR="MISSING_PUBLIC_API_KEY_ERROR",e.UPGRADE_REQUIRED_ERROR="UPGRADE_REQUIRED_ERROR",e))(Yv||{}),j1="https://docs.copilotkit.ai",hv=e=>`See more: [${e}](${e})`,fT={NETWORK_ERROR:{statusCode:503,troubleshootingUrl:`${j1}/troubleshooting/common-issues#i-am-getting-a-network-errors--api-not-found`,visibility:"banner",severity:"critical"},NOT_FOUND:{statusCode:404,troubleshootingUrl:`${j1}/troubleshooting/common-issues#i-am-getting-a-network-errors--api-not-found`,visibility:"banner",severity:"critical"},AGENT_NOT_FOUND:{statusCode:500,troubleshootingUrl:`${j1}/coagents/troubleshooting/common-issues#i-am-getting-agent-not-found-error`,visibility:"banner",severity:"critical"},API_NOT_FOUND:{statusCode:404,troubleshootingUrl:`${j1}/troubleshooting/common-issues#i-am-getting-a-network-errors--api-not-found`,visibility:"banner",severity:"critical"},REMOTE_ENDPOINT_NOT_FOUND:{statusCode:404,troubleshootingUrl:`${j1}/troubleshooting/common-issues#i-am-getting-copilotkits-remote-endpoint-not-found-error`,visibility:"banner",severity:"critical"},AUTHENTICATION_ERROR:{statusCode:401,troubleshootingUrl:`${j1}/troubleshooting/common-issues#authentication-errors`,visibility:"banner",severity:"critical"},MISUSE:{statusCode:400,troubleshootingUrl:null,visibility:"dev_only",severity:"warning"},UNKNOWN:{statusCode:500,visibility:"toast",severity:"critical"},CONFIGURATION_ERROR:{statusCode:400,troubleshootingUrl:null,severity:"warning",visibility:"banner"},MISSING_PUBLIC_API_KEY_ERROR:{statusCode:400,troubleshootingUrl:null,severity:"critical",visibility:"banner"},UPGRADE_REQUIRED_ERROR:{statusCode:402,troubleshootingUrl:null,severity:"warning",visibility:"banner"},VERSION_MISMATCH:{statusCode:400,troubleshootingUrl:null,visibility:"dev_only",severity:"info"}},vp=class extends VL{constructor({message:e="Unknown error occurred",code:t,severity:n,visibility:r}){const a=U_.COPILOT_ERROR,l=fT[t],{statusCode:f}=l,i=r??l.visibility??"toast",y=n??("severity"in l?l.severity:void 0);super(e,{extensions:{name:a,statusCode:f,code:t,visibility:i,severity:y,troubleshootingUrl:"troubleshootingUrl"in l?l.troubleshootingUrl:null,originalError:{message:e,stack:new Error().stack}}}),this.code=t,this.name=a,this.statusCode=f,this.severity=y,this.visibility=i}},lX=class extends vp{constructor(e={}){const t=e.url??"";let n="";t!=null&&t.includes("/info")?n="when fetching CopilotKit info":t.includes("/actions/execute")?n="when attempting to execute actions.":t.includes("/agents/state")?n="when attempting to get agent state.":t.includes("/agents/execute")&&(n="when attempting to execute agent(s).");const r=e.message??(e.url?`Failed to find CopilotKit API endpoint at url ${e.url} ${n}`:"Failed to find CopilotKit API endpoint."),a=e.code??"API_NOT_FOUND",l=`${r}.

${hv(fT[a].troubleshootingUrl)}`;super({message:l,code:a}),this.name=U_.COPILOT_API_DISCOVERY_ERROR}},Che=class extends lX{constructor(e){const t=(e==null?void 0:e.message)??(e!=null&&e.url?`Failed to find or contact remote endpoint at url ${e.url}`:"Failed to find or contact remote endpoint");super({message:t,code:"REMOTE_ENDPOINT_NOT_FOUND"}),this.name=U_.COPILOT_REMOTE_ENDPOINT_DISCOVERY_ERROR}},khe=class extends vp{constructor(e){const{agentName:t,availableAgents:n}=e,r="AGENT_NOT_FOUND",a=hv(fT[r].troubleshootingUrl);let l;if(n.length){const f=n.map(i=>i.name).join(", ");t?l=`Agent '${t}' was not found. Available agents are: ${f}. Please verify the agent name in your configuration and ensure it matches one of the available agents.

${a}`:l=`The requested agent was not found. Available agents are: ${f}. Please verify the agent name in your configuration and ensure it matches one of the available agents.

${a}`}else l=`${t?`Agent '${t}'`:"The requested agent"} was not found. Please set up at least one agent before proceeding. ${a}`;super({message:l,code:r}),this.name=U_.COPILOT_KIT_AGENT_DISCOVERY_ERROR}},Ihe=class extends vp{constructor({error:e,url:t,message:n}){let r="NETWORK_ERROR";const a=e.code,l=n??Mhe({errorCode:a,url:t});super({message:l,code:r}),this.name=U_.COPILOT_KIT_LOW_LEVEL_ERROR}},uX=class extends vp{constructor(e){super({message:e,code:"CONFIGURATION_ERROR"}),this.name=U_.CONFIGURATION_ERROR,this.severity="warning"}},Rhe=class extends uX{constructor(e){super(e),this.name=U_.MISSING_PUBLIC_API_KEY_ERROR,this.severity="critical"}},Mhe=({errorCode:e,url:t})=>{const n=fT.NETWORK_ERROR.troubleshootingUrl,r=(a=`Failed to fetch from url ${t}.`)=>`${a}.

Possible reasons:
- -The server may have an error preventing it from returning a response (Check the server logs for more info).
- -The server might be down or unreachable
- -There might be a network issue (e.g., DNS failure, connection timeout) 
- -The URL might be incorrect
- -The server is not running on the specified port

${hv(n)}`;if(t.includes("/info"))return r(`Failed to fetch CopilotKit agents/action information from url ${t}.`);if(t.includes("/actions/execute"))return r(`Fetch call to ${t} to execute actions failed.`);if(t.includes("/agents/state"))return r(`Fetch call to ${t} to get agent state failed.`);if(t.includes("/agents/execute"))return r(`Fetch call to ${t} to execute agent(s) failed.`);switch(e){case"ECONNREFUSED":return`Connection to ${t} was refused. Ensure the server is running and accessible.

${hv(n)}`;case"ENOTFOUND":return`The server on ${t} could not be found. Check the URL or your network configuration.

${hv(fT.NOT_FOUND.troubleshootingUrl)}`;case"ETIMEDOUT":return`The connection to ${t} timed out. The server might be overloaded or taking too long to respond.

${hv(n)}`;default:return}},La;(function(e){e.assertEqual=a=>{};function t(a){}e.assertIs=t;function n(a){throw new Error}e.assertNever=n,e.arrayToEnum=a=>{const l={};for(const f of a)l[f]=f;return l},e.getValidEnumValues=a=>{const l=e.objectKeys(a).filter(i=>typeof a[a[i]]!="number"),f={};for(const i of l)f[i]=a[i];return e.objectValues(f)},e.objectValues=a=>e.objectKeys(a).map(function(l){return a[l]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const l=[];for(const f in a)Object.prototype.hasOwnProperty.call(a,f)&&l.push(f);return l},e.find=(a,l)=>{for(const f of a)if(l(f))return f},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,l=" | "){return a.map(f=>typeof f=="string"?`'${f}'`:f).join(l)}e.joinValues=r,e.jsonStringifyReplacer=(a,l)=>typeof l=="bigint"?l.toString():l})(La||(La={}));var gj;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(gj||(gj={}));const ci=La.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Dm=e=>{switch(typeof e){case"undefined":return ci.undefined;case"string":return ci.string;case"number":return Number.isNaN(e)?ci.nan:ci.number;case"boolean":return ci.boolean;case"function":return ci.function;case"bigint":return ci.bigint;case"symbol":return ci.symbol;case"object":return Array.isArray(e)?ci.array:e===null?ci.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?ci.promise:typeof Map<"u"&&e instanceof Map?ci.map:typeof Set<"u"&&e instanceof Set?ci.set:typeof Date<"u"&&e instanceof Date?ci.date:ci.object;default:return ci.unknown}},yr=La.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);let T_=class cX extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(l){return l.message},r={_errors:[]},a=l=>{for(const f of l.issues)if(f.code==="invalid_union")f.unionErrors.map(a);else if(f.code==="invalid_return_type")a(f.returnTypeError);else if(f.code==="invalid_arguments")a(f.argumentsError);else if(f.path.length===0)r._errors.push(n(f));else{let i=r,y=0;for(;y<f.path.length;){const x=f.path[y];y===f.path.length-1?(i[x]=i[x]||{_errors:[]},i[x]._errors.push(n(f))):i[x]=i[x]||{_errors:[]},i=i[x],y++}}};return a(this),r}static assert(t){if(!(t instanceof cX))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,La.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const a of this.issues)if(a.path.length>0){const l=a.path[0];n[l]=n[l]||[],n[l].push(t(a))}else r.push(t(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}};T_.create=e=>new T_(e);const bP=(e,t)=>{let n;switch(e.code){case yr.invalid_type:e.received===ci.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case yr.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,La.jsonStringifyReplacer)}`;break;case yr.unrecognized_keys:n=`Unrecognized key(s) in object: ${La.joinValues(e.keys,", ")}`;break;case yr.invalid_union:n="Invalid input";break;case yr.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${La.joinValues(e.options)}`;break;case yr.invalid_enum_value:n=`Invalid enum value. Expected ${La.joinValues(e.options)}, received '${e.received}'`;break;case yr.invalid_arguments:n="Invalid function arguments";break;case yr.invalid_return_type:n="Invalid function return type";break;case yr.invalid_date:n="Invalid date";break;case yr.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:La.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case yr.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case yr.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case yr.custom:n="Invalid input";break;case yr.invalid_intersection_types:n="Intersection results could not be merged";break;case yr.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case yr.not_finite:n="Number must be finite";break;default:n=t.defaultError,La.assertNever(e)}return{message:n}};let Phe=bP;function Ohe(){return Phe}const Lhe=e=>{const{data:t,path:n,errorMaps:r,issueData:a}=e,l=[...n,...a.path||[]],f={...a,path:l};if(a.message!==void 0)return{...a,path:l,message:a.message};let i="";const y=r.filter(x=>!!x).slice().reverse();for(const x of y)i=x(f,{data:t,defaultError:i}).message;return{...a,path:l,message:i}};function Wr(e,t){const n=Ohe(),r=Lhe({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===bP?void 0:bP].filter(a=>!!a)});e.common.issues.push(r)}let _h=class dX{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const a of n){if(a.status==="aborted")return Es;a.status==="dirty"&&t.dirty(),r.push(a.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const a of n){const l=await a.key,f=await a.value;r.push({key:l,value:f})}return dX.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const a of n){const{key:l,value:f}=a;if(l.status==="aborted"||f.status==="aborted")return Es;l.status==="dirty"&&t.dirty(),f.status==="dirty"&&t.dirty(),l.value!=="__proto__"&&(typeof f.value<"u"||a.alwaysSet)&&(r[l.value]=f.value)}return{status:t.value,value:r}}};const Es=Object.freeze({status:"aborted"}),c2=e=>({status:"dirty",value:e}),Ad=e=>({status:"valid",value:e}),_j=e=>e.status==="aborted",yj=e=>e.status==="dirty",Kv=e=>e.status==="valid",ZA=e=>typeof Promise<"u"&&e instanceof Promise;var _i;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(_i||(_i={}));let v0=class{constructor(t,n,r,a){this._cachedPath=[],this.parent=t,this.data=n,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};const vj=(e,t)=>{if(Kv(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new T_(e.common.issues);return this._error=n,this._error}}};function ia(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:a}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(f,i)=>{const{message:y}=e;return f.code==="invalid_enum_value"?{message:y??i.defaultError}:typeof i.data>"u"?{message:y??r??i.defaultError}:f.code!=="invalid_type"?{message:i.defaultError}:{message:y??n??i.defaultError}},description:a}}let Ra=class{get description(){return this._def.description}_getType(t){return Dm(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:Dm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new _h,ctx:{common:t.parent.common,data:t.data,parsedType:Dm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(ZA(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){const r={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Dm(t)},a=this._parseSync({data:t,path:r.path,parent:r});return vj(r,a)}"~validate"(t){var r,a;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Dm(t)};if(!this["~standard"].async)try{const l=this._parseSync({data:t,path:[],parent:n});return Kv(l)?{value:l.value}:{issues:n.common.issues}}catch(l){(a=(r=l==null?void 0:l.message)==null?void 0:r.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:n}).then(l=>Kv(l)?{value:l.value}:{issues:n.common.issues})}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Dm(t)},a=this._parse({data:t,path:r.path,parent:r}),l=await(ZA(a)?a:Promise.resolve(a));return vj(r,l)}refine(t,n){const r=a=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,l)=>{const f=t(a),i=()=>l.addIssue({code:yr.custom,...r(a)});return typeof Promise<"u"&&f instanceof Promise?f.then(y=>y?!0:(i(),!1)):f?!0:(i(),!1)})}refinement(t,n){return this._refinement((r,a)=>t(r)?!0:(a.addIssue(typeof n=="function"?n(r,a):n),!1))}_refinement(t){return new Jv({schema:this,typeName:As.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return f0.create(this,this._def)}nullable(){return ex.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Qv.create(this)}promise(){return YA.create(this,this._def)}or(t){return WA.create([this,t],this._def)}and(t){return XA.create(this,t,this._def)}transform(t){return new Jv({...ia(this._def),schema:this,typeName:As.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new RP({...ia(this._def),innerType:this,defaultValue:n,typeName:As.ZodDefault})}brand(){return new rfe({typeName:As.ZodBranded,type:this,...ia(this._def)})}catch(t){const n=typeof t=="function"?t:()=>t;return new MP({...ia(this._def),innerType:this,catchValue:n,typeName:As.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return ife.create(this,t)}readonly(){return PP.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const Dhe=/^c[^\s-]{8,}$/i,Nhe=/^[0-9a-z]+$/,zhe=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Fhe=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Bhe=/^[a-z0-9_-]{21}$/i,jhe=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Uhe=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Vhe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,$he="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let B5;const Hhe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ghe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,qhe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Zhe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Whe=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Xhe=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,hX="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Yhe=new RegExp(`^${hX}$`);function fX(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function Khe(e){return new RegExp(`^${fX(e)}$`)}function Qhe(e){let t=`${hX}T${fX(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function Jhe(e,t){return!!((t==="v4"||!t)&&Hhe.test(e)||(t==="v6"||!t)&&qhe.test(e))}function efe(e,t){if(!jhe.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||t&&a.alg!==t)}catch{return!1}}function tfe(e,t){return!!((t==="v4"||!t)&&Ghe.test(e)||(t==="v6"||!t)&&Zhe.test(e))}let wP=class d2 extends Ra{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==ci.string){const l=this._getOrReturnCtx(t);return Wr(l,{code:yr.invalid_type,expected:ci.string,received:l.parsedType}),Es}const r=new _h;let a;for(const l of this._def.checks)if(l.kind==="min")t.data.length<l.value&&(a=this._getOrReturnCtx(t,a),Wr(a,{code:yr.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),r.dirty());else if(l.kind==="max")t.data.length>l.value&&(a=this._getOrReturnCtx(t,a),Wr(a,{code:yr.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),r.dirty());else if(l.kind==="length"){const f=t.data.length>l.value,i=t.data.length<l.value;(f||i)&&(a=this._getOrReturnCtx(t,a),f?Wr(a,{code:yr.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):i&&Wr(a,{code:yr.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),r.dirty())}else if(l.kind==="email")Vhe.test(t.data)||(a=this._getOrReturnCtx(t,a),Wr(a,{validation:"email",code:yr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="emoji")B5||(B5=new RegExp($he,"u")),B5.test(t.data)||(a=this._getOrReturnCtx(t,a),Wr(a,{validation:"emoji",code:yr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="uuid")Fhe.test(t.data)||(a=this._getOrReturnCtx(t,a),Wr(a,{validation:"uuid",code:yr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="nanoid")Bhe.test(t.data)||(a=this._getOrReturnCtx(t,a),Wr(a,{validation:"nanoid",code:yr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="cuid")Dhe.test(t.data)||(a=this._getOrReturnCtx(t,a),Wr(a,{validation:"cuid",code:yr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="cuid2")Nhe.test(t.data)||(a=this._getOrReturnCtx(t,a),Wr(a,{validation:"cuid2",code:yr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="ulid")zhe.test(t.data)||(a=this._getOrReturnCtx(t,a),Wr(a,{validation:"ulid",code:yr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),Wr(a,{validation:"url",code:yr.invalid_string,message:l.message}),r.dirty()}else l.kind==="regex"?(l.regex.lastIndex=0,l.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),Wr(a,{validation:"regex",code:yr.invalid_string,message:l.message}),r.dirty())):l.kind==="trim"?t.data=t.data.trim():l.kind==="includes"?t.data.includes(l.value,l.position)||(a=this._getOrReturnCtx(t,a),Wr(a,{code:yr.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),r.dirty()):l.kind==="toLowerCase"?t.data=t.data.toLowerCase():l.kind==="toUpperCase"?t.data=t.data.toUpperCase():l.kind==="startsWith"?t.data.startsWith(l.value)||(a=this._getOrReturnCtx(t,a),Wr(a,{code:yr.invalid_string,validation:{startsWith:l.value},message:l.message}),r.dirty()):l.kind==="endsWith"?t.data.endsWith(l.value)||(a=this._getOrReturnCtx(t,a),Wr(a,{code:yr.invalid_string,validation:{endsWith:l.value},message:l.message}),r.dirty()):l.kind==="datetime"?Qhe(l).test(t.data)||(a=this._getOrReturnCtx(t,a),Wr(a,{code:yr.invalid_string,validation:"datetime",message:l.message}),r.dirty()):l.kind==="date"?Yhe.test(t.data)||(a=this._getOrReturnCtx(t,a),Wr(a,{code:yr.invalid_string,validation:"date",message:l.message}),r.dirty()):l.kind==="time"?Khe(l).test(t.data)||(a=this._getOrReturnCtx(t,a),Wr(a,{code:yr.invalid_string,validation:"time",message:l.message}),r.dirty()):l.kind==="duration"?Uhe.test(t.data)||(a=this._getOrReturnCtx(t,a),Wr(a,{validation:"duration",code:yr.invalid_string,message:l.message}),r.dirty()):l.kind==="ip"?Jhe(t.data,l.version)||(a=this._getOrReturnCtx(t,a),Wr(a,{validation:"ip",code:yr.invalid_string,message:l.message}),r.dirty()):l.kind==="jwt"?efe(t.data,l.alg)||(a=this._getOrReturnCtx(t,a),Wr(a,{validation:"jwt",code:yr.invalid_string,message:l.message}),r.dirty()):l.kind==="cidr"?tfe(t.data,l.version)||(a=this._getOrReturnCtx(t,a),Wr(a,{validation:"cidr",code:yr.invalid_string,message:l.message}),r.dirty()):l.kind==="base64"?Whe.test(t.data)||(a=this._getOrReturnCtx(t,a),Wr(a,{validation:"base64",code:yr.invalid_string,message:l.message}),r.dirty()):l.kind==="base64url"?Xhe.test(t.data)||(a=this._getOrReturnCtx(t,a),Wr(a,{validation:"base64url",code:yr.invalid_string,message:l.message}),r.dirty()):La.assertNever(l);return{status:r.value,value:t.data}}_regex(t,n,r){return this.refinement(a=>t.test(a),{validation:n,code:yr.invalid_string,..._i.errToObj(r)})}_addCheck(t){return new d2({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",..._i.errToObj(t)})}url(t){return this._addCheck({kind:"url",..._i.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",..._i.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",..._i.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",..._i.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",..._i.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",..._i.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",..._i.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",..._i.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",..._i.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",..._i.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",..._i.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",..._i.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,..._i.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,..._i.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",..._i.errToObj(t)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,..._i.errToObj(n)})}includes(t,n){return this._addCheck({kind:"includes",value:t,position:n==null?void 0:n.position,..._i.errToObj(n==null?void 0:n.message)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,..._i.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,..._i.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,..._i.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,..._i.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,..._i.errToObj(n)})}nonempty(t){return this.min(1,_i.errToObj(t))}trim(){return new d2({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new d2({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new d2({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}};wP.create=e=>new wP({checks:[],typeName:As.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...ia(e)});function nfe(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,a=n>r?n:r,l=Number.parseInt(e.toFixed(a).replace(".","")),f=Number.parseInt(t.toFixed(a).replace(".",""));return l%f/10**a}let TP=class EP extends Ra{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==ci.number){const l=this._getOrReturnCtx(t);return Wr(l,{code:yr.invalid_type,expected:ci.number,received:l.parsedType}),Es}let r;const a=new _h;for(const l of this._def.checks)l.kind==="int"?La.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),Wr(r,{code:yr.invalid_type,expected:"integer",received:"float",message:l.message}),a.dirty()):l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(r=this._getOrReturnCtx(t,r),Wr(r,{code:yr.too_small,minimum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),a.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(r=this._getOrReturnCtx(t,r),Wr(r,{code:yr.too_big,maximum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),a.dirty()):l.kind==="multipleOf"?nfe(t.data,l.value)!==0&&(r=this._getOrReturnCtx(t,r),Wr(r,{code:yr.not_multiple_of,multipleOf:l.value,message:l.message}),a.dirty()):l.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),Wr(r,{code:yr.not_finite,message:l.message}),a.dirty()):La.assertNever(l);return{status:a.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,_i.toString(n))}gt(t,n){return this.setLimit("min",t,!1,_i.toString(n))}lte(t,n){return this.setLimit("max",t,!0,_i.toString(n))}lt(t,n){return this.setLimit("max",t,!1,_i.toString(n))}setLimit(t,n,r,a){return new EP({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:_i.toString(a)}]})}_addCheck(t){return new EP({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:_i.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:_i.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:_i.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:_i.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:_i.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:_i.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:_i.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:_i.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:_i.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&La.isInteger(t.value))}get isFinite(){let t=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(n)&&Number.isFinite(t)}};TP.create=e=>new TP({checks:[],typeName:As.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...ia(e)});let xj=class SP extends Ra{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==ci.bigint)return this._getInvalidInput(t);let r;const a=new _h;for(const l of this._def.checks)l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(r=this._getOrReturnCtx(t,r),Wr(r,{code:yr.too_small,type:"bigint",minimum:l.value,inclusive:l.inclusive,message:l.message}),a.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(r=this._getOrReturnCtx(t,r),Wr(r,{code:yr.too_big,type:"bigint",maximum:l.value,inclusive:l.inclusive,message:l.message}),a.dirty()):l.kind==="multipleOf"?t.data%l.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),Wr(r,{code:yr.not_multiple_of,multipleOf:l.value,message:l.message}),a.dirty()):La.assertNever(l);return{status:a.value,value:t.data}}_getInvalidInput(t){const n=this._getOrReturnCtx(t);return Wr(n,{code:yr.invalid_type,expected:ci.bigint,received:n.parsedType}),Es}gte(t,n){return this.setLimit("min",t,!0,_i.toString(n))}gt(t,n){return this.setLimit("min",t,!1,_i.toString(n))}lte(t,n){return this.setLimit("max",t,!0,_i.toString(n))}lt(t,n){return this.setLimit("max",t,!1,_i.toString(n))}setLimit(t,n,r,a){return new SP({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:_i.toString(a)}]})}_addCheck(t){return new SP({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:_i.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:_i.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:_i.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:_i.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:_i.toString(n)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}};xj.create=e=>new xj({checks:[],typeName:As.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...ia(e)});let AP=class extends Ra{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==ci.boolean){const r=this._getOrReturnCtx(t);return Wr(r,{code:yr.invalid_type,expected:ci.boolean,received:r.parsedType}),Es}return Ad(t.data)}};AP.create=e=>new AP({typeName:As.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...ia(e)});let bj=class pX extends Ra{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==ci.date){const l=this._getOrReturnCtx(t);return Wr(l,{code:yr.invalid_type,expected:ci.date,received:l.parsedType}),Es}if(Number.isNaN(t.data.getTime())){const l=this._getOrReturnCtx(t);return Wr(l,{code:yr.invalid_date}),Es}const r=new _h;let a;for(const l of this._def.checks)l.kind==="min"?t.data.getTime()<l.value&&(a=this._getOrReturnCtx(t,a),Wr(a,{code:yr.too_small,message:l.message,inclusive:!0,exact:!1,minimum:l.value,type:"date"}),r.dirty()):l.kind==="max"?t.data.getTime()>l.value&&(a=this._getOrReturnCtx(t,a),Wr(a,{code:yr.too_big,message:l.message,inclusive:!0,exact:!1,maximum:l.value,type:"date"}),r.dirty()):La.assertNever(l);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new pX({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:_i.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:_i.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}};bj.create=e=>new bj({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:As.ZodDate,...ia(e)});let wj=class extends Ra{_parse(t){if(this._getType(t)!==ci.symbol){const r=this._getOrReturnCtx(t);return Wr(r,{code:yr.invalid_type,expected:ci.symbol,received:r.parsedType}),Es}return Ad(t.data)}};wj.create=e=>new wj({typeName:As.ZodSymbol,...ia(e)});let Tj=class extends Ra{_parse(t){if(this._getType(t)!==ci.undefined){const r=this._getOrReturnCtx(t);return Wr(r,{code:yr.invalid_type,expected:ci.undefined,received:r.parsedType}),Es}return Ad(t.data)}};Tj.create=e=>new Tj({typeName:As.ZodUndefined,...ia(e)});let Ej=class extends Ra{_parse(t){if(this._getType(t)!==ci.null){const r=this._getOrReturnCtx(t);return Wr(r,{code:yr.invalid_type,expected:ci.null,received:r.parsedType}),Es}return Ad(t.data)}};Ej.create=e=>new Ej({typeName:As.ZodNull,...ia(e)});let Sj=class extends Ra{constructor(){super(...arguments),this._any=!0}_parse(t){return Ad(t.data)}};Sj.create=e=>new Sj({typeName:As.ZodAny,...ia(e)});let Aj=class extends Ra{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Ad(t.data)}};Aj.create=e=>new Aj({typeName:As.ZodUnknown,...ia(e)});let x0=class extends Ra{_parse(t){const n=this._getOrReturnCtx(t);return Wr(n,{code:yr.invalid_type,expected:ci.never,received:n.parsedType}),Es}};x0.create=e=>new x0({typeName:As.ZodNever,...ia(e)});let Cj=class extends Ra{_parse(t){if(this._getType(t)!==ci.undefined){const r=this._getOrReturnCtx(t);return Wr(r,{code:yr.invalid_type,expected:ci.void,received:r.parsedType}),Es}return Ad(t.data)}};Cj.create=e=>new Cj({typeName:As.ZodVoid,...ia(e)});let Qv=class P4 extends Ra{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),a=this._def;if(n.parsedType!==ci.array)return Wr(n,{code:yr.invalid_type,expected:ci.array,received:n.parsedType}),Es;if(a.exactLength!==null){const f=n.data.length>a.exactLength.value,i=n.data.length<a.exactLength.value;(f||i)&&(Wr(n,{code:f?yr.too_big:yr.too_small,minimum:i?a.exactLength.value:void 0,maximum:f?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(Wr(n,{code:yr.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(Wr(n,{code:yr.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((f,i)=>a.type._parseAsync(new v0(n,f,n.path,i)))).then(f=>_h.mergeArray(r,f));const l=[...n.data].map((f,i)=>a.type._parseSync(new v0(n,f,n.path,i)));return _h.mergeArray(r,l)}get element(){return this._def.type}min(t,n){return new P4({...this._def,minLength:{value:t,message:_i.toString(n)}})}max(t,n){return new P4({...this._def,maxLength:{value:t,message:_i.toString(n)}})}length(t,n){return new P4({...this._def,exactLength:{value:t,message:_i.toString(n)}})}nonempty(t){return this.min(1,t)}};Qv.create=(e,t)=>new Qv({type:e,minLength:null,maxLength:null,exactLength:null,typeName:As.ZodArray,...ia(t)});function W1(e){if(e instanceof kp){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=f0.create(W1(r))}return new kp({...e._def,shape:()=>t})}else return e instanceof Qv?new Qv({...e._def,type:W1(e.element)}):e instanceof f0?f0.create(W1(e.unwrap())):e instanceof ex?ex.create(W1(e.unwrap())):e instanceof pT?pT.create(e.items.map(t=>W1(t))):e}let kp=class rh extends Ra{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=La.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==ci.object){const x=this._getOrReturnCtx(t);return Wr(x,{code:yr.invalid_type,expected:ci.object,received:x.parsedType}),Es}const{status:r,ctx:a}=this._processInputParams(t),{shape:l,keys:f}=this._getCached(),i=[];if(!(this._def.catchall instanceof x0&&this._def.unknownKeys==="strip"))for(const x in a.data)f.includes(x)||i.push(x);const y=[];for(const x of f){const S=l[x],C=a.data[x];y.push({key:{status:"valid",value:x},value:S._parse(new v0(a,C,a.path,x)),alwaysSet:x in a.data})}if(this._def.catchall instanceof x0){const x=this._def.unknownKeys;if(x==="passthrough")for(const S of i)y.push({key:{status:"valid",value:S},value:{status:"valid",value:a.data[S]}});else if(x==="strict")i.length>0&&(Wr(a,{code:yr.unrecognized_keys,keys:i}),r.dirty());else if(x!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const x=this._def.catchall;for(const S of i){const C=a.data[S];y.push({key:{status:"valid",value:S},value:x._parse(new v0(a,C,a.path,S)),alwaysSet:S in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const x=[];for(const S of y){const C=await S.key,P=await S.value;x.push({key:C,value:P,alwaysSet:S.alwaysSet})}return x}).then(x=>_h.mergeObjectSync(r,x)):_h.mergeObjectSync(r,y)}get shape(){return this._def.shape()}strict(t){return _i.errToObj,new rh({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,r)=>{var l,f;const a=((f=(l=this._def).errorMap)==null?void 0:f.call(l,n,r).message)??r.defaultError;return n.code==="unrecognized_keys"?{message:_i.errToObj(t).message??a}:{message:a}}}:{}})}strip(){return new rh({...this._def,unknownKeys:"strip"})}passthrough(){return new rh({...this._def,unknownKeys:"passthrough"})}extend(t){return new rh({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new rh({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:As.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new rh({...this._def,catchall:t})}pick(t){const n={};for(const r of La.objectKeys(t))t[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new rh({...this._def,shape:()=>n})}omit(t){const n={};for(const r of La.objectKeys(this.shape))t[r]||(n[r]=this.shape[r]);return new rh({...this._def,shape:()=>n})}deepPartial(){return W1(this)}partial(t){const n={};for(const r of La.objectKeys(this.shape)){const a=this.shape[r];t&&!t[r]?n[r]=a:n[r]=a.optional()}return new rh({...this._def,shape:()=>n})}required(t){const n={};for(const r of La.objectKeys(this.shape))if(t&&!t[r])n[r]=this.shape[r];else{let l=this.shape[r];for(;l instanceof f0;)l=l._def.innerType;n[r]=l}return new rh({...this._def,shape:()=>n})}keyof(){return gX(La.objectKeys(this.shape))}};kp.create=(e,t)=>new kp({shape:()=>e,unknownKeys:"strip",catchall:x0.create(),typeName:As.ZodObject,...ia(t)});kp.strictCreate=(e,t)=>new kp({shape:()=>e,unknownKeys:"strict",catchall:x0.create(),typeName:As.ZodObject,...ia(t)});kp.lazycreate=(e,t)=>new kp({shape:e,unknownKeys:"strip",catchall:x0.create(),typeName:As.ZodObject,...ia(t)});let WA=class extends Ra{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function a(l){for(const i of l)if(i.result.status==="valid")return i.result;for(const i of l)if(i.result.status==="dirty")return n.common.issues.push(...i.ctx.common.issues),i.result;const f=l.map(i=>new T_(i.ctx.common.issues));return Wr(n,{code:yr.invalid_union,unionErrors:f}),Es}if(n.common.async)return Promise.all(r.map(async l=>{const f={...n,common:{...n.common,issues:[]},parent:null};return{result:await l._parseAsync({data:n.data,path:n.path,parent:f}),ctx:f}})).then(a);{let l;const f=[];for(const y of r){const x={...n,common:{...n.common,issues:[]},parent:null},S=y._parseSync({data:n.data,path:n.path,parent:x});if(S.status==="valid")return S;S.status==="dirty"&&!l&&(l={result:S,ctx:x}),x.common.issues.length&&f.push(x.common.issues)}if(l)return n.common.issues.push(...l.ctx.common.issues),l.result;const i=f.map(y=>new T_(y));return Wr(n,{code:yr.invalid_union,unionErrors:i}),Es}}get options(){return this._def.options}};WA.create=(e,t)=>new WA({options:e,typeName:As.ZodUnion,...ia(t)});function CP(e,t){const n=Dm(e),r=Dm(t);if(e===t)return{valid:!0,data:e};if(n===ci.object&&r===ci.object){const a=La.objectKeys(t),l=La.objectKeys(e).filter(i=>a.indexOf(i)!==-1),f={...e,...t};for(const i of l){const y=CP(e[i],t[i]);if(!y.valid)return{valid:!1};f[i]=y.data}return{valid:!0,data:f}}else if(n===ci.array&&r===ci.array){if(e.length!==t.length)return{valid:!1};const a=[];for(let l=0;l<e.length;l++){const f=e[l],i=t[l],y=CP(f,i);if(!y.valid)return{valid:!1};a.push(y.data)}return{valid:!0,data:a}}else return n===ci.date&&r===ci.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}let XA=class extends Ra{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=(l,f)=>{if(_j(l)||_j(f))return Es;const i=CP(l.value,f.value);return i.valid?((yj(l)||yj(f))&&n.dirty(),{status:n.value,value:i.data}):(Wr(r,{code:yr.invalid_intersection_types}),Es)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([l,f])=>a(l,f)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};XA.create=(e,t,n)=>new XA({left:e,right:t,typeName:As.ZodIntersection,...ia(n)});let pT=class mX extends Ra{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==ci.array)return Wr(r,{code:yr.invalid_type,expected:ci.array,received:r.parsedType}),Es;if(r.data.length<this._def.items.length)return Wr(r,{code:yr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Es;!this._def.rest&&r.data.length>this._def.items.length&&(Wr(r,{code:yr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const l=[...r.data].map((f,i)=>{const y=this._def.items[i]||this._def.rest;return y?y._parse(new v0(r,f,r.path,i)):null}).filter(f=>!!f);return r.common.async?Promise.all(l).then(f=>_h.mergeArray(n,f)):_h.mergeArray(n,l)}get items(){return this._def.items}rest(t){return new mX({...this._def,rest:t})}};pT.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new pT({items:e,typeName:As.ZodTuple,rest:null,...ia(t)})};let kj=class extends Ra{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==ci.map)return Wr(r,{code:yr.invalid_type,expected:ci.map,received:r.parsedType}),Es;const a=this._def.keyType,l=this._def.valueType,f=[...r.data.entries()].map(([i,y],x)=>({key:a._parse(new v0(r,i,r.path,[x,"key"])),value:l._parse(new v0(r,y,r.path,[x,"value"]))}));if(r.common.async){const i=new Map;return Promise.resolve().then(async()=>{for(const y of f){const x=await y.key,S=await y.value;if(x.status==="aborted"||S.status==="aborted")return Es;(x.status==="dirty"||S.status==="dirty")&&n.dirty(),i.set(x.value,S.value)}return{status:n.value,value:i}})}else{const i=new Map;for(const y of f){const x=y.key,S=y.value;if(x.status==="aborted"||S.status==="aborted")return Es;(x.status==="dirty"||S.status==="dirty")&&n.dirty(),i.set(x.value,S.value)}return{status:n.value,value:i}}}};kj.create=(e,t,n)=>new kj({valueType:t,keyType:e,typeName:As.ZodMap,...ia(n)});let Ij=class kP extends Ra{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==ci.set)return Wr(r,{code:yr.invalid_type,expected:ci.set,received:r.parsedType}),Es;const a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(Wr(r,{code:yr.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(Wr(r,{code:yr.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());const l=this._def.valueType;function f(y){const x=new Set;for(const S of y){if(S.status==="aborted")return Es;S.status==="dirty"&&n.dirty(),x.add(S.value)}return{status:n.value,value:x}}const i=[...r.data.values()].map((y,x)=>l._parse(new v0(r,y,r.path,x)));return r.common.async?Promise.all(i).then(y=>f(y)):f(i)}min(t,n){return new kP({...this._def,minSize:{value:t,message:_i.toString(n)}})}max(t,n){return new kP({...this._def,maxSize:{value:t,message:_i.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}};Ij.create=(e,t)=>new Ij({valueType:e,minSize:null,maxSize:null,typeName:As.ZodSet,...ia(t)});let Rj=class extends Ra{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}};Rj.create=(e,t)=>new Rj({getter:e,typeName:As.ZodLazy,...ia(t)});let Mj=class extends Ra{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return Wr(n,{received:n.data,code:yr.invalid_literal,expected:this._def.value}),Es}return{status:"valid",value:t.data}}get value(){return this._def.value}};Mj.create=(e,t)=>new Mj({value:e,typeName:As.ZodLiteral,...ia(t)});function gX(e,t){return new $L({values:e,typeName:As.ZodEnum,...ia(t)})}let $L=class IP extends Ra{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return Wr(n,{expected:La.joinValues(r),received:n.parsedType,code:yr.invalid_type}),Es}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const n=this._getOrReturnCtx(t),r=this._def.values;return Wr(n,{received:n.data,code:yr.invalid_enum_value,options:r}),Es}return Ad(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return IP.create(t,{...this._def,...n})}exclude(t,n=this._def){return IP.create(this.options.filter(r=>!t.includes(r)),{...this._def,...n})}};$L.create=gX;let Pj=class extends Ra{_parse(t){const n=La.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==ci.string&&r.parsedType!==ci.number){const a=La.objectValues(n);return Wr(r,{expected:La.joinValues(a),received:r.parsedType,code:yr.invalid_type}),Es}if(this._cache||(this._cache=new Set(La.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const a=La.objectValues(n);return Wr(r,{received:r.data,code:yr.invalid_enum_value,options:a}),Es}return Ad(t.data)}get enum(){return this._def.values}};Pj.create=(e,t)=>new Pj({values:e,typeName:As.ZodNativeEnum,...ia(t)});let YA=class extends Ra{unwrap(){return this._def.type}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==ci.promise&&n.common.async===!1)return Wr(n,{code:yr.invalid_type,expected:ci.promise,received:n.parsedType}),Es;const r=n.parsedType===ci.promise?n.data:Promise.resolve(n.data);return Ad(r.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}};YA.create=(e,t)=>new YA({type:e,typeName:As.ZodPromise,...ia(t)});let Jv=class extends Ra{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===As.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=this._def.effect||null,l={addIssue:f=>{Wr(r,f),f.fatal?n.abort():n.dirty()},get path(){return r.path}};if(l.addIssue=l.addIssue.bind(l),a.type==="preprocess"){const f=a.transform(r.data,l);if(r.common.async)return Promise.resolve(f).then(async i=>{if(n.value==="aborted")return Es;const y=await this._def.schema._parseAsync({data:i,path:r.path,parent:r});return y.status==="aborted"?Es:y.status==="dirty"||n.value==="dirty"?c2(y.value):y});{if(n.value==="aborted")return Es;const i=this._def.schema._parseSync({data:f,path:r.path,parent:r});return i.status==="aborted"?Es:i.status==="dirty"||n.value==="dirty"?c2(i.value):i}}if(a.type==="refinement"){const f=i=>{const y=a.refinement(i,l);if(r.common.async)return Promise.resolve(y);if(y instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?Es:(i.status==="dirty"&&n.dirty(),f(i.value),{status:n.value,value:i.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>i.status==="aborted"?Es:(i.status==="dirty"&&n.dirty(),f(i.value).then(()=>({status:n.value,value:i.value}))))}if(a.type==="transform")if(r.common.async===!1){const f=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Kv(f))return Es;const i=a.transform(f.value,l);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:i}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(f=>Kv(f)?Promise.resolve(a.transform(f.value,l)).then(i=>({status:n.value,value:i})):Es);La.assertNever(a)}};Jv.create=(e,t,n)=>new Jv({schema:e,typeName:As.ZodEffects,effect:t,...ia(n)});Jv.createWithPreprocess=(e,t,n)=>new Jv({schema:t,effect:{type:"preprocess",transform:e},typeName:As.ZodEffects,...ia(n)});let f0=class extends Ra{_parse(t){return this._getType(t)===ci.undefined?Ad(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};f0.create=(e,t)=>new f0({innerType:e,typeName:As.ZodOptional,...ia(t)});let ex=class extends Ra{_parse(t){return this._getType(t)===ci.null?Ad(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};ex.create=(e,t)=>new ex({innerType:e,typeName:As.ZodNullable,...ia(t)});let RP=class extends Ra{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===ci.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};RP.create=(e,t)=>new RP({innerType:e,typeName:As.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...ia(t)});let MP=class extends Ra{_parse(t){const{ctx:n}=this._processInputParams(t),r={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return ZA(a)?a.then(l=>({status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new T_(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new T_(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};MP.create=(e,t)=>new MP({innerType:e,typeName:As.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...ia(t)});let Oj=class extends Ra{_parse(t){if(this._getType(t)!==ci.nan){const r=this._getOrReturnCtx(t);return Wr(r,{code:yr.invalid_type,expected:ci.nan,received:r.parsedType}),Es}return{status:"valid",value:t.data}}};Oj.create=e=>new Oj({typeName:As.ZodNaN,...ia(e)});let rfe=class extends Ra{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}},ife=class _X extends Ra{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const l=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return l.status==="aborted"?Es:l.status==="dirty"?(n.dirty(),c2(l.value)):this._def.out._parseAsync({data:l.value,path:r.path,parent:r})})();{const a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?Es:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(t,n){return new _X({in:t,out:n,typeName:As.ZodPipeline})}},PP=class extends Ra{_parse(t){const n=this._def.innerType._parse(t),r=a=>(Kv(a)&&(a.value=Object.freeze(a.value)),a);return ZA(n)?n.then(a=>r(a)):r(n)}unwrap(){return this._def.innerType}};PP.create=(e,t)=>new PP({innerType:e,typeName:As.ZodReadonly,...ia(t)});var As;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(As||(As={}));const sfe=wP.create,afe=TP.create,ofe=AP.create;x0.create;const lfe=Qv.create,O4=kp.create;WA.create;XA.create;pT.create;$L.create;YA.create;f0.create;ex.create;function ufe(e){let t={};for(let r of e||[])t[r.name]=yX(r);let n=[];for(let r of e||[])r.required!==!1&&n.push(r.name);return{type:"object",properties:t,required:n}}function yX(e){var t,n,r;switch(e.type){case"string":return{type:"string",description:e.description,...e.enum&&{enum:e.enum}};case"number":case"boolean":return{type:e.type,description:e.description};case"object":case"object[]":const a=(t=e.attributes)==null?void 0:t.reduce((f,i)=>(f[i.name]=yX(i),f),{}),l=(n=e.attributes)==null?void 0:n.filter(f=>f.required!==!1).map(f=>f.name);return e.type==="object[]"?{type:"array",items:{type:"object",...a&&{properties:a},...l&&l.length>0&&{required:l}},description:e.description}:{type:"object",description:e.description,...a&&{properties:a},...l&&l.length>0&&{required:l}};default:return(r=e.type)!=null&&r.endsWith("[]")?{type:"array",items:{type:e.type.slice(0,-2)},description:e.description}:{type:"string",description:e.description}}}function OP(e,t){if(e.type==="object"){const n={};if(!e.properties||!Object.keys(e.properties).length)return t?O4(n):O4(n).optional();for(const[a,l]of Object.entries(e.properties))n[a]=OP(l,e.required?e.required.includes(a):!1);let r=O4(n).describe(e.description);return t?r:r.optional()}else if(e.type==="string"){let n=sfe().describe(e.description);return t?n:n.optional()}else if(e.type==="number"){let n=afe().describe(e.description);return t?n:n.optional()}else if(e.type==="boolean"){let n=ofe().describe(e.description);return t?n:n.optional()}else if(e.type==="array"){let n=OP(e.items,!0),r=lfe(n).describe(e.description);return t?r:r.optional()}throw new Error("Invalid JSON schema")}function HL(e){if(!e)return O4({});const t=ufe(e);return OP(t,!0)}const cfe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function dfe(e){return typeof e=="string"&&cfe.test(e)}function hfe(e){if(!dfe(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=t&255,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=t&255,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=t&255,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=t&255,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=t&255,n}var Vl=[];for(var j5=0;j5<256;++j5)Vl.push((j5+256).toString(16).slice(1));function vX(e,t=0){return(Vl[e[t+0]]+Vl[e[t+1]]+Vl[e[t+2]]+Vl[e[t+3]]+"-"+Vl[e[t+4]]+Vl[e[t+5]]+"-"+Vl[e[t+6]]+Vl[e[t+7]]+"-"+Vl[e[t+8]]+Vl[e[t+9]]+"-"+Vl[e[t+10]]+Vl[e[t+11]]+Vl[e[t+12]]+Vl[e[t+13]]+Vl[e[t+14]]+Vl[e[t+15]]).toLowerCase()}var U3,ffe=new Uint8Array(16);function pfe(){if(!U3&&(U3=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!U3))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return U3(ffe)}function mfe(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}var gfe="6ba7b810-9dad-11d1-80b4-00c04fd430c8",_fe="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function yfe(e,t,n){function r(a,l,f,i){var y;if(typeof a=="string"&&(a=mfe(a)),typeof l=="string"&&(l=hfe(l)),((y=l)===null||y===void 0?void 0:y.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var x=new Uint8Array(16+a.length);if(x.set(l),x.set(a,l.length),x=n(x),x[6]=x[6]&15|t,x[8]=x[8]&63|128,f){i=i||0;for(var S=0;S<16;++S)f[i+S]=x[S];return f}return vX(x)}try{r.name=e}catch{}return r.DNS=gfe,r.URL=_fe,r}var vfe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Lj={randomUUID:vfe};function xX(e,t,n){if(Lj.randomUUID&&!e)return Lj.randomUUID();e=e||{};var r=e.random||(e.rng||pfe)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,vX(r)}function xfe(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}}function U5(e,t){return e<<t|e>>>32-t}function bfe(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof e=="string"){var r=unescape(encodeURIComponent(e));e=[];for(var a=0;a<r.length;++a)e.push(r.charCodeAt(a))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var l=e.length/4+2,f=Math.ceil(l/16),i=new Array(f),y=0;y<f;++y){for(var x=new Uint32Array(16),S=0;S<16;++S)x[S]=e[y*64+S*4]<<24|e[y*64+S*4+1]<<16|e[y*64+S*4+2]<<8|e[y*64+S*4+3];i[y]=x}i[f-1][14]=(e.length-1)*8/Math.pow(2,32),i[f-1][14]=Math.floor(i[f-1][14]),i[f-1][15]=(e.length-1)*8&4294967295;for(var C=0;C<f;++C){for(var P=new Uint32Array(80),L=0;L<16;++L)P[L]=i[C][L];for(var F=16;F<80;++F)P[F]=U5(P[F-3]^P[F-8]^P[F-14]^P[F-16],1);for(var U=n[0],q=n[1],G=n[2],$=n[3],X=n[4],ie=0;ie<80;++ie){var de=Math.floor(ie/20),fe=U5(U,5)+xfe(de,q,G,$)+X+t[de]+P[ie]>>>0;X=$,$=G,G=U5(q,30)>>>0,q=U,U=fe}n[0]=n[0]+U>>>0,n[1]=n[1]+q>>>0,n[2]=n[2]+G>>>0,n[3]=n[3]+$>>>0,n[4]=n[4]+X>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,n[0]&255,n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,n[1]&255,n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,n[2]&255,n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,n[3]&255,n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,n[4]&255]}var wfe=yfe("v5",80,bfe);function bX(){return"ck-"+xX()}function wX(){return xX()}function LP(e){if(typeof e=="function")return e.toString();if(Array.isArray(e))return e.map(LP);if(e!==null&&typeof e=="object"){const t={};for(const n of Object.keys(e))t[n]=LP(e[n]);return t}return e}function Dj(e,t){const r="e4b01160-ff74-4c6e-9b27-d53cd930fe8e",a=typeof e=="string"?e:JSON.stringify(LP(e));return wfe(a,r)}var TX="https://api.cloud.copilotkit.ai",Tfe="v1",Efe=`${TX}/copilotkit/${Tfe}`,EX="X-CopilotCloud-Public-Api-Key",DP=function(e,t){return DP=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])},DP(e,t)};function Ax(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");DP(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var lf=function(){return lf=Object.assign||function(t){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(t[l]=n[l])}return t},lf.apply(this,arguments)};function SX(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n}function Sfe(e,t,n,r){function a(l){return l instanceof n?l:new n(function(f){f(l)})}return new(n||(n=Promise))(function(l,f){function i(S){try{x(r.next(S))}catch(C){f(C)}}function y(S){try{x(r.throw(S))}catch(C){f(C)}}function x(S){S.done?l(S.value):a(S.value).then(i,y)}x((r=r.apply(e,t||[])).next())})}function AX(e,t){var n={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},r,a,l,f=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return f.next=i(0),f.throw=i(1),f.return=i(2),typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function i(x){return function(S){return y([x,S])}}function y(x){if(r)throw new TypeError("Generator is already executing.");for(;f&&(f=0,x[0]&&(n=0)),n;)try{if(r=1,a&&(l=x[0]&2?a.return:x[0]?a.throw||((l=a.return)&&l.call(a),0):a.next)&&!(l=l.call(a,x[1])).done)return l;switch(a=0,l&&(x=[x[0]&2,l.value]),x[0]){case 0:case 1:l=x;break;case 4:return n.label++,{value:x[1],done:!1};case 5:n.label++,a=x[1],x=[0];continue;case 7:x=n.ops.pop(),n.trys.pop();continue;default:if(l=n.trys,!(l=l.length>0&&l[l.length-1])&&(x[0]===6||x[0]===2)){n=0;continue}if(x[0]===3&&(!l||x[1]>l[0]&&x[1]<l[3])){n.label=x[1];break}if(x[0]===6&&n.label<l[1]){n.label=l[1],l=x;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(x);break}l[2]&&n.ops.pop(),n.trys.pop();continue}x=t.call(e,n)}catch(S){x=[6,S],a=0}finally{r=l=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function tx(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function NP(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),a,l=[],f;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)l.push(a.value)}catch(i){f={error:i}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(f)throw f.error}}return l}function KA(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,l;r<a;r++)(l||!(r in t))&&(l||(l=Array.prototype.slice.call(t,0,r)),l[r]=t[r]);return e.concat(l||Array.prototype.slice.call(t))}function bv(e){return this instanceof bv?(this.v=e,this):new bv(e)}function Afe(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),a,l=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),i("next"),i("throw"),i("return",f),a[Symbol.asyncIterator]=function(){return this},a;function f(L){return function(F){return Promise.resolve(F).then(L,C)}}function i(L,F){r[L]&&(a[L]=function(U){return new Promise(function(q,G){l.push([L,U,q,G])>1||y(L,U)})},F&&(a[L]=F(a[L])))}function y(L,F){try{x(r[L](F))}catch(U){P(l[0][3],U)}}function x(L){L.value instanceof bv?Promise.resolve(L.value.v).then(S,C):P(l[0][2],L)}function S(L){y("next",L)}function C(L){y("throw",L)}function P(L,F){L(F),l.shift(),l.length&&y(l[0][0],l[0][1])}}function Cfe(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof tx=="function"?tx(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(l){n[l]=e[l]&&function(f){return new Promise(function(i,y){f=e[l](f),a(i,y,f.done,f.value)})}}function a(l,f,i,y){Promise.resolve(y).then(function(x){l({value:x,done:i})},f)}}const kfe="modulepreload",Ife=function(e){return"/"+e},Nj={},KT=function(t,n,r){let a=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),i=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));a=Promise.allSettled(n.map(y=>{if(y=Ife(y),y in Nj)return;Nj[y]=!0;const x=y.endsWith(".css"),S=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${S}`))return;const C=document.createElement("link");if(C.rel=x?"stylesheet":kfe,x||(C.as="script"),C.crossOrigin="",C.href=y,i&&C.setAttribute("nonce",i),document.head.appendChild(C),x)return new Promise((P,L)=>{C.addEventListener("load",P),C.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${y}`)))})}))}function l(f){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=f,window.dispatchEvent(i),!i.defaultPrevented)throw f}return a.then(f=>{for(const i of f||[])i.status==="rejected"&&l(i.reason);return t().catch(l)})};function zj(e){return` \r
	`.indexOf(e)>=0}function CX(e){for(var t=["topLevel"],n=0,r,a,l,f=function($){return t.push($)},i=function($){return t[t.length-1]=$},y=function($){r==null&&(r=n,a=t.length,l=$)},x=function($){$===l&&(r=void 0,a=void 0,l=void 0)},S=function(){return t.pop()},C=function(){return n--},P=function($){if("0"<=$&&$<="9"){f("number");return}switch($){case'"':f("string");return;case"-":f("numberNeedsDigit");return;case"t":f("true");return;case"f":f("false");return;case"n":f("null");return;case"[":f("arrayNeedsValue");return;case"{":f("objectNeedsKey");return}},L=e.length;n<L;n++){var F=e[n];switch(t[t.length-1]){case"topLevel":P(F);break;case"string":switch(F){case'"':S();break;case"\\":y("stringEscape"),f("stringEscaped");break}break;case"stringEscaped":F==="u"?f("stringUnicode"):(x("stringEscape"),S());break;case"stringUnicode":n-e.lastIndexOf("u",n)===4&&(x("stringEscape"),S());break;case"number":F==="."?i("numberNeedsDigit"):F==="e"||F==="E"?i("numberNeedsExponent"):(F<"0"||F>"9")&&(C(),S());break;case"numberNeedsDigit":i("number");break;case"numberNeedsExponent":i(F==="+"||F==="-"?"numberNeedsDigit":"number");break;case"true":case"false":case"null":(F<"a"||F>"z")&&(C(),S());break;case"arrayNeedsValue":F==="]"?S():zj(F)||(x("collectionItem"),i("arrayNeedsComma"),P(F));break;case"arrayNeedsComma":F==="]"?S():F===","&&(y("collectionItem"),i("arrayNeedsValue"));break;case"objectNeedsKey":F==="}"?S():F==='"'&&(y("collectionItem"),i("objectNeedsColon"),f("string"));break;case"objectNeedsColon":F===":"&&i("objectNeedsValue");break;case"objectNeedsValue":zj(F)||(x("collectionItem"),i("objectNeedsComma"),P(F));break;case"objectNeedsComma":F==="}"?S():F===","&&(y("collectionItem"),i("objectNeedsKey"));break}}a!=null&&(t.length=a);for(var U=[r!=null?e.slice(0,r):e],q=function($){return U.push($.slice(e.length-e.lastIndexOf($[0])))},G=t.length-1;G>=0;G--)switch(t[G]){case"string":U.push('"');break;case"numberNeedsDigit":case"numberNeedsExponent":U.push("0");break;case"true":q("true");break;case"false":q("false");break;case"null":q("null");break;case"arrayNeedsValue":case"arrayNeedsComma":U.push("]");break;case"objectNeedsKey":case"objectNeedsColon":case"objectNeedsValue":case"objectNeedsComma":U.push("}");break}return U.join("")}var Rfe=Object.defineProperty,Mfe=Object.defineProperties,Pfe=Object.getOwnPropertyDescriptors,QA=Object.getOwnPropertySymbols,kX=Object.prototype.hasOwnProperty,IX=Object.prototype.propertyIsEnumerable,Fj=(e,t,n)=>t in e?Rfe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ua=(e,t)=>{for(var n in t||(t={}))kX.call(t,n)&&Fj(e,n,t[n]);if(QA)for(var n of QA(t))IX.call(t,n)&&Fj(e,n,t[n]);return e},fl=(e,t)=>Mfe(e,Pfe(t)),V5=e=>typeof e=="symbol"?e:e+"",gp=(e,t)=>{var n={};for(var r in e)kX.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&QA)for(var r of QA(e))t.indexOf(r)<0&&IX.call(e,r)&&(n[r]=e[r]);return n},nx=(e,t,n)=>new Promise((r,a)=>{var l=y=>{try{i(n.next(y))}catch(x){a(x)}},f=y=>{try{i(n.throw(y))}catch(x){a(x)}},i=y=>y.done?r(y.value):Promise.resolve(y.value).then(l,f);i((n=n.apply(e,t)).next())}),Ofe=1e3*60*5,Lfe=class{constructor(){this.activeKey=null,this.intervalId=null,this.instanceCount=0,this.lastResponse=null}start(e,t){return nx(this,null,function*(){if(this.instanceCount++,this.activeKey===e)return;this.intervalId&&clearInterval(this.intervalId);const n=()=>nx(this,null,function*(){try{const a=yield fetch(`${TX}/ciu`,{method:"GET",headers:{[EX]:e}}).then(l=>l.json());return this.lastResponse=a,t==null||t(a),a}catch{return null}}),r=yield n();return this.intervalId=setInterval(n,Ofe),this.activeKey=e,r})}getLastResponse(){return this.lastResponse}stop(){this.instanceCount--,this.instanceCount===0&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null,this.activeKey=null,this.lastResponse=null)}},RX=B.createContext(void 0);function Dfe(e){if(e.severity)switch(e.severity){case e0.CRITICAL:return"critical";case e0.WARNING:return"warning";case e0.INFO:return"info";default:return"info"}const t=e.message.toLowerCase();return t.includes("api key")||t.includes("401")||t.includes("unauthorized")||t.includes("authentication")||t.includes("incorrect api key")?"critical":"info"}function Nfe(e){switch(e){case"critical":return{background:"#fee2e2",border:"#dc2626",text:"#7f1d1d",icon:"#dc2626"};case"warning":return{background:"#fef3c7",border:"#d97706",text:"#78350f",icon:"#d97706"};case"info":return{background:"#dbeafe",border:"#2563eb",text:"#1e3a8a",icon:"#2563eb"}}}function MX(){const e=B.useContext(RX);if(!e)throw new Error("useToast must be used within a ToastProvider");return e}function zfe({enabled:e,children:t}){const[n,r]=B.useState([]),[a,l]=B.useState(null),f=B.useCallback(C=>{r(P=>P.filter(L=>L.id!==C))},[]),i=B.useCallback(C=>{var P;if(!e)return;const L=(P=C.id)!=null?P:Math.random().toString(36).substring(2,9);r(F=>F.find(U=>U.id===L)?F:[...F,fl(Ua({},C),{id:L})]),C.duration&&setTimeout(()=>{f(L)},C.duration)},[e,f]),y=B.useCallback(C=>{!e&&C!==null||l(C)},[e]),x=B.useCallback(C=>{console.warn("addGraphQLErrorsToast is deprecated. All errors now show as banners.")},[]),S={toasts:n,addToast:i,addGraphQLErrorsToast:x,removeToast:f,enabled:e,bannerError:a,setBannerError:y};return k.jsxs(RX.Provider,{value:S,children:[a&&(()=>{const C=Dfe(a),P=Nfe(C);return k.jsx("div",{style:{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",zIndex:9999,backgroundColor:P.background,border:`1px solid ${P.border}`,borderLeft:`4px solid ${P.border}`,borderRadius:"8px",padding:"12px 16px",fontSize:"13px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",backdropFilter:"blur(8px)",maxWidth:"min(90vw, 700px)",width:"100%",boxSizing:"border-box",overflow:"hidden"},children:k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"10px"},children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flex:1,minWidth:0},children:[k.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:P.border,flexShrink:0}}),k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",flex:1,minWidth:0},children:[k.jsx("div",{style:{color:P.text,lineHeight:"1.4",fontWeight:"400",fontSize:"13px",flex:1,wordBreak:"break-all",overflowWrap:"break-word",maxWidth:"550px",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:10,WebkitBoxOrient:"vertical"},children:(()=>{let L=a.message;const F=L.match(/'message':\s*'([^']+)'/);return F?F[1]:(L=L.split(" - ")[0],L=L.split(": Error code")[0],L=L.replace(/:\s*\d{3}$/,""),L=L.replace(/See more:.*$/g,""),L=L.trim(),L||"Configuration error occurred.")})()}),(()=>{const L=a.message,F=/\[([^\]]+)\]\(([^)]+)\)/g,U=/(https?:\/\/[^\s)]+)/g;let q=null,G="See More";const $=F.exec(L);if($)q=$[2],G="See More";else{const X=U.exec(L);X&&(q=X[0].replace(/[.,;:'"]*$/,""),G="See More")}return q?k.jsx("button",{onClick:()=>window.open(q,"_blank","noopener,noreferrer"),style:{background:P.border,color:"white",border:"none",borderRadius:"5px",padding:"4px 10px",fontSize:"11px",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:X=>{X.currentTarget.style.opacity="0.9",X.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:X=>{X.currentTarget.style.opacity="1",X.currentTarget.style.transform="translateY(0)"},children:G}):null})()]})]}),k.jsx("button",{onClick:()=>y(null),style:{background:"transparent",border:"none",color:P.text,cursor:"pointer",padding:"2px",borderRadius:"3px",fontSize:"14px",lineHeight:"1",opacity:.6,transition:"all 0.2s ease",flexShrink:0},title:"Dismiss",onMouseEnter:L=>{L.currentTarget.style.opacity="1",L.currentTarget.style.background="rgba(0, 0, 0, 0.05)"},onMouseLeave:L=>{L.currentTarget.style.opacity="0.6",L.currentTarget.style.background="transparent"},children:""})]})})})(),t]})}function Bj(e){if(e)throw e}var L4=Object.prototype.hasOwnProperty,PX=Object.prototype.toString,jj=Object.defineProperty,Uj=Object.getOwnPropertyDescriptor,Vj=function(t){return typeof Array.isArray=="function"?Array.isArray(t):PX.call(t)==="[object Array]"},$j=function(t){if(!t||PX.call(t)!=="[object Object]")return!1;var n=L4.call(t,"constructor"),r=t.constructor&&t.constructor.prototype&&L4.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!n&&!r)return!1;var a;for(a in t);return typeof a>"u"||L4.call(t,a)},Hj=function(t,n){jj&&n.name==="__proto__"?jj(t,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):t[n.name]=n.newValue},Gj=function(t,n){if(n==="__proto__")if(L4.call(t,n)){if(Uj)return Uj(t,n).value}else return;return t[n]},Ffe=function e(){var t,n,r,a,l,f,i=arguments[0],y=1,x=arguments.length,S=!1;for(typeof i=="boolean"&&(S=i,i=arguments[1]||{},y=2),(i==null||typeof i!="object"&&typeof i!="function")&&(i={});y<x;++y)if(t=arguments[y],t!=null)for(n in t)r=Gj(i,n),a=Gj(t,n),i!==a&&(S&&a&&($j(a)||(l=Vj(a)))?(l?(l=!1,f=r&&Vj(r)?r:[]):f=r&&$j(r)?r:{},Hj(i,{name:n,newValue:e(S,f,a)})):typeof a<"u"&&Hj(i,{name:n,newValue:a}));return i};const $5=UT(Ffe);function zP(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function Bfe(){const e=[],t={run:n,use:r};return t;function n(...a){let l=-1;const f=a.pop();if(typeof f!="function")throw new TypeError("Expected function as last argument, not "+f);i(null,...a);function i(y,...x){const S=e[++l];let C=-1;if(y){f(y);return}for(;++C<a.length;)(x[C]===null||x[C]===void 0)&&(x[C]=a[C]);a=x,S?jfe(S,i)(...x):f(null,...x)}}function r(a){if(typeof a!="function")throw new TypeError("Expected `middelware` to be a function, not "+a);return e.push(a),t}}function jfe(e,t){let n;return r;function r(...f){const i=e.length>f.length;let y;i&&f.push(a);try{y=e.apply(this,f)}catch(x){const S=x;if(i&&n)throw S;return a(S)}i||(y&&y.then&&typeof y.then=="function"?y.then(l,a):y instanceof Error?a(y):l(y))}function a(f,...i){n||(n=!0,t(f,...i))}function l(f){a(null,f)}}const qj=document.createElement("i");function GL(e){const t="&"+e+";";qj.innerHTML=t;const n=qj.textContent;return n.charCodeAt(n.length-1)===59&&e!=="semi"||n===t?!1:n}const Zj=9,Wj=32;function Ufe(e){const t=String(e),n=/\r?\n|\r/g;let r=n.exec(t),a=0;const l=[];for(;r;)l.push(Xj(t.slice(a,r.index),a>0,!0),r[0]),a=r.index+r[0].length,r=n.exec(t);return l.push(Xj(t.slice(a),a>0,!1)),l.join("")}function Xj(e,t,n){let r=0,a=e.length;if(t){let l=e.codePointAt(r);for(;l===Zj||l===Wj;)r++,l=e.codePointAt(r)}if(n){let l=e.codePointAt(a-1);for(;l===Zj||l===Wj;)a--,l=e.codePointAt(a-1)}return a>r?e.slice(r,a):""}function JA(e){const t=String(e||"").trim();return t?t.split(/[ \t\n\r\f]+/g):[]}function OX(e){return e.join(" ").trim()}function eC(e){const t=[],n=String(e||"");let r=n.indexOf(","),a=0,l=!1;for(;!l;){r===-1&&(r=n.length,l=!0);const f=n.slice(a,r).trim();(f||!l)&&t.push(f),a=r+1,r=n.indexOf(",",a)}return t}function LX(e,t){const n=t||{};return(e[e.length-1]===""?[...e,""]:e).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}function DX({severity:e=e0.CRITICAL,message:t="",onClose:n,actions:r}){if(!t||!e)return null;const l={[e0.INFO]:{bg:"#f8fafc",border:"#e2e8f0",text:"#475569",accent:"#3b82f6"},[e0.WARNING]:{bg:"#fffbeb",border:"#fbbf24",text:"#92400e",accent:"#f59e0b"},[e0.CRITICAL]:{bg:"#fef2f2",border:"#fecaca",text:"#dc2626",accent:"#ef4444"}}[e];return k.jsxs(k.Fragment,{children:[k.jsx("style",{children:`
          @keyframes slideUp {
            from { opacity: 0; transform: translateX(-50%) translateY(8px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
          }
          
          .usage-banner {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            width: min(600px, calc(100vw - 32px));
            z-index: 10000;
            animation: slideUp 0.2s cubic-bezier(0.16, 1, 0.3, 1);
          }
          
          .banner-content {
            background: linear-gradient(135deg, ${l.bg} 0%, ${l.bg}f5 100%);
            border: 1px solid ${l.border};
            border-radius: 12px;
            padding: 18px 20px;
            box-shadow: 
              0 4px 24px rgba(0, 0, 0, 0.08),
              0 2px 8px rgba(0, 0, 0, 0.04),
              inset 0 1px 0 rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            gap: 16px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            backdrop-filter: blur(12px);
            position: relative;
            overflow: hidden;
          }
          
          .banner-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, ${l.accent}40, transparent);
          }
          
          .banner-message {
            color: ${l.text};
            font-size: 14px;
            line-height: 1.5;
            font-weight: 500;
            flex: 1;
            letter-spacing: -0.01em;
          }
          
          .close-btn {
            background: rgba(0, 0, 0, 0.05);
            border: none;
            color: ${l.text};
            cursor: pointer;
            padding: 0;
            border-radius: 6px;
            opacity: 0.6;
            transition: all 0.15s cubic-bezier(0.16, 1, 0.3, 1);
            font-size: 14px;
            line-height: 1;
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
          }
          
          .close-btn:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.08);
            transform: scale(1.05);
          }
          
          .btn-primary {
            background: linear-gradient(135deg, ${l.accent} 0%, ${l.accent}e6 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 18px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s cubic-bezier(0.16, 1, 0.3, 1);
            font-family: inherit;
            flex-shrink: 0;
            box-shadow: 
              0 2px 8px ${l.accent}30,
              inset 0 1px 0 rgba(255, 255, 255, 0.2);
            letter-spacing: -0.01em;
          }
          
          .btn-primary:hover {
            transform: translateY(-1px) scale(1.02);
            box-shadow: 
              0 4px 12px ${l.accent}40,
              inset 0 1px 0 rgba(255, 255, 255, 0.25);
          }
          
          .btn-primary:active {
            transform: translateY(0) scale(0.98);
            transition: all 0.08s cubic-bezier(0.16, 1, 0.3, 1);
          }
          
          @media (max-width: 640px) {
            .usage-banner {
              width: calc(100vw - 24px);
            }
            
            .banner-content {
              padding: 16px;
              gap: 12px;
            }
            
            .banner-message {
              font-size: 13px;
              line-height: 1.45;
            }
            
            .btn-primary {
              padding: 8px 14px;
              font-size: 12px;
            }
            
            .close-btn {
              width: 22px;
              height: 22px;
              font-size: 12px;
            }
          }
        `}),k.jsx("div",{className:"usage-banner",children:k.jsxs("div",{className:"banner-content",children:[k.jsx("div",{className:"banner-message",children:t}),(r==null?void 0:r.primary)&&k.jsx("button",{className:"btn-primary",onClick:r.primary.onClick,children:r.primary.label}),n&&k.jsx("button",{className:"close-btn",onClick:n,title:"Close",children:""})]})})]})}var NX=e=>{switch(e.code){case Yv.MISSING_PUBLIC_API_KEY_ERROR:return{primary:{label:"Show me how",onClick:()=>window.open("https://docs.copilotkit.ai/premium#how-do-i-get-access-to-premium-features","_blank","noopener,noreferrer")}};case Yv.UPGRADE_REQUIRED_ERROR:return{primary:{label:"Upgrade",onClick:()=>window.open("https://cloud.copilotkit.ai","_blank","noopener,noreferrer")}};default:return}},Yj=new Lfe,Vfe=class extends cs.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidMount(){this.props.publicApiKey&&Yj.start(this.props.publicApiKey,e=>{this.setState(t=>{var n;return(e==null?void 0:e.severity)!==((n=t.status)==null?void 0:n.severity)?{status:e??void 0}:null})})}componentWillUnmount(){Yj.stop()}componentDidCatch(e,t){console.error("CopilotKit Error:",e,t)}render(){var e,t,n,r;if(this.state.hasError){if(this.state.error instanceof vp)return k.jsxs(k.Fragment,{children:[this.props.children,this.props.showUsageBanner&&k.jsx(DX,{severity:(t=(e=this.state.status)==null?void 0:e.severity)!=null?t:this.state.error.severity,message:(r=(n=this.state.status)==null?void 0:n.message)!=null?r:this.state.error.message,actions:NX(this.state.error)})]});throw this.state.error}return this.props.children}};function $fe(){return typeof window>"u"?!1:window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname==="0.0.0.0"}function mT(e){return e!==void 0?e:$fe()}var zX={actions:{},setAction:()=>{},removeAction:()=>{},setRegisteredActions:()=>"",removeRegisteredAction:()=>{},chatComponentsCache:{current:{actions:{},coAgentStateRenders:{}}},getContextString:(e,t)=>zg(),addContext:()=>"",removeContext:()=>{},getAllContext:()=>[],getFunctionCallHandler:()=>zg(),isLoading:!1,setIsLoading:()=>zg(),chatInstructions:"",setChatInstructions:()=>zg(),additionalInstructions:[],setAdditionalInstructions:()=>zg(),getDocumentsContext:e=>zg(),addDocumentContext:()=>zg(),removeDocumentContext:()=>{},copilotApiConfig:new class{get chatApiEndpoint(){throw new Error("Remember to wrap your app in a `<CopilotKit> {...} </CopilotKit>` !!!")}get headers(){return{}}get body(){return{}}},chatSuggestionConfiguration:{},addChatSuggestionConfiguration:()=>{},removeChatSuggestionConfiguration:()=>{},showDevConsole:!1,coagentStates:{},setCoagentStates:()=>{},coagentStatesRef:{current:{}},setCoagentStatesWithRef:()=>{},agentSession:null,setAgentSession:()=>{},forwardedParameters:{},agentLock:null,threadId:"",setThreadId:()=>{},runId:null,setRunId:()=>{},chatAbortControllerRef:{current:null},availableAgents:[],extensions:{},setExtensions:()=>{},interruptActions:{},setInterruptAction:()=>{},removeInterruptAction:()=>{},interruptEventQueue:{},addInterruptEvent:()=>{},resolveInterruptEvent:()=>{},onError:()=>{},bannerError:null,setBannerError:()=>{},internalErrorHandlers:{},setInternalErrorHandler:()=>{},removeInternalErrorHandler:()=>{}},FX=cs.createContext(zX);function Hfe(){const e=cs.useContext(FX);if(e===zX)throw new Error("Remember to wrap your app in a `<CopilotKit> {...} </CopilotKit>` !!!");return e}function zg(e){throw new Error("Remember to wrap your app in a `<CopilotKit> {...} </CopilotKit>` !!!")}var Gfe={messages:[],setMessages:()=>[],suggestions:[],setSuggestions:()=>[]},qfe=cs.createContext(Gfe),BX=B.createContext(null);function Zfe(){const e=B.useContext(BX);if(!e)throw new Error("useMessagesTap must be used inside <MessagesTapProvider>");return e}function Wfe({children:e}){const t=B.useRef([]),n=B.useRef({getMessagesFromTap:()=>t.current,updateTapMessages:r=>{t.current=r}});return k.jsx(BX.Provider,{value:n.current,children:e})}function Xfe({children:e}){const[t,n]=B.useState([]);B.useRef(void 0),B.useRef(void 0),B.useRef(void 0);const{updateTapMessages:r}=Zfe(),{threadId:a,agentSession:l,showDevConsole:f,onError:i,copilotApiConfig:y}=Hfe(),{setBannerError:x}=MX(),S=B.useCallback((U,q)=>nx(this,null,function*(){if(!(!i||!y.publicApiKey))try{const G={type:"error",timestamp:Date.now(),context:{source:"ui",request:{operation:"loadAgentState",url:y.chatApiEndpoint,startTime:Date.now()},technical:{environment:"browser",userAgent:typeof navigator<"u"?navigator.userAgent:void 0,stackTrace:q instanceof Error?q.stack:void 0}},error:U};yield i(G)}catch(G){console.error("Error in CopilotMessages onError handler:",G)}}),[i,y.publicApiKey,y.chatApiEndpoint]),C=U=>{const q=U.extensions,G=q==null?void 0:q.originalError;if(G!=null&&G.stack){if(G.stack.includes("CopilotApiDiscoveryError"))return new lX({message:G.message});if(G.stack.includes("CopilotKitRemoteEndpointDiscoveryError"))return new Che({message:G.message});if(G.stack.includes("CopilotKitAgentDiscoveryError"))return new khe({agentName:"",availableAgents:[]})}const $=(G==null?void 0:G.message)||U.message,X=q==null?void 0:q.code;return X?new vp({message:$,code:X}):null};B.useCallback(U=>{var q;if((q=U.graphQLErrors)!=null&&q.length){const G=U.graphQLErrors,$=X=>{const ie=X.extensions,de=ie==null?void 0:ie.visibility;if(!mT(f)){console.error("CopilotKit Error (hidden in production):",X.message);return}if(de===oX.SILENT){console.error("CopilotKit Silent Error:",X.message);return}const be=C(X);if(be)x(be),S(be,X);else{const ve=new vp({message:X.message,code:Yv.UNKNOWN});x(ve),S(ve,X)}};G.forEach($)}else if(!mT(f))console.error("CopilotKit Error (hidden in production):",U);else{const $=new vp({message:(U==null?void 0:U.message)||String(U),code:Yv.UNKNOWN});x($),S($,U)}},[x,f,S]),B.useEffect(()=>{r(t)},[t,r]);const P=B.useMemo(()=>e,[e]),[L,F]=B.useState([]);return k.jsx(qfe.Provider,{value:{messages:t,setMessages:n,suggestions:L,setSuggestions:F},children:P})}var jX=(e,t)=>e.reduce((n,r)=>{if(r.id!==t){const a=fl(Ua({},r),{children:jX(r.children,t)});n.push(a)}return n},[]),UX=(e,t,n)=>n?e.map(r=>r.id===n?fl(Ua({},r),{children:[...r.children,t]}):r.children.length?fl(Ua({},r),{children:UX(r.children,t,n)}):r):[...e,t],VX=(e,t)=>t===0?(e+1).toString():t===1?String.fromCharCode(65+e):t===2?String.fromCharCode(97+e):"-",$X=(e,t="",n=0)=>{const r=" ".repeat(3).repeat(n),a=t.length+r.length,l=" ".repeat(a),f=e.value.split(`
`),i=`${r}${t}${f[0]}`,y=f.slice(1).map(C=>`${l}${C}`).join(`
`);let x=`${i}
`;y&&(x+=`${y}
`);const S=" ".repeat(t.length);return e.children.forEach((C,P)=>x+=$X(C,`${S}${VX(P,n+1)}. `,n+1)),x};function Yfe(e,t){switch(t.type){case"ADD_NODE":{const{value:n,parentId:r,id:a}=t,l={id:a,value:n,children:[],categories:new Set(t.categories)};try{return UX(e,l,r)}catch(f){return console.error(`Error while adding node with id ${a}: ${f}`),e}}case"REMOVE_NODE":return jX(e,t.id);default:return e}}var Kfe=()=>{const[e,t]=B.useReducer(Yfe,[]),n=B.useCallback((f,i,y)=>{const x=bX();return t({type:"ADD_NODE",value:f,parentId:y,id:x,categories:i}),x},[]),r=B.useCallback(f=>{t({type:"REMOVE_NODE",id:f})},[]),a=B.useCallback(()=>e,[e]),l=B.useCallback(f=>{const i=new Set(f);let y="";return e.forEach((x,S)=>{Jfe(i,x.categories)&&(S!==0&&(y+=`
`),y+=$X(x,`${VX(S,0)}. `))}),y},[e]);return{tree:e,addElement:n,printTree:l,removeElement:r,getAllElements:a}},Qfe=Kfe;function Jfe(e,t){const[n,r]=e.size<=t.size?[e,t]:[t,e];for(let a of n)if(r.has(a))return!0;return!1}var epe=()=>{const[e,t]=B.useReducer(npe,new Map),n=B.useCallback((l,f)=>{const i=bX();return t({type:"ADD_ELEMENT",value:l,id:i,categories:f}),i},[]),r=B.useCallback(l=>{t({type:"REMOVE_ELEMENT",id:l})},[]),a=B.useCallback(l=>{const f=new Set(l),i=[];return e.forEach(y=>{rpe(f,y.categories)&&i.push(y.value)}),i},[e]);return{addElement:n,removeElement:r,allElements:a}},tpe=epe;function npe(e,t){switch(t.type){case"ADD_ELEMENT":{const{value:n,id:r,categories:a}=t,l={id:r,value:n,categories:new Set(a)},f=new Map(e);return f.set(r,l),f}case"REMOVE_ELEMENT":{const n=new Map(e);return n.delete(t.id),n}default:return e}}function rpe(e,t){const[n,r]=e.size<=t.size?[e,t]:[t,e];for(let a of n)if(r.has(a))return!0;return!1}var HX=B.createContext(void 0);function ipe({children:e}){const[t,n]=B.useState({}),r=B.useCallback((f,i)=>{n(y=>fl(Ua({},y),{[f]:i}))},[]),a=B.useCallback(f=>{n(i=>{const y=Ua({},i);return delete y[f],y})},[]),l=B.useRef({});return k.jsx(HX.Provider,{value:{coAgentStateRenders:t,setCoAgentStateRender:r,removeCoAgentStateRender:a,claimsRef:l},children:e})}function spe(){const e=B.useContext(HX);if(!e)throw new Error("useCoAgentStateRenders must be used within CoAgentStateRendersProvider");return e}var Ea;(function(e){e.assertEqual=a=>{};function t(a){}e.assertIs=t;function n(a){throw new Error}e.assertNever=n,e.arrayToEnum=a=>{const l={};for(const f of a)l[f]=f;return l},e.getValidEnumValues=a=>{const l=e.objectKeys(a).filter(i=>typeof a[a[i]]!="number"),f={};for(const i of l)f[i]=a[i];return e.objectValues(f)},e.objectValues=a=>e.objectKeys(a).map(function(l){return a[l]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const l=[];for(const f in a)Object.prototype.hasOwnProperty.call(a,f)&&l.push(f);return l},e.find=(a,l)=>{for(const f of a)if(l(f))return f},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,l=" | "){return a.map(f=>typeof f=="string"?`'${f}'`:f).join(l)}e.joinValues=r,e.jsonStringifyReplacer=(a,l)=>typeof l=="bigint"?l.toString():l})(Ea||(Ea={}));var Kj;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(Kj||(Kj={}));const si=Ea.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Nm=e=>{switch(typeof e){case"undefined":return si.undefined;case"string":return si.string;case"number":return Number.isNaN(e)?si.nan:si.number;case"boolean":return si.boolean;case"function":return si.function;case"bigint":return si.bigint;case"symbol":return si.symbol;case"object":return Array.isArray(e)?si.array:e===null?si.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?si.promise:typeof Map<"u"&&e instanceof Map?si.map:typeof Set<"u"&&e instanceof Set?si.set:typeof Date<"u"&&e instanceof Date?si.date:si.object;default:return si.unknown}},or=Ea.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);let E_=class GX extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(l){return l.message},r={_errors:[]},a=l=>{for(const f of l.issues)if(f.code==="invalid_union")f.unionErrors.map(a);else if(f.code==="invalid_return_type")a(f.returnTypeError);else if(f.code==="invalid_arguments")a(f.argumentsError);else if(f.path.length===0)r._errors.push(n(f));else{let i=r,y=0;for(;y<f.path.length;){const x=f.path[y];y===f.path.length-1?(i[x]=i[x]||{_errors:[]},i[x]._errors.push(n(f))):i[x]=i[x]||{_errors:[]},i=i[x],y++}}};return a(this),r}static assert(t){if(!(t instanceof GX))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ea.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const a of this.issues)if(a.path.length>0){const l=a.path[0];n[l]=n[l]||[],n[l].push(t(a))}else r.push(t(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}};E_.create=e=>new E_(e);const FP=(e,t)=>{let n;switch(e.code){case or.invalid_type:e.received===si.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case or.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,Ea.jsonStringifyReplacer)}`;break;case or.unrecognized_keys:n=`Unrecognized key(s) in object: ${Ea.joinValues(e.keys,", ")}`;break;case or.invalid_union:n="Invalid input";break;case or.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Ea.joinValues(e.options)}`;break;case or.invalid_enum_value:n=`Invalid enum value. Expected ${Ea.joinValues(e.options)}, received '${e.received}'`;break;case or.invalid_arguments:n="Invalid function arguments";break;case or.invalid_return_type:n="Invalid function return type";break;case or.invalid_date:n="Invalid date";break;case or.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:Ea.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case or.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case or.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case or.custom:n="Invalid input";break;case or.invalid_intersection_types:n="Intersection results could not be merged";break;case or.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case or.not_finite:n="Number must be finite";break;default:n=t.defaultError,Ea.assertNever(e)}return{message:n}};let ape=FP;function ope(){return ape}const lpe=e=>{const{data:t,path:n,errorMaps:r,issueData:a}=e,l=[...n,...a.path||[]],f={...a,path:l};if(a.message!==void 0)return{...a,path:l,message:a.message};let i="";const y=r.filter(x=>!!x).slice().reverse();for(const x of y)i=x(f,{data:t,defaultError:i}).message;return{...a,path:l,message:i}};function Br(e,t){const n=ope(),r=lpe({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===FP?void 0:FP].filter(a=>!!a)});e.common.issues.push(r)}let Vc=class qX{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const a of n){if(a.status==="aborted")return us;a.status==="dirty"&&t.dirty(),r.push(a.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const a of n){const l=await a.key,f=await a.value;r.push({key:l,value:f})}return qX.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const a of n){const{key:l,value:f}=a;if(l.status==="aborted"||f.status==="aborted")return us;l.status==="dirty"&&t.dirty(),f.status==="dirty"&&t.dirty(),l.value!=="__proto__"&&(typeof f.value<"u"||a.alwaysSet)&&(r[l.value]=f.value)}return{status:t.value,value:r}}};const us=Object.freeze({status:"aborted"}),h2=e=>({status:"dirty",value:e}),Cd=e=>({status:"valid",value:e}),Qj=e=>e.status==="aborted",Jj=e=>e.status==="dirty",rx=e=>e.status==="valid",tC=e=>typeof Promise<"u"&&e instanceof Promise;var yi;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(yi||(yi={}));let vf=class{constructor(t,n,r,a){this._cachedPath=[],this.parent=t,this.data=n,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};const eU=(e,t)=>{if(rx(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new E_(e.common.issues);return this._error=n,this._error}}};function $s(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:a}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(f,i)=>{const{message:y}=e;return f.code==="invalid_enum_value"?{message:y??i.defaultError}:typeof i.data>"u"?{message:y??r??i.defaultError}:f.code!=="invalid_type"?{message:i.defaultError}:{message:y??n??i.defaultError}},description:a}}let ma=class{get description(){return this._def.description}_getType(t){return Nm(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:Nm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Vc,ctx:{common:t.parent.common,data:t.data,parsedType:Nm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(tC(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){const r={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Nm(t)},a=this._parseSync({data:t,path:r.path,parent:r});return eU(r,a)}"~validate"(t){var r,a;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Nm(t)};if(!this["~standard"].async)try{const l=this._parseSync({data:t,path:[],parent:n});return rx(l)?{value:l.value}:{issues:n.common.issues}}catch(l){(a=(r=l==null?void 0:l.message)==null?void 0:r.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:n}).then(l=>rx(l)?{value:l.value}:{issues:n.common.issues})}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Nm(t)},a=this._parse({data:t,path:r.path,parent:r}),l=await(tC(a)?a:Promise.resolve(a));return eU(r,l)}refine(t,n){const r=a=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,l)=>{const f=t(a),i=()=>l.addIssue({code:or.custom,...r(a)});return typeof Promise<"u"&&f instanceof Promise?f.then(y=>y?!0:(i(),!1)):f?!0:(i(),!1)})}refinement(t,n){return this._refinement((r,a)=>t(r)?!0:(a.addIssue(typeof n=="function"?n(r,a):n),!1))}_refinement(t){return new S_({schema:this,typeName:ds.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return xp.create(this,this._def)}nullable(){return A_.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ix.create(this)}promise(){return lC.create(this,this._def)}or(t){return rC.create([this,t],this._def)}and(t){return iC.create(this,t,this._def)}transform(t){return new S_({...$s(this._def),schema:this,typeName:ds.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new uC({...$s(this._def),innerType:this,defaultValue:n,typeName:ds.ZodDefault})}brand(){return new JX({typeName:ds.ZodBranded,type:this,...$s(this._def)})}catch(t){const n=typeof t=="function"?t:()=>t;return new cC({...$s(this._def),innerType:this,catchValue:n,typeName:ds.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return Ppe.create(this,t)}readonly(){return dC.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const upe=/^c[^\s-]{8,}$/i,cpe=/^[0-9a-z]+$/,dpe=/^[0-9A-HJKMNP-TV-Z]{26}$/i,hpe=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,fpe=/^[a-z0-9_-]{21}$/i,ppe=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,mpe=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,gpe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,_pe="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let H5;const ype=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,vpe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,xpe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,bpe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,wpe=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Tpe=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ZX="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Epe=new RegExp(`^${ZX}$`);function WX(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function Spe(e){return new RegExp(`^${WX(e)}$`)}function Ape(e){let t=`${ZX}T${WX(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function Cpe(e,t){return!!((t==="v4"||!t)&&ype.test(e)||(t==="v6"||!t)&&xpe.test(e))}function kpe(e,t){if(!ppe.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||t&&a.alg!==t)}catch{return!1}}function Ipe(e,t){return!!((t==="v4"||!t)&&vpe.test(e)||(t==="v6"||!t)&&bpe.test(e))}let nC=class f2 extends ma{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==si.string){const l=this._getOrReturnCtx(t);return Br(l,{code:or.invalid_type,expected:si.string,received:l.parsedType}),us}const r=new Vc;let a;for(const l of this._def.checks)if(l.kind==="min")t.data.length<l.value&&(a=this._getOrReturnCtx(t,a),Br(a,{code:or.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),r.dirty());else if(l.kind==="max")t.data.length>l.value&&(a=this._getOrReturnCtx(t,a),Br(a,{code:or.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),r.dirty());else if(l.kind==="length"){const f=t.data.length>l.value,i=t.data.length<l.value;(f||i)&&(a=this._getOrReturnCtx(t,a),f?Br(a,{code:or.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):i&&Br(a,{code:or.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),r.dirty())}else if(l.kind==="email")gpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"email",code:or.invalid_string,message:l.message}),r.dirty());else if(l.kind==="emoji")H5||(H5=new RegExp(_pe,"u")),H5.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"emoji",code:or.invalid_string,message:l.message}),r.dirty());else if(l.kind==="uuid")hpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"uuid",code:or.invalid_string,message:l.message}),r.dirty());else if(l.kind==="nanoid")fpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"nanoid",code:or.invalid_string,message:l.message}),r.dirty());else if(l.kind==="cuid")upe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"cuid",code:or.invalid_string,message:l.message}),r.dirty());else if(l.kind==="cuid2")cpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"cuid2",code:or.invalid_string,message:l.message}),r.dirty());else if(l.kind==="ulid")dpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"ulid",code:or.invalid_string,message:l.message}),r.dirty());else if(l.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),Br(a,{validation:"url",code:or.invalid_string,message:l.message}),r.dirty()}else l.kind==="regex"?(l.regex.lastIndex=0,l.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"regex",code:or.invalid_string,message:l.message}),r.dirty())):l.kind==="trim"?t.data=t.data.trim():l.kind==="includes"?t.data.includes(l.value,l.position)||(a=this._getOrReturnCtx(t,a),Br(a,{code:or.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),r.dirty()):l.kind==="toLowerCase"?t.data=t.data.toLowerCase():l.kind==="toUpperCase"?t.data=t.data.toUpperCase():l.kind==="startsWith"?t.data.startsWith(l.value)||(a=this._getOrReturnCtx(t,a),Br(a,{code:or.invalid_string,validation:{startsWith:l.value},message:l.message}),r.dirty()):l.kind==="endsWith"?t.data.endsWith(l.value)||(a=this._getOrReturnCtx(t,a),Br(a,{code:or.invalid_string,validation:{endsWith:l.value},message:l.message}),r.dirty()):l.kind==="datetime"?Ape(l).test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{code:or.invalid_string,validation:"datetime",message:l.message}),r.dirty()):l.kind==="date"?Epe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{code:or.invalid_string,validation:"date",message:l.message}),r.dirty()):l.kind==="time"?Spe(l).test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{code:or.invalid_string,validation:"time",message:l.message}),r.dirty()):l.kind==="duration"?mpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"duration",code:or.invalid_string,message:l.message}),r.dirty()):l.kind==="ip"?Cpe(t.data,l.version)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"ip",code:or.invalid_string,message:l.message}),r.dirty()):l.kind==="jwt"?kpe(t.data,l.alg)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"jwt",code:or.invalid_string,message:l.message}),r.dirty()):l.kind==="cidr"?Ipe(t.data,l.version)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"cidr",code:or.invalid_string,message:l.message}),r.dirty()):l.kind==="base64"?wpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"base64",code:or.invalid_string,message:l.message}),r.dirty()):l.kind==="base64url"?Tpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"base64url",code:or.invalid_string,message:l.message}),r.dirty()):Ea.assertNever(l);return{status:r.value,value:t.data}}_regex(t,n,r){return this.refinement(a=>t.test(a),{validation:n,code:or.invalid_string,...yi.errToObj(r)})}_addCheck(t){return new f2({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...yi.errToObj(t)})}url(t){return this._addCheck({kind:"url",...yi.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...yi.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...yi.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...yi.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...yi.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...yi.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...yi.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...yi.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...yi.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...yi.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...yi.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...yi.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...yi.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...yi.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...yi.errToObj(t)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...yi.errToObj(n)})}includes(t,n){return this._addCheck({kind:"includes",value:t,position:n==null?void 0:n.position,...yi.errToObj(n==null?void 0:n.message)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...yi.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...yi.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...yi.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...yi.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...yi.errToObj(n)})}nonempty(t){return this.min(1,yi.errToObj(t))}trim(){return new f2({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new f2({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new f2({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}};nC.create=e=>new nC({checks:[],typeName:ds.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...$s(e)});function Rpe(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,a=n>r?n:r,l=Number.parseInt(e.toFixed(a).replace(".","")),f=Number.parseInt(t.toFixed(a).replace(".",""));return l%f/10**a}let BP=class jP extends ma{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==si.number){const l=this._getOrReturnCtx(t);return Br(l,{code:or.invalid_type,expected:si.number,received:l.parsedType}),us}let r;const a=new Vc;for(const l of this._def.checks)l.kind==="int"?Ea.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),Br(r,{code:or.invalid_type,expected:"integer",received:"float",message:l.message}),a.dirty()):l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(r=this._getOrReturnCtx(t,r),Br(r,{code:or.too_small,minimum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),a.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(r=this._getOrReturnCtx(t,r),Br(r,{code:or.too_big,maximum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),a.dirty()):l.kind==="multipleOf"?Rpe(t.data,l.value)!==0&&(r=this._getOrReturnCtx(t,r),Br(r,{code:or.not_multiple_of,multipleOf:l.value,message:l.message}),a.dirty()):l.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),Br(r,{code:or.not_finite,message:l.message}),a.dirty()):Ea.assertNever(l);return{status:a.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,yi.toString(n))}gt(t,n){return this.setLimit("min",t,!1,yi.toString(n))}lte(t,n){return this.setLimit("max",t,!0,yi.toString(n))}lt(t,n){return this.setLimit("max",t,!1,yi.toString(n))}setLimit(t,n,r,a){return new jP({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:yi.toString(a)}]})}_addCheck(t){return new jP({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:yi.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:yi.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:yi.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:yi.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:yi.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:yi.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:yi.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:yi.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:yi.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Ea.isInteger(t.value))}get isFinite(){let t=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(n)&&Number.isFinite(t)}};BP.create=e=>new BP({checks:[],typeName:ds.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...$s(e)});let tU=class UP extends ma{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==si.bigint)return this._getInvalidInput(t);let r;const a=new Vc;for(const l of this._def.checks)l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(r=this._getOrReturnCtx(t,r),Br(r,{code:or.too_small,type:"bigint",minimum:l.value,inclusive:l.inclusive,message:l.message}),a.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(r=this._getOrReturnCtx(t,r),Br(r,{code:or.too_big,type:"bigint",maximum:l.value,inclusive:l.inclusive,message:l.message}),a.dirty()):l.kind==="multipleOf"?t.data%l.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),Br(r,{code:or.not_multiple_of,multipleOf:l.value,message:l.message}),a.dirty()):Ea.assertNever(l);return{status:a.value,value:t.data}}_getInvalidInput(t){const n=this._getOrReturnCtx(t);return Br(n,{code:or.invalid_type,expected:si.bigint,received:n.parsedType}),us}gte(t,n){return this.setLimit("min",t,!0,yi.toString(n))}gt(t,n){return this.setLimit("min",t,!1,yi.toString(n))}lte(t,n){return this.setLimit("max",t,!0,yi.toString(n))}lt(t,n){return this.setLimit("max",t,!1,yi.toString(n))}setLimit(t,n,r,a){return new UP({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:yi.toString(a)}]})}_addCheck(t){return new UP({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:yi.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:yi.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:yi.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:yi.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:yi.toString(n)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}};tU.create=e=>new tU({checks:[],typeName:ds.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...$s(e)});let VP=class extends ma{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==si.boolean){const r=this._getOrReturnCtx(t);return Br(r,{code:or.invalid_type,expected:si.boolean,received:r.parsedType}),us}return Cd(t.data)}};VP.create=e=>new VP({typeName:ds.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...$s(e)});let nU=class XX extends ma{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==si.date){const l=this._getOrReturnCtx(t);return Br(l,{code:or.invalid_type,expected:si.date,received:l.parsedType}),us}if(Number.isNaN(t.data.getTime())){const l=this._getOrReturnCtx(t);return Br(l,{code:or.invalid_date}),us}const r=new Vc;let a;for(const l of this._def.checks)l.kind==="min"?t.data.getTime()<l.value&&(a=this._getOrReturnCtx(t,a),Br(a,{code:or.too_small,message:l.message,inclusive:!0,exact:!1,minimum:l.value,type:"date"}),r.dirty()):l.kind==="max"?t.data.getTime()>l.value&&(a=this._getOrReturnCtx(t,a),Br(a,{code:or.too_big,message:l.message,inclusive:!0,exact:!1,maximum:l.value,type:"date"}),r.dirty()):Ea.assertNever(l);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new XX({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:yi.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:yi.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}};nU.create=e=>new nU({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:ds.ZodDate,...$s(e)});let rU=class extends ma{_parse(t){if(this._getType(t)!==si.symbol){const r=this._getOrReturnCtx(t);return Br(r,{code:or.invalid_type,expected:si.symbol,received:r.parsedType}),us}return Cd(t.data)}};rU.create=e=>new rU({typeName:ds.ZodSymbol,...$s(e)});let $P=class extends ma{_parse(t){if(this._getType(t)!==si.undefined){const r=this._getOrReturnCtx(t);return Br(r,{code:or.invalid_type,expected:si.undefined,received:r.parsedType}),us}return Cd(t.data)}};$P.create=e=>new $P({typeName:ds.ZodUndefined,...$s(e)});let HP=class extends ma{_parse(t){if(this._getType(t)!==si.null){const r=this._getOrReturnCtx(t);return Br(r,{code:or.invalid_type,expected:si.null,received:r.parsedType}),us}return Cd(t.data)}};HP.create=e=>new HP({typeName:ds.ZodNull,...$s(e)});let GP=class extends ma{constructor(){super(...arguments),this._any=!0}_parse(t){return Cd(t.data)}};GP.create=e=>new GP({typeName:ds.ZodAny,...$s(e)});let iU=class extends ma{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Cd(t.data)}};iU.create=e=>new iU({typeName:ds.ZodUnknown,...$s(e)});let b0=class extends ma{_parse(t){const n=this._getOrReturnCtx(t);return Br(n,{code:or.invalid_type,expected:si.never,received:n.parsedType}),us}};b0.create=e=>new b0({typeName:ds.ZodNever,...$s(e)});let sU=class extends ma{_parse(t){if(this._getType(t)!==si.undefined){const r=this._getOrReturnCtx(t);return Br(r,{code:or.invalid_type,expected:si.void,received:r.parsedType}),us}return Cd(t.data)}};sU.create=e=>new sU({typeName:ds.ZodVoid,...$s(e)});let ix=class D4 extends ma{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),a=this._def;if(n.parsedType!==si.array)return Br(n,{code:or.invalid_type,expected:si.array,received:n.parsedType}),us;if(a.exactLength!==null){const f=n.data.length>a.exactLength.value,i=n.data.length<a.exactLength.value;(f||i)&&(Br(n,{code:f?or.too_big:or.too_small,minimum:i?a.exactLength.value:void 0,maximum:f?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(Br(n,{code:or.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(Br(n,{code:or.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((f,i)=>a.type._parseAsync(new vf(n,f,n.path,i)))).then(f=>Vc.mergeArray(r,f));const l=[...n.data].map((f,i)=>a.type._parseSync(new vf(n,f,n.path,i)));return Vc.mergeArray(r,l)}get element(){return this._def.type}min(t,n){return new D4({...this._def,minLength:{value:t,message:yi.toString(n)}})}max(t,n){return new D4({...this._def,maxLength:{value:t,message:yi.toString(n)}})}length(t,n){return new D4({...this._def,exactLength:{value:t,message:yi.toString(n)}})}nonempty(t){return this.min(1,t)}};ix.create=(e,t)=>new ix({type:e,minLength:null,maxLength:null,exactLength:null,typeName:ds.ZodArray,...$s(t)});function X1(e){if(e instanceof Ip){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=xp.create(X1(r))}return new Ip({...e._def,shape:()=>t})}else return e instanceof ix?new ix({...e._def,type:X1(e.element)}):e instanceof xp?xp.create(X1(e.unwrap())):e instanceof A_?A_.create(X1(e.unwrap())):e instanceof gT?gT.create(e.items.map(t=>X1(t))):e}let Ip=class ih extends ma{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=Ea.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==si.object){const x=this._getOrReturnCtx(t);return Br(x,{code:or.invalid_type,expected:si.object,received:x.parsedType}),us}const{status:r,ctx:a}=this._processInputParams(t),{shape:l,keys:f}=this._getCached(),i=[];if(!(this._def.catchall instanceof b0&&this._def.unknownKeys==="strip"))for(const x in a.data)f.includes(x)||i.push(x);const y=[];for(const x of f){const S=l[x],C=a.data[x];y.push({key:{status:"valid",value:x},value:S._parse(new vf(a,C,a.path,x)),alwaysSet:x in a.data})}if(this._def.catchall instanceof b0){const x=this._def.unknownKeys;if(x==="passthrough")for(const S of i)y.push({key:{status:"valid",value:S},value:{status:"valid",value:a.data[S]}});else if(x==="strict")i.length>0&&(Br(a,{code:or.unrecognized_keys,keys:i}),r.dirty());else if(x!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const x=this._def.catchall;for(const S of i){const C=a.data[S];y.push({key:{status:"valid",value:S},value:x._parse(new vf(a,C,a.path,S)),alwaysSet:S in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const x=[];for(const S of y){const C=await S.key,P=await S.value;x.push({key:C,value:P,alwaysSet:S.alwaysSet})}return x}).then(x=>Vc.mergeObjectSync(r,x)):Vc.mergeObjectSync(r,y)}get shape(){return this._def.shape()}strict(t){return yi.errToObj,new ih({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,r)=>{var l,f;const a=((f=(l=this._def).errorMap)==null?void 0:f.call(l,n,r).message)??r.defaultError;return n.code==="unrecognized_keys"?{message:yi.errToObj(t).message??a}:{message:a}}}:{}})}strip(){return new ih({...this._def,unknownKeys:"strip"})}passthrough(){return new ih({...this._def,unknownKeys:"passthrough"})}extend(t){return new ih({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new ih({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:ds.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new ih({...this._def,catchall:t})}pick(t){const n={};for(const r of Ea.objectKeys(t))t[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new ih({...this._def,shape:()=>n})}omit(t){const n={};for(const r of Ea.objectKeys(this.shape))t[r]||(n[r]=this.shape[r]);return new ih({...this._def,shape:()=>n})}deepPartial(){return X1(this)}partial(t){const n={};for(const r of Ea.objectKeys(this.shape)){const a=this.shape[r];t&&!t[r]?n[r]=a:n[r]=a.optional()}return new ih({...this._def,shape:()=>n})}required(t){const n={};for(const r of Ea.objectKeys(this.shape))if(t&&!t[r])n[r]=this.shape[r];else{let l=this.shape[r];for(;l instanceof xp;)l=l._def.innerType;n[r]=l}return new ih({...this._def,shape:()=>n})}keyof(){return QX(Ea.objectKeys(this.shape))}};Ip.create=(e,t)=>new Ip({shape:()=>e,unknownKeys:"strip",catchall:b0.create(),typeName:ds.ZodObject,...$s(t)});Ip.strictCreate=(e,t)=>new Ip({shape:()=>e,unknownKeys:"strict",catchall:b0.create(),typeName:ds.ZodObject,...$s(t)});Ip.lazycreate=(e,t)=>new Ip({shape:e,unknownKeys:"strip",catchall:b0.create(),typeName:ds.ZodObject,...$s(t)});let rC=class extends ma{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function a(l){for(const i of l)if(i.result.status==="valid")return i.result;for(const i of l)if(i.result.status==="dirty")return n.common.issues.push(...i.ctx.common.issues),i.result;const f=l.map(i=>new E_(i.ctx.common.issues));return Br(n,{code:or.invalid_union,unionErrors:f}),us}if(n.common.async)return Promise.all(r.map(async l=>{const f={...n,common:{...n.common,issues:[]},parent:null};return{result:await l._parseAsync({data:n.data,path:n.path,parent:f}),ctx:f}})).then(a);{let l;const f=[];for(const y of r){const x={...n,common:{...n.common,issues:[]},parent:null},S=y._parseSync({data:n.data,path:n.path,parent:x});if(S.status==="valid")return S;S.status==="dirty"&&!l&&(l={result:S,ctx:x}),x.common.issues.length&&f.push(x.common.issues)}if(l)return n.common.issues.push(...l.ctx.common.issues),l.result;const i=f.map(y=>new E_(y));return Br(n,{code:or.invalid_union,unionErrors:i}),us}}get options(){return this._def.options}};rC.create=(e,t)=>new rC({options:e,typeName:ds.ZodUnion,...$s(t)});const ip=e=>e instanceof WP?ip(e.schema):e instanceof S_?ip(e.innerType()):e instanceof aC?[e.value]:e instanceof Ek?e.options:e instanceof oC?Ea.objectValues(e.enum):e instanceof uC?ip(e._def.innerType):e instanceof $P?[void 0]:e instanceof HP?[null]:e instanceof xp?[void 0,...ip(e.unwrap())]:e instanceof A_?[null,...ip(e.unwrap())]:e instanceof JX||e instanceof dC?ip(e.unwrap()):e instanceof cC?ip(e._def.innerType):[];let Mpe=class YX extends ma{_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==si.object)return Br(n,{code:or.invalid_type,expected:si.object,received:n.parsedType}),us;const r=this.discriminator,a=n.data[r],l=this.optionsMap.get(a);return l?n.common.async?l._parseAsync({data:n.data,path:n.path,parent:n}):l._parseSync({data:n.data,path:n.path,parent:n}):(Br(n,{code:or.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),us)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,n,r){const a=new Map;for(const l of n){const f=ip(l.shape[t]);if(!f.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const i of f){if(a.has(i))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(i)}`);a.set(i,l)}}return new YX({typeName:ds.ZodDiscriminatedUnion,discriminator:t,options:n,optionsMap:a,...$s(r)})}};function qP(e,t){const n=Nm(e),r=Nm(t);if(e===t)return{valid:!0,data:e};if(n===si.object&&r===si.object){const a=Ea.objectKeys(t),l=Ea.objectKeys(e).filter(i=>a.indexOf(i)!==-1),f={...e,...t};for(const i of l){const y=qP(e[i],t[i]);if(!y.valid)return{valid:!1};f[i]=y.data}return{valid:!0,data:f}}else if(n===si.array&&r===si.array){if(e.length!==t.length)return{valid:!1};const a=[];for(let l=0;l<e.length;l++){const f=e[l],i=t[l],y=qP(f,i);if(!y.valid)return{valid:!1};a.push(y.data)}return{valid:!0,data:a}}else return n===si.date&&r===si.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}let iC=class extends ma{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=(l,f)=>{if(Qj(l)||Qj(f))return us;const i=qP(l.value,f.value);return i.valid?((Jj(l)||Jj(f))&&n.dirty(),{status:n.value,value:i.data}):(Br(r,{code:or.invalid_intersection_types}),us)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([l,f])=>a(l,f)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};iC.create=(e,t,n)=>new iC({left:e,right:t,typeName:ds.ZodIntersection,...$s(n)});let gT=class KX extends ma{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==si.array)return Br(r,{code:or.invalid_type,expected:si.array,received:r.parsedType}),us;if(r.data.length<this._def.items.length)return Br(r,{code:or.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),us;!this._def.rest&&r.data.length>this._def.items.length&&(Br(r,{code:or.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const l=[...r.data].map((f,i)=>{const y=this._def.items[i]||this._def.rest;return y?y._parse(new vf(r,f,r.path,i)):null}).filter(f=>!!f);return r.common.async?Promise.all(l).then(f=>Vc.mergeArray(n,f)):Vc.mergeArray(n,l)}get items(){return this._def.items}rest(t){return new KX({...this._def,rest:t})}};gT.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new gT({items:e,typeName:ds.ZodTuple,rest:null,...$s(t)})};class sC extends ma{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==si.object)return Br(r,{code:or.invalid_type,expected:si.object,received:r.parsedType}),us;const a=[],l=this._def.keyType,f=this._def.valueType;for(const i in r.data)a.push({key:l._parse(new vf(r,i,r.path,i)),value:f._parse(new vf(r,r.data[i],r.path,i)),alwaysSet:i in r.data});return r.common.async?Vc.mergeObjectAsync(n,a):Vc.mergeObjectSync(n,a)}get element(){return this._def.valueType}static create(t,n,r){return n instanceof ma?new sC({keyType:t,valueType:n,typeName:ds.ZodRecord,...$s(r)}):new sC({keyType:nC.create(),valueType:t,typeName:ds.ZodRecord,...$s(n)})}}let aU=class extends ma{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==si.map)return Br(r,{code:or.invalid_type,expected:si.map,received:r.parsedType}),us;const a=this._def.keyType,l=this._def.valueType,f=[...r.data.entries()].map(([i,y],x)=>({key:a._parse(new vf(r,i,r.path,[x,"key"])),value:l._parse(new vf(r,y,r.path,[x,"value"]))}));if(r.common.async){const i=new Map;return Promise.resolve().then(async()=>{for(const y of f){const x=await y.key,S=await y.value;if(x.status==="aborted"||S.status==="aborted")return us;(x.status==="dirty"||S.status==="dirty")&&n.dirty(),i.set(x.value,S.value)}return{status:n.value,value:i}})}else{const i=new Map;for(const y of f){const x=y.key,S=y.value;if(x.status==="aborted"||S.status==="aborted")return us;(x.status==="dirty"||S.status==="dirty")&&n.dirty(),i.set(x.value,S.value)}return{status:n.value,value:i}}}};aU.create=(e,t,n)=>new aU({valueType:t,keyType:e,typeName:ds.ZodMap,...$s(n)});let oU=class ZP extends ma{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==si.set)return Br(r,{code:or.invalid_type,expected:si.set,received:r.parsedType}),us;const a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(Br(r,{code:or.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(Br(r,{code:or.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());const l=this._def.valueType;function f(y){const x=new Set;for(const S of y){if(S.status==="aborted")return us;S.status==="dirty"&&n.dirty(),x.add(S.value)}return{status:n.value,value:x}}const i=[...r.data.values()].map((y,x)=>l._parse(new vf(r,y,r.path,x)));return r.common.async?Promise.all(i).then(y=>f(y)):f(i)}min(t,n){return new ZP({...this._def,minSize:{value:t,message:yi.toString(n)}})}max(t,n){return new ZP({...this._def,maxSize:{value:t,message:yi.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}};oU.create=(e,t)=>new oU({valueType:e,minSize:null,maxSize:null,typeName:ds.ZodSet,...$s(t)});let WP=class extends ma{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}};WP.create=(e,t)=>new WP({getter:e,typeName:ds.ZodLazy,...$s(t)});let aC=class extends ma{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return Br(n,{received:n.data,code:or.invalid_literal,expected:this._def.value}),us}return{status:"valid",value:t.data}}get value(){return this._def.value}};aC.create=(e,t)=>new aC({value:e,typeName:ds.ZodLiteral,...$s(t)});function QX(e,t){return new Ek({values:e,typeName:ds.ZodEnum,...$s(t)})}let Ek=class XP extends ma{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return Br(n,{expected:Ea.joinValues(r),received:n.parsedType,code:or.invalid_type}),us}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const n=this._getOrReturnCtx(t),r=this._def.values;return Br(n,{received:n.data,code:or.invalid_enum_value,options:r}),us}return Cd(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return XP.create(t,{...this._def,...n})}exclude(t,n=this._def){return XP.create(this.options.filter(r=>!t.includes(r)),{...this._def,...n})}};Ek.create=QX;let oC=class extends ma{_parse(t){const n=Ea.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==si.string&&r.parsedType!==si.number){const a=Ea.objectValues(n);return Br(r,{expected:Ea.joinValues(a),received:r.parsedType,code:or.invalid_type}),us}if(this._cache||(this._cache=new Set(Ea.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const a=Ea.objectValues(n);return Br(r,{received:r.data,code:or.invalid_enum_value,options:a}),us}return Cd(t.data)}get enum(){return this._def.values}};oC.create=(e,t)=>new oC({values:e,typeName:ds.ZodNativeEnum,...$s(t)});let lC=class extends ma{unwrap(){return this._def.type}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==si.promise&&n.common.async===!1)return Br(n,{code:or.invalid_type,expected:si.promise,received:n.parsedType}),us;const r=n.parsedType===si.promise?n.data:Promise.resolve(n.data);return Cd(r.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}};lC.create=(e,t)=>new lC({type:e,typeName:ds.ZodPromise,...$s(t)});let S_=class extends ma{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ds.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=this._def.effect||null,l={addIssue:f=>{Br(r,f),f.fatal?n.abort():n.dirty()},get path(){return r.path}};if(l.addIssue=l.addIssue.bind(l),a.type==="preprocess"){const f=a.transform(r.data,l);if(r.common.async)return Promise.resolve(f).then(async i=>{if(n.value==="aborted")return us;const y=await this._def.schema._parseAsync({data:i,path:r.path,parent:r});return y.status==="aborted"?us:y.status==="dirty"||n.value==="dirty"?h2(y.value):y});{if(n.value==="aborted")return us;const i=this._def.schema._parseSync({data:f,path:r.path,parent:r});return i.status==="aborted"?us:i.status==="dirty"||n.value==="dirty"?h2(i.value):i}}if(a.type==="refinement"){const f=i=>{const y=a.refinement(i,l);if(r.common.async)return Promise.resolve(y);if(y instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?us:(i.status==="dirty"&&n.dirty(),f(i.value),{status:n.value,value:i.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>i.status==="aborted"?us:(i.status==="dirty"&&n.dirty(),f(i.value).then(()=>({status:n.value,value:i.value}))))}if(a.type==="transform")if(r.common.async===!1){const f=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!rx(f))return us;const i=a.transform(f.value,l);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:i}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(f=>rx(f)?Promise.resolve(a.transform(f.value,l)).then(i=>({status:n.value,value:i})):us);Ea.assertNever(a)}};S_.create=(e,t,n)=>new S_({schema:e,typeName:ds.ZodEffects,effect:t,...$s(n)});S_.createWithPreprocess=(e,t,n)=>new S_({schema:t,effect:{type:"preprocess",transform:e},typeName:ds.ZodEffects,...$s(n)});let xp=class extends ma{_parse(t){return this._getType(t)===si.undefined?Cd(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};xp.create=(e,t)=>new xp({innerType:e,typeName:ds.ZodOptional,...$s(t)});let A_=class extends ma{_parse(t){return this._getType(t)===si.null?Cd(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};A_.create=(e,t)=>new A_({innerType:e,typeName:ds.ZodNullable,...$s(t)});let uC=class extends ma{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===si.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};uC.create=(e,t)=>new uC({innerType:e,typeName:ds.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...$s(t)});let cC=class extends ma{_parse(t){const{ctx:n}=this._processInputParams(t),r={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return tC(a)?a.then(l=>({status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new E_(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new E_(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};cC.create=(e,t)=>new cC({innerType:e,typeName:ds.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...$s(t)});let lU=class extends ma{_parse(t){if(this._getType(t)!==si.nan){const r=this._getOrReturnCtx(t);return Br(r,{code:or.invalid_type,expected:si.nan,received:r.parsedType}),us}return{status:"valid",value:t.data}}};lU.create=e=>new lU({typeName:ds.ZodNaN,...$s(e)});let JX=class extends ma{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}},Ppe=class eY extends ma{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const l=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return l.status==="aborted"?us:l.status==="dirty"?(n.dirty(),h2(l.value)):this._def.out._parseAsync({data:l.value,path:r.path,parent:r})})();{const a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?us:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(t,n){return new eY({in:t,out:n,typeName:ds.ZodPipeline})}},dC=class extends ma{_parse(t){const n=this._def.innerType._parse(t),r=a=>(rx(a)&&(a.value=Object.freeze(a.value)),a);return tC(n)?n.then(a=>r(a)):r(n)}unwrap(){return this._def.innerType}};dC.create=(e,t)=>new dC({innerType:e,typeName:ds.ZodReadonly,...$s(t)});var ds;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(ds||(ds={}));const ai=nC.create,Ope=BP.create,Lpe=VP.create,Td=GP.create;b0.create;const p0=ix.create,Th=Ip.create,qL=rC.create,ZL=Mpe.create;iC.create;gT.create;const tY=sC.create,ms=aC.create;Ek.create;const Dpe=oC.create;lC.create;xp.create;A_.create;var Npe=Th({name:ai(),arguments:ai()}),zpe=Th({id:ai(),type:ms("function"),function:Npe}),Sk=Th({id:ai(),role:ai(),content:ai().optional(),name:ai().optional()}),Fpe=Th({type:ms("text"),text:ai()}),nY=Th({type:ms("binary"),mimeType:ai(),id:ai().optional(),url:ai().optional(),data:ai().optional(),filename:ai().optional()}),rY=(e,t)=>{!e.id&&!e.url&&!e.data&&t.addIssue({code:or.custom,message:"BinaryInputContent requires at least one of id, url, or data.",path:["id"]})};nY.superRefine((e,t)=>{rY(e,t)});var Bpe=ZL("type",[Fpe,nY]),jpe=Bpe.superRefine((e,t)=>{e.type==="binary"&&rY(e,t)}),Upe=Sk.extend({role:ms("developer"),content:ai()}),Vpe=Sk.extend({role:ms("system"),content:ai()}),$pe=Sk.extend({role:ms("assistant"),content:ai().optional(),toolCalls:p0(zpe).optional()}),Hpe=Sk.extend({role:ms("user"),content:qL([ai(),p0(jpe)])}),Gpe=Th({id:ai(),content:ai(),role:ms("tool"),toolCallId:ai(),error:ai().optional()}),qpe=Th({id:ai(),role:ms("activity"),activityType:ai(),content:tY(Td())}),iY=ZL("role",[Upe,Vpe,$pe,Hpe,Gpe,qpe]);qL([ms("developer"),ms("system"),ms("assistant"),ms("user"),ms("tool"),ms("activity")]);var Zpe=Th({description:ai(),value:ai()}),Wpe=Th({name:ai(),description:ai(),parameters:Td()}),Xpe=Th({threadId:ai(),runId:ai(),parentRunId:ai().optional(),state:Td(),messages:p0(iY),tools:p0(Wpe),context:p0(Zpe),forwardedProps:Td()}),Ype=Td(),$o=class extends Error{constructor(e){super(e)}},YP=class extends $o{constructor(){super("Connect not implemented. This method is not supported by the current agent.")}},sY=qL([ms("developer"),ms("system"),ms("assistant"),ms("user")]),Zn=(e=>(e.TEXT_MESSAGE_START="TEXT_MESSAGE_START",e.TEXT_MESSAGE_CONTENT="TEXT_MESSAGE_CONTENT",e.TEXT_MESSAGE_END="TEXT_MESSAGE_END",e.TEXT_MESSAGE_CHUNK="TEXT_MESSAGE_CHUNK",e.THINKING_TEXT_MESSAGE_START="THINKING_TEXT_MESSAGE_START",e.THINKING_TEXT_MESSAGE_CONTENT="THINKING_TEXT_MESSAGE_CONTENT",e.THINKING_TEXT_MESSAGE_END="THINKING_TEXT_MESSAGE_END",e.TOOL_CALL_START="TOOL_CALL_START",e.TOOL_CALL_ARGS="TOOL_CALL_ARGS",e.TOOL_CALL_END="TOOL_CALL_END",e.TOOL_CALL_CHUNK="TOOL_CALL_CHUNK",e.TOOL_CALL_RESULT="TOOL_CALL_RESULT",e.THINKING_START="THINKING_START",e.THINKING_END="THINKING_END",e.STATE_SNAPSHOT="STATE_SNAPSHOT",e.STATE_DELTA="STATE_DELTA",e.MESSAGES_SNAPSHOT="MESSAGES_SNAPSHOT",e.ACTIVITY_SNAPSHOT="ACTIVITY_SNAPSHOT",e.ACTIVITY_DELTA="ACTIVITY_DELTA",e.RAW="RAW",e.CUSTOM="CUSTOM",e.RUN_STARTED="RUN_STARTED",e.RUN_FINISHED="RUN_FINISHED",e.RUN_ERROR="RUN_ERROR",e.STEP_STARTED="STEP_STARTED",e.STEP_FINISHED="STEP_FINISHED",e))(Zn||{}),bo=Th({type:Dpe(Zn),timestamp:Ope().optional(),rawEvent:Td().optional()}),Kpe=bo.extend({type:ms("TEXT_MESSAGE_START"),messageId:ai(),role:sY.default("assistant")}),aY=bo.extend({type:ms("TEXT_MESSAGE_CONTENT"),messageId:ai(),delta:ai().refine(e=>e.length>0,"Delta must not be an empty string")}),Qpe=bo.extend({type:ms("TEXT_MESSAGE_END"),messageId:ai()}),Jpe=bo.extend({type:ms("TEXT_MESSAGE_CHUNK"),messageId:ai().optional(),role:sY.optional(),delta:ai().optional()}),eme=bo.extend({type:ms("THINKING_TEXT_MESSAGE_START")}),tme=aY.omit({messageId:!0,type:!0}).extend({type:ms("THINKING_TEXT_MESSAGE_CONTENT")}),nme=bo.extend({type:ms("THINKING_TEXT_MESSAGE_END")}),rme=bo.extend({type:ms("TOOL_CALL_START"),toolCallId:ai(),toolCallName:ai(),parentMessageId:ai().optional()}),ime=bo.extend({type:ms("TOOL_CALL_ARGS"),toolCallId:ai(),delta:ai()}),sme=bo.extend({type:ms("TOOL_CALL_END"),toolCallId:ai()}),ame=bo.extend({messageId:ai(),type:ms("TOOL_CALL_RESULT"),toolCallId:ai(),content:ai(),role:ms("tool").optional()}),ome=bo.extend({type:ms("TOOL_CALL_CHUNK"),toolCallId:ai().optional(),toolCallName:ai().optional(),parentMessageId:ai().optional(),delta:ai().optional()}),lme=bo.extend({type:ms("THINKING_START"),title:ai().optional()}),ume=bo.extend({type:ms("THINKING_END")}),cme=bo.extend({type:ms("STATE_SNAPSHOT"),snapshot:Ype}),dme=bo.extend({type:ms("STATE_DELTA"),delta:p0(Td())}),hme=bo.extend({type:ms("MESSAGES_SNAPSHOT"),messages:p0(iY)}),fme=bo.extend({type:ms("ACTIVITY_SNAPSHOT"),messageId:ai(),activityType:ai(),content:tY(Td()),replace:Lpe().optional().default(!0)}),pme=bo.extend({type:ms("ACTIVITY_DELTA"),messageId:ai(),activityType:ai(),patch:p0(Td())}),mme=bo.extend({type:ms("RAW"),event:Td(),source:ai().optional()}),gme=bo.extend({type:ms("CUSTOM"),name:ai(),value:Td()}),_me=bo.extend({type:ms("RUN_STARTED"),threadId:ai(),runId:ai(),parentRunId:ai().optional(),input:Xpe.optional()}),yme=bo.extend({type:ms("RUN_FINISHED"),threadId:ai(),runId:ai(),result:Td().optional()}),vme=bo.extend({type:ms("RUN_ERROR"),message:ai(),code:ai().optional()}),xme=bo.extend({type:ms("STEP_STARTED"),stepName:ai()}),bme=bo.extend({type:ms("STEP_FINISHED"),stepName:ai()}),oY=ZL("type",[Kpe,aY,Qpe,Jpe,lme,ume,eme,tme,nme,rme,ime,sme,ome,ame,cme,dme,hme,fme,pme,mme,gme,_me,yme,vme,xme,bme]);function Zo(e){return typeof e=="function"}function wme(e){return Zo(e==null?void 0:e.lift)}function Tf(e){return function(t){if(wme(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}var lY=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function uY(e){return Zo(e==null?void 0:e.then)}function WL(e){var t=function(r){Error.call(r),r.stack=new Error().stack},n=e(t);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var G5=WL(function(e){return function(n){e(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,a){return a+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function KP(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Ak=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,n,r,a,l;if(!this.closed){this.closed=!0;var f=this._parentage;if(f)if(this._parentage=null,Array.isArray(f))try{for(var i=tx(f),y=i.next();!y.done;y=i.next()){var x=y.value;x.remove(this)}}catch(U){t={error:U}}finally{try{y&&!y.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}else f.remove(this);var S=this.initialTeardown;if(Zo(S))try{S()}catch(U){l=U instanceof G5?U.errors:[U]}var C=this._finalizers;if(C){this._finalizers=null;try{for(var P=tx(C),L=P.next();!L.done;L=P.next()){var F=L.value;try{uU(F)}catch(U){l=l??[],U instanceof G5?l=KA(KA([],NP(l)),NP(U.errors)):l.push(U)}}}catch(U){r={error:U}}finally{try{L&&!L.done&&(a=P.return)&&a.call(P)}finally{if(r)throw r.error}}}if(l)throw new G5(l)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)uU(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(t)}},e.prototype._hasParent=function(t){var n=this._parentage;return n===t||Array.isArray(n)&&n.includes(t)},e.prototype._addParent=function(t){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t},e.prototype._removeParent=function(t){var n=this._parentage;n===t?this._parentage=null:Array.isArray(n)&&KP(n,t)},e.prototype.remove=function(t){var n=this._finalizers;n&&KP(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),cY=Ak.EMPTY;function dY(e){return e instanceof Ak||e&&"closed"in e&&Zo(e.remove)&&Zo(e.add)&&Zo(e.unsubscribe)}function uU(e){Zo(e)?e():e.unsubscribe()}var Tme={Promise:void 0},Eme={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,KA([e,t],NP(n)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function hY(e){Eme.setTimeout(function(){throw e})}function QP(){}function N4(e){e()}var XL=function(e){Ax(t,e);function t(n){var r=e.call(this)||this;return r.isStopped=!1,n?(r.destination=n,dY(n)&&n.add(r)):r.destination=Cme,r}return t.create=function(n,r,a){return new JP(n,r,a)},t.prototype.next=function(n){this.isStopped||this._next(n)},t.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(n){this.destination.next(n)},t.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Ak),Sme=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var n=this.partialObserver;if(n.next)try{n.next(t)}catch(r){V3(r)}},e.prototype.error=function(t){var n=this.partialObserver;if(n.error)try{n.error(t)}catch(r){V3(r)}else V3(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(n){V3(n)}},e}(),JP=function(e){Ax(t,e);function t(n,r,a){var l=e.call(this)||this,f;return Zo(n)||!n?f={next:n??void 0,error:r??void 0,complete:a??void 0}:f=n,l.destination=new Sme(f),l}return t}(XL);function V3(e){hY(e)}function Ame(e){throw e}var Cme={closed:!0,next:QP,error:Ame,complete:QP},YL=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function KL(e){return e}function cU(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return fY(e)}function fY(e){return e.length===0?KL:e.length===1?e[0]:function(n){return e.reduce(function(r,a){return a(r)},n)}}var Nu=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(t,n,r){var a=this,l=Ime(t)?t:new JP(t,n,r);return N4(function(){var f=a,i=f.operator,y=f.source;l.add(i?i.call(l,y):y?a._subscribe(l):a._trySubscribe(l))}),l},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(n){t.error(n)}},e.prototype.forEach=function(t,n){var r=this;return n=dU(n),new n(function(a,l){var f=new JP({next:function(i){try{t(i)}catch(y){l(y),f.unsubscribe()}},error:l,complete:a});r.subscribe(f)})},e.prototype._subscribe=function(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)},e.prototype[YL]=function(){return this},e.prototype.pipe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return fY(t)(this)},e.prototype.toPromise=function(t){var n=this;return t=dU(t),new t(function(r,a){var l;n.subscribe(function(f){return l=f},function(f){return a(f)},function(){return r(l)})})},e.create=function(t){return new e(t)},e}();function dU(e){var t;return(t=e??Tme.Promise)!==null&&t!==void 0?t:Promise}function kme(e){return e&&Zo(e.next)&&Zo(e.error)&&Zo(e.complete)}function Ime(e){return e&&e instanceof XL||kme(e)&&dY(e)}function pY(e){return Zo(e[YL])}function mY(e){return Symbol.asyncIterator&&Zo(e==null?void 0:e[Symbol.asyncIterator])}function gY(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Rme(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var _Y=Rme();function yY(e){return Zo(e==null?void 0:e[_Y])}function vY(e){return Afe(this,arguments,function(){var n,r,a,l;return AX(this,function(f){switch(f.label){case 0:n=e.getReader(),f.label=1;case 1:f.trys.push([1,,9,10]),f.label=2;case 2:return[4,bv(n.read())];case 3:return r=f.sent(),a=r.value,l=r.done,l?[4,bv(void 0)]:[3,5];case 4:return[2,f.sent()];case 5:return[4,bv(a)];case 6:return[4,f.sent()];case 7:return f.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function xY(e){return Zo(e==null?void 0:e.getReader)}function Fp(e){if(e instanceof Nu)return e;if(e!=null){if(pY(e))return Mme(e);if(lY(e))return Pme(e);if(uY(e))return Ome(e);if(mY(e))return bY(e);if(yY(e))return Lme(e);if(xY(e))return Dme(e)}throw gY(e)}function Mme(e){return new Nu(function(t){var n=e[YL]();if(Zo(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Pme(e){return new Nu(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}function Ome(e){return new Nu(function(t){e.then(function(n){t.closed||(t.next(n),t.complete())},function(n){return t.error(n)}).then(null,hY)})}function Lme(e){return new Nu(function(t){var n,r;try{for(var a=tx(e),l=a.next();!l.done;l=a.next()){var f=l.value;if(t.next(f),t.closed)return}}catch(i){n={error:i}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}t.complete()})}function bY(e){return new Nu(function(t){Nme(e,t).catch(function(n){return t.error(n)})})}function Dme(e){return bY(vY(e))}function Nme(e,t){var n,r,a,l;return Sfe(this,void 0,void 0,function(){var f,i;return AX(this,function(y){switch(y.label){case 0:y.trys.push([0,5,6,11]),n=Cfe(e),y.label=1;case 1:return[4,n.next()];case 2:if(r=y.sent(),!!r.done)return[3,4];if(f=r.value,t.next(f),t.closed)return[2];y.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return i=y.sent(),a={error:i},[3,11];case 6:return y.trys.push([6,,9,10]),r&&!r.done&&(l=n.return)?[4,l.call(n)]:[3,8];case 7:y.sent(),y.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function xf(e,t,n,r,a){return new zme(e,t,n,r,a)}var zme=function(e){Ax(t,e);function t(n,r,a,l,f,i){var y=e.call(this,n)||this;return y.onFinalize=f,y.shouldUnsubscribe=i,y._next=r?function(x){try{r(x)}catch(S){n.error(S)}}:e.prototype._next,y._error=l?function(x){try{l(x)}catch(S){n.error(S)}finally{this.unsubscribe()}}:e.prototype._error,y._complete=a?function(){try{a()}catch(x){n.error(x)}finally{this.unsubscribe()}}:e.prototype._complete,y}return t.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},t}(XL),wY={now:function(){return(wY.delegate||Date).now()},delegate:void 0};function Fme(e){return e&&Zo(e.schedule)}function Bme(e){return e[e.length-1]}function jme(e){return Fme(Bme(e))?e.pop():void 0}function c_(e,t,n,r,a){r===void 0&&(r=0),a===void 0&&(a=!1);var l=t.schedule(function(){n(),a?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(l),!a)return l}function eO(e){return Tf(function(t,n){var r=null,a=!1,l;r=t.subscribe(xf(n,void 0,void 0,function(f){l=Fp(e(f,eO(e)(t))),r?(r.unsubscribe(),r=null,l.subscribe(n)):a=!0})),a&&(r.unsubscribe(),r=null,l.subscribe(n))})}function TY(e,t){return t===void 0&&(t=0),Tf(function(n,r){n.subscribe(xf(r,function(a){return c_(r,e,function(){return r.next(a)},t)},function(){return c_(r,e,function(){return r.complete()},t)},function(a){return c_(r,e,function(){return r.error(a)},t)}))})}function EY(e,t){return t===void 0&&(t=0),Tf(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function Ume(e,t){return Fp(e).pipe(EY(t),TY(t))}function Vme(e,t){return Fp(e).pipe(EY(t),TY(t))}function $me(e,t){return new Nu(function(n){var r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}function Hme(e,t){return new Nu(function(n){var r;return c_(n,t,function(){r=e[_Y](),c_(n,t,function(){var a,l,f;try{a=r.next(),l=a.value,f=a.done}catch(i){n.error(i);return}f?n.complete():n.next(l)},0,!0)}),function(){return Zo(r==null?void 0:r.return)&&r.return()}})}function SY(e,t){if(!e)throw new Error("Iterable cannot be null");return new Nu(function(n){c_(n,t,function(){var r=e[Symbol.asyncIterator]();c_(n,t,function(){r.next().then(function(a){a.done?n.complete():n.next(a.value)})},0,!0)})})}function Gme(e,t){return SY(vY(e),t)}function qme(e,t){if(e!=null){if(pY(e))return Ume(e,t);if(lY(e))return $me(e,t);if(uY(e))return Vme(e,t);if(mY(e))return SY(e,t);if(yY(e))return Hme(e,t);if(xY(e))return Gme(e,t)}throw gY(e)}function hC(e,t){return t?qme(e,t):Fp(e)}function tO(e,t){return Tf(function(n,r){var a=0;n.subscribe(xf(r,function(l){r.next(e.call(t,l,a++))}))})}function Zme(e,t,n,r,a,l,f,i){var y=[],x=0,S=0,C=!1,P=function(){C&&!y.length&&!x&&t.complete()},L=function(U){return x<r?F(U):y.push(U)},F=function(U){x++;var q=!1;Fp(n(U,S++)).subscribe(xf(t,function(G){t.next(G)},function(){q=!0},void 0,function(){if(q)try{x--;for(var G=function(){var $=y.shift();f||F($)};y.length&&x<r;)G();P()}catch($){t.error($)}}))};return e.subscribe(xf(t,L,function(){C=!0,P()})),function(){}}function w0(e,t,n){return n===void 0&&(n=1/0),Zo(t)?w0(function(r,a){return tO(function(l,f){return t(r,l,a,f)})(Fp(e(r,a)))},n):(typeof t=="number"&&(n=t),Tf(function(r,a){return Zme(r,a,e,n)}))}function Wme(e){return e===void 0&&(e=1/0),w0(KL,e)}function AY(e,t){return Zo(t)?w0(e,t,1):w0(e,1)}var Xme=WL(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),C_=function(e){Ax(t,e);function t(){var n=e.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return t.prototype.lift=function(n){var r=new hU(this,this);return r.operator=n,r},t.prototype._throwIfClosed=function(){if(this.closed)throw new Xme},t.prototype.next=function(n){var r=this;N4(function(){var a,l;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var f=tx(r.currentObservers),i=f.next();!i.done;i=f.next()){var y=i.value;y.next(n)}}catch(x){a={error:x}}finally{try{i&&!i.done&&(l=f.return)&&l.call(f)}finally{if(a)throw a.error}}}})},t.prototype.error=function(n){var r=this;N4(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var a=r.observers;a.length;)a.shift().error(n)}})},t.prototype.complete=function(){var n=this;N4(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(n){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,n)},t.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},t.prototype._innerSubscribe=function(n){var r=this,a=this,l=a.hasError,f=a.isStopped,i=a.observers;return l||f?cY:(this.currentObservers=null,i.push(n),new Ak(function(){r.currentObservers=null,KP(i,n)}))},t.prototype._checkFinalizedStatuses=function(n){var r=this,a=r.hasError,l=r.thrownError,f=r.isStopped;a?n.error(l):f&&n.complete()},t.prototype.asObservable=function(){var n=new Nu;return n.source=this,n},t.create=function(n,r){return new hU(n,r)},t}(Nu),hU=function(e){Ax(t,e);function t(n,r){var a=e.call(this)||this;return a.destination=n,a.source=r,a}return t.prototype.next=function(n){var r,a;(a=(r=this.destination)===null||r===void 0?void 0:r.next)===null||a===void 0||a.call(r,n)},t.prototype.error=function(n){var r,a;(a=(r=this.destination)===null||r===void 0?void 0:r.error)===null||a===void 0||a.call(r,n)},t.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},t.prototype._subscribe=function(n){var r,a;return(a=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&a!==void 0?a:cY},t}(C_);function Yme(e){return Tf(function(t,n){var r=!1;t.subscribe(xf(n,function(a){r=!0,n.next(a)},function(){r||n.next(e),n.complete()}))})}var CY=new Nu(function(e){return e.complete()});function Ko(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=jme(e);return hC(e,n)}function Oo(e,t){var n=Zo(e)?e:function(){return e},r=function(a){return a.error(n())};return new Nu(r)}var Kme=WL(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function nO(e){return Tf(function(t,n){try{t.subscribe(n)}finally{n.add(e)}})}var kY=function(e){Ax(t,e);function t(n,r,a){n===void 0&&(n=1/0),r===void 0&&(r=1/0),a===void 0&&(a=wY);var l=e.call(this)||this;return l._bufferSize=n,l._windowTime=r,l._timestampProvider=a,l._buffer=[],l._infiniteTimeWindow=!0,l._infiniteTimeWindow=r===1/0,l._bufferSize=Math.max(1,n),l._windowTime=Math.max(1,r),l}return t.prototype.next=function(n){var r=this,a=r.isStopped,l=r._buffer,f=r._infiniteTimeWindow,i=r._timestampProvider,y=r._windowTime;a||(l.push(n),!f&&l.push(i.now()+y)),this._trimBuffer(),e.prototype.next.call(this,n)},t.prototype._subscribe=function(n){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(n),a=this,l=a._infiniteTimeWindow,f=a._buffer,i=f.slice(),y=0;y<i.length&&!n.closed;y+=l?1:2)n.next(i[y]);return this._checkFinalizedStatuses(n),r},t.prototype._trimBuffer=function(){var n=this,r=n._bufferSize,a=n._timestampProvider,l=n._buffer,f=n._infiniteTimeWindow,i=(f?1:2)*r;if(r<1/0&&i<l.length&&l.splice(0,l.length-i),!f){for(var y=a.now(),x=0,S=1;S<l.length&&l[S]<=y;S+=2)x=S;x&&l.splice(0,x+1)}},t}(C_);function Qme(e,t){return Tf(function(n,r){var a=null,l=0,f=!1,i=function(){return f&&!a&&r.complete()};n.subscribe(xf(r,function(y){a==null||a.unsubscribe();var x=0,S=l++;Fp(e(y,S)).subscribe(a=xf(r,function(C){return r.next(t?t(y,C,S,x++):C)},function(){a=null,i()}))},function(){f=!0,i()}))})}function fU(e){return Tf(function(t,n){Fp(e).subscribe(xf(n,function(){return n.complete()},QP)),!n.closed&&t.subscribe(n)})}function Jme(e,t,n){var r=Zo(e)||t||n?{next:e,error:t,complete:n}:e;return r?Tf(function(a,l){var f;(f=r.subscribe)===null||f===void 0||f.call(r);var i=!0;a.subscribe(xf(l,function(y){var x;(x=r.next)===null||x===void 0||x.call(r,y),l.next(y)},function(){var y;i=!1,(y=r.complete)===null||y===void 0||y.call(r),l.complete()},function(y){var x;i=!1,(x=r.error)===null||x===void 0||x.call(r,y),l.error(y)},function(){var y,x;i&&((y=r.unsubscribe)===null||y===void 0||y.call(r)),(x=r.finalize)===null||x===void 0||x.call(r)}))}):KL}function pU(e,t){return new Promise(function(n,r){var a=!1,l;e.subscribe({next:function(f){l=f,a=!0},error:r,complete:function(){a?n(l):r(new Kme)}})})}function e0e(e){return new Nu(function(t){Fp(e()).subscribe(t)})}const $l=[];for(let e=0;e<256;++e)$l.push((e+256).toString(16).slice(1));function t0e(e,t=0){return($l[e[t+0]]+$l[e[t+1]]+$l[e[t+2]]+$l[e[t+3]]+"-"+$l[e[t+4]]+$l[e[t+5]]+"-"+$l[e[t+6]]+$l[e[t+7]]+"-"+$l[e[t+8]]+$l[e[t+9]]+"-"+$l[e[t+10]]+$l[e[t+11]]+$l[e[t+12]]+$l[e[t+13]]+$l[e[t+14]]+$l[e[t+15]]).toLowerCase()}let q5;const n0e=new Uint8Array(16);function r0e(){if(!q5){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");q5=crypto.getRandomValues.bind(crypto)}return q5(n0e)}const i0e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),mU={randomUUID:i0e};function Y1(e,t,n){var a;if(mU.randomUUID&&!e)return mU.randomUUID();e=e||{};const r=e.random??((a=e.rng)==null?void 0:a.call(e))??r0e();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,t0e(r)}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var s0e=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var l in a)a.hasOwnProperty(l)&&(r[l]=a[l])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),a0e=Object.prototype.hasOwnProperty;function rO(e,t){return a0e.call(e,t)}function iO(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var a in e)rO(e,a)&&r.push(a);return r}function Nc(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function sO(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function Gg(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function IY(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function aO(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(aO(e[t]))return!0}else if(typeof e=="object"){for(var r=iO(e),a=r.length,l=0;l<a;l++)if(aO(e[r[l]]))return!0}}return!1}function gU(e,t){var n=[e];for(var r in t){var a=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof a<"u"&&n.push(r+": "+a)}return n.join(`
`)}var RY=function(e){s0e(t,e);function t(n,r,a,l,f){var i=this.constructor,y=e.call(this,gU(n,{name:r,index:a,operation:l,tree:f}))||this;return y.name=r,y.index=a,y.operation=l,y.tree=f,Object.setPrototypeOf(y,i.prototype),y.message=gU(n,{name:r,index:a,operation:l,tree:f}),y}return t}(Error),Go=RY,o0e=Nc,fv={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=fC(n,this.path);r&&(r=Nc(r));var a=d_(n,{op:"remove",path:this.from}).removed;return d_(n,{op:"add",path:this.path,value:a}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=fC(n,this.from);return d_(n,{op:"add",path:this.path,value:Nc(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:_T(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},l0e={add:function(e,t,n){return sO(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:fv.move,copy:fv.copy,test:fv.test,_get:fv._get};function fC(e,t){if(t=="")return e;var n={op:"_get",path:t};return d_(e,n),n.value}function d_(e,t,n,r,a,l){if(n===void 0&&(n=!1),r===void 0&&(r=!0),a===void 0&&(a=!0),l===void 0&&(l=0),n&&(typeof n=="function"?n(t,0,e,t.path):pC(t,0)),t.path===""){var f={newDocument:e};if(t.op==="add")return f.newDocument=t.value,f;if(t.op==="replace")return f.newDocument=t.value,f.removed=e,f;if(t.op==="move"||t.op==="copy")return f.newDocument=fC(e,t.from),t.op==="move"&&(f.removed=e),f;if(t.op==="test"){if(f.test=_T(e,t.value),f.test===!1)throw new Go("Test operation failed","TEST_OPERATION_FAILED",l,t,e);return f.newDocument=e,f}else{if(t.op==="remove")return f.removed=e,f.newDocument=null,f;if(t.op==="_get")return t.value=e,f;if(n)throw new Go("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",l,t,e);return f}}else{r||(e=Nc(e));var i=t.path||"",y=i.split("/"),x=e,S=1,C=y.length,P=void 0,L=void 0,F=void 0;for(typeof n=="function"?F=n:F=pC;;){if(L=y[S],L&&L.indexOf("~")!=-1&&(L=IY(L)),a&&(L=="__proto__"||L=="prototype"&&S>0&&y[S-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&P===void 0&&(x[L]===void 0?P=y.slice(0,S).join("/"):S==C-1&&(P=t.path),P!==void 0&&F(t,0,e,P)),S++,Array.isArray(x)){if(L==="-")L=x.length;else{if(n&&!sO(L))throw new Go("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",l,t,e);sO(L)&&(L=~~L)}if(S>=C){if(n&&t.op==="add"&&L>x.length)throw new Go("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",l,t,e);var f=l0e[t.op].call(t,x,L,e);if(f.test===!1)throw new Go("Test operation failed","TEST_OPERATION_FAILED",l,t,e);return f}}else if(S>=C){var f=fv[t.op].call(t,x,L,e);if(f.test===!1)throw new Go("Test operation failed","TEST_OPERATION_FAILED",l,t,e);return f}if(x=x[L],n&&S<C&&(!x||typeof x!="object"))throw new Go("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",l,t,e)}}}function sx(e,t,n,r,a){if(r===void 0&&(r=!0),a===void 0&&(a=!0),n&&!Array.isArray(t))throw new Go("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Nc(e));for(var l=new Array(t.length),f=0,i=t.length;f<i;f++)l[f]=d_(e,t[f],n,!0,a,f),e=l[f].newDocument;return l.newDocument=e,l}function u0e(e,t,n){var r=d_(e,t);if(r.test===!1)throw new Go("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function pC(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Go("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(fv[e.op]){if(typeof e.path!="string")throw new Go("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Go('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Go("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Go("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&aO(e.value))throw new Go("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var a=e.path.split("/").length,l=r.split("/").length;if(a!==l+1&&a!==l)throw new Go("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Go("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var f={op:"_get",path:e.from,value:void 0},i=MY([f],n);if(i&&i.name==="OPERATION_PATH_UNRESOLVABLE")throw new Go("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Go("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function MY(e,t,n){try{if(!Array.isArray(e))throw new Go("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)sx(Nc(t),Nc(e),n||!0);else{n=n||pC;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(a){if(a instanceof Go)return a;throw a}}function _T(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),a,l,f;if(n&&r){if(l=e.length,l!=t.length)return!1;for(a=l;a--!==0;)if(!_T(e[a],t[a]))return!1;return!0}if(n!=r)return!1;var i=Object.keys(e);if(l=i.length,l!==Object.keys(t).length)return!1;for(a=l;a--!==0;)if(!t.hasOwnProperty(i[a]))return!1;for(a=l;a--!==0;)if(f=i[a],!_T(e[f],t[f]))return!1;return!0}return e!==e&&t!==t}const c0e=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:Go,_areEquals:_T,applyOperation:d_,applyPatch:sx,applyReducer:u0e,deepClone:o0e,getValueByPointer:fC,validate:MY,validator:pC},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var QL=new WeakMap,d0e=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),h0e=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function f0e(e){return QL.get(e)}function p0e(e,t){return e.observers.get(t)}function m0e(e,t){e.observers.delete(t.callback)}function g0e(e,t){t.unobserve()}function _0e(e,t){var n=[],r,a=f0e(e);if(!a)a=new d0e(e),QL.set(e,a);else{var l=p0e(a,t);r=l&&l.observer}if(r)return r;if(r={},a.value=Nc(e),t){r.callback=t,r.next=null;var f=function(){oO(r)},i=function(){clearTimeout(r.next),r.next=setTimeout(f)};typeof window<"u"&&(window.addEventListener("mouseup",i),window.addEventListener("keyup",i),window.addEventListener("mousedown",i),window.addEventListener("keydown",i),window.addEventListener("change",i))}return r.patches=n,r.object=e,r.unobserve=function(){oO(r),clearTimeout(r.next),m0e(a,r),typeof window<"u"&&(window.removeEventListener("mouseup",i),window.removeEventListener("keyup",i),window.removeEventListener("mousedown",i),window.removeEventListener("keydown",i),window.removeEventListener("change",i))},a.observers.set(t,new h0e(t,r)),r}function oO(e,t){t===void 0&&(t=!1);var n=QL.get(e.object);JL(n.value,e.object,e.patches,"",t),e.patches.length&&sx(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function JL(e,t,n,r,a){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var l=iO(t),f=iO(e),i=!1,y=f.length-1;y>=0;y--){var x=f[y],S=e[x];if(rO(t,x)&&!(t[x]===void 0&&S!==void 0&&Array.isArray(t)===!1)){var C=t[x];typeof S=="object"&&S!=null&&typeof C=="object"&&C!=null&&Array.isArray(S)===Array.isArray(C)?JL(S,C,n,r+"/"+Gg(x),a):S!==C&&(a&&n.push({op:"test",path:r+"/"+Gg(x),value:Nc(S)}),n.push({op:"replace",path:r+"/"+Gg(x),value:Nc(C)}))}else Array.isArray(e)===Array.isArray(t)?(a&&n.push({op:"test",path:r+"/"+Gg(x),value:Nc(S)}),n.push({op:"remove",path:r+"/"+Gg(x)}),i=!0):(a&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!i&&l.length==f.length))for(var y=0;y<l.length;y++){var x=l[y];!rO(e,x)&&t[x]!==void 0&&n.push({op:"add",path:r+"/"+Gg(x),value:Nc(t[x])})}}}function y0e(e,t,n){n===void 0&&(n=!1);var r=[];return JL(e,t,r,"",n),r}const v0e=Object.freeze(Object.defineProperty({__proto__:null,compare:y0e,generate:oO,observe:_0e,unobserve:g0e},Symbol.toStringTag,{value:"Module"}));Object.assign({},c0e,v0e,{JsonPatchError:RY,deepClone:Nc,escapePathComponent:Gg,unescapePathComponent:IY});function x0e(){let e=0,t=0;for(let r=0;r<28;r+=7){let a=this.buf[this.pos++];if(e|=(a&127)<<r,!(a&128))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(n&15)<<28,t=(n&112)>>4,!(n&128))return this.assertBounds(),[e,t];for(let r=3;r<=31;r+=7){let a=this.buf[this.pos++];if(t|=(a&127)<<r,!(a&128))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function Z5(e,t,n){for(let l=0;l<28;l=l+7){const f=e>>>l,i=!(!(f>>>7)&&t==0),y=(i?f|128:f)&255;if(n.push(y),!i)return}const r=e>>>28&15|(t&7)<<4,a=!!(t>>3);if(n.push((a?r|128:r)&255),!!a){for(let l=3;l<31;l=l+7){const f=t>>>l,i=!!(f>>>7),y=(i?f|128:f)&255;if(n.push(y),!i)return}n.push(t>>>31&1)}}const z4=4294967296;function _U(e){const t=e[0]==="-";t&&(e=e.slice(1));const n=1e6;let r=0,a=0;function l(f,i){const y=Number(e.slice(f,i));a*=n,r=r*n+y,r>=z4&&(a=a+(r/z4|0),r=r%z4)}return l(-24,-18),l(-18,-12),l(-12,-6),l(-6),t?OY(r,a):eD(r,a)}function b0e(e,t){let n=eD(e,t);const r=n.hi&2147483648;r&&(n=OY(n.lo,n.hi));const a=PY(n.lo,n.hi);return r?"-"+a:a}function PY(e,t){if({lo:e,hi:t}=w0e(e,t),t<=2097151)return String(z4*t+e);const n=e&16777215,r=(e>>>24|t<<8)&16777215,a=t>>16&65535;let l=n+r*6777216+a*6710656,f=r+a*8147497,i=a*2;const y=1e7;return l>=y&&(f+=Math.floor(l/y),l%=y),f>=y&&(i+=Math.floor(f/y),f%=y),i.toString()+yU(f)+yU(l)}function w0e(e,t){return{lo:e>>>0,hi:t>>>0}}function eD(e,t){return{lo:e|0,hi:t|0}}function OY(e,t){return t=~t,e?e=~e+1:t+=1,eD(e,t)}const yU=e=>{const t=String(e);return"0000000".slice(t.length)+t};function vU(e,t){if(e>=0){for(;e>127;)t.push(e&127|128),e=e>>>7;t.push(e)}else{for(let n=0;n<9;n++)t.push(e&127|128),e=e>>7;t.push(1)}}function T0e(){let e=this.buf[this.pos++],t=e&127;if(!(e&128))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<7,!(e&128))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<14,!(e&128))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<21,!(e&128))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(e&15)<<28;for(let n=5;e&128&&n<10;n++)e=this.buf[this.pos++];if(e&128)throw new Error("invalid varint");return this.assertBounds(),t>>>0}var xU={};const uf=E0e();function E0e(){const e=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof e.getBigInt64=="function"&&typeof e.getBigUint64=="function"&&typeof e.setBigInt64=="function"&&typeof e.setBigUint64=="function"&&(!!globalThis.Deno||typeof process!="object"||typeof xU!="object"||xU.BUF_BIGINT_DISABLE!=="1")){const n=BigInt("-9223372036854775808"),r=BigInt("9223372036854775807"),a=BigInt("0"),l=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(f){const i=typeof f=="bigint"?f:BigInt(f);if(i>r||i<n)throw new Error(`invalid int64: ${f}`);return i},uParse(f){const i=typeof f=="bigint"?f:BigInt(f);if(i>l||i<a)throw new Error(`invalid uint64: ${f}`);return i},enc(f){return e.setBigInt64(0,this.parse(f),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(f){return e.setBigInt64(0,this.uParse(f),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec(f,i){return e.setInt32(0,f,!0),e.setInt32(4,i,!0),e.getBigInt64(0,!0)},uDec(f,i){return e.setInt32(0,f,!0),e.setInt32(4,i,!0),e.getBigUint64(0,!0)}}}return{zero:"0",supported:!1,parse(n){return typeof n!="string"&&(n=n.toString()),bU(n),n},uParse(n){return typeof n!="string"&&(n=n.toString()),wU(n),n},enc(n){return typeof n!="string"&&(n=n.toString()),bU(n),_U(n)},uEnc(n){return typeof n!="string"&&(n=n.toString()),wU(n),_U(n)},dec(n,r){return b0e(n,r)},uDec(n,r){return PY(n,r)}}}function bU(e){if(!/^-?[0-9]+$/.test(e))throw new Error("invalid int64: "+e)}function wU(e){if(!/^[0-9]+$/.test(e))throw new Error("invalid uint64: "+e)}const W5=Symbol.for("@bufbuild/protobuf/text-encoding");function LY(){if(globalThis[W5]==null){const e=new globalThis.TextEncoder,t=new globalThis.TextDecoder;globalThis[W5]={encodeUtf8(n){return e.encode(n)},decodeUtf8(n){return t.decode(n)},checkUtf8(n){try{return encodeURIComponent(n),!0}catch{return!1}}}}return globalThis[W5]}var zm;(function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"})(zm||(zm={}));const S0e=34028234663852886e22,A0e=-34028234663852886e22,C0e=4294967295,k0e=2147483647,I0e=-2147483648;class Ja{constructor(t=LY().encodeUtf8){this.encodeUtf8=t,this.stack=[],this.chunks=[],this.buf=[]}finish(){this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]);let t=0;for(let a=0;a<this.chunks.length;a++)t+=this.chunks[a].length;let n=new Uint8Array(t),r=0;for(let a=0;a<this.chunks.length;a++)n.set(this.chunks[a],r),r+=this.chunks[a].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,n){return this.uint32((t<<3|n)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(TU(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return X5(t),vU(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let n=this.encodeUtf8(t);return this.uint32(n.byteLength),this.raw(n)}float(t){R0e(t);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,t,!0),this.raw(n)}double(t){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,t,!0),this.raw(n)}fixed32(t){TU(t);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,t,!0),this.raw(n)}sfixed32(t){X5(t);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,t,!0),this.raw(n)}sint32(t){return X5(t),t=(t<<1^t>>31)>>>0,vU(t,this.buf),this}sfixed64(t){let n=new Uint8Array(8),r=new DataView(n.buffer),a=uf.enc(t);return r.setInt32(0,a.lo,!0),r.setInt32(4,a.hi,!0),this.raw(n)}fixed64(t){let n=new Uint8Array(8),r=new DataView(n.buffer),a=uf.uEnc(t);return r.setInt32(0,a.lo,!0),r.setInt32(4,a.hi,!0),this.raw(n)}int64(t){let n=uf.enc(t);return Z5(n.lo,n.hi,this.buf),this}sint64(t){const n=uf.enc(t),r=n.hi>>31,a=n.lo<<1^r,l=(n.hi<<1|n.lo>>>31)^r;return Z5(a,l,this.buf),this}uint64(t){const n=uf.uEnc(t);return Z5(n.lo,n.hi,this.buf),this}}class Ii{constructor(t,n=LY().decodeUtf8){this.decodeUtf8=n,this.varint64=x0e,this.uint32=T0e,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength)}tag(){let t=this.uint32(),n=t>>>3,r=t&7;if(n<=0||r<0||r>5)throw new Error("illegal tag: field no "+n+" wire type "+r);return[n,r]}skip(t,n){let r=this.pos;switch(t){case zm.Varint:for(;this.buf[this.pos++]&128;);break;case zm.Bit64:this.pos+=4;case zm.Bit32:this.pos+=4;break;case zm.LengthDelimited:let a=this.uint32();this.pos+=a;break;case zm.StartGroup:for(;;){const[l,f]=this.tag();if(f===zm.EndGroup){if(n!==void 0&&l!==n)throw new Error("invalid end group tag");break}this.skip(f,l)}break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return uf.dec(...this.varint64())}uint64(){return uf.uDec(...this.varint64())}sint64(){let[t,n]=this.varint64(),r=-(t&1);return t=(t>>>1|(n&1)<<31)^r,n=n>>>1^r,uf.dec(t,n)}bool(){let[t,n]=this.varint64();return t!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return uf.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return uf.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),n=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(n,n+t)}string(){return this.decodeUtf8(this.bytes())}}function X5(e){if(typeof e=="string")e=Number(e);else if(typeof e!="number")throw new Error("invalid int32: "+typeof e);if(!Number.isInteger(e)||e>k0e||e<I0e)throw new Error("invalid int32: "+e)}function TU(e){if(typeof e=="string")e=Number(e);else if(typeof e!="number")throw new Error("invalid uint32: "+typeof e);if(!Number.isInteger(e)||e>C0e||e<0)throw new Error("invalid uint32: "+e)}function R0e(e){if(typeof e=="string"){const t=e;if(e=Number(e),Number.isNaN(e)&&t!=="NaN")throw new Error("invalid float32: "+t)}else if(typeof e!="number")throw new Error("invalid float32: "+typeof e);if(Number.isFinite(e)&&(e>S0e||e<A0e))throw new Error("invalid float32: "+e)}function Y5(){return{fields:{}}}var p2={encode(e,t=new Ja){return Object.entries(e.fields).forEach(([n,r])=>{r!==void 0&&lO.encode({key:n,value:r},t.uint32(10).fork()).join()}),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=Y5();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;const f=lO.decode(n,n.uint32());f.value!==void 0&&(a.fields[f.key]=f.value);continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return p2.fromPartial(e??{})},fromPartial(e){var t;const n=Y5();return n.fields=Object.entries((t=e.fields)!=null?t:{}).reduce((r,[a,l])=>(l!==void 0&&(r[a]=l),r),{}),n},wrap(e){const t=Y5();if(e!==void 0)for(const n of Object.keys(e))t.fields[n]=e[n];return t},unwrap(e){const t={};if(e.fields)for(const n of Object.keys(e.fields))t[n]=e.fields[n];return t}};function EU(){return{key:"",value:void 0}}var lO={encode(e,t=new Ja){return e.key!==""&&t.uint32(10).string(e.key),e.value!==void 0&&ka.encode(ka.wrap(e.value),t.uint32(18).fork()).join(),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=EU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.key=n.string();continue}case 2:{if(l!==18)break;a.value=ka.unwrap(ka.decode(n,n.uint32()));continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return lO.fromPartial(e??{})},fromPartial(e){var t,n;const r=EU();return r.key=(t=e.key)!=null?t:"",r.value=(n=e.value)!=null?n:void 0,r}};function K5(){return{nullValue:void 0,numberValue:void 0,stringValue:void 0,boolValue:void 0,structValue:void 0,listValue:void 0}}var ka={encode(e,t=new Ja){return e.nullValue!==void 0&&t.uint32(8).int32(e.nullValue),e.numberValue!==void 0&&t.uint32(17).double(e.numberValue),e.stringValue!==void 0&&t.uint32(26).string(e.stringValue),e.boolValue!==void 0&&t.uint32(32).bool(e.boolValue),e.structValue!==void 0&&p2.encode(p2.wrap(e.structValue),t.uint32(42).fork()).join(),e.listValue!==void 0&&m2.encode(m2.wrap(e.listValue),t.uint32(50).fork()).join(),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=K5();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==8)break;a.nullValue=n.int32();continue}case 2:{if(l!==17)break;a.numberValue=n.double();continue}case 3:{if(l!==26)break;a.stringValue=n.string();continue}case 4:{if(l!==32)break;a.boolValue=n.bool();continue}case 5:{if(l!==42)break;a.structValue=p2.unwrap(p2.decode(n,n.uint32()));continue}case 6:{if(l!==50)break;a.listValue=m2.unwrap(m2.decode(n,n.uint32()));continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return ka.fromPartial(e??{})},fromPartial(e){var t,n,r,a,l,f;const i=K5();return i.nullValue=(t=e.nullValue)!=null?t:void 0,i.numberValue=(n=e.numberValue)!=null?n:void 0,i.stringValue=(r=e.stringValue)!=null?r:void 0,i.boolValue=(a=e.boolValue)!=null?a:void 0,i.structValue=(l=e.structValue)!=null?l:void 0,i.listValue=(f=e.listValue)!=null?f:void 0,i},wrap(e){const t=K5();if(e===null)t.nullValue=0;else if(typeof e=="boolean")t.boolValue=e;else if(typeof e=="number")t.numberValue=e;else if(typeof e=="string")t.stringValue=e;else if(globalThis.Array.isArray(e))t.listValue=e;else if(typeof e=="object")t.structValue=e;else if(typeof e<"u")throw new globalThis.Error("Unsupported any value type: "+typeof e);return t},unwrap(e){if(e.stringValue!==void 0)return e.stringValue;if((e==null?void 0:e.numberValue)!==void 0)return e.numberValue;if((e==null?void 0:e.boolValue)!==void 0)return e.boolValue;if((e==null?void 0:e.structValue)!==void 0)return e.structValue;if((e==null?void 0:e.listValue)!==void 0)return e.listValue;if((e==null?void 0:e.nullValue)!==void 0)return null}};function Q5(){return{values:[]}}var m2={encode(e,t=new Ja){for(const n of e.values)ka.encode(ka.wrap(n),t.uint32(10).fork()).join();return t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=Q5();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.values.push(ka.unwrap(ka.decode(n,n.uint32())));continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return m2.fromPartial(e??{})},fromPartial(e){var t;const n=Q5();return n.values=((t=e.values)==null?void 0:t.map(r=>r))||[],n},wrap(e){const t=Q5();return t.values=e??[],t},unwrap(e){return e!=null&&e.hasOwnProperty("values")&&globalThis.Array.isArray(e.values)?e.values:e}},DY=(e=>(e[e.ADD=0]="ADD",e[e.REMOVE=1]="REMOVE",e[e.REPLACE=2]="REPLACE",e[e.MOVE=3]="MOVE",e[e.COPY=4]="COPY",e[e.TEST=5]="TEST",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(DY||{});function SU(){return{op:0,path:"",from:void 0,value:void 0}}var F4={encode(e,t=new Ja){return e.op!==0&&t.uint32(8).int32(e.op),e.path!==""&&t.uint32(18).string(e.path),e.from!==void 0&&t.uint32(26).string(e.from),e.value!==void 0&&ka.encode(ka.wrap(e.value),t.uint32(34).fork()).join(),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=SU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==8)break;a.op=n.int32();continue}case 2:{if(l!==18)break;a.path=n.string();continue}case 3:{if(l!==26)break;a.from=n.string();continue}case 4:{if(l!==34)break;a.value=ka.unwrap(ka.decode(n,n.uint32()));continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return F4.fromPartial(e??{})},fromPartial(e){var t,n,r,a;const l=SU();return l.op=(t=e.op)!=null?t:0,l.path=(n=e.path)!=null?n:"",l.from=(r=e.from)!=null?r:void 0,l.value=(a=e.value)!=null?a:void 0,l}};function AU(){return{id:"",type:"",function:void 0}}var B4={encode(e,t=new Ja){return e.id!==""&&t.uint32(10).string(e.id),e.type!==""&&t.uint32(18).string(e.type),e.function!==void 0&&j4.encode(e.function,t.uint32(26).fork()).join(),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=AU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.id=n.string();continue}case 2:{if(l!==18)break;a.type=n.string();continue}case 3:{if(l!==26)break;a.function=j4.decode(n,n.uint32());continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return B4.fromPartial(e??{})},fromPartial(e){var t,n;const r=AU();return r.id=(t=e.id)!=null?t:"",r.type=(n=e.type)!=null?n:"",r.function=e.function!==void 0&&e.function!==null?j4.fromPartial(e.function):void 0,r}};function CU(){return{name:"",arguments:""}}var j4={encode(e,t=new Ja){return e.name!==""&&t.uint32(10).string(e.name),e.arguments!==""&&t.uint32(18).string(e.arguments),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=CU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.name=n.string();continue}case 2:{if(l!==18)break;a.arguments=n.string();continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return j4.fromPartial(e??{})},fromPartial(e){var t,n;const r=CU();return r.name=(t=e.name)!=null?t:"",r.arguments=(n=e.arguments)!=null?n:"",r}};function kU(){return{id:"",role:"",content:void 0,name:void 0,toolCalls:[],toolCallId:void 0,error:void 0}}var U4={encode(e,t=new Ja){e.id!==""&&t.uint32(10).string(e.id),e.role!==""&&t.uint32(18).string(e.role),e.content!==void 0&&t.uint32(26).string(e.content),e.name!==void 0&&t.uint32(34).string(e.name);for(const n of e.toolCalls)B4.encode(n,t.uint32(42).fork()).join();return e.toolCallId!==void 0&&t.uint32(50).string(e.toolCallId),e.error!==void 0&&t.uint32(58).string(e.error),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=kU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.id=n.string();continue}case 2:{if(l!==18)break;a.role=n.string();continue}case 3:{if(l!==26)break;a.content=n.string();continue}case 4:{if(l!==34)break;a.name=n.string();continue}case 5:{if(l!==42)break;a.toolCalls.push(B4.decode(n,n.uint32()));continue}case 6:{if(l!==50)break;a.toolCallId=n.string();continue}case 7:{if(l!==58)break;a.error=n.string();continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return U4.fromPartial(e??{})},fromPartial(e){var t,n,r,a,l,f,i;const y=kU();return y.id=(t=e.id)!=null?t:"",y.role=(n=e.role)!=null?n:"",y.content=(r=e.content)!=null?r:void 0,y.name=(a=e.name)!=null?a:void 0,y.toolCalls=((l=e.toolCalls)==null?void 0:l.map(x=>B4.fromPartial(x)))||[],y.toolCallId=(f=e.toolCallId)!=null?f:void 0,y.error=(i=e.error)!=null?i:void 0,y}},NY=(e=>(e[e.TEXT_MESSAGE_START=0]="TEXT_MESSAGE_START",e[e.TEXT_MESSAGE_CONTENT=1]="TEXT_MESSAGE_CONTENT",e[e.TEXT_MESSAGE_END=2]="TEXT_MESSAGE_END",e[e.TOOL_CALL_START=3]="TOOL_CALL_START",e[e.TOOL_CALL_ARGS=4]="TOOL_CALL_ARGS",e[e.TOOL_CALL_END=5]="TOOL_CALL_END",e[e.STATE_SNAPSHOT=6]="STATE_SNAPSHOT",e[e.STATE_DELTA=7]="STATE_DELTA",e[e.MESSAGES_SNAPSHOT=8]="MESSAGES_SNAPSHOT",e[e.RAW=9]="RAW",e[e.CUSTOM=10]="CUSTOM",e[e.RUN_STARTED=11]="RUN_STARTED",e[e.RUN_FINISHED=12]="RUN_FINISHED",e[e.RUN_ERROR=13]="RUN_ERROR",e[e.STEP_STARTED=14]="STEP_STARTED",e[e.STEP_FINISHED=15]="STEP_FINISHED",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(NY||{});function IU(){return{type:0,timestamp:void 0,rawEvent:void 0}}var Oi={encode(e,t=new Ja){return e.type!==0&&t.uint32(8).int32(e.type),e.timestamp!==void 0&&t.uint32(16).int64(e.timestamp),e.rawEvent!==void 0&&ka.encode(ka.wrap(e.rawEvent),t.uint32(26).fork()).join(),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=IU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==8)break;a.type=n.int32();continue}case 2:{if(l!==16)break;a.timestamp=M0e(n.int64());continue}case 3:{if(l!==26)break;a.rawEvent=ka.unwrap(ka.decode(n,n.uint32()));continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return Oi.fromPartial(e??{})},fromPartial(e){var t,n,r;const a=IU();return a.type=(t=e.type)!=null?t:0,a.timestamp=(n=e.timestamp)!=null?n:void 0,a.rawEvent=(r=e.rawEvent)!=null?r:void 0,a}};function RU(){return{baseEvent:void 0,messageId:"",role:void 0}}var V4={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.messageId!==""&&t.uint32(18).string(e.messageId),e.role!==void 0&&t.uint32(26).string(e.role),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=RU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.messageId=n.string();continue}case 3:{if(l!==26)break;a.role=n.string();continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return V4.fromPartial(e??{})},fromPartial(e){var t,n;const r=RU();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,r.messageId=(t=e.messageId)!=null?t:"",r.role=(n=e.role)!=null?n:void 0,r}};function MU(){return{baseEvent:void 0,messageId:"",delta:""}}var $4={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.messageId!==""&&t.uint32(18).string(e.messageId),e.delta!==""&&t.uint32(26).string(e.delta),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=MU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.messageId=n.string();continue}case 3:{if(l!==26)break;a.delta=n.string();continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return $4.fromPartial(e??{})},fromPartial(e){var t,n;const r=MU();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,r.messageId=(t=e.messageId)!=null?t:"",r.delta=(n=e.delta)!=null?n:"",r}};function PU(){return{baseEvent:void 0,messageId:""}}var H4={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.messageId!==""&&t.uint32(18).string(e.messageId),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=PU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.messageId=n.string();continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return H4.fromPartial(e??{})},fromPartial(e){var t;const n=PU();return n.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,n.messageId=(t=e.messageId)!=null?t:"",n}};function OU(){return{baseEvent:void 0,toolCallId:"",toolCallName:"",parentMessageId:void 0}}var G4={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.toolCallId!==""&&t.uint32(18).string(e.toolCallId),e.toolCallName!==""&&t.uint32(26).string(e.toolCallName),e.parentMessageId!==void 0&&t.uint32(34).string(e.parentMessageId),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=OU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.toolCallId=n.string();continue}case 3:{if(l!==26)break;a.toolCallName=n.string();continue}case 4:{if(l!==34)break;a.parentMessageId=n.string();continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return G4.fromPartial(e??{})},fromPartial(e){var t,n,r;const a=OU();return a.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,a.toolCallId=(t=e.toolCallId)!=null?t:"",a.toolCallName=(n=e.toolCallName)!=null?n:"",a.parentMessageId=(r=e.parentMessageId)!=null?r:void 0,a}};function LU(){return{baseEvent:void 0,toolCallId:"",delta:""}}var q4={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.toolCallId!==""&&t.uint32(18).string(e.toolCallId),e.delta!==""&&t.uint32(26).string(e.delta),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=LU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.toolCallId=n.string();continue}case 3:{if(l!==26)break;a.delta=n.string();continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return q4.fromPartial(e??{})},fromPartial(e){var t,n;const r=LU();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,r.toolCallId=(t=e.toolCallId)!=null?t:"",r.delta=(n=e.delta)!=null?n:"",r}};function DU(){return{baseEvent:void 0,toolCallId:""}}var Z4={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.toolCallId!==""&&t.uint32(18).string(e.toolCallId),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=DU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.toolCallId=n.string();continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return Z4.fromPartial(e??{})},fromPartial(e){var t;const n=DU();return n.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,n.toolCallId=(t=e.toolCallId)!=null?t:"",n}};function NU(){return{baseEvent:void 0,snapshot:void 0}}var W4={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.snapshot!==void 0&&ka.encode(ka.wrap(e.snapshot),t.uint32(18).fork()).join(),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=NU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.snapshot=ka.unwrap(ka.decode(n,n.uint32()));continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return W4.fromPartial(e??{})},fromPartial(e){var t;const n=NU();return n.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,n.snapshot=(t=e.snapshot)!=null?t:void 0,n}};function zU(){return{baseEvent:void 0,delta:[]}}var X4={encode(e,t=new Ja){e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join();for(const n of e.delta)F4.encode(n,t.uint32(18).fork()).join();return t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=zU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.delta.push(F4.decode(n,n.uint32()));continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return X4.fromPartial(e??{})},fromPartial(e){var t;const n=zU();return n.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,n.delta=((t=e.delta)==null?void 0:t.map(r=>F4.fromPartial(r)))||[],n}};function FU(){return{baseEvent:void 0,messages:[]}}var Y4={encode(e,t=new Ja){e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join();for(const n of e.messages)U4.encode(n,t.uint32(18).fork()).join();return t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=FU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.messages.push(U4.decode(n,n.uint32()));continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return Y4.fromPartial(e??{})},fromPartial(e){var t;const n=FU();return n.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,n.messages=((t=e.messages)==null?void 0:t.map(r=>U4.fromPartial(r)))||[],n}};function BU(){return{baseEvent:void 0,event:void 0,source:void 0}}var K4={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.event!==void 0&&ka.encode(ka.wrap(e.event),t.uint32(18).fork()).join(),e.source!==void 0&&t.uint32(26).string(e.source),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=BU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.event=ka.unwrap(ka.decode(n,n.uint32()));continue}case 3:{if(l!==26)break;a.source=n.string();continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return K4.fromPartial(e??{})},fromPartial(e){var t,n;const r=BU();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,r.event=(t=e.event)!=null?t:void 0,r.source=(n=e.source)!=null?n:void 0,r}};function jU(){return{baseEvent:void 0,name:"",value:void 0}}var Q4={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.name!==""&&t.uint32(18).string(e.name),e.value!==void 0&&ka.encode(ka.wrap(e.value),t.uint32(26).fork()).join(),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=jU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.name=n.string();continue}case 3:{if(l!==26)break;a.value=ka.unwrap(ka.decode(n,n.uint32()));continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return Q4.fromPartial(e??{})},fromPartial(e){var t,n;const r=jU();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,r.name=(t=e.name)!=null?t:"",r.value=(n=e.value)!=null?n:void 0,r}};function UU(){return{baseEvent:void 0,threadId:"",runId:""}}var J4={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.threadId!==""&&t.uint32(18).string(e.threadId),e.runId!==""&&t.uint32(26).string(e.runId),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=UU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.threadId=n.string();continue}case 3:{if(l!==26)break;a.runId=n.string();continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return J4.fromPartial(e??{})},fromPartial(e){var t,n;const r=UU();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,r.threadId=(t=e.threadId)!=null?t:"",r.runId=(n=e.runId)!=null?n:"",r}};function VU(){return{baseEvent:void 0,threadId:"",runId:"",result:void 0}}var eA={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.threadId!==""&&t.uint32(18).string(e.threadId),e.runId!==""&&t.uint32(26).string(e.runId),e.result!==void 0&&ka.encode(ka.wrap(e.result),t.uint32(34).fork()).join(),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=VU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.threadId=n.string();continue}case 3:{if(l!==26)break;a.runId=n.string();continue}case 4:{if(l!==34)break;a.result=ka.unwrap(ka.decode(n,n.uint32()));continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return eA.fromPartial(e??{})},fromPartial(e){var t,n,r;const a=VU();return a.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,a.threadId=(t=e.threadId)!=null?t:"",a.runId=(n=e.runId)!=null?n:"",a.result=(r=e.result)!=null?r:void 0,a}};function $U(){return{baseEvent:void 0,code:void 0,message:""}}var tA={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.code!==void 0&&t.uint32(18).string(e.code),e.message!==""&&t.uint32(26).string(e.message),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=$U();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.code=n.string();continue}case 3:{if(l!==26)break;a.message=n.string();continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return tA.fromPartial(e??{})},fromPartial(e){var t,n;const r=$U();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,r.code=(t=e.code)!=null?t:void 0,r.message=(n=e.message)!=null?n:"",r}};function HU(){return{baseEvent:void 0,stepName:""}}var nA={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.stepName!==""&&t.uint32(18).string(e.stepName),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=HU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.stepName=n.string();continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return nA.fromPartial(e??{})},fromPartial(e){var t;const n=HU();return n.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,n.stepName=(t=e.stepName)!=null?t:"",n}};function GU(){return{baseEvent:void 0,stepName:""}}var rA={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.stepName!==""&&t.uint32(18).string(e.stepName),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=GU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.stepName=n.string();continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return rA.fromPartial(e??{})},fromPartial(e){var t;const n=GU();return n.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,n.stepName=(t=e.stepName)!=null?t:"",n}};function qU(){return{baseEvent:void 0,messageId:void 0,role:void 0,delta:void 0}}var iA={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.messageId!==void 0&&t.uint32(18).string(e.messageId),e.role!==void 0&&t.uint32(26).string(e.role),e.delta!==void 0&&t.uint32(34).string(e.delta),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=qU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.messageId=n.string();continue}case 3:{if(l!==26)break;a.role=n.string();continue}case 4:{if(l!==34)break;a.delta=n.string();continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return iA.fromPartial(e??{})},fromPartial(e){var t,n,r;const a=qU();return a.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,a.messageId=(t=e.messageId)!=null?t:void 0,a.role=(n=e.role)!=null?n:void 0,a.delta=(r=e.delta)!=null?r:void 0,a}};function ZU(){return{baseEvent:void 0,toolCallId:void 0,toolCallName:void 0,parentMessageId:void 0,delta:void 0}}var sA={encode(e,t=new Ja){return e.baseEvent!==void 0&&Oi.encode(e.baseEvent,t.uint32(10).fork()).join(),e.toolCallId!==void 0&&t.uint32(18).string(e.toolCallId),e.toolCallName!==void 0&&t.uint32(26).string(e.toolCallName),e.parentMessageId!==void 0&&t.uint32(34).string(e.parentMessageId),e.delta!==void 0&&t.uint32(42).string(e.delta),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=ZU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.baseEvent=Oi.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.toolCallId=n.string();continue}case 3:{if(l!==26)break;a.toolCallName=n.string();continue}case 4:{if(l!==34)break;a.parentMessageId=n.string();continue}case 5:{if(l!==42)break;a.delta=n.string();continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return sA.fromPartial(e??{})},fromPartial(e){var t,n,r,a;const l=ZU();return l.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?Oi.fromPartial(e.baseEvent):void 0,l.toolCallId=(t=e.toolCallId)!=null?t:void 0,l.toolCallName=(n=e.toolCallName)!=null?n:void 0,l.parentMessageId=(r=e.parentMessageId)!=null?r:void 0,l.delta=(a=e.delta)!=null?a:void 0,l}};function WU(){return{textMessageStart:void 0,textMessageContent:void 0,textMessageEnd:void 0,toolCallStart:void 0,toolCallArgs:void 0,toolCallEnd:void 0,stateSnapshot:void 0,stateDelta:void 0,messagesSnapshot:void 0,raw:void 0,custom:void 0,runStarted:void 0,runFinished:void 0,runError:void 0,stepStarted:void 0,stepFinished:void 0,textMessageChunk:void 0,toolCallChunk:void 0}}var zY={encode(e,t=new Ja){return e.textMessageStart!==void 0&&V4.encode(e.textMessageStart,t.uint32(10).fork()).join(),e.textMessageContent!==void 0&&$4.encode(e.textMessageContent,t.uint32(18).fork()).join(),e.textMessageEnd!==void 0&&H4.encode(e.textMessageEnd,t.uint32(26).fork()).join(),e.toolCallStart!==void 0&&G4.encode(e.toolCallStart,t.uint32(34).fork()).join(),e.toolCallArgs!==void 0&&q4.encode(e.toolCallArgs,t.uint32(42).fork()).join(),e.toolCallEnd!==void 0&&Z4.encode(e.toolCallEnd,t.uint32(50).fork()).join(),e.stateSnapshot!==void 0&&W4.encode(e.stateSnapshot,t.uint32(58).fork()).join(),e.stateDelta!==void 0&&X4.encode(e.stateDelta,t.uint32(66).fork()).join(),e.messagesSnapshot!==void 0&&Y4.encode(e.messagesSnapshot,t.uint32(74).fork()).join(),e.raw!==void 0&&K4.encode(e.raw,t.uint32(82).fork()).join(),e.custom!==void 0&&Q4.encode(e.custom,t.uint32(90).fork()).join(),e.runStarted!==void 0&&J4.encode(e.runStarted,t.uint32(98).fork()).join(),e.runFinished!==void 0&&eA.encode(e.runFinished,t.uint32(106).fork()).join(),e.runError!==void 0&&tA.encode(e.runError,t.uint32(114).fork()).join(),e.stepStarted!==void 0&&nA.encode(e.stepStarted,t.uint32(122).fork()).join(),e.stepFinished!==void 0&&rA.encode(e.stepFinished,t.uint32(130).fork()).join(),e.textMessageChunk!==void 0&&iA.encode(e.textMessageChunk,t.uint32(138).fork()).join(),e.toolCallChunk!==void 0&&sA.encode(e.toolCallChunk,t.uint32(146).fork()).join(),t},decode(e,t){const n=e instanceof Ii?e:new Ii(e),r=t===void 0?n.len:n.pos+t,a=WU();for(;n.pos<r;){const l=n.uint32();switch(l>>>3){case 1:{if(l!==10)break;a.textMessageStart=V4.decode(n,n.uint32());continue}case 2:{if(l!==18)break;a.textMessageContent=$4.decode(n,n.uint32());continue}case 3:{if(l!==26)break;a.textMessageEnd=H4.decode(n,n.uint32());continue}case 4:{if(l!==34)break;a.toolCallStart=G4.decode(n,n.uint32());continue}case 5:{if(l!==42)break;a.toolCallArgs=q4.decode(n,n.uint32());continue}case 6:{if(l!==50)break;a.toolCallEnd=Z4.decode(n,n.uint32());continue}case 7:{if(l!==58)break;a.stateSnapshot=W4.decode(n,n.uint32());continue}case 8:{if(l!==66)break;a.stateDelta=X4.decode(n,n.uint32());continue}case 9:{if(l!==74)break;a.messagesSnapshot=Y4.decode(n,n.uint32());continue}case 10:{if(l!==82)break;a.raw=K4.decode(n,n.uint32());continue}case 11:{if(l!==90)break;a.custom=Q4.decode(n,n.uint32());continue}case 12:{if(l!==98)break;a.runStarted=J4.decode(n,n.uint32());continue}case 13:{if(l!==106)break;a.runFinished=eA.decode(n,n.uint32());continue}case 14:{if(l!==114)break;a.runError=tA.decode(n,n.uint32());continue}case 15:{if(l!==122)break;a.stepStarted=nA.decode(n,n.uint32());continue}case 16:{if(l!==130)break;a.stepFinished=rA.decode(n,n.uint32());continue}case 17:{if(l!==138)break;a.textMessageChunk=iA.decode(n,n.uint32());continue}case 18:{if(l!==146)break;a.toolCallChunk=sA.decode(n,n.uint32());continue}}if((l&7)===4||l===0)break;n.skip(l&7)}return a},create(e){return zY.fromPartial(e??{})},fromPartial(e){const t=WU();return t.textMessageStart=e.textMessageStart!==void 0&&e.textMessageStart!==null?V4.fromPartial(e.textMessageStart):void 0,t.textMessageContent=e.textMessageContent!==void 0&&e.textMessageContent!==null?$4.fromPartial(e.textMessageContent):void 0,t.textMessageEnd=e.textMessageEnd!==void 0&&e.textMessageEnd!==null?H4.fromPartial(e.textMessageEnd):void 0,t.toolCallStart=e.toolCallStart!==void 0&&e.toolCallStart!==null?G4.fromPartial(e.toolCallStart):void 0,t.toolCallArgs=e.toolCallArgs!==void 0&&e.toolCallArgs!==null?q4.fromPartial(e.toolCallArgs):void 0,t.toolCallEnd=e.toolCallEnd!==void 0&&e.toolCallEnd!==null?Z4.fromPartial(e.toolCallEnd):void 0,t.stateSnapshot=e.stateSnapshot!==void 0&&e.stateSnapshot!==null?W4.fromPartial(e.stateSnapshot):void 0,t.stateDelta=e.stateDelta!==void 0&&e.stateDelta!==null?X4.fromPartial(e.stateDelta):void 0,t.messagesSnapshot=e.messagesSnapshot!==void 0&&e.messagesSnapshot!==null?Y4.fromPartial(e.messagesSnapshot):void 0,t.raw=e.raw!==void 0&&e.raw!==null?K4.fromPartial(e.raw):void 0,t.custom=e.custom!==void 0&&e.custom!==null?Q4.fromPartial(e.custom):void 0,t.runStarted=e.runStarted!==void 0&&e.runStarted!==null?J4.fromPartial(e.runStarted):void 0,t.runFinished=e.runFinished!==void 0&&e.runFinished!==null?eA.fromPartial(e.runFinished):void 0,t.runError=e.runError!==void 0&&e.runError!==null?tA.fromPartial(e.runError):void 0,t.stepStarted=e.stepStarted!==void 0&&e.stepStarted!==null?nA.fromPartial(e.stepStarted):void 0,t.stepFinished=e.stepFinished!==void 0&&e.stepFinished!==null?rA.fromPartial(e.stepFinished):void 0,t.textMessageChunk=e.textMessageChunk!==void 0&&e.textMessageChunk!==null?iA.fromPartial(e.textMessageChunk):void 0,t.toolCallChunk=e.toolCallChunk!==void 0&&e.toolCallChunk!==null?sA.fromPartial(e.toolCallChunk):void 0,t}};function M0e(e){const t=globalThis.Number(e.toString());if(t>globalThis.Number.MAX_SAFE_INTEGER)throw new globalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");if(t<globalThis.Number.MIN_SAFE_INTEGER)throw new globalThis.Error("Value is smaller than Number.MIN_SAFE_INTEGER");return t}function P0e(e){var t;const n=zY.decode(e),r=Object.values(n).find(a=>a!==void 0);if(!r)throw new Error("Invalid event");if(r.type=NY[r.baseEvent.type],r.timestamp=r.baseEvent.timestamp,r.rawEvent=r.baseEvent.rawEvent,r.type===Zn.MESSAGES_SNAPSHOT)for(const a of r.messages){const l=a;((t=l.toolCalls)==null?void 0:t.length)===0&&(l.toolCalls=void 0)}if(r.type===Zn.STATE_DELTA)for(const a of r.delta)a.op=DY[a.op].toLowerCase(),Object.keys(a).forEach(l=>{a[l]===void 0&&delete a[l]});return Object.keys(r).forEach(a=>{r[a]===void 0&&delete r[a]}),oY.parse(r)}var O0e="application/vnd.ag-ui.event+proto",Sa;(function(e){e.assertEqual=a=>{};function t(a){}e.assertIs=t;function n(a){throw new Error}e.assertNever=n,e.arrayToEnum=a=>{const l={};for(const f of a)l[f]=f;return l},e.getValidEnumValues=a=>{const l=e.objectKeys(a).filter(i=>typeof a[a[i]]!="number"),f={};for(const i of l)f[i]=a[i];return e.objectValues(f)},e.objectValues=a=>e.objectKeys(a).map(function(l){return a[l]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const l=[];for(const f in a)Object.prototype.hasOwnProperty.call(a,f)&&l.push(f);return l},e.find=(a,l)=>{for(const f of a)if(l(f))return f},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,l=" | "){return a.map(f=>typeof f=="string"?`'${f}'`:f).join(l)}e.joinValues=r,e.jsonStringifyReplacer=(a,l)=>typeof l=="bigint"?l.toString():l})(Sa||(Sa={}));var XU;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(XU||(XU={}));const ui=Sa.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Fm=e=>{switch(typeof e){case"undefined":return ui.undefined;case"string":return ui.string;case"number":return Number.isNaN(e)?ui.nan:ui.number;case"boolean":return ui.boolean;case"function":return ui.function;case"bigint":return ui.bigint;case"symbol":return ui.symbol;case"object":return Array.isArray(e)?ui.array:e===null?ui.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?ui.promise:typeof Map<"u"&&e instanceof Map?ui.map:typeof Set<"u"&&e instanceof Set?ui.set:typeof Date<"u"&&e instanceof Date?ui.date:ui.object;default:return ui.unknown}},pr=Sa.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);let k_=class FY extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(l){return l.message},r={_errors:[]},a=l=>{for(const f of l.issues)if(f.code==="invalid_union")f.unionErrors.map(a);else if(f.code==="invalid_return_type")a(f.returnTypeError);else if(f.code==="invalid_arguments")a(f.argumentsError);else if(f.path.length===0)r._errors.push(n(f));else{let i=r,y=0;for(;y<f.path.length;){const x=f.path[y];y===f.path.length-1?(i[x]=i[x]||{_errors:[]},i[x]._errors.push(n(f))):i[x]=i[x]||{_errors:[]},i=i[x],y++}}};return a(this),r}static assert(t){if(!(t instanceof FY))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Sa.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const a of this.issues)if(a.path.length>0){const l=a.path[0];n[l]=n[l]||[],n[l].push(t(a))}else r.push(t(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}};k_.create=e=>new k_(e);const uO=(e,t)=>{let n;switch(e.code){case pr.invalid_type:e.received===ui.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case pr.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,Sa.jsonStringifyReplacer)}`;break;case pr.unrecognized_keys:n=`Unrecognized key(s) in object: ${Sa.joinValues(e.keys,", ")}`;break;case pr.invalid_union:n="Invalid input";break;case pr.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Sa.joinValues(e.options)}`;break;case pr.invalid_enum_value:n=`Invalid enum value. Expected ${Sa.joinValues(e.options)}, received '${e.received}'`;break;case pr.invalid_arguments:n="Invalid function arguments";break;case pr.invalid_return_type:n="Invalid function return type";break;case pr.invalid_date:n="Invalid date";break;case pr.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:Sa.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case pr.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case pr.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case pr.custom:n="Invalid input";break;case pr.invalid_intersection_types:n="Intersection results could not be merged";break;case pr.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case pr.not_finite:n="Number must be finite";break;default:n=t.defaultError,Sa.assertNever(e)}return{message:n}};let L0e=uO;function D0e(){return L0e}const N0e=e=>{const{data:t,path:n,errorMaps:r,issueData:a}=e,l=[...n,...a.path||[]],f={...a,path:l};if(a.message!==void 0)return{...a,path:l,message:a.message};let i="";const y=r.filter(x=>!!x).slice().reverse();for(const x of y)i=x(f,{data:t,defaultError:i}).message;return{...a,path:l,message:i}};function Ur(e,t){const n=D0e(),r=N0e({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===uO?void 0:uO].filter(a=>!!a)});e.common.issues.push(r)}let yh=class BY{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const a of n){if(a.status==="aborted")return ps;a.status==="dirty"&&t.dirty(),r.push(a.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const a of n){const l=await a.key,f=await a.value;r.push({key:l,value:f})}return BY.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const a of n){const{key:l,value:f}=a;if(l.status==="aborted"||f.status==="aborted")return ps;l.status==="dirty"&&t.dirty(),f.status==="dirty"&&t.dirty(),l.value!=="__proto__"&&(typeof f.value<"u"||a.alwaysSet)&&(r[l.value]=f.value)}return{status:t.value,value:r}}};const ps=Object.freeze({status:"aborted"}),g2=e=>({status:"dirty",value:e}),kd=e=>({status:"valid",value:e}),YU=e=>e.status==="aborted",KU=e=>e.status==="dirty",ax=e=>e.status==="valid",mC=e=>typeof Promise<"u"&&e instanceof Promise;var vi;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(vi||(vi={}));let T0=class{constructor(t,n,r,a){this._cachedPath=[],this.parent=t,this.data=n,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};const QU=(e,t)=>{if(ax(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new k_(e.common.issues);return this._error=n,this._error}}};function Ks(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:a}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(f,i)=>{const{message:y}=e;return f.code==="invalid_enum_value"?{message:y??i.defaultError}:typeof i.data>"u"?{message:y??r??i.defaultError}:f.code!=="invalid_type"?{message:i.defaultError}:{message:y??n??i.defaultError}},description:a}}let wa=class{get description(){return this._def.description}_getType(t){return Fm(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:Fm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new yh,ctx:{common:t.parent.common,data:t.data,parsedType:Fm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(mC(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){const r={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Fm(t)},a=this._parseSync({data:t,path:r.path,parent:r});return QU(r,a)}"~validate"(t){var r,a;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Fm(t)};if(!this["~standard"].async)try{const l=this._parseSync({data:t,path:[],parent:n});return ax(l)?{value:l.value}:{issues:n.common.issues}}catch(l){(a=(r=l==null?void 0:l.message)==null?void 0:r.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:n}).then(l=>ax(l)?{value:l.value}:{issues:n.common.issues})}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Fm(t)},a=this._parse({data:t,path:r.path,parent:r}),l=await(mC(a)?a:Promise.resolve(a));return QU(r,l)}refine(t,n){const r=a=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,l)=>{const f=t(a),i=()=>l.addIssue({code:pr.custom,...r(a)});return typeof Promise<"u"&&f instanceof Promise?f.then(y=>y?!0:(i(),!1)):f?!0:(i(),!1)})}refinement(t,n){return this._refinement((r,a)=>t(r)?!0:(a.addIssue(typeof n=="function"?n(r,a):n),!1))}_refinement(t){return new I_({schema:this,typeName:_s.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return bp.create(this,this._def)}nullable(){return R_.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ox.create(this)}promise(){return vC.create(this,this._def)}or(t){return gC.create([this,t],this._def)}and(t){return _C.create(this,t,this._def)}transform(t){return new I_({...Ks(this._def),schema:this,typeName:_s.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new xC({...Ks(this._def),innerType:this,defaultValue:n,typeName:_s.ZodDefault})}brand(){return new GY({typeName:_s.ZodBranded,type:this,...Ks(this._def)})}catch(t){const n=typeof t=="function"?t:()=>t;return new bC({...Ks(this._def),innerType:this,catchValue:n,typeName:_s.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return sge.create(this,t)}readonly(){return wC.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const z0e=/^c[^\s-]{8,}$/i,F0e=/^[0-9a-z]+$/,B0e=/^[0-9A-HJKMNP-TV-Z]{26}$/i,j0e=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,U0e=/^[a-z0-9_-]{21}$/i,V0e=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,$0e=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,H0e=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,G0e="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let J5;const q0e=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Z0e=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,W0e=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,X0e=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Y0e=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,K0e=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,jY="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Q0e=new RegExp(`^${jY}$`);function UY(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function J0e(e){return new RegExp(`^${UY(e)}$`)}function ege(e){let t=`${jY}T${UY(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function tge(e,t){return!!((t==="v4"||!t)&&q0e.test(e)||(t==="v6"||!t)&&W0e.test(e))}function nge(e,t){if(!V0e.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||t&&a.alg!==t)}catch{return!1}}function rge(e,t){return!!((t==="v4"||!t)&&Z0e.test(e)||(t==="v6"||!t)&&X0e.test(e))}let cO=class _2 extends wa{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==ui.string){const l=this._getOrReturnCtx(t);return Ur(l,{code:pr.invalid_type,expected:ui.string,received:l.parsedType}),ps}const r=new yh;let a;for(const l of this._def.checks)if(l.kind==="min")t.data.length<l.value&&(a=this._getOrReturnCtx(t,a),Ur(a,{code:pr.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),r.dirty());else if(l.kind==="max")t.data.length>l.value&&(a=this._getOrReturnCtx(t,a),Ur(a,{code:pr.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),r.dirty());else if(l.kind==="length"){const f=t.data.length>l.value,i=t.data.length<l.value;(f||i)&&(a=this._getOrReturnCtx(t,a),f?Ur(a,{code:pr.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):i&&Ur(a,{code:pr.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),r.dirty())}else if(l.kind==="email")H0e.test(t.data)||(a=this._getOrReturnCtx(t,a),Ur(a,{validation:"email",code:pr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="emoji")J5||(J5=new RegExp(G0e,"u")),J5.test(t.data)||(a=this._getOrReturnCtx(t,a),Ur(a,{validation:"emoji",code:pr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="uuid")j0e.test(t.data)||(a=this._getOrReturnCtx(t,a),Ur(a,{validation:"uuid",code:pr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="nanoid")U0e.test(t.data)||(a=this._getOrReturnCtx(t,a),Ur(a,{validation:"nanoid",code:pr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="cuid")z0e.test(t.data)||(a=this._getOrReturnCtx(t,a),Ur(a,{validation:"cuid",code:pr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="cuid2")F0e.test(t.data)||(a=this._getOrReturnCtx(t,a),Ur(a,{validation:"cuid2",code:pr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="ulid")B0e.test(t.data)||(a=this._getOrReturnCtx(t,a),Ur(a,{validation:"ulid",code:pr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),Ur(a,{validation:"url",code:pr.invalid_string,message:l.message}),r.dirty()}else l.kind==="regex"?(l.regex.lastIndex=0,l.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),Ur(a,{validation:"regex",code:pr.invalid_string,message:l.message}),r.dirty())):l.kind==="trim"?t.data=t.data.trim():l.kind==="includes"?t.data.includes(l.value,l.position)||(a=this._getOrReturnCtx(t,a),Ur(a,{code:pr.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),r.dirty()):l.kind==="toLowerCase"?t.data=t.data.toLowerCase():l.kind==="toUpperCase"?t.data=t.data.toUpperCase():l.kind==="startsWith"?t.data.startsWith(l.value)||(a=this._getOrReturnCtx(t,a),Ur(a,{code:pr.invalid_string,validation:{startsWith:l.value},message:l.message}),r.dirty()):l.kind==="endsWith"?t.data.endsWith(l.value)||(a=this._getOrReturnCtx(t,a),Ur(a,{code:pr.invalid_string,validation:{endsWith:l.value},message:l.message}),r.dirty()):l.kind==="datetime"?ege(l).test(t.data)||(a=this._getOrReturnCtx(t,a),Ur(a,{code:pr.invalid_string,validation:"datetime",message:l.message}),r.dirty()):l.kind==="date"?Q0e.test(t.data)||(a=this._getOrReturnCtx(t,a),Ur(a,{code:pr.invalid_string,validation:"date",message:l.message}),r.dirty()):l.kind==="time"?J0e(l).test(t.data)||(a=this._getOrReturnCtx(t,a),Ur(a,{code:pr.invalid_string,validation:"time",message:l.message}),r.dirty()):l.kind==="duration"?$0e.test(t.data)||(a=this._getOrReturnCtx(t,a),Ur(a,{validation:"duration",code:pr.invalid_string,message:l.message}),r.dirty()):l.kind==="ip"?tge(t.data,l.version)||(a=this._getOrReturnCtx(t,a),Ur(a,{validation:"ip",code:pr.invalid_string,message:l.message}),r.dirty()):l.kind==="jwt"?nge(t.data,l.alg)||(a=this._getOrReturnCtx(t,a),Ur(a,{validation:"jwt",code:pr.invalid_string,message:l.message}),r.dirty()):l.kind==="cidr"?rge(t.data,l.version)||(a=this._getOrReturnCtx(t,a),Ur(a,{validation:"cidr",code:pr.invalid_string,message:l.message}),r.dirty()):l.kind==="base64"?Y0e.test(t.data)||(a=this._getOrReturnCtx(t,a),Ur(a,{validation:"base64",code:pr.invalid_string,message:l.message}),r.dirty()):l.kind==="base64url"?K0e.test(t.data)||(a=this._getOrReturnCtx(t,a),Ur(a,{validation:"base64url",code:pr.invalid_string,message:l.message}),r.dirty()):Sa.assertNever(l);return{status:r.value,value:t.data}}_regex(t,n,r){return this.refinement(a=>t.test(a),{validation:n,code:pr.invalid_string,...vi.errToObj(r)})}_addCheck(t){return new _2({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...vi.errToObj(t)})}url(t){return this._addCheck({kind:"url",...vi.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...vi.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...vi.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...vi.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...vi.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...vi.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...vi.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...vi.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...vi.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...vi.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...vi.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...vi.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...vi.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...vi.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...vi.errToObj(t)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...vi.errToObj(n)})}includes(t,n){return this._addCheck({kind:"includes",value:t,position:n==null?void 0:n.position,...vi.errToObj(n==null?void 0:n.message)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...vi.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...vi.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...vi.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...vi.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...vi.errToObj(n)})}nonempty(t){return this.min(1,vi.errToObj(t))}trim(){return new _2({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new _2({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new _2({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}};cO.create=e=>new cO({checks:[],typeName:_s.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...Ks(e)});function ige(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,a=n>r?n:r,l=Number.parseInt(e.toFixed(a).replace(".","")),f=Number.parseInt(t.toFixed(a).replace(".",""));return l%f/10**a}let JU=class dO extends wa{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==ui.number){const l=this._getOrReturnCtx(t);return Ur(l,{code:pr.invalid_type,expected:ui.number,received:l.parsedType}),ps}let r;const a=new yh;for(const l of this._def.checks)l.kind==="int"?Sa.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),Ur(r,{code:pr.invalid_type,expected:"integer",received:"float",message:l.message}),a.dirty()):l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(r=this._getOrReturnCtx(t,r),Ur(r,{code:pr.too_small,minimum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),a.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(r=this._getOrReturnCtx(t,r),Ur(r,{code:pr.too_big,maximum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),a.dirty()):l.kind==="multipleOf"?ige(t.data,l.value)!==0&&(r=this._getOrReturnCtx(t,r),Ur(r,{code:pr.not_multiple_of,multipleOf:l.value,message:l.message}),a.dirty()):l.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),Ur(r,{code:pr.not_finite,message:l.message}),a.dirty()):Sa.assertNever(l);return{status:a.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,vi.toString(n))}gt(t,n){return this.setLimit("min",t,!1,vi.toString(n))}lte(t,n){return this.setLimit("max",t,!0,vi.toString(n))}lt(t,n){return this.setLimit("max",t,!1,vi.toString(n))}setLimit(t,n,r,a){return new dO({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:vi.toString(a)}]})}_addCheck(t){return new dO({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:vi.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:vi.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:vi.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:vi.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:vi.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:vi.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:vi.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:vi.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:vi.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Sa.isInteger(t.value))}get isFinite(){let t=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(n)&&Number.isFinite(t)}};JU.create=e=>new JU({checks:[],typeName:_s.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...Ks(e)});let eV=class hO extends wa{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==ui.bigint)return this._getInvalidInput(t);let r;const a=new yh;for(const l of this._def.checks)l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(r=this._getOrReturnCtx(t,r),Ur(r,{code:pr.too_small,type:"bigint",minimum:l.value,inclusive:l.inclusive,message:l.message}),a.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(r=this._getOrReturnCtx(t,r),Ur(r,{code:pr.too_big,type:"bigint",maximum:l.value,inclusive:l.inclusive,message:l.message}),a.dirty()):l.kind==="multipleOf"?t.data%l.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),Ur(r,{code:pr.not_multiple_of,multipleOf:l.value,message:l.message}),a.dirty()):Sa.assertNever(l);return{status:a.value,value:t.data}}_getInvalidInput(t){const n=this._getOrReturnCtx(t);return Ur(n,{code:pr.invalid_type,expected:ui.bigint,received:n.parsedType}),ps}gte(t,n){return this.setLimit("min",t,!0,vi.toString(n))}gt(t,n){return this.setLimit("min",t,!1,vi.toString(n))}lte(t,n){return this.setLimit("max",t,!0,vi.toString(n))}lt(t,n){return this.setLimit("max",t,!1,vi.toString(n))}setLimit(t,n,r,a){return new hO({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:vi.toString(a)}]})}_addCheck(t){return new hO({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:vi.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:vi.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:vi.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:vi.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:vi.toString(n)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}};eV.create=e=>new eV({checks:[],typeName:_s.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...Ks(e)});let fO=class extends wa{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==ui.boolean){const r=this._getOrReturnCtx(t);return Ur(r,{code:pr.invalid_type,expected:ui.boolean,received:r.parsedType}),ps}return kd(t.data)}};fO.create=e=>new fO({typeName:_s.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...Ks(e)});let tV=class VY extends wa{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==ui.date){const l=this._getOrReturnCtx(t);return Ur(l,{code:pr.invalid_type,expected:ui.date,received:l.parsedType}),ps}if(Number.isNaN(t.data.getTime())){const l=this._getOrReturnCtx(t);return Ur(l,{code:pr.invalid_date}),ps}const r=new yh;let a;for(const l of this._def.checks)l.kind==="min"?t.data.getTime()<l.value&&(a=this._getOrReturnCtx(t,a),Ur(a,{code:pr.too_small,message:l.message,inclusive:!0,exact:!1,minimum:l.value,type:"date"}),r.dirty()):l.kind==="max"?t.data.getTime()>l.value&&(a=this._getOrReturnCtx(t,a),Ur(a,{code:pr.too_big,message:l.message,inclusive:!0,exact:!1,maximum:l.value,type:"date"}),r.dirty()):Sa.assertNever(l);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new VY({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:vi.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:vi.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}};tV.create=e=>new tV({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:_s.ZodDate,...Ks(e)});let nV=class extends wa{_parse(t){if(this._getType(t)!==ui.symbol){const r=this._getOrReturnCtx(t);return Ur(r,{code:pr.invalid_type,expected:ui.symbol,received:r.parsedType}),ps}return kd(t.data)}};nV.create=e=>new nV({typeName:_s.ZodSymbol,...Ks(e)});let pO=class extends wa{_parse(t){if(this._getType(t)!==ui.undefined){const r=this._getOrReturnCtx(t);return Ur(r,{code:pr.invalid_type,expected:ui.undefined,received:r.parsedType}),ps}return kd(t.data)}};pO.create=e=>new pO({typeName:_s.ZodUndefined,...Ks(e)});let mO=class extends wa{_parse(t){if(this._getType(t)!==ui.null){const r=this._getOrReturnCtx(t);return Ur(r,{code:pr.invalid_type,expected:ui.null,received:r.parsedType}),ps}return kd(t.data)}};mO.create=e=>new mO({typeName:_s.ZodNull,...Ks(e)});let gO=class extends wa{constructor(){super(...arguments),this._any=!0}_parse(t){return kd(t.data)}};gO.create=e=>new gO({typeName:_s.ZodAny,...Ks(e)});let rV=class extends wa{constructor(){super(...arguments),this._unknown=!0}_parse(t){return kd(t.data)}};rV.create=e=>new rV({typeName:_s.ZodUnknown,...Ks(e)});let E0=class extends wa{_parse(t){const n=this._getOrReturnCtx(t);return Ur(n,{code:pr.invalid_type,expected:ui.never,received:n.parsedType}),ps}};E0.create=e=>new E0({typeName:_s.ZodNever,...Ks(e)});let iV=class extends wa{_parse(t){if(this._getType(t)!==ui.undefined){const r=this._getOrReturnCtx(t);return Ur(r,{code:pr.invalid_type,expected:ui.void,received:r.parsedType}),ps}return kd(t.data)}};iV.create=e=>new iV({typeName:_s.ZodVoid,...Ks(e)});let ox=class aA extends wa{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),a=this._def;if(n.parsedType!==ui.array)return Ur(n,{code:pr.invalid_type,expected:ui.array,received:n.parsedType}),ps;if(a.exactLength!==null){const f=n.data.length>a.exactLength.value,i=n.data.length<a.exactLength.value;(f||i)&&(Ur(n,{code:f?pr.too_big:pr.too_small,minimum:i?a.exactLength.value:void 0,maximum:f?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(Ur(n,{code:pr.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(Ur(n,{code:pr.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((f,i)=>a.type._parseAsync(new T0(n,f,n.path,i)))).then(f=>yh.mergeArray(r,f));const l=[...n.data].map((f,i)=>a.type._parseSync(new T0(n,f,n.path,i)));return yh.mergeArray(r,l)}get element(){return this._def.type}min(t,n){return new aA({...this._def,minLength:{value:t,message:vi.toString(n)}})}max(t,n){return new aA({...this._def,maxLength:{value:t,message:vi.toString(n)}})}length(t,n){return new aA({...this._def,exactLength:{value:t,message:vi.toString(n)}})}nonempty(t){return this.min(1,t)}};ox.create=(e,t)=>new ox({type:e,minLength:null,maxLength:null,exactLength:null,typeName:_s.ZodArray,...Ks(t)});function K1(e){if(e instanceof Rp){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=bp.create(K1(r))}return new Rp({...e._def,shape:()=>t})}else return e instanceof ox?new ox({...e._def,type:K1(e.element)}):e instanceof bp?bp.create(K1(e.unwrap())):e instanceof R_?R_.create(K1(e.unwrap())):e instanceof yT?yT.create(e.items.map(t=>K1(t))):e}let Rp=class sh extends wa{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=Sa.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==ui.object){const x=this._getOrReturnCtx(t);return Ur(x,{code:pr.invalid_type,expected:ui.object,received:x.parsedType}),ps}const{status:r,ctx:a}=this._processInputParams(t),{shape:l,keys:f}=this._getCached(),i=[];if(!(this._def.catchall instanceof E0&&this._def.unknownKeys==="strip"))for(const x in a.data)f.includes(x)||i.push(x);const y=[];for(const x of f){const S=l[x],C=a.data[x];y.push({key:{status:"valid",value:x},value:S._parse(new T0(a,C,a.path,x)),alwaysSet:x in a.data})}if(this._def.catchall instanceof E0){const x=this._def.unknownKeys;if(x==="passthrough")for(const S of i)y.push({key:{status:"valid",value:S},value:{status:"valid",value:a.data[S]}});else if(x==="strict")i.length>0&&(Ur(a,{code:pr.unrecognized_keys,keys:i}),r.dirty());else if(x!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const x=this._def.catchall;for(const S of i){const C=a.data[S];y.push({key:{status:"valid",value:S},value:x._parse(new T0(a,C,a.path,S)),alwaysSet:S in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const x=[];for(const S of y){const C=await S.key,P=await S.value;x.push({key:C,value:P,alwaysSet:S.alwaysSet})}return x}).then(x=>yh.mergeObjectSync(r,x)):yh.mergeObjectSync(r,y)}get shape(){return this._def.shape()}strict(t){return vi.errToObj,new sh({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,r)=>{var l,f;const a=((f=(l=this._def).errorMap)==null?void 0:f.call(l,n,r).message)??r.defaultError;return n.code==="unrecognized_keys"?{message:vi.errToObj(t).message??a}:{message:a}}}:{}})}strip(){return new sh({...this._def,unknownKeys:"strip"})}passthrough(){return new sh({...this._def,unknownKeys:"passthrough"})}extend(t){return new sh({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new sh({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:_s.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new sh({...this._def,catchall:t})}pick(t){const n={};for(const r of Sa.objectKeys(t))t[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new sh({...this._def,shape:()=>n})}omit(t){const n={};for(const r of Sa.objectKeys(this.shape))t[r]||(n[r]=this.shape[r]);return new sh({...this._def,shape:()=>n})}deepPartial(){return K1(this)}partial(t){const n={};for(const r of Sa.objectKeys(this.shape)){const a=this.shape[r];t&&!t[r]?n[r]=a:n[r]=a.optional()}return new sh({...this._def,shape:()=>n})}required(t){const n={};for(const r of Sa.objectKeys(this.shape))if(t&&!t[r])n[r]=this.shape[r];else{let l=this.shape[r];for(;l instanceof bp;)l=l._def.innerType;n[r]=l}return new sh({...this._def,shape:()=>n})}keyof(){return HY(Sa.objectKeys(this.shape))}};Rp.create=(e,t)=>new Rp({shape:()=>e,unknownKeys:"strip",catchall:E0.create(),typeName:_s.ZodObject,...Ks(t)});Rp.strictCreate=(e,t)=>new Rp({shape:()=>e,unknownKeys:"strict",catchall:E0.create(),typeName:_s.ZodObject,...Ks(t)});Rp.lazycreate=(e,t)=>new Rp({shape:e,unknownKeys:"strip",catchall:E0.create(),typeName:_s.ZodObject,...Ks(t)});let gC=class extends wa{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function a(l){for(const i of l)if(i.result.status==="valid")return i.result;for(const i of l)if(i.result.status==="dirty")return n.common.issues.push(...i.ctx.common.issues),i.result;const f=l.map(i=>new k_(i.ctx.common.issues));return Ur(n,{code:pr.invalid_union,unionErrors:f}),ps}if(n.common.async)return Promise.all(r.map(async l=>{const f={...n,common:{...n.common,issues:[]},parent:null};return{result:await l._parseAsync({data:n.data,path:n.path,parent:f}),ctx:f}})).then(a);{let l;const f=[];for(const y of r){const x={...n,common:{...n.common,issues:[]},parent:null},S=y._parseSync({data:n.data,path:n.path,parent:x});if(S.status==="valid")return S;S.status==="dirty"&&!l&&(l={result:S,ctx:x}),x.common.issues.length&&f.push(x.common.issues)}if(l)return n.common.issues.push(...l.ctx.common.issues),l.result;const i=f.map(y=>new k_(y));return Ur(n,{code:pr.invalid_union,unionErrors:i}),ps}}get options(){return this._def.options}};gC.create=(e,t)=>new gC({options:e,typeName:_s.ZodUnion,...Ks(t)});const sp=e=>e instanceof vO?sp(e.schema):e instanceof I_?sp(e.innerType()):e instanceof yC?[e.value]:e instanceof Ck?e.options:e instanceof bO?Sa.objectValues(e.enum):e instanceof xC?sp(e._def.innerType):e instanceof pO?[void 0]:e instanceof mO?[null]:e instanceof bp?[void 0,...sp(e.unwrap())]:e instanceof R_?[null,...sp(e.unwrap())]:e instanceof GY||e instanceof wC?sp(e.unwrap()):e instanceof bC?sp(e._def.innerType):[];class tD extends wa{_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==ui.object)return Ur(n,{code:pr.invalid_type,expected:ui.object,received:n.parsedType}),ps;const r=this.discriminator,a=n.data[r],l=this.optionsMap.get(a);return l?n.common.async?l._parseAsync({data:n.data,path:n.path,parent:n}):l._parseSync({data:n.data,path:n.path,parent:n}):(Ur(n,{code:pr.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),ps)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,n,r){const a=new Map;for(const l of n){const f=sp(l.shape[t]);if(!f.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const i of f){if(a.has(i))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(i)}`);a.set(i,l)}}return new tD({typeName:_s.ZodDiscriminatedUnion,discriminator:t,options:n,optionsMap:a,...Ks(r)})}}function _O(e,t){const n=Fm(e),r=Fm(t);if(e===t)return{valid:!0,data:e};if(n===ui.object&&r===ui.object){const a=Sa.objectKeys(t),l=Sa.objectKeys(e).filter(i=>a.indexOf(i)!==-1),f={...e,...t};for(const i of l){const y=_O(e[i],t[i]);if(!y.valid)return{valid:!1};f[i]=y.data}return{valid:!0,data:f}}else if(n===ui.array&&r===ui.array){if(e.length!==t.length)return{valid:!1};const a=[];for(let l=0;l<e.length;l++){const f=e[l],i=t[l],y=_O(f,i);if(!y.valid)return{valid:!1};a.push(y.data)}return{valid:!0,data:a}}else return n===ui.date&&r===ui.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}let _C=class extends wa{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=(l,f)=>{if(YU(l)||YU(f))return ps;const i=_O(l.value,f.value);return i.valid?((KU(l)||KU(f))&&n.dirty(),{status:n.value,value:i.data}):(Ur(r,{code:pr.invalid_intersection_types}),ps)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([l,f])=>a(l,f)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};_C.create=(e,t,n)=>new _C({left:e,right:t,typeName:_s.ZodIntersection,...Ks(n)});let yT=class $Y extends wa{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==ui.array)return Ur(r,{code:pr.invalid_type,expected:ui.array,received:r.parsedType}),ps;if(r.data.length<this._def.items.length)return Ur(r,{code:pr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ps;!this._def.rest&&r.data.length>this._def.items.length&&(Ur(r,{code:pr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const l=[...r.data].map((f,i)=>{const y=this._def.items[i]||this._def.rest;return y?y._parse(new T0(r,f,r.path,i)):null}).filter(f=>!!f);return r.common.async?Promise.all(l).then(f=>yh.mergeArray(n,f)):yh.mergeArray(n,l)}get items(){return this._def.items}rest(t){return new $Y({...this._def,rest:t})}};yT.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new yT({items:e,typeName:_s.ZodTuple,rest:null,...Ks(t)})};let sV=class extends wa{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==ui.map)return Ur(r,{code:pr.invalid_type,expected:ui.map,received:r.parsedType}),ps;const a=this._def.keyType,l=this._def.valueType,f=[...r.data.entries()].map(([i,y],x)=>({key:a._parse(new T0(r,i,r.path,[x,"key"])),value:l._parse(new T0(r,y,r.path,[x,"value"]))}));if(r.common.async){const i=new Map;return Promise.resolve().then(async()=>{for(const y of f){const x=await y.key,S=await y.value;if(x.status==="aborted"||S.status==="aborted")return ps;(x.status==="dirty"||S.status==="dirty")&&n.dirty(),i.set(x.value,S.value)}return{status:n.value,value:i}})}else{const i=new Map;for(const y of f){const x=y.key,S=y.value;if(x.status==="aborted"||S.status==="aborted")return ps;(x.status==="dirty"||S.status==="dirty")&&n.dirty(),i.set(x.value,S.value)}return{status:n.value,value:i}}}};sV.create=(e,t,n)=>new sV({valueType:t,keyType:e,typeName:_s.ZodMap,...Ks(n)});let aV=class yO extends wa{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==ui.set)return Ur(r,{code:pr.invalid_type,expected:ui.set,received:r.parsedType}),ps;const a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(Ur(r,{code:pr.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(Ur(r,{code:pr.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());const l=this._def.valueType;function f(y){const x=new Set;for(const S of y){if(S.status==="aborted")return ps;S.status==="dirty"&&n.dirty(),x.add(S.value)}return{status:n.value,value:x}}const i=[...r.data.values()].map((y,x)=>l._parse(new T0(r,y,r.path,x)));return r.common.async?Promise.all(i).then(y=>f(y)):f(i)}min(t,n){return new yO({...this._def,minSize:{value:t,message:vi.toString(n)}})}max(t,n){return new yO({...this._def,maxSize:{value:t,message:vi.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}};aV.create=(e,t)=>new aV({valueType:e,minSize:null,maxSize:null,typeName:_s.ZodSet,...Ks(t)});let vO=class extends wa{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}};vO.create=(e,t)=>new vO({getter:e,typeName:_s.ZodLazy,...Ks(t)});let yC=class extends wa{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return Ur(n,{received:n.data,code:pr.invalid_literal,expected:this._def.value}),ps}return{status:"valid",value:t.data}}get value(){return this._def.value}};yC.create=(e,t)=>new yC({value:e,typeName:_s.ZodLiteral,...Ks(t)});function HY(e,t){return new Ck({values:e,typeName:_s.ZodEnum,...Ks(t)})}let Ck=class xO extends wa{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return Ur(n,{expected:Sa.joinValues(r),received:n.parsedType,code:pr.invalid_type}),ps}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const n=this._getOrReturnCtx(t),r=this._def.values;return Ur(n,{received:n.data,code:pr.invalid_enum_value,options:r}),ps}return kd(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return xO.create(t,{...this._def,...n})}exclude(t,n=this._def){return xO.create(this.options.filter(r=>!t.includes(r)),{...this._def,...n})}};Ck.create=HY;let bO=class extends wa{_parse(t){const n=Sa.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==ui.string&&r.parsedType!==ui.number){const a=Sa.objectValues(n);return Ur(r,{expected:Sa.joinValues(a),received:r.parsedType,code:pr.invalid_type}),ps}if(this._cache||(this._cache=new Set(Sa.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const a=Sa.objectValues(n);return Ur(r,{received:r.data,code:pr.invalid_enum_value,options:a}),ps}return kd(t.data)}get enum(){return this._def.values}};bO.create=(e,t)=>new bO({values:e,typeName:_s.ZodNativeEnum,...Ks(t)});let vC=class extends wa{unwrap(){return this._def.type}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==ui.promise&&n.common.async===!1)return Ur(n,{code:pr.invalid_type,expected:ui.promise,received:n.parsedType}),ps;const r=n.parsedType===ui.promise?n.data:Promise.resolve(n.data);return kd(r.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}};vC.create=(e,t)=>new vC({type:e,typeName:_s.ZodPromise,...Ks(t)});let I_=class extends wa{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===_s.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=this._def.effect||null,l={addIssue:f=>{Ur(r,f),f.fatal?n.abort():n.dirty()},get path(){return r.path}};if(l.addIssue=l.addIssue.bind(l),a.type==="preprocess"){const f=a.transform(r.data,l);if(r.common.async)return Promise.resolve(f).then(async i=>{if(n.value==="aborted")return ps;const y=await this._def.schema._parseAsync({data:i,path:r.path,parent:r});return y.status==="aborted"?ps:y.status==="dirty"||n.value==="dirty"?g2(y.value):y});{if(n.value==="aborted")return ps;const i=this._def.schema._parseSync({data:f,path:r.path,parent:r});return i.status==="aborted"?ps:i.status==="dirty"||n.value==="dirty"?g2(i.value):i}}if(a.type==="refinement"){const f=i=>{const y=a.refinement(i,l);if(r.common.async)return Promise.resolve(y);if(y instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?ps:(i.status==="dirty"&&n.dirty(),f(i.value),{status:n.value,value:i.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>i.status==="aborted"?ps:(i.status==="dirty"&&n.dirty(),f(i.value).then(()=>({status:n.value,value:i.value}))))}if(a.type==="transform")if(r.common.async===!1){const f=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!ax(f))return ps;const i=a.transform(f.value,l);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:i}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(f=>ax(f)?Promise.resolve(a.transform(f.value,l)).then(i=>({status:n.value,value:i})):ps);Sa.assertNever(a)}};I_.create=(e,t,n)=>new I_({schema:e,typeName:_s.ZodEffects,effect:t,...Ks(n)});I_.createWithPreprocess=(e,t,n)=>new I_({schema:t,effect:{type:"preprocess",transform:e},typeName:_s.ZodEffects,...Ks(n)});let bp=class extends wa{_parse(t){return this._getType(t)===ui.undefined?kd(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};bp.create=(e,t)=>new bp({innerType:e,typeName:_s.ZodOptional,...Ks(t)});let R_=class extends wa{_parse(t){return this._getType(t)===ui.null?kd(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};R_.create=(e,t)=>new R_({innerType:e,typeName:_s.ZodNullable,...Ks(t)});let xC=class extends wa{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===ui.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};xC.create=(e,t)=>new xC({innerType:e,typeName:_s.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...Ks(t)});let bC=class extends wa{_parse(t){const{ctx:n}=this._processInputParams(t),r={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return mC(a)?a.then(l=>({status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new k_(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new k_(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};bC.create=(e,t)=>new bC({innerType:e,typeName:_s.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...Ks(t)});let oV=class extends wa{_parse(t){if(this._getType(t)!==ui.nan){const r=this._getOrReturnCtx(t);return Ur(r,{code:pr.invalid_type,expected:ui.nan,received:r.parsedType}),ps}return{status:"valid",value:t.data}}};oV.create=e=>new oV({typeName:_s.ZodNaN,...Ks(e)});let GY=class extends wa{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}},sge=class qY extends wa{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const l=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return l.status==="aborted"?ps:l.status==="dirty"?(n.dirty(),g2(l.value)):this._def.out._parseAsync({data:l.value,path:r.path,parent:r})})();{const a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?ps:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(t,n){return new qY({in:t,out:n,typeName:_s.ZodPipeline})}},wC=class extends wa{_parse(t){const n=this._def.innerType._parse(t),r=a=>(ax(a)&&(a.value=Object.freeze(a.value)),a);return mC(n)?n.then(a=>r(a)):r(n)}unwrap(){return this._def.innerType}};wC.create=(e,t)=>new wC({innerType:e,typeName:_s.ZodReadonly,...Ks(t)});var _s;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(_s||(_s={}));const Aa=cO.create,lV=fO.create,nD=gO.create;E0.create;ox.create;const qc=Rp.create;gC.create;const age=tD.create;_C.create;yT.create;const Ef=yC.create,ZY=Ck.create;vC.create;bp.create;R_.create;const oge=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,uV=e=>{if(typeof e!="string")throw new TypeError("Invalid argument expected string");const t=e.match(oge);if(!t)throw new Error(`Invalid argument not valid semver ('${e}' received)`);return t.shift(),t},cV=e=>e==="*"||e==="x"||e==="X",dV=e=>{const t=parseInt(e,10);return isNaN(t)?e:t},lge=(e,t)=>typeof e!=typeof t?[String(e),String(t)]:[e,t],uge=(e,t)=>{if(cV(e)||cV(t))return 0;const[n,r]=lge(dV(e),dV(t));return n>r?1:n<r?-1:0},hV=(e,t)=>{for(let n=0;n<Math.max(e.length,t.length);n++){const r=uge(e[n]||"0",t[n]||"0");if(r!==0)return r}return 0},cge=(e,t)=>{const n=uV(e),r=uV(t),a=n.pop(),l=r.pop(),f=hV(n,r);return f!==0?f:a&&l?hV(a.split("."),l.split(".")):a||l?a?-1:1:0};var dge={},hge=Object.defineProperty,fge=Object.defineProperties,pge=Object.getOwnPropertyDescriptors,TC=Object.getOwnPropertySymbols,WY=Object.prototype.hasOwnProperty,XY=Object.prototype.propertyIsEnumerable,fV=(e,t,n)=>t in e?hge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,au=(e,t)=>{for(var n in t||(t={}))WY.call(t,n)&&fV(e,n,t[n]);if(TC)for(var n of TC(t))XY.call(t,n)&&fV(e,n,t[n]);return e},S0=(e,t)=>fge(e,pge(t)),mge=(e,t)=>{var n={};for(var r in e)WY.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&TC)for(var r of TC(e))t.indexOf(r)<0&&XY.call(e,r)&&(n[r]=e[r]);return n},Ya=e=>{if(typeof structuredClone=="function")return structuredClone(e);try{return JSON.parse(JSON.stringify(e))}catch{return au({},e)}};async function Lo(e,t,n,r){let a=t,l=n,f;for(let i of e)try{let y=await r(i,Ya(a),Ya(l));if(y===void 0)continue;if(y.messages!==void 0&&(a=y.messages),y.state!==void 0&&(l=y.state),f=y.stopPropagation,f===!0)break}catch(y){dge.JEST_WORKER_ID!==void 0||console.error("Subscriber error:",y);continue}return au(au(au({},JSON.stringify(a)!==JSON.stringify(t)?{messages:a}:{}),JSON.stringify(l)!==JSON.stringify(n)?{state:l}:{}),f!==void 0?{stopPropagation:f}:{})}var YY=(e,t,n,r)=>{let a=Ya(n.messages),l=Ya(e.state),f={},i=x=>{x.messages!==void 0&&(a=x.messages,f.messages=x.messages),x.state!==void 0&&(l=x.state,f.state=x.state)},y=()=>{let x=Ya(f);return f={},x.messages!==void 0||x.state!==void 0?Ko(x):CY};return t.pipe(AY(async x=>{var S,C,P,L;let F=await Lo(r,a,l,(U,q,G)=>{var $;return($=U.onEvent)==null?void 0:$.call(U,{event:x,agent:n,input:e,messages:q,state:G})});if(i(F),F.stopPropagation===!0)return y();switch(x.type){case Zn.TEXT_MESSAGE_START:{let U=await Lo(r,a,l,(q,G,$)=>{var X;return(X=q.onTextMessageStartEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});if(i(U),U.stopPropagation!==!0){let{messageId:q,role:G="assistant"}=x,$={id:q,role:G,content:""};a.push($),i({messages:a})}return y()}case Zn.TEXT_MESSAGE_CONTENT:{let{messageId:U,delta:q}=x,G=a.find(X=>X.id===U);if(!G)return console.warn(`TEXT_MESSAGE_CONTENT: No message found with ID '${U}'`),y();let $=await Lo(r,a,l,(X,ie,de)=>{var fe;return(fe=X.onTextMessageContentEvent)==null?void 0:fe.call(X,{event:x,messages:ie,state:de,agent:n,input:e,textMessageBuffer:typeof G.content=="string"?G.content:""})});if(i($),$.stopPropagation!==!0){let X=typeof G.content=="string"?G.content:"";G.content=`${X}${q}`,i({messages:a})}return y()}case Zn.TEXT_MESSAGE_END:{let{messageId:U}=x,q=a.find($=>$.id===U);if(!q)return console.warn(`TEXT_MESSAGE_END: No message found with ID '${U}'`),y();let G=await Lo(r,a,l,($,X,ie)=>{var de;return(de=$.onTextMessageEndEvent)==null?void 0:de.call($,{event:x,messages:X,state:ie,agent:n,input:e,textMessageBuffer:typeof q.content=="string"?q.content:""})});return i(G),await Promise.all(r.map($=>{var X;(X=$.onNewMessage)==null||X.call($,{message:q,messages:a,state:l,agent:n,input:e})})),y()}case Zn.TOOL_CALL_START:{let U=await Lo(r,a,l,(q,G,$)=>{var X;return(X=q.onToolCallStartEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});if(i(U),U.stopPropagation!==!0){let{toolCallId:q,toolCallName:G,parentMessageId:$}=x,X;$&&a.length>0&&a[a.length-1].id===$?X=a[a.length-1]:(X={id:$||q,role:"assistant",toolCalls:[]},a.push(X)),X.toolCalls!=null||(X.toolCalls=[]),X.toolCalls.push({id:q,type:"function",function:{name:G,arguments:""}}),i({messages:a})}return y()}case Zn.TOOL_CALL_ARGS:{let{toolCallId:U,delta:q}=x,G=a.find(ie=>{var de;return(de=ie.toolCalls)==null?void 0:de.some(fe=>fe.id===U)});if(!G)return console.warn(`TOOL_CALL_ARGS: No message found containing tool call with ID '${U}'`),y();let $=G.toolCalls.find(ie=>ie.id===U);if(!$)return console.warn(`TOOL_CALL_ARGS: No tool call found with ID '${U}'`),y();let X=await Lo(r,a,l,(ie,de,fe)=>{var be;let ve=$.function.arguments,Je=$.function.name,we={};try{we=CX(ve)}catch{}return(be=ie.onToolCallArgsEvent)==null?void 0:be.call(ie,{event:x,messages:de,state:fe,agent:n,input:e,toolCallBuffer:ve,toolCallName:Je,partialToolCallArgs:we})});return i(X),X.stopPropagation!==!0&&($.function.arguments+=q,i({messages:a})),y()}case Zn.TOOL_CALL_END:{let{toolCallId:U}=x,q=a.find(X=>{var ie;return(ie=X.toolCalls)==null?void 0:ie.some(de=>de.id===U)});if(!q)return console.warn(`TOOL_CALL_END: No message found containing tool call with ID '${U}'`),y();let G=q.toolCalls.find(X=>X.id===U);if(!G)return console.warn(`TOOL_CALL_END: No tool call found with ID '${U}'`),y();let $=await Lo(r,a,l,(X,ie,de)=>{var fe;let be=G.function.arguments,ve=G.function.name,Je={};try{Je=JSON.parse(be)}catch{}return(fe=X.onToolCallEndEvent)==null?void 0:fe.call(X,{event:x,messages:ie,state:de,agent:n,input:e,toolCallName:ve,toolCallArgs:Je})});return i($),await Promise.all(r.map(X=>{var ie;(ie=X.onNewToolCall)==null||ie.call(X,{toolCall:G,messages:a,state:l,agent:n,input:e})})),y()}case Zn.TOOL_CALL_RESULT:{let U=await Lo(r,a,l,(q,G,$)=>{var X;return(X=q.onToolCallResultEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});if(i(U),U.stopPropagation!==!0){let{messageId:q,toolCallId:G,content:$,role:X}=x,ie={id:q,toolCallId:G,role:X||"tool",content:$};a.push(ie),await Promise.all(r.map(de=>{var fe;(fe=de.onNewMessage)==null||fe.call(de,{message:ie,messages:a,state:l,agent:n,input:e})})),i({messages:a})}return y()}case Zn.STATE_SNAPSHOT:{let U=await Lo(r,a,l,(q,G,$)=>{var X;return(X=q.onStateSnapshotEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});if(i(U),U.stopPropagation!==!0){let{snapshot:q}=x;l=q,i({state:l})}return y()}case Zn.STATE_DELTA:{let U=await Lo(r,a,l,(q,G,$)=>{var X;return(X=q.onStateDeltaEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});if(i(U),U.stopPropagation!==!0){let{delta:q}=x;try{l=sx(l,q,!0,!1).newDocument,i({state:l})}catch(G){let $=G instanceof Error?G.message:String(G);console.warn(`Failed to apply state patch:
Current state: ${JSON.stringify(l,null,2)}
Patch operations: ${JSON.stringify(q,null,2)}
Error: ${$}`)}}return y()}case Zn.MESSAGES_SNAPSHOT:{let U=await Lo(r,a,l,(q,G,$)=>{var X;return(X=q.onMessagesSnapshotEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});if(i(U),U.stopPropagation!==!0){let{messages:q}=x;a=q,i({messages:a})}return y()}case Zn.ACTIVITY_SNAPSHOT:{let U=x,q=a.findIndex(de=>de.id===U.messageId),G=q>=0?a[q]:void 0,$=(G==null?void 0:G.role)==="activity"?G:void 0,X=(S=U.replace)!=null?S:!0,ie=await Lo(r,a,l,(de,fe,be)=>{var ve;return(ve=de.onActivitySnapshotEvent)==null?void 0:ve.call(de,{event:U,messages:fe,state:be,agent:n,input:e,activityMessage:$,existingMessage:G})});if(i(ie),ie.stopPropagation!==!0){let de={id:U.messageId,role:"activity",activityType:U.activityType,content:Ya(U.content)},fe;q===-1?(a.push(de),fe=de):$?X&&(a[q]=S0(au({},$),{activityType:U.activityType,content:Ya(U.content)})):X&&(a[q]=de,fe=de),i({messages:a}),fe&&await Promise.all(r.map(be=>{var ve;return(ve=be.onNewMessage)==null?void 0:ve.call(be,{message:fe,messages:a,state:l,agent:n,input:e})}))}return y()}case Zn.ACTIVITY_DELTA:{let U=x,q=a.findIndex(ie=>ie.id===U.messageId);if(q===-1)return console.warn(`ACTIVITY_DELTA: No message found with ID '${U.messageId}' to apply patch`),y();let G=a[q];if(G.role!=="activity")return console.warn(`ACTIVITY_DELTA: Message '${U.messageId}' is not an activity message`),y();let $=G,X=await Lo(r,a,l,(ie,de,fe)=>{var be;return(be=ie.onActivityDeltaEvent)==null?void 0:be.call(ie,{event:U,messages:de,state:fe,agent:n,input:e,activityMessage:$})});if(i(X),X.stopPropagation!==!0)try{let ie=Ya((C=$.content)!=null?C:{}),de=sx(ie,(P=U.patch)!=null?P:[],!0,!1).newDocument;a[q]=S0(au({},$),{content:Ya(de),activityType:U.activityType}),i({messages:a})}catch(ie){let de=ie instanceof Error?ie.message:String(ie);console.warn(`Failed to apply activity patch for '${U.messageId}': ${de}`)}return y()}case Zn.RAW:{let U=await Lo(r,a,l,(q,G,$)=>{var X;return(X=q.onRawEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});return i(U),y()}case Zn.CUSTOM:{let U=await Lo(r,a,l,(q,G,$)=>{var X;return(X=q.onCustomEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});return i(U),y()}case Zn.RUN_STARTED:{let U=await Lo(r,a,l,(q,G,$)=>{var X;return(X=q.onRunStartedEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});if(i(U),U.stopPropagation!==!0){let q=x;if((L=q.input)!=null&&L.messages){for(let G of q.input.messages)a.find($=>$.id===G.id)||a.push(G);i({messages:a})}}return y()}case Zn.RUN_FINISHED:{let U=await Lo(r,a,l,(q,G,$)=>{var X;return(X=q.onRunFinishedEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e,result:x.result})});return i(U),y()}case Zn.RUN_ERROR:{let U=await Lo(r,a,l,(q,G,$)=>{var X;return(X=q.onRunErrorEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});return i(U),y()}case Zn.STEP_STARTED:{let U=await Lo(r,a,l,(q,G,$)=>{var X;return(X=q.onStepStartedEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});return i(U),y()}case Zn.STEP_FINISHED:{let U=await Lo(r,a,l,(q,G,$)=>{var X;return(X=q.onStepFinishedEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});return i(U),y()}case Zn.TEXT_MESSAGE_CHUNK:throw new Error("TEXT_MESSAGE_CHUNK must be tranformed before being applied");case Zn.TOOL_CALL_CHUNK:throw new Error("TOOL_CALL_CHUNK must be tranformed before being applied");case Zn.THINKING_START:return y();case Zn.THINKING_END:return y();case Zn.THINKING_TEXT_MESSAGE_START:return y();case Zn.THINKING_TEXT_MESSAGE_CONTENT:return y();case Zn.THINKING_TEXT_MESSAGE_END:return y()}return x.type,y()}),Wme(),r.length>0?Yme({}):x=>x)},eR=e=>t=>{let n=new Map,r=new Map,a=!1,l=!1,f=!1,i=new Map,y=!1,x=!1,S=!1,C=()=>{n.clear(),r.clear(),i.clear(),y=!1,x=!1,a=!1,l=!1,S=!0};return t.pipe(w0(P=>{let L=P.type;if(e&&console.debug("[VERIFY]:",JSON.stringify(P)),l)return Oo(()=>new $o(`Cannot send event type '${L}': The run has already errored with 'RUN_ERROR'. No further events can be sent.`));if(a&&L!==Zn.RUN_ERROR&&L!==Zn.RUN_STARTED)return Oo(()=>new $o(`Cannot send event type '${L}': The run has already finished with 'RUN_FINISHED'. Start a new run with 'RUN_STARTED'.`));if(f){if(L===Zn.RUN_STARTED){if(S&&!a)return Oo(()=>new $o("Cannot send 'RUN_STARTED' while a run is still active. The previous run must be finished with 'RUN_FINISHED' before starting a new run."));a&&C()}}else if(f=!0,L!==Zn.RUN_STARTED&&L!==Zn.RUN_ERROR)return Oo(()=>new $o("First event must be 'RUN_STARTED'"));switch(L){case Zn.TEXT_MESSAGE_START:{let F=P.messageId;return n.has(F)?Oo(()=>new $o(`Cannot send 'TEXT_MESSAGE_START' event: A text message with ID '${F}' is already in progress. Complete it with 'TEXT_MESSAGE_END' first.`)):(n.set(F,!0),Ko(P))}case Zn.TEXT_MESSAGE_CONTENT:{let F=P.messageId;return n.has(F)?Ko(P):Oo(()=>new $o(`Cannot send 'TEXT_MESSAGE_CONTENT' event: No active text message found with ID '${F}'. Start a text message with 'TEXT_MESSAGE_START' first.`))}case Zn.TEXT_MESSAGE_END:{let F=P.messageId;return n.has(F)?(n.delete(F),Ko(P)):Oo(()=>new $o(`Cannot send 'TEXT_MESSAGE_END' event: No active text message found with ID '${F}'. A 'TEXT_MESSAGE_START' event must be sent first.`))}case Zn.TOOL_CALL_START:{let F=P.toolCallId;return r.has(F)?Oo(()=>new $o(`Cannot send 'TOOL_CALL_START' event: A tool call with ID '${F}' is already in progress. Complete it with 'TOOL_CALL_END' first.`)):(r.set(F,!0),Ko(P))}case Zn.TOOL_CALL_ARGS:{let F=P.toolCallId;return r.has(F)?Ko(P):Oo(()=>new $o(`Cannot send 'TOOL_CALL_ARGS' event: No active tool call found with ID '${F}'. Start a tool call with 'TOOL_CALL_START' first.`))}case Zn.TOOL_CALL_END:{let F=P.toolCallId;return r.has(F)?(r.delete(F),Ko(P)):Oo(()=>new $o(`Cannot send 'TOOL_CALL_END' event: No active tool call found with ID '${F}'. A 'TOOL_CALL_START' event must be sent first.`))}case Zn.STEP_STARTED:{let F=P.stepName;return i.has(F)?Oo(()=>new $o(`Step "${F}" is already active for 'STEP_STARTED'`)):(i.set(F,!0),Ko(P))}case Zn.STEP_FINISHED:{let F=P.stepName;return i.has(F)?(i.delete(F),Ko(P)):Oo(()=>new $o(`Cannot send 'STEP_FINISHED' for step "${F}" that was not started`))}case Zn.RUN_STARTED:return S=!0,Ko(P);case Zn.RUN_FINISHED:{if(i.size>0){let F=Array.from(i.keys()).join(", ");return Oo(()=>new $o(`Cannot send 'RUN_FINISHED' while steps are still active: ${F}`))}if(n.size>0){let F=Array.from(n.keys()).join(", ");return Oo(()=>new $o(`Cannot send 'RUN_FINISHED' while text messages are still active: ${F}`))}if(r.size>0){let F=Array.from(r.keys()).join(", ");return Oo(()=>new $o(`Cannot send 'RUN_FINISHED' while tool calls are still active: ${F}`))}return a=!0,Ko(P)}case Zn.RUN_ERROR:return l=!0,Ko(P);case Zn.CUSTOM:return Ko(P);case Zn.THINKING_TEXT_MESSAGE_START:return y?x?Oo(()=>new $o("Cannot send 'THINKING_TEXT_MESSAGE_START' event: A thinking message is already in progress. Complete it with 'THINKING_TEXT_MESSAGE_END' first.")):(x=!0,Ko(P)):Oo(()=>new $o("Cannot send 'THINKING_TEXT_MESSAGE_START' event: A thinking step is not in progress. Create one with 'THINKING_START' first."));case Zn.THINKING_TEXT_MESSAGE_CONTENT:return x?Ko(P):Oo(()=>new $o("Cannot send 'THINKING_TEXT_MESSAGE_CONTENT' event: No active thinking message found. Start a message with 'THINKING_TEXT_MESSAGE_START' first."));case Zn.THINKING_TEXT_MESSAGE_END:return x?(x=!1,Ko(P)):Oo(()=>new $o("Cannot send 'THINKING_TEXT_MESSAGE_END' event: No active thinking message found. A 'THINKING_TEXT_MESSAGE_START' event must be sent first."));case Zn.THINKING_START:return y?Oo(()=>new $o("Cannot send 'THINKING_START' event: A thinking step is already in progress. End it with 'THINKING_END' first.")):(y=!0,Ko(P));case Zn.THINKING_END:return y?(y=!1,Ko(P)):Oo(()=>new $o("Cannot send 'THINKING_END' event: No active thinking step found. A 'THINKING_START' event must be sent first."));default:return Ko(P)}}))},oA=(e,t)=>e0e(()=>hC(fetch(e,t))).pipe(Qme(n=>{var r;if(!n.ok){let f=n.headers.get("content-type")||"";return hC(n.text()).pipe(w0(i=>{let y=i;if(f.includes("application/json"))try{y=JSON.parse(i)}catch{}let x=new Error(`HTTP ${n.status}: ${typeof y=="string"?y:JSON.stringify(y)}`);return x.status=n.status,x.payload=y,Oo(()=>x)}))}let a={type:"headers",status:n.status,headers:n.headers},l=(r=n.body)==null?void 0:r.getReader();return l?new Nu(f=>(f.next(a),(async()=>{try{for(;;){let{done:i,value:y}=await l.read();if(i)break;let x={type:"data",data:y};f.next(x)}f.complete()}catch(i){f.error(i)}})(),()=>{l.cancel().catch(i=>{if((i==null?void 0:i.name)!=="AbortError")throw i})})):Oo(()=>new Error("Failed to getReader() from response"))})),gge=e=>{let t=new C_,n=new TextDecoder("utf-8",{fatal:!1}),r="";e.subscribe({next:l=>{if(l.type!=="headers"&&l.type==="data"&&l.data){let f=n.decode(l.data,{stream:!0});r+=f;let i=r.split(/\n\n/);r=i.pop()||"";for(let y of i)a(y)}},error:l=>t.error(l),complete:()=>{r&&(r+=n.decode(),a(r)),t.complete()}});function a(l){let f=l.split(`
`),i=[];for(let y of f)y.startsWith("data: ")&&i.push(y.slice(6));if(i.length>0)try{let y=i.join(`
`),x=JSON.parse(y);t.next(x)}catch(y){t.error(y)}}return t.asObservable()},_ge=e=>{let t=new C_,n=new Uint8Array(0);e.subscribe({next:a=>{if(a.type!=="headers"&&a.type==="data"&&a.data){let l=new Uint8Array(n.length+a.data.length);l.set(n,0),l.set(a.data,n.length),n=l,r()}},error:a=>t.error(a),complete:()=>{if(n.length>0)try{r()}catch{console.warn("Incomplete or invalid protocol buffer data at stream end")}t.complete()}});function r(){for(;n.length>=4;){let a=4+new DataView(n.buffer,n.byteOffset,4).getUint32(0,!1);if(n.length<a)break;try{let l=n.slice(4,a),f=P0e(l);t.next(f),n=n.slice(a)}catch(l){let f=l instanceof Error?l.message:String(l);t.error(new Error(`Failed to decode protocol buffer message: ${f}`));return}}}return t.asObservable()},lA=e=>{let t=new C_,n=new kY,r=!1;return e.subscribe({next:a=>{n.next(a),a.type==="headers"&&!r?(r=!0,a.headers.get("content-type")===O0e?_ge(n).subscribe({next:l=>t.next(l),error:l=>t.error(l),complete:()=>t.complete()}):gge(n).subscribe({next:l=>{try{let f=oY.parse(l);t.next(f)}catch(f){t.error(f)}},error:l=>{if((l==null?void 0:l.name)==="AbortError"){t.next({type:Zn.RUN_ERROR,rawEvent:l}),t.complete();return}return t.error(l)},complete:()=>t.complete()})):r||t.error(new Error("No headers event received before data events"))},error:a=>{n.error(a),t.error(a)},complete:()=>{n.complete()}}),t.asObservable()},ao=ZY(["TextMessageStart","TextMessageContent","TextMessageEnd","ActionExecutionStart","ActionExecutionArgs","ActionExecutionEnd","ActionExecutionResult","AgentStateMessage","MetaEvent","RunStarted","RunFinished","RunError","NodeStarted","NodeFinished"]),yge=ZY(["LangGraphInterruptEvent","PredictState","Exit"]),vge=qc({type:Ef(ao.enum.TextMessageStart),messageId:Aa(),parentMessageId:Aa().optional(),role:Aa().optional()}),xge=qc({type:Ef(ao.enum.TextMessageContent),messageId:Aa(),content:Aa()}),bge=qc({type:Ef(ao.enum.TextMessageEnd),messageId:Aa()}),wge=qc({type:Ef(ao.enum.ActionExecutionStart),actionExecutionId:Aa(),actionName:Aa(),parentMessageId:Aa().optional()}),Tge=qc({type:Ef(ao.enum.ActionExecutionArgs),actionExecutionId:Aa(),args:Aa()}),Ege=qc({type:Ef(ao.enum.ActionExecutionEnd),actionExecutionId:Aa()}),Sge=qc({type:Ef(ao.enum.ActionExecutionResult),actionName:Aa(),actionExecutionId:Aa(),result:Aa()}),Age=qc({type:Ef(ao.enum.AgentStateMessage),threadId:Aa(),agentName:Aa(),nodeName:Aa(),runId:Aa(),active:lV(),role:Aa(),state:Aa(),running:lV()}),Cge=qc({type:Ef(ao.enum.MetaEvent),name:yge,value:nD()}),kge=qc({type:Ef(ao.enum.RunError),message:Aa(),code:Aa().optional()});age("type",[vge,xge,bge,wge,Tge,Ege,Sge,Age,Cge,kge]);qc({id:Aa(),role:Aa(),content:Aa(),parentMessageId:Aa().optional()});qc({id:Aa(),name:Aa(),arguments:nD(),parentMessageId:Aa().optional()});qc({id:Aa(),result:nD(),actionExecutionId:Aa(),actionName:Aa()});var Ige=e=>{if(typeof e=="string")return e;if(!Array.isArray(e))return;let t=e.filter(n=>n.type==="text").map(n=>n.text).filter(n=>n.length>0);if(t.length!==0)return t.join(`
`)},Rge=(e,t,n)=>r=>{let a={},l=!0,f=!0,i="",y=null,x=null,S=[],C={},P=L=>{typeof L=="object"&&L!==null&&("messages"in L&&delete L.messages,a=L)};return r.pipe(w0(L=>{switch(L.type){case Zn.TEXT_MESSAGE_START:{let F=L;return[{type:ao.enum.TextMessageStart,messageId:F.messageId,role:F.role}]}case Zn.TEXT_MESSAGE_CONTENT:{let F=L;return[{type:ao.enum.TextMessageContent,messageId:F.messageId,content:F.delta}]}case Zn.TEXT_MESSAGE_END:{let F=L;return[{type:ao.enum.TextMessageEnd,messageId:F.messageId}]}case Zn.TOOL_CALL_START:{let F=L;return S.push({id:F.toolCallId,type:"function",function:{name:F.toolCallName,arguments:""}}),f=!0,C[F.toolCallId]=F.toolCallName,[{type:ao.enum.ActionExecutionStart,actionExecutionId:F.toolCallId,actionName:F.toolCallName,parentMessageId:F.parentMessageId}]}case Zn.TOOL_CALL_ARGS:{let F=L,U=S.find(G=>G.id===F.toolCallId);if(!U)return console.warn(`TOOL_CALL_ARGS: No tool call found with ID '${F.toolCallId}'`),[];U.function.arguments+=F.delta;let q=!1;if(x){let G=x.find($=>$.tool==U.function.name);if(G)try{let $=JSON.parse(CX(U.function.arguments));G.tool_argument&&G.tool_argument in $?(P(S0(au({},a),{[G.state_key]:$[G.tool_argument]})),q=!0):G.tool_argument||(P(S0(au({},a),{[G.state_key]:$})),q=!0)}catch{}}return[{type:ao.enum.ActionExecutionArgs,actionExecutionId:F.toolCallId,args:F.delta},...q?[{type:ao.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:i,runId:t,running:l,role:"assistant",state:JSON.stringify(a),active:f}]:[]]}case Zn.TOOL_CALL_END:{let F=L;return[{type:ao.enum.ActionExecutionEnd,actionExecutionId:F.toolCallId}]}case Zn.TOOL_CALL_RESULT:{let F=L;return[{type:ao.enum.ActionExecutionResult,actionExecutionId:F.toolCallId,result:F.content,actionName:C[F.toolCallId]||"unknown"}]}case Zn.RAW:return[];case Zn.CUSTOM:{let F=L;switch(F.name){case"Exit":l=!1;break;case"PredictState":x=F.value;break}return[{type:ao.enum.MetaEvent,name:F.name,value:F.value}]}case Zn.STATE_SNAPSHOT:return P(L.snapshot),[{type:ao.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:i,runId:t,running:l,role:"assistant",state:JSON.stringify(a),active:f}];case Zn.STATE_DELTA:{let F=sx(a,L.delta,!0,!1);return F?(P(F.newDocument),[{type:ao.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:i,runId:t,running:l,role:"assistant",state:JSON.stringify(a),active:f}]):[]}case Zn.MESSAGES_SNAPSHOT:return y=L.messages,[{type:ao.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:i,runId:t,running:l,role:"assistant",state:JSON.stringify(au(au({},a),y?{messages:y}:{})),active:!0}];case Zn.RUN_STARTED:return[];case Zn.RUN_FINISHED:return y&&(a.messages=y),Object.keys(a).length===0?[]:[{type:ao.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:i,runId:t,running:l,role:"assistant",state:JSON.stringify(au(au({},a),y?{messages:Mge(y)}:{})),active:!1}];case Zn.RUN_ERROR:{let F=L;return[{type:ao.enum.RunError,message:F.message,code:F.code}]}case Zn.STEP_STARTED:return i=L.stepName,S=[],x=null,[{type:ao.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:i,runId:t,running:l,role:"assistant",state:JSON.stringify(a),active:!0}];case Zn.STEP_FINISHED:return S=[],x=null,[{type:ao.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:i,runId:t,running:l,role:"assistant",state:JSON.stringify(a),active:!1}];default:return[]}}))};function Mge(e){var t;let n=[];for(let r of e)if(r.role==="assistant"||r.role==="user"||r.role==="system"){let a=Ige(r.content);if(a){let l={id:r.id,role:r.role,content:a};n.push(l)}if(r.role==="assistant"&&r.toolCalls&&r.toolCalls.length>0)for(let l of r.toolCalls){let f={id:l.id,name:l.function.name,arguments:JSON.parse(l.function.arguments),parentMessageId:r.id};n.push(f)}}else if(r.role==="tool"){let a="unknown";for(let f of e)if(f.role==="assistant"&&(t=f.toolCalls)!=null&&t.length){for(let i of f.toolCalls)if(i.id===r.toolCallId){a=i.function.name;break}}let l={id:r.id,result:r.content,actionExecutionId:r.toolCallId,actionName:a};n.push(l)}return n}var uA=e=>t=>{let n,r,a,l=()=>{if(!n||a!=="text")throw new Error("No text message to close");let y={type:Zn.TEXT_MESSAGE_END,messageId:n.messageId};return a=void 0,n=void 0,e&&console.debug("[TRANSFORM]: TEXT_MESSAGE_END",JSON.stringify(y)),y},f=()=>{if(!r||a!=="tool")throw new Error("No tool call to close");let y={type:Zn.TOOL_CALL_END,toolCallId:r.toolCallId};return a=void 0,r=void 0,e&&console.debug("[TRANSFORM]: TOOL_CALL_END",JSON.stringify(y)),y},i=()=>a==="text"?[l()]:a==="tool"?[f()]:[];return t.pipe(w0(y=>{switch(y.type){case Zn.TEXT_MESSAGE_START:case Zn.TEXT_MESSAGE_CONTENT:case Zn.TEXT_MESSAGE_END:case Zn.TOOL_CALL_START:case Zn.TOOL_CALL_ARGS:case Zn.TOOL_CALL_END:case Zn.TOOL_CALL_RESULT:case Zn.STATE_SNAPSHOT:case Zn.STATE_DELTA:case Zn.MESSAGES_SNAPSHOT:case Zn.CUSTOM:case Zn.RUN_STARTED:case Zn.RUN_FINISHED:case Zn.RUN_ERROR:case Zn.STEP_STARTED:case Zn.STEP_FINISHED:case Zn.THINKING_START:case Zn.THINKING_END:case Zn.THINKING_TEXT_MESSAGE_START:case Zn.THINKING_TEXT_MESSAGE_CONTENT:case Zn.THINKING_TEXT_MESSAGE_END:return[...i(),y];case Zn.RAW:case Zn.ACTIVITY_SNAPSHOT:case Zn.ACTIVITY_DELTA:return[y];case Zn.TEXT_MESSAGE_CHUNK:let x=y,S=[];if((a!=="text"||x.messageId!==void 0&&x.messageId!==(n==null?void 0:n.messageId))&&S.push(...i()),a!=="text"){if(x.messageId===void 0)throw new Error("First TEXT_MESSAGE_CHUNK must have a messageId");n={messageId:x.messageId},a="text";let L={type:Zn.TEXT_MESSAGE_START,messageId:x.messageId,role:x.role||"assistant"};S.push(L),e&&console.debug("[TRANSFORM]: TEXT_MESSAGE_START",JSON.stringify(L))}if(x.delta!==void 0){let L={type:Zn.TEXT_MESSAGE_CONTENT,messageId:n.messageId,delta:x.delta};S.push(L),e&&console.debug("[TRANSFORM]: TEXT_MESSAGE_CONTENT",JSON.stringify(L))}return S;case Zn.TOOL_CALL_CHUNK:let C=y,P=[];if((a!=="tool"||C.toolCallId!==void 0&&C.toolCallId!==(r==null?void 0:r.toolCallId))&&P.push(...i()),a!=="tool"){if(C.toolCallId===void 0)throw new Error("First TOOL_CALL_CHUNK must have a toolCallId");if(C.toolCallName===void 0)throw new Error("First TOOL_CALL_CHUNK must have a toolCallName");r={toolCallId:C.toolCallId,toolCallName:C.toolCallName,parentMessageId:C.parentMessageId},a="tool";let L={type:Zn.TOOL_CALL_START,toolCallId:C.toolCallId,toolCallName:C.toolCallName,parentMessageId:C.parentMessageId};P.push(L),e&&console.debug("[TRANSFORM]: TOOL_CALL_START",JSON.stringify(L))}if(C.delta!==void 0){let L={type:Zn.TOOL_CALL_ARGS,toolCallId:r.toolCallId,delta:C.delta};P.push(L),e&&console.debug("[TRANSFORM]: TOOL_CALL_ARGS",JSON.stringify(L))}return P}return y.type,[]}),nO(()=>{i()}))},KY=class{runNext(t,n){return n.run(t).pipe(uA(!1))}runNextWithState(t,n){let r=Ya(t.messages||[]),a=Ya(t.state||{}),l=new kY;return YY(t,l,n,[]).subscribe(f=>{f.messages!==void 0&&(r=f.messages),f.state!==void 0&&(a=f.state)}),this.runNext(t,n).pipe(AY(async f=>(l.next(f),await new Promise(i=>setTimeout(i,0)),{event:f,messages:Ya(r),state:Ya(a)})))}},Pge=class extends KY{constructor(t){super(),this.fn=t}run(t,n){return this.fn(t,n)}};function Oge(e){let t=e.content;if(Array.isArray(t)){let n=t.filter(r=>typeof r=="object"&&r!==null&&"type"in r&&r.type==="text"&&typeof r.text=="string").map(r=>r.text).join("");return S0(au({},e),{content:n})}return typeof t=="string"?e:S0(au({},e),{content:""})}var Lge=class extends KY{run(t,n){let r=t,{parentRunId:a}=r,l=mge(r,["parentRunId"]),f=S0(au({},l),{messages:l.messages.map(Oge)});return this.runNext(f,n)}},Dge={version:"0.0.42"},Nge=class{constructor({agentId:t,description:n,threadId:r,initialMessages:a,initialState:l,debug:f}={}){this.debug=!1,this.subscribers=[],this.isRunning=!1,this.middlewares=[],this.agentId=t,this.description=n??"",this.threadId=r??Y1(),this.messages=Ya(a??[]),this.state=Ya(l??{}),this.debug=f??!1,cge(this.maxVersion,"0.0.39")<=0&&this.middlewares.unshift(new Lge)}get maxVersion(){return Dge.version}subscribe(t){return this.subscribers.push(t),{unsubscribe:()=>{this.subscribers=this.subscribers.filter(n=>n!==t)}}}use(...t){let n=t.map(r=>typeof r=="function"?new Pge(r):r);return this.middlewares.push(...n),this}async runAgent(t,n){var r;try{this.isRunning=!0,this.agentId=(r=this.agentId)!=null?r:Y1();let a=this.prepareRunAgentInput(t),l,f=new Set(this.messages.map(C=>C.id)),i=[{onRunFinishedEvent:C=>{l=C.result}},...this.subscribers,n??{}];await this.onInitialize(a,i),this.activeRunDetach$=new C_;let y;this.activeRunCompletionPromise=new Promise(C=>{y=C});let x=cU(()=>this.middlewares.length===0?this.run(a):this.middlewares.reduceRight((C,P)=>({run:L=>P.run(L,C)}),this).run(a),uA(this.debug),eR(this.debug),C=>C.pipe(fU(this.activeRunDetach$)),C=>this.apply(a,C,i),C=>this.processApplyEvents(a,C,i),eO(C=>(this.isRunning=!1,this.onError(a,C,i))),nO(()=>{this.isRunning=!1,this.onFinalize(a,i),y==null||y(),y=void 0,this.activeRunCompletionPromise=void 0,this.activeRunDetach$=void 0}));await pU(x(Ko(null)));let S=Ya(this.messages).filter(C=>!f.has(C.id));return{result:l,newMessages:S}}finally{this.isRunning=!1}}connect(t){throw new YP}async connectAgent(t,n){var r;try{this.isRunning=!0,this.agentId=(r=this.agentId)!=null?r:Y1();let a=this.prepareRunAgentInput(t),l,f=new Set(this.messages.map(C=>C.id)),i=[{onRunFinishedEvent:C=>{l=C.result}},...this.subscribers,n??{}];await this.onInitialize(a,i),this.activeRunDetach$=new C_;let y;this.activeRunCompletionPromise=new Promise(C=>{y=C});let x=cU(()=>this.connect(a),uA(this.debug),eR(this.debug),C=>C.pipe(fU(this.activeRunDetach$)),C=>this.apply(a,C,i),C=>this.processApplyEvents(a,C,i),eO(C=>(this.isRunning=!1,C instanceof YP?CY:this.onError(a,C,i))),nO(()=>{this.isRunning=!1,this.onFinalize(a,i),y==null||y(),y=void 0,this.activeRunCompletionPromise=void 0,this.activeRunDetach$=void 0}));await pU(x(Ko(null)));let S=Ya(this.messages).filter(C=>!f.has(C.id));return{result:l,newMessages:S}}finally{this.isRunning=!1}}abortRun(){}async detachActiveRun(){var t,n;if(!this.activeRunDetach$)return;let r=(t=this.activeRunCompletionPromise)!=null?t:Promise.resolve();this.activeRunDetach$.next(),(n=this.activeRunDetach$)==null||n.complete(),await r}apply(t,n,r){return YY(t,n,this,r)}processApplyEvents(t,n,r){return n.pipe(Jme(a=>{a.messages&&(this.messages=a.messages,r.forEach(l=>{var f;(f=l.onMessagesChanged)==null||f.call(l,{messages:this.messages,state:this.state,agent:this,input:t})})),a.state&&(this.state=a.state,r.forEach(l=>{var f;(f=l.onStateChanged)==null||f.call(l,{state:this.state,messages:this.messages,agent:this,input:t})}))}))}prepareRunAgentInput(t){var n,r,a;let l=Ya(this.messages).filter(f=>f.role!=="activity");return{threadId:this.threadId,runId:(t==null?void 0:t.runId)||Y1(),tools:Ya((n=t==null?void 0:t.tools)!=null?n:[]),context:Ya((r=t==null?void 0:t.context)!=null?r:[]),forwardedProps:Ya((a=t==null?void 0:t.forwardedProps)!=null?a:{}),state:Ya(this.state),messages:l}}async onInitialize(t,n){let r=await Lo(n,this.messages,this.state,(a,l,f)=>{var i;return(i=a.onRunInitialized)==null?void 0:i.call(a,{messages:l,state:f,agent:this,input:t})});(r.messages!==void 0||r.state!==void 0)&&(r.messages&&(this.messages=r.messages,t.messages=r.messages,n.forEach(a=>{var l;(l=a.onMessagesChanged)==null||l.call(a,{messages:this.messages,state:this.state,agent:this,input:t})})),r.state&&(this.state=r.state,t.state=r.state,n.forEach(a=>{var l;(l=a.onStateChanged)==null||l.call(a,{state:this.state,messages:this.messages,agent:this,input:t})})))}onError(t,n,r){return hC(Lo(r,this.messages,this.state,(a,l,f)=>{var i;return(i=a.onRunFailed)==null?void 0:i.call(a,{error:n,messages:l,state:f,agent:this,input:t})})).pipe(tO(a=>{let l=a;if((l.messages!==void 0||l.state!==void 0)&&(l.messages!==void 0&&(this.messages=l.messages,r.forEach(f=>{var i;(i=f.onMessagesChanged)==null||i.call(f,{messages:this.messages,state:this.state,agent:this,input:t})})),l.state!==void 0&&(this.state=l.state,r.forEach(f=>{var i;(i=f.onStateChanged)==null||i.call(f,{state:this.state,messages:this.messages,agent:this,input:t})}))),l.stopPropagation!==!0)throw console.error("Agent execution failed:",n),n;return{}}))}async onFinalize(t,n){let r=await Lo(n,this.messages,this.state,(a,l,f)=>{var i;return(i=a.onRunFinalized)==null?void 0:i.call(a,{messages:l,state:f,agent:this,input:t})});(r.messages!==void 0||r.state!==void 0)&&(r.messages!==void 0&&(this.messages=r.messages,n.forEach(a=>{var l;(l=a.onMessagesChanged)==null||l.call(a,{messages:this.messages,state:this.state,agent:this,input:t})})),r.state!==void 0&&(this.state=r.state,n.forEach(a=>{var l;(l=a.onStateChanged)==null||l.call(a,{state:this.state,messages:this.messages,agent:this,input:t})})))}clone(){let t=Object.create(Object.getPrototypeOf(this));return t.agentId=this.agentId,t.description=this.description,t.threadId=this.threadId,t.messages=Ya(this.messages),t.state=Ya(this.state),t.debug=this.debug,t.isRunning=this.isRunning,t.subscribers=[...this.subscribers],t.middlewares=[...this.middlewares],t}addMessage(t){this.messages.push(t),(async()=>{var n,r,a;for(let l of this.subscribers)await((n=l.onNewMessage)==null?void 0:n.call(l,{message:t,messages:this.messages,state:this.state,agent:this}));if(t.role==="assistant"&&t.toolCalls)for(let l of t.toolCalls)for(let f of this.subscribers)await((r=f.onNewToolCall)==null?void 0:r.call(f,{toolCall:l,messages:this.messages,state:this.state,agent:this}));for(let l of this.subscribers)await((a=l.onMessagesChanged)==null?void 0:a.call(l,{messages:this.messages,state:this.state,agent:this}))})()}addMessages(t){this.messages.push(...t),(async()=>{var n,r,a;for(let l of t){for(let f of this.subscribers)await((n=f.onNewMessage)==null?void 0:n.call(f,{message:l,messages:this.messages,state:this.state,agent:this}));if(l.role==="assistant"&&l.toolCalls)for(let f of l.toolCalls)for(let i of this.subscribers)await((r=i.onNewToolCall)==null?void 0:r.call(i,{toolCall:f,messages:this.messages,state:this.state,agent:this}))}for(let l of this.subscribers)await((a=l.onMessagesChanged)==null?void 0:a.call(l,{messages:this.messages,state:this.state,agent:this}))})()}setMessages(t){this.messages=Ya(t),(async()=>{var n;for(let r of this.subscribers)await((n=r.onMessagesChanged)==null?void 0:n.call(r,{messages:this.messages,state:this.state,agent:this}))})()}setState(t){this.state=Ya(t),(async()=>{var n;for(let r of this.subscribers)await((n=r.onStateChanged)==null?void 0:n.call(r,{messages:this.messages,state:this.state,agent:this}))})()}legacy_to_be_removed_runAgentBridged(t){var n;this.agentId=(n=this.agentId)!=null?n:Y1();let r=this.prepareRunAgentInput(t);return(this.middlewares.length===0?this.run(r):this.middlewares.reduceRight((a,l)=>({run:f=>l.run(f,a)}),this).run(r)).pipe(uA(this.debug),eR(this.debug),Rge(this.threadId,r.runId,this.agentId),a=>a.pipe(tO(l=>(this.debug&&console.debug("[LEGACY]:",JSON.stringify(l)),l))))}},EC=class extends Nge{constructor(t){var n;super(t),this.abortController=new AbortController,this.url=t.url,this.headers=Ya((n=t.headers)!=null?n:{})}requestInit(t){return{method:"POST",headers:S0(au({},this.headers),{"Content-Type":"application/json",Accept:"text/event-stream"}),body:JSON.stringify(t),signal:this.abortController.signal}}runAgent(t,n){var r;return this.abortController=(r=t==null?void 0:t.abortController)!=null?r:new AbortController,super.runAgent(t,n)}abortRun(){this.abortController.abort(),super.abortRun()}run(t){let n=oA(this.url,this.requestInit(t));return lA(n)}clone(){var t;let n=super.clone();n.url=this.url,n.headers=Ya((t=this.headers)!=null?t:{});let r=new AbortController,a=this.abortController.signal;return a.aborted&&r.abort(a.reason),n.abortController=r,n}};const zge=(e,t)=>{const n=new Array(e.length+t.length);for(let r=0;r<e.length;r++)n[r]=e[r];for(let r=0;r<t.length;r++)n[e.length+r]=t[r];return n},Fge=(e,t)=>({classGroupId:e,validator:t}),QY=(e=new Map,t=null,n)=>({nextPart:e,validators:t,classGroupId:n}),SC="-",pV=[],Bge="arbitrary..",jge=e=>{const t=Vge(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:f=>{if(f.startsWith("[")&&f.endsWith("]"))return Uge(f);const i=f.split(SC),y=i[0]===""&&i.length>1?1:0;return JY(i,y,t)},getConflictingClassGroupIds:(f,i)=>{if(i){const y=r[f],x=n[f];return y?x?zge(x,y):y:x||pV}return n[f]||pV}}},JY=(e,t,n)=>{if(e.length-t===0)return n.classGroupId;const a=e[t],l=n.nextPart.get(a);if(l){const x=JY(e,t+1,l);if(x)return x}const f=n.validators;if(f===null)return;const i=t===0?e.join(SC):e.slice(t).join(SC),y=f.length;for(let x=0;x<y;x++){const S=f[x];if(S.validator(i))return S.classGroupId}},Uge=e=>e.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const t=e.slice(1,-1),n=t.indexOf(":"),r=t.slice(0,n);return r?Bge+r:void 0})(),Vge=e=>{const{theme:t,classGroups:n}=e;return $ge(n,t)},$ge=(e,t)=>{const n=QY();for(const r in e){const a=e[r];rD(a,n,r,t)}return n},rD=(e,t,n,r)=>{const a=e.length;for(let l=0;l<a;l++){const f=e[l];Hge(f,t,n,r)}},Hge=(e,t,n,r)=>{if(typeof e=="string"){Gge(e,t,n);return}if(typeof e=="function"){qge(e,t,n,r);return}Zge(e,t,n,r)},Gge=(e,t,n)=>{const r=e===""?t:eK(t,e);r.classGroupId=n},qge=(e,t,n,r)=>{if(Wge(e)){rD(e(r),t,n,r);return}t.validators===null&&(t.validators=[]),t.validators.push(Fge(n,e))},Zge=(e,t,n,r)=>{const a=Object.entries(e),l=a.length;for(let f=0;f<l;f++){const[i,y]=a[f];rD(y,eK(t,i),n,r)}},eK=(e,t)=>{let n=e;const r=t.split(SC),a=r.length;for(let l=0;l<a;l++){const f=r[l];let i=n.nextPart.get(f);i||(i=QY(),n.nextPart.set(f,i)),n=i}return n},Wge=e=>"isThemeGetter"in e&&e.isThemeGetter===!0,Xge=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=Object.create(null),r=Object.create(null);const a=(l,f)=>{n[l]=f,t++,t>e&&(t=0,r=n,n=Object.create(null))};return{get(l){let f=n[l];if(f!==void 0)return f;if((f=r[l])!==void 0)return a(l,f),f},set(l,f){l in n?n[l]=f:a(l,f)}}},wO="!",mV=":",Yge=[],gV=(e,t,n,r,a)=>({modifiers:e,hasImportantModifier:t,baseClassName:n,maybePostfixModifierPosition:r,isExternal:a}),Kge=e=>{const{prefix:t,experimentalParseClassName:n}=e;let r=a=>{const l=[];let f=0,i=0,y=0,x;const S=a.length;for(let U=0;U<S;U++){const q=a[U];if(f===0&&i===0){if(q===mV){l.push(a.slice(y,U)),y=U+1;continue}if(q==="/"){x=U;continue}}q==="["?f++:q==="]"?f--:q==="("?i++:q===")"&&i--}const C=l.length===0?a:a.slice(y);let P=C,L=!1;C.endsWith(wO)?(P=C.slice(0,-1),L=!0):C.startsWith(wO)&&(P=C.slice(1),L=!0);const F=x&&x>y?x-y:void 0;return gV(l,L,P,F)};if(t){const a=t+mV,l=r;r=f=>f.startsWith(a)?l(f.slice(a.length)):gV(Yge,!1,f,void 0,!0)}if(n){const a=r;r=l=>n({className:l,parseClassName:a})}return r},Qge=e=>{const t=new Map;return e.orderSensitiveModifiers.forEach((n,r)=>{t.set(n,1e6+r)}),n=>{const r=[];let a=[];for(let l=0;l<n.length;l++){const f=n[l],i=f[0]==="[",y=t.has(f);i||y?(a.length>0&&(a.sort(),r.push(...a),a=[]),r.push(f)):a.push(f)}return a.length>0&&(a.sort(),r.push(...a)),r}},Jge=e=>({cache:Xge(e.cacheSize),parseClassName:Kge(e),sortModifiers:Qge(e),...jge(e)}),e_e=/\s+/,t_e=(e,t)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:a,sortModifiers:l}=t,f=[],i=e.trim().split(e_e);let y="";for(let x=i.length-1;x>=0;x-=1){const S=i[x],{isExternal:C,modifiers:P,hasImportantModifier:L,baseClassName:F,maybePostfixModifierPosition:U}=n(S);if(C){y=S+(y.length>0?" "+y:y);continue}let q=!!U,G=r(q?F.substring(0,U):F);if(!G){if(!q){y=S+(y.length>0?" "+y:y);continue}if(G=r(F),!G){y=S+(y.length>0?" "+y:y);continue}q=!1}const $=P.length===0?"":P.length===1?P[0]:l(P).join(":"),X=L?$+wO:$,ie=X+G;if(f.indexOf(ie)>-1)continue;f.push(ie);const de=a(G,q);for(let fe=0;fe<de.length;++fe){const be=de[fe];f.push(X+be)}y=S+(y.length>0?" "+y:y)}return y},n_e=(...e)=>{let t=0,n,r,a="";for(;t<e.length;)(n=e[t++])&&(r=tK(n))&&(a&&(a+=" "),a+=r);return a},tK=e=>{if(typeof e=="string")return e;let t,n="";for(let r=0;r<e.length;r++)e[r]&&(t=tK(e[r]))&&(n&&(n+=" "),n+=t);return n},r_e=(e,...t)=>{let n,r,a,l;const f=y=>{const x=t.reduce((S,C)=>C(S),e());return n=Jge(x),r=n.cache.get,a=n.cache.set,l=i,i(y)},i=y=>{const x=r(y);if(x)return x;const S=t_e(y,n);return a(y,S),S};return l=f,(...y)=>l(n_e(...y))},i_e=[],vl=e=>{const t=n=>n[e]||i_e;return t.isThemeGetter=!0,t},nK=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,rK=/^\((?:(\w[\w-]*):)?(.+)\)$/i,s_e=/^\d+\/\d+$/,a_e=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,o_e=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,l_e=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,u_e=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,c_e=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,U1=e=>s_e.test(e),Xs=e=>!!e&&!Number.isNaN(Number(e)),Tm=e=>!!e&&Number.isInteger(Number(e)),tR=e=>e.endsWith("%")&&Xs(e.slice(0,-1)),tp=e=>a_e.test(e),d_e=()=>!0,h_e=e=>o_e.test(e)&&!l_e.test(e),iK=()=>!1,f_e=e=>u_e.test(e),p_e=e=>c_e.test(e),m_e=e=>!oi(e)&&!li(e),g_e=e=>Cx(e,oK,iK),oi=e=>nK.test(e),Fg=e=>Cx(e,lK,h_e),nR=e=>Cx(e,b_e,Xs),_V=e=>Cx(e,sK,iK),__e=e=>Cx(e,aK,p_e),$3=e=>Cx(e,uK,f_e),li=e=>rK.test(e),Xw=e=>kx(e,lK),y_e=e=>kx(e,w_e),yV=e=>kx(e,sK),v_e=e=>kx(e,oK),x_e=e=>kx(e,aK),H3=e=>kx(e,uK,!0),Cx=(e,t,n)=>{const r=nK.exec(e);return r?r[1]?t(r[1]):n(r[2]):!1},kx=(e,t,n=!1)=>{const r=rK.exec(e);return r?r[1]?t(r[1]):n:!1},sK=e=>e==="position"||e==="percentage",aK=e=>e==="image"||e==="url",oK=e=>e==="length"||e==="size"||e==="bg-size",lK=e=>e==="length",b_e=e=>e==="number",w_e=e=>e==="family-name",uK=e=>e==="shadow",T_e=()=>{const e=vl("color"),t=vl("font"),n=vl("text"),r=vl("font-weight"),a=vl("tracking"),l=vl("leading"),f=vl("breakpoint"),i=vl("container"),y=vl("spacing"),x=vl("radius"),S=vl("shadow"),C=vl("inset-shadow"),P=vl("text-shadow"),L=vl("drop-shadow"),F=vl("blur"),U=vl("perspective"),q=vl("aspect"),G=vl("ease"),$=vl("animate"),X=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ie=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],de=()=>[...ie(),li,oi],fe=()=>["auto","hidden","clip","visible","scroll"],be=()=>["auto","contain","none"],ve=()=>[li,oi,y],Je=()=>[U1,"full","auto",...ve()],we=()=>[Tm,"none","subgrid",li,oi],rt=()=>["auto",{span:["full",Tm,li,oi]},Tm,li,oi],He=()=>[Tm,"auto",li,oi],ft=()=>["auto","min","max","fr",li,oi],Ct=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],Nt=()=>["start","end","center","stretch","center-safe","end-safe"],Rt=()=>["auto",...ve()],en=()=>[U1,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...ve()],nt=()=>[e,li,oi],pt=()=>[...ie(),yV,_V,{position:[li,oi]}],Oe=()=>["no-repeat",{repeat:["","x","y","space","round"]}],gn=()=>["auto","cover","contain",v_e,g_e,{size:[li,oi]}],wt=()=>[tR,Xw,Fg],Fe=()=>["","none","full",x,li,oi],jt=()=>["",Xs,Xw,Fg],Tn=()=>["solid","dashed","dotted","double"],mn=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],zn=()=>[Xs,tR,yV,_V],yn=()=>["","none",F,li,oi],qt=()=>["none",Xs,li,oi],wn=()=>["none",Xs,li,oi],Sn=()=>[Xs,li,oi],Xn=()=>[U1,"full",...ve()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[tp],breakpoint:[tp],color:[d_e],container:[tp],"drop-shadow":[tp],ease:["in","out","in-out"],font:[m_e],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[tp],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[tp],shadow:[tp],spacing:["px",Xs],text:[tp],"text-shadow":[tp],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",U1,oi,li,q]}],container:["container"],columns:[{columns:[Xs,oi,li,i]}],"break-after":[{"break-after":X()}],"break-before":[{"break-before":X()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:de()}],overflow:[{overflow:fe()}],"overflow-x":[{"overflow-x":fe()}],"overflow-y":[{"overflow-y":fe()}],overscroll:[{overscroll:be()}],"overscroll-x":[{"overscroll-x":be()}],"overscroll-y":[{"overscroll-y":be()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:Je()}],"inset-x":[{"inset-x":Je()}],"inset-y":[{"inset-y":Je()}],start:[{start:Je()}],end:[{end:Je()}],top:[{top:Je()}],right:[{right:Je()}],bottom:[{bottom:Je()}],left:[{left:Je()}],visibility:["visible","invisible","collapse"],z:[{z:[Tm,"auto",li,oi]}],basis:[{basis:[U1,"full","auto",i,...ve()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Xs,U1,"auto","initial","none",oi]}],grow:[{grow:["",Xs,li,oi]}],shrink:[{shrink:["",Xs,li,oi]}],order:[{order:[Tm,"first","last","none",li,oi]}],"grid-cols":[{"grid-cols":we()}],"col-start-end":[{col:rt()}],"col-start":[{"col-start":He()}],"col-end":[{"col-end":He()}],"grid-rows":[{"grid-rows":we()}],"row-start-end":[{row:rt()}],"row-start":[{"row-start":He()}],"row-end":[{"row-end":He()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":ft()}],"auto-rows":[{"auto-rows":ft()}],gap:[{gap:ve()}],"gap-x":[{"gap-x":ve()}],"gap-y":[{"gap-y":ve()}],"justify-content":[{justify:[...Ct(),"normal"]}],"justify-items":[{"justify-items":[...Nt(),"normal"]}],"justify-self":[{"justify-self":["auto",...Nt()]}],"align-content":[{content:["normal",...Ct()]}],"align-items":[{items:[...Nt(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...Nt(),{baseline:["","last"]}]}],"place-content":[{"place-content":Ct()}],"place-items":[{"place-items":[...Nt(),"baseline"]}],"place-self":[{"place-self":["auto",...Nt()]}],p:[{p:ve()}],px:[{px:ve()}],py:[{py:ve()}],ps:[{ps:ve()}],pe:[{pe:ve()}],pt:[{pt:ve()}],pr:[{pr:ve()}],pb:[{pb:ve()}],pl:[{pl:ve()}],m:[{m:Rt()}],mx:[{mx:Rt()}],my:[{my:Rt()}],ms:[{ms:Rt()}],me:[{me:Rt()}],mt:[{mt:Rt()}],mr:[{mr:Rt()}],mb:[{mb:Rt()}],ml:[{ml:Rt()}],"space-x":[{"space-x":ve()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":ve()}],"space-y-reverse":["space-y-reverse"],size:[{size:en()}],w:[{w:[i,"screen",...en()]}],"min-w":[{"min-w":[i,"screen","none",...en()]}],"max-w":[{"max-w":[i,"screen","none","prose",{screen:[f]},...en()]}],h:[{h:["screen","lh",...en()]}],"min-h":[{"min-h":["screen","lh","none",...en()]}],"max-h":[{"max-h":["screen","lh",...en()]}],"font-size":[{text:["base",n,Xw,Fg]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,li,nR]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",tR,oi]}],"font-family":[{font:[y_e,oi,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[a,li,oi]}],"line-clamp":[{"line-clamp":[Xs,"none",li,nR]}],leading:[{leading:[l,...ve()]}],"list-image":[{"list-image":["none",li,oi]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",li,oi]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:nt()}],"text-color":[{text:nt()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Tn(),"wavy"]}],"text-decoration-thickness":[{decoration:[Xs,"from-font","auto",li,Fg]}],"text-decoration-color":[{decoration:nt()}],"underline-offset":[{"underline-offset":[Xs,"auto",li,oi]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:ve()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",li,oi]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",li,oi]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:pt()}],"bg-repeat":[{bg:Oe()}],"bg-size":[{bg:gn()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Tm,li,oi],radial:["",li,oi],conic:[Tm,li,oi]},x_e,__e]}],"bg-color":[{bg:nt()}],"gradient-from-pos":[{from:wt()}],"gradient-via-pos":[{via:wt()}],"gradient-to-pos":[{to:wt()}],"gradient-from":[{from:nt()}],"gradient-via":[{via:nt()}],"gradient-to":[{to:nt()}],rounded:[{rounded:Fe()}],"rounded-s":[{"rounded-s":Fe()}],"rounded-e":[{"rounded-e":Fe()}],"rounded-t":[{"rounded-t":Fe()}],"rounded-r":[{"rounded-r":Fe()}],"rounded-b":[{"rounded-b":Fe()}],"rounded-l":[{"rounded-l":Fe()}],"rounded-ss":[{"rounded-ss":Fe()}],"rounded-se":[{"rounded-se":Fe()}],"rounded-ee":[{"rounded-ee":Fe()}],"rounded-es":[{"rounded-es":Fe()}],"rounded-tl":[{"rounded-tl":Fe()}],"rounded-tr":[{"rounded-tr":Fe()}],"rounded-br":[{"rounded-br":Fe()}],"rounded-bl":[{"rounded-bl":Fe()}],"border-w":[{border:jt()}],"border-w-x":[{"border-x":jt()}],"border-w-y":[{"border-y":jt()}],"border-w-s":[{"border-s":jt()}],"border-w-e":[{"border-e":jt()}],"border-w-t":[{"border-t":jt()}],"border-w-r":[{"border-r":jt()}],"border-w-b":[{"border-b":jt()}],"border-w-l":[{"border-l":jt()}],"divide-x":[{"divide-x":jt()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":jt()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Tn(),"hidden","none"]}],"divide-style":[{divide:[...Tn(),"hidden","none"]}],"border-color":[{border:nt()}],"border-color-x":[{"border-x":nt()}],"border-color-y":[{"border-y":nt()}],"border-color-s":[{"border-s":nt()}],"border-color-e":[{"border-e":nt()}],"border-color-t":[{"border-t":nt()}],"border-color-r":[{"border-r":nt()}],"border-color-b":[{"border-b":nt()}],"border-color-l":[{"border-l":nt()}],"divide-color":[{divide:nt()}],"outline-style":[{outline:[...Tn(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Xs,li,oi]}],"outline-w":[{outline:["",Xs,Xw,Fg]}],"outline-color":[{outline:nt()}],shadow:[{shadow:["","none",S,H3,$3]}],"shadow-color":[{shadow:nt()}],"inset-shadow":[{"inset-shadow":["none",C,H3,$3]}],"inset-shadow-color":[{"inset-shadow":nt()}],"ring-w":[{ring:jt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:nt()}],"ring-offset-w":[{"ring-offset":[Xs,Fg]}],"ring-offset-color":[{"ring-offset":nt()}],"inset-ring-w":[{"inset-ring":jt()}],"inset-ring-color":[{"inset-ring":nt()}],"text-shadow":[{"text-shadow":["none",P,H3,$3]}],"text-shadow-color":[{"text-shadow":nt()}],opacity:[{opacity:[Xs,li,oi]}],"mix-blend":[{"mix-blend":[...mn(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":mn()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Xs]}],"mask-image-linear-from-pos":[{"mask-linear-from":zn()}],"mask-image-linear-to-pos":[{"mask-linear-to":zn()}],"mask-image-linear-from-color":[{"mask-linear-from":nt()}],"mask-image-linear-to-color":[{"mask-linear-to":nt()}],"mask-image-t-from-pos":[{"mask-t-from":zn()}],"mask-image-t-to-pos":[{"mask-t-to":zn()}],"mask-image-t-from-color":[{"mask-t-from":nt()}],"mask-image-t-to-color":[{"mask-t-to":nt()}],"mask-image-r-from-pos":[{"mask-r-from":zn()}],"mask-image-r-to-pos":[{"mask-r-to":zn()}],"mask-image-r-from-color":[{"mask-r-from":nt()}],"mask-image-r-to-color":[{"mask-r-to":nt()}],"mask-image-b-from-pos":[{"mask-b-from":zn()}],"mask-image-b-to-pos":[{"mask-b-to":zn()}],"mask-image-b-from-color":[{"mask-b-from":nt()}],"mask-image-b-to-color":[{"mask-b-to":nt()}],"mask-image-l-from-pos":[{"mask-l-from":zn()}],"mask-image-l-to-pos":[{"mask-l-to":zn()}],"mask-image-l-from-color":[{"mask-l-from":nt()}],"mask-image-l-to-color":[{"mask-l-to":nt()}],"mask-image-x-from-pos":[{"mask-x-from":zn()}],"mask-image-x-to-pos":[{"mask-x-to":zn()}],"mask-image-x-from-color":[{"mask-x-from":nt()}],"mask-image-x-to-color":[{"mask-x-to":nt()}],"mask-image-y-from-pos":[{"mask-y-from":zn()}],"mask-image-y-to-pos":[{"mask-y-to":zn()}],"mask-image-y-from-color":[{"mask-y-from":nt()}],"mask-image-y-to-color":[{"mask-y-to":nt()}],"mask-image-radial":[{"mask-radial":[li,oi]}],"mask-image-radial-from-pos":[{"mask-radial-from":zn()}],"mask-image-radial-to-pos":[{"mask-radial-to":zn()}],"mask-image-radial-from-color":[{"mask-radial-from":nt()}],"mask-image-radial-to-color":[{"mask-radial-to":nt()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":ie()}],"mask-image-conic-pos":[{"mask-conic":[Xs]}],"mask-image-conic-from-pos":[{"mask-conic-from":zn()}],"mask-image-conic-to-pos":[{"mask-conic-to":zn()}],"mask-image-conic-from-color":[{"mask-conic-from":nt()}],"mask-image-conic-to-color":[{"mask-conic-to":nt()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:pt()}],"mask-repeat":[{mask:Oe()}],"mask-size":[{mask:gn()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",li,oi]}],filter:[{filter:["","none",li,oi]}],blur:[{blur:yn()}],brightness:[{brightness:[Xs,li,oi]}],contrast:[{contrast:[Xs,li,oi]}],"drop-shadow":[{"drop-shadow":["","none",L,H3,$3]}],"drop-shadow-color":[{"drop-shadow":nt()}],grayscale:[{grayscale:["",Xs,li,oi]}],"hue-rotate":[{"hue-rotate":[Xs,li,oi]}],invert:[{invert:["",Xs,li,oi]}],saturate:[{saturate:[Xs,li,oi]}],sepia:[{sepia:["",Xs,li,oi]}],"backdrop-filter":[{"backdrop-filter":["","none",li,oi]}],"backdrop-blur":[{"backdrop-blur":yn()}],"backdrop-brightness":[{"backdrop-brightness":[Xs,li,oi]}],"backdrop-contrast":[{"backdrop-contrast":[Xs,li,oi]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Xs,li,oi]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Xs,li,oi]}],"backdrop-invert":[{"backdrop-invert":["",Xs,li,oi]}],"backdrop-opacity":[{"backdrop-opacity":[Xs,li,oi]}],"backdrop-saturate":[{"backdrop-saturate":[Xs,li,oi]}],"backdrop-sepia":[{"backdrop-sepia":["",Xs,li,oi]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":ve()}],"border-spacing-x":[{"border-spacing-x":ve()}],"border-spacing-y":[{"border-spacing-y":ve()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",li,oi]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Xs,"initial",li,oi]}],ease:[{ease:["linear","initial",G,li,oi]}],delay:[{delay:[Xs,li,oi]}],animate:[{animate:["none",$,li,oi]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[U,li,oi]}],"perspective-origin":[{"perspective-origin":de()}],rotate:[{rotate:qt()}],"rotate-x":[{"rotate-x":qt()}],"rotate-y":[{"rotate-y":qt()}],"rotate-z":[{"rotate-z":qt()}],scale:[{scale:wn()}],"scale-x":[{"scale-x":wn()}],"scale-y":[{"scale-y":wn()}],"scale-z":[{"scale-z":wn()}],"scale-3d":["scale-3d"],skew:[{skew:Sn()}],"skew-x":[{"skew-x":Sn()}],"skew-y":[{"skew-y":Sn()}],transform:[{transform:[li,oi,"","none","gpu","cpu"]}],"transform-origin":[{origin:de()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Xn()}],"translate-x":[{"translate-x":Xn()}],"translate-y":[{"translate-y":Xn()}],"translate-z":[{"translate-z":Xn()}],"translate-none":["translate-none"],accent:[{accent:nt()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:nt()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",li,oi]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":ve()}],"scroll-mx":[{"scroll-mx":ve()}],"scroll-my":[{"scroll-my":ve()}],"scroll-ms":[{"scroll-ms":ve()}],"scroll-me":[{"scroll-me":ve()}],"scroll-mt":[{"scroll-mt":ve()}],"scroll-mr":[{"scroll-mr":ve()}],"scroll-mb":[{"scroll-mb":ve()}],"scroll-ml":[{"scroll-ml":ve()}],"scroll-p":[{"scroll-p":ve()}],"scroll-px":[{"scroll-px":ve()}],"scroll-py":[{"scroll-py":ve()}],"scroll-ps":[{"scroll-ps":ve()}],"scroll-pe":[{"scroll-pe":ve()}],"scroll-pt":[{"scroll-pt":ve()}],"scroll-pr":[{"scroll-pr":ve()}],"scroll-pb":[{"scroll-pb":ve()}],"scroll-pl":[{"scroll-pl":ve()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",li,oi]}],fill:[{fill:["none",...nt()]}],"stroke-w":[{stroke:[Xs,Xw,Fg,nR]}],stroke:[{stroke:["none",...nt()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},vo=r_e(T_e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E_e=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),S_e=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,r)=>r?r.toUpperCase():n.toLowerCase()),vV=e=>{const t=S_e(e);return t.charAt(0).toUpperCase()+t.slice(1)},cK=(...e)=>e.filter((t,n,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===n).join(" ").trim(),A_e=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var C_e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k_e=B.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:a="",children:l,iconNode:f,...i},y)=>B.createElement("svg",{ref:y,...C_e,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:cK("lucide",a),...!l&&!A_e(i)&&{"aria-hidden":"true"},...i},[...f.map(([x,S])=>B.createElement(x,S)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kl=(e,t)=>{const n=B.forwardRef(({className:r,...a},l)=>B.createElement(k_e,{ref:l,iconNode:t,className:cK(`lucide-${E_e(vV(e))}`,`lucide-${e}`,r),...a}));return n.displayName=vV(e),n};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I_e=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],R_e=Kl("arrow-up",I_e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M_e=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],iD=Kl("check",M_e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P_e=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],O_e=Kl("chevron-down",P_e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L_e=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],D_e=Kl("chevron-left",L_e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N_e=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],dK=Kl("chevron-right",N_e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z_e=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],hK=Kl("copy",z_e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F_e=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],B_e=Kl("loader-circle",F_e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j_e=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],U_e=Kl("message-circle",j_e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V_e=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],$_e=Kl("mic",V_e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H_e=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],G_e=Kl("plus",H_e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q_e=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Z_e=Kl("refresh-cw",q_e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W_e=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],X_e=Kl("square-pen",W_e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y_e=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],K_e=Kl("square",Y_e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q_e=[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]],J_e=Kl("thumbs-down",Q_e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eye=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],tye=Kl("thumbs-up",eye);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nye=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],rye=Kl("volume-2",nye);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iye=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],sD=Kl("x",iye);var fK={},TO={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Allow=e.ALL=e.COLLECTION=e.ATOM=e.SPECIAL=e.INF=e._INFINITY=e.INFINITY=e.NAN=e.BOOL=e.NULL=e.OBJ=e.ARR=e.NUM=e.STR=void 0,e.STR=1,e.NUM=2,e.ARR=4,e.OBJ=8,e.NULL=16,e.BOOL=32,e.NAN=64,e.INFINITY=128,e._INFINITY=256,e.INF=e.INFINITY|e._INFINITY,e.SPECIAL=e.NULL|e.BOOL|e.INF|e.NAN,e.ATOM=e.STR|e.NUM|e.SPECIAL,e.COLLECTION=e.ARR|e.OBJ,e.ALL=e.ATOM|e.COLLECTION,e.Allow={STR:e.STR,NUM:e.NUM,ARR:e.ARR,OBJ:e.OBJ,NULL:e.NULL,BOOL:e.BOOL,NAN:e.NAN,INFINITY:e.INFINITY,_INFINITY:e._INFINITY,INF:e.INF,SPECIAL:e.SPECIAL,ATOM:e.ATOM,COLLECTION:e.COLLECTION,ALL:e.ALL},e.default=e.Allow})(TO);(function(e){var t=fp&&fp.__createBinding||(Object.create?function(x,S,C,P){P===void 0&&(P=C);var L=Object.getOwnPropertyDescriptor(S,C);(!L||("get"in L?!S.__esModule:L.writable||L.configurable))&&(L={enumerable:!0,get:function(){return S[C]}}),Object.defineProperty(x,P,L)}:function(x,S,C,P){P===void 0&&(P=C),x[P]=S[C]}),n=fp&&fp.__exportStar||function(x,S){for(var C in x)C!=="default"&&!Object.prototype.hasOwnProperty.call(S,C)&&t(S,x,C)};Object.defineProperty(e,"__esModule",{value:!0}),e.Allow=e.MalformedJSON=e.PartialJSON=e.parseJSON=e.parse=void 0;const r=TO;Object.defineProperty(e,"Allow",{enumerable:!0,get:function(){return r.Allow}}),n(TO,e);class a extends Error{}e.PartialJSON=a;class l extends Error{}e.MalformedJSON=l;function f(x,S=r.Allow.ALL){if(typeof x!="string")throw new TypeError(`expecting str, got ${typeof x}`);if(!x.trim())throw new Error(`${x} is empty`);return i(x.trim(),S)}e.parseJSON=f;const i=(x,S)=>{const C=x.length;let P=0;const L=de=>{throw new a(`${de} at position ${P}`)},F=de=>{throw new l(`${de} at position ${P}`)},U=()=>(ie(),P>=C&&L("Unexpected end of input"),x[P]==='"'?q():x[P]==="{"?G():x[P]==="["?$():x.substring(P,P+4)==="null"||r.Allow.NULL&S&&C-P<4&&"null".startsWith(x.substring(P))?(P+=4,null):x.substring(P,P+4)==="true"||r.Allow.BOOL&S&&C-P<4&&"true".startsWith(x.substring(P))?(P+=4,!0):x.substring(P,P+5)==="false"||r.Allow.BOOL&S&&C-P<5&&"false".startsWith(x.substring(P))?(P+=5,!1):x.substring(P,P+8)==="Infinity"||r.Allow.INFINITY&S&&C-P<8&&"Infinity".startsWith(x.substring(P))?(P+=8,1/0):x.substring(P,P+9)==="-Infinity"||r.Allow._INFINITY&S&&1<C-P&&C-P<9&&"-Infinity".startsWith(x.substring(P))?(P+=9,-1/0):x.substring(P,P+3)==="NaN"||r.Allow.NAN&S&&C-P<3&&"NaN".startsWith(x.substring(P))?(P+=3,NaN):X()),q=()=>{const de=P;let fe=!1;for(P++;P<C&&(x[P]!=='"'||fe&&x[P-1]==="\\");)fe=x[P]==="\\"?!fe:!1,P++;if(x.charAt(P)=='"')try{return JSON.parse(x.substring(de,++P-Number(fe)))}catch(be){F(String(be))}else if(r.Allow.STR&S)try{return JSON.parse(x.substring(de,P-Number(fe))+'"')}catch{return JSON.parse(x.substring(de,x.lastIndexOf("\\"))+'"')}L("Unterminated string literal")},G=()=>{P++,ie();const de={};try{for(;x[P]!=="}";){if(ie(),P>=C&&r.Allow.OBJ&S)return de;const fe=q();ie(),P++;try{const be=U();de[fe]=be}catch(be){if(r.Allow.OBJ&S)return de;throw be}ie(),x[P]===","&&P++}}catch{if(r.Allow.OBJ&S)return de;L("Expected '}' at end of object")}return P++,de},$=()=>{P++;const de=[];try{for(;x[P]!=="]";)de.push(U()),ie(),x[P]===","&&P++}catch{if(r.Allow.ARR&S)return de;L("Expected ']' at end of array")}return P++,de},X=()=>{if(P===0){x==="-"&&F("Not sure what '-' is");try{return JSON.parse(x)}catch(fe){if(r.Allow.NUM&S)try{return JSON.parse(x.substring(0,x.lastIndexOf("e")))}catch{}F(String(fe))}}const de=P;for(x[P]==="-"&&P++;x[P]&&",]}".indexOf(x[P])===-1;)P++;P==C&&!(r.Allow.NUM&S)&&L("Unterminated number literal");try{return JSON.parse(x.substring(de,P))}catch{x.substring(de,P)==="-"&&L("Not sure what '-' is");try{return JSON.parse(x.substring(de,x.lastIndexOf("e")))}catch(be){F(String(be))}}},ie=()=>{for(;P<C&&` 
\r	`.includes(x[P]);)P++};return U()},y=f;e.parse=y})(fK);function gf(){return Y1()}function pK(e){try{return fK.parse(e)}catch{return{}}}var mK=console,Ix="default";function xV(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function V_(...e){return t=>{let n=!1;const r=e.map(a=>{const l=xV(a,t);return!n&&typeof l=="function"&&(n=!0),l});if(n)return()=>{for(let a=0;a<r.length;a++){const l=r[a];typeof l=="function"?l():xV(e[a],null)}}}}function hu(...e){return B.useCallback(V_(...e),e)}var sye=Symbol.for("react.lazy"),AC=$T[" use ".trim().toString()];function aye(e){return typeof e=="object"&&e!==null&&"then"in e}function gK(e){return e!=null&&typeof e=="object"&&"$$typeof"in e&&e.$$typeof===sye&&"_payload"in e&&aye(e._payload)}function oye(e){const t=uye(e),n=B.forwardRef((r,a)=>{let{children:l,...f}=r;gK(l)&&typeof AC=="function"&&(l=AC(l._payload));const i=B.Children.toArray(l),y=i.find(dye);if(y){const x=y.props.children,S=i.map(C=>C===y?B.Children.count(x)>1?B.Children.only(null):B.isValidElement(x)?x.props.children:null:C);return k.jsx(t,{...f,ref:a,children:B.isValidElement(x)?B.cloneElement(x,void 0,S):null})}return k.jsx(t,{...f,ref:a,children:l})});return n.displayName=`${e}.Slot`,n}var lye=oye("Slot");function uye(e){const t=B.forwardRef((n,r)=>{let{children:a,...l}=n;if(gK(a)&&typeof AC=="function"&&(a=AC(a._payload)),B.isValidElement(a)){const f=fye(a),i=hye(l,a.props);return a.type!==B.Fragment&&(i.ref=r?V_(r,f):f),B.cloneElement(a,i)}return B.Children.count(a)>1?B.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var cye=Symbol("radix.slottable");function dye(e){return B.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===cye}function hye(e,t){const n={...t};for(const r in t){const a=e[r],l=t[r];/^on[A-Z]/.test(r)?a&&l?n[r]=(...i)=>{const y=l(...i);return a(...i),y}:a&&(n[r]=a):r==="style"?n[r]={...a,...l}:r==="className"&&(n[r]=[a,l].filter(Boolean).join(" "))}return{...e,...n}}function fye(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function _K(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(n=_K(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function aD(){for(var e,t,n=0,r="",a=arguments.length;n<a;n++)(e=arguments[n])&&(t=_K(e))&&(r&&(r+=" "),r+=t);return r}const bV=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,wV=aD,pye=(e,t)=>n=>{var r;if((t==null?void 0:t.variants)==null)return wV(e,n==null?void 0:n.class,n==null?void 0:n.className);const{variants:a,defaultVariants:l}=t,f=Object.keys(a).map(x=>{const S=n==null?void 0:n[x],C=l==null?void 0:l[x];if(S===null)return null;const P=bV(S)||bV(C);return a[x][P]}),i=n&&Object.entries(n).reduce((x,S)=>{let[C,P]=S;return P===void 0||(x[C]=P),x},{}),y=t==null||(r=t.compoundVariants)===null||r===void 0?void 0:r.reduce((x,S)=>{let{class:C,className:P,...L}=S;return Object.entries(L).every(F=>{let[U,q]=F;return Array.isArray(q)?q.includes({...l,...i}[U]):{...l,...i}[U]===q})?[...x,C,P]:x},[]);return wV(e,f,y,n==null?void 0:n.class,n==null?void 0:n.className)};function Zs(e,t,{checkForDefaultPrevented:n=!0}={}){return function(a){if(e==null||e(a),n===!1||!a.defaultPrevented)return t==null?void 0:t(a)}}function Rx(e,t=[]){let n=[];function r(l,f){const i=B.createContext(f),y=n.length;n=[...n,f];const x=C=>{var G;const{scope:P,children:L,...F}=C,U=((G=P==null?void 0:P[e])==null?void 0:G[y])||i,q=B.useMemo(()=>F,Object.values(F));return k.jsx(U.Provider,{value:q,children:L})};x.displayName=l+"Provider";function S(C,P){var U;const L=((U=P==null?void 0:P[e])==null?void 0:U[y])||i,F=B.useContext(L);if(F)return F;if(f!==void 0)return f;throw new Error(`\`${C}\` must be used within \`${l}\``)}return[x,S]}const a=()=>{const l=n.map(f=>B.createContext(f));return function(i){const y=(i==null?void 0:i[e])||l;return B.useMemo(()=>({[`__scope${e}`]:{...i,[e]:y}}),[i,y])}};return a.scopeName=e,[r,mye(a,...t)]}function mye(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(l){const f=r.reduce((i,{useScope:y,scopeName:x})=>{const C=y(l)[`__scope${x}`];return{...i,...C}},{});return B.useMemo(()=>({[`__scope${t.scopeName}`]:f}),[f])}};return n.scopeName=t.scopeName,n}function gye(e){const t=_ye(e),n=B.forwardRef((r,a)=>{const{children:l,...f}=r,i=B.Children.toArray(l),y=i.find(vye);if(y){const x=y.props.children,S=i.map(C=>C===y?B.Children.count(x)>1?B.Children.only(null):B.isValidElement(x)?x.props.children:null:C);return k.jsx(t,{...f,ref:a,children:B.isValidElement(x)?B.cloneElement(x,void 0,S):null})}return k.jsx(t,{...f,ref:a,children:l})});return n.displayName=`${e}.Slot`,n}function _ye(e){const t=B.forwardRef((n,r)=>{const{children:a,...l}=n;if(B.isValidElement(a)){const f=bye(a),i=xye(l,a.props);return a.type!==B.Fragment&&(i.ref=r?V_(r,f):f),B.cloneElement(a,i)}return B.Children.count(a)>1?B.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var yye=Symbol("radix.slottable");function vye(e){return B.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===yye}function xye(e,t){const n={...t};for(const r in t){const a=e[r],l=t[r];/^on[A-Z]/.test(r)?a&&l?n[r]=(...i)=>{const y=l(...i);return a(...i),y}:a&&(n[r]=a):r==="style"?n[r]={...a,...l}:r==="className"&&(n[r]=[a,l].filter(Boolean).join(" "))}return{...e,...n}}function bye(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var wye=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ql=wye.reduce((e,t)=>{const n=gye(`Primitive.${t}`),r=B.forwardRef((a,l)=>{const{asChild:f,...i}=a,y=f?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),k.jsx(y,{...i,ref:l})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function yK(e,t){e&&WT.flushSync(()=>e.dispatchEvent(t))}function bf(e){const t=B.useRef(e);return B.useEffect(()=>{t.current=e}),B.useMemo(()=>(...n)=>{var r;return(r=t.current)==null?void 0:r.call(t,...n)},[])}function Tye(e,t=globalThis==null?void 0:globalThis.document){const n=bf(e);B.useEffect(()=>{const r=a=>{a.key==="Escape"&&n(a)};return t.addEventListener("keydown",r,{capture:!0}),()=>t.removeEventListener("keydown",r,{capture:!0})},[n,t])}var Eye="DismissableLayer",EO="dismissableLayer.update",Sye="dismissableLayer.pointerDownOutside",Aye="dismissableLayer.focusOutside",TV,vK=B.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),oD=B.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:a,onFocusOutside:l,onInteractOutside:f,onDismiss:i,...y}=e,x=B.useContext(vK),[S,C]=B.useState(null),P=(S==null?void 0:S.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,L]=B.useState({}),F=hu(t,be=>C(be)),U=Array.from(x.layers),[q]=[...x.layersWithOutsidePointerEventsDisabled].slice(-1),G=U.indexOf(q),$=S?U.indexOf(S):-1,X=x.layersWithOutsidePointerEventsDisabled.size>0,ie=$>=G,de=Iye(be=>{const ve=be.target,Je=[...x.branches].some(we=>we.contains(ve));!ie||Je||(a==null||a(be),f==null||f(be),be.defaultPrevented||i==null||i())},P),fe=Rye(be=>{const ve=be.target;[...x.branches].some(we=>we.contains(ve))||(l==null||l(be),f==null||f(be),be.defaultPrevented||i==null||i())},P);return Tye(be=>{$===x.layers.size-1&&(r==null||r(be),!be.defaultPrevented&&i&&(be.preventDefault(),i()))},P),B.useEffect(()=>{if(S)return n&&(x.layersWithOutsidePointerEventsDisabled.size===0&&(TV=P.body.style.pointerEvents,P.body.style.pointerEvents="none"),x.layersWithOutsidePointerEventsDisabled.add(S)),x.layers.add(S),EV(),()=>{n&&x.layersWithOutsidePointerEventsDisabled.size===1&&(P.body.style.pointerEvents=TV)}},[S,P,n,x]),B.useEffect(()=>()=>{S&&(x.layers.delete(S),x.layersWithOutsidePointerEventsDisabled.delete(S),EV())},[S,x]),B.useEffect(()=>{const be=()=>L({});return document.addEventListener(EO,be),()=>document.removeEventListener(EO,be)},[]),k.jsx(Ql.div,{...y,ref:F,style:{pointerEvents:X?ie?"auto":"none":void 0,...e.style},onFocusCapture:Zs(e.onFocusCapture,fe.onFocusCapture),onBlurCapture:Zs(e.onBlurCapture,fe.onBlurCapture),onPointerDownCapture:Zs(e.onPointerDownCapture,de.onPointerDownCapture)})});oD.displayName=Eye;var Cye="DismissableLayerBranch",kye=B.forwardRef((e,t)=>{const n=B.useContext(vK),r=B.useRef(null),a=hu(t,r);return B.useEffect(()=>{const l=r.current;if(l)return n.branches.add(l),()=>{n.branches.delete(l)}},[n.branches]),k.jsx(Ql.div,{...e,ref:a})});kye.displayName=Cye;function Iye(e,t=globalThis==null?void 0:globalThis.document){const n=bf(e),r=B.useRef(!1),a=B.useRef(()=>{});return B.useEffect(()=>{const l=i=>{if(i.target&&!r.current){let y=function(){xK(Sye,n,x,{discrete:!0})};const x={originalEvent:i};i.pointerType==="touch"?(t.removeEventListener("click",a.current),a.current=y,t.addEventListener("click",a.current,{once:!0})):y()}else t.removeEventListener("click",a.current);r.current=!1},f=window.setTimeout(()=>{t.addEventListener("pointerdown",l)},0);return()=>{window.clearTimeout(f),t.removeEventListener("pointerdown",l),t.removeEventListener("click",a.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function Rye(e,t=globalThis==null?void 0:globalThis.document){const n=bf(e),r=B.useRef(!1);return B.useEffect(()=>{const a=l=>{l.target&&!r.current&&xK(Aye,n,{originalEvent:l},{discrete:!1})};return t.addEventListener("focusin",a),()=>t.removeEventListener("focusin",a)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function EV(){const e=new CustomEvent(EO);document.dispatchEvent(e)}function xK(e,t,n,{discrete:r}){const a=n.originalEvent.target,l=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&a.addEventListener(e,t,{once:!0}),r?yK(a,l):a.dispatchEvent(l)}var A0=globalThis!=null&&globalThis.document?B.useLayoutEffect:()=>{},Mye=$T[" useId ".trim().toString()]||(()=>{}),Pye=0;function lx(e){const[t,n]=B.useState(Mye());return A0(()=>{n(r=>r??String(Pye++))},[e]),t?`radix-${t}`:""}const Oye=["top","right","bottom","left"],C0=Math.min,Oc=Math.max,CC=Math.round,G3=Math.floor,_f=e=>({x:e,y:e}),Lye={left:"right",right:"left",bottom:"top",top:"bottom"},Dye={start:"end",end:"start"};function SO(e,t,n){return Oc(e,C0(t,n))}function Mp(e,t){return typeof e=="function"?e(t):e}function Pp(e){return e.split("-")[0]}function Mx(e){return e.split("-")[1]}function lD(e){return e==="x"?"y":"x"}function uD(e){return e==="y"?"height":"width"}const Nye=new Set(["top","bottom"]);function cf(e){return Nye.has(Pp(e))?"y":"x"}function cD(e){return lD(cf(e))}function zye(e,t,n){n===void 0&&(n=!1);const r=Mx(e),a=cD(e),l=uD(a);let f=a==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return t.reference[l]>t.floating[l]&&(f=kC(f)),[f,kC(f)]}function Fye(e){const t=kC(e);return[AO(e),t,AO(t)]}function AO(e){return e.replace(/start|end/g,t=>Dye[t])}const SV=["left","right"],AV=["right","left"],Bye=["top","bottom"],jye=["bottom","top"];function Uye(e,t,n){switch(e){case"top":case"bottom":return n?t?AV:SV:t?SV:AV;case"left":case"right":return t?Bye:jye;default:return[]}}function Vye(e,t,n,r){const a=Mx(e);let l=Uye(Pp(e),n==="start",r);return a&&(l=l.map(f=>f+"-"+a),t&&(l=l.concat(l.map(AO)))),l}function kC(e){return e.replace(/left|right|bottom|top/g,t=>Lye[t])}function $ye(e){return{top:0,right:0,bottom:0,left:0,...e}}function bK(e){return typeof e!="number"?$ye(e):{top:e,right:e,bottom:e,left:e}}function IC(e){const{x:t,y:n,width:r,height:a}=e;return{width:r,height:a,top:n,left:t,right:t+r,bottom:n+a,x:t,y:n}}function CV(e,t,n){let{reference:r,floating:a}=e;const l=cf(t),f=cD(t),i=uD(f),y=Pp(t),x=l==="y",S=r.x+r.width/2-a.width/2,C=r.y+r.height/2-a.height/2,P=r[i]/2-a[i]/2;let L;switch(y){case"top":L={x:S,y:r.y-a.height};break;case"bottom":L={x:S,y:r.y+r.height};break;case"right":L={x:r.x+r.width,y:C};break;case"left":L={x:r.x-a.width,y:C};break;default:L={x:r.x,y:r.y}}switch(Mx(t)){case"start":L[f]-=P*(n&&x?-1:1);break;case"end":L[f]+=P*(n&&x?-1:1);break}return L}const Hye=async(e,t,n)=>{const{placement:r="bottom",strategy:a="absolute",middleware:l=[],platform:f}=n,i=l.filter(Boolean),y=await(f.isRTL==null?void 0:f.isRTL(t));let x=await f.getElementRects({reference:e,floating:t,strategy:a}),{x:S,y:C}=CV(x,r,y),P=r,L={},F=0;for(let U=0;U<i.length;U++){const{name:q,fn:G}=i[U],{x:$,y:X,data:ie,reset:de}=await G({x:S,y:C,initialPlacement:r,placement:P,strategy:a,middlewareData:L,rects:x,platform:f,elements:{reference:e,floating:t}});S=$??S,C=X??C,L={...L,[q]:{...L[q],...ie}},de&&F<=50&&(F++,typeof de=="object"&&(de.placement&&(P=de.placement),de.rects&&(x=de.rects===!0?await f.getElementRects({reference:e,floating:t,strategy:a}):de.rects),{x:S,y:C}=CV(x,P,y)),U=-1)}return{x:S,y:C,placement:P,strategy:a,middlewareData:L}};async function vT(e,t){var n;t===void 0&&(t={});const{x:r,y:a,platform:l,rects:f,elements:i,strategy:y}=e,{boundary:x="clippingAncestors",rootBoundary:S="viewport",elementContext:C="floating",altBoundary:P=!1,padding:L=0}=Mp(t,e),F=bK(L),q=i[P?C==="floating"?"reference":"floating":C],G=IC(await l.getClippingRect({element:(n=await(l.isElement==null?void 0:l.isElement(q)))==null||n?q:q.contextElement||await(l.getDocumentElement==null?void 0:l.getDocumentElement(i.floating)),boundary:x,rootBoundary:S,strategy:y})),$=C==="floating"?{x:r,y:a,width:f.floating.width,height:f.floating.height}:f.reference,X=await(l.getOffsetParent==null?void 0:l.getOffsetParent(i.floating)),ie=await(l.isElement==null?void 0:l.isElement(X))?await(l.getScale==null?void 0:l.getScale(X))||{x:1,y:1}:{x:1,y:1},de=IC(l.convertOffsetParentRelativeRectToViewportRelativeRect?await l.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:$,offsetParent:X,strategy:y}):$);return{top:(G.top-de.top+F.top)/ie.y,bottom:(de.bottom-G.bottom+F.bottom)/ie.y,left:(G.left-de.left+F.left)/ie.x,right:(de.right-G.right+F.right)/ie.x}}const Gye=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:r,placement:a,rects:l,platform:f,elements:i,middlewareData:y}=t,{element:x,padding:S=0}=Mp(e,t)||{};if(x==null)return{};const C=bK(S),P={x:n,y:r},L=cD(a),F=uD(L),U=await f.getDimensions(x),q=L==="y",G=q?"top":"left",$=q?"bottom":"right",X=q?"clientHeight":"clientWidth",ie=l.reference[F]+l.reference[L]-P[L]-l.floating[F],de=P[L]-l.reference[L],fe=await(f.getOffsetParent==null?void 0:f.getOffsetParent(x));let be=fe?fe[X]:0;(!be||!await(f.isElement==null?void 0:f.isElement(fe)))&&(be=i.floating[X]||l.floating[F]);const ve=ie/2-de/2,Je=be/2-U[F]/2-1,we=C0(C[G],Je),rt=C0(C[$],Je),He=we,ft=be-U[F]-rt,Ct=be/2-U[F]/2+ve,Nt=SO(He,Ct,ft),Rt=!y.arrow&&Mx(a)!=null&&Ct!==Nt&&l.reference[F]/2-(Ct<He?we:rt)-U[F]/2<0,en=Rt?Ct<He?Ct-He:Ct-ft:0;return{[L]:P[L]+en,data:{[L]:Nt,centerOffset:Ct-Nt-en,...Rt&&{alignmentOffset:en}},reset:Rt}}}),qye=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,r;const{placement:a,middlewareData:l,rects:f,initialPlacement:i,platform:y,elements:x}=t,{mainAxis:S=!0,crossAxis:C=!0,fallbackPlacements:P,fallbackStrategy:L="bestFit",fallbackAxisSideDirection:F="none",flipAlignment:U=!0,...q}=Mp(e,t);if((n=l.arrow)!=null&&n.alignmentOffset)return{};const G=Pp(a),$=cf(i),X=Pp(i)===i,ie=await(y.isRTL==null?void 0:y.isRTL(x.floating)),de=P||(X||!U?[kC(i)]:Fye(i)),fe=F!=="none";!P&&fe&&de.push(...Vye(i,U,F,ie));const be=[i,...de],ve=await vT(t,q),Je=[];let we=((r=l.flip)==null?void 0:r.overflows)||[];if(S&&Je.push(ve[G]),C){const Ct=zye(a,f,ie);Je.push(ve[Ct[0]],ve[Ct[1]])}if(we=[...we,{placement:a,overflows:Je}],!Je.every(Ct=>Ct<=0)){var rt,He;const Ct=(((rt=l.flip)==null?void 0:rt.index)||0)+1,Nt=be[Ct];if(Nt&&(!(C==="alignment"?$!==cf(Nt):!1)||we.every(nt=>cf(nt.placement)===$?nt.overflows[0]>0:!0)))return{data:{index:Ct,overflows:we},reset:{placement:Nt}};let Rt=(He=we.filter(en=>en.overflows[0]<=0).sort((en,nt)=>en.overflows[1]-nt.overflows[1])[0])==null?void 0:He.placement;if(!Rt)switch(L){case"bestFit":{var ft;const en=(ft=we.filter(nt=>{if(fe){const pt=cf(nt.placement);return pt===$||pt==="y"}return!0}).map(nt=>[nt.placement,nt.overflows.filter(pt=>pt>0).reduce((pt,Oe)=>pt+Oe,0)]).sort((nt,pt)=>nt[1]-pt[1])[0])==null?void 0:ft[0];en&&(Rt=en);break}case"initialPlacement":Rt=i;break}if(a!==Rt)return{reset:{placement:Rt}}}return{}}}};function kV(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function IV(e){return Oye.some(t=>e[t]>=0)}const Zye=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:r="referenceHidden",...a}=Mp(e,t);switch(r){case"referenceHidden":{const l=await vT(t,{...a,elementContext:"reference"}),f=kV(l,n.reference);return{data:{referenceHiddenOffsets:f,referenceHidden:IV(f)}}}case"escaped":{const l=await vT(t,{...a,altBoundary:!0}),f=kV(l,n.floating);return{data:{escapedOffsets:f,escaped:IV(f)}}}default:return{}}}}},wK=new Set(["left","top"]);async function Wye(e,t){const{placement:n,platform:r,elements:a}=e,l=await(r.isRTL==null?void 0:r.isRTL(a.floating)),f=Pp(n),i=Mx(n),y=cf(n)==="y",x=wK.has(f)?-1:1,S=l&&y?-1:1,C=Mp(t,e);let{mainAxis:P,crossAxis:L,alignmentAxis:F}=typeof C=="number"?{mainAxis:C,crossAxis:0,alignmentAxis:null}:{mainAxis:C.mainAxis||0,crossAxis:C.crossAxis||0,alignmentAxis:C.alignmentAxis};return i&&typeof F=="number"&&(L=i==="end"?F*-1:F),y?{x:L*S,y:P*x}:{x:P*x,y:L*S}}const Xye=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,r;const{x:a,y:l,placement:f,middlewareData:i}=t,y=await Wye(t,e);return f===((n=i.offset)==null?void 0:n.placement)&&(r=i.arrow)!=null&&r.alignmentOffset?{}:{x:a+y.x,y:l+y.y,data:{...y,placement:f}}}}},Yye=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:r,placement:a}=t,{mainAxis:l=!0,crossAxis:f=!1,limiter:i={fn:q=>{let{x:G,y:$}=q;return{x:G,y:$}}},...y}=Mp(e,t),x={x:n,y:r},S=await vT(t,y),C=cf(Pp(a)),P=lD(C);let L=x[P],F=x[C];if(l){const q=P==="y"?"top":"left",G=P==="y"?"bottom":"right",$=L+S[q],X=L-S[G];L=SO($,L,X)}if(f){const q=C==="y"?"top":"left",G=C==="y"?"bottom":"right",$=F+S[q],X=F-S[G];F=SO($,F,X)}const U=i.fn({...t,[P]:L,[C]:F});return{...U,data:{x:U.x-n,y:U.y-r,enabled:{[P]:l,[C]:f}}}}}},Kye=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:n,y:r,placement:a,rects:l,middlewareData:f}=t,{offset:i=0,mainAxis:y=!0,crossAxis:x=!0}=Mp(e,t),S={x:n,y:r},C=cf(a),P=lD(C);let L=S[P],F=S[C];const U=Mp(i,t),q=typeof U=="number"?{mainAxis:U,crossAxis:0}:{mainAxis:0,crossAxis:0,...U};if(y){const X=P==="y"?"height":"width",ie=l.reference[P]-l.floating[X]+q.mainAxis,de=l.reference[P]+l.reference[X]-q.mainAxis;L<ie?L=ie:L>de&&(L=de)}if(x){var G,$;const X=P==="y"?"width":"height",ie=wK.has(Pp(a)),de=l.reference[C]-l.floating[X]+(ie&&((G=f.offset)==null?void 0:G[C])||0)+(ie?0:q.crossAxis),fe=l.reference[C]+l.reference[X]+(ie?0:(($=f.offset)==null?void 0:$[C])||0)-(ie?q.crossAxis:0);F<de?F=de:F>fe&&(F=fe)}return{[P]:L,[C]:F}}}},Qye=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var n,r;const{placement:a,rects:l,platform:f,elements:i}=t,{apply:y=()=>{},...x}=Mp(e,t),S=await vT(t,x),C=Pp(a),P=Mx(a),L=cf(a)==="y",{width:F,height:U}=l.floating;let q,G;C==="top"||C==="bottom"?(q=C,G=P===(await(f.isRTL==null?void 0:f.isRTL(i.floating))?"start":"end")?"left":"right"):(G=C,q=P==="end"?"top":"bottom");const $=U-S.top-S.bottom,X=F-S.left-S.right,ie=C0(U-S[q],$),de=C0(F-S[G],X),fe=!t.middlewareData.shift;let be=ie,ve=de;if((n=t.middlewareData.shift)!=null&&n.enabled.x&&(ve=X),(r=t.middlewareData.shift)!=null&&r.enabled.y&&(be=$),fe&&!P){const we=Oc(S.left,0),rt=Oc(S.right,0),He=Oc(S.top,0),ft=Oc(S.bottom,0);L?ve=F-2*(we!==0||rt!==0?we+rt:Oc(S.left,S.right)):be=U-2*(He!==0||ft!==0?He+ft:Oc(S.top,S.bottom))}await y({...t,availableWidth:ve,availableHeight:be});const Je=await f.getDimensions(i.floating);return F!==Je.width||U!==Je.height?{reset:{rects:!0}}:{}}}};function kk(){return typeof window<"u"}function Px(e){return TK(e)?(e.nodeName||"").toLowerCase():"#document"}function Fc(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Sf(e){var t;return(t=(TK(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function TK(e){return kk()?e instanceof Node||e instanceof Fc(e).Node:!1}function vh(e){return kk()?e instanceof Element||e instanceof Fc(e).Element:!1}function wf(e){return kk()?e instanceof HTMLElement||e instanceof Fc(e).HTMLElement:!1}function RV(e){return!kk()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Fc(e).ShadowRoot}const Jye=new Set(["inline","contents"]);function QT(e){const{overflow:t,overflowX:n,overflowY:r,display:a}=xh(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!Jye.has(a)}const e1e=new Set(["table","td","th"]);function t1e(e){return e1e.has(Px(e))}const n1e=[":popover-open",":modal"];function Ik(e){return n1e.some(t=>{try{return e.matches(t)}catch{return!1}})}const r1e=["transform","translate","scale","rotate","perspective"],i1e=["transform","translate","scale","rotate","perspective","filter"],s1e=["paint","layout","strict","content"];function dD(e){const t=hD(),n=vh(e)?xh(e):e;return r1e.some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||i1e.some(r=>(n.willChange||"").includes(r))||s1e.some(r=>(n.contain||"").includes(r))}function a1e(e){let t=k0(e);for(;wf(t)&&!ux(t);){if(dD(t))return t;if(Ik(t))return null;t=k0(t)}return null}function hD(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const o1e=new Set(["html","body","#document"]);function ux(e){return o1e.has(Px(e))}function xh(e){return Fc(e).getComputedStyle(e)}function Rk(e){return vh(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function k0(e){if(Px(e)==="html")return e;const t=e.assignedSlot||e.parentNode||RV(e)&&e.host||Sf(e);return RV(t)?t.host:t}function EK(e){const t=k0(e);return ux(t)?e.ownerDocument?e.ownerDocument.body:e.body:wf(t)&&QT(t)?t:EK(t)}function xT(e,t,n){var r;t===void 0&&(t=[]),n===void 0&&(n=!0);const a=EK(e),l=a===((r=e.ownerDocument)==null?void 0:r.body),f=Fc(a);if(l){const i=CO(f);return t.concat(f,f.visualViewport||[],QT(a)?a:[],i&&n?xT(i):[])}return t.concat(a,xT(a,[],n))}function CO(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function SK(e){const t=xh(e);let n=parseFloat(t.width)||0,r=parseFloat(t.height)||0;const a=wf(e),l=a?e.offsetWidth:n,f=a?e.offsetHeight:r,i=CC(n)!==l||CC(r)!==f;return i&&(n=l,r=f),{width:n,height:r,$:i}}function fD(e){return vh(e)?e:e.contextElement}function wv(e){const t=fD(e);if(!wf(t))return _f(1);const n=t.getBoundingClientRect(),{width:r,height:a,$:l}=SK(t);let f=(l?CC(n.width):n.width)/r,i=(l?CC(n.height):n.height)/a;return(!f||!Number.isFinite(f))&&(f=1),(!i||!Number.isFinite(i))&&(i=1),{x:f,y:i}}const l1e=_f(0);function AK(e){const t=Fc(e);return!hD()||!t.visualViewport?l1e:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function u1e(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==Fc(e)?!1:t}function M_(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1);const a=e.getBoundingClientRect(),l=fD(e);let f=_f(1);t&&(r?vh(r)&&(f=wv(r)):f=wv(e));const i=u1e(l,n,r)?AK(l):_f(0);let y=(a.left+i.x)/f.x,x=(a.top+i.y)/f.y,S=a.width/f.x,C=a.height/f.y;if(l){const P=Fc(l),L=r&&vh(r)?Fc(r):r;let F=P,U=CO(F);for(;U&&r&&L!==F;){const q=wv(U),G=U.getBoundingClientRect(),$=xh(U),X=G.left+(U.clientLeft+parseFloat($.paddingLeft))*q.x,ie=G.top+(U.clientTop+parseFloat($.paddingTop))*q.y;y*=q.x,x*=q.y,S*=q.x,C*=q.y,y+=X,x+=ie,F=Fc(U),U=CO(F)}}return IC({width:S,height:C,x:y,y:x})}function Mk(e,t){const n=Rk(e).scrollLeft;return t?t.left+n:M_(Sf(e)).left+n}function CK(e,t){const n=e.getBoundingClientRect(),r=n.left+t.scrollLeft-Mk(e,n),a=n.top+t.scrollTop;return{x:r,y:a}}function c1e(e){let{elements:t,rect:n,offsetParent:r,strategy:a}=e;const l=a==="fixed",f=Sf(r),i=t?Ik(t.floating):!1;if(r===f||i&&l)return n;let y={scrollLeft:0,scrollTop:0},x=_f(1);const S=_f(0),C=wf(r);if((C||!C&&!l)&&((Px(r)!=="body"||QT(f))&&(y=Rk(r)),wf(r))){const L=M_(r);x=wv(r),S.x=L.x+r.clientLeft,S.y=L.y+r.clientTop}const P=f&&!C&&!l?CK(f,y):_f(0);return{width:n.width*x.x,height:n.height*x.y,x:n.x*x.x-y.scrollLeft*x.x+S.x+P.x,y:n.y*x.y-y.scrollTop*x.y+S.y+P.y}}function d1e(e){return Array.from(e.getClientRects())}function h1e(e){const t=Sf(e),n=Rk(e),r=e.ownerDocument.body,a=Oc(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),l=Oc(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight);let f=-n.scrollLeft+Mk(e);const i=-n.scrollTop;return xh(r).direction==="rtl"&&(f+=Oc(t.clientWidth,r.clientWidth)-a),{width:a,height:l,x:f,y:i}}const MV=25;function f1e(e,t){const n=Fc(e),r=Sf(e),a=n.visualViewport;let l=r.clientWidth,f=r.clientHeight,i=0,y=0;if(a){l=a.width,f=a.height;const S=hD();(!S||S&&t==="fixed")&&(i=a.offsetLeft,y=a.offsetTop)}const x=Mk(r);if(x<=0){const S=r.ownerDocument,C=S.body,P=getComputedStyle(C),L=S.compatMode==="CSS1Compat"&&parseFloat(P.marginLeft)+parseFloat(P.marginRight)||0,F=Math.abs(r.clientWidth-C.clientWidth-L);F<=MV&&(l-=F)}else x<=MV&&(l+=x);return{width:l,height:f,x:i,y}}const p1e=new Set(["absolute","fixed"]);function m1e(e,t){const n=M_(e,!0,t==="fixed"),r=n.top+e.clientTop,a=n.left+e.clientLeft,l=wf(e)?wv(e):_f(1),f=e.clientWidth*l.x,i=e.clientHeight*l.y,y=a*l.x,x=r*l.y;return{width:f,height:i,x:y,y:x}}function PV(e,t,n){let r;if(t==="viewport")r=f1e(e,n);else if(t==="document")r=h1e(Sf(e));else if(vh(t))r=m1e(t,n);else{const a=AK(e);r={x:t.x-a.x,y:t.y-a.y,width:t.width,height:t.height}}return IC(r)}function kK(e,t){const n=k0(e);return n===t||!vh(n)||ux(n)?!1:xh(n).position==="fixed"||kK(n,t)}function g1e(e,t){const n=t.get(e);if(n)return n;let r=xT(e,[],!1).filter(i=>vh(i)&&Px(i)!=="body"),a=null;const l=xh(e).position==="fixed";let f=l?k0(e):e;for(;vh(f)&&!ux(f);){const i=xh(f),y=dD(f);!y&&i.position==="fixed"&&(a=null),(l?!y&&!a:!y&&i.position==="static"&&!!a&&p1e.has(a.position)||QT(f)&&!y&&kK(e,f))?r=r.filter(S=>S!==f):a=i,f=k0(f)}return t.set(e,r),r}function _1e(e){let{element:t,boundary:n,rootBoundary:r,strategy:a}=e;const f=[...n==="clippingAncestors"?Ik(t)?[]:g1e(t,this._c):[].concat(n),r],i=f[0],y=f.reduce((x,S)=>{const C=PV(t,S,a);return x.top=Oc(C.top,x.top),x.right=C0(C.right,x.right),x.bottom=C0(C.bottom,x.bottom),x.left=Oc(C.left,x.left),x},PV(t,i,a));return{width:y.right-y.left,height:y.bottom-y.top,x:y.left,y:y.top}}function y1e(e){const{width:t,height:n}=SK(e);return{width:t,height:n}}function v1e(e,t,n){const r=wf(t),a=Sf(t),l=n==="fixed",f=M_(e,!0,l,t);let i={scrollLeft:0,scrollTop:0};const y=_f(0);function x(){y.x=Mk(a)}if(r||!r&&!l)if((Px(t)!=="body"||QT(a))&&(i=Rk(t)),r){const L=M_(t,!0,l,t);y.x=L.x+t.clientLeft,y.y=L.y+t.clientTop}else a&&x();l&&!r&&a&&x();const S=a&&!r&&!l?CK(a,i):_f(0),C=f.left+i.scrollLeft-y.x-S.x,P=f.top+i.scrollTop-y.y-S.y;return{x:C,y:P,width:f.width,height:f.height}}function rR(e){return xh(e).position==="static"}function OV(e,t){if(!wf(e)||xh(e).position==="fixed")return null;if(t)return t(e);let n=e.offsetParent;return Sf(e)===n&&(n=n.ownerDocument.body),n}function IK(e,t){const n=Fc(e);if(Ik(e))return n;if(!wf(e)){let a=k0(e);for(;a&&!ux(a);){if(vh(a)&&!rR(a))return a;a=k0(a)}return n}let r=OV(e,t);for(;r&&t1e(r)&&rR(r);)r=OV(r,t);return r&&ux(r)&&rR(r)&&!dD(r)?n:r||a1e(e)||n}const x1e=async function(e){const t=this.getOffsetParent||IK,n=this.getDimensions,r=await n(e.floating);return{reference:v1e(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function b1e(e){return xh(e).direction==="rtl"}const w1e={convertOffsetParentRelativeRectToViewportRelativeRect:c1e,getDocumentElement:Sf,getClippingRect:_1e,getOffsetParent:IK,getElementRects:x1e,getClientRects:d1e,getDimensions:y1e,getScale:wv,isElement:vh,isRTL:b1e};function RK(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function T1e(e,t){let n=null,r;const a=Sf(e);function l(){var i;clearTimeout(r),(i=n)==null||i.disconnect(),n=null}function f(i,y){i===void 0&&(i=!1),y===void 0&&(y=1),l();const x=e.getBoundingClientRect(),{left:S,top:C,width:P,height:L}=x;if(i||t(),!P||!L)return;const F=G3(C),U=G3(a.clientWidth-(S+P)),q=G3(a.clientHeight-(C+L)),G=G3(S),X={rootMargin:-F+"px "+-U+"px "+-q+"px "+-G+"px",threshold:Oc(0,C0(1,y))||1};let ie=!0;function de(fe){const be=fe[0].intersectionRatio;if(be!==y){if(!ie)return f();be?f(!1,be):r=setTimeout(()=>{f(!1,1e-7)},1e3)}be===1&&!RK(x,e.getBoundingClientRect())&&f(),ie=!1}try{n=new IntersectionObserver(de,{...X,root:a.ownerDocument})}catch{n=new IntersectionObserver(de,X)}n.observe(e)}return f(!0),l}function E1e(e,t,n,r){r===void 0&&(r={});const{ancestorScroll:a=!0,ancestorResize:l=!0,elementResize:f=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:y=!1}=r,x=fD(e),S=a||l?[...x?xT(x):[],...xT(t)]:[];S.forEach(G=>{a&&G.addEventListener("scroll",n,{passive:!0}),l&&G.addEventListener("resize",n)});const C=x&&i?T1e(x,n):null;let P=-1,L=null;f&&(L=new ResizeObserver(G=>{let[$]=G;$&&$.target===x&&L&&(L.unobserve(t),cancelAnimationFrame(P),P=requestAnimationFrame(()=>{var X;(X=L)==null||X.observe(t)})),n()}),x&&!y&&L.observe(x),L.observe(t));let F,U=y?M_(e):null;y&&q();function q(){const G=M_(e);U&&!RK(U,G)&&n(),U=G,F=requestAnimationFrame(q)}return n(),()=>{var G;S.forEach($=>{a&&$.removeEventListener("scroll",n),l&&$.removeEventListener("resize",n)}),C==null||C(),(G=L)==null||G.disconnect(),L=null,y&&cancelAnimationFrame(F)}}const S1e=Xye,A1e=Yye,C1e=qye,k1e=Qye,I1e=Zye,LV=Gye,R1e=Kye,M1e=(e,t,n)=>{const r=new Map,a={platform:w1e,...n},l={...a.platform,_c:r};return Hye(e,t,{...a,platform:l})};var P1e=typeof document<"u",O1e=function(){},cA=P1e?B.useLayoutEffect:O1e;function RC(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,r,a;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(r=n;r--!==0;)if(!RC(e[r],t[r]))return!1;return!0}if(a=Object.keys(e),n=a.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(t,a[r]))return!1;for(r=n;r--!==0;){const l=a[r];if(!(l==="_owner"&&e.$$typeof)&&!RC(e[l],t[l]))return!1}return!0}return e!==e&&t!==t}function MK(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function DV(e,t){const n=MK(e);return Math.round(t*n)/n}function iR(e){const t=B.useRef(e);return cA(()=>{t.current=e}),t}function L1e(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:a,elements:{reference:l,floating:f}={},transform:i=!0,whileElementsMounted:y,open:x}=e,[S,C]=B.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[P,L]=B.useState(r);RC(P,r)||L(r);const[F,U]=B.useState(null),[q,G]=B.useState(null),$=B.useCallback(nt=>{nt!==fe.current&&(fe.current=nt,U(nt))},[]),X=B.useCallback(nt=>{nt!==be.current&&(be.current=nt,G(nt))},[]),ie=l||F,de=f||q,fe=B.useRef(null),be=B.useRef(null),ve=B.useRef(S),Je=y!=null,we=iR(y),rt=iR(a),He=iR(x),ft=B.useCallback(()=>{if(!fe.current||!be.current)return;const nt={placement:t,strategy:n,middleware:P};rt.current&&(nt.platform=rt.current),M1e(fe.current,be.current,nt).then(pt=>{const Oe={...pt,isPositioned:He.current!==!1};Ct.current&&!RC(ve.current,Oe)&&(ve.current=Oe,WT.flushSync(()=>{C(Oe)}))})},[P,t,n,rt,He]);cA(()=>{x===!1&&ve.current.isPositioned&&(ve.current.isPositioned=!1,C(nt=>({...nt,isPositioned:!1})))},[x]);const Ct=B.useRef(!1);cA(()=>(Ct.current=!0,()=>{Ct.current=!1}),[]),cA(()=>{if(ie&&(fe.current=ie),de&&(be.current=de),ie&&de){if(we.current)return we.current(ie,de,ft);ft()}},[ie,de,ft,we,Je]);const Nt=B.useMemo(()=>({reference:fe,floating:be,setReference:$,setFloating:X}),[$,X]),Rt=B.useMemo(()=>({reference:ie,floating:de}),[ie,de]),en=B.useMemo(()=>{const nt={position:n,left:0,top:0};if(!Rt.floating)return nt;const pt=DV(Rt.floating,S.x),Oe=DV(Rt.floating,S.y);return i?{...nt,transform:"translate("+pt+"px, "+Oe+"px)",...MK(Rt.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:pt,top:Oe}},[n,i,Rt.floating,S.x,S.y]);return B.useMemo(()=>({...S,update:ft,refs:Nt,elements:Rt,floatingStyles:en}),[S,ft,Nt,Rt,en])}const D1e=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:r,padding:a}=typeof e=="function"?e(n):e;return r&&t(r)?r.current!=null?LV({element:r.current,padding:a}).fn(n):{}:r?LV({element:r,padding:a}).fn(n):{}}}},N1e=(e,t)=>({...S1e(e),options:[e,t]}),z1e=(e,t)=>({...A1e(e),options:[e,t]}),F1e=(e,t)=>({...R1e(e),options:[e,t]}),B1e=(e,t)=>({...C1e(e),options:[e,t]}),j1e=(e,t)=>({...k1e(e),options:[e,t]}),U1e=(e,t)=>({...I1e(e),options:[e,t]}),V1e=(e,t)=>({...D1e(e),options:[e,t]});var $1e="Arrow",PK=B.forwardRef((e,t)=>{const{children:n,width:r=10,height:a=5,...l}=e;return k.jsx(Ql.svg,{...l,ref:t,width:r,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:k.jsx("polygon",{points:"0,0 30,0 15,10"})})});PK.displayName=$1e;var H1e=PK;function G1e(e){const[t,n]=B.useState(void 0);return A0(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const r=new ResizeObserver(a=>{if(!Array.isArray(a)||!a.length)return;const l=a[0];let f,i;if("borderBoxSize"in l){const y=l.borderBoxSize,x=Array.isArray(y)?y[0]:y;f=x.inlineSize,i=x.blockSize}else f=e.offsetWidth,i=e.offsetHeight;n({width:f,height:i})});return r.observe(e,{box:"border-box"}),()=>r.unobserve(e)}else n(void 0)},[e]),t}var pD="Popper",[OK,Pk]=Rx(pD),[q1e,LK]=OK(pD),DK=e=>{const{__scopePopper:t,children:n}=e,[r,a]=B.useState(null);return k.jsx(q1e,{scope:t,anchor:r,onAnchorChange:a,children:n})};DK.displayName=pD;var NK="PopperAnchor",zK=B.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:r,...a}=e,l=LK(NK,n),f=B.useRef(null),i=hu(t,f),y=B.useRef(null);return B.useEffect(()=>{const x=y.current;y.current=(r==null?void 0:r.current)||f.current,x!==y.current&&l.onAnchorChange(y.current)}),r?null:k.jsx(Ql.div,{...a,ref:i})});zK.displayName=NK;var mD="PopperContent",[Z1e,W1e]=OK(mD),FK=B.forwardRef((e,t)=>{var zn,yn,qt,wn,Sn,Xn;const{__scopePopper:n,side:r="bottom",sideOffset:a=0,align:l="center",alignOffset:f=0,arrowPadding:i=0,avoidCollisions:y=!0,collisionBoundary:x=[],collisionPadding:S=0,sticky:C="partial",hideWhenDetached:P=!1,updatePositionStrategy:L="optimized",onPlaced:F,...U}=e,q=LK(mD,n),[G,$]=B.useState(null),X=hu(t,rn=>$(rn)),[ie,de]=B.useState(null),fe=G1e(ie),be=(fe==null?void 0:fe.width)??0,ve=(fe==null?void 0:fe.height)??0,Je=r+(l!=="center"?"-"+l:""),we=typeof S=="number"?S:{top:0,right:0,bottom:0,left:0,...S},rt=Array.isArray(x)?x:[x],He=rt.length>0,ft={padding:we,boundary:rt.filter(Y1e),altBoundary:He},{refs:Ct,floatingStyles:Nt,placement:Rt,isPositioned:en,middlewareData:nt}=L1e({strategy:"fixed",placement:Je,whileElementsMounted:(...rn)=>E1e(...rn,{animationFrame:L==="always"}),elements:{reference:q.anchor},middleware:[N1e({mainAxis:a+ve,alignmentAxis:f}),y&&z1e({mainAxis:!0,crossAxis:!1,limiter:C==="partial"?F1e():void 0,...ft}),y&&B1e({...ft}),j1e({...ft,apply:({elements:rn,rects:br,availableWidth:Qr,availableHeight:sr})=>{const{width:ar,height:Vn}=br.reference,wr=rn.floating.style;wr.setProperty("--radix-popper-available-width",`${Qr}px`),wr.setProperty("--radix-popper-available-height",`${sr}px`),wr.setProperty("--radix-popper-anchor-width",`${ar}px`),wr.setProperty("--radix-popper-anchor-height",`${Vn}px`)}}),ie&&V1e({element:ie,padding:i}),K1e({arrowWidth:be,arrowHeight:ve}),P&&U1e({strategy:"referenceHidden",...ft})]}),[pt,Oe]=UK(Rt),gn=bf(F);A0(()=>{en&&(gn==null||gn())},[en,gn]);const wt=(zn=nt.arrow)==null?void 0:zn.x,Fe=(yn=nt.arrow)==null?void 0:yn.y,jt=((qt=nt.arrow)==null?void 0:qt.centerOffset)!==0,[Tn,mn]=B.useState();return A0(()=>{G&&mn(window.getComputedStyle(G).zIndex)},[G]),k.jsx("div",{ref:Ct.setFloating,"data-radix-popper-content-wrapper":"",style:{...Nt,transform:en?Nt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Tn,"--radix-popper-transform-origin":[(wn=nt.transformOrigin)==null?void 0:wn.x,(Sn=nt.transformOrigin)==null?void 0:Sn.y].join(" "),...((Xn=nt.hide)==null?void 0:Xn.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:k.jsx(Z1e,{scope:n,placedSide:pt,onArrowChange:de,arrowX:wt,arrowY:Fe,shouldHideArrow:jt,children:k.jsx(Ql.div,{"data-side":pt,"data-align":Oe,...U,ref:X,style:{...U.style,animation:en?void 0:"none"}})})})});FK.displayName=mD;var BK="PopperArrow",X1e={top:"bottom",right:"left",bottom:"top",left:"right"},jK=B.forwardRef(function(t,n){const{__scopePopper:r,...a}=t,l=W1e(BK,r),f=X1e[l.placedSide];return k.jsx("span",{ref:l.onArrowChange,style:{position:"absolute",left:l.arrowX,top:l.arrowY,[f]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[l.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[l.placedSide],visibility:l.shouldHideArrow?"hidden":void 0},children:k.jsx(H1e,{...a,ref:n,style:{...a.style,display:"block"}})})});jK.displayName=BK;function Y1e(e){return e!==null}var K1e=e=>({name:"transformOrigin",options:e,fn(t){var q,G,$;const{placement:n,rects:r,middlewareData:a}=t,f=((q=a.arrow)==null?void 0:q.centerOffset)!==0,i=f?0:e.arrowWidth,y=f?0:e.arrowHeight,[x,S]=UK(n),C={start:"0%",center:"50%",end:"100%"}[S],P=(((G=a.arrow)==null?void 0:G.x)??0)+i/2,L=((($=a.arrow)==null?void 0:$.y)??0)+y/2;let F="",U="";return x==="bottom"?(F=f?C:`${P}px`,U=`${-y}px`):x==="top"?(F=f?C:`${P}px`,U=`${r.floating.height+y}px`):x==="right"?(F=`${-y}px`,U=f?C:`${L}px`):x==="left"&&(F=`${r.floating.width+y}px`,U=f?C:`${L}px`),{data:{x:F,y:U}}}});function UK(e){const[t,n="center"]=e.split("-");return[t,n]}var gD=DK,VK=zK,$K=FK,HK=jK,Q1e="Portal",_D=B.forwardRef((e,t)=>{var i;const{container:n,...r}=e,[a,l]=B.useState(!1);A0(()=>l(!0),[]);const f=n||a&&((i=globalThis==null?void 0:globalThis.document)==null?void 0:i.body);return f?Lce.createPortal(k.jsx(Ql.div,{...r,ref:t}),f):null});_D.displayName=Q1e;function J1e(e,t){return B.useReducer((n,r)=>t[n][r]??n,e)}var $_=e=>{const{present:t,children:n}=e,r=eve(t),a=typeof n=="function"?n({present:r.isPresent}):B.Children.only(n),l=hu(r.ref,tve(a));return typeof n=="function"||r.isPresent?B.cloneElement(a,{ref:l}):null};$_.displayName="Presence";function eve(e){const[t,n]=B.useState(),r=B.useRef(null),a=B.useRef(e),l=B.useRef("none"),f=e?"mounted":"unmounted",[i,y]=J1e(f,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return B.useEffect(()=>{const x=q3(r.current);l.current=i==="mounted"?x:"none"},[i]),A0(()=>{const x=r.current,S=a.current;if(S!==e){const P=l.current,L=q3(x);e?y("MOUNT"):L==="none"||(x==null?void 0:x.display)==="none"?y("UNMOUNT"):y(S&&P!==L?"ANIMATION_OUT":"UNMOUNT"),a.current=e}},[e,y]),A0(()=>{if(t){let x;const S=t.ownerDocument.defaultView??window,C=L=>{const U=q3(r.current).includes(CSS.escape(L.animationName));if(L.target===t&&U&&(y("ANIMATION_END"),!a.current)){const q=t.style.animationFillMode;t.style.animationFillMode="forwards",x=S.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=q)})}},P=L=>{L.target===t&&(l.current=q3(r.current))};return t.addEventListener("animationstart",P),t.addEventListener("animationcancel",C),t.addEventListener("animationend",C),()=>{S.clearTimeout(x),t.removeEventListener("animationstart",P),t.removeEventListener("animationcancel",C),t.removeEventListener("animationend",C)}}else y("ANIMATION_END")},[t,y]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:B.useCallback(x=>{r.current=x?getComputedStyle(x):null,n(x)},[])}}function q3(e){return(e==null?void 0:e.animationName)||"none"}function tve(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var nve=Symbol("radix.slottable");function rve(e){const t=({children:n})=>k.jsx(k.Fragment,{children:n});return t.displayName=`${e}.Slottable`,t.__radixId=nve,t}var ive=$T[" useInsertionEffect ".trim().toString()]||A0;function Ok({prop:e,defaultProp:t,onChange:n=()=>{},caller:r}){const[a,l,f]=sve({defaultProp:t,onChange:n}),i=e!==void 0,y=i?e:a;{const S=B.useRef(e!==void 0);B.useEffect(()=>{const C=S.current;C!==i&&console.warn(`${r} is changing from ${C?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),S.current=i},[i,r])}const x=B.useCallback(S=>{var C;if(i){const P=ave(S)?S(e):S;P!==e&&((C=f.current)==null||C.call(f,P))}else l(S)},[i,e,l,f]);return[y,x]}function sve({defaultProp:e,onChange:t}){const[n,r]=B.useState(e),a=B.useRef(n),l=B.useRef(t);return ive(()=>{l.current=t},[t]),B.useEffect(()=>{var f;a.current!==n&&((f=l.current)==null||f.call(l,n),a.current=n)},[n,a]),[n,r,l]}function ave(e){return typeof e=="function"}var ove=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),lve="VisuallyHidden",GK=B.forwardRef((e,t)=>k.jsx(Ql.span,{...e,ref:t,style:{...ove,...e.style}}));GK.displayName=lve;var uve=GK,[Lk]=Rx("Tooltip",[Pk]),Dk=Pk(),qK="TooltipProvider",cve=700,kO="tooltip.open",[dve,yD]=Lk(qK),ZK=e=>{const{__scopeTooltip:t,delayDuration:n=cve,skipDelayDuration:r=300,disableHoverableContent:a=!1,children:l}=e,f=B.useRef(!0),i=B.useRef(!1),y=B.useRef(0);return B.useEffect(()=>{const x=y.current;return()=>window.clearTimeout(x)},[]),k.jsx(dve,{scope:t,isOpenDelayedRef:f,delayDuration:n,onOpen:B.useCallback(()=>{window.clearTimeout(y.current),f.current=!1},[]),onClose:B.useCallback(()=>{window.clearTimeout(y.current),y.current=window.setTimeout(()=>f.current=!0,r)},[r]),isPointerInTransitRef:i,onPointerInTransitChange:B.useCallback(x=>{i.current=x},[]),disableHoverableContent:a,children:l})};ZK.displayName=qK;var bT="Tooltip",[hve,JT]=Lk(bT),WK=e=>{const{__scopeTooltip:t,children:n,open:r,defaultOpen:a,onOpenChange:l,disableHoverableContent:f,delayDuration:i}=e,y=yD(bT,e.__scopeTooltip),x=Dk(t),[S,C]=B.useState(null),P=lx(),L=B.useRef(0),F=f??y.disableHoverableContent,U=i??y.delayDuration,q=B.useRef(!1),[G,$]=Ok({prop:r,defaultProp:a??!1,onChange:be=>{be?(y.onOpen(),document.dispatchEvent(new CustomEvent(kO))):y.onClose(),l==null||l(be)},caller:bT}),X=B.useMemo(()=>G?q.current?"delayed-open":"instant-open":"closed",[G]),ie=B.useCallback(()=>{window.clearTimeout(L.current),L.current=0,q.current=!1,$(!0)},[$]),de=B.useCallback(()=>{window.clearTimeout(L.current),L.current=0,$(!1)},[$]),fe=B.useCallback(()=>{window.clearTimeout(L.current),L.current=window.setTimeout(()=>{q.current=!0,$(!0),L.current=0},U)},[U,$]);return B.useEffect(()=>()=>{L.current&&(window.clearTimeout(L.current),L.current=0)},[]),k.jsx(gD,{...x,children:k.jsx(hve,{scope:t,contentId:P,open:G,stateAttribute:X,trigger:S,onTriggerChange:C,onTriggerEnter:B.useCallback(()=>{y.isOpenDelayedRef.current?fe():ie()},[y.isOpenDelayedRef,fe,ie]),onTriggerLeave:B.useCallback(()=>{F?de():(window.clearTimeout(L.current),L.current=0)},[de,F]),onOpen:ie,onClose:de,disableHoverableContent:F,children:n})})};WK.displayName=bT;var IO="TooltipTrigger",XK=B.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,a=JT(IO,n),l=yD(IO,n),f=Dk(n),i=B.useRef(null),y=hu(t,i,a.onTriggerChange),x=B.useRef(!1),S=B.useRef(!1),C=B.useCallback(()=>x.current=!1,[]);return B.useEffect(()=>()=>document.removeEventListener("pointerup",C),[C]),k.jsx(VK,{asChild:!0,...f,children:k.jsx(Ql.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...r,ref:y,onPointerMove:Zs(e.onPointerMove,P=>{P.pointerType!=="touch"&&!S.current&&!l.isPointerInTransitRef.current&&(a.onTriggerEnter(),S.current=!0)}),onPointerLeave:Zs(e.onPointerLeave,()=>{a.onTriggerLeave(),S.current=!1}),onPointerDown:Zs(e.onPointerDown,()=>{a.open&&a.onClose(),x.current=!0,document.addEventListener("pointerup",C,{once:!0})}),onFocus:Zs(e.onFocus,()=>{x.current||a.onOpen()}),onBlur:Zs(e.onBlur,a.onClose),onClick:Zs(e.onClick,a.onClose)})})});XK.displayName=IO;var vD="TooltipPortal",[fve,pve]=Lk(vD,{forceMount:void 0}),YK=e=>{const{__scopeTooltip:t,forceMount:n,children:r,container:a}=e,l=JT(vD,t);return k.jsx(fve,{scope:t,forceMount:n,children:k.jsx($_,{present:n||l.open,children:k.jsx(_D,{asChild:!0,container:a,children:r})})})};YK.displayName=vD;var cx="TooltipContent",KK=B.forwardRef((e,t)=>{const n=pve(cx,e.__scopeTooltip),{forceMount:r=n.forceMount,side:a="top",...l}=e,f=JT(cx,e.__scopeTooltip);return k.jsx($_,{present:r||f.open,children:f.disableHoverableContent?k.jsx(QK,{side:a,...l,ref:t}):k.jsx(mve,{side:a,...l,ref:t})})}),mve=B.forwardRef((e,t)=>{const n=JT(cx,e.__scopeTooltip),r=yD(cx,e.__scopeTooltip),a=B.useRef(null),l=hu(t,a),[f,i]=B.useState(null),{trigger:y,onClose:x}=n,S=a.current,{onPointerInTransitChange:C}=r,P=B.useCallback(()=>{i(null),C(!1)},[C]),L=B.useCallback((F,U)=>{const q=F.currentTarget,G={x:F.clientX,y:F.clientY},$=vve(G,q.getBoundingClientRect()),X=xve(G,$),ie=bve(U.getBoundingClientRect()),de=Tve([...X,...ie]);i(de),C(!0)},[C]);return B.useEffect(()=>()=>P(),[P]),B.useEffect(()=>{if(y&&S){const F=q=>L(q,S),U=q=>L(q,y);return y.addEventListener("pointerleave",F),S.addEventListener("pointerleave",U),()=>{y.removeEventListener("pointerleave",F),S.removeEventListener("pointerleave",U)}}},[y,S,L,P]),B.useEffect(()=>{if(f){const F=U=>{const q=U.target,G={x:U.clientX,y:U.clientY},$=(y==null?void 0:y.contains(q))||(S==null?void 0:S.contains(q)),X=!wve(G,f);$?P():X&&(P(),x())};return document.addEventListener("pointermove",F),()=>document.removeEventListener("pointermove",F)}},[y,S,f,x,P]),k.jsx(QK,{...e,ref:l})}),[gve,_ve]=Lk(bT,{isInside:!1}),yve=rve("TooltipContent"),QK=B.forwardRef((e,t)=>{const{__scopeTooltip:n,children:r,"aria-label":a,onEscapeKeyDown:l,onPointerDownOutside:f,...i}=e,y=JT(cx,n),x=Dk(n),{onClose:S}=y;return B.useEffect(()=>(document.addEventListener(kO,S),()=>document.removeEventListener(kO,S)),[S]),B.useEffect(()=>{if(y.trigger){const C=P=>{const L=P.target;L!=null&&L.contains(y.trigger)&&S()};return window.addEventListener("scroll",C,{capture:!0}),()=>window.removeEventListener("scroll",C,{capture:!0})}},[y.trigger,S]),k.jsx(oD,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:l,onPointerDownOutside:f,onFocusOutside:C=>C.preventDefault(),onDismiss:S,children:k.jsxs($K,{"data-state":y.stateAttribute,...x,...i,ref:t,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[k.jsx(yve,{children:r}),k.jsx(gve,{scope:n,isInside:!0,children:k.jsx(uve,{id:y.contentId,role:"tooltip",children:a||r})})]})})});KK.displayName=cx;var JK="TooltipArrow",eQ=B.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,a=Dk(n);return _ve(JK,n).isInside?null:k.jsx(HK,{...a,...r,ref:t})});eQ.displayName=JK;function vve(e,t){const n=Math.abs(t.top-e.y),r=Math.abs(t.bottom-e.y),a=Math.abs(t.right-e.x),l=Math.abs(t.left-e.x);switch(Math.min(n,r,a,l)){case l:return"left";case a:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function xve(e,t,n=5){const r=[];switch(t){case"top":r.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case"bottom":r.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case"left":r.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case"right":r.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n});break}return r}function bve(e){const{top:t,right:n,bottom:r,left:a}=e;return[{x:a,y:t},{x:n,y:t},{x:n,y:r},{x:a,y:r}]}function wve(e,t){const{x:n,y:r}=e;let a=!1;for(let l=0,f=t.length-1;l<t.length;f=l++){const i=t[l],y=t[f],x=i.x,S=i.y,C=y.x,P=y.y;S>r!=P>r&&n<(C-x)*(r-S)/(P-S)+x&&(a=!a)}return a}function Tve(e){const t=e.slice();return t.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),Eve(t)}function Eve(e){if(e.length<=1)return e.slice();const t=[];for(let r=0;r<e.length;r++){const a=e[r];for(;t.length>=2;){const l=t[t.length-1],f=t[t.length-2];if((l.x-f.x)*(a.y-f.y)>=(l.y-f.y)*(a.x-f.x))t.pop();else break}t.push(a)}t.pop();const n=[];for(let r=e.length-1;r>=0;r--){const a=e[r];for(;n.length>=2;){const l=n[n.length-1],f=n[n.length-2];if((l.x-f.x)*(a.y-f.y)>=(l.y-f.y)*(a.x-f.x))n.pop();else break}n.push(a)}return n.pop(),t.length===1&&n.length===1&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}var Sve=ZK,Ave=WK,Cve=XK,kve=YK,Ive=KK,Rve=eQ;function NV(e){const t=Mve(e),n=B.forwardRef((r,a)=>{const{children:l,...f}=r,i=B.Children.toArray(l),y=i.find(Ove);if(y){const x=y.props.children,S=i.map(C=>C===y?B.Children.count(x)>1?B.Children.only(null):B.isValidElement(x)?x.props.children:null:C);return k.jsx(t,{...f,ref:a,children:B.isValidElement(x)?B.cloneElement(x,void 0,S):null})}return k.jsx(t,{...f,ref:a,children:l})});return n.displayName=`${e}.Slot`,n}function Mve(e){const t=B.forwardRef((n,r)=>{const{children:a,...l}=n;if(B.isValidElement(a)){const f=Dve(a),i=Lve(l,a.props);return a.type!==B.Fragment&&(i.ref=r?V_(r,f):f),B.cloneElement(a,i)}return B.Children.count(a)>1?B.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Pve=Symbol("radix.slottable");function Ove(e){return B.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Pve}function Lve(e,t){const n={...t};for(const r in t){const a=e[r],l=t[r];/^on[A-Z]/.test(r)?a&&l?n[r]=(...i)=>{const y=l(...i);return a(...i),y}:a&&(n[r]=a):r==="style"?n[r]={...a,...l}:r==="className"&&(n[r]=[a,l].filter(Boolean).join(" "))}return{...e,...n}}function Dve(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function tQ(e){const t=e+"CollectionProvider",[n,r]=Rx(t),[a,l]=n(t,{collectionRef:{current:null},itemMap:new Map}),f=U=>{const{scope:q,children:G}=U,$=cs.useRef(null),X=cs.useRef(new Map).current;return k.jsx(a,{scope:q,itemMap:X,collectionRef:$,children:G})};f.displayName=t;const i=e+"CollectionSlot",y=NV(i),x=cs.forwardRef((U,q)=>{const{scope:G,children:$}=U,X=l(i,G),ie=hu(q,X.collectionRef);return k.jsx(y,{ref:ie,children:$})});x.displayName=i;const S=e+"CollectionItemSlot",C="data-radix-collection-item",P=NV(S),L=cs.forwardRef((U,q)=>{const{scope:G,children:$,...X}=U,ie=cs.useRef(null),de=hu(q,ie),fe=l(S,G);return cs.useEffect(()=>(fe.itemMap.set(ie,{ref:ie,...X}),()=>void fe.itemMap.delete(ie))),k.jsx(P,{[C]:"",ref:de,children:$})});L.displayName=S;function F(U){const q=l(e+"CollectionConsumer",U);return cs.useCallback(()=>{const $=q.collectionRef.current;if(!$)return[];const X=Array.from($.querySelectorAll(`[${C}]`));return Array.from(q.itemMap.values()).sort((fe,be)=>X.indexOf(fe.ref.current)-X.indexOf(be.ref.current))},[q.collectionRef,q.itemMap])}return[{Provider:f,Slot:x,ItemSlot:L},F,r]}var Nve=B.createContext(void 0);function nQ(e){const t=B.useContext(Nve);return e||t||"ltr"}var sR=0;function zve(){B.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??zV()),document.body.insertAdjacentElement("beforeend",e[1]??zV()),sR++,()=>{sR===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),sR--}},[])}function zV(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var aR="focusScope.autoFocusOnMount",oR="focusScope.autoFocusOnUnmount",FV={bubbles:!1,cancelable:!0},Fve="FocusScope",rQ=B.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:a,onUnmountAutoFocus:l,...f}=e,[i,y]=B.useState(null),x=bf(a),S=bf(l),C=B.useRef(null),P=hu(t,U=>y(U)),L=B.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;B.useEffect(()=>{if(r){let U=function(X){if(L.paused||!i)return;const ie=X.target;i.contains(ie)?C.current=ie:Im(C.current,{select:!0})},q=function(X){if(L.paused||!i)return;const ie=X.relatedTarget;ie!==null&&(i.contains(ie)||Im(C.current,{select:!0}))},G=function(X){if(document.activeElement===document.body)for(const de of X)de.removedNodes.length>0&&Im(i)};document.addEventListener("focusin",U),document.addEventListener("focusout",q);const $=new MutationObserver(G);return i&&$.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",U),document.removeEventListener("focusout",q),$.disconnect()}}},[r,i,L.paused]),B.useEffect(()=>{if(i){jV.add(L);const U=document.activeElement;if(!i.contains(U)){const G=new CustomEvent(aR,FV);i.addEventListener(aR,x),i.dispatchEvent(G),G.defaultPrevented||(Bve(Hve(iQ(i)),{select:!0}),document.activeElement===U&&Im(i))}return()=>{i.removeEventListener(aR,x),setTimeout(()=>{const G=new CustomEvent(oR,FV);i.addEventListener(oR,S),i.dispatchEvent(G),G.defaultPrevented||Im(U??document.body,{select:!0}),i.removeEventListener(oR,S),jV.remove(L)},0)}}},[i,x,S,L]);const F=B.useCallback(U=>{if(!n&&!r||L.paused)return;const q=U.key==="Tab"&&!U.altKey&&!U.ctrlKey&&!U.metaKey,G=document.activeElement;if(q&&G){const $=U.currentTarget,[X,ie]=jve($);X&&ie?!U.shiftKey&&G===ie?(U.preventDefault(),n&&Im(X,{select:!0})):U.shiftKey&&G===X&&(U.preventDefault(),n&&Im(ie,{select:!0})):G===$&&U.preventDefault()}},[n,r,L.paused]);return k.jsx(Ql.div,{tabIndex:-1,...f,ref:P,onKeyDown:F})});rQ.displayName=Fve;function Bve(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(Im(r,{select:t}),document.activeElement!==n)return}function jve(e){const t=iQ(e),n=BV(t,e),r=BV(t.reverse(),e);return[n,r]}function iQ(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const a=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||a?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function BV(e,t){for(const n of e)if(!Uve(n,{upTo:t}))return n}function Uve(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function Vve(e){return e instanceof HTMLInputElement&&"select"in e}function Im(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&Vve(e)&&t&&e.select()}}var jV=$ve();function $ve(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=UV(e,t),e.unshift(t)},remove(t){var n;e=UV(e,t),(n=e[0])==null||n.resume()}}}function UV(e,t){const n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function Hve(e){return e.filter(t=>t.tagName!=="A")}var lR="rovingFocusGroup.onEntryFocus",Gve={bubbles:!1,cancelable:!0},eE="RovingFocusGroup",[RO,sQ,qve]=tQ(eE),[Zve,aQ]=Rx(eE,[qve]),[Wve,Xve]=Zve(eE),oQ=B.forwardRef((e,t)=>k.jsx(RO.Provider,{scope:e.__scopeRovingFocusGroup,children:k.jsx(RO.Slot,{scope:e.__scopeRovingFocusGroup,children:k.jsx(Yve,{...e,ref:t})})}));oQ.displayName=eE;var Yve=B.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:a=!1,dir:l,currentTabStopId:f,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:y,onEntryFocus:x,preventScrollOnEntryFocus:S=!1,...C}=e,P=B.useRef(null),L=hu(t,P),F=nQ(l),[U,q]=Ok({prop:f,defaultProp:i??null,onChange:y,caller:eE}),[G,$]=B.useState(!1),X=bf(x),ie=sQ(n),de=B.useRef(!1),[fe,be]=B.useState(0);return B.useEffect(()=>{const ve=P.current;if(ve)return ve.addEventListener(lR,X),()=>ve.removeEventListener(lR,X)},[X]),k.jsx(Wve,{scope:n,orientation:r,dir:F,loop:a,currentTabStopId:U,onItemFocus:B.useCallback(ve=>q(ve),[q]),onItemShiftTab:B.useCallback(()=>$(!0),[]),onFocusableItemAdd:B.useCallback(()=>be(ve=>ve+1),[]),onFocusableItemRemove:B.useCallback(()=>be(ve=>ve-1),[]),children:k.jsx(Ql.div,{tabIndex:G||fe===0?-1:0,"data-orientation":r,...C,ref:L,style:{outline:"none",...e.style},onMouseDown:Zs(e.onMouseDown,()=>{de.current=!0}),onFocus:Zs(e.onFocus,ve=>{const Je=!de.current;if(ve.target===ve.currentTarget&&Je&&!G){const we=new CustomEvent(lR,Gve);if(ve.currentTarget.dispatchEvent(we),!we.defaultPrevented){const rt=ie().filter(Rt=>Rt.focusable),He=rt.find(Rt=>Rt.active),ft=rt.find(Rt=>Rt.id===U),Nt=[He,ft,...rt].filter(Boolean).map(Rt=>Rt.ref.current);cQ(Nt,S)}}de.current=!1}),onBlur:Zs(e.onBlur,()=>$(!1))})})}),lQ="RovingFocusGroupItem",uQ=B.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:a=!1,tabStopId:l,children:f,...i}=e,y=lx(),x=l||y,S=Xve(lQ,n),C=S.currentTabStopId===x,P=sQ(n),{onFocusableItemAdd:L,onFocusableItemRemove:F,currentTabStopId:U}=S;return B.useEffect(()=>{if(r)return L(),()=>F()},[r,L,F]),k.jsx(RO.ItemSlot,{scope:n,id:x,focusable:r,active:a,children:k.jsx(Ql.span,{tabIndex:C?0:-1,"data-orientation":S.orientation,...i,ref:t,onMouseDown:Zs(e.onMouseDown,q=>{r?S.onItemFocus(x):q.preventDefault()}),onFocus:Zs(e.onFocus,()=>S.onItemFocus(x)),onKeyDown:Zs(e.onKeyDown,q=>{if(q.key==="Tab"&&q.shiftKey){S.onItemShiftTab();return}if(q.target!==q.currentTarget)return;const G=Jve(q,S.orientation,S.dir);if(G!==void 0){if(q.metaKey||q.ctrlKey||q.altKey||q.shiftKey)return;q.preventDefault();let X=P().filter(ie=>ie.focusable).map(ie=>ie.ref.current);if(G==="last")X.reverse();else if(G==="prev"||G==="next"){G==="prev"&&X.reverse();const ie=X.indexOf(q.currentTarget);X=S.loop?exe(X,ie+1):X.slice(ie+1)}setTimeout(()=>cQ(X))}}),children:typeof f=="function"?f({isCurrentTabStop:C,hasTabStop:U!=null}):f})})});uQ.displayName=lQ;var Kve={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Qve(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Jve(e,t,n){const r=Qve(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return Kve[r]}function cQ(e,t=!1){const n=document.activeElement;for(const r of e)if(r===n||(r.focus({preventScroll:t}),document.activeElement!==n))return}function exe(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var txe=oQ,nxe=uQ;function rxe(e){const t=ixe(e),n=B.forwardRef((r,a)=>{const{children:l,...f}=r,i=B.Children.toArray(l),y=i.find(axe);if(y){const x=y.props.children,S=i.map(C=>C===y?B.Children.count(x)>1?B.Children.only(null):B.isValidElement(x)?x.props.children:null:C);return k.jsx(t,{...f,ref:a,children:B.isValidElement(x)?B.cloneElement(x,void 0,S):null})}return k.jsx(t,{...f,ref:a,children:l})});return n.displayName=`${e}.Slot`,n}function ixe(e){const t=B.forwardRef((n,r)=>{const{children:a,...l}=n;if(B.isValidElement(a)){const f=lxe(a),i=oxe(l,a.props);return a.type!==B.Fragment&&(i.ref=r?V_(r,f):f),B.cloneElement(a,i)}return B.Children.count(a)>1?B.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var sxe=Symbol("radix.slottable");function axe(e){return B.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===sxe}function oxe(e,t){const n={...t};for(const r in t){const a=e[r],l=t[r];/^on[A-Z]/.test(r)?a&&l?n[r]=(...i)=>{const y=l(...i);return a(...i),y}:a&&(n[r]=a):r==="style"?n[r]={...a,...l}:r==="className"&&(n[r]=[a,l].filter(Boolean).join(" "))}return{...e,...n}}function lxe(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var uxe=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},V1=new WeakMap,Z3=new WeakMap,W3={},uR=0,dQ=function(e){return e&&(e.host||dQ(e.parentNode))},cxe=function(e,t){return t.map(function(n){if(e.contains(n))return n;var r=dQ(n);return r&&e.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},dxe=function(e,t,n,r){var a=cxe(t,Array.isArray(e)?e:[e]);W3[n]||(W3[n]=new WeakMap);var l=W3[n],f=[],i=new Set,y=new Set(a),x=function(C){!C||i.has(C)||(i.add(C),x(C.parentNode))};a.forEach(x);var S=function(C){!C||y.has(C)||Array.prototype.forEach.call(C.children,function(P){if(i.has(P))S(P);else try{var L=P.getAttribute(r),F=L!==null&&L!=="false",U=(V1.get(P)||0)+1,q=(l.get(P)||0)+1;V1.set(P,U),l.set(P,q),f.push(P),U===1&&F&&Z3.set(P,!0),q===1&&P.setAttribute(n,"true"),F||P.setAttribute(r,"true")}catch(G){console.error("aria-hidden: cannot operate on ",P,G)}})};return S(t),i.clear(),uR++,function(){f.forEach(function(C){var P=V1.get(C)-1,L=l.get(C)-1;V1.set(C,P),l.set(C,L),P||(Z3.has(C)||C.removeAttribute(r),Z3.delete(C)),L||C.removeAttribute(n)}),uR--,uR||(V1=new WeakMap,V1=new WeakMap,Z3=new WeakMap,W3={})}},hxe=function(e,t,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),a=uxe(e);return a?(r.push.apply(r,Array.from(a.querySelectorAll("[aria-live], script"))),dxe(r,a,n,"aria-hidden")):function(){return null}},dA="right-scroll-bar-position",hA="width-before-scroll-bar",fxe="with-scroll-bars-hidden",pxe="--removed-body-scroll-bar-size";function cR(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function mxe(e,t){var n=B.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(r){var a=n.value;a!==r&&(n.value=r,n.callback(r,a))}}}})[0];return n.callback=t,n.facade}var gxe=typeof window<"u"?B.useLayoutEffect:B.useEffect,VV=new WeakMap;function _xe(e,t){var n=mxe(null,function(r){return e.forEach(function(a){return cR(a,r)})});return gxe(function(){var r=VV.get(n);if(r){var a=new Set(r),l=new Set(e),f=n.current;a.forEach(function(i){l.has(i)||cR(i,null)}),l.forEach(function(i){a.has(i)||cR(i,f)})}VV.set(n,e)},[e]),n}function yxe(e){return e}function vxe(e,t){t===void 0&&(t=yxe);var n=[],r=!1,a={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(l){var f=t(l,r);return n.push(f),function(){n=n.filter(function(i){return i!==f})}},assignSyncMedium:function(l){for(r=!0;n.length;){var f=n;n=[],f.forEach(l)}n={push:function(i){return l(i)},filter:function(){return n}}},assignMedium:function(l){r=!0;var f=[];if(n.length){var i=n;n=[],i.forEach(l),f=n}var y=function(){var S=f;f=[],S.forEach(l)},x=function(){return Promise.resolve().then(y)};x(),n={push:function(S){f.push(S),x()},filter:function(S){return f=f.filter(S),n}}}};return a}function xxe(e){e===void 0&&(e={});var t=vxe(null);return t.options=lf({async:!0,ssr:!1},e),t}var hQ=function(e){var t=e.sideCar,n=SX(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw new Error("Sidecar medium not found");return B.createElement(r,lf({},n))};hQ.isSideCarExport=!0;function bxe(e,t){return e.useMedium(t),hQ}var fQ=xxe(),dR=function(){},Nk=B.forwardRef(function(e,t){var n=B.useRef(null),r=B.useState({onScrollCapture:dR,onWheelCapture:dR,onTouchMoveCapture:dR}),a=r[0],l=r[1],f=e.forwardProps,i=e.children,y=e.className,x=e.removeScrollBar,S=e.enabled,C=e.shards,P=e.sideCar,L=e.noRelative,F=e.noIsolation,U=e.inert,q=e.allowPinchZoom,G=e.as,$=G===void 0?"div":G,X=e.gapMode,ie=SX(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),de=P,fe=_xe([n,t]),be=lf(lf({},ie),a);return B.createElement(B.Fragment,null,S&&B.createElement(de,{sideCar:fQ,removeScrollBar:x,shards:C,noRelative:L,noIsolation:F,inert:U,setCallbacks:l,allowPinchZoom:!!q,lockRef:n,gapMode:X}),f?B.cloneElement(B.Children.only(i),lf(lf({},be),{ref:fe})):B.createElement($,lf({},be,{className:y,ref:fe}),i))});Nk.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Nk.classNames={fullWidth:hA,zeroRight:dA};var wxe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Txe(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=wxe();return t&&e.setAttribute("nonce",t),e}function Exe(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function Sxe(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var Axe=function(){var e=0,t=null;return{add:function(n){e==0&&(t=Txe())&&(Exe(t,n),Sxe(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Cxe=function(){var e=Axe();return function(t,n){B.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},pQ=function(){var e=Cxe(),t=function(n){var r=n.styles,a=n.dynamic;return e(r,a),null};return t},kxe={left:0,top:0,right:0,gap:0},hR=function(e){return parseInt(e||"",10)||0},Ixe=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],r=t[e==="padding"?"paddingTop":"marginTop"],a=t[e==="padding"?"paddingRight":"marginRight"];return[hR(n),hR(r),hR(a)]},Rxe=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return kxe;var t=Ixe(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},Mxe=pQ(),Tv="data-scroll-locked",Pxe=function(e,t,n,r){var a=e.left,l=e.top,f=e.right,i=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(fxe,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(i,"px ").concat(r,`;
  }
  body[`).concat(Tv,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(a,`px;
    padding-top: `).concat(l,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(i,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(dA,` {
    right: `).concat(i,"px ").concat(r,`;
  }
  
  .`).concat(hA,` {
    margin-right: `).concat(i,"px ").concat(r,`;
  }
  
  .`).concat(dA," .").concat(dA,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(hA," .").concat(hA,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(Tv,`] {
    `).concat(pxe,": ").concat(i,`px;
  }
`)},$V=function(){var e=parseInt(document.body.getAttribute(Tv)||"0",10);return isFinite(e)?e:0},Oxe=function(){B.useEffect(function(){return document.body.setAttribute(Tv,($V()+1).toString()),function(){var e=$V()-1;e<=0?document.body.removeAttribute(Tv):document.body.setAttribute(Tv,e.toString())}},[])},Lxe=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,a=r===void 0?"margin":r;Oxe();var l=B.useMemo(function(){return Rxe(a)},[a]);return B.createElement(Mxe,{styles:Pxe(l,!t,a,n?"":"!important")})},MO=!1;if(typeof window<"u")try{var X3=Object.defineProperty({},"passive",{get:function(){return MO=!0,!0}});window.addEventListener("test",X3,X3),window.removeEventListener("test",X3,X3)}catch{MO=!1}var $1=MO?{passive:!1}:!1,Dxe=function(e){return e.tagName==="TEXTAREA"},mQ=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!Dxe(e)&&n[t]==="visible")},Nxe=function(e){return mQ(e,"overflowY")},zxe=function(e){return mQ(e,"overflowX")},HV=function(e,t){var n=t.ownerDocument,r=t;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var a=gQ(e,r);if(a){var l=_Q(e,r),f=l[1],i=l[2];if(f>i)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},Fxe=function(e){var t=e.scrollTop,n=e.scrollHeight,r=e.clientHeight;return[t,n,r]},Bxe=function(e){var t=e.scrollLeft,n=e.scrollWidth,r=e.clientWidth;return[t,n,r]},gQ=function(e,t){return e==="v"?Nxe(t):zxe(t)},_Q=function(e,t){return e==="v"?Fxe(t):Bxe(t)},jxe=function(e,t){return e==="h"&&t==="rtl"?-1:1},Uxe=function(e,t,n,r,a){var l=jxe(e,window.getComputedStyle(t).direction),f=l*r,i=n.target,y=t.contains(i),x=!1,S=f>0,C=0,P=0;do{if(!i)break;var L=_Q(e,i),F=L[0],U=L[1],q=L[2],G=U-q-l*F;(F||G)&&gQ(e,i)&&(C+=G,P+=F);var $=i.parentNode;i=$&&$.nodeType===Node.DOCUMENT_FRAGMENT_NODE?$.host:$}while(!y&&i!==document.body||y&&(t.contains(i)||t===i));return(S&&Math.abs(C)<1||!S&&Math.abs(P)<1)&&(x=!0),x},Y3=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},GV=function(e){return[e.deltaX,e.deltaY]},qV=function(e){return e&&"current"in e?e.current:e},Vxe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},$xe=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},Hxe=0,H1=[];function Gxe(e){var t=B.useRef([]),n=B.useRef([0,0]),r=B.useRef(),a=B.useState(Hxe++)[0],l=B.useState(pQ)[0],f=B.useRef(e);B.useEffect(function(){f.current=e},[e]),B.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(a));var U=KA([e.lockRef.current],(e.shards||[]).map(qV),!0).filter(Boolean);return U.forEach(function(q){return q.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),U.forEach(function(q){return q.classList.remove("allow-interactivity-".concat(a))})}}},[e.inert,e.lockRef.current,e.shards]);var i=B.useCallback(function(U,q){if("touches"in U&&U.touches.length===2||U.type==="wheel"&&U.ctrlKey)return!f.current.allowPinchZoom;var G=Y3(U),$=n.current,X="deltaX"in U?U.deltaX:$[0]-G[0],ie="deltaY"in U?U.deltaY:$[1]-G[1],de,fe=U.target,be=Math.abs(X)>Math.abs(ie)?"h":"v";if("touches"in U&&be==="h"&&fe.type==="range")return!1;var ve=window.getSelection(),Je=ve&&ve.anchorNode,we=Je?Je===fe||Je.contains(fe):!1;if(we)return!1;var rt=HV(be,fe);if(!rt)return!0;if(rt?de=be:(de=be==="v"?"h":"v",rt=HV(be,fe)),!rt)return!1;if(!r.current&&"changedTouches"in U&&(X||ie)&&(r.current=de),!de)return!0;var He=r.current||de;return Uxe(He,q,U,He==="h"?X:ie)},[]),y=B.useCallback(function(U){var q=U;if(!(!H1.length||H1[H1.length-1]!==l)){var G="deltaY"in q?GV(q):Y3(q),$=t.current.filter(function(de){return de.name===q.type&&(de.target===q.target||q.target===de.shadowParent)&&Vxe(de.delta,G)})[0];if($&&$.should){q.cancelable&&q.preventDefault();return}if(!$){var X=(f.current.shards||[]).map(qV).filter(Boolean).filter(function(de){return de.contains(q.target)}),ie=X.length>0?i(q,X[0]):!f.current.noIsolation;ie&&q.cancelable&&q.preventDefault()}}},[]),x=B.useCallback(function(U,q,G,$){var X={name:U,delta:q,target:G,should:$,shadowParent:qxe(G)};t.current.push(X),setTimeout(function(){t.current=t.current.filter(function(ie){return ie!==X})},1)},[]),S=B.useCallback(function(U){n.current=Y3(U),r.current=void 0},[]),C=B.useCallback(function(U){x(U.type,GV(U),U.target,i(U,e.lockRef.current))},[]),P=B.useCallback(function(U){x(U.type,Y3(U),U.target,i(U,e.lockRef.current))},[]);B.useEffect(function(){return H1.push(l),e.setCallbacks({onScrollCapture:C,onWheelCapture:C,onTouchMoveCapture:P}),document.addEventListener("wheel",y,$1),document.addEventListener("touchmove",y,$1),document.addEventListener("touchstart",S,$1),function(){H1=H1.filter(function(U){return U!==l}),document.removeEventListener("wheel",y,$1),document.removeEventListener("touchmove",y,$1),document.removeEventListener("touchstart",S,$1)}},[]);var L=e.removeScrollBar,F=e.inert;return B.createElement(B.Fragment,null,F?B.createElement(l,{styles:$xe(a)}):null,L?B.createElement(Lxe,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function qxe(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const Zxe=bxe(fQ,Gxe);var yQ=B.forwardRef(function(e,t){return B.createElement(Nk,lf({},e,{ref:t,sideCar:Zxe}))});yQ.classNames=Nk.classNames;var PO=["Enter"," "],Wxe=["ArrowDown","PageUp","Home"],vQ=["ArrowUp","PageDown","End"],Xxe=[...Wxe,...vQ],Yxe={ltr:[...PO,"ArrowRight"],rtl:[...PO,"ArrowLeft"]},Kxe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},tE="Menu",[wT,Qxe,Jxe]=tQ(tE),[H_,xQ]=Rx(tE,[Jxe,Pk,aQ]),nE=Pk(),bQ=aQ(),[wQ,j0]=H_(tE),[ebe,rE]=H_(tE),TQ=e=>{const{__scopeMenu:t,open:n=!1,children:r,dir:a,onOpenChange:l,modal:f=!0}=e,i=nE(t),[y,x]=B.useState(null),S=B.useRef(!1),C=bf(l),P=nQ(a);return B.useEffect(()=>{const L=()=>{S.current=!0,document.addEventListener("pointerdown",F,{capture:!0,once:!0}),document.addEventListener("pointermove",F,{capture:!0,once:!0})},F=()=>S.current=!1;return document.addEventListener("keydown",L,{capture:!0}),()=>{document.removeEventListener("keydown",L,{capture:!0}),document.removeEventListener("pointerdown",F,{capture:!0}),document.removeEventListener("pointermove",F,{capture:!0})}},[]),k.jsx(gD,{...i,children:k.jsx(wQ,{scope:t,open:n,onOpenChange:C,content:y,onContentChange:x,children:k.jsx(ebe,{scope:t,onClose:B.useCallback(()=>C(!1),[C]),isUsingKeyboardRef:S,dir:P,modal:f,children:r})})})};TQ.displayName=tE;var tbe="MenuAnchor",xD=B.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,a=nE(n);return k.jsx(VK,{...a,...r,ref:t})});xD.displayName=tbe;var bD="MenuPortal",[nbe,EQ]=H_(bD,{forceMount:void 0}),SQ=e=>{const{__scopeMenu:t,forceMount:n,children:r,container:a}=e,l=j0(bD,t);return k.jsx(nbe,{scope:t,forceMount:n,children:k.jsx($_,{present:n||l.open,children:k.jsx(_D,{asChild:!0,container:a,children:r})})})};SQ.displayName=bD;var xd="MenuContent",[rbe,wD]=H_(xd),AQ=B.forwardRef((e,t)=>{const n=EQ(xd,e.__scopeMenu),{forceMount:r=n.forceMount,...a}=e,l=j0(xd,e.__scopeMenu),f=rE(xd,e.__scopeMenu);return k.jsx(wT.Provider,{scope:e.__scopeMenu,children:k.jsx($_,{present:r||l.open,children:k.jsx(wT.Slot,{scope:e.__scopeMenu,children:f.modal?k.jsx(ibe,{...a,ref:t}):k.jsx(sbe,{...a,ref:t})})})})}),ibe=B.forwardRef((e,t)=>{const n=j0(xd,e.__scopeMenu),r=B.useRef(null),a=hu(t,r);return B.useEffect(()=>{const l=r.current;if(l)return hxe(l)},[]),k.jsx(TD,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:Zs(e.onFocusOutside,l=>l.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),sbe=B.forwardRef((e,t)=>{const n=j0(xd,e.__scopeMenu);return k.jsx(TD,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),abe=rxe("MenuContent.ScrollLock"),TD=B.forwardRef((e,t)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:a,onOpenAutoFocus:l,onCloseAutoFocus:f,disableOutsidePointerEvents:i,onEntryFocus:y,onEscapeKeyDown:x,onPointerDownOutside:S,onFocusOutside:C,onInteractOutside:P,onDismiss:L,disableOutsideScroll:F,...U}=e,q=j0(xd,n),G=rE(xd,n),$=nE(n),X=bQ(n),ie=Qxe(n),[de,fe]=B.useState(null),be=B.useRef(null),ve=hu(t,be,q.onContentChange),Je=B.useRef(0),we=B.useRef(""),rt=B.useRef(0),He=B.useRef(null),ft=B.useRef("right"),Ct=B.useRef(0),Nt=F?yQ:B.Fragment,Rt=F?{as:abe,allowPinchZoom:!0}:void 0,en=pt=>{var zn,yn;const Oe=we.current+pt,gn=ie().filter(qt=>!qt.disabled),wt=document.activeElement,Fe=(zn=gn.find(qt=>qt.ref.current===wt))==null?void 0:zn.textValue,jt=gn.map(qt=>qt.textValue),Tn=ybe(jt,Oe,Fe),mn=(yn=gn.find(qt=>qt.textValue===Tn))==null?void 0:yn.ref.current;(function qt(wn){we.current=wn,window.clearTimeout(Je.current),wn!==""&&(Je.current=window.setTimeout(()=>qt(""),1e3))})(Oe),mn&&setTimeout(()=>mn.focus())};B.useEffect(()=>()=>window.clearTimeout(Je.current),[]),zve();const nt=B.useCallback(pt=>{var gn,wt;return ft.current===((gn=He.current)==null?void 0:gn.side)&&xbe(pt,(wt=He.current)==null?void 0:wt.area)},[]);return k.jsx(rbe,{scope:n,searchRef:we,onItemEnter:B.useCallback(pt=>{nt(pt)&&pt.preventDefault()},[nt]),onItemLeave:B.useCallback(pt=>{var Oe;nt(pt)||((Oe=be.current)==null||Oe.focus(),fe(null))},[nt]),onTriggerLeave:B.useCallback(pt=>{nt(pt)&&pt.preventDefault()},[nt]),pointerGraceTimerRef:rt,onPointerGraceIntentChange:B.useCallback(pt=>{He.current=pt},[]),children:k.jsx(Nt,{...Rt,children:k.jsx(rQ,{asChild:!0,trapped:a,onMountAutoFocus:Zs(l,pt=>{var Oe;pt.preventDefault(),(Oe=be.current)==null||Oe.focus({preventScroll:!0})}),onUnmountAutoFocus:f,children:k.jsx(oD,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:x,onPointerDownOutside:S,onFocusOutside:C,onInteractOutside:P,onDismiss:L,children:k.jsx(txe,{asChild:!0,...X,dir:G.dir,orientation:"vertical",loop:r,currentTabStopId:de,onCurrentTabStopIdChange:fe,onEntryFocus:Zs(y,pt=>{G.isUsingKeyboardRef.current||pt.preventDefault()}),preventScrollOnEntryFocus:!0,children:k.jsx($K,{role:"menu","aria-orientation":"vertical","data-state":$Q(q.open),"data-radix-menu-content":"",dir:G.dir,...$,...U,ref:ve,style:{outline:"none",...U.style},onKeyDown:Zs(U.onKeyDown,pt=>{const gn=pt.target.closest("[data-radix-menu-content]")===pt.currentTarget,wt=pt.ctrlKey||pt.altKey||pt.metaKey,Fe=pt.key.length===1;gn&&(pt.key==="Tab"&&pt.preventDefault(),!wt&&Fe&&en(pt.key));const jt=be.current;if(pt.target!==jt||!Xxe.includes(pt.key))return;pt.preventDefault();const mn=ie().filter(zn=>!zn.disabled).map(zn=>zn.ref.current);vQ.includes(pt.key)&&mn.reverse(),gbe(mn)}),onBlur:Zs(e.onBlur,pt=>{pt.currentTarget.contains(pt.target)||(window.clearTimeout(Je.current),we.current="")}),onPointerMove:Zs(e.onPointerMove,TT(pt=>{const Oe=pt.target,gn=Ct.current!==pt.clientX;if(pt.currentTarget.contains(Oe)&&gn){const wt=pt.clientX>Ct.current?"right":"left";ft.current=wt,Ct.current=pt.clientX}}))})})})})})})});AQ.displayName=xd;var obe="MenuGroup",ED=B.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return k.jsx(Ql.div,{role:"group",...r,ref:t})});ED.displayName=obe;var lbe="MenuLabel",CQ=B.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return k.jsx(Ql.div,{...r,ref:t})});CQ.displayName=lbe;var MC="MenuItem",ZV="menu.itemSelect",zk=B.forwardRef((e,t)=>{const{disabled:n=!1,onSelect:r,...a}=e,l=B.useRef(null),f=rE(MC,e.__scopeMenu),i=wD(MC,e.__scopeMenu),y=hu(t,l),x=B.useRef(!1),S=()=>{const C=l.current;if(!n&&C){const P=new CustomEvent(ZV,{bubbles:!0,cancelable:!0});C.addEventListener(ZV,L=>r==null?void 0:r(L),{once:!0}),yK(C,P),P.defaultPrevented?x.current=!1:f.onClose()}};return k.jsx(kQ,{...a,ref:y,disabled:n,onClick:Zs(e.onClick,S),onPointerDown:C=>{var P;(P=e.onPointerDown)==null||P.call(e,C),x.current=!0},onPointerUp:Zs(e.onPointerUp,C=>{var P;x.current||(P=C.currentTarget)==null||P.click()}),onKeyDown:Zs(e.onKeyDown,C=>{const P=i.searchRef.current!=="";n||P&&C.key===" "||PO.includes(C.key)&&(C.currentTarget.click(),C.preventDefault())})})});zk.displayName=MC;var kQ=B.forwardRef((e,t)=>{const{__scopeMenu:n,disabled:r=!1,textValue:a,...l}=e,f=wD(MC,n),i=bQ(n),y=B.useRef(null),x=hu(t,y),[S,C]=B.useState(!1),[P,L]=B.useState("");return B.useEffect(()=>{const F=y.current;F&&L((F.textContent??"").trim())},[l.children]),k.jsx(wT.ItemSlot,{scope:n,disabled:r,textValue:a??P,children:k.jsx(nxe,{asChild:!0,...i,focusable:!r,children:k.jsx(Ql.div,{role:"menuitem","data-highlighted":S?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...l,ref:x,onPointerMove:Zs(e.onPointerMove,TT(F=>{r?f.onItemLeave(F):(f.onItemEnter(F),F.defaultPrevented||F.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Zs(e.onPointerLeave,TT(F=>f.onItemLeave(F))),onFocus:Zs(e.onFocus,()=>C(!0)),onBlur:Zs(e.onBlur,()=>C(!1))})})})}),ube="MenuCheckboxItem",IQ=B.forwardRef((e,t)=>{const{checked:n=!1,onCheckedChange:r,...a}=e;return k.jsx(LQ,{scope:e.__scopeMenu,checked:n,children:k.jsx(zk,{role:"menuitemcheckbox","aria-checked":PC(n)?"mixed":n,...a,ref:t,"data-state":CD(n),onSelect:Zs(a.onSelect,()=>r==null?void 0:r(PC(n)?!0:!n),{checkForDefaultPrevented:!1})})})});IQ.displayName=ube;var RQ="MenuRadioGroup",[cbe,dbe]=H_(RQ,{value:void 0,onValueChange:()=>{}}),MQ=B.forwardRef((e,t)=>{const{value:n,onValueChange:r,...a}=e,l=bf(r);return k.jsx(cbe,{scope:e.__scopeMenu,value:n,onValueChange:l,children:k.jsx(ED,{...a,ref:t})})});MQ.displayName=RQ;var PQ="MenuRadioItem",OQ=B.forwardRef((e,t)=>{const{value:n,...r}=e,a=dbe(PQ,e.__scopeMenu),l=n===a.value;return k.jsx(LQ,{scope:e.__scopeMenu,checked:l,children:k.jsx(zk,{role:"menuitemradio","aria-checked":l,...r,ref:t,"data-state":CD(l),onSelect:Zs(r.onSelect,()=>{var f;return(f=a.onValueChange)==null?void 0:f.call(a,n)},{checkForDefaultPrevented:!1})})})});OQ.displayName=PQ;var SD="MenuItemIndicator",[LQ,hbe]=H_(SD,{checked:!1}),DQ=B.forwardRef((e,t)=>{const{__scopeMenu:n,forceMount:r,...a}=e,l=hbe(SD,n);return k.jsx($_,{present:r||PC(l.checked)||l.checked===!0,children:k.jsx(Ql.span,{...a,ref:t,"data-state":CD(l.checked)})})});DQ.displayName=SD;var fbe="MenuSeparator",NQ=B.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return k.jsx(Ql.div,{role:"separator","aria-orientation":"horizontal",...r,ref:t})});NQ.displayName=fbe;var pbe="MenuArrow",zQ=B.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,a=nE(n);return k.jsx(HK,{...a,...r,ref:t})});zQ.displayName=pbe;var AD="MenuSub",[mbe,FQ]=H_(AD),BQ=e=>{const{__scopeMenu:t,children:n,open:r=!1,onOpenChange:a}=e,l=j0(AD,t),f=nE(t),[i,y]=B.useState(null),[x,S]=B.useState(null),C=bf(a);return B.useEffect(()=>(l.open===!1&&C(!1),()=>C(!1)),[l.open,C]),k.jsx(gD,{...f,children:k.jsx(wQ,{scope:t,open:r,onOpenChange:C,content:x,onContentChange:S,children:k.jsx(mbe,{scope:t,contentId:lx(),triggerId:lx(),trigger:i,onTriggerChange:y,children:n})})})};BQ.displayName=AD;var y2="MenuSubTrigger",jQ=B.forwardRef((e,t)=>{const n=j0(y2,e.__scopeMenu),r=rE(y2,e.__scopeMenu),a=FQ(y2,e.__scopeMenu),l=wD(y2,e.__scopeMenu),f=B.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:y}=l,x={__scopeMenu:e.__scopeMenu},S=B.useCallback(()=>{f.current&&window.clearTimeout(f.current),f.current=null},[]);return B.useEffect(()=>S,[S]),B.useEffect(()=>{const C=i.current;return()=>{window.clearTimeout(C),y(null)}},[i,y]),k.jsx(xD,{asChild:!0,...x,children:k.jsx(kQ,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":a.contentId,"data-state":$Q(n.open),...e,ref:V_(t,a.onTriggerChange),onClick:C=>{var P;(P=e.onClick)==null||P.call(e,C),!(e.disabled||C.defaultPrevented)&&(C.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:Zs(e.onPointerMove,TT(C=>{l.onItemEnter(C),!C.defaultPrevented&&!e.disabled&&!n.open&&!f.current&&(l.onPointerGraceIntentChange(null),f.current=window.setTimeout(()=>{n.onOpenChange(!0),S()},100))})),onPointerLeave:Zs(e.onPointerLeave,TT(C=>{var L,F;S();const P=(L=n.content)==null?void 0:L.getBoundingClientRect();if(P){const U=(F=n.content)==null?void 0:F.dataset.side,q=U==="right",G=q?-5:5,$=P[q?"left":"right"],X=P[q?"right":"left"];l.onPointerGraceIntentChange({area:[{x:C.clientX+G,y:C.clientY},{x:$,y:P.top},{x:X,y:P.top},{x:X,y:P.bottom},{x:$,y:P.bottom}],side:U}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>l.onPointerGraceIntentChange(null),300)}else{if(l.onTriggerLeave(C),C.defaultPrevented)return;l.onPointerGraceIntentChange(null)}})),onKeyDown:Zs(e.onKeyDown,C=>{var L;const P=l.searchRef.current!=="";e.disabled||P&&C.key===" "||Yxe[r.dir].includes(C.key)&&(n.onOpenChange(!0),(L=n.content)==null||L.focus(),C.preventDefault())})})})});jQ.displayName=y2;var UQ="MenuSubContent",VQ=B.forwardRef((e,t)=>{const n=EQ(xd,e.__scopeMenu),{forceMount:r=n.forceMount,...a}=e,l=j0(xd,e.__scopeMenu),f=rE(xd,e.__scopeMenu),i=FQ(UQ,e.__scopeMenu),y=B.useRef(null),x=hu(t,y);return k.jsx(wT.Provider,{scope:e.__scopeMenu,children:k.jsx($_,{present:r||l.open,children:k.jsx(wT.Slot,{scope:e.__scopeMenu,children:k.jsx(TD,{id:i.contentId,"aria-labelledby":i.triggerId,...a,ref:x,align:"start",side:f.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:S=>{var C;f.isUsingKeyboardRef.current&&((C=y.current)==null||C.focus()),S.preventDefault()},onCloseAutoFocus:S=>S.preventDefault(),onFocusOutside:Zs(e.onFocusOutside,S=>{S.target!==i.trigger&&l.onOpenChange(!1)}),onEscapeKeyDown:Zs(e.onEscapeKeyDown,S=>{f.onClose(),S.preventDefault()}),onKeyDown:Zs(e.onKeyDown,S=>{var L;const C=S.currentTarget.contains(S.target),P=Kxe[f.dir].includes(S.key);C&&P&&(l.onOpenChange(!1),(L=i.trigger)==null||L.focus(),S.preventDefault())})})})})})});VQ.displayName=UQ;function $Q(e){return e?"open":"closed"}function PC(e){return e==="indeterminate"}function CD(e){return PC(e)?"indeterminate":e?"checked":"unchecked"}function gbe(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function _be(e,t){return e.map((n,r)=>e[(t+r)%e.length])}function ybe(e,t,n){const a=t.length>1&&Array.from(t).every(x=>x===t[0])?t[0]:t,l=n?e.indexOf(n):-1;let f=_be(e,Math.max(l,0));a.length===1&&(f=f.filter(x=>x!==n));const y=f.find(x=>x.toLowerCase().startsWith(a.toLowerCase()));return y!==n?y:void 0}function vbe(e,t){const{x:n,y:r}=e;let a=!1;for(let l=0,f=t.length-1;l<t.length;f=l++){const i=t[l],y=t[f],x=i.x,S=i.y,C=y.x,P=y.y;S>r!=P>r&&n<(C-x)*(r-S)/(P-S)+x&&(a=!a)}return a}function xbe(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return vbe(n,t)}function TT(e){return t=>t.pointerType==="mouse"?e(t):void 0}var bbe=TQ,wbe=xD,Tbe=SQ,Ebe=AQ,Sbe=ED,Abe=CQ,Cbe=zk,kbe=IQ,Ibe=MQ,Rbe=OQ,Mbe=DQ,Pbe=NQ,Obe=zQ,Lbe=BQ,Dbe=jQ,Nbe=VQ,Fk="DropdownMenu",[zbe]=Rx(Fk,[xQ]),fu=xQ(),[Fbe,HQ]=zbe(Fk),GQ=e=>{const{__scopeDropdownMenu:t,children:n,dir:r,open:a,defaultOpen:l,onOpenChange:f,modal:i=!0}=e,y=fu(t),x=B.useRef(null),[S,C]=Ok({prop:a,defaultProp:l??!1,onChange:f,caller:Fk});return k.jsx(Fbe,{scope:t,triggerId:lx(),triggerRef:x,contentId:lx(),open:S,onOpenChange:C,onOpenToggle:B.useCallback(()=>C(P=>!P),[C]),modal:i,children:k.jsx(bbe,{...y,open:S,onOpenChange:C,dir:r,modal:i,children:n})})};GQ.displayName=Fk;var qQ="DropdownMenuTrigger",ZQ=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...a}=e,l=HQ(qQ,n),f=fu(n);return k.jsx(wbe,{asChild:!0,...f,children:k.jsx(Ql.button,{type:"button",id:l.triggerId,"aria-haspopup":"menu","aria-expanded":l.open,"aria-controls":l.open?l.contentId:void 0,"data-state":l.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...a,ref:V_(t,l.triggerRef),onPointerDown:Zs(e.onPointerDown,i=>{!r&&i.button===0&&i.ctrlKey===!1&&(l.onOpenToggle(),l.open||i.preventDefault())}),onKeyDown:Zs(e.onKeyDown,i=>{r||(["Enter"," "].includes(i.key)&&l.onOpenToggle(),i.key==="ArrowDown"&&l.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});ZQ.displayName=qQ;var Bbe="DropdownMenuPortal",WQ=e=>{const{__scopeDropdownMenu:t,...n}=e,r=fu(t);return k.jsx(Tbe,{...r,...n})};WQ.displayName=Bbe;var XQ="DropdownMenuContent",YQ=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=HQ(XQ,n),l=fu(n),f=B.useRef(!1);return k.jsx(Ebe,{id:a.contentId,"aria-labelledby":a.triggerId,...l,...r,ref:t,onCloseAutoFocus:Zs(e.onCloseAutoFocus,i=>{var y;f.current||(y=a.triggerRef.current)==null||y.focus(),f.current=!1,i.preventDefault()}),onInteractOutside:Zs(e.onInteractOutside,i=>{const y=i.detail.originalEvent,x=y.button===0&&y.ctrlKey===!0,S=y.button===2||x;(!a.modal||S)&&(f.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});YQ.displayName=XQ;var jbe="DropdownMenuGroup",Ube=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=fu(n);return k.jsx(Sbe,{...a,...r,ref:t})});Ube.displayName=jbe;var Vbe="DropdownMenuLabel",$be=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=fu(n);return k.jsx(Abe,{...a,...r,ref:t})});$be.displayName=Vbe;var Hbe="DropdownMenuItem",KQ=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=fu(n);return k.jsx(Cbe,{...a,...r,ref:t})});KQ.displayName=Hbe;var Gbe="DropdownMenuCheckboxItem",qbe=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=fu(n);return k.jsx(kbe,{...a,...r,ref:t})});qbe.displayName=Gbe;var Zbe="DropdownMenuRadioGroup",Wbe=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=fu(n);return k.jsx(Ibe,{...a,...r,ref:t})});Wbe.displayName=Zbe;var Xbe="DropdownMenuRadioItem",Ybe=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=fu(n);return k.jsx(Rbe,{...a,...r,ref:t})});Ybe.displayName=Xbe;var Kbe="DropdownMenuItemIndicator",Qbe=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=fu(n);return k.jsx(Mbe,{...a,...r,ref:t})});Qbe.displayName=Kbe;var Jbe="DropdownMenuSeparator",QQ=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=fu(n);return k.jsx(Pbe,{...a,...r,ref:t})});QQ.displayName=Jbe;var ewe="DropdownMenuArrow",twe=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=fu(n);return k.jsx(Obe,{...a,...r,ref:t})});twe.displayName=ewe;var nwe=e=>{const{__scopeDropdownMenu:t,children:n,open:r,onOpenChange:a,defaultOpen:l}=e,f=fu(t),[i,y]=Ok({prop:r,defaultProp:l??!1,onChange:a,caller:"DropdownMenuSub"});return k.jsx(Lbe,{...f,open:i,onOpenChange:y,children:n})},rwe="DropdownMenuSubTrigger",JQ=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=fu(n);return k.jsx(Dbe,{...a,...r,ref:t})});JQ.displayName=rwe;var iwe="DropdownMenuSubContent",eJ=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=fu(n);return k.jsx(Nbe,{...a,...r,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});eJ.displayName=iwe;var swe=GQ,awe=ZQ,owe=WQ,lwe=YQ,uwe=KQ,cwe=QQ,dwe=nwe,hwe=JQ,fwe=eJ;const pwe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),iE=function(e){if(e==null)return ywe;if(typeof e=="function")return Bk(e);if(typeof e=="object")return Array.isArray(e)?mwe(e):gwe(e);if(typeof e=="string")return _we(e);throw new Error("Expected function, string, or object as test")};function mwe(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=iE(e[n]);return Bk(r);function r(...a){let l=-1;for(;++l<t.length;)if(t[l].apply(this,a))return!0;return!1}}function gwe(e){const t=e;return Bk(n);function n(r){const a=r;let l;for(l in e)if(a[l]!==t[l])return!1;return!0}}function _we(e){return Bk(t);function t(n){return n&&n.type===e}}function Bk(e){return t;function t(n,r,a){return!!(vwe(n)&&e.call(this,n,typeof r=="number"?r:void 0,a||void 0))}}function ywe(){return!0}function vwe(e){return e!==null&&typeof e=="object"&&"type"in e}const tJ=[],v2=!0,OO=!1,OC="skip";function Ox(e,t,n,r){let a;typeof t=="function"&&typeof n!="function"?(r=n,n=t):a=t;const l=iE(a),f=r?-1:1;i(e,void 0,[])();function i(y,x,S){const C=y&&typeof y=="object"?y:{};if(typeof C.type=="string"){const L=typeof C.tagName=="string"?C.tagName:typeof C.name=="string"?C.name:void 0;Object.defineProperty(P,"name",{value:"node ("+(y.type+(L?"<"+L+">":""))+")"})}return P;function P(){let L=tJ,F,U,q;if((!t||l(y,x,S[S.length-1]||void 0))&&(L=xwe(n(y,S)),L[0]===OO))return L;if("children"in y&&y.children){const G=y;if(G.children&&L[0]!==OC)for(U=(r?G.children.length:-1)+f,q=S.concat(G);U>-1&&U<G.children.length;){const $=G.children[U];if(F=i($,U,q)(),F[0]===OO)return F;U=typeof F[1]=="number"?F[1]:U+f}}return L}}}function xwe(e){return Array.isArray(e)?e:typeof e=="number"?[v2,e]:e==null?tJ:[e]}function LO(e,t,n,r){let a,l,f;typeof t=="function"&&typeof n!="function"?(l=void 0,f=t,a=n):(l=t,f=n,a=r),Ox(e,l,i,a);function i(y,x){const S=x[x.length-1],C=S?S.children.indexOf(y):void 0;return f(y,C,S)}}function bwe({defaultOrigin:e="",allowedLinkPrefixes:t=[],allowedImagePrefixes:n=[],allowDataImages:r=!1,allowedProtocols:a=[],blockedImageClass:l="inline-block bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-3 py-1 rounded text-sm",blockedLinkClass:f="text-gray-500"}){const i=t.length&&!t.every(x=>x==="*"),y=n.length&&!n.every(x=>x==="*");if(!e&&(i||y))throw new Error("defaultOrigin is required when allowedLinkPrefixes or allowedImagePrefixes are provided");return x=>{const S=Swe(e,t,n,r,a,l,f);LO(x,S)}}function WV(e,t){if(typeof e!="string")return null;try{return new URL(e)}catch{if(t)try{return new URL(e,t)}catch{return null}if(e.startsWith("/")||e.startsWith("./")||e.startsWith("../"))try{return new URL(e,"http://example.com")}catch{return null}return null}}function wwe(e){return typeof e!="string"?!1:e.startsWith("/")||e.startsWith("./")||e.startsWith("../")}const Twe=new Set(["https:","http:","irc:","ircs:","mailto:","xmpp:","blob:"]),Ewe=new Set(["javascript:","data:","file:","vbscript:"]);function XV(e,t,n,r=!1,a=!1,l=[]){if(!e)return null;if(typeof e=="string"&&e.startsWith("#")&&!a)try{if(new URL(e,"http://example.com").hash===e)return e}catch{}if(typeof e=="string"&&e.startsWith("data:"))return a&&r&&e.startsWith("data:image/")?e:null;if(typeof e=="string"&&e.startsWith("blob:")){try{if(new URL(e).protocol==="blob:"&&e.length>5){const S=e.substring(5);if(S&&S.length>0&&S!=="invalid")return e}}catch{return null}return null}const f=WV(e,n);if(!f||Ewe.has(f.protocol)||!(Twe.has(f.protocol)||l.includes(f.protocol)||l.includes("*")))return null;if(f.protocol==="mailto:"||!f.protocol.match(/^https?:$/))return f.href;const y=wwe(e);return f&&t.some(x=>{const S=WV(x,n);return!S||S.origin!==f.origin?!1:f.href.startsWith(S.href)})?y?f.pathname+f.search+f.hash:f.href:t.includes("*")?f.protocol!=="https:"&&f.protocol!=="http:"?null:y?f.pathname+f.search+f.hash:f.href:null}const fR=Symbol("node-seen"),Swe=(e,t,n,r,a,l,f)=>{const i=(y,x,S)=>{if(y.type!=="element"||y[fR])return v2;if(y.tagName==="a"){const C=XV(y.properties.href,t,e,!1,!1,a);return C===null?(y[fR]=!0,LO(y,i),S&&typeof x=="number"&&(S.children[x]={type:"element",tagName:"span",properties:{title:"Blocked URL: "+String(y.properties.href),class:f},children:[...y.children,{type:"text",value:" [blocked]"}]}),OC):(y.properties.href=C,y.properties.target="_blank",y.properties.rel="noopener noreferrer",v2)}if(y.tagName==="img"){const C=XV(y.properties.src,n,e,r,!0,a);return C===null?(y[fR]=!0,LO(y,i),S&&typeof x=="number"&&(S.children[x]={type:"element",tagName:"span",properties:{class:l},children:[{type:"text",value:"[Image blocked: "+String(y.properties.alt||"No description")+"]"}]}),OC):(y.properties.src=C,v2)}return v2};return i};let sE=class{constructor(t,n,r){this.normal=n,this.property=t,r&&(this.space=r)}};sE.prototype.normal={};sE.prototype.property={};sE.prototype.space=void 0;function nJ(e,t){const n={},r={};for(const a of e)Object.assign(n,a.property),Object.assign(r,a.normal);return new sE(n,r,t)}function ET(e){return e.toLowerCase()}let hc=class{constructor(t,n){this.attribute=n,this.property=t}};hc.prototype.attribute="";hc.prototype.booleanish=!1;hc.prototype.boolean=!1;hc.prototype.commaOrSpaceSeparated=!1;hc.prototype.commaSeparated=!1;hc.prototype.defined=!1;hc.prototype.mustUseProperty=!1;hc.prototype.number=!1;hc.prototype.overloadedBoolean=!1;hc.prototype.property="";hc.prototype.spaceSeparated=!1;hc.prototype.space=void 0;let Awe=0;const Bs=G_(),ul=G_(),DO=G_(),ur=G_(),oo=G_(),Ev=G_(),kc=G_();function G_(){return 2**++Awe}const NO=Object.freeze(Object.defineProperty({__proto__:null,boolean:Bs,booleanish:ul,commaOrSpaceSeparated:kc,commaSeparated:Ev,number:ur,overloadedBoolean:DO,spaceSeparated:oo},Symbol.toStringTag,{value:"Module"})),pR=Object.keys(NO);let kD=class extends hc{constructor(t,n,r,a){let l=-1;if(super(t,n),YV(this,"space",a),typeof r=="number")for(;++l<pR.length;){const f=pR[l];YV(this,pR[l],(r&NO[f])===NO[f])}}};kD.prototype.defined=!0;function YV(e,t,n){n&&(e[t]=n)}function Lx(e){const t={},n={};for(const[r,a]of Object.entries(e.properties)){const l=new kD(r,e.transform(e.attributes||{},r),a,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(l.mustUseProperty=!0),t[r]=l,n[ET(r)]=r,n[ET(l.attribute)]=r}return new sE(t,n,e.space)}const rJ=Lx({properties:{ariaActiveDescendant:null,ariaAtomic:ul,ariaAutoComplete:null,ariaBusy:ul,ariaChecked:ul,ariaColCount:ur,ariaColIndex:ur,ariaColSpan:ur,ariaControls:oo,ariaCurrent:null,ariaDescribedBy:oo,ariaDetails:null,ariaDisabled:ul,ariaDropEffect:oo,ariaErrorMessage:null,ariaExpanded:ul,ariaFlowTo:oo,ariaGrabbed:ul,ariaHasPopup:null,ariaHidden:ul,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:oo,ariaLevel:ur,ariaLive:null,ariaModal:ul,ariaMultiLine:ul,ariaMultiSelectable:ul,ariaOrientation:null,ariaOwns:oo,ariaPlaceholder:null,ariaPosInSet:ur,ariaPressed:ul,ariaReadOnly:ul,ariaRelevant:null,ariaRequired:ul,ariaRoleDescription:oo,ariaRowCount:ur,ariaRowIndex:ur,ariaRowSpan:ur,ariaSelected:ul,ariaSetSize:ur,ariaSort:null,ariaValueMax:ur,ariaValueMin:ur,ariaValueNow:ur,ariaValueText:null,role:null},transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function iJ(e,t){return t in e?e[t]:t}function sJ(e,t){return iJ(e,t.toLowerCase())}const Cwe=Lx({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Ev,acceptCharset:oo,accessKey:oo,action:null,allow:null,allowFullScreen:Bs,allowPaymentRequest:Bs,allowUserMedia:Bs,alt:null,as:null,async:Bs,autoCapitalize:null,autoComplete:oo,autoFocus:Bs,autoPlay:Bs,blocking:oo,capture:null,charSet:null,checked:Bs,cite:null,className:oo,cols:ur,colSpan:null,content:null,contentEditable:ul,controls:Bs,controlsList:oo,coords:ur|Ev,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Bs,defer:Bs,dir:null,dirName:null,disabled:Bs,download:DO,draggable:ul,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Bs,formTarget:null,headers:oo,height:ur,hidden:DO,high:ur,href:null,hrefLang:null,htmlFor:oo,httpEquiv:oo,id:null,imageSizes:null,imageSrcSet:null,inert:Bs,inputMode:null,integrity:null,is:null,isMap:Bs,itemId:null,itemProp:oo,itemRef:oo,itemScope:Bs,itemType:oo,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Bs,low:ur,manifest:null,max:null,maxLength:ur,media:null,method:null,min:null,minLength:ur,multiple:Bs,muted:Bs,name:null,nonce:null,noModule:Bs,noValidate:Bs,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Bs,optimum:ur,pattern:null,ping:oo,placeholder:null,playsInline:Bs,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Bs,referrerPolicy:null,rel:oo,required:Bs,reversed:Bs,rows:ur,rowSpan:ur,sandbox:oo,scope:null,scoped:Bs,seamless:Bs,selected:Bs,shadowRootClonable:Bs,shadowRootDelegatesFocus:Bs,shadowRootMode:null,shape:null,size:ur,sizes:null,slot:null,span:ur,spellCheck:ul,src:null,srcDoc:null,srcLang:null,srcSet:null,start:ur,step:null,style:null,tabIndex:ur,target:null,title:null,translate:null,type:null,typeMustMatch:Bs,useMap:null,value:ul,width:ur,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:oo,axis:null,background:null,bgColor:null,border:ur,borderColor:null,bottomMargin:ur,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Bs,declare:Bs,event:null,face:null,frame:null,frameBorder:null,hSpace:ur,leftMargin:ur,link:null,longDesc:null,lowSrc:null,marginHeight:ur,marginWidth:ur,noResize:Bs,noHref:Bs,noShade:Bs,noWrap:Bs,object:null,profile:null,prompt:null,rev:null,rightMargin:ur,rules:null,scheme:null,scrolling:ul,standby:null,summary:null,text:null,topMargin:ur,valueType:null,version:null,vAlign:null,vLink:null,vSpace:ur,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Bs,disableRemotePlayback:Bs,prefix:null,property:null,results:ur,security:null,unselectable:null},space:"html",transform:sJ}),kwe=Lx({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:kc,accentHeight:ur,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:ur,amplitude:ur,arabicForm:null,ascent:ur,attributeName:null,attributeType:null,azimuth:ur,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:ur,by:null,calcMode:null,capHeight:ur,className:oo,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:ur,diffuseConstant:ur,direction:null,display:null,dur:null,divisor:ur,dominantBaseline:null,download:Bs,dx:null,dy:null,edgeMode:null,editable:null,elevation:ur,enableBackground:null,end:null,event:null,exponent:ur,externalResourcesRequired:null,fill:null,fillOpacity:ur,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Ev,g2:Ev,glyphName:Ev,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:ur,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:ur,horizOriginX:ur,horizOriginY:ur,id:null,ideographic:ur,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:ur,k:ur,k1:ur,k2:ur,k3:ur,k4:ur,kernelMatrix:kc,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:ur,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:ur,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:ur,overlineThickness:ur,paintOrder:null,panose1:null,path:null,pathLength:ur,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:oo,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:ur,pointsAtY:ur,pointsAtZ:ur,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:kc,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:kc,rev:kc,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:kc,requiredFeatures:kc,requiredFonts:kc,requiredFormats:kc,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:ur,specularExponent:ur,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:ur,strikethroughThickness:ur,string:null,stroke:null,strokeDashArray:kc,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:ur,strokeOpacity:ur,strokeWidth:null,style:null,surfaceScale:ur,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:kc,tabIndex:ur,tableValues:null,target:null,targetX:ur,targetY:ur,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:kc,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:ur,underlineThickness:ur,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:ur,values:null,vAlphabetic:ur,vMathematical:ur,vectorEffect:null,vHanging:ur,vIdeographic:ur,version:null,vertAdvY:ur,vertOriginX:ur,vertOriginY:ur,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:ur,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:iJ}),aJ=Lx({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()}}),oJ=Lx({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:sJ}),lJ=Lx({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()}}),Iwe=/[A-Z]/g,KV=/-[a-z]/g,Rwe=/^data[-\w.:]+$/i;function Mwe(e,t){const n=ET(t);let r=t,a=hc;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&Rwe.test(t)){if(t.charAt(4)==="-"){const l=t.slice(5).replace(KV,Owe);r="data"+l.charAt(0).toUpperCase()+l.slice(1)}else{const l=t.slice(4);if(!KV.test(l)){let f=l.replace(Iwe,Pwe);f.charAt(0)!=="-"&&(f="-"+f),t="data"+f}}a=kD}return new a(r,t)}function Pwe(e){return"-"+e.toLowerCase()}function Owe(e){return e.charAt(1).toUpperCase()}const Lwe=nJ([rJ,Cwe,aJ,oJ,lJ],"html"),Dwe=nJ([rJ,kwe,aJ,oJ,lJ],"svg"),QV=/[#.]/g;function Nwe(e,t){const n=e||"",r={};let a=0,l,f;for(;a<n.length;){QV.lastIndex=a;const i=QV.exec(n),y=n.slice(a,i?i.index:n.length);y&&(l?l==="#"?r.id=y:Array.isArray(r.className)?r.className.push(y):r.className=[y]:f=y,a+=y.length),i&&(l=i[0],a++)}return{type:"element",tagName:f||t||"div",properties:r,children:[]}}function uJ(e,t,n){const r=n?jwe(n):void 0;function a(l,f,...i){let y;if(l==null){y={type:"root",children:[]};const x=f;i.unshift(x)}else{y=Nwe(l,t);const x=y.tagName.toLowerCase(),S=r?r.get(x):void 0;if(y.tagName=S||x,zwe(f))i.unshift(f);else for(const[C,P]of Object.entries(f))Fwe(e,y.properties,C,P)}for(const x of i)zO(y.children,x);return y.type==="element"&&y.tagName==="template"&&(y.content={type:"root",children:y.children},y.children=[]),y}return a}function zwe(e){if(e===null||typeof e!="object"||Array.isArray(e))return!0;if(typeof e.type!="string")return!1;const t=e,n=Object.keys(e);for(const r of n){const a=t[r];if(a&&typeof a=="object"){if(!Array.isArray(a))return!0;const l=a;for(const f of l)if(typeof f!="number"&&typeof f!="string")return!0}}return!!("children"in e&&Array.isArray(e.children))}function Fwe(e,t,n,r){const a=Mwe(e,n);let l;if(r!=null){if(typeof r=="number"){if(Number.isNaN(r))return;l=r}else typeof r=="boolean"?l=r:typeof r=="string"?a.spaceSeparated?l=JA(r):a.commaSeparated?l=eC(r):a.commaOrSpaceSeparated?l=JA(eC(r).join(" ")):l=JV(a,a.property,r):Array.isArray(r)?l=[...r]:l=a.property==="style"?Bwe(r):String(r);if(Array.isArray(l)){const f=[];for(const i of l)f.push(JV(a,a.property,i));l=f}a.property==="className"&&Array.isArray(t.className)&&(l=t.className.concat(l)),t[a.property]=l}}function zO(e,t){if(t!=null)if(typeof t=="number"||typeof t=="string")e.push({type:"text",value:String(t)});else if(Array.isArray(t))for(const n of t)zO(e,n);else if(typeof t=="object"&&"type"in t)t.type==="root"?zO(e,t.children):e.push(t);else throw new Error("Expected node, nodes, or string, got `"+t+"`")}function JV(e,t,n){if(typeof n=="string"){if(e.number&&n&&!Number.isNaN(Number(n)))return Number(n);if((e.boolean||e.overloadedBoolean)&&(n===""||ET(n)===ET(t)))return!0}return n}function Bwe(e){const t=[];for(const[n,r]of Object.entries(e))t.push([n,r].join(": "));return t.join("; ")}function jwe(e){const t=new Map;for(const n of e)t.set(n.toLowerCase(),n);return t}const Uwe=["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","solidColor","textArea","textPath"],Vwe=uJ(Lwe,"div"),$we=uJ(Dwe,"g",Uwe),df={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Hwe(e,t){return cJ(e,{})||{type:"root",children:[]}}function cJ(e,t){const n=Gwe(e,t);return n&&t.afterTransform&&t.afterTransform(e,n),n}function Gwe(e,t){switch(e.nodeType){case 1:return Xwe(e,t);case 3:return Zwe(e);case 8:return Wwe(e);case 9:return e$(e,t);case 10:return qwe();case 11:return e$(e,t);default:return}}function e$(e,t){return{type:"root",children:dJ(e,t)}}function qwe(){return{type:"doctype"}}function Zwe(e){return{type:"text",value:e.nodeValue||""}}function Wwe(e){return{type:"comment",value:e.nodeValue||""}}function Xwe(e,t){const n=e.namespaceURI,r=n===df.svg?$we:Vwe,a=n===df.html?e.tagName.toLowerCase():e.tagName,l=n===df.html&&a==="template"?e.content:e,f=e.getAttributeNames(),i={};let y=-1;for(;++y<f.length;)i[f[y]]=e.getAttribute(f[y])||"";return r(a,i,dJ(l,t))}function dJ(e,t){const n=e.childNodes,r=[];let a=-1;for(;++a<n.length;){const l=cJ(n[a],t);l!==void 0&&r.push(l)}return r}new DOMParser;function Ywe(e,t){const n=Kwe(e);return Hwe(n)}function Kwe(e){const t=document.createElement("template");return t.innerHTML=e,t.content}const t$=function(e,t,n){const r=iE(n);if(!e||!e.type||!e.children)throw new Error("Expected parent node");if(typeof t=="number"){if(t<0||t===Number.POSITIVE_INFINITY)throw new Error("Expected positive finite number as index")}else if(t=e.children.indexOf(t),t<0)throw new Error("Expected child node or index");for(;++t<e.children.length;)if(r(e.children[t],t,e))return e.children[t]},q_=function(e){if(e==null)return e2e;if(typeof e=="string")return Jwe(e);if(typeof e=="object")return Qwe(e);if(typeof e=="function")return ID(e);throw new Error("Expected function, string, or array as `test`")};function Qwe(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=q_(e[n]);return ID(r);function r(...a){let l=-1;for(;++l<t.length;)if(t[l].apply(this,a))return!0;return!1}}function Jwe(e){return ID(t);function t(n){return n.tagName===e}}function ID(e){return t;function t(n,r,a){return!!(t2e(n)&&e.call(this,n,typeof r=="number"?r:void 0,a||void 0))}}function e2e(e){return!!(e&&typeof e=="object"&&"type"in e&&e.type==="element"&&"tagName"in e&&typeof e.tagName=="string")}function t2e(e){return e!==null&&typeof e=="object"&&"type"in e&&"tagName"in e}const n$=/\n/g,r$=/[\t ]+/g,FO=q_("br"),i$=q_(u2e),n2e=q_("p"),s$=q_("tr"),r2e=q_(["datalist","head","noembed","noframes","noscript","rp","script","style","template","title",l2e,c2e]),hJ=q_(["address","article","aside","blockquote","body","caption","center","dd","dialog","dir","dl","dt","div","figure","figcaption","footer","form,","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","legend","li","listing","main","menu","nav","ol","p","plaintext","pre","section","ul","xmp"]);function i2e(e,t){const n=t||{},r="children"in e?e.children:[],a=hJ(e),l=mJ(e,{whitespace:n.whitespace||"normal"}),f=[];(e.type==="text"||e.type==="comment")&&f.push(...pJ(e,{breakBefore:!0,breakAfter:!0}));let i=-1;for(;++i<r.length;)f.push(...fJ(r[i],e,{whitespace:l,breakBefore:i?void 0:a,breakAfter:i<r.length-1?FO(r[i+1]):a}));const y=[];let x;for(i=-1;++i<f.length;){const S=f[i];typeof S=="number"?x!==void 0&&S>x&&(x=S):S&&(x!==void 0&&x>-1&&y.push(`
`.repeat(x)||" "),x=-1,y.push(S))}return y.join("")}function fJ(e,t,n){return e.type==="element"?s2e(e,t,n):e.type==="text"?n.whitespace==="normal"?pJ(e,n):a2e(e):[]}function s2e(e,t,n){const r=mJ(e,n),a=e.children||[];let l=-1,f=[];if(r2e(e))return f;let i,y;for(FO(e)||s$(e)&&t$(t,e,s$)?y=`
`:n2e(e)?(i=2,y=2):hJ(e)&&(i=1,y=1);++l<a.length;)f=f.concat(fJ(a[l],e,{whitespace:r,breakBefore:l?void 0:i,breakAfter:l<a.length-1?FO(a[l+1]):y}));return i$(e)&&t$(t,e,i$)&&f.push("	"),i&&f.unshift(i),y&&f.push(y),f}function pJ(e,t){const n=String(e.value),r=[],a=[];let l=0;for(;l<=n.length;){n$.lastIndex=l;const y=n$.exec(n),x=y&&"index"in y?y.index:n.length;r.push(o2e(n.slice(l,x).replace(/[\u061C\u200E\u200F\u202A-\u202E\u2066-\u2069]/g,""),l===0?t.breakBefore:!0,x===n.length?t.breakAfter:!0)),l=x+1}let f=-1,i;for(;++f<r.length;)r[f].charCodeAt(r[f].length-1)===8203||f<r.length-1&&r[f+1].charCodeAt(0)===8203?(a.push(r[f]),i=void 0):r[f]?(typeof i=="number"&&a.push(i),a.push(r[f]),i=0):(f===0||f===r.length-1)&&a.push(0);return a}function a2e(e){return[String(e.value)]}function o2e(e,t,n){const r=[];let a=0,l;for(;a<e.length;){r$.lastIndex=a;const f=r$.exec(e);l=f?f.index:e.length,!a&&!l&&f&&!t&&r.push(""),a!==l&&r.push(e.slice(a,l)),a=f?l+f[0].length:l}return a!==l&&!n&&r.push(""),r.join(" ")}function mJ(e,t){if(e.type==="element"){const n=e.properties||{};switch(e.tagName){case"listing":case"plaintext":case"xmp":return"pre";case"nobr":return"nowrap";case"pre":return n.wrap?"pre-wrap":"pre";case"td":case"th":return n.noWrap?"nowrap":t.whitespace;case"textarea":return"pre-wrap"}}return t.whitespace}function l2e(e){return!!(e.properties||{}).hidden}function u2e(e){return e.tagName==="td"||e.tagName==="th"}function c2e(e){return e.tagName==="dialog"&&!(e.properties||{}).open}class rc{constructor(t,n,r){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=t,this.start=n,this.end=r}static range(t,n){return n?!t||!t.loc||!n.loc||t.loc.lexer!==n.loc.lexer?null:new rc(t.loc.lexer,t.loc.start,n.loc.end):t&&t.loc}}class Bc{constructor(t,n){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=t,this.loc=n}range(t,n){return new Bc(n,rc.range(this,t))}}class rr{constructor(t,n){this.name=void 0,this.position=void 0,this.length=void 0,this.rawMessage=void 0;var r="KaTeX parse error: "+t,a,l,f=n&&n.loc;if(f&&f.start<=f.end){var i=f.lexer.input;a=f.start,l=f.end,a===i.length?r+=" at end of input: ":r+=" at position "+(a+1)+": ";var y=i.slice(a,l).replace(/[^]/g,"$&"),x;a>15?x=""+i.slice(a-15,a):x=i.slice(0,a);var S;l+15<i.length?S=i.slice(l,l+15)+"":S=i.slice(l),r+=x+y+S}var C=new Error(r);return C.name="ParseError",C.__proto__=rr.prototype,C.position=a,a!=null&&l!=null&&(C.length=l-a),C.rawMessage=t,C}}rr.prototype.__proto__=Error.prototype;var d2e=function(t,n){return t===void 0?n:t},h2e=/([A-Z])/g,f2e=function(t){return t.replace(h2e,"-$1").toLowerCase()},p2e={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},m2e=/[&><"']/g;function g2e(e){return String(e).replace(m2e,t=>p2e[t])}var gJ=function e(t){return t.type==="ordgroup"||t.type==="color"?t.body.length===1?e(t.body[0]):t:t.type==="font"?e(t.body):t},_2e=function(t){var n=gJ(t);return n.type==="mathord"||n.type==="textord"||n.type==="atom"},y2e=function(t){if(!t)throw new Error("Expected non-null, but got "+String(t));return t},v2e=function(t){var n=/^[\x00-\x20]*([^\\/#?]*?)(:|&#0*58|&#x0*3a|&colon)/i.exec(t);return n?n[2]!==":"||!/^[a-zA-Z][a-zA-Z0-9+\-.]*$/.test(n[1])?null:n[1].toLowerCase():"_relative"},Na={deflt:d2e,escape:g2e,hyphenate:f2e,getBaseElem:gJ,isCharacterBox:_2e,protocolFromUrl:v2e},O2={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:e=>"#"+e},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(e,t)=>(t.push(e),t)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:e=>Math.max(0,e),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:e=>Math.max(0,e),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:e=>Math.max(0,e),cli:"-e, --max-expand <n>",cliProcessor:e=>e==="Infinity"?1/0:parseInt(e)},globalGroup:{type:"boolean",cli:!1}};function x2e(e){if(e.default)return e.default;var t=e.type,n=Array.isArray(t)?t[0]:t;if(typeof n!="string")return n.enum[0];switch(n){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class RD{constructor(t){this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,t=t||{};for(var n in O2)if(O2.hasOwnProperty(n)){var r=O2[n];this[n]=t[n]!==void 0?r.processor?r.processor(t[n]):t[n]:x2e(r)}}reportNonstrict(t,n,r){var a=this.strict;if(typeof a=="function"&&(a=a(t,n,r)),!(!a||a==="ignore")){if(a===!0||a==="error")throw new rr("LaTeX-incompatible input and strict mode is set to 'error': "+(n+" ["+t+"]"),r);a==="warn"?typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(n+" ["+t+"]")):typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+a+"': "+n+" ["+t+"]"))}}useStrictBehavior(t,n,r){var a=this.strict;if(typeof a=="function")try{a=a(t,n,r)}catch{a="error"}return!a||a==="ignore"?!1:a===!0||a==="error"?!0:a==="warn"?(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(n+" ["+t+"]")),!1):(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+a+"': "+n+" ["+t+"]")),!1)}isTrusted(t){if(t.url&&!t.protocol){var n=Na.protocolFromUrl(t.url);if(n==null)return!1;t.protocol=n}var r=typeof this.trust=="function"?this.trust(t):this.trust;return!!r}}class Em{constructor(t,n,r){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=t,this.size=n,this.cramped=r}sup(){return sf[b2e[this.id]]}sub(){return sf[w2e[this.id]]}fracNum(){return sf[T2e[this.id]]}fracDen(){return sf[E2e[this.id]]}cramp(){return sf[S2e[this.id]]}text(){return sf[A2e[this.id]]}isTight(){return this.size>=2}}var MD=0,LC=1,Sv=2,wp=3,ST=4,yd=5,dx=6,Ou=7,sf=[new Em(MD,0,!1),new Em(LC,0,!0),new Em(Sv,1,!1),new Em(wp,1,!0),new Em(ST,2,!1),new Em(yd,2,!0),new Em(dx,3,!1),new Em(Ou,3,!0)],b2e=[ST,yd,ST,yd,dx,Ou,dx,Ou],w2e=[yd,yd,yd,yd,Ou,Ou,Ou,Ou],T2e=[Sv,wp,ST,yd,dx,Ou,dx,Ou],E2e=[wp,wp,yd,yd,Ou,Ou,Ou,Ou],S2e=[LC,LC,wp,wp,yd,yd,Ou,Ou],A2e=[MD,LC,Sv,wp,Sv,wp,Sv,wp],Vi={DISPLAY:sf[MD],TEXT:sf[Sv],SCRIPT:sf[ST],SCRIPTSCRIPT:sf[dx]},BO=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}];function C2e(e){for(var t=0;t<BO.length;t++)for(var n=BO[t],r=0;r<n.blocks.length;r++){var a=n.blocks[r];if(e>=a[0]&&e<=a[1])return n.name}return null}var fA=[];BO.forEach(e=>e.blocks.forEach(t=>fA.push(...t)));function _J(e){for(var t=0;t<fA.length;t+=2)if(e>=fA[t]&&e<=fA[t+1])return!0;return!1}var G1=80,k2e=function(t,n){return"M95,"+(622+t+n)+`
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l`+t/2.075+" -"+t+`
c5.3,-9.3,12,-14,20,-14
H400000v`+(40+t)+`H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M`+(834+t)+" "+n+"h400000v"+(40+t)+"h-400000z"},I2e=function(t,n){return"M263,"+(601+t+n)+`c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l`+t/2.084+" -"+t+`
c4.7,-7.3,11,-11,19,-11
H40000v`+(40+t)+`H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M`+(1001+t)+" "+n+"h400000v"+(40+t)+"h-400000z"},R2e=function(t,n){return"M983 "+(10+t+n)+`
l`+t/3.13+" -"+t+`
c4,-6.7,10,-10,18,-10 H400000v`+(40+t)+`
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M`+(1001+t)+" "+n+"h400000v"+(40+t)+"h-400000z"},M2e=function(t,n){return"M424,"+(2398+t+n)+`
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l`+t/4.223+" -"+t+`c4,-6.7,10,-10,18,-10 H400000
v`+(40+t)+`H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M`+(1001+t)+" "+n+`
h400000v`+(40+t)+"h-400000z"},P2e=function(t,n){return"M473,"+(2713+t+n)+`
c339.3,-1799.3,509.3,-2700,510,-2702 l`+t/5.298+" -"+t+`
c3.3,-7.3,9.3,-11,18,-11 H400000v`+(40+t)+`H1017.7
s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200
c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26
s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,
606zM`+(1001+t)+" "+n+"h400000v"+(40+t)+"H1017.7z"},O2e=function(t){var n=t/2;return"M400000 "+t+" H0 L"+n+" 0 l65 45 L145 "+(t-80)+" H400000z"},L2e=function(t,n,r){var a=r-54-n-t;return"M702 "+(t+n)+"H400000"+(40+t)+`
H742v`+a+`l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1
h-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170
c-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667
219 661 l218 661zM702 `+n+"H400000v"+(40+t)+"H742z"},D2e=function(t,n,r){n=1e3*n;var a="";switch(t){case"sqrtMain":a=k2e(n,G1);break;case"sqrtSize1":a=I2e(n,G1);break;case"sqrtSize2":a=R2e(n,G1);break;case"sqrtSize3":a=M2e(n,G1);break;case"sqrtSize4":a=P2e(n,G1);break;case"sqrtTall":a=L2e(n,G1,r)}return a},N2e=function(t,n){switch(t){case"":return"M291 0 H417 V"+n+" H291z M291 0 H417 V"+n+" H291z";case"":return"M145 0 H188 V"+n+" H145z M145 0 H188 V"+n+" H145z";case"":return"M145 0 H188 V"+n+" H145z M145 0 H188 V"+n+" H145z"+("M367 0 H410 V"+n+" H367z M367 0 H410 V"+n+" H367z");case"":return"M457 0 H583 V"+n+" H457z M457 0 H583 V"+n+" H457z";case"":return"M319 0 H403 V"+n+" H319z M319 0 H403 V"+n+" H319z";case"":return"M263 0 H347 V"+n+" H263z M263 0 H347 V"+n+" H263z";case"":return"M384 0 H504 V"+n+" H384z M384 0 H504 V"+n+" H384z";case"":return"M312 0 H355 V"+n+" H312z M312 0 H355 V"+n+" H312z";case"":return"M257 0 H300 V"+n+" H257z M257 0 H300 V"+n+" H257z"+("M478 0 H521 V"+n+" H478z M478 0 H521 V"+n+" H478z");default:return""}},a$={doubleleftarrow:`M262 157
l10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3
 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28
 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5
c2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5
 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87
-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7
-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z
m8 0v40h399730v-40zm0 194v40h399730v-40z`,doublerightarrow:`M399738 392l
-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5
 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88
-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68
-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18
-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782
c-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3
-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z`,leftarrow:`M400000 241H110l3-3c68.7-52.7 113.7-120
 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8
-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247
c-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208
 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3
 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202
 l-3-3h399890zM100 241v40h399900v-40z`,leftbrace:`M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117
-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7
 5-6 9-10 13-.7 1-7.3 1-20 1H6z`,leftbraceunder:`M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z`,leftgroup:`M400000 80
H435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0
 435 0h399565z`,leftgroupunder:`M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z`,leftharpoon:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3
-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5
-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7
-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z`,leftharpoonplus:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5
 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3
-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7
-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z
m0 0v40h400000v-40z`,leftharpoondown:`M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333
 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5
 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667
-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z`,leftharpoondownplus:`M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12
 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7
-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0
v40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z`,lefthook:`M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5
-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3
-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21
 71.5 23h399859zM103 281v-40h399897v40z`,leftlinesegment:`M40 281 V428 H0 V94 H40 V241 H400000 v40z
M40 281 V428 H0 V94 H40 V241 H400000 v40z`,leftmapsto:`M40 281 V448H0V74H40V241H400000v40z
M40 281 V448H0V74H40V241H400000v40z`,leftToFrom:`M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23
-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8
c28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3
 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z`,longequal:`M0 50 h400000 v40H0z m0 194h40000v40H0z
M0 50 h400000 v40H0z m0 194h40000v40H0z`,midbrace:`M200428 334
c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14
-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7
 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11
 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z`,midbraceunder:`M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z`,oiintSize1:`M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6
-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z
m368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8
60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z`,oiintSize2:`M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8
-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z
m502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2
c0 110 84 276 504 276s502.4-166 502.4-276z`,oiiintSize1:`M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6
-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z
m525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0
85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z`,oiiintSize2:`M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8
-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z
m770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1
c0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z`,rightarrow:`M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z`,rightbrace:`M400000 542l
-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5
s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1
c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z`,rightbraceunder:`M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z`,rightgroup:`M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0
 3-1 3-3v-38c-76-158-257-219-435-219H0z`,rightgroupunder:`M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z`,rightharpoon:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3
-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2
-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58
 69.2 92 94.5zm0 0v40h399900v-40z`,rightharpoonplus:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11
-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7
 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z
m0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z`,rightharpoondown:`M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8
 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5
-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95
-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z`,rightharpoondownplus:`M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8
 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3
 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3
-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z
m0-194v40h400000v-40zm0 0v40h400000v-40z`,righthook:`M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3
 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0
-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21
 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z`,rightlinesegment:`M399960 241 V94 h40 V428 h-40 V281 H0 v-40z
M399960 241 V94 h40 V428 h-40 V281 H0 v-40z`,rightToFrom:`M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23
 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32
-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142
-167z M100 147v40h399900v-40zM0 341v40h399900v-40z`,twoheadleftarrow:`M0 167c68 40
 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69
-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3
-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19
-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101
 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z`,twoheadrightarrow:`M400000 167
c-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3
 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42
 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333
-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70
 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z`,tilde1:`M200 55.538c-77 0-168 73.953-177 73.953-3 0-7
-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0
 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0
 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128
-68.267.847-113-73.952-191-73.952z`,tilde2:`M344 55.266c-142 0-300.638 81.316-311.5 86.418
-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9
 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114
c1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751
 181.476 676 181.476c-149 0-189-126.21-332-126.21z`,tilde3:`M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457
-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0
 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697
 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696
 -338 0-409-156.573-744-156.573z`,tilde4:`M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345
-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409
 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9
 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409
 -175.236-744-175.236z`,vec:`M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z`,widehat1:`M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z`,widehat2:`M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat3:`M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat4:`M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widecheck1:`M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,
-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z`,widecheck2:`M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck3:`M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck4:`M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,baraboveleftarrow:`M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202
c4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5
c-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130
s-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47
121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6
s2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11
c0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z
M100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z`,rightarrowabovebar:`M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32
-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0
13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39
-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5
-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z`,baraboveshortleftharpoon:`M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17
c2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21
c-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40
c-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z
M0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z`,rightharpoonaboveshortbar:`M0,241 l0,40c399126,0,399993,0,399993,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z`,shortbaraboveleftharpoon:`M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,
1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,
-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z
M93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z`,shortrightharpoonabovebar:`M53,241l0,40c398570,0,399437,0,399437,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z`},z2e=function(t,n){switch(t){case"lbrack":return"M403 1759 V84 H666 V0 H319 V1759 v"+n+` v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v`+n+" v1759 h84z";case"rbrack":return"M347 1759 V0 H0 V84 H263 V1759 v"+n+` v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v`+n+" v1759 h84z";case"vert":return"M145 15 v585 v"+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+n+" v585 h43z";case"doublevert":return"M145 15 v585 v"+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+n+` v585 h43z
M367 15 v585 v`+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M410 15 H367 v585 v`+n+" v585 h43z";case"lfloor":return"M319 602 V0 H403 V602 v"+n+` v1715 h263 v84 H319z
MM319 602 V0 H403 V602 v`+n+" v1715 H319z";case"rfloor":return"M319 602 V0 H403 V602 v"+n+` v1799 H0 v-84 H319z
MM319 602 V0 H403 V602 v`+n+" v1715 H319z";case"lceil":return"M403 1759 V84 H666 V0 H319 V1759 v"+n+` v602 h84z
M403 1759 V0 H319 V1759 v`+n+" v602 h84z";case"rceil":return"M347 1759 V0 H0 V84 H263 V1759 v"+n+` v602 h84z
M347 1759 V0 h-84 V1759 v`+n+" v602 h84z";case"lparen":return`M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,`+(n+84)+`c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-`+(n+92)+`c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z`;case"rparen":return`M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,`+(n+9)+`
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-`+(n+144)+`c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z`;default:throw new Error("Unknown stretchy delimiter.")}};class aE{constructor(t){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=t,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(t){return this.classes.includes(t)}toNode(){for(var t=document.createDocumentFragment(),n=0;n<this.children.length;n++)t.appendChild(this.children[n].toNode());return t}toMarkup(){for(var t="",n=0;n<this.children.length;n++)t+=this.children[n].toMarkup();return t}toText(){var t=n=>n.toText();return this.children.map(t).join("")}}var hf={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},K3={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},o$={:"A",:"D",:"o",:"a",:"d",:"o",:"A",:"B",:"B",:"F",:"A",:"E",:"K",:"3",:"N",:"N",:"K",:"N",:"M",:"H",:"O",:"N",:"P",:"C",:"T",:"y",:"O",:"X",:"U",:"h",:"W",:"W",:"B",:"X",:"B",:"3",:"X",:"R",:"a",:"b",:"a",:"r",:"y",:"e",:"m",:"e",:"n",:"n",:"n",:"n",:"m",:"n",:"o",:"n",:"p",:"c",:"o",:"y",:"b",:"x",:"n",:"n",:"w",:"w",:"a",:"m",:"a",:"e",:"m",:"r"};function yJ(e,t){hf[e]=t}function PD(e,t,n){if(!hf[t])throw new Error("Font metrics not found for font: "+t+".");var r=e.charCodeAt(0),a=hf[t][r];if(!a&&e[0]in o$&&(r=o$[e[0]].charCodeAt(0),a=hf[t][r]),!a&&n==="text"&&_J(r)&&(a=hf[t][77]),a)return{depth:a[0],height:a[1],italic:a[2],skew:a[3],width:a[4]}}var mR={};function F2e(e){var t;if(e>=5?t=0:e>=3?t=1:t=2,!mR[t]){var n=mR[t]={cssEmPerMu:K3.quad[t]/18};for(var r in K3)K3.hasOwnProperty(r)&&(n[r]=K3[r][t])}return mR[t]}var B2e=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],l$=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],u$=function(t,n){return n.size<2?t:B2e[t-1][n.size-1]};class lp{constructor(t){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=t.style,this.color=t.color,this.size=t.size||lp.BASESIZE,this.textSize=t.textSize||this.size,this.phantom=!!t.phantom,this.font=t.font||"",this.fontFamily=t.fontFamily||"",this.fontWeight=t.fontWeight||"",this.fontShape=t.fontShape||"",this.sizeMultiplier=l$[this.size-1],this.maxSize=t.maxSize,this.minRuleThickness=t.minRuleThickness,this._fontMetrics=void 0}extend(t){var n={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);return new lp(n)}havingStyle(t){return this.style===t?this:this.extend({style:t,size:u$(this.textSize,t)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(t){return this.size===t&&this.textSize===t?this:this.extend({style:this.style.text(),size:t,textSize:t,sizeMultiplier:l$[t-1]})}havingBaseStyle(t){t=t||this.style.text();var n=u$(lp.BASESIZE,t);return this.size===n&&this.textSize===lp.BASESIZE&&this.style===t?this:this.extend({style:t,size:n})}havingBaseSizing(){var t;switch(this.style.id){case 4:case 5:t=3;break;case 6:case 7:t=1;break;default:t=6}return this.extend({style:this.style.text(),size:t})}withColor(t){return this.extend({color:t})}withPhantom(){return this.extend({phantom:!0})}withFont(t){return this.extend({font:t})}withTextFontFamily(t){return this.extend({fontFamily:t,font:""})}withTextFontWeight(t){return this.extend({fontWeight:t,font:""})}withTextFontShape(t){return this.extend({fontShape:t,font:""})}sizingClasses(t){return t.size!==this.size?["sizing","reset-size"+t.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==lp.BASESIZE?["sizing","reset-size"+this.size,"size"+lp.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=F2e(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}lp.BASESIZE=6;var jO={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:803/800,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:803/800},j2e={ex:!0,em:!0,mu:!0},vJ=function(t){return typeof t!="string"&&(t=t.unit),t in jO||t in j2e||t==="ex"},zo=function(t,n){var r;if(t.unit in jO)r=jO[t.unit]/n.fontMetrics().ptPerEm/n.sizeMultiplier;else if(t.unit==="mu")r=n.fontMetrics().cssEmPerMu;else{var a;if(n.style.isTight()?a=n.havingStyle(n.style.text()):a=n,t.unit==="ex")r=a.fontMetrics().xHeight;else if(t.unit==="em")r=a.fontMetrics().quad;else throw new rr("Invalid unit: '"+t.unit+"'");a!==n&&(r*=a.sizeMultiplier/n.sizeMultiplier)}return Math.min(t.number*r,n.maxSize)},Cr=function(t){return+t.toFixed(4)+"em"},I0=function(t){return t.filter(n=>n).join(" ")},xJ=function(t,n,r){if(this.classes=t||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=r||{},n){n.style.isTight()&&this.classes.push("mtight");var a=n.getColor();a&&(this.style.color=a)}},bJ=function(t){var n=document.createElement(t);n.className=I0(this.classes);for(var r in this.style)this.style.hasOwnProperty(r)&&(n.style[r]=this.style[r]);for(var a in this.attributes)this.attributes.hasOwnProperty(a)&&n.setAttribute(a,this.attributes[a]);for(var l=0;l<this.children.length;l++)n.appendChild(this.children[l].toNode());return n},U2e=/[\s"'>/=\x00-\x1f]/,wJ=function(t){var n="<"+t;this.classes.length&&(n+=' class="'+Na.escape(I0(this.classes))+'"');var r="";for(var a in this.style)this.style.hasOwnProperty(a)&&(r+=Na.hyphenate(a)+":"+this.style[a]+";");r&&(n+=' style="'+Na.escape(r)+'"');for(var l in this.attributes)if(this.attributes.hasOwnProperty(l)){if(U2e.test(l))throw new rr("Invalid attribute name '"+l+"'");n+=" "+l+'="'+Na.escape(this.attributes[l])+'"'}n+=">";for(var f=0;f<this.children.length;f++)n+=this.children[f].toMarkup();return n+="</"+t+">",n};class oE{constructor(t,n,r,a){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,xJ.call(this,t,r,a),this.children=n||[]}setAttribute(t,n){this.attributes[t]=n}hasClass(t){return this.classes.includes(t)}toNode(){return bJ.call(this,"span")}toMarkup(){return wJ.call(this,"span")}}class OD{constructor(t,n,r,a){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,xJ.call(this,n,a),this.children=r||[],this.setAttribute("href",t)}setAttribute(t,n){this.attributes[t]=n}hasClass(t){return this.classes.includes(t)}toNode(){return bJ.call(this,"a")}toMarkup(){return wJ.call(this,"a")}}class V2e{constructor(t,n,r){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=n,this.src=t,this.classes=["mord"],this.style=r}hasClass(t){return this.classes.includes(t)}toNode(){var t=document.createElement("img");t.src=this.src,t.alt=this.alt,t.className="mord";for(var n in this.style)this.style.hasOwnProperty(n)&&(t.style[n]=this.style[n]);return t}toMarkup(){var t='<img src="'+Na.escape(this.src)+'"'+(' alt="'+Na.escape(this.alt)+'"'),n="";for(var r in this.style)this.style.hasOwnProperty(r)&&(n+=Na.hyphenate(r)+":"+this.style[r]+";");return n&&(t+=' style="'+Na.escape(n)+'"'),t+="'/>",t}}var $2e={:"",:"",:"",:""};class Ed{constructor(t,n,r,a,l,f,i,y){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=t,this.height=n||0,this.depth=r||0,this.italic=a||0,this.skew=l||0,this.width=f||0,this.classes=i||[],this.style=y||{},this.maxFontSize=0;var x=C2e(this.text.charCodeAt(0));x&&this.classes.push(x+"_fallback"),/[]/.test(this.text)&&(this.text=$2e[this.text])}hasClass(t){return this.classes.includes(t)}toNode(){var t=document.createTextNode(this.text),n=null;this.italic>0&&(n=document.createElement("span"),n.style.marginRight=Cr(this.italic)),this.classes.length>0&&(n=n||document.createElement("span"),n.className=I0(this.classes));for(var r in this.style)this.style.hasOwnProperty(r)&&(n=n||document.createElement("span"),n.style[r]=this.style[r]);return n?(n.appendChild(t),n):t}toMarkup(){var t=!1,n="<span";this.classes.length&&(t=!0,n+=' class="',n+=Na.escape(I0(this.classes)),n+='"');var r="";this.italic>0&&(r+="margin-right:"+this.italic+"em;");for(var a in this.style)this.style.hasOwnProperty(a)&&(r+=Na.hyphenate(a)+":"+this.style[a]+";");r&&(t=!0,n+=' style="'+Na.escape(r)+'"');var l=Na.escape(this.text);return t?(n+=">",n+=l,n+="</span>",n):l}}class Op{constructor(t,n){this.children=void 0,this.attributes=void 0,this.children=t||[],this.attributes=n||{}}toNode(){var t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"svg");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&n.setAttribute(r,this.attributes[r]);for(var a=0;a<this.children.length;a++)n.appendChild(this.children[a].toNode());return n}toMarkup(){var t='<svg xmlns="http://www.w3.org/2000/svg"';for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(t+=" "+n+'="'+Na.escape(this.attributes[n])+'"');t+=">";for(var r=0;r<this.children.length;r++)t+=this.children[r].toMarkup();return t+="</svg>",t}}class R0{constructor(t,n){this.pathName=void 0,this.alternate=void 0,this.pathName=t,this.alternate=n}toNode(){var t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"path");return this.alternate?n.setAttribute("d",this.alternate):n.setAttribute("d",a$[this.pathName]),n}toMarkup(){return this.alternate?'<path d="'+Na.escape(this.alternate)+'"/>':'<path d="'+Na.escape(a$[this.pathName])+'"/>'}}class UO{constructor(t){this.attributes=void 0,this.attributes=t||{}}toNode(){var t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"line");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&n.setAttribute(r,this.attributes[r]);return n}toMarkup(){var t="<line";for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(t+=" "+n+'="'+Na.escape(this.attributes[n])+'"');return t+="/>",t}}function c$(e){if(e instanceof Ed)return e;throw new Error("Expected symbolNode but got "+String(e)+".")}function H2e(e){if(e instanceof oE)return e;throw new Error("Expected span<HtmlDomNode> but got "+String(e)+".")}var G2e={bin:1,close:1,inner:1,open:1,punct:1,rel:1},q2e={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},fo={math:{},text:{}};function se(e,t,n,r,a,l){fo[e][a]={font:t,group:n,replace:r},l&&r&&(fo[e][r]=fo[e][a])}var ce="math",qn="text",xe="main",st="ams",Io="accent-token",Kr="bin",Bu="close",Dx="inner",Ui="mathord",gl="op-token",Zc="open",jk="punct",ot="rel",Bp="spacing",At="textord";se(ce,xe,ot,"","\\equiv",!0);se(ce,xe,ot,"","\\prec",!0);se(ce,xe,ot,"","\\succ",!0);se(ce,xe,ot,"","\\sim",!0);se(ce,xe,ot,"","\\perp");se(ce,xe,ot,"","\\preceq",!0);se(ce,xe,ot,"","\\succeq",!0);se(ce,xe,ot,"","\\simeq",!0);se(ce,xe,ot,"","\\mid",!0);se(ce,xe,ot,"","\\ll",!0);se(ce,xe,ot,"","\\gg",!0);se(ce,xe,ot,"","\\asymp",!0);se(ce,xe,ot,"","\\parallel");se(ce,xe,ot,"","\\bowtie",!0);se(ce,xe,ot,"","\\smile",!0);se(ce,xe,ot,"","\\sqsubseteq",!0);se(ce,xe,ot,"","\\sqsupseteq",!0);se(ce,xe,ot,"","\\doteq",!0);se(ce,xe,ot,"","\\frown",!0);se(ce,xe,ot,"","\\ni",!0);se(ce,xe,ot,"","\\propto",!0);se(ce,xe,ot,"","\\vdash",!0);se(ce,xe,ot,"","\\dashv",!0);se(ce,xe,ot,"","\\owns");se(ce,xe,jk,".","\\ldotp");se(ce,xe,jk,"","\\cdotp");se(ce,xe,At,"#","\\#");se(qn,xe,At,"#","\\#");se(ce,xe,At,"&","\\&");se(qn,xe,At,"&","\\&");se(ce,xe,At,"","\\aleph",!0);se(ce,xe,At,"","\\forall",!0);se(ce,xe,At,"","\\hbar",!0);se(ce,xe,At,"","\\exists",!0);se(ce,xe,At,"","\\nabla",!0);se(ce,xe,At,"","\\flat",!0);se(ce,xe,At,"","\\ell",!0);se(ce,xe,At,"","\\natural",!0);se(ce,xe,At,"","\\clubsuit",!0);se(ce,xe,At,"","\\wp",!0);se(ce,xe,At,"","\\sharp",!0);se(ce,xe,At,"","\\diamondsuit",!0);se(ce,xe,At,"","\\Re",!0);se(ce,xe,At,"","\\heartsuit",!0);se(ce,xe,At,"","\\Im",!0);se(ce,xe,At,"","\\spadesuit",!0);se(ce,xe,At,"","\\S",!0);se(qn,xe,At,"","\\S");se(ce,xe,At,"","\\P",!0);se(qn,xe,At,"","\\P");se(ce,xe,At,"","\\dag");se(qn,xe,At,"","\\dag");se(qn,xe,At,"","\\textdagger");se(ce,xe,At,"","\\ddag");se(qn,xe,At,"","\\ddag");se(qn,xe,At,"","\\textdaggerdbl");se(ce,xe,Bu,"","\\rmoustache",!0);se(ce,xe,Zc,"","\\lmoustache",!0);se(ce,xe,Bu,"","\\rgroup",!0);se(ce,xe,Zc,"","\\lgroup",!0);se(ce,xe,Kr,"","\\mp",!0);se(ce,xe,Kr,"","\\ominus",!0);se(ce,xe,Kr,"","\\uplus",!0);se(ce,xe,Kr,"","\\sqcap",!0);se(ce,xe,Kr,"","\\ast");se(ce,xe,Kr,"","\\sqcup",!0);se(ce,xe,Kr,"","\\bigcirc",!0);se(ce,xe,Kr,"","\\bullet",!0);se(ce,xe,Kr,"","\\ddagger");se(ce,xe,Kr,"","\\wr",!0);se(ce,xe,Kr,"","\\amalg");se(ce,xe,Kr,"&","\\And");se(ce,xe,ot,"","\\longleftarrow",!0);se(ce,xe,ot,"","\\Leftarrow",!0);se(ce,xe,ot,"","\\Longleftarrow",!0);se(ce,xe,ot,"","\\longrightarrow",!0);se(ce,xe,ot,"","\\Rightarrow",!0);se(ce,xe,ot,"","\\Longrightarrow",!0);se(ce,xe,ot,"","\\leftrightarrow",!0);se(ce,xe,ot,"","\\longleftrightarrow",!0);se(ce,xe,ot,"","\\Leftrightarrow",!0);se(ce,xe,ot,"","\\Longleftrightarrow",!0);se(ce,xe,ot,"","\\mapsto",!0);se(ce,xe,ot,"","\\longmapsto",!0);se(ce,xe,ot,"","\\nearrow",!0);se(ce,xe,ot,"","\\hookleftarrow",!0);se(ce,xe,ot,"","\\hookrightarrow",!0);se(ce,xe,ot,"","\\searrow",!0);se(ce,xe,ot,"","\\leftharpoonup",!0);se(ce,xe,ot,"","\\rightharpoonup",!0);se(ce,xe,ot,"","\\swarrow",!0);se(ce,xe,ot,"","\\leftharpoondown",!0);se(ce,xe,ot,"","\\rightharpoondown",!0);se(ce,xe,ot,"","\\nwarrow",!0);se(ce,xe,ot,"","\\rightleftharpoons",!0);se(ce,st,ot,"","\\nless",!0);se(ce,st,ot,"","\\@nleqslant");se(ce,st,ot,"","\\@nleqq");se(ce,st,ot,"","\\lneq",!0);se(ce,st,ot,"","\\lneqq",!0);se(ce,st,ot,"","\\@lvertneqq");se(ce,st,ot,"","\\lnsim",!0);se(ce,st,ot,"","\\lnapprox",!0);se(ce,st,ot,"","\\nprec",!0);se(ce,st,ot,"","\\npreceq",!0);se(ce,st,ot,"","\\precnsim",!0);se(ce,st,ot,"","\\precnapprox",!0);se(ce,st,ot,"","\\nsim",!0);se(ce,st,ot,"","\\@nshortmid");se(ce,st,ot,"","\\nmid",!0);se(ce,st,ot,"","\\nvdash",!0);se(ce,st,ot,"","\\nvDash",!0);se(ce,st,ot,"","\\ntriangleleft");se(ce,st,ot,"","\\ntrianglelefteq",!0);se(ce,st,ot,"","\\subsetneq",!0);se(ce,st,ot,"","\\@varsubsetneq");se(ce,st,ot,"","\\subsetneqq",!0);se(ce,st,ot,"","\\@varsubsetneqq");se(ce,st,ot,"","\\ngtr",!0);se(ce,st,ot,"","\\@ngeqslant");se(ce,st,ot,"","\\@ngeqq");se(ce,st,ot,"","\\gneq",!0);se(ce,st,ot,"","\\gneqq",!0);se(ce,st,ot,"","\\@gvertneqq");se(ce,st,ot,"","\\gnsim",!0);se(ce,st,ot,"","\\gnapprox",!0);se(ce,st,ot,"","\\nsucc",!0);se(ce,st,ot,"","\\nsucceq",!0);se(ce,st,ot,"","\\succnsim",!0);se(ce,st,ot,"","\\succnapprox",!0);se(ce,st,ot,"","\\ncong",!0);se(ce,st,ot,"","\\@nshortparallel");se(ce,st,ot,"","\\nparallel",!0);se(ce,st,ot,"","\\nVDash",!0);se(ce,st,ot,"","\\ntriangleright");se(ce,st,ot,"","\\ntrianglerighteq",!0);se(ce,st,ot,"","\\@nsupseteqq");se(ce,st,ot,"","\\supsetneq",!0);se(ce,st,ot,"","\\@varsupsetneq");se(ce,st,ot,"","\\supsetneqq",!0);se(ce,st,ot,"","\\@varsupsetneqq");se(ce,st,ot,"","\\nVdash",!0);se(ce,st,ot,"","\\precneqq",!0);se(ce,st,ot,"","\\succneqq",!0);se(ce,st,ot,"","\\@nsubseteqq");se(ce,st,Kr,"","\\unlhd");se(ce,st,Kr,"","\\unrhd");se(ce,st,ot,"","\\nleftarrow",!0);se(ce,st,ot,"","\\nrightarrow",!0);se(ce,st,ot,"","\\nLeftarrow",!0);se(ce,st,ot,"","\\nRightarrow",!0);se(ce,st,ot,"","\\nleftrightarrow",!0);se(ce,st,ot,"","\\nLeftrightarrow",!0);se(ce,st,ot,"","\\vartriangle");se(ce,st,At,"","\\hslash");se(ce,st,At,"","\\triangledown");se(ce,st,At,"","\\lozenge");se(ce,st,At,"","\\circledS");se(ce,st,At,"","\\circledR");se(qn,st,At,"","\\circledR");se(ce,st,At,"","\\measuredangle",!0);se(ce,st,At,"","\\nexists");se(ce,st,At,"","\\mho");se(ce,st,At,"","\\Finv",!0);se(ce,st,At,"","\\Game",!0);se(ce,st,At,"","\\backprime");se(ce,st,At,"","\\blacktriangle");se(ce,st,At,"","\\blacktriangledown");se(ce,st,At,"","\\blacksquare");se(ce,st,At,"","\\blacklozenge");se(ce,st,At,"","\\bigstar");se(ce,st,At,"","\\sphericalangle",!0);se(ce,st,At,"","\\complement",!0);se(ce,st,At,"","\\eth",!0);se(qn,xe,At,"","");se(ce,st,At,"","\\diagup");se(ce,st,At,"","\\diagdown");se(ce,st,At,"","\\square");se(ce,st,At,"","\\Box");se(ce,st,At,"","\\Diamond");se(ce,st,At,"","\\yen",!0);se(qn,st,At,"","\\yen",!0);se(ce,st,At,"","\\checkmark",!0);se(qn,st,At,"","\\checkmark");se(ce,st,At,"","\\beth",!0);se(ce,st,At,"","\\daleth",!0);se(ce,st,At,"","\\gimel",!0);se(ce,st,At,"","\\digamma",!0);se(ce,st,At,"","\\varkappa");se(ce,st,Zc,"","\\@ulcorner",!0);se(ce,st,Bu,"","\\@urcorner",!0);se(ce,st,Zc,"","\\@llcorner",!0);se(ce,st,Bu,"","\\@lrcorner",!0);se(ce,st,ot,"","\\leqq",!0);se(ce,st,ot,"","\\leqslant",!0);se(ce,st,ot,"","\\eqslantless",!0);se(ce,st,ot,"","\\lesssim",!0);se(ce,st,ot,"","\\lessapprox",!0);se(ce,st,ot,"","\\approxeq",!0);se(ce,st,Kr,"","\\lessdot");se(ce,st,ot,"","\\lll",!0);se(ce,st,ot,"","\\lessgtr",!0);se(ce,st,ot,"","\\lesseqgtr",!0);se(ce,st,ot,"","\\lesseqqgtr",!0);se(ce,st,ot,"","\\doteqdot");se(ce,st,ot,"","\\risingdotseq",!0);se(ce,st,ot,"","\\fallingdotseq",!0);se(ce,st,ot,"","\\backsim",!0);se(ce,st,ot,"","\\backsimeq",!0);se(ce,st,ot,"","\\subseteqq",!0);se(ce,st,ot,"","\\Subset",!0);se(ce,st,ot,"","\\sqsubset",!0);se(ce,st,ot,"","\\preccurlyeq",!0);se(ce,st,ot,"","\\curlyeqprec",!0);se(ce,st,ot,"","\\precsim",!0);se(ce,st,ot,"","\\precapprox",!0);se(ce,st,ot,"","\\vartriangleleft");se(ce,st,ot,"","\\trianglelefteq");se(ce,st,ot,"","\\vDash",!0);se(ce,st,ot,"","\\Vvdash",!0);se(ce,st,ot,"","\\smallsmile");se(ce,st,ot,"","\\smallfrown");se(ce,st,ot,"","\\bumpeq",!0);se(ce,st,ot,"","\\Bumpeq",!0);se(ce,st,ot,"","\\geqq",!0);se(ce,st,ot,"","\\geqslant",!0);se(ce,st,ot,"","\\eqslantgtr",!0);se(ce,st,ot,"","\\gtrsim",!0);se(ce,st,ot,"","\\gtrapprox",!0);se(ce,st,Kr,"","\\gtrdot");se(ce,st,ot,"","\\ggg",!0);se(ce,st,ot,"","\\gtrless",!0);se(ce,st,ot,"","\\gtreqless",!0);se(ce,st,ot,"","\\gtreqqless",!0);se(ce,st,ot,"","\\eqcirc",!0);se(ce,st,ot,"","\\circeq",!0);se(ce,st,ot,"","\\triangleq",!0);se(ce,st,ot,"","\\thicksim");se(ce,st,ot,"","\\thickapprox");se(ce,st,ot,"","\\supseteqq",!0);se(ce,st,ot,"","\\Supset",!0);se(ce,st,ot,"","\\sqsupset",!0);se(ce,st,ot,"","\\succcurlyeq",!0);se(ce,st,ot,"","\\curlyeqsucc",!0);se(ce,st,ot,"","\\succsim",!0);se(ce,st,ot,"","\\succapprox",!0);se(ce,st,ot,"","\\vartriangleright");se(ce,st,ot,"","\\trianglerighteq");se(ce,st,ot,"","\\Vdash",!0);se(ce,st,ot,"","\\shortmid");se(ce,st,ot,"","\\shortparallel");se(ce,st,ot,"","\\between",!0);se(ce,st,ot,"","\\pitchfork",!0);se(ce,st,ot,"","\\varpropto");se(ce,st,ot,"","\\blacktriangleleft");se(ce,st,ot,"","\\therefore",!0);se(ce,st,ot,"","\\backepsilon");se(ce,st,ot,"","\\blacktriangleright");se(ce,st,ot,"","\\because",!0);se(ce,st,ot,"","\\llless");se(ce,st,ot,"","\\gggtr");se(ce,st,Kr,"","\\lhd");se(ce,st,Kr,"","\\rhd");se(ce,st,ot,"","\\eqsim",!0);se(ce,xe,ot,"","\\Join");se(ce,st,ot,"","\\Doteq",!0);se(ce,st,Kr,"","\\dotplus",!0);se(ce,st,Kr,"","\\smallsetminus");se(ce,st,Kr,"","\\Cap",!0);se(ce,st,Kr,"","\\Cup",!0);se(ce,st,Kr,"","\\doublebarwedge",!0);se(ce,st,Kr,"","\\boxminus",!0);se(ce,st,Kr,"","\\boxplus",!0);se(ce,st,Kr,"","\\divideontimes",!0);se(ce,st,Kr,"","\\ltimes",!0);se(ce,st,Kr,"","\\rtimes",!0);se(ce,st,Kr,"","\\leftthreetimes",!0);se(ce,st,Kr,"","\\rightthreetimes",!0);se(ce,st,Kr,"","\\curlywedge",!0);se(ce,st,Kr,"","\\curlyvee",!0);se(ce,st,Kr,"","\\circleddash",!0);se(ce,st,Kr,"","\\circledast",!0);se(ce,st,Kr,"","\\centerdot");se(ce,st,Kr,"","\\intercal",!0);se(ce,st,Kr,"","\\doublecap");se(ce,st,Kr,"","\\doublecup");se(ce,st,Kr,"","\\boxtimes",!0);se(ce,st,ot,"","\\dashrightarrow",!0);se(ce,st,ot,"","\\dashleftarrow",!0);se(ce,st,ot,"","\\leftleftarrows",!0);se(ce,st,ot,"","\\leftrightarrows",!0);se(ce,st,ot,"","\\Lleftarrow",!0);se(ce,st,ot,"","\\twoheadleftarrow",!0);se(ce,st,ot,"","\\leftarrowtail",!0);se(ce,st,ot,"","\\looparrowleft",!0);se(ce,st,ot,"","\\leftrightharpoons",!0);se(ce,st,ot,"","\\curvearrowleft",!0);se(ce,st,ot,"","\\circlearrowleft",!0);se(ce,st,ot,"","\\Lsh",!0);se(ce,st,ot,"","\\upuparrows",!0);se(ce,st,ot,"","\\upharpoonleft",!0);se(ce,st,ot,"","\\downharpoonleft",!0);se(ce,xe,ot,"","\\origof",!0);se(ce,xe,ot,"","\\imageof",!0);se(ce,st,ot,"","\\multimap",!0);se(ce,st,ot,"","\\leftrightsquigarrow",!0);se(ce,st,ot,"","\\rightrightarrows",!0);se(ce,st,ot,"","\\rightleftarrows",!0);se(ce,st,ot,"","\\twoheadrightarrow",!0);se(ce,st,ot,"","\\rightarrowtail",!0);se(ce,st,ot,"","\\looparrowright",!0);se(ce,st,ot,"","\\curvearrowright",!0);se(ce,st,ot,"","\\circlearrowright",!0);se(ce,st,ot,"","\\Rsh",!0);se(ce,st,ot,"","\\downdownarrows",!0);se(ce,st,ot,"","\\upharpoonright",!0);se(ce,st,ot,"","\\downharpoonright",!0);se(ce,st,ot,"","\\rightsquigarrow",!0);se(ce,st,ot,"","\\leadsto");se(ce,st,ot,"","\\Rrightarrow",!0);se(ce,st,ot,"","\\restriction");se(ce,xe,At,"","`");se(ce,xe,At,"$","\\$");se(qn,xe,At,"$","\\$");se(qn,xe,At,"$","\\textdollar");se(ce,xe,At,"%","\\%");se(qn,xe,At,"%","\\%");se(ce,xe,At,"_","\\_");se(qn,xe,At,"_","\\_");se(qn,xe,At,"_","\\textunderscore");se(ce,xe,At,"","\\angle",!0);se(ce,xe,At,"","\\infty",!0);se(ce,xe,At,"","\\prime");se(ce,xe,At,"","\\triangle");se(ce,xe,At,"","\\Gamma",!0);se(ce,xe,At,"","\\Delta",!0);se(ce,xe,At,"","\\Theta",!0);se(ce,xe,At,"","\\Lambda",!0);se(ce,xe,At,"","\\Xi",!0);se(ce,xe,At,"","\\Pi",!0);se(ce,xe,At,"","\\Sigma",!0);se(ce,xe,At,"","\\Upsilon",!0);se(ce,xe,At,"","\\Phi",!0);se(ce,xe,At,"","\\Psi",!0);se(ce,xe,At,"","\\Omega",!0);se(ce,xe,At,"A","");se(ce,xe,At,"B","");se(ce,xe,At,"E","");se(ce,xe,At,"Z","");se(ce,xe,At,"H","");se(ce,xe,At,"I","");se(ce,xe,At,"K","");se(ce,xe,At,"M","");se(ce,xe,At,"N","");se(ce,xe,At,"O","");se(ce,xe,At,"P","");se(ce,xe,At,"T","");se(ce,xe,At,"X","");se(ce,xe,At,"","\\neg",!0);se(ce,xe,At,"","\\lnot");se(ce,xe,At,"","\\top");se(ce,xe,At,"","\\bot");se(ce,xe,At,"","\\emptyset");se(ce,st,At,"","\\varnothing");se(ce,xe,Ui,"","\\alpha",!0);se(ce,xe,Ui,"","\\beta",!0);se(ce,xe,Ui,"","\\gamma",!0);se(ce,xe,Ui,"","\\delta",!0);se(ce,xe,Ui,"","\\epsilon",!0);se(ce,xe,Ui,"","\\zeta",!0);se(ce,xe,Ui,"","\\eta",!0);se(ce,xe,Ui,"","\\theta",!0);se(ce,xe,Ui,"","\\iota",!0);se(ce,xe,Ui,"","\\kappa",!0);se(ce,xe,Ui,"","\\lambda",!0);se(ce,xe,Ui,"","\\mu",!0);se(ce,xe,Ui,"","\\nu",!0);se(ce,xe,Ui,"","\\xi",!0);se(ce,xe,Ui,"","\\omicron",!0);se(ce,xe,Ui,"","\\pi",!0);se(ce,xe,Ui,"","\\rho",!0);se(ce,xe,Ui,"","\\sigma",!0);se(ce,xe,Ui,"","\\tau",!0);se(ce,xe,Ui,"","\\upsilon",!0);se(ce,xe,Ui,"","\\phi",!0);se(ce,xe,Ui,"","\\chi",!0);se(ce,xe,Ui,"","\\psi",!0);se(ce,xe,Ui,"","\\omega",!0);se(ce,xe,Ui,"","\\varepsilon",!0);se(ce,xe,Ui,"","\\vartheta",!0);se(ce,xe,Ui,"","\\varpi",!0);se(ce,xe,Ui,"","\\varrho",!0);se(ce,xe,Ui,"","\\varsigma",!0);se(ce,xe,Ui,"","\\varphi",!0);se(ce,xe,Kr,"","*",!0);se(ce,xe,Kr,"+","+");se(ce,xe,Kr,"","-",!0);se(ce,xe,Kr,"","\\cdot",!0);se(ce,xe,Kr,"","\\circ",!0);se(ce,xe,Kr,"","\\div",!0);se(ce,xe,Kr,"","\\pm",!0);se(ce,xe,Kr,"","\\times",!0);se(ce,xe,Kr,"","\\cap",!0);se(ce,xe,Kr,"","\\cup",!0);se(ce,xe,Kr,"","\\setminus",!0);se(ce,xe,Kr,"","\\land");se(ce,xe,Kr,"","\\lor");se(ce,xe,Kr,"","\\wedge",!0);se(ce,xe,Kr,"","\\vee",!0);se(ce,xe,At,"","\\surd");se(ce,xe,Zc,"","\\langle",!0);se(ce,xe,Zc,"","\\lvert");se(ce,xe,Zc,"","\\lVert");se(ce,xe,Bu,"?","?");se(ce,xe,Bu,"!","!");se(ce,xe,Bu,"","\\rangle",!0);se(ce,xe,Bu,"","\\rvert");se(ce,xe,Bu,"","\\rVert");se(ce,xe,ot,"=","=");se(ce,xe,ot,":",":");se(ce,xe,ot,"","\\approx",!0);se(ce,xe,ot,"","\\cong",!0);se(ce,xe,ot,"","\\ge");se(ce,xe,ot,"","\\geq",!0);se(ce,xe,ot,"","\\gets");se(ce,xe,ot,">","\\gt",!0);se(ce,xe,ot,"","\\in",!0);se(ce,xe,ot,"","\\@not");se(ce,xe,ot,"","\\subset",!0);se(ce,xe,ot,"","\\supset",!0);se(ce,xe,ot,"","\\subseteq",!0);se(ce,xe,ot,"","\\supseteq",!0);se(ce,st,ot,"","\\nsubseteq",!0);se(ce,st,ot,"","\\nsupseteq",!0);se(ce,xe,ot,"","\\models");se(ce,xe,ot,"","\\leftarrow",!0);se(ce,xe,ot,"","\\le");se(ce,xe,ot,"","\\leq",!0);se(ce,xe,ot,"<","\\lt",!0);se(ce,xe,ot,"","\\rightarrow",!0);se(ce,xe,ot,"","\\to");se(ce,st,ot,"","\\ngeq",!0);se(ce,st,ot,"","\\nleq",!0);se(ce,xe,Bp,"","\\ ");se(ce,xe,Bp,"","\\space");se(ce,xe,Bp,"","\\nobreakspace");se(qn,xe,Bp,"","\\ ");se(qn,xe,Bp,""," ");se(qn,xe,Bp,"","\\space");se(qn,xe,Bp,"","\\nobreakspace");se(ce,xe,Bp,null,"\\nobreak");se(ce,xe,Bp,null,"\\allowbreak");se(ce,xe,jk,",",",");se(ce,xe,jk,";",";");se(ce,st,Kr,"","\\barwedge",!0);se(ce,st,Kr,"","\\veebar",!0);se(ce,xe,Kr,"","\\odot",!0);se(ce,xe,Kr,"","\\oplus",!0);se(ce,xe,Kr,"","\\otimes",!0);se(ce,xe,At,"","\\partial",!0);se(ce,xe,Kr,"","\\oslash",!0);se(ce,st,Kr,"","\\circledcirc",!0);se(ce,st,Kr,"","\\boxdot",!0);se(ce,xe,Kr,"","\\bigtriangleup");se(ce,xe,Kr,"","\\bigtriangledown");se(ce,xe,Kr,"","\\dagger");se(ce,xe,Kr,"","\\diamond");se(ce,xe,Kr,"","\\star");se(ce,xe,Kr,"","\\triangleleft");se(ce,xe,Kr,"","\\triangleright");se(ce,xe,Zc,"{","\\{");se(qn,xe,At,"{","\\{");se(qn,xe,At,"{","\\textbraceleft");se(ce,xe,Bu,"}","\\}");se(qn,xe,At,"}","\\}");se(qn,xe,At,"}","\\textbraceright");se(ce,xe,Zc,"{","\\lbrace");se(ce,xe,Bu,"}","\\rbrace");se(ce,xe,Zc,"[","\\lbrack",!0);se(qn,xe,At,"[","\\lbrack",!0);se(ce,xe,Bu,"]","\\rbrack",!0);se(qn,xe,At,"]","\\rbrack",!0);se(ce,xe,Zc,"(","\\lparen",!0);se(ce,xe,Bu,")","\\rparen",!0);se(qn,xe,At,"<","\\textless",!0);se(qn,xe,At,">","\\textgreater",!0);se(ce,xe,Zc,"","\\lfloor",!0);se(ce,xe,Bu,"","\\rfloor",!0);se(ce,xe,Zc,"","\\lceil",!0);se(ce,xe,Bu,"","\\rceil",!0);se(ce,xe,At,"\\","\\backslash");se(ce,xe,At,"","|");se(ce,xe,At,"","\\vert");se(qn,xe,At,"|","\\textbar",!0);se(ce,xe,At,"","\\|");se(ce,xe,At,"","\\Vert");se(qn,xe,At,"","\\textbardbl");se(qn,xe,At,"~","\\textasciitilde");se(qn,xe,At,"\\","\\textbackslash");se(qn,xe,At,"^","\\textasciicircum");se(ce,xe,ot,"","\\uparrow",!0);se(ce,xe,ot,"","\\Uparrow",!0);se(ce,xe,ot,"","\\downarrow",!0);se(ce,xe,ot,"","\\Downarrow",!0);se(ce,xe,ot,"","\\updownarrow",!0);se(ce,xe,ot,"","\\Updownarrow",!0);se(ce,xe,gl,"","\\coprod");se(ce,xe,gl,"","\\bigvee");se(ce,xe,gl,"","\\bigwedge");se(ce,xe,gl,"","\\biguplus");se(ce,xe,gl,"","\\bigcap");se(ce,xe,gl,"","\\bigcup");se(ce,xe,gl,"","\\int");se(ce,xe,gl,"","\\intop");se(ce,xe,gl,"","\\iint");se(ce,xe,gl,"","\\iiint");se(ce,xe,gl,"","\\prod");se(ce,xe,gl,"","\\sum");se(ce,xe,gl,"","\\bigotimes");se(ce,xe,gl,"","\\bigoplus");se(ce,xe,gl,"","\\bigodot");se(ce,xe,gl,"","\\oint");se(ce,xe,gl,"","\\oiint");se(ce,xe,gl,"","\\oiiint");se(ce,xe,gl,"","\\bigsqcup");se(ce,xe,gl,"","\\smallint");se(qn,xe,Dx,"","\\textellipsis");se(ce,xe,Dx,"","\\mathellipsis");se(qn,xe,Dx,"","\\ldots",!0);se(ce,xe,Dx,"","\\ldots",!0);se(ce,xe,Dx,"","\\@cdots",!0);se(ce,xe,Dx,"","\\ddots",!0);se(ce,xe,At,"","\\varvdots");se(qn,xe,At,"","\\varvdots");se(ce,xe,Io,"","\\acute");se(ce,xe,Io,"","\\grave");se(ce,xe,Io,"","\\ddot");se(ce,xe,Io,"~","\\tilde");se(ce,xe,Io,"","\\bar");se(ce,xe,Io,"","\\breve");se(ce,xe,Io,"","\\check");se(ce,xe,Io,"^","\\hat");se(ce,xe,Io,"","\\vec");se(ce,xe,Io,"","\\dot");se(ce,xe,Io,"","\\mathring");se(ce,xe,Ui,"","\\@imath");se(ce,xe,Ui,"","\\@jmath");se(ce,xe,At,"","");se(ce,xe,At,"","");se(qn,xe,At,"","\\i",!0);se(qn,xe,At,"","\\j",!0);se(qn,xe,At,"","\\ss",!0);se(qn,xe,At,"","\\ae",!0);se(qn,xe,At,"","\\oe",!0);se(qn,xe,At,"","\\o",!0);se(qn,xe,At,"","\\AE",!0);se(qn,xe,At,"","\\OE",!0);se(qn,xe,At,"","\\O",!0);se(qn,xe,Io,"","\\'");se(qn,xe,Io,"","\\`");se(qn,xe,Io,"","\\^");se(qn,xe,Io,"","\\~");se(qn,xe,Io,"","\\=");se(qn,xe,Io,"","\\u");se(qn,xe,Io,"","\\.");se(qn,xe,Io,"","\\c");se(qn,xe,Io,"","\\r");se(qn,xe,Io,"","\\v");se(qn,xe,Io,"",'\\"');se(qn,xe,Io,"","\\H");se(qn,xe,Io,"","\\textcircled");var TJ={"--":!0,"---":!0,"``":!0,"''":!0};se(qn,xe,At,"","--",!0);se(qn,xe,At,"","\\textendash");se(qn,xe,At,"","---",!0);se(qn,xe,At,"","\\textemdash");se(qn,xe,At,"","`",!0);se(qn,xe,At,"","\\textquoteleft");se(qn,xe,At,"","'",!0);se(qn,xe,At,"","\\textquoteright");se(qn,xe,At,"","``",!0);se(qn,xe,At,"","\\textquotedblleft");se(qn,xe,At,"","''",!0);se(qn,xe,At,"","\\textquotedblright");se(ce,xe,At,"","\\degree",!0);se(qn,xe,At,"","\\degree");se(qn,xe,At,"","\\textdegree",!0);se(ce,xe,At,"","\\pounds");se(ce,xe,At,"","\\mathsterling",!0);se(qn,xe,At,"","\\pounds");se(qn,xe,At,"","\\textsterling",!0);se(ce,st,At,"","\\maltese");se(qn,st,At,"","\\maltese");var d$='0123456789/@."';for(var gR=0;gR<d$.length;gR++){var h$=d$.charAt(gR);se(ce,xe,At,h$,h$)}var f$='0123456789!@*()-=+";:?/.,';for(var _R=0;_R<f$.length;_R++){var p$=f$.charAt(_R);se(qn,xe,At,p$,p$)}var DC="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var yR=0;yR<DC.length;yR++){var Q3=DC.charAt(yR);se(ce,xe,Ui,Q3,Q3),se(qn,xe,At,Q3,Q3)}se(ce,st,At,"C","");se(qn,st,At,"C","");se(ce,st,At,"H","");se(qn,st,At,"H","");se(ce,st,At,"N","");se(qn,st,At,"N","");se(ce,st,At,"P","");se(qn,st,At,"P","");se(ce,st,At,"Q","");se(qn,st,At,"Q","");se(ce,st,At,"R","");se(qn,st,At,"R","");se(ce,st,At,"Z","");se(qn,st,At,"Z","");se(ce,xe,Ui,"h","");se(qn,xe,Ui,"h","");var ss="";for(var Su=0;Su<DC.length;Su++){var Vo=DC.charAt(Su);ss=String.fromCharCode(55349,56320+Su),se(ce,xe,Ui,Vo,ss),se(qn,xe,At,Vo,ss),ss=String.fromCharCode(55349,56372+Su),se(ce,xe,Ui,Vo,ss),se(qn,xe,At,Vo,ss),ss=String.fromCharCode(55349,56424+Su),se(ce,xe,Ui,Vo,ss),se(qn,xe,At,Vo,ss),ss=String.fromCharCode(55349,56580+Su),se(ce,xe,Ui,Vo,ss),se(qn,xe,At,Vo,ss),ss=String.fromCharCode(55349,56684+Su),se(ce,xe,Ui,Vo,ss),se(qn,xe,At,Vo,ss),ss=String.fromCharCode(55349,56736+Su),se(ce,xe,Ui,Vo,ss),se(qn,xe,At,Vo,ss),ss=String.fromCharCode(55349,56788+Su),se(ce,xe,Ui,Vo,ss),se(qn,xe,At,Vo,ss),ss=String.fromCharCode(55349,56840+Su),se(ce,xe,Ui,Vo,ss),se(qn,xe,At,Vo,ss),ss=String.fromCharCode(55349,56944+Su),se(ce,xe,Ui,Vo,ss),se(qn,xe,At,Vo,ss),Su<26&&(ss=String.fromCharCode(55349,56632+Su),se(ce,xe,Ui,Vo,ss),se(qn,xe,At,Vo,ss),ss=String.fromCharCode(55349,56476+Su),se(ce,xe,Ui,Vo,ss),se(qn,xe,At,Vo,ss))}ss="";se(ce,xe,Ui,"k",ss);se(qn,xe,At,"k",ss);for(var Bg=0;Bg<10;Bg++){var Sm=Bg.toString();ss=String.fromCharCode(55349,57294+Bg),se(ce,xe,Ui,Sm,ss),se(qn,xe,At,Sm,ss),ss=String.fromCharCode(55349,57314+Bg),se(ce,xe,Ui,Sm,ss),se(qn,xe,At,Sm,ss),ss=String.fromCharCode(55349,57324+Bg),se(ce,xe,Ui,Sm,ss),se(qn,xe,At,Sm,ss),ss=String.fromCharCode(55349,57334+Bg),se(ce,xe,Ui,Sm,ss),se(qn,xe,At,Sm,ss)}var VO="";for(var vR=0;vR<VO.length;vR++){var J3=VO.charAt(vR);se(ce,xe,Ui,J3,J3),se(qn,xe,At,J3,J3)}var e4=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],m$=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],Z2e=function(t,n){var r=t.charCodeAt(0),a=t.charCodeAt(1),l=(r-55296)*1024+(a-56320)+65536,f=n==="math"?0:1;if(119808<=l&&l<120484){var i=Math.floor((l-119808)/26);return[e4[i][2],e4[i][f]]}else if(120782<=l&&l<=120831){var y=Math.floor((l-120782)/10);return[m$[y][2],m$[y][f]]}else{if(l===120485||l===120486)return[e4[0][2],e4[0][f]];if(120486<l&&l<120782)return["",""];throw new rr("Unsupported character: "+t)}},Uk=function(t,n,r){return fo[r][t]&&fo[r][t].replace&&(t=fo[r][t].replace),{value:t,metrics:PD(t,n,r)}},ch=function(t,n,r,a,l){var f=Uk(t,n,r),i=f.metrics;t=f.value;var y;if(i){var x=i.italic;(r==="text"||a&&a.font==="mathit")&&(x=0),y=new Ed(t,i.height,i.depth,x,i.skew,i.width,l)}else typeof console<"u"&&console.warn("No character metrics "+("for '"+t+"' in style '"+n+"' and mode '"+r+"'")),y=new Ed(t,0,0,0,0,0,l);if(a){y.maxFontSize=a.sizeMultiplier,a.style.isTight()&&y.classes.push("mtight");var S=a.getColor();S&&(y.style.color=S)}return y},W2e=function(t,n,r,a){return a===void 0&&(a=[]),r.font==="boldsymbol"&&Uk(t,"Main-Bold",n).metrics?ch(t,"Main-Bold",n,r,a.concat(["mathbf"])):t==="\\"||fo[n][t].font==="main"?ch(t,"Main-Regular",n,r,a):ch(t,"AMS-Regular",n,r,a.concat(["amsrm"]))},X2e=function(t,n,r,a,l){return l!=="textord"&&Uk(t,"Math-BoldItalic",n).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}},Y2e=function(t,n,r){var a=t.mode,l=t.text,f=["mord"],i=a==="math"||a==="text"&&n.font,y=i?n.font:n.fontFamily,x="",S="";if(l.charCodeAt(0)===55349&&([x,S]=Z2e(l,a)),x.length>0)return ch(l,x,a,n,f.concat(S));if(y){var C,P;if(y==="boldsymbol"){var L=X2e(l,a,n,f,r);C=L.fontName,P=[L.fontClass]}else i?(C=AJ[y].fontName,P=[y]):(C=t4(y,n.fontWeight,n.fontShape),P=[y,n.fontWeight,n.fontShape]);if(Uk(l,C,a).metrics)return ch(l,C,a,n,f.concat(P));if(TJ.hasOwnProperty(l)&&C.slice(0,10)==="Typewriter"){for(var F=[],U=0;U<l.length;U++)F.push(ch(l[U],C,a,n,f.concat(P)));return SJ(F)}}if(r==="mathord")return ch(l,"Math-Italic",a,n,f.concat(["mathnormal"]));if(r==="textord"){var q=fo[a][l]&&fo[a][l].font;if(q==="ams"){var G=t4("amsrm",n.fontWeight,n.fontShape);return ch(l,G,a,n,f.concat("amsrm",n.fontWeight,n.fontShape))}else if(q==="main"||!q){var $=t4("textrm",n.fontWeight,n.fontShape);return ch(l,$,a,n,f.concat(n.fontWeight,n.fontShape))}else{var X=t4(q,n.fontWeight,n.fontShape);return ch(l,X,a,n,f.concat(X,n.fontWeight,n.fontShape))}}else throw new Error("unexpected type: "+r+" in makeOrd")},K2e=(e,t)=>{if(I0(e.classes)!==I0(t.classes)||e.skew!==t.skew||e.maxFontSize!==t.maxFontSize)return!1;if(e.classes.length===1){var n=e.classes[0];if(n==="mbin"||n==="mord")return!1}for(var r in e.style)if(e.style.hasOwnProperty(r)&&e.style[r]!==t.style[r])return!1;for(var a in t.style)if(t.style.hasOwnProperty(a)&&e.style[a]!==t.style[a])return!1;return!0},Q2e=e=>{for(var t=0;t<e.length-1;t++){var n=e[t],r=e[t+1];n instanceof Ed&&r instanceof Ed&&K2e(n,r)&&(n.text+=r.text,n.height=Math.max(n.height,r.height),n.depth=Math.max(n.depth,r.depth),n.italic=r.italic,e.splice(t+1,1),t--)}return e},LD=function(t){for(var n=0,r=0,a=0,l=0;l<t.children.length;l++){var f=t.children[l];f.height>n&&(n=f.height),f.depth>r&&(r=f.depth),f.maxFontSize>a&&(a=f.maxFontSize)}t.height=n,t.depth=r,t.maxFontSize=a},tc=function(t,n,r,a){var l=new oE(t,n,r,a);return LD(l),l},EJ=(e,t,n,r)=>new oE(e,t,n,r),J2e=function(t,n,r){var a=tc([t],[],n);return a.height=Math.max(r||n.fontMetrics().defaultRuleThickness,n.minRuleThickness),a.style.borderBottomWidth=Cr(a.height),a.maxFontSize=1,a},eTe=function(t,n,r,a){var l=new OD(t,n,r,a);return LD(l),l},SJ=function(t){var n=new aE(t);return LD(n),n},tTe=function(t,n){return t instanceof aE?tc([],[t],n):t},nTe=function(t){if(t.positionType==="individualShift"){for(var n=t.children,r=[n[0]],a=-n[0].shift-n[0].elem.depth,l=a,f=1;f<n.length;f++){var i=-n[f].shift-l-n[f].elem.depth,y=i-(n[f-1].elem.height+n[f-1].elem.depth);l=l+i,r.push({type:"kern",size:y}),r.push(n[f])}return{children:r,depth:a}}var x;if(t.positionType==="top"){for(var S=t.positionData,C=0;C<t.children.length;C++){var P=t.children[C];S-=P.type==="kern"?P.size:P.elem.height+P.elem.depth}x=S}else if(t.positionType==="bottom")x=-t.positionData;else{var L=t.children[0];if(L.type!=="elem")throw new Error('First child must have type "elem".');if(t.positionType==="shift")x=-L.elem.depth-t.positionData;else if(t.positionType==="firstBaseline")x=-L.elem.depth;else throw new Error("Invalid positionType "+t.positionType+".")}return{children:t.children,depth:x}},rTe=function(t,n){for(var{children:r,depth:a}=nTe(t),l=0,f=0;f<r.length;f++){var i=r[f];if(i.type==="elem"){var y=i.elem;l=Math.max(l,y.maxFontSize,y.height)}}l+=2;var x=tc(["pstrut"],[]);x.style.height=Cr(l);for(var S=[],C=a,P=a,L=a,F=0;F<r.length;F++){var U=r[F];if(U.type==="kern")L+=U.size;else{var q=U.elem,G=U.wrapperClasses||[],$=U.wrapperStyle||{},X=tc(G,[x,q],void 0,$);X.style.top=Cr(-l-L-q.depth),U.marginLeft&&(X.style.marginLeft=U.marginLeft),U.marginRight&&(X.style.marginRight=U.marginRight),S.push(X),L+=q.height+q.depth}C=Math.min(C,L),P=Math.max(P,L)}var ie=tc(["vlist"],S);ie.style.height=Cr(P);var de;if(C<0){var fe=tc([],[]),be=tc(["vlist"],[fe]);be.style.height=Cr(-C);var ve=tc(["vlist-s"],[new Ed("")]);de=[tc(["vlist-r"],[ie,ve]),tc(["vlist-r"],[be])]}else de=[tc(["vlist-r"],[ie])];var Je=tc(["vlist-t"],de);return de.length===2&&Je.classes.push("vlist-t2"),Je.height=P,Je.depth=-C,Je},iTe=(e,t)=>{var n=tc(["mspace"],[],t),r=zo(e,t);return n.style.marginRight=Cr(r),n},t4=function(t,n,r){var a="";switch(t){case"amsrm":a="AMS";break;case"textrm":a="Main";break;case"textsf":a="SansSerif";break;case"texttt":a="Typewriter";break;default:a=t}var l;return n==="textbf"&&r==="textit"?l="BoldItalic":n==="textbf"?l="Bold":n==="textit"?l="Italic":l="Regular",a+"-"+l},AJ={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathsfit:{variant:"sans-serif-italic",fontName:"SansSerif-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},CJ={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},sTe=function(t,n){var[r,a,l]=CJ[t],f=new R0(r),i=new Op([f],{width:Cr(a),height:Cr(l),style:"width:"+Cr(a),viewBox:"0 0 "+1e3*a+" "+1e3*l,preserveAspectRatio:"xMinYMin"}),y=EJ(["overlay"],[i],n);return y.height=l,y.style.height=Cr(l),y.style.width=Cr(a),y},Xt={fontMap:AJ,makeSymbol:ch,mathsym:W2e,makeSpan:tc,makeSvgSpan:EJ,makeLineSpan:J2e,makeAnchor:eTe,makeFragment:SJ,wrapFragment:tTe,makeVList:rTe,makeOrd:Y2e,makeGlue:iTe,staticSvg:sTe,svgData:CJ,tryCombineChars:Q2e},Do={number:3,unit:"mu"},jg={number:4,unit:"mu"},np={number:5,unit:"mu"},aTe={mord:{mop:Do,mbin:jg,mrel:np,minner:Do},mop:{mord:Do,mop:Do,mrel:np,minner:Do},mbin:{mord:jg,mop:jg,mopen:jg,minner:jg},mrel:{mord:np,mop:np,mopen:np,minner:np},mopen:{},mclose:{mop:Do,mbin:jg,mrel:np,minner:Do},mpunct:{mord:Do,mop:Do,mrel:np,mopen:Do,mclose:Do,mpunct:Do,minner:Do},minner:{mord:Do,mop:Do,mbin:jg,mrel:np,mopen:Do,mpunct:Do,minner:Do}},oTe={mord:{mop:Do},mop:{mord:Do,mop:Do},mbin:{},mrel:{},mopen:{},mclose:{mop:Do},mpunct:{},minner:{mop:Do}},kJ={},NC={},zC={};function Fr(e){for(var{type:t,names:n,props:r,handler:a,htmlBuilder:l,mathmlBuilder:f}=e,i={type:t,numArgs:r.numArgs,argTypes:r.argTypes,allowedInArgument:!!r.allowedInArgument,allowedInText:!!r.allowedInText,allowedInMath:r.allowedInMath===void 0?!0:r.allowedInMath,numOptionalArgs:r.numOptionalArgs||0,infix:!!r.infix,primitive:!!r.primitive,handler:a},y=0;y<n.length;++y)kJ[n[y]]=i;t&&(l&&(NC[t]=l),f&&(zC[t]=f))}function Z_(e){var{type:t,htmlBuilder:n,mathmlBuilder:r}=e;Fr({type:t,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:n,mathmlBuilder:r})}var FC=function(t){return t.type==="ordgroup"&&t.body.length===1?t.body[0]:t},tl=function(t){return t.type==="ordgroup"?t.body:[t]},Lp=Xt.makeSpan,lTe=["leftmost","mbin","mopen","mrel","mop","mpunct"],uTe=["rightmost","mrel","mclose","mpunct"],cTe={display:Vi.DISPLAY,text:Vi.TEXT,script:Vi.SCRIPT,scriptscript:Vi.SCRIPTSCRIPT},dTe={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},Tl=function(t,n,r,a){a===void 0&&(a=[null,null]);for(var l=[],f=0;f<t.length;f++){var i=Ia(t[f],n);if(i instanceof aE){var y=i.children;l.push(...y)}else l.push(i)}if(Xt.tryCombineChars(l),!r)return l;var x=n;if(t.length===1){var S=t[0];S.type==="sizing"?x=n.havingSize(S.size):S.type==="styling"&&(x=n.havingStyle(cTe[S.style]))}var C=Lp([a[0]||"leftmost"],[],n),P=Lp([a[1]||"rightmost"],[],n),L=r==="root";return g$(l,(F,U)=>{var q=U.classes[0],G=F.classes[0];q==="mbin"&&uTe.includes(G)?U.classes[0]="mord":G==="mbin"&&lTe.includes(q)&&(F.classes[0]="mord")},{node:C},P,L),g$(l,(F,U)=>{var q=$O(U),G=$O(F),$=q&&G?F.hasClass("mtight")?oTe[q][G]:aTe[q][G]:null;if($)return Xt.makeGlue($,x)},{node:C},P,L),l},g$=function e(t,n,r,a,l){a&&t.push(a);for(var f=0;f<t.length;f++){var i=t[f],y=IJ(i);if(y){e(y.children,n,r,null,l);continue}var x=!i.hasClass("mspace");if(x){var S=n(i,r.node);S&&(r.insertAfter?r.insertAfter(S):(t.unshift(S),f++))}x?r.node=i:l&&i.hasClass("newline")&&(r.node=Lp(["leftmost"])),r.insertAfter=(C=>P=>{t.splice(C+1,0,P),f++})(f)}a&&t.pop()},IJ=function(t){return t instanceof aE||t instanceof OD||t instanceof oE&&t.hasClass("enclosing")?t:null},hTe=function e(t,n){var r=IJ(t);if(r){var a=r.children;if(a.length){if(n==="right")return e(a[a.length-1],"right");if(n==="left")return e(a[0],"left")}}return t},$O=function(t,n){return t?(n&&(t=hTe(t,n)),dTe[t.classes[0]]||null):null},AT=function(t,n){var r=["nulldelimiter"].concat(t.baseSizingClasses());return Lp(n.concat(r))},Ia=function(t,n,r){if(!t)return Lp();if(NC[t.type]){var a=NC[t.type](t,n);if(r&&n.size!==r.size){a=Lp(n.sizingClasses(r),[a],n);var l=n.sizeMultiplier/r.sizeMultiplier;a.height*=l,a.depth*=l}return a}else throw new rr("Got group of unknown type: '"+t.type+"'")};function n4(e,t){var n=Lp(["base"],e,t),r=Lp(["strut"]);return r.style.height=Cr(n.height+n.depth),n.depth&&(r.style.verticalAlign=Cr(-n.depth)),n.children.unshift(r),n}function HO(e,t){var n=null;e.length===1&&e[0].type==="tag"&&(n=e[0].tag,e=e[0].body);var r=Tl(e,t,"root"),a;r.length===2&&r[1].hasClass("tag")&&(a=r.pop());for(var l=[],f=[],i=0;i<r.length;i++)if(f.push(r[i]),r[i].hasClass("mbin")||r[i].hasClass("mrel")||r[i].hasClass("allowbreak")){for(var y=!1;i<r.length-1&&r[i+1].hasClass("mspace")&&!r[i+1].hasClass("newline");)i++,f.push(r[i]),r[i].hasClass("nobreak")&&(y=!0);y||(l.push(n4(f,t)),f=[])}else r[i].hasClass("newline")&&(f.pop(),f.length>0&&(l.push(n4(f,t)),f=[]),l.push(r[i]));f.length>0&&l.push(n4(f,t));var x;n?(x=n4(Tl(n,t,!0)),x.classes=["tag"],l.push(x)):a&&l.push(a);var S=Lp(["katex-html"],l);if(S.setAttribute("aria-hidden","true"),x){var C=x.children[0];C.style.height=Cr(S.height+S.depth),S.depth&&(C.style.verticalAlign=Cr(-S.depth))}return S}function RJ(e){return new aE(e)}class Lc{constructor(t,n,r){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=t,this.attributes={},this.children=n||[],this.classes=r||[]}setAttribute(t,n){this.attributes[t]=n}getAttribute(t){return this.attributes[t]}toNode(){var t=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&t.setAttribute(n,this.attributes[n]);this.classes.length>0&&(t.className=I0(this.classes));for(var r=0;r<this.children.length;r++)if(this.children[r]instanceof ff&&this.children[r+1]instanceof ff){for(var a=this.children[r].toText()+this.children[++r].toText();this.children[r+1]instanceof ff;)a+=this.children[++r].toText();t.appendChild(new ff(a).toNode())}else t.appendChild(this.children[r].toNode());return t}toMarkup(){var t="<"+this.type;for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(t+=" "+n+'="',t+=Na.escape(this.attributes[n]),t+='"');this.classes.length>0&&(t+=' class ="'+Na.escape(I0(this.classes))+'"'),t+=">";for(var r=0;r<this.children.length;r++)t+=this.children[r].toMarkup();return t+="</"+this.type+">",t}toText(){return this.children.map(t=>t.toText()).join("")}}class ff{constructor(t){this.text=void 0,this.text=t}toNode(){return document.createTextNode(this.text)}toMarkup(){return Na.escape(this.toText())}toText(){return this.text}}class fTe{constructor(t){this.width=void 0,this.character=void 0,this.width=t,t>=.05555&&t<=.05556?this.character="":t>=.1666&&t<=.1667?this.character="":t>=.2222&&t<=.2223?this.character="":t>=.2777&&t<=.2778?this.character="":t>=-.05556&&t<=-.05555?this.character="":t>=-.1667&&t<=-.1666?this.character="":t>=-.2223&&t<=-.2222?this.character="":t>=-.2778&&t<=-.2777?this.character="":this.character=null}toNode(){if(this.character)return document.createTextNode(this.character);var t=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return t.setAttribute("width",Cr(this.width)),t}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+Cr(this.width)+'"/>'}toText(){return this.character?this.character:" "}}var er={MathNode:Lc,TextNode:ff,SpaceNode:fTe,newDocumentFragment:RJ},Sd=function(t,n,r){return fo[n][t]&&fo[n][t].replace&&t.charCodeAt(0)!==55349&&!(TJ.hasOwnProperty(t)&&r&&(r.fontFamily&&r.fontFamily.slice(4,6)==="tt"||r.font&&r.font.slice(4,6)==="tt"))&&(t=fo[n][t].replace),new er.TextNode(t)},DD=function(t){return t.length===1?t[0]:new er.MathNode("mrow",t)},ND=function(t,n){if(n.fontFamily==="texttt")return"monospace";if(n.fontFamily==="textsf")return n.fontShape==="textit"&&n.fontWeight==="textbf"?"sans-serif-bold-italic":n.fontShape==="textit"?"sans-serif-italic":n.fontWeight==="textbf"?"bold-sans-serif":"sans-serif";if(n.fontShape==="textit"&&n.fontWeight==="textbf")return"bold-italic";if(n.fontShape==="textit")return"italic";if(n.fontWeight==="textbf")return"bold";var r=n.font;if(!r||r==="mathnormal")return null;var a=t.mode;if(r==="mathit")return"italic";if(r==="boldsymbol")return t.type==="textord"?"bold":"bold-italic";if(r==="mathbf")return"bold";if(r==="mathbb")return"double-struck";if(r==="mathsfit")return"sans-serif-italic";if(r==="mathfrak")return"fraktur";if(r==="mathscr"||r==="mathcal")return"script";if(r==="mathsf")return"sans-serif";if(r==="mathtt")return"monospace";var l=t.text;if(["\\imath","\\jmath"].includes(l))return null;fo[a][l]&&fo[a][l].replace&&(l=fo[a][l].replace);var f=Xt.fontMap[r].fontName;return PD(l,f,a)?Xt.fontMap[r].variant:null};function xR(e){if(!e)return!1;if(e.type==="mi"&&e.children.length===1){var t=e.children[0];return t instanceof ff&&t.text==="."}else if(e.type==="mo"&&e.children.length===1&&e.getAttribute("separator")==="true"&&e.getAttribute("lspace")==="0em"&&e.getAttribute("rspace")==="0em"){var n=e.children[0];return n instanceof ff&&n.text===","}else return!1}var fc=function(t,n,r){if(t.length===1){var a=eo(t[0],n);return r&&a instanceof Lc&&a.type==="mo"&&(a.setAttribute("lspace","0em"),a.setAttribute("rspace","0em")),[a]}for(var l=[],f,i=0;i<t.length;i++){var y=eo(t[i],n);if(y instanceof Lc&&f instanceof Lc){if(y.type==="mtext"&&f.type==="mtext"&&y.getAttribute("mathvariant")===f.getAttribute("mathvariant")){f.children.push(...y.children);continue}else if(y.type==="mn"&&f.type==="mn"){f.children.push(...y.children);continue}else if(xR(y)&&f.type==="mn"){f.children.push(...y.children);continue}else if(y.type==="mn"&&xR(f))y.children=[...f.children,...y.children],l.pop();else if((y.type==="msup"||y.type==="msub")&&y.children.length>=1&&(f.type==="mn"||xR(f))){var x=y.children[0];x instanceof Lc&&x.type==="mn"&&(x.children=[...f.children,...x.children],l.pop())}else if(f.type==="mi"&&f.children.length===1){var S=f.children[0];if(S instanceof ff&&S.text===""&&(y.type==="mo"||y.type==="mi"||y.type==="mn")){var C=y.children[0];C instanceof ff&&C.text.length>0&&(C.text=C.text.slice(0,1)+""+C.text.slice(1),l.pop())}}}l.push(y),f=y}return l},M0=function(t,n,r){return DD(fc(t,n,r))},eo=function(t,n){if(!t)return new er.MathNode("mrow");if(zC[t.type]){var r=zC[t.type](t,n);return r}else throw new rr("Got group of unknown type: '"+t.type+"'")};function _$(e,t,n,r,a){var l=fc(e,n),f;l.length===1&&l[0]instanceof Lc&&["mrow","mtable"].includes(l[0].type)?f=l[0]:f=new er.MathNode("mrow",l);var i=new er.MathNode("annotation",[new er.TextNode(t)]);i.setAttribute("encoding","application/x-tex");var y=new er.MathNode("semantics",[f,i]),x=new er.MathNode("math",[y]);x.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),r&&x.setAttribute("display","block");var S=a?"katex":"katex-mathml";return Xt.makeSpan([S],[x])}var MJ=function(t){return new lp({style:t.displayMode?Vi.DISPLAY:Vi.TEXT,maxSize:t.maxSize,minRuleThickness:t.minRuleThickness})},PJ=function(t,n){if(n.displayMode){var r=["katex-display"];n.leqno&&r.push("leqno"),n.fleqn&&r.push("fleqn"),t=Xt.makeSpan(r,[t])}return t},pTe=function(t,n,r){var a=MJ(r),l;if(r.output==="mathml")return _$(t,n,a,r.displayMode,!0);if(r.output==="html"){var f=HO(t,a);l=Xt.makeSpan(["katex"],[f])}else{var i=_$(t,n,a,r.displayMode,!1),y=HO(t,a);l=Xt.makeSpan(["katex"],[i,y])}return PJ(l,r)},mTe=function(t,n,r){var a=MJ(r),l=HO(t,a),f=Xt.makeSpan(["katex"],[l]);return PJ(f,r)},gTe={widehat:"^",widecheck:"",widetilde:"~",utilde:"~",overleftarrow:"",underleftarrow:"",xleftarrow:"",overrightarrow:"",underrightarrow:"",xrightarrow:"",underbrace:"",overbrace:"",overgroup:"",undergroup:"",overleftrightarrow:"",underleftrightarrow:"",xleftrightarrow:"",Overrightarrow:"",xRightarrow:"",overleftharpoon:"",xleftharpoonup:"",overrightharpoon:"",xrightharpoonup:"",xLeftarrow:"",xLeftrightarrow:"",xhookleftarrow:"",xhookrightarrow:"",xmapsto:"",xrightharpoondown:"",xleftharpoondown:"",xrightleftharpoons:"",xleftrightharpoons:"",xtwoheadleftarrow:"",xtwoheadrightarrow:"",xlongequal:"=",xtofrom:"",xrightleftarrows:"",xrightequilibrium:"",xleftequilibrium:"","\\cdrightarrow":"","\\cdleftarrow":"","\\cdlongequal":"="},_Te=function(t){var n=new er.MathNode("mo",[new er.TextNode(gTe[t.replace(/^\\/,"")])]);return n.setAttribute("stretchy","true"),n},yTe={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},vTe=function(t){return t.type==="ordgroup"?t.body.length:1},xTe=function(t,n){function r(){var i=4e5,y=t.label.slice(1);if(["widehat","widecheck","widetilde","utilde"].includes(y)){var x=t,S=vTe(x.base),C,P,L;if(S>5)y==="widehat"||y==="widecheck"?(C=420,i=2364,L=.42,P=y+"4"):(C=312,i=2340,L=.34,P="tilde4");else{var F=[1,1,2,2,3,3][S];y==="widehat"||y==="widecheck"?(i=[0,1062,2364,2364,2364][F],C=[0,239,300,360,420][F],L=[0,.24,.3,.3,.36,.42][F],P=y+F):(i=[0,600,1033,2339,2340][F],C=[0,260,286,306,312][F],L=[0,.26,.286,.3,.306,.34][F],P="tilde"+F)}var U=new R0(P),q=new Op([U],{width:"100%",height:Cr(L),viewBox:"0 0 "+i+" "+C,preserveAspectRatio:"none"});return{span:Xt.makeSvgSpan([],[q],n),minWidth:0,height:L}}else{var G=[],$=yTe[y],[X,ie,de]=$,fe=de/1e3,be=X.length,ve,Je;if(be===1){var we=$[3];ve=["hide-tail"],Je=[we]}else if(be===2)ve=["halfarrow-left","halfarrow-right"],Je=["xMinYMin","xMaxYMin"];else if(be===3)ve=["brace-left","brace-center","brace-right"],Je=["xMinYMin","xMidYMin","xMaxYMin"];else throw new Error(`Correct katexImagesData or update code here to support
                    `+be+" children.");for(var rt=0;rt<be;rt++){var He=new R0(X[rt]),ft=new Op([He],{width:"400em",height:Cr(fe),viewBox:"0 0 "+i+" "+de,preserveAspectRatio:Je[rt]+" slice"}),Ct=Xt.makeSvgSpan([ve[rt]],[ft],n);if(be===1)return{span:Ct,minWidth:ie,height:fe};Ct.style.height=Cr(fe),G.push(Ct)}return{span:Xt.makeSpan(["stretchy"],G,n),minWidth:ie,height:fe}}}var{span:a,minWidth:l,height:f}=r();return a.height=f,a.style.height=Cr(f),l>0&&(a.style.minWidth=Cr(l)),a},bTe=function(t,n,r,a,l){var f,i=t.height+t.depth+r+a;if(/fbox|color|angl/.test(n)){if(f=Xt.makeSpan(["stretchy",n],[],l),n==="fbox"){var y=l.color&&l.getColor();y&&(f.style.borderColor=y)}}else{var x=[];/^[bx]cancel$/.test(n)&&x.push(new UO({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(n)&&x.push(new UO({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var S=new Op(x,{width:"100%",height:Cr(i)});f=Xt.makeSvgSpan([],[S],l)}return f.height=i,f.style.height=Cr(i),f},Dp={encloseSpan:bTe,mathMLnode:_Te,svgSpan:xTe};function Gs(e,t){if(!e||e.type!==t)throw new Error("Expected node of type "+t+", but got "+(e?"node of type "+e.type:String(e)));return e}function zD(e){var t=Vk(e);if(!t)throw new Error("Expected node of symbol group type, but got "+(e?"node of type "+e.type:String(e)));return t}function Vk(e){return e&&(e.type==="atom"||q2e.hasOwnProperty(e.type))?e:null}var FD=(e,t)=>{var n,r,a;e&&e.type==="supsub"?(r=Gs(e.base,"accent"),n=r.base,e.base=n,a=H2e(Ia(e,t)),e.base=r):(r=Gs(e,"accent"),n=r.base);var l=Ia(n,t.havingCrampedStyle()),f=r.isShifty&&Na.isCharacterBox(n),i=0;if(f){var y=Na.getBaseElem(n),x=Ia(y,t.havingCrampedStyle());i=c$(x).skew}var S=r.label==="\\c",C=S?l.height+l.depth:Math.min(l.height,t.fontMetrics().xHeight),P;if(r.isStretchy)P=Dp.svgSpan(r,t),P=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:l},{type:"elem",elem:P,wrapperClasses:["svg-align"],wrapperStyle:i>0?{width:"calc(100% - "+Cr(2*i)+")",marginLeft:Cr(2*i)}:void 0}]},t);else{var L,F;r.label==="\\vec"?(L=Xt.staticSvg("vec",t),F=Xt.svgData.vec[1]):(L=Xt.makeOrd({mode:r.mode,text:r.label},t,"textord"),L=c$(L),L.italic=0,F=L.width,S&&(C+=L.depth)),P=Xt.makeSpan(["accent-body"],[L]);var U=r.label==="\\textcircled";U&&(P.classes.push("accent-full"),C=l.height);var q=i;U||(q-=F/2),P.style.left=Cr(q),r.label==="\\textcircled"&&(P.style.top=".2em"),P=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:l},{type:"kern",size:-C},{type:"elem",elem:P}]},t)}var G=Xt.makeSpan(["mord","accent"],[P],t);return a?(a.children[0]=G,a.height=Math.max(G.height,a.height),a.classes[0]="mord",a):G},OJ=(e,t)=>{var n=e.isStretchy?Dp.mathMLnode(e.label):new er.MathNode("mo",[Sd(e.label,e.mode)]),r=new er.MathNode("mover",[eo(e.base,t),n]);return r.setAttribute("accent","true"),r},wTe=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map(e=>"\\"+e).join("|"));Fr({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(e,t)=>{var n=FC(t[0]),r=!wTe.test(e.funcName),a=!r||e.funcName==="\\widehat"||e.funcName==="\\widetilde"||e.funcName==="\\widecheck";return{type:"accent",mode:e.parser.mode,label:e.funcName,isStretchy:r,isShifty:a,base:n}},htmlBuilder:FD,mathmlBuilder:OJ});Fr({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(e,t)=>{var n=t[0],r=e.parser.mode;return r==="math"&&(e.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+e.funcName+" works only in text mode"),r="text"),{type:"accent",mode:r,label:e.funcName,isStretchy:!1,isShifty:!0,base:n}},htmlBuilder:FD,mathmlBuilder:OJ});Fr({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0];return{type:"accentUnder",mode:n.mode,label:r,base:a}},htmlBuilder:(e,t)=>{var n=Ia(e.base,t),r=Dp.svgSpan(e,t),a=e.label==="\\utilde"?.12:0,l=Xt.makeVList({positionType:"top",positionData:n.height,children:[{type:"elem",elem:r,wrapperClasses:["svg-align"]},{type:"kern",size:a},{type:"elem",elem:n}]},t);return Xt.makeSpan(["mord","accentunder"],[l],t)},mathmlBuilder:(e,t)=>{var n=Dp.mathMLnode(e.label),r=new er.MathNode("munder",[eo(e.base,t),n]);return r.setAttribute("accentunder","true"),r}});var r4=e=>{var t=new er.MathNode("mpadded",e?[e]:[]);return t.setAttribute("width","+0.6em"),t.setAttribute("lspace","0.3em"),t};Fr({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(e,t,n){var{parser:r,funcName:a}=e;return{type:"xArrow",mode:r.mode,label:a,body:t[0],below:n[0]}},htmlBuilder(e,t){var n=t.style,r=t.havingStyle(n.sup()),a=Xt.wrapFragment(Ia(e.body,r,t),t),l=e.label.slice(0,2)==="\\x"?"x":"cd";a.classes.push(l+"-arrow-pad");var f;e.below&&(r=t.havingStyle(n.sub()),f=Xt.wrapFragment(Ia(e.below,r,t),t),f.classes.push(l+"-arrow-pad"));var i=Dp.svgSpan(e,t),y=-t.fontMetrics().axisHeight+.5*i.height,x=-t.fontMetrics().axisHeight-.5*i.height-.111;(a.depth>.25||e.label==="\\xleftequilibrium")&&(x-=a.depth);var S;if(f){var C=-t.fontMetrics().axisHeight+f.height+.5*i.height+.111;S=Xt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:a,shift:x},{type:"elem",elem:i,shift:y},{type:"elem",elem:f,shift:C}]},t)}else S=Xt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:a,shift:x},{type:"elem",elem:i,shift:y}]},t);return S.children[0].children[0].children[1].classes.push("svg-align"),Xt.makeSpan(["mrel","x-arrow"],[S],t)},mathmlBuilder(e,t){var n=Dp.mathMLnode(e.label);n.setAttribute("minsize",e.label.charAt(0)==="x"?"1.75em":"3.0em");var r;if(e.body){var a=r4(eo(e.body,t));if(e.below){var l=r4(eo(e.below,t));r=new er.MathNode("munderover",[n,l,a])}else r=new er.MathNode("mover",[n,a])}else if(e.below){var f=r4(eo(e.below,t));r=new er.MathNode("munder",[n,f])}else r=r4(),r=new er.MathNode("mover",[n,r]);return r}});var TTe=Xt.makeSpan;function LJ(e,t){var n=Tl(e.body,t,!0);return TTe([e.mclass],n,t)}function DJ(e,t){var n,r=fc(e.body,t);return e.mclass==="minner"?n=new er.MathNode("mpadded",r):e.mclass==="mord"?e.isCharacterBox?(n=r[0],n.type="mi"):n=new er.MathNode("mi",r):(e.isCharacterBox?(n=r[0],n.type="mo"):n=new er.MathNode("mo",r),e.mclass==="mbin"?(n.attributes.lspace="0.22em",n.attributes.rspace="0.22em"):e.mclass==="mpunct"?(n.attributes.lspace="0em",n.attributes.rspace="0.17em"):e.mclass==="mopen"||e.mclass==="mclose"?(n.attributes.lspace="0em",n.attributes.rspace="0em"):e.mclass==="minner"&&(n.attributes.lspace="0.0556em",n.attributes.width="+0.1111em")),n}Fr({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(e,t){var{parser:n,funcName:r}=e,a=t[0];return{type:"mclass",mode:n.mode,mclass:"m"+r.slice(5),body:tl(a),isCharacterBox:Na.isCharacterBox(a)}},htmlBuilder:LJ,mathmlBuilder:DJ});var $k=e=>{var t=e.type==="ordgroup"&&e.body.length?e.body[0]:e;return t.type==="atom"&&(t.family==="bin"||t.family==="rel")?"m"+t.family:"mord"};Fr({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(e,t){var{parser:n}=e;return{type:"mclass",mode:n.mode,mclass:$k(t[0]),body:tl(t[1]),isCharacterBox:Na.isCharacterBox(t[1])}}});Fr({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(e,t){var{parser:n,funcName:r}=e,a=t[1],l=t[0],f;r!=="\\stackrel"?f=$k(a):f="mrel";var i={type:"op",mode:a.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:r!=="\\stackrel",body:tl(a)},y={type:"supsub",mode:l.mode,base:i,sup:r==="\\underset"?null:l,sub:r==="\\underset"?l:null};return{type:"mclass",mode:n.mode,mclass:f,body:[y],isCharacterBox:Na.isCharacterBox(y)}},htmlBuilder:LJ,mathmlBuilder:DJ});Fr({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"pmb",mode:n.mode,mclass:$k(t[0]),body:tl(t[0])}},htmlBuilder(e,t){var n=Tl(e.body,t,!0),r=Xt.makeSpan([e.mclass],n,t);return r.style.textShadow="0.02em 0.01em 0.04px",r},mathmlBuilder(e,t){var n=fc(e.body,t),r=new er.MathNode("mstyle",n);return r.setAttribute("style","text-shadow: 0.02em 0.01em 0.04px"),r}});var ETe={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},y$=()=>({type:"styling",body:[],mode:"math",style:"display"}),v$=e=>e.type==="textord"&&e.text==="@",STe=(e,t)=>(e.type==="mathord"||e.type==="atom")&&e.text===t;function ATe(e,t,n){var r=ETe[e];switch(r){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return n.callFunction(r,[t[0]],[t[1]]);case"\\uparrow":case"\\downarrow":{var a=n.callFunction("\\\\cdleft",[t[0]],[]),l={type:"atom",text:r,mode:"math",family:"rel"},f=n.callFunction("\\Big",[l],[]),i=n.callFunction("\\\\cdright",[t[1]],[]),y={type:"ordgroup",mode:"math",body:[a,f,i]};return n.callFunction("\\\\cdparent",[y],[])}case"\\\\cdlongequal":return n.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":{var x={type:"textord",text:"\\Vert",mode:"math"};return n.callFunction("\\Big",[x],[])}default:return{type:"textord",text:" ",mode:"math"}}}function CTe(e){var t=[];for(e.gullet.beginGroup(),e.gullet.macros.set("\\cr","\\\\\\relax"),e.gullet.beginGroup();;){t.push(e.parseExpression(!1,"\\\\")),e.gullet.endGroup(),e.gullet.beginGroup();var n=e.fetch().text;if(n==="&"||n==="\\\\")e.consume();else if(n==="\\end"){t[t.length-1].length===0&&t.pop();break}else throw new rr("Expected \\\\ or \\cr or \\end",e.nextToken)}for(var r=[],a=[r],l=0;l<t.length;l++){for(var f=t[l],i=y$(),y=0;y<f.length;y++)if(!v$(f[y]))i.body.push(f[y]);else{r.push(i),y+=1;var x=zD(f[y]).text,S=new Array(2);if(S[0]={type:"ordgroup",mode:"math",body:[]},S[1]={type:"ordgroup",mode:"math",body:[]},!("=|.".indexOf(x)>-1))if("<>AV".indexOf(x)>-1)for(var C=0;C<2;C++){for(var P=!0,L=y+1;L<f.length;L++){if(STe(f[L],x)){P=!1,y=L;break}if(v$(f[L]))throw new rr("Missing a "+x+" character to complete a CD arrow.",f[L]);S[C].body.push(f[L])}if(P)throw new rr("Missing a "+x+" character to complete a CD arrow.",f[y])}else throw new rr('Expected one of "<>AV=|." after @',f[y]);var F=ATe(x,S,e),U={type:"styling",body:[F],mode:"math",style:"display"};r.push(U),i=y$()}l%2===0?r.push(i):r.shift(),r=[],a.push(r)}e.gullet.endGroup(),e.gullet.endGroup();var q=new Array(a[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25});return{type:"array",mode:"math",body:a,arraystretch:1,addJot:!0,rowGaps:[null],cols:q,colSeparationType:"CD",hLinesBeforeRow:new Array(a.length+1).fill([])}}Fr({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:r}=e;return{type:"cdlabel",mode:n.mode,side:r.slice(4),label:t[0]}},htmlBuilder(e,t){var n=t.havingStyle(t.style.sup()),r=Xt.wrapFragment(Ia(e.label,n,t),t);return r.classes.push("cd-label-"+e.side),r.style.bottom=Cr(.8-r.depth),r.height=0,r.depth=0,r},mathmlBuilder(e,t){var n=new er.MathNode("mrow",[eo(e.label,t)]);return n=new er.MathNode("mpadded",[n]),n.setAttribute("width","0"),e.side==="left"&&n.setAttribute("lspace","-1width"),n.setAttribute("voffset","0.7em"),n=new er.MathNode("mstyle",[n]),n.setAttribute("displaystyle","false"),n.setAttribute("scriptlevel","1"),n}});Fr({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(e,t){var{parser:n}=e;return{type:"cdlabelparent",mode:n.mode,fragment:t[0]}},htmlBuilder(e,t){var n=Xt.wrapFragment(Ia(e.fragment,t),t);return n.classes.push("cd-vert-arrow"),n},mathmlBuilder(e,t){return new er.MathNode("mrow",[eo(e.fragment,t)])}});Fr({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(e,t){for(var{parser:n}=e,r=Gs(t[0],"ordgroup"),a=r.body,l="",f=0;f<a.length;f++){var i=Gs(a[f],"textord");l+=i.text}var y=parseInt(l),x;if(isNaN(y))throw new rr("\\@char has non-numeric argument "+l);if(y<0||y>=1114111)throw new rr("\\@char with invalid code point "+l);return y<=65535?x=String.fromCharCode(y):(y-=65536,x=String.fromCharCode((y>>10)+55296,(y&1023)+56320)),{type:"textord",mode:n.mode,text:x}}});var NJ=(e,t)=>{var n=Tl(e.body,t.withColor(e.color),!1);return Xt.makeFragment(n)},zJ=(e,t)=>{var n=fc(e.body,t.withColor(e.color)),r=new er.MathNode("mstyle",n);return r.setAttribute("mathcolor",e.color),r};Fr({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(e,t){var{parser:n}=e,r=Gs(t[0],"color-token").color,a=t[1];return{type:"color",mode:n.mode,color:r,body:tl(a)}},htmlBuilder:NJ,mathmlBuilder:zJ});Fr({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(e,t){var{parser:n,breakOnTokenText:r}=e,a=Gs(t[0],"color-token").color;n.gullet.macros.set("\\current@color",a);var l=n.parseExpression(!0,r);return{type:"color",mode:n.mode,color:a,body:l}},htmlBuilder:NJ,mathmlBuilder:zJ});Fr({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler(e,t,n){var{parser:r}=e,a=r.gullet.future().text==="["?r.parseSizeGroup(!0):null,l=!r.settings.displayMode||!r.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:r.mode,newLine:l,size:a&&Gs(a,"size").value}},htmlBuilder(e,t){var n=Xt.makeSpan(["mspace"],[],t);return e.newLine&&(n.classes.push("newline"),e.size&&(n.style.marginTop=Cr(zo(e.size,t)))),n},mathmlBuilder(e,t){var n=new er.MathNode("mspace");return e.newLine&&(n.setAttribute("linebreak","newline"),e.size&&n.setAttribute("height",Cr(zo(e.size,t)))),n}});var GO={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},FJ=e=>{var t=e.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(t))throw new rr("Expected a control sequence",e);return t},kTe=e=>{var t=e.gullet.popToken();return t.text==="="&&(t=e.gullet.popToken(),t.text===" "&&(t=e.gullet.popToken())),t},BJ=(e,t,n,r)=>{var a=e.gullet.macros.get(n.text);a==null&&(n.noexpand=!0,a={tokens:[n],numArgs:0,unexpandable:!e.gullet.isExpandable(n.text)}),e.gullet.macros.set(t,a,r)};Fr({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(e){var{parser:t,funcName:n}=e;t.consumeSpaces();var r=t.fetch();if(GO[r.text])return(n==="\\global"||n==="\\\\globallong")&&(r.text=GO[r.text]),Gs(t.parseFunction(),"internal");throw new rr("Invalid token after macro prefix",r)}});Fr({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,r=t.gullet.popToken(),a=r.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(a))throw new rr("Expected a control sequence",r);for(var l=0,f,i=[[]];t.gullet.future().text!=="{";)if(r=t.gullet.popToken(),r.text==="#"){if(t.gullet.future().text==="{"){f=t.gullet.future(),i[l].push("{");break}if(r=t.gullet.popToken(),!/^[1-9]$/.test(r.text))throw new rr('Invalid argument number "'+r.text+'"');if(parseInt(r.text)!==l+1)throw new rr('Argument number "'+r.text+'" out of order');l++,i.push([])}else{if(r.text==="EOF")throw new rr("Expected a macro definition");i[l].push(r.text)}var{tokens:y}=t.gullet.consumeArg();return f&&y.unshift(f),(n==="\\edef"||n==="\\xdef")&&(y=t.gullet.expandTokens(y),y.reverse()),t.gullet.macros.set(a,{tokens:y,numArgs:l,delimiters:i},n===GO[n]),{type:"internal",mode:t.mode}}});Fr({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,r=FJ(t.gullet.popToken());t.gullet.consumeSpaces();var a=kTe(t);return BJ(t,r,a,n==="\\\\globallet"),{type:"internal",mode:t.mode}}});Fr({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,r=FJ(t.gullet.popToken()),a=t.gullet.popToken(),l=t.gullet.popToken();return BJ(t,r,l,n==="\\\\globalfuture"),t.gullet.pushToken(l),t.gullet.pushToken(a),{type:"internal",mode:t.mode}}});var x2=function(t,n,r){var a=fo.math[t]&&fo.math[t].replace,l=PD(a||t,n,r);if(!l)throw new Error("Unsupported symbol "+t+" and font size "+n+".");return l},BD=function(t,n,r,a){var l=r.havingBaseStyle(n),f=Xt.makeSpan(a.concat(l.sizingClasses(r)),[t],r),i=l.sizeMultiplier/r.sizeMultiplier;return f.height*=i,f.depth*=i,f.maxFontSize=l.sizeMultiplier,f},jJ=function(t,n,r){var a=n.havingBaseStyle(r),l=(1-n.sizeMultiplier/a.sizeMultiplier)*n.fontMetrics().axisHeight;t.classes.push("delimcenter"),t.style.top=Cr(l),t.height-=l,t.depth+=l},ITe=function(t,n,r,a,l,f){var i=Xt.makeSymbol(t,"Main-Regular",l,a),y=BD(i,n,a,f);return r&&jJ(y,a,n),y},RTe=function(t,n,r,a){return Xt.makeSymbol(t,"Size"+n+"-Regular",r,a)},UJ=function(t,n,r,a,l,f){var i=RTe(t,n,l,a),y=BD(Xt.makeSpan(["delimsizing","size"+n],[i],a),Vi.TEXT,a,f);return r&&jJ(y,a,Vi.TEXT),y},bR=function(t,n,r){var a;n==="Size1-Regular"?a="delim-size1":a="delim-size4";var l=Xt.makeSpan(["delimsizinginner",a],[Xt.makeSpan([],[Xt.makeSymbol(t,n,r)])]);return{type:"elem",elem:l}},wR=function(t,n,r){var a=hf["Size4-Regular"][t.charCodeAt(0)]?hf["Size4-Regular"][t.charCodeAt(0)][4]:hf["Size1-Regular"][t.charCodeAt(0)][4],l=new R0("inner",N2e(t,Math.round(1e3*n))),f=new Op([l],{width:Cr(a),height:Cr(n),style:"width:"+Cr(a),viewBox:"0 0 "+1e3*a+" "+Math.round(1e3*n),preserveAspectRatio:"xMinYMin"}),i=Xt.makeSvgSpan([],[f],r);return i.height=n,i.style.height=Cr(n),i.style.width=Cr(a),{type:"elem",elem:i}},qO=.008,i4={type:"kern",size:-1*qO},MTe=["|","\\lvert","\\rvert","\\vert"],PTe=["\\|","\\lVert","\\rVert","\\Vert"],VJ=function(t,n,r,a,l,f){var i,y,x,S,C="",P=0;i=x=S=t,y=null;var L="Size1-Regular";t==="\\uparrow"?x=S="":t==="\\Uparrow"?x=S="":t==="\\downarrow"?i=x="":t==="\\Downarrow"?i=x="":t==="\\updownarrow"?(i="\\uparrow",x="",S="\\downarrow"):t==="\\Updownarrow"?(i="\\Uparrow",x="",S="\\Downarrow"):MTe.includes(t)?(x="",C="vert",P=333):PTe.includes(t)?(x="",C="doublevert",P=556):t==="["||t==="\\lbrack"?(i="",x="",S="",L="Size4-Regular",C="lbrack",P=667):t==="]"||t==="\\rbrack"?(i="",x="",S="",L="Size4-Regular",C="rbrack",P=667):t==="\\lfloor"||t===""?(x=i="",S="",L="Size4-Regular",C="lfloor",P=667):t==="\\lceil"||t===""?(i="",x=S="",L="Size4-Regular",C="lceil",P=667):t==="\\rfloor"||t===""?(x=i="",S="",L="Size4-Regular",C="rfloor",P=667):t==="\\rceil"||t===""?(i="",x=S="",L="Size4-Regular",C="rceil",P=667):t==="("||t==="\\lparen"?(i="",x="",S="",L="Size4-Regular",C="lparen",P=875):t===")"||t==="\\rparen"?(i="",x="",S="",L="Size4-Regular",C="rparen",P=875):t==="\\{"||t==="\\lbrace"?(i="",y="",S="",x="",L="Size4-Regular"):t==="\\}"||t==="\\rbrace"?(i="",y="",S="",x="",L="Size4-Regular"):t==="\\lgroup"||t===""?(i="",S="",x="",L="Size4-Regular"):t==="\\rgroup"||t===""?(i="",S="",x="",L="Size4-Regular"):t==="\\lmoustache"||t===""?(i="",S="",x="",L="Size4-Regular"):(t==="\\rmoustache"||t==="")&&(i="",S="",x="",L="Size4-Regular");var F=x2(i,L,l),U=F.height+F.depth,q=x2(x,L,l),G=q.height+q.depth,$=x2(S,L,l),X=$.height+$.depth,ie=0,de=1;if(y!==null){var fe=x2(y,L,l);ie=fe.height+fe.depth,de=2}var be=U+X+ie,ve=Math.max(0,Math.ceil((n-be)/(de*G))),Je=be+ve*de*G,we=a.fontMetrics().axisHeight;r&&(we*=a.sizeMultiplier);var rt=Je/2-we,He=[];if(C.length>0){var ft=Je-U-X,Ct=Math.round(Je*1e3),Nt=z2e(C,Math.round(ft*1e3)),Rt=new R0(C,Nt),en=(P/1e3).toFixed(3)+"em",nt=(Ct/1e3).toFixed(3)+"em",pt=new Op([Rt],{width:en,height:nt,viewBox:"0 0 "+P+" "+Ct}),Oe=Xt.makeSvgSpan([],[pt],a);Oe.height=Ct/1e3,Oe.style.width=en,Oe.style.height=nt,He.push({type:"elem",elem:Oe})}else{if(He.push(bR(S,L,l)),He.push(i4),y===null){var gn=Je-U-X+2*qO;He.push(wR(x,gn,a))}else{var wt=(Je-U-X-ie)/2+2*qO;He.push(wR(x,wt,a)),He.push(i4),He.push(bR(y,L,l)),He.push(i4),He.push(wR(x,wt,a))}He.push(i4),He.push(bR(i,L,l))}var Fe=a.havingBaseStyle(Vi.TEXT),jt=Xt.makeVList({positionType:"bottom",positionData:rt,children:He},Fe);return BD(Xt.makeSpan(["delimsizing","mult"],[jt],Fe),Vi.TEXT,a,f)},TR=80,ER=.08,SR=function(t,n,r,a,l){var f=D2e(t,a,r),i=new R0(t,f),y=new Op([i],{width:"400em",height:Cr(n),viewBox:"0 0 400000 "+r,preserveAspectRatio:"xMinYMin slice"});return Xt.makeSvgSpan(["hide-tail"],[y],l)},OTe=function(t,n){var r=n.havingBaseSizing(),a=qJ("\\surd",t*r.sizeMultiplier,GJ,r),l=r.sizeMultiplier,f=Math.max(0,n.minRuleThickness-n.fontMetrics().sqrtRuleThickness),i,y=0,x=0,S=0,C;return a.type==="small"?(S=1e3+1e3*f+TR,t<1?l=1:t<1.4&&(l=.7),y=(1+f+ER)/l,x=(1+f)/l,i=SR("sqrtMain",y,S,f,n),i.style.minWidth="0.853em",C=.833/l):a.type==="large"?(S=(1e3+TR)*L2[a.size],x=(L2[a.size]+f)/l,y=(L2[a.size]+f+ER)/l,i=SR("sqrtSize"+a.size,y,S,f,n),i.style.minWidth="1.02em",C=1/l):(y=t+f+ER,x=t+f,S=Math.floor(1e3*t+f)+TR,i=SR("sqrtTall",y,S,f,n),i.style.minWidth="0.742em",C=1.056),i.height=x,i.style.height=Cr(y),{span:i,advanceWidth:C,ruleWidth:(n.fontMetrics().sqrtRuleThickness+f)*l}},$J=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","\\surd"],LTe=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","",""],HJ=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],L2=[0,1.2,1.8,2.4,3],DTe=function(t,n,r,a,l){if(t==="<"||t==="\\lt"||t===""?t="\\langle":(t===">"||t==="\\gt"||t==="")&&(t="\\rangle"),$J.includes(t)||HJ.includes(t))return UJ(t,n,!1,r,a,l);if(LTe.includes(t))return VJ(t,L2[n],!1,r,a,l);throw new rr("Illegal delimiter: '"+t+"'")},NTe=[{type:"small",style:Vi.SCRIPTSCRIPT},{type:"small",style:Vi.SCRIPT},{type:"small",style:Vi.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],zTe=[{type:"small",style:Vi.SCRIPTSCRIPT},{type:"small",style:Vi.SCRIPT},{type:"small",style:Vi.TEXT},{type:"stack"}],GJ=[{type:"small",style:Vi.SCRIPTSCRIPT},{type:"small",style:Vi.SCRIPT},{type:"small",style:Vi.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],FTe=function(t){if(t.type==="small")return"Main-Regular";if(t.type==="large")return"Size"+t.size+"-Regular";if(t.type==="stack")return"Size4-Regular";throw new Error("Add support for delim type '"+t.type+"' here.")},qJ=function(t,n,r,a){for(var l=Math.min(2,3-a.style.size),f=l;f<r.length&&r[f].type!=="stack";f++){var i=x2(t,FTe(r[f]),"math"),y=i.height+i.depth;if(r[f].type==="small"){var x=a.havingBaseStyle(r[f].style);y*=x.sizeMultiplier}if(y>n)return r[f]}return r[r.length-1]},ZJ=function(t,n,r,a,l,f){t==="<"||t==="\\lt"||t===""?t="\\langle":(t===">"||t==="\\gt"||t==="")&&(t="\\rangle");var i;HJ.includes(t)?i=NTe:$J.includes(t)?i=GJ:i=zTe;var y=qJ(t,n,i,a);return y.type==="small"?ITe(t,y.style,r,a,l,f):y.type==="large"?UJ(t,y.size,r,a,l,f):VJ(t,n,r,a,l,f)},BTe=function(t,n,r,a,l,f){var i=a.fontMetrics().axisHeight*a.sizeMultiplier,y=901,x=5/a.fontMetrics().ptPerEm,S=Math.max(n-i,r+i),C=Math.max(S/500*y,2*S-x);return ZJ(t,C,!0,a,l,f)},Tp={sqrtImage:OTe,sizedDelim:DTe,sizeToMaxHeight:L2,customSizedDelim:ZJ,leftRightDelim:BTe},x$={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},jTe=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","<",">","\\langle","","\\rangle","","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","","","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function Hk(e,t){var n=Vk(e);if(n&&jTe.includes(n.text))return n;throw n?new rr("Invalid delimiter '"+n.text+"' after '"+t.funcName+"'",e):new rr("Invalid delimiter type '"+e.type+"'",e)}Fr({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(e,t)=>{var n=Hk(t[0],e);return{type:"delimsizing",mode:e.parser.mode,size:x$[e.funcName].size,mclass:x$[e.funcName].mclass,delim:n.text}},htmlBuilder:(e,t)=>e.delim==="."?Xt.makeSpan([e.mclass]):Tp.sizedDelim(e.delim,e.size,t,e.mode,[e.mclass]),mathmlBuilder:e=>{var t=[];e.delim!=="."&&t.push(Sd(e.delim,e.mode));var n=new er.MathNode("mo",t);e.mclass==="mopen"||e.mclass==="mclose"?n.setAttribute("fence","true"):n.setAttribute("fence","false"),n.setAttribute("stretchy","true");var r=Cr(Tp.sizeToMaxHeight[e.size]);return n.setAttribute("minsize",r),n.setAttribute("maxsize",r),n}});function b$(e){if(!e.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}Fr({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=e.parser.gullet.macros.get("\\current@color");if(n&&typeof n!="string")throw new rr("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:e.parser.mode,delim:Hk(t[0],e).text,color:n}}});Fr({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=Hk(t[0],e),r=e.parser;++r.leftrightDepth;var a=r.parseExpression(!1);--r.leftrightDepth,r.expect("\\right",!1);var l=Gs(r.parseFunction(),"leftright-right");return{type:"leftright",mode:r.mode,body:a,left:n.text,right:l.delim,rightColor:l.color}},htmlBuilder:(e,t)=>{b$(e);for(var n=Tl(e.body,t,!0,["mopen","mclose"]),r=0,a=0,l=!1,f=0;f<n.length;f++)n[f].isMiddle?l=!0:(r=Math.max(n[f].height,r),a=Math.max(n[f].depth,a));r*=t.sizeMultiplier,a*=t.sizeMultiplier;var i;if(e.left==="."?i=AT(t,["mopen"]):i=Tp.leftRightDelim(e.left,r,a,t,e.mode,["mopen"]),n.unshift(i),l)for(var y=1;y<n.length;y++){var x=n[y],S=x.isMiddle;S&&(n[y]=Tp.leftRightDelim(S.delim,r,a,S.options,e.mode,[]))}var C;if(e.right===".")C=AT(t,["mclose"]);else{var P=e.rightColor?t.withColor(e.rightColor):t;C=Tp.leftRightDelim(e.right,r,a,P,e.mode,["mclose"])}return n.push(C),Xt.makeSpan(["minner"],n,t)},mathmlBuilder:(e,t)=>{b$(e);var n=fc(e.body,t);if(e.left!=="."){var r=new er.MathNode("mo",[Sd(e.left,e.mode)]);r.setAttribute("fence","true"),n.unshift(r)}if(e.right!=="."){var a=new er.MathNode("mo",[Sd(e.right,e.mode)]);a.setAttribute("fence","true"),e.rightColor&&a.setAttribute("mathcolor",e.rightColor),n.push(a)}return DD(n)}});Fr({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=Hk(t[0],e);if(!e.parser.leftrightDepth)throw new rr("\\middle without preceding \\left",n);return{type:"middle",mode:e.parser.mode,delim:n.text}},htmlBuilder:(e,t)=>{var n;if(e.delim===".")n=AT(t,[]);else{n=Tp.sizedDelim(e.delim,1,t,e.mode,[]);var r={delim:e.delim,options:t};n.isMiddle=r}return n},mathmlBuilder:(e,t)=>{var n=e.delim==="\\vert"||e.delim==="|"?Sd("|","text"):Sd(e.delim,e.mode),r=new er.MathNode("mo",[n]);return r.setAttribute("fence","true"),r.setAttribute("lspace","0.05em"),r.setAttribute("rspace","0.05em"),r}});var jD=(e,t)=>{var n=Xt.wrapFragment(Ia(e.body,t),t),r=e.label.slice(1),a=t.sizeMultiplier,l,f=0,i=Na.isCharacterBox(e.body);if(r==="sout")l=Xt.makeSpan(["stretchy","sout"]),l.height=t.fontMetrics().defaultRuleThickness/a,f=-.5*t.fontMetrics().xHeight;else if(r==="phase"){var y=zo({number:.6,unit:"pt"},t),x=zo({number:.35,unit:"ex"},t),S=t.havingBaseSizing();a=a/S.sizeMultiplier;var C=n.height+n.depth+y+x;n.style.paddingLeft=Cr(C/2+y);var P=Math.floor(1e3*C*a),L=O2e(P),F=new Op([new R0("phase",L)],{width:"400em",height:Cr(P/1e3),viewBox:"0 0 400000 "+P,preserveAspectRatio:"xMinYMin slice"});l=Xt.makeSvgSpan(["hide-tail"],[F],t),l.style.height=Cr(C),f=n.depth+y+x}else{/cancel/.test(r)?i||n.classes.push("cancel-pad"):r==="angl"?n.classes.push("anglpad"):n.classes.push("boxpad");var U=0,q=0,G=0;/box/.test(r)?(G=Math.max(t.fontMetrics().fboxrule,t.minRuleThickness),U=t.fontMetrics().fboxsep+(r==="colorbox"?0:G),q=U):r==="angl"?(G=Math.max(t.fontMetrics().defaultRuleThickness,t.minRuleThickness),U=4*G,q=Math.max(0,.25-n.depth)):(U=i?.2:0,q=U),l=Dp.encloseSpan(n,r,U,q,t),/fbox|boxed|fcolorbox/.test(r)?(l.style.borderStyle="solid",l.style.borderWidth=Cr(G)):r==="angl"&&G!==.049&&(l.style.borderTopWidth=Cr(G),l.style.borderRightWidth=Cr(G)),f=n.depth+q,e.backgroundColor&&(l.style.backgroundColor=e.backgroundColor,e.borderColor&&(l.style.borderColor=e.borderColor))}var $;if(e.backgroundColor)$=Xt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:l,shift:f},{type:"elem",elem:n,shift:0}]},t);else{var X=/cancel|phase/.test(r)?["svg-align"]:[];$=Xt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:n,shift:0},{type:"elem",elem:l,shift:f,wrapperClasses:X}]},t)}return/cancel/.test(r)&&($.height=n.height,$.depth=n.depth),/cancel/.test(r)&&!i?Xt.makeSpan(["mord","cancel-lap"],[$],t):Xt.makeSpan(["mord"],[$],t)},UD=(e,t)=>{var n=0,r=new er.MathNode(e.label.indexOf("colorbox")>-1?"mpadded":"menclose",[eo(e.body,t)]);switch(e.label){case"\\cancel":r.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":r.setAttribute("notation","downdiagonalstrike");break;case"\\phase":r.setAttribute("notation","phasorangle");break;case"\\sout":r.setAttribute("notation","horizontalstrike");break;case"\\fbox":r.setAttribute("notation","box");break;case"\\angl":r.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(n=t.fontMetrics().fboxsep*t.fontMetrics().ptPerEm,r.setAttribute("width","+"+2*n+"pt"),r.setAttribute("height","+"+2*n+"pt"),r.setAttribute("lspace",n+"pt"),r.setAttribute("voffset",n+"pt"),e.label==="\\fcolorbox"){var a=Math.max(t.fontMetrics().fboxrule,t.minRuleThickness);r.setAttribute("style","border: "+a+"em solid "+String(e.borderColor))}break;case"\\xcancel":r.setAttribute("notation","updiagonalstrike downdiagonalstrike");break}return e.backgroundColor&&r.setAttribute("mathbackground",e.backgroundColor),r};Fr({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(e,t,n){var{parser:r,funcName:a}=e,l=Gs(t[0],"color-token").color,f=t[1];return{type:"enclose",mode:r.mode,label:a,backgroundColor:l,body:f}},htmlBuilder:jD,mathmlBuilder:UD});Fr({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(e,t,n){var{parser:r,funcName:a}=e,l=Gs(t[0],"color-token").color,f=Gs(t[1],"color-token").color,i=t[2];return{type:"enclose",mode:r.mode,label:a,backgroundColor:f,borderColor:l,body:i}},htmlBuilder:jD,mathmlBuilder:UD});Fr({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"enclose",mode:n.mode,label:"\\fbox",body:t[0]}}});Fr({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:r}=e,a=t[0];return{type:"enclose",mode:n.mode,label:r,body:a}},htmlBuilder:jD,mathmlBuilder:UD});Fr({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(e,t){var{parser:n}=e;return{type:"enclose",mode:n.mode,label:"\\angl",body:t[0]}}});var WJ={};function Af(e){for(var{type:t,names:n,props:r,handler:a,htmlBuilder:l,mathmlBuilder:f}=e,i={type:t,numArgs:r.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:a},y=0;y<n.length;++y)WJ[n[y]]=i;l&&(NC[t]=l),f&&(zC[t]=f)}var XJ={};function De(e,t){XJ[e]=t}function w$(e){var t=[];e.consumeSpaces();var n=e.fetch().text;for(n==="\\relax"&&(e.consume(),e.consumeSpaces(),n=e.fetch().text);n==="\\hline"||n==="\\hdashline";)e.consume(),t.push(n==="\\hdashline"),e.consumeSpaces(),n=e.fetch().text;return t}var Gk=e=>{var t=e.parser.settings;if(!t.displayMode)throw new rr("{"+e.envName+"} can be used only in display mode.")};function VD(e){if(e.indexOf("ed")===-1)return e.indexOf("*")===-1}function U0(e,t,n){var{hskipBeforeAndAfter:r,addJot:a,cols:l,arraystretch:f,colSeparationType:i,autoTag:y,singleRow:x,emptySingleRow:S,maxNumCols:C,leqno:P}=t;if(e.gullet.beginGroup(),x||e.gullet.macros.set("\\cr","\\\\\\relax"),!f){var L=e.gullet.expandMacroAsText("\\arraystretch");if(L==null)f=1;else if(f=parseFloat(L),!f||f<0)throw new rr("Invalid \\arraystretch: "+L)}e.gullet.beginGroup();var F=[],U=[F],q=[],G=[],$=y!=null?[]:void 0;function X(){y&&e.gullet.macros.set("\\@eqnsw","1",!0)}function ie(){$&&(e.gullet.macros.get("\\df@tag")?($.push(e.subparse([new Bc("\\df@tag")])),e.gullet.macros.set("\\df@tag",void 0,!0)):$.push(!!y&&e.gullet.macros.get("\\@eqnsw")==="1"))}for(X(),G.push(w$(e));;){var de=e.parseExpression(!1,x?"\\end":"\\\\");e.gullet.endGroup(),e.gullet.beginGroup(),de={type:"ordgroup",mode:e.mode,body:de},n&&(de={type:"styling",mode:e.mode,style:n,body:[de]}),F.push(de);var fe=e.fetch().text;if(fe==="&"){if(C&&F.length===C){if(x||i)throw new rr("Too many tab characters: &",e.nextToken);e.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}e.consume()}else if(fe==="\\end"){ie(),F.length===1&&de.type==="styling"&&de.body[0].body.length===0&&(U.length>1||!S)&&U.pop(),G.length<U.length+1&&G.push([]);break}else if(fe==="\\\\"){e.consume();var be=void 0;e.gullet.future().text!==" "&&(be=e.parseSizeGroup(!0)),q.push(be?be.value:null),ie(),G.push(w$(e)),F=[],U.push(F),X()}else throw new rr("Expected & or \\\\ or \\cr or \\end",e.nextToken)}return e.gullet.endGroup(),e.gullet.endGroup(),{type:"array",mode:e.mode,addJot:a,arraystretch:f,body:U,cols:l,rowGaps:q,hskipBeforeAndAfter:r,hLinesBeforeRow:G,colSeparationType:i,tags:$,leqno:P}}function $D(e){return e.slice(0,1)==="d"?"display":"text"}var Cf=function(t,n){var r,a,l=t.body.length,f=t.hLinesBeforeRow,i=0,y=new Array(l),x=[],S=Math.max(n.fontMetrics().arrayRuleWidth,n.minRuleThickness),C=1/n.fontMetrics().ptPerEm,P=5*C;if(t.colSeparationType&&t.colSeparationType==="small"){var L=n.havingStyle(Vi.SCRIPT).sizeMultiplier;P=.2778*(L/n.sizeMultiplier)}var F=t.colSeparationType==="CD"?zo({number:3,unit:"ex"},n):12*C,U=3*C,q=t.arraystretch*F,G=.7*q,$=.3*q,X=0;function ie(Vn){for(var wr=0;wr<Vn.length;++wr)wr>0&&(X+=.25),x.push({pos:X,isDashed:Vn[wr]})}for(ie(f[0]),r=0;r<t.body.length;++r){var de=t.body[r],fe=G,be=$;i<de.length&&(i=de.length);var ve=new Array(de.length);for(a=0;a<de.length;++a){var Je=Ia(de[a],n);be<Je.depth&&(be=Je.depth),fe<Je.height&&(fe=Je.height),ve[a]=Je}var we=t.rowGaps[r],rt=0;we&&(rt=zo(we,n),rt>0&&(rt+=$,be<rt&&(be=rt),rt=0)),t.addJot&&(be+=U),ve.height=fe,ve.depth=be,X+=fe,ve.pos=X,X+=be+rt,y[r]=ve,ie(f[r+1])}var He=X/2+n.fontMetrics().axisHeight,ft=t.cols||[],Ct=[],Nt,Rt,en=[];if(t.tags&&t.tags.some(Vn=>Vn))for(r=0;r<l;++r){var nt=y[r],pt=nt.pos-He,Oe=t.tags[r],gn=void 0;Oe===!0?gn=Xt.makeSpan(["eqn-num"],[],n):Oe===!1?gn=Xt.makeSpan([],[],n):gn=Xt.makeSpan([],Tl(Oe,n,!0),n),gn.depth=nt.depth,gn.height=nt.height,en.push({type:"elem",elem:gn,shift:pt})}for(a=0,Rt=0;a<i||Rt<ft.length;++a,++Rt){for(var wt=ft[Rt]||{},Fe=!0;wt.type==="separator";){if(Fe||(Nt=Xt.makeSpan(["arraycolsep"],[]),Nt.style.width=Cr(n.fontMetrics().doubleRuleSep),Ct.push(Nt)),wt.separator==="|"||wt.separator===":"){var jt=wt.separator==="|"?"solid":"dashed",Tn=Xt.makeSpan(["vertical-separator"],[],n);Tn.style.height=Cr(X),Tn.style.borderRightWidth=Cr(S),Tn.style.borderRightStyle=jt,Tn.style.margin="0 "+Cr(-S/2);var mn=X-He;mn&&(Tn.style.verticalAlign=Cr(-mn)),Ct.push(Tn)}else throw new rr("Invalid separator type: "+wt.separator);Rt++,wt=ft[Rt]||{},Fe=!1}if(!(a>=i)){var zn=void 0;(a>0||t.hskipBeforeAndAfter)&&(zn=Na.deflt(wt.pregap,P),zn!==0&&(Nt=Xt.makeSpan(["arraycolsep"],[]),Nt.style.width=Cr(zn),Ct.push(Nt)));var yn=[];for(r=0;r<l;++r){var qt=y[r],wn=qt[a];if(wn){var Sn=qt.pos-He;wn.depth=qt.depth,wn.height=qt.height,yn.push({type:"elem",elem:wn,shift:Sn})}}yn=Xt.makeVList({positionType:"individualShift",children:yn},n),yn=Xt.makeSpan(["col-align-"+(wt.align||"c")],[yn]),Ct.push(yn),(a<i-1||t.hskipBeforeAndAfter)&&(zn=Na.deflt(wt.postgap,P),zn!==0&&(Nt=Xt.makeSpan(["arraycolsep"],[]),Nt.style.width=Cr(zn),Ct.push(Nt)))}}if(y=Xt.makeSpan(["mtable"],Ct),x.length>0){for(var Xn=Xt.makeLineSpan("hline",n,S),rn=Xt.makeLineSpan("hdashline",n,S),br=[{type:"elem",elem:y,shift:0}];x.length>0;){var Qr=x.pop(),sr=Qr.pos-He;Qr.isDashed?br.push({type:"elem",elem:rn,shift:sr}):br.push({type:"elem",elem:Xn,shift:sr})}y=Xt.makeVList({positionType:"individualShift",children:br},n)}if(en.length===0)return Xt.makeSpan(["mord"],[y],n);var ar=Xt.makeVList({positionType:"individualShift",children:en},n);return ar=Xt.makeSpan(["tag"],[ar],n),Xt.makeFragment([y,ar])},UTe={c:"center ",l:"left ",r:"right "},kf=function(t,n){for(var r=[],a=new er.MathNode("mtd",[],["mtr-glue"]),l=new er.MathNode("mtd",[],["mml-eqn-num"]),f=0;f<t.body.length;f++){for(var i=t.body[f],y=[],x=0;x<i.length;x++)y.push(new er.MathNode("mtd",[eo(i[x],n)]));t.tags&&t.tags[f]&&(y.unshift(a),y.push(a),t.leqno?y.unshift(l):y.push(l)),r.push(new er.MathNode("mtr",y))}var S=new er.MathNode("mtable",r),C=t.arraystretch===.5?.1:.16+t.arraystretch-1+(t.addJot?.09:0);S.setAttribute("rowspacing",Cr(C));var P="",L="";if(t.cols&&t.cols.length>0){var F=t.cols,U="",q=!1,G=0,$=F.length;F[0].type==="separator"&&(P+="top ",G=1),F[F.length-1].type==="separator"&&(P+="bottom ",$-=1);for(var X=G;X<$;X++)F[X].type==="align"?(L+=UTe[F[X].align],q&&(U+="none "),q=!0):F[X].type==="separator"&&q&&(U+=F[X].separator==="|"?"solid ":"dashed ",q=!1);S.setAttribute("columnalign",L.trim()),/[sd]/.test(U)&&S.setAttribute("columnlines",U.trim())}if(t.colSeparationType==="align"){for(var ie=t.cols||[],de="",fe=1;fe<ie.length;fe++)de+=fe%2?"0em ":"1em ";S.setAttribute("columnspacing",de.trim())}else t.colSeparationType==="alignat"||t.colSeparationType==="gather"?S.setAttribute("columnspacing","0em"):t.colSeparationType==="small"?S.setAttribute("columnspacing","0.2778em"):t.colSeparationType==="CD"?S.setAttribute("columnspacing","0.5em"):S.setAttribute("columnspacing","1em");var be="",ve=t.hLinesBeforeRow;P+=ve[0].length>0?"left ":"",P+=ve[ve.length-1].length>0?"right ":"";for(var Je=1;Je<ve.length-1;Je++)be+=ve[Je].length===0?"none ":ve[Je][0]?"dashed ":"solid ";return/[sd]/.test(be)&&S.setAttribute("rowlines",be.trim()),P!==""&&(S=new er.MathNode("menclose",[S]),S.setAttribute("notation",P.trim())),t.arraystretch&&t.arraystretch<1&&(S=new er.MathNode("mstyle",[S]),S.setAttribute("scriptlevel","1")),S},YJ=function(t,n){t.envName.indexOf("ed")===-1&&Gk(t);var r=[],a=t.envName.indexOf("at")>-1?"alignat":"align",l=t.envName==="split",f=U0(t.parser,{cols:r,addJot:!0,autoTag:l?void 0:VD(t.envName),emptySingleRow:!0,colSeparationType:a,maxNumCols:l?2:void 0,leqno:t.parser.settings.leqno},"display"),i,y=0,x={type:"ordgroup",mode:t.mode,body:[]};if(n[0]&&n[0].type==="ordgroup"){for(var S="",C=0;C<n[0].body.length;C++){var P=Gs(n[0].body[C],"textord");S+=P.text}i=Number(S),y=i*2}var L=!y;f.body.forEach(function(G){for(var $=1;$<G.length;$+=2){var X=Gs(G[$],"styling"),ie=Gs(X.body[0],"ordgroup");ie.body.unshift(x)}if(L)y<G.length&&(y=G.length);else{var de=G.length/2;if(i<de)throw new rr("Too many math in a row: "+("expected "+i+", but got "+de),G[0])}});for(var F=0;F<y;++F){var U="r",q=0;F%2===1?U="l":F>0&&L&&(q=1),r[F]={type:"align",align:U,pregap:q,postgap:0}}return f.colSeparationType=L?"align":"alignat",f};Af({type:"array",names:["array","darray"],props:{numArgs:1},handler(e,t){var n=Vk(t[0]),r=n?[t[0]]:Gs(t[0],"ordgroup").body,a=r.map(function(f){var i=zD(f),y=i.text;if("lcr".indexOf(y)!==-1)return{type:"align",align:y};if(y==="|")return{type:"separator",separator:"|"};if(y===":")return{type:"separator",separator:":"};throw new rr("Unknown column alignment: "+y,f)}),l={cols:a,hskipBeforeAndAfter:!0,maxNumCols:a.length};return U0(e.parser,l,$D(e.envName))},htmlBuilder:Cf,mathmlBuilder:kf});Af({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(e){var t={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[e.envName.replace("*","")],n="c",r={hskipBeforeAndAfter:!1,cols:[{type:"align",align:n}]};if(e.envName.charAt(e.envName.length-1)==="*"){var a=e.parser;if(a.consumeSpaces(),a.fetch().text==="["){if(a.consume(),a.consumeSpaces(),n=a.fetch().text,"lcr".indexOf(n)===-1)throw new rr("Expected l or c or r",a.nextToken);a.consume(),a.consumeSpaces(),a.expect("]"),a.consume(),r.cols=[{type:"align",align:n}]}}var l=U0(e.parser,r,$D(e.envName)),f=Math.max(0,...l.body.map(i=>i.length));return l.cols=new Array(f).fill({type:"align",align:n}),t?{type:"leftright",mode:e.mode,body:[l],left:t[0],right:t[1],rightColor:void 0}:l},htmlBuilder:Cf,mathmlBuilder:kf});Af({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(e){var t={arraystretch:.5},n=U0(e.parser,t,"script");return n.colSeparationType="small",n},htmlBuilder:Cf,mathmlBuilder:kf});Af({type:"array",names:["subarray"],props:{numArgs:1},handler(e,t){var n=Vk(t[0]),r=n?[t[0]]:Gs(t[0],"ordgroup").body,a=r.map(function(f){var i=zD(f),y=i.text;if("lc".indexOf(y)!==-1)return{type:"align",align:y};throw new rr("Unknown column alignment: "+y,f)});if(a.length>1)throw new rr("{subarray} can contain only one column");var l={cols:a,hskipBeforeAndAfter:!1,arraystretch:.5};if(l=U0(e.parser,l,"script"),l.body.length>0&&l.body[0].length>1)throw new rr("{subarray} can contain only one column");return l},htmlBuilder:Cf,mathmlBuilder:kf});Af({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(e){var t={arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},n=U0(e.parser,t,$D(e.envName));return{type:"leftright",mode:e.mode,body:[n],left:e.envName.indexOf("r")>-1?".":"\\{",right:e.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:Cf,mathmlBuilder:kf});Af({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:YJ,htmlBuilder:Cf,mathmlBuilder:kf});Af({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(e){["gather","gather*"].includes(e.envName)&&Gk(e);var t={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:VD(e.envName),emptySingleRow:!0,leqno:e.parser.settings.leqno};return U0(e.parser,t,"display")},htmlBuilder:Cf,mathmlBuilder:kf});Af({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:YJ,htmlBuilder:Cf,mathmlBuilder:kf});Af({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(e){Gk(e);var t={autoTag:VD(e.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:e.parser.settings.leqno};return U0(e.parser,t,"display")},htmlBuilder:Cf,mathmlBuilder:kf});Af({type:"array",names:["CD"],props:{numArgs:0},handler(e){return Gk(e),CTe(e.parser)},htmlBuilder:Cf,mathmlBuilder:kf});De("\\nonumber","\\gdef\\@eqnsw{0}");De("\\notag","\\nonumber");Fr({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(e,t){throw new rr(e.funcName+" valid only within array environment")}});var T$=WJ;Fr({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(e,t){var{parser:n,funcName:r}=e,a=t[0];if(a.type!=="ordgroup")throw new rr("Invalid environment name",a);for(var l="",f=0;f<a.body.length;++f)l+=Gs(a.body[f],"textord").text;if(r==="\\begin"){if(!T$.hasOwnProperty(l))throw new rr("No such environment: "+l,a);var i=T$[l],{args:y,optArgs:x}=n.parseArguments("\\begin{"+l+"}",i),S={mode:n.mode,envName:l,parser:n},C=i.handler(S,y,x);n.expect("\\end",!1);var P=n.nextToken,L=Gs(n.parseFunction(),"environment");if(L.name!==l)throw new rr("Mismatch: \\begin{"+l+"} matched by \\end{"+L.name+"}",P);return C}return{type:"environment",mode:n.mode,name:l,nameGroup:a}}});var KJ=(e,t)=>{var n=e.font,r=t.withFont(n);return Ia(e.body,r)},QJ=(e,t)=>{var n=e.font,r=t.withFont(n);return eo(e.body,r)},E$={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};Fr({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathsfit","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=FC(t[0]),l=r;return l in E$&&(l=E$[l]),{type:"font",mode:n.mode,font:l.slice(1),body:a}},htmlBuilder:KJ,mathmlBuilder:QJ});Fr({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(e,t)=>{var{parser:n}=e,r=t[0],a=Na.isCharacterBox(r);return{type:"mclass",mode:n.mode,mclass:$k(r),body:[{type:"font",mode:n.mode,font:"boldsymbol",body:r}],isCharacterBox:a}}});Fr({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(e,t)=>{var{parser:n,funcName:r,breakOnTokenText:a}=e,{mode:l}=n,f=n.parseExpression(!0,a),i="math"+r.slice(1);return{type:"font",mode:l,font:i,body:{type:"ordgroup",mode:n.mode,body:f}}},htmlBuilder:KJ,mathmlBuilder:QJ});var JJ=(e,t)=>{var n=t;return e==="display"?n=n.id>=Vi.SCRIPT.id?n.text():Vi.DISPLAY:e==="text"&&n.size===Vi.DISPLAY.size?n=Vi.TEXT:e==="script"?n=Vi.SCRIPT:e==="scriptscript"&&(n=Vi.SCRIPTSCRIPT),n},HD=(e,t)=>{var n=JJ(e.size,t.style),r=n.fracNum(),a=n.fracDen(),l;l=t.havingStyle(r);var f=Ia(e.numer,l,t);if(e.continued){var i=8.5/t.fontMetrics().ptPerEm,y=3.5/t.fontMetrics().ptPerEm;f.height=f.height<i?i:f.height,f.depth=f.depth<y?y:f.depth}l=t.havingStyle(a);var x=Ia(e.denom,l,t),S,C,P;e.hasBarLine?(e.barSize?(C=zo(e.barSize,t),S=Xt.makeLineSpan("frac-line",t,C)):S=Xt.makeLineSpan("frac-line",t),C=S.height,P=S.height):(S=null,C=0,P=t.fontMetrics().defaultRuleThickness);var L,F,U;n.size===Vi.DISPLAY.size||e.size==="display"?(L=t.fontMetrics().num1,C>0?F=3*P:F=7*P,U=t.fontMetrics().denom1):(C>0?(L=t.fontMetrics().num2,F=P):(L=t.fontMetrics().num3,F=3*P),U=t.fontMetrics().denom2);var q;if(S){var $=t.fontMetrics().axisHeight;L-f.depth-($+.5*C)<F&&(L+=F-(L-f.depth-($+.5*C))),$-.5*C-(x.height-U)<F&&(U+=F-($-.5*C-(x.height-U)));var X=-($-.5*C);q=Xt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:x,shift:U},{type:"elem",elem:S,shift:X},{type:"elem",elem:f,shift:-L}]},t)}else{var G=L-f.depth-(x.height-U);G<F&&(L+=.5*(F-G),U+=.5*(F-G)),q=Xt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:x,shift:U},{type:"elem",elem:f,shift:-L}]},t)}l=t.havingStyle(n),q.height*=l.sizeMultiplier/t.sizeMultiplier,q.depth*=l.sizeMultiplier/t.sizeMultiplier;var ie;n.size===Vi.DISPLAY.size?ie=t.fontMetrics().delim1:n.size===Vi.SCRIPTSCRIPT.size?ie=t.havingStyle(Vi.SCRIPT).fontMetrics().delim2:ie=t.fontMetrics().delim2;var de,fe;return e.leftDelim==null?de=AT(t,["mopen"]):de=Tp.customSizedDelim(e.leftDelim,ie,!0,t.havingStyle(n),e.mode,["mopen"]),e.continued?fe=Xt.makeSpan([]):e.rightDelim==null?fe=AT(t,["mclose"]):fe=Tp.customSizedDelim(e.rightDelim,ie,!0,t.havingStyle(n),e.mode,["mclose"]),Xt.makeSpan(["mord"].concat(l.sizingClasses(t)),[de,Xt.makeSpan(["mfrac"],[q]),fe],t)},GD=(e,t)=>{var n=new er.MathNode("mfrac",[eo(e.numer,t),eo(e.denom,t)]);if(!e.hasBarLine)n.setAttribute("linethickness","0px");else if(e.barSize){var r=zo(e.barSize,t);n.setAttribute("linethickness",Cr(r))}var a=JJ(e.size,t.style);if(a.size!==t.style.size){n=new er.MathNode("mstyle",[n]);var l=a.size===Vi.DISPLAY.size?"true":"false";n.setAttribute("displaystyle",l),n.setAttribute("scriptlevel","0")}if(e.leftDelim!=null||e.rightDelim!=null){var f=[];if(e.leftDelim!=null){var i=new er.MathNode("mo",[new er.TextNode(e.leftDelim.replace("\\",""))]);i.setAttribute("fence","true"),f.push(i)}if(f.push(n),e.rightDelim!=null){var y=new er.MathNode("mo",[new er.TextNode(e.rightDelim.replace("\\",""))]);y.setAttribute("fence","true"),f.push(y)}return DD(f)}return n};Fr({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0],l=t[1],f,i=null,y=null,x="auto";switch(r){case"\\dfrac":case"\\frac":case"\\tfrac":f=!0;break;case"\\\\atopfrac":f=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":f=!1,i="(",y=")";break;case"\\\\bracefrac":f=!1,i="\\{",y="\\}";break;case"\\\\brackfrac":f=!1,i="[",y="]";break;default:throw new Error("Unrecognized genfrac command")}switch(r){case"\\dfrac":case"\\dbinom":x="display";break;case"\\tfrac":case"\\tbinom":x="text";break}return{type:"genfrac",mode:n.mode,continued:!1,numer:a,denom:l,hasBarLine:f,leftDelim:i,rightDelim:y,size:x,barSize:null}},htmlBuilder:HD,mathmlBuilder:GD});Fr({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0],l=t[1];return{type:"genfrac",mode:n.mode,continued:!0,numer:a,denom:l,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}});Fr({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(e){var{parser:t,funcName:n,token:r}=e,a;switch(n){case"\\over":a="\\frac";break;case"\\choose":a="\\binom";break;case"\\atop":a="\\\\atopfrac";break;case"\\brace":a="\\\\bracefrac";break;case"\\brack":a="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:t.mode,replaceWith:a,token:r}}});var S$=["display","text","script","scriptscript"],A$=function(t){var n=null;return t.length>0&&(n=t,n=n==="."?null:n),n};Fr({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(e,t){var{parser:n}=e,r=t[4],a=t[5],l=FC(t[0]),f=l.type==="atom"&&l.family==="open"?A$(l.text):null,i=FC(t[1]),y=i.type==="atom"&&i.family==="close"?A$(i.text):null,x=Gs(t[2],"size"),S,C=null;x.isBlank?S=!0:(C=x.value,S=C.number>0);var P="auto",L=t[3];if(L.type==="ordgroup"){if(L.body.length>0){var F=Gs(L.body[0],"textord");P=S$[Number(F.text)]}}else L=Gs(L,"textord"),P=S$[Number(L.text)];return{type:"genfrac",mode:n.mode,numer:r,denom:a,continued:!1,hasBarLine:S,barSize:C,leftDelim:f,rightDelim:y,size:P}},htmlBuilder:HD,mathmlBuilder:GD});Fr({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(e,t){var{parser:n,funcName:r,token:a}=e;return{type:"infix",mode:n.mode,replaceWith:"\\\\abovefrac",size:Gs(t[0],"size").value,token:a}}});Fr({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0],l=y2e(Gs(t[1],"infix").size),f=t[2],i=l.number>0;return{type:"genfrac",mode:n.mode,numer:a,denom:f,continued:!1,hasBarLine:i,barSize:l,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:HD,mathmlBuilder:GD});var eee=(e,t)=>{var n=t.style,r,a;e.type==="supsub"?(r=e.sup?Ia(e.sup,t.havingStyle(n.sup()),t):Ia(e.sub,t.havingStyle(n.sub()),t),a=Gs(e.base,"horizBrace")):a=Gs(e,"horizBrace");var l=Ia(a.base,t.havingBaseStyle(Vi.DISPLAY)),f=Dp.svgSpan(a,t),i;if(a.isOver?(i=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:l},{type:"kern",size:.1},{type:"elem",elem:f}]},t),i.children[0].children[0].children[1].classes.push("svg-align")):(i=Xt.makeVList({positionType:"bottom",positionData:l.depth+.1+f.height,children:[{type:"elem",elem:f},{type:"kern",size:.1},{type:"elem",elem:l}]},t),i.children[0].children[0].children[0].classes.push("svg-align")),r){var y=Xt.makeSpan(["mord",a.isOver?"mover":"munder"],[i],t);a.isOver?i=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:y},{type:"kern",size:.2},{type:"elem",elem:r}]},t):i=Xt.makeVList({positionType:"bottom",positionData:y.depth+.2+r.height+r.depth,children:[{type:"elem",elem:r},{type:"kern",size:.2},{type:"elem",elem:y}]},t)}return Xt.makeSpan(["mord",a.isOver?"mover":"munder"],[i],t)},VTe=(e,t)=>{var n=Dp.mathMLnode(e.label);return new er.MathNode(e.isOver?"mover":"munder",[eo(e.base,t),n])};Fr({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:r}=e;return{type:"horizBrace",mode:n.mode,label:r,isOver:/^\\over/.test(r),base:t[0]}},htmlBuilder:eee,mathmlBuilder:VTe});Fr({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[1],a=Gs(t[0],"url").url;return n.settings.isTrusted({command:"\\href",url:a})?{type:"href",mode:n.mode,href:a,body:tl(r)}:n.formatUnsupportedCmd("\\href")},htmlBuilder:(e,t)=>{var n=Tl(e.body,t,!1);return Xt.makeAnchor(e.href,[],n,t)},mathmlBuilder:(e,t)=>{var n=M0(e.body,t);return n instanceof Lc||(n=new Lc("mrow",[n])),n.setAttribute("href",e.href),n}});Fr({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=Gs(t[0],"url").url;if(!n.settings.isTrusted({command:"\\url",url:r}))return n.formatUnsupportedCmd("\\url");for(var a=[],l=0;l<r.length;l++){var f=r[l];f==="~"&&(f="\\textasciitilde"),a.push({type:"textord",mode:"text",text:f})}var i={type:"text",mode:n.mode,font:"\\texttt",body:a};return{type:"href",mode:n.mode,href:r,body:tl(i)}}});Fr({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(e,t){var{parser:n}=e;return{type:"hbox",mode:n.mode,body:tl(t[0])}},htmlBuilder(e,t){var n=Tl(e.body,t,!1);return Xt.makeFragment(n)},mathmlBuilder(e,t){return new er.MathNode("mrow",fc(e.body,t))}});Fr({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(e,t)=>{var{parser:n,funcName:r,token:a}=e,l=Gs(t[0],"raw").string,f=t[1];n.settings.strict&&n.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var i,y={};switch(r){case"\\htmlClass":y.class=l,i={command:"\\htmlClass",class:l};break;case"\\htmlId":y.id=l,i={command:"\\htmlId",id:l};break;case"\\htmlStyle":y.style=l,i={command:"\\htmlStyle",style:l};break;case"\\htmlData":{for(var x=l.split(","),S=0;S<x.length;S++){var C=x[S],P=C.indexOf("=");if(P<0)throw new rr("\\htmlData key/value '"+C+"' missing equals sign");var L=C.slice(0,P),F=C.slice(P+1);y["data-"+L.trim()]=F}i={command:"\\htmlData",attributes:y};break}default:throw new Error("Unrecognized html command")}return n.settings.isTrusted(i)?{type:"html",mode:n.mode,attributes:y,body:tl(f)}:n.formatUnsupportedCmd(r)},htmlBuilder:(e,t)=>{var n=Tl(e.body,t,!1),r=["enclosing"];e.attributes.class&&r.push(...e.attributes.class.trim().split(/\s+/));var a=Xt.makeSpan(r,n,t);for(var l in e.attributes)l!=="class"&&e.attributes.hasOwnProperty(l)&&a.setAttribute(l,e.attributes[l]);return a},mathmlBuilder:(e,t)=>M0(e.body,t)});Fr({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e;return{type:"htmlmathml",mode:n.mode,html:tl(t[0]),mathml:tl(t[1])}},htmlBuilder:(e,t)=>{var n=Tl(e.html,t,!1);return Xt.makeFragment(n)},mathmlBuilder:(e,t)=>M0(e.mathml,t)});var AR=function(t){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(t))return{number:+t,unit:"bp"};var n=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(t);if(!n)throw new rr("Invalid size: '"+t+"' in \\includegraphics");var r={number:+(n[1]+n[2]),unit:n[3]};if(!vJ(r))throw new rr("Invalid unit: '"+r.unit+"' in \\includegraphics.");return r};Fr({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(e,t,n)=>{var{parser:r}=e,a={number:0,unit:"em"},l={number:.9,unit:"em"},f={number:0,unit:"em"},i="";if(n[0])for(var y=Gs(n[0],"raw").string,x=y.split(","),S=0;S<x.length;S++){var C=x[S].split("=");if(C.length===2){var P=C[1].trim();switch(C[0].trim()){case"alt":i=P;break;case"width":a=AR(P);break;case"height":l=AR(P);break;case"totalheight":f=AR(P);break;default:throw new rr("Invalid key: '"+C[0]+"' in \\includegraphics.")}}}var L=Gs(t[0],"url").url;return i===""&&(i=L,i=i.replace(/^.*[\\/]/,""),i=i.substring(0,i.lastIndexOf("."))),r.settings.isTrusted({command:"\\includegraphics",url:L})?{type:"includegraphics",mode:r.mode,alt:i,width:a,height:l,totalheight:f,src:L}:r.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(e,t)=>{var n=zo(e.height,t),r=0;e.totalheight.number>0&&(r=zo(e.totalheight,t)-n);var a=0;e.width.number>0&&(a=zo(e.width,t));var l={height:Cr(n+r)};a>0&&(l.width=Cr(a)),r>0&&(l.verticalAlign=Cr(-r));var f=new V2e(e.src,e.alt,l);return f.height=n,f.depth=r,f},mathmlBuilder:(e,t)=>{var n=new er.MathNode("mglyph",[]);n.setAttribute("alt",e.alt);var r=zo(e.height,t),a=0;if(e.totalheight.number>0&&(a=zo(e.totalheight,t)-r,n.setAttribute("valign",Cr(-a))),n.setAttribute("height",Cr(r+a)),e.width.number>0){var l=zo(e.width,t);n.setAttribute("width",Cr(l))}return n.setAttribute("src",e.src),n}});Fr({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(e,t){var{parser:n,funcName:r}=e,a=Gs(t[0],"size");if(n.settings.strict){var l=r[1]==="m",f=a.value.unit==="mu";l?(f||n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" supports only mu units, "+("not "+a.value.unit+" units")),n.mode!=="math"&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" works only in math mode")):f&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" doesn't support mu units")}return{type:"kern",mode:n.mode,dimension:a.value}},htmlBuilder(e,t){return Xt.makeGlue(e.dimension,t)},mathmlBuilder(e,t){var n=zo(e.dimension,t);return new er.SpaceNode(n)}});Fr({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0];return{type:"lap",mode:n.mode,alignment:r.slice(5),body:a}},htmlBuilder:(e,t)=>{var n;e.alignment==="clap"?(n=Xt.makeSpan([],[Ia(e.body,t)]),n=Xt.makeSpan(["inner"],[n],t)):n=Xt.makeSpan(["inner"],[Ia(e.body,t)]);var r=Xt.makeSpan(["fix"],[]),a=Xt.makeSpan([e.alignment],[n,r],t),l=Xt.makeSpan(["strut"]);return l.style.height=Cr(a.height+a.depth),a.depth&&(l.style.verticalAlign=Cr(-a.depth)),a.children.unshift(l),a=Xt.makeSpan(["thinbox"],[a],t),Xt.makeSpan(["mord","vbox"],[a],t)},mathmlBuilder:(e,t)=>{var n=new er.MathNode("mpadded",[eo(e.body,t)]);if(e.alignment!=="rlap"){var r=e.alignment==="llap"?"-1":"-0.5";n.setAttribute("lspace",r+"width")}return n.setAttribute("width","0px"),n}});Fr({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(e,t){var{funcName:n,parser:r}=e,a=r.mode;r.switchMode("math");var l=n==="\\("?"\\)":"$",f=r.parseExpression(!1,l);return r.expect(l),r.switchMode(a),{type:"styling",mode:r.mode,style:"text",body:f}}});Fr({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(e,t){throw new rr("Mismatched "+e.funcName)}});var C$=(e,t)=>{switch(t.style.size){case Vi.DISPLAY.size:return e.display;case Vi.TEXT.size:return e.text;case Vi.SCRIPT.size:return e.script;case Vi.SCRIPTSCRIPT.size:return e.scriptscript;default:return e.text}};Fr({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(e,t)=>{var{parser:n}=e;return{type:"mathchoice",mode:n.mode,display:tl(t[0]),text:tl(t[1]),script:tl(t[2]),scriptscript:tl(t[3])}},htmlBuilder:(e,t)=>{var n=C$(e,t),r=Tl(n,t,!1);return Xt.makeFragment(r)},mathmlBuilder:(e,t)=>{var n=C$(e,t);return M0(n,t)}});var tee=(e,t,n,r,a,l,f)=>{e=Xt.makeSpan([],[e]);var i=n&&Na.isCharacterBox(n),y,x;if(t){var S=Ia(t,r.havingStyle(a.sup()),r);x={elem:S,kern:Math.max(r.fontMetrics().bigOpSpacing1,r.fontMetrics().bigOpSpacing3-S.depth)}}if(n){var C=Ia(n,r.havingStyle(a.sub()),r);y={elem:C,kern:Math.max(r.fontMetrics().bigOpSpacing2,r.fontMetrics().bigOpSpacing4-C.height)}}var P;if(x&&y){var L=r.fontMetrics().bigOpSpacing5+y.elem.height+y.elem.depth+y.kern+e.depth+f;P=Xt.makeVList({positionType:"bottom",positionData:L,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:y.elem,marginLeft:Cr(-l)},{type:"kern",size:y.kern},{type:"elem",elem:e},{type:"kern",size:x.kern},{type:"elem",elem:x.elem,marginLeft:Cr(l)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else if(y){var F=e.height-f;P=Xt.makeVList({positionType:"top",positionData:F,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:y.elem,marginLeft:Cr(-l)},{type:"kern",size:y.kern},{type:"elem",elem:e}]},r)}else if(x){var U=e.depth+f;P=Xt.makeVList({positionType:"bottom",positionData:U,children:[{type:"elem",elem:e},{type:"kern",size:x.kern},{type:"elem",elem:x.elem,marginLeft:Cr(l)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else return e;var q=[P];if(y&&l!==0&&!i){var G=Xt.makeSpan(["mspace"],[],r);G.style.marginRight=Cr(l),q.unshift(G)}return Xt.makeSpan(["mop","op-limits"],q,r)},nee=["\\smallint"],Nx=(e,t)=>{var n,r,a=!1,l;e.type==="supsub"?(n=e.sup,r=e.sub,l=Gs(e.base,"op"),a=!0):l=Gs(e,"op");var f=t.style,i=!1;f.size===Vi.DISPLAY.size&&l.symbol&&!nee.includes(l.name)&&(i=!0);var y;if(l.symbol){var x=i?"Size2-Regular":"Size1-Regular",S="";if((l.name==="\\oiint"||l.name==="\\oiiint")&&(S=l.name.slice(1),l.name=S==="oiint"?"\\iint":"\\iiint"),y=Xt.makeSymbol(l.name,x,"math",t,["mop","op-symbol",i?"large-op":"small-op"]),S.length>0){var C=y.italic,P=Xt.staticSvg(S+"Size"+(i?"2":"1"),t);y=Xt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:y,shift:0},{type:"elem",elem:P,shift:i?.08:0}]},t),l.name="\\"+S,y.classes.unshift("mop"),y.italic=C}}else if(l.body){var L=Tl(l.body,t,!0);L.length===1&&L[0]instanceof Ed?(y=L[0],y.classes[0]="mop"):y=Xt.makeSpan(["mop"],L,t)}else{for(var F=[],U=1;U<l.name.length;U++)F.push(Xt.mathsym(l.name[U],l.mode,t));y=Xt.makeSpan(["mop"],F,t)}var q=0,G=0;return(y instanceof Ed||l.name==="\\oiint"||l.name==="\\oiiint")&&!l.suppressBaseShift&&(q=(y.height-y.depth)/2-t.fontMetrics().axisHeight,G=y.italic),a?tee(y,n,r,t,f,G,q):(q&&(y.style.position="relative",y.style.top=Cr(q)),y)},lE=(e,t)=>{var n;if(e.symbol)n=new Lc("mo",[Sd(e.name,e.mode)]),nee.includes(e.name)&&n.setAttribute("largeop","false");else if(e.body)n=new Lc("mo",fc(e.body,t));else{n=new Lc("mi",[new ff(e.name.slice(1))]);var r=new Lc("mo",[Sd("","text")]);e.parentIsSupSub?n=new Lc("mrow",[n,r]):n=RJ([n,r])}return n},$Te={"":"\\prod","":"\\coprod","":"\\sum","":"\\bigwedge","":"\\bigvee","":"\\bigcap","":"\\bigcup","":"\\bigodot","":"\\bigoplus","":"\\bigotimes","":"\\biguplus","":"\\bigsqcup"};Fr({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","","","","","","","","","","","",""],props:{numArgs:0},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=r;return a.length===1&&(a=$Te[a]),{type:"op",mode:n.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:a}},htmlBuilder:Nx,mathmlBuilder:lE});Fr({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"op",mode:n.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:tl(r)}},htmlBuilder:Nx,mathmlBuilder:lE});var HTe={"":"\\int","":"\\iint","":"\\iiint","":"\\oint","":"\\oiint","":"\\oiiint"};Fr({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e;return{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:Nx,mathmlBuilder:lE});Fr({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e;return{type:"op",mode:t.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:Nx,mathmlBuilder:lE});Fr({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","","","","","",""],props:{numArgs:0,allowedInArgument:!0},handler(e){var{parser:t,funcName:n}=e,r=n;return r.length===1&&(r=HTe[r]),{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:r}},htmlBuilder:Nx,mathmlBuilder:lE});var ree=(e,t)=>{var n,r,a=!1,l;e.type==="supsub"?(n=e.sup,r=e.sub,l=Gs(e.base,"operatorname"),a=!0):l=Gs(e,"operatorname");var f;if(l.body.length>0){for(var i=l.body.map(C=>{var P=C.text;return typeof P=="string"?{type:"textord",mode:C.mode,text:P}:C}),y=Tl(i,t.withFont("mathrm"),!0),x=0;x<y.length;x++){var S=y[x];S instanceof Ed&&(S.text=S.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}f=Xt.makeSpan(["mop"],y,t)}else f=Xt.makeSpan(["mop"],[],t);return a?tee(f,n,r,t,t.style,0,0):f},GTe=(e,t)=>{for(var n=fc(e.body,t.withFont("mathrm")),r=!0,a=0;a<n.length;a++){var l=n[a];if(!(l instanceof er.SpaceNode))if(l instanceof er.MathNode)switch(l.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":{var f=l.children[0];l.children.length===1&&f instanceof er.TextNode?f.text=f.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):r=!1;break}default:r=!1}else r=!1}if(r){var i=n.map(S=>S.toText()).join("");n=[new er.TextNode(i)]}var y=new er.MathNode("mi",n);y.setAttribute("mathvariant","normal");var x=new er.MathNode("mo",[Sd("","text")]);return e.parentIsSupSub?new er.MathNode("mrow",[y,x]):er.newDocumentFragment([y,x])};Fr({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0];return{type:"operatorname",mode:n.mode,body:tl(a),alwaysHandleSupSub:r==="\\operatornamewithlimits",limits:!1,parentIsSupSub:!1}},htmlBuilder:ree,mathmlBuilder:GTe});De("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@");Z_({type:"ordgroup",htmlBuilder(e,t){return e.semisimple?Xt.makeFragment(Tl(e.body,t,!1)):Xt.makeSpan(["mord"],Tl(e.body,t,!0),t)},mathmlBuilder(e,t){return M0(e.body,t,!0)}});Fr({type:"overline",names:["\\overline"],props:{numArgs:1},handler(e,t){var{parser:n}=e,r=t[0];return{type:"overline",mode:n.mode,body:r}},htmlBuilder(e,t){var n=Ia(e.body,t.havingCrampedStyle()),r=Xt.makeLineSpan("overline-line",t),a=t.fontMetrics().defaultRuleThickness,l=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n},{type:"kern",size:3*a},{type:"elem",elem:r},{type:"kern",size:a}]},t);return Xt.makeSpan(["mord","overline"],[l],t)},mathmlBuilder(e,t){var n=new er.MathNode("mo",[new er.TextNode("")]);n.setAttribute("stretchy","true");var r=new er.MathNode("mover",[eo(e.body,t),n]);return r.setAttribute("accent","true"),r}});Fr({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"phantom",mode:n.mode,body:tl(r)}},htmlBuilder:(e,t)=>{var n=Tl(e.body,t.withPhantom(),!1);return Xt.makeFragment(n)},mathmlBuilder:(e,t)=>{var n=fc(e.body,t);return new er.MathNode("mphantom",n)}});Fr({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"hphantom",mode:n.mode,body:r}},htmlBuilder:(e,t)=>{var n=Xt.makeSpan([],[Ia(e.body,t.withPhantom())]);if(n.height=0,n.depth=0,n.children)for(var r=0;r<n.children.length;r++)n.children[r].height=0,n.children[r].depth=0;return n=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},t),Xt.makeSpan(["mord"],[n],t)},mathmlBuilder:(e,t)=>{var n=fc(tl(e.body),t),r=new er.MathNode("mphantom",n),a=new er.MathNode("mpadded",[r]);return a.setAttribute("height","0px"),a.setAttribute("depth","0px"),a}});Fr({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"vphantom",mode:n.mode,body:r}},htmlBuilder:(e,t)=>{var n=Xt.makeSpan(["inner"],[Ia(e.body,t.withPhantom())]),r=Xt.makeSpan(["fix"],[]);return Xt.makeSpan(["mord","rlap"],[n,r],t)},mathmlBuilder:(e,t)=>{var n=fc(tl(e.body),t),r=new er.MathNode("mphantom",n),a=new er.MathNode("mpadded",[r]);return a.setAttribute("width","0px"),a}});Fr({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(e,t){var{parser:n}=e,r=Gs(t[0],"size").value,a=t[1];return{type:"raisebox",mode:n.mode,dy:r,body:a}},htmlBuilder(e,t){var n=Ia(e.body,t),r=zo(e.dy,t);return Xt.makeVList({positionType:"shift",positionData:-r,children:[{type:"elem",elem:n}]},t)},mathmlBuilder(e,t){var n=new er.MathNode("mpadded",[eo(e.body,t)]),r=e.dy.number+e.dy.unit;return n.setAttribute("voffset",r),n}});Fr({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0,allowedInArgument:!0},handler(e){var{parser:t}=e;return{type:"internal",mode:t.mode}}});Fr({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["size","size","size"]},handler(e,t,n){var{parser:r}=e,a=n[0],l=Gs(t[0],"size"),f=Gs(t[1],"size");return{type:"rule",mode:r.mode,shift:a&&Gs(a,"size").value,width:l.value,height:f.value}},htmlBuilder(e,t){var n=Xt.makeSpan(["mord","rule"],[],t),r=zo(e.width,t),a=zo(e.height,t),l=e.shift?zo(e.shift,t):0;return n.style.borderRightWidth=Cr(r),n.style.borderTopWidth=Cr(a),n.style.bottom=Cr(l),n.width=r,n.height=a+l,n.depth=-l,n.maxFontSize=a*1.125*t.sizeMultiplier,n},mathmlBuilder(e,t){var n=zo(e.width,t),r=zo(e.height,t),a=e.shift?zo(e.shift,t):0,l=t.color&&t.getColor()||"black",f=new er.MathNode("mspace");f.setAttribute("mathbackground",l),f.setAttribute("width",Cr(n)),f.setAttribute("height",Cr(r));var i=new er.MathNode("mpadded",[f]);return a>=0?i.setAttribute("height",Cr(a)):(i.setAttribute("height",Cr(a)),i.setAttribute("depth",Cr(-a))),i.setAttribute("voffset",Cr(a)),i}});function iee(e,t,n){for(var r=Tl(e,t,!1),a=t.sizeMultiplier/n.sizeMultiplier,l=0;l<r.length;l++){var f=r[l].classes.indexOf("sizing");f<0?Array.prototype.push.apply(r[l].classes,t.sizingClasses(n)):r[l].classes[f+1]==="reset-size"+t.size&&(r[l].classes[f+1]="reset-size"+n.size),r[l].height*=a,r[l].depth*=a}return Xt.makeFragment(r)}var k$=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],qTe=(e,t)=>{var n=t.havingSize(e.size);return iee(e.body,n,t)};Fr({type:"sizing",names:k$,props:{numArgs:0,allowedInText:!0},handler:(e,t)=>{var{breakOnTokenText:n,funcName:r,parser:a}=e,l=a.parseExpression(!1,n);return{type:"sizing",mode:a.mode,size:k$.indexOf(r)+1,body:l}},htmlBuilder:qTe,mathmlBuilder:(e,t)=>{var n=t.havingSize(e.size),r=fc(e.body,n),a=new er.MathNode("mstyle",r);return a.setAttribute("mathsize",Cr(n.sizeMultiplier)),a}});Fr({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(e,t,n)=>{var{parser:r}=e,a=!1,l=!1,f=n[0]&&Gs(n[0],"ordgroup");if(f)for(var i="",y=0;y<f.body.length;++y){var x=f.body[y];if(i=x.text,i==="t")a=!0;else if(i==="b")l=!0;else{a=!1,l=!1;break}}else a=!0,l=!0;var S=t[0];return{type:"smash",mode:r.mode,body:S,smashHeight:a,smashDepth:l}},htmlBuilder:(e,t)=>{var n=Xt.makeSpan([],[Ia(e.body,t)]);if(!e.smashHeight&&!e.smashDepth)return n;if(e.smashHeight&&(n.height=0,n.children))for(var r=0;r<n.children.length;r++)n.children[r].height=0;if(e.smashDepth&&(n.depth=0,n.children))for(var a=0;a<n.children.length;a++)n.children[a].depth=0;var l=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},t);return Xt.makeSpan(["mord"],[l],t)},mathmlBuilder:(e,t)=>{var n=new er.MathNode("mpadded",[eo(e.body,t)]);return e.smashHeight&&n.setAttribute("height","0px"),e.smashDepth&&n.setAttribute("depth","0px"),n}});Fr({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(e,t,n){var{parser:r}=e,a=n[0],l=t[0];return{type:"sqrt",mode:r.mode,body:l,index:a}},htmlBuilder(e,t){var n=Ia(e.body,t.havingCrampedStyle());n.height===0&&(n.height=t.fontMetrics().xHeight),n=Xt.wrapFragment(n,t);var r=t.fontMetrics(),a=r.defaultRuleThickness,l=a;t.style.id<Vi.TEXT.id&&(l=t.fontMetrics().xHeight);var f=a+l/4,i=n.height+n.depth+f+a,{span:y,ruleWidth:x,advanceWidth:S}=Tp.sqrtImage(i,t),C=y.height-x;C>n.height+n.depth+f&&(f=(f+C-n.height-n.depth)/2);var P=y.height-n.height-f-x;n.style.paddingLeft=Cr(S);var L=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n,wrapperClasses:["svg-align"]},{type:"kern",size:-(n.height+P)},{type:"elem",elem:y},{type:"kern",size:x}]},t);if(e.index){var F=t.havingStyle(Vi.SCRIPTSCRIPT),U=Ia(e.index,F,t),q=.6*(L.height-L.depth),G=Xt.makeVList({positionType:"shift",positionData:-q,children:[{type:"elem",elem:U}]},t),$=Xt.makeSpan(["root"],[G]);return Xt.makeSpan(["mord","sqrt"],[$,L],t)}else return Xt.makeSpan(["mord","sqrt"],[L],t)},mathmlBuilder(e,t){var{body:n,index:r}=e;return r?new er.MathNode("mroot",[eo(n,t),eo(r,t)]):new er.MathNode("msqrt",[eo(n,t)])}});var I$={display:Vi.DISPLAY,text:Vi.TEXT,script:Vi.SCRIPT,scriptscript:Vi.SCRIPTSCRIPT};Fr({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e,t){var{breakOnTokenText:n,funcName:r,parser:a}=e,l=a.parseExpression(!0,n),f=r.slice(1,r.length-5);return{type:"styling",mode:a.mode,style:f,body:l}},htmlBuilder(e,t){var n=I$[e.style],r=t.havingStyle(n).withFont("");return iee(e.body,r,t)},mathmlBuilder(e,t){var n=I$[e.style],r=t.havingStyle(n),a=fc(e.body,r),l=new er.MathNode("mstyle",a),f={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]},i=f[e.style];return l.setAttribute("scriptlevel",i[0]),l.setAttribute("displaystyle",i[1]),l}});var ZTe=function(t,n){var r=t.base;if(r)if(r.type==="op"){var a=r.limits&&(n.style.size===Vi.DISPLAY.size||r.alwaysHandleSupSub);return a?Nx:null}else if(r.type==="operatorname"){var l=r.alwaysHandleSupSub&&(n.style.size===Vi.DISPLAY.size||r.limits);return l?ree:null}else{if(r.type==="accent")return Na.isCharacterBox(r.base)?FD:null;if(r.type==="horizBrace"){var f=!t.sub;return f===r.isOver?eee:null}else return null}else return null};Z_({type:"supsub",htmlBuilder(e,t){var n=ZTe(e,t);if(n)return n(e,t);var{base:r,sup:a,sub:l}=e,f=Ia(r,t),i,y,x=t.fontMetrics(),S=0,C=0,P=r&&Na.isCharacterBox(r);if(a){var L=t.havingStyle(t.style.sup());i=Ia(a,L,t),P||(S=f.height-L.fontMetrics().supDrop*L.sizeMultiplier/t.sizeMultiplier)}if(l){var F=t.havingStyle(t.style.sub());y=Ia(l,F,t),P||(C=f.depth+F.fontMetrics().subDrop*F.sizeMultiplier/t.sizeMultiplier)}var U;t.style===Vi.DISPLAY?U=x.sup1:t.style.cramped?U=x.sup3:U=x.sup2;var q=t.sizeMultiplier,G=Cr(.5/x.ptPerEm/q),$=null;if(y){var X=e.base&&e.base.type==="op"&&e.base.name&&(e.base.name==="\\oiint"||e.base.name==="\\oiiint");(f instanceof Ed||X)&&($=Cr(-f.italic))}var ie;if(i&&y){S=Math.max(S,U,i.depth+.25*x.xHeight),C=Math.max(C,x.sub2);var de=x.defaultRuleThickness,fe=4*de;if(S-i.depth-(y.height-C)<fe){C=fe-(S-i.depth)+y.height;var be=.8*x.xHeight-(S-i.depth);be>0&&(S+=be,C-=be)}var ve=[{type:"elem",elem:y,shift:C,marginRight:G,marginLeft:$},{type:"elem",elem:i,shift:-S,marginRight:G}];ie=Xt.makeVList({positionType:"individualShift",children:ve},t)}else if(y){C=Math.max(C,x.sub1,y.height-.8*x.xHeight);var Je=[{type:"elem",elem:y,marginLeft:$,marginRight:G}];ie=Xt.makeVList({positionType:"shift",positionData:C,children:Je},t)}else if(i)S=Math.max(S,U,i.depth+.25*x.xHeight),ie=Xt.makeVList({positionType:"shift",positionData:-S,children:[{type:"elem",elem:i,marginRight:G}]},t);else throw new Error("supsub must have either sup or sub.");var we=$O(f,"right")||"mord";return Xt.makeSpan([we],[f,Xt.makeSpan(["msupsub"],[ie])],t)},mathmlBuilder(e,t){var n=!1,r,a;e.base&&e.base.type==="horizBrace"&&(a=!!e.sup,a===e.base.isOver&&(n=!0,r=e.base.isOver)),e.base&&(e.base.type==="op"||e.base.type==="operatorname")&&(e.base.parentIsSupSub=!0);var l=[eo(e.base,t)];e.sub&&l.push(eo(e.sub,t)),e.sup&&l.push(eo(e.sup,t));var f;if(n)f=r?"mover":"munder";else if(e.sub)if(e.sup){var x=e.base;x&&x.type==="op"&&x.limits&&t.style===Vi.DISPLAY||x&&x.type==="operatorname"&&x.alwaysHandleSupSub&&(t.style===Vi.DISPLAY||x.limits)?f="munderover":f="msubsup"}else{var y=e.base;y&&y.type==="op"&&y.limits&&(t.style===Vi.DISPLAY||y.alwaysHandleSupSub)||y&&y.type==="operatorname"&&y.alwaysHandleSupSub&&(y.limits||t.style===Vi.DISPLAY)?f="munder":f="msub"}else{var i=e.base;i&&i.type==="op"&&i.limits&&(t.style===Vi.DISPLAY||i.alwaysHandleSupSub)||i&&i.type==="operatorname"&&i.alwaysHandleSupSub&&(i.limits||t.style===Vi.DISPLAY)?f="mover":f="msup"}return new er.MathNode(f,l)}});Z_({type:"atom",htmlBuilder(e,t){return Xt.mathsym(e.text,e.mode,t,["m"+e.family])},mathmlBuilder(e,t){var n=new er.MathNode("mo",[Sd(e.text,e.mode)]);if(e.family==="bin"){var r=ND(e,t);r==="bold-italic"&&n.setAttribute("mathvariant",r)}else e.family==="punct"?n.setAttribute("separator","true"):(e.family==="open"||e.family==="close")&&n.setAttribute("stretchy","false");return n}});var see={mi:"italic",mn:"normal",mtext:"normal"};Z_({type:"mathord",htmlBuilder(e,t){return Xt.makeOrd(e,t,"mathord")},mathmlBuilder(e,t){var n=new er.MathNode("mi",[Sd(e.text,e.mode,t)]),r=ND(e,t)||"italic";return r!==see[n.type]&&n.setAttribute("mathvariant",r),n}});Z_({type:"textord",htmlBuilder(e,t){return Xt.makeOrd(e,t,"textord")},mathmlBuilder(e,t){var n=Sd(e.text,e.mode,t),r=ND(e,t)||"normal",a;return e.mode==="text"?a=new er.MathNode("mtext",[n]):/[0-9]/.test(e.text)?a=new er.MathNode("mn",[n]):e.text==="\\prime"?a=new er.MathNode("mo",[n]):a=new er.MathNode("mi",[n]),r!==see[a.type]&&a.setAttribute("mathvariant",r),a}});var CR={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},kR={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};Z_({type:"spacing",htmlBuilder(e,t){if(kR.hasOwnProperty(e.text)){var n=kR[e.text].className||"";if(e.mode==="text"){var r=Xt.makeOrd(e,t,"textord");return r.classes.push(n),r}else return Xt.makeSpan(["mspace",n],[Xt.mathsym(e.text,e.mode,t)],t)}else{if(CR.hasOwnProperty(e.text))return Xt.makeSpan(["mspace",CR[e.text]],[],t);throw new rr('Unknown type of space "'+e.text+'"')}},mathmlBuilder(e,t){var n;if(kR.hasOwnProperty(e.text))n=new er.MathNode("mtext",[new er.TextNode("")]);else{if(CR.hasOwnProperty(e.text))return new er.MathNode("mspace");throw new rr('Unknown type of space "'+e.text+'"')}return n}});var R$=()=>{var e=new er.MathNode("mtd",[]);return e.setAttribute("width","50%"),e};Z_({type:"tag",mathmlBuilder(e,t){var n=new er.MathNode("mtable",[new er.MathNode("mtr",[R$(),new er.MathNode("mtd",[M0(e.body,t)]),R$(),new er.MathNode("mtd",[M0(e.tag,t)])])]);return n.setAttribute("width","100%"),n}});var M$={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},P$={"\\textbf":"textbf","\\textmd":"textmd"},WTe={"\\textit":"textit","\\textup":"textup"},O$=(e,t)=>{var n=e.font;if(n){if(M$[n])return t.withTextFontFamily(M$[n]);if(P$[n])return t.withTextFontWeight(P$[n]);if(n==="\\emph")return t.fontShape==="textit"?t.withTextFontShape("textup"):t.withTextFontShape("textit")}else return t;return t.withTextFontShape(WTe[n])};Fr({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup","\\emph"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(e,t){var{parser:n,funcName:r}=e,a=t[0];return{type:"text",mode:n.mode,body:tl(a),font:r}},htmlBuilder(e,t){var n=O$(e,t),r=Tl(e.body,n,!0);return Xt.makeSpan(["mord","text"],r,n)},mathmlBuilder(e,t){var n=O$(e,t);return M0(e.body,n)}});Fr({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"underline",mode:n.mode,body:t[0]}},htmlBuilder(e,t){var n=Ia(e.body,t),r=Xt.makeLineSpan("underline-line",t),a=t.fontMetrics().defaultRuleThickness,l=Xt.makeVList({positionType:"top",positionData:n.height,children:[{type:"kern",size:a},{type:"elem",elem:r},{type:"kern",size:3*a},{type:"elem",elem:n}]},t);return Xt.makeSpan(["mord","underline"],[l],t)},mathmlBuilder(e,t){var n=new er.MathNode("mo",[new er.TextNode("")]);n.setAttribute("stretchy","true");var r=new er.MathNode("munder",[eo(e.body,t),n]);return r.setAttribute("accentunder","true"),r}});Fr({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(e,t){var{parser:n}=e;return{type:"vcenter",mode:n.mode,body:t[0]}},htmlBuilder(e,t){var n=Ia(e.body,t),r=t.fontMetrics().axisHeight,a=.5*(n.height-r-(n.depth+r));return Xt.makeVList({positionType:"shift",positionData:a,children:[{type:"elem",elem:n}]},t)},mathmlBuilder(e,t){return new er.MathNode("mpadded",[eo(e.body,t)],["vcenter"])}});Fr({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(e,t,n){throw new rr("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(e,t){for(var n=L$(e),r=[],a=t.havingStyle(t.style.text()),l=0;l<n.length;l++){var f=n[l];f==="~"&&(f="\\textasciitilde"),r.push(Xt.makeSymbol(f,"Typewriter-Regular",e.mode,a,["mord","texttt"]))}return Xt.makeSpan(["mord","text"].concat(a.sizingClasses(t)),Xt.tryCombineChars(r),a)},mathmlBuilder(e,t){var n=new er.TextNode(L$(e)),r=new er.MathNode("mtext",[n]);return r.setAttribute("mathvariant","monospace"),r}});var L$=e=>e.body.replace(/ /g,e.star?"":""),t0=kJ,aee=`[ \r
	]`,XTe="\\\\[a-zA-Z@]+",YTe="\\\\[^\uD800-\uDFFF]",KTe="("+XTe+")"+aee+"*",QTe=`\\\\(
|[ \r	]+
?)[ \r	]*`,ZO="[-]",JTe=new RegExp(ZO+"+$"),eEe="("+aee+"+)|"+(QTe+"|")+"([!-\\[\\]---]"+(ZO+"*")+"|[\uD800-\uDBFF][\uDC00-\uDFFF]"+(ZO+"*")+"|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5"+("|"+KTe)+("|"+YTe+")");class D${constructor(t,n){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=t,this.settings=n,this.tokenRegex=new RegExp(eEe,"g"),this.catcodes={"%":14,"~":13}}setCatcode(t,n){this.catcodes[t]=n}lex(){var t=this.input,n=this.tokenRegex.lastIndex;if(n===t.length)return new Bc("EOF",new rc(this,n,n));var r=this.tokenRegex.exec(t);if(r===null||r.index!==n)throw new rr("Unexpected character: '"+t[n]+"'",new Bc(t[n],new rc(this,n,n+1)));var a=r[6]||r[3]||(r[2]?"\\ ":" ");if(this.catcodes[a]===14){var l=t.indexOf(`
`,this.tokenRegex.lastIndex);return l===-1?(this.tokenRegex.lastIndex=t.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=l+1,this.lex()}return new Bc(a,new rc(this,n,this.tokenRegex.lastIndex))}}class tEe{constructor(t,n){t===void 0&&(t={}),n===void 0&&(n={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=n,this.builtins=t,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(this.undefStack.length===0)throw new rr("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var t=this.undefStack.pop();for(var n in t)t.hasOwnProperty(n)&&(t[n]==null?delete this.current[n]:this.current[n]=t[n])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(t){return this.current.hasOwnProperty(t)||this.builtins.hasOwnProperty(t)}get(t){return this.current.hasOwnProperty(t)?this.current[t]:this.builtins[t]}set(t,n,r){if(r===void 0&&(r=!1),r){for(var a=0;a<this.undefStack.length;a++)delete this.undefStack[a][t];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][t]=n)}else{var l=this.undefStack[this.undefStack.length-1];l&&!l.hasOwnProperty(t)&&(l[t]=this.current[t])}n==null?delete this.current[t]:this.current[t]=n}}var nEe=XJ;De("\\noexpand",function(e){var t=e.popToken();return e.isExpandable(t.text)&&(t.noexpand=!0,t.treatAsRelax=!0),{tokens:[t],numArgs:0}});De("\\expandafter",function(e){var t=e.popToken();return e.expandOnce(!0),{tokens:[t],numArgs:0}});De("\\@firstoftwo",function(e){var t=e.consumeArgs(2);return{tokens:t[0],numArgs:0}});De("\\@secondoftwo",function(e){var t=e.consumeArgs(2);return{tokens:t[1],numArgs:0}});De("\\@ifnextchar",function(e){var t=e.consumeArgs(3);e.consumeSpaces();var n=e.future();return t[0].length===1&&t[0][0].text===n.text?{tokens:t[1],numArgs:0}:{tokens:t[2],numArgs:0}});De("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}");De("\\TextOrMath",function(e){var t=e.consumeArgs(2);return e.mode==="text"?{tokens:t[0],numArgs:0}:{tokens:t[1],numArgs:0}});var N$={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};De("\\char",function(e){var t=e.popToken(),n,r="";if(t.text==="'")n=8,t=e.popToken();else if(t.text==='"')n=16,t=e.popToken();else if(t.text==="`")if(t=e.popToken(),t.text[0]==="\\")r=t.text.charCodeAt(1);else{if(t.text==="EOF")throw new rr("\\char` missing argument");r=t.text.charCodeAt(0)}else n=10;if(n){if(r=N$[t.text],r==null||r>=n)throw new rr("Invalid base-"+n+" digit "+t.text);for(var a;(a=N$[e.future().text])!=null&&a<n;)r*=n,r+=a,e.popToken()}return"\\@char{"+r+"}"});var qD=(e,t,n,r)=>{var a=e.consumeArg().tokens;if(a.length!==1)throw new rr("\\newcommand's first argument must be a macro name");var l=a[0].text,f=e.isDefined(l);if(f&&!t)throw new rr("\\newcommand{"+l+"} attempting to redefine "+(l+"; use \\renewcommand"));if(!f&&!n)throw new rr("\\renewcommand{"+l+"} when command "+l+" does not yet exist; use \\newcommand");var i=0;if(a=e.consumeArg().tokens,a.length===1&&a[0].text==="["){for(var y="",x=e.expandNextToken();x.text!=="]"&&x.text!=="EOF";)y+=x.text,x=e.expandNextToken();if(!y.match(/^\s*[0-9]+\s*$/))throw new rr("Invalid number of arguments: "+y);i=parseInt(y),a=e.consumeArg().tokens}return f&&r||e.macros.set(l,{tokens:a,numArgs:i}),""};De("\\newcommand",e=>qD(e,!1,!0,!1));De("\\renewcommand",e=>qD(e,!0,!1,!1));De("\\providecommand",e=>qD(e,!0,!0,!0));De("\\message",e=>{var t=e.consumeArgs(1)[0];return console.log(t.reverse().map(n=>n.text).join("")),""});De("\\errmessage",e=>{var t=e.consumeArgs(1)[0];return console.error(t.reverse().map(n=>n.text).join("")),""});De("\\show",e=>{var t=e.popToken(),n=t.text;return console.log(t,e.macros.get(n),t0[n],fo.math[n],fo.text[n]),""});De("\\bgroup","{");De("\\egroup","}");De("~","\\nobreakspace");De("\\lq","`");De("\\rq","'");De("\\aa","\\r a");De("\\AA","\\r A");De("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`}");De("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}");De("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`}");De("","\\mathscr{B}");De("","\\mathscr{E}");De("","\\mathscr{F}");De("","\\mathscr{H}");De("","\\mathscr{I}");De("","\\mathscr{L}");De("","\\mathscr{M}");De("","\\mathscr{R}");De("","\\mathfrak{C}");De("","\\mathfrak{H}");De("","\\mathfrak{Z}");De("\\Bbbk","\\Bbb{k}");De("","\\cdotp");De("\\llap","\\mathllap{\\textrm{#1}}");De("\\rlap","\\mathrlap{\\textrm{#1}}");De("\\clap","\\mathclap{\\textrm{#1}}");De("\\mathstrut","\\vphantom{(}");De("\\underbar","\\underline{\\text{#1}}");De("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}');De("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`}}");De("\\ne","\\neq");De("","\\neq");De("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`}}");De("","\\notin");De("","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`}}");De("","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`}}");De("","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`}}");De("","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`}}");De("","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`}}");De("","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`}}");De("","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`}}");De("","\\perp");De("","\\mathclose{!\\mkern-0.8mu!}");De("","\\notni");De("","\\ulcorner");De("","\\urcorner");De("","\\llcorner");De("","\\lrcorner");De("","\\copyright");De("","\\textregistered");De("","\\textregistered");De("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}');De("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}');De("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}');De("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}');De("\\vdots","{\\varvdots\\rule{0pt}{15pt}}");De("","\\vdots");De("\\varGamma","\\mathit{\\Gamma}");De("\\varDelta","\\mathit{\\Delta}");De("\\varTheta","\\mathit{\\Theta}");De("\\varLambda","\\mathit{\\Lambda}");De("\\varXi","\\mathit{\\Xi}");De("\\varPi","\\mathit{\\Pi}");De("\\varSigma","\\mathit{\\Sigma}");De("\\varUpsilon","\\mathit{\\Upsilon}");De("\\varPhi","\\mathit{\\Phi}");De("\\varPsi","\\mathit{\\Psi}");De("\\varOmega","\\mathit{\\Omega}");De("\\substack","\\begin{subarray}{c}#1\\end{subarray}");De("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax");De("\\boxed","\\fbox{$\\displaystyle{#1}$}");De("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;");De("\\implies","\\DOTSB\\;\\Longrightarrow\\;");De("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");De("\\dddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ...}}{#1}}");De("\\ddddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ....}}{#1}}");var z$={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};De("\\dots",function(e){var t="\\dotso",n=e.expandAfterFuture().text;return n in z$?t=z$[n]:(n.slice(0,4)==="\\not"||n in fo.math&&["bin","rel"].includes(fo.math[n].group))&&(t="\\dotsb"),t});var ZD={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};De("\\dotso",function(e){var t=e.future().text;return t in ZD?"\\ldots\\,":"\\ldots"});De("\\dotsc",function(e){var t=e.future().text;return t in ZD&&t!==","?"\\ldots\\,":"\\ldots"});De("\\cdots",function(e){var t=e.future().text;return t in ZD?"\\@cdots\\,":"\\@cdots"});De("\\dotsb","\\cdots");De("\\dotsm","\\cdots");De("\\dotsi","\\!\\cdots");De("\\dotsx","\\ldots\\,");De("\\DOTSI","\\relax");De("\\DOTSB","\\relax");De("\\DOTSX","\\relax");De("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax");De("\\,","\\tmspace+{3mu}{.1667em}");De("\\thinspace","\\,");De("\\>","\\mskip{4mu}");De("\\:","\\tmspace+{4mu}{.2222em}");De("\\medspace","\\:");De("\\;","\\tmspace+{5mu}{.2777em}");De("\\thickspace","\\;");De("\\!","\\tmspace-{3mu}{.1667em}");De("\\negthinspace","\\!");De("\\negmedspace","\\tmspace-{4mu}{.2222em}");De("\\negthickspace","\\tmspace-{5mu}{.277em}");De("\\enspace","\\kern.5em ");De("\\enskip","\\hskip.5em\\relax");De("\\quad","\\hskip1em\\relax");De("\\qquad","\\hskip2em\\relax");De("\\tag","\\@ifstar\\tag@literal\\tag@paren");De("\\tag@paren","\\tag@literal{({#1})}");De("\\tag@literal",e=>{if(e.macros.get("\\df@tag"))throw new rr("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"});De("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}");De("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)");De("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}");De("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1");De("\\newline","\\\\\\relax");De("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var oee=Cr(hf["Main-Regular"][84][1]-.7*hf["Main-Regular"][65][1]);De("\\LaTeX","\\textrm{\\html@mathml{"+("L\\kern-.36em\\raisebox{"+oee+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{LaTeX}}");De("\\KaTeX","\\textrm{\\html@mathml{"+("K\\kern-.17em\\raisebox{"+oee+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{KaTeX}}");De("\\hspace","\\@ifstar\\@hspacer\\@hspace");De("\\@hspace","\\hskip #1\\relax");De("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax");De("\\ordinarycolon",":");De("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}");De("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}');De("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}');De("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}');De("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}');De("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}');De("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}');De("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}');De("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}');De("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}');De("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}');De("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}');De("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}');De("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}');De("","\\dblcolon");De("","\\eqcolon");De("","\\coloneqq");De("","\\eqqcolon");De("","\\Coloneqq");De("\\ratio","\\vcentcolon");De("\\coloncolon","\\dblcolon");De("\\colonequals","\\coloneqq");De("\\coloncolonequals","\\Coloneqq");De("\\equalscolon","\\eqqcolon");De("\\equalscoloncolon","\\Eqqcolon");De("\\colonminus","\\coloneq");De("\\coloncolonminus","\\Coloneq");De("\\minuscolon","\\eqcolon");De("\\minuscoloncolon","\\Eqcolon");De("\\coloncolonapprox","\\Colonapprox");De("\\coloncolonsim","\\Colonsim");De("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}");De("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}");De("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}");De("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}");De("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`}}");De("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}");De("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}");De("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}");De("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}");De("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}");De("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}");De("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}");De("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}");De("\\gvertneqq","\\html@mathml{\\@gvertneqq}{}");De("\\lvertneqq","\\html@mathml{\\@lvertneqq}{}");De("\\ngeqq","\\html@mathml{\\@ngeqq}{}");De("\\ngeqslant","\\html@mathml{\\@ngeqslant}{}");De("\\nleqq","\\html@mathml{\\@nleqq}{}");De("\\nleqslant","\\html@mathml{\\@nleqslant}{}");De("\\nshortmid","\\html@mathml{\\@nshortmid}{}");De("\\nshortparallel","\\html@mathml{\\@nshortparallel}{}");De("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{}");De("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{}");De("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{}");De("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{}");De("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{}");De("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{}");De("\\imath","\\html@mathml{\\@imath}{}");De("\\jmath","\\html@mathml{\\@jmath}{}");De("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`}}");De("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`}}");De("","\\llbracket");De("","\\rrbracket");De("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`}}");De("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`}}");De("","\\lBrace");De("","\\rBrace");De("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`}}");De("","\\minuso");De("\\darr","\\downarrow");De("\\dArr","\\Downarrow");De("\\Darr","\\Downarrow");De("\\lang","\\langle");De("\\rang","\\rangle");De("\\uarr","\\uparrow");De("\\uArr","\\Uparrow");De("\\Uarr","\\Uparrow");De("\\N","\\mathbb{N}");De("\\R","\\mathbb{R}");De("\\Z","\\mathbb{Z}");De("\\alef","\\aleph");De("\\alefsym","\\aleph");De("\\Alpha","\\mathrm{A}");De("\\Beta","\\mathrm{B}");De("\\bull","\\bullet");De("\\Chi","\\mathrm{X}");De("\\clubs","\\clubsuit");De("\\cnums","\\mathbb{C}");De("\\Complex","\\mathbb{C}");De("\\Dagger","\\ddagger");De("\\diamonds","\\diamondsuit");De("\\empty","\\emptyset");De("\\Epsilon","\\mathrm{E}");De("\\Eta","\\mathrm{H}");De("\\exist","\\exists");De("\\harr","\\leftrightarrow");De("\\hArr","\\Leftrightarrow");De("\\Harr","\\Leftrightarrow");De("\\hearts","\\heartsuit");De("\\image","\\Im");De("\\infin","\\infty");De("\\Iota","\\mathrm{I}");De("\\isin","\\in");De("\\Kappa","\\mathrm{K}");De("\\larr","\\leftarrow");De("\\lArr","\\Leftarrow");De("\\Larr","\\Leftarrow");De("\\lrarr","\\leftrightarrow");De("\\lrArr","\\Leftrightarrow");De("\\Lrarr","\\Leftrightarrow");De("\\Mu","\\mathrm{M}");De("\\natnums","\\mathbb{N}");De("\\Nu","\\mathrm{N}");De("\\Omicron","\\mathrm{O}");De("\\plusmn","\\pm");De("\\rarr","\\rightarrow");De("\\rArr","\\Rightarrow");De("\\Rarr","\\Rightarrow");De("\\real","\\Re");De("\\reals","\\mathbb{R}");De("\\Reals","\\mathbb{R}");De("\\Rho","\\mathrm{P}");De("\\sdot","\\cdot");De("\\sect","\\S");De("\\spades","\\spadesuit");De("\\sub","\\subset");De("\\sube","\\subseteq");De("\\supe","\\supseteq");De("\\Tau","\\mathrm{T}");De("\\thetasym","\\vartheta");De("\\weierp","\\wp");De("\\Zeta","\\mathrm{Z}");De("\\argmin","\\DOTSB\\operatorname*{arg\\,min}");De("\\argmax","\\DOTSB\\operatorname*{arg\\,max}");De("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits");De("\\bra","\\mathinner{\\langle{#1}|}");De("\\ket","\\mathinner{|{#1}\\rangle}");De("\\braket","\\mathinner{\\langle{#1}\\rangle}");De("\\Bra","\\left\\langle#1\\right|");De("\\Ket","\\left|#1\\right\\rangle");var lee=e=>t=>{var n=t.consumeArg().tokens,r=t.consumeArg().tokens,a=t.consumeArg().tokens,l=t.consumeArg().tokens,f=t.macros.get("|"),i=t.macros.get("\\|");t.macros.beginGroup();var y=C=>P=>{e&&(P.macros.set("|",f),a.length&&P.macros.set("\\|",i));var L=C;if(!C&&a.length){var F=P.future();F.text==="|"&&(P.popToken(),L=!0)}return{tokens:L?a:r,numArgs:0}};t.macros.set("|",y(!1)),a.length&&t.macros.set("\\|",y(!0));var x=t.consumeArg().tokens,S=t.expandTokens([...l,...x,...n]);return t.macros.endGroup(),{tokens:S.reverse(),numArgs:0}};De("\\bra@ket",lee(!1));De("\\bra@set",lee(!0));De("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}");De("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}");De("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}");De("\\angln","{\\angl n}");De("\\blue","\\textcolor{##6495ed}{#1}");De("\\orange","\\textcolor{##ffa500}{#1}");De("\\pink","\\textcolor{##ff00af}{#1}");De("\\red","\\textcolor{##df0030}{#1}");De("\\green","\\textcolor{##28ae7b}{#1}");De("\\gray","\\textcolor{gray}{#1}");De("\\purple","\\textcolor{##9d38bd}{#1}");De("\\blueA","\\textcolor{##ccfaff}{#1}");De("\\blueB","\\textcolor{##80f6ff}{#1}");De("\\blueC","\\textcolor{##63d9ea}{#1}");De("\\blueD","\\textcolor{##11accd}{#1}");De("\\blueE","\\textcolor{##0c7f99}{#1}");De("\\tealA","\\textcolor{##94fff5}{#1}");De("\\tealB","\\textcolor{##26edd5}{#1}");De("\\tealC","\\textcolor{##01d1c1}{#1}");De("\\tealD","\\textcolor{##01a995}{#1}");De("\\tealE","\\textcolor{##208170}{#1}");De("\\greenA","\\textcolor{##b6ffb0}{#1}");De("\\greenB","\\textcolor{##8af281}{#1}");De("\\greenC","\\textcolor{##74cf70}{#1}");De("\\greenD","\\textcolor{##1fab54}{#1}");De("\\greenE","\\textcolor{##0d923f}{#1}");De("\\goldA","\\textcolor{##ffd0a9}{#1}");De("\\goldB","\\textcolor{##ffbb71}{#1}");De("\\goldC","\\textcolor{##ff9c39}{#1}");De("\\goldD","\\textcolor{##e07d10}{#1}");De("\\goldE","\\textcolor{##a75a05}{#1}");De("\\redA","\\textcolor{##fca9a9}{#1}");De("\\redB","\\textcolor{##ff8482}{#1}");De("\\redC","\\textcolor{##f9685d}{#1}");De("\\redD","\\textcolor{##e84d39}{#1}");De("\\redE","\\textcolor{##bc2612}{#1}");De("\\maroonA","\\textcolor{##ffbde0}{#1}");De("\\maroonB","\\textcolor{##ff92c6}{#1}");De("\\maroonC","\\textcolor{##ed5fa6}{#1}");De("\\maroonD","\\textcolor{##ca337c}{#1}");De("\\maroonE","\\textcolor{##9e034e}{#1}");De("\\purpleA","\\textcolor{##ddd7ff}{#1}");De("\\purpleB","\\textcolor{##c6b9fc}{#1}");De("\\purpleC","\\textcolor{##aa87ff}{#1}");De("\\purpleD","\\textcolor{##7854ab}{#1}");De("\\purpleE","\\textcolor{##543b78}{#1}");De("\\mintA","\\textcolor{##f5f9e8}{#1}");De("\\mintB","\\textcolor{##edf2df}{#1}");De("\\mintC","\\textcolor{##e0e5cc}{#1}");De("\\grayA","\\textcolor{##f6f7f7}{#1}");De("\\grayB","\\textcolor{##f0f1f2}{#1}");De("\\grayC","\\textcolor{##e3e5e6}{#1}");De("\\grayD","\\textcolor{##d6d8da}{#1}");De("\\grayE","\\textcolor{##babec2}{#1}");De("\\grayF","\\textcolor{##888d93}{#1}");De("\\grayG","\\textcolor{##626569}{#1}");De("\\grayH","\\textcolor{##3b3e40}{#1}");De("\\grayI","\\textcolor{##21242c}{#1}");De("\\kaBlue","\\textcolor{##314453}{#1}");De("\\kaGreen","\\textcolor{##71B307}{#1}");var uee={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class rEe{constructor(t,n,r){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=n,this.expansionCount=0,this.feed(t),this.macros=new tEe(nEe,n.macros),this.mode=r,this.stack=[]}feed(t){this.lexer=new D$(t,this.settings)}switchMode(t){this.mode=t}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return this.stack.length===0&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(t){this.stack.push(t)}pushTokens(t){this.stack.push(...t)}scanArgument(t){var n,r,a;if(t){if(this.consumeSpaces(),this.future().text!=="[")return null;n=this.popToken(),{tokens:a,end:r}=this.consumeArg(["]"])}else({tokens:a,start:n,end:r}=this.consumeArg());return this.pushToken(new Bc("EOF",r.loc)),this.pushTokens(a),new Bc("",rc.range(n,r))}consumeSpaces(){for(;;){var t=this.future();if(t.text===" ")this.stack.pop();else break}}consumeArg(t){var n=[],r=t&&t.length>0;r||this.consumeSpaces();var a=this.future(),l,f=0,i=0;do{if(l=this.popToken(),n.push(l),l.text==="{")++f;else if(l.text==="}"){if(--f,f===-1)throw new rr("Extra }",l)}else if(l.text==="EOF")throw new rr("Unexpected end of input in a macro argument, expected '"+(t&&r?t[i]:"}")+"'",l);if(t&&r)if((f===0||f===1&&t[i]==="{")&&l.text===t[i]){if(++i,i===t.length){n.splice(-i,i);break}}else i=0}while(f!==0||r);return a.text==="{"&&n[n.length-1].text==="}"&&(n.pop(),n.shift()),n.reverse(),{tokens:n,start:a,end:l}}consumeArgs(t,n){if(n){if(n.length!==t+1)throw new rr("The length of delimiters doesn't match the number of args!");for(var r=n[0],a=0;a<r.length;a++){var l=this.popToken();if(r[a]!==l.text)throw new rr("Use of the macro doesn't match its definition",l)}}for(var f=[],i=0;i<t;i++)f.push(this.consumeArg(n&&n[i+1]).tokens);return f}countExpansion(t){if(this.expansionCount+=t,this.expansionCount>this.settings.maxExpand)throw new rr("Too many expansions: infinite loop or need to increase maxExpand setting")}expandOnce(t){var n=this.popToken(),r=n.text,a=n.noexpand?null:this._getExpansion(r);if(a==null||t&&a.unexpandable){if(t&&a==null&&r[0]==="\\"&&!this.isDefined(r))throw new rr("Undefined control sequence: "+r);return this.pushToken(n),!1}this.countExpansion(1);var l=a.tokens,f=this.consumeArgs(a.numArgs,a.delimiters);if(a.numArgs){l=l.slice();for(var i=l.length-1;i>=0;--i){var y=l[i];if(y.text==="#"){if(i===0)throw new rr("Incomplete placeholder at end of macro body",y);if(y=l[--i],y.text==="#")l.splice(i+1,1);else if(/^[1-9]$/.test(y.text))l.splice(i,2,...f[+y.text-1]);else throw new rr("Not a valid argument number",y)}}}return this.pushTokens(l),l.length}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;)if(this.expandOnce()===!1){var t=this.stack.pop();return t.treatAsRelax&&(t.text="\\relax"),t}throw new Error}expandMacro(t){return this.macros.has(t)?this.expandTokens([new Bc(t)]):void 0}expandTokens(t){var n=[],r=this.stack.length;for(this.pushTokens(t);this.stack.length>r;)if(this.expandOnce(!0)===!1){var a=this.stack.pop();a.treatAsRelax&&(a.noexpand=!1,a.treatAsRelax=!1),n.push(a)}return this.countExpansion(n.length),n}expandMacroAsText(t){var n=this.expandMacro(t);return n&&n.map(r=>r.text).join("")}_getExpansion(t){var n=this.macros.get(t);if(n==null)return n;if(t.length===1){var r=this.lexer.catcodes[t];if(r!=null&&r!==13)return}var a=typeof n=="function"?n(this):n;if(typeof a=="string"){var l=0;if(a.indexOf("#")!==-1)for(var f=a.replace(/##/g,"");f.indexOf("#"+(l+1))!==-1;)++l;for(var i=new D$(a,this.settings),y=[],x=i.lex();x.text!=="EOF";)y.push(x),x=i.lex();y.reverse();var S={tokens:y,numArgs:l};return S}return a}isDefined(t){return this.macros.has(t)||t0.hasOwnProperty(t)||fo.math.hasOwnProperty(t)||fo.text.hasOwnProperty(t)||uee.hasOwnProperty(t)}isExpandable(t){var n=this.macros.get(t);return n!=null?typeof n=="string"||typeof n=="function"||!n.unexpandable:t0.hasOwnProperty(t)&&!t0[t].primitive}}var F$=/^[]/,s4=Object.freeze({"":"+","":"-","":"=","":"(","":")","":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"a","":"e","":"h","":"i","":"j","":"k","":"l","":"m","":"n","":"o","":"p","":"r","":"s","":"t","":"u","":"v","":"x","":"","":"","":"","":"","":"","":"+","":"-","":"=","":"(","":")","":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"A","":"B","":"D","":"E","":"G","":"H","":"I","":"J","":"K","":"L","":"M","":"N","":"O","":"P","":"R","":"T","":"U","":"V","":"W","":"a","":"b","":"c","":"d","":"e","":"f","":"g",:"h","":"i",:"j","":"k",:"l","":"m",:"n","":"o","":"p",:"r",:"s","":"t","":"u","":"v",:"w",:"x",:"y","":"z","":"","":"","":"","":"","":"","":""}),IR={"":{text:"\\'",math:"\\acute"},"":{text:"\\`",math:"\\grave"},"":{text:'\\"',math:"\\ddot"},"":{text:"\\~",math:"\\tilde"},"":{text:"\\=",math:"\\bar"},"":{text:"\\u",math:"\\breve"},"":{text:"\\v",math:"\\check"},"":{text:"\\^",math:"\\hat"},"":{text:"\\.",math:"\\dot"},"":{text:"\\r",math:"\\mathring"},"":{text:"\\H"},"":{text:"\\c"}},B$={:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"b",:"c",:"c",:"c",:"c",:"c",:"c",:"d",:"d",:"d",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"f",:"g",:"g",:"g",:"g",:"g",:"g",:"g",:"h",:"h",:"h",:"h",:"h",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"j",:"j",:"k",:"k",:"k",:"l",:"l",:"l",:"m",:"m",:"n",:"n",:"n",:"n",:"n",:"n",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"p",:"p",:"r",:"r",:"r",:"r",:"s",:"s",:"s",:"s",:"s",:"s",:"s",:"t",:"t",:"t",:"t",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"v",:"w",:"w",:"w",:"w",:"w",:"w",:"x",:"x",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"z",:"z",:"z",:"z",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"B",:"C",:"C",:"C",:"C",:"C",:"C",:"D",:"D",:"D",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"F",:"G",:"G",:"G",:"G",:"G",:"G",:"G",:"H",:"H",:"H",:"H",:"H",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"J",:"K",:"K",:"K",:"L",:"L",:"L",:"M",:"M",:"N",:"N",:"N",:"N",:"N",:"N",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"P",:"P",:"R",:"R",:"R",:"R",:"S",:"S",:"S",:"S",:"S",:"S",:"S",:"T",:"T",:"T",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"V",:"W",:"W",:"W",:"W",:"W",:"X",:"X",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Z",:"Z",:"Z",:"Z",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""};let cee=class dee{constructor(t,n){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new rEe(t,n,this.mode),this.settings=n,this.leftrightDepth=0}expect(t,n){if(n===void 0&&(n=!0),this.fetch().text!==t)throw new rr("Expected '"+t+"', got '"+this.fetch().text+"'",this.fetch());n&&this.consume()}consume(){this.nextToken=null}fetch(){return this.nextToken==null&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(t){this.mode=t,this.gullet.switchMode(t)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{var t=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),t}finally{this.gullet.endGroups()}}subparse(t){var n=this.nextToken;this.consume(),this.gullet.pushToken(new Bc("}")),this.gullet.pushTokens(t);var r=this.parseExpression(!1);return this.expect("}"),this.nextToken=n,r}parseExpression(t,n){for(var r=[];;){this.mode==="math"&&this.consumeSpaces();var a=this.fetch();if(dee.endOfExpression.indexOf(a.text)!==-1||n&&a.text===n||t&&t0[a.text]&&t0[a.text].infix)break;var l=this.parseAtom(n);if(l){if(l.type==="internal")continue}else break;r.push(l)}return this.mode==="text"&&this.formLigatures(r),this.handleInfixNodes(r)}handleInfixNodes(t){for(var n=-1,r,a=0;a<t.length;a++)if(t[a].type==="infix"){if(n!==-1)throw new rr("only one infix operator per group",t[a].token);n=a,r=t[a].replaceWith}if(n!==-1&&r){var l,f,i=t.slice(0,n),y=t.slice(n+1);i.length===1&&i[0].type==="ordgroup"?l=i[0]:l={type:"ordgroup",mode:this.mode,body:i},y.length===1&&y[0].type==="ordgroup"?f=y[0]:f={type:"ordgroup",mode:this.mode,body:y};var x;return r==="\\\\abovefrac"?x=this.callFunction(r,[l,t[n],f],[]):x=this.callFunction(r,[l,f],[]),[x]}else return t}handleSupSubscript(t){var n=this.fetch(),r=n.text;this.consume(),this.consumeSpaces();var a;do{var l;a=this.parseGroup(t)}while(((l=a)==null?void 0:l.type)==="internal");if(!a)throw new rr("Expected group after '"+r+"'",n);return a}formatUnsupportedCmd(t){for(var n=[],r=0;r<t.length;r++)n.push({type:"textord",mode:"text",text:t[r]});var a={type:"text",mode:this.mode,body:n},l={type:"color",mode:this.mode,color:this.settings.errorColor,body:[a]};return l}parseAtom(t){var n=this.parseGroup("atom",t);if((n==null?void 0:n.type)==="internal"||this.mode==="text")return n;for(var r,a;;){this.consumeSpaces();var l=this.fetch();if(l.text==="\\limits"||l.text==="\\nolimits"){if(n&&n.type==="op"){var f=l.text==="\\limits";n.limits=f,n.alwaysHandleSupSub=!0}else if(n&&n.type==="operatorname")n.alwaysHandleSupSub&&(n.limits=l.text==="\\limits");else throw new rr("Limit controls must follow a math operator",l);this.consume()}else if(l.text==="^"){if(r)throw new rr("Double superscript",l);r=this.handleSupSubscript("superscript")}else if(l.text==="_"){if(a)throw new rr("Double subscript",l);a=this.handleSupSubscript("subscript")}else if(l.text==="'"){if(r)throw new rr("Double superscript",l);var i={type:"textord",mode:this.mode,text:"\\prime"},y=[i];for(this.consume();this.fetch().text==="'";)y.push(i),this.consume();this.fetch().text==="^"&&y.push(this.handleSupSubscript("superscript")),r={type:"ordgroup",mode:this.mode,body:y}}else if(s4[l.text]){var x=F$.test(l.text),S=[];for(S.push(new Bc(s4[l.text])),this.consume();;){var C=this.fetch().text;if(!s4[C]||F$.test(C)!==x)break;S.unshift(new Bc(s4[C])),this.consume()}var P=this.subparse(S);x?a={type:"ordgroup",mode:"math",body:P}:r={type:"ordgroup",mode:"math",body:P}}else break}return r||a?{type:"supsub",mode:this.mode,base:n,sup:r,sub:a}:n}parseFunction(t,n){var r=this.fetch(),a=r.text,l=t0[a];if(!l)return null;if(this.consume(),n&&n!=="atom"&&!l.allowedInArgument)throw new rr("Got function '"+a+"' with no arguments"+(n?" as "+n:""),r);if(this.mode==="text"&&!l.allowedInText)throw new rr("Can't use function '"+a+"' in text mode",r);if(this.mode==="math"&&l.allowedInMath===!1)throw new rr("Can't use function '"+a+"' in math mode",r);var{args:f,optArgs:i}=this.parseArguments(a,l);return this.callFunction(a,f,i,r,t)}callFunction(t,n,r,a,l){var f={funcName:t,parser:this,token:a,breakOnTokenText:l},i=t0[t];if(i&&i.handler)return i.handler(f,n,r);throw new rr("No function handler for "+t)}parseArguments(t,n){var r=n.numArgs+n.numOptionalArgs;if(r===0)return{args:[],optArgs:[]};for(var a=[],l=[],f=0;f<r;f++){var i=n.argTypes&&n.argTypes[f],y=f<n.numOptionalArgs;(n.primitive&&i==null||n.type==="sqrt"&&f===1&&l[0]==null)&&(i="primitive");var x=this.parseGroupOfType("argument to '"+t+"'",i,y);if(y)l.push(x);else if(x!=null)a.push(x);else throw new rr("Null argument, please report this as a bug")}return{args:a,optArgs:l}}parseGroupOfType(t,n,r){switch(n){case"color":return this.parseColorGroup(r);case"size":return this.parseSizeGroup(r);case"url":return this.parseUrlGroup(r);case"math":case"text":return this.parseArgumentGroup(r,n);case"hbox":{var a=this.parseArgumentGroup(r,"text");return a!=null?{type:"styling",mode:a.mode,body:[a],style:"text"}:null}case"raw":{var l=this.parseStringGroup("raw",r);return l!=null?{type:"raw",mode:"text",string:l.text}:null}case"primitive":{if(r)throw new rr("A primitive argument cannot be optional");var f=this.parseGroup(t);if(f==null)throw new rr("Expected group as "+t,this.fetch());return f}case"original":case null:case void 0:return this.parseArgumentGroup(r);default:throw new rr("Unknown group type as "+t,this.fetch())}}consumeSpaces(){for(;this.fetch().text===" ";)this.consume()}parseStringGroup(t,n){var r=this.gullet.scanArgument(n);if(r==null)return null;for(var a="",l;(l=this.fetch()).text!=="EOF";)a+=l.text,this.consume();return this.consume(),r.text=a,r}parseRegexGroup(t,n){for(var r=this.fetch(),a=r,l="",f;(f=this.fetch()).text!=="EOF"&&t.test(l+f.text);)a=f,l+=a.text,this.consume();if(l==="")throw new rr("Invalid "+n+": '"+r.text+"'",r);return r.range(a,l)}parseColorGroup(t){var n=this.parseStringGroup("color",t);if(n==null)return null;var r=/^(#[a-f0-9]{3,4}|#[a-f0-9]{6}|#[a-f0-9]{8}|[a-f0-9]{6}|[a-z]+)$/i.exec(n.text);if(!r)throw new rr("Invalid color: '"+n.text+"'",n);var a=r[0];return/^[0-9a-f]{6}$/i.test(a)&&(a="#"+a),{type:"color-token",mode:this.mode,color:a}}parseSizeGroup(t){var n,r=!1;if(this.gullet.consumeSpaces(),!t&&this.gullet.future().text!=="{"?n=this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size"):n=this.parseStringGroup("size",t),!n)return null;!t&&n.text.length===0&&(n.text="0pt",r=!0);var a=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(n.text);if(!a)throw new rr("Invalid size: '"+n.text+"'",n);var l={number:+(a[1]+a[2]),unit:a[3]};if(!vJ(l))throw new rr("Invalid unit: '"+l.unit+"'",n);return{type:"size",mode:this.mode,value:l,isBlank:r}}parseUrlGroup(t){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);var n=this.parseStringGroup("url",t);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),n==null)return null;var r=n.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:r}}parseArgumentGroup(t,n){var r=this.gullet.scanArgument(t);if(r==null)return null;var a=this.mode;n&&this.switchMode(n),this.gullet.beginGroup();var l=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var f={type:"ordgroup",mode:this.mode,loc:r.loc,body:l};return n&&this.switchMode(a),f}parseGroup(t,n){var r=this.fetch(),a=r.text,l;if(a==="{"||a==="\\begingroup"){this.consume();var f=a==="{"?"}":"\\endgroup";this.gullet.beginGroup();var i=this.parseExpression(!1,f),y=this.fetch();this.expect(f),this.gullet.endGroup(),l={type:"ordgroup",mode:this.mode,loc:rc.range(r,y),body:i,semisimple:a==="\\begingroup"||void 0}}else if(l=this.parseFunction(n,t)||this.parseSymbol(),l==null&&a[0]==="\\"&&!uee.hasOwnProperty(a)){if(this.settings.throwOnError)throw new rr("Undefined control sequence: "+a,r);l=this.formatUnsupportedCmd(a),this.consume()}return l}formLigatures(t){for(var n=t.length-1,r=0;r<n;++r){var a=t[r],l=a.text;l==="-"&&t[r+1].text==="-"&&(r+1<n&&t[r+2].text==="-"?(t.splice(r,3,{type:"textord",mode:"text",loc:rc.range(a,t[r+2]),text:"---"}),n-=2):(t.splice(r,2,{type:"textord",mode:"text",loc:rc.range(a,t[r+1]),text:"--"}),n-=1)),(l==="'"||l==="`")&&t[r+1].text===l&&(t.splice(r,2,{type:"textord",mode:"text",loc:rc.range(a,t[r+1]),text:l+l}),n-=1)}}parseSymbol(){var t=this.fetch(),n=t.text;if(/^\\verb[^a-zA-Z]/.test(n)){this.consume();var r=n.slice(5),a=r.charAt(0)==="*";if(a&&(r=r.slice(1)),r.length<2||r.charAt(0)!==r.slice(-1))throw new rr(`\\verb assertion failed --
                    please report what input caused this bug`);return r=r.slice(1,-1),{type:"verb",mode:"text",body:r,star:a}}B$.hasOwnProperty(n[0])&&!fo[this.mode][n[0]]&&(this.settings.strict&&this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+n[0]+'" used in math mode',t),n=B$[n[0]]+n.slice(1));var l=JTe.exec(n);l&&(n=n.substring(0,l.index),n==="i"?n="":n==="j"&&(n=""));var f;if(fo[this.mode][n]){this.settings.strict&&this.mode==="math"&&VO.indexOf(n)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+n[0]+'" used in math mode',t);var i=fo[this.mode][n].group,y=rc.range(t),x;if(G2e.hasOwnProperty(i)){var S=i;x={type:"atom",mode:this.mode,family:S,loc:y,text:n}}else x={type:i,mode:this.mode,loc:y,text:n};f=x}else if(n.charCodeAt(0)>=128)this.settings.strict&&(_J(n.charCodeAt(0))?this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+n[0]+'" used in math mode',t):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+n[0]+'"'+(" ("+n.charCodeAt(0)+")"),t)),f={type:"textord",mode:"text",loc:rc.range(t),text:n};else return null;if(this.consume(),l)for(var C=0;C<l[0].length;C++){var P=l[0][C];if(!IR[P])throw new rr("Unknown accent ' "+P+"'",t);var L=IR[P][this.mode]||IR[P].text;if(!L)throw new rr("Accent "+P+" unsupported in "+this.mode+" mode",t);f={type:"accent",mode:this.mode,loc:rc.range(t),label:L,isStretchy:!1,isShifty:!0,base:f}}return f}};cee.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var WD=function(t,n){if(!(typeof t=="string"||t instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var r=new cee(t,n);delete r.gullet.macros.current["\\df@tag"];var a=r.parse();if(delete r.gullet.macros.current["\\current@color"],delete r.gullet.macros.current["\\color"],r.gullet.macros.get("\\df@tag")){if(!n.displayMode)throw new rr("\\tag works only in display equations");a=[{type:"tag",mode:"text",body:a,tag:r.subparse([new Bc("\\df@tag")])}]}return a},XD=function(t,n,r){n.textContent="";var a=qk(t,r).toNode();n.appendChild(a)};typeof document<"u"&&document.compatMode!=="CSS1Compat"&&(typeof console<"u"&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),XD=function(){throw new rr("KaTeX doesn't work in quirks mode.")});var hee=function(t,n){var r=qk(t,n).toMarkup();return r},fee=function(t,n){var r=new RD(n);return WD(t,r)},pee=function(t,n,r){if(r.throwOnError||!(t instanceof rr))throw t;var a=Xt.makeSpan(["katex-error"],[new Ed(n)]);return a.setAttribute("title",t.toString()),a.setAttribute("style","color:"+r.errorColor),a},qk=function(t,n){var r=new RD(n);try{var a=WD(t,r);return pTe(a,t,r)}catch(l){return pee(l,t,r)}},mee=function(t,n){var r=new RD(n);try{var a=WD(t,r);return mTe(a,t,r)}catch(l){return pee(l,t,r)}},gee="0.16.27",_ee={Span:oE,Anchor:OD,SymbolNode:Ed,SvgNode:Op,PathNode:R0,LineNode:UO},WO={version:gee,render:XD,renderToString:hee,ParseError:rr,SETTINGS_SCHEMA:O2,__parse:fee,__renderToDomTree:qk,__renderToHTMLTree:mee,__setFontMetrics:yJ,__defineSymbol:se,__defineFunction:Fr,__defineMacro:De,__domTree:_ee};const v9e=Object.freeze(Object.defineProperty({__proto__:null,ParseError:rr,SETTINGS_SCHEMA:O2,__defineFunction:Fr,__defineMacro:De,__defineSymbol:se,__domTree:_ee,__parse:fee,__renderToDomTree:qk,__renderToHTMLTree:mee,__setFontMetrics:yJ,default:WO,get render(){return XD},renderToString:hee,version:gee},Symbol.toStringTag,{value:"Module"})),iEe={},sEe=[];function XO(e){const t=e||iEe;return function(n,r){Ox(n,"element",function(a,l){const f=Array.isArray(a.properties.className)?a.properties.className:sEe,i=f.includes("language-math"),y=f.includes("math-display"),x=f.includes("math-inline");let S=y;if(!i&&!y&&!x)return;let C=l[l.length-1],P=a;if(a.tagName==="code"&&i&&C&&C.type==="element"&&C.tagName==="pre"&&(P=C,C=l[l.length-2],S=!0),!C)return;const L=i2e(P,{whitespace:"pre"});let F;try{F=WO.renderToString(L,{...t,displayMode:S,throwOnError:!0})}catch(q){const G=q,$=G.name.toLowerCase();r.message("Could not render math with KaTeX",{ancestors:[...l,a],cause:G,place:a.position,ruleId:$,source:"rehype-katex"});try{F=WO.renderToString(L,{...t,displayMode:S,strict:"ignore",throwOnError:!1})}catch{F=[{type:"element",tagName:"span",properties:{className:["katex-error"],style:"color:"+(t.errorColor||"#cc0000"),title:String(q)},children:[{type:"text",value:L}]}]}}typeof F=="string"&&(F=Ywe(F).children);const U=C.children.indexOf(P);return C.children.splice(U,1,...F),OC})}}const yee=-1,Zk=0,D2=1,BC=2,YD=3,KD=4,QD=5,JD=6,vee=7,xee=8,j$=typeof self=="object"?self:globalThis,aEe=(e,t)=>{const n=(a,l)=>(e.set(l,a),a),r=a=>{if(e.has(a))return e.get(a);const[l,f]=t[a];switch(l){case Zk:case yee:return n(f,a);case D2:{const i=n([],a);for(const y of f)i.push(r(y));return i}case BC:{const i=n({},a);for(const[y,x]of f)i[r(y)]=r(x);return i}case YD:return n(new Date(f),a);case KD:{const{source:i,flags:y}=f;return n(new RegExp(i,y),a)}case QD:{const i=n(new Map,a);for(const[y,x]of f)i.set(r(y),r(x));return i}case JD:{const i=n(new Set,a);for(const y of f)i.add(r(y));return i}case vee:{const{name:i,message:y}=f;return n(new j$[i](y),a)}case xee:return n(BigInt(f),a);case"BigInt":return n(Object(BigInt(f)),a);case"ArrayBuffer":return n(new Uint8Array(f).buffer,f);case"DataView":{const{buffer:i}=new Uint8Array(f);return n(new DataView(i),f)}}return n(new j$[l](f),a)};return r},U$=e=>aEe(new Map,e)(0),q1="",{toString:oEe}={},{keys:lEe}=Object,Yw=e=>{const t=typeof e;if(t!=="object"||!e)return[Zk,t];const n=oEe.call(e).slice(8,-1);switch(n){case"Array":return[D2,q1];case"Object":return[BC,q1];case"Date":return[YD,q1];case"RegExp":return[KD,q1];case"Map":return[QD,q1];case"Set":return[JD,q1];case"DataView":return[D2,n]}return n.includes("Array")?[D2,n]:n.includes("Error")?[vee,n]:[BC,n]},a4=([e,t])=>e===Zk&&(t==="function"||t==="symbol"),uEe=(e,t,n,r)=>{const a=(f,i)=>{const y=r.push(f)-1;return n.set(i,y),y},l=f=>{if(n.has(f))return n.get(f);let[i,y]=Yw(f);switch(i){case Zk:{let S=f;switch(y){case"bigint":i=xee,S=f.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+y);S=null;break;case"undefined":return a([yee],f)}return a([i,S],f)}case D2:{if(y){let P=f;return y==="DataView"?P=new Uint8Array(f.buffer):y==="ArrayBuffer"&&(P=new Uint8Array(f)),a([y,[...P]],f)}const S=[],C=a([i,S],f);for(const P of f)S.push(l(P));return C}case BC:{if(y)switch(y){case"BigInt":return a([y,f.toString()],f);case"Boolean":case"Number":case"String":return a([y,f.valueOf()],f)}if(t&&"toJSON"in f)return l(f.toJSON());const S=[],C=a([i,S],f);for(const P of lEe(f))(e||!a4(Yw(f[P])))&&S.push([l(P),l(f[P])]);return C}case YD:return a([i,f.toISOString()],f);case KD:{const{source:S,flags:C}=f;return a([i,{source:S,flags:C}],f)}case QD:{const S=[],C=a([i,S],f);for(const[P,L]of f)(e||!(a4(Yw(P))||a4(Yw(L))))&&S.push([l(P),l(L)]);return C}case JD:{const S=[],C=a([i,S],f);for(const P of f)(e||!a4(Yw(P)))&&S.push(l(P));return C}}const{message:x}=f;return a([i,{name:y,message:x}],f)};return l},V$=(e,{json:t,lossy:n}={})=>{const r=[];return uEe(!(t||n),!!t,new Map,r)(e),r},P_=typeof structuredClone=="function"?(e,t)=>t&&("json"in t||"lossy"in t)?U$(V$(e,t)):structuredClone(e):(e,t)=>U$(V$(e,t));let uE=class{constructor(t,n,r){this.normal=n,this.property=t,r&&(this.space=r)}};uE.prototype.normal={};uE.prototype.property={};uE.prototype.space=void 0;function bee(e,t){const n={},r={};for(const a of e)Object.assign(n,a.property),Object.assign(r,a.normal);return new uE(n,r,t)}function CT(e){return e.toLowerCase()}let pc=class{constructor(t,n){this.attribute=n,this.property=t}};pc.prototype.attribute="";pc.prototype.booleanish=!1;pc.prototype.boolean=!1;pc.prototype.commaOrSpaceSeparated=!1;pc.prototype.commaSeparated=!1;pc.prototype.defined=!1;pc.prototype.mustUseProperty=!1;pc.prototype.number=!1;pc.prototype.overloadedBoolean=!1;pc.prototype.property="";pc.prototype.spaceSeparated=!1;pc.prototype.space=void 0;let cEe=0;const js=W_(),cl=W_(),YO=W_(),cr=W_(),lo=W_(),Av=W_(),Ic=W_();function W_(){return 2**++cEe}const KO=Object.freeze(Object.defineProperty({__proto__:null,boolean:js,booleanish:cl,commaOrSpaceSeparated:Ic,commaSeparated:Av,number:cr,overloadedBoolean:YO,spaceSeparated:lo},Symbol.toStringTag,{value:"Module"})),RR=Object.keys(KO);let eN=class extends pc{constructor(t,n,r,a){let l=-1;if(super(t,n),$$(this,"space",a),typeof r=="number")for(;++l<RR.length;){const f=RR[l];$$(this,RR[l],(r&KO[f])===KO[f])}}};eN.prototype.defined=!0;function $$(e,t,n){n&&(e[t]=n)}function zx(e){const t={},n={};for(const[r,a]of Object.entries(e.properties)){const l=new eN(r,e.transform(e.attributes||{},r),a,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(l.mustUseProperty=!0),t[r]=l,n[CT(r)]=r,n[CT(l.attribute)]=r}return new uE(t,n,e.space)}const wee=zx({properties:{ariaActiveDescendant:null,ariaAtomic:cl,ariaAutoComplete:null,ariaBusy:cl,ariaChecked:cl,ariaColCount:cr,ariaColIndex:cr,ariaColSpan:cr,ariaControls:lo,ariaCurrent:null,ariaDescribedBy:lo,ariaDetails:null,ariaDisabled:cl,ariaDropEffect:lo,ariaErrorMessage:null,ariaExpanded:cl,ariaFlowTo:lo,ariaGrabbed:cl,ariaHasPopup:null,ariaHidden:cl,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:lo,ariaLevel:cr,ariaLive:null,ariaModal:cl,ariaMultiLine:cl,ariaMultiSelectable:cl,ariaOrientation:null,ariaOwns:lo,ariaPlaceholder:null,ariaPosInSet:cr,ariaPressed:cl,ariaReadOnly:cl,ariaRelevant:null,ariaRequired:cl,ariaRoleDescription:lo,ariaRowCount:cr,ariaRowIndex:cr,ariaRowSpan:cr,ariaSelected:cl,ariaSetSize:cr,ariaSort:null,ariaValueMax:cr,ariaValueMin:cr,ariaValueNow:cr,ariaValueText:null,role:null},transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function Tee(e,t){return t in e?e[t]:t}function Eee(e,t){return Tee(e,t.toLowerCase())}const dEe=zx({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Av,acceptCharset:lo,accessKey:lo,action:null,allow:null,allowFullScreen:js,allowPaymentRequest:js,allowUserMedia:js,alt:null,as:null,async:js,autoCapitalize:null,autoComplete:lo,autoFocus:js,autoPlay:js,blocking:lo,capture:null,charSet:null,checked:js,cite:null,className:lo,cols:cr,colSpan:null,content:null,contentEditable:cl,controls:js,controlsList:lo,coords:cr|Av,crossOrigin:null,data:null,dateTime:null,decoding:null,default:js,defer:js,dir:null,dirName:null,disabled:js,download:YO,draggable:cl,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:js,formTarget:null,headers:lo,height:cr,hidden:YO,high:cr,href:null,hrefLang:null,htmlFor:lo,httpEquiv:lo,id:null,imageSizes:null,imageSrcSet:null,inert:js,inputMode:null,integrity:null,is:null,isMap:js,itemId:null,itemProp:lo,itemRef:lo,itemScope:js,itemType:lo,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:js,low:cr,manifest:null,max:null,maxLength:cr,media:null,method:null,min:null,minLength:cr,multiple:js,muted:js,name:null,nonce:null,noModule:js,noValidate:js,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:js,optimum:cr,pattern:null,ping:lo,placeholder:null,playsInline:js,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:js,referrerPolicy:null,rel:lo,required:js,reversed:js,rows:cr,rowSpan:cr,sandbox:lo,scope:null,scoped:js,seamless:js,selected:js,shadowRootClonable:js,shadowRootDelegatesFocus:js,shadowRootMode:null,shape:null,size:cr,sizes:null,slot:null,span:cr,spellCheck:cl,src:null,srcDoc:null,srcLang:null,srcSet:null,start:cr,step:null,style:null,tabIndex:cr,target:null,title:null,translate:null,type:null,typeMustMatch:js,useMap:null,value:cl,width:cr,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:lo,axis:null,background:null,bgColor:null,border:cr,borderColor:null,bottomMargin:cr,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:js,declare:js,event:null,face:null,frame:null,frameBorder:null,hSpace:cr,leftMargin:cr,link:null,longDesc:null,lowSrc:null,marginHeight:cr,marginWidth:cr,noResize:js,noHref:js,noShade:js,noWrap:js,object:null,profile:null,prompt:null,rev:null,rightMargin:cr,rules:null,scheme:null,scrolling:cl,standby:null,summary:null,text:null,topMargin:cr,valueType:null,version:null,vAlign:null,vLink:null,vSpace:cr,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:js,disableRemotePlayback:js,prefix:null,property:null,results:cr,security:null,unselectable:null},space:"html",transform:Eee}),hEe=zx({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Ic,accentHeight:cr,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:cr,amplitude:cr,arabicForm:null,ascent:cr,attributeName:null,attributeType:null,azimuth:cr,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:cr,by:null,calcMode:null,capHeight:cr,className:lo,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:cr,diffuseConstant:cr,direction:null,display:null,dur:null,divisor:cr,dominantBaseline:null,download:js,dx:null,dy:null,edgeMode:null,editable:null,elevation:cr,enableBackground:null,end:null,event:null,exponent:cr,externalResourcesRequired:null,fill:null,fillOpacity:cr,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Av,g2:Av,glyphName:Av,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:cr,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:cr,horizOriginX:cr,horizOriginY:cr,id:null,ideographic:cr,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:cr,k:cr,k1:cr,k2:cr,k3:cr,k4:cr,kernelMatrix:Ic,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:cr,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:cr,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:cr,overlineThickness:cr,paintOrder:null,panose1:null,path:null,pathLength:cr,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:lo,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:cr,pointsAtY:cr,pointsAtZ:cr,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Ic,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Ic,rev:Ic,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Ic,requiredFeatures:Ic,requiredFonts:Ic,requiredFormats:Ic,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:cr,specularExponent:cr,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:cr,strikethroughThickness:cr,string:null,stroke:null,strokeDashArray:Ic,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:cr,strokeOpacity:cr,strokeWidth:null,style:null,surfaceScale:cr,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Ic,tabIndex:cr,tableValues:null,target:null,targetX:cr,targetY:cr,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Ic,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:cr,underlineThickness:cr,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:cr,values:null,vAlphabetic:cr,vMathematical:cr,vectorEffect:null,vHanging:cr,vIdeographic:cr,version:null,vertAdvY:cr,vertOriginX:cr,vertOriginY:cr,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:cr,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:Tee}),See=zx({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()}}),Aee=zx({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:Eee}),Cee=zx({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()}}),fEe=/[A-Z]/g,H$=/-[a-z]/g,pEe=/^data[-\w.:]+$/i;function kee(e,t){const n=CT(t);let r=t,a=pc;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&pEe.test(t)){if(t.charAt(4)==="-"){const l=t.slice(5).replace(H$,gEe);r="data"+l.charAt(0).toUpperCase()+l.slice(1)}else{const l=t.slice(4);if(!H$.test(l)){let f=l.replace(fEe,mEe);f.charAt(0)!=="-"&&(f="-"+f),t="data"+f}}a=eN}return new a(r,t)}function mEe(e){return"-"+e.toLowerCase()}function gEe(e){return e.charAt(1).toUpperCase()}const tN=bee([wee,dEe,See,Aee,Cee],"html"),nN=bee([wee,hEe,See,Aee,Cee],"svg"),G$=/[#.]/g;function _Ee(e,t){const n=e||"",r={};let a=0,l,f;for(;a<n.length;){G$.lastIndex=a;const i=G$.exec(n),y=n.slice(a,i?i.index:n.length);y&&(l?l==="#"?r.id=y:Array.isArray(r.className)?r.className.push(y):r.className=[y]:f=y,a+=y.length),i&&(l=i[0],a++)}return{type:"element",tagName:f||t||"div",properties:r,children:[]}}function Iee(e,t,n){const r=n?bEe(n):void 0;function a(l,f,...i){let y;if(l==null){y={type:"root",children:[]};const x=f;i.unshift(x)}else{y=_Ee(l,t);const x=y.tagName.toLowerCase(),S=r?r.get(x):void 0;if(y.tagName=S||x,yEe(f))i.unshift(f);else for(const[C,P]of Object.entries(f))vEe(e,y.properties,C,P)}for(const x of i)QO(y.children,x);return y.type==="element"&&y.tagName==="template"&&(y.content={type:"root",children:y.children},y.children=[]),y}return a}function yEe(e){if(e===null||typeof e!="object"||Array.isArray(e))return!0;if(typeof e.type!="string")return!1;const t=e,n=Object.keys(e);for(const r of n){const a=t[r];if(a&&typeof a=="object"){if(!Array.isArray(a))return!0;const l=a;for(const f of l)if(typeof f!="number"&&typeof f!="string")return!0}}return!!("children"in e&&Array.isArray(e.children))}function vEe(e,t,n,r){const a=kee(e,n);let l;if(r!=null){if(typeof r=="number"){if(Number.isNaN(r))return;l=r}else typeof r=="boolean"?l=r:typeof r=="string"?a.spaceSeparated?l=JA(r):a.commaSeparated?l=eC(r):a.commaOrSpaceSeparated?l=JA(eC(r).join(" ")):l=q$(a,a.property,r):Array.isArray(r)?l=[...r]:l=a.property==="style"?xEe(r):String(r);if(Array.isArray(l)){const f=[];for(const i of l)f.push(q$(a,a.property,i));l=f}a.property==="className"&&Array.isArray(t.className)&&(l=t.className.concat(l)),t[a.property]=l}}function QO(e,t){if(t!=null)if(typeof t=="number"||typeof t=="string")e.push({type:"text",value:String(t)});else if(Array.isArray(t))for(const n of t)QO(e,n);else if(typeof t=="object"&&"type"in t)t.type==="root"?QO(e,t.children):e.push(t);else throw new Error("Expected node, nodes, or string, got `"+t+"`")}function q$(e,t,n){if(typeof n=="string"){if(e.number&&n&&!Number.isNaN(Number(n)))return Number(n);if((e.boolean||e.overloadedBoolean)&&(n===""||CT(n)===CT(t)))return!0}return n}function xEe(e){const t=[];for(const[n,r]of Object.entries(e))t.push([n,r].join(": "));return t.join("; ")}function bEe(e){const t=new Map;for(const n of e)t.set(n.toLowerCase(),n);return t}const wEe=["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","solidColor","textArea","textPath"],TEe=Iee(tN,"div"),EEe=Iee(nN,"g",wEe);function SEe(e){const t=String(e),n=[];return{toOffset:a,toPoint:r};function r(l){if(typeof l=="number"&&l>-1&&l<=t.length){let f=0;for(;;){let i=n[f];if(i===void 0){const y=Z$(t,n[f-1]);i=y===-1?t.length+1:y+1,n[f]=i}if(i>l)return{line:f+1,column:l-(f>0?n[f-1]:0)+1,offset:l};f++}}}function a(l){if(l&&typeof l.line=="number"&&typeof l.column=="number"&&!Number.isNaN(l.line)&&!Number.isNaN(l.column)){for(;n.length<l.line;){const i=n[n.length-1],y=Z$(t,i),x=y===-1?t.length+1:y+1;if(i===x)break;n.push(x)}const f=(l.line>1?n[l.line-2]:0)+l.column-1;if(f<n[l.line-1])return f}}}function Z$(e,t){const n=e.indexOf("\r",t),r=e.indexOf(`
`,t);return r===-1?n:n===-1||n+1===r?r:n<r?n:r}const Ree={}.hasOwnProperty,AEe=Object.prototype;function CEe(e,t){const n=t||{};return rN({file:n.file||void 0,location:!1,schema:n.space==="svg"?nN:tN,verbose:n.verbose||!1},e)}function rN(e,t){let n;switch(t.nodeName){case"#comment":{const r=t;return n={type:"comment",value:r.data},pA(e,r,n),n}case"#document":case"#document-fragment":{const r=t,a="mode"in r?r.mode==="quirks"||r.mode==="limited-quirks":!1;if(n={type:"root",children:Mee(e,t.childNodes),data:{quirksMode:a}},e.file&&e.location){const l=String(e.file),f=SEe(l),i=f.toPoint(0),y=f.toPoint(l.length);n.position={start:i,end:y}}return n}case"#documentType":{const r=t;return n={type:"doctype"},pA(e,r,n),n}case"#text":{const r=t;return n={type:"text",value:r.value},pA(e,r,n),n}default:return n=kEe(e,t),n}}function Mee(e,t){let n=-1;const r=[];for(;++n<t.length;){const a=rN(e,t[n]);r.push(a)}return r}function kEe(e,t){const n=e.schema;e.schema=t.namespaceURI===df.svg?nN:tN;let r=-1;const a={};for(;++r<t.attrs.length;){const i=t.attrs[r],y=(i.prefix?i.prefix+":":"")+i.name;Ree.call(AEe,y)||(a[y]=i.value)}const f=(e.schema.space==="svg"?EEe:TEe)(t.tagName,a,Mee(e,t.childNodes));if(pA(e,t,f),f.tagName==="template"){const i=t,y=i.sourceCodeLocation,x=y&&y.startTag&&pv(y.startTag),S=y&&y.endTag&&pv(y.endTag),C=rN(e,i.content);x&&S&&e.file&&(C.position={start:x.end,end:S.start}),f.content=C}return e.schema=n,f}function pA(e,t,n){if("sourceCodeLocation"in t&&t.sourceCodeLocation&&e.file){const r=IEe(e,n,t.sourceCodeLocation);r&&(e.location=!0,n.position=r)}}function IEe(e,t,n){const r=pv(n);if(t.type==="element"){const a=t.children[t.children.length-1];if(r&&!n.endTag&&a&&a.position&&a.position.end&&(r.end=Object.assign({},a.position.end)),e.verbose){const l={};let f;if(n.attrs)for(f in n.attrs)Ree.call(n.attrs,f)&&(l[kee(e.schema,f).property]=pv(n.attrs[f]));n.startTag;const i=pv(n.startTag),y=n.endTag?pv(n.endTag):void 0,x={opening:i};y&&(x.closing=y),x.properties=l,t.data={position:x}}}return r}function pv(e){const t=W$({line:e.startLine,column:e.startCol,offset:e.startOffset}),n=W$({line:e.endLine,column:e.endCol,offset:e.endOffset});return t||n?{start:t,end:n}:void 0}function W$(e){return e.line&&e.column?e:void 0}let cE=class{constructor(t,n,r){this.normal=n,this.property=t,r&&(this.space=r)}};cE.prototype.normal={};cE.prototype.property={};cE.prototype.space=void 0;function Pee(e,t){const n={},r={};for(const a of e)Object.assign(n,a.property),Object.assign(r,a.normal);return new cE(n,r,t)}function JO(e){return e.toLowerCase()}let mc=class{constructor(t,n){this.attribute=n,this.property=t}};mc.prototype.attribute="";mc.prototype.booleanish=!1;mc.prototype.boolean=!1;mc.prototype.commaOrSpaceSeparated=!1;mc.prototype.commaSeparated=!1;mc.prototype.defined=!1;mc.prototype.mustUseProperty=!1;mc.prototype.number=!1;mc.prototype.overloadedBoolean=!1;mc.prototype.property="";mc.prototype.spaceSeparated=!1;mc.prototype.space=void 0;let REe=0;const Us=X_(),dl=X_(),e8=X_(),dr=X_(),uo=X_(),Cv=X_(),Rc=X_();function X_(){return 2**++REe}const t8=Object.freeze(Object.defineProperty({__proto__:null,boolean:Us,booleanish:dl,commaOrSpaceSeparated:Rc,commaSeparated:Cv,number:dr,overloadedBoolean:e8,spaceSeparated:uo},Symbol.toStringTag,{value:"Module"})),MR=Object.keys(t8);let iN=class extends mc{constructor(t,n,r,a){let l=-1;if(super(t,n),X$(this,"space",a),typeof r=="number")for(;++l<MR.length;){const f=MR[l];X$(this,MR[l],(r&t8[f])===t8[f])}}};iN.prototype.defined=!0;function X$(e,t,n){n&&(e[t]=n)}function Fx(e){const t={},n={};for(const[r,a]of Object.entries(e.properties)){const l=new iN(r,e.transform(e.attributes||{},r),a,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(l.mustUseProperty=!0),t[r]=l,n[JO(r)]=r,n[JO(l.attribute)]=r}return new cE(t,n,e.space)}const Oee=Fx({properties:{ariaActiveDescendant:null,ariaAtomic:dl,ariaAutoComplete:null,ariaBusy:dl,ariaChecked:dl,ariaColCount:dr,ariaColIndex:dr,ariaColSpan:dr,ariaControls:uo,ariaCurrent:null,ariaDescribedBy:uo,ariaDetails:null,ariaDisabled:dl,ariaDropEffect:uo,ariaErrorMessage:null,ariaExpanded:dl,ariaFlowTo:uo,ariaGrabbed:dl,ariaHasPopup:null,ariaHidden:dl,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:uo,ariaLevel:dr,ariaLive:null,ariaModal:dl,ariaMultiLine:dl,ariaMultiSelectable:dl,ariaOrientation:null,ariaOwns:uo,ariaPlaceholder:null,ariaPosInSet:dr,ariaPressed:dl,ariaReadOnly:dl,ariaRelevant:null,ariaRequired:dl,ariaRoleDescription:uo,ariaRowCount:dr,ariaRowIndex:dr,ariaRowSpan:dr,ariaSelected:dl,ariaSetSize:dr,ariaSort:null,ariaValueMax:dr,ariaValueMin:dr,ariaValueNow:dr,ariaValueText:null,role:null},transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function Lee(e,t){return t in e?e[t]:t}function Dee(e,t){return Lee(e,t.toLowerCase())}const MEe=Fx({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Cv,acceptCharset:uo,accessKey:uo,action:null,allow:null,allowFullScreen:Us,allowPaymentRequest:Us,allowUserMedia:Us,alt:null,as:null,async:Us,autoCapitalize:null,autoComplete:uo,autoFocus:Us,autoPlay:Us,blocking:uo,capture:null,charSet:null,checked:Us,cite:null,className:uo,cols:dr,colSpan:null,content:null,contentEditable:dl,controls:Us,controlsList:uo,coords:dr|Cv,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Us,defer:Us,dir:null,dirName:null,disabled:Us,download:e8,draggable:dl,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Us,formTarget:null,headers:uo,height:dr,hidden:e8,high:dr,href:null,hrefLang:null,htmlFor:uo,httpEquiv:uo,id:null,imageSizes:null,imageSrcSet:null,inert:Us,inputMode:null,integrity:null,is:null,isMap:Us,itemId:null,itemProp:uo,itemRef:uo,itemScope:Us,itemType:uo,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Us,low:dr,manifest:null,max:null,maxLength:dr,media:null,method:null,min:null,minLength:dr,multiple:Us,muted:Us,name:null,nonce:null,noModule:Us,noValidate:Us,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Us,optimum:dr,pattern:null,ping:uo,placeholder:null,playsInline:Us,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Us,referrerPolicy:null,rel:uo,required:Us,reversed:Us,rows:dr,rowSpan:dr,sandbox:uo,scope:null,scoped:Us,seamless:Us,selected:Us,shadowRootClonable:Us,shadowRootDelegatesFocus:Us,shadowRootMode:null,shape:null,size:dr,sizes:null,slot:null,span:dr,spellCheck:dl,src:null,srcDoc:null,srcLang:null,srcSet:null,start:dr,step:null,style:null,tabIndex:dr,target:null,title:null,translate:null,type:null,typeMustMatch:Us,useMap:null,value:dl,width:dr,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:uo,axis:null,background:null,bgColor:null,border:dr,borderColor:null,bottomMargin:dr,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Us,declare:Us,event:null,face:null,frame:null,frameBorder:null,hSpace:dr,leftMargin:dr,link:null,longDesc:null,lowSrc:null,marginHeight:dr,marginWidth:dr,noResize:Us,noHref:Us,noShade:Us,noWrap:Us,object:null,profile:null,prompt:null,rev:null,rightMargin:dr,rules:null,scheme:null,scrolling:dl,standby:null,summary:null,text:null,topMargin:dr,valueType:null,version:null,vAlign:null,vLink:null,vSpace:dr,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Us,disableRemotePlayback:Us,prefix:null,property:null,results:dr,security:null,unselectable:null},space:"html",transform:Dee}),PEe=Fx({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Rc,accentHeight:dr,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:dr,amplitude:dr,arabicForm:null,ascent:dr,attributeName:null,attributeType:null,azimuth:dr,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:dr,by:null,calcMode:null,capHeight:dr,className:uo,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:dr,diffuseConstant:dr,direction:null,display:null,dur:null,divisor:dr,dominantBaseline:null,download:Us,dx:null,dy:null,edgeMode:null,editable:null,elevation:dr,enableBackground:null,end:null,event:null,exponent:dr,externalResourcesRequired:null,fill:null,fillOpacity:dr,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Cv,g2:Cv,glyphName:Cv,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:dr,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:dr,horizOriginX:dr,horizOriginY:dr,id:null,ideographic:dr,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:dr,k:dr,k1:dr,k2:dr,k3:dr,k4:dr,kernelMatrix:Rc,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:dr,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:dr,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:dr,overlineThickness:dr,paintOrder:null,panose1:null,path:null,pathLength:dr,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:uo,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:dr,pointsAtY:dr,pointsAtZ:dr,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Rc,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Rc,rev:Rc,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Rc,requiredFeatures:Rc,requiredFonts:Rc,requiredFormats:Rc,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:dr,specularExponent:dr,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:dr,strikethroughThickness:dr,string:null,stroke:null,strokeDashArray:Rc,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:dr,strokeOpacity:dr,strokeWidth:null,style:null,surfaceScale:dr,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Rc,tabIndex:dr,tableValues:null,target:null,targetX:dr,targetY:dr,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Rc,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:dr,underlineThickness:dr,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:dr,values:null,vAlphabetic:dr,vMathematical:dr,vectorEffect:null,vHanging:dr,vIdeographic:dr,version:null,vertAdvY:dr,vertOriginX:dr,vertOriginY:dr,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:dr,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:Lee}),Nee=Fx({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()}}),zee=Fx({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:Dee}),Fee=Fx({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()}}),OEe=/[A-Z]/g,Y$=/-[a-z]/g,LEe=/^data[-\w.:]+$/i;function DEe(e,t){const n=JO(t);let r=t,a=mc;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&LEe.test(t)){if(t.charAt(4)==="-"){const l=t.slice(5).replace(Y$,zEe);r="data"+l.charAt(0).toUpperCase()+l.slice(1)}else{const l=t.slice(4);if(!Y$.test(l)){let f=l.replace(OEe,NEe);f.charAt(0)!=="-"&&(f="-"+f),t="data"+f}}a=iN}return new a(r,t)}function NEe(e){return"-"+e.toLowerCase()}function zEe(e){return e.charAt(1).toUpperCase()}const FEe=Pee([Oee,MEe,Nee,zee,Fee],"html"),Bee=Pee([Oee,PEe,Nee,zee,Fee],"svg"),K$={}.hasOwnProperty;function jee(e,t){const n=t||{};function r(a,...l){let f=r.invalid;const i=r.handlers;if(a&&K$.call(a,e)){const y=String(a[e]);f=K$.call(i,y)?i[y]:r.unknown}if(f)return f.call(this,a,...l)}return r.handlers=n.handlers||{},r.invalid=n.invalid,r.unknown=n.unknown,r}const BEe={},jEe={}.hasOwnProperty,Uee=jee("type",{handlers:{root:VEe,element:ZEe,text:GEe,comment:qEe,doctype:HEe}});function UEe(e,t){const r=(t||BEe).space;return Uee(e,r==="svg"?Bee:FEe)}function VEe(e,t){const n={nodeName:"#document",mode:(e.data||{}).quirksMode?"quirks":"no-quirks",childNodes:[]};return n.childNodes=sN(e.children,n,t),Bx(e,n),n}function $Ee(e,t){const n={nodeName:"#document-fragment",childNodes:[]};return n.childNodes=sN(e.children,n,t),Bx(e,n),n}function HEe(e){const t={nodeName:"#documentType",name:"html",publicId:"",systemId:"",parentNode:null};return Bx(e,t),t}function GEe(e){const t={nodeName:"#text",value:e.value,parentNode:null};return Bx(e,t),t}function qEe(e){const t={nodeName:"#comment",data:e.value,parentNode:null};return Bx(e,t),t}function ZEe(e,t){const n=t;let r=n;e.type==="element"&&e.tagName.toLowerCase()==="svg"&&n.space==="html"&&(r=Bee);const a=[];let l;if(e.properties){for(l in e.properties)if(l!=="children"&&jEe.call(e.properties,l)){const y=WEe(r,l,e.properties[l]);y&&a.push(y)}}const f=r.space,i={nodeName:e.tagName,tagName:e.tagName,attrs:a,namespaceURI:df[f],childNodes:[],parentNode:null};return i.childNodes=sN(e.children,i,r),Bx(e,i),e.tagName==="template"&&e.content&&(i.content=$Ee(e.content,r)),i}function WEe(e,t,n){const r=DEe(e,t);if(n===!1||n===null||n===void 0||typeof n=="number"&&Number.isNaN(n)||!n&&r.boolean)return;Array.isArray(n)&&(n=r.commaSeparated?LX(n):OX(n));const a={name:r.attribute,value:n===!0?"":String(n)};if(r.space&&r.space!=="html"&&r.space!=="svg"){const l=a.name.indexOf(":");l<0?a.prefix="":(a.name=a.name.slice(l+1),a.prefix=r.attribute.slice(0,l)),a.namespace=df[r.space]}return a}function sN(e,t,n){let r=-1;const a=[];if(e)for(;++r<e.length;){const l=Uee(e[r],n);l.parentNode=t,a.push(l)}return a}function Bx(e,t){const n=e.position;n&&n.start&&n.end&&(n.start.offset,n.end.offset,t.sourceCodeLocation={startLine:n.start.line,startCol:n.start.column,startOffset:n.start.offset,endLine:n.end.line,endCol:n.end.column,endOffset:n.end.offset})}const XEe=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","keygen","link","meta","param","source","track","wbr"],YEe=new Set([65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111]),Co="";var qe;(function(e){e[e.EOF=-1]="EOF",e[e.NULL=0]="NULL",e[e.TABULATION=9]="TABULATION",e[e.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",e[e.LINE_FEED=10]="LINE_FEED",e[e.FORM_FEED=12]="FORM_FEED",e[e.SPACE=32]="SPACE",e[e.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",e[e.QUOTATION_MARK=34]="QUOTATION_MARK",e[e.AMPERSAND=38]="AMPERSAND",e[e.APOSTROPHE=39]="APOSTROPHE",e[e.HYPHEN_MINUS=45]="HYPHEN_MINUS",e[e.SOLIDUS=47]="SOLIDUS",e[e.DIGIT_0=48]="DIGIT_0",e[e.DIGIT_9=57]="DIGIT_9",e[e.SEMICOLON=59]="SEMICOLON",e[e.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",e[e.EQUALS_SIGN=61]="EQUALS_SIGN",e[e.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",e[e.QUESTION_MARK=63]="QUESTION_MARK",e[e.LATIN_CAPITAL_A=65]="LATIN_CAPITAL_A",e[e.LATIN_CAPITAL_Z=90]="LATIN_CAPITAL_Z",e[e.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",e[e.GRAVE_ACCENT=96]="GRAVE_ACCENT",e[e.LATIN_SMALL_A=97]="LATIN_SMALL_A",e[e.LATIN_SMALL_Z=122]="LATIN_SMALL_Z"})(qe||(qe={}));const Qu={DASH_DASH:"--",CDATA_START:"[CDATA[",DOCTYPE:"doctype",SCRIPT:"script",PUBLIC:"public",SYSTEM:"system"};function Vee(e){return e>=55296&&e<=57343}function KEe(e){return e>=56320&&e<=57343}function QEe(e,t){return(e-55296)*1024+9216+t}function $ee(e){return e!==32&&e!==10&&e!==13&&e!==9&&e!==12&&e>=1&&e<=31||e>=127&&e<=159}function Hee(e){return e>=64976&&e<=65007||YEe.has(e)}var hn;(function(e){e.controlCharacterInInputStream="control-character-in-input-stream",e.noncharacterInInputStream="noncharacter-in-input-stream",e.surrogateInInputStream="surrogate-in-input-stream",e.nonVoidHtmlElementStartTagWithTrailingSolidus="non-void-html-element-start-tag-with-trailing-solidus",e.endTagWithAttributes="end-tag-with-attributes",e.endTagWithTrailingSolidus="end-tag-with-trailing-solidus",e.unexpectedSolidusInTag="unexpected-solidus-in-tag",e.unexpectedNullCharacter="unexpected-null-character",e.unexpectedQuestionMarkInsteadOfTagName="unexpected-question-mark-instead-of-tag-name",e.invalidFirstCharacterOfTagName="invalid-first-character-of-tag-name",e.unexpectedEqualsSignBeforeAttributeName="unexpected-equals-sign-before-attribute-name",e.missingEndTagName="missing-end-tag-name",e.unexpectedCharacterInAttributeName="unexpected-character-in-attribute-name",e.unknownNamedCharacterReference="unknown-named-character-reference",e.missingSemicolonAfterCharacterReference="missing-semicolon-after-character-reference",e.unexpectedCharacterAfterDoctypeSystemIdentifier="unexpected-character-after-doctype-system-identifier",e.unexpectedCharacterInUnquotedAttributeValue="unexpected-character-in-unquoted-attribute-value",e.eofBeforeTagName="eof-before-tag-name",e.eofInTag="eof-in-tag",e.missingAttributeValue="missing-attribute-value",e.missingWhitespaceBetweenAttributes="missing-whitespace-between-attributes",e.missingWhitespaceAfterDoctypePublicKeyword="missing-whitespace-after-doctype-public-keyword",e.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers="missing-whitespace-between-doctype-public-and-system-identifiers",e.missingWhitespaceAfterDoctypeSystemKeyword="missing-whitespace-after-doctype-system-keyword",e.missingQuoteBeforeDoctypePublicIdentifier="missing-quote-before-doctype-public-identifier",e.missingQuoteBeforeDoctypeSystemIdentifier="missing-quote-before-doctype-system-identifier",e.missingDoctypePublicIdentifier="missing-doctype-public-identifier",e.missingDoctypeSystemIdentifier="missing-doctype-system-identifier",e.abruptDoctypePublicIdentifier="abrupt-doctype-public-identifier",e.abruptDoctypeSystemIdentifier="abrupt-doctype-system-identifier",e.cdataInHtmlContent="cdata-in-html-content",e.incorrectlyOpenedComment="incorrectly-opened-comment",e.eofInScriptHtmlCommentLikeText="eof-in-script-html-comment-like-text",e.eofInDoctype="eof-in-doctype",e.nestedComment="nested-comment",e.abruptClosingOfEmptyComment="abrupt-closing-of-empty-comment",e.eofInComment="eof-in-comment",e.incorrectlyClosedComment="incorrectly-closed-comment",e.eofInCdata="eof-in-cdata",e.absenceOfDigitsInNumericCharacterReference="absence-of-digits-in-numeric-character-reference",e.nullCharacterReference="null-character-reference",e.surrogateCharacterReference="surrogate-character-reference",e.characterReferenceOutsideUnicodeRange="character-reference-outside-unicode-range",e.controlCharacterReference="control-character-reference",e.noncharacterCharacterReference="noncharacter-character-reference",e.missingWhitespaceBeforeDoctypeName="missing-whitespace-before-doctype-name",e.missingDoctypeName="missing-doctype-name",e.invalidCharacterSequenceAfterDoctypeName="invalid-character-sequence-after-doctype-name",e.duplicateAttribute="duplicate-attribute",e.nonConformingDoctype="non-conforming-doctype",e.missingDoctype="missing-doctype",e.misplacedDoctype="misplaced-doctype",e.endTagWithoutMatchingOpenElement="end-tag-without-matching-open-element",e.closingOfElementWithOpenChildElements="closing-of-element-with-open-child-elements",e.disallowedContentInNoscriptInHead="disallowed-content-in-noscript-in-head",e.openElementsLeftAfterEof="open-elements-left-after-eof",e.abandonedHeadElementChild="abandoned-head-element-child",e.misplacedStartTagForHeadElement="misplaced-start-tag-for-head-element",e.nestedNoscriptInHead="nested-noscript-in-head",e.eofInElementThatCanContainOnlyText="eof-in-element-that-can-contain-only-text"})(hn||(hn={}));const JEe=65536;class eSe{constructor(t){this.handler=t,this.html="",this.pos=-1,this.lastGapPos=-2,this.gapStack=[],this.skipNextNewLine=!1,this.lastChunkWritten=!1,this.endOfChunkHit=!1,this.bufferWaterline=JEe,this.isEol=!1,this.lineStartPos=0,this.droppedBufferSize=0,this.line=1,this.lastErrOffset=-1}get col(){return this.pos-this.lineStartPos+ +(this.lastGapPos!==this.pos)}get offset(){return this.droppedBufferSize+this.pos}getError(t,n){const{line:r,col:a,offset:l}=this,f=a+n,i=l+n;return{code:t,startLine:r,endLine:r,startCol:f,endCol:f,startOffset:i,endOffset:i}}_err(t){this.handler.onParseError&&this.lastErrOffset!==this.offset&&(this.lastErrOffset=this.offset,this.handler.onParseError(this.getError(t,0)))}_addGap(){this.gapStack.push(this.lastGapPos),this.lastGapPos=this.pos}_processSurrogate(t){if(this.pos!==this.html.length-1){const n=this.html.charCodeAt(this.pos+1);if(KEe(n))return this.pos++,this._addGap(),QEe(t,n)}else if(!this.lastChunkWritten)return this.endOfChunkHit=!0,qe.EOF;return this._err(hn.surrogateInInputStream),t}willDropParsedChunk(){return this.pos>this.bufferWaterline}dropParsedChunk(){this.willDropParsedChunk()&&(this.html=this.html.substring(this.pos),this.lineStartPos-=this.pos,this.droppedBufferSize+=this.pos,this.pos=0,this.lastGapPos=-2,this.gapStack.length=0)}write(t,n){this.html.length>0?this.html+=t:this.html=t,this.endOfChunkHit=!1,this.lastChunkWritten=n}insertHtmlAtCurrentPos(t){this.html=this.html.substring(0,this.pos+1)+t+this.html.substring(this.pos+1),this.endOfChunkHit=!1}startsWith(t,n){if(this.pos+t.length>this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,!1;if(n)return this.html.startsWith(t,this.pos);for(let r=0;r<t.length;r++)if((this.html.charCodeAt(this.pos+r)|32)!==t.charCodeAt(r))return!1;return!0}peek(t){const n=this.pos+t;if(n>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,qe.EOF;const r=this.html.charCodeAt(n);return r===qe.CARRIAGE_RETURN?qe.LINE_FEED:r}advance(){if(this.pos++,this.isEol&&(this.isEol=!1,this.line++,this.lineStartPos=this.pos),this.pos>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,qe.EOF;let t=this.html.charCodeAt(this.pos);return t===qe.CARRIAGE_RETURN?(this.isEol=!0,this.skipNextNewLine=!0,qe.LINE_FEED):t===qe.LINE_FEED&&(this.isEol=!0,this.skipNextNewLine)?(this.line--,this.skipNextNewLine=!1,this._addGap(),this.advance()):(this.skipNextNewLine=!1,Vee(t)&&(t=this._processSurrogate(t)),this.handler.onParseError===null||t>31&&t<127||t===qe.LINE_FEED||t===qe.CARRIAGE_RETURN||t>159&&t<64976||this._checkForProblematicCharacters(t),t)}_checkForProblematicCharacters(t){$ee(t)?this._err(hn.controlCharacterInInputStream):Hee(t)&&this._err(hn.noncharacterInInputStream)}retreat(t){for(this.pos-=t;this.pos<this.lastGapPos;)this.lastGapPos=this.gapStack.pop(),this.pos--;this.isEol=!1}}var na;(function(e){e[e.CHARACTER=0]="CHARACTER",e[e.NULL_CHARACTER=1]="NULL_CHARACTER",e[e.WHITESPACE_CHARACTER=2]="WHITESPACE_CHARACTER",e[e.START_TAG=3]="START_TAG",e[e.END_TAG=4]="END_TAG",e[e.COMMENT=5]="COMMENT",e[e.DOCTYPE=6]="DOCTYPE",e[e.EOF=7]="EOF",e[e.HIBERNATION=8]="HIBERNATION"})(na||(na={}));function Gee(e,t){for(let n=e.attrs.length-1;n>=0;n--)if(e.attrs[n].name===t)return e.attrs[n].value;return null}const tSe=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(e=>e.charCodeAt(0))),nSe=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);function rSe(e){var t;return e>=55296&&e<=57343||e>1114111?65533:(t=nSe.get(e))!==null&&t!==void 0?t:e}var Ll;(function(e){e[e.NUM=35]="NUM",e[e.SEMI=59]="SEMI",e[e.EQUALS=61]="EQUALS",e[e.ZERO=48]="ZERO",e[e.NINE=57]="NINE",e[e.LOWER_A=97]="LOWER_A",e[e.LOWER_F=102]="LOWER_F",e[e.LOWER_X=120]="LOWER_X",e[e.LOWER_Z=122]="LOWER_Z",e[e.UPPER_A=65]="UPPER_A",e[e.UPPER_F=70]="UPPER_F",e[e.UPPER_Z=90]="UPPER_Z"})(Ll||(Ll={}));const iSe=32;var n0;(function(e){e[e.VALUE_LENGTH=49152]="VALUE_LENGTH",e[e.BRANCH_LENGTH=16256]="BRANCH_LENGTH",e[e.JUMP_TABLE=127]="JUMP_TABLE"})(n0||(n0={}));function n8(e){return e>=Ll.ZERO&&e<=Ll.NINE}function sSe(e){return e>=Ll.UPPER_A&&e<=Ll.UPPER_F||e>=Ll.LOWER_A&&e<=Ll.LOWER_F}function aSe(e){return e>=Ll.UPPER_A&&e<=Ll.UPPER_Z||e>=Ll.LOWER_A&&e<=Ll.LOWER_Z||n8(e)}function oSe(e){return e===Ll.EQUALS||aSe(e)}var Ml;(function(e){e[e.EntityStart=0]="EntityStart",e[e.NumericStart=1]="NumericStart",e[e.NumericDecimal=2]="NumericDecimal",e[e.NumericHex=3]="NumericHex",e[e.NamedEntity=4]="NamedEntity"})(Ml||(Ml={}));var dp;(function(e){e[e.Legacy=0]="Legacy",e[e.Strict=1]="Strict",e[e.Attribute=2]="Attribute"})(dp||(dp={}));class lSe{constructor(t,n,r){this.decodeTree=t,this.emitCodePoint=n,this.errors=r,this.state=Ml.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=dp.Strict}startEntity(t){this.decodeMode=t,this.state=Ml.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(t,n){switch(this.state){case Ml.EntityStart:return t.charCodeAt(n)===Ll.NUM?(this.state=Ml.NumericStart,this.consumed+=1,this.stateNumericStart(t,n+1)):(this.state=Ml.NamedEntity,this.stateNamedEntity(t,n));case Ml.NumericStart:return this.stateNumericStart(t,n);case Ml.NumericDecimal:return this.stateNumericDecimal(t,n);case Ml.NumericHex:return this.stateNumericHex(t,n);case Ml.NamedEntity:return this.stateNamedEntity(t,n)}}stateNumericStart(t,n){return n>=t.length?-1:(t.charCodeAt(n)|iSe)===Ll.LOWER_X?(this.state=Ml.NumericHex,this.consumed+=1,this.stateNumericHex(t,n+1)):(this.state=Ml.NumericDecimal,this.stateNumericDecimal(t,n))}addToNumericResult(t,n,r,a){if(n!==r){const l=r-n;this.result=this.result*Math.pow(a,l)+Number.parseInt(t.substr(n,l),a),this.consumed+=l}}stateNumericHex(t,n){const r=n;for(;n<t.length;){const a=t.charCodeAt(n);if(n8(a)||sSe(a))n+=1;else return this.addToNumericResult(t,r,n,16),this.emitNumericEntity(a,3)}return this.addToNumericResult(t,r,n,16),-1}stateNumericDecimal(t,n){const r=n;for(;n<t.length;){const a=t.charCodeAt(n);if(n8(a))n+=1;else return this.addToNumericResult(t,r,n,10),this.emitNumericEntity(a,2)}return this.addToNumericResult(t,r,n,10),-1}emitNumericEntity(t,n){var r;if(this.consumed<=n)return(r=this.errors)===null||r===void 0||r.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(t===Ll.SEMI)this.consumed+=1;else if(this.decodeMode===dp.Strict)return 0;return this.emitCodePoint(rSe(this.result),this.consumed),this.errors&&(t!==Ll.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(t,n){const{decodeTree:r}=this;let a=r[this.treeIndex],l=(a&n0.VALUE_LENGTH)>>14;for(;n<t.length;n++,this.excess++){const f=t.charCodeAt(n);if(this.treeIndex=uSe(r,a,this.treeIndex+Math.max(1,l),f),this.treeIndex<0)return this.result===0||this.decodeMode===dp.Attribute&&(l===0||oSe(f))?0:this.emitNotTerminatedNamedEntity();if(a=r[this.treeIndex],l=(a&n0.VALUE_LENGTH)>>14,l!==0){if(f===Ll.SEMI)return this.emitNamedEntityData(this.treeIndex,l,this.consumed+this.excess);this.decodeMode!==dp.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var t;const{result:n,decodeTree:r}=this,a=(r[n]&n0.VALUE_LENGTH)>>14;return this.emitNamedEntityData(n,a,this.consumed),(t=this.errors)===null||t===void 0||t.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(t,n,r){const{decodeTree:a}=this;return this.emitCodePoint(n===1?a[t]&~n0.VALUE_LENGTH:a[t+1],r),n===3&&this.emitCodePoint(a[t+2],r),r}end(){var t;switch(this.state){case Ml.NamedEntity:return this.result!==0&&(this.decodeMode!==dp.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case Ml.NumericDecimal:return this.emitNumericEntity(0,2);case Ml.NumericHex:return this.emitNumericEntity(0,3);case Ml.NumericStart:return(t=this.errors)===null||t===void 0||t.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case Ml.EntityStart:return 0}}}function uSe(e,t,n,r){const a=(t&n0.BRANCH_LENGTH)>>7,l=t&n0.JUMP_TABLE;if(a===0)return l!==0&&r===l?n:-1;if(l){const y=r-l;return y<0||y>=a?-1:e[n+y]-1}let f=n,i=f+a-1;for(;f<=i;){const y=f+i>>>1,x=e[y];if(x<r)f=y+1;else if(x>r)i=y-1;else return e[y+a]}return-1}var Wn;(function(e){e.HTML="http://www.w3.org/1999/xhtml",e.MATHML="http://www.w3.org/1998/Math/MathML",e.SVG="http://www.w3.org/2000/svg",e.XLINK="http://www.w3.org/1999/xlink",e.XML="http://www.w3.org/XML/1998/namespace",e.XMLNS="http://www.w3.org/2000/xmlns/"})(Wn||(Wn={}));var h_;(function(e){e.TYPE="type",e.ACTION="action",e.ENCODING="encoding",e.PROMPT="prompt",e.NAME="name",e.COLOR="color",e.FACE="face",e.SIZE="size"})(h_||(h_={}));var pd;(function(e){e.NO_QUIRKS="no-quirks",e.QUIRKS="quirks",e.LIMITED_QUIRKS="limited-quirks"})(pd||(pd={}));var Gt;(function(e){e.A="a",e.ADDRESS="address",e.ANNOTATION_XML="annotation-xml",e.APPLET="applet",e.AREA="area",e.ARTICLE="article",e.ASIDE="aside",e.B="b",e.BASE="base",e.BASEFONT="basefont",e.BGSOUND="bgsound",e.BIG="big",e.BLOCKQUOTE="blockquote",e.BODY="body",e.BR="br",e.BUTTON="button",e.CAPTION="caption",e.CENTER="center",e.CODE="code",e.COL="col",e.COLGROUP="colgroup",e.DD="dd",e.DESC="desc",e.DETAILS="details",e.DIALOG="dialog",e.DIR="dir",e.DIV="div",e.DL="dl",e.DT="dt",e.EM="em",e.EMBED="embed",e.FIELDSET="fieldset",e.FIGCAPTION="figcaption",e.FIGURE="figure",e.FONT="font",e.FOOTER="footer",e.FOREIGN_OBJECT="foreignObject",e.FORM="form",e.FRAME="frame",e.FRAMESET="frameset",e.H1="h1",e.H2="h2",e.H3="h3",e.H4="h4",e.H5="h5",e.H6="h6",e.HEAD="head",e.HEADER="header",e.HGROUP="hgroup",e.HR="hr",e.HTML="html",e.I="i",e.IMG="img",e.IMAGE="image",e.INPUT="input",e.IFRAME="iframe",e.KEYGEN="keygen",e.LABEL="label",e.LI="li",e.LINK="link",e.LISTING="listing",e.MAIN="main",e.MALIGNMARK="malignmark",e.MARQUEE="marquee",e.MATH="math",e.MENU="menu",e.META="meta",e.MGLYPH="mglyph",e.MI="mi",e.MO="mo",e.MN="mn",e.MS="ms",e.MTEXT="mtext",e.NAV="nav",e.NOBR="nobr",e.NOFRAMES="noframes",e.NOEMBED="noembed",e.NOSCRIPT="noscript",e.OBJECT="object",e.OL="ol",e.OPTGROUP="optgroup",e.OPTION="option",e.P="p",e.PARAM="param",e.PLAINTEXT="plaintext",e.PRE="pre",e.RB="rb",e.RP="rp",e.RT="rt",e.RTC="rtc",e.RUBY="ruby",e.S="s",e.SCRIPT="script",e.SEARCH="search",e.SECTION="section",e.SELECT="select",e.SOURCE="source",e.SMALL="small",e.SPAN="span",e.STRIKE="strike",e.STRONG="strong",e.STYLE="style",e.SUB="sub",e.SUMMARY="summary",e.SUP="sup",e.TABLE="table",e.TBODY="tbody",e.TEMPLATE="template",e.TEXTAREA="textarea",e.TFOOT="tfoot",e.TD="td",e.TH="th",e.THEAD="thead",e.TITLE="title",e.TR="tr",e.TRACK="track",e.TT="tt",e.U="u",e.UL="ul",e.SVG="svg",e.VAR="var",e.WBR="wbr",e.XMP="xmp"})(Gt||(Gt={}));var Q;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.A=1]="A",e[e.ADDRESS=2]="ADDRESS",e[e.ANNOTATION_XML=3]="ANNOTATION_XML",e[e.APPLET=4]="APPLET",e[e.AREA=5]="AREA",e[e.ARTICLE=6]="ARTICLE",e[e.ASIDE=7]="ASIDE",e[e.B=8]="B",e[e.BASE=9]="BASE",e[e.BASEFONT=10]="BASEFONT",e[e.BGSOUND=11]="BGSOUND",e[e.BIG=12]="BIG",e[e.BLOCKQUOTE=13]="BLOCKQUOTE",e[e.BODY=14]="BODY",e[e.BR=15]="BR",e[e.BUTTON=16]="BUTTON",e[e.CAPTION=17]="CAPTION",e[e.CENTER=18]="CENTER",e[e.CODE=19]="CODE",e[e.COL=20]="COL",e[e.COLGROUP=21]="COLGROUP",e[e.DD=22]="DD",e[e.DESC=23]="DESC",e[e.DETAILS=24]="DETAILS",e[e.DIALOG=25]="DIALOG",e[e.DIR=26]="DIR",e[e.DIV=27]="DIV",e[e.DL=28]="DL",e[e.DT=29]="DT",e[e.EM=30]="EM",e[e.EMBED=31]="EMBED",e[e.FIELDSET=32]="FIELDSET",e[e.FIGCAPTION=33]="FIGCAPTION",e[e.FIGURE=34]="FIGURE",e[e.FONT=35]="FONT",e[e.FOOTER=36]="FOOTER",e[e.FOREIGN_OBJECT=37]="FOREIGN_OBJECT",e[e.FORM=38]="FORM",e[e.FRAME=39]="FRAME",e[e.FRAMESET=40]="FRAMESET",e[e.H1=41]="H1",e[e.H2=42]="H2",e[e.H3=43]="H3",e[e.H4=44]="H4",e[e.H5=45]="H5",e[e.H6=46]="H6",e[e.HEAD=47]="HEAD",e[e.HEADER=48]="HEADER",e[e.HGROUP=49]="HGROUP",e[e.HR=50]="HR",e[e.HTML=51]="HTML",e[e.I=52]="I",e[e.IMG=53]="IMG",e[e.IMAGE=54]="IMAGE",e[e.INPUT=55]="INPUT",e[e.IFRAME=56]="IFRAME",e[e.KEYGEN=57]="KEYGEN",e[e.LABEL=58]="LABEL",e[e.LI=59]="LI",e[e.LINK=60]="LINK",e[e.LISTING=61]="LISTING",e[e.MAIN=62]="MAIN",e[e.MALIGNMARK=63]="MALIGNMARK",e[e.MARQUEE=64]="MARQUEE",e[e.MATH=65]="MATH",e[e.MENU=66]="MENU",e[e.META=67]="META",e[e.MGLYPH=68]="MGLYPH",e[e.MI=69]="MI",e[e.MO=70]="MO",e[e.MN=71]="MN",e[e.MS=72]="MS",e[e.MTEXT=73]="MTEXT",e[e.NAV=74]="NAV",e[e.NOBR=75]="NOBR",e[e.NOFRAMES=76]="NOFRAMES",e[e.NOEMBED=77]="NOEMBED",e[e.NOSCRIPT=78]="NOSCRIPT",e[e.OBJECT=79]="OBJECT",e[e.OL=80]="OL",e[e.OPTGROUP=81]="OPTGROUP",e[e.OPTION=82]="OPTION",e[e.P=83]="P",e[e.PARAM=84]="PARAM",e[e.PLAINTEXT=85]="PLAINTEXT",e[e.PRE=86]="PRE",e[e.RB=87]="RB",e[e.RP=88]="RP",e[e.RT=89]="RT",e[e.RTC=90]="RTC",e[e.RUBY=91]="RUBY",e[e.S=92]="S",e[e.SCRIPT=93]="SCRIPT",e[e.SEARCH=94]="SEARCH",e[e.SECTION=95]="SECTION",e[e.SELECT=96]="SELECT",e[e.SOURCE=97]="SOURCE",e[e.SMALL=98]="SMALL",e[e.SPAN=99]="SPAN",e[e.STRIKE=100]="STRIKE",e[e.STRONG=101]="STRONG",e[e.STYLE=102]="STYLE",e[e.SUB=103]="SUB",e[e.SUMMARY=104]="SUMMARY",e[e.SUP=105]="SUP",e[e.TABLE=106]="TABLE",e[e.TBODY=107]="TBODY",e[e.TEMPLATE=108]="TEMPLATE",e[e.TEXTAREA=109]="TEXTAREA",e[e.TFOOT=110]="TFOOT",e[e.TD=111]="TD",e[e.TH=112]="TH",e[e.THEAD=113]="THEAD",e[e.TITLE=114]="TITLE",e[e.TR=115]="TR",e[e.TRACK=116]="TRACK",e[e.TT=117]="TT",e[e.U=118]="U",e[e.UL=119]="UL",e[e.SVG=120]="SVG",e[e.VAR=121]="VAR",e[e.WBR=122]="WBR",e[e.XMP=123]="XMP"})(Q||(Q={}));const cSe=new Map([[Gt.A,Q.A],[Gt.ADDRESS,Q.ADDRESS],[Gt.ANNOTATION_XML,Q.ANNOTATION_XML],[Gt.APPLET,Q.APPLET],[Gt.AREA,Q.AREA],[Gt.ARTICLE,Q.ARTICLE],[Gt.ASIDE,Q.ASIDE],[Gt.B,Q.B],[Gt.BASE,Q.BASE],[Gt.BASEFONT,Q.BASEFONT],[Gt.BGSOUND,Q.BGSOUND],[Gt.BIG,Q.BIG],[Gt.BLOCKQUOTE,Q.BLOCKQUOTE],[Gt.BODY,Q.BODY],[Gt.BR,Q.BR],[Gt.BUTTON,Q.BUTTON],[Gt.CAPTION,Q.CAPTION],[Gt.CENTER,Q.CENTER],[Gt.CODE,Q.CODE],[Gt.COL,Q.COL],[Gt.COLGROUP,Q.COLGROUP],[Gt.DD,Q.DD],[Gt.DESC,Q.DESC],[Gt.DETAILS,Q.DETAILS],[Gt.DIALOG,Q.DIALOG],[Gt.DIR,Q.DIR],[Gt.DIV,Q.DIV],[Gt.DL,Q.DL],[Gt.DT,Q.DT],[Gt.EM,Q.EM],[Gt.EMBED,Q.EMBED],[Gt.FIELDSET,Q.FIELDSET],[Gt.FIGCAPTION,Q.FIGCAPTION],[Gt.FIGURE,Q.FIGURE],[Gt.FONT,Q.FONT],[Gt.FOOTER,Q.FOOTER],[Gt.FOREIGN_OBJECT,Q.FOREIGN_OBJECT],[Gt.FORM,Q.FORM],[Gt.FRAME,Q.FRAME],[Gt.FRAMESET,Q.FRAMESET],[Gt.H1,Q.H1],[Gt.H2,Q.H2],[Gt.H3,Q.H3],[Gt.H4,Q.H4],[Gt.H5,Q.H5],[Gt.H6,Q.H6],[Gt.HEAD,Q.HEAD],[Gt.HEADER,Q.HEADER],[Gt.HGROUP,Q.HGROUP],[Gt.HR,Q.HR],[Gt.HTML,Q.HTML],[Gt.I,Q.I],[Gt.IMG,Q.IMG],[Gt.IMAGE,Q.IMAGE],[Gt.INPUT,Q.INPUT],[Gt.IFRAME,Q.IFRAME],[Gt.KEYGEN,Q.KEYGEN],[Gt.LABEL,Q.LABEL],[Gt.LI,Q.LI],[Gt.LINK,Q.LINK],[Gt.LISTING,Q.LISTING],[Gt.MAIN,Q.MAIN],[Gt.MALIGNMARK,Q.MALIGNMARK],[Gt.MARQUEE,Q.MARQUEE],[Gt.MATH,Q.MATH],[Gt.MENU,Q.MENU],[Gt.META,Q.META],[Gt.MGLYPH,Q.MGLYPH],[Gt.MI,Q.MI],[Gt.MO,Q.MO],[Gt.MN,Q.MN],[Gt.MS,Q.MS],[Gt.MTEXT,Q.MTEXT],[Gt.NAV,Q.NAV],[Gt.NOBR,Q.NOBR],[Gt.NOFRAMES,Q.NOFRAMES],[Gt.NOEMBED,Q.NOEMBED],[Gt.NOSCRIPT,Q.NOSCRIPT],[Gt.OBJECT,Q.OBJECT],[Gt.OL,Q.OL],[Gt.OPTGROUP,Q.OPTGROUP],[Gt.OPTION,Q.OPTION],[Gt.P,Q.P],[Gt.PARAM,Q.PARAM],[Gt.PLAINTEXT,Q.PLAINTEXT],[Gt.PRE,Q.PRE],[Gt.RB,Q.RB],[Gt.RP,Q.RP],[Gt.RT,Q.RT],[Gt.RTC,Q.RTC],[Gt.RUBY,Q.RUBY],[Gt.S,Q.S],[Gt.SCRIPT,Q.SCRIPT],[Gt.SEARCH,Q.SEARCH],[Gt.SECTION,Q.SECTION],[Gt.SELECT,Q.SELECT],[Gt.SOURCE,Q.SOURCE],[Gt.SMALL,Q.SMALL],[Gt.SPAN,Q.SPAN],[Gt.STRIKE,Q.STRIKE],[Gt.STRONG,Q.STRONG],[Gt.STYLE,Q.STYLE],[Gt.SUB,Q.SUB],[Gt.SUMMARY,Q.SUMMARY],[Gt.SUP,Q.SUP],[Gt.TABLE,Q.TABLE],[Gt.TBODY,Q.TBODY],[Gt.TEMPLATE,Q.TEMPLATE],[Gt.TEXTAREA,Q.TEXTAREA],[Gt.TFOOT,Q.TFOOT],[Gt.TD,Q.TD],[Gt.TH,Q.TH],[Gt.THEAD,Q.THEAD],[Gt.TITLE,Q.TITLE],[Gt.TR,Q.TR],[Gt.TRACK,Q.TRACK],[Gt.TT,Q.TT],[Gt.U,Q.U],[Gt.UL,Q.UL],[Gt.SVG,Q.SVG],[Gt.VAR,Q.VAR],[Gt.WBR,Q.WBR],[Gt.XMP,Q.XMP]]);function jx(e){var t;return(t=cSe.get(e))!==null&&t!==void 0?t:Q.UNKNOWN}const Jn=Q,dSe={[Wn.HTML]:new Set([Jn.ADDRESS,Jn.APPLET,Jn.AREA,Jn.ARTICLE,Jn.ASIDE,Jn.BASE,Jn.BASEFONT,Jn.BGSOUND,Jn.BLOCKQUOTE,Jn.BODY,Jn.BR,Jn.BUTTON,Jn.CAPTION,Jn.CENTER,Jn.COL,Jn.COLGROUP,Jn.DD,Jn.DETAILS,Jn.DIR,Jn.DIV,Jn.DL,Jn.DT,Jn.EMBED,Jn.FIELDSET,Jn.FIGCAPTION,Jn.FIGURE,Jn.FOOTER,Jn.FORM,Jn.FRAME,Jn.FRAMESET,Jn.H1,Jn.H2,Jn.H3,Jn.H4,Jn.H5,Jn.H6,Jn.HEAD,Jn.HEADER,Jn.HGROUP,Jn.HR,Jn.HTML,Jn.IFRAME,Jn.IMG,Jn.INPUT,Jn.LI,Jn.LINK,Jn.LISTING,Jn.MAIN,Jn.MARQUEE,Jn.MENU,Jn.META,Jn.NAV,Jn.NOEMBED,Jn.NOFRAMES,Jn.NOSCRIPT,Jn.OBJECT,Jn.OL,Jn.P,Jn.PARAM,Jn.PLAINTEXT,Jn.PRE,Jn.SCRIPT,Jn.SECTION,Jn.SELECT,Jn.SOURCE,Jn.STYLE,Jn.SUMMARY,Jn.TABLE,Jn.TBODY,Jn.TD,Jn.TEMPLATE,Jn.TEXTAREA,Jn.TFOOT,Jn.TH,Jn.THEAD,Jn.TITLE,Jn.TR,Jn.TRACK,Jn.UL,Jn.WBR,Jn.XMP]),[Wn.MATHML]:new Set([Jn.MI,Jn.MO,Jn.MN,Jn.MS,Jn.MTEXT,Jn.ANNOTATION_XML]),[Wn.SVG]:new Set([Jn.TITLE,Jn.FOREIGN_OBJECT,Jn.DESC]),[Wn.XLINK]:new Set,[Wn.XML]:new Set,[Wn.XMLNS]:new Set},r8=new Set([Jn.H1,Jn.H2,Jn.H3,Jn.H4,Jn.H5,Jn.H6]);Gt.STYLE,Gt.SCRIPT,Gt.XMP,Gt.IFRAME,Gt.NOEMBED,Gt.NOFRAMES,Gt.PLAINTEXT;var et;(function(e){e[e.DATA=0]="DATA",e[e.RCDATA=1]="RCDATA",e[e.RAWTEXT=2]="RAWTEXT",e[e.SCRIPT_DATA=3]="SCRIPT_DATA",e[e.PLAINTEXT=4]="PLAINTEXT",e[e.TAG_OPEN=5]="TAG_OPEN",e[e.END_TAG_OPEN=6]="END_TAG_OPEN",e[e.TAG_NAME=7]="TAG_NAME",e[e.RCDATA_LESS_THAN_SIGN=8]="RCDATA_LESS_THAN_SIGN",e[e.RCDATA_END_TAG_OPEN=9]="RCDATA_END_TAG_OPEN",e[e.RCDATA_END_TAG_NAME=10]="RCDATA_END_TAG_NAME",e[e.RAWTEXT_LESS_THAN_SIGN=11]="RAWTEXT_LESS_THAN_SIGN",e[e.RAWTEXT_END_TAG_OPEN=12]="RAWTEXT_END_TAG_OPEN",e[e.RAWTEXT_END_TAG_NAME=13]="RAWTEXT_END_TAG_NAME",e[e.SCRIPT_DATA_LESS_THAN_SIGN=14]="SCRIPT_DATA_LESS_THAN_SIGN",e[e.SCRIPT_DATA_END_TAG_OPEN=15]="SCRIPT_DATA_END_TAG_OPEN",e[e.SCRIPT_DATA_END_TAG_NAME=16]="SCRIPT_DATA_END_TAG_NAME",e[e.SCRIPT_DATA_ESCAPE_START=17]="SCRIPT_DATA_ESCAPE_START",e[e.SCRIPT_DATA_ESCAPE_START_DASH=18]="SCRIPT_DATA_ESCAPE_START_DASH",e[e.SCRIPT_DATA_ESCAPED=19]="SCRIPT_DATA_ESCAPED",e[e.SCRIPT_DATA_ESCAPED_DASH=20]="SCRIPT_DATA_ESCAPED_DASH",e[e.SCRIPT_DATA_ESCAPED_DASH_DASH=21]="SCRIPT_DATA_ESCAPED_DASH_DASH",e[e.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN=22]="SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN",e[e.SCRIPT_DATA_ESCAPED_END_TAG_OPEN=23]="SCRIPT_DATA_ESCAPED_END_TAG_OPEN",e[e.SCRIPT_DATA_ESCAPED_END_TAG_NAME=24]="SCRIPT_DATA_ESCAPED_END_TAG_NAME",e[e.SCRIPT_DATA_DOUBLE_ESCAPE_START=25]="SCRIPT_DATA_DOUBLE_ESCAPE_START",e[e.SCRIPT_DATA_DOUBLE_ESCAPED=26]="SCRIPT_DATA_DOUBLE_ESCAPED",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_DASH=27]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH=28]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN=29]="SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN",e[e.SCRIPT_DATA_DOUBLE_ESCAPE_END=30]="SCRIPT_DATA_DOUBLE_ESCAPE_END",e[e.BEFORE_ATTRIBUTE_NAME=31]="BEFORE_ATTRIBUTE_NAME",e[e.ATTRIBUTE_NAME=32]="ATTRIBUTE_NAME",e[e.AFTER_ATTRIBUTE_NAME=33]="AFTER_ATTRIBUTE_NAME",e[e.BEFORE_ATTRIBUTE_VALUE=34]="BEFORE_ATTRIBUTE_VALUE",e[e.ATTRIBUTE_VALUE_DOUBLE_QUOTED=35]="ATTRIBUTE_VALUE_DOUBLE_QUOTED",e[e.ATTRIBUTE_VALUE_SINGLE_QUOTED=36]="ATTRIBUTE_VALUE_SINGLE_QUOTED",e[e.ATTRIBUTE_VALUE_UNQUOTED=37]="ATTRIBUTE_VALUE_UNQUOTED",e[e.AFTER_ATTRIBUTE_VALUE_QUOTED=38]="AFTER_ATTRIBUTE_VALUE_QUOTED",e[e.SELF_CLOSING_START_TAG=39]="SELF_CLOSING_START_TAG",e[e.BOGUS_COMMENT=40]="BOGUS_COMMENT",e[e.MARKUP_DECLARATION_OPEN=41]="MARKUP_DECLARATION_OPEN",e[e.COMMENT_START=42]="COMMENT_START",e[e.COMMENT_START_DASH=43]="COMMENT_START_DASH",e[e.COMMENT=44]="COMMENT",e[e.COMMENT_LESS_THAN_SIGN=45]="COMMENT_LESS_THAN_SIGN",e[e.COMMENT_LESS_THAN_SIGN_BANG=46]="COMMENT_LESS_THAN_SIGN_BANG",e[e.COMMENT_LESS_THAN_SIGN_BANG_DASH=47]="COMMENT_LESS_THAN_SIGN_BANG_DASH",e[e.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH=48]="COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH",e[e.COMMENT_END_DASH=49]="COMMENT_END_DASH",e[e.COMMENT_END=50]="COMMENT_END",e[e.COMMENT_END_BANG=51]="COMMENT_END_BANG",e[e.DOCTYPE=52]="DOCTYPE",e[e.BEFORE_DOCTYPE_NAME=53]="BEFORE_DOCTYPE_NAME",e[e.DOCTYPE_NAME=54]="DOCTYPE_NAME",e[e.AFTER_DOCTYPE_NAME=55]="AFTER_DOCTYPE_NAME",e[e.AFTER_DOCTYPE_PUBLIC_KEYWORD=56]="AFTER_DOCTYPE_PUBLIC_KEYWORD",e[e.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER=57]="BEFORE_DOCTYPE_PUBLIC_IDENTIFIER",e[e.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED=58]="DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED",e[e.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED=59]="DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED",e[e.AFTER_DOCTYPE_PUBLIC_IDENTIFIER=60]="AFTER_DOCTYPE_PUBLIC_IDENTIFIER",e[e.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS=61]="BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS",e[e.AFTER_DOCTYPE_SYSTEM_KEYWORD=62]="AFTER_DOCTYPE_SYSTEM_KEYWORD",e[e.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER=63]="BEFORE_DOCTYPE_SYSTEM_IDENTIFIER",e[e.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED=64]="DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED",e[e.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED=65]="DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED",e[e.AFTER_DOCTYPE_SYSTEM_IDENTIFIER=66]="AFTER_DOCTYPE_SYSTEM_IDENTIFIER",e[e.BOGUS_DOCTYPE=67]="BOGUS_DOCTYPE",e[e.CDATA_SECTION=68]="CDATA_SECTION",e[e.CDATA_SECTION_BRACKET=69]="CDATA_SECTION_BRACKET",e[e.CDATA_SECTION_END=70]="CDATA_SECTION_END",e[e.CHARACTER_REFERENCE=71]="CHARACTER_REFERENCE",e[e.AMBIGUOUS_AMPERSAND=72]="AMBIGUOUS_AMPERSAND"})(et||(et={}));const Jo={DATA:et.DATA,RCDATA:et.RCDATA,RAWTEXT:et.RAWTEXT,SCRIPT_DATA:et.SCRIPT_DATA,PLAINTEXT:et.PLAINTEXT,CDATA_SECTION:et.CDATA_SECTION};function hSe(e){return e>=qe.DIGIT_0&&e<=qe.DIGIT_9}function b2(e){return e>=qe.LATIN_CAPITAL_A&&e<=qe.LATIN_CAPITAL_Z}function fSe(e){return e>=qe.LATIN_SMALL_A&&e<=qe.LATIN_SMALL_Z}function Rm(e){return fSe(e)||b2(e)}function Q$(e){return Rm(e)||hSe(e)}function o4(e){return e+32}function qee(e){return e===qe.SPACE||e===qe.LINE_FEED||e===qe.TABULATION||e===qe.FORM_FEED}function J$(e){return qee(e)||e===qe.SOLIDUS||e===qe.GREATER_THAN_SIGN}function pSe(e){return e===qe.NULL?hn.nullCharacterReference:e>1114111?hn.characterReferenceOutsideUnicodeRange:Vee(e)?hn.surrogateCharacterReference:Hee(e)?hn.noncharacterCharacterReference:$ee(e)||e===qe.CARRIAGE_RETURN?hn.controlCharacterReference:null}class mSe{constructor(t,n){this.options=t,this.handler=n,this.paused=!1,this.inLoop=!1,this.inForeignNode=!1,this.lastStartTagName="",this.active=!1,this.state=et.DATA,this.returnState=et.DATA,this.entityStartPos=0,this.consumedAfterSnapshot=-1,this.currentCharacterToken=null,this.currentToken=null,this.currentAttr={name:"",value:""},this.preprocessor=new eSe(n),this.currentLocation=this.getCurrentLocation(-1),this.entityDecoder=new lSe(tSe,(r,a)=>{this.preprocessor.pos=this.entityStartPos+a-1,this._flushCodePointConsumedAsCharacterReference(r)},n.onParseError?{missingSemicolonAfterCharacterReference:()=>{this._err(hn.missingSemicolonAfterCharacterReference,1)},absenceOfDigitsInNumericCharacterReference:r=>{this._err(hn.absenceOfDigitsInNumericCharacterReference,this.entityStartPos-this.preprocessor.pos+r)},validateNumericCharacterReference:r=>{const a=pSe(r);a&&this._err(a,1)}}:void 0)}_err(t,n=0){var r,a;(a=(r=this.handler).onParseError)===null||a===void 0||a.call(r,this.preprocessor.getError(t,n))}getCurrentLocation(t){return this.options.sourceCodeLocationInfo?{startLine:this.preprocessor.line,startCol:this.preprocessor.col-t,startOffset:this.preprocessor.offset-t,endLine:-1,endCol:-1,endOffset:-1}:null}_runParsingLoop(){if(!this.inLoop){for(this.inLoop=!0;this.active&&!this.paused;){this.consumedAfterSnapshot=0;const t=this._consume();this._ensureHibernation()||this._callState(t)}this.inLoop=!1}}pause(){this.paused=!0}resume(t){if(!this.paused)throw new Error("Parser was already resumed");this.paused=!1,!this.inLoop&&(this._runParsingLoop(),this.paused||t==null||t())}write(t,n,r){this.active=!0,this.preprocessor.write(t,n),this._runParsingLoop(),this.paused||r==null||r()}insertHtmlAtCurrentPos(t){this.active=!0,this.preprocessor.insertHtmlAtCurrentPos(t),this._runParsingLoop()}_ensureHibernation(){return this.preprocessor.endOfChunkHit?(this.preprocessor.retreat(this.consumedAfterSnapshot),this.consumedAfterSnapshot=0,this.active=!1,!0):!1}_consume(){return this.consumedAfterSnapshot++,this.preprocessor.advance()}_advanceBy(t){this.consumedAfterSnapshot+=t;for(let n=0;n<t;n++)this.preprocessor.advance()}_consumeSequenceIfMatch(t,n){return this.preprocessor.startsWith(t,n)?(this._advanceBy(t.length-1),!0):!1}_createStartTagToken(){this.currentToken={type:na.START_TAG,tagName:"",tagID:Q.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(1)}}_createEndTagToken(){this.currentToken={type:na.END_TAG,tagName:"",tagID:Q.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(2)}}_createCommentToken(t){this.currentToken={type:na.COMMENT,data:"",location:this.getCurrentLocation(t)}}_createDoctypeToken(t){this.currentToken={type:na.DOCTYPE,name:t,forceQuirks:!1,publicId:null,systemId:null,location:this.currentLocation}}_createCharacterToken(t,n){this.currentCharacterToken={type:t,chars:n,location:this.currentLocation}}_createAttr(t){this.currentAttr={name:t,value:""},this.currentLocation=this.getCurrentLocation(0)}_leaveAttrName(){var t,n;const r=this.currentToken;if(Gee(r,this.currentAttr.name)===null){if(r.attrs.push(this.currentAttr),r.location&&this.currentLocation){const a=(t=(n=r.location).attrs)!==null&&t!==void 0?t:n.attrs=Object.create(null);a[this.currentAttr.name]=this.currentLocation,this._leaveAttrValue()}}else this._err(hn.duplicateAttribute)}_leaveAttrValue(){this.currentLocation&&(this.currentLocation.endLine=this.preprocessor.line,this.currentLocation.endCol=this.preprocessor.col,this.currentLocation.endOffset=this.preprocessor.offset)}prepareToken(t){this._emitCurrentCharacterToken(t.location),this.currentToken=null,t.location&&(t.location.endLine=this.preprocessor.line,t.location.endCol=this.preprocessor.col+1,t.location.endOffset=this.preprocessor.offset+1),this.currentLocation=this.getCurrentLocation(-1)}emitCurrentTagToken(){const t=this.currentToken;this.prepareToken(t),t.tagID=jx(t.tagName),t.type===na.START_TAG?(this.lastStartTagName=t.tagName,this.handler.onStartTag(t)):(t.attrs.length>0&&this._err(hn.endTagWithAttributes),t.selfClosing&&this._err(hn.endTagWithTrailingSolidus),this.handler.onEndTag(t)),this.preprocessor.dropParsedChunk()}emitCurrentComment(t){this.prepareToken(t),this.handler.onComment(t),this.preprocessor.dropParsedChunk()}emitCurrentDoctype(t){this.prepareToken(t),this.handler.onDoctype(t),this.preprocessor.dropParsedChunk()}_emitCurrentCharacterToken(t){if(this.currentCharacterToken){switch(t&&this.currentCharacterToken.location&&(this.currentCharacterToken.location.endLine=t.startLine,this.currentCharacterToken.location.endCol=t.startCol,this.currentCharacterToken.location.endOffset=t.startOffset),this.currentCharacterToken.type){case na.CHARACTER:{this.handler.onCharacter(this.currentCharacterToken);break}case na.NULL_CHARACTER:{this.handler.onNullCharacter(this.currentCharacterToken);break}case na.WHITESPACE_CHARACTER:{this.handler.onWhitespaceCharacter(this.currentCharacterToken);break}}this.currentCharacterToken=null}}_emitEOFToken(){const t=this.getCurrentLocation(0);t&&(t.endLine=t.startLine,t.endCol=t.startCol,t.endOffset=t.startOffset),this._emitCurrentCharacterToken(t),this.handler.onEof({type:na.EOF,location:t}),this.active=!1}_appendCharToCurrentCharacterToken(t,n){if(this.currentCharacterToken)if(this.currentCharacterToken.type===t){this.currentCharacterToken.chars+=n;return}else this.currentLocation=this.getCurrentLocation(0),this._emitCurrentCharacterToken(this.currentLocation),this.preprocessor.dropParsedChunk();this._createCharacterToken(t,n)}_emitCodePoint(t){const n=qee(t)?na.WHITESPACE_CHARACTER:t===qe.NULL?na.NULL_CHARACTER:na.CHARACTER;this._appendCharToCurrentCharacterToken(n,String.fromCodePoint(t))}_emitChars(t){this._appendCharToCurrentCharacterToken(na.CHARACTER,t)}_startCharacterReference(){this.returnState=this.state,this.state=et.CHARACTER_REFERENCE,this.entityStartPos=this.preprocessor.pos,this.entityDecoder.startEntity(this._isCharacterReferenceInAttribute()?dp.Attribute:dp.Legacy)}_isCharacterReferenceInAttribute(){return this.returnState===et.ATTRIBUTE_VALUE_DOUBLE_QUOTED||this.returnState===et.ATTRIBUTE_VALUE_SINGLE_QUOTED||this.returnState===et.ATTRIBUTE_VALUE_UNQUOTED}_flushCodePointConsumedAsCharacterReference(t){this._isCharacterReferenceInAttribute()?this.currentAttr.value+=String.fromCodePoint(t):this._emitCodePoint(t)}_callState(t){switch(this.state){case et.DATA:{this._stateData(t);break}case et.RCDATA:{this._stateRcdata(t);break}case et.RAWTEXT:{this._stateRawtext(t);break}case et.SCRIPT_DATA:{this._stateScriptData(t);break}case et.PLAINTEXT:{this._statePlaintext(t);break}case et.TAG_OPEN:{this._stateTagOpen(t);break}case et.END_TAG_OPEN:{this._stateEndTagOpen(t);break}case et.TAG_NAME:{this._stateTagName(t);break}case et.RCDATA_LESS_THAN_SIGN:{this._stateRcdataLessThanSign(t);break}case et.RCDATA_END_TAG_OPEN:{this._stateRcdataEndTagOpen(t);break}case et.RCDATA_END_TAG_NAME:{this._stateRcdataEndTagName(t);break}case et.RAWTEXT_LESS_THAN_SIGN:{this._stateRawtextLessThanSign(t);break}case et.RAWTEXT_END_TAG_OPEN:{this._stateRawtextEndTagOpen(t);break}case et.RAWTEXT_END_TAG_NAME:{this._stateRawtextEndTagName(t);break}case et.SCRIPT_DATA_LESS_THAN_SIGN:{this._stateScriptDataLessThanSign(t);break}case et.SCRIPT_DATA_END_TAG_OPEN:{this._stateScriptDataEndTagOpen(t);break}case et.SCRIPT_DATA_END_TAG_NAME:{this._stateScriptDataEndTagName(t);break}case et.SCRIPT_DATA_ESCAPE_START:{this._stateScriptDataEscapeStart(t);break}case et.SCRIPT_DATA_ESCAPE_START_DASH:{this._stateScriptDataEscapeStartDash(t);break}case et.SCRIPT_DATA_ESCAPED:{this._stateScriptDataEscaped(t);break}case et.SCRIPT_DATA_ESCAPED_DASH:{this._stateScriptDataEscapedDash(t);break}case et.SCRIPT_DATA_ESCAPED_DASH_DASH:{this._stateScriptDataEscapedDashDash(t);break}case et.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataEscapedLessThanSign(t);break}case et.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:{this._stateScriptDataEscapedEndTagOpen(t);break}case et.SCRIPT_DATA_ESCAPED_END_TAG_NAME:{this._stateScriptDataEscapedEndTagName(t);break}case et.SCRIPT_DATA_DOUBLE_ESCAPE_START:{this._stateScriptDataDoubleEscapeStart(t);break}case et.SCRIPT_DATA_DOUBLE_ESCAPED:{this._stateScriptDataDoubleEscaped(t);break}case et.SCRIPT_DATA_DOUBLE_ESCAPED_DASH:{this._stateScriptDataDoubleEscapedDash(t);break}case et.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH:{this._stateScriptDataDoubleEscapedDashDash(t);break}case et.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataDoubleEscapedLessThanSign(t);break}case et.SCRIPT_DATA_DOUBLE_ESCAPE_END:{this._stateScriptDataDoubleEscapeEnd(t);break}case et.BEFORE_ATTRIBUTE_NAME:{this._stateBeforeAttributeName(t);break}case et.ATTRIBUTE_NAME:{this._stateAttributeName(t);break}case et.AFTER_ATTRIBUTE_NAME:{this._stateAfterAttributeName(t);break}case et.BEFORE_ATTRIBUTE_VALUE:{this._stateBeforeAttributeValue(t);break}case et.ATTRIBUTE_VALUE_DOUBLE_QUOTED:{this._stateAttributeValueDoubleQuoted(t);break}case et.ATTRIBUTE_VALUE_SINGLE_QUOTED:{this._stateAttributeValueSingleQuoted(t);break}case et.ATTRIBUTE_VALUE_UNQUOTED:{this._stateAttributeValueUnquoted(t);break}case et.AFTER_ATTRIBUTE_VALUE_QUOTED:{this._stateAfterAttributeValueQuoted(t);break}case et.SELF_CLOSING_START_TAG:{this._stateSelfClosingStartTag(t);break}case et.BOGUS_COMMENT:{this._stateBogusComment(t);break}case et.MARKUP_DECLARATION_OPEN:{this._stateMarkupDeclarationOpen(t);break}case et.COMMENT_START:{this._stateCommentStart(t);break}case et.COMMENT_START_DASH:{this._stateCommentStartDash(t);break}case et.COMMENT:{this._stateComment(t);break}case et.COMMENT_LESS_THAN_SIGN:{this._stateCommentLessThanSign(t);break}case et.COMMENT_LESS_THAN_SIGN_BANG:{this._stateCommentLessThanSignBang(t);break}case et.COMMENT_LESS_THAN_SIGN_BANG_DASH:{this._stateCommentLessThanSignBangDash(t);break}case et.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:{this._stateCommentLessThanSignBangDashDash(t);break}case et.COMMENT_END_DASH:{this._stateCommentEndDash(t);break}case et.COMMENT_END:{this._stateCommentEnd(t);break}case et.COMMENT_END_BANG:{this._stateCommentEndBang(t);break}case et.DOCTYPE:{this._stateDoctype(t);break}case et.BEFORE_DOCTYPE_NAME:{this._stateBeforeDoctypeName(t);break}case et.DOCTYPE_NAME:{this._stateDoctypeName(t);break}case et.AFTER_DOCTYPE_NAME:{this._stateAfterDoctypeName(t);break}case et.AFTER_DOCTYPE_PUBLIC_KEYWORD:{this._stateAfterDoctypePublicKeyword(t);break}case et.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateBeforeDoctypePublicIdentifier(t);break}case et.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypePublicIdentifierDoubleQuoted(t);break}case et.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypePublicIdentifierSingleQuoted(t);break}case et.AFTER_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateAfterDoctypePublicIdentifier(t);break}case et.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS:{this._stateBetweenDoctypePublicAndSystemIdentifiers(t);break}case et.AFTER_DOCTYPE_SYSTEM_KEYWORD:{this._stateAfterDoctypeSystemKeyword(t);break}case et.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateBeforeDoctypeSystemIdentifier(t);break}case et.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypeSystemIdentifierDoubleQuoted(t);break}case et.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypeSystemIdentifierSingleQuoted(t);break}case et.AFTER_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateAfterDoctypeSystemIdentifier(t);break}case et.BOGUS_DOCTYPE:{this._stateBogusDoctype(t);break}case et.CDATA_SECTION:{this._stateCdataSection(t);break}case et.CDATA_SECTION_BRACKET:{this._stateCdataSectionBracket(t);break}case et.CDATA_SECTION_END:{this._stateCdataSectionEnd(t);break}case et.CHARACTER_REFERENCE:{this._stateCharacterReference();break}case et.AMBIGUOUS_AMPERSAND:{this._stateAmbiguousAmpersand(t);break}default:throw new Error("Unknown state")}}_stateData(t){switch(t){case qe.LESS_THAN_SIGN:{this.state=et.TAG_OPEN;break}case qe.AMPERSAND:{this._startCharacterReference();break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),this._emitCodePoint(t);break}case qe.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateRcdata(t){switch(t){case qe.AMPERSAND:{this._startCharacterReference();break}case qe.LESS_THAN_SIGN:{this.state=et.RCDATA_LESS_THAN_SIGN;break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),this._emitChars(Co);break}case qe.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateRawtext(t){switch(t){case qe.LESS_THAN_SIGN:{this.state=et.RAWTEXT_LESS_THAN_SIGN;break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),this._emitChars(Co);break}case qe.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptData(t){switch(t){case qe.LESS_THAN_SIGN:{this.state=et.SCRIPT_DATA_LESS_THAN_SIGN;break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),this._emitChars(Co);break}case qe.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_statePlaintext(t){switch(t){case qe.NULL:{this._err(hn.unexpectedNullCharacter),this._emitChars(Co);break}case qe.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateTagOpen(t){if(Rm(t))this._createStartTagToken(),this.state=et.TAG_NAME,this._stateTagName(t);else switch(t){case qe.EXCLAMATION_MARK:{this.state=et.MARKUP_DECLARATION_OPEN;break}case qe.SOLIDUS:{this.state=et.END_TAG_OPEN;break}case qe.QUESTION_MARK:{this._err(hn.unexpectedQuestionMarkInsteadOfTagName),this._createCommentToken(1),this.state=et.BOGUS_COMMENT,this._stateBogusComment(t);break}case qe.EOF:{this._err(hn.eofBeforeTagName),this._emitChars("<"),this._emitEOFToken();break}default:this._err(hn.invalidFirstCharacterOfTagName),this._emitChars("<"),this.state=et.DATA,this._stateData(t)}}_stateEndTagOpen(t){if(Rm(t))this._createEndTagToken(),this.state=et.TAG_NAME,this._stateTagName(t);else switch(t){case qe.GREATER_THAN_SIGN:{this._err(hn.missingEndTagName),this.state=et.DATA;break}case qe.EOF:{this._err(hn.eofBeforeTagName),this._emitChars("</"),this._emitEOFToken();break}default:this._err(hn.invalidFirstCharacterOfTagName),this._createCommentToken(2),this.state=et.BOGUS_COMMENT,this._stateBogusComment(t)}}_stateTagName(t){const n=this.currentToken;switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:{this.state=et.BEFORE_ATTRIBUTE_NAME;break}case qe.SOLIDUS:{this.state=et.SELF_CLOSING_START_TAG;break}case qe.GREATER_THAN_SIGN:{this.state=et.DATA,this.emitCurrentTagToken();break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),n.tagName+=Co;break}case qe.EOF:{this._err(hn.eofInTag),this._emitEOFToken();break}default:n.tagName+=String.fromCodePoint(b2(t)?o4(t):t)}}_stateRcdataLessThanSign(t){t===qe.SOLIDUS?this.state=et.RCDATA_END_TAG_OPEN:(this._emitChars("<"),this.state=et.RCDATA,this._stateRcdata(t))}_stateRcdataEndTagOpen(t){Rm(t)?(this.state=et.RCDATA_END_TAG_NAME,this._stateRcdataEndTagName(t)):(this._emitChars("</"),this.state=et.RCDATA,this._stateRcdata(t))}handleSpecialEndTag(t){if(!this.preprocessor.startsWith(this.lastStartTagName,!1))return!this._ensureHibernation();this._createEndTagToken();const n=this.currentToken;switch(n.tagName=this.lastStartTagName,this.preprocessor.peek(this.lastStartTagName.length)){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:return this._advanceBy(this.lastStartTagName.length),this.state=et.BEFORE_ATTRIBUTE_NAME,!1;case qe.SOLIDUS:return this._advanceBy(this.lastStartTagName.length),this.state=et.SELF_CLOSING_START_TAG,!1;case qe.GREATER_THAN_SIGN:return this._advanceBy(this.lastStartTagName.length),this.emitCurrentTagToken(),this.state=et.DATA,!1;default:return!this._ensureHibernation()}}_stateRcdataEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=et.RCDATA,this._stateRcdata(t))}_stateRawtextLessThanSign(t){t===qe.SOLIDUS?this.state=et.RAWTEXT_END_TAG_OPEN:(this._emitChars("<"),this.state=et.RAWTEXT,this._stateRawtext(t))}_stateRawtextEndTagOpen(t){Rm(t)?(this.state=et.RAWTEXT_END_TAG_NAME,this._stateRawtextEndTagName(t)):(this._emitChars("</"),this.state=et.RAWTEXT,this._stateRawtext(t))}_stateRawtextEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=et.RAWTEXT,this._stateRawtext(t))}_stateScriptDataLessThanSign(t){switch(t){case qe.SOLIDUS:{this.state=et.SCRIPT_DATA_END_TAG_OPEN;break}case qe.EXCLAMATION_MARK:{this.state=et.SCRIPT_DATA_ESCAPE_START,this._emitChars("<!");break}default:this._emitChars("<"),this.state=et.SCRIPT_DATA,this._stateScriptData(t)}}_stateScriptDataEndTagOpen(t){Rm(t)?(this.state=et.SCRIPT_DATA_END_TAG_NAME,this._stateScriptDataEndTagName(t)):(this._emitChars("</"),this.state=et.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=et.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscapeStart(t){t===qe.HYPHEN_MINUS?(this.state=et.SCRIPT_DATA_ESCAPE_START_DASH,this._emitChars("-")):(this.state=et.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscapeStartDash(t){t===qe.HYPHEN_MINUS?(this.state=et.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-")):(this.state=et.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscaped(t){switch(t){case qe.HYPHEN_MINUS:{this.state=et.SCRIPT_DATA_ESCAPED_DASH,this._emitChars("-");break}case qe.LESS_THAN_SIGN:{this.state=et.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),this._emitChars(Co);break}case qe.EOF:{this._err(hn.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptDataEscapedDash(t){switch(t){case qe.HYPHEN_MINUS:{this.state=et.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-");break}case qe.LESS_THAN_SIGN:{this.state=et.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),this.state=et.SCRIPT_DATA_ESCAPED,this._emitChars(Co);break}case qe.EOF:{this._err(hn.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=et.SCRIPT_DATA_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataEscapedDashDash(t){switch(t){case qe.HYPHEN_MINUS:{this._emitChars("-");break}case qe.LESS_THAN_SIGN:{this.state=et.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case qe.GREATER_THAN_SIGN:{this.state=et.SCRIPT_DATA,this._emitChars(">");break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),this.state=et.SCRIPT_DATA_ESCAPED,this._emitChars(Co);break}case qe.EOF:{this._err(hn.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=et.SCRIPT_DATA_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataEscapedLessThanSign(t){t===qe.SOLIDUS?this.state=et.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:Rm(t)?(this._emitChars("<"),this.state=et.SCRIPT_DATA_DOUBLE_ESCAPE_START,this._stateScriptDataDoubleEscapeStart(t)):(this._emitChars("<"),this.state=et.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataEscapedEndTagOpen(t){Rm(t)?(this.state=et.SCRIPT_DATA_ESCAPED_END_TAG_NAME,this._stateScriptDataEscapedEndTagName(t)):(this._emitChars("</"),this.state=et.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataEscapedEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=et.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataDoubleEscapeStart(t){if(this.preprocessor.startsWith(Qu.SCRIPT,!1)&&J$(this.preprocessor.peek(Qu.SCRIPT.length))){this._emitCodePoint(t);for(let n=0;n<Qu.SCRIPT.length;n++)this._emitCodePoint(this._consume());this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED}else this._ensureHibernation()||(this.state=et.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataDoubleEscaped(t){switch(t){case qe.HYPHEN_MINUS:{this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED_DASH,this._emitChars("-");break}case qe.LESS_THAN_SIGN:{this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),this._emitChars(Co);break}case qe.EOF:{this._err(hn.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedDash(t){switch(t){case qe.HYPHEN_MINUS:{this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH,this._emitChars("-");break}case qe.LESS_THAN_SIGN:{this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(Co);break}case qe.EOF:{this._err(hn.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedDashDash(t){switch(t){case qe.HYPHEN_MINUS:{this._emitChars("-");break}case qe.LESS_THAN_SIGN:{this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case qe.GREATER_THAN_SIGN:{this.state=et.SCRIPT_DATA,this._emitChars(">");break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(Co);break}case qe.EOF:{this._err(hn.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedLessThanSign(t){t===qe.SOLIDUS?(this.state=et.SCRIPT_DATA_DOUBLE_ESCAPE_END,this._emitChars("/")):(this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(t))}_stateScriptDataDoubleEscapeEnd(t){if(this.preprocessor.startsWith(Qu.SCRIPT,!1)&&J$(this.preprocessor.peek(Qu.SCRIPT.length))){this._emitCodePoint(t);for(let n=0;n<Qu.SCRIPT.length;n++)this._emitCodePoint(this._consume());this.state=et.SCRIPT_DATA_ESCAPED}else this._ensureHibernation()||(this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(t))}_stateBeforeAttributeName(t){switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:break;case qe.SOLIDUS:case qe.GREATER_THAN_SIGN:case qe.EOF:{this.state=et.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(t);break}case qe.EQUALS_SIGN:{this._err(hn.unexpectedEqualsSignBeforeAttributeName),this._createAttr("="),this.state=et.ATTRIBUTE_NAME;break}default:this._createAttr(""),this.state=et.ATTRIBUTE_NAME,this._stateAttributeName(t)}}_stateAttributeName(t){switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:case qe.SOLIDUS:case qe.GREATER_THAN_SIGN:case qe.EOF:{this._leaveAttrName(),this.state=et.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(t);break}case qe.EQUALS_SIGN:{this._leaveAttrName(),this.state=et.BEFORE_ATTRIBUTE_VALUE;break}case qe.QUOTATION_MARK:case qe.APOSTROPHE:case qe.LESS_THAN_SIGN:{this._err(hn.unexpectedCharacterInAttributeName),this.currentAttr.name+=String.fromCodePoint(t);break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),this.currentAttr.name+=Co;break}default:this.currentAttr.name+=String.fromCodePoint(b2(t)?o4(t):t)}}_stateAfterAttributeName(t){switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:break;case qe.SOLIDUS:{this.state=et.SELF_CLOSING_START_TAG;break}case qe.EQUALS_SIGN:{this.state=et.BEFORE_ATTRIBUTE_VALUE;break}case qe.GREATER_THAN_SIGN:{this.state=et.DATA,this.emitCurrentTagToken();break}case qe.EOF:{this._err(hn.eofInTag),this._emitEOFToken();break}default:this._createAttr(""),this.state=et.ATTRIBUTE_NAME,this._stateAttributeName(t)}}_stateBeforeAttributeValue(t){switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:break;case qe.QUOTATION_MARK:{this.state=et.ATTRIBUTE_VALUE_DOUBLE_QUOTED;break}case qe.APOSTROPHE:{this.state=et.ATTRIBUTE_VALUE_SINGLE_QUOTED;break}case qe.GREATER_THAN_SIGN:{this._err(hn.missingAttributeValue),this.state=et.DATA,this.emitCurrentTagToken();break}default:this.state=et.ATTRIBUTE_VALUE_UNQUOTED,this._stateAttributeValueUnquoted(t)}}_stateAttributeValueDoubleQuoted(t){switch(t){case qe.QUOTATION_MARK:{this.state=et.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case qe.AMPERSAND:{this._startCharacterReference();break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),this.currentAttr.value+=Co;break}case qe.EOF:{this._err(hn.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAttributeValueSingleQuoted(t){switch(t){case qe.APOSTROPHE:{this.state=et.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case qe.AMPERSAND:{this._startCharacterReference();break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),this.currentAttr.value+=Co;break}case qe.EOF:{this._err(hn.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAttributeValueUnquoted(t){switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:{this._leaveAttrValue(),this.state=et.BEFORE_ATTRIBUTE_NAME;break}case qe.AMPERSAND:{this._startCharacterReference();break}case qe.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=et.DATA,this.emitCurrentTagToken();break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),this.currentAttr.value+=Co;break}case qe.QUOTATION_MARK:case qe.APOSTROPHE:case qe.LESS_THAN_SIGN:case qe.EQUALS_SIGN:case qe.GRAVE_ACCENT:{this._err(hn.unexpectedCharacterInUnquotedAttributeValue),this.currentAttr.value+=String.fromCodePoint(t);break}case qe.EOF:{this._err(hn.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAfterAttributeValueQuoted(t){switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:{this._leaveAttrValue(),this.state=et.BEFORE_ATTRIBUTE_NAME;break}case qe.SOLIDUS:{this._leaveAttrValue(),this.state=et.SELF_CLOSING_START_TAG;break}case qe.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=et.DATA,this.emitCurrentTagToken();break}case qe.EOF:{this._err(hn.eofInTag),this._emitEOFToken();break}default:this._err(hn.missingWhitespaceBetweenAttributes),this.state=et.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(t)}}_stateSelfClosingStartTag(t){switch(t){case qe.GREATER_THAN_SIGN:{const n=this.currentToken;n.selfClosing=!0,this.state=et.DATA,this.emitCurrentTagToken();break}case qe.EOF:{this._err(hn.eofInTag),this._emitEOFToken();break}default:this._err(hn.unexpectedSolidusInTag),this.state=et.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(t)}}_stateBogusComment(t){const n=this.currentToken;switch(t){case qe.GREATER_THAN_SIGN:{this.state=et.DATA,this.emitCurrentComment(n);break}case qe.EOF:{this.emitCurrentComment(n),this._emitEOFToken();break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),n.data+=Co;break}default:n.data+=String.fromCodePoint(t)}}_stateMarkupDeclarationOpen(t){this._consumeSequenceIfMatch(Qu.DASH_DASH,!0)?(this._createCommentToken(Qu.DASH_DASH.length+1),this.state=et.COMMENT_START):this._consumeSequenceIfMatch(Qu.DOCTYPE,!1)?(this.currentLocation=this.getCurrentLocation(Qu.DOCTYPE.length+1),this.state=et.DOCTYPE):this._consumeSequenceIfMatch(Qu.CDATA_START,!0)?this.inForeignNode?this.state=et.CDATA_SECTION:(this._err(hn.cdataInHtmlContent),this._createCommentToken(Qu.CDATA_START.length+1),this.currentToken.data="[CDATA[",this.state=et.BOGUS_COMMENT):this._ensureHibernation()||(this._err(hn.incorrectlyOpenedComment),this._createCommentToken(2),this.state=et.BOGUS_COMMENT,this._stateBogusComment(t))}_stateCommentStart(t){switch(t){case qe.HYPHEN_MINUS:{this.state=et.COMMENT_START_DASH;break}case qe.GREATER_THAN_SIGN:{this._err(hn.abruptClosingOfEmptyComment),this.state=et.DATA;const n=this.currentToken;this.emitCurrentComment(n);break}default:this.state=et.COMMENT,this._stateComment(t)}}_stateCommentStartDash(t){const n=this.currentToken;switch(t){case qe.HYPHEN_MINUS:{this.state=et.COMMENT_END;break}case qe.GREATER_THAN_SIGN:{this._err(hn.abruptClosingOfEmptyComment),this.state=et.DATA,this.emitCurrentComment(n);break}case qe.EOF:{this._err(hn.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="-",this.state=et.COMMENT,this._stateComment(t)}}_stateComment(t){const n=this.currentToken;switch(t){case qe.HYPHEN_MINUS:{this.state=et.COMMENT_END_DASH;break}case qe.LESS_THAN_SIGN:{n.data+="<",this.state=et.COMMENT_LESS_THAN_SIGN;break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),n.data+=Co;break}case qe.EOF:{this._err(hn.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+=String.fromCodePoint(t)}}_stateCommentLessThanSign(t){const n=this.currentToken;switch(t){case qe.EXCLAMATION_MARK:{n.data+="!",this.state=et.COMMENT_LESS_THAN_SIGN_BANG;break}case qe.LESS_THAN_SIGN:{n.data+="<";break}default:this.state=et.COMMENT,this._stateComment(t)}}_stateCommentLessThanSignBang(t){t===qe.HYPHEN_MINUS?this.state=et.COMMENT_LESS_THAN_SIGN_BANG_DASH:(this.state=et.COMMENT,this._stateComment(t))}_stateCommentLessThanSignBangDash(t){t===qe.HYPHEN_MINUS?this.state=et.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:(this.state=et.COMMENT_END_DASH,this._stateCommentEndDash(t))}_stateCommentLessThanSignBangDashDash(t){t!==qe.GREATER_THAN_SIGN&&t!==qe.EOF&&this._err(hn.nestedComment),this.state=et.COMMENT_END,this._stateCommentEnd(t)}_stateCommentEndDash(t){const n=this.currentToken;switch(t){case qe.HYPHEN_MINUS:{this.state=et.COMMENT_END;break}case qe.EOF:{this._err(hn.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="-",this.state=et.COMMENT,this._stateComment(t)}}_stateCommentEnd(t){const n=this.currentToken;switch(t){case qe.GREATER_THAN_SIGN:{this.state=et.DATA,this.emitCurrentComment(n);break}case qe.EXCLAMATION_MARK:{this.state=et.COMMENT_END_BANG;break}case qe.HYPHEN_MINUS:{n.data+="-";break}case qe.EOF:{this._err(hn.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="--",this.state=et.COMMENT,this._stateComment(t)}}_stateCommentEndBang(t){const n=this.currentToken;switch(t){case qe.HYPHEN_MINUS:{n.data+="--!",this.state=et.COMMENT_END_DASH;break}case qe.GREATER_THAN_SIGN:{this._err(hn.incorrectlyClosedComment),this.state=et.DATA,this.emitCurrentComment(n);break}case qe.EOF:{this._err(hn.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="--!",this.state=et.COMMENT,this._stateComment(t)}}_stateDoctype(t){switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:{this.state=et.BEFORE_DOCTYPE_NAME;break}case qe.GREATER_THAN_SIGN:{this.state=et.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(t);break}case qe.EOF:{this._err(hn.eofInDoctype),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.missingWhitespaceBeforeDoctypeName),this.state=et.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(t)}}_stateBeforeDoctypeName(t){if(b2(t))this._createDoctypeToken(String.fromCharCode(o4(t))),this.state=et.DOCTYPE_NAME;else switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:break;case qe.NULL:{this._err(hn.unexpectedNullCharacter),this._createDoctypeToken(Co),this.state=et.DOCTYPE_NAME;break}case qe.GREATER_THAN_SIGN:{this._err(hn.missingDoctypeName),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=et.DATA;break}case qe.EOF:{this._err(hn.eofInDoctype),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._createDoctypeToken(String.fromCodePoint(t)),this.state=et.DOCTYPE_NAME}}_stateDoctypeName(t){const n=this.currentToken;switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:{this.state=et.AFTER_DOCTYPE_NAME;break}case qe.GREATER_THAN_SIGN:{this.state=et.DATA,this.emitCurrentDoctype(n);break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),n.name+=Co;break}case qe.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.name+=String.fromCodePoint(b2(t)?o4(t):t)}}_stateAfterDoctypeName(t){const n=this.currentToken;switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:break;case qe.GREATER_THAN_SIGN:{this.state=et.DATA,this.emitCurrentDoctype(n);break}case qe.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._consumeSequenceIfMatch(Qu.PUBLIC,!1)?this.state=et.AFTER_DOCTYPE_PUBLIC_KEYWORD:this._consumeSequenceIfMatch(Qu.SYSTEM,!1)?this.state=et.AFTER_DOCTYPE_SYSTEM_KEYWORD:this._ensureHibernation()||(this._err(hn.invalidCharacterSequenceAfterDoctypeName),n.forceQuirks=!0,this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t))}}_stateAfterDoctypePublicKeyword(t){const n=this.currentToken;switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:{this.state=et.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER;break}case qe.QUOTATION_MARK:{this._err(hn.missingWhitespaceAfterDoctypePublicKeyword),n.publicId="",this.state=et.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case qe.APOSTROPHE:{this._err(hn.missingWhitespaceAfterDoctypePublicKeyword),n.publicId="",this.state=et.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case qe.GREATER_THAN_SIGN:{this._err(hn.missingDoctypePublicIdentifier),n.forceQuirks=!0,this.state=et.DATA,this.emitCurrentDoctype(n);break}case qe.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.missingQuoteBeforeDoctypePublicIdentifier),n.forceQuirks=!0,this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBeforeDoctypePublicIdentifier(t){const n=this.currentToken;switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:break;case qe.QUOTATION_MARK:{n.publicId="",this.state=et.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case qe.APOSTROPHE:{n.publicId="",this.state=et.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case qe.GREATER_THAN_SIGN:{this._err(hn.missingDoctypePublicIdentifier),n.forceQuirks=!0,this.state=et.DATA,this.emitCurrentDoctype(n);break}case qe.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.missingQuoteBeforeDoctypePublicIdentifier),n.forceQuirks=!0,this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateDoctypePublicIdentifierDoubleQuoted(t){const n=this.currentToken;switch(t){case qe.QUOTATION_MARK:{this.state=et.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),n.publicId+=Co;break}case qe.GREATER_THAN_SIGN:{this._err(hn.abruptDoctypePublicIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=et.DATA;break}case qe.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.publicId+=String.fromCodePoint(t)}}_stateDoctypePublicIdentifierSingleQuoted(t){const n=this.currentToken;switch(t){case qe.APOSTROPHE:{this.state=et.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),n.publicId+=Co;break}case qe.GREATER_THAN_SIGN:{this._err(hn.abruptDoctypePublicIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=et.DATA;break}case qe.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.publicId+=String.fromCodePoint(t)}}_stateAfterDoctypePublicIdentifier(t){const n=this.currentToken;switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:{this.state=et.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS;break}case qe.GREATER_THAN_SIGN:{this.state=et.DATA,this.emitCurrentDoctype(n);break}case qe.QUOTATION_MARK:{this._err(hn.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case qe.APOSTROPHE:{this._err(hn.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case qe.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBetweenDoctypePublicAndSystemIdentifiers(t){const n=this.currentToken;switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:break;case qe.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=et.DATA;break}case qe.QUOTATION_MARK:{n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case qe.APOSTROPHE:{n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case qe.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateAfterDoctypeSystemKeyword(t){const n=this.currentToken;switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:{this.state=et.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER;break}case qe.QUOTATION_MARK:{this._err(hn.missingWhitespaceAfterDoctypeSystemKeyword),n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case qe.APOSTROPHE:{this._err(hn.missingWhitespaceAfterDoctypeSystemKeyword),n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case qe.GREATER_THAN_SIGN:{this._err(hn.missingDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=et.DATA,this.emitCurrentDoctype(n);break}case qe.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBeforeDoctypeSystemIdentifier(t){const n=this.currentToken;switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:break;case qe.QUOTATION_MARK:{n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case qe.APOSTROPHE:{n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case qe.GREATER_THAN_SIGN:{this._err(hn.missingDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=et.DATA,this.emitCurrentDoctype(n);break}case qe.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateDoctypeSystemIdentifierDoubleQuoted(t){const n=this.currentToken;switch(t){case qe.QUOTATION_MARK:{this.state=et.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),n.systemId+=Co;break}case qe.GREATER_THAN_SIGN:{this._err(hn.abruptDoctypeSystemIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=et.DATA;break}case qe.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.systemId+=String.fromCodePoint(t)}}_stateDoctypeSystemIdentifierSingleQuoted(t){const n=this.currentToken;switch(t){case qe.APOSTROPHE:{this.state=et.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case qe.NULL:{this._err(hn.unexpectedNullCharacter),n.systemId+=Co;break}case qe.GREATER_THAN_SIGN:{this._err(hn.abruptDoctypeSystemIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=et.DATA;break}case qe.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.systemId+=String.fromCodePoint(t)}}_stateAfterDoctypeSystemIdentifier(t){const n=this.currentToken;switch(t){case qe.SPACE:case qe.LINE_FEED:case qe.TABULATION:case qe.FORM_FEED:break;case qe.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=et.DATA;break}case qe.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.unexpectedCharacterAfterDoctypeSystemIdentifier),this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBogusDoctype(t){const n=this.currentToken;switch(t){case qe.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=et.DATA;break}case qe.NULL:{this._err(hn.unexpectedNullCharacter);break}case qe.EOF:{this.emitCurrentDoctype(n),this._emitEOFToken();break}}}_stateCdataSection(t){switch(t){case qe.RIGHT_SQUARE_BRACKET:{this.state=et.CDATA_SECTION_BRACKET;break}case qe.EOF:{this._err(hn.eofInCdata),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateCdataSectionBracket(t){t===qe.RIGHT_SQUARE_BRACKET?this.state=et.CDATA_SECTION_END:(this._emitChars("]"),this.state=et.CDATA_SECTION,this._stateCdataSection(t))}_stateCdataSectionEnd(t){switch(t){case qe.GREATER_THAN_SIGN:{this.state=et.DATA;break}case qe.RIGHT_SQUARE_BRACKET:{this._emitChars("]");break}default:this._emitChars("]]"),this.state=et.CDATA_SECTION,this._stateCdataSection(t)}}_stateCharacterReference(){let t=this.entityDecoder.write(this.preprocessor.html,this.preprocessor.pos);if(t<0)if(this.preprocessor.lastChunkWritten)t=this.entityDecoder.end();else{this.active=!1,this.preprocessor.pos=this.preprocessor.html.length-1,this.consumedAfterSnapshot=0,this.preprocessor.endOfChunkHit=!0;return}t===0?(this.preprocessor.pos=this.entityStartPos,this._flushCodePointConsumedAsCharacterReference(qe.AMPERSAND),this.state=!this._isCharacterReferenceInAttribute()&&Q$(this.preprocessor.peek(1))?et.AMBIGUOUS_AMPERSAND:this.returnState):this.state=this.returnState}_stateAmbiguousAmpersand(t){Q$(t)?this._flushCodePointConsumedAsCharacterReference(t):(t===qe.SEMICOLON&&this._err(hn.unknownNamedCharacterReference),this.state=this.returnState,this._callState(t))}}const Zee=new Set([Q.DD,Q.DT,Q.LI,Q.OPTGROUP,Q.OPTION,Q.P,Q.RB,Q.RP,Q.RT,Q.RTC]),eH=new Set([...Zee,Q.CAPTION,Q.COLGROUP,Q.TBODY,Q.TD,Q.TFOOT,Q.TH,Q.THEAD,Q.TR]),jC=new Set([Q.APPLET,Q.CAPTION,Q.HTML,Q.MARQUEE,Q.OBJECT,Q.TABLE,Q.TD,Q.TEMPLATE,Q.TH]),gSe=new Set([...jC,Q.OL,Q.UL]),_Se=new Set([...jC,Q.BUTTON]),tH=new Set([Q.ANNOTATION_XML,Q.MI,Q.MN,Q.MO,Q.MS,Q.MTEXT]),nH=new Set([Q.DESC,Q.FOREIGN_OBJECT,Q.TITLE]),ySe=new Set([Q.TR,Q.TEMPLATE,Q.HTML]),vSe=new Set([Q.TBODY,Q.TFOOT,Q.THEAD,Q.TEMPLATE,Q.HTML]),xSe=new Set([Q.TABLE,Q.TEMPLATE,Q.HTML]),bSe=new Set([Q.TD,Q.TH]);class wSe{get currentTmplContentOrNode(){return this._isInTemplate()?this.treeAdapter.getTemplateContent(this.current):this.current}constructor(t,n,r){this.treeAdapter=n,this.handler=r,this.items=[],this.tagIDs=[],this.stackTop=-1,this.tmplCount=0,this.currentTagId=Q.UNKNOWN,this.current=t}_indexOf(t){return this.items.lastIndexOf(t,this.stackTop)}_isInTemplate(){return this.currentTagId===Q.TEMPLATE&&this.treeAdapter.getNamespaceURI(this.current)===Wn.HTML}_updateCurrentElement(){this.current=this.items[this.stackTop],this.currentTagId=this.tagIDs[this.stackTop]}push(t,n){this.stackTop++,this.items[this.stackTop]=t,this.current=t,this.tagIDs[this.stackTop]=n,this.currentTagId=n,this._isInTemplate()&&this.tmplCount++,this.handler.onItemPush(t,n,!0)}pop(){const t=this.current;this.tmplCount>0&&this._isInTemplate()&&this.tmplCount--,this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(t,!0)}replace(t,n){const r=this._indexOf(t);this.items[r]=n,r===this.stackTop&&(this.current=n)}insertAfter(t,n,r){const a=this._indexOf(t)+1;this.items.splice(a,0,n),this.tagIDs.splice(a,0,r),this.stackTop++,a===this.stackTop&&this._updateCurrentElement(),this.current&&this.currentTagId!==void 0&&this.handler.onItemPush(this.current,this.currentTagId,a===this.stackTop)}popUntilTagNamePopped(t){let n=this.stackTop+1;do n=this.tagIDs.lastIndexOf(t,n-1);while(n>0&&this.treeAdapter.getNamespaceURI(this.items[n])!==Wn.HTML);this.shortenToLength(Math.max(n,0))}shortenToLength(t){for(;this.stackTop>=t;){const n=this.current;this.tmplCount>0&&this._isInTemplate()&&(this.tmplCount-=1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(n,this.stackTop<t)}}popUntilElementPopped(t){const n=this._indexOf(t);this.shortenToLength(Math.max(n,0))}popUntilPopped(t,n){const r=this._indexOfTagNames(t,n);this.shortenToLength(Math.max(r,0))}popUntilNumberedHeaderPopped(){this.popUntilPopped(r8,Wn.HTML)}popUntilTableCellPopped(){this.popUntilPopped(bSe,Wn.HTML)}popAllUpToHtmlElement(){this.tmplCount=0,this.shortenToLength(1)}_indexOfTagNames(t,n){for(let r=this.stackTop;r>=0;r--)if(t.has(this.tagIDs[r])&&this.treeAdapter.getNamespaceURI(this.items[r])===n)return r;return-1}clearBackTo(t,n){const r=this._indexOfTagNames(t,n);this.shortenToLength(r+1)}clearBackToTableContext(){this.clearBackTo(xSe,Wn.HTML)}clearBackToTableBodyContext(){this.clearBackTo(vSe,Wn.HTML)}clearBackToTableRowContext(){this.clearBackTo(ySe,Wn.HTML)}remove(t){const n=this._indexOf(t);n>=0&&(n===this.stackTop?this.pop():(this.items.splice(n,1),this.tagIDs.splice(n,1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(t,!1)))}tryPeekProperlyNestedBodyElement(){return this.stackTop>=1&&this.tagIDs[1]===Q.BODY?this.items[1]:null}contains(t){return this._indexOf(t)>-1}getCommonAncestor(t){const n=this._indexOf(t)-1;return n>=0?this.items[n]:null}isRootHtmlElementCurrent(){return this.stackTop===0&&this.tagIDs[0]===Q.HTML}hasInDynamicScope(t,n){for(let r=this.stackTop;r>=0;r--){const a=this.tagIDs[r];switch(this.treeAdapter.getNamespaceURI(this.items[r])){case Wn.HTML:{if(a===t)return!0;if(n.has(a))return!1;break}case Wn.SVG:{if(nH.has(a))return!1;break}case Wn.MATHML:{if(tH.has(a))return!1;break}}}return!0}hasInScope(t){return this.hasInDynamicScope(t,jC)}hasInListItemScope(t){return this.hasInDynamicScope(t,gSe)}hasInButtonScope(t){return this.hasInDynamicScope(t,_Se)}hasNumberedHeaderInScope(){for(let t=this.stackTop;t>=0;t--){const n=this.tagIDs[t];switch(this.treeAdapter.getNamespaceURI(this.items[t])){case Wn.HTML:{if(r8.has(n))return!0;if(jC.has(n))return!1;break}case Wn.SVG:{if(nH.has(n))return!1;break}case Wn.MATHML:{if(tH.has(n))return!1;break}}}return!0}hasInTableScope(t){for(let n=this.stackTop;n>=0;n--)if(this.treeAdapter.getNamespaceURI(this.items[n])===Wn.HTML)switch(this.tagIDs[n]){case t:return!0;case Q.TABLE:case Q.HTML:return!1}return!0}hasTableBodyContextInTableScope(){for(let t=this.stackTop;t>=0;t--)if(this.treeAdapter.getNamespaceURI(this.items[t])===Wn.HTML)switch(this.tagIDs[t]){case Q.TBODY:case Q.THEAD:case Q.TFOOT:return!0;case Q.TABLE:case Q.HTML:return!1}return!0}hasInSelectScope(t){for(let n=this.stackTop;n>=0;n--)if(this.treeAdapter.getNamespaceURI(this.items[n])===Wn.HTML)switch(this.tagIDs[n]){case t:return!0;case Q.OPTION:case Q.OPTGROUP:break;default:return!1}return!0}generateImpliedEndTags(){for(;this.currentTagId!==void 0&&Zee.has(this.currentTagId);)this.pop()}generateImpliedEndTagsThoroughly(){for(;this.currentTagId!==void 0&&eH.has(this.currentTagId);)this.pop()}generateImpliedEndTagsWithExclusion(t){for(;this.currentTagId!==void 0&&this.currentTagId!==t&&eH.has(this.currentTagId);)this.pop()}}const PR=3;var af;(function(e){e[e.Marker=0]="Marker",e[e.Element=1]="Element"})(af||(af={}));const rH={type:af.Marker};class TSe{constructor(t){this.treeAdapter=t,this.entries=[],this.bookmark=null}_getNoahArkConditionCandidates(t,n){const r=[],a=n.length,l=this.treeAdapter.getTagName(t),f=this.treeAdapter.getNamespaceURI(t);for(let i=0;i<this.entries.length;i++){const y=this.entries[i];if(y.type===af.Marker)break;const{element:x}=y;if(this.treeAdapter.getTagName(x)===l&&this.treeAdapter.getNamespaceURI(x)===f){const S=this.treeAdapter.getAttrList(x);S.length===a&&r.push({idx:i,attrs:S})}}return r}_ensureNoahArkCondition(t){if(this.entries.length<PR)return;const n=this.treeAdapter.getAttrList(t),r=this._getNoahArkConditionCandidates(t,n);if(r.length<PR)return;const a=new Map(n.map(f=>[f.name,f.value]));let l=0;for(let f=0;f<r.length;f++){const i=r[f];i.attrs.every(y=>a.get(y.name)===y.value)&&(l+=1,l>=PR&&this.entries.splice(i.idx,1))}}insertMarker(){this.entries.unshift(rH)}pushElement(t,n){this._ensureNoahArkCondition(t),this.entries.unshift({type:af.Element,element:t,token:n})}insertElementAfterBookmark(t,n){const r=this.entries.indexOf(this.bookmark);this.entries.splice(r,0,{type:af.Element,element:t,token:n})}removeEntry(t){const n=this.entries.indexOf(t);n!==-1&&this.entries.splice(n,1)}clearToLastMarker(){const t=this.entries.indexOf(rH);t===-1?this.entries.length=0:this.entries.splice(0,t+1)}getElementEntryInScopeWithTagName(t){const n=this.entries.find(r=>r.type===af.Marker||this.treeAdapter.getTagName(r.element)===t);return n&&n.type===af.Element?n:null}getElementEntry(t){return this.entries.find(n=>n.type===af.Element&&n.element===t)}}const Mm={createDocument(){return{nodeName:"#document",mode:pd.NO_QUIRKS,childNodes:[]}},createDocumentFragment(){return{nodeName:"#document-fragment",childNodes:[]}},createElement(e,t,n){return{nodeName:e,tagName:e,attrs:n,namespaceURI:t,childNodes:[],parentNode:null}},createCommentNode(e){return{nodeName:"#comment",data:e,parentNode:null}},createTextNode(e){return{nodeName:"#text",value:e,parentNode:null}},appendChild(e,t){e.childNodes.push(t),t.parentNode=e},insertBefore(e,t,n){const r=e.childNodes.indexOf(n);e.childNodes.splice(r,0,t),t.parentNode=e},setTemplateContent(e,t){e.content=t},getTemplateContent(e){return e.content},setDocumentType(e,t,n,r){const a=e.childNodes.find(l=>l.nodeName==="#documentType");if(a)a.name=t,a.publicId=n,a.systemId=r;else{const l={nodeName:"#documentType",name:t,publicId:n,systemId:r,parentNode:null};Mm.appendChild(e,l)}},setDocumentMode(e,t){e.mode=t},getDocumentMode(e){return e.mode},detachNode(e){if(e.parentNode){const t=e.parentNode.childNodes.indexOf(e);e.parentNode.childNodes.splice(t,1),e.parentNode=null}},insertText(e,t){if(e.childNodes.length>0){const n=e.childNodes[e.childNodes.length-1];if(Mm.isTextNode(n)){n.value+=t;return}}Mm.appendChild(e,Mm.createTextNode(t))},insertTextBefore(e,t,n){const r=e.childNodes[e.childNodes.indexOf(n)-1];r&&Mm.isTextNode(r)?r.value+=t:Mm.insertBefore(e,Mm.createTextNode(t),n)},adoptAttributes(e,t){const n=new Set(e.attrs.map(r=>r.name));for(let r=0;r<t.length;r++)n.has(t[r].name)||e.attrs.push(t[r])},getFirstChild(e){return e.childNodes[0]},getChildNodes(e){return e.childNodes},getParentNode(e){return e.parentNode},getAttrList(e){return e.attrs},getTagName(e){return e.tagName},getNamespaceURI(e){return e.namespaceURI},getTextNodeContent(e){return e.value},getCommentNodeContent(e){return e.data},getDocumentTypeNodeName(e){return e.name},getDocumentTypeNodePublicId(e){return e.publicId},getDocumentTypeNodeSystemId(e){return e.systemId},isTextNode(e){return e.nodeName==="#text"},isCommentNode(e){return e.nodeName==="#comment"},isDocumentTypeNode(e){return e.nodeName==="#documentType"},isElementNode(e){return Object.prototype.hasOwnProperty.call(e,"tagName")},setNodeSourceCodeLocation(e,t){e.sourceCodeLocation=t},getNodeSourceCodeLocation(e){return e.sourceCodeLocation},updateNodeSourceCodeLocation(e,t){e.sourceCodeLocation={...e.sourceCodeLocation,...t}}},Wee="html",ESe="about:legacy-compat",SSe="http://www.ibm.com/data/dtd/v11/ibmxhtml1-transitional.dtd",Xee=["+//silmaril//dtd html pro v0r11 19970101//","-//as//dtd html 3.0 aswedit + extensions//","-//advasoft ltd//dtd html 3.0 aswedit + extensions//","-//ietf//dtd html 2.0 level 1//","-//ietf//dtd html 2.0 level 2//","-//ietf//dtd html 2.0 strict level 1//","-//ietf//dtd html 2.0 strict level 2//","-//ietf//dtd html 2.0 strict//","-//ietf//dtd html 2.0//","-//ietf//dtd html 2.1e//","-//ietf//dtd html 3.0//","-//ietf//dtd html 3.2 final//","-//ietf//dtd html 3.2//","-//ietf//dtd html 3//","-//ietf//dtd html level 0//","-//ietf//dtd html level 1//","-//ietf//dtd html level 2//","-//ietf//dtd html level 3//","-//ietf//dtd html strict level 0//","-//ietf//dtd html strict level 1//","-//ietf//dtd html strict level 2//","-//ietf//dtd html strict level 3//","-//ietf//dtd html strict//","-//ietf//dtd html//","-//metrius//dtd metrius presentational//","-//microsoft//dtd internet explorer 2.0 html strict//","-//microsoft//dtd internet explorer 2.0 html//","-//microsoft//dtd internet explorer 2.0 tables//","-//microsoft//dtd internet explorer 3.0 html strict//","-//microsoft//dtd internet explorer 3.0 html//","-//microsoft//dtd internet explorer 3.0 tables//","-//netscape comm. corp.//dtd html//","-//netscape comm. corp.//dtd strict html//","-//o'reilly and associates//dtd html 2.0//","-//o'reilly and associates//dtd html extended 1.0//","-//o'reilly and associates//dtd html extended relaxed 1.0//","-//sq//dtd html 2.0 hotmetal + extensions//","-//softquad software//dtd hotmetal pro 6.0::19990601::extensions to html 4.0//","-//softquad//dtd hotmetal pro 4.0::19971010::extensions to html 4.0//","-//spyglass//dtd html 2.0 extended//","-//sun microsystems corp.//dtd hotjava html//","-//sun microsystems corp.//dtd hotjava strict html//","-//w3c//dtd html 3 1995-03-24//","-//w3c//dtd html 3.2 draft//","-//w3c//dtd html 3.2 final//","-//w3c//dtd html 3.2//","-//w3c//dtd html 3.2s draft//","-//w3c//dtd html 4.0 frameset//","-//w3c//dtd html 4.0 transitional//","-//w3c//dtd html experimental 19960712//","-//w3c//dtd html experimental 970421//","-//w3c//dtd w3 html//","-//w3o//dtd w3 html 3.0//","-//webtechs//dtd mozilla html 2.0//","-//webtechs//dtd mozilla html//"],ASe=[...Xee,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"],CSe=new Set(["-//w3o//dtd w3 html strict 3.0//en//","-/w3c/dtd html 4.0 transitional/en","html"]),Yee=["-//w3c//dtd xhtml 1.0 frameset//","-//w3c//dtd xhtml 1.0 transitional//"],kSe=[...Yee,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"];function iH(e,t){return t.some(n=>e.startsWith(n))}function ISe(e){return e.name===Wee&&e.publicId===null&&(e.systemId===null||e.systemId===ESe)}function RSe(e){if(e.name!==Wee)return pd.QUIRKS;const{systemId:t}=e;if(t&&t.toLowerCase()===SSe)return pd.QUIRKS;let{publicId:n}=e;if(n!==null){if(n=n.toLowerCase(),CSe.has(n))return pd.QUIRKS;let r=t===null?ASe:Xee;if(iH(n,r))return pd.QUIRKS;if(r=t===null?Yee:kSe,iH(n,r))return pd.LIMITED_QUIRKS}return pd.NO_QUIRKS}const sH={TEXT_HTML:"text/html",APPLICATION_XML:"application/xhtml+xml"},MSe="definitionurl",PSe="definitionURL",OSe=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(e=>[e.toLowerCase(),e])),LSe=new Map([["xlink:actuate",{prefix:"xlink",name:"actuate",namespace:Wn.XLINK}],["xlink:arcrole",{prefix:"xlink",name:"arcrole",namespace:Wn.XLINK}],["xlink:href",{prefix:"xlink",name:"href",namespace:Wn.XLINK}],["xlink:role",{prefix:"xlink",name:"role",namespace:Wn.XLINK}],["xlink:show",{prefix:"xlink",name:"show",namespace:Wn.XLINK}],["xlink:title",{prefix:"xlink",name:"title",namespace:Wn.XLINK}],["xlink:type",{prefix:"xlink",name:"type",namespace:Wn.XLINK}],["xml:lang",{prefix:"xml",name:"lang",namespace:Wn.XML}],["xml:space",{prefix:"xml",name:"space",namespace:Wn.XML}],["xmlns",{prefix:"",name:"xmlns",namespace:Wn.XMLNS}],["xmlns:xlink",{prefix:"xmlns",name:"xlink",namespace:Wn.XMLNS}]]),DSe=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(e=>[e.toLowerCase(),e])),NSe=new Set([Q.B,Q.BIG,Q.BLOCKQUOTE,Q.BODY,Q.BR,Q.CENTER,Q.CODE,Q.DD,Q.DIV,Q.DL,Q.DT,Q.EM,Q.EMBED,Q.H1,Q.H2,Q.H3,Q.H4,Q.H5,Q.H6,Q.HEAD,Q.HR,Q.I,Q.IMG,Q.LI,Q.LISTING,Q.MENU,Q.META,Q.NOBR,Q.OL,Q.P,Q.PRE,Q.RUBY,Q.S,Q.SMALL,Q.SPAN,Q.STRONG,Q.STRIKE,Q.SUB,Q.SUP,Q.TABLE,Q.TT,Q.U,Q.UL,Q.VAR]);function zSe(e){const t=e.tagID;return t===Q.FONT&&e.attrs.some(({name:r})=>r===h_.COLOR||r===h_.SIZE||r===h_.FACE)||NSe.has(t)}function Kee(e){for(let t=0;t<e.attrs.length;t++)if(e.attrs[t].name===MSe){e.attrs[t].name=PSe;break}}function Qee(e){for(let t=0;t<e.attrs.length;t++){const n=OSe.get(e.attrs[t].name);n!=null&&(e.attrs[t].name=n)}}function aN(e){for(let t=0;t<e.attrs.length;t++){const n=LSe.get(e.attrs[t].name);n&&(e.attrs[t].prefix=n.prefix,e.attrs[t].name=n.name,e.attrs[t].namespace=n.namespace)}}function FSe(e){const t=DSe.get(e.tagName);t!=null&&(e.tagName=t,e.tagID=jx(e.tagName))}function BSe(e,t){return t===Wn.MATHML&&(e===Q.MI||e===Q.MO||e===Q.MN||e===Q.MS||e===Q.MTEXT)}function jSe(e,t,n){if(t===Wn.MATHML&&e===Q.ANNOTATION_XML){for(let r=0;r<n.length;r++)if(n[r].name===h_.ENCODING){const a=n[r].value.toLowerCase();return a===sH.TEXT_HTML||a===sH.APPLICATION_XML}}return t===Wn.SVG&&(e===Q.FOREIGN_OBJECT||e===Q.DESC||e===Q.TITLE)}function USe(e,t,n,r){return(!r||r===Wn.HTML)&&jSe(e,t,n)||(!r||r===Wn.MATHML)&&BSe(e,t)}const VSe="hidden",$Se=8,HSe=3;var lt;(function(e){e[e.INITIAL=0]="INITIAL",e[e.BEFORE_HTML=1]="BEFORE_HTML",e[e.BEFORE_HEAD=2]="BEFORE_HEAD",e[e.IN_HEAD=3]="IN_HEAD",e[e.IN_HEAD_NO_SCRIPT=4]="IN_HEAD_NO_SCRIPT",e[e.AFTER_HEAD=5]="AFTER_HEAD",e[e.IN_BODY=6]="IN_BODY",e[e.TEXT=7]="TEXT",e[e.IN_TABLE=8]="IN_TABLE",e[e.IN_TABLE_TEXT=9]="IN_TABLE_TEXT",e[e.IN_CAPTION=10]="IN_CAPTION",e[e.IN_COLUMN_GROUP=11]="IN_COLUMN_GROUP",e[e.IN_TABLE_BODY=12]="IN_TABLE_BODY",e[e.IN_ROW=13]="IN_ROW",e[e.IN_CELL=14]="IN_CELL",e[e.IN_SELECT=15]="IN_SELECT",e[e.IN_SELECT_IN_TABLE=16]="IN_SELECT_IN_TABLE",e[e.IN_TEMPLATE=17]="IN_TEMPLATE",e[e.AFTER_BODY=18]="AFTER_BODY",e[e.IN_FRAMESET=19]="IN_FRAMESET",e[e.AFTER_FRAMESET=20]="AFTER_FRAMESET",e[e.AFTER_AFTER_BODY=21]="AFTER_AFTER_BODY",e[e.AFTER_AFTER_FRAMESET=22]="AFTER_AFTER_FRAMESET"})(lt||(lt={}));const GSe={startLine:-1,startCol:-1,startOffset:-1,endLine:-1,endCol:-1,endOffset:-1},Jee=new Set([Q.TABLE,Q.TBODY,Q.TFOOT,Q.THEAD,Q.TR]),aH={scriptingEnabled:!0,sourceCodeLocationInfo:!1,treeAdapter:Mm,onParseError:null};class oH{constructor(t,n,r=null,a=null){this.fragmentContext=r,this.scriptHandler=a,this.currentToken=null,this.stopped=!1,this.insertionMode=lt.INITIAL,this.originalInsertionMode=lt.INITIAL,this.headElement=null,this.formElement=null,this.currentNotInHTML=!1,this.tmplInsertionModeStack=[],this.pendingCharacterTokens=[],this.hasNonWhitespacePendingCharacterToken=!1,this.framesetOk=!0,this.skipNextNewLine=!1,this.fosterParentingEnabled=!1,this.options={...aH,...t},this.treeAdapter=this.options.treeAdapter,this.onParseError=this.options.onParseError,this.onParseError&&(this.options.sourceCodeLocationInfo=!0),this.document=n??this.treeAdapter.createDocument(),this.tokenizer=new mSe(this.options,this),this.activeFormattingElements=new TSe(this.treeAdapter),this.fragmentContextID=r?jx(this.treeAdapter.getTagName(r)):Q.UNKNOWN,this._setContextModes(r??this.document,this.fragmentContextID),this.openElements=new wSe(this.document,this.treeAdapter,this)}static parse(t,n){const r=new this(n);return r.tokenizer.write(t,!0),r.document}static getFragmentParser(t,n){const r={...aH,...n};t??(t=r.treeAdapter.createElement(Gt.TEMPLATE,Wn.HTML,[]));const a=r.treeAdapter.createElement("documentmock",Wn.HTML,[]),l=new this(r,a,t);return l.fragmentContextID===Q.TEMPLATE&&l.tmplInsertionModeStack.unshift(lt.IN_TEMPLATE),l._initTokenizerForFragmentParsing(),l._insertFakeRootElement(),l._resetInsertionMode(),l._findFormInFragmentContext(),l}getFragment(){const t=this.treeAdapter.getFirstChild(this.document),n=this.treeAdapter.createDocumentFragment();return this._adoptNodes(t,n),n}_err(t,n,r){var a;if(!this.onParseError)return;const l=(a=t.location)!==null&&a!==void 0?a:GSe,f={code:n,startLine:l.startLine,startCol:l.startCol,startOffset:l.startOffset,endLine:r?l.startLine:l.endLine,endCol:r?l.startCol:l.endCol,endOffset:r?l.startOffset:l.endOffset};this.onParseError(f)}onItemPush(t,n,r){var a,l;(l=(a=this.treeAdapter).onItemPush)===null||l===void 0||l.call(a,t),r&&this.openElements.stackTop>0&&this._setContextModes(t,n)}onItemPop(t,n){var r,a;if(this.options.sourceCodeLocationInfo&&this._setEndLocation(t,this.currentToken),(a=(r=this.treeAdapter).onItemPop)===null||a===void 0||a.call(r,t,this.openElements.current),n){let l,f;this.openElements.stackTop===0&&this.fragmentContext?(l=this.fragmentContext,f=this.fragmentContextID):{current:l,currentTagId:f}=this.openElements,this._setContextModes(l,f)}}_setContextModes(t,n){const r=t===this.document||t&&this.treeAdapter.getNamespaceURI(t)===Wn.HTML;this.currentNotInHTML=!r,this.tokenizer.inForeignNode=!r&&t!==void 0&&n!==void 0&&!this._isIntegrationPoint(n,t)}_switchToTextParsing(t,n){this._insertElement(t,Wn.HTML),this.tokenizer.state=n,this.originalInsertionMode=this.insertionMode,this.insertionMode=lt.TEXT}switchToPlaintextParsing(){this.insertionMode=lt.TEXT,this.originalInsertionMode=lt.IN_BODY,this.tokenizer.state=Jo.PLAINTEXT}_getAdjustedCurrentElement(){return this.openElements.stackTop===0&&this.fragmentContext?this.fragmentContext:this.openElements.current}_findFormInFragmentContext(){let t=this.fragmentContext;for(;t;){if(this.treeAdapter.getTagName(t)===Gt.FORM){this.formElement=t;break}t=this.treeAdapter.getParentNode(t)}}_initTokenizerForFragmentParsing(){if(!(!this.fragmentContext||this.treeAdapter.getNamespaceURI(this.fragmentContext)!==Wn.HTML))switch(this.fragmentContextID){case Q.TITLE:case Q.TEXTAREA:{this.tokenizer.state=Jo.RCDATA;break}case Q.STYLE:case Q.XMP:case Q.IFRAME:case Q.NOEMBED:case Q.NOFRAMES:case Q.NOSCRIPT:{this.tokenizer.state=Jo.RAWTEXT;break}case Q.SCRIPT:{this.tokenizer.state=Jo.SCRIPT_DATA;break}case Q.PLAINTEXT:{this.tokenizer.state=Jo.PLAINTEXT;break}}}_setDocumentType(t){const n=t.name||"",r=t.publicId||"",a=t.systemId||"";if(this.treeAdapter.setDocumentType(this.document,n,r,a),t.location){const f=this.treeAdapter.getChildNodes(this.document).find(i=>this.treeAdapter.isDocumentTypeNode(i));f&&this.treeAdapter.setNodeSourceCodeLocation(f,t.location)}}_attachElementToTree(t,n){if(this.options.sourceCodeLocationInfo){const r=n&&{...n,startTag:n};this.treeAdapter.setNodeSourceCodeLocation(t,r)}if(this._shouldFosterParentOnInsertion())this._fosterParentElement(t);else{const r=this.openElements.currentTmplContentOrNode;this.treeAdapter.appendChild(r??this.document,t)}}_appendElement(t,n){const r=this.treeAdapter.createElement(t.tagName,n,t.attrs);this._attachElementToTree(r,t.location)}_insertElement(t,n){const r=this.treeAdapter.createElement(t.tagName,n,t.attrs);this._attachElementToTree(r,t.location),this.openElements.push(r,t.tagID)}_insertFakeElement(t,n){const r=this.treeAdapter.createElement(t,Wn.HTML,[]);this._attachElementToTree(r,null),this.openElements.push(r,n)}_insertTemplate(t){const n=this.treeAdapter.createElement(t.tagName,Wn.HTML,t.attrs),r=this.treeAdapter.createDocumentFragment();this.treeAdapter.setTemplateContent(n,r),this._attachElementToTree(n,t.location),this.openElements.push(n,t.tagID),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(r,null)}_insertFakeRootElement(){const t=this.treeAdapter.createElement(Gt.HTML,Wn.HTML,[]);this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(t,null),this.treeAdapter.appendChild(this.openElements.current,t),this.openElements.push(t,Q.HTML)}_appendCommentNode(t,n){const r=this.treeAdapter.createCommentNode(t.data);this.treeAdapter.appendChild(n,r),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(r,t.location)}_insertCharacters(t){let n,r;if(this._shouldFosterParentOnInsertion()?({parent:n,beforeElement:r}=this._findFosterParentingLocation(),r?this.treeAdapter.insertTextBefore(n,t.chars,r):this.treeAdapter.insertText(n,t.chars)):(n=this.openElements.currentTmplContentOrNode,this.treeAdapter.insertText(n,t.chars)),!t.location)return;const a=this.treeAdapter.getChildNodes(n),l=r?a.lastIndexOf(r):a.length,f=a[l-1];if(this.treeAdapter.getNodeSourceCodeLocation(f)){const{endLine:y,endCol:x,endOffset:S}=t.location;this.treeAdapter.updateNodeSourceCodeLocation(f,{endLine:y,endCol:x,endOffset:S})}else this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(f,t.location)}_adoptNodes(t,n){for(let r=this.treeAdapter.getFirstChild(t);r;r=this.treeAdapter.getFirstChild(t))this.treeAdapter.detachNode(r),this.treeAdapter.appendChild(n,r)}_setEndLocation(t,n){if(this.treeAdapter.getNodeSourceCodeLocation(t)&&n.location){const r=n.location,a=this.treeAdapter.getTagName(t),l=n.type===na.END_TAG&&a===n.tagName?{endTag:{...r},endLine:r.endLine,endCol:r.endCol,endOffset:r.endOffset}:{endLine:r.startLine,endCol:r.startCol,endOffset:r.startOffset};this.treeAdapter.updateNodeSourceCodeLocation(t,l)}}shouldProcessStartTagTokenInForeignContent(t){if(!this.currentNotInHTML)return!1;let n,r;return this.openElements.stackTop===0&&this.fragmentContext?(n=this.fragmentContext,r=this.fragmentContextID):{current:n,currentTagId:r}=this.openElements,t.tagID===Q.SVG&&this.treeAdapter.getTagName(n)===Gt.ANNOTATION_XML&&this.treeAdapter.getNamespaceURI(n)===Wn.MATHML?!1:this.tokenizer.inForeignNode||(t.tagID===Q.MGLYPH||t.tagID===Q.MALIGNMARK)&&r!==void 0&&!this._isIntegrationPoint(r,n,Wn.HTML)}_processToken(t){switch(t.type){case na.CHARACTER:{this.onCharacter(t);break}case na.NULL_CHARACTER:{this.onNullCharacter(t);break}case na.COMMENT:{this.onComment(t);break}case na.DOCTYPE:{this.onDoctype(t);break}case na.START_TAG:{this._processStartTag(t);break}case na.END_TAG:{this.onEndTag(t);break}case na.EOF:{this.onEof(t);break}case na.WHITESPACE_CHARACTER:{this.onWhitespaceCharacter(t);break}}}_isIntegrationPoint(t,n,r){const a=this.treeAdapter.getNamespaceURI(n),l=this.treeAdapter.getAttrList(n);return USe(t,a,l,r)}_reconstructActiveFormattingElements(){const t=this.activeFormattingElements.entries.length;if(t){const n=this.activeFormattingElements.entries.findIndex(a=>a.type===af.Marker||this.openElements.contains(a.element)),r=n===-1?t-1:n-1;for(let a=r;a>=0;a--){const l=this.activeFormattingElements.entries[a];this._insertElement(l.token,this.treeAdapter.getNamespaceURI(l.element)),l.element=this.openElements.current}}}_closeTableCell(){this.openElements.generateImpliedEndTags(),this.openElements.popUntilTableCellPopped(),this.activeFormattingElements.clearToLastMarker(),this.insertionMode=lt.IN_ROW}_closePElement(){this.openElements.generateImpliedEndTagsWithExclusion(Q.P),this.openElements.popUntilTagNamePopped(Q.P)}_resetInsertionMode(){for(let t=this.openElements.stackTop;t>=0;t--)switch(t===0&&this.fragmentContext?this.fragmentContextID:this.openElements.tagIDs[t]){case Q.TR:{this.insertionMode=lt.IN_ROW;return}case Q.TBODY:case Q.THEAD:case Q.TFOOT:{this.insertionMode=lt.IN_TABLE_BODY;return}case Q.CAPTION:{this.insertionMode=lt.IN_CAPTION;return}case Q.COLGROUP:{this.insertionMode=lt.IN_COLUMN_GROUP;return}case Q.TABLE:{this.insertionMode=lt.IN_TABLE;return}case Q.BODY:{this.insertionMode=lt.IN_BODY;return}case Q.FRAMESET:{this.insertionMode=lt.IN_FRAMESET;return}case Q.SELECT:{this._resetInsertionModeForSelect(t);return}case Q.TEMPLATE:{this.insertionMode=this.tmplInsertionModeStack[0];return}case Q.HTML:{this.insertionMode=this.headElement?lt.AFTER_HEAD:lt.BEFORE_HEAD;return}case Q.TD:case Q.TH:{if(t>0){this.insertionMode=lt.IN_CELL;return}break}case Q.HEAD:{if(t>0){this.insertionMode=lt.IN_HEAD;return}break}}this.insertionMode=lt.IN_BODY}_resetInsertionModeForSelect(t){if(t>0)for(let n=t-1;n>0;n--){const r=this.openElements.tagIDs[n];if(r===Q.TEMPLATE)break;if(r===Q.TABLE){this.insertionMode=lt.IN_SELECT_IN_TABLE;return}}this.insertionMode=lt.IN_SELECT}_isElementCausesFosterParenting(t){return Jee.has(t)}_shouldFosterParentOnInsertion(){return this.fosterParentingEnabled&&this.openElements.currentTagId!==void 0&&this._isElementCausesFosterParenting(this.openElements.currentTagId)}_findFosterParentingLocation(){for(let t=this.openElements.stackTop;t>=0;t--){const n=this.openElements.items[t];switch(this.openElements.tagIDs[t]){case Q.TEMPLATE:{if(this.treeAdapter.getNamespaceURI(n)===Wn.HTML)return{parent:this.treeAdapter.getTemplateContent(n),beforeElement:null};break}case Q.TABLE:{const r=this.treeAdapter.getParentNode(n);return r?{parent:r,beforeElement:n}:{parent:this.openElements.items[t-1],beforeElement:null}}}}return{parent:this.openElements.items[0],beforeElement:null}}_fosterParentElement(t){const n=this._findFosterParentingLocation();n.beforeElement?this.treeAdapter.insertBefore(n.parent,t,n.beforeElement):this.treeAdapter.appendChild(n.parent,t)}_isSpecialElement(t,n){const r=this.treeAdapter.getNamespaceURI(t);return dSe[r].has(n)}onCharacter(t){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){b4e(this,t);return}switch(this.insertionMode){case lt.INITIAL:{Kw(this,t);break}case lt.BEFORE_HTML:{N2(this,t);break}case lt.BEFORE_HEAD:{z2(this,t);break}case lt.IN_HEAD:{F2(this,t);break}case lt.IN_HEAD_NO_SCRIPT:{B2(this,t);break}case lt.AFTER_HEAD:{j2(this,t);break}case lt.IN_BODY:case lt.IN_CAPTION:case lt.IN_CELL:case lt.IN_TEMPLATE:{tte(this,t);break}case lt.TEXT:case lt.IN_SELECT:case lt.IN_SELECT_IN_TABLE:{this._insertCharacters(t);break}case lt.IN_TABLE:case lt.IN_TABLE_BODY:case lt.IN_ROW:{OR(this,t);break}case lt.IN_TABLE_TEXT:{ote(this,t);break}case lt.IN_COLUMN_GROUP:{UC(this,t);break}case lt.AFTER_BODY:{VC(this,t);break}case lt.AFTER_AFTER_BODY:{mA(this,t);break}}}onNullCharacter(t){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){x4e(this,t);return}switch(this.insertionMode){case lt.INITIAL:{Kw(this,t);break}case lt.BEFORE_HTML:{N2(this,t);break}case lt.BEFORE_HEAD:{z2(this,t);break}case lt.IN_HEAD:{F2(this,t);break}case lt.IN_HEAD_NO_SCRIPT:{B2(this,t);break}case lt.AFTER_HEAD:{j2(this,t);break}case lt.TEXT:{this._insertCharacters(t);break}case lt.IN_TABLE:case lt.IN_TABLE_BODY:case lt.IN_ROW:{OR(this,t);break}case lt.IN_COLUMN_GROUP:{UC(this,t);break}case lt.AFTER_BODY:{VC(this,t);break}case lt.AFTER_AFTER_BODY:{mA(this,t);break}}}onComment(t){if(this.skipNextNewLine=!1,this.currentNotInHTML){i8(this,t);return}switch(this.insertionMode){case lt.INITIAL:case lt.BEFORE_HTML:case lt.BEFORE_HEAD:case lt.IN_HEAD:case lt.IN_HEAD_NO_SCRIPT:case lt.AFTER_HEAD:case lt.IN_BODY:case lt.IN_TABLE:case lt.IN_CAPTION:case lt.IN_COLUMN_GROUP:case lt.IN_TABLE_BODY:case lt.IN_ROW:case lt.IN_CELL:case lt.IN_SELECT:case lt.IN_SELECT_IN_TABLE:case lt.IN_TEMPLATE:case lt.IN_FRAMESET:case lt.AFTER_FRAMESET:{i8(this,t);break}case lt.IN_TABLE_TEXT:{Qw(this,t);break}case lt.AFTER_BODY:{QSe(this,t);break}case lt.AFTER_AFTER_BODY:case lt.AFTER_AFTER_FRAMESET:{JSe(this,t);break}}}onDoctype(t){switch(this.skipNextNewLine=!1,this.insertionMode){case lt.INITIAL:{e3e(this,t);break}case lt.BEFORE_HEAD:case lt.IN_HEAD:case lt.IN_HEAD_NO_SCRIPT:case lt.AFTER_HEAD:{this._err(t,hn.misplacedDoctype);break}case lt.IN_TABLE_TEXT:{Qw(this,t);break}}}onStartTag(t){this.skipNextNewLine=!1,this.currentToken=t,this._processStartTag(t),t.selfClosing&&!t.ackSelfClosing&&this._err(t,hn.nonVoidHtmlElementStartTagWithTrailingSolidus)}_processStartTag(t){this.shouldProcessStartTagTokenInForeignContent(t)?w4e(this,t):this._startTagOutsideForeignContent(t)}_startTagOutsideForeignContent(t){switch(this.insertionMode){case lt.INITIAL:{Kw(this,t);break}case lt.BEFORE_HTML:{t3e(this,t);break}case lt.BEFORE_HEAD:{r3e(this,t);break}case lt.IN_HEAD:{Eh(this,t);break}case lt.IN_HEAD_NO_SCRIPT:{a3e(this,t);break}case lt.AFTER_HEAD:{l3e(this,t);break}case lt.IN_BODY:{pu(this,t);break}case lt.IN_TABLE:{hx(this,t);break}case lt.IN_TABLE_TEXT:{Qw(this,t);break}case lt.IN_CAPTION:{i4e(this,t);break}case lt.IN_COLUMN_GROUP:{uN(this,t);break}case lt.IN_TABLE_BODY:{Yk(this,t);break}case lt.IN_ROW:{Kk(this,t);break}case lt.IN_CELL:{o4e(this,t);break}case lt.IN_SELECT:{cte(this,t);break}case lt.IN_SELECT_IN_TABLE:{u4e(this,t);break}case lt.IN_TEMPLATE:{d4e(this,t);break}case lt.AFTER_BODY:{f4e(this,t);break}case lt.IN_FRAMESET:{p4e(this,t);break}case lt.AFTER_FRAMESET:{g4e(this,t);break}case lt.AFTER_AFTER_BODY:{y4e(this,t);break}case lt.AFTER_AFTER_FRAMESET:{v4e(this,t);break}}}onEndTag(t){this.skipNextNewLine=!1,this.currentToken=t,this.currentNotInHTML?T4e(this,t):this._endTagOutsideForeignContent(t)}_endTagOutsideForeignContent(t){switch(this.insertionMode){case lt.INITIAL:{Kw(this,t);break}case lt.BEFORE_HTML:{n3e(this,t);break}case lt.BEFORE_HEAD:{i3e(this,t);break}case lt.IN_HEAD:{s3e(this,t);break}case lt.IN_HEAD_NO_SCRIPT:{o3e(this,t);break}case lt.AFTER_HEAD:{u3e(this,t);break}case lt.IN_BODY:{Xk(this,t);break}case lt.TEXT:{W3e(this,t);break}case lt.IN_TABLE:{kT(this,t);break}case lt.IN_TABLE_TEXT:{Qw(this,t);break}case lt.IN_CAPTION:{s4e(this,t);break}case lt.IN_COLUMN_GROUP:{a4e(this,t);break}case lt.IN_TABLE_BODY:{s8(this,t);break}case lt.IN_ROW:{ute(this,t);break}case lt.IN_CELL:{l4e(this,t);break}case lt.IN_SELECT:{dte(this,t);break}case lt.IN_SELECT_IN_TABLE:{c4e(this,t);break}case lt.IN_TEMPLATE:{h4e(this,t);break}case lt.AFTER_BODY:{fte(this,t);break}case lt.IN_FRAMESET:{m4e(this,t);break}case lt.AFTER_FRAMESET:{_4e(this,t);break}case lt.AFTER_AFTER_BODY:{mA(this,t);break}}}onEof(t){switch(this.insertionMode){case lt.INITIAL:{Kw(this,t);break}case lt.BEFORE_HTML:{N2(this,t);break}case lt.BEFORE_HEAD:{z2(this,t);break}case lt.IN_HEAD:{F2(this,t);break}case lt.IN_HEAD_NO_SCRIPT:{B2(this,t);break}case lt.AFTER_HEAD:{j2(this,t);break}case lt.IN_BODY:case lt.IN_TABLE:case lt.IN_CAPTION:case lt.IN_COLUMN_GROUP:case lt.IN_TABLE_BODY:case lt.IN_ROW:case lt.IN_CELL:case lt.IN_SELECT:case lt.IN_SELECT_IN_TABLE:{ste(this,t);break}case lt.TEXT:{X3e(this,t);break}case lt.IN_TABLE_TEXT:{Qw(this,t);break}case lt.IN_TEMPLATE:{hte(this,t);break}case lt.AFTER_BODY:case lt.IN_FRAMESET:case lt.AFTER_FRAMESET:case lt.AFTER_AFTER_BODY:case lt.AFTER_AFTER_FRAMESET:{lN(this,t);break}}}onWhitespaceCharacter(t){if(this.skipNextNewLine&&(this.skipNextNewLine=!1,t.chars.charCodeAt(0)===qe.LINE_FEED)){if(t.chars.length===1)return;t.chars=t.chars.substr(1)}if(this.tokenizer.inForeignNode){this._insertCharacters(t);return}switch(this.insertionMode){case lt.IN_HEAD:case lt.IN_HEAD_NO_SCRIPT:case lt.AFTER_HEAD:case lt.TEXT:case lt.IN_COLUMN_GROUP:case lt.IN_SELECT:case lt.IN_SELECT_IN_TABLE:case lt.IN_FRAMESET:case lt.AFTER_FRAMESET:{this._insertCharacters(t);break}case lt.IN_BODY:case lt.IN_CAPTION:case lt.IN_CELL:case lt.IN_TEMPLATE:case lt.AFTER_BODY:case lt.AFTER_AFTER_BODY:case lt.AFTER_AFTER_FRAMESET:{ete(this,t);break}case lt.IN_TABLE:case lt.IN_TABLE_BODY:case lt.IN_ROW:{OR(this,t);break}case lt.IN_TABLE_TEXT:{ate(this,t);break}}}}function qSe(e,t){let n=e.activeFormattingElements.getElementEntryInScopeWithTagName(t.tagName);return n?e.openElements.contains(n.element)?e.openElements.hasInScope(t.tagID)||(n=null):(e.activeFormattingElements.removeEntry(n),n=null):ite(e,t),n}function ZSe(e,t){let n=null,r=e.openElements.stackTop;for(;r>=0;r--){const a=e.openElements.items[r];if(a===t.element)break;e._isSpecialElement(a,e.openElements.tagIDs[r])&&(n=a)}return n||(e.openElements.shortenToLength(Math.max(r,0)),e.activeFormattingElements.removeEntry(t)),n}function WSe(e,t,n){let r=t,a=e.openElements.getCommonAncestor(t);for(let l=0,f=a;f!==n;l++,f=a){a=e.openElements.getCommonAncestor(f);const i=e.activeFormattingElements.getElementEntry(f),y=i&&l>=HSe;!i||y?(y&&e.activeFormattingElements.removeEntry(i),e.openElements.remove(f)):(f=XSe(e,i),r===t&&(e.activeFormattingElements.bookmark=i),e.treeAdapter.detachNode(r),e.treeAdapter.appendChild(f,r),r=f)}return r}function XSe(e,t){const n=e.treeAdapter.getNamespaceURI(t.element),r=e.treeAdapter.createElement(t.token.tagName,n,t.token.attrs);return e.openElements.replace(t.element,r),t.element=r,r}function YSe(e,t,n){const r=e.treeAdapter.getTagName(t),a=jx(r);if(e._isElementCausesFosterParenting(a))e._fosterParentElement(n);else{const l=e.treeAdapter.getNamespaceURI(t);a===Q.TEMPLATE&&l===Wn.HTML&&(t=e.treeAdapter.getTemplateContent(t)),e.treeAdapter.appendChild(t,n)}}function KSe(e,t,n){const r=e.treeAdapter.getNamespaceURI(n.element),{token:a}=n,l=e.treeAdapter.createElement(a.tagName,r,a.attrs);e._adoptNodes(t,l),e.treeAdapter.appendChild(t,l),e.activeFormattingElements.insertElementAfterBookmark(l,a),e.activeFormattingElements.removeEntry(n),e.openElements.remove(n.element),e.openElements.insertAfter(t,l,a.tagID)}function oN(e,t){for(let n=0;n<$Se;n++){const r=qSe(e,t);if(!r)break;const a=ZSe(e,r);if(!a)break;e.activeFormattingElements.bookmark=r;const l=WSe(e,a,r.element),f=e.openElements.getCommonAncestor(r.element);e.treeAdapter.detachNode(l),f&&YSe(e,f,l),KSe(e,a,r)}}function i8(e,t){e._appendCommentNode(t,e.openElements.currentTmplContentOrNode)}function QSe(e,t){e._appendCommentNode(t,e.openElements.items[0])}function JSe(e,t){e._appendCommentNode(t,e.document)}function lN(e,t){if(e.stopped=!0,t.location){const n=e.fragmentContext?0:2;for(let r=e.openElements.stackTop;r>=n;r--)e._setEndLocation(e.openElements.items[r],t);if(!e.fragmentContext&&e.openElements.stackTop>=0){const r=e.openElements.items[0],a=e.treeAdapter.getNodeSourceCodeLocation(r);if(a&&!a.endTag&&(e._setEndLocation(r,t),e.openElements.stackTop>=1)){const l=e.openElements.items[1],f=e.treeAdapter.getNodeSourceCodeLocation(l);f&&!f.endTag&&e._setEndLocation(l,t)}}}}function e3e(e,t){e._setDocumentType(t);const n=t.forceQuirks?pd.QUIRKS:RSe(t);ISe(t)||e._err(t,hn.nonConformingDoctype),e.treeAdapter.setDocumentMode(e.document,n),e.insertionMode=lt.BEFORE_HTML}function Kw(e,t){e._err(t,hn.missingDoctype,!0),e.treeAdapter.setDocumentMode(e.document,pd.QUIRKS),e.insertionMode=lt.BEFORE_HTML,e._processToken(t)}function t3e(e,t){t.tagID===Q.HTML?(e._insertElement(t,Wn.HTML),e.insertionMode=lt.BEFORE_HEAD):N2(e,t)}function n3e(e,t){const n=t.tagID;(n===Q.HTML||n===Q.HEAD||n===Q.BODY||n===Q.BR)&&N2(e,t)}function N2(e,t){e._insertFakeRootElement(),e.insertionMode=lt.BEFORE_HEAD,e._processToken(t)}function r3e(e,t){switch(t.tagID){case Q.HTML:{pu(e,t);break}case Q.HEAD:{e._insertElement(t,Wn.HTML),e.headElement=e.openElements.current,e.insertionMode=lt.IN_HEAD;break}default:z2(e,t)}}function i3e(e,t){const n=t.tagID;n===Q.HEAD||n===Q.BODY||n===Q.HTML||n===Q.BR?z2(e,t):e._err(t,hn.endTagWithoutMatchingOpenElement)}function z2(e,t){e._insertFakeElement(Gt.HEAD,Q.HEAD),e.headElement=e.openElements.current,e.insertionMode=lt.IN_HEAD,e._processToken(t)}function Eh(e,t){switch(t.tagID){case Q.HTML:{pu(e,t);break}case Q.BASE:case Q.BASEFONT:case Q.BGSOUND:case Q.LINK:case Q.META:{e._appendElement(t,Wn.HTML),t.ackSelfClosing=!0;break}case Q.TITLE:{e._switchToTextParsing(t,Jo.RCDATA);break}case Q.NOSCRIPT:{e.options.scriptingEnabled?e._switchToTextParsing(t,Jo.RAWTEXT):(e._insertElement(t,Wn.HTML),e.insertionMode=lt.IN_HEAD_NO_SCRIPT);break}case Q.NOFRAMES:case Q.STYLE:{e._switchToTextParsing(t,Jo.RAWTEXT);break}case Q.SCRIPT:{e._switchToTextParsing(t,Jo.SCRIPT_DATA);break}case Q.TEMPLATE:{e._insertTemplate(t),e.activeFormattingElements.insertMarker(),e.framesetOk=!1,e.insertionMode=lt.IN_TEMPLATE,e.tmplInsertionModeStack.unshift(lt.IN_TEMPLATE);break}case Q.HEAD:{e._err(t,hn.misplacedStartTagForHeadElement);break}default:F2(e,t)}}function s3e(e,t){switch(t.tagID){case Q.HEAD:{e.openElements.pop(),e.insertionMode=lt.AFTER_HEAD;break}case Q.BODY:case Q.BR:case Q.HTML:{F2(e,t);break}case Q.TEMPLATE:{Y_(e,t);break}default:e._err(t,hn.endTagWithoutMatchingOpenElement)}}function Y_(e,t){e.openElements.tmplCount>0?(e.openElements.generateImpliedEndTagsThoroughly(),e.openElements.currentTagId!==Q.TEMPLATE&&e._err(t,hn.closingOfElementWithOpenChildElements),e.openElements.popUntilTagNamePopped(Q.TEMPLATE),e.activeFormattingElements.clearToLastMarker(),e.tmplInsertionModeStack.shift(),e._resetInsertionMode()):e._err(t,hn.endTagWithoutMatchingOpenElement)}function F2(e,t){e.openElements.pop(),e.insertionMode=lt.AFTER_HEAD,e._processToken(t)}function a3e(e,t){switch(t.tagID){case Q.HTML:{pu(e,t);break}case Q.BASEFONT:case Q.BGSOUND:case Q.HEAD:case Q.LINK:case Q.META:case Q.NOFRAMES:case Q.STYLE:{Eh(e,t);break}case Q.NOSCRIPT:{e._err(t,hn.nestedNoscriptInHead);break}default:B2(e,t)}}function o3e(e,t){switch(t.tagID){case Q.NOSCRIPT:{e.openElements.pop(),e.insertionMode=lt.IN_HEAD;break}case Q.BR:{B2(e,t);break}default:e._err(t,hn.endTagWithoutMatchingOpenElement)}}function B2(e,t){const n=t.type===na.EOF?hn.openElementsLeftAfterEof:hn.disallowedContentInNoscriptInHead;e._err(t,n),e.openElements.pop(),e.insertionMode=lt.IN_HEAD,e._processToken(t)}function l3e(e,t){switch(t.tagID){case Q.HTML:{pu(e,t);break}case Q.BODY:{e._insertElement(t,Wn.HTML),e.framesetOk=!1,e.insertionMode=lt.IN_BODY;break}case Q.FRAMESET:{e._insertElement(t,Wn.HTML),e.insertionMode=lt.IN_FRAMESET;break}case Q.BASE:case Q.BASEFONT:case Q.BGSOUND:case Q.LINK:case Q.META:case Q.NOFRAMES:case Q.SCRIPT:case Q.STYLE:case Q.TEMPLATE:case Q.TITLE:{e._err(t,hn.abandonedHeadElementChild),e.openElements.push(e.headElement,Q.HEAD),Eh(e,t),e.openElements.remove(e.headElement);break}case Q.HEAD:{e._err(t,hn.misplacedStartTagForHeadElement);break}default:j2(e,t)}}function u3e(e,t){switch(t.tagID){case Q.BODY:case Q.HTML:case Q.BR:{j2(e,t);break}case Q.TEMPLATE:{Y_(e,t);break}default:e._err(t,hn.endTagWithoutMatchingOpenElement)}}function j2(e,t){e._insertFakeElement(Gt.BODY,Q.BODY),e.insertionMode=lt.IN_BODY,Wk(e,t)}function Wk(e,t){switch(t.type){case na.CHARACTER:{tte(e,t);break}case na.WHITESPACE_CHARACTER:{ete(e,t);break}case na.COMMENT:{i8(e,t);break}case na.START_TAG:{pu(e,t);break}case na.END_TAG:{Xk(e,t);break}case na.EOF:{ste(e,t);break}}}function ete(e,t){e._reconstructActiveFormattingElements(),e._insertCharacters(t)}function tte(e,t){e._reconstructActiveFormattingElements(),e._insertCharacters(t),e.framesetOk=!1}function c3e(e,t){e.openElements.tmplCount===0&&e.treeAdapter.adoptAttributes(e.openElements.items[0],t.attrs)}function d3e(e,t){const n=e.openElements.tryPeekProperlyNestedBodyElement();n&&e.openElements.tmplCount===0&&(e.framesetOk=!1,e.treeAdapter.adoptAttributes(n,t.attrs))}function h3e(e,t){const n=e.openElements.tryPeekProperlyNestedBodyElement();e.framesetOk&&n&&(e.treeAdapter.detachNode(n),e.openElements.popAllUpToHtmlElement(),e._insertElement(t,Wn.HTML),e.insertionMode=lt.IN_FRAMESET)}function f3e(e,t){e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._insertElement(t,Wn.HTML)}function p3e(e,t){e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e.openElements.currentTagId!==void 0&&r8.has(e.openElements.currentTagId)&&e.openElements.pop(),e._insertElement(t,Wn.HTML)}function m3e(e,t){e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._insertElement(t,Wn.HTML),e.skipNextNewLine=!0,e.framesetOk=!1}function g3e(e,t){const n=e.openElements.tmplCount>0;(!e.formElement||n)&&(e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._insertElement(t,Wn.HTML),n||(e.formElement=e.openElements.current))}function _3e(e,t){e.framesetOk=!1;const n=t.tagID;for(let r=e.openElements.stackTop;r>=0;r--){const a=e.openElements.tagIDs[r];if(n===Q.LI&&a===Q.LI||(n===Q.DD||n===Q.DT)&&(a===Q.DD||a===Q.DT)){e.openElements.generateImpliedEndTagsWithExclusion(a),e.openElements.popUntilTagNamePopped(a);break}if(a!==Q.ADDRESS&&a!==Q.DIV&&a!==Q.P&&e._isSpecialElement(e.openElements.items[r],a))break}e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._insertElement(t,Wn.HTML)}function y3e(e,t){e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._insertElement(t,Wn.HTML),e.tokenizer.state=Jo.PLAINTEXT}function v3e(e,t){e.openElements.hasInScope(Q.BUTTON)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(Q.BUTTON)),e._reconstructActiveFormattingElements(),e._insertElement(t,Wn.HTML),e.framesetOk=!1}function x3e(e,t){const n=e.activeFormattingElements.getElementEntryInScopeWithTagName(Gt.A);n&&(oN(e,t),e.openElements.remove(n.element),e.activeFormattingElements.removeEntry(n)),e._reconstructActiveFormattingElements(),e._insertElement(t,Wn.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function b3e(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,Wn.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function w3e(e,t){e._reconstructActiveFormattingElements(),e.openElements.hasInScope(Q.NOBR)&&(oN(e,t),e._reconstructActiveFormattingElements()),e._insertElement(t,Wn.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function T3e(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,Wn.HTML),e.activeFormattingElements.insertMarker(),e.framesetOk=!1}function E3e(e,t){e.treeAdapter.getDocumentMode(e.document)!==pd.QUIRKS&&e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._insertElement(t,Wn.HTML),e.framesetOk=!1,e.insertionMode=lt.IN_TABLE}function nte(e,t){e._reconstructActiveFormattingElements(),e._appendElement(t,Wn.HTML),e.framesetOk=!1,t.ackSelfClosing=!0}function rte(e){const t=Gee(e,h_.TYPE);return t!=null&&t.toLowerCase()===VSe}function S3e(e,t){e._reconstructActiveFormattingElements(),e._appendElement(t,Wn.HTML),rte(t)||(e.framesetOk=!1),t.ackSelfClosing=!0}function A3e(e,t){e._appendElement(t,Wn.HTML),t.ackSelfClosing=!0}function C3e(e,t){e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._appendElement(t,Wn.HTML),e.framesetOk=!1,t.ackSelfClosing=!0}function k3e(e,t){t.tagName=Gt.IMG,t.tagID=Q.IMG,nte(e,t)}function I3e(e,t){e._insertElement(t,Wn.HTML),e.skipNextNewLine=!0,e.tokenizer.state=Jo.RCDATA,e.originalInsertionMode=e.insertionMode,e.framesetOk=!1,e.insertionMode=lt.TEXT}function R3e(e,t){e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._reconstructActiveFormattingElements(),e.framesetOk=!1,e._switchToTextParsing(t,Jo.RAWTEXT)}function M3e(e,t){e.framesetOk=!1,e._switchToTextParsing(t,Jo.RAWTEXT)}function lH(e,t){e._switchToTextParsing(t,Jo.RAWTEXT)}function P3e(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,Wn.HTML),e.framesetOk=!1,e.insertionMode=e.insertionMode===lt.IN_TABLE||e.insertionMode===lt.IN_CAPTION||e.insertionMode===lt.IN_TABLE_BODY||e.insertionMode===lt.IN_ROW||e.insertionMode===lt.IN_CELL?lt.IN_SELECT_IN_TABLE:lt.IN_SELECT}function O3e(e,t){e.openElements.currentTagId===Q.OPTION&&e.openElements.pop(),e._reconstructActiveFormattingElements(),e._insertElement(t,Wn.HTML)}function L3e(e,t){e.openElements.hasInScope(Q.RUBY)&&e.openElements.generateImpliedEndTags(),e._insertElement(t,Wn.HTML)}function D3e(e,t){e.openElements.hasInScope(Q.RUBY)&&e.openElements.generateImpliedEndTagsWithExclusion(Q.RTC),e._insertElement(t,Wn.HTML)}function N3e(e,t){e._reconstructActiveFormattingElements(),Kee(t),aN(t),t.selfClosing?e._appendElement(t,Wn.MATHML):e._insertElement(t,Wn.MATHML),t.ackSelfClosing=!0}function z3e(e,t){e._reconstructActiveFormattingElements(),Qee(t),aN(t),t.selfClosing?e._appendElement(t,Wn.SVG):e._insertElement(t,Wn.SVG),t.ackSelfClosing=!0}function uH(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,Wn.HTML)}function pu(e,t){switch(t.tagID){case Q.I:case Q.S:case Q.B:case Q.U:case Q.EM:case Q.TT:case Q.BIG:case Q.CODE:case Q.FONT:case Q.SMALL:case Q.STRIKE:case Q.STRONG:{b3e(e,t);break}case Q.A:{x3e(e,t);break}case Q.H1:case Q.H2:case Q.H3:case Q.H4:case Q.H5:case Q.H6:{p3e(e,t);break}case Q.P:case Q.DL:case Q.OL:case Q.UL:case Q.DIV:case Q.DIR:case Q.NAV:case Q.MAIN:case Q.MENU:case Q.ASIDE:case Q.CENTER:case Q.FIGURE:case Q.FOOTER:case Q.HEADER:case Q.HGROUP:case Q.DIALOG:case Q.DETAILS:case Q.ADDRESS:case Q.ARTICLE:case Q.SEARCH:case Q.SECTION:case Q.SUMMARY:case Q.FIELDSET:case Q.BLOCKQUOTE:case Q.FIGCAPTION:{f3e(e,t);break}case Q.LI:case Q.DD:case Q.DT:{_3e(e,t);break}case Q.BR:case Q.IMG:case Q.WBR:case Q.AREA:case Q.EMBED:case Q.KEYGEN:{nte(e,t);break}case Q.HR:{C3e(e,t);break}case Q.RB:case Q.RTC:{L3e(e,t);break}case Q.RT:case Q.RP:{D3e(e,t);break}case Q.PRE:case Q.LISTING:{m3e(e,t);break}case Q.XMP:{R3e(e,t);break}case Q.SVG:{z3e(e,t);break}case Q.HTML:{c3e(e,t);break}case Q.BASE:case Q.LINK:case Q.META:case Q.STYLE:case Q.TITLE:case Q.SCRIPT:case Q.BGSOUND:case Q.BASEFONT:case Q.TEMPLATE:{Eh(e,t);break}case Q.BODY:{d3e(e,t);break}case Q.FORM:{g3e(e,t);break}case Q.NOBR:{w3e(e,t);break}case Q.MATH:{N3e(e,t);break}case Q.TABLE:{E3e(e,t);break}case Q.INPUT:{S3e(e,t);break}case Q.PARAM:case Q.TRACK:case Q.SOURCE:{A3e(e,t);break}case Q.IMAGE:{k3e(e,t);break}case Q.BUTTON:{v3e(e,t);break}case Q.APPLET:case Q.OBJECT:case Q.MARQUEE:{T3e(e,t);break}case Q.IFRAME:{M3e(e,t);break}case Q.SELECT:{P3e(e,t);break}case Q.OPTION:case Q.OPTGROUP:{O3e(e,t);break}case Q.NOEMBED:case Q.NOFRAMES:{lH(e,t);break}case Q.FRAMESET:{h3e(e,t);break}case Q.TEXTAREA:{I3e(e,t);break}case Q.NOSCRIPT:{e.options.scriptingEnabled?lH(e,t):uH(e,t);break}case Q.PLAINTEXT:{y3e(e,t);break}case Q.COL:case Q.TH:case Q.TD:case Q.TR:case Q.HEAD:case Q.FRAME:case Q.TBODY:case Q.TFOOT:case Q.THEAD:case Q.CAPTION:case Q.COLGROUP:break;default:uH(e,t)}}function F3e(e,t){if(e.openElements.hasInScope(Q.BODY)&&(e.insertionMode=lt.AFTER_BODY,e.options.sourceCodeLocationInfo)){const n=e.openElements.tryPeekProperlyNestedBodyElement();n&&e._setEndLocation(n,t)}}function B3e(e,t){e.openElements.hasInScope(Q.BODY)&&(e.insertionMode=lt.AFTER_BODY,fte(e,t))}function j3e(e,t){const n=t.tagID;e.openElements.hasInScope(n)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(n))}function U3e(e){const t=e.openElements.tmplCount>0,{formElement:n}=e;t||(e.formElement=null),(n||t)&&e.openElements.hasInScope(Q.FORM)&&(e.openElements.generateImpliedEndTags(),t?e.openElements.popUntilTagNamePopped(Q.FORM):n&&e.openElements.remove(n))}function V3e(e){e.openElements.hasInButtonScope(Q.P)||e._insertFakeElement(Gt.P,Q.P),e._closePElement()}function $3e(e){e.openElements.hasInListItemScope(Q.LI)&&(e.openElements.generateImpliedEndTagsWithExclusion(Q.LI),e.openElements.popUntilTagNamePopped(Q.LI))}function H3e(e,t){const n=t.tagID;e.openElements.hasInScope(n)&&(e.openElements.generateImpliedEndTagsWithExclusion(n),e.openElements.popUntilTagNamePopped(n))}function G3e(e){e.openElements.hasNumberedHeaderInScope()&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilNumberedHeaderPopped())}function q3e(e,t){const n=t.tagID;e.openElements.hasInScope(n)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(n),e.activeFormattingElements.clearToLastMarker())}function Z3e(e){e._reconstructActiveFormattingElements(),e._insertFakeElement(Gt.BR,Q.BR),e.openElements.pop(),e.framesetOk=!1}function ite(e,t){const n=t.tagName,r=t.tagID;for(let a=e.openElements.stackTop;a>0;a--){const l=e.openElements.items[a],f=e.openElements.tagIDs[a];if(r===f&&(r!==Q.UNKNOWN||e.treeAdapter.getTagName(l)===n)){e.openElements.generateImpliedEndTagsWithExclusion(r),e.openElements.stackTop>=a&&e.openElements.shortenToLength(a);break}if(e._isSpecialElement(l,f))break}}function Xk(e,t){switch(t.tagID){case Q.A:case Q.B:case Q.I:case Q.S:case Q.U:case Q.EM:case Q.TT:case Q.BIG:case Q.CODE:case Q.FONT:case Q.NOBR:case Q.SMALL:case Q.STRIKE:case Q.STRONG:{oN(e,t);break}case Q.P:{V3e(e);break}case Q.DL:case Q.UL:case Q.OL:case Q.DIR:case Q.DIV:case Q.NAV:case Q.PRE:case Q.MAIN:case Q.MENU:case Q.ASIDE:case Q.BUTTON:case Q.CENTER:case Q.FIGURE:case Q.FOOTER:case Q.HEADER:case Q.HGROUP:case Q.DIALOG:case Q.ADDRESS:case Q.ARTICLE:case Q.DETAILS:case Q.SEARCH:case Q.SECTION:case Q.SUMMARY:case Q.LISTING:case Q.FIELDSET:case Q.BLOCKQUOTE:case Q.FIGCAPTION:{j3e(e,t);break}case Q.LI:{$3e(e);break}case Q.DD:case Q.DT:{H3e(e,t);break}case Q.H1:case Q.H2:case Q.H3:case Q.H4:case Q.H5:case Q.H6:{G3e(e);break}case Q.BR:{Z3e(e);break}case Q.BODY:{F3e(e,t);break}case Q.HTML:{B3e(e,t);break}case Q.FORM:{U3e(e);break}case Q.APPLET:case Q.OBJECT:case Q.MARQUEE:{q3e(e,t);break}case Q.TEMPLATE:{Y_(e,t);break}default:ite(e,t)}}function ste(e,t){e.tmplInsertionModeStack.length>0?hte(e,t):lN(e,t)}function W3e(e,t){var n;t.tagID===Q.SCRIPT&&((n=e.scriptHandler)===null||n===void 0||n.call(e,e.openElements.current)),e.openElements.pop(),e.insertionMode=e.originalInsertionMode}function X3e(e,t){e._err(t,hn.eofInElementThatCanContainOnlyText),e.openElements.pop(),e.insertionMode=e.originalInsertionMode,e.onEof(t)}function OR(e,t){if(e.openElements.currentTagId!==void 0&&Jee.has(e.openElements.currentTagId))switch(e.pendingCharacterTokens.length=0,e.hasNonWhitespacePendingCharacterToken=!1,e.originalInsertionMode=e.insertionMode,e.insertionMode=lt.IN_TABLE_TEXT,t.type){case na.CHARACTER:{ote(e,t);break}case na.WHITESPACE_CHARACTER:{ate(e,t);break}}else dE(e,t)}function Y3e(e,t){e.openElements.clearBackToTableContext(),e.activeFormattingElements.insertMarker(),e._insertElement(t,Wn.HTML),e.insertionMode=lt.IN_CAPTION}function K3e(e,t){e.openElements.clearBackToTableContext(),e._insertElement(t,Wn.HTML),e.insertionMode=lt.IN_COLUMN_GROUP}function Q3e(e,t){e.openElements.clearBackToTableContext(),e._insertFakeElement(Gt.COLGROUP,Q.COLGROUP),e.insertionMode=lt.IN_COLUMN_GROUP,uN(e,t)}function J3e(e,t){e.openElements.clearBackToTableContext(),e._insertElement(t,Wn.HTML),e.insertionMode=lt.IN_TABLE_BODY}function e4e(e,t){e.openElements.clearBackToTableContext(),e._insertFakeElement(Gt.TBODY,Q.TBODY),e.insertionMode=lt.IN_TABLE_BODY,Yk(e,t)}function t4e(e,t){e.openElements.hasInTableScope(Q.TABLE)&&(e.openElements.popUntilTagNamePopped(Q.TABLE),e._resetInsertionMode(),e._processStartTag(t))}function n4e(e,t){rte(t)?e._appendElement(t,Wn.HTML):dE(e,t),t.ackSelfClosing=!0}function r4e(e,t){!e.formElement&&e.openElements.tmplCount===0&&(e._insertElement(t,Wn.HTML),e.formElement=e.openElements.current,e.openElements.pop())}function hx(e,t){switch(t.tagID){case Q.TD:case Q.TH:case Q.TR:{e4e(e,t);break}case Q.STYLE:case Q.SCRIPT:case Q.TEMPLATE:{Eh(e,t);break}case Q.COL:{Q3e(e,t);break}case Q.FORM:{r4e(e,t);break}case Q.TABLE:{t4e(e,t);break}case Q.TBODY:case Q.TFOOT:case Q.THEAD:{J3e(e,t);break}case Q.INPUT:{n4e(e,t);break}case Q.CAPTION:{Y3e(e,t);break}case Q.COLGROUP:{K3e(e,t);break}default:dE(e,t)}}function kT(e,t){switch(t.tagID){case Q.TABLE:{e.openElements.hasInTableScope(Q.TABLE)&&(e.openElements.popUntilTagNamePopped(Q.TABLE),e._resetInsertionMode());break}case Q.TEMPLATE:{Y_(e,t);break}case Q.BODY:case Q.CAPTION:case Q.COL:case Q.COLGROUP:case Q.HTML:case Q.TBODY:case Q.TD:case Q.TFOOT:case Q.TH:case Q.THEAD:case Q.TR:break;default:dE(e,t)}}function dE(e,t){const n=e.fosterParentingEnabled;e.fosterParentingEnabled=!0,Wk(e,t),e.fosterParentingEnabled=n}function ate(e,t){e.pendingCharacterTokens.push(t)}function ote(e,t){e.pendingCharacterTokens.push(t),e.hasNonWhitespacePendingCharacterToken=!0}function Qw(e,t){let n=0;if(e.hasNonWhitespacePendingCharacterToken)for(;n<e.pendingCharacterTokens.length;n++)dE(e,e.pendingCharacterTokens[n]);else for(;n<e.pendingCharacterTokens.length;n++)e._insertCharacters(e.pendingCharacterTokens[n]);e.insertionMode=e.originalInsertionMode,e._processToken(t)}const lte=new Set([Q.CAPTION,Q.COL,Q.COLGROUP,Q.TBODY,Q.TD,Q.TFOOT,Q.TH,Q.THEAD,Q.TR]);function i4e(e,t){const n=t.tagID;lte.has(n)?e.openElements.hasInTableScope(Q.CAPTION)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(Q.CAPTION),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=lt.IN_TABLE,hx(e,t)):pu(e,t)}function s4e(e,t){const n=t.tagID;switch(n){case Q.CAPTION:case Q.TABLE:{e.openElements.hasInTableScope(Q.CAPTION)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(Q.CAPTION),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=lt.IN_TABLE,n===Q.TABLE&&kT(e,t));break}case Q.BODY:case Q.COL:case Q.COLGROUP:case Q.HTML:case Q.TBODY:case Q.TD:case Q.TFOOT:case Q.TH:case Q.THEAD:case Q.TR:break;default:Xk(e,t)}}function uN(e,t){switch(t.tagID){case Q.HTML:{pu(e,t);break}case Q.COL:{e._appendElement(t,Wn.HTML),t.ackSelfClosing=!0;break}case Q.TEMPLATE:{Eh(e,t);break}default:UC(e,t)}}function a4e(e,t){switch(t.tagID){case Q.COLGROUP:{e.openElements.currentTagId===Q.COLGROUP&&(e.openElements.pop(),e.insertionMode=lt.IN_TABLE);break}case Q.TEMPLATE:{Y_(e,t);break}case Q.COL:break;default:UC(e,t)}}function UC(e,t){e.openElements.currentTagId===Q.COLGROUP&&(e.openElements.pop(),e.insertionMode=lt.IN_TABLE,e._processToken(t))}function Yk(e,t){switch(t.tagID){case Q.TR:{e.openElements.clearBackToTableBodyContext(),e._insertElement(t,Wn.HTML),e.insertionMode=lt.IN_ROW;break}case Q.TH:case Q.TD:{e.openElements.clearBackToTableBodyContext(),e._insertFakeElement(Gt.TR,Q.TR),e.insertionMode=lt.IN_ROW,Kk(e,t);break}case Q.CAPTION:case Q.COL:case Q.COLGROUP:case Q.TBODY:case Q.TFOOT:case Q.THEAD:{e.openElements.hasTableBodyContextInTableScope()&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=lt.IN_TABLE,hx(e,t));break}default:hx(e,t)}}function s8(e,t){const n=t.tagID;switch(t.tagID){case Q.TBODY:case Q.TFOOT:case Q.THEAD:{e.openElements.hasInTableScope(n)&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=lt.IN_TABLE);break}case Q.TABLE:{e.openElements.hasTableBodyContextInTableScope()&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=lt.IN_TABLE,kT(e,t));break}case Q.BODY:case Q.CAPTION:case Q.COL:case Q.COLGROUP:case Q.HTML:case Q.TD:case Q.TH:case Q.TR:break;default:kT(e,t)}}function Kk(e,t){switch(t.tagID){case Q.TH:case Q.TD:{e.openElements.clearBackToTableRowContext(),e._insertElement(t,Wn.HTML),e.insertionMode=lt.IN_CELL,e.activeFormattingElements.insertMarker();break}case Q.CAPTION:case Q.COL:case Q.COLGROUP:case Q.TBODY:case Q.TFOOT:case Q.THEAD:case Q.TR:{e.openElements.hasInTableScope(Q.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=lt.IN_TABLE_BODY,Yk(e,t));break}default:hx(e,t)}}function ute(e,t){switch(t.tagID){case Q.TR:{e.openElements.hasInTableScope(Q.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=lt.IN_TABLE_BODY);break}case Q.TABLE:{e.openElements.hasInTableScope(Q.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=lt.IN_TABLE_BODY,s8(e,t));break}case Q.TBODY:case Q.TFOOT:case Q.THEAD:{(e.openElements.hasInTableScope(t.tagID)||e.openElements.hasInTableScope(Q.TR))&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=lt.IN_TABLE_BODY,s8(e,t));break}case Q.BODY:case Q.CAPTION:case Q.COL:case Q.COLGROUP:case Q.HTML:case Q.TD:case Q.TH:break;default:kT(e,t)}}function o4e(e,t){const n=t.tagID;lte.has(n)?(e.openElements.hasInTableScope(Q.TD)||e.openElements.hasInTableScope(Q.TH))&&(e._closeTableCell(),Kk(e,t)):pu(e,t)}function l4e(e,t){const n=t.tagID;switch(n){case Q.TD:case Q.TH:{e.openElements.hasInTableScope(n)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(n),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=lt.IN_ROW);break}case Q.TABLE:case Q.TBODY:case Q.TFOOT:case Q.THEAD:case Q.TR:{e.openElements.hasInTableScope(n)&&(e._closeTableCell(),ute(e,t));break}case Q.BODY:case Q.CAPTION:case Q.COL:case Q.COLGROUP:case Q.HTML:break;default:Xk(e,t)}}function cte(e,t){switch(t.tagID){case Q.HTML:{pu(e,t);break}case Q.OPTION:{e.openElements.currentTagId===Q.OPTION&&e.openElements.pop(),e._insertElement(t,Wn.HTML);break}case Q.OPTGROUP:{e.openElements.currentTagId===Q.OPTION&&e.openElements.pop(),e.openElements.currentTagId===Q.OPTGROUP&&e.openElements.pop(),e._insertElement(t,Wn.HTML);break}case Q.HR:{e.openElements.currentTagId===Q.OPTION&&e.openElements.pop(),e.openElements.currentTagId===Q.OPTGROUP&&e.openElements.pop(),e._appendElement(t,Wn.HTML),t.ackSelfClosing=!0;break}case Q.INPUT:case Q.KEYGEN:case Q.TEXTAREA:case Q.SELECT:{e.openElements.hasInSelectScope(Q.SELECT)&&(e.openElements.popUntilTagNamePopped(Q.SELECT),e._resetInsertionMode(),t.tagID!==Q.SELECT&&e._processStartTag(t));break}case Q.SCRIPT:case Q.TEMPLATE:{Eh(e,t);break}}}function dte(e,t){switch(t.tagID){case Q.OPTGROUP:{e.openElements.stackTop>0&&e.openElements.currentTagId===Q.OPTION&&e.openElements.tagIDs[e.openElements.stackTop-1]===Q.OPTGROUP&&e.openElements.pop(),e.openElements.currentTagId===Q.OPTGROUP&&e.openElements.pop();break}case Q.OPTION:{e.openElements.currentTagId===Q.OPTION&&e.openElements.pop();break}case Q.SELECT:{e.openElements.hasInSelectScope(Q.SELECT)&&(e.openElements.popUntilTagNamePopped(Q.SELECT),e._resetInsertionMode());break}case Q.TEMPLATE:{Y_(e,t);break}}}function u4e(e,t){const n=t.tagID;n===Q.CAPTION||n===Q.TABLE||n===Q.TBODY||n===Q.TFOOT||n===Q.THEAD||n===Q.TR||n===Q.TD||n===Q.TH?(e.openElements.popUntilTagNamePopped(Q.SELECT),e._resetInsertionMode(),e._processStartTag(t)):cte(e,t)}function c4e(e,t){const n=t.tagID;n===Q.CAPTION||n===Q.TABLE||n===Q.TBODY||n===Q.TFOOT||n===Q.THEAD||n===Q.TR||n===Q.TD||n===Q.TH?e.openElements.hasInTableScope(n)&&(e.openElements.popUntilTagNamePopped(Q.SELECT),e._resetInsertionMode(),e.onEndTag(t)):dte(e,t)}function d4e(e,t){switch(t.tagID){case Q.BASE:case Q.BASEFONT:case Q.BGSOUND:case Q.LINK:case Q.META:case Q.NOFRAMES:case Q.SCRIPT:case Q.STYLE:case Q.TEMPLATE:case Q.TITLE:{Eh(e,t);break}case Q.CAPTION:case Q.COLGROUP:case Q.TBODY:case Q.TFOOT:case Q.THEAD:{e.tmplInsertionModeStack[0]=lt.IN_TABLE,e.insertionMode=lt.IN_TABLE,hx(e,t);break}case Q.COL:{e.tmplInsertionModeStack[0]=lt.IN_COLUMN_GROUP,e.insertionMode=lt.IN_COLUMN_GROUP,uN(e,t);break}case Q.TR:{e.tmplInsertionModeStack[0]=lt.IN_TABLE_BODY,e.insertionMode=lt.IN_TABLE_BODY,Yk(e,t);break}case Q.TD:case Q.TH:{e.tmplInsertionModeStack[0]=lt.IN_ROW,e.insertionMode=lt.IN_ROW,Kk(e,t);break}default:e.tmplInsertionModeStack[0]=lt.IN_BODY,e.insertionMode=lt.IN_BODY,pu(e,t)}}function h4e(e,t){t.tagID===Q.TEMPLATE&&Y_(e,t)}function hte(e,t){e.openElements.tmplCount>0?(e.openElements.popUntilTagNamePopped(Q.TEMPLATE),e.activeFormattingElements.clearToLastMarker(),e.tmplInsertionModeStack.shift(),e._resetInsertionMode(),e.onEof(t)):lN(e,t)}function f4e(e,t){t.tagID===Q.HTML?pu(e,t):VC(e,t)}function fte(e,t){var n;if(t.tagID===Q.HTML){if(e.fragmentContext||(e.insertionMode=lt.AFTER_AFTER_BODY),e.options.sourceCodeLocationInfo&&e.openElements.tagIDs[0]===Q.HTML){e._setEndLocation(e.openElements.items[0],t);const r=e.openElements.items[1];r&&!(!((n=e.treeAdapter.getNodeSourceCodeLocation(r))===null||n===void 0)&&n.endTag)&&e._setEndLocation(r,t)}}else VC(e,t)}function VC(e,t){e.insertionMode=lt.IN_BODY,Wk(e,t)}function p4e(e,t){switch(t.tagID){case Q.HTML:{pu(e,t);break}case Q.FRAMESET:{e._insertElement(t,Wn.HTML);break}case Q.FRAME:{e._appendElement(t,Wn.HTML),t.ackSelfClosing=!0;break}case Q.NOFRAMES:{Eh(e,t);break}}}function m4e(e,t){t.tagID===Q.FRAMESET&&!e.openElements.isRootHtmlElementCurrent()&&(e.openElements.pop(),!e.fragmentContext&&e.openElements.currentTagId!==Q.FRAMESET&&(e.insertionMode=lt.AFTER_FRAMESET))}function g4e(e,t){switch(t.tagID){case Q.HTML:{pu(e,t);break}case Q.NOFRAMES:{Eh(e,t);break}}}function _4e(e,t){t.tagID===Q.HTML&&(e.insertionMode=lt.AFTER_AFTER_FRAMESET)}function y4e(e,t){t.tagID===Q.HTML?pu(e,t):mA(e,t)}function mA(e,t){e.insertionMode=lt.IN_BODY,Wk(e,t)}function v4e(e,t){switch(t.tagID){case Q.HTML:{pu(e,t);break}case Q.NOFRAMES:{Eh(e,t);break}}}function x4e(e,t){t.chars=Co,e._insertCharacters(t)}function b4e(e,t){e._insertCharacters(t),e.framesetOk=!1}function pte(e){for(;e.treeAdapter.getNamespaceURI(e.openElements.current)!==Wn.HTML&&e.openElements.currentTagId!==void 0&&!e._isIntegrationPoint(e.openElements.currentTagId,e.openElements.current);)e.openElements.pop()}function w4e(e,t){if(zSe(t))pte(e),e._startTagOutsideForeignContent(t);else{const n=e._getAdjustedCurrentElement(),r=e.treeAdapter.getNamespaceURI(n);r===Wn.MATHML?Kee(t):r===Wn.SVG&&(FSe(t),Qee(t)),aN(t),t.selfClosing?e._appendElement(t,r):e._insertElement(t,r),t.ackSelfClosing=!0}}function T4e(e,t){if(t.tagID===Q.P||t.tagID===Q.BR){pte(e),e._endTagOutsideForeignContent(t);return}for(let n=e.openElements.stackTop;n>0;n--){const r=e.openElements.items[n];if(e.treeAdapter.getNamespaceURI(r)===Wn.HTML){e._endTagOutsideForeignContent(t);break}const a=e.treeAdapter.getTagName(r);if(a.toLowerCase()===t.tagName){t.tagName=a,e.openElements.shortenToLength(n);break}}}Gt.AREA,Gt.BASE,Gt.BASEFONT,Gt.BGSOUND,Gt.BR,Gt.COL,Gt.EMBED,Gt.FRAME,Gt.HR,Gt.IMG,Gt.INPUT,Gt.KEYGEN,Gt.LINK,Gt.META,Gt.PARAM,Gt.SOURCE,Gt.TRACK,Gt.WBR;const Qk=mte("end"),If=mte("start");function mte(e){return t;function t(n){const r=n&&n.position&&n.position[e]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function gte(e){const t=If(e),n=Qk(e);if(t&&n)return{start:t,end:n}}function E4e(e,t,n,r){let a,l,f;l=t,f=n,a=r,Ox(e,l,i,a);function i(y,x){const S=x[x.length-1],C=S?S.children.indexOf(y):void 0;return f(y,C,S)}}const S4e=/<(\/?)(iframe|noembed|noframes|plaintext|script|style|textarea|title|xmp)(?=[\t\n\f\r />])/gi,A4e=new Set(["mdxFlowExpression","mdxJsxFlowElement","mdxJsxTextElement","mdxTextExpression","mdxjsEsm"]),cH={sourceCodeLocationInfo:!0,scriptingEnabled:!1};function _te(e,t){const n=N4e(e),r=jee("type",{handlers:{root:C4e,element:k4e,text:I4e,comment:vte,doctype:R4e,raw:P4e},unknown:O4e}),a={parser:n?new oH(cH):oH.getFragmentParser(void 0,cH),handle(i){r(i,a)},stitches:!1,options:t||{}};r(e,a),Ux(a,If());const l=n?a.parser.document:a.parser.getFragment(),f=CEe(l,{file:a.options.file});return a.stitches&&E4e(f,"comment",function(i,y,x){const S=i;if(S.value.stitch&&x&&y!==void 0){const C=x.children;return C[y]=S.value.stitch,y}}),f.type==="root"&&f.children.length===1&&f.children[0].type===e.type?f.children[0]:f}function yte(e,t){let n=-1;if(e)for(;++n<e.length;)t.handle(e[n])}function C4e(e,t){yte(e.children,t)}function k4e(e,t){L4e(e,t),yte(e.children,t),D4e(e,t)}function I4e(e,t){t.parser.tokenizer.state>4&&(t.parser.tokenizer.state=0);const n={type:na.CHARACTER,chars:e.value,location:hE(e)};Ux(t,If(e)),t.parser.currentToken=n,t.parser._processToken(t.parser.currentToken)}function R4e(e,t){const n={type:na.DOCTYPE,name:"html",forceQuirks:!1,publicId:"",systemId:"",location:hE(e)};Ux(t,If(e)),t.parser.currentToken=n,t.parser._processToken(t.parser.currentToken)}function M4e(e,t){t.stitches=!0;const n=z4e(e);if("children"in e&&"children"in n){const r=_te({type:"root",children:e.children},t.options);n.children=r.children}vte({type:"comment",value:{stitch:n}},t)}function vte(e,t){const n=e.value,r={type:na.COMMENT,data:n,location:hE(e)};Ux(t,If(e)),t.parser.currentToken=r,t.parser._processToken(t.parser.currentToken)}function P4e(e,t){if(t.parser.tokenizer.preprocessor.html="",t.parser.tokenizer.preprocessor.pos=-1,t.parser.tokenizer.preprocessor.lastGapPos=-2,t.parser.tokenizer.preprocessor.gapStack=[],t.parser.tokenizer.preprocessor.skipNextNewLine=!1,t.parser.tokenizer.preprocessor.lastChunkWritten=!1,t.parser.tokenizer.preprocessor.endOfChunkHit=!1,t.parser.tokenizer.preprocessor.isEol=!1,xte(t,If(e)),t.parser.tokenizer.write(t.options.tagfilter?e.value.replace(S4e,"&lt;$1$2"):e.value,!1),t.parser.tokenizer._runParsingLoop(),t.parser.tokenizer.state===72||t.parser.tokenizer.state===78){t.parser.tokenizer.preprocessor.lastChunkWritten=!0;const n=t.parser.tokenizer._consume();t.parser.tokenizer._callState(n)}}function O4e(e,t){const n=e;if(t.options.passThrough&&t.options.passThrough.includes(n.type))M4e(n,t);else{let r="";throw A4e.has(n.type)&&(r=". It looks like you are using MDX nodes with `hast-util-raw` (or `rehype-raw`). If you use this because you are using remark or rehype plugins that inject `'html'` nodes, then please raise an issue with that plugin, as its a bad and slow idea. If you use this because you are using markdown syntax, then you have to configure this utility (or plugin) to pass through these nodes (see `passThrough` in docs), but you can also migrate to use the MDX syntax"),new Error("Cannot compile `"+n.type+"` node"+r)}}function Ux(e,t){xte(e,t);const n=e.parser.tokenizer.currentCharacterToken;n&&n.location&&(n.location.endLine=e.parser.tokenizer.preprocessor.line,n.location.endCol=e.parser.tokenizer.preprocessor.col+1,n.location.endOffset=e.parser.tokenizer.preprocessor.offset+1,e.parser.currentToken=n,e.parser._processToken(e.parser.currentToken)),e.parser.tokenizer.paused=!1,e.parser.tokenizer.inLoop=!1,e.parser.tokenizer.active=!1,e.parser.tokenizer.returnState=Jo.DATA,e.parser.tokenizer.charRefCode=-1,e.parser.tokenizer.consumedAfterSnapshot=-1,e.parser.tokenizer.currentLocation=null,e.parser.tokenizer.currentCharacterToken=null,e.parser.tokenizer.currentToken=null,e.parser.tokenizer.currentAttr={name:"",value:""}}function xte(e,t){if(t&&t.offset!==void 0){const n={startLine:t.line,startCol:t.column,startOffset:t.offset,endLine:-1,endCol:-1,endOffset:-1};e.parser.tokenizer.preprocessor.lineStartPos=-t.column+1,e.parser.tokenizer.preprocessor.droppedBufferSize=t.offset,e.parser.tokenizer.preprocessor.line=t.line,e.parser.tokenizer.currentLocation=n}}function L4e(e,t){const n=e.tagName.toLowerCase();if(t.parser.tokenizer.state===Jo.PLAINTEXT)return;Ux(t,If(e));const r=t.parser.openElements.current;let a="namespaceURI"in r?r.namespaceURI:df.html;a===df.html&&n==="svg"&&(a=df.svg);const l=UEe({...e,children:[]},{space:a===df.svg?"svg":"html"}),f={type:na.START_TAG,tagName:n,tagID:jx(n),selfClosing:!1,ackSelfClosing:!1,attrs:"attrs"in l?l.attrs:[],location:hE(e)};t.parser.currentToken=f,t.parser._processToken(t.parser.currentToken),t.parser.tokenizer.lastStartTagName=n}function D4e(e,t){const n=e.tagName.toLowerCase();if(!t.parser.tokenizer.inForeignNode&&XEe.includes(n)||t.parser.tokenizer.state===Jo.PLAINTEXT)return;Ux(t,Qk(e));const r={type:na.END_TAG,tagName:n,tagID:jx(n),selfClosing:!1,ackSelfClosing:!1,attrs:[],location:hE(e)};t.parser.currentToken=r,t.parser._processToken(t.parser.currentToken),n===t.parser.tokenizer.lastStartTagName&&(t.parser.tokenizer.state===Jo.RCDATA||t.parser.tokenizer.state===Jo.RAWTEXT||t.parser.tokenizer.state===Jo.SCRIPT_DATA)&&(t.parser.tokenizer.state=Jo.DATA)}function N4e(e){const t=e.type==="root"?e.children[0]:e;return!!(t&&(t.type==="doctype"||t.type==="element"&&t.tagName.toLowerCase()==="html"))}function hE(e){const t=If(e)||{line:void 0,column:void 0,offset:void 0},n=Qk(e)||{line:void 0,column:void 0,offset:void 0};return{startLine:t.line,startCol:t.column,startOffset:t.offset,endLine:n.line,endCol:n.column,endOffset:n.offset}}function z4e(e){return"children"in e?P_({...e,children:[]}):P_(e)}function F4e(e){return function(t,n){return _te(t,{...e,file:n})}}const Ug=["ariaDescribedBy","ariaLabel","ariaLabelledBy"],dH={ancestors:{tbody:["table"],td:["table"],th:["table"],thead:["table"],tfoot:["table"],tr:["table"]},attributes:{a:[...Ug,"dataFootnoteBackref","dataFootnoteRef",["className","data-footnote-backref"],"href"],blockquote:["cite"],code:[["className",/^language-./]],del:["cite"],div:["itemScope","itemType"],dl:[...Ug],h2:[["className","sr-only"]],img:[...Ug,"longDesc","src"],input:[["disabled",!0],["type","checkbox"]],ins:["cite"],li:[["className","task-list-item"]],ol:[...Ug,["className","contains-task-list"]],q:["cite"],section:["dataFootnotes",["className","footnotes"]],source:["srcSet"],summary:[...Ug],table:[...Ug],ul:[...Ug,["className","contains-task-list"]],"*":["abbr","accept","acceptCharset","accessKey","action","align","alt","axis","border","cellPadding","cellSpacing","char","charOff","charSet","checked","clear","colSpan","color","cols","compact","coords","dateTime","dir","encType","frame","hSpace","headers","height","hrefLang","htmlFor","id","isMap","itemProp","label","lang","maxLength","media","method","multiple","name","noHref","noShade","noWrap","open","prompt","readOnly","rev","rowSpan","rows","rules","scope","selected","shape","size","span","start","summary","tabIndex","title","useMap","vAlign","value","width"]},clobber:["ariaDescribedBy","ariaLabelledBy","id","name"],clobberPrefix:"user-content-",protocols:{cite:["http","https"],href:["http","https","irc","ircs","mailto","xmpp"],longDesc:["http","https"],src:["http","https"]},required:{input:{disabled:!0,type:"checkbox"}},strip:["script"],tagNames:["a","b","blockquote","br","code","dd","del","details","div","dl","dt","em","h1","h2","h3","h4","h5","h6","hr","i","img","input","ins","kbd","li","ol","p","picture","pre","q","rp","rt","ruby","s","samp","section","source","span","strike","strong","sub","summary","sup","table","tbody","td","tfoot","th","thead","tr","tt","ul","var"]},Bm={}.hasOwnProperty;function B4e(e,t){let n={type:"root",children:[]};const r={schema:t?{...dH,...t}:dH,stack:[]},a=bte(r,e);return a&&(Array.isArray(a)?a.length===1?n=a[0]:n.children=a:n=a),n}function bte(e,t){if(t&&typeof t=="object"){const n=t;switch(typeof n.type=="string"?n.type:""){case"comment":return j4e(e,n);case"doctype":return U4e(e,n);case"element":return V4e(e,n);case"root":return $4e(e,n);case"text":return H4e(e,n)}}}function j4e(e,t){if(e.schema.allowComments){const n=typeof t.value=="string"?t.value:"",r=n.indexOf("-->"),l={type:"comment",value:r<0?n:n.slice(0,r)};return fE(l,t),l}}function U4e(e,t){if(e.schema.allowDoctypes){const n={type:"doctype"};return fE(n,t),n}}function V4e(e,t){const n=typeof t.tagName=="string"?t.tagName:"";e.stack.push(n);const r=wte(e,t.children),a=G4e(e,t.properties);e.stack.pop();let l=!1;if(n&&n!=="*"&&(!e.schema.tagNames||e.schema.tagNames.includes(n))&&(l=!0,e.schema.ancestors&&Bm.call(e.schema.ancestors,n))){const i=e.schema.ancestors[n];let y=-1;for(l=!1;++y<i.length;)e.stack.includes(i[y])&&(l=!0)}if(!l)return e.schema.strip&&!e.schema.strip.includes(n)?r:void 0;const f={type:"element",tagName:n,properties:a,children:r};return fE(f,t),f}function $4e(e,t){const r={type:"root",children:wte(e,t.children)};return fE(r,t),r}function H4e(e,t){const r={type:"text",value:typeof t.value=="string"?t.value:""};return fE(r,t),r}function wte(e,t){const n=[];if(Array.isArray(t)){const r=t;let a=-1;for(;++a<r.length;){const l=bte(e,r[a]);l&&(Array.isArray(l)?n.push(...l):n.push(l))}}return n}function G4e(e,t){const n=e.stack[e.stack.length-1],r=e.schema.attributes,a=e.schema.required,l=r&&Bm.call(r,n)?r[n]:void 0,f=r&&Bm.call(r,"*")?r["*"]:void 0,i=t&&typeof t=="object"?t:{},y={};let x;for(x in i)if(Bm.call(i,x)){const S=i[x];let C=hH(e,fH(l,x),x,S);C==null&&(C=hH(e,fH(f,x),x,S)),C!=null&&(y[x]=C)}if(a&&Bm.call(a,n)){const S=a[n];for(x in S)Bm.call(S,x)&&!Bm.call(y,x)&&(y[x]=S[x])}return y}function hH(e,t,n,r){return t?Array.isArray(r)?q4e(e,t,n,r):Tte(e,t,n,r):void 0}function q4e(e,t,n,r){let a=-1;const l=[];for(;++a<r.length;){const f=Tte(e,t,n,r[a]);(typeof f=="number"||typeof f=="string")&&l.push(f)}return l}function Tte(e,t,n,r){if(!(typeof r!="boolean"&&typeof r!="number"&&typeof r!="string")&&Z4e(e,n,r)){if(typeof t=="object"&&t.length>1){let a=!1,l=0;for(;++l<t.length;){const f=t[l];if(f&&typeof f=="object"&&"flags"in f){if(f.test(String(r))){a=!0;break}}else if(f===r){a=!0;break}}if(!a)return}return e.schema.clobber&&e.schema.clobberPrefix&&e.schema.clobber.includes(n)?e.schema.clobberPrefix+r:r}}function Z4e(e,t,n){const r=e.schema.protocols&&Bm.call(e.schema.protocols,t)?e.schema.protocols[t]:void 0;if(!r||r.length===0)return!0;const a=String(n),l=a.indexOf(":"),f=a.indexOf("?"),i=a.indexOf("#"),y=a.indexOf("/");if(l<0||y>-1&&l>y||f>-1&&l>f||i>-1&&l>i)return!0;let x=-1;for(;++x<r.length;){const S=r[x];if(l===S.length&&a.slice(0,S.length)===S)return!0}return!1}function fE(e,t){const n=gte(t);t.data&&(e.data=P_(t.data)),n&&(e.position=n)}function fH(e,t){let n,r=-1;if(e)for(;++r<e.length;){const a=e[r],l=typeof a=="string"?a:a[0];if(l===t)return a;l==="data*"&&(n=a)}if(t.length>4&&t.slice(0,4).toLowerCase()==="data")return n}function W4e(e){return function(t){return B4e(t,e)}}const _p={eof:null,asterisk:42,underscore:95,tilde:126},fx={attentionSideAfter:2,characterGroupPunctuation:2,characterGroupWhitespace:1},Jh={data:"data",characterEscape:"characterEscape",emphasis:"emphasis",emphasisSequence:"emphasisSequence",emphasisText:"emphasisText",strong:"strong",strongSequence:"strongSequence",strongText:"strongText"},Ru=V0(/[A-Za-z]/),cu=V0(/[\dA-Za-z]/),X4e=V0(/[#-'*+\--9=?A-Z^-~]/);function $C(e){return e!==null&&(e<32||e===127)}const a8=V0(/\d/),Y4e=V0(/[\dA-Fa-f]/),K4e=V0(/[!-/:-@[-`{-~]/);function Ti(e){return e!==null&&e<-2}function Qa(e){return e!==null&&(e<0||e===32)}function la(e){return e===-2||e===-1||e===32}const Jk=V0(new RegExp("\\p{P}|\\p{S}","u")),O_=V0(/\s/);function V0(e){return t;function t(n){return n!==null&&n>-1&&e.test(String.fromCharCode(n))}}function Q4e(e){return e===161||e===164||e===167||e===168||e===170||e===173||e===174||e>=176&&e<=180||e>=182&&e<=186||e>=188&&e<=191||e===198||e===208||e===215||e===216||e>=222&&e<=225||e===230||e>=232&&e<=234||e===236||e===237||e===240||e===242||e===243||e>=247&&e<=250||e===252||e===254||e===257||e===273||e===275||e===283||e===294||e===295||e===299||e>=305&&e<=307||e===312||e>=319&&e<=322||e===324||e>=328&&e<=331||e===333||e===338||e===339||e===358||e===359||e===363||e===462||e===464||e===466||e===468||e===470||e===472||e===474||e===476||e===593||e===609||e===708||e===711||e>=713&&e<=715||e===717||e===720||e>=728&&e<=731||e===733||e===735||e>=768&&e<=879||e>=913&&e<=929||e>=931&&e<=937||e>=945&&e<=961||e>=963&&e<=969||e===1025||e>=1040&&e<=1103||e===1105||e===8208||e>=8211&&e<=8214||e===8216||e===8217||e===8220||e===8221||e>=8224&&e<=8226||e>=8228&&e<=8231||e===8240||e===8242||e===8243||e===8245||e===8251||e===8254||e===8308||e===8319||e>=8321&&e<=8324||e===8364||e===8451||e===8453||e===8457||e===8467||e===8470||e===8481||e===8482||e===8486||e===8491||e===8531||e===8532||e>=8539&&e<=8542||e>=8544&&e<=8555||e>=8560&&e<=8569||e===8585||e>=8592&&e<=8601||e===8632||e===8633||e===8658||e===8660||e===8679||e===8704||e===8706||e===8707||e===8711||e===8712||e===8715||e===8719||e===8721||e===8725||e===8730||e>=8733&&e<=8736||e===8739||e===8741||e>=8743&&e<=8748||e===8750||e>=8756&&e<=8759||e===8764||e===8765||e===8776||e===8780||e===8786||e===8800||e===8801||e>=8804&&e<=8807||e===8810||e===8811||e===8814||e===8815||e===8834||e===8835||e===8838||e===8839||e===8853||e===8857||e===8869||e===8895||e===8978||e>=9312&&e<=9449||e>=9451&&e<=9547||e>=9552&&e<=9587||e>=9600&&e<=9615||e>=9618&&e<=9621||e===9632||e===9633||e>=9635&&e<=9641||e===9650||e===9651||e===9654||e===9655||e===9660||e===9661||e===9664||e===9665||e>=9670&&e<=9672||e===9675||e>=9678&&e<=9681||e>=9698&&e<=9701||e===9711||e===9733||e===9734||e===9737||e===9742||e===9743||e===9756||e===9758||e===9792||e===9794||e===9824||e===9825||e>=9827&&e<=9829||e>=9831&&e<=9834||e===9836||e===9837||e===9839||e===9886||e===9887||e===9919||e>=9926&&e<=9933||e>=9935&&e<=9939||e>=9941&&e<=9953||e===9955||e===9960||e===9961||e>=9963&&e<=9969||e===9972||e>=9974&&e<=9977||e===9979||e===9980||e===9982||e===9983||e===10045||e>=10102&&e<=10111||e>=11094&&e<=11097||e>=12872&&e<=12879||e>=57344&&e<=63743||e>=65024&&e<=65039||e===65533||e>=127232&&e<=127242||e>=127248&&e<=127277||e>=127280&&e<=127337||e>=127344&&e<=127373||e===127375||e===127376||e>=127387&&e<=127404||e>=917760&&e<=917999||e>=983040&&e<=1048573||e>=1048576&&e<=1114109}function J4e(e){return e===12288||e>=65281&&e<=65376||e>=65504&&e<=65510}function eAe(e){return e>=4352&&e<=4447||e===8986||e===8987||e===9001||e===9002||e>=9193&&e<=9196||e===9200||e===9203||e===9725||e===9726||e===9748||e===9749||e>=9776&&e<=9783||e>=9800&&e<=9811||e===9855||e>=9866&&e<=9871||e===9875||e===9889||e===9898||e===9899||e===9917||e===9918||e===9924||e===9925||e===9934||e===9940||e===9962||e===9970||e===9971||e===9973||e===9978||e===9981||e===9989||e===9994||e===9995||e===10024||e===10060||e===10062||e>=10067&&e<=10069||e===10071||e>=10133&&e<=10135||e===10160||e===10175||e===11035||e===11036||e===11088||e===11093||e>=11904&&e<=11929||e>=11931&&e<=12019||e>=12032&&e<=12245||e>=12272&&e<=12287||e>=12289&&e<=12350||e>=12353&&e<=12438||e>=12441&&e<=12543||e>=12549&&e<=12591||e>=12593&&e<=12686||e>=12688&&e<=12773||e>=12783&&e<=12830||e>=12832&&e<=12871||e>=12880&&e<=42124||e>=42128&&e<=42182||e>=43360&&e<=43388||e>=44032&&e<=55203||e>=63744&&e<=64255||e>=65040&&e<=65049||e>=65072&&e<=65106||e>=65108&&e<=65126||e>=65128&&e<=65131||e>=94176&&e<=94180||e>=94192&&e<=94198||e>=94208&&e<=101589||e>=101631&&e<=101662||e>=101760&&e<=101874||e>=110576&&e<=110579||e>=110581&&e<=110587||e===110589||e===110590||e>=110592&&e<=110882||e===110898||e>=110928&&e<=110930||e===110933||e>=110948&&e<=110951||e>=110960&&e<=111355||e>=119552&&e<=119638||e>=119648&&e<=119670||e===126980||e===127183||e===127374||e>=127377&&e<=127386||e>=127488&&e<=127490||e>=127504&&e<=127547||e>=127552&&e<=127560||e===127568||e===127569||e>=127584&&e<=127589||e>=127744&&e<=127776||e>=127789&&e<=127797||e>=127799&&e<=127868||e>=127870&&e<=127891||e>=127904&&e<=127946||e>=127951&&e<=127955||e>=127968&&e<=127984||e===127988||e>=127992&&e<=128062||e===128064||e>=128066&&e<=128252||e>=128255&&e<=128317||e>=128331&&e<=128334||e>=128336&&e<=128359||e===128378||e===128405||e===128406||e===128420||e>=128507&&e<=128591||e>=128640&&e<=128709||e===128716||e>=128720&&e<=128722||e>=128725&&e<=128728||e>=128732&&e<=128735||e===128747||e===128748||e>=128756&&e<=128764||e>=128992&&e<=129003||e===129008||e>=129292&&e<=129338||e>=129340&&e<=129349||e>=129351&&e<=129535||e>=129648&&e<=129660||e>=129664&&e<=129674||e>=129678&&e<=129734||e===129736||e>=129741&&e<=129756||e>=129759&&e<=129770||e>=129775&&e<=129784||e>=131072&&e<=196605||e>=196608&&e<=262141}function tAe(e){return Q4e(e)?"ambiguous":J4e(e)?"fullwidth":e===8361||e>=65377&&e<=65470||e>=65474&&e<=65479||e>=65482&&e<=65487||e>=65490&&e<=65495||e>=65498&&e<=65500||e>=65512&&e<=65518?"halfwidth":e>=32&&e<=126||e===162||e===163||e===165||e===166||e===172||e===175||e>=10214&&e<=10221||e===10629||e===10630?"narrow":eAe(e)?"wide":"neutral"}function nAe(e){if(!Number.isSafeInteger(e))throw new TypeError(`Expected a code point, got \`${typeof e}\`.`)}function rAe(e){return nAe(e),tAe(e)}var iAe=Object.defineProperty,sAe=(e,t,n)=>t in e?iAe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,aAe=(e,t,n)=>sAe(e,t+"",n);function oAe(e){return new RegExp("^\\p{Emoji_Presentation}","u").test(String.fromCodePoint(e))}function lAe(e){if(!e||e<4352)return!1;switch(rAe(e)){case"fullwidth":case"halfwidth":return!0;case"wide":return!oAe(e);case"narrow":return!1;case"ambiguous":return 917760<=e&&e<=917999?null:!1;case"neutral":return new RegExp("^\\p{sc=Hangul}","u").test(String.fromCodePoint(e))}}function uAe(e,t){return t!==65025||!e||e<8216?!1:e===8216||e===8217||e===8220||e===8221}function cAe(e){return e!==null&&e>=65024&&e<=65038}var dAe=Ete(new RegExp("\\p{P}|\\p{S}","u")),hAe=Ete(/\s/);function Ete(e){return t;function t(n){return n!==null&&n>-1&&e.test(String.fromCodePoint(n))}}var jc;(e=>{e.spaceOrPunctuation=3,e.cjk=4096,e.cjkPunctuation=4098,e.ivs=8192,e.cjkOrIvs=12288,e.nonEmojiGeneralUseVS=16384,e.variationSelector=24576,e.ivsToCjkRightShift=1})(jc||(jc={}));function kv(e){if(e===_p.eof||Qa(e)||hAe(e))return fx.characterGroupWhitespace;let t=0;if(e>=4352){if(cAe(e))return jc.nonEmojiGeneralUseVS;switch(lAe(e)){case null:return jc.ivs;case!0:t|=jc.cjk;break}}return dAe(e)&&(t|=fx.characterGroupPunctuation),t}function Ste(e,t,n){if(!gAe(e))return e;const r=t(),a=kv(r);return!r||IT(a)?e:uAe(r,n)?jc.cjkPunctuation:fAe(a)}function fAe(e){return e&~jc.ivs}function IT(e){return!!(e&fx.characterGroupWhitespace)}function HC(e){return(e&jc.cjkPunctuation)===fx.characterGroupPunctuation}function o8(e){return!!(e&jc.cjk)}function pAe(e){return e===jc.ivs}function mAe(e){return!!(e&jc.cjkOrIvs)}function gAe(e){return e===jc.nonEmojiGeneralUseVS}function pH(e){return!!(e&jc.spaceOrPunctuation)}function Ate(e){return!!(e&&e>=55296&&e<=56319)}function Cte(e){return!!(e&&e>=56320&&e<=57343)}function kte(e,t,n){if(t._bufferIndex<2)return e;const a=n({start:{...t,_bufferIndex:t._bufferIndex-2},end:t}).codePointAt(0);return a&&a>=65536?a:e}function _Ae(e,t,n){const r=e>=65536?2:1;if(t._bufferIndex<1+r)return null;const a=t._bufferIndex-r-2,l=n({start:{...t,_bufferIndex:a>=0?a:0},end:{...t,_bufferIndex:t._bufferIndex-r}}),f=l.charCodeAt(l.length-1);if(Number.isNaN(f))return null;if(l.length<2||f<56320||57343<f)return f;const i=l.codePointAt(0);return i&&i>=65536?i:f}var Ite=class{constructor(e,t,n){this.previousCode=e,this.nowPoint=t,this.sliceSerialize=n,aAe(this,"cachedValue")}value(){return this.cachedValue===void 0&&(this.cachedValue=_Ae(this.previousCode,this.nowPoint,this.sliceSerialize)),this.cachedValue}};function Rte(e,t,n){const r=n({start:t,end:{...t,_bufferIndex:t._bufferIndex+2}}).codePointAt(0);return r&&r>=65536?r:e}function Xl(e,t,n,r){const a=e.length;let l=0,f;if(t<0?t=-t>a?0:a+t:t=t>a?a:t,n=n>0?n:0,r.length<1e4)f=Array.from(r),f.unshift(t,n),e.splice(...f);else for(n&&e.splice(t,n);l<r.length;)f=r.slice(l,l+1e4),f.unshift(t,0),e.splice(...f),l+=1e4,t+=1e4}function Zl(e,t){return e.length>0?(Xl(e,e.length,0,t),e):t}function Vx(e,t,n){const r=[];let a=-1;for(;++a<e.length;){const l=e[a].resolveAll;l&&!r.includes(l)&&(t=l(t,n),r.push(l))}return t}var LR={name:"attention",resolveAll:yAe,tokenize:vAe};function yAe(e,t){let n=-1,r,a,l,f,i,y,x,S;for(;++n<e.length;)if(e[n][0]==="enter"&&e[n][1].type==="attentionSequence"&&e[n][1]._close){for(r=n;r--;)if(e[r][0]==="exit"&&e[r][1].type==="attentionSequence"&&e[r][1]._open&&t.sliceSerialize(e[r][1]).charCodeAt(0)===t.sliceSerialize(e[n][1]).charCodeAt(0)){if((e[r][1]._close||e[n][1]._open)&&(e[n][1].end.offset-e[n][1].start.offset)%3&&!((e[r][1].end.offset-e[r][1].start.offset+e[n][1].end.offset-e[n][1].start.offset)%3))continue;y=e[r][1].end.offset-e[r][1].start.offset>1&&e[n][1].end.offset-e[n][1].start.offset>1?2:1;const C={...e[r][1].end},P={...e[n][1].start};mH(C,-y),mH(P,y),f={type:y>1?Jh.strongSequence:Jh.emphasisSequence,start:C,end:{...e[r][1].end}},i={type:y>1?Jh.strongSequence:Jh.emphasisSequence,start:{...e[n][1].start},end:P},l={type:y>1?Jh.strongText:Jh.emphasisText,start:{...e[r][1].end},end:{...e[n][1].start}},a={type:y>1?Jh.strong:Jh.emphasis,start:{...f.start},end:{...i.end}},e[r][1].end={...f.start},e[n][1].start={...i.end},x=[],e[r][1].end.offset-e[r][1].start.offset&&(x=Zl(x,[["enter",e[r][1],t],["exit",e[r][1],t]])),x=Zl(x,[["enter",a,t],["enter",f,t],["exit",f,t],["enter",l,t]]),t.parser.constructs.insideSpan.null,x=Zl(x,Vx(t.parser.constructs.insideSpan.null,e.slice(r+1,n),t)),x=Zl(x,[["exit",l,t],["enter",i,t],["exit",i,t],["exit",a,t]]),e[n][1].end.offset-e[n][1].start.offset?(S=2,x=Zl(x,[["enter",e[n][1],t],["exit",e[n][1],t]])):S=0,Xl(e,r-1,n-r+3,x),n=r+x.length-S-2;break}}for(n=-1;++n<e.length;)e[n][1].type==="attentionSequence"&&(e[n][1].type="data");return e}function vAe(e,t){const n=this.parser.constructs.attentionMarkers.null,{now:r,sliceSerialize:a,previous:l}=this,f=Cte(l)?kte(l,r(),a):l,i=kv(f),y=new Ite(f,r(),a),x=Ste(i,y.value.bind(y),f);let S;return C;function C(L){return S=L,e.enter("attentionSequence"),P(L)}function P(L){if(L===S)return e.consume(L),P;const F=e.exit("attentionSequence"),U=Ate(L)?Rte(L,r(),a):L,q=kv(U),G=HC(x),$=G||IT(x),X=HC(q),ie=X||IT(q),de=mAe(x),fe=!ie||X&&($||de)||n.includes(L),be=!$||G&&(ie||o8(q))||n.includes(f);return F._open=!!(S===_p.asterisk?fe:fe&&(pH(x)||!be)),F._close=!!(S===_p.asterisk?be:be&&(pH(q)||!fe)),t(L)}}function mH(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}function xAe(){return{text:{[_p.asterisk]:LR,[_p.underscore]:LR},insideSpan:{null:[LR]}}}function bAe(){const e=this.data();(e.micromarkExtensions||(e.micromarkExtensions=[])).push(xAe())}function wAe(e){let n=(e||{}).singleTilde;const r={name:"strikethrough",tokenize:l,resolveAll:a};return n==null&&(n=!0),{text:{[_p.tilde]:r},insideSpan:{null:[r]},attentionMarkers:{null:[_p.tilde]}};function a(f,i){let y=-1;for(;++y<f.length;)if(f[y][0]==="enter"&&f[y][1].type==="strikethroughSequenceTemporary"&&f[y][1]._close){let x=y;for(;x--;)if(f[x][0]==="exit"&&f[x][1].type==="strikethroughSequenceTemporary"&&f[x][1]._open&&f[y][1].end.offset-f[y][1].start.offset===f[x][1].end.offset-f[x][1].start.offset){f[y][1].type="strikethroughSequence",f[x][1].type="strikethroughSequence";const S={type:"strikethrough",start:Object.assign({},f[x][1].start),end:Object.assign({},f[y][1].end)},C={type:"strikethroughText",start:Object.assign({},f[x][1].end),end:Object.assign({},f[y][1].start)},P=[["enter",S,i],["enter",f[x][1],i],["exit",f[x][1],i],["enter",C,i]],L=i.parser.constructs.insideSpan.null;L&&Xl(P,P.length,0,Vx(L,f.slice(x+1,y),i)),Xl(P,P.length,0,[["exit",C,i],["enter",f[y][1],i],["exit",f[y][1],i],["exit",S,i]]),Xl(f,x-1,y-x+3,P),y=x+P.length-2;break}}for(y=-1;++y<f.length;)f[y][1].type==="strikethroughSequenceTemporary"&&(f[y][1].type=Jh.data);return f}function l(f,i,y){const{now:x,sliceSerialize:S,previous:C}=this,P=Cte(C)?kte(C,x(),S):C,L=kv(P),F=new Ite(P,x(),S),U=Ste(L,F.value.bind(F),P),q=this.events;let G=0;return $;function $(ie){return P===_p.tilde&&q[q.length-1][1].type!==Jh.characterEscape?y(ie):(f.enter("strikethroughSequenceTemporary"),X(ie))}function X(ie){const de=kv(P);if(ie===_p.tilde)return G>1?y(ie):(f.consume(ie),G++,X);if(G<2&&!n)return y(ie);const fe=f.exit("strikethroughSequenceTemporary"),be=Ate(ie)?Rte(ie,x(),S):ie,ve=kv(be),we=HC(U)||IT(U),He=HC(ve)||IT(ve),ft=o8(U)||pAe(de);return fe._open=!He||ve===fx.attentionSideAfter&&(we||ft),fe._close=!we||de===fx.attentionSideAfter&&(He||o8(ve)),i(ie)}}}function TAe(e){const t=this.data();(t.micromarkExtensions||(t.micromarkExtensions=[])).push(wAe(e))}function gH(e,t){const n=String(e);if(typeof t!="string")throw new TypeError("Expected character");let r=0,a=n.indexOf(t);for(;a!==-1;)r++,a=n.indexOf(t,a+t.length);return r}function EAe(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function SAe(e,t,n){const a=iE((n||{}).ignore||[]),l=AAe(t);let f=-1;for(;++f<l.length;)Ox(e,"text",i);function i(x,S){let C=-1,P;for(;++C<S.length;){const L=S[C],F=P?P.children:void 0;if(a(L,F?F.indexOf(L):void 0,P))return;P=L}if(P)return y(x,S)}function y(x,S){const C=S[S.length-1],P=l[f][0],L=l[f][1];let F=0;const q=C.children.indexOf(x);let G=!1,$=[];P.lastIndex=0;let X=P.exec(x.value);for(;X;){const ie=X.index,de={index:X.index,input:X.input,stack:[...S,x]};let fe=L(...X,de);if(typeof fe=="string"&&(fe=fe.length>0?{type:"text",value:fe}:void 0),fe===!1?P.lastIndex=ie+1:(F!==ie&&$.push({type:"text",value:x.value.slice(F,ie)}),Array.isArray(fe)?$.push(...fe):fe&&$.push(fe),F=ie+X[0].length,G=!0),!P.global)break;X=P.exec(x.value)}return G?(F<x.value.length&&$.push({type:"text",value:x.value.slice(F)}),C.children.splice(q,1,...$)):$=[x],q+$.length}}function AAe(e){const t=[];if(!Array.isArray(e))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!e[0]||Array.isArray(e[0])?e:[e];let r=-1;for(;++r<n.length;){const a=n[r];t.push([CAe(a[0]),kAe(a[1])])}return t}function CAe(e){return typeof e=="string"?new RegExp(EAe(e),"g"):e}function kAe(e){return typeof e=="function"?e:function(){return e}}const DR="phrasing",NR=["autolink","link","image","label"];function IAe(){return{transforms:[NAe],enter:{literalAutolink:MAe,literalAutolinkEmail:zR,literalAutolinkHttp:zR,literalAutolinkWww:zR},exit:{literalAutolink:DAe,literalAutolinkEmail:LAe,literalAutolinkHttp:PAe,literalAutolinkWww:OAe}}}function RAe(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:DR,notInConstruct:NR},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:DR,notInConstruct:NR},{character:":",before:"[ps]",after:"\\/",inConstruct:DR,notInConstruct:NR}]}}function MAe(e){this.enter({type:"link",title:null,url:"",children:[]},e)}function zR(e){this.config.enter.autolinkProtocol.call(this,e)}function PAe(e){this.config.exit.autolinkProtocol.call(this,e)}function OAe(e){this.config.exit.data.call(this,e);const t=this.stack[this.stack.length-1];t.type,t.url="http://"+this.sliceSerialize(e)}function LAe(e){this.config.exit.autolinkEmail.call(this,e)}function DAe(e){this.exit(e)}function NAe(e){SAe(e,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,zAe],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),FAe]],{ignore:["link","linkReference"]})}function zAe(e,t,n,r,a){let l="";if(!Mte(a)||(/^w/i.test(t)&&(n=t+n,t="",l="http://"),!BAe(n)))return!1;const f=jAe(n+r);if(!f[0])return!1;const i={type:"link",title:null,url:l+t+f[0],children:[{type:"text",value:t+f[0]}]};return f[1]?[i,{type:"text",value:f[1]}]:i}function FAe(e,t,n,r){return!Mte(r,!0)||/[-\d_]$/.test(n)?!1:{type:"link",title:null,url:"mailto:"+t+"@"+n,children:[{type:"text",value:t+"@"+n}]}}function BAe(e){const t=e.split(".");return!(t.length<2||t[t.length-1]&&(/_/.test(t[t.length-1])||!/[a-zA-Z\d]/.test(t[t.length-1]))||t[t.length-2]&&(/_/.test(t[t.length-2])||!/[a-zA-Z\d]/.test(t[t.length-2])))}function jAe(e){const t=/[!"&'),.:;<>?\]}]+$/.exec(e);if(!t)return[e,void 0];e=e.slice(0,t.index);let n=t[0],r=n.indexOf(")");const a=gH(e,"(");let l=gH(e,")");for(;r!==-1&&a>l;)e+=n.slice(0,r+1),n=n.slice(r+1),r=n.indexOf(")"),l++;return[e,n]}function Mte(e,t){const n=e.input.charCodeAt(e.index-1);return(e.index===0||O_(n)||Jk(n))&&(!t||n!==47)}function mh(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}Pte.peek=XAe;function UAe(){this.buffer()}function VAe(e){this.enter({type:"footnoteReference",identifier:"",label:""},e)}function $Ae(){this.buffer()}function HAe(e){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},e)}function GAe(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=mh(this.sliceSerialize(e)).toLowerCase(),n.label=t}function qAe(e){this.exit(e)}function ZAe(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=mh(this.sliceSerialize(e)).toLowerCase(),n.label=t}function WAe(e){this.exit(e)}function XAe(){return"["}function Pte(e,t,n,r){const a=n.createTracker(r);let l=a.move("[^");const f=n.enter("footnoteReference"),i=n.enter("reference");return l+=a.move(n.safe(n.associationId(e),{after:"]",before:l})),i(),f(),l+=a.move("]"),l}function YAe(){return{enter:{gfmFootnoteCallString:UAe,gfmFootnoteCall:VAe,gfmFootnoteDefinitionLabelString:$Ae,gfmFootnoteDefinition:HAe},exit:{gfmFootnoteCallString:GAe,gfmFootnoteCall:qAe,gfmFootnoteDefinitionLabelString:ZAe,gfmFootnoteDefinition:WAe}}}function KAe(e){let t=!1;return e&&e.firstLineBlank&&(t=!0),{handlers:{footnoteDefinition:n,footnoteReference:Pte},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function n(r,a,l,f){const i=l.createTracker(f);let y=i.move("[^");const x=l.enter("footnoteDefinition"),S=l.enter("label");return y+=i.move(l.safe(l.associationId(r),{before:y,after:"]"})),S(),y+=i.move("]:"),r.children&&r.children.length>0&&(i.shift(4),y+=i.move((t?`
`:" ")+l.indentLines(l.containerFlow(r,i.current()),t?Ote:QAe))),x(),y}}function QAe(e,t,n){return t===0?e:Ote(e,t,n)}function Ote(e,t,n){return(n?"":"    ")+e}const JAe=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];Lte.peek=iCe;function eCe(){return{canContainEols:["delete"],enter:{strikethrough:nCe},exit:{strikethrough:rCe}}}function tCe(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:JAe}],handlers:{delete:Lte}}}function nCe(e){this.enter({type:"delete",children:[]},e)}function rCe(e){this.exit(e)}function Lte(e,t,n,r){const a=n.createTracker(r),l=n.enter("strikethrough");let f=a.move("~~");return f+=n.containerPhrasing(e,{...a.current(),before:f,after:"~"}),f+=a.move("~~"),l(),f}function iCe(){return"~"}function sCe(e){return e.length}function aCe(e,t){const n=t||{},r=(n.align||[]).concat(),a=n.stringLength||sCe,l=[],f=[],i=[],y=[];let x=0,S=-1;for(;++S<e.length;){const U=[],q=[];let G=-1;for(e[S].length>x&&(x=e[S].length);++G<e[S].length;){const $=oCe(e[S][G]);if(n.alignDelimiters!==!1){const X=a($);q[G]=X,(y[G]===void 0||X>y[G])&&(y[G]=X)}U.push($)}f[S]=U,i[S]=q}let C=-1;if(typeof r=="object"&&"length"in r)for(;++C<x;)l[C]=_H(r[C]);else{const U=_H(r);for(;++C<x;)l[C]=U}C=-1;const P=[],L=[];for(;++C<x;){const U=l[C];let q="",G="";U===99?(q=":",G=":"):U===108?q=":":U===114&&(G=":");let $=n.alignDelimiters===!1?1:Math.max(1,y[C]-q.length-G.length);const X=q+"-".repeat($)+G;n.alignDelimiters!==!1&&($=q.length+$+G.length,$>y[C]&&(y[C]=$),L[C]=$),P[C]=X}f.splice(1,0,P),i.splice(1,0,L),S=-1;const F=[];for(;++S<f.length;){const U=f[S],q=i[S];C=-1;const G=[];for(;++C<x;){const $=U[C]||"";let X="",ie="";if(n.alignDelimiters!==!1){const de=y[C]-(q[C]||0),fe=l[C];fe===114?X=" ".repeat(de):fe===99?de%2?(X=" ".repeat(de/2+.5),ie=" ".repeat(de/2-.5)):(X=" ".repeat(de/2),ie=X):ie=" ".repeat(de)}n.delimiterStart!==!1&&!C&&G.push("|"),n.padding!==!1&&!(n.alignDelimiters===!1&&$==="")&&(n.delimiterStart!==!1||C)&&G.push(" "),n.alignDelimiters!==!1&&G.push(X),G.push($),n.alignDelimiters!==!1&&G.push(ie),n.padding!==!1&&G.push(" "),(n.delimiterEnd!==!1||C!==x-1)&&G.push("|")}F.push(n.delimiterEnd===!1?G.join("").replace(/ +$/,""):G.join(""))}return F.join(`
`)}function oCe(e){return e==null?"":String(e)}function _H(e){const t=typeof e=="string"?e.codePointAt(0):0;return t===67||t===99?99:t===76||t===108?108:t===82||t===114?114:0}function lCe(e,t,n,r){const a=n.enter("blockquote"),l=n.createTracker(r);l.move("> "),l.shift(2);const f=n.indentLines(n.containerFlow(e,l.current()),uCe);return a(),f}function uCe(e,t,n){return">"+(n?"":" ")+e}function cCe(e,t){return yH(e,t.inConstruct,!0)&&!yH(e,t.notInConstruct,!1)}function yH(e,t,n){if(typeof t=="string"&&(t=[t]),!t||t.length===0)return n;let r=-1;for(;++r<t.length;)if(e.includes(t[r]))return!0;return!1}function vH(e,t,n,r){let a=-1;for(;++a<n.unsafe.length;)if(n.unsafe[a].character===`
`&&cCe(n.stack,n.unsafe[a]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}function Dte(e,t){const n=String(e);let r=n.indexOf(t),a=r,l=0,f=0;if(typeof t!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===a?++l>f&&(f=l):l=1,a=r+t.length,r=n.indexOf(t,a);return f}function dCe(e,t){return!!(t.options.fences===!1&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}function hCe(e){const t=e.options.fence||"`";if(t!=="`"&&t!=="~")throw new Error("Cannot serialize code with `"+t+"` for `options.fence`, expected `` ` `` or `~`");return t}function fCe(e,t,n,r){const a=hCe(n),l=e.value||"",f=a==="`"?"GraveAccent":"Tilde";if(dCe(e,n)){const C=n.enter("codeIndented"),P=n.indentLines(l,pCe);return C(),P}const i=n.createTracker(r),y=a.repeat(Math.max(Dte(l,a)+1,3)),x=n.enter("codeFenced");let S=i.move(y);if(e.lang){const C=n.enter(`codeFencedLang${f}`);S+=i.move(n.safe(e.lang,{before:S,after:" ",encode:["`"],...i.current()})),C()}if(e.lang&&e.meta){const C=n.enter(`codeFencedMeta${f}`);S+=i.move(" "),S+=i.move(n.safe(e.meta,{before:S,after:`
`,encode:["`"],...i.current()})),C()}return S+=i.move(`
`),l&&(S+=i.move(l+`
`)),S+=i.move(y),x(),S}function pCe(e,t,n){return(n?"":"    ")+e}function cN(e){const t=e.options.quote||'"';if(t!=='"'&&t!=="'")throw new Error("Cannot serialize title with `"+t+"` for `options.quote`, expected `\"`, or `'`");return t}function mCe(e,t,n,r){const a=cN(n),l=a==='"'?"Quote":"Apostrophe",f=n.enter("definition");let i=n.enter("label");const y=n.createTracker(r);let x=y.move("[");return x+=y.move(n.safe(n.associationId(e),{before:x,after:"]",...y.current()})),x+=y.move("]: "),i(),!e.url||/[\0- \u007F]/.test(e.url)?(i=n.enter("destinationLiteral"),x+=y.move("<"),x+=y.move(n.safe(e.url,{before:x,after:">",...y.current()})),x+=y.move(">")):(i=n.enter("destinationRaw"),x+=y.move(n.safe(e.url,{before:x,after:e.title?" ":`
`,...y.current()}))),i(),e.title&&(i=n.enter(`title${l}`),x+=y.move(" "+a),x+=y.move(n.safe(e.title,{before:x,after:a,...y.current()})),x+=y.move(a),i()),f(),x}function gCe(e){const t=e.options.emphasis||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize emphasis with `"+t+"` for `options.emphasis`, expected `*`, or `_`");return t}function RT(e){return"&#x"+e.toString(16).toUpperCase()+";"}function px(e){if(e===null||Qa(e)||O_(e))return 1;if(Jk(e))return 2}function GC(e,t,n){const r=px(e),a=px(t);return r===void 0?a===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:a===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?a===void 0?{inside:!1,outside:!1}:a===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:a===void 0?{inside:!1,outside:!1}:a===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}Nte.peek=_Ce;function Nte(e,t,n,r){const a=gCe(n),l=n.enter("emphasis"),f=n.createTracker(r),i=f.move(a);let y=f.move(n.containerPhrasing(e,{after:a,before:i,...f.current()}));const x=y.charCodeAt(0),S=GC(r.before.charCodeAt(r.before.length-1),x,a);S.inside&&(y=RT(x)+y.slice(1));const C=y.charCodeAt(y.length-1),P=GC(r.after.charCodeAt(0),C,a);P.inside&&(y=y.slice(0,-1)+RT(C));const L=f.move(a);return l(),n.attentionEncodeSurroundingInfo={after:P.outside,before:S.outside},i+y+L}function _Ce(e,t,n){return n.options.emphasis||"*"}function yCe(e,t,n,r){let a,l,f;typeof t=="function"&&typeof n!="function"?(l=void 0,f=t,a=n):(l=t,f=n,a=r),Ox(e,l,i,a);function i(y,x){const S=x[x.length-1],C=S?S.children.indexOf(y):void 0;return f(y,C,S)}}const vCe={};function dN(e,t){const n=vCe,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,a=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return zte(e,r,a)}function zte(e,t,n){if(xCe(e)){if("value"in e)return e.type==="html"&&!n?"":e.value;if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return xH(e.children,t,n)}return Array.isArray(e)?xH(e,t,n):""}function xH(e,t,n){const r=[];let a=-1;for(;++a<e.length;)r[a]=zte(e[a],t,n);return r.join("")}function xCe(e){return!!(e&&typeof e=="object")}function bCe(e,t){let n=!1;return yCe(e,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return n=!0,OO}),!!((!e.depth||e.depth<3)&&dN(e)&&(t.options.setext||n))}function wCe(e,t,n,r){const a=Math.max(Math.min(6,e.depth||1),1),l=n.createTracker(r);if(bCe(e,n)){const S=n.enter("headingSetext"),C=n.enter("phrasing"),P=n.containerPhrasing(e,{...l.current(),before:`
`,after:`
`});return C(),S(),P+`
`+(a===1?"=":"-").repeat(P.length-(Math.max(P.lastIndexOf("\r"),P.lastIndexOf(`
`))+1))}const f="#".repeat(a),i=n.enter("headingAtx"),y=n.enter("phrasing");l.move(f+" ");let x=n.containerPhrasing(e,{before:"# ",after:`
`,...l.current()});return/^[\t ]/.test(x)&&(x=RT(x.charCodeAt(0))+x.slice(1)),x=x?f+" "+x:f,n.options.closeAtx&&(x+=" "+f),y(),i(),x}Fte.peek=TCe;function Fte(e){return e.value||""}function TCe(){return"<"}Bte.peek=ECe;function Bte(e,t,n,r){const a=cN(n),l=a==='"'?"Quote":"Apostrophe",f=n.enter("image");let i=n.enter("label");const y=n.createTracker(r);let x=y.move("![");return x+=y.move(n.safe(e.alt,{before:x,after:"]",...y.current()})),x+=y.move("]("),i(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(i=n.enter("destinationLiteral"),x+=y.move("<"),x+=y.move(n.safe(e.url,{before:x,after:">",...y.current()})),x+=y.move(">")):(i=n.enter("destinationRaw"),x+=y.move(n.safe(e.url,{before:x,after:e.title?" ":")",...y.current()}))),i(),e.title&&(i=n.enter(`title${l}`),x+=y.move(" "+a),x+=y.move(n.safe(e.title,{before:x,after:a,...y.current()})),x+=y.move(a),i()),x+=y.move(")"),f(),x}function ECe(){return"!"}jte.peek=SCe;function jte(e,t,n,r){const a=e.referenceType,l=n.enter("imageReference");let f=n.enter("label");const i=n.createTracker(r);let y=i.move("![");const x=n.safe(e.alt,{before:y,after:"]",...i.current()});y+=i.move(x+"]["),f();const S=n.stack;n.stack=[],f=n.enter("reference");const C=n.safe(n.associationId(e),{before:y,after:"]",...i.current()});return f(),n.stack=S,l(),a==="full"||!x||x!==C?y+=i.move(C+"]"):a==="shortcut"?y=y.slice(0,-1):y+=i.move("]"),y}function SCe(){return"!"}Ute.peek=ACe;function Ute(e,t,n){let r=e.value||"",a="`",l=-1;for(;new RegExp("(^|[^`])"+a+"([^`]|$)").test(r);)a+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++l<n.unsafe.length;){const f=n.unsafe[l],i=n.compilePattern(f);let y;if(f.atBreak)for(;y=i.exec(r);){let x=y.index;r.charCodeAt(x)===10&&r.charCodeAt(x-1)===13&&x--,r=r.slice(0,x)+" "+r.slice(y.index+1)}}return a+r+a}function ACe(){return"`"}function Vte(e,t){const n=dN(e);return!!(!t.options.resourceLink&&e.url&&!e.title&&e.children&&e.children.length===1&&e.children[0].type==="text"&&(n===e.url||"mailto:"+n===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}$te.peek=CCe;function $te(e,t,n,r){const a=cN(n),l=a==='"'?"Quote":"Apostrophe",f=n.createTracker(r);let i,y;if(Vte(e,n)){const S=n.stack;n.stack=[],i=n.enter("autolink");let C=f.move("<");return C+=f.move(n.containerPhrasing(e,{before:C,after:">",...f.current()})),C+=f.move(">"),i(),n.stack=S,C}i=n.enter("link"),y=n.enter("label");let x=f.move("[");return x+=f.move(n.containerPhrasing(e,{before:x,after:"](",...f.current()})),x+=f.move("]("),y(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(y=n.enter("destinationLiteral"),x+=f.move("<"),x+=f.move(n.safe(e.url,{before:x,after:">",...f.current()})),x+=f.move(">")):(y=n.enter("destinationRaw"),x+=f.move(n.safe(e.url,{before:x,after:e.title?" ":")",...f.current()}))),y(),e.title&&(y=n.enter(`title${l}`),x+=f.move(" "+a),x+=f.move(n.safe(e.title,{before:x,after:a,...f.current()})),x+=f.move(a),y()),x+=f.move(")"),i(),x}function CCe(e,t,n){return Vte(e,n)?"<":"["}Hte.peek=kCe;function Hte(e,t,n,r){const a=e.referenceType,l=n.enter("linkReference");let f=n.enter("label");const i=n.createTracker(r);let y=i.move("[");const x=n.containerPhrasing(e,{before:y,after:"]",...i.current()});y+=i.move(x+"]["),f();const S=n.stack;n.stack=[],f=n.enter("reference");const C=n.safe(n.associationId(e),{before:y,after:"]",...i.current()});return f(),n.stack=S,l(),a==="full"||!x||x!==C?y+=i.move(C+"]"):a==="shortcut"?y=y.slice(0,-1):y+=i.move("]"),y}function kCe(){return"["}function hN(e){const t=e.options.bullet||"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bullet`, expected `*`, `+`, or `-`");return t}function ICe(e){const t=hN(e),n=e.options.bulletOther;if(!n)return t==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===t)throw new Error("Expected `bullet` (`"+t+"`) and `bulletOther` (`"+n+"`) to be different");return n}function RCe(e){const t=e.options.bulletOrdered||".";if(t!=="."&&t!==")")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOrdered`, expected `.` or `)`");return t}function Gte(e){const t=e.options.rule||"*";if(t!=="*"&&t!=="-"&&t!=="_")throw new Error("Cannot serialize rules with `"+t+"` for `options.rule`, expected `*`, `-`, or `_`");return t}function MCe(e,t,n,r){const a=n.enter("list"),l=n.bulletCurrent;let f=e.ordered?RCe(n):hN(n);const i=e.ordered?f==="."?")":".":ICe(n);let y=t&&n.bulletLastUsed?f===n.bulletLastUsed:!1;if(!e.ordered){const S=e.children?e.children[0]:void 0;if((f==="*"||f==="-")&&S&&(!S.children||!S.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(y=!0),Gte(n)===f&&S){let C=-1;for(;++C<e.children.length;){const P=e.children[C];if(P&&P.type==="listItem"&&P.children&&P.children[0]&&P.children[0].type==="thematicBreak"){y=!0;break}}}}y&&(f=i),n.bulletCurrent=f;const x=n.containerFlow(e,r);return n.bulletLastUsed=f,n.bulletCurrent=l,a(),x}function PCe(e){const t=e.options.listItemIndent||"one";if(t!=="tab"&&t!=="one"&&t!=="mixed")throw new Error("Cannot serialize items with `"+t+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return t}function OCe(e,t,n,r){const a=PCe(n);let l=n.bulletCurrent||hN(n);t&&t.type==="list"&&t.ordered&&(l=(typeof t.start=="number"&&t.start>-1?t.start:1)+(n.options.incrementListMarker===!1?0:t.children.indexOf(e))+l);let f=l.length+1;(a==="tab"||a==="mixed"&&(t&&t.type==="list"&&t.spread||e.spread))&&(f=Math.ceil(f/4)*4);const i=n.createTracker(r);i.move(l+" ".repeat(f-l.length)),i.shift(f);const y=n.enter("listItem"),x=n.indentLines(n.containerFlow(e,i.current()),S);return y(),x;function S(C,P,L){return P?(L?"":" ".repeat(f))+C:(L?l:l+" ".repeat(f-l.length))+C}}function LCe(e,t,n,r){const a=n.enter("paragraph"),l=n.enter("phrasing"),f=n.containerPhrasing(e,r);return l(),a(),f}const DCe=iE(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function NCe(e,t,n,r){return(e.children.some(function(f){return DCe(f)})?n.containerPhrasing:n.containerFlow).call(n,e,r)}function zCe(e){const t=e.options.strong||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize strong with `"+t+"` for `options.strong`, expected `*`, or `_`");return t}qte.peek=FCe;function qte(e,t,n,r){const a=zCe(n),l=n.enter("strong"),f=n.createTracker(r),i=f.move(a+a);let y=f.move(n.containerPhrasing(e,{after:a,before:i,...f.current()}));const x=y.charCodeAt(0),S=GC(r.before.charCodeAt(r.before.length-1),x,a);S.inside&&(y=RT(x)+y.slice(1));const C=y.charCodeAt(y.length-1),P=GC(r.after.charCodeAt(0),C,a);P.inside&&(y=y.slice(0,-1)+RT(C));const L=f.move(a+a);return l(),n.attentionEncodeSurroundingInfo={after:P.outside,before:S.outside},i+y+L}function FCe(e,t,n){return n.options.strong||"*"}function BCe(e,t,n,r){return n.safe(e.value,r)}function jCe(e){const t=e.options.ruleRepetition||3;if(t<3)throw new Error("Cannot serialize rules with repetition `"+t+"` for `options.ruleRepetition`, expected `3` or more");return t}function UCe(e,t,n){const r=(Gte(n)+(n.options.ruleSpaces?" ":"")).repeat(jCe(n));return n.options.ruleSpaces?r.slice(0,-1):r}const Zte={blockquote:lCe,break:vH,code:fCe,definition:mCe,emphasis:Nte,hardBreak:vH,heading:wCe,html:Fte,image:Bte,imageReference:jte,inlineCode:Ute,link:$te,linkReference:Hte,list:MCe,listItem:OCe,paragraph:LCe,root:NCe,strong:qte,text:BCe,thematicBreak:UCe};function Wte(e,t){const n=Number.parseInt(e,t);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}const VCe=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function $Ce(e){return e.replace(VCe,HCe)}function HCe(e,t,n){if(t)return t;if(n.charCodeAt(0)===35){const a=n.charCodeAt(1),l=a===120||a===88;return Wte(n.slice(l?2:1),l?16:10)}return GL(n)||e}function GCe(){return{enter:{table:qCe,tableData:bH,tableHeader:bH,tableRow:WCe},exit:{codeText:XCe,table:ZCe,tableData:FR,tableHeader:FR,tableRow:FR}}}function qCe(e){const t=e._align;this.enter({type:"table",align:t.map(function(n){return n==="none"?null:n}),children:[]},e),this.data.inTable=!0}function ZCe(e){this.exit(e),this.data.inTable=void 0}function WCe(e){this.enter({type:"tableRow",children:[]},e)}function FR(e){this.exit(e)}function bH(e){this.enter({type:"tableCell",children:[]},e)}function XCe(e){let t=this.resume();this.data.inTable&&(t=t.replace(/\\([\\|])/g,YCe));const n=this.stack[this.stack.length-1];n.type,n.value=t,this.exit(e)}function YCe(e,t){return t==="|"?t:e}function KCe(e){const t=e||{},n=t.tableCellPadding,r=t.tablePipeAlign,a=t.stringLength,l=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:P,table:f,tableCell:y,tableRow:i}};function f(L,F,U,q){return x(S(L,U,q),L.align)}function i(L,F,U,q){const G=C(L,U,q),$=x([G]);return $.slice(0,$.indexOf(`
`))}function y(L,F,U,q){const G=U.enter("tableCell"),$=U.enter("phrasing"),X=U.containerPhrasing(L,{...q,before:l,after:l});return $(),G(),X}function x(L,F){return aCe(L,{align:F,alignDelimiters:r,padding:n,stringLength:a})}function S(L,F,U){const q=L.children;let G=-1;const $=[],X=F.enter("table");for(;++G<q.length;)$[G]=C(q[G],F,U);return X(),$}function C(L,F,U){const q=L.children;let G=-1;const $=[],X=F.enter("tableRow");for(;++G<q.length;)$[G]=y(q[G],L,F,U);return X(),$}function P(L,F,U){let q=Zte.inlineCode(L,F,U);return U.stack.includes("tableCell")&&(q=q.replace(/\|/g,"\\$&")),q}}function QCe(){return{exit:{taskListCheckValueChecked:wH,taskListCheckValueUnchecked:wH,paragraph:eke}}}function JCe(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:tke}}}function wH(e){const t=this.stack[this.stack.length-2];t.type,t.checked=e.type==="taskListCheckValueChecked"}function eke(e){const t=this.stack[this.stack.length-2];if(t&&t.type==="listItem"&&typeof t.checked=="boolean"){const n=this.stack[this.stack.length-1];n.type;const r=n.children[0];if(r&&r.type==="text"){const a=t.children;let l=-1,f;for(;++l<a.length;){const i=a[l];if(i.type==="paragraph"){f=i;break}}f===n&&(r.value=r.value.slice(1),r.value.length===0?n.children.shift():n.position&&r.position&&typeof r.position.start.offset=="number"&&(r.position.start.column++,r.position.start.offset++,n.position.start=Object.assign({},r.position.start)))}}this.exit(e)}function tke(e,t,n,r){const a=e.children[0],l=typeof e.checked=="boolean"&&a&&a.type==="paragraph",f="["+(e.checked?"x":" ")+"] ",i=n.createTracker(r);l&&i.move(f);let y=Zte.listItem(e,t,n,{...r,...i.current()});return l&&(y=y.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,x)),y;function x(S){return S+f}}function nke(){return[IAe(),YAe(),eCe(),GCe(),QCe()]}function rke(e){return{extensions:[RAe(),KAe(e),tCe(),KCe(e),JCe()]}}const TH={}.hasOwnProperty;function Xte(e){const t={};let n=-1;for(;++n<e.length;)ike(t,e[n]);return t}function ike(e,t){let n;for(n in t){const a=(TH.call(e,n)?e[n]:void 0)||(e[n]={}),l=t[n];let f;if(l)for(f in l){TH.call(a,f)||(a[f]=[]);const i=l[f];ske(a[f],Array.isArray(i)?i:i?[i]:[])}}}function ske(e,t){let n=-1;const r=[];for(;++n<t.length;)(t[n].add==="after"?e:r).push(t[n]);Xl(e,0,0,r)}const ake={tokenize:hke,partial:!0},Yte={tokenize:fke,partial:!0},Kte={tokenize:pke,partial:!0},Qte={tokenize:mke,partial:!0},oke={tokenize:gke,partial:!0},Jte={name:"wwwAutolink",tokenize:cke,previous:tne},ene={name:"protocolAutolink",tokenize:dke,previous:nne},jp={name:"emailAutolink",tokenize:uke,previous:rne},Rf={};function lke(){return{text:Rf}}let Vg=48;for(;Vg<123;)Rf[Vg]=jp,Vg++,Vg===58?Vg=65:Vg===91&&(Vg=97);Rf[43]=jp;Rf[45]=jp;Rf[46]=jp;Rf[95]=jp;Rf[72]=[jp,ene];Rf[104]=[jp,ene];Rf[87]=[jp,Jte];Rf[119]=[jp,Jte];function uke(e,t,n){const r=this;let a,l;return f;function f(C){return!l8(C)||!rne.call(r,r.previous)||fN(r.events)?n(C):(e.enter("literalAutolink"),e.enter("literalAutolinkEmail"),i(C))}function i(C){return l8(C)?(e.consume(C),i):C===64?(e.consume(C),y):n(C)}function y(C){return C===46?e.check(oke,S,x)(C):C===45||C===95||cu(C)?(l=!0,e.consume(C),y):S(C)}function x(C){return e.consume(C),a=!0,y}function S(C){return l&&a&&Ru(r.previous)?(e.exit("literalAutolinkEmail"),e.exit("literalAutolink"),t(C)):n(C)}}function cke(e,t,n){const r=this;return a;function a(f){return f!==87&&f!==119||!tne.call(r,r.previous)||fN(r.events)?n(f):(e.enter("literalAutolink"),e.enter("literalAutolinkWww"),e.check(ake,e.attempt(Yte,e.attempt(Kte,l),n),n)(f))}function l(f){return e.exit("literalAutolinkWww"),e.exit("literalAutolink"),t(f)}}function dke(e,t,n){const r=this;let a="",l=!1;return f;function f(C){return(C===72||C===104)&&nne.call(r,r.previous)&&!fN(r.events)?(e.enter("literalAutolink"),e.enter("literalAutolinkHttp"),a+=String.fromCodePoint(C),e.consume(C),i):n(C)}function i(C){if(Ru(C)&&a.length<5)return a+=String.fromCodePoint(C),e.consume(C),i;if(C===58){const P=a.toLowerCase();if(P==="http"||P==="https")return e.consume(C),y}return n(C)}function y(C){return C===47?(e.consume(C),l?x:(l=!0,y)):n(C)}function x(C){return C===null||$C(C)||Qa(C)||O_(C)||Jk(C)?n(C):e.attempt(Yte,e.attempt(Kte,S),n)(C)}function S(C){return e.exit("literalAutolinkHttp"),e.exit("literalAutolink"),t(C)}}function hke(e,t,n){let r=0;return a;function a(f){return(f===87||f===119)&&r<3?(r++,e.consume(f),a):f===46&&r===3?(e.consume(f),l):n(f)}function l(f){return f===null?n(f):t(f)}}function fke(e,t,n){let r,a,l;return f;function f(x){return x===46||x===95?e.check(Qte,y,i)(x):x===null||Qa(x)||O_(x)||x!==45&&Jk(x)?y(x):(l=!0,e.consume(x),f)}function i(x){return x===95?r=!0:(a=r,r=void 0),e.consume(x),f}function y(x){return a||r||!l?n(x):t(x)}}function pke(e,t){let n=0,r=0;return a;function a(f){return f===40?(n++,e.consume(f),a):f===41&&r<n?l(f):f===33||f===34||f===38||f===39||f===41||f===42||f===44||f===46||f===58||f===59||f===60||f===63||f===93||f===95||f===126?e.check(Qte,t,l)(f):f===null||Qa(f)||O_(f)?t(f):(e.consume(f),a)}function l(f){return f===41&&r++,e.consume(f),a}}function mke(e,t,n){return r;function r(i){return i===33||i===34||i===39||i===41||i===42||i===44||i===46||i===58||i===59||i===63||i===95||i===126?(e.consume(i),r):i===38?(e.consume(i),l):i===93?(e.consume(i),a):i===60||i===null||Qa(i)||O_(i)?t(i):n(i)}function a(i){return i===null||i===40||i===91||Qa(i)||O_(i)?t(i):r(i)}function l(i){return Ru(i)?f(i):n(i)}function f(i){return i===59?(e.consume(i),r):Ru(i)?(e.consume(i),f):n(i)}}function gke(e,t,n){return r;function r(l){return e.consume(l),a}function a(l){return cu(l)?n(l):t(l)}}function tne(e){return e===null||e===40||e===42||e===95||e===91||e===93||e===126||Qa(e)}function nne(e){return!Ru(e)}function rne(e){return!(e===47||l8(e))}function l8(e){return e===43||e===45||e===46||e===95||cu(e)}function fN(e){let t=e.length,n=!1;for(;t--;){const r=e[t][1];if((r.type==="labelLink"||r.type==="labelImage")&&!r._balanced){n=!0;break}if(r._gfmAutolinkLiteralWalkedInto){n=!1;break}}return e.length>0&&!n&&(e[e.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}function $x(e){const t=[];let n=-1,r=0,a=0;for(;++n<e.length;){const l=e.charCodeAt(n);let f="";if(l===37&&cu(e.charCodeAt(n+1))&&cu(e.charCodeAt(n+2)))a=2;else if(l<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(l))||(f=String.fromCharCode(l));else if(l>55295&&l<57344){const i=e.charCodeAt(n+1);l<56320&&i>56319&&i<57344?(f=String.fromCharCode(l,i),a=1):f=""}else f=String.fromCharCode(l);f&&(t.push(e.slice(r,n),encodeURIComponent(f)),r=n+a+1,f=""),a&&(n+=a,a=0)}return t.join("")+e.slice(r)}const u8={name:"attention",resolveAll:_ke,tokenize:yke};function _ke(e,t){let n=-1,r,a,l,f,i,y,x,S;for(;++n<e.length;)if(e[n][0]==="enter"&&e[n][1].type==="attentionSequence"&&e[n][1]._close){for(r=n;r--;)if(e[r][0]==="exit"&&e[r][1].type==="attentionSequence"&&e[r][1]._open&&t.sliceSerialize(e[r][1]).charCodeAt(0)===t.sliceSerialize(e[n][1]).charCodeAt(0)){if((e[r][1]._close||e[n][1]._open)&&(e[n][1].end.offset-e[n][1].start.offset)%3&&!((e[r][1].end.offset-e[r][1].start.offset+e[n][1].end.offset-e[n][1].start.offset)%3))continue;y=e[r][1].end.offset-e[r][1].start.offset>1&&e[n][1].end.offset-e[n][1].start.offset>1?2:1;const C={...e[r][1].end},P={...e[n][1].start};EH(C,-y),EH(P,y),f={type:y>1?"strongSequence":"emphasisSequence",start:C,end:{...e[r][1].end}},i={type:y>1?"strongSequence":"emphasisSequence",start:{...e[n][1].start},end:P},l={type:y>1?"strongText":"emphasisText",start:{...e[r][1].end},end:{...e[n][1].start}},a={type:y>1?"strong":"emphasis",start:{...f.start},end:{...i.end}},e[r][1].end={...f.start},e[n][1].start={...i.end},x=[],e[r][1].end.offset-e[r][1].start.offset&&(x=Zl(x,[["enter",e[r][1],t],["exit",e[r][1],t]])),x=Zl(x,[["enter",a,t],["enter",f,t],["exit",f,t],["enter",l,t]]),x=Zl(x,Vx(t.parser.constructs.insideSpan.null,e.slice(r+1,n),t)),x=Zl(x,[["exit",l,t],["enter",i,t],["exit",i,t],["exit",a,t]]),e[n][1].end.offset-e[n][1].start.offset?(S=2,x=Zl(x,[["enter",e[n][1],t],["exit",e[n][1],t]])):S=0,Xl(e,r-1,n-r+3,x),n=r+x.length-S-2;break}}for(n=-1;++n<e.length;)e[n][1].type==="attentionSequence"&&(e[n][1].type="data");return e}function yke(e,t){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,a=px(r);let l;return f;function f(y){return l=y,e.enter("attentionSequence"),i(y)}function i(y){if(y===l)return e.consume(y),i;const x=e.exit("attentionSequence"),S=px(y),C=!S||S===2&&a||n.includes(y),P=!a||a===2&&S||n.includes(r);return x._open=!!(l===42?C:C&&(a||!P)),x._close=!!(l===42?P:P&&(S||!C)),t(y)}}function EH(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}const vke={name:"autolink",tokenize:xke};function xke(e,t,n){let r=0;return a;function a(L){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(L),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),l}function l(L){return Ru(L)?(e.consume(L),f):L===64?n(L):x(L)}function f(L){return L===43||L===45||L===46||cu(L)?(r=1,i(L)):x(L)}function i(L){return L===58?(e.consume(L),r=0,y):(L===43||L===45||L===46||cu(L))&&r++<32?(e.consume(L),i):(r=0,x(L))}function y(L){return L===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(L),e.exit("autolinkMarker"),e.exit("autolink"),t):L===null||L===32||L===60||$C(L)?n(L):(e.consume(L),y)}function x(L){return L===64?(e.consume(L),S):X4e(L)?(e.consume(L),x):n(L)}function S(L){return cu(L)?C(L):n(L)}function C(L){return L===46?(e.consume(L),r=0,S):L===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(L),e.exit("autolinkMarker"),e.exit("autolink"),t):P(L)}function P(L){if((L===45||cu(L))&&r++<63){const F=L===45?P:C;return e.consume(L),F}return n(L)}}function ra(e,t,n,r){const a=r?r-1:Number.POSITIVE_INFINITY;let l=0;return f;function f(y){return la(y)?(e.enter(n),i(y)):t(y)}function i(y){return la(y)&&l++<a?(e.consume(y),i):(e.exit(n),t(y))}}const pE={partial:!0,tokenize:bke};function bke(e,t,n){return r;function r(l){return la(l)?ra(e,a,"linePrefix")(l):a(l)}function a(l){return l===null||Ti(l)?t(l):n(l)}}const ine={continuation:{tokenize:Tke},exit:Eke,name:"blockQuote",tokenize:wke};function wke(e,t,n){const r=this;return a;function a(f){if(f===62){const i=r.containerState;return i.open||(e.enter("blockQuote",{_container:!0}),i.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(f),e.exit("blockQuoteMarker"),l}return n(f)}function l(f){return la(f)?(e.enter("blockQuotePrefixWhitespace"),e.consume(f),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(f))}}function Tke(e,t,n){const r=this;return a;function a(f){return la(f)?ra(e,l,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(f):l(f)}function l(f){return e.attempt(ine,t,n)(f)}}function Eke(e){e.exit("blockQuote")}const sne={name:"characterEscape",tokenize:Ske};function Ske(e,t,n){return r;function r(l){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(l),e.exit("escapeMarker"),a}function a(l){return K4e(l)?(e.enter("characterEscapeValue"),e.consume(l),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):n(l)}}const ane={name:"characterReference",tokenize:Ake};function Ake(e,t,n){const r=this;let a=0,l,f;return i;function i(C){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(C),e.exit("characterReferenceMarker"),y}function y(C){return C===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(C),e.exit("characterReferenceMarkerNumeric"),x):(e.enter("characterReferenceValue"),l=31,f=cu,S(C))}function x(C){return C===88||C===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(C),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),l=6,f=Y4e,S):(e.enter("characterReferenceValue"),l=7,f=a8,S(C))}function S(C){if(C===59&&a){const P=e.exit("characterReferenceValue");return f===cu&&!GL(r.sliceSerialize(P))?n(C):(e.enter("characterReferenceMarker"),e.consume(C),e.exit("characterReferenceMarker"),e.exit("characterReference"),t)}return f(C)&&a++<l?(e.consume(C),S):n(C)}}const SH={partial:!0,tokenize:kke},AH={concrete:!0,name:"codeFenced",tokenize:Cke};function Cke(e,t,n){const r=this,a={partial:!0,tokenize:de};let l=0,f=0,i;return y;function y(fe){return x(fe)}function x(fe){const be=r.events[r.events.length-1];return l=be&&be[1].type==="linePrefix"?be[2].sliceSerialize(be[1],!0).length:0,i=fe,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),S(fe)}function S(fe){return fe===i?(f++,e.consume(fe),S):f<3?n(fe):(e.exit("codeFencedFenceSequence"),la(fe)?ra(e,C,"whitespace")(fe):C(fe))}function C(fe){return fe===null||Ti(fe)?(e.exit("codeFencedFence"),r.interrupt?t(fe):e.check(SH,U,ie)(fe)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),P(fe))}function P(fe){return fe===null||Ti(fe)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),C(fe)):la(fe)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),ra(e,L,"whitespace")(fe)):fe===96&&fe===i?n(fe):(e.consume(fe),P)}function L(fe){return fe===null||Ti(fe)?C(fe):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),F(fe))}function F(fe){return fe===null||Ti(fe)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),C(fe)):fe===96&&fe===i?n(fe):(e.consume(fe),F)}function U(fe){return e.attempt(a,ie,q)(fe)}function q(fe){return e.enter("lineEnding"),e.consume(fe),e.exit("lineEnding"),G}function G(fe){return l>0&&la(fe)?ra(e,$,"linePrefix",l+1)(fe):$(fe)}function $(fe){return fe===null||Ti(fe)?e.check(SH,U,ie)(fe):(e.enter("codeFlowValue"),X(fe))}function X(fe){return fe===null||Ti(fe)?(e.exit("codeFlowValue"),$(fe)):(e.consume(fe),X)}function ie(fe){return e.exit("codeFenced"),t(fe)}function de(fe,be,ve){let Je=0;return we;function we(Nt){return fe.enter("lineEnding"),fe.consume(Nt),fe.exit("lineEnding"),rt}function rt(Nt){return fe.enter("codeFencedFence"),la(Nt)?ra(fe,He,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(Nt):He(Nt)}function He(Nt){return Nt===i?(fe.enter("codeFencedFenceSequence"),ft(Nt)):ve(Nt)}function ft(Nt){return Nt===i?(Je++,fe.consume(Nt),ft):Je>=f?(fe.exit("codeFencedFenceSequence"),la(Nt)?ra(fe,Ct,"whitespace")(Nt):Ct(Nt)):ve(Nt)}function Ct(Nt){return Nt===null||Ti(Nt)?(fe.exit("codeFencedFence"),be(Nt)):ve(Nt)}}}function kke(e,t,n){const r=this;return a;function a(f){return f===null?n(f):(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),l)}function l(f){return r.parser.lazy[r.now().line]?n(f):t(f)}}const BR={name:"codeIndented",tokenize:Rke},Ike={partial:!0,tokenize:Mke};function Rke(e,t,n){const r=this;return a;function a(x){return e.enter("codeIndented"),ra(e,l,"linePrefix",5)(x)}function l(x){const S=r.events[r.events.length-1];return S&&S[1].type==="linePrefix"&&S[2].sliceSerialize(S[1],!0).length>=4?f(x):n(x)}function f(x){return x===null?y(x):Ti(x)?e.attempt(Ike,f,y)(x):(e.enter("codeFlowValue"),i(x))}function i(x){return x===null||Ti(x)?(e.exit("codeFlowValue"),f(x)):(e.consume(x),i)}function y(x){return e.exit("codeIndented"),t(x)}}function Mke(e,t,n){const r=this;return a;function a(f){return r.parser.lazy[r.now().line]?n(f):Ti(f)?(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),a):ra(e,l,"linePrefix",5)(f)}function l(f){const i=r.events[r.events.length-1];return i&&i[1].type==="linePrefix"&&i[2].sliceSerialize(i[1],!0).length>=4?t(f):Ti(f)?a(f):n(f)}}const Pke={name:"codeText",previous:Lke,resolve:Oke,tokenize:Dke};function Oke(e){let t=e.length-4,n=3,r,a;if((e[n][1].type==="lineEnding"||e[n][1].type==="space")&&(e[t][1].type==="lineEnding"||e[t][1].type==="space")){for(r=n;++r<t;)if(e[r][1].type==="codeTextData"){e[n][1].type="codeTextPadding",e[t][1].type="codeTextPadding",n+=2,t-=2;break}}for(r=n-1,t++;++r<=t;)a===void 0?r!==t&&e[r][1].type!=="lineEnding"&&(a=r):(r===t||e[r][1].type==="lineEnding")&&(e[a][1].type="codeTextData",r!==a+2&&(e[a][1].end=e[r-1][1].end,e.splice(a+2,r-a-2),t-=r-a-2,r=a+2),a=void 0);return e}function Lke(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function Dke(e,t,n){let r=0,a,l;return f;function f(C){return e.enter("codeText"),e.enter("codeTextSequence"),i(C)}function i(C){return C===96?(e.consume(C),r++,i):(e.exit("codeTextSequence"),y(C))}function y(C){return C===null?n(C):C===32?(e.enter("space"),e.consume(C),e.exit("space"),y):C===96?(l=e.enter("codeTextSequence"),a=0,S(C)):Ti(C)?(e.enter("lineEnding"),e.consume(C),e.exit("lineEnding"),y):(e.enter("codeTextData"),x(C))}function x(C){return C===null||C===32||C===96||Ti(C)?(e.exit("codeTextData"),y(C)):(e.consume(C),x)}function S(C){return C===96?(e.consume(C),a++,S):a===r?(e.exit("codeTextSequence"),e.exit("codeText"),t(C)):(l.type="codeTextData",x(C))}}class Nke{constructor(t){this.left=t?[...t]:[],this.right=[]}get(t){if(t<0||t>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+t+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return t<this.left.length?this.left[t]:this.right[this.right.length-t+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(t,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(t,r):t>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-t+this.left.length).reverse():this.left.slice(t).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(t,n,r){const a=n||0;this.setCursor(Math.trunc(t));const l=this.right.splice(this.right.length-a,Number.POSITIVE_INFINITY);return r&&Jw(this.left,r),l.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(t){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(t)}pushMany(t){this.setCursor(Number.POSITIVE_INFINITY),Jw(this.left,t)}unshift(t){this.setCursor(0),this.right.push(t)}unshiftMany(t){this.setCursor(0),Jw(this.right,t.reverse())}setCursor(t){if(!(t===this.left.length||t>this.left.length&&this.right.length===0||t<0&&this.left.length===0))if(t<this.left.length){const n=this.left.splice(t,Number.POSITIVE_INFINITY);Jw(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-t,Number.POSITIVE_INFINITY);Jw(this.left,n.reverse())}}}function Jw(e,t){let n=0;if(t.length<1e4)e.push(...t);else for(;n<t.length;)e.push(...t.slice(n,n+1e4)),n+=1e4}function one(e){const t={};let n=-1,r,a,l,f,i,y,x;const S=new Nke(e);for(;++n<S.length;){for(;n in t;)n=t[n];if(r=S.get(n),n&&r[1].type==="chunkFlow"&&S.get(n-1)[1].type==="listItemPrefix"&&(y=r[1]._tokenizer.events,l=0,l<y.length&&y[l][1].type==="lineEndingBlank"&&(l+=2),l<y.length&&y[l][1].type==="content"))for(;++l<y.length&&y[l][1].type!=="content";)y[l][1].type==="chunkText"&&(y[l][1]._isInFirstContentOfListItem=!0,l++);if(r[0]==="enter")r[1].contentType&&(Object.assign(t,zke(S,n)),n=t[n],x=!0);else if(r[1]._container){for(l=n,a=void 0;l--;)if(f=S.get(l),f[1].type==="lineEnding"||f[1].type==="lineEndingBlank")f[0]==="enter"&&(a&&(S.get(a)[1].type="lineEndingBlank"),f[1].type="lineEnding",a=l);else if(!(f[1].type==="linePrefix"||f[1].type==="listItemIndent"))break;a&&(r[1].end={...S.get(a)[1].start},i=S.slice(a,n),i.unshift(r),S.splice(a,n-a+1,i))}}return Xl(e,0,Number.POSITIVE_INFINITY,S.slice(0)),!x}function zke(e,t){const n=e.get(t)[1],r=e.get(t)[2];let a=t-1;const l=[];let f=n._tokenizer;f||(f=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(f._contentTypeTextTrailing=!0));const i=f.events,y=[],x={};let S,C,P=-1,L=n,F=0,U=0;const q=[U];for(;L;){for(;e.get(++a)[1]!==L;);l.push(a),L._tokenizer||(S=r.sliceStream(L),L.next||S.push(null),C&&f.defineSkip(L.start),L._isInFirstContentOfListItem&&(f._gfmTasklistFirstContentOfListItem=!0),f.write(S),L._isInFirstContentOfListItem&&(f._gfmTasklistFirstContentOfListItem=void 0)),C=L,L=L.next}for(L=n;++P<i.length;)i[P][0]==="exit"&&i[P-1][0]==="enter"&&i[P][1].type===i[P-1][1].type&&i[P][1].start.line!==i[P][1].end.line&&(U=P+1,q.push(U),L._tokenizer=void 0,L.previous=void 0,L=L.next);for(f.events=[],L?(L._tokenizer=void 0,L.previous=void 0):q.pop(),P=q.length;P--;){const G=i.slice(q[P],q[P+1]),$=l.pop();y.push([$,$+G.length-1]),e.splice($,2,G)}for(y.reverse(),P=-1;++P<y.length;)x[F+y[P][0]]=F+y[P][1],F+=y[P][1]-y[P][0]-1;return x}const Fke={resolve:jke,tokenize:Uke},Bke={partial:!0,tokenize:Vke};function jke(e){return one(e),e}function Uke(e,t){let n;return r;function r(i){return e.enter("content"),n=e.enter("chunkContent",{contentType:"content"}),a(i)}function a(i){return i===null?l(i):Ti(i)?e.check(Bke,f,l)(i):(e.consume(i),a)}function l(i){return e.exit("chunkContent"),e.exit("content"),t(i)}function f(i){return e.consume(i),e.exit("chunkContent"),n.next=e.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,a}}function Vke(e,t,n){const r=this;return a;function a(f){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),ra(e,l,"linePrefix")}function l(f){if(f===null||Ti(f))return n(f);const i=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&i&&i[1].type==="linePrefix"&&i[2].sliceSerialize(i[1],!0).length>=4?t(f):e.interrupt(r.parser.constructs.flow,n,t)(f)}}function lne(e,t,n,r,a,l,f,i,y){const x=y||Number.POSITIVE_INFINITY;let S=0;return C;function C(G){return G===60?(e.enter(r),e.enter(a),e.enter(l),e.consume(G),e.exit(l),P):G===null||G===32||G===41||$C(G)?n(G):(e.enter(r),e.enter(f),e.enter(i),e.enter("chunkString",{contentType:"string"}),U(G))}function P(G){return G===62?(e.enter(l),e.consume(G),e.exit(l),e.exit(a),e.exit(r),t):(e.enter(i),e.enter("chunkString",{contentType:"string"}),L(G))}function L(G){return G===62?(e.exit("chunkString"),e.exit(i),P(G)):G===null||G===60||Ti(G)?n(G):(e.consume(G),G===92?F:L)}function F(G){return G===60||G===62||G===92?(e.consume(G),L):L(G)}function U(G){return!S&&(G===null||G===41||Qa(G))?(e.exit("chunkString"),e.exit(i),e.exit(f),e.exit(r),t(G)):S<x&&G===40?(e.consume(G),S++,U):G===41?(e.consume(G),S--,U):G===null||G===32||G===40||$C(G)?n(G):(e.consume(G),G===92?q:U)}function q(G){return G===40||G===41||G===92?(e.consume(G),U):U(G)}}function une(e,t,n,r,a,l){const f=this;let i=0,y;return x;function x(L){return e.enter(r),e.enter(a),e.consume(L),e.exit(a),e.enter(l),S}function S(L){return i>999||L===null||L===91||L===93&&!y||L===94&&!i&&"_hiddenFootnoteSupport"in f.parser.constructs?n(L):L===93?(e.exit(l),e.enter(a),e.consume(L),e.exit(a),e.exit(r),t):Ti(L)?(e.enter("lineEnding"),e.consume(L),e.exit("lineEnding"),S):(e.enter("chunkString",{contentType:"string"}),C(L))}function C(L){return L===null||L===91||L===93||Ti(L)||i++>999?(e.exit("chunkString"),S(L)):(e.consume(L),y||(y=!la(L)),L===92?P:C)}function P(L){return L===91||L===92||L===93?(e.consume(L),i++,C):C(L)}}function cne(e,t,n,r,a,l){let f;return i;function i(P){return P===34||P===39||P===40?(e.enter(r),e.enter(a),e.consume(P),e.exit(a),f=P===40?41:P,y):n(P)}function y(P){return P===f?(e.enter(a),e.consume(P),e.exit(a),e.exit(r),t):(e.enter(l),x(P))}function x(P){return P===f?(e.exit(l),y(f)):P===null?n(P):Ti(P)?(e.enter("lineEnding"),e.consume(P),e.exit("lineEnding"),ra(e,x,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),S(P))}function S(P){return P===f||P===null||Ti(P)?(e.exit("chunkString"),x(P)):(e.consume(P),P===92?C:S)}function C(P){return P===f||P===92?(e.consume(P),S):S(P)}}function U2(e,t){let n;return r;function r(a){return Ti(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),n=!0,r):la(a)?ra(e,r,n?"linePrefix":"lineSuffix")(a):t(a)}}const $ke={name:"definition",tokenize:Gke},Hke={partial:!0,tokenize:qke};function Gke(e,t,n){const r=this;let a;return l;function l(L){return e.enter("definition"),f(L)}function f(L){return une.call(r,e,i,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(L)}function i(L){return a=mh(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),L===58?(e.enter("definitionMarker"),e.consume(L),e.exit("definitionMarker"),y):n(L)}function y(L){return Qa(L)?U2(e,x)(L):x(L)}function x(L){return lne(e,S,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(L)}function S(L){return e.attempt(Hke,C,C)(L)}function C(L){return la(L)?ra(e,P,"whitespace")(L):P(L)}function P(L){return L===null||Ti(L)?(e.exit("definition"),r.parser.defined.push(a),t(L)):n(L)}}function qke(e,t,n){return r;function r(i){return Qa(i)?U2(e,a)(i):n(i)}function a(i){return cne(e,l,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(i)}function l(i){return la(i)?ra(e,f,"whitespace")(i):f(i)}function f(i){return i===null||Ti(i)?t(i):n(i)}}const Zke={name:"hardBreakEscape",tokenize:Wke};function Wke(e,t,n){return r;function r(l){return e.enter("hardBreakEscape"),e.consume(l),a}function a(l){return Ti(l)?(e.exit("hardBreakEscape"),t(l)):n(l)}}const Xke={name:"headingAtx",resolve:Yke,tokenize:Kke};function Yke(e,t){let n=e.length-2,r=3,a,l;return e[r][1].type==="whitespace"&&(r+=2),n-2>r&&e[n][1].type==="whitespace"&&(n-=2),e[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&e[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(a={type:"atxHeadingText",start:e[r][1].start,end:e[n][1].end},l={type:"chunkText",start:e[r][1].start,end:e[n][1].end,contentType:"text"},Xl(e,r,n-r+1,[["enter",a,t],["enter",l,t],["exit",l,t],["exit",a,t]])),e}function Kke(e,t,n){let r=0;return a;function a(S){return e.enter("atxHeading"),l(S)}function l(S){return e.enter("atxHeadingSequence"),f(S)}function f(S){return S===35&&r++<6?(e.consume(S),f):S===null||Qa(S)?(e.exit("atxHeadingSequence"),i(S)):n(S)}function i(S){return S===35?(e.enter("atxHeadingSequence"),y(S)):S===null||Ti(S)?(e.exit("atxHeading"),t(S)):la(S)?ra(e,i,"whitespace")(S):(e.enter("atxHeadingText"),x(S))}function y(S){return S===35?(e.consume(S),y):(e.exit("atxHeadingSequence"),i(S))}function x(S){return S===null||S===35||Qa(S)?(e.exit("atxHeadingText"),i(S)):(e.consume(S),x)}}const Qke=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],CH=["pre","script","style","textarea"],Jke={concrete:!0,name:"htmlFlow",resolveTo:nIe,tokenize:rIe},eIe={partial:!0,tokenize:sIe},tIe={partial:!0,tokenize:iIe};function nIe(e){let t=e.length;for(;t--&&!(e[t][0]==="enter"&&e[t][1].type==="htmlFlow"););return t>1&&e[t-2][1].type==="linePrefix"&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2)),e}function rIe(e,t,n){const r=this;let a,l,f,i,y;return x;function x(Fe){return S(Fe)}function S(Fe){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(Fe),C}function C(Fe){return Fe===33?(e.consume(Fe),P):Fe===47?(e.consume(Fe),l=!0,U):Fe===63?(e.consume(Fe),a=3,r.interrupt?t:Oe):Ru(Fe)?(e.consume(Fe),f=String.fromCharCode(Fe),q):n(Fe)}function P(Fe){return Fe===45?(e.consume(Fe),a=2,L):Fe===91?(e.consume(Fe),a=5,i=0,F):Ru(Fe)?(e.consume(Fe),a=4,r.interrupt?t:Oe):n(Fe)}function L(Fe){return Fe===45?(e.consume(Fe),r.interrupt?t:Oe):n(Fe)}function F(Fe){const jt="CDATA[";return Fe===jt.charCodeAt(i++)?(e.consume(Fe),i===jt.length?r.interrupt?t:He:F):n(Fe)}function U(Fe){return Ru(Fe)?(e.consume(Fe),f=String.fromCharCode(Fe),q):n(Fe)}function q(Fe){if(Fe===null||Fe===47||Fe===62||Qa(Fe)){const jt=Fe===47,Tn=f.toLowerCase();return!jt&&!l&&CH.includes(Tn)?(a=1,r.interrupt?t(Fe):He(Fe)):Qke.includes(f.toLowerCase())?(a=6,jt?(e.consume(Fe),G):r.interrupt?t(Fe):He(Fe)):(a=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(Fe):l?$(Fe):X(Fe))}return Fe===45||cu(Fe)?(e.consume(Fe),f+=String.fromCharCode(Fe),q):n(Fe)}function G(Fe){return Fe===62?(e.consume(Fe),r.interrupt?t:He):n(Fe)}function $(Fe){return la(Fe)?(e.consume(Fe),$):we(Fe)}function X(Fe){return Fe===47?(e.consume(Fe),we):Fe===58||Fe===95||Ru(Fe)?(e.consume(Fe),ie):la(Fe)?(e.consume(Fe),X):we(Fe)}function ie(Fe){return Fe===45||Fe===46||Fe===58||Fe===95||cu(Fe)?(e.consume(Fe),ie):de(Fe)}function de(Fe){return Fe===61?(e.consume(Fe),fe):la(Fe)?(e.consume(Fe),de):X(Fe)}function fe(Fe){return Fe===null||Fe===60||Fe===61||Fe===62||Fe===96?n(Fe):Fe===34||Fe===39?(e.consume(Fe),y=Fe,be):la(Fe)?(e.consume(Fe),fe):ve(Fe)}function be(Fe){return Fe===y?(e.consume(Fe),y=null,Je):Fe===null||Ti(Fe)?n(Fe):(e.consume(Fe),be)}function ve(Fe){return Fe===null||Fe===34||Fe===39||Fe===47||Fe===60||Fe===61||Fe===62||Fe===96||Qa(Fe)?de(Fe):(e.consume(Fe),ve)}function Je(Fe){return Fe===47||Fe===62||la(Fe)?X(Fe):n(Fe)}function we(Fe){return Fe===62?(e.consume(Fe),rt):n(Fe)}function rt(Fe){return Fe===null||Ti(Fe)?He(Fe):la(Fe)?(e.consume(Fe),rt):n(Fe)}function He(Fe){return Fe===45&&a===2?(e.consume(Fe),Rt):Fe===60&&a===1?(e.consume(Fe),en):Fe===62&&a===4?(e.consume(Fe),gn):Fe===63&&a===3?(e.consume(Fe),Oe):Fe===93&&a===5?(e.consume(Fe),pt):Ti(Fe)&&(a===6||a===7)?(e.exit("htmlFlowData"),e.check(eIe,wt,ft)(Fe)):Fe===null||Ti(Fe)?(e.exit("htmlFlowData"),ft(Fe)):(e.consume(Fe),He)}function ft(Fe){return e.check(tIe,Ct,wt)(Fe)}function Ct(Fe){return e.enter("lineEnding"),e.consume(Fe),e.exit("lineEnding"),Nt}function Nt(Fe){return Fe===null||Ti(Fe)?ft(Fe):(e.enter("htmlFlowData"),He(Fe))}function Rt(Fe){return Fe===45?(e.consume(Fe),Oe):He(Fe)}function en(Fe){return Fe===47?(e.consume(Fe),f="",nt):He(Fe)}function nt(Fe){if(Fe===62){const jt=f.toLowerCase();return CH.includes(jt)?(e.consume(Fe),gn):He(Fe)}return Ru(Fe)&&f.length<8?(e.consume(Fe),f+=String.fromCharCode(Fe),nt):He(Fe)}function pt(Fe){return Fe===93?(e.consume(Fe),Oe):He(Fe)}function Oe(Fe){return Fe===62?(e.consume(Fe),gn):Fe===45&&a===2?(e.consume(Fe),Oe):He(Fe)}function gn(Fe){return Fe===null||Ti(Fe)?(e.exit("htmlFlowData"),wt(Fe)):(e.consume(Fe),gn)}function wt(Fe){return e.exit("htmlFlow"),t(Fe)}}function iIe(e,t,n){const r=this;return a;function a(f){return Ti(f)?(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),l):n(f)}function l(f){return r.parser.lazy[r.now().line]?n(f):t(f)}}function sIe(e,t,n){return r;function r(a){return e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),e.attempt(pE,t,n)}}const aIe={name:"htmlText",tokenize:oIe};function oIe(e,t,n){const r=this;let a,l,f;return i;function i(Oe){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(Oe),y}function y(Oe){return Oe===33?(e.consume(Oe),x):Oe===47?(e.consume(Oe),de):Oe===63?(e.consume(Oe),X):Ru(Oe)?(e.consume(Oe),ve):n(Oe)}function x(Oe){return Oe===45?(e.consume(Oe),S):Oe===91?(e.consume(Oe),l=0,F):Ru(Oe)?(e.consume(Oe),$):n(Oe)}function S(Oe){return Oe===45?(e.consume(Oe),L):n(Oe)}function C(Oe){return Oe===null?n(Oe):Oe===45?(e.consume(Oe),P):Ti(Oe)?(f=C,en(Oe)):(e.consume(Oe),C)}function P(Oe){return Oe===45?(e.consume(Oe),L):C(Oe)}function L(Oe){return Oe===62?Rt(Oe):Oe===45?P(Oe):C(Oe)}function F(Oe){const gn="CDATA[";return Oe===gn.charCodeAt(l++)?(e.consume(Oe),l===gn.length?U:F):n(Oe)}function U(Oe){return Oe===null?n(Oe):Oe===93?(e.consume(Oe),q):Ti(Oe)?(f=U,en(Oe)):(e.consume(Oe),U)}function q(Oe){return Oe===93?(e.consume(Oe),G):U(Oe)}function G(Oe){return Oe===62?Rt(Oe):Oe===93?(e.consume(Oe),G):U(Oe)}function $(Oe){return Oe===null||Oe===62?Rt(Oe):Ti(Oe)?(f=$,en(Oe)):(e.consume(Oe),$)}function X(Oe){return Oe===null?n(Oe):Oe===63?(e.consume(Oe),ie):Ti(Oe)?(f=X,en(Oe)):(e.consume(Oe),X)}function ie(Oe){return Oe===62?Rt(Oe):X(Oe)}function de(Oe){return Ru(Oe)?(e.consume(Oe),fe):n(Oe)}function fe(Oe){return Oe===45||cu(Oe)?(e.consume(Oe),fe):be(Oe)}function be(Oe){return Ti(Oe)?(f=be,en(Oe)):la(Oe)?(e.consume(Oe),be):Rt(Oe)}function ve(Oe){return Oe===45||cu(Oe)?(e.consume(Oe),ve):Oe===47||Oe===62||Qa(Oe)?Je(Oe):n(Oe)}function Je(Oe){return Oe===47?(e.consume(Oe),Rt):Oe===58||Oe===95||Ru(Oe)?(e.consume(Oe),we):Ti(Oe)?(f=Je,en(Oe)):la(Oe)?(e.consume(Oe),Je):Rt(Oe)}function we(Oe){return Oe===45||Oe===46||Oe===58||Oe===95||cu(Oe)?(e.consume(Oe),we):rt(Oe)}function rt(Oe){return Oe===61?(e.consume(Oe),He):Ti(Oe)?(f=rt,en(Oe)):la(Oe)?(e.consume(Oe),rt):Je(Oe)}function He(Oe){return Oe===null||Oe===60||Oe===61||Oe===62||Oe===96?n(Oe):Oe===34||Oe===39?(e.consume(Oe),a=Oe,ft):Ti(Oe)?(f=He,en(Oe)):la(Oe)?(e.consume(Oe),He):(e.consume(Oe),Ct)}function ft(Oe){return Oe===a?(e.consume(Oe),a=void 0,Nt):Oe===null?n(Oe):Ti(Oe)?(f=ft,en(Oe)):(e.consume(Oe),ft)}function Ct(Oe){return Oe===null||Oe===34||Oe===39||Oe===60||Oe===61||Oe===96?n(Oe):Oe===47||Oe===62||Qa(Oe)?Je(Oe):(e.consume(Oe),Ct)}function Nt(Oe){return Oe===47||Oe===62||Qa(Oe)?Je(Oe):n(Oe)}function Rt(Oe){return Oe===62?(e.consume(Oe),e.exit("htmlTextData"),e.exit("htmlText"),t):n(Oe)}function en(Oe){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(Oe),e.exit("lineEnding"),nt}function nt(Oe){return la(Oe)?ra(e,pt,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(Oe):pt(Oe)}function pt(Oe){return e.enter("htmlTextData"),f(Oe)}}const pN={name:"labelEnd",resolveAll:dIe,resolveTo:hIe,tokenize:fIe},lIe={tokenize:pIe},uIe={tokenize:mIe},cIe={tokenize:gIe};function dIe(e){let t=-1;const n=[];for(;++t<e.length;){const r=e[t][1];if(n.push(e[t]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const a=r.type==="labelImage"?4:2;r.type="data",t+=a}}return e.length!==n.length&&Xl(e,0,e.length,n),e}function hIe(e,t){let n=e.length,r=0,a,l,f,i;for(;n--;)if(a=e[n][1],l){if(a.type==="link"||a.type==="labelLink"&&a._inactive)break;e[n][0]==="enter"&&a.type==="labelLink"&&(a._inactive=!0)}else if(f){if(e[n][0]==="enter"&&(a.type==="labelImage"||a.type==="labelLink")&&!a._balanced&&(l=n,a.type!=="labelLink")){r=2;break}}else a.type==="labelEnd"&&(f=n);const y={type:e[l][1].type==="labelLink"?"link":"image",start:{...e[l][1].start},end:{...e[e.length-1][1].end}},x={type:"label",start:{...e[l][1].start},end:{...e[f][1].end}},S={type:"labelText",start:{...e[l+r+2][1].end},end:{...e[f-2][1].start}};return i=[["enter",y,t],["enter",x,t]],i=Zl(i,e.slice(l+1,l+r+3)),i=Zl(i,[["enter",S,t]]),i=Zl(i,Vx(t.parser.constructs.insideSpan.null,e.slice(l+r+4,f-3),t)),i=Zl(i,[["exit",S,t],e[f-2],e[f-1],["exit",x,t]]),i=Zl(i,e.slice(f+1)),i=Zl(i,[["exit",y,t]]),Xl(e,l,e.length,i),e}function fIe(e,t,n){const r=this;let a=r.events.length,l,f;for(;a--;)if((r.events[a][1].type==="labelImage"||r.events[a][1].type==="labelLink")&&!r.events[a][1]._balanced){l=r.events[a][1];break}return i;function i(P){return l?l._inactive?C(P):(f=r.parser.defined.includes(mh(r.sliceSerialize({start:l.end,end:r.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(P),e.exit("labelMarker"),e.exit("labelEnd"),y):n(P)}function y(P){return P===40?e.attempt(lIe,S,f?S:C)(P):P===91?e.attempt(uIe,S,f?x:C)(P):f?S(P):C(P)}function x(P){return e.attempt(cIe,S,C)(P)}function S(P){return t(P)}function C(P){return l._balanced=!0,n(P)}}function pIe(e,t,n){return r;function r(C){return e.enter("resource"),e.enter("resourceMarker"),e.consume(C),e.exit("resourceMarker"),a}function a(C){return Qa(C)?U2(e,l)(C):l(C)}function l(C){return C===41?S(C):lne(e,f,i,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(C)}function f(C){return Qa(C)?U2(e,y)(C):S(C)}function i(C){return n(C)}function y(C){return C===34||C===39||C===40?cne(e,x,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(C):S(C)}function x(C){return Qa(C)?U2(e,S)(C):S(C)}function S(C){return C===41?(e.enter("resourceMarker"),e.consume(C),e.exit("resourceMarker"),e.exit("resource"),t):n(C)}}function mIe(e,t,n){const r=this;return a;function a(i){return une.call(r,e,l,f,"reference","referenceMarker","referenceString")(i)}function l(i){return r.parser.defined.includes(mh(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?t(i):n(i)}function f(i){return n(i)}}function gIe(e,t,n){return r;function r(l){return e.enter("reference"),e.enter("referenceMarker"),e.consume(l),e.exit("referenceMarker"),a}function a(l){return l===93?(e.enter("referenceMarker"),e.consume(l),e.exit("referenceMarker"),e.exit("reference"),t):n(l)}}const _Ie={name:"labelStartImage",resolveAll:pN.resolveAll,tokenize:yIe};function yIe(e,t,n){const r=this;return a;function a(i){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(i),e.exit("labelImageMarker"),l}function l(i){return i===91?(e.enter("labelMarker"),e.consume(i),e.exit("labelMarker"),e.exit("labelImage"),f):n(i)}function f(i){return i===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(i):t(i)}}const vIe={name:"labelStartLink",resolveAll:pN.resolveAll,tokenize:xIe};function xIe(e,t,n){const r=this;return a;function a(f){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(f),e.exit("labelMarker"),e.exit("labelLink"),l}function l(f){return f===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(f):t(f)}}const jR={name:"lineEnding",tokenize:bIe};function bIe(e,t){return n;function n(r){return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),ra(e,t,"linePrefix")}}const gA={name:"thematicBreak",tokenize:wIe};function wIe(e,t,n){let r=0,a;return l;function l(x){return e.enter("thematicBreak"),f(x)}function f(x){return a=x,i(x)}function i(x){return x===a?(e.enter("thematicBreakSequence"),y(x)):r>=3&&(x===null||Ti(x))?(e.exit("thematicBreak"),t(x)):n(x)}function y(x){return x===a?(e.consume(x),r++,y):(e.exit("thematicBreakSequence"),la(x)?ra(e,i,"whitespace")(x):i(x))}}const Ju={continuation:{tokenize:AIe},exit:kIe,name:"list",tokenize:SIe},TIe={partial:!0,tokenize:IIe},EIe={partial:!0,tokenize:CIe};function SIe(e,t,n){const r=this,a=r.events[r.events.length-1];let l=a&&a[1].type==="linePrefix"?a[2].sliceSerialize(a[1],!0).length:0,f=0;return i;function i(L){const F=r.containerState.type||(L===42||L===43||L===45?"listUnordered":"listOrdered");if(F==="listUnordered"?!r.containerState.marker||L===r.containerState.marker:a8(L)){if(r.containerState.type||(r.containerState.type=F,e.enter(F,{_container:!0})),F==="listUnordered")return e.enter("listItemPrefix"),L===42||L===45?e.check(gA,n,x)(L):x(L);if(!r.interrupt||L===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),y(L)}return n(L)}function y(L){return a8(L)&&++f<10?(e.consume(L),y):(!r.interrupt||f<2)&&(r.containerState.marker?L===r.containerState.marker:L===41||L===46)?(e.exit("listItemValue"),x(L)):n(L)}function x(L){return e.enter("listItemMarker"),e.consume(L),e.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||L,e.check(pE,r.interrupt?n:S,e.attempt(TIe,P,C))}function S(L){return r.containerState.initialBlankLine=!0,l++,P(L)}function C(L){return la(L)?(e.enter("listItemPrefixWhitespace"),e.consume(L),e.exit("listItemPrefixWhitespace"),P):n(L)}function P(L){return r.containerState.size=l+r.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(L)}}function AIe(e,t,n){const r=this;return r.containerState._closeFlow=void 0,e.check(pE,a,l);function a(i){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,ra(e,t,"listItemIndent",r.containerState.size+1)(i)}function l(i){return r.containerState.furtherBlankLines||!la(i)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,f(i)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,e.attempt(EIe,t,f)(i))}function f(i){return r.containerState._closeFlow=!0,r.interrupt=void 0,ra(e,e.attempt(Ju,t,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(i)}}function CIe(e,t,n){const r=this;return ra(e,a,"listItemIndent",r.containerState.size+1);function a(l){const f=r.events[r.events.length-1];return f&&f[1].type==="listItemIndent"&&f[2].sliceSerialize(f[1],!0).length===r.containerState.size?t(l):n(l)}}function kIe(e){e.exit(this.containerState.type)}function IIe(e,t,n){const r=this;return ra(e,a,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function a(l){const f=r.events[r.events.length-1];return!la(l)&&f&&f[1].type==="listItemPrefixWhitespace"?t(l):n(l)}}const kH={name:"setextUnderline",resolveTo:RIe,tokenize:MIe};function RIe(e,t){let n=e.length,r,a,l;for(;n--;)if(e[n][0]==="enter"){if(e[n][1].type==="content"){r=n;break}e[n][1].type==="paragraph"&&(a=n)}else e[n][1].type==="content"&&e.splice(n,1),!l&&e[n][1].type==="definition"&&(l=n);const f={type:"setextHeading",start:{...e[r][1].start},end:{...e[e.length-1][1].end}};return e[a][1].type="setextHeadingText",l?(e.splice(a,0,["enter",f,t]),e.splice(l+1,0,["exit",e[r][1],t]),e[r][1].end={...e[l][1].end}):e[r][1]=f,e.push(["exit",f,t]),e}function MIe(e,t,n){const r=this;let a;return l;function l(x){let S=r.events.length,C;for(;S--;)if(r.events[S][1].type!=="lineEnding"&&r.events[S][1].type!=="linePrefix"&&r.events[S][1].type!=="content"){C=r.events[S][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||C)?(e.enter("setextHeadingLine"),a=x,f(x)):n(x)}function f(x){return e.enter("setextHeadingLineSequence"),i(x)}function i(x){return x===a?(e.consume(x),i):(e.exit("setextHeadingLineSequence"),la(x)?ra(e,y,"lineSuffix")(x):y(x))}function y(x){return x===null||Ti(x)?(e.exit("setextHeadingLine"),t(x)):n(x)}}const PIe={tokenize:jIe,partial:!0};function OIe(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:zIe,continuation:{tokenize:FIe},exit:BIe}},text:{91:{name:"gfmFootnoteCall",tokenize:NIe},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:LIe,resolveTo:DIe}}}}function LIe(e,t,n){const r=this;let a=r.events.length;const l=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let f;for(;a--;){const y=r.events[a][1];if(y.type==="labelImage"){f=y;break}if(y.type==="gfmFootnoteCall"||y.type==="labelLink"||y.type==="label"||y.type==="image"||y.type==="link")break}return i;function i(y){if(!f||!f._balanced)return n(y);const x=mh(r.sliceSerialize({start:f.end,end:r.now()}));return x.codePointAt(0)!==94||!l.includes(x.slice(1))?n(y):(e.enter("gfmFootnoteCallLabelMarker"),e.consume(y),e.exit("gfmFootnoteCallLabelMarker"),t(y))}}function DIe(e,t){let n=e.length;for(;n--;)if(e[n][1].type==="labelImage"&&e[n][0]==="enter"){e[n][1];break}e[n+1][1].type="data",e[n+3][1].type="gfmFootnoteCallLabelMarker";const r={type:"gfmFootnoteCall",start:Object.assign({},e[n+3][1].start),end:Object.assign({},e[e.length-1][1].end)},a={type:"gfmFootnoteCallMarker",start:Object.assign({},e[n+3][1].end),end:Object.assign({},e[n+3][1].end)};a.end.column++,a.end.offset++,a.end._bufferIndex++;const l={type:"gfmFootnoteCallString",start:Object.assign({},a.end),end:Object.assign({},e[e.length-1][1].start)},f={type:"chunkString",contentType:"string",start:Object.assign({},l.start),end:Object.assign({},l.end)},i=[e[n+1],e[n+2],["enter",r,t],e[n+3],e[n+4],["enter",a,t],["exit",a,t],["enter",l,t],["enter",f,t],["exit",f,t],["exit",l,t],e[e.length-2],e[e.length-1],["exit",r,t]];return e.splice(n,e.length-n+1,...i),e}function NIe(e,t,n){const r=this,a=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let l=0,f;return i;function i(C){return e.enter("gfmFootnoteCall"),e.enter("gfmFootnoteCallLabelMarker"),e.consume(C),e.exit("gfmFootnoteCallLabelMarker"),y}function y(C){return C!==94?n(C):(e.enter("gfmFootnoteCallMarker"),e.consume(C),e.exit("gfmFootnoteCallMarker"),e.enter("gfmFootnoteCallString"),e.enter("chunkString").contentType="string",x)}function x(C){if(l>999||C===93&&!f||C===null||C===91||Qa(C))return n(C);if(C===93){e.exit("chunkString");const P=e.exit("gfmFootnoteCallString");return a.includes(mh(r.sliceSerialize(P)))?(e.enter("gfmFootnoteCallLabelMarker"),e.consume(C),e.exit("gfmFootnoteCallLabelMarker"),e.exit("gfmFootnoteCall"),t):n(C)}return Qa(C)||(f=!0),l++,e.consume(C),C===92?S:x}function S(C){return C===91||C===92||C===93?(e.consume(C),l++,x):x(C)}}function zIe(e,t,n){const r=this,a=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let l,f=0,i;return y;function y(F){return e.enter("gfmFootnoteDefinition")._container=!0,e.enter("gfmFootnoteDefinitionLabel"),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(F),e.exit("gfmFootnoteDefinitionLabelMarker"),x}function x(F){return F===94?(e.enter("gfmFootnoteDefinitionMarker"),e.consume(F),e.exit("gfmFootnoteDefinitionMarker"),e.enter("gfmFootnoteDefinitionLabelString"),e.enter("chunkString").contentType="string",S):n(F)}function S(F){if(f>999||F===93&&!i||F===null||F===91||Qa(F))return n(F);if(F===93){e.exit("chunkString");const U=e.exit("gfmFootnoteDefinitionLabelString");return l=mh(r.sliceSerialize(U)),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(F),e.exit("gfmFootnoteDefinitionLabelMarker"),e.exit("gfmFootnoteDefinitionLabel"),P}return Qa(F)||(i=!0),f++,e.consume(F),F===92?C:S}function C(F){return F===91||F===92||F===93?(e.consume(F),f++,S):S(F)}function P(F){return F===58?(e.enter("definitionMarker"),e.consume(F),e.exit("definitionMarker"),a.includes(l)||a.push(l),ra(e,L,"gfmFootnoteDefinitionWhitespace")):n(F)}function L(F){return t(F)}}function FIe(e,t,n){return e.check(pE,t,e.attempt(PIe,t,n))}function BIe(e){e.exit("gfmFootnoteDefinition")}function jIe(e,t,n){const r=this;return ra(e,a,"gfmFootnoteDefinitionIndent",5);function a(l){const f=r.events[r.events.length-1];return f&&f[1].type==="gfmFootnoteDefinitionIndent"&&f[2].sliceSerialize(f[1],!0).length===4?t(l):n(l)}}function UIe(e){let n=(e||{}).singleTilde;const r={name:"strikethrough",tokenize:l,resolveAll:a};return n==null&&(n=!0),{text:{126:r},insideSpan:{null:[r]},attentionMarkers:{null:[126]}};function a(f,i){let y=-1;for(;++y<f.length;)if(f[y][0]==="enter"&&f[y][1].type==="strikethroughSequenceTemporary"&&f[y][1]._close){let x=y;for(;x--;)if(f[x][0]==="exit"&&f[x][1].type==="strikethroughSequenceTemporary"&&f[x][1]._open&&f[y][1].end.offset-f[y][1].start.offset===f[x][1].end.offset-f[x][1].start.offset){f[y][1].type="strikethroughSequence",f[x][1].type="strikethroughSequence";const S={type:"strikethrough",start:Object.assign({},f[x][1].start),end:Object.assign({},f[y][1].end)},C={type:"strikethroughText",start:Object.assign({},f[x][1].end),end:Object.assign({},f[y][1].start)},P=[["enter",S,i],["enter",f[x][1],i],["exit",f[x][1],i],["enter",C,i]],L=i.parser.constructs.insideSpan.null;L&&Xl(P,P.length,0,Vx(L,f.slice(x+1,y),i)),Xl(P,P.length,0,[["exit",C,i],["enter",f[y][1],i],["exit",f[y][1],i],["exit",S,i]]),Xl(f,x-1,y-x+3,P),y=x+P.length-2;break}}for(y=-1;++y<f.length;)f[y][1].type==="strikethroughSequenceTemporary"&&(f[y][1].type="data");return f}function l(f,i,y){const x=this.previous,S=this.events;let C=0;return P;function P(F){return x===126&&S[S.length-1][1].type!=="characterEscape"?y(F):(f.enter("strikethroughSequenceTemporary"),L(F))}function L(F){const U=px(x);if(F===126)return C>1?y(F):(f.consume(F),C++,L);if(C<2&&!n)return y(F);const q=f.exit("strikethroughSequenceTemporary"),G=px(F);return q._open=!G||G===2&&!!U,q._close=!U||U===2&&!!G,i(F)}}}class VIe{constructor(){this.map=[]}add(t,n,r){$Ie(this,t,n,r)}consume(t){if(this.map.sort(function(l,f){return l[0]-f[0]}),this.map.length===0)return;let n=this.map.length;const r=[];for(;n>0;)n-=1,r.push(t.slice(this.map[n][0]+this.map[n][1]),this.map[n][2]),t.length=this.map[n][0];r.push(t.slice()),t.length=0;let a=r.pop();for(;a;){for(const l of a)t.push(l);a=r.pop()}this.map.length=0}}function $Ie(e,t,n,r){let a=0;if(!(n===0&&r.length===0)){for(;a<e.map.length;){if(e.map[a][0]===t){e.map[a][1]+=n,e.map[a][2].push(...r);return}a+=1}e.map.push([t,n,r])}}function HIe(e,t){let n=!1;const r=[];for(;t<e.length;){const a=e[t];if(n){if(a[0]==="enter")a[1].type==="tableContent"&&r.push(e[t+1][1].type==="tableDelimiterMarker"?"left":"none");else if(a[1].type==="tableContent"){if(e[t-1][1].type==="tableDelimiterMarker"){const l=r.length-1;r[l]=r[l]==="left"?"center":"right"}}else if(a[1].type==="tableDelimiterRow")break}else a[0]==="enter"&&a[1].type==="tableDelimiterRow"&&(n=!0);t+=1}return r}function GIe(){return{flow:{null:{name:"table",tokenize:qIe,resolveAll:ZIe}}}}function qIe(e,t,n){const r=this;let a=0,l=0,f;return i;function i(we){let rt=r.events.length-1;for(;rt>-1;){const Ct=r.events[rt][1].type;if(Ct==="lineEnding"||Ct==="linePrefix")rt--;else break}const He=rt>-1?r.events[rt][1].type:null,ft=He==="tableHead"||He==="tableRow"?fe:y;return ft===fe&&r.parser.lazy[r.now().line]?n(we):ft(we)}function y(we){return e.enter("tableHead"),e.enter("tableRow"),x(we)}function x(we){return we===124||(f=!0,l+=1),S(we)}function S(we){return we===null?n(we):Ti(we)?l>1?(l=0,r.interrupt=!0,e.exit("tableRow"),e.enter("lineEnding"),e.consume(we),e.exit("lineEnding"),L):n(we):la(we)?ra(e,S,"whitespace")(we):(l+=1,f&&(f=!1,a+=1),we===124?(e.enter("tableCellDivider"),e.consume(we),e.exit("tableCellDivider"),f=!0,S):(e.enter("data"),C(we)))}function C(we){return we===null||we===124||Qa(we)?(e.exit("data"),S(we)):(e.consume(we),we===92?P:C)}function P(we){return we===92||we===124?(e.consume(we),C):C(we)}function L(we){return r.interrupt=!1,r.parser.lazy[r.now().line]?n(we):(e.enter("tableDelimiterRow"),f=!1,la(we)?ra(e,F,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(we):F(we))}function F(we){return we===45||we===58?q(we):we===124?(f=!0,e.enter("tableCellDivider"),e.consume(we),e.exit("tableCellDivider"),U):de(we)}function U(we){return la(we)?ra(e,q,"whitespace")(we):q(we)}function q(we){return we===58?(l+=1,f=!0,e.enter("tableDelimiterMarker"),e.consume(we),e.exit("tableDelimiterMarker"),G):we===45?(l+=1,G(we)):we===null||Ti(we)?ie(we):de(we)}function G(we){return we===45?(e.enter("tableDelimiterFiller"),$(we)):de(we)}function $(we){return we===45?(e.consume(we),$):we===58?(f=!0,e.exit("tableDelimiterFiller"),e.enter("tableDelimiterMarker"),e.consume(we),e.exit("tableDelimiterMarker"),X):(e.exit("tableDelimiterFiller"),X(we))}function X(we){return la(we)?ra(e,ie,"whitespace")(we):ie(we)}function ie(we){return we===124?F(we):we===null||Ti(we)?!f||a!==l?de(we):(e.exit("tableDelimiterRow"),e.exit("tableHead"),t(we)):de(we)}function de(we){return n(we)}function fe(we){return e.enter("tableRow"),be(we)}function be(we){return we===124?(e.enter("tableCellDivider"),e.consume(we),e.exit("tableCellDivider"),be):we===null||Ti(we)?(e.exit("tableRow"),t(we)):la(we)?ra(e,be,"whitespace")(we):(e.enter("data"),ve(we))}function ve(we){return we===null||we===124||Qa(we)?(e.exit("data"),be(we)):(e.consume(we),we===92?Je:ve)}function Je(we){return we===92||we===124?(e.consume(we),ve):ve(we)}}function ZIe(e,t){let n=-1,r=!0,a=0,l=[0,0,0,0],f=[0,0,0,0],i=!1,y=0,x,S,C;const P=new VIe;for(;++n<e.length;){const L=e[n],F=L[1];L[0]==="enter"?F.type==="tableHead"?(i=!1,y!==0&&(IH(P,t,y,x,S),S=void 0,y=0),x={type:"table",start:Object.assign({},F.start),end:Object.assign({},F.end)},P.add(n,0,[["enter",x,t]])):F.type==="tableRow"||F.type==="tableDelimiterRow"?(r=!0,C=void 0,l=[0,0,0,0],f=[0,n+1,0,0],i&&(i=!1,S={type:"tableBody",start:Object.assign({},F.start),end:Object.assign({},F.end)},P.add(n,0,[["enter",S,t]])),a=F.type==="tableDelimiterRow"?2:S?3:1):a&&(F.type==="data"||F.type==="tableDelimiterMarker"||F.type==="tableDelimiterFiller")?(r=!1,f[2]===0&&(l[1]!==0&&(f[0]=f[1],C=l4(P,t,l,a,void 0,C),l=[0,0,0,0]),f[2]=n)):F.type==="tableCellDivider"&&(r?r=!1:(l[1]!==0&&(f[0]=f[1],C=l4(P,t,l,a,void 0,C)),l=f,f=[l[1],n,0,0])):F.type==="tableHead"?(i=!0,y=n):F.type==="tableRow"||F.type==="tableDelimiterRow"?(y=n,l[1]!==0?(f[0]=f[1],C=l4(P,t,l,a,n,C)):f[1]!==0&&(C=l4(P,t,f,a,n,C)),a=0):a&&(F.type==="data"||F.type==="tableDelimiterMarker"||F.type==="tableDelimiterFiller")&&(f[3]=n)}for(y!==0&&IH(P,t,y,x,S),P.consume(t.events),n=-1;++n<t.events.length;){const L=t.events[n];L[0]==="enter"&&L[1].type==="table"&&(L[1]._align=HIe(t.events,n))}return e}function l4(e,t,n,r,a,l){const f=r===1?"tableHeader":r===2?"tableDelimiter":"tableData",i="tableContent";n[0]!==0&&(l.end=Object.assign({},Q1(t.events,n[0])),e.add(n[0],0,[["exit",l,t]]));const y=Q1(t.events,n[1]);if(l={type:f,start:Object.assign({},y),end:Object.assign({},y)},e.add(n[1],0,[["enter",l,t]]),n[2]!==0){const x=Q1(t.events,n[2]),S=Q1(t.events,n[3]),C={type:i,start:Object.assign({},x),end:Object.assign({},S)};if(e.add(n[2],0,[["enter",C,t]]),r!==2){const P=t.events[n[2]],L=t.events[n[3]];if(P[1].end=Object.assign({},L[1].end),P[1].type="chunkText",P[1].contentType="text",n[3]>n[2]+1){const F=n[2]+1,U=n[3]-n[2]-1;e.add(F,U,[])}}e.add(n[3]+1,0,[["exit",C,t]])}return a!==void 0&&(l.end=Object.assign({},Q1(t.events,a)),e.add(a,0,[["exit",l,t]]),l=void 0),l}function IH(e,t,n,r,a){const l=[],f=Q1(t.events,n);a&&(a.end=Object.assign({},f),l.push(["exit",a,t])),r.end=Object.assign({},f),l.push(["exit",r,t]),e.add(n+1,0,l)}function Q1(e,t){const n=e[t],r=n[0]==="enter"?"start":"end";return n[1][r]}const WIe={name:"tasklistCheck",tokenize:YIe};function XIe(){return{text:{91:WIe}}}function YIe(e,t,n){const r=this;return a;function a(y){return r.previous!==null||!r._gfmTasklistFirstContentOfListItem?n(y):(e.enter("taskListCheck"),e.enter("taskListCheckMarker"),e.consume(y),e.exit("taskListCheckMarker"),l)}function l(y){return Qa(y)?(e.enter("taskListCheckValueUnchecked"),e.consume(y),e.exit("taskListCheckValueUnchecked"),f):y===88||y===120?(e.enter("taskListCheckValueChecked"),e.consume(y),e.exit("taskListCheckValueChecked"),f):n(y)}function f(y){return y===93?(e.enter("taskListCheckMarker"),e.consume(y),e.exit("taskListCheckMarker"),e.exit("taskListCheck"),i):n(y)}function i(y){return Ti(y)?t(y):la(y)?e.check({tokenize:KIe},t,n)(y):n(y)}}function KIe(e,t,n){return ra(e,r,"whitespace");function r(a){return a===null?n(a):t(a)}}function QIe(e){return Xte([lke(),OIe(),UIe(e),GIe(),XIe()])}const JIe={};function e6e(e){const t=this,n=e||JIe,r=t.data(),a=r.micromarkExtensions||(r.micromarkExtensions=[]),l=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),f=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);a.push(QIe(n)),l.push(nke()),f.push(rke(n))}function t6e(){return{enter:{mathFlow:e,mathFlowFenceMeta:t,mathText:l},exit:{mathFlow:a,mathFlowFence:r,mathFlowFenceMeta:n,mathFlowValue:i,mathText:f,mathTextData:i}};function e(y){const x={type:"element",tagName:"code",properties:{className:["language-math","math-display"]},children:[]};this.enter({type:"math",meta:null,value:"",data:{hName:"pre",hChildren:[x]}},y)}function t(){this.buffer()}function n(){const y=this.resume(),x=this.stack[this.stack.length-1];x.type,x.meta=y}function r(){this.data.mathFlowInside||(this.buffer(),this.data.mathFlowInside=!0)}function a(y){const x=this.resume().replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),S=this.stack[this.stack.length-1];S.type,this.exit(y),S.value=x;const C=S.data.hChildren[0];C.type,C.tagName,C.children.push({type:"text",value:x}),this.data.mathFlowInside=void 0}function l(y){this.enter({type:"inlineMath",value:"",data:{hName:"code",hProperties:{className:["language-math","math-inline"]},hChildren:[]}},y),this.buffer()}function f(y){const x=this.resume(),S=this.stack[this.stack.length-1];S.type,this.exit(y),S.value=x,S.data.hChildren.push({type:"text",value:x})}function i(y){this.config.enter.data.call(this,y),this.config.exit.data.call(this,y)}}function n6e(e){let t=(e||{}).singleDollarTextMath;return t==null&&(t=!0),r.peek=a,{unsafe:[{character:"\r",inConstruct:"mathFlowMeta"},{character:`
`,inConstruct:"mathFlowMeta"},{character:"$",after:t?void 0:"\\$",inConstruct:"phrasing"},{character:"$",inConstruct:"mathFlowMeta"},{atBreak:!0,character:"$",after:"\\$"}],handlers:{math:n,inlineMath:r}};function n(l,f,i,y){const x=l.value||"",S=i.createTracker(y),C="$".repeat(Math.max(Dte(x,"$")+1,2)),P=i.enter("mathFlow");let L=S.move(C);if(l.meta){const F=i.enter("mathFlowMeta");L+=S.move(i.safe(l.meta,{after:`
`,before:L,encode:["$"],...S.current()})),F()}return L+=S.move(`
`),x&&(L+=S.move(x+`
`)),L+=S.move(C),P(),L}function r(l,f,i){let y=l.value||"",x=1;for(t||x++;new RegExp("(^|[^$])"+"\\$".repeat(x)+"([^$]|$)").test(y);)x++;const S="$".repeat(x);/[^ \r\n]/.test(y)&&(/^[ \r\n]/.test(y)&&/[ \r\n]$/.test(y)||/^\$|\$$/.test(y))&&(y=" "+y+" ");let C=-1;for(;++C<i.unsafe.length;){const P=i.unsafe[C];if(!P.atBreak)continue;const L=i.compilePattern(P);let F;for(;F=L.exec(y);){let U=F.index;y.codePointAt(U)===10&&y.codePointAt(U-1)===13&&U--,y=y.slice(0,U)+" "+y.slice(F.index+1)}}return S+y+S}function a(){return"$"}}const r6e={tokenize:i6e,concrete:!0,name:"mathFlow"},RH={tokenize:s6e,partial:!0};function i6e(e,t,n){const r=this,a=r.events[r.events.length-1],l=a&&a[1].type==="linePrefix"?a[2].sliceSerialize(a[1],!0).length:0;let f=0;return i;function i($){return e.enter("mathFlow"),e.enter("mathFlowFence"),e.enter("mathFlowFenceSequence"),y($)}function y($){return $===36?(e.consume($),f++,y):f<2?n($):(e.exit("mathFlowFenceSequence"),ra(e,x,"whitespace")($))}function x($){return $===null||Ti($)?C($):(e.enter("mathFlowFenceMeta"),e.enter("chunkString",{contentType:"string"}),S($))}function S($){return $===null||Ti($)?(e.exit("chunkString"),e.exit("mathFlowFenceMeta"),C($)):$===36?n($):(e.consume($),S)}function C($){return e.exit("mathFlowFence"),r.interrupt?t($):e.attempt(RH,P,q)($)}function P($){return e.attempt({tokenize:G,partial:!0},q,L)($)}function L($){return(l?ra(e,F,"linePrefix",l+1):F)($)}function F($){return $===null?q($):Ti($)?e.attempt(RH,P,q)($):(e.enter("mathFlowValue"),U($))}function U($){return $===null||Ti($)?(e.exit("mathFlowValue"),F($)):(e.consume($),U)}function q($){return e.exit("mathFlow"),t($)}function G($,X,ie){let de=0;return ra($,fe,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4);function fe(Je){return $.enter("mathFlowFence"),$.enter("mathFlowFenceSequence"),be(Je)}function be(Je){return Je===36?(de++,$.consume(Je),be):de<f?ie(Je):($.exit("mathFlowFenceSequence"),ra($,ve,"whitespace")(Je))}function ve(Je){return Je===null||Ti(Je)?($.exit("mathFlowFence"),X(Je)):ie(Je)}}}function s6e(e,t,n){const r=this;return a;function a(f){return f===null?t(f):(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),l)}function l(f){return r.parser.lazy[r.now().line]?n(f):t(f)}}function a6e(e){let n=(e||{}).singleDollarTextMath;return n==null&&(n=!0),{tokenize:r,resolve:o6e,previous:l6e,name:"mathText"};function r(a,l,f){let i=0,y,x;return S;function S(U){return a.enter("mathText"),a.enter("mathTextSequence"),C(U)}function C(U){return U===36?(a.consume(U),i++,C):i<2&&!n?f(U):(a.exit("mathTextSequence"),P(U))}function P(U){return U===null?f(U):U===36?(x=a.enter("mathTextSequence"),y=0,F(U)):U===32?(a.enter("space"),a.consume(U),a.exit("space"),P):Ti(U)?(a.enter("lineEnding"),a.consume(U),a.exit("lineEnding"),P):(a.enter("mathTextData"),L(U))}function L(U){return U===null||U===32||U===36||Ti(U)?(a.exit("mathTextData"),P(U)):(a.consume(U),L)}function F(U){return U===36?(a.consume(U),y++,F):y===i?(a.exit("mathTextSequence"),a.exit("mathText"),l(U)):(x.type="mathTextData",L(U))}}}function o6e(e){let t=e.length-4,n=3,r,a;if((e[n][1].type==="lineEnding"||e[n][1].type==="space")&&(e[t][1].type==="lineEnding"||e[t][1].type==="space")){for(r=n;++r<t;)if(e[r][1].type==="mathTextData"){e[t][1].type="mathTextPadding",e[n][1].type="mathTextPadding",n+=2,t-=2;break}}for(r=n-1,t++;++r<=t;)a===void 0?r!==t&&e[r][1].type!=="lineEnding"&&(a=r):(r===t||e[r][1].type==="lineEnding")&&(e[a][1].type="mathTextData",r!==a+2&&(e[a][1].end=e[r-1][1].end,e.splice(a+2,r-a-2),t-=r-a-2,r=a+2),a=void 0);return e}function l6e(e){return e!==36||this.events[this.events.length-1][1].type==="characterEscape"}function u6e(e){return{flow:{36:r6e},text:{36:a6e(e)}}}const c6e={};function c8(e){const t=this,n=e||c6e,r=t.data(),a=r.micromarkExtensions||(r.micromarkExtensions=[]),l=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),f=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);a.push(u6e(n)),l.push(t6e()),f.push(n6e(n))}var d6e=/(\*\*)([^*]*?)$/,h6e=/(__)([^_]*?)$/,f6e=/(\*\*\*)([^*]*?)$/,p6e=/(\*)([^*]*?)$/,m6e=/(_)([^_]*?)$/,g6e=/(`)([^`]*?)$/,_6e=/(~~)([^~]*?)$/,K_=/^[\s_~*`]*$/,dne=/^[\s]*[-*+][\s]+$/,y6e=/[\p{L}\p{N}_]/u,v6e=/^```[^`\n]*```?$/,x6e=/^\*{4,}$/,P0=e=>{if(!e)return!1;let t=e.charCodeAt(0);return t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||t===95?!0:y6e.test(e)},eI=e=>{let t=(e.match(/```/g)||[]).length;return t>0&&t%2===0&&e.includes(`
`)},b6e=(e,t)=>{let n=1;for(let r=t-1;r>=0;r-=1)if(e[r]==="]")n+=1;else if(e[r]==="["&&(n-=1,n===0))return r;return-1},w6e=(e,t)=>{let n=1;for(let r=t+1;r<e.length;r+=1)if(e[r]==="[")n+=1;else if(e[r]==="]"&&(n-=1,n===0))return r;return-1},hne=(e,t)=>{let n=!1,r=!1;for(let a=0;a<e.length&&a<t;a+=1){if(e[a]==="\\"&&e[a+1]==="$"){a+=1;continue}e[a]==="$"&&(e[a+1]==="$"?(r=!r,a+=1,n=!1):r||(n=!n))}return n||r},T6e=(e,t,n)=>{if(n!==" "&&n!=="	")return!1;let r=0;for(let a=t-1;a>=0;a-=1)if(e[a]===`
`){r=a+1;break}for(let a=r;a<t;a+=1)if(e[a]!==" "&&e[a]!=="	")return!1;return!0},E6e=(e,t,n,r)=>!!(n==="\\"||n==="*"||r==="*"||n&&r&&P0(n)&&P0(r)||T6e(e,t,r)),S6e=e=>{let t=0,n=e.length;for(let r=0;r<n;r+=1){if(e[r]!=="*")continue;let a=r>0?e[r-1]:"",l=r<n-1?e[r+1]:"";E6e(e,r,a,l)||(t+=1)}return t},A6e=(e,t,n,r)=>!!(n==="\\"||e.includes("$")&&hne(e,t)||n==="_"||r==="_"||n&&r&&P0(n)&&P0(r)),C6e=e=>{let t=0,n=e.length;for(let r=0;r<n;r+=1){if(e[r]!=="_")continue;let a=r>0?e[r-1]:"",l=r<n-1?e[r+1]:"";A6e(e,r,a,l)||(t+=1)}return t},k6e=e=>{let t=0,n=0;for(let r=0;r<e.length;r+=1)e[r]==="*"?n+=1:(n>=3&&(t+=Math.floor(n/3)),n=0);return n>=3&&(t+=Math.floor(n/3)),t},I6e=e=>{if(eI(e))return e;let t=e.match(d6e);if(t){let n=t[2];if(!n||K_.test(n))return e;let r=e.lastIndexOf(t[1]),a=e.substring(0,r).lastIndexOf(`
`),l=a===-1?0:a+1,f=e.substring(l,r);if(dne.test(f)&&n.includes(`
`))return e;if((e.match(/\*\*/g)||[]).length%2===1)return`${e}**`}return e},R6e=e=>{let t=e.match(h6e);if(t){let n=t[2];if(!n||K_.test(n))return e;let r=e.lastIndexOf(t[1]),a=e.substring(0,r).lastIndexOf(`
`),l=a===-1?0:a+1,f=e.substring(l,r);if(dne.test(f)&&n.includes(`
`))return e;if((e.match(/__/g)||[]).length%2===1)return`${e}__`}return e},M6e=e=>{for(let t=0;t<e.length;t+=1)if(e[t]==="*"&&e[t-1]!=="*"&&e[t+1]!=="*"&&e[t-1]!=="\\"){let n=t>0?e[t-1]:"",r=t<e.length-1?e[t+1]:"";if(n&&r&&P0(n)&&P0(r))continue;return t}return-1},P6e=e=>{if(eI(e)||!e.match(p6e))return e;let t=M6e(e);if(t===-1)return e;let n=e.substring(t+1);return!n||K_.test(n)?e:S6e(e)%2===1?`${e}*`:e},O6e=e=>{for(let t=0;t<e.length;t+=1)if(e[t]==="_"&&e[t-1]!=="_"&&e[t+1]!=="_"&&e[t-1]!=="\\"&&!hne(e,t)){let n=t>0?e[t-1]:"",r=t<e.length-1?e[t+1]:"";if(n&&r&&P0(n)&&P0(r))continue;return t}return-1},L6e=e=>{let t=e.length;for(;t>0&&e[t-1]===`
`;)t-=1;if(t<e.length){let n=e.slice(0,t),r=e.slice(t);return`${n}_${r}`}return`${e}_`},D6e=e=>{if(eI(e)||!e.match(m6e))return e;let t=O6e(e);if(t===-1)return e;let n=e.substring(t+1);return!n||K_.test(n)?e:C6e(e)%2===1?L6e(e):e},N6e=e=>{if(eI(e)||x6e.test(e))return e;let t=e.match(f6e);if(t){let n=t[2];if(!n||K_.test(n))return e;if(k6e(e)%2===1)return`${e}***`}return e},d8=(e,t)=>{let n=!1,r=!1;for(let a=0;a<t;a+=1){if(e.substring(a,a+3)==="```"){r=!r,a+=2;continue}!r&&e[a]==="`"&&(n=!n)}return n||r},z6e=(e,t)=>{let n=e.substring(t,t+3)==="```",r=t>0&&e.substring(t-1,t+2)==="```",a=t>1&&e.substring(t-2,t+1)==="```";return n||r||a},F6e=e=>{let t=0;for(let n=0;n<e.length;n+=1)e[n]==="`"&&!z6e(e,n)&&(t+=1);return t},B6e=e=>!e.match(v6e)||e.includes(`
`)?null:e.endsWith("``")&&!e.endsWith("```")?`${e}\``:e,j6e=e=>{let t=(e.match(/```/g)||[]).length;return!!(t>0&&t%2===0&&e.includes(`
`)||(e.endsWith("```\n")||e.endsWith("```"))&&t%2===0)},U6e=e=>(e.match(/```/g)||[]).length%2===1,V6e=e=>{let t=B6e(e);if(t!==null)return t;if(j6e(e))return e;let n=e.match(g6e);if(n&&!U6e(e)){let r=n[2];if(!r||K_.test(r))return e;if(F6e(e)%2===1)return`${e}\``}return e},$6e=e=>{if((e.match(/\$\$/g)||[]).length%2===0)return e;let t=e.indexOf("$$");return t!==-1&&e.indexOf(`
`,t)!==-1&&!e.endsWith(`
`)?`${e}
$$`:`${e}$$`},H6e=(e,t)=>{if(e.substring(t+2).includes(")"))return null;let n=b6e(e,t);if(n===-1||d8(e,n))return null;let r=n>0&&e[n-1]==="!",a=r?n-1:n,l=e.substring(0,a);if(r)return l;let f=e.substring(n+1,t);return`${l}[${f}](streamdown:incomplete-link)`},G6e=(e,t)=>{let n=t>0&&e[t-1]==="!",r=n?t-1:t;if(!e.substring(t+1).includes("]")){let a=e.substring(0,r);return n?a:`${e}](streamdown:incomplete-link)`}if(w6e(e,t)===-1){let a=e.substring(0,r);return n?a:`${e}](streamdown:incomplete-link)`}return null},q6e=e=>{let t=e.lastIndexOf("](");if(t!==-1&&!d8(e,t)){let n=H6e(e,t);if(n!==null)return n}for(let n=e.length-1;n>=0;n-=1)if(e[n]==="["&&!d8(e,n)){let r=G6e(e,n);if(r!==null)return r}return e},Z6e=e=>{let t=e.match(_6e);if(t){let n=t[2];if(!n||K_.test(n))return e;if((e.match(/~~/g)||[]).length%2===1)return`${e}~~`}return e},W6e=e=>{if(!e||typeof e!="string")return e;let t=e,n=q6e(t);return n.endsWith("](streamdown:incomplete-link)")?n:(t=n,t=N6e(t),t=I6e(t),t=R6e(t),t=P6e(t),t=D6e(t),t=V6e(t),t=Z6e(t),t=$6e(t),t)},X6e=W6e;/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y6e=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),K6e=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,r)=>r?r.toUpperCase():n.toLowerCase()),MH=e=>{const t=K6e(e);return t.charAt(0).toUpperCase()+t.slice(1)},fne=(...e)=>e.filter((t,n,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===n).join(" ").trim(),Q6e=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var J6e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e5e=B.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:a="",children:l,iconNode:f,...i},y)=>B.createElement("svg",{ref:y,...J6e,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:fne("lucide",a),...!l&&!Q6e(i)&&{"aria-hidden":"true"},...i},[...f.map(([x,S])=>B.createElement(x,S)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Up=(e,t)=>{const n=B.forwardRef(({className:r,...a},l)=>B.createElement(e5e,{ref:l,iconNode:t,className:fne(`lucide-${Y6e(MH(e))}`,`lucide-${e}`,r),...a}));return n.displayName=MH(e),n};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t5e=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],pne=Up("check",t5e);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n5e=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],mne=Up("copy",n5e);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r5e=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],tI=Up("download",r5e);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i5e=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],s5e=Up("loader-circle",i5e);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a5e=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],o5e=Up("maximize-2",a5e);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l5e=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],u5e=Up("rotate-ccw",l5e);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c5e=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],d5e=Up("x",c5e);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h5e=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],f5e=Up("zoom-in",h5e);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p5e=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],m5e=Up("zoom-out",p5e),g5e=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,_5e=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,y5e={};function PH(e,t){return(y5e.jsx?_5e:g5e).test(e)}const v5e=/[ \t\n\f\r]/g;function x5e(e){return typeof e=="object"?e.type==="text"?OH(e.value):!1:OH(e)}function OH(e){return e.replace(v5e,"")===""}class mE{constructor(t,n,r){this.normal=n,this.property=t,r&&(this.space=r)}}mE.prototype.normal={};mE.prototype.property={};mE.prototype.space=void 0;function gne(e,t){const n={},r={};for(const a of e)Object.assign(n,a.property),Object.assign(r,a.normal);return new mE(n,r,t)}function h8(e){return e.toLowerCase()}class gc{constructor(t,n){this.attribute=n,this.property=t}}gc.prototype.attribute="";gc.prototype.booleanish=!1;gc.prototype.boolean=!1;gc.prototype.commaOrSpaceSeparated=!1;gc.prototype.commaSeparated=!1;gc.prototype.defined=!1;gc.prototype.mustUseProperty=!1;gc.prototype.number=!1;gc.prototype.overloadedBoolean=!1;gc.prototype.property="";gc.prototype.spaceSeparated=!1;gc.prototype.space=void 0;let b5e=0;const Vs=Q_(),hl=Q_(),f8=Q_(),hr=Q_(),co=Q_(),Iv=Q_(),Mc=Q_();function Q_(){return 2**++b5e}const p8=Object.freeze(Object.defineProperty({__proto__:null,boolean:Vs,booleanish:hl,commaOrSpaceSeparated:Mc,commaSeparated:Iv,number:hr,overloadedBoolean:f8,spaceSeparated:co},Symbol.toStringTag,{value:"Module"})),UR=Object.keys(p8);class mN extends gc{constructor(t,n,r,a){let l=-1;if(super(t,n),LH(this,"space",a),typeof r=="number")for(;++l<UR.length;){const f=UR[l];LH(this,UR[l],(r&p8[f])===p8[f])}}}mN.prototype.defined=!0;function LH(e,t,n){n&&(e[t]=n)}function Hx(e){const t={},n={};for(const[r,a]of Object.entries(e.properties)){const l=new mN(r,e.transform(e.attributes||{},r),a,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(l.mustUseProperty=!0),t[r]=l,n[h8(r)]=r,n[h8(l.attribute)]=r}return new mE(t,n,e.space)}const _ne=Hx({properties:{ariaActiveDescendant:null,ariaAtomic:hl,ariaAutoComplete:null,ariaBusy:hl,ariaChecked:hl,ariaColCount:hr,ariaColIndex:hr,ariaColSpan:hr,ariaControls:co,ariaCurrent:null,ariaDescribedBy:co,ariaDetails:null,ariaDisabled:hl,ariaDropEffect:co,ariaErrorMessage:null,ariaExpanded:hl,ariaFlowTo:co,ariaGrabbed:hl,ariaHasPopup:null,ariaHidden:hl,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:co,ariaLevel:hr,ariaLive:null,ariaModal:hl,ariaMultiLine:hl,ariaMultiSelectable:hl,ariaOrientation:null,ariaOwns:co,ariaPlaceholder:null,ariaPosInSet:hr,ariaPressed:hl,ariaReadOnly:hl,ariaRelevant:null,ariaRequired:hl,ariaRoleDescription:co,ariaRowCount:hr,ariaRowIndex:hr,ariaRowSpan:hr,ariaSelected:hl,ariaSetSize:hr,ariaSort:null,ariaValueMax:hr,ariaValueMin:hr,ariaValueNow:hr,ariaValueText:null,role:null},transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function yne(e,t){return t in e?e[t]:t}function vne(e,t){return yne(e,t.toLowerCase())}const w5e=Hx({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Iv,acceptCharset:co,accessKey:co,action:null,allow:null,allowFullScreen:Vs,allowPaymentRequest:Vs,allowUserMedia:Vs,alt:null,as:null,async:Vs,autoCapitalize:null,autoComplete:co,autoFocus:Vs,autoPlay:Vs,blocking:co,capture:null,charSet:null,checked:Vs,cite:null,className:co,cols:hr,colSpan:null,content:null,contentEditable:hl,controls:Vs,controlsList:co,coords:hr|Iv,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Vs,defer:Vs,dir:null,dirName:null,disabled:Vs,download:f8,draggable:hl,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Vs,formTarget:null,headers:co,height:hr,hidden:f8,high:hr,href:null,hrefLang:null,htmlFor:co,httpEquiv:co,id:null,imageSizes:null,imageSrcSet:null,inert:Vs,inputMode:null,integrity:null,is:null,isMap:Vs,itemId:null,itemProp:co,itemRef:co,itemScope:Vs,itemType:co,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Vs,low:hr,manifest:null,max:null,maxLength:hr,media:null,method:null,min:null,minLength:hr,multiple:Vs,muted:Vs,name:null,nonce:null,noModule:Vs,noValidate:Vs,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Vs,optimum:hr,pattern:null,ping:co,placeholder:null,playsInline:Vs,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Vs,referrerPolicy:null,rel:co,required:Vs,reversed:Vs,rows:hr,rowSpan:hr,sandbox:co,scope:null,scoped:Vs,seamless:Vs,selected:Vs,shadowRootClonable:Vs,shadowRootDelegatesFocus:Vs,shadowRootMode:null,shape:null,size:hr,sizes:null,slot:null,span:hr,spellCheck:hl,src:null,srcDoc:null,srcLang:null,srcSet:null,start:hr,step:null,style:null,tabIndex:hr,target:null,title:null,translate:null,type:null,typeMustMatch:Vs,useMap:null,value:hl,width:hr,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:co,axis:null,background:null,bgColor:null,border:hr,borderColor:null,bottomMargin:hr,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Vs,declare:Vs,event:null,face:null,frame:null,frameBorder:null,hSpace:hr,leftMargin:hr,link:null,longDesc:null,lowSrc:null,marginHeight:hr,marginWidth:hr,noResize:Vs,noHref:Vs,noShade:Vs,noWrap:Vs,object:null,profile:null,prompt:null,rev:null,rightMargin:hr,rules:null,scheme:null,scrolling:hl,standby:null,summary:null,text:null,topMargin:hr,valueType:null,version:null,vAlign:null,vLink:null,vSpace:hr,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Vs,disableRemotePlayback:Vs,prefix:null,property:null,results:hr,security:null,unselectable:null},space:"html",transform:vne}),T5e=Hx({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Mc,accentHeight:hr,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:hr,amplitude:hr,arabicForm:null,ascent:hr,attributeName:null,attributeType:null,azimuth:hr,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:hr,by:null,calcMode:null,capHeight:hr,className:co,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:hr,diffuseConstant:hr,direction:null,display:null,dur:null,divisor:hr,dominantBaseline:null,download:Vs,dx:null,dy:null,edgeMode:null,editable:null,elevation:hr,enableBackground:null,end:null,event:null,exponent:hr,externalResourcesRequired:null,fill:null,fillOpacity:hr,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Iv,g2:Iv,glyphName:Iv,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:hr,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:hr,horizOriginX:hr,horizOriginY:hr,id:null,ideographic:hr,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:hr,k:hr,k1:hr,k2:hr,k3:hr,k4:hr,kernelMatrix:Mc,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:hr,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:hr,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:hr,overlineThickness:hr,paintOrder:null,panose1:null,path:null,pathLength:hr,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:co,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:hr,pointsAtY:hr,pointsAtZ:hr,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Mc,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Mc,rev:Mc,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Mc,requiredFeatures:Mc,requiredFonts:Mc,requiredFormats:Mc,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:hr,specularExponent:hr,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:hr,strikethroughThickness:hr,string:null,stroke:null,strokeDashArray:Mc,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:hr,strokeOpacity:hr,strokeWidth:null,style:null,surfaceScale:hr,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Mc,tabIndex:hr,tableValues:null,target:null,targetX:hr,targetY:hr,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Mc,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:hr,underlineThickness:hr,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:hr,values:null,vAlphabetic:hr,vMathematical:hr,vectorEffect:null,vHanging:hr,vIdeographic:hr,version:null,vertAdvY:hr,vertOriginX:hr,vertOriginY:hr,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:hr,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:yne}),xne=Hx({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()}}),bne=Hx({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:vne}),wne=Hx({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()}}),E5e={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},S5e=/[A-Z]/g,DH=/-[a-z]/g,A5e=/^data[-\w.:]+$/i;function C5e(e,t){const n=h8(t);let r=t,a=gc;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&A5e.test(t)){if(t.charAt(4)==="-"){const l=t.slice(5).replace(DH,I5e);r="data"+l.charAt(0).toUpperCase()+l.slice(1)}else{const l=t.slice(4);if(!DH.test(l)){let f=l.replace(S5e,k5e);f.charAt(0)!=="-"&&(f="-"+f),t="data"+f}}a=mN}return new a(r,t)}function k5e(e){return"-"+e.toLowerCase()}function I5e(e){return e.charAt(1).toUpperCase()}const R5e=gne([_ne,w5e,xne,bne,wne],"html"),gN=gne([_ne,T5e,xne,bne,wne],"svg");var _N={},NH=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,M5e=/\n/g,P5e=/^\s*/,O5e=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,L5e=/^:\s*/,D5e=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,N5e=/^[;\s]*/,z5e=/^\s+|\s+$/g,F5e=`
`,zH="/",FH="*",qg="",B5e="comment",j5e="declaration";function U5e(e,t){if(typeof e!="string")throw new TypeError("First argument must be a string");if(!e)return[];t=t||{};var n=1,r=1;function a(F){var U=F.match(M5e);U&&(n+=U.length);var q=F.lastIndexOf(F5e);r=~q?F.length-q:r+F.length}function l(){var F={line:n,column:r};return function(U){return U.position=new f(F),x(),U}}function f(F){this.start=F,this.end={line:n,column:r},this.source=t.source}f.prototype.content=e;function i(F){var U=new Error(t.source+":"+n+":"+r+": "+F);if(U.reason=F,U.filename=t.source,U.line=n,U.column=r,U.source=e,!t.silent)throw U}function y(F){var U=F.exec(e);if(U){var q=U[0];return a(q),e=e.slice(q.length),U}}function x(){y(P5e)}function S(F){var U;for(F=F||[];U=C();)U!==!1&&F.push(U);return F}function C(){var F=l();if(!(zH!=e.charAt(0)||FH!=e.charAt(1))){for(var U=2;qg!=e.charAt(U)&&(FH!=e.charAt(U)||zH!=e.charAt(U+1));)++U;if(U+=2,qg===e.charAt(U-1))return i("End of comment missing");var q=e.slice(2,U-2);return r+=2,a(q),e=e.slice(U),r+=2,F({type:B5e,comment:q})}}function P(){var F=l(),U=y(O5e);if(U){if(C(),!y(L5e))return i("property missing ':'");var q=y(D5e),G=F({type:j5e,property:BH(U[0].replace(NH,qg)),value:q?BH(q[0].replace(NH,qg)):qg});return y(N5e),G}}function L(){var F=[];S(F);for(var U;U=P();)U!==!1&&(F.push(U),S(F));return F}return x(),L()}function BH(e){return e?e.replace(z5e,qg):qg}var V5e=U5e,$5e=fp&&fp.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(_N,"__esModule",{value:!0});_N.default=G5e;const H5e=$5e(V5e);function G5e(e,t){let n=null;if(!e||typeof e!="string")return n;const r=(0,H5e.default)(e),a=typeof t=="function";return r.forEach(l=>{if(l.type!=="declaration")return;const{property:f,value:i}=l;a?t(f,i,l):i&&(n=n||{},n[f]=i)}),n}var nI={};Object.defineProperty(nI,"__esModule",{value:!0});nI.camelCase=void 0;var q5e=/^--[a-zA-Z0-9_-]+$/,Z5e=/-([a-z])/g,W5e=/^[^-]+$/,X5e=/^-(webkit|moz|ms|o|khtml)-/,Y5e=/^-(ms)-/,K5e=function(e){return!e||W5e.test(e)||q5e.test(e)},Q5e=function(e,t){return t.toUpperCase()},jH=function(e,t){return"".concat(t,"-")},J5e=function(e,t){return t===void 0&&(t={}),K5e(e)?e:(e=e.toLowerCase(),t.reactCompat?e=e.replace(Y5e,jH):e=e.replace(X5e,jH),e.replace(Z5e,Q5e))};nI.camelCase=J5e;var eRe=fp&&fp.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},tRe=eRe(_N),nRe=nI;function m8(e,t){var n={};return!e||typeof e!="string"||(0,tRe.default)(e,function(r,a){r&&a&&(n[(0,nRe.camelCase)(r,t)]=a)}),n}m8.default=m8;var rRe=m8;const iRe=UT(rRe);function V2(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?UH(e.position):"start"in e||"end"in e?UH(e):"line"in e||"column"in e?g8(e):""}function g8(e){return VH(e&&e.line)+":"+VH(e&&e.column)}function UH(e){return g8(e&&e.start)+"-"+g8(e&&e.end)}function VH(e){return e&&typeof e=="number"?e:1}class mu extends Error{constructor(t,n,r){super(),typeof n=="string"&&(r=n,n=void 0);let a="",l={},f=!1;if(n&&("line"in n&&"column"in n?l={place:n}:"start"in n&&"end"in n?l={place:n}:"type"in n?l={ancestors:[n],place:n.position}:l={...n}),typeof t=="string"?a=t:!l.cause&&t&&(f=!0,a=t.message,l.cause=t),!l.ruleId&&!l.source&&typeof r=="string"){const y=r.indexOf(":");y===-1?l.ruleId=r:(l.source=r.slice(0,y),l.ruleId=r.slice(y+1))}if(!l.place&&l.ancestors&&l.ancestors){const y=l.ancestors[l.ancestors.length-1];y&&(l.place=y.position)}const i=l.place&&"start"in l.place?l.place.start:l.place;this.ancestors=l.ancestors||void 0,this.cause=l.cause||void 0,this.column=i?i.column:void 0,this.fatal=void 0,this.file="",this.message=a,this.line=i?i.line:void 0,this.name=V2(l.place)||"1:1",this.place=l.place||void 0,this.reason=this.message,this.ruleId=l.ruleId||void 0,this.source=l.source||void 0,this.stack=f&&l.cause&&typeof l.cause.stack=="string"?l.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}mu.prototype.file="";mu.prototype.name="";mu.prototype.reason="";mu.prototype.message="";mu.prototype.stack="";mu.prototype.column=void 0;mu.prototype.line=void 0;mu.prototype.ancestors=void 0;mu.prototype.cause=void 0;mu.prototype.fatal=void 0;mu.prototype.place=void 0;mu.prototype.ruleId=void 0;mu.prototype.source=void 0;const yN={}.hasOwnProperty,sRe=new Map,aRe=/[A-Z]/g,oRe=new Set(["table","tbody","thead","tfoot","tr"]),lRe=new Set(["td","th"]),Tne="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function uRe(e,t){if(!t||t.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=t.filePath||void 0;let r;if(t.development){if(typeof t.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=_Re(n,t.jsxDEV)}else{if(typeof t.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof t.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=gRe(n,t.jsx,t.jsxs)}const a={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:r,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:t.passKeys!==!1,passNode:t.passNode||!1,schema:t.space==="svg"?gN:R5e,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:t.tableCellAlignToStyle!==!1},l=Ene(a,e,void 0);return l&&typeof l!="string"?l:a.create(e,a.Fragment,{children:l||void 0},void 0)}function Ene(e,t,n){if(t.type==="element")return cRe(e,t,n);if(t.type==="mdxFlowExpression"||t.type==="mdxTextExpression")return dRe(e,t);if(t.type==="mdxJsxFlowElement"||t.type==="mdxJsxTextElement")return fRe(e,t,n);if(t.type==="mdxjsEsm")return hRe(e,t);if(t.type==="root")return pRe(e,t,n);if(t.type==="text")return mRe(e,t)}function cRe(e,t,n){const r=e.schema;let a=r;t.tagName.toLowerCase()==="svg"&&r.space==="html"&&(a=gN,e.schema=a),e.ancestors.push(t);const l=Ane(e,t.tagName,!1),f=yRe(e,t);let i=xN(e,t);return oRe.has(t.tagName)&&(i=i.filter(function(y){return typeof y=="string"?!x5e(y):!0})),Sne(e,f,l,t),vN(f,i),e.ancestors.pop(),e.schema=r,e.create(t,l,f,n)}function dRe(e,t){if(t.data&&t.data.estree&&e.evaluater){const r=t.data.estree.body[0];return r.type,e.evaluater.evaluateExpression(r.expression)}MT(e,t.position)}function hRe(e,t){if(t.data&&t.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(t.data.estree);MT(e,t.position)}function fRe(e,t,n){const r=e.schema;let a=r;t.name==="svg"&&r.space==="html"&&(a=gN,e.schema=a),e.ancestors.push(t);const l=t.name===null?e.Fragment:Ane(e,t.name,!0),f=vRe(e,t),i=xN(e,t);return Sne(e,f,l,t),vN(f,i),e.ancestors.pop(),e.schema=r,e.create(t,l,f,n)}function pRe(e,t,n){const r={};return vN(r,xN(e,t)),e.create(t,e.Fragment,r,n)}function mRe(e,t){return t.value}function Sne(e,t,n,r){typeof n!="string"&&n!==e.Fragment&&e.passNode&&(t.node=r)}function vN(e,t){if(t.length>0){const n=t.length>1?t:t[0];n&&(e.children=n)}}function gRe(e,t,n){return r;function r(a,l,f,i){const x=Array.isArray(f.children)?n:t;return i?x(l,f,i):x(l,f)}}function _Re(e,t){return n;function n(r,a,l,f){const i=Array.isArray(l.children),y=If(r);return t(a,l,f,i,{columnNumber:y?y.column-1:void 0,fileName:e,lineNumber:y?y.line:void 0},void 0)}}function yRe(e,t){const n={};let r,a;for(a in t.properties)if(a!=="children"&&yN.call(t.properties,a)){const l=xRe(e,a,t.properties[a]);if(l){const[f,i]=l;e.tableCellAlignToStyle&&f==="align"&&typeof i=="string"&&lRe.has(t.tagName)?r=i:n[f]=i}}if(r){const l=n.style||(n.style={});l[e.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return n}function vRe(e,t){const n={};for(const r of t.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&e.evaluater){const l=r.data.estree.body[0];l.type;const f=l.expression;f.type;const i=f.properties[0];i.type,Object.assign(n,e.evaluater.evaluateExpression(i.argument))}else MT(e,t.position);else{const a=r.name;let l;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&e.evaluater){const i=r.value.data.estree.body[0];i.type,l=e.evaluater.evaluateExpression(i.expression)}else MT(e,t.position);else l=r.value===null?!0:r.value;n[a]=l}return n}function xN(e,t){const n=[];let r=-1;const a=e.passKeys?new Map:sRe;for(;++r<t.children.length;){const l=t.children[r];let f;if(e.passKeys){const y=l.type==="element"?l.tagName:l.type==="mdxJsxFlowElement"||l.type==="mdxJsxTextElement"?l.name:void 0;if(y){const x=a.get(y)||0;f=y+"-"+x,a.set(y,x+1)}}const i=Ene(e,l,f);i!==void 0&&n.push(i)}return n}function xRe(e,t,n){const r=C5e(e.schema,t);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?LX(n):OX(n)),r.property==="style"){let a=typeof n=="object"?n:bRe(e,String(n));return e.stylePropertyNameCase==="css"&&(a=wRe(a)),["style",a]}return[e.elementAttributeNameCase==="react"&&r.space?E5e[r.property]||r.property:r.attribute,n]}}function bRe(e,t){try{return iRe(t,{reactCompat:!0})}catch(n){if(e.ignoreInvalidStyle)return{};const r=n,a=new mu("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw a.file=e.filePath||void 0,a.url=Tne+"#cannot-parse-style-attribute",a}}function Ane(e,t,n){let r;if(!n)r={type:"Literal",value:t};else if(t.includes(".")){const a=t.split(".");let l=-1,f;for(;++l<a.length;){const i=PH(a[l])?{type:"Identifier",name:a[l]}:{type:"Literal",value:a[l]};f=f?{type:"MemberExpression",object:f,property:i,computed:!!(l&&i.type==="Literal"),optional:!1}:i}r=f}else r=PH(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t};if(r.type==="Literal"){const a=r.value;return yN.call(e.components,a)?e.components[a]:a}if(e.evaluater)return e.evaluater.evaluateExpression(r);MT(e)}function MT(e,t){const n=new mu("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=e.filePath||void 0,n.url=Tne+"#cannot-handle-mdx-estrees-without-createevaluater",n}function wRe(e){const t={};let n;for(n in e)yN.call(e,n)&&(t[TRe(n)]=e[n]);return t}function TRe(e){let t=e.replace(aRe,ERe);return t.slice(0,3)==="ms-"&&(t="-"+t),t}function ERe(e){return"-"+e.toLowerCase()}const SRe={tokenize:ARe};function ARe(e){const t=e.attempt(this.parser.constructs.contentInitial,r,a);let n;return t;function r(i){if(i===null){e.consume(i);return}return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),ra(e,t,"linePrefix")}function a(i){return e.enter("paragraph"),l(i)}function l(i){const y=e.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=y),n=y,f(i)}function f(i){if(i===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(i);return}return Ti(i)?(e.consume(i),e.exit("chunkText"),l):(e.consume(i),f)}}const CRe={tokenize:kRe},$H={tokenize:IRe};function kRe(e){const t=this,n=[];let r=0,a,l,f;return i;function i(X){if(r<n.length){const ie=n[r];return t.containerState=ie[1],e.attempt(ie[0].continuation,y,x)(X)}return x(X)}function y(X){if(r++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,a&&$();const ie=t.events.length;let de=ie,fe;for(;de--;)if(t.events[de][0]==="exit"&&t.events[de][1].type==="chunkFlow"){fe=t.events[de][1].end;break}G(r);let be=ie;for(;be<t.events.length;)t.events[be][1].end={...fe},be++;return Xl(t.events,de+1,0,t.events.slice(ie)),t.events.length=be,x(X)}return i(X)}function x(X){if(r===n.length){if(!a)return P(X);if(a.currentConstruct&&a.currentConstruct.concrete)return F(X);t.interrupt=!!(a.currentConstruct&&!a._gfmTableDynamicInterruptHack)}return t.containerState={},e.check($H,S,C)(X)}function S(X){return a&&$(),G(r),P(X)}function C(X){return t.parser.lazy[t.now().line]=r!==n.length,f=t.now().offset,F(X)}function P(X){return t.containerState={},e.attempt($H,L,F)(X)}function L(X){return r++,n.push([t.currentConstruct,t.containerState]),P(X)}function F(X){if(X===null){a&&$(),G(0),e.consume(X);return}return a=a||t.parser.flow(t.now()),e.enter("chunkFlow",{_tokenizer:a,contentType:"flow",previous:l}),U(X)}function U(X){if(X===null){q(e.exit("chunkFlow"),!0),G(0),e.consume(X);return}return Ti(X)?(e.consume(X),q(e.exit("chunkFlow")),r=0,t.interrupt=void 0,i):(e.consume(X),U)}function q(X,ie){const de=t.sliceStream(X);if(ie&&de.push(null),X.previous=l,l&&(l.next=X),l=X,a.defineSkip(X.start),a.write(de),t.parser.lazy[X.start.line]){let fe=a.events.length;for(;fe--;)if(a.events[fe][1].start.offset<f&&(!a.events[fe][1].end||a.events[fe][1].end.offset>f))return;const be=t.events.length;let ve=be,Je,we;for(;ve--;)if(t.events[ve][0]==="exit"&&t.events[ve][1].type==="chunkFlow"){if(Je){we=t.events[ve][1].end;break}Je=!0}for(G(r),fe=be;fe<t.events.length;)t.events[fe][1].end={...we},fe++;Xl(t.events,ve+1,0,t.events.slice(be)),t.events.length=fe}}function G(X){let ie=n.length;for(;ie-- >X;){const de=n[ie];t.containerState=de[1],de[0].exit.call(t,e)}n.length=X}function $(){a.write([null]),l=void 0,a=void 0,t.containerState._closeFlow=void 0}}function IRe(e,t,n){return ra(e,e.attempt(this.parser.constructs.document,t,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}const RRe={tokenize:MRe};function MRe(e){const t=this,n=e.attempt(pE,r,e.attempt(this.parser.constructs.flowInitial,a,ra(e,e.attempt(this.parser.constructs.flow,a,e.attempt(Fke,a)),"linePrefix")));return n;function r(l){if(l===null){e.consume(l);return}return e.enter("lineEndingBlank"),e.consume(l),e.exit("lineEndingBlank"),t.currentConstruct=void 0,n}function a(l){if(l===null){e.consume(l);return}return e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),t.currentConstruct=void 0,n}}const PRe={resolveAll:kne()},ORe=Cne("string"),LRe=Cne("text");function Cne(e){return{resolveAll:kne(e==="text"?DRe:void 0),tokenize:t};function t(n){const r=this,a=this.parser.constructs[e],l=n.attempt(a,f,i);return f;function f(S){return x(S)?l(S):i(S)}function i(S){if(S===null){n.consume(S);return}return n.enter("data"),n.consume(S),y}function y(S){return x(S)?(n.exit("data"),l(S)):(n.consume(S),y)}function x(S){if(S===null)return!0;const C=a[S];let P=-1;if(C)for(;++P<C.length;){const L=C[P];if(!L.previous||L.previous.call(r,r.previous))return!0}return!1}}}function kne(e){return t;function t(n,r){let a=-1,l;for(;++a<=n.length;)l===void 0?n[a]&&n[a][1].type==="data"&&(l=a,a++):(!n[a]||n[a][1].type!=="data")&&(a!==l+2&&(n[l][1].end=n[a-1][1].end,n.splice(l+2,a-l-2),a=l+2),l=void 0);return e?e(n,r):n}}function DRe(e,t){let n=0;for(;++n<=e.length;)if((n===e.length||e[n][1].type==="lineEnding")&&e[n-1][1].type==="data"){const r=e[n-1][1],a=t.sliceStream(r);let l=a.length,f=-1,i=0,y;for(;l--;){const x=a[l];if(typeof x=="string"){for(f=x.length;x.charCodeAt(f-1)===32;)i++,f--;if(f)break;f=-1}else if(x===-2)y=!0,i++;else if(x!==-1){l++;break}}if(t._contentTypeTextTrailing&&n===e.length&&(i=0),i){const x={type:n===e.length||y||i<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:l?f:r.start._bufferIndex+f,_index:r.start._index+l,line:r.end.line,column:r.end.column-i,offset:r.end.offset-i},end:{...r.end}};r.end={...x.start},r.start.offset===r.end.offset?Object.assign(r,x):(e.splice(n,0,["enter",x,t],["exit",x,t]),n+=2)}n++}return e}const NRe={42:Ju,43:Ju,45:Ju,48:Ju,49:Ju,50:Ju,51:Ju,52:Ju,53:Ju,54:Ju,55:Ju,56:Ju,57:Ju,62:ine},zRe={91:$ke},FRe={[-2]:BR,[-1]:BR,32:BR},BRe={35:Xke,42:gA,45:[kH,gA],60:Jke,61:kH,95:gA,96:AH,126:AH},jRe={38:ane,92:sne},URe={[-5]:jR,[-4]:jR,[-3]:jR,33:_Ie,38:ane,42:u8,60:[vke,aIe],91:vIe,92:[Zke,sne],93:pN,95:u8,96:Pke},VRe={null:[u8,PRe]},$Re={null:[42,95]},HRe={null:[]},GRe=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:$Re,contentInitial:zRe,disable:HRe,document:NRe,flow:BRe,flowInitial:FRe,insideSpan:VRe,string:jRe,text:URe},Symbol.toStringTag,{value:"Module"}));function qRe(e,t,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const a={},l=[];let f=[],i=[];const y={attempt:be(de),check:be(fe),consume:$,enter:X,exit:ie,interrupt:be(fe,{interrupt:!0})},x={code:null,containerState:{},defineSkip:U,events:[],now:F,parser:e,previous:null,sliceSerialize:P,sliceStream:L,write:C};let S=t.tokenize.call(x,y);return t.resolveAll&&l.push(t),x;function C(rt){return f=Zl(f,rt),q(),f[f.length-1]!==null?[]:(ve(t,0),x.events=Vx(l,x.events,x),x.events)}function P(rt,He){return WRe(L(rt),He)}function L(rt){return ZRe(f,rt)}function F(){const{_bufferIndex:rt,_index:He,line:ft,column:Ct,offset:Nt}=r;return{_bufferIndex:rt,_index:He,line:ft,column:Ct,offset:Nt}}function U(rt){a[rt.line]=rt.column,we()}function q(){let rt;for(;r._index<f.length;){const He=f[r._index];if(typeof He=="string")for(rt=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===rt&&r._bufferIndex<He.length;)G(He.charCodeAt(r._bufferIndex));else G(He)}}function G(rt){S=S(rt)}function $(rt){Ti(rt)?(r.line++,r.column=1,r.offset+=rt===-3?2:1,we()):rt!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===f[r._index].length&&(r._bufferIndex=-1,r._index++)),x.previous=rt}function X(rt,He){const ft=He||{};return ft.type=rt,ft.start=F(),x.events.push(["enter",ft,x]),i.push(ft),ft}function ie(rt){const He=i.pop();return He.end=F(),x.events.push(["exit",He,x]),He}function de(rt,He){ve(rt,He.from)}function fe(rt,He){He.restore()}function be(rt,He){return ft;function ft(Ct,Nt,Rt){let en,nt,pt,Oe;return Array.isArray(Ct)?wt(Ct):"tokenize"in Ct?wt([Ct]):gn(Ct);function gn(mn){return zn;function zn(yn){const qt=yn!==null&&mn[yn],wn=yn!==null&&mn.null,Sn=[...Array.isArray(qt)?qt:qt?[qt]:[],...Array.isArray(wn)?wn:wn?[wn]:[]];return wt(Sn)(yn)}}function wt(mn){return en=mn,nt=0,mn.length===0?Rt:Fe(mn[nt])}function Fe(mn){return zn;function zn(yn){return Oe=Je(),pt=mn,mn.partial||(x.currentConstruct=mn),mn.name&&x.parser.constructs.disable.null.includes(mn.name)?Tn():mn.tokenize.call(He?Object.assign(Object.create(x),He):x,y,jt,Tn)(yn)}}function jt(mn){return rt(pt,Oe),Nt}function Tn(mn){return Oe.restore(),++nt<en.length?Fe(en[nt]):Rt}}}function ve(rt,He){rt.resolveAll&&!l.includes(rt)&&l.push(rt),rt.resolve&&Xl(x.events,He,x.events.length-He,rt.resolve(x.events.slice(He),x)),rt.resolveTo&&(x.events=rt.resolveTo(x.events,x))}function Je(){const rt=F(),He=x.previous,ft=x.currentConstruct,Ct=x.events.length,Nt=Array.from(i);return{from:Ct,restore:Rt};function Rt(){r=rt,x.previous=He,x.currentConstruct=ft,x.events.length=Ct,i=Nt,we()}}function we(){r.line in a&&r.column<2&&(r.column=a[r.line],r.offset+=a[r.line]-1)}}function ZRe(e,t){const n=t.start._index,r=t.start._bufferIndex,a=t.end._index,l=t.end._bufferIndex;let f;if(n===a)f=[e[n].slice(r,l)];else{if(f=e.slice(n,a),r>-1){const i=f[0];typeof i=="string"?f[0]=i.slice(r):f.shift()}l>0&&f.push(e[a].slice(0,l))}return f}function WRe(e,t){let n=-1;const r=[];let a;for(;++n<e.length;){const l=e[n];let f;if(typeof l=="string")f=l;else switch(l){case-5:{f="\r";break}case-4:{f=`
`;break}case-3:{f=`\r
`;break}case-2:{f=t?" ":"	";break}case-1:{if(!t&&a)continue;f=" ";break}default:f=String.fromCharCode(l)}a=l===-2,r.push(f)}return r.join("")}function XRe(e){const r={constructs:Xte([GRe,...(e||{}).extensions||[]]),content:a(SRe),defined:[],document:a(CRe),flow:a(RRe),lazy:{},string:a(ORe),text:a(LRe)};return r;function a(l){return f;function f(i){return qRe(r,l,i)}}}function YRe(e){for(;!one(e););return e}const HH=/[\0\t\n\r]/g;function KRe(){let e=1,t="",n=!0,r;return a;function a(l,f,i){const y=[];let x,S,C,P,L;for(l=t+(typeof l=="string"?l.toString():new TextDecoder(f||void 0).decode(l)),C=0,t="",n&&(l.charCodeAt(0)===65279&&C++,n=void 0);C<l.length;){if(HH.lastIndex=C,x=HH.exec(l),P=x&&x.index!==void 0?x.index:l.length,L=l.charCodeAt(P),!x){t=l.slice(C);break}if(L===10&&C===P&&r)y.push(-3),r=void 0;else switch(r&&(y.push(-5),r=void 0),C<P&&(y.push(l.slice(C,P)),e+=P-C),L){case 0:{y.push(65533),e++;break}case 9:{for(S=Math.ceil(e/4)*4,y.push(-2);e++<S;)y.push(-1);break}case 10:{y.push(-4),e=1;break}default:r=!0,e=1}C=P+1}return i&&(r&&y.push(-5),t&&y.push(t),y.push(null)),y}}const Ine={}.hasOwnProperty;function QRe(e,t,n){return typeof t!="string"&&(n=t,t=void 0),JRe(n)(YRe(XRe(n).document().write(KRe()(e,t,!0))))}function JRe(e){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:l(wr),autolinkProtocol:Je,autolinkEmail:Je,atxHeading:l(Qr),blockQuote:l(wn),characterEscape:Je,characterReference:Je,codeFenced:l(Sn),codeFencedFenceInfo:f,codeFencedFenceMeta:f,codeIndented:l(Sn,f),codeText:l(Xn,f),codeTextData:Je,data:Je,codeFlowValue:Je,definition:l(rn),definitionDestinationString:f,definitionLabelString:f,definitionTitleString:f,emphasis:l(br),hardBreakEscape:l(sr),hardBreakTrailing:l(sr),htmlFlow:l(ar,f),htmlFlowData:Je,htmlText:l(ar,f),htmlTextData:Je,image:l(Vn),label:f,link:l(wr),listItem:l(Si),listItemValue:P,listOrdered:l(ys,C),listUnordered:l(ys),paragraph:l(Ri),reference:Fe,referenceString:f,resourceDestinationString:f,resourceTitleString:f,setextHeading:l(Qr),strong:l(ks),thematicBreak:l(Ws)},exit:{atxHeading:y(),atxHeadingSequence:de,autolink:y(),autolinkEmail:qt,autolinkProtocol:yn,blockQuote:y(),characterEscapeValue:we,characterReferenceMarkerHexadecimal:Tn,characterReferenceMarkerNumeric:Tn,characterReferenceValue:mn,characterReference:zn,codeFenced:y(q),codeFencedFence:U,codeFencedFenceInfo:L,codeFencedFenceMeta:F,codeFlowValue:we,codeIndented:y(G),codeText:y(Nt),codeTextData:we,data:we,definition:y(),definitionDestinationString:ie,definitionLabelString:$,definitionTitleString:X,emphasis:y(),hardBreakEscape:y(He),hardBreakTrailing:y(He),htmlFlow:y(ft),htmlFlowData:we,htmlText:y(Ct),htmlTextData:we,image:y(en),label:pt,labelText:nt,lineEnding:rt,link:y(Rt),listItem:y(),listOrdered:y(),listUnordered:y(),paragraph:y(),referenceString:jt,resourceDestinationString:Oe,resourceTitleString:gn,resource:wt,setextHeading:y(ve),setextHeadingLineSequence:be,setextHeadingText:fe,strong:y(),thematicBreak:y()}};Rne(t,(e||{}).mdastExtensions||[]);const n={};return r;function r(Kt){let An={type:"root",children:[]};const Lr={stack:[An],tokenStack:[],config:t,enter:i,exit:x,buffer:f,resume:S,data:n},Tt=[];let kn=-1;for(;++kn<Kt.length;)if(Kt[kn][1].type==="listOrdered"||Kt[kn][1].type==="listUnordered")if(Kt[kn][0]==="enter")Tt.push(kn);else{const nr=Tt.pop();kn=a(Kt,nr,kn)}for(kn=-1;++kn<Kt.length;){const nr=t[Kt[kn][0]];Ine.call(nr,Kt[kn][1].type)&&nr[Kt[kn][1].type].call(Object.assign({sliceSerialize:Kt[kn][2].sliceSerialize},Lr),Kt[kn][1])}if(Lr.tokenStack.length>0){const nr=Lr.tokenStack[Lr.tokenStack.length-1];(nr[1]||GH).call(Lr,void 0,nr[0])}for(An.position={start:Am(Kt.length>0?Kt[0][1].start:{line:1,column:1,offset:0}),end:Am(Kt.length>0?Kt[Kt.length-2][1].end:{line:1,column:1,offset:0})},kn=-1;++kn<t.transforms.length;)An=t.transforms[kn](An)||An;return An}function a(Kt,An,Lr){let Tt=An-1,kn=-1,nr=!1,dt,Qn,ti,Zi;for(;++Tt<=Lr;){const Is=Kt[Tt];switch(Is[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Is[0]==="enter"?kn++:kn--,Zi=void 0;break}case"lineEndingBlank":{Is[0]==="enter"&&(dt&&!Zi&&!kn&&!ti&&(ti=Tt),Zi=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Zi=void 0}if(!kn&&Is[0]==="enter"&&Is[1].type==="listItemPrefix"||kn===-1&&Is[0]==="exit"&&(Is[1].type==="listUnordered"||Is[1].type==="listOrdered")){if(dt){let Ln=Tt;for(Qn=void 0;Ln--;){const Hn=Kt[Ln];if(Hn[1].type==="lineEnding"||Hn[1].type==="lineEndingBlank"){if(Hn[0]==="exit")continue;Qn&&(Kt[Qn][1].type="lineEndingBlank",nr=!0),Hn[1].type="lineEnding",Qn=Ln}else if(!(Hn[1].type==="linePrefix"||Hn[1].type==="blockQuotePrefix"||Hn[1].type==="blockQuotePrefixWhitespace"||Hn[1].type==="blockQuoteMarker"||Hn[1].type==="listItemIndent"))break}ti&&(!Qn||ti<Qn)&&(dt._spread=!0),dt.end=Object.assign({},Qn?Kt[Qn][1].start:Is[1].end),Kt.splice(Qn||Tt,0,["exit",dt,Is[2]]),Tt++,Lr++}if(Is[1].type==="listItemPrefix"){const Ln={type:"listItem",_spread:!1,start:Object.assign({},Is[1].start),end:void 0};dt=Ln,Kt.splice(Tt,0,["enter",Ln,Is[2]]),Tt++,Lr++,ti=void 0,Zi=!0}}}return Kt[An][1]._spread=nr,Lr}function l(Kt,An){return Lr;function Lr(Tt){i.call(this,Kt(Tt),Tt),An&&An.call(this,Tt)}}function f(){this.stack.push({type:"fragment",children:[]})}function i(Kt,An,Lr){this.stack[this.stack.length-1].children.push(Kt),this.stack.push(Kt),this.tokenStack.push([An,Lr||void 0]),Kt.position={start:Am(An.start),end:void 0}}function y(Kt){return An;function An(Lr){Kt&&Kt.call(this,Lr),x.call(this,Lr)}}function x(Kt,An){const Lr=this.stack.pop(),Tt=this.tokenStack.pop();if(Tt)Tt[0].type!==Kt.type&&(An?An.call(this,Kt,Tt[0]):(Tt[1]||GH).call(this,Kt,Tt[0]));else throw new Error("Cannot close `"+Kt.type+"` ("+V2({start:Kt.start,end:Kt.end})+"): its not open");Lr.position.end=Am(Kt.end)}function S(){return dN(this.stack.pop())}function C(){this.data.expectingFirstListItemValue=!0}function P(Kt){if(this.data.expectingFirstListItemValue){const An=this.stack[this.stack.length-2];An.start=Number.parseInt(this.sliceSerialize(Kt),10),this.data.expectingFirstListItemValue=void 0}}function L(){const Kt=this.resume(),An=this.stack[this.stack.length-1];An.lang=Kt}function F(){const Kt=this.resume(),An=this.stack[this.stack.length-1];An.meta=Kt}function U(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function q(){const Kt=this.resume(),An=this.stack[this.stack.length-1];An.value=Kt.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function G(){const Kt=this.resume(),An=this.stack[this.stack.length-1];An.value=Kt.replace(/(\r?\n|\r)$/g,"")}function $(Kt){const An=this.resume(),Lr=this.stack[this.stack.length-1];Lr.label=An,Lr.identifier=mh(this.sliceSerialize(Kt)).toLowerCase()}function X(){const Kt=this.resume(),An=this.stack[this.stack.length-1];An.title=Kt}function ie(){const Kt=this.resume(),An=this.stack[this.stack.length-1];An.url=Kt}function de(Kt){const An=this.stack[this.stack.length-1];if(!An.depth){const Lr=this.sliceSerialize(Kt).length;An.depth=Lr}}function fe(){this.data.setextHeadingSlurpLineEnding=!0}function be(Kt){const An=this.stack[this.stack.length-1];An.depth=this.sliceSerialize(Kt).codePointAt(0)===61?1:2}function ve(){this.data.setextHeadingSlurpLineEnding=void 0}function Je(Kt){const Lr=this.stack[this.stack.length-1].children;let Tt=Lr[Lr.length-1];(!Tt||Tt.type!=="text")&&(Tt=$i(),Tt.position={start:Am(Kt.start),end:void 0},Lr.push(Tt)),this.stack.push(Tt)}function we(Kt){const An=this.stack.pop();An.value+=this.sliceSerialize(Kt),An.position.end=Am(Kt.end)}function rt(Kt){const An=this.stack[this.stack.length-1];if(this.data.atHardBreak){const Lr=An.children[An.children.length-1];Lr.position.end=Am(Kt.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(An.type)&&(Je.call(this,Kt),we.call(this,Kt))}function He(){this.data.atHardBreak=!0}function ft(){const Kt=this.resume(),An=this.stack[this.stack.length-1];An.value=Kt}function Ct(){const Kt=this.resume(),An=this.stack[this.stack.length-1];An.value=Kt}function Nt(){const Kt=this.resume(),An=this.stack[this.stack.length-1];An.value=Kt}function Rt(){const Kt=this.stack[this.stack.length-1];if(this.data.inReference){const An=this.data.referenceType||"shortcut";Kt.type+="Reference",Kt.referenceType=An,delete Kt.url,delete Kt.title}else delete Kt.identifier,delete Kt.label;this.data.referenceType=void 0}function en(){const Kt=this.stack[this.stack.length-1];if(this.data.inReference){const An=this.data.referenceType||"shortcut";Kt.type+="Reference",Kt.referenceType=An,delete Kt.url,delete Kt.title}else delete Kt.identifier,delete Kt.label;this.data.referenceType=void 0}function nt(Kt){const An=this.sliceSerialize(Kt),Lr=this.stack[this.stack.length-2];Lr.label=$Ce(An),Lr.identifier=mh(An).toLowerCase()}function pt(){const Kt=this.stack[this.stack.length-1],An=this.resume(),Lr=this.stack[this.stack.length-1];if(this.data.inReference=!0,Lr.type==="link"){const Tt=Kt.children;Lr.children=Tt}else Lr.alt=An}function Oe(){const Kt=this.resume(),An=this.stack[this.stack.length-1];An.url=Kt}function gn(){const Kt=this.resume(),An=this.stack[this.stack.length-1];An.title=Kt}function wt(){this.data.inReference=void 0}function Fe(){this.data.referenceType="collapsed"}function jt(Kt){const An=this.resume(),Lr=this.stack[this.stack.length-1];Lr.label=An,Lr.identifier=mh(this.sliceSerialize(Kt)).toLowerCase(),this.data.referenceType="full"}function Tn(Kt){this.data.characterReferenceType=Kt.type}function mn(Kt){const An=this.sliceSerialize(Kt),Lr=this.data.characterReferenceType;let Tt;Lr?(Tt=Wte(An,Lr==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):Tt=GL(An);const kn=this.stack[this.stack.length-1];kn.value+=Tt}function zn(Kt){const An=this.stack.pop();An.position.end=Am(Kt.end)}function yn(Kt){we.call(this,Kt);const An=this.stack[this.stack.length-1];An.url=this.sliceSerialize(Kt)}function qt(Kt){we.call(this,Kt);const An=this.stack[this.stack.length-1];An.url="mailto:"+this.sliceSerialize(Kt)}function wn(){return{type:"blockquote",children:[]}}function Sn(){return{type:"code",lang:null,meta:null,value:""}}function Xn(){return{type:"inlineCode",value:""}}function rn(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function br(){return{type:"emphasis",children:[]}}function Qr(){return{type:"heading",depth:0,children:[]}}function sr(){return{type:"break"}}function ar(){return{type:"html",value:""}}function Vn(){return{type:"image",title:null,url:"",alt:null}}function wr(){return{type:"link",title:null,url:"",children:[]}}function ys(Kt){return{type:"list",ordered:Kt.type==="listOrdered",start:null,spread:Kt._spread,children:[]}}function Si(Kt){return{type:"listItem",spread:Kt._spread,checked:null,children:[]}}function Ri(){return{type:"paragraph",children:[]}}function ks(){return{type:"strong",children:[]}}function $i(){return{type:"text",value:""}}function Ws(){return{type:"thematicBreak"}}}function Am(e){return{line:e.line,column:e.column,offset:e.offset}}function Rne(e,t){let n=-1;for(;++n<t.length;){const r=t[n];Array.isArray(r)?Rne(e,r):eMe(e,r)}}function eMe(e,t){let n;for(n in t)if(Ine.call(t,n))switch(n){case"canContainEols":{const r=t[n];r&&e[n].push(...r);break}case"transforms":{const r=t[n];r&&e[n].push(...r);break}case"enter":case"exit":{const r=t[n];r&&Object.assign(e[n],r);break}}}function GH(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+V2({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+V2({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+V2({start:t.start,end:t.end})+") is still open")}function tMe(e){const t=this;t.parser=n;function n(r){return QRe(r,{...t.data("settings"),...e,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}function nMe(e,t){const n={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(t),!0)};return e.patch(t,n),e.applyData(t,n)}function rMe(e,t){const n={type:"element",tagName:"br",properties:{},children:[]};return e.patch(t,n),[e.applyData(t,n),{type:"text",value:`
`}]}function iMe(e,t){const n=t.value?t.value+`
`:"",r={},a=t.lang?t.lang.split(/\s+/):[];a.length>0&&(r.className=["language-"+a[0]]);let l={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return t.meta&&(l.data={meta:t.meta}),e.patch(t,l),l=e.applyData(t,l),l={type:"element",tagName:"pre",properties:{},children:[l]},e.patch(t,l),l}function sMe(e,t){const n={type:"element",tagName:"del",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function aMe(e,t){const n={type:"element",tagName:"em",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function oMe(e,t){const n=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",r=String(t.identifier).toUpperCase(),a=$x(r.toLowerCase()),l=e.footnoteOrder.indexOf(r);let f,i=e.footnoteCounts.get(r);i===void 0?(i=0,e.footnoteOrder.push(r),f=e.footnoteOrder.length):f=l+1,i+=1,e.footnoteCounts.set(r,i);const y={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+a,id:n+"fnref-"+a+(i>1?"-"+i:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(f)}]};e.patch(t,y);const x={type:"element",tagName:"sup",properties:{},children:[y]};return e.patch(t,x),e.applyData(t,x)}function lMe(e,t){const n={type:"element",tagName:"h"+t.depth,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function uMe(e,t){if(e.options.allowDangerousHtml){const n={type:"raw",value:t.value};return e.patch(t,n),e.applyData(t,n)}}function Mne(e,t){const n=t.referenceType;let r="]";if(n==="collapsed"?r+="[]":n==="full"&&(r+="["+(t.label||t.identifier)+"]"),t.type==="imageReference")return[{type:"text",value:"!["+t.alt+r}];const a=e.all(t),l=a[0];l&&l.type==="text"?l.value="["+l.value:a.unshift({type:"text",value:"["});const f=a[a.length-1];return f&&f.type==="text"?f.value+=r:a.push({type:"text",value:r}),a}function cMe(e,t){const n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n);if(!r)return Mne(e,t);const a={src:$x(r.url||""),alt:t.alt};r.title!==null&&r.title!==void 0&&(a.title=r.title);const l={type:"element",tagName:"img",properties:a,children:[]};return e.patch(t,l),e.applyData(t,l)}function dMe(e,t){const n={src:$x(t.url)};t.alt!==null&&t.alt!==void 0&&(n.alt=t.alt),t.title!==null&&t.title!==void 0&&(n.title=t.title);const r={type:"element",tagName:"img",properties:n,children:[]};return e.patch(t,r),e.applyData(t,r)}function hMe(e,t){const n={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};e.patch(t,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return e.patch(t,r),e.applyData(t,r)}function fMe(e,t){const n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n);if(!r)return Mne(e,t);const a={href:$x(r.url||"")};r.title!==null&&r.title!==void 0&&(a.title=r.title);const l={type:"element",tagName:"a",properties:a,children:e.all(t)};return e.patch(t,l),e.applyData(t,l)}function pMe(e,t){const n={href:$x(t.url)};t.title!==null&&t.title!==void 0&&(n.title=t.title);const r={type:"element",tagName:"a",properties:n,children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function mMe(e,t,n){const r=e.all(t),a=n?gMe(n):Pne(t),l={},f=[];if(typeof t.checked=="boolean"){const S=r[0];let C;S&&S.type==="element"&&S.tagName==="p"?C=S:(C={type:"element",tagName:"p",properties:{},children:[]},r.unshift(C)),C.children.length>0&&C.children.unshift({type:"text",value:" "}),C.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),l.className=["task-list-item"]}let i=-1;for(;++i<r.length;){const S=r[i];(a||i!==0||S.type!=="element"||S.tagName!=="p")&&f.push({type:"text",value:`
`}),S.type==="element"&&S.tagName==="p"&&!a?f.push(...S.children):f.push(S)}const y=r[r.length-1];y&&(a||y.type!=="element"||y.tagName!=="p")&&f.push({type:"text",value:`
`});const x={type:"element",tagName:"li",properties:l,children:f};return e.patch(t,x),e.applyData(t,x)}function gMe(e){let t=!1;if(e.type==="list"){t=e.spread||!1;const n=e.children;let r=-1;for(;!t&&++r<n.length;)t=Pne(n[r])}return t}function Pne(e){const t=e.spread;return t??e.children.length>1}function _Me(e,t){const n={},r=e.all(t);let a=-1;for(typeof t.start=="number"&&t.start!==1&&(n.start=t.start);++a<r.length;){const f=r[a];if(f.type==="element"&&f.tagName==="li"&&f.properties&&Array.isArray(f.properties.className)&&f.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const l={type:"element",tagName:t.ordered?"ol":"ul",properties:n,children:e.wrap(r,!0)};return e.patch(t,l),e.applyData(t,l)}function yMe(e,t){const n={type:"element",tagName:"p",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function vMe(e,t){const n={type:"root",children:e.wrap(e.all(t))};return e.patch(t,n),e.applyData(t,n)}function xMe(e,t){const n={type:"element",tagName:"strong",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function bMe(e,t){const n=e.all(t),r=n.shift(),a=[];if(r){const f={type:"element",tagName:"thead",properties:{},children:e.wrap([r],!0)};e.patch(t.children[0],f),a.push(f)}if(n.length>0){const f={type:"element",tagName:"tbody",properties:{},children:e.wrap(n,!0)},i=If(t.children[1]),y=Qk(t.children[t.children.length-1]);i&&y&&(f.position={start:i,end:y}),a.push(f)}const l={type:"element",tagName:"table",properties:{},children:e.wrap(a,!0)};return e.patch(t,l),e.applyData(t,l)}function wMe(e,t,n){const r=n?n.children:void 0,l=(r?r.indexOf(t):1)===0?"th":"td",f=n&&n.type==="table"?n.align:void 0,i=f?f.length:t.children.length;let y=-1;const x=[];for(;++y<i;){const C=t.children[y],P={},L=f?f[y]:void 0;L&&(P.align=L);let F={type:"element",tagName:l,properties:P,children:[]};C&&(F.children=e.all(C),e.patch(C,F),F=e.applyData(C,F)),x.push(F)}const S={type:"element",tagName:"tr",properties:{},children:e.wrap(x,!0)};return e.patch(t,S),e.applyData(t,S)}function TMe(e,t){const n={type:"element",tagName:"td",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function EMe(e,t){const n={type:"text",value:Ufe(String(t.value))};return e.patch(t,n),e.applyData(t,n)}function SMe(e,t){const n={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(t,n),e.applyData(t,n)}const AMe={blockquote:nMe,break:rMe,code:iMe,delete:sMe,emphasis:aMe,footnoteReference:oMe,heading:lMe,html:uMe,imageReference:cMe,image:dMe,inlineCode:hMe,linkReference:fMe,link:pMe,listItem:mMe,list:_Me,paragraph:yMe,root:vMe,strong:xMe,table:bMe,tableCell:TMe,tableRow:wMe,text:EMe,thematicBreak:SMe,toml:u4,yaml:u4,definition:u4,footnoteDefinition:u4};function u4(){}function CMe(e,t){const n=[{type:"text",value:""}];return t>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),n}function kMe(e,t){return"Back to reference "+(e+1)+(t>1?"-"+t:"")}function IMe(e){const t=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",n=e.options.footnoteBackContent||CMe,r=e.options.footnoteBackLabel||kMe,a=e.options.footnoteLabel||"Footnotes",l=e.options.footnoteLabelTagName||"h2",f=e.options.footnoteLabelProperties||{className:["sr-only"]},i=[];let y=-1;for(;++y<e.footnoteOrder.length;){const x=e.footnoteById.get(e.footnoteOrder[y]);if(!x)continue;const S=e.all(x),C=String(x.identifier).toUpperCase(),P=$x(C.toLowerCase());let L=0;const F=[],U=e.footnoteCounts.get(C);for(;U!==void 0&&++L<=U;){F.length>0&&F.push({type:"text",value:" "});let $=typeof n=="string"?n:n(y,L);typeof $=="string"&&($={type:"text",value:$}),F.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+P+(L>1?"-"+L:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(y,L),className:["data-footnote-backref"]},children:Array.isArray($)?$:[$]})}const q=S[S.length-1];if(q&&q.type==="element"&&q.tagName==="p"){const $=q.children[q.children.length-1];$&&$.type==="text"?$.value+=" ":q.children.push({type:"text",value:" "}),q.children.push(...F)}else S.push(...F);const G={type:"element",tagName:"li",properties:{id:t+"fn-"+P},children:e.wrap(S,!0)};e.patch(x,G),i.push(G)}if(i.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:l,properties:{...P_(f),id:"footnote-label"},children:[{type:"text",value:a}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:e.wrap(i,!0)},{type:"text",value:`
`}]}}function RMe(e,t,n,r){let a,l,f;typeof t=="function"&&typeof n!="function"?(l=void 0,f=t,a=n):(l=t,f=n,a=r),Ox(e,l,i,a);function i(y,x){const S=x[x.length-1],C=S?S.children.indexOf(y):void 0;return f(y,C,S)}}const _8={}.hasOwnProperty,MMe={};function PMe(e,t){const n=t||MMe,r=new Map,a=new Map,l=new Map,f={...AMe,...n.handlers},i={all:x,applyData:LMe,definitionById:r,footnoteById:a,footnoteCounts:l,footnoteOrder:[],handlers:f,one:y,options:n,patch:OMe,wrap:NMe};return RMe(e,function(S){if(S.type==="definition"||S.type==="footnoteDefinition"){const C=S.type==="definition"?r:a,P=String(S.identifier).toUpperCase();C.has(P)||C.set(P,S)}}),i;function y(S,C){const P=S.type,L=i.handlers[P];if(_8.call(i.handlers,P)&&L)return L(i,S,C);if(i.options.passThrough&&i.options.passThrough.includes(P)){if("children"in S){const{children:U,...q}=S,G=P_(q);return G.children=i.all(S),G}return P_(S)}return(i.options.unknownHandler||DMe)(i,S,C)}function x(S){const C=[];if("children"in S){const P=S.children;let L=-1;for(;++L<P.length;){const F=i.one(P[L],S);if(F){if(L&&P[L-1].type==="break"&&(!Array.isArray(F)&&F.type==="text"&&(F.value=qH(F.value)),!Array.isArray(F)&&F.type==="element")){const U=F.children[0];U&&U.type==="text"&&(U.value=qH(U.value))}Array.isArray(F)?C.push(...F):C.push(F)}}}return C}}function OMe(e,t){e.position&&(t.position=gte(e))}function LMe(e,t){let n=t;if(e&&e.data){const r=e.data.hName,a=e.data.hChildren,l=e.data.hProperties;if(typeof r=="string")if(n.type==="element")n.tagName=r;else{const f="children"in n?n.children:[n];n={type:"element",tagName:r,properties:{},children:f}}n.type==="element"&&l&&Object.assign(n.properties,P_(l)),"children"in n&&n.children&&a!==null&&a!==void 0&&(n.children=a)}return n}function DMe(e,t){const n=t.data||{},r="value"in t&&!(_8.call(n,"hProperties")||_8.call(n,"hChildren"))?{type:"text",value:t.value}:{type:"element",tagName:"div",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function NMe(e,t){const n=[];let r=-1;for(t&&n.push({type:"text",value:`
`});++r<e.length;)r&&n.push({type:"text",value:`
`}),n.push(e[r]);return t&&e.length>0&&n.push({type:"text",value:`
`}),n}function qH(e){let t=0,n=e.charCodeAt(t);for(;n===9||n===32;)t++,n=e.charCodeAt(t);return e.slice(t)}function ZH(e,t){const n=PMe(e,t),r=n.one(e,void 0),a=IMe(n),l=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return a&&l.children.push({type:"text",value:`
`},a),l}function zMe(e,t){return e&&"run"in e?async function(n,r){const a=ZH(n,{file:r,...t});await e.run(a,r)}:function(n,r){return ZH(n,{file:r,...e||t})}}const ef={basename:FMe,dirname:BMe,extname:jMe,join:UMe,sep:"/"};function FMe(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');gE(e);let n=0,r=-1,a=e.length,l;if(t===void 0||t.length===0||t.length>e.length){for(;a--;)if(e.codePointAt(a)===47){if(l){n=a+1;break}}else r<0&&(l=!0,r=a+1);return r<0?"":e.slice(n,r)}if(t===e)return"";let f=-1,i=t.length-1;for(;a--;)if(e.codePointAt(a)===47){if(l){n=a+1;break}}else f<0&&(l=!0,f=a+1),i>-1&&(e.codePointAt(a)===t.codePointAt(i--)?i<0&&(r=a):(i=-1,r=f));return n===r?r=f:r<0&&(r=e.length),e.slice(n,r)}function BMe(e){if(gE(e),e.length===0)return".";let t=-1,n=e.length,r;for(;--n;)if(e.codePointAt(n)===47){if(r){t=n;break}}else r||(r=!0);return t<0?e.codePointAt(0)===47?"/":".":t===1&&e.codePointAt(0)===47?"//":e.slice(0,t)}function jMe(e){gE(e);let t=e.length,n=-1,r=0,a=-1,l=0,f;for(;t--;){const i=e.codePointAt(t);if(i===47){if(f){r=t+1;break}continue}n<0&&(f=!0,n=t+1),i===46?a<0?a=t:l!==1&&(l=1):a>-1&&(l=-1)}return a<0||n<0||l===0||l===1&&a===n-1&&a===r+1?"":e.slice(a,n)}function UMe(...e){let t=-1,n;for(;++t<e.length;)gE(e[t]),e[t]&&(n=n===void 0?e[t]:n+"/"+e[t]);return n===void 0?".":VMe(n)}function VMe(e){gE(e);const t=e.codePointAt(0)===47;let n=$Me(e,!t);return n.length===0&&!t&&(n="."),n.length>0&&e.codePointAt(e.length-1)===47&&(n+="/"),t?"/"+n:n}function $Me(e,t){let n="",r=0,a=-1,l=0,f=-1,i,y;for(;++f<=e.length;){if(f<e.length)i=e.codePointAt(f);else{if(i===47)break;i=47}if(i===47){if(!(a===f-1||l===1))if(a!==f-1&&l===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(y=n.lastIndexOf("/"),y!==n.length-1){y<0?(n="",r=0):(n=n.slice(0,y),r=n.length-1-n.lastIndexOf("/")),a=f,l=0;continue}}else if(n.length>0){n="",r=0,a=f,l=0;continue}}t&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+e.slice(a+1,f):n=e.slice(a+1,f),r=f-a-1;a=f,l=0}else i===46&&l>-1?l++:l=-1}return n}function gE(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const HMe={cwd:GMe};function GMe(){return"/"}function y8(e){return!!(e!==null&&typeof e=="object"&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&e.auth===void 0)}function qMe(e){if(typeof e=="string")e=new URL(e);else if(!y8(e)){const t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if(e.protocol!=="file:"){const t=new TypeError("The URL must be of scheme file");throw t.code="ERR_INVALID_URL_SCHEME",t}return ZMe(e)}function ZMe(e){if(e.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const t=e.pathname;let n=-1;for(;++n<t.length;)if(t.codePointAt(n)===37&&t.codePointAt(n+1)===50){const r=t.codePointAt(n+2);if(r===70||r===102){const a=new TypeError("File URL path must not include encoded / characters");throw a.code="ERR_INVALID_FILE_URL_PATH",a}}return decodeURIComponent(t)}const VR=["history","path","basename","stem","extname","dirname"];class WMe{constructor(t){let n;t?y8(t)?n={path:t}:typeof t=="string"||XMe(t)?n={value:t}:n=t:n={},this.cwd="cwd"in n?"":HMe.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<VR.length;){const l=VR[r];l in n&&n[l]!==void 0&&n[l]!==null&&(this[l]=l==="history"?[...n[l]]:n[l])}let a;for(a in n)VR.includes(a)||(this[a]=n[a])}get basename(){return typeof this.path=="string"?ef.basename(this.path):void 0}set basename(t){HR(t,"basename"),$R(t,"basename"),this.path=ef.join(this.dirname||"",t)}get dirname(){return typeof this.path=="string"?ef.dirname(this.path):void 0}set dirname(t){WH(this.basename,"dirname"),this.path=ef.join(t||"",this.basename)}get extname(){return typeof this.path=="string"?ef.extname(this.path):void 0}set extname(t){if($R(t,"extname"),WH(this.dirname,"extname"),t){if(t.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(t.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=ef.join(this.dirname,this.stem+(t||""))}get path(){return this.history[this.history.length-1]}set path(t){y8(t)&&(t=qMe(t)),HR(t,"path"),this.path!==t&&this.history.push(t)}get stem(){return typeof this.path=="string"?ef.basename(this.path,this.extname):void 0}set stem(t){HR(t,"stem"),$R(t,"stem"),this.path=ef.join(this.dirname||"",t+(this.extname||""))}fail(t,n,r){const a=this.message(t,n,r);throw a.fatal=!0,a}info(t,n,r){const a=this.message(t,n,r);return a.fatal=void 0,a}message(t,n,r){const a=new mu(t,n,r);return this.path&&(a.name=this.path+":"+a.name,a.file=this.path),a.fatal=!1,this.messages.push(a),a}toString(t){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(t||void 0).decode(this.value)}}function $R(e,t){if(e&&e.includes(ef.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+ef.sep+"`")}function HR(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function WH(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}function XMe(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const YMe=function(e){const r=this.constructor.prototype,a=r[e],l=function(){return a.apply(l,arguments)};return Object.setPrototypeOf(l,r),l},KMe={}.hasOwnProperty;class bN extends YMe{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=Bfe()}copy(){const t=new bN;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];t.use(...r)}return t.data($5(!0,{},this.namespace)),t}data(t,n){return typeof t=="string"?arguments.length===2?(ZR("data",this.frozen),this.namespace[t]=n,this):KMe.call(this.namespace,t)&&this.namespace[t]||void 0:t?(ZR("data",this.frozen),this.namespace=t,this):this.namespace}freeze(){if(this.frozen)return this;const t=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const a=n.call(t,...r);typeof a=="function"&&this.transformers.use(a)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(t){this.freeze();const n=c4(t),r=this.parser||this.Parser;return GR("parse",r),r(String(n),n)}process(t,n){const r=this;return this.freeze(),GR("process",this.parser||this.Parser),qR("process",this.compiler||this.Compiler),n?a(void 0,n):new Promise(a);function a(l,f){const i=c4(t),y=r.parse(i);r.run(y,i,function(S,C,P){if(S||!C||!P)return x(S);const L=C,F=r.stringify(L,P);ePe(F)?P.value=F:P.result=F,x(S,P)});function x(S,C){S||!C?f(S):l?l(C):n(void 0,C)}}}processSync(t){let n=!1,r;return this.freeze(),GR("processSync",this.parser||this.Parser),qR("processSync",this.compiler||this.Compiler),this.process(t,a),YH("processSync","process",n),r;function a(l,f){n=!0,Bj(l),r=f}}run(t,n,r){XH(t),this.freeze();const a=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?l(void 0,r):new Promise(l);function l(f,i){const y=c4(n);a.run(t,y,x);function x(S,C,P){const L=C||t;S?i(S):f?f(L):r(void 0,L,P)}}}runSync(t,n){let r=!1,a;return this.run(t,n,l),YH("runSync","run",r),a;function l(f,i){Bj(f),a=i,r=!0}}stringify(t,n){this.freeze();const r=c4(n),a=this.compiler||this.Compiler;return qR("stringify",a),XH(t),a(t,r)}use(t,...n){const r=this.attachers,a=this.namespace;if(ZR("use",this.frozen),t!=null)if(typeof t=="function")y(t,n);else if(typeof t=="object")Array.isArray(t)?i(t):f(t);else throw new TypeError("Expected usable value, not `"+t+"`");return this;function l(x){if(typeof x=="function")y(x,[]);else if(typeof x=="object")if(Array.isArray(x)){const[S,...C]=x;y(S,C)}else f(x);else throw new TypeError("Expected usable value, not `"+x+"`")}function f(x){if(!("plugins"in x)&&!("settings"in x))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");i(x.plugins),x.settings&&(a.settings=$5(!0,a.settings,x.settings))}function i(x){let S=-1;if(x!=null)if(Array.isArray(x))for(;++S<x.length;){const C=x[S];l(C)}else throw new TypeError("Expected a list of plugins, not `"+x+"`")}function y(x,S){let C=-1,P=-1;for(;++C<r.length;)if(r[C][0]===x){P=C;break}if(P===-1)r.push([x,...S]);else if(S.length>0){let[L,...F]=S;const U=r[P][1];zP(U)&&zP(L)&&(L=$5(!0,U,L)),r[P]=[x,L,...F]}}}}const QMe=new bN().freeze();function GR(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `parser`")}function qR(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `compiler`")}function ZR(e,t){if(t)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function XH(e){if(!zP(e)||typeof e.type!="string")throw new TypeError("Expected node, got `"+e+"`")}function YH(e,t,n){if(!n)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}function c4(e){return JMe(e)?e:new WMe(e)}function JMe(e){return!!(e&&typeof e=="object"&&"message"in e&&"messages"in e)}function ePe(e){return typeof e=="string"||tPe(e)}function tPe(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}function wN(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var J_=wN();function One(e){J_=e}var $2={exec:()=>null};function za(e,t=""){let n=typeof e=="string"?e:e.source,r={replace:(a,l)=>{let f=typeof l=="string"?l:l.source;return f=f.replace(Lu.caret,"$1"),n=n.replace(a,f),r},getRegex:()=>new RegExp(n,t)};return r}var nPe=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),Lu={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>new RegExp(`^( {0,3}${e})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}#`),htmlBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}<(?:[a-z].*>|!--)`,"i")},rPe=/^(?:[ \t]*(?:\n|$))+/,iPe=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,sPe=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,_E=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,aPe=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,TN=/(?:[*+-]|\d{1,9}[.)])/,Lne=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Dne=za(Lne).replace(/bull/g,TN).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),oPe=za(Lne).replace(/bull/g,TN).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),EN=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,lPe=/^[^\n]+/,SN=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,uPe=za(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",SN).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),cPe=za(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,TN).getRegex(),rI="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",AN=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,dPe=za("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",AN).replace("tag",rI).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Nne=za(EN).replace("hr",_E).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",rI).getRegex(),hPe=za(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Nne).getRegex(),CN={blockquote:hPe,code:iPe,def:uPe,fences:sPe,heading:aPe,hr:_E,html:dPe,lheading:Dne,list:cPe,newline:rPe,paragraph:Nne,table:$2,text:lPe},KH=za("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",_E).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",rI).getRegex(),fPe={...CN,lheading:oPe,table:KH,paragraph:za(EN).replace("hr",_E).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",KH).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",rI).getRegex()},pPe={...CN,html:za(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",AN).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:$2,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:za(EN).replace("hr",_E).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Dne).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},mPe=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,gPe=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,zne=/^( {2,}|\\)\n(?!\s*$)/,_Pe=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,iI=/[\p{P}\p{S}]/u,kN=/[\s\p{P}\p{S}]/u,Fne=/[^\s\p{P}\p{S}]/u,yPe=za(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,kN).getRegex(),Bne=/(?!~)[\p{P}\p{S}]/u,vPe=/(?!~)[\s\p{P}\p{S}]/u,xPe=/(?:[^\s\p{P}\p{S}]|~)/u,bPe=za(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",nPe?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),jne=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,wPe=za(jne,"u").replace(/punct/g,iI).getRegex(),TPe=za(jne,"u").replace(/punct/g,Bne).getRegex(),Une="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",EPe=za(Une,"gu").replace(/notPunctSpace/g,Fne).replace(/punctSpace/g,kN).replace(/punct/g,iI).getRegex(),SPe=za(Une,"gu").replace(/notPunctSpace/g,xPe).replace(/punctSpace/g,vPe).replace(/punct/g,Bne).getRegex(),APe=za("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Fne).replace(/punctSpace/g,kN).replace(/punct/g,iI).getRegex(),CPe=za(/\\(punct)/,"gu").replace(/punct/g,iI).getRegex(),kPe=za(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),IPe=za(AN).replace("(?:-->|$)","-->").getRegex(),RPe=za("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",IPe).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),qC=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,MPe=za(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",qC).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Vne=za(/^!?\[(label)\]\[(ref)\]/).replace("label",qC).replace("ref",SN).getRegex(),$ne=za(/^!?\[(ref)\](?:\[\])?/).replace("ref",SN).getRegex(),PPe=za("reflink|nolink(?!\\()","g").replace("reflink",Vne).replace("nolink",$ne).getRegex(),QH=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,IN={_backpedal:$2,anyPunctuation:CPe,autolink:kPe,blockSkip:bPe,br:zne,code:gPe,del:$2,emStrongLDelim:wPe,emStrongRDelimAst:EPe,emStrongRDelimUnd:APe,escape:mPe,link:MPe,nolink:$ne,punctuation:yPe,reflink:Vne,reflinkSearch:PPe,tag:RPe,text:_Pe,url:$2},OPe={...IN,link:za(/^!?\[(label)\]\((.*?)\)/).replace("label",qC).getRegex(),reflink:za(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",qC).getRegex()},v8={...IN,emStrongRDelimAst:SPe,emStrongLDelim:TPe,url:za(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",QH).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:za(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",QH).getRegex()},LPe={...v8,br:za(zne).replace("{2,}","*").getRegex(),text:za(v8.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},d4={normal:CN,gfm:fPe,pedantic:pPe},e2={normal:IN,gfm:v8,breaks:LPe,pedantic:OPe},DPe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},JH=e=>DPe[e];function Kh(e,t){if(t){if(Lu.escapeTest.test(e))return e.replace(Lu.escapeReplace,JH)}else if(Lu.escapeTestNoEncode.test(e))return e.replace(Lu.escapeReplaceNoEncode,JH);return e}function eG(e){try{e=encodeURI(e).replace(Lu.percentDecode,"%")}catch{return null}return e}function tG(e,t){var l;let n=e.replace(Lu.findPipe,(f,i,y)=>{let x=!1,S=i;for(;--S>=0&&y[S]==="\\";)x=!x;return x?"|":" |"}),r=n.split(Lu.splitPipe),a=0;if(r[0].trim()||r.shift(),r.length>0&&!((l=r.at(-1))!=null&&l.trim())&&r.pop(),t)if(r.length>t)r.splice(t);else for(;r.length<t;)r.push("");for(;a<r.length;a++)r[a]=r[a].trim().replace(Lu.slashPipe,"|");return r}function t2(e,t,n){let r=e.length;if(r===0)return"";let a=0;for(;a<r&&e.charAt(r-a-1)===t;)a++;return e.slice(0,r-a)}function NPe(e,t){if(e.indexOf(t[1])===-1)return-1;let n=0;for(let r=0;r<e.length;r++)if(e[r]==="\\")r++;else if(e[r]===t[0])n++;else if(e[r]===t[1]&&(n--,n<0))return r;return n>0?-2:-1}function nG(e,t,n,r,a){let l=t.href,f=t.title||null,i=e[1].replace(a.other.outputLinkReplace,"$1");r.state.inLink=!0;let y={type:e[0].charAt(0)==="!"?"image":"link",raw:n,href:l,title:f,text:i,tokens:r.inlineTokens(i)};return r.state.inLink=!1,y}function zPe(e,t,n){let r=e.match(n.other.indentCodeCompensation);if(r===null)return t;let a=r[1];return t.split(`
`).map(l=>{let f=l.match(n.other.beginningSpace);if(f===null)return l;let[i]=f;return i.length>=a.length?l.slice(a.length):l}).join(`
`)}var ZC=class{constructor(e){wi(this,"options");wi(this,"rules");wi(this,"lexer");this.options=e||J_}space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let n=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:t2(n,`
`)}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let n=t[0],r=zPe(n,t[3]||"",this.rules);return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:r}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(this.rules.other.endingHash.test(n)){let r=t2(n,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(n=r.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t2(t[0],`
`)}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let n=t2(t[0],`
`).split(`
`),r="",a="",l=[];for(;n.length>0;){let f=!1,i=[],y;for(y=0;y<n.length;y++)if(this.rules.other.blockquoteStart.test(n[y]))i.push(n[y]),f=!0;else if(!f)i.push(n[y]);else break;n=n.slice(y);let x=i.join(`
`),S=x.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${x}`:x,a=a?`${a}
${S}`:S;let C=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(S,l,!0),this.lexer.state.top=C,n.length===0)break;let P=l.at(-1);if((P==null?void 0:P.type)==="code")break;if((P==null?void 0:P.type)==="blockquote"){let L=P,F=L.raw+`
`+n.join(`
`),U=this.blockquote(F);l[l.length-1]=U,r=r.substring(0,r.length-L.raw.length)+U.raw,a=a.substring(0,a.length-L.text.length)+U.text;break}else if((P==null?void 0:P.type)==="list"){let L=P,F=L.raw+`
`+n.join(`
`),U=this.list(F);l[l.length-1]=U,r=r.substring(0,r.length-P.raw.length)+U.raw,a=a.substring(0,a.length-L.raw.length)+U.raw,n=F.substring(l.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:l,text:a}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim(),r=n.length>1,a={type:"list",raw:"",ordered:r,start:r?+n.slice(0,-1):"",loose:!1,items:[]};n=r?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=r?n:"[*+-]");let l=this.rules.other.listItemRegex(n),f=!1;for(;e;){let y=!1,x="",S="";if(!(t=l.exec(e))||this.rules.block.hr.test(e))break;x=t[0],e=e.substring(x.length);let C=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,G=>" ".repeat(3*G.length)),P=e.split(`
`,1)[0],L=!C.trim(),F=0;if(this.options.pedantic?(F=2,S=C.trimStart()):L?F=t[1].length+1:(F=t[2].search(this.rules.other.nonSpaceChar),F=F>4?1:F,S=C.slice(F),F+=t[1].length),L&&this.rules.other.blankLine.test(P)&&(x+=P+`
`,e=e.substring(P.length+1),y=!0),!y){let G=this.rules.other.nextBulletRegex(F),$=this.rules.other.hrRegex(F),X=this.rules.other.fencesBeginRegex(F),ie=this.rules.other.headingBeginRegex(F),de=this.rules.other.htmlBeginRegex(F);for(;e;){let fe=e.split(`
`,1)[0],be;if(P=fe,this.options.pedantic?(P=P.replace(this.rules.other.listReplaceNesting,"  "),be=P):be=P.replace(this.rules.other.tabCharGlobal,"    "),X.test(P)||ie.test(P)||de.test(P)||G.test(P)||$.test(P))break;if(be.search(this.rules.other.nonSpaceChar)>=F||!P.trim())S+=`
`+be.slice(F);else{if(L||C.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||X.test(C)||ie.test(C)||$.test(C))break;S+=`
`+P}!L&&!P.trim()&&(L=!0),x+=fe+`
`,e=e.substring(fe.length+1),C=be.slice(F)}}a.loose||(f?a.loose=!0:this.rules.other.doubleBlankLine.test(x)&&(f=!0));let U=null,q;this.options.gfm&&(U=this.rules.other.listIsTask.exec(S),U&&(q=U[0]!=="[ ] ",S=S.replace(this.rules.other.listReplaceTask,""))),a.items.push({type:"list_item",raw:x,task:!!U,checked:q,loose:!1,text:S,tokens:[]}),a.raw+=x}let i=a.items.at(-1);if(i)i.raw=i.raw.trimEnd(),i.text=i.text.trimEnd();else return;a.raw=a.raw.trimEnd();for(let y=0;y<a.items.length;y++)if(this.lexer.state.top=!1,a.items[y].tokens=this.lexer.blockTokens(a.items[y].text,[]),!a.loose){let x=a.items[y].tokens.filter(C=>C.type==="space"),S=x.length>0&&x.some(C=>this.rules.other.anyLine.test(C.raw));a.loose=S}if(a.loose)for(let y=0;y<a.items.length;y++)a.items[y].loose=!0;return a}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let n=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:r,title:a}}}table(e){var f;let t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let n=tG(t[1]),r=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),a=(f=t[3])!=null&&f.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],l={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===r.length){for(let i of r)this.rules.other.tableAlignRight.test(i)?l.align.push("right"):this.rules.other.tableAlignCenter.test(i)?l.align.push("center"):this.rules.other.tableAlignLeft.test(i)?l.align.push("left"):l.align.push(null);for(let i=0;i<n.length;i++)l.header.push({text:n[i],tokens:this.lexer.inline(n[i]),header:!0,align:l.align[i]});for(let i of a)l.rows.push(tG(i,l.header.length).map((y,x)=>({text:y,tokens:this.lexer.inline(y),header:!1,align:l.align[x]})));return l}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let n=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let l=t2(n.slice(0,-1),"\\");if((n.length-l.length)%2===0)return}else{let l=NPe(t[2],"()");if(l===-2)return;if(l>-1){let f=(t[0].indexOf("!")===0?5:4)+t[1].length+l;t[2]=t[2].substring(0,l),t[0]=t[0].substring(0,f).trim(),t[3]=""}}let r=t[2],a="";if(this.options.pedantic){let l=this.rules.other.pedanticHrefTitle.exec(r);l&&(r=l[1],a=l[3])}else a=t[3]?t[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?r=r.slice(1):r=r.slice(1,-1)),nG(t,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){let r=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=t[r.toLowerCase()];if(!a){let l=n[0].charAt(0);return{type:"text",raw:l,text:l}}return nG(n,a,n[0],this.lexer,this.rules)}}emStrong(e,t,n=""){let r=this.rules.inline.emStrongLDelim.exec(e);if(!(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!n||this.rules.inline.punctuation.exec(n))){let a=[...r[0]].length-1,l,f,i=a,y=0,x=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(x.lastIndex=0,t=t.slice(-1*e.length+a);(r=x.exec(t))!=null;){if(l=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!l)continue;if(f=[...l].length,r[3]||r[4]){i+=f;continue}else if((r[5]||r[6])&&a%3&&!((a+f)%3)){y+=f;continue}if(i-=f,i>0)continue;f=Math.min(f,f+i+y);let S=[...r[0]][0].length,C=e.slice(0,a+r.index+S+f);if(Math.min(a,f)%2){let L=C.slice(1,-1);return{type:"em",raw:C,text:L,tokens:this.lexer.inlineTokens(L)}}let P=C.slice(2,-2);return{type:"strong",raw:C,text:P,tokens:this.lexer.inlineTokens(P)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(n),a=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return r&&a&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:t[0],text:n}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){let t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let n,r;return t[2]==="@"?(n=t[1],r="mailto:"+n):(n=t[1],r=n),{type:"link",raw:t[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}url(e){var n;let t;if(t=this.rules.inline.url.exec(e)){let r,a;if(t[2]==="@")r=t[0],a="mailto:"+r;else{let l;do l=t[0],t[0]=((n=this.rules.inline._backpedal.exec(t[0]))==null?void 0:n[0])??"";while(l!==t[0]);r=t[0],t[1]==="www."?a="http://"+t[0]:a=t[0]}return{type:"link",raw:t[0],text:r,href:a,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let n=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:n}}}},md=class x8{constructor(t){wi(this,"tokens");wi(this,"options");wi(this,"state");wi(this,"tokenizer");wi(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=t||J_,this.options.tokenizer=this.options.tokenizer||new ZC,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:Lu,block:d4.normal,inline:e2.normal};this.options.pedantic?(n.block=d4.pedantic,n.inline=e2.pedantic):this.options.gfm&&(n.block=d4.gfm,this.options.breaks?n.inline=e2.breaks:n.inline=e2.gfm),this.tokenizer.rules=n}static get rules(){return{block:d4,inline:e2}}static lex(t,n){return new x8(n).lex(t)}static lexInline(t,n){return new x8(n).inlineTokens(t)}lex(t){t=t.replace(Lu.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let r=this.inlineQueue[n];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,n=[],r=!1){var a,l,f;for(this.options.pedantic&&(t=t.replace(Lu.tabCharGlobal,"    ").replace(Lu.spaceLine,""));t;){let i;if((l=(a=this.options.extensions)==null?void 0:a.block)!=null&&l.some(x=>(i=x.call({lexer:this},t,n))?(t=t.substring(i.raw.length),n.push(i),!0):!1))continue;if(i=this.tokenizer.space(t)){t=t.substring(i.raw.length);let x=n.at(-1);i.raw.length===1&&x!==void 0?x.raw+=`
`:n.push(i);continue}if(i=this.tokenizer.code(t)){t=t.substring(i.raw.length);let x=n.at(-1);(x==null?void 0:x.type)==="paragraph"||(x==null?void 0:x.type)==="text"?(x.raw+=(x.raw.endsWith(`
`)?"":`
`)+i.raw,x.text+=`
`+i.text,this.inlineQueue.at(-1).src=x.text):n.push(i);continue}if(i=this.tokenizer.fences(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.heading(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.hr(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.blockquote(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.list(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.html(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.def(t)){t=t.substring(i.raw.length);let x=n.at(-1);(x==null?void 0:x.type)==="paragraph"||(x==null?void 0:x.type)==="text"?(x.raw+=(x.raw.endsWith(`
`)?"":`
`)+i.raw,x.text+=`
`+i.raw,this.inlineQueue.at(-1).src=x.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title},n.push(i));continue}if(i=this.tokenizer.table(t)){t=t.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.lheading(t)){t=t.substring(i.raw.length),n.push(i);continue}let y=t;if((f=this.options.extensions)!=null&&f.startBlock){let x=1/0,S=t.slice(1),C;this.options.extensions.startBlock.forEach(P=>{C=P.call({lexer:this},S),typeof C=="number"&&C>=0&&(x=Math.min(x,C))}),x<1/0&&x>=0&&(y=t.substring(0,x+1))}if(this.state.top&&(i=this.tokenizer.paragraph(y))){let x=n.at(-1);r&&(x==null?void 0:x.type)==="paragraph"?(x.raw+=(x.raw.endsWith(`
`)?"":`
`)+i.raw,x.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=x.text):n.push(i),r=y.length!==t.length,t=t.substring(i.raw.length);continue}if(i=this.tokenizer.text(t)){t=t.substring(i.raw.length);let x=n.at(-1);(x==null?void 0:x.type)==="text"?(x.raw+=(x.raw.endsWith(`
`)?"":`
`)+i.raw,x.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=x.text):n.push(i);continue}if(t){let x="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(x);break}else throw new Error(x)}}return this.state.top=!0,n}inline(t,n=[]){return this.inlineQueue.push({src:t,tokens:n}),n}inlineTokens(t,n=[]){var y,x,S,C,P;let r=t,a=null;if(this.tokens.links){let L=Object.keys(this.tokens.links);if(L.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)L.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,a.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let l;for(;(a=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)l=a[2]?a[2].length:0,r=r.slice(0,a.index+l)+"["+"a".repeat(a[0].length-l-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);r=((x=(y=this.options.hooks)==null?void 0:y.emStrongMask)==null?void 0:x.call({lexer:this},r))??r;let f=!1,i="";for(;t;){f||(i=""),f=!1;let L;if((C=(S=this.options.extensions)==null?void 0:S.inline)!=null&&C.some(U=>(L=U.call({lexer:this},t,n))?(t=t.substring(L.raw.length),n.push(L),!0):!1))continue;if(L=this.tokenizer.escape(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.tag(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.link(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(L.raw.length);let U=n.at(-1);L.type==="text"&&(U==null?void 0:U.type)==="text"?(U.raw+=L.raw,U.text+=L.text):n.push(L);continue}if(L=this.tokenizer.emStrong(t,r,i)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.codespan(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.br(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.del(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.autolink(t)){t=t.substring(L.raw.length),n.push(L);continue}if(!this.state.inLink&&(L=this.tokenizer.url(t))){t=t.substring(L.raw.length),n.push(L);continue}let F=t;if((P=this.options.extensions)!=null&&P.startInline){let U=1/0,q=t.slice(1),G;this.options.extensions.startInline.forEach($=>{G=$.call({lexer:this},q),typeof G=="number"&&G>=0&&(U=Math.min(U,G))}),U<1/0&&U>=0&&(F=t.substring(0,U+1))}if(L=this.tokenizer.inlineText(F)){t=t.substring(L.raw.length),L.raw.slice(-1)!=="_"&&(i=L.raw.slice(-1)),f=!0;let U=n.at(-1);(U==null?void 0:U.type)==="text"?(U.raw+=L.raw,U.text+=L.text):n.push(L);continue}if(t){let U="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(U);break}else throw new Error(U)}}return n}},WC=class{constructor(e){wi(this,"options");wi(this,"parser");this.options=e||J_}space(e){return""}code({text:e,lang:t,escaped:n}){var l;let r=(l=(t||"").match(Lu.notSpaceStart))==null?void 0:l[0],a=e.replace(Lu.endingNewline,"")+`
`;return r?'<pre><code class="language-'+Kh(r)+'">'+(n?a:Kh(a,!0))+`</code></pre>
`:"<pre><code>"+(n?a:Kh(a,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}def(e){return""}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){let t=e.ordered,n=e.start,r="";for(let f=0;f<e.items.length;f++){let i=e.items[f];r+=this.listitem(i)}let a=t?"ol":"ul",l=t&&n!==1?' start="'+n+'"':"";return"<"+a+l+`>
`+r+"</"+a+`>
`}listitem(e){var n;let t="";if(e.task){let r=this.checkbox({checked:!!e.checked});e.loose?((n=e.tokens[0])==null?void 0:n.type)==="paragraph"?(e.tokens[0].text=r+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=r+" "+Kh(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",n="";for(let a=0;a<e.header.length;a++)n+=this.tablecell(e.header[a]);t+=this.tablerow({text:n});let r="";for(let a=0;a<e.rows.length;a++){let l=e.rows[a];n="";for(let f=0;f<l.length;f++)n+=this.tablecell(l[f]);r+=this.tablerow({text:n})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+r+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${Kh(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){let r=this.parser.parseInline(n),a=eG(e);if(a===null)return r;e=a;let l='<a href="'+e+'"';return t&&(l+=' title="'+Kh(t)+'"'),l+=">"+r+"</a>",l}image({href:e,title:t,text:n,tokens:r}){r&&(n=this.parser.parseInline(r,this.parser.textRenderer));let a=eG(e);if(a===null)return Kh(n);e=a;let l=`<img src="${e}" alt="${n}"`;return t&&(l+=` title="${Kh(t)}"`),l+=">",l}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:Kh(e.text)}},RN=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}},hh=class b8{constructor(t){wi(this,"options");wi(this,"renderer");wi(this,"textRenderer");this.options=t||J_,this.options.renderer=this.options.renderer||new WC,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new RN}static parse(t,n){return new b8(n).parse(t)}static parseInline(t,n){return new b8(n).parseInline(t)}parse(t,n=!0){var a,l;let r="";for(let f=0;f<t.length;f++){let i=t[f];if((l=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&l[i.type]){let x=i,S=this.options.extensions.renderers[x.type].call({parser:this},x);if(S!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(x.type)){r+=S||"";continue}}let y=i;switch(y.type){case"space":{r+=this.renderer.space(y);continue}case"hr":{r+=this.renderer.hr(y);continue}case"heading":{r+=this.renderer.heading(y);continue}case"code":{r+=this.renderer.code(y);continue}case"table":{r+=this.renderer.table(y);continue}case"blockquote":{r+=this.renderer.blockquote(y);continue}case"list":{r+=this.renderer.list(y);continue}case"html":{r+=this.renderer.html(y);continue}case"def":{r+=this.renderer.def(y);continue}case"paragraph":{r+=this.renderer.paragraph(y);continue}case"text":{let x=y,S=this.renderer.text(x);for(;f+1<t.length&&t[f+1].type==="text";)x=t[++f],S+=`
`+this.renderer.text(x);n?r+=this.renderer.paragraph({type:"paragraph",raw:S,text:S,tokens:[{type:"text",raw:S,text:S,escaped:!0}]}):r+=S;continue}default:{let x='Token with "'+y.type+'" type was not found.';if(this.options.silent)return console.error(x),"";throw new Error(x)}}}return r}parseInline(t,n=this.renderer){var a,l;let r="";for(let f=0;f<t.length;f++){let i=t[f];if((l=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&l[i.type]){let x=this.options.extensions.renderers[i.type].call({parser:this},i);if(x!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type)){r+=x||"";continue}}let y=i;switch(y.type){case"escape":{r+=n.text(y);break}case"html":{r+=n.html(y);break}case"link":{r+=n.link(y);break}case"image":{r+=n.image(y);break}case"strong":{r+=n.strong(y);break}case"em":{r+=n.em(y);break}case"codespan":{r+=n.codespan(y);break}case"br":{r+=n.br(y);break}case"del":{r+=n.del(y);break}case"text":{r+=n.text(y);break}default:{let x='Token with "'+y.type+'" type was not found.';if(this.options.silent)return console.error(x),"";throw new Error(x)}}}return r}},y4,w2=(y4=class{constructor(e){wi(this,"options");wi(this,"block");this.options=e||J_}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}emStrongMask(e){return e}provideLexer(){return this.block?md.lex:md.lexInline}provideParser(){return this.block?hh.parse:hh.parseInline}},wi(y4,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),wi(y4,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),y4),FPe=class{constructor(...e){wi(this,"defaults",wN());wi(this,"options",this.setOptions);wi(this,"parse",this.parseMarkdown(!0));wi(this,"parseInline",this.parseMarkdown(!1));wi(this,"Parser",hh);wi(this,"Renderer",WC);wi(this,"TextRenderer",RN);wi(this,"Lexer",md);wi(this,"Tokenizer",ZC);wi(this,"Hooks",w2);this.use(...e)}walkTokens(e,t){var r,a;let n=[];for(let l of e)switch(n=n.concat(t.call(this,l)),l.type){case"table":{let f=l;for(let i of f.header)n=n.concat(this.walkTokens(i.tokens,t));for(let i of f.rows)for(let y of i)n=n.concat(this.walkTokens(y.tokens,t));break}case"list":{let f=l;n=n.concat(this.walkTokens(f.items,t));break}default:{let f=l;(a=(r=this.defaults.extensions)==null?void 0:r.childTokens)!=null&&a[f.type]?this.defaults.extensions.childTokens[f.type].forEach(i=>{let y=f[i].flat(1/0);n=n.concat(this.walkTokens(y,t))}):f.tokens&&(n=n.concat(this.walkTokens(f.tokens,t)))}}return n}use(...e){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(n=>{let r={...n};if(r.async=this.defaults.async||r.async||!1,n.extensions&&(n.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){let l=t.renderers[a.name];l?t.renderers[a.name]=function(...f){let i=a.renderer.apply(this,f);return i===!1&&(i=l.apply(this,f)),i}:t.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let l=t[a.level];l?l.unshift(a.tokenizer):t[a.level]=[a.tokenizer],a.start&&(a.level==="block"?t.startBlock?t.startBlock.push(a.start):t.startBlock=[a.start]:a.level==="inline"&&(t.startInline?t.startInline.push(a.start):t.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(t.childTokens[a.name]=a.childTokens)}),r.extensions=t),n.renderer){let a=this.defaults.renderer||new WC(this.defaults);for(let l in n.renderer){if(!(l in a))throw new Error(`renderer '${l}' does not exist`);if(["options","parser"].includes(l))continue;let f=l,i=n.renderer[f],y=a[f];a[f]=(...x)=>{let S=i.apply(a,x);return S===!1&&(S=y.apply(a,x)),S||""}}r.renderer=a}if(n.tokenizer){let a=this.defaults.tokenizer||new ZC(this.defaults);for(let l in n.tokenizer){if(!(l in a))throw new Error(`tokenizer '${l}' does not exist`);if(["options","rules","lexer"].includes(l))continue;let f=l,i=n.tokenizer[f],y=a[f];a[f]=(...x)=>{let S=i.apply(a,x);return S===!1&&(S=y.apply(a,x)),S}}r.tokenizer=a}if(n.hooks){let a=this.defaults.hooks||new w2;for(let l in n.hooks){if(!(l in a))throw new Error(`hook '${l}' does not exist`);if(["options","block"].includes(l))continue;let f=l,i=n.hooks[f],y=a[f];w2.passThroughHooks.has(l)?a[f]=x=>{if(this.defaults.async&&w2.passThroughHooksRespectAsync.has(l))return(async()=>{let C=await i.call(a,x);return y.call(a,C)})();let S=i.call(a,x);return y.call(a,S)}:a[f]=(...x)=>{if(this.defaults.async)return(async()=>{let C=await i.apply(a,x);return C===!1&&(C=await y.apply(a,x)),C})();let S=i.apply(a,x);return S===!1&&(S=y.apply(a,x)),S}}r.hooks=a}if(n.walkTokens){let a=this.defaults.walkTokens,l=n.walkTokens;r.walkTokens=function(f){let i=[];return i.push(l.call(this,f)),a&&(i=i.concat(a.call(this,f))),i}}this.defaults={...this.defaults,...r}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return md.lex(e,t??this.defaults)}parser(e,t){return hh.parse(e,t??this.defaults)}parseMarkdown(e){return(t,n)=>{let r={...n},a={...this.defaults,...r},l=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&r.async===!1)return l(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return l(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return l(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(a.hooks&&(a.hooks.options=a,a.hooks.block=e),a.async)return(async()=>{let f=a.hooks?await a.hooks.preprocess(t):t,i=await(a.hooks?await a.hooks.provideLexer():e?md.lex:md.lexInline)(f,a),y=a.hooks?await a.hooks.processAllTokens(i):i;a.walkTokens&&await Promise.all(this.walkTokens(y,a.walkTokens));let x=await(a.hooks?await a.hooks.provideParser():e?hh.parse:hh.parseInline)(y,a);return a.hooks?await a.hooks.postprocess(x):x})().catch(l);try{a.hooks&&(t=a.hooks.preprocess(t));let f=(a.hooks?a.hooks.provideLexer():e?md.lex:md.lexInline)(t,a);a.hooks&&(f=a.hooks.processAllTokens(f)),a.walkTokens&&this.walkTokens(f,a.walkTokens);let i=(a.hooks?a.hooks.provideParser():e?hh.parse:hh.parseInline)(f,a);return a.hooks&&(i=a.hooks.postprocess(i)),i}catch(f){return l(f)}}}onError(e,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let r="<p>An error occurred:</p><pre>"+Kh(n.message+"",!0)+"</pre>";return t?Promise.resolve(r):r}if(t)return Promise.reject(n);throw n}}},L_=new FPe;function Ka(e,t){return L_.parse(e,t)}Ka.options=Ka.setOptions=function(e){return L_.setOptions(e),Ka.defaults=L_.defaults,One(Ka.defaults),Ka};Ka.getDefaults=wN;Ka.defaults=J_;Ka.use=function(...e){return L_.use(...e),Ka.defaults=L_.defaults,One(Ka.defaults),Ka};Ka.walkTokens=function(e,t){return L_.walkTokens(e,t)};Ka.parseInline=L_.parseInline;Ka.Parser=hh;Ka.parser=hh.parse;Ka.Renderer=WC;Ka.TextRenderer=RN;Ka.Lexer=md;Ka.lexer=md.lex;Ka.Tokenizer=ZC;Ka.Hooks=w2;Ka.parse=Ka;Ka.options;Ka.setOptions;Ka.use;Ka.walkTokens;Ka.parseInline;hh.parse;md.lex;var Hs=(...e)=>vo(aD(e)),Rv=(e,t,n)=>{let r=typeof t=="string"?new Blob([t],{type:n}):t,a=URL.createObjectURL(r),l=document.createElement("a");l.href=a,l.download=e,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a)},BPe=B.createContext({code:""}),Hne=()=>B.useContext(BPe),rG=({onCopy:e,onError:t,timeout:n=2e3,children:r,className:a,code:l,...f})=>{let[i,y]=B.useState(!1),x=B.useRef(0),{code:S}=Hne(),{isAnimating:C}=B.useContext(bh),P=l??S,L=async()=>{var U;if(typeof window>"u"||!((U=navigator==null?void 0:navigator.clipboard)!=null&&U.writeText)){t==null||t(new Error("Clipboard API not available"));return}try{i||(await navigator.clipboard.writeText(P),y(!0),e==null||e(),x.current=window.setTimeout(()=>y(!1),n))}catch(q){t==null||t(q)}};B.useEffect(()=>()=>{window.clearTimeout(x.current)},[]);let F=i?pne:mne;return k.jsx("button",{className:Hs("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",a),"data-streamdown":"code-block-copy-button",disabled:C,onClick:L,title:"Copy Code",type:"button",...f,children:r??k.jsx(F,{size:14})})},iG={"1c":"1c","1c-query":"1cq",abap:"abap","actionscript-3":"as",ada:"ada",adoc:"adoc","angular-html":"html","angular-ts":"ts",apache:"conf",apex:"cls",apl:"apl",applescript:"applescript",ara:"ara",asciidoc:"adoc",asm:"asm",astro:"astro",awk:"awk",ballerina:"bal",bash:"sh",bat:"bat",batch:"bat",be:"be",beancount:"beancount",berry:"berry",bibtex:"bib",bicep:"bicep",blade:"blade.php",bsl:"bsl",c:"c","c#":"cs","c++":"cpp",cadence:"cdc",cairo:"cairo",cdc:"cdc",clarity:"clar",clj:"clj",clojure:"clj","closure-templates":"soy",cmake:"cmake",cmd:"cmd",cobol:"cob",codeowners:"CODEOWNERS",codeql:"ql",coffee:"coffee",coffeescript:"coffee","common-lisp":"lisp",console:"sh",coq:"v",cpp:"cpp",cql:"cql",crystal:"cr",cs:"cs",csharp:"cs",css:"css",csv:"csv",cue:"cue",cypher:"cql",d:"d",dart:"dart",dax:"dax",desktop:"desktop",diff:"diff",docker:"dockerfile",dockerfile:"dockerfile",dotenv:"env","dream-maker":"dm",edge:"edge",elisp:"el",elixir:"ex",elm:"elm","emacs-lisp":"el",erb:"erb",erl:"erl",erlang:"erl",f:"f","f#":"fs",f03:"f03",f08:"f08",f18:"f18",f77:"f77",f90:"f90",f95:"f95",fennel:"fnl",fish:"fish",fluent:"ftl",for:"for","fortran-fixed-form":"f","fortran-free-form":"f90",fs:"fs",fsharp:"fs",fsl:"fsl",ftl:"ftl",gdresource:"tres",gdscript:"gd",gdshader:"gdshader",genie:"gs",gherkin:"feature","git-commit":"gitcommit","git-rebase":"gitrebase",gjs:"js",gleam:"gleam","glimmer-js":"js","glimmer-ts":"ts",glsl:"glsl",gnuplot:"plt",go:"go",gql:"gql",graphql:"graphql",groovy:"groovy",gts:"gts",hack:"hack",haml:"haml",handlebars:"hbs",haskell:"hs",haxe:"hx",hbs:"hbs",hcl:"hcl",hjson:"hjson",hlsl:"hlsl",hs:"hs",html:"html","html-derivative":"html",http:"http",hxml:"hxml",hy:"hy",imba:"imba",ini:"ini",jade:"jade",java:"java",javascript:"js",jinja:"jinja",jison:"jison",jl:"jl",js:"js",json:"json",json5:"json5",jsonc:"jsonc",jsonl:"jsonl",jsonnet:"jsonnet",jssm:"jssm",jsx:"jsx",julia:"jl",kotlin:"kt",kql:"kql",kt:"kt",kts:"kts",kusto:"kql",latex:"tex",lean:"lean",lean4:"lean",less:"less",liquid:"liquid",lisp:"lisp",lit:"lit",llvm:"ll",log:"log",logo:"logo",lua:"lua",luau:"luau",make:"mak",makefile:"mak",markdown:"md",marko:"marko",matlab:"m",md:"md",mdc:"mdc",mdx:"mdx",mediawiki:"wiki",mermaid:"mmd",mips:"s",mipsasm:"s",mmd:"mmd",mojo:"mojo",move:"move",nar:"nar",narrat:"narrat",nextflow:"nf",nf:"nf",nginx:"conf",nim:"nim",nix:"nix",nu:"nu",nushell:"nu",objc:"m","objective-c":"m","objective-cpp":"mm",ocaml:"ml",pascal:"pas",perl:"pl",perl6:"p6",php:"php",plsql:"pls",po:"po",polar:"polar",postcss:"pcss",pot:"pot",potx:"potx",powerquery:"pq",powershell:"ps1",prisma:"prisma",prolog:"pl",properties:"properties",proto:"proto",protobuf:"proto",ps:"ps",ps1:"ps1",pug:"pug",puppet:"pp",purescript:"purs",py:"py",python:"py",ql:"ql",qml:"qml",qmldir:"qmldir",qss:"qss",r:"r",racket:"rkt",raku:"raku",razor:"cshtml",rb:"rb",reg:"reg",regex:"regex",regexp:"regexp",rel:"rel",riscv:"s",rs:"rs",rst:"rst",ruby:"rb",rust:"rs",sas:"sas",sass:"sass",scala:"scala",scheme:"scm",scss:"scss",sdbl:"sdbl",sh:"sh",shader:"shader",shaderlab:"shader",shell:"sh",shellscript:"sh",shellsession:"sh",smalltalk:"st",solidity:"sol",soy:"soy",sparql:"rq",spl:"spl",splunk:"spl",sql:"sql","ssh-config":"config",stata:"do",styl:"styl",stylus:"styl",svelte:"svelte",swift:"swift","system-verilog":"sv",systemd:"service",talon:"talon",talonscript:"talon",tasl:"tasl",tcl:"tcl",templ:"templ",terraform:"tf",tex:"tex",tf:"tf",tfvars:"tfvars",toml:"toml",ts:"ts","ts-tags":"ts",tsp:"tsp",tsv:"tsv",tsx:"tsx",turtle:"ttl",twig:"twig",typ:"typ",typescript:"ts",typespec:"tsp",typst:"typ",v:"v",vala:"vala",vb:"vb",verilog:"v",vhdl:"vhdl",vim:"vim",viml:"vim",vimscript:"vim",vue:"vue","vue-html":"html","vue-vine":"vine",vy:"vy",vyper:"vy",wasm:"wasm",wenyan:"wy",wgsl:"wgsl",wiki:"wiki",wikitext:"wiki",wit:"wit",wl:"wl",wolfram:"wl",xml:"xml",xsl:"xsl",yaml:"yaml",yml:"yml",zenscript:"zs",zig:"zig",zsh:"zsh",:"wy"},jPe=({onDownload:e,onError:t,language:n,children:r,className:a,code:l,...f})=>{let{code:i}=Hne(),{isAnimating:y}=B.useContext(bh),x=l??i,S=`file.${n&&n in iG?iG[n]:"txt"}`,C="text/plain",P=()=>{try{Rv(S,x,C),e==null||e()}catch(L){t==null||t(L)}};return k.jsx("button",{className:Hs("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",a),"data-streamdown":"code-block-download-button",disabled:y,onClick:P,title:"Download file",type:"button",...f,children:r??k.jsx(tI,{size:14})})},sG=()=>k.jsxs("div",{className:"w-full divide-y divide-border overflow-hidden rounded-xl border border-border",children:[k.jsx("div",{className:"h-[46px] w-full bg-muted/80"}),k.jsx("div",{className:"flex w-full items-center justify-center p-4",children:k.jsx(s5e,{className:"size-4 animate-spin"})})]}),UPe=/\.[^/.]+$/,VPe=({node:e,className:t,src:n,alt:r,...a})=>{let l=async()=>{if(n)try{let f=await(await fetch(n)).blob(),i=new URL(n,window.location.origin).pathname.split("/").pop()||"",y=i.split(".").pop(),x=i.includes(".")&&y!==void 0&&y.length<=4,S="";if(x)S=i;else{let C=f.type,P="png";C.includes("jpeg")||C.includes("jpg")?P="jpg":C.includes("png")?P="png":C.includes("svg")?P="svg":C.includes("gif")?P="gif":C.includes("webp")&&(P="webp"),S=`${(r||i||"image").replace(UPe,"")}.${P}`}Rv(S,f,f.type)}catch(f){console.error("Failed to download image:",f)}};return n?k.jsxs("div",{className:"group relative my-4 inline-block","data-streamdown":"image-wrapper",children:[k.jsx("img",{alt:r,className:Hs("max-w-full rounded-lg",t),"data-streamdown":"image",src:n,...a}),k.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-lg bg-black/10 group-hover:block"}),k.jsx("button",{className:Hs("absolute right-2 bottom-2 flex h-8 w-8 cursor-pointer items-center justify-center rounded-md border border-border bg-background/90 shadow-sm backdrop-blur-sm transition-all duration-200 hover:bg-background","opacity-0 group-hover:opacity-100"),onClick:l,title:"Download image",type:"button",children:k.jsx(tI,{size:14})})]}):null},Gne=async e=>{let t={startOnLoad:!1,theme:"default",securityLevel:"strict",fontFamily:"monospace",suppressErrorRendering:!0,...e},n=(await KT(async()=>{const{default:r}=await import("./mermaid.core-BFB6Sr5j.js").then(a=>a.bA);return{default:r}},[])).default;return n.initialize(t),n},$Pe=(e,t)=>{var n;let r=(n=void 0)!=null?n:5;return new Promise((a,l)=>{let f="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e))),i=new Image;i.crossOrigin="anonymous",i.onload=()=>{let y=document.createElement("canvas"),x=i.width*r,S=i.height*r;y.width=x,y.height=S;let C=y.getContext("2d");if(!C){l(new Error("Failed to create 2D canvas context for PNG export"));return}C.drawImage(i,0,0,x,S),y.toBlob(P=>{if(!P){l(new Error("Failed to create PNG blob"));return}a(P)},"image/png")},i.onerror=()=>l(new Error("Failed to load SVG image")),i.src=f})},HPe=({chart:e,children:t,className:n,onDownload:r,config:a,onError:l})=>{let[f,i]=B.useState(!1),y=B.useRef(null),{isAnimating:x}=B.useContext(bh),S=async C=>{try{if(C==="mmd"){Rv("diagram.mmd",e,"text/plain"),i(!1),r==null||r(C);return}let P=await Gne(a),L=e.split("").reduce((q,G)=>(q<<5)-q+G.charCodeAt(0)|0,0),F=`mermaid-${Math.abs(L)}-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,{svg:U}=await P.render(F,e);if(!U){l==null||l(new Error("SVG not found. Please wait for the diagram to render."));return}if(C==="svg"){Rv("diagram.svg",U,"image/svg+xml"),i(!1),r==null||r(C);return}if(C==="png"){let q=await $Pe(U);Rv("diagram.png",q,"image/png"),r==null||r(C),i(!1);return}}catch(P){l==null||l(P)}};return B.useEffect(()=>{let C=P=>{y.current&&!y.current.contains(P.target)&&i(!1)};return document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[]),k.jsxs("div",{className:"relative",ref:y,children:[k.jsx("button",{className:Hs("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",n),disabled:x,onClick:()=>i(!f),title:"Download diagram",type:"button",children:t??k.jsx(tI,{size:14})}),f&&k.jsxs("div",{className:"absolute top-full right-0 z-10 mt-1 min-w-[120px] overflow-hidden rounded-md border border-border bg-background shadow-lg",children:[k.jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>S("svg"),title:"Download diagram as SVG",type:"button",children:"SVG"}),k.jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>S("png"),title:"Download diagram as PNG",type:"button",children:"PNG"}),k.jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>S("mmd"),title:"Download diagram as MMD",type:"button",children:"MMD"})]})]})},H2=0,GPe=()=>{H2+=1,H2===1&&(document.body.style.overflow="hidden")},qPe=()=>{H2=Math.max(0,H2-1),H2===0&&(document.body.style.overflow="")},ZPe=({chart:e,config:t,onFullscreen:n,onExit:r,className:a,...l})=>{let[f,i]=B.useState(!1),{isAnimating:y,controls:x}=B.useContext(bh),S=(()=>{if(typeof x=="boolean")return x;let P=x.mermaid;return P===!1?!1:P===!0||P===void 0?!0:P.panZoom!==!1})(),C=()=>{i(!f)};return B.useEffect(()=>{if(f){GPe();let P=L=>{L.key==="Escape"&&i(!1)};return document.addEventListener("keydown",P),()=>{document.removeEventListener("keydown",P),qPe()}}},[f]),B.useEffect(()=>{f?n==null||n():r&&r()},[f,n,r]),k.jsxs(k.Fragment,{children:[k.jsx("button",{className:Hs("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",a),disabled:y,onClick:C,title:"View fullscreen",type:"button",...l,children:k.jsx(o5e,{size:14})}),f&&k.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/95 backdrop-blur-sm",onClick:C,onKeyDown:P=>{P.key==="Escape"&&C()},role:"button",tabIndex:0,children:[k.jsx("button",{className:"absolute top-4 right-4 z-10 rounded-md p-2 text-muted-foreground transition-all hover:bg-muted hover:text-foreground",onClick:C,title:"Exit fullscreen",type:"button",children:k.jsx(d5e,{size:20})}),k.jsx("div",{className:"flex h-full w-full items-center justify-center p-4",onClick:P=>P.stopPropagation(),onKeyDown:P=>P.stopPropagation(),role:"presentation",children:k.jsx(bre,{chart:e,className:"h-full w-full [&>div]:h-full [&>div]:overflow-hidden [&_svg]:h-auto [&_svg]:w-auto",config:t,fullscreen:!0,showControls:S})})]})]})},qne=e=>{var t,n;let r=[],a=[],l=e.querySelectorAll("thead th");for(let i of l)r.push(((t=i.textContent)==null?void 0:t.trim())||"");let f=e.querySelectorAll("tbody tr");for(let i of f){let y=[],x=i.querySelectorAll("td");for(let S of x)y.push(((n=S.textContent)==null?void 0:n.trim())||"");a.push(y)}return{headers:r,rows:a}},Zne=e=>{let{headers:t,rows:n}=e,r=i=>{let y=!1,x=!1;for(let S=0;S<i.length;S+=1){let C=i[S];if(C==='"'){y=!0,x=!0;break}(C===","||C===`
`)&&(y=!0)}return y?x?`"${i.replace(/"/g,'""')}"`:`"${i}"`:i},a=t.length>0?n.length+1:n.length,l=new Array(a),f=0;t.length>0&&(l[f]=t.map(r).join(","),f+=1);for(let i of n)l[f]=i.map(r).join(","),f+=1;return l.join(`
`)},WPe=e=>{let{headers:t,rows:n}=e,r=i=>{let y=!1;for(let S=0;S<i.length;S+=1){let C=i[S];if(C==="	"||C===`
`||C==="\r"){y=!0;break}}if(!y)return i;let x=[];for(let S=0;S<i.length;S+=1){let C=i[S];C==="	"?x.push("\\t"):C===`
`?x.push("\\n"):C==="\r"?x.push("\\r"):x.push(C)}return x.join("")},a=t.length>0?n.length+1:n.length,l=new Array(a),f=0;t.length>0&&(l[f]=t.map(r).join("	"),f+=1);for(let i of n)l[f]=i.map(r).join("	"),f+=1;return l.join(`
`)},WR=e=>{let t=!1;for(let r=0;r<e.length;r+=1){let a=e[r];if(a==="\\"||a==="|"){t=!0;break}}if(!t)return e;let n=[];for(let r=0;r<e.length;r+=1){let a=e[r];a==="\\"?n.push("\\\\"):a==="|"?n.push("\\|"):n.push(a)}return n.join("")},XPe=e=>{let{headers:t,rows:n}=e;if(t.length===0)return"";let r=new Array(n.length+2),a=0,l=t.map(i=>WR(i));r[a]=`| ${l.join(" | ")} |`,a+=1;let f=new Array(t.length);for(let i=0;i<t.length;i+=1)f[i]="---";r[a]=`| ${f.join(" | ")} |`,a+=1;for(let i of n)if(i.length<t.length){let y=new Array(t.length);for(let x=0;x<t.length;x+=1)y[x]=x<i.length?WR(i[x]):"";r[a]=`| ${y.join(" | ")} |`,a+=1}else{let y=i.map(x=>WR(x));r[a]=`| ${y.join(" | ")} |`,a+=1}return r.join(`
`)},YPe=({children:e,className:t,onCopy:n,onError:r,timeout:a=2e3})=>{let[l,f]=B.useState(!1),[i,y]=B.useState(!1),x=B.useRef(null),S=B.useRef(0),{isAnimating:C}=B.useContext(bh),P=async F=>{var U,q;if(typeof window>"u"||!((U=navigator==null?void 0:navigator.clipboard)!=null&&U.write)){r==null||r(new Error("Clipboard API not available"));return}try{let G=(q=x.current)==null?void 0:q.closest('[data-streamdown="table-wrapper"]'),$=G==null?void 0:G.querySelector("table");if(!$){r==null||r(new Error("Table not found"));return}let X=qne($),ie=F==="csv"?Zne(X):WPe(X),de=new ClipboardItem({"text/plain":new Blob([ie],{type:"text/plain"}),"text/html":new Blob([$.outerHTML],{type:"text/html"})});await navigator.clipboard.write([de]),y(!0),f(!1),n==null||n(F),S.current=window.setTimeout(()=>y(!1),a)}catch(G){r==null||r(G)}};B.useEffect(()=>{let F=U=>{x.current&&!x.current.contains(U.target)&&f(!1)};return document.addEventListener("mousedown",F),()=>{document.removeEventListener("mousedown",F),window.clearTimeout(S.current)}},[]);let L=i?pne:mne;return k.jsxs("div",{className:"relative",ref:x,children:[k.jsx("button",{className:Hs("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",t),disabled:C,onClick:()=>f(!l),title:"Copy table",type:"button",children:e??k.jsx(L,{size:14})}),l&&k.jsxs("div",{className:"absolute top-full right-0 z-10 mt-1 min-w-[120px] overflow-hidden rounded-md border border-border bg-background shadow-lg",children:[k.jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>P("csv"),title:"Copy table as CSV",type:"button",children:"CSV"}),k.jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>P("tsv"),title:"Copy table as TSV",type:"button",children:"TSV"})]})]})},KPe=({children:e,className:t,onDownload:n,onError:r})=>{let[a,l]=B.useState(!1),f=B.useRef(null),{isAnimating:i}=B.useContext(bh),y=x=>{var S;try{let C=(S=f.current)==null?void 0:S.closest('[data-streamdown="table-wrapper"]'),P=C==null?void 0:C.querySelector("table");if(!P){r==null||r(new Error("Table not found"));return}let L=qne(P),F=x==="csv"?Zne(L):XPe(L);Rv(`table.${x==="csv"?"csv":"md"}`,F,x==="csv"?"text/csv":"text/markdown"),l(!1),n==null||n(x)}catch(C){r==null||r(C)}};return B.useEffect(()=>{let x=S=>{f.current&&!f.current.contains(S.target)&&l(!1)};return document.addEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}},[]),k.jsxs("div",{className:"relative",ref:f,children:[k.jsx("button",{className:Hs("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",t),disabled:i,onClick:()=>l(!a),title:"Download table",type:"button",children:e??k.jsx(tI,{size:14})}),a&&k.jsxs("div",{className:"absolute top-full right-0 z-10 mt-1 min-w-[120px] overflow-hidden rounded-md border border-border bg-background shadow-lg",children:[k.jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>y("csv"),title:"Download table as CSV",type:"button",children:"CSV"}),k.jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>y("markdown"),title:"Download table as Markdown",type:"button",children:"Markdown"})]})]})},QPe=({children:e,className:t,showControls:n,...r})=>k.jsxs("div",{className:"my-4 flex flex-col space-y-2","data-streamdown":"table-wrapper",children:[n&&k.jsxs("div",{className:"flex items-center justify-end gap-1",children:[k.jsx(YPe,{}),k.jsx(KPe,{})]}),k.jsx("div",{className:"overflow-x-auto",children:k.jsx("table",{className:Hs("w-full border-collapse border border-border",t),"data-streamdown":"table",...r,children:e})})]}),JPe=B.lazy(()=>KT(()=>import("./code-block-IT6T5CEO-BcQ0Jmgz.js"),[]).then(e=>({default:e.CodeBlock}))),eOe=B.lazy(()=>KT(()=>Promise.resolve().then(()=>Vze),void 0).then(e=>({default:e.Mermaid}))),tOe=/language-([^\s]+)/;function sI(e,t){if(!(e!=null&&e.position||t!=null&&t.position))return!0;if(!(e!=null&&e.position&&t!=null&&t.position))return!1;let n=e.position.start,r=t.position.start,a=e.position.end,l=t.position.end;return(n==null?void 0:n.line)===(r==null?void 0:r.line)&&(n==null?void 0:n.column)===(r==null?void 0:r.column)&&(a==null?void 0:a.line)===(l==null?void 0:l.line)&&(a==null?void 0:a.column)===(l==null?void 0:l.column)}function Wo(e,t){return e.className===t.className&&sI(e.node,t.node)}var w8=(e,t)=>typeof e=="boolean"?e:e[t]!==!1,h4=(e,t)=>{if(typeof e=="boolean")return e;let n=e.mermaid;return n===!1?!1:n===!0||n===void 0?!0:n[t]!==!1},MN=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("ol",{className:Hs("list-inside list-decimal whitespace-normal",t),"data-streamdown":"ordered-list",...r,children:e}),(e,t)=>Wo(e,t));MN.displayName="MarkdownOl";var Wne=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("li",{className:Hs("py-1 [&>p]:inline",t),"data-streamdown":"list-item",...r,children:e}),(e,t)=>e.className===t.className&&sI(e.node,t.node));Wne.displayName="MarkdownLi";var Xne=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("ul",{className:Hs("list-inside list-disc whitespace-normal",t),"data-streamdown":"unordered-list",...r,children:e}),(e,t)=>Wo(e,t));Xne.displayName="MarkdownUl";var Yne=B.memo(({className:e,node:t,...n})=>k.jsx("hr",{className:Hs("my-6 border-border",e),"data-streamdown":"horizontal-rule",...n}),(e,t)=>Wo(e,t));Yne.displayName="MarkdownHr";var Kne=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("span",{className:Hs("font-semibold",t),"data-streamdown":"strong",...r,children:e}),(e,t)=>Wo(e,t));Kne.displayName="MarkdownStrong";var Qne=B.memo(({children:e,className:t,href:n,node:r,...a})=>{let l=n==="streamdown:incomplete-link";return k.jsx("a",{className:Hs("wrap-anywhere font-medium text-primary underline",t),"data-incomplete":l,"data-streamdown":"link",href:n,rel:"noreferrer",target:"_blank",...a,children:e})},(e,t)=>Wo(e,t)&&e.href===t.href);Qne.displayName="MarkdownA";var Jne=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("h1",{className:Hs("mt-6 mb-2 font-semibold text-3xl",t),"data-streamdown":"heading-1",...r,children:e}),(e,t)=>Wo(e,t));Jne.displayName="MarkdownH1";var ere=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("h2",{className:Hs("mt-6 mb-2 font-semibold text-2xl",t),"data-streamdown":"heading-2",...r,children:e}),(e,t)=>Wo(e,t));ere.displayName="MarkdownH2";var tre=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("h3",{className:Hs("mt-6 mb-2 font-semibold text-xl",t),"data-streamdown":"heading-3",...r,children:e}),(e,t)=>Wo(e,t));tre.displayName="MarkdownH3";var nre=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("h4",{className:Hs("mt-6 mb-2 font-semibold text-lg",t),"data-streamdown":"heading-4",...r,children:e}),(e,t)=>Wo(e,t));nre.displayName="MarkdownH4";var rre=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("h5",{className:Hs("mt-6 mb-2 font-semibold text-base",t),"data-streamdown":"heading-5",...r,children:e}),(e,t)=>Wo(e,t));rre.displayName="MarkdownH5";var ire=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("h6",{className:Hs("mt-6 mb-2 font-semibold text-sm",t),"data-streamdown":"heading-6",...r,children:e}),(e,t)=>Wo(e,t));ire.displayName="MarkdownH6";var sre=B.memo(({children:e,className:t,node:n,...r})=>{let{controls:a}=B.useContext(bh),l=w8(a,"table");return k.jsx(QPe,{className:t,"data-streamdown":"table-wrapper",showControls:l,...r,children:e})},(e,t)=>Wo(e,t));sre.displayName="MarkdownTable";var are=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("thead",{className:Hs("bg-muted/80",t),"data-streamdown":"table-header",...r,children:e}),(e,t)=>Wo(e,t));are.displayName="MarkdownThead";var ore=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("tbody",{className:Hs("divide-y divide-border bg-muted/40",t),"data-streamdown":"table-body",...r,children:e}),(e,t)=>Wo(e,t));ore.displayName="MarkdownTbody";var lre=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("tr",{className:Hs("border-border border-b",t),"data-streamdown":"table-row",...r,children:e}),(e,t)=>Wo(e,t));lre.displayName="MarkdownTr";var ure=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("th",{className:Hs("whitespace-nowrap px-4 py-2 text-left font-semibold text-sm",t),"data-streamdown":"table-header-cell",...r,children:e}),(e,t)=>Wo(e,t));ure.displayName="MarkdownTh";var cre=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("td",{className:Hs("px-4 py-2 text-sm",t),"data-streamdown":"table-cell",...r,children:e}),(e,t)=>Wo(e,t));cre.displayName="MarkdownTd";var dre=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("blockquote",{className:Hs("my-4 border-muted-foreground/30 border-l-4 pl-4 text-muted-foreground italic",t),"data-streamdown":"blockquote",...r,children:e}),(e,t)=>Wo(e,t));dre.displayName="MarkdownBlockquote";var hre=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("sup",{className:Hs("text-sm",t),"data-streamdown":"superscript",...r,children:e}),(e,t)=>Wo(e,t));hre.displayName="MarkdownSup";var fre=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("sub",{className:Hs("text-sm",t),"data-streamdown":"subscript",...r,children:e}),(e,t)=>Wo(e,t));fre.displayName="MarkdownSub";var pre=B.memo(({children:e,className:t,node:n,...r})=>{if("data-footnotes"in r){let a=f=>{var i,y;if(!B.isValidElement(f))return!1;let x=Array.isArray(f.props.children)?f.props.children:[f.props.children],S=!1,C=!1;for(let P of x)if(P){if(typeof P=="string")P.trim()!==""&&(S=!0);else if(B.isValidElement(P))if(((i=P.props)==null?void 0:i["data-footnote-backref"])!==void 0)C=!0;else{let L=Array.isArray(P.props.children)?P.props.children:[P.props.children];for(let F of L){if(typeof F=="string"&&F.trim()!==""){S=!0;break}if(B.isValidElement(F)&&((y=F.props)==null?void 0:y["data-footnote-backref"])===void 0){S=!0;break}}}}return C&&!S},l=Array.isArray(e)?e.map(f=>{if(!B.isValidElement(f))return f;if(f.type===MN){let i=(Array.isArray(f.props.children)?f.props.children:[f.props.children]).filter(y=>!a(y));return i.length===0?null:{...f,props:{...f.props,children:i}}}return f}):e;return(Array.isArray(l)?l.some(f=>f!==null):l!==null)?k.jsx("section",{className:t,...r,children:l}):null}return k.jsx("section",{className:t,...r,children:e})},(e,t)=>Wo(e,t));pre.displayName="MarkdownSection";var nOe=({node:e,className:t,children:n,...r})=>{var a,l,f;let i=((a=e==null?void 0:e.position)==null?void 0:a.start.line)===((l=e==null?void 0:e.position)==null?void 0:l.end.line),{mermaid:y,controls:x}=B.useContext(bh);if(i)return k.jsx("code",{className:Hs("rounded bg-muted px-1.5 py-0.5 font-mono text-sm",t),"data-streamdown":"inline-code",...r,children:n});let S=t==null?void 0:t.match(tOe),C=(f=S==null?void 0:S.at(1))!=null?f:"",P="";if(B.isValidElement(n)&&n.props&&typeof n.props=="object"&&"children"in n.props&&typeof n.props.children=="string"?P=n.props.children:typeof n=="string"&&(P=n),C==="mermaid"){let F=w8(x,"mermaid"),U=h4(x,"download"),q=h4(x,"copy"),G=h4(x,"fullscreen"),$=h4(x,"panZoom");return k.jsx(B.Suspense,{fallback:k.jsx(sG,{}),children:k.jsxs("div",{className:Hs("group relative my-4 h-auto rounded-xl border p-4",t),"data-streamdown":"mermaid-block",children:[F&&(U||q||G)&&k.jsxs("div",{className:"flex items-center justify-end gap-2",children:[U&&k.jsx(HPe,{chart:P,config:y==null?void 0:y.config}),q&&k.jsx(rG,{code:P}),G&&k.jsx(ZPe,{chart:P,config:y==null?void 0:y.config})]}),k.jsx(eOe,{chart:P,config:y==null?void 0:y.config,showControls:$})]})})}let L=w8(x,"code");return k.jsx(B.Suspense,{fallback:k.jsx(sG,{}),children:k.jsx(JPe,{className:Hs("overflow-x-auto border-border border-t",t),code:P,language:C,children:L&&k.jsxs(k.Fragment,{children:[k.jsx(jPe,{code:P,language:C}),k.jsx(rG,{})]})})})},mre=B.memo(nOe,(e,t)=>e.className===t.className&&sI(e.node,t.node));mre.displayName="MarkdownCode";var gre=B.memo(VPe,(e,t)=>e.className===t.className&&sI(e.node,t.node));gre.displayName="MarkdownImg";var _re=B.memo(({children:e,className:t,node:n,...r})=>{var a;let l=(Array.isArray(e)?e:[e]).filter(f=>f!=null&&f!=="");return l.length===1&&B.isValidElement(l[0])&&((a=l[0].props.node)==null?void 0:a.tagName)==="img"?k.jsx(k.Fragment,{children:e}):k.jsx("p",{className:t,...r,children:e})},(e,t)=>Wo(e,t));_re.displayName="MarkdownParagraph";var rOe={ol:MN,li:Wne,ul:Xne,hr:Yne,strong:Kne,a:Qne,h1:Jne,h2:ere,h3:tre,h4:nre,h5:rre,h6:ire,table:sre,thead:are,tbody:ore,tr:lre,th:ure,td:cre,blockquote:dre,code:mre,img:gre,pre:({children:e})=>e,sup:hre,sub:fre,p:_re,section:pre},aG=[],oG={allowDangerousHtml:!0},f4=new WeakMap,iOe=class{constructor(){this.cache=new Map,this.keyCache=new WeakMap,this.maxSize=100}generateCacheKey(e){let t=this.keyCache.get(e);if(t)return t;let n=e.rehypePlugins,r=e.remarkPlugins,a=e.remarkRehypeOptions;if(!(n||r||a)){let S="default";return this.keyCache.set(e,S),S}let l=S=>{if(!S||S.length===0)return"";let C="";for(let P=0;P<S.length;P+=1){let L=S[P];if(P>0&&(C+=","),Array.isArray(L)){let[F,U]=L;if(typeof F=="function"){let q=f4.get(F);q||(q=F.name,f4.set(F,q)),C+=q}else C+=String(F);C+=":",C+=JSON.stringify(U)}else if(typeof L=="function"){let F=f4.get(L);F||(F=L.name,f4.set(L,F)),C+=F}else C+=String(L)}return C},f=l(n),i=l(r),y=a?JSON.stringify(a):"",x=`${i}::${f}::${y}`;return this.keyCache.set(e,x),x}get(e){let t=this.generateCacheKey(e),n=this.cache.get(t);return n&&(this.cache.delete(t),this.cache.set(t,n)),n}set(e,t){let n=this.generateCacheKey(e);if(this.cache.size>=this.maxSize){let r=this.cache.keys().next().value;r&&this.cache.delete(r)}this.cache.set(n,t)}clear(){this.cache.clear()}},lG=new iOe,yre=e=>{let t=sOe(e),n=e.children||"";return oOe(t.runSync(t.parse(n),n),e)},sOe=e=>{let t=lG.get(e);if(t)return t;let n=aOe(e);return lG.set(e,n),n},aOe=e=>{let t=e.rehypePlugins||aG,n=e.remarkPlugins||aG,r=e.remarkRehypeOptions?{...oG,...e.remarkRehypeOptions}:oG;return QMe().use(tMe).use(n).use(zMe,r).use(t)},oOe=(e,t)=>uRe(e,{Fragment:k.Fragment,components:t.components,ignoreInvalidStyle:!0,jsx:k.jsx,jsxs:k.jsxs,passKeys:!0,passNode:!0}),lOe=/\[\^[^\]\s]{1,200}\](?!:)/,uOe=/\[\^[^\]\s]{1,200}\]:/,cOe=/<\/(\w+)>/,dOe=/<(\w+)[\s>]/,XR=e=>{let t=0;for(;t<e.length&&(e[t]===" "||e[t]==="	"||e[t]===`
`||e[t]==="\r");)t+=1;return t+1<e.length&&e[t]==="$"&&e[t+1]==="$"},hOe=e=>{let t=e.length-1;for(;t>=0&&(e[t]===" "||e[t]==="	"||e[t]===`
`||e[t]==="\r");)t-=1;return t>=1&&e[t]==="$"&&e[t-1]==="$"},YR=e=>{let t=0;for(let n=0;n<e.length-1;n+=1)e[n]==="$"&&e[n+1]==="$"&&(t+=1,n+=1);return t},fOe=e=>{let t=lOe.test(e),n=uOe.test(e);if(t||n)return[e];let r=md.lex(e,{gfm:!0}),a=[],l=[];for(let f of r){let i=f.raw,y=a.length;if(l.length>0){if(a[y-1]+=i,f.type==="html"){let x=i.match(cOe);if(x){let S=x[1];l.at(-1)===S&&l.pop()}}continue}if(f.type==="html"&&f.block){let x=i.match(dOe);if(x){let S=x[1];i.includes(`</${S}>`)||l.push(S)}}if(i.trim()==="$$"&&y>0){let x=a[y-1],S=XR(x),C=YR(x);if(S&&C%2===1){a[y-1]=x+i;continue}}if(y>0&&hOe(i)){let x=a[y-1],S=XR(x),C=YR(x),P=YR(i);if(S&&C%2===1&&!XR(i)&&P===1){a[y-1]=x+i;continue}}a.push(i)}return a},pOe={raw:F4e,katex:[XO,{errorColor:"var(--color-muted-foreground)"}],sanitize:[W4e,{}],harden:[bwe,{allowedImagePrefixes:["*"],allowedLinkPrefixes:["*"],allowedProtocols:["*"],defaultOrigin:void 0,allowDataImages:!0}]},mOe={gfm:[e6e,{}],math:[c8,{singleDollarTextMath:!1}],cjkFriendly:[bAe,{}],cjkFriendlyGfmStrikethrough:[TAe,{}]},gOe=Object.values(pOe),_Oe=Object.values(mOe),yOe={shikiTheme:["github-light","github-dark"],controls:!0,isAnimating:!1,mode:"streaming",mermaid:void 0},bh=B.createContext(yOe),vre=B.memo(({content:e,shouldParseIncompleteMarkdown:t,...n})=>{let r=B.useMemo(()=>typeof e=="string"&&t?X6e(e.trim()):e,[e,t]);return k.jsx(yre,{...n,children:r})},(e,t)=>{if(e.content!==t.content||e.shouldParseIncompleteMarkdown!==t.shouldParseIncompleteMarkdown||e.index!==t.index)return!1;if(e.components!==t.components){let n=Object.keys(e.components||{}),r=Object.keys(t.components||{});if(n.length!==r.length||n.some(a=>{var l,f;return((l=e.components)==null?void 0:l[a])!==((f=t.components)==null?void 0:f[a])}))return!1}return!(e.rehypePlugins!==t.rehypePlugins||e.remarkPlugins!==t.remarkPlugins)});vre.displayName="Block";var vOe=["github-light","github-dark"],xre=B.memo(({children:e,mode:t="streaming",parseIncompleteMarkdown:n=!0,components:r,rehypePlugins:a=gOe,remarkPlugins:l=_Oe,className:f,shikiTheme:i=vOe,mermaid:y,controls:x=!0,isAnimating:S=!1,BlockComponent:C=vre,parseMarkdownIntoBlocksFn:P=fOe,...L})=>{let F=B.useId(),[U,q]=B.useTransition(),[G,$]=B.useState([]),X=B.useMemo(()=>P(typeof e=="string"?e:""),[e,P]);B.useEffect(()=>{t==="streaming"?q(()=>{$(X)}):$(X)},[X,t]);let ie=t==="streaming"?G:X,de=B.useMemo(()=>ie.map((ve,Je)=>`${F}-${Je}`),[ie.length,F]),fe=B.useMemo(()=>({shikiTheme:i,controls:x,isAnimating:S,mode:t,mermaid:y}),[i,x,S,t,y]),be=B.useMemo(()=>({...rOe,...r}),[r]);return B.useEffect(()=>{if(!(Array.isArray(a)&&a.some(He=>Array.isArray(He)?He[0]===XO:He===XO)))return;let ve=!1;if(Array.isArray(l)){let He=l.find(ft=>Array.isArray(ft)?ft[0]===c8:ft===c8);He&&Array.isArray(He)&&He[1]&&(ve=He[1].singleDollarTextMath===!0)}let Je=typeof e=="string"?e:"",we=Je.includes("$$"),rt=ve&&(/[^$]\$[^$]/.test(Je)||/^\$[^$]/.test(Je)||/[^$]\$$/.test(Je));(we||rt)&&KT(()=>Promise.resolve().then(()=>pwe),void 0)},[a,l,e]),t==="static"?k.jsx(bh.Provider,{value:fe,children:k.jsx("div",{className:Hs("space-y-4 whitespace-normal",f),children:k.jsx(yre,{components:be,rehypePlugins:a,remarkPlugins:l,...L,children:e})})}):k.jsx(bh.Provider,{value:fe,children:k.jsx("div",{className:Hs("space-y-4 whitespace-normal",f),children:ie.map((ve,Je)=>k.jsx(C,{components:be,content:ve,index:Je,rehypePlugins:a,remarkPlugins:l,shouldParseIncompleteMarkdown:n,...L},de[Je]))})})},(e,t)=>e.children===t.children&&e.shikiTheme===t.shikiTheme&&e.isAnimating===t.isAnimating&&e.mode===t.mode);xre.displayName="Streamdown";var xOe=({children:e,className:t,minZoom:n=.5,maxZoom:r=3,zoomStep:a=.1,showControls:l=!0,initialZoom:f=1,fullscreen:i=!1})=>{let y=B.useRef(null),x=B.useRef(null),[S,C]=B.useState(f),[P,L]=B.useState({x:0,y:0}),[F,U]=B.useState(!1),[q,G]=B.useState({x:0,y:0}),[$,X]=B.useState({x:0,y:0}),ie=B.useCallback(He=>{C(ft=>Math.max(n,Math.min(r,ft+He)))},[n,r]),de=B.useCallback(()=>{ie(a)},[ie,a]),fe=B.useCallback(()=>{ie(-a)},[ie,a]),be=B.useCallback(()=>{C(f),L({x:0,y:0})},[f]),ve=B.useCallback(He=>{He.preventDefault();let ft=He.deltaY>0?-a:a;ie(ft)},[ie,a]),Je=B.useCallback(He=>{if(He.button!==0||He.isPrimary===!1)return;U(!0),G({x:He.clientX,y:He.clientY}),X(P);let ft=He.currentTarget;ft instanceof HTMLElement&&ft.setPointerCapture(He.pointerId)},[P]),we=B.useCallback(He=>{if(!F)return;He.preventDefault();let ft=He.clientX-q.x,Ct=He.clientY-q.y;L({x:$.x+ft,y:$.y+Ct})},[F,q,$]),rt=B.useCallback(He=>{U(!1);let ft=He.currentTarget;ft instanceof HTMLElement&&ft.releasePointerCapture(He.pointerId)},[]);return B.useEffect(()=>{let He=y.current;if(He)return He.addEventListener("wheel",ve,{passive:!1}),()=>{He.removeEventListener("wheel",ve)}},[ve]),B.useEffect(()=>{let He=x.current;if(He&&F)return document.body.style.userSelect="none",He.addEventListener("pointermove",we,{passive:!1}),He.addEventListener("pointerup",rt),He.addEventListener("pointercancel",rt),()=>{document.body.style.userSelect="",He.removeEventListener("pointermove",we),He.removeEventListener("pointerup",rt),He.removeEventListener("pointercancel",rt)}},[F,we,rt]),k.jsxs("div",{className:Hs("relative",i?"h-full w-full":"w-full",t),ref:y,style:{cursor:F?"grabbing":"grab"},children:[l&&k.jsxs("div",{className:Hs("absolute z-10 flex flex-col gap-1 rounded-md border border-border bg-background/90 p-1 shadow-sm backdrop-blur-sm",i?"bottom-4 left-4":"bottom-2 left-2"),children:[k.jsx("button",{className:"flex items-center justify-center rounded p-1.5 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",disabled:S>=r,onClick:de,title:"Zoom in",type:"button",children:k.jsx(f5e,{size:16})}),k.jsx("button",{className:"flex items-center justify-center rounded p-1.5 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",disabled:S<=n,onClick:fe,title:"Zoom out",type:"button",children:k.jsx(m5e,{size:16})}),k.jsx("button",{className:"flex items-center justify-center rounded p-1.5 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground",onClick:be,title:"Reset zoom and pan",type:"button",children:k.jsx(u5e,{size:16})})]}),k.jsx("div",{className:Hs("origin-center transition-transform duration-150 ease-out",i&&"flex w-full items-center justify-center"),onPointerDown:Je,ref:x,role:"application",style:{transform:`translate(${P.x}px, ${P.y}px) scale(${S})`,transformOrigin:"center center",touchAction:"none",willChange:"transform"},children:e})]})},bre=({chart:e,className:t,config:n,fullscreen:r=!1,showControls:a=!0})=>{let[l,f]=B.useState(null),[i,y]=B.useState(!0),[x,S]=B.useState(""),[C,P]=B.useState(""),[L,F]=B.useState(0),{mermaid:U}=B.useContext(bh),q=U==null?void 0:U.errorComponent;if(B.useEffect(()=>{(async()=>{try{f(null),y(!0);let $=await Gne(n),X=e.split("").reduce((fe,be)=>(fe<<5)-fe+be.charCodeAt(0)|0,0),ie=`mermaid-${Math.abs(X)}-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,{svg:de}=await $.render(ie,e);S(de),P(de)}catch($){if(!(C||x)){let X=$ instanceof Error?$.message:"Failed to render Mermaid chart";f(X)}}finally{y(!1)}})()},[e,n,L]),i&&!x&&!C)return k.jsx("div",{className:Hs("my-4 flex justify-center p-4",t),children:k.jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[k.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-current border-b-2"}),k.jsx("span",{className:"text-sm",children:"Loading diagram..."})]})});if(l&&!x&&!C){let $=()=>F(X=>X+1);return q?k.jsx(q,{chart:e,error:l,retry:$}):k.jsxs("div",{className:Hs("rounded-lg border border-red-200 bg-red-50 p-4",t),children:[k.jsxs("p",{className:"font-mono text-red-700 text-sm",children:["Mermaid Error: ",l]}),k.jsxs("details",{className:"mt-2",children:[k.jsx("summary",{className:"cursor-pointer text-red-600 text-xs",children:"Show Code"}),k.jsx("pre",{className:"mt-2 overflow-x-auto rounded bg-red-100 p-2 text-red-800 text-xs",children:e})]})]})}let G=x||C;return k.jsx(xOe,{className:Hs(r?"h-full w-full overflow-hidden":"my-4 overflow-hidden",t),fullscreen:r,maxZoom:3,minZoom:.5,showControls:a,zoomStep:.1,children:k.jsx("div",{"aria-label":"Mermaid chart",className:Hs("flex justify-center",r&&"h-full w-full items-center"),dangerouslySetInnerHTML:{__html:G},role:"img"})})};const bOe=Symbol("Let zodToJsonSchema decide on which parser to use"),uG={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},wOe=e=>typeof e=="string"?{...uG,name:e}:{...uG,...e},TOe=e=>{const t=wOe(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}};function wre(e,t,n,r){r!=null&&r.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function Ga(e,t,n,r,a){e[t]=n,wre(e,t,r,a)}const Tre=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")};var PT;(function(e){e.assertEqual=a=>{};function t(a){}e.assertIs=t;function n(a){throw new Error}e.assertNever=n,e.arrayToEnum=a=>{const l={};for(const f of a)l[f]=f;return l},e.getValidEnumValues=a=>{const l=e.objectKeys(a).filter(i=>typeof a[a[i]]!="number"),f={};for(const i of l)f[i]=a[i];return e.objectValues(f)},e.objectValues=a=>e.objectKeys(a).map(function(l){return a[l]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const l=[];for(const f in a)Object.prototype.hasOwnProperty.call(a,f)&&l.push(f);return l},e.find=(a,l)=>{for(const f of a)if(l(f))return f},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,l=" | "){return a.map(f=>typeof f=="string"?`'${f}'`:f).join(l)}e.joinValues=r,e.jsonStringifyReplacer=(a,l)=>typeof l=="bigint"?l.toString():l})(PT||(PT={}));var cG;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(cG||(cG={}));PT.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]);PT.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);let dG=class Ere extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(l){return l.message},r={_errors:[]},a=l=>{for(const f of l.issues)if(f.code==="invalid_union")f.unionErrors.map(a);else if(f.code==="invalid_return_type")a(f.returnTypeError);else if(f.code==="invalid_arguments")a(f.argumentsError);else if(f.path.length===0)r._errors.push(n(f));else{let i=r,y=0;for(;y<f.path.length;){const x=f.path[y];y===f.path.length-1?(i[x]=i[x]||{_errors:[]},i[x]._errors.push(n(f))):i[x]=i[x]||{_errors:[]},i=i[x],y++}}};return a(this),r}static assert(t){if(!(t instanceof Ere))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,PT.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n=Object.create(null),r=[];for(const a of this.issues)if(a.path.length>0){const l=a.path[0];n[l]=n[l]||[],n[l].push(t(a))}else r.push(t(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}};dG.create=e=>new dG(e);var hG;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(hG||(hG={}));var Ts;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(Ts||(Ts={}));function dc(e){if(e.target!=="openAi")return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:e.$refStrategy==="relative"?Tre(t,e.currentPath):t.join("/")}}function EOe(e,t){var r,a,l;const n={type:"array"};return(r=e.type)!=null&&r._def&&((l=(a=e.type)==null?void 0:a._def)==null?void 0:l.typeName)!==Ts.ZodAny&&(n.items=Va(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&Ga(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&Ga(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(Ga(n,"minItems",e.exactLength.value,e.exactLength.message,t),Ga(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}function SOe(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":t.target==="jsonSchema7"?r.inclusive?Ga(n,"minimum",r.value,r.message,t):Ga(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ga(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Ga(n,"maximum",r.value,r.message,t):Ga(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ga(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ga(n,"multipleOf",r.value,r.message,t);break}return n}function AOe(){return{type:"boolean"}}function Sre(e,t){return Va(e.type._def,t)}const COe=(e,t)=>Va(e.innerType._def,t);function Are(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,l)=>Are(e,t,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return kOe(e,t)}}const kOe=(e,t)=>{const n={type:"integer",format:"unix-time"};if(t.target==="openApi3")return n;for(const r of e.checks)switch(r.kind){case"min":Ga(n,"minimum",r.value,r.message,t);break;case"max":Ga(n,"maximum",r.value,r.message,t);break}return n};function IOe(e,t){return{...Va(e.innerType._def,t),default:e.defaultValue()}}function ROe(e,t){return t.effectStrategy==="input"?Va(e.schema._def,t):dc(t)}function MOe(e){return{type:"string",enum:Array.from(e.values)}}const POe=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function OOe(e,t){const n=[Va(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),Va(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(l=>!!l);let r=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return n.forEach(l=>{if(POe(l))a.push(...l.allOf),l.unevaluatedProperties===void 0&&(r=void 0);else{let f=l;if("additionalProperties"in l&&l.additionalProperties===!1){const{additionalProperties:i,...y}=l;f=y}else r=void 0;a.push(f)}}),a.length?{allOf:a,...r}:void 0}function LOe(e,t){const n=typeof e.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[e.value]}:{type:n==="bigint"?"integer":n,const:e.value}}let KR;const th={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(KR===void 0&&(KR=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),KR),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Cre(e,t){const n={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":Ga(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t);break;case"max":Ga(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"email":switch(t.emailStrategy){case"format:email":nh(n,"email",r.message,t);break;case"format:idn-email":nh(n,"idn-email",r.message,t);break;case"pattern:zod":Au(n,th.email,r.message,t);break}break;case"url":nh(n,"uri",r.message,t);break;case"uuid":nh(n,"uuid",r.message,t);break;case"regex":Au(n,r.regex,r.message,t);break;case"cuid":Au(n,th.cuid,r.message,t);break;case"cuid2":Au(n,th.cuid2,r.message,t);break;case"startsWith":Au(n,RegExp(`^${QR(r.value,t)}`),r.message,t);break;case"endsWith":Au(n,RegExp(`${QR(r.value,t)}$`),r.message,t);break;case"datetime":nh(n,"date-time",r.message,t);break;case"date":nh(n,"date",r.message,t);break;case"time":nh(n,"time",r.message,t);break;case"duration":nh(n,"duration",r.message,t);break;case"length":Ga(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t),Ga(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"includes":{Au(n,RegExp(QR(r.value,t)),r.message,t);break}case"ip":{r.version!=="v6"&&nh(n,"ipv4",r.message,t),r.version!=="v4"&&nh(n,"ipv6",r.message,t);break}case"base64url":Au(n,th.base64url,r.message,t);break;case"jwt":Au(n,th.jwt,r.message,t);break;case"cidr":{r.version!=="v6"&&Au(n,th.ipv4Cidr,r.message,t),r.version!=="v4"&&Au(n,th.ipv6Cidr,r.message,t);break}case"emoji":Au(n,th.emoji(),r.message,t);break;case"ulid":{Au(n,th.ulid,r.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{nh(n,"binary",r.message,t);break}case"contentEncoding:base64":{Ga(n,"contentEncoding","base64",r.message,t);break}case"pattern:zod":{Au(n,th.base64,r.message,t);break}}break}case"nanoid":Au(n,th.nanoid,r.message,t)}return n}function QR(e,t){return t.patternStrategy==="escape"?NOe(e):e}const DOe=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function NOe(e){let t="";for(let n=0;n<e.length;n++)DOe.has(e[n])||(t+="\\"),t+=e[n];return t}function nh(e,t,n,r){var a;e.format||(a=e.anyOf)!=null&&a.some(l=>l.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Ga(e,"format",t,n,r)}function Au(e,t,n,r){var a;e.pattern||(a=e.allOf)!=null&&a.some(l=>l.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:fG(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Ga(e,"pattern",fG(t,r),n,r)}function fG(e,t){var y;if(!t.applyRegexFlags||!e.flags)return e.source;const n={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},r=n.i?e.source.toLowerCase():e.source;let a="",l=!1,f=!1,i=!1;for(let x=0;x<r.length;x++){if(l){a+=r[x],l=!1;continue}if(n.i){if(f){if(r[x].match(/[a-z]/)){i?(a+=r[x],a+=`${r[x-2]}-${r[x]}`.toUpperCase(),i=!1):r[x+1]==="-"&&((y=r[x+2])!=null&&y.match(/[a-z]/))?(a+=r[x],i=!0):a+=`${r[x]}${r[x].toUpperCase()}`;continue}}else if(r[x].match(/[a-z]/)){a+=`[${r[x]}${r[x].toUpperCase()}]`;continue}}if(n.m){if(r[x]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(r[x]==="$"){a+=`($|(?=[\r
]))`;continue}}if(n.s&&r[x]==="."){a+=f?`${r[x]}\r
`:`[${r[x]}\r
]`;continue}a+=r[x],r[x]==="\\"?l=!0:f&&r[x]==="]"?f=!1:!f&&r[x]==="["&&(f=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return a}function kre(e,t){var r,a,l,f,i,y;if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&((r=e.keyType)==null?void 0:r._def.typeName)===Ts.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((x,S)=>({...x,[S]:Va(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",S]})??dc(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};const n={type:"object",additionalProperties:Va(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if(t.target==="openApi3")return n;if(((a=e.keyType)==null?void 0:a._def.typeName)===Ts.ZodString&&((l=e.keyType._def.checks)!=null&&l.length)){const{type:x,...S}=Cre(e.keyType._def,t);return{...n,propertyNames:S}}else{if(((f=e.keyType)==null?void 0:f._def.typeName)===Ts.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};if(((i=e.keyType)==null?void 0:i._def.typeName)===Ts.ZodBranded&&e.keyType._def.type._def.typeName===Ts.ZodString&&((y=e.keyType._def.type._def.checks)!=null&&y.length)){const{type:x,...S}=Sre(e.keyType._def,t);return{...n,propertyNames:S}}}return n}function zOe(e,t){if(t.mapStrategy==="record")return kre(e,t);const n=Va(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||dc(t),r=Va(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||dc(t);return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function FOe(e){const t=e.values,r=Object.keys(e.values).filter(l=>typeof t[t[l]]!="number").map(l=>t[l]),a=Array.from(new Set(r.map(l=>typeof l)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:r}}function BOe(e){return e.target==="openAi"?void 0:{not:dc({...e,currentPath:[...e.currentPath,"not"]})}}function jOe(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const XC={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function UOe(e,t){if(t.target==="openApi3")return pG(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(r=>r._def.typeName in XC&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((a,l)=>{const f=XC[l._def.typeName];return f&&!a.includes(f)?[...a,f]:a},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((a,l)=>{const f=typeof l._def.value;switch(f){case"string":case"number":case"boolean":return[...a,f];case"bigint":return[...a,"integer"];case"object":if(l._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===n.length){const a=r.filter((l,f,i)=>i.indexOf(l)===f);return{type:a.length>1?a:a[0],enum:n.reduce((l,f)=>l.includes(f._def.value)?l:[...l,f._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,a)=>[...r,...a._def.values.filter(l=>!r.includes(l))],[])};return pG(e,t)}const pG=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,a)=>Va(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function VOe(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:XC[e.innerType._def.typeName],nullable:!0}:{type:[XC[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const r=Va(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=Va(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function $Oe(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",wre(n,"type",r.message,t);break;case"min":t.target==="jsonSchema7"?r.inclusive?Ga(n,"minimum",r.value,r.message,t):Ga(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Ga(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Ga(n,"maximum",r.value,r.message,t):Ga(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Ga(n,"maximum",r.value,r.message,t));break;case"multipleOf":Ga(n,"multipleOf",r.value,r.message,t);break}return n}function HOe(e,t){const n=t.target==="openAi",r={type:"object",properties:{}},a=[],l=e.shape();for(const i in l){let y=l[i];if(y===void 0||y._def===void 0)continue;let x=qOe(y);x&&n&&(y._def.typeName==="ZodOptional"&&(y=y._def.innerType),y.isNullable()||(y=y.nullable()),x=!1);const S=Va(y._def,{...t,currentPath:[...t.currentPath,"properties",i],propertyPath:[...t.currentPath,"properties",i]});S!==void 0&&(r.properties[i]=S,x||a.push(i))}a.length&&(r.required=a);const f=GOe(e,t);return f!==void 0&&(r.additionalProperties=f),r}function GOe(e,t){if(e.catchall._def.typeName!=="ZodNever")return Va(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function qOe(e){try{return e.isOptional()}catch{return!0}}const ZOe=(e,t)=>{var r;if(t.currentPath.toString()===((r=t.propertyPath)==null?void 0:r.toString()))return Va(e.innerType._def,t);const n=Va(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:dc(t)},n]}:dc(t)},WOe=(e,t)=>{if(t.pipeStrategy==="input")return Va(e.in._def,t);if(t.pipeStrategy==="output")return Va(e.out._def,t);const n=Va(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=Va(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(a=>a!==void 0)}};function XOe(e,t){return Va(e.type._def,t)}function YOe(e,t){const r={type:"array",uniqueItems:!0,items:Va(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&Ga(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&Ga(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}function KOe(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,r)=>Va(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:Va(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,r)=>Va(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function QOe(e){return{not:dc(e)}}function JOe(e){return dc(e)}const e8e=(e,t)=>Va(e.innerType._def,t),t8e=(e,t,n)=>{switch(t){case Ts.ZodString:return Cre(e,n);case Ts.ZodNumber:return $Oe(e,n);case Ts.ZodObject:return HOe(e,n);case Ts.ZodBigInt:return SOe(e,n);case Ts.ZodBoolean:return AOe();case Ts.ZodDate:return Are(e,n);case Ts.ZodUndefined:return QOe(n);case Ts.ZodNull:return jOe(n);case Ts.ZodArray:return EOe(e,n);case Ts.ZodUnion:case Ts.ZodDiscriminatedUnion:return UOe(e,n);case Ts.ZodIntersection:return OOe(e,n);case Ts.ZodTuple:return KOe(e,n);case Ts.ZodRecord:return kre(e,n);case Ts.ZodLiteral:return LOe(e,n);case Ts.ZodEnum:return MOe(e);case Ts.ZodNativeEnum:return FOe(e);case Ts.ZodNullable:return VOe(e,n);case Ts.ZodOptional:return ZOe(e,n);case Ts.ZodMap:return zOe(e,n);case Ts.ZodSet:return YOe(e,n);case Ts.ZodLazy:return()=>e.getter()._def;case Ts.ZodPromise:return XOe(e,n);case Ts.ZodNaN:case Ts.ZodNever:return BOe(n);case Ts.ZodEffects:return ROe(e,n);case Ts.ZodAny:return dc(n);case Ts.ZodUnknown:return JOe(n);case Ts.ZodDefault:return IOe(e,n);case Ts.ZodBranded:return Sre(e,n);case Ts.ZodReadonly:return e8e(e,n);case Ts.ZodCatch:return COe(e,n);case Ts.ZodPipeline:return WOe(e,n);case Ts.ZodFunction:case Ts.ZodVoid:case Ts.ZodSymbol:return;default:return(r=>{})()}};function Va(e,t,n=!1){var i;const r=t.seen.get(e);if(t.override){const y=(i=t.override)==null?void 0:i.call(t,e,t,r,n);if(y!==bOe)return y}if(r&&!n){const y=n8e(r,t);if(y!==void 0)return y}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const l=t8e(e,e.typeName,t),f=typeof l=="function"?Va(l(),t):l;if(f&&r8e(e,t,f),t.postProcess){const y=t.postProcess(f,e,t);return a.jsonSchema=f,y}return a.jsonSchema=f,f}const n8e=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Tre(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((n,r)=>t.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),dc(t)):t.$refStrategy==="seen"?dc(t):void 0}},r8e=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),i8e=(e,t)=>{const n=TOe(t);let r=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((y,[x,S])=>({...y,[x]:Va(S._def,{...n,currentPath:[...n.basePath,n.definitionPath,x]},!0)??dc(n)}),{}):void 0;const a=typeof t=="string"?t:(t==null?void 0:t.nameStrategy)==="title"||t==null?void 0:t.name,l=Va(e._def,a===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,a]},!1)??dc(n),f=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;f!==void 0&&(l.title=f),n.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[n.openAiAnyTypeName]||(r[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:n.$refStrategy==="relative"?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));const i=a===void 0?r?{...l,[n.definitionPath]:r}:l:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,a].join("/"),[n.definitionPath]:{...r,[a]:l}};return n.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(n.target==="jsonSchema2019-09"||n.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),n.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};var Ire=class extends EC{constructor(t){const n=t.runtimeUrl?t.runtimeUrl.replace(/\/$/,""):void 0,r=t.transport??"rest",a=r==="single"?n??t.runtimeUrl??"":`${n??t.runtimeUrl}/agent/${encodeURIComponent(t.agentId??"")}/run`;if(!a)throw new Error("ProxiedCopilotRuntimeAgent requires a runtimeUrl when transport is set to 'single'.");super({...t,url:a});wi(this,"runtimeUrl");wi(this,"transport");wi(this,"singleEndpointUrl");this.runtimeUrl=n??t.runtimeUrl,this.transport=r,this.transport==="single"&&(this.singleEndpointUrl=this.runtimeUrl)}abortRun(){if(!this.agentId||!this.threadId||typeof fetch>"u")return;if(this.transport==="single"){if(!this.singleEndpointUrl)return;const l=new Headers({...this.headers,"Content-Type":"application/json"});fetch(this.singleEndpointUrl,{method:"POST",headers:l,body:JSON.stringify({method:"agent/stop",params:{agentId:this.agentId,threadId:this.threadId}})}).catch(f=>{console.error("ProxiedCopilotRuntimeAgent: stop request failed",f)});return}if(!this.runtimeUrl)return;const t=`${this.runtimeUrl}/agent/${encodeURIComponent(this.agentId)}/stop/${encodeURIComponent(this.threadId)}`,n=typeof window<"u"&&window.location?window.location.origin:"http://localhost",r=new URL(this.runtimeUrl,n),a=new URL(t,r);fetch(a.toString(),{method:"POST",headers:{"Content-Type":"application/json",...this.headers}}).catch(l=>{console.error("ProxiedCopilotRuntimeAgent: stop request failed",l)})}connect(t){if(this.transport==="single"){if(!this.singleEndpointUrl)throw new Error("Single endpoint transport requires a runtimeUrl");const r=this.createSingleRouteRequestInit(t,"agent/connect",{agentId:this.agentId}),a=oA(this.singleEndpointUrl,r);return lA(a)}const n=oA(`${this.runtimeUrl}/agent/${this.agentId}/connect`,this.requestInit(t));return lA(n)}run(t){if(this.transport==="single"){if(!this.singleEndpointUrl)throw new Error("Single endpoint transport requires a runtimeUrl");const n=this.createSingleRouteRequestInit(t,"agent/run",{agentId:this.agentId}),r=oA(this.singleEndpointUrl,n);return lA(r)}return super.run(t)}clone(){const t=super.clone();return t.runtimeUrl=this.runtimeUrl,t.transport=this.transport,t.singleEndpointUrl=this.singleEndpointUrl,t}createSingleRouteRequestInit(t,n,r){if(!this.agentId)throw new Error("ProxiedCopilotRuntimeAgent requires agentId to make runtime requests");const a=super.requestInit(t),l=new Headers(a.headers??{});l.set("Content-Type","application/json"),l.set("Accept",l.get("Accept")??"text/event-stream");let f;if(typeof a.body=="string")try{f=JSON.parse(a.body)}catch(y){console.warn("ProxiedCopilotRuntimeAgent: failed to parse request body for single route transport",y),f=void 0}const i={method:n};return r&&Object.keys(r).length>0&&(i.params=r),f!==void 0&&(i.body=f),{...a,headers:l,body:JSON.stringify(i)}}},s8e=class{constructor(e){wi(this,"_agents",{});wi(this,"localAgents",{});wi(this,"remoteAgents",{});wi(this,"_runtimeUrl");wi(this,"_runtimeVersion");wi(this,"_runtimeConnectionStatus","disconnected");wi(this,"_runtimeTransport","rest");this.core=e}get agents(){return this._agents}get runtimeUrl(){return this._runtimeUrl}get runtimeVersion(){return this._runtimeVersion}get runtimeConnectionStatus(){return this._runtimeConnectionStatus}get runtimeTransport(){return this._runtimeTransport}initialize(e){this.localAgents=this.assignAgentIds(e),this.applyHeadersToAgents(this.localAgents),this._agents=this.localAgents}setRuntimeUrl(e){const t=e?e.replace(/\/$/,""):void 0;this._runtimeUrl!==t&&(this._runtimeUrl=t,this.updateRuntimeConnection())}setRuntimeTransport(e){this._runtimeTransport!==e&&(this._runtimeTransport=e,this.updateRuntimeConnection())}setAgents__unsafe_dev_only(e){Object.entries(e).forEach(([t,n])=>{n&&this.validateAndAssignAgentId(t,n)}),this.localAgents=e,this._agents={...this.localAgents,...this.remoteAgents},this.applyHeadersToAgents(this._agents),this.notifyAgentsChanged()}addAgent__unsafe_dev_only({id:e,agent:t}){this.validateAndAssignAgentId(e,t),this.localAgents[e]=t,this.applyHeadersToAgent(t),this._agents={...this.localAgents,...this.remoteAgents},this.notifyAgentsChanged()}removeAgent__unsafe_dev_only(e){delete this.localAgents[e],this._agents={...this.localAgents,...this.remoteAgents},this.notifyAgentsChanged()}getAgent(e){if(e in this._agents)return this._agents[e];this.runtimeUrl!==void 0&&(this.runtimeConnectionStatus==="disconnected"||this.runtimeConnectionStatus==="connecting")||console.warn(`Agent ${e} not found`)}applyHeadersToAgent(e){e instanceof EC&&(e.headers={...this.core.headers})}applyHeadersToAgents(e){Object.values(e).forEach(t=>{this.applyHeadersToAgent(t)})}async updateRuntimeConnection(){if(!(typeof window>"u")){if(!this.runtimeUrl){this._runtimeConnectionStatus="disconnected",this._runtimeVersion=void 0,this.remoteAgents={},this._agents=this.localAgents,await this.notifyRuntimeStatusChanged("disconnected"),await this.notifyAgentsChanged();return}this._runtimeConnectionStatus="connecting",await this.notifyRuntimeStatusChanged("connecting");try{const e=await this.fetchRuntimeInfo(),{version:t,...n}=e,r=Object.fromEntries(Object.entries(n.agents).map(([a,{description:l}])=>{const f=new Ire({runtimeUrl:this.runtimeUrl,agentId:a,description:l,transport:this._runtimeTransport});return this.applyHeadersToAgent(f),[a,f]}));this.remoteAgents=r,this._agents={...this.localAgents,...this.remoteAgents},this._runtimeConnectionStatus="connected",this._runtimeVersion=t,await this.notifyRuntimeStatusChanged("connected"),await this.notifyAgentsChanged()}catch(e){this._runtimeConnectionStatus="error",this._runtimeVersion=void 0,this.remoteAgents={},this._agents=this.localAgents,await this.notifyRuntimeStatusChanged("error"),await this.notifyAgentsChanged();const t=e instanceof Error?e.message:JSON.stringify(e);mK.warn(`Failed to load runtime info (${this.runtimeUrl}/info): ${t}`);const n=e instanceof Error?e:new Error(String(e));await this.core.emitError({error:n,code:"runtime_info_fetch_failed",context:{runtimeUrl:this.runtimeUrl}})}}}async fetchRuntimeInfo(){if(!this.runtimeUrl)throw new Error("Runtime URL is not set");const t={...this.core.headers};if(this._runtimeTransport==="single"){t["Content-Type"]||(t["Content-Type"]="application/json");const r=await fetch(this.runtimeUrl,{method:"POST",headers:t,body:JSON.stringify({method:"info"})});if("ok"in r&&!r.ok)throw new Error(`Runtime info request failed with status ${r.status}`);return await r.json()}const n=await fetch(`${this.runtimeUrl}/info`,{headers:t});if("ok"in n&&!n.ok)throw new Error(`Runtime info request failed with status ${n.status}`);return await n.json()}assignAgentIds(e){return Object.entries(e).forEach(([t,n])=>{n&&this.validateAndAssignAgentId(t,n)}),e}validateAndAssignAgentId(e,t){if(t.agentId&&t.agentId!==e)throw new Error(`Agent registration mismatch: Agent with ID "${t.agentId}" cannot be registered under key "${e}". The agent ID must match the registration key or be undefined.`);t.agentId||(t.agentId=e)}async notifyRuntimeStatusChanged(e){await this.core.notifySubscribers(t=>{var n;return(n=t.onRuntimeConnectionStatusChanged)==null?void 0:n.call(t,{copilotkit:this.core,status:e})},"Error in CopilotKitCore subscriber (onRuntimeConnectionStatusChanged):")}async notifyAgentsChanged(){await this.core.notifySubscribers(e=>{var t;return(t=e.onAgentsChanged)==null?void 0:t.call(e,{copilotkit:this.core,agents:this._agents})},"Subscriber onAgentsChanged error:")}},a8e=class{constructor(e){wi(this,"_context",{});this.core=e}get context(){return this._context}addContext({description:e,value:t}){const n=gf();return this._context[n]={description:e,value:t},this.notifySubscribers(),n}removeContext(e){delete this._context[e],this.notifySubscribers()}async notifySubscribers(){await this.core.notifySubscribers(e=>{var t;return(t=e.onContextChanged)==null?void 0:t.call(e,{copilotkit:this.core,context:this._context})},"Subscriber onContextChanged error:")}},o8e=class{constructor(e){wi(this,"_suggestionsConfig",{});wi(this,"_suggestions",{});wi(this,"_runningSuggestions",{});this.core=e}initialize(e){for(const t of e)this._suggestionsConfig[gf()]=t}addSuggestionsConfig(e){const t=gf();return this._suggestionsConfig[t]=e,this.notifySuggestionsConfigChanged(),t}removeSuggestionsConfig(e){delete this._suggestionsConfig[e],this.notifySuggestionsConfigChanged()}reloadSuggestions(e){var a;this.clearSuggestions(e);const t=this.core.getAgent(e);if(!t)return;const n=((a=t.messages)==null?void 0:a.length)??0;let r=!1;for(const l of Object.values(this._suggestionsConfig)){if(l.consumerAgentId!==void 0&&l.consumerAgentId!=="*"&&l.consumerAgentId!==e||!this.shouldShowSuggestions(l,n))continue;const f=gf();mG(l)?(r||(r=!0,this.notifySuggestionsStartedLoading(e)),this.generateSuggestions(f,l,e)):l8e(l)&&this.addStaticSuggestions(f,l,e)}}clearSuggestions(e){const t=this._runningSuggestions[e];if(t){for(const n of t)n.abortRun();delete this._runningSuggestions[e]}this._suggestions[e]={},this.notifySuggestionsChanged(e,[])}getSuggestions(e){var r;const t=Object.values(this._suggestions[e]??{}).flat(),n=(((r=this._runningSuggestions[e])==null?void 0:r.length)??0)>0;return{suggestions:t,isLoading:n}}async generateSuggestions(e,t,n){let r;try{const a=this.core.getAgent(t.providerAgentId??"default");if(!a)throw new Error(`Suggestions provider agent not found: ${t.providerAgentId}`);const l=this.core.getAgent(n);if(!l)throw new Error(`Suggestions consumer agent not found: ${n}`);r=a.clone(),r.threadId=e,r.messages=JSON.parse(JSON.stringify(l.messages)),r.state=JSON.parse(JSON.stringify(l.state)),this._suggestions[n]={...this._suggestions[n]??{},[e]:[]},this._runningSuggestions[n]=[...this._runningSuggestions[n]??[],r],r.addMessage({id:e,role:"user",content:["Suggest what the user could say next. Provide clear, highly relevant suggestions by calling the `copilotkitSuggest` tool.",`Provide at least ${t.minSuggestions??1} and at most ${t.maxSuggestions??3} suggestions.`,`The user has the following tools available: ${JSON.stringify(this.core.buildFrontendTools(n))}.`,` ${t.instructions}`].join(`
`)}),await r.runAgent({context:Object.values(this.core.context),forwardedProps:{...this.core.properties,toolChoice:{type:"function",function:{name:"copilotkitSuggest"}}},tools:[u8e]},{onMessagesChanged:({messages:i})=>{this.extractSuggestions(i,e,n,!0)}})}catch(a){console.warn("Error generating suggestions:",a)}finally{this.finalizeSuggestions(e,n);const a=this._runningSuggestions[n];if(r&&a){const l=a.filter(f=>f!==r);this._runningSuggestions[n]=l,l.length===0&&(delete this._runningSuggestions[n],await this.notifySuggestionsFinishedLoading(n))}}}finalizeSuggestions(e,t){const n=this._suggestions[t],r=n==null?void 0:n[e];if(n&&r&&r.length>0){const a=r.filter(f=>f.title!==""||f.message!=="").map(f=>({...f,isLoading:!1}));a.length>0?n[e]=a:delete n[e];const l=Object.values(this._suggestions[t]??{}).flat();this.notifySuggestionsChanged(t,l,"finalized")}}extractSuggestions(e,t,n,r){const a=e.findIndex(y=>y.id===t);if(a==-1)return;const l=[],f=e.slice(a+1);for(const y of f)if(y.role==="assistant"&&y.toolCalls){for(const x of y.toolCalls)if(x.function.name==="copilotkitSuggest"){const S=Array.isArray(x.function.arguments)?x.function.arguments.join(""):x.function.arguments,C=pK(S);if(C&&typeof C=="object"&&"suggestions"in C){const P=C.suggestions;if(Array.isArray(P))for(const L of P)L&&typeof L=="object"&&"title"in L&&l.push({title:L.title??"",message:L.message??"",isLoading:!1})}}}r&&l.length>0&&(l[l.length-1].isLoading=!0);const i=this._suggestions[n];if(i){i[t]=l;const y=Object.values(this._suggestions[n]??{}).flat();this.notifySuggestionsChanged(n,y,"suggestions changed")}}async notifySuggestionsConfigChanged(){await this.core.notifySubscribers(e=>{var t;return(t=e.onSuggestionsConfigChanged)==null?void 0:t.call(e,{copilotkit:this.core,suggestionsConfig:this._suggestionsConfig})},"Subscriber onSuggestionsConfigChanged error:")}async notifySuggestionsChanged(e,t,n=""){await this.core.notifySubscribers(r=>{var a;return(a=r.onSuggestionsChanged)==null?void 0:a.call(r,{copilotkit:this.core,agentId:e,suggestions:t})},`Subscriber onSuggestionsChanged error: ${n}`)}async notifySuggestionsStartedLoading(e){await this.core.notifySubscribers(t=>{var n;return(n=t.onSuggestionsStartedLoading)==null?void 0:n.call(t,{copilotkit:this.core,agentId:e})},"Subscriber onSuggestionsStartedLoading error:")}async notifySuggestionsFinishedLoading(e){await this.core.notifySubscribers(t=>{var n;return(n=t.onSuggestionsFinishedLoading)==null?void 0:n.call(t,{copilotkit:this.core,agentId:e})},"Subscriber onSuggestionsFinishedLoading error:")}shouldShowSuggestions(e,t){const n=e.available;if(!n)return mG(e)?t>0:t===0;switch(n){case"disabled":return!1;case"before-first-message":return t===0;case"after-first-message":return t>0;case"always":return!0;default:return!1}}addStaticSuggestions(e,t,n){const r=t.suggestions.map(l=>({...l,isLoading:!1}));this._suggestions[n]={...this._suggestions[n]??{},[e]:r};const a=Object.values(this._suggestions[n]??{}).flat();this.notifySuggestionsChanged(n,a,"static suggestions added")}};function mG(e){return"instructions"in e}function l8e(e){return"suggestions"in e}var u8e={name:"copilotkitSuggest",description:"Suggest what the user could say next",parameters:{type:"object",properties:{suggestions:{type:"array",description:"List of suggestions shown to the user as buttons.",items:{type:"object",properties:{title:{type:"string",description:"The title of the suggestion. This is shown as a button and should be short."},message:{type:"string",description:"The message to send when the suggestion is clicked. This should be a clear, complete sentence and will be sent as an instruction to the AI."}},required:["title","message"]}}},required:["suggestions"]}},c8e=class{constructor(e){wi(this,"_tools",[]);this.core=e}get tools(){return this._tools}initialize(e){this._tools=e}addTool(e){if(this._tools.findIndex(n=>n.name===e.name&&n.agentId===e.agentId)!==-1){mK.warn(`Tool already exists: '${e.name}' for agent '${e.agentId||"global"}', skipping.`);return}this._tools.push(e)}removeTool(e,t){this._tools=this._tools.filter(n=>t!==void 0?!(n.name===e&&n.agentId===t):!(n.name===e&&!n.agentId))}getTool(e){const{toolName:t,agentId:n}=e;if(n){const r=this._tools.find(a=>a.name===t&&a.agentId===n);if(r)return r}return this._tools.find(r=>r.name===t&&!r.agentId)}setTools(e){this._tools=[...e]}async connectAgent({agent:e}){try{await e.detachActiveRun(),e.setMessages([]),e.setState({}),e instanceof EC&&(e.headers={...this.core.headers});const t=await e.connectAgent({forwardedProps:this.core.properties,tools:this.buildFrontendTools(e.agentId)},this.createAgentErrorSubscriber(e));return this.processAgentResult({runAgentResult:t,agent:e})}catch(t){const n=t instanceof Error?t:new Error(String(t)),r={};throw e.agentId&&(r.agentId=e.agentId),await this.core.emitError({error:n,code:"agent_connect_failed",context:r}),t}}async runAgent({agent:e,withMessages:t}){e.agentId&&this.core.suggestionEngine.clearSuggestions(e.agentId),e instanceof EC&&(e.headers={...this.core.headers}),t&&e.addMessages(t);try{const n=await e.runAgent({forwardedProps:this.core.properties,tools:this.buildFrontendTools(e.agentId),context:Object.values(this.core.context)},this.createAgentErrorSubscriber(e));return this.processAgentResult({runAgentResult:n,agent:e})}catch(n){const r=n instanceof Error?n:new Error(String(n)),a={};throw e.agentId&&(a.agentId=e.agentId),t&&(a.messageCount=t.length),await this.core.emitError({error:r,code:"agent_run_failed",context:a}),n}}async processAgentResult({runAgentResult:e,agent:t}){const{newMessages:n}=e,r=t.agentId;let a=!1;for(const l of n)if(l.role==="assistant"){for(const f of l.toolCalls||[])if(n.findIndex(i=>i.role==="tool"&&i.toolCallId===f.id)===-1){const i=this.getTool({toolName:f.function.name,agentId:t.agentId});if(i)await this.executeSpecificTool(i,f,l,t,r)&&(a=!0);else{const y=this.getTool({toolName:"*",agentId:t.agentId});y&&await this.executeWildcardTool(y,f,l,t,r)&&(a=!0)}}}return a?await this.runAgent({agent:t}):(this.core.suggestionEngine.reloadSuggestions(r),e)}async executeSpecificTool(e,t,n,r,a){if(e!=null&&e.agentId&&e.agentId!==r.agentId)return!1;let l="",f,i=!1;if(e!=null&&e.handler){let y;try{y=JSON.parse(t.function.arguments)}catch(x){const S=x instanceof Error?x:new Error(String(x));f=S.message,i=!0,await this.core.emitError({error:S,code:"tool_argument_parse_failed",context:{agentId:a,toolCallId:t.id,toolName:t.function.name,rawArguments:t.function.arguments,toolType:"specific",messageId:n.id}})}if(await this.core.notifySubscribers(x=>{var S;return(S=x.onToolExecutionStart)==null?void 0:S.call(x,{copilotkit:this.core,toolCallId:t.id,agentId:a,toolName:t.function.name,args:y})},"Subscriber onToolExecutionStart error:"),!f)try{const x=await e.handler(y,t);x==null?l="":typeof x=="string"?l=x:l=JSON.stringify(x)}catch(x){const S=x instanceof Error?x:new Error(String(x));f=S.message,await this.core.emitError({error:S,code:"tool_handler_failed",context:{agentId:a,toolCallId:t.id,toolName:t.function.name,parsedArgs:y,toolType:"specific",messageId:n.id}})}if(f&&(l=`Error: ${f}`),await this.core.notifySubscribers(x=>{var S;return(S=x.onToolExecutionEnd)==null?void 0:S.call(x,{copilotkit:this.core,toolCallId:t.id,agentId:a,toolName:t.function.name,result:f?"":l,error:f})},"Subscriber onToolExecutionEnd error:"),i)throw new Error(f??"Tool execution failed")}if(!f||!i){const y=r.messages.findIndex(S=>S.id===n.id),x={id:gf(),role:"tool",toolCallId:t.id,content:l};if(r.messages.splice(y+1,0,x),!f&&(e==null?void 0:e.followUp)!==!1)return!0}return!1}async executeWildcardTool(e,t,n,r,a){if(e!=null&&e.agentId&&e.agentId!==r.agentId)return!1;let l="",f,i=!1;if(e!=null&&e.handler){let y;try{y=JSON.parse(t.function.arguments)}catch(S){const C=S instanceof Error?S:new Error(String(S));f=C.message,i=!0,await this.core.emitError({error:C,code:"tool_argument_parse_failed",context:{agentId:a,toolCallId:t.id,toolName:t.function.name,rawArguments:t.function.arguments,toolType:"wildcard",messageId:n.id}})}const x={toolName:t.function.name,args:y};if(await this.core.notifySubscribers(S=>{var C;return(C=S.onToolExecutionStart)==null?void 0:C.call(S,{copilotkit:this.core,toolCallId:t.id,agentId:a,toolName:t.function.name,args:x})},"Subscriber onToolExecutionStart error:"),!f)try{const S=await e.handler(x,t);S==null?l="":typeof S=="string"?l=S:l=JSON.stringify(S)}catch(S){const C=S instanceof Error?S:new Error(String(S));f=C.message,await this.core.emitError({error:C,code:"tool_handler_failed",context:{agentId:a,toolCallId:t.id,toolName:t.function.name,parsedArgs:x,toolType:"wildcard",messageId:n.id}})}if(f&&(l=`Error: ${f}`),await this.core.notifySubscribers(S=>{var C;return(C=S.onToolExecutionEnd)==null?void 0:C.call(S,{copilotkit:this.core,toolCallId:t.id,agentId:a,toolName:t.function.name,result:f?"":l,error:f})},"Subscriber onToolExecutionEnd error:"),i)throw new Error(f??"Tool execution failed")}if(!f||!i){const y=r.messages.findIndex(S=>S.id===n.id),x={id:gf(),role:"tool",toolCallId:t.id,content:l};if(r.messages.splice(y+1,0,x),!f&&(e==null?void 0:e.followUp)!==!1)return!0}return!1}buildFrontendTools(e){return this._tools.filter(t=>!t.agentId||t.agentId===e).map(t=>({name:t.name,description:t.description??"",parameters:d8e(t)}))}createAgentErrorSubscriber(e){const t=async(n,r,a={})=>{const l={...a};e.agentId&&(l.agentId=e.agentId),await this.core.emitError({error:n,code:r,context:l})};return{onRunFailed:async({error:n})=>{await t(n,"agent_run_failed_event",{source:"onRunFailed"})},onRunErrorEvent:async({event:n})=>{var f,i;const r=(n==null?void 0:n.rawEvent)instanceof Error?n.rawEvent:((f=n==null?void 0:n.rawEvent)==null?void 0:f.error)instanceof Error?n.rawEvent.error:void 0,a=typeof((i=n==null?void 0:n.rawEvent)==null?void 0:i.error)=="string"?n.rawEvent.error:(n==null?void 0:n.message)??"Agent run error",l=r??new Error(a);n!=null&&n.code&&!l.code&&(l.code=n.code),await t(l,"agent_run_error_event",{source:"onRunErrorEvent",event:n,runtimeErrorCode:n==null?void 0:n.code})}}}},gG={type:"object",properties:{}};function d8e(e){if(!e.parameters)return{...gG};const t=i8e(e.parameters,{$refStrategy:"none"});if(!t||typeof t!="object")return{...gG};const{$schema:n,...r}=t;return typeof r.type!="string"&&(r.type="object"),(typeof r.properties!="object"||r.properties===null)&&(r.properties={}),T8(r),r}function T8(e){if(!e||typeof e!="object")return;if(Array.isArray(e)){e.forEach(T8);return}const t=e;t.additionalProperties!==void 0&&delete t.additionalProperties;for(const n of Object.values(t))T8(n)}var h8e=class{constructor(e){wi(this,"stateByRun",new Map);wi(this,"messageToRun",new Map);wi(this,"agentSubscriptions",new Map);this.core=e}initialize(){}subscribeToAgent(e){if(!e.agentId)return;const t=e.agentId;this.unsubscribeFromAgent(t);const{unsubscribe:n}=e.subscribe({onRunStartedEvent:({event:r,state:a})=>{this.handleRunStarted(e,r,a)},onRunFinishedEvent:({event:r,state:a})=>{this.handleRunFinished(e,r,a)},onStateSnapshotEvent:({event:r,input:a,state:l})=>{this.handleStateSnapshot(e,r,a,l)},onStateDeltaEvent:({event:r,input:a,state:l})=>{this.handleStateDelta(e,r,a,l)},onMessagesSnapshotEvent:({event:r,input:a,messages:l})=>{this.handleMessagesSnapshot(e,r,a,l)},onNewMessage:({message:r,input:a})=>{this.handleNewMessage(e,r,a)}});this.agentSubscriptions.set(t,n)}unsubscribeFromAgent(e){const t=this.agentSubscriptions.get(e);t&&(t(),this.agentSubscriptions.delete(e))}getStateByRun(e,t,n){var a,l;const r=(l=(a=this.stateByRun.get(e))==null?void 0:a.get(t))==null?void 0:l.get(n);if(r)return JSON.parse(JSON.stringify(r))}getRunIdForMessage(e,t,n){var r,a;return(a=(r=this.messageToRun.get(e))==null?void 0:r.get(t))==null?void 0:a.get(n)}getStatesForThread(e,t){var n;return((n=this.stateByRun.get(e))==null?void 0:n.get(t))??new Map}getRunIdsForThread(e,t){var r;const n=(r=this.stateByRun.get(e))==null?void 0:r.get(t);return n?Array.from(n.keys()):[]}handleRunStarted(e,t,n){if(!e.agentId)return;const{threadId:r,runId:a}=t;this.saveState(e.agentId,r,a,n)}handleRunFinished(e,t,n){if(!e.agentId)return;const{threadId:r,runId:a}=t;this.saveState(e.agentId,r,a,n)}handleStateSnapshot(e,t,n,r){if(!e.agentId)return;const{threadId:a,runId:l}=n,f={...r,...t.snapshot};this.saveState(e.agentId,a,l,f)}handleStateDelta(e,t,n,r){if(!e.agentId)return;const{threadId:a,runId:l}=n;this.saveState(e.agentId,a,l,r)}handleMessagesSnapshot(e,t,n,r){if(!e.agentId)return;const{threadId:a,runId:l}=n;for(const f of t.messages)this.associateMessageWithRun(e.agentId,a,f.id,l)}handleNewMessage(e,t,n){if(!e.agentId||!n)return;const{threadId:r,runId:a}=n;this.associateMessageWithRun(e.agentId,r,t.id,a)}saveState(e,t,n,r){this.stateByRun.has(e)||this.stateByRun.set(e,new Map);const a=this.stateByRun.get(e);a.has(t)||a.set(t,new Map),a.get(t).set(n,JSON.parse(JSON.stringify(r)))}associateMessageWithRun(e,t,n,r){this.messageToRun.has(e)||this.messageToRun.set(e,new Map);const a=this.messageToRun.get(e);a.has(t)||a.set(t,new Map),a.get(t).set(n,r)}clearAgentState(e){this.stateByRun.delete(e),this.messageToRun.delete(e)}clearThreadState(e,t){var n,r;(n=this.stateByRun.get(e))==null||n.delete(t),(r=this.messageToRun.get(e))==null||r.delete(t)}},E8=(e=>(e.Disconnected="disconnected",e.Connected="connected",e.Connecting="connecting",e.Error="error",e))(E8||{}),f8e=class{constructor({runtimeUrl:e,runtimeTransport:t="rest",headers:n={},properties:r={},agents__unsafe_dev_only:a={},tools:l=[],suggestionsConfig:f=[]}){wi(this,"_headers");wi(this,"_properties");wi(this,"subscribers",new Set);wi(this,"agentRegistry");wi(this,"contextStore");wi(this,"suggestionEngine");wi(this,"runHandler");wi(this,"stateManager");this._headers=n,this._properties=r,this.agentRegistry=new s8e(this),this.contextStore=new a8e(this),this.suggestionEngine=new o8e(this),this.runHandler=new c8e(this),this.stateManager=new h8e(this),this.agentRegistry.initialize(a),this.runHandler.initialize(l),this.suggestionEngine.initialize(f),this.stateManager.initialize(),this.agentRegistry.setRuntimeTransport(t),this.agentRegistry.setRuntimeUrl(e),this.subscribe({onAgentsChanged:({agents:i})=>{Object.values(i).forEach(y=>{y.agentId&&this.stateManager.subscribeToAgent(y)})}})}async notifySubscribers(e,t){await Promise.all(Array.from(this.subscribers).map(async n=>{try{await e(n)}catch(r){console.error(t,r)}}))}async emitError({error:e,code:t,context:n={}}){await this.notifySubscribers(r=>{var a;return(a=r.onError)==null?void 0:a.call(r,{copilotkit:this,error:e,code:t,context:n})},"Subscriber onError error:")}get context(){return this.contextStore.context}get agents(){return this.agentRegistry.agents}get tools(){return this.runHandler.tools}get runtimeUrl(){return this.agentRegistry.runtimeUrl}setRuntimeUrl(e){this.agentRegistry.setRuntimeUrl(e)}get runtimeTransport(){return this.agentRegistry.runtimeTransport}setRuntimeTransport(e){this.agentRegistry.setRuntimeTransport(e)}get runtimeVersion(){return this.agentRegistry.runtimeVersion}get headers(){return this._headers}get properties(){return this._properties}get runtimeConnectionStatus(){return this.agentRegistry.runtimeConnectionStatus}setHeaders(e){this._headers=e,this.agentRegistry.applyHeadersToAgents(this.agentRegistry.agents),this.notifySubscribers(t=>{var n;return(n=t.onHeadersChanged)==null?void 0:n.call(t,{copilotkit:this,headers:this.headers})},"Subscriber onHeadersChanged error:")}setProperties(e){this._properties=e,this.notifySubscribers(t=>{var n;return(n=t.onPropertiesChanged)==null?void 0:n.call(t,{copilotkit:this,properties:this.properties})},"Subscriber onPropertiesChanged error:")}setAgents__unsafe_dev_only(e){this.agentRegistry.setAgents__unsafe_dev_only(e)}addAgent__unsafe_dev_only(e){this.agentRegistry.addAgent__unsafe_dev_only(e)}removeAgent__unsafe_dev_only(e){this.agentRegistry.removeAgent__unsafe_dev_only(e)}getAgent(e){return this.agentRegistry.getAgent(e)}addContext(e){return this.contextStore.addContext(e)}removeContext(e){this.contextStore.removeContext(e)}addSuggestionsConfig(e){return this.suggestionEngine.addSuggestionsConfig(e)}removeSuggestionsConfig(e){this.suggestionEngine.removeSuggestionsConfig(e)}reloadSuggestions(e){this.suggestionEngine.reloadSuggestions(e)}clearSuggestions(e){this.suggestionEngine.clearSuggestions(e)}getSuggestions(e){return this.suggestionEngine.getSuggestions(e)}addTool(e){this.runHandler.addTool(e)}removeTool(e,t){this.runHandler.removeTool(e,t)}getTool(e){return this.runHandler.getTool(e)}setTools(e){this.runHandler.setTools(e)}subscribe(e){return this.subscribers.add(e),{unsubscribe:()=>{this.subscribers.delete(e)}}}async connectAgent(e){return this.runHandler.connectAgent(e)}stopAgent(e){e.agent.abortRun()}async runAgent(e){return this.runHandler.runAgent(e)}getStateByRun(e,t,n){return this.stateManager.getStateByRun(e,t,n)}getRunIdForMessage(e,t,n){return this.stateManager.getRunIdForMessage(e,t,n)}getRunIdsForThread(e,t){return this.stateManager.getRunIdsForThread(e,t)}buildFrontendTools(e){return this.runHandler.buildFrontendTools(e)}},f_=(e=>(e.InProgress="inProgress",e.Executing="executing",e.Complete="complete",e))(f_||{}),Da;(function(e){e.assertEqual=a=>{};function t(a){}e.assertIs=t;function n(a){throw new Error}e.assertNever=n,e.arrayToEnum=a=>{const l={};for(const f of a)l[f]=f;return l},e.getValidEnumValues=a=>{const l=e.objectKeys(a).filter(i=>typeof a[a[i]]!="number"),f={};for(const i of l)f[i]=a[i];return e.objectValues(f)},e.objectValues=a=>e.objectKeys(a).map(function(l){return a[l]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const l=[];for(const f in a)Object.prototype.hasOwnProperty.call(a,f)&&l.push(f);return l},e.find=(a,l)=>{for(const f of a)if(l(f))return f},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,l=" | "){return a.map(f=>typeof f=="string"?`'${f}'`:f).join(l)}e.joinValues=r,e.jsonStringifyReplacer=(a,l)=>typeof l=="bigint"?l.toString():l})(Da||(Da={}));var _G;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(_G||(_G={}));const di=Da.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),jm=e=>{switch(typeof e){case"undefined":return di.undefined;case"string":return di.string;case"number":return Number.isNaN(e)?di.nan:di.number;case"boolean":return di.boolean;case"function":return di.function;case"bigint":return di.bigint;case"symbol":return di.symbol;case"object":return Array.isArray(e)?di.array:e===null?di.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?di.promise:typeof Map<"u"&&e instanceof Map?di.map:typeof Set<"u"&&e instanceof Set?di.set:typeof Date<"u"&&e instanceof Date?di.date:di.object;default:return di.unknown}},vr=Da.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Np extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(l){return l.message},r={_errors:[]},a=l=>{for(const f of l.issues)if(f.code==="invalid_union")f.unionErrors.map(a);else if(f.code==="invalid_return_type")a(f.returnTypeError);else if(f.code==="invalid_arguments")a(f.argumentsError);else if(f.path.length===0)r._errors.push(n(f));else{let i=r,y=0;for(;y<f.path.length;){const x=f.path[y];y===f.path.length-1?(i[x]=i[x]||{_errors:[]},i[x]._errors.push(n(f))):i[x]=i[x]||{_errors:[]},i=i[x],y++}}};return a(this),r}static assert(t){if(!(t instanceof Np))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Da.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const a of this.issues)if(a.path.length>0){const l=a.path[0];n[l]=n[l]||[],n[l].push(t(a))}else r.push(t(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}Np.create=e=>new Np(e);const S8=(e,t)=>{let n;switch(e.code){case vr.invalid_type:e.received===di.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case vr.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,Da.jsonStringifyReplacer)}`;break;case vr.unrecognized_keys:n=`Unrecognized key(s) in object: ${Da.joinValues(e.keys,", ")}`;break;case vr.invalid_union:n="Invalid input";break;case vr.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Da.joinValues(e.options)}`;break;case vr.invalid_enum_value:n=`Invalid enum value. Expected ${Da.joinValues(e.options)}, received '${e.received}'`;break;case vr.invalid_arguments:n="Invalid function arguments";break;case vr.invalid_return_type:n="Invalid function return type";break;case vr.invalid_date:n="Invalid date";break;case vr.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:Da.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case vr.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case vr.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case vr.custom:n="Invalid input";break;case vr.invalid_intersection_types:n="Intersection results could not be merged";break;case vr.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case vr.not_finite:n="Number must be finite";break;default:n=t.defaultError,Da.assertNever(e)}return{message:n}};let p8e=S8;function m8e(){return p8e}const g8e=e=>{const{data:t,path:n,errorMaps:r,issueData:a}=e,l=[...n,...a.path||[]],f={...a,path:l};if(a.message!==void 0)return{...a,path:l,message:a.message};let i="";const y=r.filter(x=>!!x).slice().reverse();for(const x of y)i=x(f,{data:t,defaultError:i}).message;return{...a,path:l,message:i}};function Xr(e,t){const n=m8e(),r=g8e({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===S8?void 0:S8].filter(a=>!!a)});e.common.issues.push(r)}class $c{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const a of n){if(a.status==="aborted")return Ss;a.status==="dirty"&&t.dirty(),r.push(a.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const a of n){const l=await a.key,f=await a.value;r.push({key:l,value:f})}return $c.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const a of n){const{key:l,value:f}=a;if(l.status==="aborted"||f.status==="aborted")return Ss;l.status==="dirty"&&t.dirty(),f.status==="dirty"&&t.dirty(),l.value!=="__proto__"&&(typeof f.value<"u"||a.alwaysSet)&&(r[l.value]=f.value)}return{status:t.value,value:r}}}const Ss=Object.freeze({status:"aborted"}),T2=e=>({status:"dirty",value:e}),Id=e=>({status:"valid",value:e}),yG=e=>e.status==="aborted",vG=e=>e.status==="dirty",mx=e=>e.status==="valid",YC=e=>typeof Promise<"u"&&e instanceof Promise;var xi;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(xi||(xi={}));class O0{constructor(t,n,r,a){this._cachedPath=[],this.parent=t,this.data=n,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const xG=(e,t)=>{if(mx(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new Np(e.common.issues);return this._error=n,this._error}}};function sa(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:a}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(f,i)=>{const{message:y}=e;return f.code==="invalid_enum_value"?{message:y??i.defaultError}:typeof i.data>"u"?{message:y??r??i.defaultError}:f.code!=="invalid_type"?{message:i.defaultError}:{message:y??n??i.defaultError}},description:a}}class Ma{get description(){return this._def.description}_getType(t){return jm(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:jm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new $c,ctx:{common:t.parent.common,data:t.data,parsedType:jm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(YC(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){const r={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:jm(t)},a=this._parseSync({data:t,path:r.path,parent:r});return xG(r,a)}"~validate"(t){var r,a;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:jm(t)};if(!this["~standard"].async)try{const l=this._parseSync({data:t,path:[],parent:n});return mx(l)?{value:l.value}:{issues:n.common.issues}}catch(l){(a=(r=l==null?void 0:l.message)==null?void 0:r.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:n}).then(l=>mx(l)?{value:l.value}:{issues:n.common.issues})}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:jm(t)},a=this._parse({data:t,path:r.path,parent:r}),l=await(YC(a)?a:Promise.resolve(a));return xG(r,l)}refine(t,n){const r=a=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,l)=>{const f=t(a),i=()=>l.addIssue({code:vr.custom,...r(a)});return typeof Promise<"u"&&f instanceof Promise?f.then(y=>y?!0:(i(),!1)):f?!0:(i(),!1)})}refinement(t,n){return this._refinement((r,a)=>t(r)?!0:(a.addIssue(typeof n=="function"?n(r,a):n),!1))}_refinement(t){return new _x({schema:this,typeName:Cs.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return m0.create(this,this._def)}nullable(){return yx.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return yf.create(this)}promise(){return ek.create(this,this._def)}or(t){return QC.create([this,t],this._def)}and(t){return JC.create(this,t,this._def)}transform(t){return new _x({...sa(this._def),schema:this,typeName:Cs.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new k8({...sa(this._def),innerType:this,defaultValue:n,typeName:Cs.ZodDefault})}brand(){return new B8e({typeName:Cs.ZodBranded,type:this,...sa(this._def)})}catch(t){const n=typeof t=="function"?t:()=>t;return new I8({...sa(this._def),innerType:this,catchValue:n,typeName:Cs.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return PN.create(this,t)}readonly(){return R8.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const _8e=/^c[^\s-]{8,}$/i,y8e=/^[0-9a-z]+$/,v8e=/^[0-9A-HJKMNP-TV-Z]{26}$/i,x8e=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,b8e=/^[a-z0-9_-]{21}$/i,w8e=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,T8e=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,E8e=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,S8e="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let JR;const A8e=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,C8e=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,k8e=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,I8e=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,R8e=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,M8e=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Rre="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",P8e=new RegExp(`^${Rre}$`);function Mre(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function O8e(e){return new RegExp(`^${Mre(e)}$`)}function L8e(e){let t=`${Rre}T${Mre(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function D8e(e,t){return!!((t==="v4"||!t)&&A8e.test(e)||(t==="v6"||!t)&&k8e.test(e))}function N8e(e,t){if(!w8e.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||t&&a.alg!==t)}catch{return!1}}function z8e(e,t){return!!((t==="v4"||!t)&&C8e.test(e)||(t==="v6"||!t)&&I8e.test(e))}class Kg extends Ma{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==di.string){const l=this._getOrReturnCtx(t);return Xr(l,{code:vr.invalid_type,expected:di.string,received:l.parsedType}),Ss}const r=new $c;let a;for(const l of this._def.checks)if(l.kind==="min")t.data.length<l.value&&(a=this._getOrReturnCtx(t,a),Xr(a,{code:vr.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),r.dirty());else if(l.kind==="max")t.data.length>l.value&&(a=this._getOrReturnCtx(t,a),Xr(a,{code:vr.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),r.dirty());else if(l.kind==="length"){const f=t.data.length>l.value,i=t.data.length<l.value;(f||i)&&(a=this._getOrReturnCtx(t,a),f?Xr(a,{code:vr.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):i&&Xr(a,{code:vr.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),r.dirty())}else if(l.kind==="email")E8e.test(t.data)||(a=this._getOrReturnCtx(t,a),Xr(a,{validation:"email",code:vr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="emoji")JR||(JR=new RegExp(S8e,"u")),JR.test(t.data)||(a=this._getOrReturnCtx(t,a),Xr(a,{validation:"emoji",code:vr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="uuid")x8e.test(t.data)||(a=this._getOrReturnCtx(t,a),Xr(a,{validation:"uuid",code:vr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="nanoid")b8e.test(t.data)||(a=this._getOrReturnCtx(t,a),Xr(a,{validation:"nanoid",code:vr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="cuid")_8e.test(t.data)||(a=this._getOrReturnCtx(t,a),Xr(a,{validation:"cuid",code:vr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="cuid2")y8e.test(t.data)||(a=this._getOrReturnCtx(t,a),Xr(a,{validation:"cuid2",code:vr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="ulid")v8e.test(t.data)||(a=this._getOrReturnCtx(t,a),Xr(a,{validation:"ulid",code:vr.invalid_string,message:l.message}),r.dirty());else if(l.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),Xr(a,{validation:"url",code:vr.invalid_string,message:l.message}),r.dirty()}else l.kind==="regex"?(l.regex.lastIndex=0,l.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),Xr(a,{validation:"regex",code:vr.invalid_string,message:l.message}),r.dirty())):l.kind==="trim"?t.data=t.data.trim():l.kind==="includes"?t.data.includes(l.value,l.position)||(a=this._getOrReturnCtx(t,a),Xr(a,{code:vr.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),r.dirty()):l.kind==="toLowerCase"?t.data=t.data.toLowerCase():l.kind==="toUpperCase"?t.data=t.data.toUpperCase():l.kind==="startsWith"?t.data.startsWith(l.value)||(a=this._getOrReturnCtx(t,a),Xr(a,{code:vr.invalid_string,validation:{startsWith:l.value},message:l.message}),r.dirty()):l.kind==="endsWith"?t.data.endsWith(l.value)||(a=this._getOrReturnCtx(t,a),Xr(a,{code:vr.invalid_string,validation:{endsWith:l.value},message:l.message}),r.dirty()):l.kind==="datetime"?L8e(l).test(t.data)||(a=this._getOrReturnCtx(t,a),Xr(a,{code:vr.invalid_string,validation:"datetime",message:l.message}),r.dirty()):l.kind==="date"?P8e.test(t.data)||(a=this._getOrReturnCtx(t,a),Xr(a,{code:vr.invalid_string,validation:"date",message:l.message}),r.dirty()):l.kind==="time"?O8e(l).test(t.data)||(a=this._getOrReturnCtx(t,a),Xr(a,{code:vr.invalid_string,validation:"time",message:l.message}),r.dirty()):l.kind==="duration"?T8e.test(t.data)||(a=this._getOrReturnCtx(t,a),Xr(a,{validation:"duration",code:vr.invalid_string,message:l.message}),r.dirty()):l.kind==="ip"?D8e(t.data,l.version)||(a=this._getOrReturnCtx(t,a),Xr(a,{validation:"ip",code:vr.invalid_string,message:l.message}),r.dirty()):l.kind==="jwt"?N8e(t.data,l.alg)||(a=this._getOrReturnCtx(t,a),Xr(a,{validation:"jwt",code:vr.invalid_string,message:l.message}),r.dirty()):l.kind==="cidr"?z8e(t.data,l.version)||(a=this._getOrReturnCtx(t,a),Xr(a,{validation:"cidr",code:vr.invalid_string,message:l.message}),r.dirty()):l.kind==="base64"?R8e.test(t.data)||(a=this._getOrReturnCtx(t,a),Xr(a,{validation:"base64",code:vr.invalid_string,message:l.message}),r.dirty()):l.kind==="base64url"?M8e.test(t.data)||(a=this._getOrReturnCtx(t,a),Xr(a,{validation:"base64url",code:vr.invalid_string,message:l.message}),r.dirty()):Da.assertNever(l);return{status:r.value,value:t.data}}_regex(t,n,r){return this.refinement(a=>t.test(a),{validation:n,code:vr.invalid_string,...xi.errToObj(r)})}_addCheck(t){return new Kg({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...xi.errToObj(t)})}url(t){return this._addCheck({kind:"url",...xi.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...xi.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...xi.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...xi.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...xi.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...xi.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...xi.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...xi.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...xi.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...xi.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...xi.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...xi.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...xi.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...xi.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...xi.errToObj(t)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...xi.errToObj(n)})}includes(t,n){return this._addCheck({kind:"includes",value:t,position:n==null?void 0:n.position,...xi.errToObj(n==null?void 0:n.message)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...xi.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...xi.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...xi.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...xi.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...xi.errToObj(n)})}nonempty(t){return this.min(1,xi.errToObj(t))}trim(){return new Kg({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Kg({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Kg({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}Kg.create=e=>new Kg({checks:[],typeName:Cs.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...sa(e)});function F8e(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,a=n>r?n:r,l=Number.parseInt(e.toFixed(a).replace(".","")),f=Number.parseInt(t.toFixed(a).replace(".",""));return l%f/10**a}class OT extends Ma{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==di.number){const l=this._getOrReturnCtx(t);return Xr(l,{code:vr.invalid_type,expected:di.number,received:l.parsedType}),Ss}let r;const a=new $c;for(const l of this._def.checks)l.kind==="int"?Da.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),Xr(r,{code:vr.invalid_type,expected:"integer",received:"float",message:l.message}),a.dirty()):l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(r=this._getOrReturnCtx(t,r),Xr(r,{code:vr.too_small,minimum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),a.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(r=this._getOrReturnCtx(t,r),Xr(r,{code:vr.too_big,maximum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),a.dirty()):l.kind==="multipleOf"?F8e(t.data,l.value)!==0&&(r=this._getOrReturnCtx(t,r),Xr(r,{code:vr.not_multiple_of,multipleOf:l.value,message:l.message}),a.dirty()):l.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),Xr(r,{code:vr.not_finite,message:l.message}),a.dirty()):Da.assertNever(l);return{status:a.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,xi.toString(n))}gt(t,n){return this.setLimit("min",t,!1,xi.toString(n))}lte(t,n){return this.setLimit("max",t,!0,xi.toString(n))}lt(t,n){return this.setLimit("max",t,!1,xi.toString(n))}setLimit(t,n,r,a){return new OT({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:xi.toString(a)}]})}_addCheck(t){return new OT({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:xi.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:xi.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:xi.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:xi.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:xi.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:xi.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:xi.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:xi.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:xi.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Da.isInteger(t.value))}get isFinite(){let t=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(n)&&Number.isFinite(t)}}OT.create=e=>new OT({checks:[],typeName:Cs.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...sa(e)});class LT extends Ma{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==di.bigint)return this._getInvalidInput(t);let r;const a=new $c;for(const l of this._def.checks)l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(r=this._getOrReturnCtx(t,r),Xr(r,{code:vr.too_small,type:"bigint",minimum:l.value,inclusive:l.inclusive,message:l.message}),a.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(r=this._getOrReturnCtx(t,r),Xr(r,{code:vr.too_big,type:"bigint",maximum:l.value,inclusive:l.inclusive,message:l.message}),a.dirty()):l.kind==="multipleOf"?t.data%l.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),Xr(r,{code:vr.not_multiple_of,multipleOf:l.value,message:l.message}),a.dirty()):Da.assertNever(l);return{status:a.value,value:t.data}}_getInvalidInput(t){const n=this._getOrReturnCtx(t);return Xr(n,{code:vr.invalid_type,expected:di.bigint,received:n.parsedType}),Ss}gte(t,n){return this.setLimit("min",t,!0,xi.toString(n))}gt(t,n){return this.setLimit("min",t,!1,xi.toString(n))}lte(t,n){return this.setLimit("max",t,!0,xi.toString(n))}lt(t,n){return this.setLimit("max",t,!1,xi.toString(n))}setLimit(t,n,r,a){return new LT({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:xi.toString(a)}]})}_addCheck(t){return new LT({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:xi.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:xi.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:xi.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:xi.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:xi.toString(n)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}LT.create=e=>new LT({checks:[],typeName:Cs.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...sa(e)});class bG extends Ma{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==di.boolean){const r=this._getOrReturnCtx(t);return Xr(r,{code:vr.invalid_type,expected:di.boolean,received:r.parsedType}),Ss}return Id(t.data)}}bG.create=e=>new bG({typeName:Cs.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...sa(e)});class KC extends Ma{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==di.date){const l=this._getOrReturnCtx(t);return Xr(l,{code:vr.invalid_type,expected:di.date,received:l.parsedType}),Ss}if(Number.isNaN(t.data.getTime())){const l=this._getOrReturnCtx(t);return Xr(l,{code:vr.invalid_date}),Ss}const r=new $c;let a;for(const l of this._def.checks)l.kind==="min"?t.data.getTime()<l.value&&(a=this._getOrReturnCtx(t,a),Xr(a,{code:vr.too_small,message:l.message,inclusive:!0,exact:!1,minimum:l.value,type:"date"}),r.dirty()):l.kind==="max"?t.data.getTime()>l.value&&(a=this._getOrReturnCtx(t,a),Xr(a,{code:vr.too_big,message:l.message,inclusive:!0,exact:!1,maximum:l.value,type:"date"}),r.dirty()):Da.assertNever(l);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new KC({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:xi.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:xi.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}}KC.create=e=>new KC({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:Cs.ZodDate,...sa(e)});class wG extends Ma{_parse(t){if(this._getType(t)!==di.symbol){const r=this._getOrReturnCtx(t);return Xr(r,{code:vr.invalid_type,expected:di.symbol,received:r.parsedType}),Ss}return Id(t.data)}}wG.create=e=>new wG({typeName:Cs.ZodSymbol,...sa(e)});class TG extends Ma{_parse(t){if(this._getType(t)!==di.undefined){const r=this._getOrReturnCtx(t);return Xr(r,{code:vr.invalid_type,expected:di.undefined,received:r.parsedType}),Ss}return Id(t.data)}}TG.create=e=>new TG({typeName:Cs.ZodUndefined,...sa(e)});class EG extends Ma{_parse(t){if(this._getType(t)!==di.null){const r=this._getOrReturnCtx(t);return Xr(r,{code:vr.invalid_type,expected:di.null,received:r.parsedType}),Ss}return Id(t.data)}}EG.create=e=>new EG({typeName:Cs.ZodNull,...sa(e)});class A8 extends Ma{constructor(){super(...arguments),this._any=!0}_parse(t){return Id(t.data)}}A8.create=e=>new A8({typeName:Cs.ZodAny,...sa(e)});class SG extends Ma{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Id(t.data)}}SG.create=e=>new SG({typeName:Cs.ZodUnknown,...sa(e)});class L0 extends Ma{_parse(t){const n=this._getOrReturnCtx(t);return Xr(n,{code:vr.invalid_type,expected:di.never,received:n.parsedType}),Ss}}L0.create=e=>new L0({typeName:Cs.ZodNever,...sa(e)});class AG extends Ma{_parse(t){if(this._getType(t)!==di.undefined){const r=this._getOrReturnCtx(t);return Xr(r,{code:vr.invalid_type,expected:di.void,received:r.parsedType}),Ss}return Id(t.data)}}AG.create=e=>new AG({typeName:Cs.ZodVoid,...sa(e)});class yf extends Ma{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),a=this._def;if(n.parsedType!==di.array)return Xr(n,{code:vr.invalid_type,expected:di.array,received:n.parsedType}),Ss;if(a.exactLength!==null){const f=n.data.length>a.exactLength.value,i=n.data.length<a.exactLength.value;(f||i)&&(Xr(n,{code:f?vr.too_big:vr.too_small,minimum:i?a.exactLength.value:void 0,maximum:f?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(Xr(n,{code:vr.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(Xr(n,{code:vr.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((f,i)=>a.type._parseAsync(new O0(n,f,n.path,i)))).then(f=>$c.mergeArray(r,f));const l=[...n.data].map((f,i)=>a.type._parseSync(new O0(n,f,n.path,i)));return $c.mergeArray(r,l)}get element(){return this._def.type}min(t,n){return new yf({...this._def,minLength:{value:t,message:xi.toString(n)}})}max(t,n){return new yf({...this._def,maxLength:{value:t,message:xi.toString(n)}})}length(t,n){return new yf({...this._def,exactLength:{value:t,message:xi.toString(n)}})}nonempty(t){return this.min(1,t)}}yf.create=(e,t)=>new yf({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Cs.ZodArray,...sa(t)});function J1(e){if(e instanceof xl){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=m0.create(J1(r))}return new xl({...e._def,shape:()=>t})}else return e instanceof yf?new yf({...e._def,type:J1(e.element)}):e instanceof m0?m0.create(J1(e.unwrap())):e instanceof yx?yx.create(J1(e.unwrap())):e instanceof D_?D_.create(e.items.map(t=>J1(t))):e}class xl extends Ma{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=Da.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==di.object){const x=this._getOrReturnCtx(t);return Xr(x,{code:vr.invalid_type,expected:di.object,received:x.parsedType}),Ss}const{status:r,ctx:a}=this._processInputParams(t),{shape:l,keys:f}=this._getCached(),i=[];if(!(this._def.catchall instanceof L0&&this._def.unknownKeys==="strip"))for(const x in a.data)f.includes(x)||i.push(x);const y=[];for(const x of f){const S=l[x],C=a.data[x];y.push({key:{status:"valid",value:x},value:S._parse(new O0(a,C,a.path,x)),alwaysSet:x in a.data})}if(this._def.catchall instanceof L0){const x=this._def.unknownKeys;if(x==="passthrough")for(const S of i)y.push({key:{status:"valid",value:S},value:{status:"valid",value:a.data[S]}});else if(x==="strict")i.length>0&&(Xr(a,{code:vr.unrecognized_keys,keys:i}),r.dirty());else if(x!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const x=this._def.catchall;for(const S of i){const C=a.data[S];y.push({key:{status:"valid",value:S},value:x._parse(new O0(a,C,a.path,S)),alwaysSet:S in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const x=[];for(const S of y){const C=await S.key,P=await S.value;x.push({key:C,value:P,alwaysSet:S.alwaysSet})}return x}).then(x=>$c.mergeObjectSync(r,x)):$c.mergeObjectSync(r,y)}get shape(){return this._def.shape()}strict(t){return xi.errToObj,new xl({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,r)=>{var l,f;const a=((f=(l=this._def).errorMap)==null?void 0:f.call(l,n,r).message)??r.defaultError;return n.code==="unrecognized_keys"?{message:xi.errToObj(t).message??a}:{message:a}}}:{}})}strip(){return new xl({...this._def,unknownKeys:"strip"})}passthrough(){return new xl({...this._def,unknownKeys:"passthrough"})}extend(t){return new xl({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new xl({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:Cs.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new xl({...this._def,catchall:t})}pick(t){const n={};for(const r of Da.objectKeys(t))t[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new xl({...this._def,shape:()=>n})}omit(t){const n={};for(const r of Da.objectKeys(this.shape))t[r]||(n[r]=this.shape[r]);return new xl({...this._def,shape:()=>n})}deepPartial(){return J1(this)}partial(t){const n={};for(const r of Da.objectKeys(this.shape)){const a=this.shape[r];t&&!t[r]?n[r]=a:n[r]=a.optional()}return new xl({...this._def,shape:()=>n})}required(t){const n={};for(const r of Da.objectKeys(this.shape))if(t&&!t[r])n[r]=this.shape[r];else{let l=this.shape[r];for(;l instanceof m0;)l=l._def.innerType;n[r]=l}return new xl({...this._def,shape:()=>n})}keyof(){return Pre(Da.objectKeys(this.shape))}}xl.create=(e,t)=>new xl({shape:()=>e,unknownKeys:"strip",catchall:L0.create(),typeName:Cs.ZodObject,...sa(t)});xl.strictCreate=(e,t)=>new xl({shape:()=>e,unknownKeys:"strict",catchall:L0.create(),typeName:Cs.ZodObject,...sa(t)});xl.lazycreate=(e,t)=>new xl({shape:e,unknownKeys:"strip",catchall:L0.create(),typeName:Cs.ZodObject,...sa(t)});class QC extends Ma{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function a(l){for(const i of l)if(i.result.status==="valid")return i.result;for(const i of l)if(i.result.status==="dirty")return n.common.issues.push(...i.ctx.common.issues),i.result;const f=l.map(i=>new Np(i.ctx.common.issues));return Xr(n,{code:vr.invalid_union,unionErrors:f}),Ss}if(n.common.async)return Promise.all(r.map(async l=>{const f={...n,common:{...n.common,issues:[]},parent:null};return{result:await l._parseAsync({data:n.data,path:n.path,parent:f}),ctx:f}})).then(a);{let l;const f=[];for(const y of r){const x={...n,common:{...n.common,issues:[]},parent:null},S=y._parseSync({data:n.data,path:n.path,parent:x});if(S.status==="valid")return S;S.status==="dirty"&&!l&&(l={result:S,ctx:x}),x.common.issues.length&&f.push(x.common.issues)}if(l)return n.common.issues.push(...l.ctx.common.issues),l.result;const i=f.map(y=>new Np(y));return Xr(n,{code:vr.invalid_union,unionErrors:i}),Ss}}get options(){return this._def.options}}QC.create=(e,t)=>new QC({options:e,typeName:Cs.ZodUnion,...sa(t)});function C8(e,t){const n=jm(e),r=jm(t);if(e===t)return{valid:!0,data:e};if(n===di.object&&r===di.object){const a=Da.objectKeys(t),l=Da.objectKeys(e).filter(i=>a.indexOf(i)!==-1),f={...e,...t};for(const i of l){const y=C8(e[i],t[i]);if(!y.valid)return{valid:!1};f[i]=y.data}return{valid:!0,data:f}}else if(n===di.array&&r===di.array){if(e.length!==t.length)return{valid:!1};const a=[];for(let l=0;l<e.length;l++){const f=e[l],i=t[l],y=C8(f,i);if(!y.valid)return{valid:!1};a.push(y.data)}return{valid:!0,data:a}}else return n===di.date&&r===di.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class JC extends Ma{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=(l,f)=>{if(yG(l)||yG(f))return Ss;const i=C8(l.value,f.value);return i.valid?((vG(l)||vG(f))&&n.dirty(),{status:n.value,value:i.data}):(Xr(r,{code:vr.invalid_intersection_types}),Ss)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([l,f])=>a(l,f)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}JC.create=(e,t,n)=>new JC({left:e,right:t,typeName:Cs.ZodIntersection,...sa(n)});class D_ extends Ma{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==di.array)return Xr(r,{code:vr.invalid_type,expected:di.array,received:r.parsedType}),Ss;if(r.data.length<this._def.items.length)return Xr(r,{code:vr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ss;!this._def.rest&&r.data.length>this._def.items.length&&(Xr(r,{code:vr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const l=[...r.data].map((f,i)=>{const y=this._def.items[i]||this._def.rest;return y?y._parse(new O0(r,f,r.path,i)):null}).filter(f=>!!f);return r.common.async?Promise.all(l).then(f=>$c.mergeArray(n,f)):$c.mergeArray(n,l)}get items(){return this._def.items}rest(t){return new D_({...this._def,rest:t})}}D_.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new D_({items:e,typeName:Cs.ZodTuple,rest:null,...sa(t)})};class CG extends Ma{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==di.map)return Xr(r,{code:vr.invalid_type,expected:di.map,received:r.parsedType}),Ss;const a=this._def.keyType,l=this._def.valueType,f=[...r.data.entries()].map(([i,y],x)=>({key:a._parse(new O0(r,i,r.path,[x,"key"])),value:l._parse(new O0(r,y,r.path,[x,"value"]))}));if(r.common.async){const i=new Map;return Promise.resolve().then(async()=>{for(const y of f){const x=await y.key,S=await y.value;if(x.status==="aborted"||S.status==="aborted")return Ss;(x.status==="dirty"||S.status==="dirty")&&n.dirty(),i.set(x.value,S.value)}return{status:n.value,value:i}})}else{const i=new Map;for(const y of f){const x=y.key,S=y.value;if(x.status==="aborted"||S.status==="aborted")return Ss;(x.status==="dirty"||S.status==="dirty")&&n.dirty(),i.set(x.value,S.value)}return{status:n.value,value:i}}}}CG.create=(e,t,n)=>new CG({valueType:t,keyType:e,typeName:Cs.ZodMap,...sa(n)});class DT extends Ma{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==di.set)return Xr(r,{code:vr.invalid_type,expected:di.set,received:r.parsedType}),Ss;const a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(Xr(r,{code:vr.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(Xr(r,{code:vr.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());const l=this._def.valueType;function f(y){const x=new Set;for(const S of y){if(S.status==="aborted")return Ss;S.status==="dirty"&&n.dirty(),x.add(S.value)}return{status:n.value,value:x}}const i=[...r.data.values()].map((y,x)=>l._parse(new O0(r,y,r.path,x)));return r.common.async?Promise.all(i).then(y=>f(y)):f(i)}min(t,n){return new DT({...this._def,minSize:{value:t,message:xi.toString(n)}})}max(t,n){return new DT({...this._def,maxSize:{value:t,message:xi.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}}DT.create=(e,t)=>new DT({valueType:e,minSize:null,maxSize:null,typeName:Cs.ZodSet,...sa(t)});class kG extends Ma{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}kG.create=(e,t)=>new kG({getter:e,typeName:Cs.ZodLazy,...sa(t)});class IG extends Ma{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return Xr(n,{received:n.data,code:vr.invalid_literal,expected:this._def.value}),Ss}return{status:"valid",value:t.data}}get value(){return this._def.value}}IG.create=(e,t)=>new IG({value:e,typeName:Cs.ZodLiteral,...sa(t)});function Pre(e,t){return new gx({values:e,typeName:Cs.ZodEnum,...sa(t)})}class gx extends Ma{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return Xr(n,{expected:Da.joinValues(r),received:n.parsedType,code:vr.invalid_type}),Ss}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const n=this._getOrReturnCtx(t),r=this._def.values;return Xr(n,{received:n.data,code:vr.invalid_enum_value,options:r}),Ss}return Id(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return gx.create(t,{...this._def,...n})}exclude(t,n=this._def){return gx.create(this.options.filter(r=>!t.includes(r)),{...this._def,...n})}}gx.create=Pre;class RG extends Ma{_parse(t){const n=Da.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==di.string&&r.parsedType!==di.number){const a=Da.objectValues(n);return Xr(r,{expected:Da.joinValues(a),received:r.parsedType,code:vr.invalid_type}),Ss}if(this._cache||(this._cache=new Set(Da.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const a=Da.objectValues(n);return Xr(r,{received:r.data,code:vr.invalid_enum_value,options:a}),Ss}return Id(t.data)}get enum(){return this._def.values}}RG.create=(e,t)=>new RG({values:e,typeName:Cs.ZodNativeEnum,...sa(t)});class ek extends Ma{unwrap(){return this._def.type}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==di.promise&&n.common.async===!1)return Xr(n,{code:vr.invalid_type,expected:di.promise,received:n.parsedType}),Ss;const r=n.parsedType===di.promise?n.data:Promise.resolve(n.data);return Id(r.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}}ek.create=(e,t)=>new ek({type:e,typeName:Cs.ZodPromise,...sa(t)});class _x extends Ma{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Cs.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=this._def.effect||null,l={addIssue:f=>{Xr(r,f),f.fatal?n.abort():n.dirty()},get path(){return r.path}};if(l.addIssue=l.addIssue.bind(l),a.type==="preprocess"){const f=a.transform(r.data,l);if(r.common.async)return Promise.resolve(f).then(async i=>{if(n.value==="aborted")return Ss;const y=await this._def.schema._parseAsync({data:i,path:r.path,parent:r});return y.status==="aborted"?Ss:y.status==="dirty"||n.value==="dirty"?T2(y.value):y});{if(n.value==="aborted")return Ss;const i=this._def.schema._parseSync({data:f,path:r.path,parent:r});return i.status==="aborted"?Ss:i.status==="dirty"||n.value==="dirty"?T2(i.value):i}}if(a.type==="refinement"){const f=i=>{const y=a.refinement(i,l);if(r.common.async)return Promise.resolve(y);if(y instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?Ss:(i.status==="dirty"&&n.dirty(),f(i.value),{status:n.value,value:i.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>i.status==="aborted"?Ss:(i.status==="dirty"&&n.dirty(),f(i.value).then(()=>({status:n.value,value:i.value}))))}if(a.type==="transform")if(r.common.async===!1){const f=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!mx(f))return Ss;const i=a.transform(f.value,l);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:i}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(f=>mx(f)?Promise.resolve(a.transform(f.value,l)).then(i=>({status:n.value,value:i})):Ss);Da.assertNever(a)}}_x.create=(e,t,n)=>new _x({schema:e,typeName:Cs.ZodEffects,effect:t,...sa(n)});_x.createWithPreprocess=(e,t,n)=>new _x({schema:t,effect:{type:"preprocess",transform:e},typeName:Cs.ZodEffects,...sa(n)});class m0 extends Ma{_parse(t){return this._getType(t)===di.undefined?Id(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}m0.create=(e,t)=>new m0({innerType:e,typeName:Cs.ZodOptional,...sa(t)});class yx extends Ma{_parse(t){return this._getType(t)===di.null?Id(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}yx.create=(e,t)=>new yx({innerType:e,typeName:Cs.ZodNullable,...sa(t)});class k8 extends Ma{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===di.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}k8.create=(e,t)=>new k8({innerType:e,typeName:Cs.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...sa(t)});class I8 extends Ma{_parse(t){const{ctx:n}=this._processInputParams(t),r={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return YC(a)?a.then(l=>({status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new Np(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Np(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}I8.create=(e,t)=>new I8({innerType:e,typeName:Cs.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...sa(t)});class MG extends Ma{_parse(t){if(this._getType(t)!==di.nan){const r=this._getOrReturnCtx(t);return Xr(r,{code:vr.invalid_type,expected:di.nan,received:r.parsedType}),Ss}return{status:"valid",value:t.data}}}MG.create=e=>new MG({typeName:Cs.ZodNaN,...sa(e)});class B8e extends Ma{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class PN extends Ma{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const l=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return l.status==="aborted"?Ss:l.status==="dirty"?(n.dirty(),T2(l.value)):this._def.out._parseAsync({data:l.value,path:r.path,parent:r})})();{const a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?Ss:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(t,n){return new PN({in:t,out:n,typeName:Cs.ZodPipeline})}}class R8 extends Ma{_parse(t){const n=this._def.innerType._parse(t),r=a=>(mx(a)&&(a.value=Object.freeze(a.value)),a);return YC(n)?n.then(a=>r(a)):r(n)}unwrap(){return this._def.innerType}}R8.create=(e,t)=>new R8({innerType:e,typeName:Cs.ZodReadonly,...sa(t)});var Cs;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(Cs||(Cs={}));const Ore=A8.create;L0.create;yf.create;QC.create;JC.create;D_.create;gx.create;ek.create;m0.create;yx.create;/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const j8e=new Set(["children","localName","ref","style","className"]),PG=new WeakMap,OG=(e,t,n,r,a)=>{const l=a==null?void 0:a[t];l===void 0?(e[t]=n,n==null&&t in HTMLElement.prototype&&e.removeAttribute(t)):n!==r&&((f,i,y)=>{let x=PG.get(f);x===void 0&&PG.set(f,x=new Map);let S=x.get(i);y!==void 0?S===void 0?(x.set(i,S={handleEvent:y}),f.addEventListener(i,S)):S.handleEvent=y:S!==void 0&&(x.delete(i),f.removeEventListener(i,S))})(e,l,n)},U8e=({react:e,tagName:t,elementClass:n,events:r,displayName:a})=>{const l=new Set(Object.keys(r??{})),f=e.forwardRef((i,y)=>{const x=e.useRef(new Map),S=e.useRef(null),C={},P={};for(const[L,F]of Object.entries(i))j8e.has(L)?C[L==="className"?"class":L]=F:l.has(L)||L in n.prototype?P[L]=F:C[L]=F;return e.useLayoutEffect(()=>{if(S.current===null)return;const L=new Map;for(const F in P)OG(S.current,F,i[F],x.current.get(F),r),x.current.delete(F),L.set(F,i[F]);for(const[F,U]of x.current)OG(S.current,F,void 0,U,r);x.current=L}),e.useLayoutEffect(()=>{var L;(L=S.current)==null||L.removeAttribute("defer-hydration")},[]),C.suppressHydrationWarning=!0,e.createElement(t,{...C,ref:e.useCallback(L=>{S.current=L,typeof y=="function"?y(L):y!==null&&(y.current=L)},[y])})});return f.displayName=a??n.name,f};/*!---------------------------------------------------------------------------------------------
 *  Copyright (c) StackBlitz. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/const V8e={damping:.7,stiffness:.05,mass:1.25},$8e=70,H8e=1e3/60,G8e=350;let aI=!1;var Tq;(Tq=globalThis.document)==null||Tq.addEventListener("mousedown",()=>{aI=!0});var Eq;(Eq=globalThis.document)==null||Eq.addEventListener("mouseup",()=>{aI=!1});var Sq;(Sq=globalThis.document)==null||Sq.addEventListener("click",()=>{aI=!1});const Lre=(e={})=>{const[t,n]=B.useState(!1),[r,a]=B.useState(e.initial!==!1),[l,f]=B.useState(!1),i=B.useRef(null);i.current=e;const y=B.useCallback(()=>{var ie;if(!aI)return!1;const $=window.getSelection();if(!$||!$.rangeCount)return!1;const X=$.getRangeAt(0);return X.commonAncestorContainer.contains(q.current)||((ie=q.current)==null?void 0:ie.contains(X.commonAncestorContainer))},[]),x=B.useCallback($=>{C.isAtBottom=$,a($)},[]),S=B.useCallback($=>{C.escapedFromLock=$,n($)},[]),C=B.useMemo(()=>{let $;return{escapedFromLock:t,isAtBottom:r,resizeDifference:0,accumulated:0,velocity:0,listeners:new Set,get scrollTop(){var X;return((X=q.current)==null?void 0:X.scrollTop)??0},set scrollTop(X){q.current&&(q.current.scrollTop=X,C.ignoreScrollToTop=q.current.scrollTop)},get targetScrollTop(){return!q.current||!G.current?0:q.current.scrollHeight-1-q.current.clientHeight},get calculatedTargetScrollTop(){if(!q.current||!G.current)return 0;const{targetScrollTop:X}=this;if(!e.targetScrollTop)return X;if(($==null?void 0:$.targetScrollTop)===X)return $.calculatedScrollTop;const ie=Math.max(Math.min(e.targetScrollTop(X,{scrollElement:q.current,contentElement:G.current}),X),0);return $={targetScrollTop:X,calculatedScrollTop:ie},requestAnimationFrame(()=>{$=void 0}),ie},get scrollDifference(){return this.calculatedTargetScrollTop-this.scrollTop},get isNearBottom(){return this.scrollDifference<=$8e}}},[]),P=B.useCallback(($={})=>{var Je;typeof $=="string"&&($={animation:$}),$.preserveScrollPosition||x(!0);const X=Date.now()+(Number($.wait)||0),ie=tM(i.current,$.animation),{ignoreEscapes:de=!1}=$;let fe,be=C.calculatedTargetScrollTop;$.duration instanceof Promise?$.duration.finally(()=>{fe=Date.now()}):fe=X+($.duration??0);const ve=async()=>{const we=new Promise(requestAnimationFrame).then(()=>{var Ct;if(!C.isAtBottom)return C.animation=void 0,!1;const{scrollTop:rt}=C,He=performance.now(),ft=(He-(C.lastTick??He))/H8e;if(C.animation||(C.animation={behavior:ie,promise:we,ignoreEscapes:de}),C.animation.behavior===ie&&(C.lastTick=He),y()||X>Date.now())return ve();if(rt<Math.min(be,C.calculatedTargetScrollTop)){if(((Ct=C.animation)==null?void 0:Ct.behavior)===ie){if(ie==="instant")return C.scrollTop=C.calculatedTargetScrollTop,ve();C.velocity=(ie.damping*C.velocity+ie.stiffness*C.scrollDifference)/ie.mass,C.accumulated+=C.velocity*ft,C.scrollTop+=C.accumulated,C.scrollTop!==rt&&(C.accumulated=0)}return ve()}return fe>Date.now()?(be=C.calculatedTargetScrollTop,ve()):(C.animation=void 0,C.scrollTop<C.calculatedTargetScrollTop?P({animation:tM(i.current,i.current.resize),ignoreEscapes:de,duration:Math.max(0,fe-Date.now())||void 0}):C.isAtBottom)});return we.then(rt=>(requestAnimationFrame(()=>{C.animation||(C.lastTick=void 0,C.velocity=0)}),rt))};return $.wait!==!0&&(C.animation=void 0),((Je=C.animation)==null?void 0:Je.behavior)===ie?C.animation.promise:ve()},[x,y,C]),L=B.useCallback(()=>{S(!0),x(!1)},[S,x]),F=B.useCallback(({target:$})=>{if($!==q.current)return;const{scrollTop:X,ignoreScrollToTop:ie}=C;let{lastScrollTop:de=X}=C;C.lastScrollTop=X,C.ignoreScrollToTop=void 0,ie&&ie>X&&(de=ie),f(C.isNearBottom),setTimeout(()=>{var ve;if(C.resizeDifference||X===ie)return;if(y()){S(!0),x(!1);return}const fe=X>de,be=X<de;if((ve=C.animation)!=null&&ve.ignoreEscapes){C.scrollTop=de;return}be&&(S(!0),x(!1)),fe&&S(!1),!C.escapedFromLock&&C.isNearBottom&&x(!0)},1)},[S,x,y,C]),U=B.useCallback(({target:$,deltaY:X})=>{var de;let ie=$;for(;!["scroll","auto"].includes(getComputedStyle(ie).overflow);){if(!ie.parentElement)return;ie=ie.parentElement}ie===q.current&&X<0&&q.current.scrollHeight>q.current.clientHeight&&!((de=C.animation)!=null&&de.ignoreEscapes)&&(S(!0),x(!1))},[S,x,C]),q=LG($=>{var X,ie;(X=q.current)==null||X.removeEventListener("scroll",F),(ie=q.current)==null||ie.removeEventListener("wheel",U),$==null||$.addEventListener("scroll",F,{passive:!0}),$==null||$.addEventListener("wheel",U,{passive:!0})},[]),G=LG($=>{var ie,de;if((ie=C.resizeObserver)==null||ie.disconnect(),!$)return;let X;C.resizeObserver=new ResizeObserver(([fe])=>{const{height:be}=fe.contentRect,ve=be-(X??be);if(C.resizeDifference=ve,C.scrollTop>C.targetScrollTop&&(C.scrollTop=C.targetScrollTop),f(C.isNearBottom),ve>=0){const Je=tM(i.current,X?i.current.resize:i.current.initial);P({animation:Je,wait:!0,preserveScrollPosition:!0,duration:Je==="instant"?void 0:G8e})}else C.isNearBottom&&(S(!1),x(!0));X=be,requestAnimationFrame(()=>{setTimeout(()=>{C.resizeDifference===ve&&(C.resizeDifference=0)},1)})}),(de=C.resizeObserver)==null||de.observe($)},[]);return{contentRef:G,scrollRef:q,scrollToBottom:P,stopScroll:L,isAtBottom:r||l,isNearBottom:l,escapedFromLock:t,state:C}};function LG(e,t){const n=B.useCallback(r=>(n.current=r,e(r)),t);return n}const eM=new Map;function tM(...e){const t={...V8e};let n=!1;for(const a of e){if(a==="instant"){n=!0;continue}typeof a=="object"&&(n=!1,t.damping=a.damping??t.damping,t.stiffness=a.stiffness??t.stiffness,t.mass=a.mass??t.mass)}const r=JSON.stringify(t);return eM.has(r)||eM.set(r,Object.freeze(t)),n?"instant":eM.get(r)}const Dre=B.createContext(null),q8e=typeof window<"u"?B.useLayoutEffect:B.useEffect;function tk({instance:e,children:t,resize:n,initial:r,mass:a,damping:l,stiffness:f,targetScrollTop:i,contextRef:y,...x}){const S=B.useRef(null),C=B.useCallback((de,fe)=>{const be=(ie==null?void 0:ie.targetScrollTop)??i;return(be==null?void 0:be(de,fe))??de},[i]),P=Lre({mass:a,damping:l,stiffness:f,resize:n,initial:r,targetScrollTop:C}),{scrollRef:L,contentRef:F,scrollToBottom:U,stopScroll:q,isAtBottom:G,escapedFromLock:$,state:X}=e??P,ie=B.useMemo(()=>({scrollToBottom:U,stopScroll:q,scrollRef:L,isAtBottom:G,escapedFromLock:$,contentRef:F,state:X,get targetScrollTop(){return S.current},set targetScrollTop(de){S.current=de}}),[U,G,F,L,q,$,X]);return B.useImperativeHandle(y,()=>ie,[ie]),q8e(()=>{L.current&&getComputedStyle(L.current).overflow==="visible"&&(L.current.style.overflow="auto")},[]),k.jsx(Dre.Provider,{value:ie,children:k.jsx("div",{...x,children:typeof t=="function"?t(ie):t})})}(function(e){function t({children:n,...r}){const a=Nre();return k.jsx("div",{ref:a.scrollRef,style:{height:"100%",width:"100%"},children:k.jsx("div",{...r,ref:a.contentRef,children:typeof n=="function"?n(a):n})})}e.Content=t})(tk||(tk={}));function Nre(){const e=B.useContext(Dre);if(!e)throw new Error("use-stick-to-bottom component context must be used within a StickToBottom component");return e}const p4=e=>{if(typeof e=="object"&&e!==null){if(typeof Object.getPrototypeOf=="function"){const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}return Object.prototype.toString.call(e)==="[object Object]"}return!1},gd=(...e)=>e.reduce((t,n)=>{if(n===void 0)return t;if(Array.isArray(n))throw new TypeError("Arguments provided to ts-deepmerge must be objects, not arrays.");return Object.keys(n).forEach(r=>{["__proto__","constructor","prototype"].includes(r)||(Array.isArray(t[r])&&Array.isArray(n[r])?t[r]=gd.options.mergeArrays?gd.options.uniqueArrayItems?Array.from(new Set(t[r].concat(n[r]))):[...t[r],...n[r]]:n[r]:p4(t[r])&&p4(n[r])?t[r]=gd(t[r],n[r]):!p4(t[r])&&p4(n[r])?t[r]=gd(n[r],void 0):t[r]=n[r]===void 0?gd.options.allowUndefinedOverrides?n[r]:t[r]:n[r])}),t},{}),M8={allowUndefinedOverrides:!0,mergeArrays:!0,uniqueArrayItems:!0};gd.options=M8;gd.withOptions=(e,...t)=>{gd.options=Object.assign(Object.assign({},M8),e);const n=gd(...t);return gd.options=M8,n};var Mu={chatInputPlaceholder:"Type a message...",chatInputToolbarStartTranscribeButtonLabel:"Transcribe",chatInputToolbarCancelTranscribeButtonLabel:"Cancel",chatInputToolbarFinishTranscribeButtonLabel:"Finish",chatInputToolbarAddButtonLabel:"Add photos or files",chatInputToolbarToolsButtonLabel:"Tools",assistantMessageToolbarCopyCodeLabel:"Copy",assistantMessageToolbarCopyCodeCopiedLabel:"Copied",assistantMessageToolbarCopyMessageLabel:"Copy",assistantMessageToolbarThumbsUpLabel:"Good response",assistantMessageToolbarThumbsDownLabel:"Bad response",assistantMessageToolbarReadAloudLabel:"Read aloud",assistantMessageToolbarRegenerateLabel:"Regenerate",userMessageToolbarCopyMessageLabel:"Copy",userMessageToolbarEditMessageLabel:"Edit",chatDisclaimerText:"AI can make mistakes. Please verify important information.",chatToggleOpenLabel:"Open chat",chatToggleCloseLabel:"Close chat",modalHeaderTitle:"CopilotKit Chat"},P8=B.createContext(null),zre=({children:e,labels:t,agentId:n,threadId:r,isModalDefaultOpen:a})=>{const l=B.useContext(P8),f=B.useMemo(()=>({...Mu,...(l==null?void 0:l.labels)??{},...t??{}}),[t,l==null?void 0:l.labels]),i=n??(l==null?void 0:l.agentId)??Ix,y=B.useMemo(()=>r||(l!=null&&l.threadId?l.threadId:gf()),[r,l==null?void 0:l.threadId]),x=a??(l==null?void 0:l.isModalDefaultOpen)??!0,[S,C]=B.useState((l==null?void 0:l.isModalOpen)??x),P=(l==null?void 0:l.isModalOpen)??S,L=(l==null?void 0:l.setModalOpen)??C,F=B.useMemo(()=>({labels:f,agentId:i,threadId:y,isModalOpen:P,setModalOpen:L,isModalDefaultOpen:x}),[f,i,y,P,L,x]);return k.jsx(P8.Provider,{value:F,children:e})},ml=()=>B.useContext(P8);function el(...e){return vo(aD(e))}var Z8e=pye("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 cursor-pointer",link:"text-primary underline-offset-4 hover:underline",assistantMessageToolbarButton:["cursor-pointer","p-0 text-[rgb(93,93,93)] hover:bg-[#E8E8E8]","dark:text-[rgb(243,243,243)] dark:hover:bg-[#303030]","h-8 w-8","transition-colors","hover:text-[rgb(93,93,93)]","dark:hover:text-[rgb(243,243,243)]"],chatInputToolbarPrimary:["cursor-pointer","bg-black text-white","dark:bg-white dark:text-black dark:focus-visible:outline-white","rounded-full","transition-colors","focus:outline-none","hover:opacity-70 disabled:hover:opacity-100","disabled:cursor-not-allowed disabled:bg-[#00000014] disabled:text-[rgb(13,13,13)]","dark:disabled:bg-[#454545] dark:disabled:text-white "],chatInputToolbarSecondary:["cursor-pointer","bg-transparent text-[#444444]","dark:text-white dark:border-[#404040]","rounded-full","transition-colors","focus:outline-none","hover:bg-[#f8f8f8] hover:text-[#333333]","dark:hover:bg-[#404040] dark:hover:text-[#FFFFFF]","disabled:cursor-not-allowed disabled:opacity-50","disabled:hover:bg-transparent disabled:hover:text-[#444444]","dark:disabled:hover:bg-transparent dark:disabled:hover:text-[#CCCCCC]"]},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9",chatInputToolbarIcon:["h-9 w-9 rounded-full"],chatInputToolbarIconLabel:["h-9 px-3 rounded-full","gap-2","font-normal"]}},defaultVariants:{variant:"default",size:"default"}});function g0({className:e,variant:t,size:n,asChild:r=!1,...a}){const l=r?lye:"button";return k.jsx(l,{"data-slot":"button",className:el(Z8e({variant:t,size:n,className:e})),...a})}function W8e({delayDuration:e=0,...t}){return k.jsx(Sve,{"data-slot":"tooltip-provider",delayDuration:e,...t})}function nk({...e}){return k.jsx(W8e,{children:k.jsx(Ave,{"data-slot":"tooltip",...e})})}function rk({...e}){return k.jsx(Cve,{"data-slot":"tooltip-trigger",...e})}function ik({className:e,sideOffset:t=0,children:n,...r}){return k.jsx(kve,{children:k.jsxs(Ive,{"data-slot":"tooltip-content",sideOffset:t,className:el("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",e),...r,children:[n,k.jsx(Rve,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}function X8e({...e}){return k.jsx(swe,{"data-slot":"dropdown-menu",...e})}function Y8e({...e}){return k.jsx(awe,{"data-slot":"dropdown-menu-trigger",...e})}function K8e({className:e,sideOffset:t=4,...n}){return k.jsx(owe,{children:k.jsx(lwe,{"data-slot":"dropdown-menu-content",sideOffset:t,className:el("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",e),...n})})}function Q8e({className:e,inset:t,variant:n="default",...r}){return k.jsx(uwe,{"data-slot":"dropdown-menu-item","data-inset":t,"data-variant":n,className:el("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...r})}function J8e({className:e,...t}){return k.jsx(cwe,{"data-slot":"dropdown-menu-separator",className:el("bg-border -mx-1 my-1 h-px",e),...t})}function eLe({...e}){return k.jsx(dwe,{"data-slot":"dropdown-menu-sub",...e})}function tLe({className:e,inset:t,children:n,...r}){return k.jsxs(hwe,{"data-slot":"dropdown-menu-sub-trigger","data-inset":t,className:el("focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8",e),...r,children:[n,k.jsx(dK,{className:"ml-auto size-4"})]})}function nLe({className:e,...t}){return k.jsx(fwe,{"data-slot":"dropdown-menu-sub-content",className:el("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",e),...t})}var ON=B.forwardRef((e,t)=>{const{className:n,...r}=e,a=B.useRef(null),l=f=>{const i=Date.now()/1e3,y=[];for(let x=0;x<f;x++){const S=x/f*10+i*.5,C=Math.sin(S*2)*.3,P=Math.sin(S*5+i)*.2,L=Math.sin(S*.5+i*.3)*.4,F=(Math.random()-.5)*.1,U=Math.sin(i*.7)*.5+.5;let q=(C+P+L+F)*U;q=Math.max(0,Math.min(1,q*.5+.3)),y.push(q)}return y};return B.useEffect(()=>{const f=a.current;if(!f)return;const i=f.getContext("2d");if(!i)return;let y;const x=()=>{const S=f.getBoundingClientRect(),C=window.devicePixelRatio||1;(f.width!==S.width*C||f.height!==S.height*C)&&(f.width=S.width*C,f.height=S.height*C,i.scale(C,C),i.imageSmoothingEnabled=!1);const P=2,L=2,F=20,U=2,q=Math.ceil(S.width/(P+U)),G=l(q);i.clearRect(0,0,S.width,S.height);const X=getComputedStyle(f).color;i.fillStyle=X;const ie=S.height/2;for(let de=0;de<G.length;de++){const fe=G[de]??0,be=Math.round(fe*(F-L)+L),ve=Math.round(de*(P+U)),Je=Math.round(ie-be/2);i.fillRect(ve,Je,P,be)}y=requestAnimationFrame(x)};return x(),()=>{y&&cancelAnimationFrame(y)}},[]),B.useImperativeHandle(t,()=>({get state(){return"idle"},start:async()=>{},stop:()=>new Promise(f=>{const i=new Blob([],{type:"audio/webm"});f(i)}),dispose:()=>{}}),[]),k.jsx("div",{className:vo("h-[44px] w-full px-5",n),...r,children:k.jsx("canvas",{ref:a,className:"w-full h-full",style:{imageRendering:"pixelated"}})})});ON.displayName="WebAudioRecorder";function rLe(e,t){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const a of n)if(e[a]!==t[a])return!1;return!0}function iLe(e,t,n){return typeof e=="string"?cs.createElement(t,{...n,className:e}):typeof e=="function"?cs.createElement(e,n):e&&typeof e=="object"&&!cs.isValidElement(e)?cs.createElement(t,{...n,...e}):cs.createElement(t,n)}var sLe=cs.memo(cs.forwardRef(function(t,n){const{$slot:r,$component:a,...l}=t,f=n!==null?{...l,ref:n}:l;return iLe(r,a,f)}),(e,t)=>{if(e.$slot!==t.$slot||e.$component!==t.$component)return!1;const{$slot:n,$component:r,...a}=e,{$slot:l,$component:f,...i}=t;return rLe(a,i)});function Ys(e,t,n){return cs.createElement(sLe,{...n,$slot:e,$component:t})}var aLe=5,oLe=40;function ou({mode:e="input",onSubmitMessage:t,onStop:n,isRunning:r=!1,onStartTranscribe:a,onCancelTranscribe:l,onFinishTranscribe:f,onAddFile:i,onChange:y,value:x,toolsMenu:S,autoFocus:C=!0,textArea:P,sendButton:L,startTranscribeButton:F,cancelTranscribeButton:U,finishTranscribeButton:q,addMenuButton:G,audioRecorder:$,children:X,className:ie,...de}){const fe=x!==void 0,[be,ve]=B.useState(()=>x??"");B.useEffect(()=>{!fe&&x!==void 0&&ve(x)},[fe,x]);const Je=fe?x??"":be,[we,rt]=B.useState("compact"),He=B.useRef(!1),ft=B.useRef(null),Ct=e==="input"&&we==="expanded",[Nt,Rt]=B.useState(null),[en,nt]=B.useState(0),pt=B.useRef(null),Oe=B.useRef(null),gn=B.useRef(null),wt=B.useRef(null),Fe=B.useRef(null),jt=B.useRef(null),Tn=ml(),mn=(Tn==null?void 0:Tn.labels)??Mu,zn=B.useRef(void 0),yn=B.useRef(null),qt=B.useRef({singleLineHeight:0,maxHeight:0,paddingLeft:0,paddingRight:0}),wn=B.useMemo(()=>{const Ln=[],Hn=new Set,Ke=sn=>{if(sn!=="-"){if(sn.items&&sn.items.length>0){for(const bn of sn.items)Ke(bn);return}Hn.has(sn.label)||(Hn.add(sn.label),Ln.push(sn))}};if(i&&Ke({label:mn.chatInputToolbarAddButtonLabel,action:i}),S&&S.length>0)for(const sn of S)Ke(sn);return Ln},[mn.chatInputToolbarAddButtonLabel,i,S]),Sn=B.useMemo(()=>{if(Nt===null)return[];if(wn.length===0)return[];const Ln=Nt.trim().toLowerCase();if(Ln.length===0)return wn;const Hn=[],Ke=[];for(const sn of wn){const bn=sn.label.toLowerCase();bn.startsWith(Ln)?Hn.push(sn):bn.includes(Ln)&&Ke.push(sn)}return[...Hn,...Ke]},[wn,Nt]);B.useEffect(()=>{var Ln;if(!C){zn.current=Tn==null?void 0:Tn.isModalOpen;return}Tn!=null&&Tn.isModalOpen&&!zn.current&&((Ln=pt.current)==null||Ln.focus()),zn.current=Tn==null?void 0:Tn.isModalOpen},[Tn==null?void 0:Tn.isModalOpen,C]),B.useEffect(()=>{wn.length===0&&Nt!==null&&Rt(null)},[wn.length,Nt]);const Xn=B.useRef(null);B.useEffect(()=>{Nt!==null&&Nt!==Xn.current&&Sn.length>0&&nt(0),Xn.current=Nt},[Nt,Sn.length]),B.useEffect(()=>{if(Nt===null){nt(0);return}Sn.length===0?nt(-1):(en<0||en>=Sn.length)&&nt(0)},[Nt,Sn,en]),B.useEffect(()=>{const Ln=Fe.current;Ln&&(e==="transcribe"?Ln.start().catch(console.error):Ln.state==="recording"&&Ln.stop().catch(console.error))},[e]),B.useEffect(()=>{e!=="input"&&(rt("compact"),Rt(null))},[e]);const rn=B.useCallback(Ln=>{if(wn.length===0){Rt(Hn=>Hn===null?Hn:null);return}if(Ln.startsWith("/")){const Ke=(Ln.split(/\r?\n/,1)[0]??"").slice(1);Rt(sn=>sn===Ke?sn:Ke)}else Rt(Hn=>Hn===null?Hn:null)},[wn.length]);B.useEffect(()=>{rn(Je)},[Je,rn]);const br=Ln=>{const Hn=Ln.target.value;fe||ve(Hn),y==null||y(Hn),rn(Hn)},Qr=B.useCallback(()=>{fe||ve(""),y&&y("")},[fe,y]),sr=B.useCallback(Ln=>{var Hn;Qr(),(Hn=Ln.action)==null||Hn.call(Ln),Rt(null),nt(0),requestAnimationFrame(()=>{var Ke;(Ke=pt.current)==null||Ke.focus()})},[Qr]),ar=Ln=>{if(Nt!==null&&e==="input"){if(Ln.key==="ArrowDown"){Sn.length>0&&(Ln.preventDefault(),nt(Hn=>Sn.length===0?Hn:Hn===-1?0:(Hn+1)%Sn.length));return}if(Ln.key==="ArrowUp"){Sn.length>0&&(Ln.preventDefault(),nt(Hn=>Sn.length===0?Hn:Hn===-1||Hn<=0?Sn.length-1:Hn-1));return}if(Ln.key==="Enter"){const Hn=en>=0?Sn[en]:void 0;if(Hn){Ln.preventDefault(),sr(Hn);return}}if(Ln.key==="Escape"){Ln.preventDefault(),Rt(null);return}}Ln.key==="Enter"&&!Ln.shiftKey&&(Ln.preventDefault(),ys?n==null||n():Vn())},Vn=()=>{if(!t)return;const Ln=Je.trim();Ln&&(t(Ln),fe||(ve(""),y==null||y("")),pt.current&&pt.current.focus())},wr=Ys(P,ou.TextArea,{ref:pt,value:Je,onChange:br,onKeyDown:ar,autoFocus:C,className:vo("w-full py-3",Ct?"px-5":"pr-5")}),ys=e!=="transcribe"&&r,Si=Je.trim().length>0&&!!t,Ri=!!n,ks=()=>{if(ys){n==null||n();return}Vn()},$i=Ys($,ON,{ref:Fe}),Ws=Ys(L,ou.SendButton,{onClick:ks,disabled:ys?!Ri:!Si,children:ys&&Ri?k.jsx(K_e,{className:"size-[18px] fill-current"}):void 0}),Kt=Ys(F,ou.StartTranscribeButton,{onClick:a}),An=Ys(U,ou.CancelTranscribeButton,{onClick:l}),Lr=Ys(q,ou.FinishTranscribeButton,{onClick:f}),Tt=Ys(G,ou.AddMenuButton,{disabled:e==="transcribe",onAddFile:i,toolsMenu:S});if(X){const Ln={textArea:wr,audioRecorder:$i,sendButton:Ws,startTranscribeButton:Kt,cancelTranscribeButton:An,finishTranscribeButton:Lr,addMenuButton:Tt,onSubmitMessage:t,onStop:n,isRunning:r,onStartTranscribe:a,onCancelTranscribe:l,onFinishTranscribe:f,onAddFile:i,mode:e,toolsMenu:S,autoFocus:C};return k.jsx(k.Fragment,{children:X(Ln)})}const kn=Ln=>{const Hn=Ln.target;Hn.tagName!=="BUTTON"&&!Hn.closest("button")&&pt.current&&e==="input"&&pt.current.focus()},nr=B.useCallback(()=>{const Ln=pt.current;if(!Ln)return;const Hn=Ln.value,Ke=Ln.style.height;Ln.style.height="auto";const sn=window.getComputedStyle(Ln),bn=parseFloat(sn.paddingLeft)||0,kr=parseFloat(sn.paddingRight)||0,In=parseFloat(sn.paddingTop)||0,Ki=parseFloat(sn.paddingBottom)||0;Ln.value="";const Ta=Ln.scrollHeight;Ln.value=Hn;const Ht=(Ta-In-Ki)*5+In+Ki;qt.current={singleLineHeight:Ta,maxHeight:Ht,paddingLeft:bn,paddingRight:kr},Ln.style.height=Ke,Ln.style.maxHeight=`${Ht}px`},[]),dt=B.useCallback(()=>{const Ln=pt.current;if(!Ln)return 0;qt.current.singleLineHeight===0&&nr();const{maxHeight:Hn}=qt.current;Hn&&(Ln.style.maxHeight=`${Hn}px`),Ln.style.height="auto";const Ke=Ln.scrollHeight;return Hn?Ln.style.height=`${Math.min(Ke,Hn)}px`:Ln.style.height=`${Ke}px`,Ke},[nr]),Qn=B.useCallback(Ln=>{rt(Hn=>Hn===Ln?Hn:(He.current=!0,Ln))},[]),ti=B.useCallback(()=>{if(e!=="input"){Qn("compact");return}if(typeof window<"u"&&typeof window.matchMedia=="function"&&window.matchMedia("(max-width: 767px)").matches){nr(),dt(),Qn("expanded");return}const Ln=pt.current,Hn=Oe.current,Ke=gn.current,sn=wt.current;if(!Ln||!Hn||!Ke||!sn)return;qt.current.singleLineHeight===0&&nr();const bn=dt(),kr=qt.current.singleLineHeight,In=Je.includes(`
`),Ki=kr>0?bn>kr+1:!1;let Ta=In||Ki;if(!Ta){const Ht=window.getComputedStyle(Hn),Dn=parseFloat(Ht.paddingLeft)||0,je=parseFloat(Ht.paddingRight)||0,jn=parseFloat(Ht.columnGap)||0,Ir=Hn.clientWidth-Dn-je;if(Ir>0){const Gn=Ke.getBoundingClientRect().width,cn=sn.getBoundingClientRect().width,xr=Math.max(Ir-Gn-cn-jn*2,0),Qs=yn.current??document.createElement("canvas");yn.current||(yn.current=Qs);const Sr=Qs.getContext("2d");if(Sr){const Mi=window.getComputedStyle(Ln),Ye=Mi.font||`${Mi.fontStyle} ${Mi.fontVariant} ${Mi.fontWeight} ${Mi.fontSize}/${Mi.lineHeight} ${Mi.fontFamily}`;Sr.font=Ye;const ee=Math.max(xr-(qt.current.paddingLeft||0)-(qt.current.paddingRight||0),0);if(ee>0){const le=Je.length>0?Je.split(`
`):[""];let ye=0;for(const Ne of le){const Me=Sr.measureText(Ne||" ");Me.width>ye&&(ye=Me.width)}ye>ee&&(Ta=!0)}}}}Qn(Ta?"expanded":"compact")},[dt,nr,e,Je,Qn]);B.useLayoutEffect(()=>{ti()},[ti]),B.useEffect(()=>{if(typeof ResizeObserver>"u")return;const Ln=pt.current,Hn=Oe.current,Ke=gn.current,sn=wt.current;if(!Ln||!Hn||!Ke||!sn)return;const bn=()=>{if(He.current){He.current=!1;return}if(typeof window>"u"){ti();return}ft.current!==null&&cancelAnimationFrame(ft.current),ft.current=window.requestAnimationFrame(()=>{ft.current=null,ti()})},kr=new ResizeObserver(()=>{bn()});return kr.observe(Hn),kr.observe(Ke),kr.observe(sn),kr.observe(Ln),()=>{kr.disconnect(),typeof window<"u"&&ft.current!==null&&(cancelAnimationFrame(ft.current),ft.current=null)}},[ti]);const Zi=Nt!==null&&wn.length>0;B.useEffect(()=>{var Hn;if(!Zi||en<0)return;const Ln=(Hn=jt.current)==null?void 0:Hn.querySelector(`[data-slash-index="${en}"]`);Ln==null||Ln.scrollIntoView({block:"nearest"})},[Zi,en]);const Is=Zi?k.jsx("div",{"data-testid":"copilot-slash-menu",role:"listbox","aria-label":"Slash commands",ref:jt,className:"absolute bottom-full left-0 right-0 z-30 mb-2 max-h-64 overflow-y-auto rounded-lg border border-border bg-white shadow-lg dark:border-[#3a3a3a] dark:bg-[#1f1f1f]",style:{maxHeight:`${aLe*oLe}px`},children:Sn.length===0?k.jsx("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:"No commands found"}):Sn.map((Ln,Hn)=>{const Ke=Hn===en;return k.jsx("button",{type:"button",role:"option","aria-selected":Ke,"data-active":Ke?"true":void 0,"data-slash-index":Hn,className:vo("w-full px-3 py-2 text-left text-sm transition-colors","hover:bg-muted dark:hover:bg-[#2f2f2f]",Ke?"bg-muted dark:bg-[#2f2f2f]":"bg-transparent"),onMouseEnter:()=>nt(Hn),onMouseDown:sn=>{sn.preventDefault(),sr(Ln)},children:Ln.label},`${Ln.label}-${Hn}`)})}):null;return k.jsx("div",{className:vo("flex w-full flex-col items-center justify-center","cursor-text","overflow-visible bg-clip-padding contain-inline-size","bg-white dark:bg-[#303030]","shadow-[0_4px_4px_0_#0000000a,0_0_1px_0_#0000009e] rounded-[28px]",ie),onClick:kn,...de,"data-layout":Ct?"expanded":"compact",children:k.jsxs("div",{ref:Oe,className:vo("grid w-full gap-x-3 gap-y-3 px-3 py-2",Ct?"grid-cols-[auto_minmax(0,1fr)_auto] grid-rows-[auto_auto]":"grid-cols-[auto_minmax(0,1fr)_auto] items-center"),"data-layout":Ct?"expanded":"compact",children:[k.jsx("div",{ref:gn,className:vo("flex items-center",Ct?"row-start-2":"row-start-1","col-start-1"),children:Tt}),k.jsx("div",{className:vo("relative flex min-w-0 flex-col",Ct?"col-span-3 row-start-1":"col-start-2 row-start-1"),children:e==="transcribe"?$i:k.jsxs(k.Fragment,{children:[wr,Is]})}),k.jsx("div",{ref:wt,className:vo("flex items-center justify-end gap-2",Ct?"col-start-3 row-start-2":"col-start-3 row-start-1"),children:e==="transcribe"?k.jsxs(k.Fragment,{children:[l&&An,f&&Lr]}):k.jsxs(k.Fragment,{children:[a&&Kt,Ws]})})]})})}(e=>{e.SendButton=({className:t,children:n,...r})=>k.jsx("div",{className:"mr-[10px]",children:k.jsx(g0,{type:"button",variant:"chatInputToolbarPrimary",size:"chatInputToolbarIcon",className:t,...r,children:n??k.jsx(R_e,{className:"size-[18px]"})})}),e.ToolbarButton=({icon:t,labelKey:n,defaultClassName:r,className:a,...l})=>{const f=ml(),i=(f==null?void 0:f.labels)??Mu;return k.jsxs(nk,{children:[k.jsx(rk,{asChild:!0,children:k.jsx(g0,{type:"button",variant:"chatInputToolbarSecondary",size:"chatInputToolbarIcon",className:vo(r,a),...l,children:t})}),k.jsx(ik,{side:"bottom",children:k.jsx("p",{children:i[n]})})]})},e.StartTranscribeButton=t=>k.jsx(e.ToolbarButton,{icon:k.jsx($_e,{className:"size-[18px]"}),labelKey:"chatInputToolbarStartTranscribeButtonLabel",defaultClassName:"mr-2",...t}),e.CancelTranscribeButton=t=>k.jsx(e.ToolbarButton,{icon:k.jsx(sD,{className:"size-[18px]"}),labelKey:"chatInputToolbarCancelTranscribeButtonLabel",defaultClassName:"mr-2",...t}),e.FinishTranscribeButton=t=>k.jsx(e.ToolbarButton,{icon:k.jsx(iD,{className:"size-[18px]"}),labelKey:"chatInputToolbarFinishTranscribeButtonLabel",defaultClassName:"mr-[10px]",...t}),e.AddMenuButton=({className:t,toolsMenu:n,onAddFile:r,disabled:a,...l})=>{const f=ml(),i=(f==null?void 0:f.labels)??Mu,y=B.useMemo(()=>{const P=[];if(r&&P.push({label:i.chatInputToolbarAddButtonLabel,action:r}),n&&n.length>0){P.length>0&&P.push("-");for(const L of n)if(L==="-"){if(P.length===0||P[P.length-1]==="-")continue;P.push(L)}else P.push(L);for(;P.length>0&&P[P.length-1]==="-";)P.pop()}return P},[r,n,i.chatInputToolbarAddButtonLabel]),x=B.useCallback(P=>P.map((L,F)=>L==="-"?k.jsx(J8e,{},`separator-${F}`):L.items&&L.items.length>0?k.jsxs(eLe,{children:[k.jsx(tLe,{children:L.label}),k.jsx(nLe,{children:x(L.items)})]},`group-${F}`):k.jsx(Q8e,{onClick:L.action,children:L.label},`item-${F}`)),[]),S=y.length>0,C=a||!S;return k.jsxs(X8e,{children:[k.jsxs(nk,{children:[k.jsx(rk,{asChild:!0,children:k.jsx(Y8e,{asChild:!0,children:k.jsx(g0,{type:"button",variant:"chatInputToolbarSecondary",size:"chatInputToolbarIcon",className:vo("ml-1",t),disabled:C,...l,children:k.jsx(G_e,{className:"size-[20px]"})})})}),k.jsx(ik,{side:"bottom",children:k.jsxs("p",{className:"flex items-center gap-1 text-xs font-medium",children:[k.jsx("span",{children:"Add files and more"}),k.jsx("code",{className:"rounded bg-[#4a4a4a] px-1 py-[1px] font-mono text-[11px] text-white dark:bg-[#e0e0e0] dark:text-black",children:"/"})]})})]}),S&&k.jsx(K8e,{side:"top",align:"start",children:x(y)})]})},e.TextArea=B.forwardRef(function({style:n,className:r,autoFocus:a,...l},f){const i=B.useRef(null),y=ml(),x=(y==null?void 0:y.labels)??Mu;return B.useImperativeHandle(f,()=>i.current),B.useEffect(()=>{const S=i.current;if(!S)return;const C=()=>{setTimeout(()=>{S.scrollIntoView({behavior:"smooth",block:"nearest"})},300)};return S.addEventListener("focus",C),()=>S.removeEventListener("focus",C)},[]),B.useEffect(()=>{var S;a&&((S=i.current)==null||S.focus())},[a]),k.jsx("textarea",{ref:i,...l,style:{overflow:"auto",resize:"none",...n},placeholder:x.chatInputPlaceholder,className:vo("bg-transparent outline-none antialiased font-regular leading-relaxed text-[16px] placeholder:text-[#00000077] dark:placeholder:text-[#fffc]",r),rows:1})}),e.AudioRecorder=ON})(ou||(ou={}));ou.TextArea.displayName="CopilotChatInput.TextArea";ou.SendButton.displayName="CopilotChatInput.SendButton";ou.ToolbarButton.displayName="CopilotChatInput.ToolbarButton";ou.StartTranscribeButton.displayName="CopilotChatInput.StartTranscribeButton";ou.CancelTranscribeButton.displayName="CopilotChatInput.CancelTranscribeButton";ou.FinishTranscribeButton.displayName="CopilotChatInput.FinishTranscribeButton";ou.AddMenuButton.displayName="CopilotChatInput.AddMenuButton";var lLe=ou,uLe=class extends f8e{constructor(t){super(t);wi(this,"_renderToolCalls",[]);wi(this,"_renderCustomMessages",[]);wi(this,"_renderActivityMessages",[]);this._renderToolCalls=t.renderToolCalls??[],this._renderCustomMessages=t.renderCustomMessages??[],this._renderActivityMessages=t.renderActivityMessages??[]}get renderCustomMessages(){return this._renderCustomMessages}get renderActivityMessages(){return this._renderActivityMessages}get renderToolCalls(){return this._renderToolCalls}setRenderToolCalls(t){this._renderToolCalls=t,this.notifySubscribers(n=>{const r=n;r.onRenderToolCallsChanged&&r.onRenderToolCallsChanged({copilotkit:this,renderToolCalls:this.renderToolCalls})},"Subscriber onRenderToolCallsChanged error:")}subscribe(t){return super.subscribe(t)}},Fre=({core:e,...t})=>{const[n,r]=B.useState(null);return B.useEffect(()=>{let a=!0;return KT(()=>import("./index-Ci6ERCjJ.js"),[]).then(l=>{var i;(i=l.defineWebInspector)==null||i.call(l);const f=U8e({tagName:l.WEB_INSPECTOR_TAG,elementClass:l.WebInspectorElement,react:$T});a&&r(()=>f)}),()=>{a=!1}},[]),n?k.jsx(n,{...t,core:e??null}):null};Fre.displayName="CopilotKitInspector";var DG="X-CopilotCloud-Public-Api-Key",cLe="https://api.cloud.copilotkit.ai/copilotkit/v1",Bre=B.createContext({copilotkit:null});function n2(e,t,n){const r=B.useMemo(()=>[],[]),a=e??r,l=B.useRef(a);return B.useEffect(()=>{t&&a!==l.current&&(!n||n(l.current,a))&&console.error(t)},[a,t]),a}var dLe=({children:e,runtimeUrl:t,headers:n={},publicApiKey:r,publicLicenseKey:a,properties:l={},agents__unsafe_dev_only:f={},renderToolCalls:i,renderActivityMessages:y,renderCustomMessages:x,frontendTools:S,humanInTheLoop:C,showDevConsole:P=!1,useSingleEndpoint:L=!1})=>{const[F,U]=B.useState(!1);B.useEffect(()=>{typeof window>"u"||(P===!0||P==="auto"&&new Set(["localhost","127.0.0.1"]).has(window.location.hostname)?U(!0):U(!1))},[P]);const q=n2(i,"renderToolCalls must be a stable array. If you want to dynamically add or remove tools, use `useFrontendTool` instead.",(Ct,Nt)=>{const Rt=Oe=>`${(Oe==null?void 0:Oe.agentId)??""}:${(Oe==null?void 0:Oe.name)??""}`,en=Oe=>new Set(Oe.map(Rt)),nt=en(Ct),pt=en(Nt);if(nt.size!==pt.size)return!0;for(const Oe of nt)if(!pt.has(Oe))return!0;return!1}),G=n2(x,"renderCustomMessages must be a stable array."),$=n2(y,"renderActivityMessages must be a stable array."),X=r??a,ie=f&&Object.keys(f).length>0,de=B.useMemo(()=>!X||n[DG]?n:{...n,[DG]:X},[n,X]);if(!t&&!X&&!ie){const Ct="Missing required prop: 'runtimeUrl' or 'publicApiKey' or 'publicLicenseKey'";throw new Error(Ct)}const fe=t??(X?cLe:void 0),be=n2(S,"frontendTools must be a stable array. If you want to dynamically add or remove tools, use `useFrontendTool` instead."),ve=n2(C,"humanInTheLoop must be a stable array. If you want to dynamically add or remove human-in-the-loop tools, use `useHumanInTheLoop` instead."),Je=B.useMemo(()=>{const Ct=[],Nt=[];return ve.forEach(Rt=>{const en={name:Rt.name,description:Rt.description,parameters:Rt.parameters,followUp:Rt.followUp,...Rt.agentId&&{agentId:Rt.agentId},handler:async()=>new Promise(nt=>{console.warn(`Human-in-the-loop tool '${Rt.name}' called but no interactive handler is set up.`),nt(void 0)})};Ct.push(en),Rt.render&&Nt.push({name:Rt.name,args:Rt.parameters,render:Rt.render,...Rt.agentId&&{agentId:Rt.agentId}})}),{tools:Ct,renderToolCalls:Nt}},[ve]),we=B.useMemo(()=>{const Ct=[];return Ct.push(...be),Ct.push(...Je.tools),Ct},[be,Je]),rt=B.useMemo(()=>{const Ct=[...q];return be.forEach(Nt=>{if(Nt.render){const Rt=Nt.parameters||(Nt.name==="*"?Ore():void 0);Rt&&Ct.push({name:Nt.name,args:Rt,render:Nt.render})}}),Ct.push(...Je.renderToolCalls),Ct},[q,be,Je]),He=B.useMemo(()=>new uLe({runtimeUrl:fe,runtimeTransport:L?"single":"rest",headers:de,properties:l,agents__unsafe_dev_only:f,tools:we,renderToolCalls:rt,renderActivityMessages:$,renderCustomMessages:G}),[we,rt,$,G,L]),[,ft]=B.useReducer(Ct=>Ct+1,0);return B.useEffect(()=>{const Ct=He.subscribe({onRenderToolCallsChanged:()=>{ft()}});return()=>{Ct.unsubscribe()}},[He]),B.useEffect(()=>{He.setRuntimeUrl(fe),He.setRuntimeTransport(L?"single":"rest"),He.setHeaders(de),He.setProperties(l),He.setAgents__unsafe_dev_only(f)},[fe,de,l,f,L]),k.jsxs(Bre.Provider,{value:{copilotkit:He},children:[e,F?k.jsx(Fre,{core:He}):null]})},Sh=()=>{const e=B.useContext(Bre),[,t]=B.useReducer(n=>n+1,0);if(!e)throw new Error("useCopilotKit must be used within CopilotKitProvider");return B.useEffect(()=>{const n=e.copilotkit.subscribe({onRuntimeConnectionStatusChanged:()=>{t()}});return()=>{n.unsubscribe()}},[]),e},hLe=cs.memo(function({toolCall:t,toolMessage:n,RenderComponent:r,isExecuting:a}){const l=B.useMemo(()=>pK(t.function.arguments),[t.function.arguments]),f=t.function.name;return n?k.jsx(r,{name:f,args:l,status:f_.Complete,result:n.content}):a?k.jsx(r,{name:f,args:l,status:f_.Executing,result:void 0}):k.jsx(r,{name:f,args:l,status:f_.InProgress,result:void 0})},(e,t)=>{var a,l;if(e.toolCall.id!==t.toolCall.id||e.toolCall.function.name!==t.toolCall.function.name||e.toolCall.function.arguments!==t.toolCall.function.arguments)return!1;const n=(a=e.toolMessage)==null?void 0:a.content,r=(l=t.toolMessage)==null?void 0:l.content;return!(n!==r||e.isExecuting!==t.isExecuting||e.RenderComponent!==t.RenderComponent)});function fLe(){const{copilotkit:e}=Sh(),t=ml(),n=(t==null?void 0:t.agentId)??Ix,[r,a]=B.useState(()=>new Set),l=B.useSyncExternalStore(i=>e.subscribe({onRenderToolCallsChanged:i}).unsubscribe,()=>e.renderToolCalls,()=>e.renderToolCalls);return B.useEffect(()=>{const i=e.subscribe({onToolExecutionStart:({toolCallId:y})=>{a(x=>{if(x.has(y))return x;const S=new Set(x);return S.add(y),S})},onToolExecutionEnd:({toolCallId:y})=>{a(x=>{if(!x.has(y))return x;const S=new Set(x);return S.delete(y),S})}});return()=>i.unsubscribe()},[e]),B.useCallback(({toolCall:i,toolMessage:y})=>{const x=l.filter(L=>L.name===i.function.name),S=x.find(L=>L.agentId===n)||x.find(L=>!L.agentId)||x[0]||l.find(L=>L.name==="*");if(!S)return null;const C=S.render,P=r.has(i.id);return k.jsx(hLe,{toolCall:i,toolMessage:y,RenderComponent:C,isExecuting:P},i.id)},[l,r,n])}function pLe(){const{copilotkit:e}=Sh(),t=ml();if(!t)return null;const{agentId:n,threadId:r}=t,a=e.renderCustomMessages.filter(l=>l.agentId===void 0||l.agentId===n).sort((l,f)=>{const i=l.agentId!==void 0,y=f.agentId!==void 0;return i===y?0:i?-1:1});return function(l){if(!a.length)return null;const{message:f,position:i}=l,y=e.getRunIdForMessage(n,r,f.id),x=e.getAgent(n);if(!x)throw new Error("Agent not found");const S=x.messages.filter(q=>e.getRunIdForMessage(n,r,q.id)===y).map(q=>q.id),C=x.messages.findIndex(q=>q.id===f.id)??0,P=Math.min(S.indexOf(f.id),0),L=S.length,F=e.getStateByRun(n,r,y);let U=null;for(const q of a){if(!q.render)continue;const G=q.render;if(U=k.jsx(G,{message:f,position:i,runId:y,messageIndex:C,messageIndexInRun:P,numberOfMessagesInRun:L,agentId:n,stateSnapshot:F},`${y}-${f.id}-${i}`),U)break}return U}}function mLe(){const{copilotkit:e}=Sh(),t=ml(),n=(t==null?void 0:t.agentId)??Ix,r=e.renderActivityMessages;return B.useCallback(a=>{if(!r.length)return null;const l=r.filter(S=>S.activityType===a.activityType),f=l.find(S=>S.agentId===n)??l.find(S=>S.agentId===void 0)??r.find(S=>S.activityType==="*");if(!f)return null;const i=f.content.safeParse(a.content);if(!i.success)return console.warn(`Failed to parse content for activity message '${a.activityType}':`,i.error),null;const y=f.render,x=e.getAgent(n);return k.jsx(y,{activityType:a.activityType,content:i.data,message:a,agent:x},a.id)},[n,e,r])}var gLe=[];function jre(e,t){const{copilotkit:n}=Sh(),r=gLe;B.useEffect(()=>{const a=e.name;if(n.getTool({toolName:a,agentId:e.agentId})&&(console.warn(`Tool '${a}' already exists for agent '${e.agentId||"global"}'. Overriding with latest registration.`),n.removeTool(a,e.agentId)),n.addTool(e),e.render){const l=x=>`${x.agentId??""}:${x.name}`,f=n.renderToolCalls,i=new Map;for(const x of f)i.set(l(x),x);const y={name:a,args:e.parameters,agentId:e.agentId,render:e.render};i.set(l(y),y),n.setRenderToolCalls(Array.from(i.values()))}return()=>{n.removeTool(a,e.agentId)}},[e.name,n,r.length,...r])}function _Le(e,t){const{copilotkit:n}=Sh(),r=B.useRef(null),a=B.useCallback(async y=>{r.current&&(r.current(y),r.current=null)},[]),l=B.useCallback(async()=>new Promise(y=>{r.current=y}),[]),f=B.useCallback(y=>{const x=e.render;if(y.status==="inProgress"){const S={...y,name:e.name,description:e.description||"",respond:void 0};return cs.createElement(x,S)}else if(y.status==="executing"){const S={...y,name:e.name,description:e.description||"",respond:a};return cs.createElement(x,S)}else if(y.status==="complete"){const S={...y,name:e.name,description:e.description||"",respond:void 0};return cs.createElement(x,S)}return cs.createElement(x,y)},[e.render,e.name,e.description,a]),i={...e,handler:l,render:f};jre(i),B.useEffect(()=>()=>{const y=C=>`${C.agentId??""}:${C.name}`,S=n.renderToolCalls.filter(C=>y(C)!==y({name:e.name,agentId:e.agentId}));n.setRenderToolCalls(S)},[n,e.name,e.agentId])}var yLe=["OnMessagesChanged","OnStateChanged","OnRunStatusChanged"];function LN({agentId:e,updates:t}={}){e??(e=Ix);const{copilotkit:n}=Sh(),[,r]=B.useReducer(f=>f+1,0),a=B.useMemo(()=>t??yLe,[JSON.stringify(t)]),l=B.useMemo(()=>{const f=n.getAgent(e);if(f)return f;const i=n.runtimeUrl!==void 0,y=n.runtimeConnectionStatus;if(i&&(y===E8.Disconnected||y===E8.Connecting)){const C=new Ire({runtimeUrl:n.runtimeUrl,agentId:e,transport:n.runtimeTransport});return C.headers={...n.headers},C}const x=Object.keys(n.agents??{}),S=i?`runtimeUrl=${n.runtimeUrl}`:"no runtimeUrl";throw new Error(`useAgent: Agent '${e}' not found after runtime sync (${S}). `+(x.length?`Known agents: [${x.join(", ")}]`:"No agents registered.")+" Verify your runtime /info and/or agents__unsafe_dev_only.")},[e,n.agents,n.runtimeConnectionStatus,n.runtimeUrl,n.runtimeTransport,JSON.stringify(n.headers),n]);return B.useEffect(()=>{if(a.length===0)return;const f={};a.includes("OnMessagesChanged")&&(f.onMessagesChanged=()=>{r()}),a.includes("OnStateChanged")&&(f.onStateChanged=()=>{r()}),a.includes("OnRunStatusChanged")&&(f.onRunInitialized=()=>{r()},f.onRunFinalized=()=>{r()},f.onRunFailed=()=>{r()});const i=l.subscribe(f);return()=>i.unsubscribe()},[l,r,JSON.stringify(a)]),{agent:l}}function vLe({agentId:e}={}){const{copilotkit:t}=Sh(),n=ml(),r=B.useMemo(()=>e??(n==null?void 0:n.agentId)??Ix,[e,n==null?void 0:n.agentId]),[a,l]=B.useState(()=>t.getSuggestions(r).suggestions),[f,i]=B.useState(()=>t.getSuggestions(r).isLoading);B.useEffect(()=>{const S=t.getSuggestions(r);l(S.suggestions),i(S.isLoading)},[t,r]),B.useEffect(()=>{const S=t.subscribe({onSuggestionsChanged:({agentId:C,suggestions:P})=>{C===r&&l(P)},onSuggestionsStartedLoading:({agentId:C})=>{C===r&&i(!0)},onSuggestionsFinishedLoading:({agentId:C})=>{C===r&&i(!1)},onSuggestionsConfigChanged:()=>{const C=t.getSuggestions(r);l(C.suggestions),i(C.isLoading)}});return()=>{S.unsubscribe()}},[t,r]);const y=B.useCallback(()=>{t.reloadSuggestions(r)},[t,r]),x=B.useCallback(()=>{t.clearSuggestions(r)},[t,r]);return{suggestions:a,reloadSuggestions:y,clearSuggestions:x,isLoading:f}}function xLe({message:e,messages:t=[]}){const n=fLe();return!e.toolCalls||e.toolCalls.length===0?null:k.jsx(k.Fragment,{children:e.toolCalls.map(r=>{const a=t.find(l=>l.role==="tool"&&l.toolCallId===r.id);return k.jsx(cs.Fragment,{children:n({toolCall:r,toolMessage:a})},r.id)})})}var bLe=xLe;function Gl({message:e,messages:t,isRunning:n,onThumbsUp:r,onThumbsDown:a,onReadAloud:l,onRegenerate:f,additionalToolbarItems:i,toolbarVisible:y=!0,markdownRenderer:x,toolbar:S,copyButton:C,thumbsUpButton:P,thumbsDownButton:L,readAloudButton:F,regenerateButton:U,toolCallsView:q,children:G,className:$,...X}){var Nt;const ie=Ys(x,Gl.MarkdownRenderer,{content:e.content||""}),de=Ys(C,Gl.CopyButton,{onClick:async()=>{if(e.content)try{await navigator.clipboard.writeText(e.content)}catch(Rt){console.error("Failed to copy message:",Rt)}}}),fe=Ys(P,Gl.ThumbsUpButton,{onClick:r}),be=Ys(L,Gl.ThumbsDownButton,{onClick:a}),ve=Ys(F,Gl.ReadAloudButton,{onClick:l}),Je=Ys(U,Gl.RegenerateButton,{onClick:f}),we=Ys(S,Gl.Toolbar,{children:k.jsxs("div",{className:"flex items-center gap-1",children:[de,(r||P)&&fe,(a||L)&&be,(l||F)&&ve,(f||U)&&Je,i]})}),rt=Ys(q,bLe,{message:e,messages:t}),He=!!(e.content&&e.content.trim().length>0),ft=e.role==="assistant"&&((Nt=t==null?void 0:t[t.length-1])==null?void 0:Nt.id)===e.id,Ct=y&&He&&!(n&&ft);return G?k.jsx(k.Fragment,{children:G({markdownRenderer:ie,toolbar:we,toolCallsView:rt,copyButton:de,thumbsUpButton:fe,thumbsDownButton:be,readAloudButton:ve,regenerateButton:Je,message:e,messages:t,isRunning:n,onThumbsUp:r,onThumbsDown:a,onReadAloud:l,onRegenerate:f,additionalToolbarItems:i,toolbarVisible:Ct})}):k.jsxs("div",{className:vo("prose max-w-full break-words dark:prose-invert",$),...X,"data-message-id":e.id,children:[ie,rt,Ct&&we]})}(e=>{e.MarkdownRenderer=({content:t,className:n,...r})=>k.jsx(xre,{className:n,...r,children:t??""}),e.Toolbar=({className:t,...n})=>k.jsx("div",{className:vo("w-full bg-transparent flex items-center -ml-[5px] -mt-[0px]",t),...n}),e.ToolbarButton=({title:t,children:n,...r})=>k.jsxs(nk,{children:[k.jsx(rk,{asChild:!0,children:k.jsx(g0,{type:"button",variant:"assistantMessageToolbarButton","aria-label":t,...r,children:n})}),k.jsx(ik,{side:"bottom",children:k.jsx("p",{children:t})})]}),e.CopyButton=({className:t,title:n,onClick:r,...a})=>{const l=ml(),f=(l==null?void 0:l.labels)??Mu,[i,y]=B.useState(!1),x=S=>{y(!0),setTimeout(()=>y(!1),2e3),r&&r(S)};return k.jsx(e.ToolbarButton,{title:n||f.assistantMessageToolbarCopyMessageLabel,onClick:x,className:t,...a,children:i?k.jsx(iD,{className:"size-[18px]"}):k.jsx(hK,{className:"size-[18px]"})})},e.ThumbsUpButton=({title:t,...n})=>{const r=ml(),a=(r==null?void 0:r.labels)??Mu;return k.jsx(e.ToolbarButton,{title:t||a.assistantMessageToolbarThumbsUpLabel,...n,children:k.jsx(tye,{className:"size-[18px]"})})},e.ThumbsDownButton=({title:t,...n})=>{const r=ml(),a=(r==null?void 0:r.labels)??Mu;return k.jsx(e.ToolbarButton,{title:t||a.assistantMessageToolbarThumbsDownLabel,...n,children:k.jsx(J_e,{className:"size-[18px]"})})},e.ReadAloudButton=({title:t,...n})=>{const r=ml(),a=(r==null?void 0:r.labels)??Mu;return k.jsx(e.ToolbarButton,{title:t||a.assistantMessageToolbarReadAloudLabel,...n,children:k.jsx(rye,{className:"size-[20px]"})})},e.RegenerateButton=({title:t,...n})=>{const r=ml(),a=(r==null?void 0:r.labels)??Mu;return k.jsx(e.ToolbarButton,{title:t||a.assistantMessageToolbarRegenerateLabel,...n,children:k.jsx(Z_e,{className:"size-[18px]"})})}})(Gl||(Gl={}));Gl.MarkdownRenderer.displayName="CopilotChatAssistantMessage.MarkdownRenderer";Gl.Toolbar.displayName="CopilotChatAssistantMessage.Toolbar";Gl.CopyButton.displayName="CopilotChatAssistantMessage.CopyButton";Gl.ThumbsUpButton.displayName="CopilotChatAssistantMessage.ThumbsUpButton";Gl.ThumbsDownButton.displayName="CopilotChatAssistantMessage.ThumbsDownButton";Gl.ReadAloudButton.displayName="CopilotChatAssistantMessage.ReadAloudButton";Gl.RegenerateButton.displayName="CopilotChatAssistantMessage.RegenerateButton";var wLe=Gl;function TLe(e){return e?typeof e=="string"?e:e.map(t=>t&&typeof t=="object"&&"type"in t&&t.type==="text"&&typeof t.text=="string"?t.text:"").filter(t=>t.length>0).join(`
`):""}function Pu({message:e,onEditMessage:t,branchIndex:n,numberOfBranches:r,onSwitchToBranch:a,additionalToolbarItems:l,messageRenderer:f,toolbar:i,copyButton:y,editButton:x,branchNavigation:S,children:C,className:P,...L}){const F=B.useMemo(()=>TLe(e.content),[e.content]),U=Ys(f,Pu.MessageRenderer,{content:F}),q=Ys(y,Pu.CopyButton,{onClick:async()=>{if(F)try{await navigator.clipboard.writeText(F)}catch(de){console.error("Failed to copy message:",de)}}}),G=Ys(x,Pu.EditButton,{onClick:()=>t==null?void 0:t({message:e})}),$=Ys(S,Pu.BranchNavigation,{currentBranch:n,numberOfBranches:r,onSwitchToBranch:a,message:e}),X=r&&r>1&&a,ie=Ys(i,Pu.Toolbar,{children:k.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[l,q,t&&G,X&&$]})});return C?k.jsx(k.Fragment,{children:C({messageRenderer:U,toolbar:ie,copyButton:q,editButton:G,branchNavigation:$,message:e,branchIndex:n,numberOfBranches:r,additionalToolbarItems:l})}):k.jsxs("div",{className:vo("flex flex-col items-end group pt-10",P),"data-message-id":e.id,...L,children:[U,ie]})}(e=>{e.Container=({children:t,className:n,...r})=>k.jsx("div",{className:vo("flex flex-col items-end group",n),...r,children:t}),e.MessageRenderer=({content:t,className:n})=>k.jsx("div",{className:vo("prose dark:prose-invert bg-muted relative max-w-[80%] rounded-[18px] px-4 py-1.5 data-[multiline]:py-3 inline-block whitespace-pre-wrap",n),children:t}),e.Toolbar=({className:t,...n})=>k.jsx("div",{className:vo("w-full bg-transparent flex items-center justify-end -mr-[5px] mt-[4px] invisible group-hover:visible",t),...n}),e.ToolbarButton=({title:t,children:n,className:r,...a})=>k.jsxs(nk,{children:[k.jsx(rk,{asChild:!0,children:k.jsx(g0,{type:"button",variant:"assistantMessageToolbarButton","aria-label":t,className:vo(r),...a,children:n})}),k.jsx(ik,{side:"bottom",children:k.jsx("p",{children:t})})]}),e.CopyButton=({className:t,title:n,onClick:r,...a})=>{const l=ml(),f=(l==null?void 0:l.labels)??Mu,[i,y]=B.useState(!1),x=S=>{y(!0),setTimeout(()=>y(!1),2e3),r&&r(S)};return k.jsx(e.ToolbarButton,{title:n||f.userMessageToolbarCopyMessageLabel,onClick:x,className:t,...a,children:i?k.jsx(iD,{className:"size-[18px]"}):k.jsx(hK,{className:"size-[18px]"})})},e.EditButton=({className:t,title:n,...r})=>{const a=ml(),l=(a==null?void 0:a.labels)??Mu;return k.jsx(e.ToolbarButton,{title:n||l.userMessageToolbarEditMessageLabel,className:t,...r,children:k.jsx(X_e,{className:"size-[18px]"})})},e.BranchNavigation=({className:t,currentBranch:n=0,numberOfBranches:r=1,onSwitchToBranch:a,message:l,...f})=>{if(!r||r<=1||!a)return null;const i=n>0,y=n<r-1;return k.jsxs("div",{className:vo("flex items-center gap-1",t),...f,children:[k.jsx(g0,{type:"button",variant:"assistantMessageToolbarButton",onClick:()=>a==null?void 0:a({branchIndex:n-1,numberOfBranches:r,message:l}),disabled:!i,className:"h-6 w-6 p-0",children:k.jsx(D_e,{className:"size-[20px]"})}),k.jsxs("span",{className:"text-sm text-muted-foreground px-0 font-medium",children:[n+1,"/",r]}),k.jsx(g0,{type:"button",variant:"assistantMessageToolbarButton",onClick:()=>a==null?void 0:a({branchIndex:n+1,numberOfBranches:r,message:l}),disabled:!y,className:"h-6 w-6 p-0",children:k.jsx(dK,{className:"size-[20px]"})})]})}})(Pu||(Pu={}));Pu.Container.displayName="CopilotChatUserMessage.Container";Pu.MessageRenderer.displayName="CopilotChatUserMessage.MessageRenderer";Pu.Toolbar.displayName="CopilotChatUserMessage.Toolbar";Pu.ToolbarButton.displayName="CopilotChatUserMessage.ToolbarButton";Pu.CopyButton.displayName="CopilotChatUserMessage.CopyButton";Pu.EditButton.displayName="CopilotChatUserMessage.EditButton";Pu.BranchNavigation.displayName="CopilotChatUserMessage.BranchNavigation";var ELe=Pu,SLe="group inline-flex h-7 sm:h-8 items-center gap-1 sm:gap-1.5 rounded-full border border-border/60 bg-background px-2.5 sm:px-3 text-[11px] sm:text-xs leading-none text-foreground transition-colors cursor-pointer hover:bg-accent/60 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:text-muted-foreground disabled:hover:bg-background disabled:hover:text-muted-foreground pointer-events-auto",ALe="whitespace-nowrap font-medium leading-none",Ure=cs.forwardRef(function({className:t,children:n,icon:r,isLoading:a,type:l,...f},i){const y=!a&&r;return k.jsxs("button",{ref:i,"data-slot":"suggestion-pill",className:el(SLe,t),type:l??"button","aria-busy":a||void 0,disabled:a||f.disabled,...f,children:[a?k.jsx("span",{className:"flex h-3.5 sm:h-4 w-3.5 sm:w-4 items-center justify-center text-muted-foreground",children:k.jsx(B_e,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 animate-spin","aria-hidden":"true"})}):y&&k.jsx("span",{className:"flex h-3.5 sm:h-4 w-3.5 sm:w-4 items-center justify-center text-muted-foreground",children:r}),k.jsx("span",{className:ALe,children:n})]})});Ure.displayName="CopilotChatSuggestionPill";var NG=Ure,CLe=cs.forwardRef(function({className:t,...n},r){return k.jsx("div",{ref:r,className:el("flex flex-wrap items-center gap-1.5 sm:gap-2 pl-0 pr-4 sm:px-0 pointer-events-none",t),...n})}),Vre=cs.forwardRef(function({suggestions:t,onSelectSuggestion:n,loadingIndexes:r,container:a,suggestion:l,className:f,children:i,...y},x){var F,U;const S=cs.useMemo(()=>!r||r.length===0?new Set:new Set(r),[r]),C=Ys(a,CLe,{ref:x,className:f,...y}),P=t.map((q,G)=>{const $=S.has(G)||q.isLoading===!0,X=Ys(l,NG,{children:q.title,isLoading:$,type:"button",onClick:()=>n==null?void 0:n(q,G)});return cs.cloneElement(X,{key:`${q.title}-${G}`})}),L=cs.cloneElement(C,void 0,P);if(typeof i=="function"){const q=Ys(l,NG,{children:((F=t[0])==null?void 0:F.title)??"",isLoading:t.length>0?S.has(0)||((U=t[0])==null?void 0:U.isLoading)===!0:!1,type:"button"});return k.jsx(k.Fragment,{children:i({container:L,suggestion:q,suggestions:t,onSelectSuggestion:n,loadingIndexes:r,className:f,...y})})}return i?k.jsxs(k.Fragment,{children:[L,i]}):L});Vre.displayName="CopilotChatSuggestionView";var kLe=Vre,ILe=cs.memo(function({message:t,messages:n,isRunning:r,AssistantMessageComponent:a}){return k.jsx(a,{message:t,messages:n,isRunning:r})},(e,t)=>{var l;if(e.message.id!==t.message.id||e.message.content!==t.message.content)return!1;const n=e.message.toolCalls,r=t.message.toolCalls;if((n==null?void 0:n.length)!==(r==null?void 0:r.length))return!1;if(n&&r)for(let f=0;f<n.length;f++){const i=n[f],y=r[f];if(!i||!y||i.id!==y.id||i.function.arguments!==y.function.arguments)return!1}if(n&&n.length>0){const f=new Set(n.map(x=>x.id)),i=e.messages.filter(x=>x.role==="tool"&&f.has(x.toolCallId)),y=t.messages.filter(x=>x.role==="tool"&&f.has(x.toolCallId));if(i.length!==y.length)return!1;for(let x=0;x<i.length;x++)if(i[x].content!==y[x].content)return!1}return!(((l=t.messages[t.messages.length-1])==null?void 0:l.id)===t.message.id&&e.isRunning!==t.isRunning||e.AssistantMessageComponent!==t.AssistantMessageComponent)}),RLe=cs.memo(function({message:t,UserMessageComponent:n}){return k.jsx(n,{message:t})},(e,t)=>!(e.message.id!==t.message.id||e.message.content!==t.message.content||e.UserMessageComponent!==t.UserMessageComponent)),MLe=cs.memo(function({message:t,renderActivityMessage:n}){return n(t)},(e,t)=>!(e.message.id!==t.message.id||e.message.activityType!==t.message.activityType||JSON.stringify(e.message.content)!==JSON.stringify(t.message.content))),zG=cs.memo(function({message:t,position:n,renderCustomMessage:r}){return r({message:t,position:n})},(e,t)=>!(e.message.id!==t.message.id||e.position!==t.position||e.message.content!==t.message.content||e.message.role!==t.message.role));function DN({messages:e=[],assistantMessage:t,userMessage:n,cursor:r,isRunning:a=!1,children:l,className:f,...i}){const y=pLe(),x=mLe(),S=e.flatMap(C=>{const P=[];if(y&&P.push(k.jsx(zG,{message:C,position:"before",renderCustomMessage:y},`${C.id}-custom-before`)),C.role==="assistant"){const L=typeof t=="function"?t:wLe;P.push(k.jsx(ILe,{message:C,messages:e,isRunning:a,AssistantMessageComponent:L},C.id))}else if(C.role==="user"){const L=typeof n=="function"?n:ELe;P.push(k.jsx(RLe,{message:C,UserMessageComponent:L},C.id))}else C.role==="activity"&&P.push(k.jsx(MLe,{message:C,renderActivityMessage:x},C.id));return y&&P.push(k.jsx(zG,{message:C,position:"after",renderCustomMessage:y},`${C.id}-custom-after`)),P}).filter(Boolean);return l?l({messageElements:S,messages:e,isRunning:a}):k.jsxs("div",{className:vo("flex flex-col",f),...i,children:[S,a&&Ys(r,DN.Cursor,{})]})}DN.Cursor=function({className:t,...n}){return k.jsx("div",{className:vo("w-[11px] h-[11px] rounded-full bg-foreground animate-pulse-cursor ml-1",t),...n})};var PLe=DN;function OLe(){const[e,t]=B.useState({isKeyboardOpen:!1,keyboardHeight:0,availableHeight:typeof window<"u"?window.innerHeight:0,viewportHeight:typeof window<"u"?window.innerHeight:0});return B.useEffect(()=>{if(typeof window>"u")return;const n=window.visualViewport;if(!n)return;const r=()=>{const a=window.innerHeight,l=n.height,f=Math.max(0,a-l),i=f>150;t({isKeyboardOpen:i,keyboardHeight:f,availableHeight:l,viewportHeight:a})};return r(),n.addEventListener("resize",r),n.addEventListener("scroll",r),()=>{n.removeEventListener("resize",r),n.removeEventListener("scroll",r)}},[]),e}function hp({messageView:e,input:t,scrollView:n,scrollToBottomButton:r,feather:a,inputContainer:l,disclaimer:f,suggestionView:i,messages:y=[],autoScroll:x=!0,inputProps:S,isRunning:C=!1,suggestions:P,suggestionLoadingIndexes:L,onSelectSuggestion:F,children:U,className:q,...G}){const $=B.useRef(null),[X,ie]=B.useState(0),[de,fe]=B.useState(!1),be=B.useRef(null),{isKeyboardOpen:ve,keyboardHeight:Je,availableHeight:we}=OLe();B.useEffect(()=>{const Oe=$.current;if(!Oe)return;const gn=new ResizeObserver(wt=>{for(const Fe of wt){const jt=Fe.contentRect.height;ie(Tn=>jt!==Tn?(fe(!0),be.current&&clearTimeout(be.current),be.current=setTimeout(()=>{fe(!1)},250),jt):Tn)}});return gn.observe(Oe),ie(Oe.offsetHeight),()=>{gn.disconnect(),be.current&&clearTimeout(be.current)}},[]);const rt=Ys(e,PLe,{messages:y,isRunning:C}),He=Ys(t,lLe,S??{}),ft=Array.isArray(P)&&P.length>0,Ct=ft?Ys(i,kLe,{suggestions:P,loadingIndexes:L,onSelectSuggestion:F,className:"mb-3 lg:ml-4 lg:mr-4 ml-0 mr-0"}):null,Nt=Ys(a,hp.Feather,{}),Rt=Ys(n,hp.ScrollView,{autoScroll:x,scrollToBottomButton:r,inputContainerHeight:X,isResizing:de,children:k.jsx("div",{style:{paddingBottom:`${X+(ft?4:32)}px`},children:k.jsxs("div",{className:"max-w-3xl mx-auto",children:[rt,ft?k.jsx("div",{className:"pl-0 pr-4 sm:px-0 mt-4",children:Ct}):null]})})}),en=Ys(r,hp.ScrollToBottomButton,{}),nt=Ys(f,hp.Disclaimer,{}),pt=Ys(l,hp.InputContainer,{ref:$,keyboardHeight:ve?Je:0,children:k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"max-w-3xl mx-auto py-0 px-4 sm:px-0 [div[data-sidebar-chat]_&]:px-8 [div[data-popup-chat]_&]:px-6 pointer-events-auto",children:He}),nt]})});return U?U({messageView:rt,input:He,scrollView:Rt,scrollToBottomButton:en,feather:Nt,inputContainer:pt,disclaimer:nt,suggestionView:Ct??k.jsx(k.Fragment,{})}):k.jsxs("div",{className:vo("relative h-full",q),...G,children:[Rt,Nt,pt]})}(e=>{const t=({children:n,scrollToBottomButton:r,inputContainerHeight:a,isResizing:l})=>{const{isAtBottom:f,scrollToBottom:i}=Nre();return k.jsxs(k.Fragment,{children:[k.jsx(tk.Content,{className:"overflow-y-scroll overflow-x-hidden",children:k.jsx("div",{className:"px-4 sm:px-0 [div[data-sidebar-chat]_&]:px-8 [div[data-popup-chat]_&]:px-6",children:n})}),!f&&!l&&k.jsx("div",{className:"absolute inset-x-0 flex justify-center z-10 pointer-events-none",style:{bottom:`${a+16}px`},children:Ys(r,e.ScrollToBottomButton,{onClick:()=>i()})})]})};e.ScrollView=({children:n,autoScroll:r=!0,scrollToBottomButton:a,inputContainerHeight:l=0,isResizing:f=!1,className:i,...y})=>{const[x,S]=B.useState(!1),{scrollRef:C,contentRef:P,scrollToBottom:L}=Lre(),[F,U]=B.useState(!1);return B.useEffect(()=>{S(!0)},[]),B.useEffect(()=>{if(r)return;const q=C.current;if(!q)return;const G=()=>{const X=q.scrollHeight-q.scrollTop-q.clientHeight<10;U(!X)};G(),q.addEventListener("scroll",G);const $=new ResizeObserver(G);return $.observe(q),()=>{q.removeEventListener("scroll",G),$.disconnect()}},[C,r]),x?r?k.jsx(tk,{className:el("h-full max-h-full flex flex-col min-h-0 relative",i),resize:"smooth",initial:"smooth",...y,children:k.jsx(t,{scrollToBottomButton:a,inputContainerHeight:l,isResizing:f,children:n})}):k.jsxs("div",{ref:C,className:el("h-full max-h-full flex flex-col min-h-0 overflow-y-scroll overflow-x-hidden relative",i),...y,children:[k.jsx("div",{ref:P,className:"px-4 sm:px-0 [div[data-sidebar-chat]_&]:px-8 [div[data-popup-chat]_&]:px-6",children:n}),F&&!f&&k.jsx("div",{className:"absolute inset-x-0 flex justify-center z-10 pointer-events-none",style:{bottom:`${l+16}px`},children:Ys(a,e.ScrollToBottomButton,{onClick:()=>L()})})]}):k.jsx("div",{className:"h-full max-h-full flex flex-col min-h-0 overflow-y-scroll overflow-x-hidden",children:k.jsx("div",{className:"px-4 sm:px-0 [div[data-sidebar-chat]_&]:px-8 [div[data-popup-chat]_&]:px-6",children:n})})},e.ScrollToBottomButton=({className:n,...r})=>k.jsx(g0,{variant:"outline",size:"sm",className:vo("rounded-full w-10 h-10 p-0 pointer-events-auto","bg-white dark:bg-gray-900","shadow-lg border border-gray-200 dark:border-gray-700","hover:bg-gray-50 dark:hover:bg-gray-800","flex items-center justify-center cursor-pointer",n),...r,children:k.jsx(O_e,{className:"w-4 h-4 text-gray-600 dark:text-white"})}),e.Feather=({className:n,style:r,...a})=>k.jsx("div",{className:el("absolute bottom-0 left-0 right-4 h-24 pointer-events-none z-10 bg-gradient-to-t","from-white via-white to-transparent","dark:from-[rgb(33,33,33)] dark:via-[rgb(33,33,33)]",n),style:r,...a}),e.InputContainer=cs.forwardRef(({children:n,className:r,keyboardHeight:a=0,...l},f)=>k.jsx("div",{ref:f,className:el("absolute bottom-0 left-0 right-0 z-20 pointer-events-none",r),style:{transform:a>0?`translateY(-${a}px)`:void 0,transition:"transform 0.2s ease-out"},...l,children:n})),e.InputContainer.displayName="CopilotChatView.InputContainer",e.Disclaimer=({className:n,...r})=>{const a=ml(),l=(a==null?void 0:a.labels)??Mu;return k.jsx("div",{className:el("text-center text-xs text-muted-foreground py-3 px-4 max-w-3xl mx-auto",n),...r,children:l.chatDisclaimerText})}})(hp||(hp={}));function FG({agentId:e,threadId:t,labels:n,chatView:r,isModalDefaultOpen:a,...l}){const f=ml(),i=e??(f==null?void 0:f.agentId)??Ix,y=B.useMemo(()=>t??(f==null?void 0:f.threadId)??gf(),[t,f==null?void 0:f.threadId]),{agent:x}=LN({agentId:i}),{copilotkit:S}=Sh(),{suggestions:C}=vLe({agentId:i}),{inputProps:P,messageView:L,suggestionView:F,...U}=l;B.useEffect(()=>{const rt=async He=>{try{await S.connectAgent({agent:He})}catch(ft){if(!(ft instanceof YP))throw ft}};return x.threadId=y,rt(x),()=>{}},[y,x,S,i]);const q=B.useCallback(async rt=>{x.addMessage({id:gf(),role:"user",content:rt});try{await S.runAgent({agent:x})}catch(He){console.error("CopilotChat: runAgent failed",He)}},[x,S]),G=B.useCallback(async rt=>{x.addMessage({id:gf(),role:"user",content:rt.message});try{await S.runAgent({agent:x})}catch(He){console.error("CopilotChat: runAgent failed after selecting suggestion",He)}},[x,S]),$=B.useCallback(()=>{try{S.stopAgent({agent:x})}catch(rt){console.error("CopilotChat: stopAgent failed",rt);try{x.abortRun()}catch(He){console.error("CopilotChat: abortRun fallback failed",He)}}},[x,S]),X=gd({isRunning:x.isRunning,suggestions:C,onSelectSuggestion:G,suggestionView:F},{...U,...typeof L=="string"?{messageView:{className:L}}:L!==void 0?{messageView:L}:{}}),ie=P==null?void 0:P.onStop,de=x.messages.length>0,be=x.isRunning&&de?ie??$:ie,ve={...P,onSubmitMessage:q,onStop:be,isRunning:x.isRunning};ve.mode=x.isRunning?"processing":ve.mode??"input";const Je=gd(X,{messages:x.messages,inputProps:ve}),we=Ys(r,hp,Je);return k.jsx(zre,{agentId:i,threadId:y,labels:n,isModalDefaultOpen:a,children:we})}(e=>{e.View=hp})(FG||(FG={}));var $re=({className:e,...t})=>k.jsx(U_e,{className:el("h-6 w-6",e),strokeWidth:1.75,fill:"currentColor",...t}),Hre=({className:e,...t})=>k.jsx(sD,{className:el("h-6 w-6",e),strokeWidth:1.75,...t});$re.displayName="CopilotChatToggleButton.OpenIcon";Hre.displayName="CopilotChatToggleButton.CloseIcon";var BG=Object.freeze({transition:"opacity 120ms ease-out, transform 260ms cubic-bezier(0.22, 1, 0.36, 1)"}),jG="pointer-events-none absolute inset-0 flex items-center justify-center will-change-transform",LLe=el("fixed bottom-6 right-6 z-[1100] flex h-14 w-14 items-center justify-center","rounded-full border border-primary bg-primary text-primary-foreground","shadow-sm transition-all duration-200 ease-out","hover:scale-[1.04] hover:shadow-md","cursor-pointer","active:scale-[0.96]","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 focus-visible:ring-offset-2 focus-visible:ring-offset-background","disabled:pointer-events-none disabled:opacity-60"),DLe=cs.forwardRef(function({openIcon:t,closeIcon:n,className:r,...a},l){const{onClick:f,type:i,disabled:y,...x}=a,S=ml(),C=(S==null?void 0:S.labels)??Mu,[P,L]=B.useState(!1),F=(S==null?void 0:S.isModalOpen)??P,U=(S==null?void 0:S.setModalOpen)??L,q=de=>{if(y||(f&&f(de),de.defaultPrevented))return;U(!F)},G=Ys(t,$re,{className:"h-6 w-6","aria-hidden":!0,focusable:!1}),$=Ys(n,Hre,{className:"h-6 w-6","aria-hidden":!0,focusable:!1}),X=k.jsx("span",{"aria-hidden":"true","data-slot":"chat-toggle-button-open-icon",className:jG,style:{...BG,opacity:F?0:1,transform:`scale(${F?.75:1}) rotate(${F?90:0}deg)`},children:G}),ie=k.jsx("span",{"aria-hidden":"true","data-slot":"chat-toggle-button-close-icon",className:jG,style:{...BG,opacity:F?1:0,transform:`scale(${F?1:.75}) rotate(${F?0:-90}deg)`},children:$});return k.jsxs("button",{ref:l,type:i??"button","data-slot":"chat-toggle-button","data-state":F?"open":"closed",className:el(LLe,r),"aria-label":F?C.chatToggleCloseLabel:C.chatToggleOpenLabel,"aria-pressed":F,disabled:y,onClick:q,...x,children:[X,ie]})});DLe.displayName="CopilotChatToggleButton";function N_({title:e,titleContent:t,closeButton:n,children:r,className:a,...l}){const f=ml(),i=(f==null?void 0:f.labels.modalHeaderTitle)??Mu.modalHeaderTitle,y=e??i,x=B.useCallback(()=>{f==null||f.setModalOpen(!1)},[f]),S=Ys(t,N_.Title,{children:y}),C=Ys(n,N_.CloseButton,{onClick:x});return r?r({titleContent:S,closeButton:C,title:y,...l}):k.jsx("header",{"data-slot":"copilot-modal-header",className:el("flex items-center justify-between border-b border-border px-4 py-4","bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/80",a),...l,children:k.jsxs("div",{className:"flex w-full items-center gap-2",children:[k.jsx("div",{className:"flex-1","aria-hidden":"true"}),k.jsx("div",{className:"flex flex-1 justify-center text-center",children:S}),k.jsx("div",{className:"flex flex-1 justify-end",children:C})]})})}N_.displayName="CopilotModalHeader";(e=>{e.Title=({children:t,className:n,...r})=>k.jsx("div",{className:el("w-full text-base font-medium leading-none tracking-tight text-foreground",n),...r,children:t}),e.CloseButton=({className:t,...n})=>k.jsx("button",{type:"button",className:el("inline-flex size-8 items-center justify-center rounded-full text-muted-foreground transition cursor-pointer","hover:bg-muted hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",t),"aria-label":"Close",...n,children:k.jsx(sD,{className:"h-4 w-4","aria-hidden":"true"})})})(N_||(N_={}));N_.Title.displayName="CopilotModalHeader.Title";N_.CloseButton.displayName="CopilotModalHeader.CloseButton";function O8(e){const t=e.name==="*"&&!e.args?Ore():e.args;return{name:e.name,args:t,render:e.render,...e.agentId?{agentId:e.agentId}:{}}}O8({name:"*",render:({args:e,result:t,name:n,status:r})=>{const[a,l]=B.useState(!1),f=String(r),x=f==="inProgress"||f==="executing"?"bg-amber-100 text-amber-800 dark:bg-amber-500/15 dark:text-amber-400":f==="complete"?"bg-emerald-100 text-emerald-800 dark:bg-emerald-500/15 dark:text-emerald-400":"bg-zinc-100 text-zinc-800 dark:bg-zinc-700/40 dark:text-zinc-300";return k.jsx("div",{className:"mt-2 pb-2",children:k.jsxs("div",{className:"rounded-xl border border-zinc-200/60 dark:border-zinc-800/60 bg-white/70 dark:bg-zinc-900/50 shadow-sm backdrop-blur p-4",children:[k.jsxs("div",{className:"flex items-center justify-between gap-3 cursor-pointer",onClick:()=>l(!a),children:[k.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[k.jsx("svg",{className:`h-4 w-4 text-zinc-500 dark:text-zinc-400 transition-transform ${a?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",children:k.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})}),k.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-blue-500"}),k.jsx("span",{className:"truncate text-sm font-medium text-zinc-900 dark:text-zinc-100",children:n})]}),k.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${x}`,children:String(r)})]}),a&&k.jsxs("div",{className:"mt-3 grid gap-4",children:[k.jsxs("div",{children:[k.jsx("div",{className:"text-xs uppercase tracking-wide text-zinc-500 dark:text-zinc-400",children:"Arguments"}),k.jsx("pre",{className:"mt-2 max-h-64 overflow-auto rounded-md bg-zinc-50 dark:bg-zinc-800/60 p-3 text-xs leading-relaxed text-zinc-800 dark:text-zinc-200 whitespace-pre-wrap break-words",children:JSON.stringify(e??{},null,2)})]}),t!==void 0&&k.jsxs("div",{children:[k.jsx("div",{className:"text-xs uppercase tracking-wide text-zinc-500 dark:text-zinc-400",children:"Result"}),k.jsx("pre",{className:"mt-2 max-h-64 overflow-auto rounded-md bg-zinc-50 dark:bg-zinc-800/60 p-3 text-xs leading-relaxed text-zinc-800 dark:text-zinc-200 whitespace-pre-wrap break-words",children:typeof t=="string"?t:JSON.stringify(t,null,2)})]})]})]})})}});function UG(e){if(!e)return{};const t=e,{messages:n,tools:r,copilotkit:a}=t;return gp(t,["messages","tools","copilotkit"])}function NLe(e,t){if(e&&!t||!e&&t)return!1;const n=e,{messages:r,tools:a,copilotkit:l}=n,f=gp(n,["messages","tools","copilotkit"]),i=t,{messages:y,tools:x,copilotkit:S}=i,C=gp(i,["messages","tools","copilotkit"]);return JSON.stringify(f)===JSON.stringify(C)}function zLe(e,t){var n;const{stateSnapshot:r,messageIndexInRun:a,message:l}=t,{coAgentStateRenders:f,claimsRef:i}=spe(),{agent:y}=LN({agentId:e}),[x,S]=B.useState(void 0),P=((n=t.runId)!=null?n:l.runId)||"pending";B.useEffect(()=>{if(!y)return;const U={onStepStartedEvent:({event:G})=>{G.stepName!==x&&S(G.stepName)},onStepFinishedEvent:({event:G})=>{G.stepName===x&&S(void 0)}},{unsubscribe:q}=y.subscribe(U);return()=>{q()}},[e,x]);const L=B.useCallback(U=>Object.entries(f).find(([q,G])=>{if(i.current[U])return q===i.current[U].stateRenderId;const $=G.name===e,X=G.nodeName?G.nodeName===x:!0;return $&&X}),[f,x,e]),F=({stateRenderId:U,messageId:q,runId:G,stateSnapshot:$})=>{if(i.current[q]){const ie=i.current[q].stateRenderId===U;return ie&&G&&(!i.current[q].runId||i.current[q].runId==="pending")&&(i.current[q].runId=G),ie}const X=Object.values(i.current).find(ie=>ie.stateRenderId===U&&Dj(UG(ie.stateSnapshot))===Dj(UG($)));return X?$&&X.stateSnapshot&&!NLe(X.stateSnapshot,$)?(i.current[q]={stateRenderId:U,runId:G},!0):!1:(i.current[q]={stateRenderId:U,runId:G},!0)};return B.useMemo(()=>{var U,q,G;if(a!==0)return null;const[$,X]=(U=L(l.id))!=null?U:[];if(!X||!$)return null;const ie=r?w_(r,r):y==null?void 0:y.state;if(!F({stateRenderId:$,messageId:l.id,runId:P,stateSnapshot:ie}))return null;if(ie&&!i.current[l.id].locked&&(r?(i.current[l.id].stateSnapshot=ie,i.current[l.id].locked=!0):i.current[l.id].stateSnapshot=ie),X.handler&&X.handler({state:r?w_(r,r):(q=y==null?void 0:y.state)!=null?q:{},nodeName:x??""}),X.render){const fe=y!=null&&y.isRunning?"inProgress":"complete";return typeof X.render=="string"?X.render:X.render({status:fe,state:(G=i.current[l.id].stateSnapshot)!=null?G:{},nodeName:x??""})}},[L,r,y==null?void 0:y.state,y==null?void 0:y.isRunning,x,P,l.id,a])}function FLe(e){return zLe(e.agentId,e)}var Gre=B.createContext(void 0);function BLe({children:e,threadId:t}){const[n,r]=B.useState(t??wX()),a=n;return k.jsx(Gre.Provider,{value:{threadId:a,setThreadId:r},children:e})}function jLe(){const e=B.useContext(Gre);if(!e)throw new Error("useThreads must be used within ThreadsProvider");return e}var ULe=e=>{const t=B.useRef([]),n=B.useCallback(r=>({onCustomEvent:({event:a})=>{a.name==="PredictState"&&(t.current=a.value)},onToolCallArgsEvent:({partialToolCallArgs:a,toolCallName:l})=>{t.current.forEach(f=>{if((f==null?void 0:f.tool)!==l)return;const i=typeof a=="string"?w_(a,a):a;r.setState({[f.state_key]:i[f.state_key]})})}}),[]);B.useEffect(()=>{if(!e)return;const r=n(e),{unsubscribe:a}=e.subscribe(r);return()=>{a()}},[e,n])};function VLe(){const{copilotkit:e}=Sh(),t=ml(),n=t==null?void 0:t.agentId,{setBannerError:r}=MX(),{agent:a}=LN({agentId:n});return ULe(a),B.useEffect(()=>{const l={onError:({error:i})=>{r(new Ihe({error:i,message:i.message}))}},f=e.subscribe(l);return()=>{f.unsubscribe()}},[e==null?void 0:e.subscribe]),null}function $Le(e){var t=e,{children:n}=t,r=gp(t,["children"]);const a=mT(r.showDevConsole),l=mT(r.enableInspector),f=r.publicApiKey||r.publicLicenseKey,i=B.useMemo(()=>[{render:FLe}],[]);return k.jsx(zfe,{enabled:a,children:k.jsx(Vfe,{publicApiKey:f,showUsageBanner:a,children:k.jsx(BLe,{threadId:r.threadId,children:k.jsx(dLe,fl(Ua({},r),{showDevConsole:l,renderCustomMessages:i,useSingleEndpoint:!0,children:k.jsx(HLe,fl(Ua({},r),{children:n}))}))})})})}function HLe(e){var t;const n=e,{children:r}=n,a=gp(n,["children"]);ZLe(e);const l=a.publicLicenseKey||a.publicApiKey,f=a.runtimeUrl||Efe,[i,y]=B.useState({}),[x,S]=B.useState(new Map),C=B.useRef({actions:{},coAgentStateRenders:{}}),{addElement:P,removeElement:L,printTree:F,getAllElements:U}=Qfe(),[q,G]=B.useState(!1),[$,X]=B.useState(""),[ie,de]=B.useState({}),[fe,be]=B.useState({}),[ve,Je]=B.useState([]),{addElement:we,removeElement:rt,allElements:He}=tpe(),ft=B.useCallback((je,jn)=>{y(Ir=>fl(Ua({},Ir),{[je]:jn}))},[]),Ct=B.useCallback(je=>{y(jn=>{const Ir=Ua({},jn);return delete Ir[je],Ir})},[]),Nt=B.useCallback((je,jn)=>{const Ir=je.map(cn=>`${cn.name} (${cn.sourceApplication}):
${cn.getContents()}`).join(`

`),Gn=F(jn);return`${Ir}

${Gn}`},[F]),Rt=B.useCallback((je,jn,Ir=VG)=>P(je,Ir,jn),[P]),en=B.useCallback(je=>{L(je)},[L]),nt=B.useCallback(()=>U(),[U]),pt=B.useCallback(je=>GLe(Object.values(je||i)),[i]),Oe=B.useCallback(je=>He(je),[He]),gn=B.useCallback((je,jn=VG)=>we(je,jn),[we]),wt=B.useCallback(je=>{rt(je)},[rt]),Fe=B.useMemo(()=>{var je,jn;let Ir;return l&&(Ir={guardrails:{input:{restrictToTopic:{enabled:!!a.guardrails_c,validTopics:((je=a.guardrails_c)==null?void 0:je.validTopics)||[],invalidTopics:((jn=a.guardrails_c)==null?void 0:jn.invalidTopics)||[]}}}}),fl(Ua({publicApiKey:l},Ir?{cloud:Ir}:{}),{chatApiEndpoint:f,headers:a.headers||{},properties:a.properties||{},transcribeAudioUrl:a.transcribeAudioUrl,textToSpeechUrl:a.textToSpeechUrl,credentials:a.credentials})},[l,a.headers,a.properties,a.transcribeAudioUrl,a.textToSpeechUrl,a.credentials,a.cloudRestrictToTopic,a.guardrails_c]);B.useMemo(()=>{const je=Object.values(ie||{}).reduce((jn,Ir)=>Ir.status==="authenticated"&&Ir.authHeaders?Ua(Ua({},jn),Object.entries(Ir.authHeaders).reduce((Gn,[cn,xr])=>fl(Ua({},Gn),{[cn.startsWith("X-Custom-")?cn:`X-Custom-${cn}`]:xr}),{})):jn,{});return Ua(Ua(Ua({},Fe.headers||{}),Fe.publicApiKey?{[EX]:Fe.publicApiKey}:{}),je)},[Fe.headers,Fe.publicApiKey,ie]);const[jt,Tn]=B.useState({}),mn=B.useCallback(je=>{Tn(jn=>Ua(Ua({},jn),je))},[]),zn=B.useCallback(je=>{Tn(jn=>{const Ir=jn,{[je]:Gn}=Ir;return gp(Ir,[V5(je)])})},[]),yn=B.useRef(a.onError);B.useEffect(()=>{yn.current=a.onError},[a.onError]);const qt=B.useRef({});B.useEffect(()=>{qt.current=jt},[jt]);const wn=B.useCallback(je=>nx(this,null,function*(){if(Fe.publicApiKey&&yn.current)try{yield yn.current(je)}catch(Ir){console.error("Error in public onError handler:",Ir)}const jn=Object.values(qt.current);yield Promise.all(jn.map(Ir=>Promise.resolve(Ir(je)).catch(Gn=>console.error("Error in internal error handler:",Gn))))}),[Fe.publicApiKey]),[Sn,Xn]=B.useState({}),rn=B.useCallback((je,jn)=>{Xn(Ir=>fl(Ua({},Ir),{[je]:jn}))},[Xn]),br=B.useCallback(je=>{Xn(jn=>{const Ir=jn,{[je]:Gn}=Ir;return gp(Ir,[V5(je)])})},[Xn]),[Qr,sr]=B.useState([]),[ar,Vn]=B.useState({}),wr=B.useRef({}),ys=B.useCallback(je=>{const jn=typeof je=="function"?je(wr.current):je;wr.current=jn,Vn(Ir=>jn)},[]);let Si=null;a.agent&&(Si={agentName:a.agent});const[Ri,ks]=B.useState(Si);B.useEffect(()=>{a.agent?ks({agentName:a.agent}):ks(null)},[a.agent]);const{threadId:$i,setThreadId:Ws}=jLe(),Kt=B.useCallback(je=>{if(a.threadId)throw new Error("Cannot call setThreadId() when threadId is provided via props.");Ws(je)},[a.threadId]),[An,Lr]=B.useState(null),Tt=B.useRef(null),kn=mT(a.showDevConsole),[nr,dt]=B.useState({}),Qn=B.useCallback(je=>{dt(jn=>{var Ir;return je==null||!je.id?jn:fl(Ua({},jn),{[je.id]:Ua(Ua({},(Ir=jn[je.id])!=null?Ir:{}),je)})})},[]),ti=B.useCallback(je=>{dt(jn=>{const Ir=jn,{[je]:Gn}=Ir;return gp(Ir,[V5(je)])})},[]),[Zi,Is]=B.useState({}),Ln=B.useCallback(je=>{Is(jn=>{const Ir=jn[je.threadId]||[];return fl(Ua({},jn),{[je.threadId]:[...Ir,je]})})},[]),Hn=B.useCallback((je,jn,Ir)=>{Is(Gn=>{const cn=Gn[je]||[];return fl(Ua({},Gn),{[je]:cn.map(xr=>xr.eventId===jn?fl(Ua({},xr),{event:fl(Ua({},xr.event),{response:Ir})}):xr)})})},[]),Ke=B.useMemo(()=>r,[r]),[sn,bn]=B.useState(null),kr=B.useMemo(()=>{var je;return(je=a.agent)!=null?je:null},[a.agent]),In=B.useMemo(()=>{var je;return(je=a.forwardedParameters)!=null?je:{}},[a.forwardedParameters]),Ki=B.useCallback(je=>{be(jn=>{const Ir=typeof je=="function"?je(jn):je;return Object.keys(Ir).length===Object.keys(jn).length&&Object.entries(Ir).every(([xr,Qs])=>jn[xr]===Qs)?jn:Ir})},[be]),Ta=B.useCallback(je=>{de(jn=>{const Ir=typeof je=="function"?je(jn):je;return Object.keys(Ir).length===Object.keys(jn).length&&Object.entries(Ir).every(([xr,Qs])=>jn[xr]===Qs)?jn:Ir})},[de]),Ns=B.useCallback(je=>{const jn=je.action.name||wX();return S(Ir=>{const Gn=new Map(Ir);return Gn.set(jn,je),Gn}),jn},[]),Ht=B.useCallback(je=>{S(jn=>{const Ir=new Map(jn);return Ir.delete(je),Ir})},[]),Dn=B.useMemo(()=>()=>k.jsx(k.Fragment,{children:Array.from(x.entries()).map(([je,jn])=>{const Ir=jn.component;return k.jsx(Ir,{action:jn.action},je)})}),[x]);return k.jsx(zre,{agentId:(t=a.agent)!=null?t:"default",threadId:$i,children:k.jsxs(FX.Provider,{value:{actions:i,chatComponentsCache:C,getFunctionCallHandler:pt,setAction:ft,removeAction:Ct,setRegisteredActions:Ns,removeRegisteredAction:Ht,getContextString:Nt,addContext:Rt,removeContext:en,getAllContext:nt,getDocumentsContext:Oe,addDocumentContext:gn,removeDocumentContext:wt,copilotApiConfig:Fe,isLoading:q,setIsLoading:G,chatSuggestionConfiguration:Sn,addChatSuggestionConfiguration:rn,removeChatSuggestionConfiguration:br,chatInstructions:$,setChatInstructions:X,additionalInstructions:ve,setAdditionalInstructions:Je,showDevConsole:kn,coagentStates:ar,setCoagentStates:Vn,coagentStatesRef:wr,setCoagentStatesWithRef:ys,agentSession:Ri,setAgentSession:ks,forwardedParameters:In,agentLock:kr,threadId:$i,setThreadId:Kt,runId:An,setRunId:Lr,chatAbortControllerRef:Tt,availableAgents:Qr,authConfig_c:a.authConfig_c,authStates_c:ie,setAuthStates_c:Ta,extensions:fe,setExtensions:Ki,interruptActions:nr,setInterruptAction:Qn,removeInterruptAction:ti,interruptEventQueue:Zi,addInterruptEvent:Ln,resolveInterruptEvent:Hn,bannerError:sn,setBannerError:bn,onError:wn,internalErrorHandlers:jt,setInternalErrorHandler:mn,removeInternalErrorHandler:zn},children:[k.jsx(VLe,{}),k.jsxs(ipe,{children:[k.jsx(Wfe,{children:k.jsxs(Xfe,{children:[Ke,k.jsx(Dn,{})]})}),sn&&kn&&k.jsx(DX,{severity:sn.severity,message:sn.message,onClose:()=>bn(null),actions:NX(sn)})]})]})})}var VG=["global"];function GLe(e){return t=>nx(this,[t],function*({name:n,args:r}){let a={};for(let i of e)a[i.name]=i;const l=a[n];let f;return l&&(yield new Promise((i,y)=>{WT.flushSync(()=>nx(this,null,function*(){var x;try{f=yield(x=l.handler)==null?void 0:x.call(l,r),i()}catch(S){y(S)}}))}),yield new Promise(i=>setTimeout(i,20))),f})}function qLe(e){return e.replace(/_c$/,"").split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" ")}function ZLe(e){const t=Object.keys(e).filter(r=>r.endsWith("_c")),n=e.publicApiKey||e.publicLicenseKey;if(!e.runtimeUrl&&!n)throw new uX("Missing required prop: 'runtimeUrl' or 'publicApiKey' or 'publicLicenseKey'");if(t.length>0&&!n)throw new Rhe(`Missing required prop: 'publicApiKey' or 'publicLicenseKey' to use cloud features: ${t.map(qLe).join(", ")}`)}function WLe(e,t){const{copilotkit:n}=Sh(),r=B.useRef(!1);B.useEffect(()=>{const{name:a,parameters:l,render:f}=e,i=HL(l),y=O8(a==="*"?{name:"*",render:S=>f(fl(Ua({},S),{result:S.result?w_(S.result,S.result):S.result}))}:{name:a,args:i,render:S=>f(fl(Ua({},S),{result:S.result?w_(S.result,S.result):S.result}))}),x=n.renderToolCalls.findIndex(S=>S.name===a);return x!==-1&&n.renderToolCalls.splice(x,1),n.renderToolCalls.push(y),r.current=!0,()=>{if(r.current){const S=n.renderToolCalls.findIndex(C=>C.name===a);S!==-1&&n.renderToolCalls.splice(S,1),r.current=!1}}},[e])}function XLe(e,t){const{name:n,description:r,parameters:a,render:l,followUp:f}=e,i=HL(a),y=(()=>{if(!(typeof l>"u")){if(typeof l=="string"){const C=l;return()=>cs.createElement(cs.Fragment,null,C)}return C=>{const P=fl(Ua({},C),{result:typeof C.result=="string"?w_(C.result,C.result):C.result}),L=l(P);return typeof L=="string"?cs.createElement(cs.Fragment,null,L):L??null}}})(),x=B.useRef(e.handler);B.useEffect(()=>{x.current=e.handler},[e.handler]);const S=e.handler?C=>{var P;return(P=x.current)==null?void 0:P.call(x,C)}:void 0;jre({name:n,description:r,parameters:i,handler:S,followUp:f,render:y})}function YLe(e,t){const n=e,{render:r}=n,a=gp(n,["render"]),{name:l,description:f,parameters:i,followUp:y}=a,x=HL(i),S=B.useRef(null);B.useEffect(()=>{S.current=C=>{if(typeof r=="string")return cs.createElement(cs.Fragment,null,r);if(!r)return null;const P=(()=>{const F=C.args;switch(C.status){case f_.InProgress:return{args:F,respond:C.respond,status:C.status,handler:void 0};case f_.Executing:return{args:F,respond:C.respond,status:C.status,handler:()=>{}};case f_.Complete:return{args:F,respond:C.respond,status:C.status,result:C.result?w_(C.result,C.result):C.result,handler:void 0};default:throw new vp({code:Yv.UNKNOWN,message:`Invalid tool call status: ${C.status}`})}})(),L=r(P);return typeof L=="string"?cs.createElement(cs.Fragment,null,L):L??null}},[r]),_Le({name:l,description:f,followUp:y,parameters:x,render:C=>{var P,L;return(L=(P=S.current)==null?void 0:P.call(S,C))!=null?L:null}})}function $G(e){if(e.name==="*")return{type:"render",action:e};if("renderAndWaitForResponse"in e||"renderAndWait"in e){let t=e.render;return!t&&"renderAndWaitForResponse"in e&&(t=e.renderAndWaitForResponse),!t&&"renderAndWait"in e&&(t=e.renderAndWait),{type:"hitl",action:fl(Ua({},e),{render:t})}}if("available"in e){if(e.available==="enabled"||e.available==="remote")return{type:"frontend",action:e};if(e.available==="frontend"||e.available==="disabled")return{type:"render",action:e}}if("handler"in e)return{type:"frontend",action:e};throw new Error("Invalid action configuration")}function m4(e,t){const[n]=B.useState($G(e)),r=$G(e);if(n.type!==r.type)throw new Error("Action configuration changed between renders");switch(r.type){case"render":return WLe(r.action);case"hitl":return YLe(r.action);case"frontend":return XLe(r.action);default:throw new Error("Invalid action configuration")}}function KLe({description:e,value:t,convert:n,available:r},a){const{copilotkit:l}=Sh(),f=B.useRef(void 0);return B.useEffect(()=>{if(!l)return;const i=Object.entries(l.context).find(([y,x])=>JSON.stringify({description:e,value:t})==JSON.stringify(x));if(i){f.current=i[0],r==="disabled"&&l.removeContext(f.current);return}if(!(!i&&r==="disabled"))return f.current=l.addContext({description:e,value:(n??JSON.stringify)(t)}),()=>{f.current&&l.removeContext(f.current)}},[e,t,n]),f.current}function qre(e,t){return function(){return e.apply(t,arguments)}}const{toString:QLe}=Object.prototype,{getPrototypeOf:NN}=Object,{iterator:oI,toStringTag:Zre}=Symbol,lI=(e=>t=>{const n=QLe.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Ah=e=>(e=e.toLowerCase(),t=>lI(t)===e),uI=e=>t=>typeof t===e,{isArray:Gx}=Array,vx=uI("undefined");function yE(e){return e!==null&&!vx(e)&&e.constructor!==null&&!vx(e.constructor)&&uc(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Wre=Ah("ArrayBuffer");function JLe(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&Wre(e.buffer),t}const eDe=uI("string"),uc=uI("function"),Xre=uI("number"),vE=e=>e!==null&&typeof e=="object",tDe=e=>e===!0||e===!1,_A=e=>{if(lI(e)!=="object")return!1;const t=NN(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Zre in e)&&!(oI in e)},nDe=e=>{if(!vE(e)||yE(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},rDe=Ah("Date"),iDe=Ah("File"),sDe=Ah("Blob"),aDe=Ah("FileList"),oDe=e=>vE(e)&&uc(e.pipe),lDe=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||uc(e.append)&&((t=lI(e))==="formdata"||t==="object"&&uc(e.toString)&&e.toString()==="[object FormData]"))},uDe=Ah("URLSearchParams"),[cDe,dDe,hDe,fDe]=["ReadableStream","Request","Response","Headers"].map(Ah),pDe=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function xE(e,t,{allOwnKeys:n=!1}={}){if(e===null||typeof e>"u")return;let r,a;if(typeof e!="object"&&(e=[e]),Gx(e))for(r=0,a=e.length;r<a;r++)t.call(null,e[r],r,e);else{if(yE(e))return;const l=n?Object.getOwnPropertyNames(e):Object.keys(e),f=l.length;let i;for(r=0;r<f;r++)i=l[r],t.call(null,e[i],i,e)}}function Yre(e,t){if(yE(e))return null;t=t.toLowerCase();const n=Object.keys(e);let r=n.length,a;for(;r-- >0;)if(a=n[r],t===a.toLowerCase())return a;return null}const Qg=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Kre=e=>!vx(e)&&e!==Qg;function L8(){const{caseless:e,skipUndefined:t}=Kre(this)&&this||{},n={},r=(a,l)=>{const f=e&&Yre(n,l)||l;_A(n[f])&&_A(a)?n[f]=L8(n[f],a):_A(a)?n[f]=L8({},a):Gx(a)?n[f]=a.slice():(!t||!vx(a))&&(n[f]=a)};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&xE(arguments[a],r);return n}const mDe=(e,t,n,{allOwnKeys:r}={})=>(xE(t,(a,l)=>{n&&uc(a)?e[l]=qre(a,n):e[l]=a},{allOwnKeys:r}),e),gDe=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),_De=(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},yDe=(e,t,n,r)=>{let a,l,f;const i={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),l=a.length;l-- >0;)f=a[l],(!r||r(f,e,t))&&!i[f]&&(t[f]=e[f],i[f]=!0);e=n!==!1&&NN(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},vDe=(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},xDe=e=>{if(!e)return null;if(Gx(e))return e;let t=e.length;if(!Xre(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},bDe=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&NN(Uint8Array)),wDe=(e,t)=>{const r=(e&&e[oI]).call(e);let a;for(;(a=r.next())&&!a.done;){const l=a.value;t.call(e,l[0],l[1])}},TDe=(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},EDe=Ah("HTMLFormElement"),SDe=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,a){return r.toUpperCase()+a}),HG=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),ADe=Ah("RegExp"),Qre=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};xE(n,(a,l)=>{let f;(f=t(a,l,e))!==!1&&(r[l]=f||a)}),Object.defineProperties(e,r)},CDe=e=>{Qre(e,(t,n)=>{if(uc(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];if(uc(r)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},kDe=(e,t)=>{const n={},r=a=>{a.forEach(l=>{n[l]=!0})};return Gx(e)?r(e):r(String(e).split(t)),n},IDe=()=>{},RDe=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function MDe(e){return!!(e&&uc(e.append)&&e[Zre]==="FormData"&&e[oI])}const PDe=e=>{const t=new Array(10),n=(r,a)=>{if(vE(r)){if(t.indexOf(r)>=0)return;if(yE(r))return r;if(!("toJSON"in r)){t[a]=r;const l=Gx(r)?[]:{};return xE(r,(f,i)=>{const y=n(f,a+1);!vx(y)&&(l[i]=y)}),t[a]=void 0,l}}return r};return n(e,0)},ODe=Ah("AsyncFunction"),LDe=e=>e&&(vE(e)||uc(e))&&uc(e.then)&&uc(e.catch),Jre=((e,t)=>e?setImmediate:t?((n,r)=>(Qg.addEventListener("message",({source:a,data:l})=>{a===Qg&&l===n&&r.length&&r.shift()()},!1),a=>{r.push(a),Qg.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",uc(Qg.postMessage)),DDe=typeof queueMicrotask<"u"?queueMicrotask.bind(Qg):typeof process<"u"&&process.nextTick||Jre,NDe=e=>e!=null&&uc(e[oI]),on={isArray:Gx,isArrayBuffer:Wre,isBuffer:yE,isFormData:lDe,isArrayBufferView:JLe,isString:eDe,isNumber:Xre,isBoolean:tDe,isObject:vE,isPlainObject:_A,isEmptyObject:nDe,isReadableStream:cDe,isRequest:dDe,isResponse:hDe,isHeaders:fDe,isUndefined:vx,isDate:rDe,isFile:iDe,isBlob:sDe,isRegExp:ADe,isFunction:uc,isStream:oDe,isURLSearchParams:uDe,isTypedArray:bDe,isFileList:aDe,forEach:xE,merge:L8,extend:mDe,trim:pDe,stripBOM:gDe,inherits:_De,toFlatObject:yDe,kindOf:lI,kindOfTest:Ah,endsWith:vDe,toArray:xDe,forEachEntry:wDe,matchAll:TDe,isHTMLForm:EDe,hasOwnProperty:HG,hasOwnProp:HG,reduceDescriptors:Qre,freezeMethods:CDe,toObjectSet:kDe,toCamelCase:SDe,noop:IDe,toFiniteNumber:RDe,findKey:Yre,global:Qg,isContextDefined:Kre,isSpecCompliantForm:MDe,toJSONObject:PDe,isAsyncFn:ODe,isThenable:LDe,setImmediate:Jre,asap:DDe,isIterable:NDe};function Ds(e,t,n,r,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),a&&(this.response=a,this.status=a.status?a.status:null)}on.inherits(Ds,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:on.toJSONObject(this.config),code:this.code,status:this.status}}});const eie=Ds.prototype,tie={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{tie[e]={value:e}});Object.defineProperties(Ds,tie);Object.defineProperty(eie,"isAxiosError",{value:!0});Ds.from=(e,t,n,r,a,l)=>{const f=Object.create(eie);on.toFlatObject(e,f,function(S){return S!==Error.prototype},x=>x!=="isAxiosError");const i=e&&e.message?e.message:"Error",y=t==null&&e?e.code:t;return Ds.call(f,i,y,n,r,a),e&&f.cause==null&&Object.defineProperty(f,"cause",{value:e,configurable:!0}),f.name=e&&e.name||"Error",l&&Object.assign(f,l),f};const zDe=null;function D8(e){return on.isPlainObject(e)||on.isArray(e)}function nie(e){return on.endsWith(e,"[]")?e.slice(0,-2):e}function GG(e,t,n){return e?e.concat(t).map(function(a,l){return a=nie(a),!n&&l?"["+a+"]":a}).join(n?".":""):t}function FDe(e){return on.isArray(e)&&!e.some(D8)}const BDe=on.toFlatObject(on,{},null,function(t){return/^is[A-Z]/.test(t)});function cI(e,t,n){if(!on.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=on.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(U,q){return!on.isUndefined(q[U])});const r=n.metaTokens,a=n.visitor||S,l=n.dots,f=n.indexes,y=(n.Blob||typeof Blob<"u"&&Blob)&&on.isSpecCompliantForm(t);if(!on.isFunction(a))throw new TypeError("visitor must be a function");function x(F){if(F===null)return"";if(on.isDate(F))return F.toISOString();if(on.isBoolean(F))return F.toString();if(!y&&on.isBlob(F))throw new Ds("Blob is not supported. Use a Buffer instead.");return on.isArrayBuffer(F)||on.isTypedArray(F)?y&&typeof Blob=="function"?new Blob([F]):Buffer.from(F):F}function S(F,U,q){let G=F;if(F&&!q&&typeof F=="object"){if(on.endsWith(U,"{}"))U=r?U:U.slice(0,-2),F=JSON.stringify(F);else if(on.isArray(F)&&FDe(F)||(on.isFileList(F)||on.endsWith(U,"[]"))&&(G=on.toArray(F)))return U=nie(U),G.forEach(function(X,ie){!(on.isUndefined(X)||X===null)&&t.append(f===!0?GG([U],ie,l):f===null?U:U+"[]",x(X))}),!1}return D8(F)?!0:(t.append(GG(q,U,l),x(F)),!1)}const C=[],P=Object.assign(BDe,{defaultVisitor:S,convertValue:x,isVisitable:D8});function L(F,U){if(!on.isUndefined(F)){if(C.indexOf(F)!==-1)throw Error("Circular reference detected in "+U.join("."));C.push(F),on.forEach(F,function(G,$){(!(on.isUndefined(G)||G===null)&&a.call(t,G,on.isString($)?$.trim():$,U,P))===!0&&L(G,U?U.concat($):[$])}),C.pop()}}if(!on.isObject(e))throw new TypeError("data must be an object");return L(e),t}function qG(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function zN(e,t){this._pairs=[],e&&cI(e,this,t)}const rie=zN.prototype;rie.append=function(t,n){this._pairs.push([t,n])};rie.toString=function(t){const n=t?function(r){return t.call(this,r,qG)}:qG;return this._pairs.map(function(a){return n(a[0])+"="+n(a[1])},"").join("&")};function jDe(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function iie(e,t,n){if(!t)return e;const r=n&&n.encode||jDe;on.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let l;if(a?l=a(t,n):l=on.isURLSearchParams(t)?t.toString():new zN(t,n).toString(r),l){const f=e.indexOf("#");f!==-1&&(e=e.slice(0,f)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}class ZG{constructor(){this.handlers=[]}use(t,n,r){return this.handlers.push({fulfilled:t,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){on.forEach(this.handlers,function(r){r!==null&&t(r)})}}const sie={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},UDe=typeof URLSearchParams<"u"?URLSearchParams:zN,VDe=typeof FormData<"u"?FormData:null,$De=typeof Blob<"u"?Blob:null,HDe={isBrowser:!0,classes:{URLSearchParams:UDe,FormData:VDe,Blob:$De},protocols:["http","https","file","blob","url","data"]},FN=typeof window<"u"&&typeof document<"u",N8=typeof navigator=="object"&&navigator||void 0,GDe=FN&&(!N8||["ReactNative","NativeScript","NS"].indexOf(N8.product)<0),qDe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ZDe=FN&&window.location.href||"http://localhost",WDe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:FN,hasStandardBrowserEnv:GDe,hasStandardBrowserWebWorkerEnv:qDe,navigator:N8,origin:ZDe},Symbol.toStringTag,{value:"Module"})),lu={...WDe,...HDe};function XDe(e,t){return cI(e,new lu.classes.URLSearchParams,{visitor:function(n,r,a,l){return lu.isNode&&on.isBuffer(n)?(this.append(r,n.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...t})}function YDe(e){return on.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function KDe(e){const t={},n=Object.keys(e);let r;const a=n.length;let l;for(r=0;r<a;r++)l=n[r],t[l]=e[l];return t}function aie(e){function t(n,r,a,l){let f=n[l++];if(f==="__proto__")return!0;const i=Number.isFinite(+f),y=l>=n.length;return f=!f&&on.isArray(a)?a.length:f,y?(on.hasOwnProp(a,f)?a[f]=[a[f],r]:a[f]=r,!i):((!a[f]||!on.isObject(a[f]))&&(a[f]=[]),t(n,r,a[f],l)&&on.isArray(a[f])&&(a[f]=KDe(a[f])),!i)}if(on.isFormData(e)&&on.isFunction(e.entries)){const n={};return on.forEachEntry(e,(r,a)=>{t(YDe(r),a,n,0)}),n}return null}function QDe(e,t,n){if(on.isString(e))try{return(t||JSON.parse)(e),on.trim(e)}catch(r){if(r.name!=="SyntaxError")throw r}return(n||JSON.stringify)(e)}const bE={transitional:sie,adapter:["xhr","http","fetch"],transformRequest:[function(t,n){const r=n.getContentType()||"",a=r.indexOf("application/json")>-1,l=on.isObject(t);if(l&&on.isHTMLForm(t)&&(t=new FormData(t)),on.isFormData(t))return a?JSON.stringify(aie(t)):t;if(on.isArrayBuffer(t)||on.isBuffer(t)||on.isStream(t)||on.isFile(t)||on.isBlob(t)||on.isReadableStream(t))return t;if(on.isArrayBufferView(t))return t.buffer;if(on.isURLSearchParams(t))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let i;if(l){if(r.indexOf("application/x-www-form-urlencoded")>-1)return XDe(t,this.formSerializer).toString();if((i=on.isFileList(t))||r.indexOf("multipart/form-data")>-1){const y=this.env&&this.env.FormData;return cI(i?{"files[]":t}:t,y&&new y,this.formSerializer)}}return l||a?(n.setContentType("application/json",!1),QDe(t)):t}],transformResponse:[function(t){const n=this.transitional||bE.transitional,r=n&&n.forcedJSONParsing,a=this.responseType==="json";if(on.isResponse(t)||on.isReadableStream(t))return t;if(t&&on.isString(t)&&(r&&!this.responseType||a)){const f=!(n&&n.silentJSONParsing)&&a;try{return JSON.parse(t,this.parseReviver)}catch(i){if(f)throw i.name==="SyntaxError"?Ds.from(i,Ds.ERR_BAD_RESPONSE,this,null,this.response):i}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:lu.classes.FormData,Blob:lu.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};on.forEach(["delete","get","head","post","put","patch"],e=>{bE.headers[e]={}});const JDe=on.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),eNe=e=>{const t={};let n,r,a;return e&&e.split(`
`).forEach(function(f){a=f.indexOf(":"),n=f.substring(0,a).trim().toLowerCase(),r=f.substring(a+1).trim(),!(!n||t[n]&&JDe[n])&&(n==="set-cookie"?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)}),t},WG=Symbol("internals");function r2(e){return e&&String(e).trim().toLowerCase()}function yA(e){return e===!1||e==null?e:on.isArray(e)?e.map(yA):String(e)}function tNe(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}const nNe=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function nM(e,t,n,r,a){if(on.isFunction(r))return r.call(this,t,n);if(a&&(t=n),!!on.isString(t)){if(on.isString(r))return t.indexOf(r)!==-1;if(on.isRegExp(r))return r.test(t)}}function rNe(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,n,r)=>n.toUpperCase()+r)}function iNe(e,t){const n=on.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+n,{value:function(a,l,f){return this[r].call(this,t,a,l,f)},configurable:!0})})}let cc=class{constructor(t){t&&this.set(t)}set(t,n,r){const a=this;function l(i,y,x){const S=r2(y);if(!S)throw new Error("header name must be a non-empty string");const C=on.findKey(a,S);(!C||a[C]===void 0||x===!0||x===void 0&&a[C]!==!1)&&(a[C||y]=yA(i))}const f=(i,y)=>on.forEach(i,(x,S)=>l(x,S,y));if(on.isPlainObject(t)||t instanceof this.constructor)f(t,n);else if(on.isString(t)&&(t=t.trim())&&!nNe(t))f(eNe(t),n);else if(on.isObject(t)&&on.isIterable(t)){let i={},y,x;for(const S of t){if(!on.isArray(S))throw TypeError("Object iterator must return a key-value pair");i[x=S[0]]=(y=i[x])?on.isArray(y)?[...y,S[1]]:[y,S[1]]:S[1]}f(i,n)}else t!=null&&l(n,t,r);return this}get(t,n){if(t=r2(t),t){const r=on.findKey(this,t);if(r){const a=this[r];if(!n)return a;if(n===!0)return tNe(a);if(on.isFunction(n))return n.call(this,a,r);if(on.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=r2(t),t){const r=on.findKey(this,t);return!!(r&&this[r]!==void 0&&(!n||nM(this,this[r],r,n)))}return!1}delete(t,n){const r=this;let a=!1;function l(f){if(f=r2(f),f){const i=on.findKey(r,f);i&&(!n||nM(r,r[i],i,n))&&(delete r[i],a=!0)}}return on.isArray(t)?t.forEach(l):l(t),a}clear(t){const n=Object.keys(this);let r=n.length,a=!1;for(;r--;){const l=n[r];(!t||nM(this,this[l],l,t,!0))&&(delete this[l],a=!0)}return a}normalize(t){const n=this,r={};return on.forEach(this,(a,l)=>{const f=on.findKey(r,l);if(f){n[f]=yA(a),delete n[l];return}const i=t?rNe(l):String(l).trim();i!==l&&delete n[l],n[i]=yA(a),r[i]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const n=Object.create(null);return on.forEach(this,(r,a)=>{r!=null&&r!==!1&&(n[a]=t&&on.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,n])=>t+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...n){const r=new this(t);return n.forEach(a=>r.set(a)),r}static accessor(t){const r=(this[WG]=this[WG]={accessors:{}}).accessors,a=this.prototype;function l(f){const i=r2(f);r[i]||(iNe(a,f),r[i]=!0)}return on.isArray(t)?t.forEach(l):l(t),this}};cc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);on.reduceDescriptors(cc.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(r){this[n]=r}}});on.freezeMethods(cc);function rM(e,t){const n=this||bE,r=t||n,a=cc.from(r.headers);let l=r.data;return on.forEach(e,function(i){l=i.call(n,l,a.normalize(),t?t.status:void 0)}),a.normalize(),l}function oie(e){return!!(e&&e.__CANCEL__)}function qx(e,t,n){Ds.call(this,e??"canceled",Ds.ERR_CANCELED,t,n),this.name="CanceledError"}on.inherits(qx,Ds,{__CANCEL__:!0});function lie(e,t,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?e(n):t(new Ds("Request failed with status code "+n.status,[Ds.ERR_BAD_REQUEST,Ds.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function sNe(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function aNe(e,t){e=e||10;const n=new Array(e),r=new Array(e);let a=0,l=0,f;return t=t!==void 0?t:1e3,function(y){const x=Date.now(),S=r[l];f||(f=x),n[a]=y,r[a]=x;let C=l,P=0;for(;C!==a;)P+=n[C++],C=C%e;if(a=(a+1)%e,a===l&&(l=(l+1)%e),x-f<t)return;const L=S&&x-S;return L?Math.round(P*1e3/L):void 0}}function oNe(e,t){let n=0,r=1e3/t,a,l;const f=(x,S=Date.now())=>{n=S,a=null,l&&(clearTimeout(l),l=null),e(...x)};return[(...x)=>{const S=Date.now(),C=S-n;C>=r?f(x,S):(a=x,l||(l=setTimeout(()=>{l=null,f(a)},r-C)))},()=>a&&f(a)]}const sk=(e,t,n=3)=>{let r=0;const a=aNe(50,250);return oNe(l=>{const f=l.loaded,i=l.lengthComputable?l.total:void 0,y=f-r,x=a(y),S=f<=i;r=f;const C={loaded:f,total:i,progress:i?f/i:void 0,bytes:y,rate:x||void 0,estimated:x&&i&&S?(i-f)/x:void 0,event:l,lengthComputable:i!=null,[t?"download":"upload"]:!0};e(C)},n)},XG=(e,t)=>{const n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},YG=e=>(...t)=>on.asap(()=>e(...t)),lNe=lu.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,lu.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(lu.origin),lu.navigator&&/(msie|trident)/i.test(lu.navigator.userAgent)):()=>!0,uNe=lu.hasStandardBrowserEnv?{write(e,t,n,r,a,l,f){if(typeof document>"u")return;const i=[`${e}=${encodeURIComponent(t)}`];on.isNumber(n)&&i.push(`expires=${new Date(n).toUTCString()}`),on.isString(r)&&i.push(`path=${r}`),on.isString(a)&&i.push(`domain=${a}`),l===!0&&i.push("secure"),on.isString(f)&&i.push(`SameSite=${f}`),document.cookie=i.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function cNe(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function dNe(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function uie(e,t,n){let r=!cNe(t);return e&&(r||n==!1)?dNe(e,t):t}const KG=e=>e instanceof cc?{...e}:e;function z_(e,t){t=t||{};const n={};function r(x,S,C,P){return on.isPlainObject(x)&&on.isPlainObject(S)?on.merge.call({caseless:P},x,S):on.isPlainObject(S)?on.merge({},S):on.isArray(S)?S.slice():S}function a(x,S,C,P){if(on.isUndefined(S)){if(!on.isUndefined(x))return r(void 0,x,C,P)}else return r(x,S,C,P)}function l(x,S){if(!on.isUndefined(S))return r(void 0,S)}function f(x,S){if(on.isUndefined(S)){if(!on.isUndefined(x))return r(void 0,x)}else return r(void 0,S)}function i(x,S,C){if(C in t)return r(x,S);if(C in e)return r(void 0,x)}const y={url:l,method:l,data:l,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,withXSRFToken:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:i,headers:(x,S,C)=>a(KG(x),KG(S),C,!0)};return on.forEach(Object.keys({...e,...t}),function(S){const C=y[S]||a,P=C(e[S],t[S],S);on.isUndefined(P)&&C!==i||(n[S]=P)}),n}const cie=e=>{const t=z_({},e);let{data:n,withXSRFToken:r,xsrfHeaderName:a,xsrfCookieName:l,headers:f,auth:i}=t;if(t.headers=f=cc.from(f),t.url=iie(uie(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),i&&f.set("Authorization","Basic "+btoa((i.username||"")+":"+(i.password?unescape(encodeURIComponent(i.password)):""))),on.isFormData(n)){if(lu.hasStandardBrowserEnv||lu.hasStandardBrowserWebWorkerEnv)f.setContentType(void 0);else if(on.isFunction(n.getHeaders)){const y=n.getHeaders(),x=["content-type","content-length"];Object.entries(y).forEach(([S,C])=>{x.includes(S.toLowerCase())&&f.set(S,C)})}}if(lu.hasStandardBrowserEnv&&(r&&on.isFunction(r)&&(r=r(t)),r||r!==!1&&lNe(t.url))){const y=a&&l&&uNe.read(l);y&&f.set(a,y)}return t},hNe=typeof XMLHttpRequest<"u",fNe=hNe&&function(e){return new Promise(function(n,r){const a=cie(e);let l=a.data;const f=cc.from(a.headers).normalize();let{responseType:i,onUploadProgress:y,onDownloadProgress:x}=a,S,C,P,L,F;function U(){L&&L(),F&&F(),a.cancelToken&&a.cancelToken.unsubscribe(S),a.signal&&a.signal.removeEventListener("abort",S)}let q=new XMLHttpRequest;q.open(a.method.toUpperCase(),a.url,!0),q.timeout=a.timeout;function G(){if(!q)return;const X=cc.from("getAllResponseHeaders"in q&&q.getAllResponseHeaders()),de={data:!i||i==="text"||i==="json"?q.responseText:q.response,status:q.status,statusText:q.statusText,headers:X,config:e,request:q};lie(function(be){n(be),U()},function(be){r(be),U()},de),q=null}"onloadend"in q?q.onloadend=G:q.onreadystatechange=function(){!q||q.readyState!==4||q.status===0&&!(q.responseURL&&q.responseURL.indexOf("file:")===0)||setTimeout(G)},q.onabort=function(){q&&(r(new Ds("Request aborted",Ds.ECONNABORTED,e,q)),q=null)},q.onerror=function(ie){const de=ie&&ie.message?ie.message:"Network Error",fe=new Ds(de,Ds.ERR_NETWORK,e,q);fe.event=ie||null,r(fe),q=null},q.ontimeout=function(){let ie=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const de=a.transitional||sie;a.timeoutErrorMessage&&(ie=a.timeoutErrorMessage),r(new Ds(ie,de.clarifyTimeoutError?Ds.ETIMEDOUT:Ds.ECONNABORTED,e,q)),q=null},l===void 0&&f.setContentType(null),"setRequestHeader"in q&&on.forEach(f.toJSON(),function(ie,de){q.setRequestHeader(de,ie)}),on.isUndefined(a.withCredentials)||(q.withCredentials=!!a.withCredentials),i&&i!=="json"&&(q.responseType=a.responseType),x&&([P,F]=sk(x,!0),q.addEventListener("progress",P)),y&&q.upload&&([C,L]=sk(y),q.upload.addEventListener("progress",C),q.upload.addEventListener("loadend",L)),(a.cancelToken||a.signal)&&(S=X=>{q&&(r(!X||X.type?new qx(null,e,q):X),q.abort(),q=null)},a.cancelToken&&a.cancelToken.subscribe(S),a.signal&&(a.signal.aborted?S():a.signal.addEventListener("abort",S)));const $=sNe(a.url);if($&&lu.protocols.indexOf($)===-1){r(new Ds("Unsupported protocol "+$+":",Ds.ERR_BAD_REQUEST,e));return}q.send(l||null)})},pNe=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r=new AbortController,a;const l=function(x){if(!a){a=!0,i();const S=x instanceof Error?x:this.reason;r.abort(S instanceof Ds?S:new qx(S instanceof Error?S.message:S))}};let f=t&&setTimeout(()=>{f=null,l(new Ds(`timeout ${t} of ms exceeded`,Ds.ETIMEDOUT))},t);const i=()=>{e&&(f&&clearTimeout(f),f=null,e.forEach(x=>{x.unsubscribe?x.unsubscribe(l):x.removeEventListener("abort",l)}),e=null)};e.forEach(x=>x.addEventListener("abort",l));const{signal:y}=r;return y.unsubscribe=()=>on.asap(i),y}},mNe=function*(e,t){let n=e.byteLength;if(n<t){yield e;return}let r=0,a;for(;r<n;)a=r+t,yield e.slice(r,a),r=a},gNe=async function*(e,t){for await(const n of _Ne(e))yield*mNe(n,t)},_Ne=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:n,value:r}=await t.read();if(n)break;yield r}}finally{await t.cancel()}},QG=(e,t,n,r)=>{const a=gNe(e,t);let l=0,f,i=y=>{f||(f=!0,r&&r(y))};return new ReadableStream({async pull(y){try{const{done:x,value:S}=await a.next();if(x){i(),y.close();return}let C=S.byteLength;if(n){let P=l+=C;n(P)}y.enqueue(new Uint8Array(S))}catch(x){throw i(x),x}},cancel(y){return i(y),a.return()}},{highWaterMark:2})},JG=64*1024,{isFunction:g4}=on,yNe=(({Request:e,Response:t})=>({Request:e,Response:t}))(on.global),{ReadableStream:eq,TextEncoder:tq}=on.global,nq=(e,...t)=>{try{return!!e(...t)}catch{return!1}},vNe=e=>{e=on.merge.call({skipUndefined:!0},yNe,e);const{fetch:t,Request:n,Response:r}=e,a=t?g4(t):typeof fetch=="function",l=g4(n),f=g4(r);if(!a)return!1;const i=a&&g4(eq),y=a&&(typeof tq=="function"?(F=>U=>F.encode(U))(new tq):async F=>new Uint8Array(await new n(F).arrayBuffer())),x=l&&i&&nq(()=>{let F=!1;const U=new n(lu.origin,{body:new eq,method:"POST",get duplex(){return F=!0,"half"}}).headers.has("Content-Type");return F&&!U}),S=f&&i&&nq(()=>on.isReadableStream(new r("").body)),C={stream:S&&(F=>F.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(F=>{!C[F]&&(C[F]=(U,q)=>{let G=U&&U[F];if(G)return G.call(U);throw new Ds(`Response type '${F}' is not supported`,Ds.ERR_NOT_SUPPORT,q)})});const P=async F=>{if(F==null)return 0;if(on.isBlob(F))return F.size;if(on.isSpecCompliantForm(F))return(await new n(lu.origin,{method:"POST",body:F}).arrayBuffer()).byteLength;if(on.isArrayBufferView(F)||on.isArrayBuffer(F))return F.byteLength;if(on.isURLSearchParams(F)&&(F=F+""),on.isString(F))return(await y(F)).byteLength},L=async(F,U)=>{const q=on.toFiniteNumber(F.getContentLength());return q??P(U)};return async F=>{let{url:U,method:q,data:G,signal:$,cancelToken:X,timeout:ie,onDownloadProgress:de,onUploadProgress:fe,responseType:be,headers:ve,withCredentials:Je="same-origin",fetchOptions:we}=cie(F),rt=t||fetch;be=be?(be+"").toLowerCase():"text";let He=pNe([$,X&&X.toAbortSignal()],ie),ft=null;const Ct=He&&He.unsubscribe&&(()=>{He.unsubscribe()});let Nt;try{if(fe&&x&&q!=="get"&&q!=="head"&&(Nt=await L(ve,G))!==0){let gn=new n(U,{method:"POST",body:G,duplex:"half"}),wt;if(on.isFormData(G)&&(wt=gn.headers.get("content-type"))&&ve.setContentType(wt),gn.body){const[Fe,jt]=XG(Nt,sk(YG(fe)));G=QG(gn.body,JG,Fe,jt)}}on.isString(Je)||(Je=Je?"include":"omit");const Rt=l&&"credentials"in n.prototype,en={...we,signal:He,method:q.toUpperCase(),headers:ve.normalize().toJSON(),body:G,duplex:"half",credentials:Rt?Je:void 0};ft=l&&new n(U,en);let nt=await(l?rt(ft,we):rt(U,en));const pt=S&&(be==="stream"||be==="response");if(S&&(de||pt&&Ct)){const gn={};["status","statusText","headers"].forEach(Tn=>{gn[Tn]=nt[Tn]});const wt=on.toFiniteNumber(nt.headers.get("content-length")),[Fe,jt]=de&&XG(wt,sk(YG(de),!0))||[];nt=new r(QG(nt.body,JG,Fe,()=>{jt&&jt(),Ct&&Ct()}),gn)}be=be||"text";let Oe=await C[on.findKey(C,be)||"text"](nt,F);return!pt&&Ct&&Ct(),await new Promise((gn,wt)=>{lie(gn,wt,{data:Oe,headers:cc.from(nt.headers),status:nt.status,statusText:nt.statusText,config:F,request:ft})})}catch(Rt){throw Ct&&Ct(),Rt&&Rt.name==="TypeError"&&/Load failed|fetch/i.test(Rt.message)?Object.assign(new Ds("Network Error",Ds.ERR_NETWORK,F,ft),{cause:Rt.cause||Rt}):Ds.from(Rt,Rt&&Rt.code,F,ft)}}},xNe=new Map,die=e=>{let t=e&&e.env||{};const{fetch:n,Request:r,Response:a}=t,l=[r,a,n];let f=l.length,i=f,y,x,S=xNe;for(;i--;)y=l[i],x=S.get(y),x===void 0&&S.set(y,x=i?new Map:vNe(t)),S=x;return x};die();const BN={http:zDe,xhr:fNe,fetch:{get:die}};on.forEach(BN,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const rq=e=>`- ${e}`,bNe=e=>on.isFunction(e)||e===null||e===!1;function wNe(e,t){e=on.isArray(e)?e:[e];const{length:n}=e;let r,a;const l={};for(let f=0;f<n;f++){r=e[f];let i;if(a=r,!bNe(r)&&(a=BN[(i=String(r)).toLowerCase()],a===void 0))throw new Ds(`Unknown adapter '${i}'`);if(a&&(on.isFunction(a)||(a=a.get(t))))break;l[i||"#"+f]=a}if(!a){const f=Object.entries(l).map(([y,x])=>`adapter ${y} `+(x===!1?"is not supported by the environment":"is not available in the build"));let i=n?f.length>1?`since :
`+f.map(rq).join(`
`):" "+rq(f[0]):"as no adapter specified";throw new Ds("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return a}const hie={getAdapter:wNe,adapters:BN};function iM(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new qx(null,e)}function iq(e){return iM(e),e.headers=cc.from(e.headers),e.data=rM.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),hie.getAdapter(e.adapter||bE.adapter,e)(e).then(function(r){return iM(e),r.data=rM.call(e,e.transformResponse,r),r.headers=cc.from(r.headers),r},function(r){return oie(r)||(iM(e),r&&r.response&&(r.response.data=rM.call(e,e.transformResponse,r.response),r.response.headers=cc.from(r.response.headers))),Promise.reject(r)})}const fie="1.13.2",dI={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{dI[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const sq={};dI.transitional=function(t,n,r){function a(l,f){return"[Axios v"+fie+"] Transitional option '"+l+"'"+f+(r?". "+r:"")}return(l,f,i)=>{if(t===!1)throw new Ds(a(f," has been removed"+(n?" in "+n:"")),Ds.ERR_DEPRECATED);return n&&!sq[f]&&(sq[f]=!0,console.warn(a(f," has been deprecated since v"+n+" and will be removed in the near future"))),t?t(l,f,i):!0}};dI.spelling=function(t){return(n,r)=>(console.warn(`${r} is likely a misspelling of ${t}`),!0)};function TNe(e,t,n){if(typeof e!="object")throw new Ds("options must be an object",Ds.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let a=r.length;for(;a-- >0;){const l=r[a],f=t[l];if(f){const i=e[l],y=i===void 0||f(i,l,e);if(y!==!0)throw new Ds("option "+l+" must be "+y,Ds.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Ds("Unknown option "+l,Ds.ERR_BAD_OPTION)}}const vA={assertOptions:TNe,validators:dI},Yh=vA.validators;let p_=class{constructor(t){this.defaults=t||{},this.interceptors={request:new ZG,response:new ZG}}async request(t,n){try{return await this._request(t,n)}catch(r){if(r instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{r.stack?l&&!String(r.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+l):r.stack=l}catch{}}throw r}}_request(t,n){typeof t=="string"?(n=n||{},n.url=t):n=t||{},n=z_(this.defaults,n);const{transitional:r,paramsSerializer:a,headers:l}=n;r!==void 0&&vA.assertOptions(r,{silentJSONParsing:Yh.transitional(Yh.boolean),forcedJSONParsing:Yh.transitional(Yh.boolean),clarifyTimeoutError:Yh.transitional(Yh.boolean)},!1),a!=null&&(on.isFunction(a)?n.paramsSerializer={serialize:a}:vA.assertOptions(a,{encode:Yh.function,serialize:Yh.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),vA.assertOptions(n,{baseUrl:Yh.spelling("baseURL"),withXsrfToken:Yh.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let f=l&&on.merge(l.common,l[n.method]);l&&on.forEach(["delete","get","head","post","put","patch","common"],F=>{delete l[F]}),n.headers=cc.concat(f,l);const i=[];let y=!0;this.interceptors.request.forEach(function(U){typeof U.runWhen=="function"&&U.runWhen(n)===!1||(y=y&&U.synchronous,i.unshift(U.fulfilled,U.rejected))});const x=[];this.interceptors.response.forEach(function(U){x.push(U.fulfilled,U.rejected)});let S,C=0,P;if(!y){const F=[iq.bind(this),void 0];for(F.unshift(...i),F.push(...x),P=F.length,S=Promise.resolve(n);C<P;)S=S.then(F[C++],F[C++]);return S}P=i.length;let L=n;for(;C<P;){const F=i[C++],U=i[C++];try{L=F(L)}catch(q){U.call(this,q);break}}try{S=iq.call(this,L)}catch(F){return Promise.reject(F)}for(C=0,P=x.length;C<P;)S=S.then(x[C++],x[C++]);return S}getUri(t){t=z_(this.defaults,t);const n=uie(t.baseURL,t.url,t.allowAbsoluteUrls);return iie(n,t.params,t.paramsSerializer)}};on.forEach(["delete","get","head","options"],function(t){p_.prototype[t]=function(n,r){return this.request(z_(r||{},{method:t,url:n,data:(r||{}).data}))}});on.forEach(["post","put","patch"],function(t){function n(r){return function(l,f,i){return this.request(z_(i||{},{method:t,headers:r?{"Content-Type":"multipart/form-data"}:{},url:l,data:f}))}}p_.prototype[t]=n(),p_.prototype[t+"Form"]=n(!0)});let ENe=class pie{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(l){n=l});const r=this;this.promise.then(a=>{if(!r._listeners)return;let l=r._listeners.length;for(;l-- >0;)r._listeners[l](a);r._listeners=null}),this.promise.then=a=>{let l;const f=new Promise(i=>{r.subscribe(i),l=i}).then(a);return f.cancel=function(){r.unsubscribe(l)},f},t(function(l,f,i){r.reason||(r.reason=new qx(l,f,i),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new pie(function(a){t=a}),cancel:t}}};function SNe(e){return function(n){return e.apply(null,n)}}function ANe(e){return on.isObject(e)&&e.isAxiosError===!0}const z8={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(z8).forEach(([e,t])=>{z8[t]=e});function mie(e){const t=new p_(e),n=qre(p_.prototype.request,t);return on.extend(n,p_.prototype,t,{allOwnKeys:!0}),on.extend(n,t,null,{allOwnKeys:!0}),n.create=function(a){return mie(z_(e,a))},n}const rl=mie(bE);rl.Axios=p_;rl.CanceledError=qx;rl.CancelToken=ENe;rl.isCancel=oie;rl.VERSION=fie;rl.toFormData=cI;rl.AxiosError=Ds;rl.Cancel=rl.CanceledError;rl.all=function(t){return Promise.all(t)};rl.spread=SNe;rl.isAxiosError=ANe;rl.mergeConfig=z_;rl.AxiosHeaders=cc;rl.formToJSON=e=>aie(on.isHTMLForm(e)?new FormData(e):e);rl.getAdapter=hie.getAdapter;rl.HttpStatusCode=z8;rl.default=rl;const{Axios:k9e,AxiosError:I9e,CanceledError:R9e,isCancel:M9e,CancelToken:P9e,VERSION:O9e,all:L9e,Cancel:D9e,isAxiosError:N9e,spread:z9e,toFormData:F9e,AxiosHeaders:B9e,HttpStatusCode:j9e,formToJSON:U9e,getAdapter:V9e,mergeConfig:$9e}=rl,CNe="/api";class kNe{constructor(){wi(this,"client");wi(this,"token",null);this.client=rl.create({baseURL:CNe,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(n=>(this.token&&(n.headers.Authorization=`Bearer ${this.token}`),n)),this.client.interceptors.response.use(n=>n,n=>{var r;if(((r=n.response)==null?void 0:r.status)===401){const a=n.response.data;if((a==null?void 0:a.code)==="SESSION_REPLACED")return this.token=null,sessionStorage.removeItem("token"),alert(a.message||"Sei stato disconnesso perch  stato effettuato un accesso da un altro dispositivo"),window.location.href="/login",Promise.reject(n);this.token=null,sessionStorage.removeItem("token"),window.location.href="/login"}return Promise.reject(n)});const t=sessionStorage.getItem("token");t&&(this.token=t)}setToken(t){this.token=t,t?sessionStorage.setItem("token",t):sessionStorage.removeItem("token")}async login(t,n){const{data:r}=await this.client.post("/auth/login",{email:t,password:n});return this.setToken(r.token),r}async getMe(){const{data:t}=await this.client.get("/auth/me");return t}async verifyPin(t){const{data:n}=await this.client.post("/auth/verify-pin",{pin:t});return this.setToken(n.token),n}async setPin(t,n){const{data:r}=await this.client.post("/auth/set-pin",{pin:t,current_pin:n});return r}async register(t){const{data:n}=await this.client.post("/auth/register",t);return this.setToken(n.token),n}logout(){this.setToken(null)}async getNeuroni(t){const{data:n}=await this.client.get("/neuroni",{params:t});return n}async getNeurone(t){const{data:n}=await this.client.get(`/neuroni/${t}`);return n}async createNeurone(t){const{data:n}=await this.client.post("/neuroni",t);return n}async updateNeurone(t,n){await this.client.put(`/neuroni/${t}`,n)}async deleteNeurone(t){await this.client.delete(`/neuroni/${t}`)}async getNeuroneSinapsi(t,n){const{data:r}=await this.client.get(`/neuroni/${t}/sinapsi`,{params:n});return r}async getSinapsi(t){const{data:n}=await this.client.get("/sinapsi",{params:t});return n}async getSinapsiById(t){const{data:n}=await this.client.get(`/sinapsi/${t}`);return n}async createSinapsi(t){const{data:n}=await this.client.post("/sinapsi",t);return n}async updateSinapsi(t,n){await this.client.put(`/sinapsi/${t}`,n)}async deleteSinapsi(t){await this.client.delete(`/sinapsi/${t}`)}async getNote(t){const{data:n}=await this.client.get("/note",{params:t?{neurone_id:t}:void 0});return n}async createNota(t,n){const{data:r}=await this.client.post("/note",{neurone_id:t,testo:n});return r}async updateNota(t,n){await this.client.put(`/note/${t}`,{testo:n})}async deleteNota(t){await this.client.delete(`/note/${t}`)}async getStats(){const{data:t}=await this.client.get("/stats");return t}async updateProfile(t){const{data:n}=await this.client.put("/users/profile",t);return n}async uploadFoto(t){const n=new FormData;n.append("foto",t);const{data:r}=await this.client.post("/users/upload-foto",n,{headers:{"Content-Type":"multipart/form-data"}});return r}async changePassword(t){const{data:n}=await this.client.put("/users/password",t);return n}async getAziendaMembri(){const{data:t}=await this.client.get("/azienda/membri");return t}async removeAziendaMembro(t){const{data:n}=await this.client.delete(`/azienda/membri/${t}`);return n}async invitaCollega(t){const{data:n}=await this.client.post("/azienda/inviti",{email:t});return n}async getInvitiPendenti(){const{data:t}=await this.client.get("/auth/inviti-pendenti");return t}async accettaInvito(t){const{data:n}=await this.client.post("/azienda/inviti/accetta",{invito_id:t});return this.setToken(n.token),n}async rifiutaInvito(t){const{data:n}=await this.client.post("/azienda/inviti/rifiuta",{invito_id:t});return n}async getTipiNeurone(){const{data:t}=await this.client.get("/tipi-neurone");return t}async createTipoNeurone(t){const{data:n}=await this.client.post("/tipi-neurone",t);return n}async updateTipoNeurone(t,n){const{data:r}=await this.client.put(`/tipi-neurone/${t}`,n);return r}async deleteTipoNeurone(t){const{data:n}=await this.client.delete(`/tipi-neurone/${t}`);return n}async getCategorie(t){const{data:n}=await this.client.get("/categorie",{params:t?{tipo_id:t}:void 0});return n}async createCategoria(t){const{data:n}=await this.client.post("/categorie",t);return n}async updateCategoria(t,n){const{data:r}=await this.client.put(`/categorie/${t}`,n);return r}async deleteCategoria(t){const{data:n}=await this.client.delete(`/categorie/${t}`);return n}async getCampi(t){const{data:n}=await this.client.get("/campi",{params:{tipo:t}});return n}async getTipiSinapsi(){const{data:t}=await this.client.get("/tipi-sinapsi");return t}async createTipoSinapsi(t){const{data:n}=await this.client.post("/tipi-sinapsi",t);return n}async updateTipoSinapsi(t,n){const{data:r}=await this.client.put(`/tipi-sinapsi/${t}`,n);return r}async deleteTipoSinapsi(t){const{data:n}=await this.client.delete(`/tipi-sinapsi/${t}`);return n}async getFamiglieProdotto(t){const{data:n}=await this.client.get("/famiglie-prodotto",{params:t});return n}async getFamigliaProdotto(t){const{data:n}=await this.client.get(`/famiglie-prodotto/${t}`);return n}async createFamigliaProdotto(t){const{data:n}=await this.client.post("/famiglie-prodotto",t);return n}async updateFamigliaProdotto(t,n){const{data:r}=await this.client.put(`/famiglie-prodotto/${t}`,n);return r}async deleteFamigliaProdotto(t){const{data:n}=await this.client.delete(`/famiglie-prodotto/${t}`);return n}async getVendite(t){const{data:n}=await this.client.get("/vendite",{params:{neurone_id:t}});return n}async createVendita(t){const{data:n}=await this.client.post("/vendite",t);return n}async deleteVendita(t){const{data:n}=await this.client.delete(`/vendite/${t}`);return n}async get(t,n){return this.client.get(t,{params:n})}async post(t,n){return this.client.post(t,n)}async put(t,n){return this.client.put(t,n)}async delete(t){return this.client.delete(t)}async getPreferenze(){try{const{data:t}=await this.client.get("/preferenze");return t.data}catch{return null}}async savePreferenze(t){await this.client.post("/preferenze",t)}async aiChat(t,n=[],r){const{data:a}=await this.client.post("/ai/chat",{message:t,history:n,context:r});return a}async aiDualBrain(t,n){const{data:r}=await this.client.post("/ai/dual-brain-v2",{message:t,context:n});return r}async aiChatContinue(t,n){const{data:r}=await this.client.post("/ai/chat",{resume_context:t,action_result:n});return r}async getAgeaMemory(){const{data:t}=await this.client.get("/agea/memory");return t}async updateAgeaMemory(t){const{data:n}=await this.client.put("/agea/memory",t);return n}async resetAgeaMemory(){const{data:t}=await this.client.delete("/agea/memory");return t}async geocodeSearch(t,n=5){const{data:r}=await this.client.get("/geocode/search",{params:{q:t,limit:n}});return r}}const Kn=new kNe;function jN(){const[e,t]=B.useState({user:null,token:sessionStorage.getItem("token"),personalAccess:!1,isLoading:!0});B.useEffect(()=>{(async()=>{const y=sessionStorage.getItem("token");if(!y){t(x=>({...x,isLoading:!1}));return}try{const x=await Kn.getMe();t({user:x,token:y,personalAccess:!1,isLoading:!1})}catch{sessionStorage.removeItem("token"),t({user:null,token:null,personalAccess:!1,isLoading:!1})}})()},[]);const n=B.useCallback(async(i,y)=>{const{token:x,user:S}=await Kn.login(i,y);return t({user:S,token:x,personalAccess:!1,isLoading:!1}),S},[]),r=B.useCallback(()=>{Kn.logout(),t({user:null,token:null,personalAccess:!1,isLoading:!1}),window.location.href="/genagenta/login"},[]),a=B.useCallback(async i=>{const{personal_access:y}=await Kn.verifyPin(i);return t(x=>({...x,personalAccess:y})),y},[]),l=B.useCallback(()=>{t(i=>({...i,personalAccess:!1}))},[]),f=B.useCallback(i=>{t(y=>({...y,user:y.user?{...y.user,...i}:null}))},[]);return{user:e.user,isAuthenticated:!!e.user,personalAccess:e.personalAccess,isLoading:e.isLoading,login:n,logout:r,verifyPin:a,exitPersonalMode:l,updateUser:f}}const gie=B.createContext(null);function INe(e,t=4){const n=[],r=["[role]","button","a[href]","input","select","textarea",'[tabindex]:not([tabindex="-1"])',"[aria-label]","[aria-labelledby]","h1","h2","h3","h4","[data-ai-readable]"].join(",");function a(y,x){var de,fe;if(x>t)return null;const S=y.getAttribute("role")||y.tagName.toLowerCase(),C=y.getAttribute("aria-label"),P=y.getAttribute("aria-labelledby"),L=y.getAttribute("title"),F=y.getAttribute("placeholder");let q=y.getAttribute("data-ai-name")||C||"";if(!q&&P){const be=document.getElementById(P);q=((de=be==null?void 0:be.textContent)==null?void 0:de.trim())||""}q||(q=L||F||((fe=y.textContent)==null?void 0:fe.trim().substring(0,50))||"");const G=["main","nav","section","article","aside","dialog","tabpanel"].includes(S);if(!q&&!G)return null;const $={role:l(S),name:q.substring(0,100)};y instanceof HTMLInputElement&&(y.type==="checkbox"||y.type==="radio"?$.checked=y.checked:$.value=y.value,$.disabled=y.disabled),y instanceof HTMLSelectElement&&($.value=y.value,$.disabled=y.disabled),y.getAttribute("aria-selected")==="true"&&($.selected=!0),y.getAttribute("aria-expanded")&&($.expanded=y.getAttribute("aria-expanded")==="true"),y.getAttribute("aria-disabled")==="true"&&($.disabled=!0);const ie=Array.from(y.children).filter(be=>be.matches('[role], button, a[href], input, select, textarea, [tabindex]:not([tabindex="-1"]), [aria-label], [aria-labelledby], h1, h2, h3, h4, [data-ai-readable]'));if(ie.length>0&&x<t){const be=[];ie.forEach(ve=>{const Je=a(ve,x+1);Je&&be.push(Je)}),be.length>0&&($.children=be)}return $}function l(y){return{button:"bottone",link:"link",textbox:"campo_testo",checkbox:"checkbox",radio:"radio",tab:"tab",tablist:"lista_tab",tabpanel:"pannello_tab",dialog:"dialogo",menu:"menu",menuitem:"voce_menu",listbox:"lista_selezione",option:"opzione",combobox:"dropdown",slider:"slider",spinbutton:"numero",switch:"interruttore",heading:"titolo",h1:"titolo_h1",h2:"titolo_h2",h3:"titolo_h3",h4:"titolo_h4",input:"input",select:"selezione",textarea:"area_testo",a:"link",nav:"navigazione",main:"contenuto_principale",section:"sezione",article:"articolo",aside:"sidebar",form:"form",img:"immagine",div:"contenitore",span:"testo"}[y]||y}const f=e.querySelectorAll(r),i=new Set;return f.forEach(y=>{let x=y.parentElement;for(;x&&x!==e;){if(i.has(x))return;x=x.parentElement}const S=a(y,0);S&&(n.push(S),i.add(y))}),n}function RNe({children:e}){const[t,n]=B.useState(new Map),[r,a]=B.useState(new Map),[l,f]=B.useState([]),[i,y]=B.useState(Date.now()),x=B.useRef(r);x.current=r;const S=B.useCallback(X=>{n(ie=>{const de=new Map(ie);return de.set(X.id,X),de}),y(Date.now())},[]),C=B.useCallback(X=>{n(ie=>{const de=new Map(ie);return de.delete(X),de}),y(Date.now())},[]),P=B.useCallback(X=>{a(ie=>{const de=new Map(ie);return de.set(X.id,X),de}),y(Date.now())},[]),L=B.useCallback(X=>{a(ie=>{const de=new Map(ie);return de.delete(X),de}),y(Date.now())},[]),F=B.useCallback(async(X,ie)=>{const de=x.current.get(X);if(!de)return{success:!1,message:`Azione "${X}" non trovata`};try{const fe=await de.handler(ie);return y(Date.now()),fe}catch(fe){return{success:!1,message:`Errore esecuzione: ${fe}`}}},[]),U=B.useCallback(()=>{const X=document.querySelector('[data-ai-container="main"]')||document.body,ie=INe(X);f(ie),y(Date.now())},[]);B.useEffect(()=>{const X=setInterval(()=>{U()},2e3);return()=>clearInterval(X)},[]);const q=B.useCallback(()=>{const X=["=== INTERFACCIA UTENTE ATTUALE ===",""],ie=new Map;if(t.forEach(de=>{const fe=de.category;ie.has(fe)||ie.set(fe,[]),ie.get(fe).push(de)}),ie.size>0&&(X.push("STATO COMPONENTI:"),ie.forEach((de,fe)=>{X.push(`  [${fe.toUpperCase()}]`),de.forEach(be=>{const ve=typeof be.value=="object"?JSON.stringify(be.value):String(be.value);X.push(`    ${be.name}: ${ve}`),be.description&&X.push(`      (${be.description})`)})}),X.push("")),r.size>0&&(X.push("AZIONI DISPONIBILI:"),r.forEach(de=>{const fe=de.parameters.map(be=>`${be.name}${be.required?"":"?"}: ${be.type}${be.options?` [${be.options.join("|")}]`:""}`).join(", ");X.push(`  - ${de.id}(${fe})`),X.push(`    ${de.description}`)}),X.push("")),l.length>0){X.push("ELEMENTI UI VISIBILI:");const de=(fe,be="  ")=>{let ve=`${be}[${fe.role}] "${fe.name}"`;fe.value!==void 0&&(ve+=` = "${fe.value}"`),fe.checked!==void 0&&(ve+=fe.checked?" ":" "),fe.selected&&(ve+=" (selezionato)"),fe.expanded!==void 0&&(ve+=fe.expanded?" (aperto)":" (chiuso)"),fe.disabled&&(ve+=" (disabilitato)"),X.push(ve),fe.children&&fe.children.forEach(Je=>de(Je,be+"  "))};l.forEach(fe=>de(fe)),X.push("")}return X.push("=== FINE UI ==="),X.join(`
`)},[t,r,l]),G=B.useCallback(()=>({readables:Array.from(t.values()),actions:Array.from(r.values()).map(({handler:X,...ie})=>ie),ui:l}),[t,r,l]),$={state:{readables:t,actions:r,accessibilitySnapshot:l,lastUpdate:i},registerReadable:S,unregisterReadable:C,registerAction:P,unregisterAction:L,executeAction:F,refreshAccessibilitySnapshot:U,exportForAi:q,exportForAiJson:G};return k.jsx(gie.Provider,{value:$,children:e})}function UN(){const e=B.useContext(gie);if(!e)throw new Error("useAiUi must be used within AiUiProvider");return e}function MNe(e,t,n,r,a){const{registerReadable:l,unregisterReadable:f}=UN();B.useEffect(()=>(l({id:e,category:t,name:n,value:r,description:a}),()=>f(e)),[e,t,n,r,a,l,f])}function sM(e){const{registerAction:t,unregisterAction:n}=UN(),r=B.useRef(e);r.current=e,B.useEffect(()=>{const a={...e,handler:l=>r.current.handler(l)};return t(a),()=>n(e.id)},[e.id,e.name,e.description,JSON.stringify(e.parameters),t,n])}function PNe(){const e=XT(),{login:t,isAuthenticated:n}=jN(),[r,a]=B.useState(""),[l,f]=B.useState(""),[i,y]=B.useState(""),[x,S]=B.useState(!1);if(n)return e("/",{replace:!0}),null;const C=async P=>{var L,F;P.preventDefault(),y(""),S(!0);try{await t(r,l),e("/",{replace:!0})}catch(U){y(((F=(L=U.response)==null?void 0:L.data)==null?void 0:F.error)||"Errore di connessione")}finally{S(!1)}};return k.jsx("div",{className:"login-container",children:k.jsxs("div",{className:"login-card",children:[k.jsx("h1",{className:"login-title",children:"GenAgenTa"}),k.jsx("p",{className:"login-subtitle",children:"Rete Neurale delle Relazioni Commerciali"}),k.jsxs("form",{onSubmit:C,children:[k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"email",children:"Email"}),k.jsx("input",{id:"email",type:"email",className:"form-input",value:r,onChange:P=>a(P.target.value),placeholder:"email@esempio.it",required:!0,autoFocus:!0})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"password",children:"Password"}),k.jsx("input",{id:"password",type:"password",className:"form-input",value:l,onChange:P=>f(P.target.value),placeholder:"",required:!0})]}),i&&k.jsx("div",{style:{padding:"12px",marginBottom:"16px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",borderRadius:"8px",fontSize:"14px"},children:i}),k.jsx("button",{type:"submit",className:"btn btn-primary",style:{width:"100%"},disabled:x,children:x?"Accesso in corso...":"Accedi"})]}),k.jsxs("p",{style:{marginTop:"24px",fontSize:"14px",color:"var(--text-secondary)",textAlign:"center"},children:["Non hai un account?"," ",k.jsx(ZW,{to:"/register",style:{color:"var(--primary)"},children:"Registrati"})]}),k.jsx("p",{style:{marginTop:"16px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"Demo: admin@gruppogea.net / admin123"})]})})}function ONe(){const e=XT(),[t]=Bde(),n=t.get("codice")||"",[r,a]=B.useState(n?"join":"new"),[l,f]=B.useState(""),[i,y]=B.useState(""),[x,S]=B.useState(""),[C,P]=B.useState(""),[L,F]=B.useState(""),[U,q]=B.useState(n),[G,$]=B.useState(""),[X,ie]=B.useState(!1);B.useEffect(()=>{n&&(q(n),a("join"))},[n]);const[de,fe]=B.useState(null),be=async ve=>{var Je,we;if(ve.preventDefault(),$(""),x!==C){$("Le password non coincidono");return}if(x.length<6){$("La password deve essere di almeno 6 caratteri");return}if(r==="new"&&!L.trim()){$("Inserisci il nome della tua azienda");return}if(r==="join"&&!U.trim()){$("Inserisci il codice azienda");return}ie(!0);try{const rt=await Kn.register({email:i,password:x,nome:l,nome_azienda:r==="new"?L:void 0,codice_azienda:r==="join"?U.toUpperCase():void 0});r==="new"?fe({azienda:rt.azienda}):e("/",{replace:!0})}catch(rt){$(((we=(Je=rt.response)==null?void 0:Je.data)==null?void 0:we.error)||"Errore durante la registrazione")}finally{ie(!1)}};return de?k.jsx("div",{className:"login-container",children:k.jsxs("div",{className:"login-card",children:[k.jsx("h1",{className:"login-title",children:" Registrazione Completata!"}),k.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",borderRadius:"12px",padding:"20px",marginBottom:"24px",textAlign:"center"},children:[k.jsxs("p",{style:{marginBottom:"12px",color:"var(--text-secondary)"},children:["La tua azienda ",k.jsx("strong",{children:de.azienda.nome}),"  stata creata."]}),k.jsx("p",{style:{marginBottom:"8px",fontSize:"14px",color:"var(--text-secondary)"},children:"Codice per invitare i colleghi:"}),k.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",fontFamily:"monospace",color:"var(--primary)",letterSpacing:"2px",padding:"12px",background:"var(--bg-primary)",borderRadius:"8px"},children:de.azienda.codice_pairing})]}),k.jsxs("p",{style:{fontSize:"13px",color:"var(--text-secondary)",marginBottom:"24px",textAlign:"center"},children:["Condividi questo codice con i tuoi colleghi.",k.jsx("br",{}),"Lo useranno per unirsi alla tua azienda durante la registrazione."]}),k.jsx("button",{className:"btn btn-primary",style:{width:"100%"},onClick:()=>e("/",{replace:!0}),children:"Vai alla Dashboard"})]})}):k.jsx("div",{className:"login-container",children:k.jsxs("div",{className:"login-card",children:[k.jsx("h1",{className:"login-title",children:"GenAgenTa"}),k.jsx("p",{className:"login-subtitle",children:"Crea il tuo account"}),k.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"24px"},children:[k.jsx("button",{type:"button",className:`btn ${r==="new"?"btn-primary":"btn-secondary"}`,style:{flex:1,fontSize:"13px"},onClick:()=>a("new"),children:"Nuova Azienda"}),k.jsx("button",{type:"button",className:`btn ${r==="join"?"btn-primary":"btn-secondary"}`,style:{flex:1,fontSize:"13px"},onClick:()=>a("join"),children:"Unisciti"})]}),k.jsxs("form",{onSubmit:be,children:[k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"nome",children:"Il tuo nome"}),k.jsx("input",{id:"nome",type:"text",className:"form-input",value:l,onChange:ve=>f(ve.target.value),placeholder:"Mario Rossi",required:!0,autoFocus:!0})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"email",children:"Email"}),k.jsx("input",{id:"email",type:"email",className:"form-input",value:i,onChange:ve=>y(ve.target.value),placeholder:"email@esempio.it",required:!0})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"password",children:"Password"}),k.jsx("input",{id:"password",type:"password",className:"form-input",value:x,onChange:ve=>S(ve.target.value),placeholder:"Minimo 6 caratteri",required:!0})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"confirmPassword",children:"Conferma Password"}),k.jsx("input",{id:"confirmPassword",type:"password",className:"form-input",value:C,onChange:ve=>P(ve.target.value),placeholder:"Ripeti la password",required:!0})]}),r==="new"?k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"nomeAzienda",children:"Nome Azienda"}),k.jsx("input",{id:"nomeAzienda",type:"text",className:"form-input",value:L,onChange:ve=>F(ve.target.value),placeholder:"La tua azienda S.r.l.",required:!0}),k.jsx("p",{style:{fontSize:"12px",color:"var(--text-secondary)",marginTop:"4px"},children:"Riceverai un codice da condividere con i colleghi"})]}):k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"codiceAzienda",children:"Codice Azienda"}),k.jsx("input",{id:"codiceAzienda",type:"text",className:"form-input",value:U,onChange:ve=>q(ve.target.value.toUpperCase()),placeholder:"GEA-XXXXXX",style:{fontFamily:"monospace",letterSpacing:"1px"},required:!0}),k.jsx("p",{style:{fontSize:"12px",color:"var(--text-secondary)",marginTop:"4px"},children:"Chiedi il codice all'amministratore della tua azienda"})]}),G&&k.jsx("div",{style:{padding:"12px",marginBottom:"16px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",borderRadius:"8px",fontSize:"14px"},children:G}),k.jsx("button",{type:"submit",className:"btn btn-primary",style:{width:"100%"},disabled:X,children:X?"Registrazione in corso...":"Registrati"})]}),k.jsxs("p",{style:{marginTop:"24px",fontSize:"14px",color:"var(--text-secondary)",textAlign:"center"},children:["Hai gi un account?"," ",k.jsx(ZW,{to:"/login",style:{color:"var(--primary)"},children:"Accedi"})]})]})})}const uu={neuroni:e=>["neuroni",e],neurone:e=>["neurone",e],sinapsi:e=>["sinapsi",e],sinapsiNeurone:e=>["sinapsi","neurone",e],sinapsiById:e=>["sinapsi","detail",e],tipi:()=>["tipi"],tipologie:()=>["tipologie"],campiTipo:e=>["campi","tipo",e],famiglieProdotto:()=>["famiglieProdotto"],note:e=>["note",e],vendite:e=>["vendite",e]};function LNe(e={}){return wh({queryKey:uu.neuroni(e),queryFn:async()=>(await Kn.getNeuroni({tipo:e.tipoNeurone||void 0,categoria:e.categoria||void 0,data_inizio:e.dataInizio||void 0,data_fine:e.dataFine||void 0,limit:500})).data})}function DNe(e){return wh({queryKey:uu.neurone(e||""),queryFn:async()=>e?await Kn.getNeurone(e):null,enabled:!!e})}function NNe(e={}){return wh({queryKey:uu.sinapsi(e),queryFn:async()=>(await Kn.getSinapsi({data_inizio:e.dataInizio||void 0,data_fine:e.dataFine||void 0,certezza:e.certezza||void 0,valore_min:e.valoreMin||void 0,limit:1e3})).data})}function _ie(e){return wh({queryKey:uu.sinapsiNeurone(e||""),queryFn:async()=>e?(await Kn.getNeuroneSinapsi(e)).data:[],enabled:!!e})}function zNe(e){return wh({queryKey:uu.sinapsiById(e||""),queryFn:async()=>e?await Kn.getSinapsiById(e):null,enabled:!!e})}function yie(){return wh({queryKey:uu.tipi(),queryFn:async()=>(await Kn.get("/tipi")).data.data.map(t=>({id:t.id,nome:t.nome,forma:t.forma,ordine:t.ordine})),staleTime:1e3*60*30})}function FNe(){return wh({queryKey:uu.tipologie(),queryFn:async()=>(await Kn.get("/tipologie")).data.data.map(t=>({id:t.id,tipo_id:t.tipo_id,nome:t.nome,colore:t.colore,ordine:t.ordine})),staleTime:1e3*60*30})}function BNe(e){return wh({queryKey:uu.campiTipo(e||""),queryFn:async()=>e?(await Kn.getCampi(e)).data:[],enabled:!!e,staleTime:1e3*60*30})}function jNe(){return wh({queryKey:uu.famiglieProdotto(),queryFn:async()=>{const e=await Kn.getFamiglieProdotto({flat:!0}),t=[],n=(r,a=0)=>{r.forEach(l=>{t.push({id:l.id,nome:"  ".repeat(a)+l.nome,colore:l.colore,parent_id:l.parent_id}),l.children&&n(l.children,a+1)})};return n(e.data),t},staleTime:1e3*60*30})}function UNe(e){return wh({queryKey:uu.note(e||""),queryFn:async()=>e?(await Kn.getNote(e)).data:[],enabled:!!e})}function VNe(e){return wh({queryKey:uu.vendite(e||""),queryFn:async()=>e?await Kn.getVendite(e):{data:[],potenziale:0,totale_venduto:0,percentuale:0},enabled:!!e})}function wE(){const e=iX();return{invalidateNeuroni:()=>{e.invalidateQueries({predicate:t=>{const n=t.queryKey[0];return n==="neuroni"||n==="neurone"}})},invalidateNeurone:t=>{e.invalidateQueries({queryKey:uu.neurone(t)})},invalidateSinapsi:()=>{e.invalidateQueries({predicate:t=>t.queryKey[0]==="sinapsi"})},invalidateSinapsiNeurone:t=>{e.invalidateQueries({queryKey:uu.sinapsiNeurone(t)})},invalidateSinapsiById:t=>{e.invalidateQueries({queryKey:uu.sinapsiById(t)})},invalidateNote:t=>{e.invalidateQueries({queryKey:uu.note(t)})},invalidateVendite:t=>{e.invalidateQueries({queryKey:uu.vendite(t)})},invalidateAll:()=>{e.invalidateQueries({predicate:t=>{const n=t.queryKey[0];return n==="neuroni"||n==="neurone"||n==="sinapsi"||n==="note"||n==="vendite"}})},invalidateNeuroniESinapsi:()=>{e.invalidateQueries({predicate:t=>{const n=t.queryKey[0];return n==="neuroni"||n==="neurone"||n==="sinapsi"}})}}}function $Ne(e,t,n,r){const l=(n-e)*Math.PI/180,f=(r-t)*Math.PI/180,i=Math.sin(l/2)*Math.sin(l/2)+Math.cos(e*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(f/2)*Math.sin(f/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}function HNe(e){return 4e4/Math.pow(2,e)}function GNe({neuroni:e,sinapsi:t,filtri:n,selectedNeurone:r,selectedSinapsiId:a,aiMarkers:l,userActions:f,tipiNeurone:i,mapViewport:y,categorie:x}){const S=B.useMemo(()=>{if(!y)return{viewport:null,entitaNellaViewport:[],connessioniVisibili:t.length,filtriAttivi:{tipi:n.tipiSelezionati.length>0?n.tipiSelezionati:"tutti",categorie:n.categorieSelezionate.length>0?n.categorieSelezionate:"tutte",ricerca:n.ricerca||null,periodo:`${n.dataInizio} - ${n.dataFine}`},totaleEntitaCaricate:e.length,totaleConnessioni:t.length};const{center:F,zoom:U}=y,q=HNe(U),G=e.filter($=>$.lat!==null&&$.lng!==null).map($=>({id:$.id,nome:$.nome,tipo:$.tipo,distanzaDalCentroKm:$Ne(F.lat,F.lng,$.lat,$.lng)})).filter($=>$.distanzaDalCentroKm<=q*1.5).sort(($,X)=>$.distanzaDalCentroKm-X.distanzaDalCentroKm).slice(0,15);return{viewport:{centro:F,zoom:U,raggioApprossimativoKm:Math.round(q*10)/10},entitaNellaViewport:G,connessioniVisibili:t.length,filtriAttivi:{tipi:n.tipiSelezionati.length>0?n.tipiSelezionati:"tutti",categorie:n.categorieSelezionate.length>0?n.categorieSelezionate:"tutte",ricerca:n.ricerca||null,periodo:`${n.dataInizio} - ${n.dataFine}`},totaleEntitaCaricate:e.length,totaleConnessioni:t.length}},[e,t,n,y]),C=B.useMemo(()=>{if(!r)return{entitaSelezionata:null,pannelloAperto:a?"dettaglio_connessione":null,markerAI:l.length};const F=r.potenziale||0,U=r.venduto_totale||0,q=F>0?Math.round(U/F*100):0;return{entitaSelezionata:{id:r.id,nome:r.nome,tipo:r.tipo,indirizzo:r.indirizzo,categorie:r.categorie,telefono:r.telefono,email:r.email,potenziale:r.potenziale,venduto_totale:r.venduto_totale,percentuale_raggiunta:q,is_acquirente:r.is_acquirente,is_venditore:r.is_venditore,is_intermediario:r.is_intermediario,is_influencer:r.is_influencer},pannelloAperto:"dettaglio_entita",markerAI:l.length}},[r,a,l]),P=B.useMemo(()=>({tipiDisponibili:i.map(F=>F.nome),categorieDisponibili:x.map(F=>({nome:F.nome,colore:F.colore}))}),[i,x]);return B.useMemo(()=>({mappa:S,selezione:C,azioniRecenti:f.slice(-5),configurazione:P,timestamp:new Date().toISOString()}),[S,C,f,P])}function qNe(e){const t=["=== CONTESTO LIVE APPLICAZIONE ===",""];if(e.mappa.viewport){const r=e.mappa.viewport;t.push("VIEWPORT MAPPA:"),t.push(`  Centro: ${r.centro.lat.toFixed(5)}, ${r.centro.lng.toFixed(5)}`),t.push(`  Zoom: ${r.zoom} (raggio visibile ~${r.raggioApprossimativoKm}km)`),t.push(`  Totale entit caricate: ${e.mappa.totaleEntitaCaricate}`)}else t.push(`MAPPA: ${e.mappa.totaleEntitaCaricate} entit caricate`);if(e.mappa.filtriAttivi.ricerca&&t.push(`  Ricerca attiva: "${e.mappa.filtriAttivi.ricerca}"`),e.mappa.filtriAttivi.tipi!=="tutti"&&t.push(`  Filtro tipi: ${e.mappa.filtriAttivi.tipi.join(", ")}`),e.selezione.entitaSelezionata){const r=e.selezione.entitaSelezionata;t.push(""),t.push(`ENTIT SELEZIONATA: "${r.nome}" (${r.tipo})`),t.push(`  ID: ${r.id}`),r.indirizzo&&t.push(`  Indirizzo: ${r.indirizzo}`),r.telefono&&t.push(`  Tel: ${r.telefono}`),r.email&&t.push(`  Email: ${r.email}`),t.push("  --- DATI COMMERCIALI (tab Transazioni) ---"),t.push(`  Potenziale di acquisto: ${(r.potenziale||0).toLocaleString("it-IT")}`),t.push(`  Venduto totale: ${(r.venduto_totale||0).toLocaleString("it-IT")}`),r.potenziale&&r.potenziale>0&&t.push(`  Percentuale raggiunta: ${r.percentuale_raggiunta}%`);const a=[];r.is_acquirente&&a.push("Acquirente "),r.is_venditore&&a.push("Venditore "),r.is_intermediario&&a.push("Intermediario "),r.is_influencer&&a.push("Influencer "),a.length>0?t.push(`  Natura commerciale: ${a.join(", ")}`):t.push("  Natura commerciale: nessuna spunta attiva"),t.push(`  (Quando l'utente dice "questo/questa" si riferisce a questa entit)`)}e.mappa.entitaNellaViewport.length>0?(t.push(""),t.push(`ENTIT VISIBILI NELLA VIEWPORT (${e.mappa.entitaNellaViewport.length}):`),e.mappa.entitaNellaViewport.forEach(r=>{t.push(`  - ${r.nome} (${r.tipo}) ~${r.distanzaDalCentroKm.toFixed(1)}km dal centro`)})):e.mappa.viewport&&(t.push(""),t.push("NESSUNA ENTIT VISIBILE nella viewport corrente"));const n=e.azioniRecenti.filter(r=>r.type!=="map_move");return n.length>0&&(t.push(""),t.push("AZIONI RECENTI UTENTE:"),n.forEach(r=>{const a=new Date(r.timestamp).toLocaleTimeString("it-IT");t.push(`  [${a}] ${r.type}: ${JSON.stringify(r.data)}`)})),e.selezione.markerAI>0&&(t.push(""),t.push(`MARKER AI SULLA MAPPA: ${e.selezione.markerAI}`)),t.push(""),t.push("=== FINE CONTESTO ==="),t.join(`
`)}function aq({label:e,options:t,selected:n,onToggle:r,placeholder:a,onSelectAll:l}){const[f,i]=B.useState(!1),y=B.useRef(null);B.useEffect(()=>{const C=P=>{y.current&&!y.current.contains(P.target)&&i(!1)};return f&&document.addEventListener("mousedown",C),()=>document.removeEventListener("mousedown",C)},[f]);const x=n.length,S=x===0?a||e:x===t.length?"Tutti":`${x} ${e.toLowerCase()}`;return k.jsxs("div",{ref:y,style:{position:"relative",flex:1},children:[k.jsxs("button",{onClick:()=>i(!f),style:{width:"100%",padding:"6px 10px",fontSize:"12px",border:"1px solid var(--border-color)",borderRadius:"6px",background:x>0?"var(--primary)":"var(--bg-secondary)",color:x>0?"white":"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"4px"},children:[k.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:S}),k.jsx("span",{style:{fontSize:"10px",transform:f?"rotate(180deg)":"none",transition:"transform 0.15s ease"},children:""})]}),f&&k.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"1px solid var(--border-color)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",zIndex:100,maxHeight:"200px",overflowY:"auto"},children:[l&&k.jsx("div",{onClick:()=>{l(),i(!1)},style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 10px",cursor:"pointer",borderBottom:"2px solid var(--border-color)",background:n.length===0?"var(--bg-tertiary)":"transparent",fontWeight:n.length===0?600:400},onMouseEnter:C=>{n.length>0&&(C.currentTarget.style.background="var(--bg-secondary)")},onMouseLeave:C=>{C.currentTarget.style.background=n.length===0?"var(--bg-tertiary)":"transparent"},children:k.jsx("span",{style:{fontSize:"12px",color:"var(--text-primary)"},children:"Tutti"})}),t.map(C=>{const P=n.includes(C.id);return k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 10px",cursor:"pointer",borderBottom:"1px solid var(--border-color)",background:P?"var(--bg-tertiary)":"transparent"},onMouseEnter:L=>{P||(L.currentTarget.style.background="var(--bg-secondary)")},onMouseLeave:L=>{L.currentTarget.style.background=P?"var(--bg-tertiary)":"transparent"},children:[k.jsx("input",{type:"checkbox",checked:P,onChange:()=>r(C.id),style:{accentColor:C.colore||"var(--primary)"}}),C.colore&&k.jsx("span",{style:{width:"10px",height:"10px",borderRadius:"50%",background:C.colore,flexShrink:0}}),k.jsx("span",{style:{flex:1,fontSize:"12px",color:"var(--text-primary)"},children:C.label}),k.jsx("span",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:C.count})]},C.id)}),t.length===0&&k.jsx("div",{style:{padding:"12px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"Nessuna opzione"})]})]})}function ZNe({neuroni:e,selectedId:t,onSelect:n,filtri:r,onFiltriChange:a,loading:l,onAddNeurone:f,onQuickMapMode:i,tipiNeurone:y,categorie:x}){const[S,C]=B.useState(!1),P=B.useRef(null);B.useEffect(()=>{const $=X=>{P.current&&!P.current.contains(X.target)&&C(!1)};return S&&document.addEventListener("mousedown",$),()=>document.removeEventListener("mousedown",$)},[S]);const L=B.useMemo(()=>{let $=e;if(r.tipiSelezionati.length>0&&($=$.filter(X=>r.tipiSelezionati.includes(X.tipo))),r.categorieSelezionate.length>0&&($=$.filter(X=>X.categorie.some(ie=>r.categorieSelezionate.some(de=>de.toLowerCase()===ie.toLowerCase())))),r.ricerca.trim()){const X=r.ricerca.toLowerCase().trim();$=$.filter(ie=>{var de;return ie.nome.toLowerCase().includes(X)||((de=ie.indirizzo)==null?void 0:de.toLowerCase().includes(X))||ie.categorie.some(fe=>fe.toLowerCase().includes(X))})}return $},[e,r.tipiSelezionati,r.categorieSelezionate,r.ricerca]),F=B.useMemo(()=>{const $={};return y.forEach(X=>{$[X.nome]=L.filter(ie=>ie.tipo===X.nome)}),$},[L,y]),U=$=>{const X=r.tipiSelezionati.includes($)?r.tipiSelezionati.filter(ie=>ie!==$):[...r.tipiSelezionati,$];a({...r,tipiSelezionati:X})},q=$=>{const X=r.categorieSelezionate.includes($)?r.categorieSelezionate.filter(ie=>ie!==$):[...r.categorieSelezionate,$];a({...r,categorieSelezionate:X})},G=B.useMemo(()=>{if(r.tipiSelezionati.length===0)return x;const $=y.filter(X=>r.tipiSelezionati.includes(X.nome)).map(X=>X.id);return x.filter(X=>$.includes(X.tipo_id))},[x,r.tipiSelezionati,y]);return k.jsxs("aside",{className:"sidebar",children:[k.jsx("div",{style:{padding:"16px",borderBottom:"1px solid var(--border-color)"},children:k.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[k.jsxs("div",{children:[k.jsx("h2",{style:{fontSize:"20px",fontWeight:700,color:"var(--color-primary)"},children:"GenAgenTa"}),k.jsx("p",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:"Rete Neurale Commerciale"})]}),(f||i)&&k.jsxs("div",{ref:P,style:{position:"relative"},children:[k.jsx("button",{onClick:()=>C(!S),className:"btn btn-primary",style:{width:"40px",height:"40px",borderRadius:"50%",padding:0,fontSize:"24px",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",transform:S?"rotate(45deg)":"none",transition:"transform 0.2s ease"},title:"Aggiungi",children:"+"}),S&&k.jsxs("div",{style:{position:"absolute",top:"48px",right:0,background:"white",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.2)",overflow:"hidden",minWidth:"180px",zIndex:1e3},children:[f&&k.jsxs("button",{onClick:()=>{C(!1),f()},style:{display:"flex",alignItems:"center",gap:"10px",width:"100%",padding:"12px 16px",border:"none",background:"none",cursor:"pointer",fontSize:"14px",textAlign:"left",borderBottom:"1px solid #e5e7eb"},onMouseEnter:$=>$.currentTarget.style.background="#f3f4f6",onMouseLeave:$=>$.currentTarget.style.background="none",children:[k.jsx("span",{style:{fontSize:"18px"},children:""}),"Nuova entit"]}),i&&k.jsxs("button",{onClick:()=>{C(!1),i()},style:{display:"flex",alignItems:"center",gap:"10px",width:"100%",padding:"12px 16px",border:"none",background:"none",cursor:"pointer",fontSize:"14px",textAlign:"left"},onMouseEnter:$=>$.currentTarget.style.background="#f3f4f6",onMouseLeave:$=>$.currentTarget.style.background="none",children:[k.jsx("span",{style:{fontSize:"18px"},children:""}),"Nuovo su mappa"]})]})]})]})}),k.jsxs("div",{style:{padding:"10px 12px",borderBottom:"1px solid var(--border-color)"},children:[k.jsx("input",{type:"search",className:"form-input",placeholder:"Cerca...",value:r.ricerca,onChange:$=>a({...r,ricerca:$.target.value}),style:{fontSize:"12px",padding:"6px 10px",marginBottom:"8px"}}),k.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px",marginBottom:"8px"},children:[k.jsx(aq,{label:"Tipi",placeholder:"Tutti i tipi",options:y.map($=>({id:$.nome,label:$.nome,count:e.filter(X=>X.tipo===$.nome).length})),selected:r.tipiSelezionati,onToggle:U,onSelectAll:()=>a({...r,tipiSelezionati:[]})}),k.jsx(aq,{label:"Categorie",placeholder:"Tutte le categorie",options:G.map($=>({id:$.nome,label:$.nome,count:e.filter(X=>X.categorie.some(ie=>ie.toLowerCase()===$.nome.toLowerCase())).length,colore:$.colore})),selected:r.categorieSelezionate,onToggle:q,onSelectAll:()=>a({...r,categorieSelezionate:[]})})]}),k.jsxs("div",{style:{display:"flex",gap:"12px",fontSize:"11px"},children:[k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},children:[k.jsx("input",{type:"checkbox",checked:r.mostraConnessioni,onChange:$=>a({...r,mostraConnessioni:$.target.checked}),style:{width:"14px",height:"14px"}}),"Connessioni"]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer",opacity:r.mostraConnessioni?1:.4},children:[k.jsx("input",{type:"checkbox",checked:r.soloConnessioniSelezionate,onChange:$=>a({...r,soloConnessioniSelezionate:$.target.checked}),disabled:!r.mostraConnessioni,style:{width:"14px",height:"14px"}}),"Solo selezionato"]})]})]}),k.jsx("div",{className:"neurone-list",children:l?k.jsx("p",{style:{padding:"16px",color:"var(--text-secondary)",textAlign:"center"},children:"Caricamento..."}):L.length===0?k.jsx("p",{style:{padding:"16px",color:"var(--text-secondary)",textAlign:"center"},children:"Nessun risultato"}):k.jsx(k.Fragment,{children:y.map($=>{const X=F[$.nome]||[];return X.length===0?null:k.jsx(WNe,{titolo:$.nome,neuroni:X,selectedId:t,onSelect:n,categorie:x},$.id)})})}),k.jsx("div",{style:{padding:"12px",borderTop:"1px solid var(--border-color)",fontSize:"12px",color:"var(--text-secondary)"},children:L.length===e.length?`${e.length} entit`:`${L.length} di ${e.length} entit`})]})}function WNe({titolo:e,neuroni:t,selectedId:n,onSelect:r,categorie:a}){const l=f=>{const i=a.find(y=>y.nome.toLowerCase()===f.toLowerCase());return(i==null?void 0:i.colore)||"#6b7280"};return k.jsxs("div",{style:{marginBottom:"8px"},children:[k.jsxs("h3",{style:{fontSize:"11px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--text-secondary)",padding:"8px 12px 4px"},children:[e," (",t.length,")"]}),t.slice(0,50).map(f=>k.jsxs("div",{className:`neurone-item ${n===f.id?"active":""}`,onClick:()=>r(f),children:[k.jsxs("div",{className:"neurone-item-name",children:[f.nome,f.has_note&&k.jsx("span",{className:"icon-lock",title:"Ha note personali",children:""})]}),k.jsxs("div",{className:"neurone-item-meta",style:{display:"flex",alignItems:"center",gap:"4px"},children:[f.categorie.slice(0,2).map((i,y)=>k.jsx("span",{style:{display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",background:l(i)},title:i},y)),k.jsx("span",{style:{marginLeft:"2px"},children:f.categorie.slice(0,2).join(", ")})]})]},f.id)),t.length>50&&k.jsxs("p",{style:{padding:"4px 12px",fontSize:"11px",color:"var(--text-secondary)"},children:["+",t.length-50," altri..."]})]})}var vie={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(fp,function(){var n,r,a;function l(i,y){if(!n)n=y;else if(!r)r=y;else{var x="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",S={};n(S),a=y(S),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(a.workerUrl=window.URL.createObjectURL(new Blob([x],{type:"text/javascript"})))}}l(["exports"],function(i){var y=1e-6,x=typeof Float32Array<"u"?Float32Array:Array;function S(c,s){var u=s[0],h=s[1],p=s[2],_=s[3],v=u*_-p*h;return v?(c[0]=_*(v=1/v),c[1]=-h*v,c[2]=-p*v,c[3]=u*v,c):null}function C(){var c=new x(9);return x!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function P(c,s){var u=s[0],h=s[1],p=s[2],_=s[3],v=s[4],w=s[5],A=s[6],R=s[7],O=s[8];return c[0]=v*O-w*R,c[1]=p*R-h*O,c[2]=h*w-p*v,c[3]=w*A-_*O,c[4]=u*O-p*A,c[5]=p*_-u*w,c[6]=_*R-v*A,c[7]=h*A-u*R,c[8]=u*v-h*_,c}function L(c,s,u){var h=s[0],p=s[1],_=s[2],v=s[3],w=s[4],A=s[5],R=s[6],O=s[7],D=s[8],z=u[0],V=u[1],H=u[2],K=u[3],re=u[4],ne=u[5],ue=u[6],he=u[7],ge=u[8];return c[0]=z*h+V*v+H*R,c[1]=z*p+V*w+H*O,c[2]=z*_+V*A+H*D,c[3]=K*h+re*v+ne*R,c[4]=K*p+re*w+ne*O,c[5]=K*_+re*A+ne*D,c[6]=ue*h+he*v+ge*R,c[7]=ue*p+he*w+ge*O,c[8]=ue*_+he*A+ge*D,c}function F(){var c=new x(16);return x!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c}function U(c){var s=new x(16);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=c[6],s[7]=c[7],s[8]=c[8],s[9]=c[9],s[10]=c[10],s[11]=c[11],s[12]=c[12],s[13]=c[13],s[14]=c[14],s[15]=c[15],s}function q(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function G(c,s){var u=s[0],h=s[1],p=s[2],_=s[3],v=s[4],w=s[5],A=s[6],R=s[7],O=s[8],D=s[9],z=s[10],V=s[11],H=s[12],K=s[13],re=s[14],ne=s[15],ue=u*w-h*v,he=u*A-p*v,ge=u*R-_*v,ke=h*A-p*w,Ee=h*R-_*w,Pe=p*R-_*A,Be=O*K-D*H,$e=O*re-z*H,mt=O*ne-V*H,Xe=D*re-z*K,vt=D*ne-V*K,kt=z*ne-V*re,It=ue*kt-he*vt+ge*Xe+ke*mt-Ee*$e+Pe*Be;return It?(c[0]=(w*kt-A*vt+R*Xe)*(It=1/It),c[1]=(p*vt-h*kt-_*Xe)*It,c[2]=(K*Pe-re*Ee+ne*ke)*It,c[3]=(z*Ee-D*Pe-V*ke)*It,c[4]=(A*mt-v*kt-R*$e)*It,c[5]=(u*kt-p*mt+_*$e)*It,c[6]=(re*ge-H*Pe-ne*he)*It,c[7]=(O*Pe-z*ge+V*he)*It,c[8]=(v*vt-w*mt+R*Be)*It,c[9]=(h*mt-u*vt-_*Be)*It,c[10]=(H*Ee-K*ge+ne*ue)*It,c[11]=(D*ge-O*Ee-V*ue)*It,c[12]=(w*$e-v*Xe-A*Be)*It,c[13]=(u*Xe-h*$e+p*Be)*It,c[14]=(K*he-H*ke-re*ue)*It,c[15]=(O*ke-D*he+z*ue)*It,c):null}function $(c,s,u){var h=s[0],p=s[1],_=s[2],v=s[3],w=s[4],A=s[5],R=s[6],O=s[7],D=s[8],z=s[9],V=s[10],H=s[11],K=s[12],re=s[13],ne=s[14],ue=s[15],he=u[0],ge=u[1],ke=u[2],Ee=u[3];return c[0]=he*h+ge*w+ke*D+Ee*K,c[1]=he*p+ge*A+ke*z+Ee*re,c[2]=he*_+ge*R+ke*V+Ee*ne,c[3]=he*v+ge*O+ke*H+Ee*ue,c[4]=(he=u[4])*h+(ge=u[5])*w+(ke=u[6])*D+(Ee=u[7])*K,c[5]=he*p+ge*A+ke*z+Ee*re,c[6]=he*_+ge*R+ke*V+Ee*ne,c[7]=he*v+ge*O+ke*H+Ee*ue,c[8]=(he=u[8])*h+(ge=u[9])*w+(ke=u[10])*D+(Ee=u[11])*K,c[9]=he*p+ge*A+ke*z+Ee*re,c[10]=he*_+ge*R+ke*V+Ee*ne,c[11]=he*v+ge*O+ke*H+Ee*ue,c[12]=(he=u[12])*h+(ge=u[13])*w+(ke=u[14])*D+(Ee=u[15])*K,c[13]=he*p+ge*A+ke*z+Ee*re,c[14]=he*_+ge*R+ke*V+Ee*ne,c[15]=he*v+ge*O+ke*H+Ee*ue,c}function X(c,s,u){var h,p,_,v,w,A,R,O,D,z,V,H,K=u[0],re=u[1],ne=u[2];return s===c?(c[12]=s[0]*K+s[4]*re+s[8]*ne+s[12],c[13]=s[1]*K+s[5]*re+s[9]*ne+s[13],c[14]=s[2]*K+s[6]*re+s[10]*ne+s[14],c[15]=s[3]*K+s[7]*re+s[11]*ne+s[15]):(p=s[1],_=s[2],v=s[3],w=s[4],A=s[5],R=s[6],O=s[7],D=s[8],z=s[9],V=s[10],H=s[11],c[0]=h=s[0],c[1]=p,c[2]=_,c[3]=v,c[4]=w,c[5]=A,c[6]=R,c[7]=O,c[8]=D,c[9]=z,c[10]=V,c[11]=H,c[12]=h*K+w*re+D*ne+s[12],c[13]=p*K+A*re+z*ne+s[13],c[14]=_*K+R*re+V*ne+s[14],c[15]=v*K+O*re+H*ne+s[15]),c}function ie(c,s,u){var h=u[0],p=u[1],_=u[2];return c[0]=s[0]*h,c[1]=s[1]*h,c[2]=s[2]*h,c[3]=s[3]*h,c[4]=s[4]*p,c[5]=s[5]*p,c[6]=s[6]*p,c[7]=s[7]*p,c[8]=s[8]*_,c[9]=s[9]*_,c[10]=s[10]*_,c[11]=s[11]*_,c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c}function de(c,s,u){var h=Math.sin(u),p=Math.cos(u),_=s[4],v=s[5],w=s[6],A=s[7],R=s[8],O=s[9],D=s[10],z=s[11];return s!==c&&(c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[4]=_*p+R*h,c[5]=v*p+O*h,c[6]=w*p+D*h,c[7]=A*p+z*h,c[8]=R*p-_*h,c[9]=O*p-v*h,c[10]=D*p-w*h,c[11]=z*p-A*h,c}function fe(c,s,u){var h=Math.sin(u),p=Math.cos(u),_=s[0],v=s[1],w=s[2],A=s[3],R=s[8],O=s[9],D=s[10],z=s[11];return s!==c&&(c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=_*p-R*h,c[1]=v*p-O*h,c[2]=w*p-D*h,c[3]=A*p-z*h,c[8]=_*h+R*p,c[9]=v*h+O*p,c[10]=w*h+D*p,c[11]=A*h+z*p,c}function be(c,s,u){var h=Math.sin(u),p=Math.cos(u),_=s[0],v=s[1],w=s[2],A=s[3],R=s[4],O=s[5],D=s[6],z=s[7];return s!==c&&(c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=_*p+R*h,c[1]=v*p+O*h,c[2]=w*p+D*h,c[3]=A*p+z*h,c[4]=R*p-_*h,c[5]=O*p-v*h,c[6]=D*p-w*h,c[7]=z*p-A*h,c}function ve(c,s){return c[0]=s[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=s[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=s[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Je(c,s,u){var h,p,_,v=u[0],w=u[1],A=u[2],R=Math.sqrt(v*v+w*w+A*A);return R<y?null:(v*=R=1/R,w*=R,A*=R,h=Math.sin(s),p=Math.cos(s),c[0]=v*v*(_=1-p)+p,c[1]=w*v*_+A*h,c[2]=A*v*_-w*h,c[3]=0,c[4]=v*w*_-A*h,c[5]=w*w*_+p,c[6]=A*w*_+v*h,c[7]=0,c[8]=v*A*_+w*h,c[9]=w*A*_-v*h,c[10]=A*A*_+p,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c)}function we(c,s){var u=s[0],h=s[1],p=s[2],_=s[4],v=s[5],w=s[6],A=s[8],R=s[9],O=s[10];return c[0]=Math.sqrt(u*u+h*h+p*p),c[1]=Math.sqrt(_*_+v*v+w*w),c[2]=Math.sqrt(A*A+R*R+O*O),c}function rt(c,s){var u=s[0],h=s[1],p=s[2],_=s[3],v=u+u,w=h+h,A=p+p,R=u*v,O=h*v,D=h*w,z=p*v,V=p*w,H=p*A,K=_*v,re=_*w,ne=_*A;return c[0]=1-D-H,c[1]=O+ne,c[2]=z-re,c[3]=0,c[4]=O-ne,c[5]=1-R-H,c[6]=V+K,c[7]=0,c[8]=z+re,c[9]=V-K,c[10]=1-R-D,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}var He=$;function ft(){var c=new x(3);return x!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function Ct(c){var s=new x(3);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s}function Nt(c){var s=c[0],u=c[1],h=c[2];return Math.sqrt(s*s+u*u+h*h)}function Rt(c,s,u){var h=new x(3);return h[0]=c,h[1]=s,h[2]=u,h}function en(c,s,u,h){return c[0]=s,c[1]=u,c[2]=h,c}function nt(c,s,u){return c[0]=s[0]+u[0],c[1]=s[1]+u[1],c[2]=s[2]+u[2],c}function pt(c,s,u){return c[0]=s[0]-u[0],c[1]=s[1]-u[1],c[2]=s[2]-u[2],c}function Oe(c,s,u){return c[0]=s[0]*u[0],c[1]=s[1]*u[1],c[2]=s[2]*u[2],c}function gn(c,s,u){return c[0]=Math.min(s[0],u[0]),c[1]=Math.min(s[1],u[1]),c[2]=Math.min(s[2],u[2]),c}function wt(c,s,u){return c[0]=Math.max(s[0],u[0]),c[1]=Math.max(s[1],u[1]),c[2]=Math.max(s[2],u[2]),c}function Fe(c,s,u){return c[0]=s[0]*u,c[1]=s[1]*u,c[2]=s[2]*u,c}function jt(c,s,u,h){return c[0]=s[0]+u[0]*h,c[1]=s[1]+u[1]*h,c[2]=s[2]+u[2]*h,c}function Tn(c,s){var u=s[0]-c[0],h=s[1]-c[1],p=s[2]-c[2];return Math.sqrt(u*u+h*h+p*p)}function mn(c,s){var u=s[0]-c[0],h=s[1]-c[1],p=s[2]-c[2];return u*u+h*h+p*p}function zn(c){var s=c[0],u=c[1],h=c[2];return s*s+u*u+h*h}function yn(c,s){return c[0]=-s[0],c[1]=-s[1],c[2]=-s[2],c}function qt(c,s){var u=s[0],h=s[1],p=s[2],_=u*u+h*h+p*p;return _>0&&(_=1/Math.sqrt(_)),c[0]=s[0]*_,c[1]=s[1]*_,c[2]=s[2]*_,c}function wn(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]}function Sn(c,s,u){var h=s[0],p=s[1],_=s[2],v=u[0],w=u[1],A=u[2];return c[0]=p*A-_*w,c[1]=_*v-h*A,c[2]=h*w-p*v,c}function Xn(c,s,u,h){var p=s[0],_=s[1],v=s[2];return c[0]=p+h*(u[0]-p),c[1]=_+h*(u[1]-_),c[2]=v+h*(u[2]-v),c}function rn(c,s,u){var h=s[0],p=s[1],_=s[2],v=u[3]*h+u[7]*p+u[11]*_+u[15];return c[0]=(u[0]*h+u[4]*p+u[8]*_+u[12])/(v=v||1),c[1]=(u[1]*h+u[5]*p+u[9]*_+u[13])/v,c[2]=(u[2]*h+u[6]*p+u[10]*_+u[14])/v,c}function br(c,s,u){var h=s[0],p=s[1],_=s[2];return c[0]=h*u[0]+p*u[3]+_*u[6],c[1]=h*u[1]+p*u[4]+_*u[7],c[2]=h*u[2]+p*u[5]+_*u[8],c}function Qr(c,s,u){var h=u[0],p=u[1],_=u[2],v=u[3],w=s[0],A=s[1],R=s[2],O=p*R-_*A,D=_*w-h*R,z=h*A-p*w;return c[0]=w+v*(O+=O)+p*(z+=z)-_*(D+=D),c[1]=A+v*D+_*O-h*z,c[2]=R+v*z+h*D-p*O,c}function sr(c){return c[0]=0,c[1]=0,c[2]=0,c}function ar(c,s){return c[0]===s[0]&&c[1]===s[1]&&c[2]===s[2]}var Vn=pt,wr=Oe,ys=Nt;function Si(){var c=new x(4);return x!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0,c[3]=0),c}function Ri(c,s,u){return c[0]=s[0]*u,c[1]=s[1]*u,c[2]=s[2]*u,c[3]=s[3]*u,c}function ks(c,s){var u=s[0],h=s[1],p=s[2],_=s[3],v=u*u+h*h+p*p+_*_;return v>0&&(v=1/Math.sqrt(v)),c[0]=u*v,c[1]=h*v,c[2]=p*v,c[3]=_*v,c}function $i(c,s,u){var h=s[0],p=s[1],_=s[2],v=s[3];return c[0]=u[0]*h+u[4]*p+u[8]*_+u[12]*v,c[1]=u[1]*h+u[5]*p+u[9]*_+u[13]*v,c[2]=u[2]*h+u[6]*p+u[10]*_+u[14]*v,c[3]=u[3]*h+u[7]*p+u[11]*_+u[15]*v,c}function Ws(){var c=new x(4);return x!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function Kt(c){return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c}function An(c,s,u){u*=.5;var h=s[0],p=s[1],_=s[2],v=s[3],w=Math.sin(u),A=Math.cos(u);return c[0]=h*A+v*w,c[1]=p*A+_*w,c[2]=_*A-p*w,c[3]=v*A-h*w,c}function Lr(c,s,u){u*=.5;var h=s[0],p=s[1],_=s[2],v=s[3],w=Math.sin(u),A=Math.cos(u);return c[0]=h*A-_*w,c[1]=p*A+v*w,c[2]=_*A+h*w,c[3]=v*A-p*w,c}ft(),Si();var Tt,kn,nr,dt=ks,Qn=(Tt=ft(),kn=Rt(1,0,0),nr=Rt(0,1,0),function(c,s,u){var h=wn(s,u);return h<-.999999?(Sn(Tt,kn,s),ys(Tt)<1e-6&&Sn(Tt,nr,s),qt(Tt,Tt),function(p,_,v){v*=.5;var w=Math.sin(v);p[0]=w*_[0],p[1]=w*_[1],p[2]=w*_[2],p[3]=Math.cos(v)}(c,Tt,Math.PI),c):h>.999999?(c[0]=0,c[1]=0,c[2]=0,c[3]=1,c):(Sn(Tt,s,u),c[0]=Tt[0],c[1]=Tt[1],c[2]=Tt[2],c[3]=1+h,dt(c,c))});function ti(){var c=new x(2);return x!=Float32Array&&(c[0]=0,c[1]=0),c}function Zi(c,s){var u=new x(2);return u[0]=c,u[1]=s,u}function Is(c,s,u){return c[0]=s,c[1]=u,c}function Ln(c,s,u){return c[0]=s[0]+u[0],c[1]=s[1]+u[1],c}function Hn(c,s,u){return c[0]=s[0]-u[0],c[1]=s[1]-u[1],c}function Ke(c,s,u){return c[0]=s[0]*u,c[1]=s[1]*u,c}function sn(c){var s=c[0],u=c[1];return Math.sqrt(s*s+u*u)}function bn(c,s){var u=s[0],h=s[1],p=u*u+h*h;return p>0&&(p=1/Math.sqrt(p)),c[0]=s[0]*p,c[1]=s[1]*p,c}function kr(c,s){return c[0]*s[0]+c[1]*s[1]}Ws(),Ws(),C();var In,Ki,Ta=Hn;function Ns(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}ti();var Ht=function(){if(Ki)return In;function c(s,u,h,p){this.cx=3*s,this.bx=3*(h-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(p-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=u,this.p2x=h,this.p2y=p}return Ki=1,In=c,c.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,u){if(u===void 0&&(u=1e-6),s<0)return 0;if(s>1)return 1;for(var h=s,p=0;p<8;p++){var _=this.sampleCurveX(h)-s;if(Math.abs(_)<u)return h;var v=this.sampleCurveDerivativeX(h);if(Math.abs(v)<1e-6)break;h-=_/v}var w=0,A=1;for(h=s,p=0;p<20&&(_=this.sampleCurveX(h),!(Math.abs(_-s)<u));p++)s>_?w=h:A=h,h=.5*(A-w)+w;return h},solve:function(s,u){return this.sampleCurveY(this.solveCurveX(s,u))}},In}(),Dn=Ns(Ht);function je(c,s){this.x=c,this.y=s}function jn(c,s){if(Array.isArray(c)){if(!Array.isArray(s)||c.length!==s.length)return!1;for(let u=0;u<c.length;u++)if(!jn(c[u],s[u]))return!1;return!0}if(typeof c=="object"&&c!==null&&s!==null){if(typeof s!="object"||Object.keys(c).length!==Object.keys(s).length)return!1;for(const u in c)if(!jn(c[u],s[u]))return!1;return!0}return c===s}je.prototype={clone(){return new je(this.x,this.y)},add(c){return this.clone()._add(c)},sub(c){return this.clone()._sub(c)},multByPoint(c){return this.clone()._multByPoint(c)},divByPoint(c){return this.clone()._divByPoint(c)},mult(c){return this.clone()._mult(c)},div(c){return this.clone()._div(c)},rotate(c){return this.clone()._rotate(c)},rotateAround(c,s){return this.clone()._rotateAround(c,s)},matMult(c){return this.clone()._matMult(c)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(c){return this.x===c.x&&this.y===c.y},dist(c){return Math.sqrt(this.distSqr(c))},distSqr(c){const s=c.x-this.x,u=c.y-this.y;return s*s+u*u},angle(){return Math.atan2(this.y,this.x)},angleTo(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith(c){return this.angleWithSep(c.x,c.y)},angleWithSep(c,s){return Math.atan2(this.x*s-this.y*c,this.x*c+this.y*s)},_matMult(c){const s=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=s,this},_add(c){return this.x+=c.x,this.y+=c.y,this},_sub(c){return this.x-=c.x,this.y-=c.y,this},_mult(c){return this.x*=c,this.y*=c,this},_div(c){return this.x/=c,this.y/=c,this},_multByPoint(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint(c){return this.x/=c.x,this.y/=c.y,this},_unit(){return this._div(this.mag()),this},_perp(){const c=this.y;return this.y=this.x,this.x=-c,this},_rotate(c){const s=Math.cos(c),u=Math.sin(c),h=u*this.x+s*this.y;return this.x=s*this.x-u*this.y,this.y=h,this},_rotateAround(c,s){const u=Math.cos(c),h=Math.sin(c),p=s.y+h*(this.x-s.x)+u*(this.y-s.y);return this.x=s.x+u*(this.x-s.x)-h*(this.y-s.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:je},je.convert=function(c){if(c instanceof je)return c;if(Array.isArray(c))return new je(+c[0],+c[1]);if(c.x!==void 0&&c.y!==void 0)return new je(+c.x,+c.y);throw new Error("Expected [x, y] or {x, y} point format")};const Ir=Math.PI/180,Gn=180/Math.PI;function cn(c){return c*Ir}function xr(c){return c*Gn}const Qs=[[0,0],[1,0],[1,1],[0,1]];function Sr(c){if(c<=0)return 0;if(c>=1)return 1;const s=c*c,u=s*c;return 4*(c<.5?u:3*(c-s)+u-.75)}function Mi(c,s,u,h){const p=new Dn(c,s,u,h);return function(_){return p.solve(_)}}const Ye=Mi(.25,.1,.25,1);function ee(c,s,u){return Math.min(u,Math.max(s,c))}function le(c,s,u){return(u=ee((u-c)/(s-c),0,1))*u*(3-2*u)}function ye(c,s,u){const h=u-s,p=((c-s)%h+h)%h+s;return p===s?u:p}function Ne(c,s,u){if(!c.length)return u(null,[]);let h=c.length;const p=new Array(c.length);let _=null;c.forEach((v,w)=>{s(v,(A,R)=>{A&&(_=A),p[w]=R,--h==0&&u(_,p)})})}let Me=1;function Ve(){return Me++}function tt(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log2(c)))}function Ze(c,s){c.forEach(u=>{s[u]&&(s[u]=s[u].bind(s))})}function at(c,s,u){const h={};for(const p in c)h[p]=s.call(this,c[p],p,c);return h}function Mt(c,s,u){const h={};for(const p in c)s.call(this,c[p],p,c)&&(h[p]=c[p]);return h}function xt(c){return Array.isArray(c)?c.map(xt):typeof c=="object"&&c?at(c,xt):c}function dn(c,s){for(let u=0;u<c.length;u++)if(s.indexOf(c[u])>=0)return!0;return!1}const Mn={};function Qt(c){Mn[c]||(typeof console<"u"&&console.warn(c),Mn[c]=!0)}function Ar(c,s,u){return(u.y-c.y)*(s.x-c.x)>(s.y-c.y)*(u.x-c.x)}function lr(c){let s=0;for(let u,h,p=0,_=c.length,v=_-1;p<_;v=p++)u=c[p],h=c[v],s+=(h.x-u.x)*(u.y+h.y);return s}function Er([c,s,u]){const h=cn(s+90),p=cn(u);return{x:c*Math.cos(h)*Math.sin(p),y:c*Math.sin(h)*Math.sin(p),z:c*Math.cos(p),azimuthal:s,polar:u}}function ni(c){return(typeof self<"u"||c!==void 0)&&typeof WorkerGlobalScope<"u"&&(c!==void 0?c:self)instanceof WorkerGlobalScope}function Ms(c){const s={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,h,p,_)=>{const v=p||_;return s[h]=!v||v.toLowerCase(),""}),s["max-age"]){const u=parseInt(s["max-age"],10);isNaN(u)?delete s["max-age"]:s["max-age"]=u}return s}let as=null;function Qi(c,s){return[c[4*s],c[4*s+1],c[4*s+2],c[4*s+3]]}function vs(c,s,u,h){for(;s<u;){const p=s+u>>1;c[p]<h?s=p+1:u=p}return s}function Hi(c,s,u,h){for(;s<u;){const p=s+u>>1;c[p]<=h?s=p+1:u=p}return s}function $r(c){return c>0?1/(1.001-c):1+c}function Ps(c){return c>0?1-1/(1.001-c):-c}function Ji(c,s,u){return(c-s.min)*(u.max-u.min)/(s.max-s.min)+u.min}const ri={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ri.API_URL)return null;try{const c=new URL(ri.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ca(c){return ri.API_URL_REGEX.test(c)}function Ro(c){return ri.API_SPRITE_REGEX.test(c)}let jo,wo,ju,po,gu,_l;function Wc(){return jo==null&&(jo=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),jo}const To={now:()=>po!==void 0?po:performance.now(),setNow(c){po=c},restoreNow(){po=void 0},frame(c){const s=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(c,s=0){const{width:u,height:h}=c;gu||(gu=document.createElement("canvas"));const p=gu.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(u>gu.width||h>gu.height)&&(gu.width=u,gu.height=h),p.clearRect(-s,-s,u+2*s,h+2*s),p.drawImage(c,0,0,u,h),p.getImageData(-s,-s,u+2*s,h+2*s)},resolveURL:c=>(wo||(wo=document.createElement("a")),wo.href=c,wo.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(ju==null&&(ju=window.matchMedia("(prefers-reduced-motion: reduce)")),ju.matches)},hasCanvasFingerprintNoise(){if(_l!==void 0)return _l;if(!Wc())return _l=!1,!1;const c=new OffscreenCanvas(85,1),s=c.getContext("2d",{willReadFrequently:!0});let u=0;for(let p=0;p<c.width;++p)s.fillStyle=`rgba(${u++},${u++},${u++}, 255)`,s.fillRect(p,0,1,1);const h=s.getImageData(0,0,c.width,c.height);u=0;for(let p=0;p<h.data.length;++p)if(p%4!=3&&u++!==h.data[p])return _l=!0,!0;return _l=!1,!1}};function Mf(c,s){const u=c.indexOf("?");if(u<0)return`${c}?${new URLSearchParams(s).toString()}`;const h=new URLSearchParams(c.slice(u));for(const p in s)h.set(p,s[p]);return`${c.slice(0,u)}?${h.toString()}`}function Vp(c,s={persistentParams:[]}){const u=c.indexOf("?");if(u<0)return c;const h=new URLSearchParams,p=new URLSearchParams(c.slice(u));for(const v of s.persistentParams){const w=p.get(v);w&&h.set(v,w)}const _=h.toString();return`${c.slice(0,u)}${_.length>0?`?${_}`:""}`}const ey="mapbox-tiles";let ty=500,ny=50;const $0=["language","worldview","jobid"];let Xc,Nl;function _c(){try{return caches}catch{}}function yc(){const c=_c();c&&Xc==null&&(Xc=c.open(ey))}let Uu=1/0;const Yc={supported:!1,testSupport:function(c){!ry&&Pf&&(Of?SE(c):Ch=c)}};let Ch,Pf,ry=!1,Of=!1;const iy=typeof self<"u"?self:{};function SE(c){const s=c.createTexture();c.bindTexture(c.TEXTURE_2D,s);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Pf),c.isContextLost())return;Yc.supported=!0}catch{}c.deleteTexture(s),ry=!0}iy.document&&(Pf=iy.document.createElement("img"),Pf.onload=function(){Ch&&SE(Ch),Ch=null,Of=!0},Pf.onerror=function(){ry=!0,Ch=null},Pf.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const H0={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(H0);class Jl extends Error{constructor(s,u,h){u===401&&ca(h)&&(s+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(s),this.status=u,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const sy=ni()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Lf=function(c,s){if(!(/^file:/.test(u=c.url)||/^file:/.test(sy())&&!/^\w+:/.test(u))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(h,p){const _=new AbortController,v=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:sy(),referrerPolicy:h.referrerPolicy,signal:_.signal});let w=!1,A=!1;const R=(O=v.url).indexOf("sku=")>0&&ca(O);var O;h.type==="json"&&v.headers.set("Accept","application/json");const D=(V,H,K)=>{if(A)return;if(V&&V.message!=="SecurityError"&&Qt(V.toString()),H&&K)return z(H);const re=Date.now();fetch(v).then(ne=>{if(ne.ok){const ue=R?ne.clone():null;return z(ne,ue,re)}return p(new Jl(ne.statusText,ne.status,h.url))}).catch(ne=>{ne.name!=="AbortError"&&p(new Error(`${ne.message} ${h.url}`))})},z=(V,H,K)=>{(h.type==="arrayBuffer"?V.arrayBuffer():h.type==="json"?V.json():V.text()).then(re=>{A||(H&&K&&function(ne,ue,he){if(yc(),Xc==null)return;const ge=Ms(ue.headers.get("Cache-Control")||"");if(ge["no-store"])return;const ke={status:ue.status,statusText:ue.statusText,headers:new Headers};ue.headers.forEach((Be,$e)=>ke.headers.set($e,Be)),ge["max-age"]&&ke.headers.set("Expires",new Date(he+1e3*ge["max-age"]).toUTCString());const Ee=ke.headers.get("Expires");if(!Ee||new Date(Ee).getTime()-he<42e4)return;let Pe=Vp(ne.url,{persistentParams:$0});if(ue.status===206){const Be=ne.headers.get("Range");if(!Be)return;ke.status=200,Pe=Mf(Pe,{range:Be})}(function(Be,$e){if(Nl===void 0)try{new Response(new ReadableStream),Nl=!0}catch{Nl=!1}Nl?$e(Be.body):Be.blob().then($e).catch(mt=>Qt(mt.message))})(ue,Be=>{const $e=new Response((mt=ue.status)!==200&&mt!==404&&[101,103,204,205,304].includes(mt)?null:Be,ke);var mt;yc(),Xc!=null&&Xc.then(Xe=>Xe.put(Pe,$e)).catch(Xe=>Qt(Xe.message))})}(v,H,K),w=!0,p(null,re,V.headers))}).catch(re=>{A||p(new Error(re.message))})};return R?function(V,H){if(yc(),Xc==null)return H(null);Xc.then(K=>{let re=Vp(V.url,{persistentParams:$0});const ne=V.headers.get("Range");ne&&(re=Mf(re,{range:ne})),K.match(re).then(ue=>{const he=function(ge){if(!ge)return!1;const ke=new Date(ge.headers.get("Expires")||0),Ee=Ms(ge.headers.get("Cache-Control")||"");return Number(ke)>Date.now()&&!Ee["no-cache"]}(ue);K.delete(re).catch(H),he&&K.put(re,ue.clone()).catch(H),H(null,ue,he)}).catch(H)}).catch(H)}(v,D):D(null,null),{cancel:()=>{A=!0,w||_.abort()}}}(c,s);if(ni(self)&&self.worker.actor)return self.worker.actor.send("getResource",c,s,void 0,!0)}var u;return function(h,p){const _=new XMLHttpRequest;_.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const v in h.headers)_.setRequestHeader(v,h.headers[v]);return h.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=h.credentials==="include",_.onerror=()=>{p(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let v=_.response;if(h.type==="json")try{v=JSON.parse(_.response)}catch(A){return p(A)}const w=new Headers;_.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(A=>{const R=A.split(": "),O=R.shift(),D=R.join(": ");w.append(O,D)}),p(null,v,w)}else p(new Jl(_.statusText,_.status,h.url))},_.send(h.body),{cancel:()=>_.abort()}}(c,s)},Rd=function(c,s){return Lf(Object.assign(c,{type:"arrayBuffer"}),s)};function hI(c){const s=document.createElement("a");return s.href=c,s.protocol===location.protocol&&s.host===location.host}const AE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let G0,Li;G0=[],Li=0;const ay=function(c,s){if(Yc.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Li>=ri.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:c,callback:s,cancelled:!1,cancel(){this.cancelled=!0}};return G0.push(_),_}Li++;let u=!1;const h=()=>{if(!u)for(u=!0,Li--;G0.length&&Li<ri.MAX_PARALLEL_IMAGE_REQUESTS;){const _=G0.shift(),{requestParameters:v,callback:w,cancelled:A}=_;A||(_.cancel=ay(v,w).cancel)}},p=Rd(c,(_,v,w)=>{h(),_?s(_):v&&(self.createImageBitmap?function(A,R){const O=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(O).then(D=>{R(null,D)}).catch(D=>{R(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(A,R)=>s(A,R,w)):function(A,R){const O=new Image;O.onload=()=>{R(null,O),URL.revokeObjectURL(O.src),O.onload=null,requestAnimationFrame(()=>{O.src=AE})},O.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Blob([new Uint8Array(A)],{type:"image/png"});O.src=A.byteLength?URL.createObjectURL(D):AE}(v,(A,R)=>s(A,R,w)))});return{cancel:()=>{p.cancel(),h()}}};var Zx,CE,kE,kh={exports:{}},q0={exports:{}},Z0={exports:{}},Wx=function(){if(kE)return kh.exports;kE=1;var c=(Zx||(Zx=1,q0.exports=function(u,h){var p,_,v,w,A,R,O,D;for(_=u.length-(p=3&u.length),v=h,A=3432918353,R=461845907,D=0;D<_;)O=255&u.charCodeAt(D)|(255&u.charCodeAt(++D))<<8|(255&u.charCodeAt(++D))<<16|(255&u.charCodeAt(++D))<<24,++D,v=27492+(65535&(w=5*(65535&(v=(v^=O=(65535&(O=(O=(65535&O)*A+(((O>>>16)*A&65535)<<16)&4294967295)<<15|O>>>17))*R+(((O>>>16)*R&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(O=0,p){case 3:O^=(255&u.charCodeAt(D+2))<<16;case 2:O^=(255&u.charCodeAt(D+1))<<8;case 1:v^=O=(65535&(O=(O=(65535&(O^=255&u.charCodeAt(D)))*A+(((O>>>16)*A&65535)<<16)&4294967295)<<15|O>>>17))*R+(((O>>>16)*R&65535)<<16)&4294967295}return v^=u.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}),q0.exports),s=(CE||(CE=1,Z0.exports=function(u,h){for(var p,_=u.length,v=h^_,w=0;_>=4;)p=1540483477*(65535&(p=255&u.charCodeAt(w)|(255&u.charCodeAt(++w))<<8|(255&u.charCodeAt(++w))<<16|(255&u.charCodeAt(++w))<<24))+((1540483477*(p>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),_-=4,++w;switch(_){case 3:v^=(255&u.charCodeAt(w+2))<<16;case 2:v^=(255&u.charCodeAt(w+1))<<8;case 1:v=1540483477*(65535&(v^=255&u.charCodeAt(w)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}),Z0.exports);return kh.exports=c,kh.exports.murmur3=c,kh.exports.murmur2=s,kh.exports}(),oy=Ns(Wx);class Kc{constructor(s,...u){Object.assign(this,u[0]||{}),this.type=s}}class W0 extends Kc{constructor(s,u={}){super("error",Object.assign({error:s},u))}}function Xx(c,s,u){u[c]&&u[c].indexOf(s)!==-1||(u[c]=u[c]||[],u[c].push(s))}function Ih(c,s,u){if(u&&u[c]){const h=u[c].indexOf(s);h!==-1&&u[c].splice(h,1)}}class Df{on(s,u){return this._listeners=this._listeners||{},Xx(s,u,this._listeners),this}off(s,u){return Ih(s,u,this._listeners),Ih(s,u,this._oneTimeListeners),this}once(s,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Xx(s,u,this._oneTimeListeners),this):new Promise(h=>{this.once(s,h)})}fire(s,u){const h=typeof s=="string"?new Kc(s,u):s,p=h.type;if(this.listens(p)){h.target=this;const _=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const A of _)A.call(this,h);const v=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const A of v)Ih(p,A,this._oneTimeListeners),A.call(this,h);const w=this._eventedParent;if(w){const A=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(h,A),w.fire(h)}}else h instanceof W0&&console.error(h.error);return this}listens(s){return!!(this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s))}setEventedParent(s,u){return this._eventedParent=s,this._eventedParentData=u,this}}class yl{constructor(s){typeof s=="string"?this.name=s:(this.name=s.name,this.iconsetId=s.iconsetId)}static from(s){return new yl(s)}static toString(s){return s.iconsetId?`${s.name}${s.iconsetId}`:s.name}static parse(s){const[u,h]=s.split("");return new yl({name:u,iconsetId:h})}static isEqual(s,u){return s.name===u.name&&s.iconsetId===u.iconsetId}toString(){return yl.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var ly,X0={},Vu=function(){if(ly)return X0;ly=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(_){return(_=Math.round(_))<0?0:_>255?255:_}function u(_){return s(_[_.length-1]==="%"?parseFloat(_)/100*255:parseInt(_))}function h(_){return(v=_[_.length-1]==="%"?parseFloat(_)/100:parseFloat(_))<0?0:v>1?1:v;var v}function p(_,v,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?_+(v-_)*w*6:2*w<1?v:3*w<2?_+(v-_)*(2/3-w)*6:_}try{X0.parseCSSColor=function(_){var v,w=_.replace(/ /g,"").toLowerCase();if(w in c)return c[w].slice();if(w[0]==="#")return w.length===4?(v=parseInt(w.substr(1),16))>=0&&v<=4095?[(3840&v)>>4|(3840&v)>>8,240&v|(240&v)>>4,15&v|(15&v)<<4,1]:null:w.length===7&&(v=parseInt(w.substr(1),16))>=0&&v<=16777215?[(16711680&v)>>16,(65280&v)>>8,255&v,1]:null;var A=w.indexOf("("),R=w.indexOf(")");if(A!==-1&&R+1===w.length){var O=w.substr(0,A),D=w.substr(A+1,R-(A+1)).split(","),z=1;switch(O){case"rgba":if(D.length!==4)return null;z=h(D.pop());case"rgb":return D.length!==3?null:[u(D[0]),u(D[1]),u(D[2]),z];case"hsla":if(D.length!==4)return null;z=h(D.pop());case"hsl":if(D.length!==3)return null;var V=(parseFloat(D[0])%360+360)%360/360,H=h(D[1]),K=h(D[2]),re=K<=.5?K*(H+1):K+H-K*H,ne=2*K-re;return[s(255*p(ne,re,V+1/3)),s(255*p(ne,re,V)),s(255*p(ne,re,V-1/3)),z];default:return null}}return null}}catch{}return X0}();class ts{constructor(s,u,h,p=1){this.r=s,this.g=u,this.b=h,this.a=p}static parse(s){if(!s)return;if(s instanceof ts)return s;if(typeof s!="string")return;const u=Vu.parseCSSColor(s);return u?new ts(u[0]/255,u[1]/255,u[2]/255,u[3]):void 0}toString(){const[s,u,h,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*s)},${Math.round(255*u)},${Math.round(255*h)},${p})`}toNonPremultipliedRenderColor(s){const{r:u,g:h,b:p,a:_}=this;return new RE(s,u,h,p,_)}toPremultipliedRenderColor(s){const{r:u,g:h,b:p,a:_}=this;return new ME(s,u*_,h*_,p*_,_)}clone(){return new ts(this.r,this.g,this.b,this.a)}}class IE{constructor(s,u,h,p,_,v=!1){if(this.premultiplied=!1,this.premultiplied=v,s){const w=s.image.height,A=w*w;this.premultiplied?(u=_===0?0:u/_*(w-1),h=_===0?0:h/_*(w-1),p=_===0?0:p/_*(w-1)):(u*=w-1,h*=w-1,p*=w-1);const R=Math.floor(u),O=Math.floor(h),D=Math.floor(p),z=Math.ceil(u),V=Math.ceil(h),H=Math.ceil(p),K=u-R,re=h-O,ne=p-D,ue=s.image.data,he=4*(R+O*A+D*w),ge=4*(R+O*A+H*w),ke=4*(R+V*A+D*w),Ee=4*(R+V*A+H*w),Pe=4*(z+O*A+D*w),Be=4*(z+O*A+H*w),$e=4*(z+V*A+D*w),mt=4*(z+V*A+H*w);if(he<0||mt>=ue.length)throw new Error("out of range");this.r=Tr(Tr(Tr(ue[he],ue[ge],ne),Tr(ue[ke],ue[Ee],ne),re),Tr(Tr(ue[Pe],ue[Be],ne),Tr(ue[$e],ue[mt],ne),re),K)/255*(this.premultiplied?_:1),this.g=Tr(Tr(Tr(ue[he+1],ue[ge+1],ne),Tr(ue[ke+1],ue[Ee+1],ne),re),Tr(Tr(ue[Pe+1],ue[Be+1],ne),Tr(ue[$e+1],ue[mt+1],ne),re),K)/255*(this.premultiplied?_:1),this.b=Tr(Tr(Tr(ue[he+2],ue[ge+2],ne),Tr(ue[ke+2],ue[Ee+2],ne),re),Tr(Tr(ue[Pe+2],ue[Be+2],ne),Tr(ue[$e+2],ue[mt+2],ne),re),K)/255*(this.premultiplied?_:1),this.a=_}else this.r=u,this.g=h,this.b=p,this.a=_}toArray(){const{r:s,g:u,b:h,a:p}=this;return[255*s,255*u,255*h,p]}toHslaArray(){let{r:s,g:u,b:h,a:p}=this;if(this.premultiplied){if(p===0)return[0,0,0,0];const H=1/p;s*=H,u*=H,h*=H}const _=Math.min(Math.max(s,0),1),v=Math.min(Math.max(u,0),1),w=Math.min(Math.max(h,0),1),A=Math.min(_,v,w),R=Math.max(_,v,w),O=R-A,D=.5*(A+R);if(O===0)return[0,0,100*D,p];const z=D>.5?O/(2-R-A):O/(R+A);let V;switch(R){case _:V=60*((v-w)/O+(v<w?6:0));break;case v:V=60*((w-_)/O+2);break;default:V=60*((_-v)/O+4)}return[V,100*z,100*D,p]}toArray01(){const{r:s,g:u,b:h,a:p}=this;return[s,u,h,p]}toArray01Scaled(s){const{r:u,g:h,b:p}=this;return[u*s,h*s,p*s]}toArray01Linear(){const{r:s,g:u,b:h,a:p}=this;return[Math.pow(s,2.2),Math.pow(u,2.2),Math.pow(h,2.2),p]}}class RE extends IE{constructor(s,u,h,p,_){super(s,u,h,p,_,!1)}}class ME extends IE{constructor(s,u,h,p,_){super(s,u,h,p,_,!0)}}function Tr(c,s,u){return c*(1-u)+s*u}function Yx(c,s,u){return c.map((h,p)=>Tr(h,s[p],u))}ts.black=new ts(0,0,0,1),ts.white=new ts(1,1,1,1),ts.transparent=new ts(0,0,0,0),ts.red=new ts(1,0,0,1),ts.blue=new ts(0,0,1,1);var Y0=Object.freeze({__proto__:null,array:Yx,color:function(c,s,u){return new ts(Tr(c.r,s.r,u),Tr(c.g,s.g,u),Tr(c.b,s.b,u),Tr(c.a,s.a,u))},number:Tr});class $u extends Error{constructor(s,u){super(u),this.message=u,this.key=s}}class $p{constructor(s,u=[]){this.parent=s,this.bindings={};for(const[h,p]of u)this.bindings[h]=p}concat(s){return new $p(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const vc={kind:"null"},$n={kind:"number"},Ai={kind:"string"},os={kind:"boolean"},zl={kind:"color"},Qc={kind:"object"},es={kind:"value"},uy={kind:"collator"},K0={kind:"formatted"},Q0={kind:"resolvedImage"};function il(c,s){return{kind:"array",itemType:c,N:s}}function Za(c){if(c.kind==="array"){const s=Za(c.itemType);return typeof c.N=="number"?`array<${s}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${s}>`}return c.kind}const fI=[vc,$n,Ai,os,zl,K0,Qc,il(es),Q0];function Rh(c,s){if(s.kind==="error")return null;if(c.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Rh(c.itemType,s.itemType))&&(typeof c.N!="number"||c.N===s.N))return null}else{if(c.kind===s.kind)return null;if(c.kind==="value"){for(const u of fI)if(!Rh(u,s))return null}}return`Expected ${Za(c)} but found ${Za(s)} instead.`}function Kx(c,s){return s.some(u=>u.kind===c.kind)}function J0(c,s){return s.some(u=>u==="null"?c===null:u==="array"?Array.isArray(c):u==="object"?c&&!Array.isArray(c)&&typeof c=="object":u===typeof c)}function cy(c,s){return c.kind==="array"&&s.kind==="array"?c.N===s.N&&cy(c.itemType,s.itemType):c.kind===s.kind}class Qx{constructor(s,u,h){this.sensitivity=s?u?"variant":"case":u?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,u){return this.collator.compare(s,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dy{constructor(s,u,h,p,_){this.text=s.normalize?s.normalize():s,this.image=u,this.scale=h,this.fontStack=p,this.textColor=_}}class El{constructor(s){this.sections=s}static fromString(s){return new El([new dy(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||!!s.image&&s.image.hasPrimary())}static factory(s){return s instanceof El?s:El.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}serialize(){const s=["format"];for(const u of this.sections){if(u.image){const p=u.image.getPrimary().id.toString();s.push(["image",p]);continue}s.push(u.text);const h={};u.fontStack&&(h["text-font"]=["literal",u.fontStack.split(",")]),u.scale&&(h["font-scale"]=u.scale),u.textColor&&(h["text-color"]=["rgba"].concat(u.textColor.toNonPremultipliedRenderColor(null).toArray())),s.push(h)}return s}}class Md{constructor(s,u={}){this.id=yl.from(s),this.params=u.params,this.sx=u.sx||1,this.sy=u.sy||1}toString(){return JSON.stringify(this)}static parse(s){let u,h,p,_;try{({id:u,params:h,sx:p,sy:_}=JSON.parse(s)||{})}catch{return null}return u?new Md(u,{params:h,sx:p,sy:_}):null}scaleSelf(s,u=s){return this.sx*=s,this.sy*=u,this}}class Sl{constructor(s,u,h,p,_=!1){this.primaryId=yl.from(s),this.primaryOptions=u,h&&(this.secondaryId=yl.from(h)),this.secondaryOptions=p,this.available=_}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Md(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Md(this.secondaryId,this.secondaryOptions):null}static from(s){return typeof s=="string"?Sl.build({name:s}):s}static build(s,u,h,p){return!s||typeof s=="object"&&!("name"in s)?null:new Sl(s,h,u,p)}}function Nf(c,s,u,h){return typeof c=="number"&&c>=0&&c<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof u=="number"&&u>=0&&u<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[c,s,u,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[c,s,u,h]:[c,s,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Hp(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof ts||c instanceof Qx||c instanceof El||c instanceof Sl)return!0;if(Array.isArray(c)){for(const s of c)if(!Hp(s))return!1;return!0}if(typeof c=="object"){for(const s in c)if(!Hp(c[s]))return!1;return!0}return!1}function Eo(c){if(c===null)return vc;if(typeof c=="string")return Ai;if(typeof c=="boolean")return os;if(typeof c=="number")return $n;if(c instanceof ts)return zl;if(c instanceof Qx)return uy;if(c instanceof El)return K0;if(c instanceof Sl)return Q0;if(Array.isArray(c)){const s=c.length;let u;for(const h of c){const p=Eo(h);if(u){if(u===p)continue;u=es;break}u=p}return il(u||es,s)}return Qc}function Hu(c){const s=typeof c;return c===null?"":s==="string"||s==="number"||s==="boolean"?String(c):c instanceof El||c instanceof Sl||c instanceof ts?c.toString():JSON.stringify(c)}class Pd{constructor(s,u){this.type=s,this.value=u}static parse(s,u){if(s.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!Hp(s[1]))return u.error("invalid value");const h=s[1];let p=Eo(h);const _=u.expectedType;return p.kind!=="array"||p.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(p=_),new Pd(p,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ts?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof El?this.value.serialize():this.value}}class mo{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const Jx={string:Ai,number:$n,boolean:os,object:Qc};class xc{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");let h,p=1;const _=s[0];if(_==="array"){let w,A;if(s.length>2){const R=s[1];if(typeof R!="string"||!(R in Jx)||R==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);w=Jx[R],p++}else w=es;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return u.error('The length argument to "array" must be a positive integer literal',2);A=s[2],p++}h=il(w,A)}else h=Jx[_];const v=[];for(;p<s.length;p++){const w=u.parse(s[p],p,es);if(!w)return null;v.push(w)}return new xc(h,v)}evaluate(s){for(let u=0;u<this.args.length;u++){const h=this.args[u].evaluate(s);if(!Rh(this.type,Eo(h)))return h;if(u===this.args.length-1)throw new mo(`The expression ${JSON.stringify(this.args[u].serialize())} evaluated to ${Za(Eo(h))} but was expected to be of type ${Za(this.type)}.`)}return null}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=this.type,u=[s.kind];if(s.kind==="array"){const h=s.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){u.push(h.kind);const p=s.N;(typeof p=="number"||this.args.length>1)&&u.push(p)}}return u.concat(this.args.map(h=>h.serialize()))}}class Jc{constructor(s){this.type=K0,this.sections=s}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");const h=s[1];if(!Array.isArray(h)&&typeof h=="object")return u.error("First argument must be an image or text section.");const p=[];let _=!1;for(let v=1;v<=s.length-1;++v){const w=s[v];if(_&&typeof w=="object"&&!Array.isArray(w)){_=!1;let A=null;if(w["font-scale"]&&(A=u.parseObjectValue(w["font-scale"],v,"font-scale",$n),!A))return null;let R=null;if(w["text-font"]&&(R=u.parseObjectValue(w["text-font"],v,"text-font",il(Ai)),!R))return null;let O=null;if(w["text-color"]&&(O=u.parseObjectValue(w["text-color"],v,"text-color",zl),!O))return null;const D=p[p.length-1];D.scale=A,D.font=R,D.textColor=O}else{const A=u.parse(s[v],v,es);if(!A)return null;const R=A.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:A,scale:null,font:null,textColor:null})}}return new Jc(p)}evaluate(s){return new El(this.sections.map(u=>{const h=u.content.evaluate(s);return cy(Eo(h),Q0)?new dy("",h,null,null,null):new dy(Hu(h),null,u.scale?u.scale.evaluate(s):null,u.font?u.font.evaluate(s).join(","):null,u.textColor?u.textColor.evaluate(s):null)}))}eachChild(s){for(const u of this.sections)s(u.content),u.scale&&s(u.scale),u.font&&s(u.font),u.textColor&&s(u.textColor)}outputDefined(){return!1}serialize(){const s=["format"];for(const u of this.sections){s.push(u.content.serialize());const h={};u.scale&&(h["font-scale"]=u.scale.serialize()),u.font&&(h["text-font"]=u.font.serialize()),u.textColor&&(h["text-color"]=u.textColor.serialize()),s.push(h)}return s}}class Vr{constructor(s,u,h,p){this._imageWarnHistory={},this.type=Q0,this.namePrimary=s,this.nameSecondary=u,h&&(this.paramsPrimary=h.params,this.iconsetIdPrimary=h.iconset?h.iconset.id:void 0),p&&(this.paramsSecondary=p.params,this.iconsetIdSecondary=p.iconset?p.iconset.id:void 0)}static parse(s,u){if(s.length<2)return u.error("Expected two or more arguments.");let h=1;const p=[];function _(){if(h<s.length){const w=u.parse(s[h],h++,Ai);return w?(p.push({image:w,options:{}}),!0):(u.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function v(){if(h<s.length){const A=s[h];if((w=A)===null||typeof w!="object"||Array.isArray(w))return!0;const R=A.params,O=A.iconset,D=u.concat(h);if(!R&&!O)return h++,!0;if(R){if(typeof R!="object"||R.constructor!==Object)return D.error('Image options "params" should be an object'),!1;const z={},V=D.concat(void 0,"params");for(const H in R){if(!H)return V.error("Image parameter name should be non-empty"),!1;const K=V.concat(void 0,H).parse(R[H],void 0,zl,void 0,{typeAnnotation:"coerce"});if(!K)return!1;z[H]=K}p[p.length-1].options.params=z}if(O){if(typeof O!="object"||O.constructor!==Object)return D.error('Image options "iconset" should be an object'),!1;if(!O.id)return D.error('Image options "iconset" should have an "id" property'),!1;p[p.length-1].options.iconset=O}return h++,!0}var w;return!0}for(let w=0;w<2;w++)if(!_()||!v())return;return new Vr(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(s,u){const h={};if(u){for(const p in u)if(u[p])try{h[p]=u[p].evaluate(s)}catch{continue}if(Object.keys(h).length!==0)return{params:h}}}evaluate(s){const u={name:this.namePrimary.evaluate(s),iconsetId:this.iconsetIdPrimary},h=this.nameSecondary?{name:this.nameSecondary.evaluate(s),iconsetId:this.iconsetIdSecondary}:void 0,p=Sl.build(u,h,this.paramsPrimary?this.evaluateParams(s,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(s,this.paramsSecondary):void 0);if(p&&s.availableImages){const _=p.getPrimary().id;if(p.available=s.availableImages.some(v=>yl.isEqual(v,_)),p.available){const v=p.getSecondary()?p.getSecondary().id:null;v&&(p.available=s.availableImages.some(w=>yl.isEqual(w,v)))}}return p}eachChild(s){if(s(this.namePrimary),this.paramsPrimary)for(const u in this.paramsPrimary)this.paramsPrimary[u]&&s(this.paramsPrimary[u]);if(this.nameSecondary&&(s(this.nameSecondary),this.paramsSecondary))for(const u in this.paramsSecondary)this.paramsSecondary[u]&&s(this.paramsSecondary[u])}outputDefined(){return!1}serializeOptions(s,u){const h={};if(u&&(h.iconset={id:u}),s){h.params={};for(const p in s)s[p]&&(h.params[p]=s[p].serialize())}return Object.keys(h).length>0?h:void 0}serialize(){const s=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const u=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);u&&s.push(u)}if(this.nameSecondary&&(s.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const u=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);u&&s.push(u)}return s}}function Fn(c){return Mr(c)?"string":Gp(c)?"number":fy(c)?"boolean":Array.isArray(c)?"array":c===null?"null":hy(c)?"object":typeof c}function hy(c){return c!=null&&!Array.isArray(c)&&typeof c!="function"&&!(c instanceof String||c instanceof Number||c instanceof Boolean)&&typeof c=="object"}function Mr(c){return typeof c=="string"||c instanceof String}function Gp(c){return typeof c=="number"||c instanceof Number}function fy(c){return typeof c=="boolean"||c instanceof Boolean}const Rr={"to-boolean":os,"to-color":zl,"to-number":$n,"to-string":Ai};class ed{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");const h=s[0],p=[];let _=vc;if(h==="to-array"){if(!Array.isArray(s[1]))return null;const v=s[1].length;if(u.expectedType){if(u.expectedType.kind!=="array")return u.error(`Expected ${u.expectedType.kind} but found array.`);_=il(u.expectedType.itemType,v)}else{if(!(v>0&&Hp(s[1][0])))return null;_=il(Eo(s[1][0]),v)}for(let w=0;w<v;w++){const A=s[1][w];let R;if(Array.isArray(A))R=u.parse(A,void 0,_.itemType);else{const O=Fn(A);if(O!==_.itemType.kind)return u.error(`Expected ${_.itemType.kind} but found ${O}.`);R=u.registry.literal.parse(["literal",A===void 0?null:A],u)}if(!R)return null;p.push(R)}}else{if((h==="to-boolean"||h==="to-string")&&s.length!==2)return u.error("Expected one argument.");_=Rr[h];for(let v=1;v<s.length;v++){const w=u.parse(s[v],v,es);if(!w)return null;p.push(w)}}return new ed(_,p)}evaluate(s){if(this.type.kind==="boolean")return!!this.args[0].evaluate(s);if(this.type.kind==="color"){let u,h;for(const p of this.args){if(u=p.evaluate(s),h=null,u instanceof ts)return u;if(typeof u=="string"){const _=s.parseColor(u);if(_)return _}else if(Array.isArray(u)&&(h=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Nf(u[0],u[1],u[2],u[3]),!h))return new ts(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new mo(h||`Could not parse color from value '${typeof u=="string"?u:String(JSON.stringify(u))}'`)}if(this.type.kind==="number"){let u=null;for(const h of this.args){if(u=h.evaluate(s),u===null)return 0;const p=Number(u);if(!isNaN(p))return p}throw new mo(`Could not convert ${JSON.stringify(u)} to number.`)}return this.type.kind==="formatted"?El.fromString(Hu(this.args[0].evaluate(s))):this.type.kind==="resolvedImage"?Sl.build(Hu(this.args[0].evaluate(s))):this.type.kind==="array"?this.args.map(u=>u.evaluate(s)):Hu(this.args[0].evaluate(s))}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Jc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Vr(this.args[0]).serialize();const s=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(u=>{s.push(u.serialize())}),s}}const eb=["Unknown","Point","LineString","Polygon"];class py{constructor(s,u,h){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=s,this.options=u,this.iconImageUseTheme=h}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?eb[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(s){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,u=this.featureDistanceData.scale,{x:h,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*u-s[0])+this.featureDistanceData.bearing[1]*(p*u-s[1])}return 0}parseColor(s){let u=this._parseColorCache[s];return u||(u=this._parseColorCache[s]=ts.parse(s)),u}getConfig(s){return this.options?this.options.get(s):null}}class Al{constructor(s,u,h,p,_){this.name=s,this.type=u,this._evaluate=h,this.args=p,this._overloadIndex=_}evaluate(s){if(!this._evaluate){const u=Al.definitions[this.name];this._evaluate=Array.isArray(u)?u[2]:u.overloads[this._overloadIndex][1]}return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(s=>s.serialize()))}static parse(s,u){const h=s[0],p=Al.definitions[h];if(!p)return u.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(p)?p[0]:p.type,v=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=[];let A=null,R=-1;for(const[O,D]of v){if(Array.isArray(O)&&O.length!==s.length-1)continue;w.push(O),R++,A=new Ay(u.registry,u.path,null,u.scope,void 0,u._scope,u.options,u.iconImageUseTheme);const z=[];let V=!1;for(let H=1;H<s.length;H++){const K=s[H],re=Array.isArray(O)?O[H-1]:O.type,ne=A.parse(K,1+z.length,re);if(!ne){V=!0;break}z.push(ne)}if(!V)if(Array.isArray(O)&&O.length!==z.length)A.error(`Expected ${O.length} arguments, but found ${z.length} instead.`);else{for(let H=0;H<z.length;H++){const K=Array.isArray(O)?O[H]:O.type,re=z[H];A.concat(H+1).checkSubtype(K,re.type)}if(A.errors.length===0)return new Al(h,_,D,z,R)}}if(w.length===1)u.errors.push(...A.errors);else{const O=(w.length?w:v.map(([z])=>z)).map(my).join(" | "),D=[];for(let z=1;z<s.length;z++){const V=u.parse(s[z],1+D.length);if(!V)return null;D.push(Za(V.type))}u.error(`Expected arguments of type ${O}, but found (${D.join(", ")}) instead.`)}return null}static register(s,u){Al.definitions=u;for(const h in u)s[h]=Al}}function my(c){return Array.isArray(c)?`(${c.map(Za).join(", ")})`:`(${Za(c.type)}...)`}class Mo{constructor(s,u,h){this.type=uy,this.locale=h,this.caseSensitive=s,this.diacriticSensitive=u}static parse(s,u){if(s.length!==2)return u.error("Expected one argument.");const h=s[1];if(typeof h!="object"||Array.isArray(h))return u.error("Collator options argument must be an object.");const p=h["case-sensitive"]===void 0?u.parse(!1,1,os):u.parseObjectValue(h["case-sensitive"],1,"case-sensitive",os);if(!p)return null;const _=h["diacritic-sensitive"]===void 0?u.parse(!1,1,os):u.parseObjectValue(h["diacritic-sensitive"],1,"diacritic-sensitive",os);if(!_)return null;let v=null;return h.locale&&(v=u.parseObjectValue(h.locale,1,"locale",Ai),!v)?null:new Mo(p,_,v)}evaluate(s){return new Qx(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}serialize(){const s={};return s["case-sensitive"]=this.caseSensitive.serialize(),s["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(s.locale=this.locale.serialize()),["collator",s]}}function gy(c,s,u=0,h=c.length-1,p=tb){for(;h>u;){if(h-u>600){const A=h-u+1,R=s-u+1,O=Math.log(A),D=.5*Math.exp(2*O/3),z=.5*Math.sqrt(O*D*(A-D)/A)*(R-A/2<0?-1:1);gy(c,s,Math.max(u,Math.floor(s-R*D/A+z)),Math.min(h,Math.floor(s+(A-R)*D/A+z)),p)}const _=c[s];let v=u,w=h;for(bc(c,u,s),p(c[h],_)>0&&bc(c,u,h);v<w;){for(bc(c,v,w),v++,w--;p(c[v],_)<0;)v++;for(;p(c[w],_)>0;)w--}p(c[u],_)===0?bc(c,u,w):(w++,bc(c,w,h)),w<=s&&(u=w+1),s<=w&&(h=w-1)}}function bc(c,s,u){const h=c[s];c[s]=c[u],c[u]=h}function tb(c,s){return c<s?-1:c>s?1:0}function Mh(c){let s=0;for(let u,h,p=0,_=c.length,v=_-1;p<_;v=p++)u=c[p],h=c[v],s+=(h.x-u.x)*(u.y+h.y);return s}function Gu(c,s){c[0]=Math.min(c[0],s[0]),c[1]=Math.min(c[1],s[1]),c[2]=Math.max(c[2],s[0]),c[3]=Math.max(c[3],s[1])}function eg(c,s){return!(c[0]<=s[0]||c[2]>=s[2]||c[1]<=s[1]||c[3]>=s[3])}function pI(c,s,u){const h=c[0]-s[0],p=c[1]-s[1],_=c[0]-u[0],v=c[1]-u[1];return h*v-_*p==0&&h*_<=0&&p*v<=0}function qp(c,s,u=!1){let h=!1;for(let w=0,A=s.length;w<A;w++){const R=s[w];for(let O=0,D=R.length,z=D-1;O<D;z=O++){const V=R[z],H=R[O];if(pI(c,V,H))return u;(_=V)[1]>(p=c)[1]!=(v=H)[1]>p[1]&&p[0]<(v[0]-_[0])*(p[1]-_[1])/(v[1]-_[1])+_[0]&&(h=!h)}}var p,_,v;return h}function tg(c,s,u,h){const p=h[0]-u[0],_=h[1]-u[1],v=(c[0]-u[0])*_-p*(c[1]-u[1]),w=(s[0]-u[0])*_-p*(s[1]-u[1]);return v>0&&w<0||v<0&&w>0}function ng(c,s,u,h){return(p=[h[0]-u[0],h[1]-u[1]])[0]*(_=[s[0]-c[0],s[1]-c[1]])[1]-p[1]*_[0]!=0&&!(!tg(c,s,u,h)||!tg(u,h,c,s));var p,_}function Od(c){const s=new je(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),u=new je(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const h of c[0])s.x>h.x&&(s.x=h.x),s.y>h.y&&(s.y=h.y),u.x<h.x&&(u.x=h.x),u.y<h.y&&(u.y=h.y);return{min:s,max:u}}const Ph=8192;function mI(c,s){const u=(180+c[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,p=Math.pow(2,s.z);return[Math.round(u*p*Ph),Math.round(h*p*Ph)]}function nb(c,s){for(let u=0;u<s.length;u++)if(qp(c,s[u]))return!0;return!1}function gI(c,s,u){for(const h of u)for(let p=0,_=h.length,v=_-1;p<_;v=p++)if(ng(c,s,h[v],h[p]))return!0;return!1}function PE(c,s){for(let u=0;u<c.length;++u)if(!qp(c[u],s))return!1;for(let u=0;u<c.length-1;++u)if(gI(c[u],c[u+1],s))return!1;return!0}function OE(c,s){for(let u=0;u<s.length;u++)if(PE(c,s[u]))return!0;return!1}function rb(c,s,u){const h=[];for(let p=0;p<c.length;p++){const _=[];for(let v=0;v<c[p].length;v++){const w=mI(c[p][v],u);Gu(s,w),_.push(w)}h.push(_)}return h}function Oh(c,s,u){const h=[];for(let p=0;p<c.length;p++){const _=rb(c[p],s,u);h.push(_)}return h}function LE(c,s,u,h){if(c[0]<u[0]||c[0]>u[2]){const p=.5*h;let _=c[0]-u[0]>p?-h:u[0]-c[0]>p?h:0;_===0&&(_=c[0]-u[2]>p?-h:u[2]-c[0]>p?h:0),c[0]+=_}Gu(s,c)}function DE(c,s,u,h){const p=Math.pow(2,h.z)*Ph,_=[h.x*Ph,h.y*Ph],v=[];if(!c)return v;for(const w of c)for(const A of w){const R=[A.x+_[0],A.y+_[1]];LE(R,s,u,p),v.push(R)}return v}function _y(c,s,u,h){const p=Math.pow(2,h.z)*Ph,_=[h.x*Ph,h.y*Ph],v=[];if(!c)return v;for(const A of c){const R=[];for(const O of A){const D=[O.x+_[0],O.y+_[1]];Gu(s,D),R.push(D)}v.push(R)}if(s[2]-s[0]<=p/2){(w=s)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const A of v)for(const R of A)LE(R,s,u,p)}var w;return v}class Lh{constructor(s,u){this.type=os,this.geojson=s,this.geometries=u}static parse(s,u){if(s.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(Hp(s[1])){const h=s[1];if(h.type==="FeatureCollection")for(let p=0;p<h.features.length;++p){const _=h.features[p].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Lh(h,h.features[p].geometry)}else if(h.type==="Feature"){const p=h.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Lh(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Lh(h,h)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(u,h){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=u.canonicalID();if(!v)return!1;if(h.type==="Polygon"){const w=rb(h.coordinates,_,v),A=DE(u.geometry(),p,_,v);if(!eg(p,_))return!1;for(const R of A)if(!qp(R,w))return!1}if(h.type==="MultiPolygon"){const w=Oh(h.coordinates,_,v),A=DE(u.geometry(),p,_,v);if(!eg(p,_))return!1;for(const R of A)if(!nb(R,w))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(u,h){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=u.canonicalID();if(!v)return!1;if(h.type==="Polygon"){const w=rb(h.coordinates,_,v),A=_y(u.geometry(),p,_,v);if(!eg(p,_))return!1;for(const R of A)if(!PE(R,w))return!1}if(h.type==="MultiPolygon"){const w=Oh(h.coordinates,_,v),A=_y(u.geometry(),p,_,v);if(!eg(p,_))return!1;for(const R of A)if(!OE(R,w))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const rg={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},qu=1/298.257223563,NE=qu*(2-qu),Zp=Math.PI/180;class Wp{static fromTile(s,u,h){const p=Math.PI*(1-2*(s+.5)/Math.pow(2,u)),_=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/Zp;return new Wp(_,h)}static get units(){return rg}constructor(s,u){if(s===void 0)throw new Error("No latitude given.");if(u&&!rg[u])throw new Error(`Unknown unit ${u}. Use one of: ${Object.keys(rg).join(", ")}`);const h=6378.137*Zp*(u?rg[u]:1),p=Math.cos(s*Zp),_=1/(1-NE*(1-p*p)),v=Math.sqrt(_);this.kx=h*v*p,this.ky=h*v*_*(1-NE)}distance(s,u){const h=_u(s[0]-u[0])*this.kx,p=(s[1]-u[1])*this.ky;return Math.sqrt(h*h+p*p)}bearing(s,u){const h=_u(u[0]-s[0])*this.kx;return Math.atan2(h,(u[1]-s[1])*this.ky)/Zp}destination(s,u,h){const p=h*Zp;return this.offset(s,Math.sin(p)*u,Math.cos(p)*u)}offset(s,u,h){return[s[0]+u/this.kx,s[1]+h/this.ky]}lineDistance(s){let u=0;for(let h=0;h<s.length-1;h++)u+=this.distance(s[h],s[h+1]);return u}area(s){let u=0;for(let h=0;h<s.length;h++){const p=s[h];for(let _=0,v=p.length,w=v-1;_<v;w=_++)u+=_u(p[_][0]-p[w][0])*(p[_][1]+p[w][1])*(h?-1:1)}return Math.abs(u)/2*this.kx*this.ky}along(s,u){let h=0;if(u<=0)return s[0];for(let p=0;p<s.length-1;p++){const _=s[p],v=s[p+1],w=this.distance(_,v);if(h+=w,h>u)return yy(_,v,(u-(h-w))/w)}return s[s.length-1]}pointToSegmentDistance(s,u,h){let[p,_]=u,v=_u(h[0]-p)*this.kx,w=(h[1]-_)*this.ky;if(v!==0||w!==0){const A=(_u(s[0]-p)*this.kx*v+(s[1]-_)*this.ky*w)/(v*v+w*w);A>1?(p=h[0],_=h[1]):A>0&&(p+=v/this.kx*A,_+=w/this.ky*A)}return v=_u(s[0]-p)*this.kx,w=(s[1]-_)*this.ky,Math.sqrt(v*v+w*w)}pointOnLine(s,u){let h=1/0,p=s[0][0],_=s[0][1],v=0,w=0;for(let A=0;A<s.length-1;A++){let R=s[A][0],O=s[A][1],D=_u(s[A+1][0]-R)*this.kx,z=(s[A+1][1]-O)*this.ky,V=0;D===0&&z===0||(V=(_u(u[0]-R)*this.kx*D+(u[1]-O)*this.ky*z)/(D*D+z*z),V>1?(R=s[A+1][0],O=s[A+1][1]):V>0&&(R+=D/this.kx*V,O+=z/this.ky*V)),D=_u(u[0]-R)*this.kx,z=(u[1]-O)*this.ky;const H=D*D+z*z;H<h&&(h=H,p=R,_=O,v=A,w=V)}return{point:[p,_],index:v,t:Math.max(0,Math.min(1,w))}}lineSlice(s,u,h){let p=this.pointOnLine(h,s),_=this.pointOnLine(h,u);if(p.index>_.index||p.index===_.index&&p.t>_.t){const R=p;p=_,_=R}const v=[p.point],w=p.index+1,A=_.index;!ib(h[w],v[0])&&w<=A&&v.push(h[w]);for(let R=w+1;R<=A;R++)v.push(h[R]);return ib(h[A],_.point)||v.push(_.point),v}lineSliceAlong(s,u,h){let p=0;const _=[];for(let v=0;v<h.length-1;v++){const w=h[v],A=h[v+1],R=this.distance(w,A);if(p+=R,p>s&&_.length===0&&_.push(yy(w,A,(s-(p-R))/R)),p>=u)return _.push(yy(w,A,(u-(p-R))/R)),_;p>s&&_.push(A)}return _}bufferPoint(s,u){const h=u/this.ky,p=u/this.kx;return[s[0]-p,s[1]-h,s[0]+p,s[1]+h]}bufferBBox(s,u){const h=u/this.ky,p=u/this.kx;return[s[0]-p,s[1]-h,s[2]+p,s[3]+h]}insideBBox(s,u){return _u(s[0]-u[0])>=0&&_u(s[0]-u[2])<=0&&s[1]>=u[1]&&s[1]<=u[3]}}function ib(c,s){return c[0]===s[0]&&c[1]===s[1]}function yy(c,s,u){const h=_u(s[0]-c[0]);return[c[0]+h*u,c[1]+(s[1]-c[1])*u]}function _u(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class vy{constructor(s=[],u=(h,p)=>h<p?-1:h>p?1:0){if(this.data=s,this.length=this.data.length,this.compare=u,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:u,compare:h}=this,p=u[s];for(;s>0;){const _=s-1>>1,v=u[_];if(h(p,v)>=0)break;u[s]=v,s=_}u[s]=p}_down(s){const{data:u,compare:h}=this,p=this.length>>1,_=u[s];for(;s<p;){let v=1+(s<<1);const w=v+1;if(w<this.length&&h(u[w],u[v])<0&&(v=w),h(u[v],_)>=0)break;u[s]=u[v],s=v}u[s]=_}}var Jt=8192;function sb(c,s){return s.dist-c.dist}const xy=100,by=50;function ab(c){const s=[1/0,1/0,-1/0,-1/0];if(s.length!==c.length)return!1;for(let u=0;u<s.length;u++)if(s[u]!==c[u])return!1;return!0}function ig(c){return c[1]-c[0]+1}function td(c,s){const u=c[1]>=c[0]&&c[1]<s;return u||console.warn("Distance Expression: Index is out of range"),u}function ob(c,s){if(c[0]>c[1])return[null,null];const u=ig(c);if(s){if(u===2)return[c,null];const h=Math.floor(u/2);return[[c[0],c[0]+h],[c[0]+h,c[1]]]}{if(u===1)return[c,null];const h=Math.floor(u/2)-1;return[[c[0],c[0]+h],[c[0]+h+1,c[1]]]}}function zf(c,s){const u=[1/0,1/0,-1/0,-1/0];if(!td(s,c.length))return u;for(let h=s[0];h<=s[1];++h)Gu(u,c[h]);return u}function Ff(c){const s=[1/0,1/0,-1/0,-1/0];for(let u=0;u<c.length;++u)for(let h=0;h<c[u].length;++h)Gu(s,c[u][h]);return s}function Dh(c,s,u){if(ab(c)||ab(s))return NaN;let h=0,p=0;return c[2]<s[0]&&(h=s[0]-c[2]),c[0]>s[2]&&(h=c[0]-s[2]),c[1]>s[3]&&(p=c[1]-s[3]),c[3]<s[1]&&(p=s[1]-c[3]),u.distance([0,0],[h,p])}function wy(c){return 360*c-180}function zE(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Ty(c,s){const u=Math.pow(2,s.z),h=(c.y/Jt+s.y)/u;return[wy((c.x/Jt+s.x)/u),zE(h)]}function _I(c,s){const u=[];for(let h=0;h<c.length;++h)u.push(Ty(c[h],s));return u}function FE(c,s,u){const h=u.pointOnLine(s,c).point;return u.distance(c,h)}function lb(c,s,u,h,p){const _=u.slice(h[0],h[1]+1);let v=1/0;for(let w=s[0];w<=s[1];++w)if((v=Math.min(v,FE(c[w],_,p)))===0)return 0;return v}function Nh(c,s,u,h,p){const _=Math.min(p.pointToSegmentDistance(c,u,h),p.pointToSegmentDistance(s,u,h)),v=Math.min(p.pointToSegmentDistance(u,c,s),p.pointToSegmentDistance(h,c,s));return Math.min(_,v)}function Ci(c,s,u,h,p){if(!td(s,c.length)||!td(h,u.length))return NaN;let _=1/0;for(let v=s[0];v<s[1];++v)for(let w=h[0];w<h[1];++w){if(ng(c[v],c[v+1],u[w],u[w+1]))return 0;_=Math.min(_,Nh(c[v],c[v+1],u[w],u[w+1],p))}return _}function yI(c,s,u,h,p){if(!td(s,c.length)||!td(h,u.length))return NaN;let _=1/0;for(let v=s[0];v<=s[1];++v)for(let w=h[0];w<=h[1];++w)if((_=Math.min(_,p.distance(c[v],u[w])))===0)return _;return _}function vI(c,s,u){if(qp(c,s,!0))return 0;let h=1/0;for(const p of s){const _=p.length;if(_<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[_-1]&&(h=Math.min(h,u.pointToSegmentDistance(c,p[_-1],p[0])))===0||(h=Math.min(h,FE(c,p,u)))===0)return h}return h}function xI(c,s,u,h){if(!td(s,c.length))return NaN;for(let _=s[0];_<=s[1];++_)if(qp(c[_],u,!0))return 0;let p=1/0;for(let _=s[0];_<s[1];++_)for(const v of u)for(let w=0,A=v.length,R=A-1;w<A;R=w++){if(ng(c[_],c[_+1],v[R],v[w]))return 0;p=Math.min(p,Nh(c[_],c[_+1],v[R],v[w],h))}return p}function ub(c,s){for(const u of c)for(let h=0;h<=u.length-1;++h)if(qp(u[h],s,!0))return!0;return!1}function bI(c,s,u,h=1/0){const p=Ff(c),_=Ff(s);if(h!==1/0&&Dh(p,_,u)>=h)return h;if(eg(p,_)){if(ub(c,s))return 0}else if(ub(s,c))return 0;let v=h;for(const w of c)for(let A=0,R=w.length,O=R-1;A<R;O=A++)for(const D of s)for(let z=0,V=D.length,H=V-1;z<V;H=z++){if(ng(w[O],w[A],D[H],D[z]))return 0;v=Math.min(v,Nh(w[O],w[A],D[H],D[z],u))}return v}function aa(c,s,u,h,p,_,v){if(_===null||v===null)return;const w=Dh(zf(h,_),zf(p,v),u);w<s&&c.push({dist:w,range1:_,range2:v})}function wI(c,s,u,h,p=1/0){let _=Math.min(h.distance(c[0],u[0][0]),p);if(_===0)return _;const v=new vy([{dist:0,range1:[0,c.length-1],range2:[0,0]}],sb),w=s?by:xy,A=Ff(u);for(;v.length;){const R=v.pop();if(R.dist>=_)continue;const O=R.range1;if(ig(O)<=w){if(!td(O,c.length))return NaN;if(s){const D=xI(c,O,u,h);if((_=Math.min(_,D))===0)return _}else for(let D=O[0];D<=O[1];++D){const z=vI(c[D],u,h);if((_=Math.min(_,z))===0)return _}}else{const D=ob(O,s);if(D[0]!==null){const z=Dh(zf(c,D[0]),A,h);z<_&&v.push({dist:z,range1:D[0],range2:[0,0]})}if(D[1]!==null){const z=Dh(zf(c,D[1]),A,h);z<_&&v.push({dist:z,range1:D[1],range2:[0,0]})}}}return _}function BE(c,s,u,h,p,_=1/0){let v=Math.min(_,p.distance(c[0],u[0]));if(v===0)return v;const w=new vy([{dist:0,range1:[0,c.length-1],range2:[0,u.length-1]}],sb),A=s?by:xy,R=h?by:xy;for(;w.length;){const O=w.pop();if(O.dist>=v)continue;const D=O.range1,z=O.range2;if(ig(D)<=A&&ig(z)<=R){if(!td(D,c.length)||!td(z,u.length))return NaN;if(s&&h?v=Math.min(v,Ci(c,D,u,z,p)):s||h?s&&!h?v=Math.min(v,lb(u,z,c,D,p)):!s&&h&&(v=Math.min(v,lb(c,D,u,z,p))):v=Math.min(v,yI(c,D,u,z,p)),v===0)return v}else{const V=ob(D,s),H=ob(z,h);aa(w,v,p,c,u,V[0],H[0]),aa(w,v,p,c,u,V[0],H[1]),aa(w,v,p,c,u,V[1],H[0]),aa(w,v,p,c,u,V[1],H[1])}}return v}function cb(c,s,u,h,p=1/0){let _=p;const v=zf(c,[0,c.length-1]);for(const w of u)if(!(_!==1/0&&Dh(v,zf(w,[0,w.length-1]),h)>=_)&&(_=Math.min(_,BE(c,s,w,!0,h,_)),_===0))return _;return _}function Ey(c,s,u,h,p=1/0){let _=p;const v=zf(c,[0,c.length-1]);for(const w of u){if(_!==1/0&&Dh(v,Ff(w),h)>=_)continue;const A=wI(c,s,w,h,_);if(isNaN(A))return A;if((_=Math.min(_,A))===0)return _}return _}function db(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class Bf{constructor(s,u){this.type=$n,this.geojson=s,this.geometries=u}static parse(s,u){if(s.length!==2)return u.error(`'distance' expression requires either one argument, but found ' ${s.length-1} instead.`);if(Hp(s[1])){const h=s[1];if(h.type==="FeatureCollection"){for(let p=0;p<h.features.length;++p)if(db(h.features[p].geometry.type))return new Bf(h,h.features[p].geometry)}else if(h.type==="Feature"){if(db(h.geometry.type))return new Bf(h,h.geometry)}else if(db(h.type))return new Bf(h,h)}return u.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(s){const u=s.geometry(),h=s.canonicalID();if(u!=null&&h!=null){if(s.geometryType()==="Point")return function(p,_,v){const w=[];for(const R of p)for(const O of R)w.push(Ty(O,_));const A=new Wp(w[0][1],"meters");return v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString"?BE(w,!1,v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",A):v.type==="MultiLineString"?cb(w,!1,v.coordinates,A):v.type==="Polygon"||v.type==="MultiPolygon"?Ey(w,!1,v.type==="Polygon"?[v.coordinates]:v.coordinates,A):null}(u,h,this.geometries);if(s.geometryType()==="LineString")return function(p,_,v){const w=[];for(const R of p){const O=[];for(const D of R)O.push(Ty(D,_));w.push(O)}const A=new Wp(w[0][0][1],"meters");if(v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString")return cb(v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",w,A);if(v.type==="MultiLineString"){let R=1/0;for(let O=0;O<v.coordinates.length;O++){const D=cb(v.coordinates[O],!0,w,A,R);if(isNaN(D))return D;if((R=Math.min(R,D))===0)return R}return R}if(v.type==="Polygon"||v.type==="MultiPolygon"){let R=1/0;for(let O=0;O<w.length;O++){const D=Ey(w[O],!0,v.type==="Polygon"?[v.coordinates]:v.coordinates,A,R);if(isNaN(D))return D;if((R=Math.min(R,D))===0)return R}return R}return null}(u,h,this.geometries);if(s.geometryType()==="Polygon")return function(p,_,v){const w=[];for(const R of function(O,D){const z=O.length;if(z<=1)return[O];const V=[];let H,K;for(let re=0;re<z;re++){const ne=Mh(O[re]);ne!==0&&(O[re].area=Math.abs(ne),K===void 0&&(K=ne<0),K===ne<0?(H&&V.push(H),H=[O[re]]):H.push(O[re]))}return H&&V.push(H),V}(p)){const O=[];for(let D=0;D<R.length;++D)O.push(_I(R[D],_));w.push(O)}const A=new Wp(w[0][0][0][1],"meters");if(v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString")return Ey(v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",w,A);if(v.type==="MultiLineString"){let R=1/0;for(let O=0;O<v.coordinates.length;O++){const D=Ey(v.coordinates[O],!0,w,A,R);if(isNaN(D))return D;if((R=Math.min(R,D))===0)return R}return R}return v.type==="Polygon"||v.type==="MultiPolygon"?function(R,O,D){let z=1/0;for(const V of R)for(const H of O){const K=bI(V,H,D,z);if(isNaN(K))return K;if((z=Math.min(z,K))===0)return z}return z}(v.type==="Polygon"?[v.coordinates]:v.coordinates,w,A):null}(u,h,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Xp(c){if(c instanceof Al&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Lh||c instanceof Bf)return!1;if(c instanceof Kp)return c.featureConstant;let s=!0;return c.eachChild(u=>{s&&!Xp(u)&&(s=!1)}),s}function sg(c){if(c instanceof Al&&c.name==="feature-state")return!1;let s=!0;return c.eachChild(u=>{s&&!sg(u)&&(s=!1)}),s}function Yp(c,s){if(c instanceof Al&&s.indexOf(c.name)>=0)return!1;let u=!0;return c.eachChild(h=>{u&&!Yp(h,s)&&(u=!1)}),u}function jE(c,s,u){return[c,s,u].filter(Boolean).join("")}function hb(c,s){switch(c){case"string":return Hu(s);case"number":return+s;case"boolean":return!!s;case"color":return ts.parse(s);case"formatted":return El.fromString(Hu(s));case"resolvedImage":return Sl.build(Hu(s))}return s}function UE(c,s,u,h){return h!==void 0&&(c=h*Math.round(c/h)),s!==void 0&&c<s&&(c=s),u!==void 0&&c>u&&(c=u),c}class Kp{constructor(s,u,h,p=!1){this.type=s,this.key=u,this.scope=h,this.featureConstant=p}static parse(s,u){let h=u.expectedType;if(h==null&&(h=es),s.length<2||s.length>3)return u.error("Invalid number of arguments for 'config' expression.");const p=u.parse(s[1],1);if(!(p instanceof Pd))return u.error("Key name of 'config' expression must be a string literal.");let _,v=!0;const w=Hu(p.value);if(s.length>=3){const A=u.parse(s[2],2);if(!(A instanceof Pd))return u.error("Scope of 'config' expression must be a string literal.");_=Hu(A.value)}if(u.options){const A=jE(w,_,u._scope),R=u.options.get(A);R&&(v=Xp(R.value||R.default))}return new Kp(h,w,_,v)}evaluate(s){const u=jE(this.key,this.scope,s.scope),h=s.getConfig(u);if(!h)return null;const{type:p,value:_,values:v,minValue:w,maxValue:A,stepValue:R}=h,O=h.default.evaluate(s);let D=O;if(_){const z=s.scope;s.scope=(z||"").split("").slice(1).join(""),D=_.evaluate(s),s.scope=z}return p&&(D=hb(p,D)),D===void 0||w===void 0&&A===void 0&&R===void 0||(typeof D=="number"?D=UE(D,w,A,R):Array.isArray(D)&&(D=D.map(z=>typeof z=="number"?UE(z,w,A,R):z))),_!==void 0&&D!==void 0&&v&&!v.includes(D)&&(D=O,p&&(D=hb(p,D))),(p&&p!==this.type||D!==void 0&&!cy(Eo(D),this.type))&&(D=hb(this.type.kind,D)),D}eachChild(){}outputDefined(){return!1}serialize(){const s=["config",this.key];return this.scope&&s.concat(this.scope),s}}class Sy{constructor(s,u){this.type=u.type,this.name=s,this.boundExpression=u}static parse(s,u){if(s.length!==2||typeof s[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const h=s[1];return u.scope.has(h)?new Sy(h,u.scope.get(h)):u.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ay{constructor(s,u=[],h,p=new $p,_=[],v,w,A){this.registry=s,this.path=u,this.key=u.map(R=>typeof R=="string"?`['${R}']`:`[${R}]`).join(""),this.scope=p,this.errors=_,this.expectedType=h,this._scope=v,this.options=w,this.iconImageUseTheme=A}parse(s,u,h,p,_={}){return u||h?this.concat(u,null,h,p)._parse(s,_):this._parse(s,_)}parseObjectValue(s,u,h,p,_,v={}){return this.concat(u,h,p,_)._parse(s,v)}_parse(s,u){function h(p,_,v){return v==="assert"?new xc(_,[p]):v==="coerce"?new ed(_,[p]):p}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof s[0]=="string"?this.registry[s[0]]:void 0;if(p){let _=p.parse(s,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,w=_.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||w.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(v,w))return null}else _=h(_,v,u.typeAnnotation||"coerce");else _=h(_,v,u.typeAnnotation||"assert")}if(!(_ instanceof Pd)&&_.type.kind!=="resolvedImage"&&fb(_)){const v=new py(this._scope,this.options,this.iconImageUseTheme);try{_=new Pd(_.type,_.evaluate(v))}catch(w){return this.error(w.message),null}}return _}return ed.parse(["to-array",s],this)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,u,h,p){let _=typeof s=="number"?this.path.concat(s):this.path;_=typeof u=="string"?_.concat(u):_;const v=p?this.scope.concat(p):this.scope;return new Ay(this.registry,_,h||null,v,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(s,...u){const h=`${this.key}${u.map(p=>`[${p}]`).join("")}`;this.errors.push(new $u(h,s))}checkSubtype(s,u){const h=Rh(s,u);return h&&this.error(h),h}}function fb(c){if(c instanceof Sy)return fb(c.boundExpression);if(c instanceof Al&&c.name==="error"||c instanceof Mo||c instanceof Lh||c instanceof Bf||c instanceof Kp)return!1;const s=c instanceof ed||c instanceof xc;let u=!0;return c.eachChild(h=>{u=s?u&&fb(h):u&&h instanceof Pd}),!!u&&Xp(c)&&Yp(c,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Cy(c,s){const u=c.length-1;let h,p,_=0,v=u,w=0;for(;_<=v;)if(w=Math.floor((_+v)/2),h=c[w],p=c[w+1],h<=s){if(w===u||s<p)return w;_=w+1}else{if(!(h>s))throw new mo("Input is not a number.");v=w-1}return 0}class ag{constructor(s,u,h){this.type=s,this.input=u,this.labels=[],this.outputs=[];for(const[p,_]of h)this.labels.push(p),this.outputs.push(_)}static parse(s,u){if(s.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");const h=u.parse(s[1],1,$n);if(!h)return null;const p=[];let _=null;u.expectedType&&u.expectedType.kind!=="value"&&(_=u.expectedType);for(let v=1;v<s.length;v+=2){const w=v===1?-1/0:s[v],A=s[v+1],R=v,O=v+1;if(typeof w!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(p.length&&p[p.length-1][0]>=w)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const D=u.parse(A,O,_);if(!D)return null;_=_||D.type,p.push([w,D])}return new ag(_,h,p)}evaluate(s){const u=this.labels,h=this.outputs;if(u.length===1)return h[0].evaluate(s);const p=this.input.evaluate(s);if(p<=u[0])return h[0].evaluate(s);const _=u.length;return p>=u[_-1]?h[_-1].evaluate(s):h[Cy(u,p)].evaluate(s)}eachChild(s){s(this.input);for(const u of this.outputs)s(u)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){const s=["step",this.input.serialize()];for(let u=0;u<this.labels.length;u++)u>0&&s.push(this.labels[u]),s.push(this.outputs[u].serialize());return s}}const VE=.95047,$E=1.08883,HE=4/29,Qp=6/29,GE=3*Qp*Qp,TI=Qp*Qp*Qp,EI=Math.PI/180,SI=180/Math.PI;function pb(c){return c>TI?Math.pow(c,1/3):c/GE+HE}function mb(c){return c>Qp?c*c*c:GE*(c-HE)}function gb(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function _b(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function qE(c){const s=_b(c.r),u=_b(c.g),h=_b(c.b),p=pb((.4124564*s+.3575761*u+.1804375*h)/VE),_=pb((.2126729*s+.7151522*u+.072175*h)/1);return{l:116*_-16,a:500*(p-_),b:200*(_-pb((.0193339*s+.119192*u+.9503041*h)/$E)),alpha:c.a}}function ky(c){let s=(c.l+16)/116,u=isNaN(c.a)?s:s+c.a/500,h=isNaN(c.b)?s:s-c.b/200;return s=1*mb(s),u=VE*mb(u),h=$E*mb(h),new ts(gb(3.2404542*u-1.5371385*s-.4985314*h),gb(-.969266*u+1.8760108*s+.041556*h),gb(.0556434*u-.2040259*s+1.0572252*h),c.alpha)}function Iy(c,s,u){const h=s-c;return c+u*(h>180||h<-180?h-360*Math.round(h/360):h)}const Jp={forward:qE,reverse:ky,interpolate:function(c,s,u){return{l:Tr(c.l,s.l,u),a:Tr(c.a,s.a,u),b:Tr(c.b,s.b,u),alpha:Tr(c.alpha,s.alpha,u)}}},og={forward:function(c){const{l:s,a:u,b:h}=qE(c),p=Math.atan2(h,u)*SI;return{h:p<0?p+360:p,c:Math.sqrt(u*u+h*h),l:s,alpha:c.a}},reverse:function(c){const s=c.h*EI,u=c.c;return ky({l:c.l,a:Math.cos(s)*u,b:Math.sin(s)*u,alpha:c.alpha})},interpolate:function(c,s,u){return{h:Iy(c.h,s.h,u),c:Tr(c.c,s.c,u),l:Tr(c.l,s.l,u),alpha:Tr(c.alpha,s.alpha,u)}}};var ZE=Object.freeze({__proto__:null,hcl:og,lab:Jp});class yu{constructor(s,u,h,p,_){this.type=s,this.operator=u,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(const[v,w]of _)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(s,u,h,p){let _=0;if(s.name==="exponential")_=Ry(u,s.base,h,p);else if(s.name==="linear")_=Ry(u,1,h,p);else if(s.name==="cubic-bezier"){const v=s.controlPoints;_=new Dn(v[0],v[1],v[2],v[3]).solve(Ry(u,1,h,p))}return _}static parse(s,u){let[h,p,_,...v]=s;if(!Array.isArray(p)||p.length===0)return u.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const R=p[1];if(typeof R!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:R}}else{if(p[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const R=p.slice(1);if(R.length!==4||R.some(O=>typeof O!="number"||O<0||O>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:R}}}if(s.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length-1>3&&(s.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(_=u.parse(_,2,$n),!_)return null;const w=[];let A=null;h==="interpolate-hcl"||h==="interpolate-lab"?A=zl:u.expectedType&&u.expectedType.kind!=="value"&&(A=u.expectedType);for(let R=0;R<v.length;R+=2){const O=v[R],D=v[R+1],z=R+3,V=R+4;if(typeof O!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(w.length&&w[w.length-1][0]>=O)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const H=u.parse(D,V,A);if(!H)return null;A=A||H.type,w.push([O,H])}return A.kind==="number"||A.kind==="color"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new yu(A,h,p,_,w):u.error(`Type ${Za(A)} is not interpolatable.`)}evaluate(s){const u=this.labels,h=this.outputs;if(u.length===1)return h[0].evaluate(s);const p=this.input.evaluate(s);if(p<=u[0])return h[0].evaluate(s);const _=u.length;if(p>=u[_-1])return h[_-1].evaluate(s);const v=Cy(u,p),w=yu.interpolationFactor(this.interpolation,p,u[v],u[v+1]),A=h[v].evaluate(s),R=h[v+1].evaluate(s);return this.operator==="interpolate"?Y0[this.type.kind.toLowerCase()](A,R,w):this.operator==="interpolate-hcl"?og.reverse(og.interpolate(og.forward(A),og.forward(R),w)):Jp.reverse(Jp.interpolate(Jp.forward(A),Jp.forward(R),w))}eachChild(s){s(this.input);for(const u of this.outputs)s(u)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){let s;s=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const u=[this.operator,s,this.input.serialize()];for(let h=0;h<this.labels.length;h++)u.push(this.labels[h],this.outputs[h].serialize());return u}}function Ry(c,s,u,h){const p=h-u,_=c-u;return p===0?0:s===1?_/p:(Math.pow(s,_)-1)/(Math.pow(s,p)-1)}class lg{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expectected at least one argument.");let h=null;const p=u.expectedType;p&&p.kind!=="value"&&(h=p);const _=[];for(const w of s.slice(1)){const A=u.parse(w,1+_.length,h,void 0,{typeAnnotation:"omit"});if(!A)return null;h=h||A.type,_.push(A)}const v=p&&_.some(w=>Rh(p,w.type));return new lg(v?es:h,_)}evaluate(s){let u,h=null,p=0;for(const _ of this.args){if(p++,h=_.evaluate(s),h&&h instanceof Sl&&!h.available&&(u||(u=h),h=null,p===this.args.length))return u;if(h!==null)break}return h}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=["coalesce"];return this.eachChild(u=>{s.push(u.serialize())}),s}}class Ld{constructor(s,u){this.type=u.type,this.bindings=[].concat(s),this.result=u}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const u of this.bindings)s(u[1]);s(this.result)}static parse(s,u){if(s.length<4)return u.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const h=[];for(let _=1;_<s.length-1;_+=2){const v=s[_];if(typeof v!="string")return u.error(`Expected string, but found ${typeof v} instead.`,_);if(/[^a-zA-Z0-9_]/.test(v))return u.error("Variable names must contain only alphanumeric characters or '_'.",_);const w=u.parse(s[_+1],_+1);if(!w)return null;h.push([v,w])}const p=u.parse(s[s.length-1],s.length-1,u.expectedType,h);return p?new Ld(h,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const s=["let"];for(const[u,h]of this.bindings)s.push(u,h.serialize());return s.push(this.result.serialize()),s}}class My{constructor(s,u,h){this.type=s,this.index=u,this.input=h}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const h=u.parse(s[1],1,$n),p=u.parse(s[2],2,il(u.expectedType||es));return h&&p?new My(p.type.itemType,h,p):null}evaluate(s){const u=this.index.evaluate(s),h=this.input.evaluate(s);if(u<0)throw new mo("Array index out of bounds: negative index");if(u>=h.length)throw new mo("Array index out of bounds: index exceeds array size");if(u!==Math.floor(u))throw new mo("Array index must be an integer. Use at-interpolated for fractional indices");return h[u]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Py{constructor(s,u,h){this.type=s,this.index=u,this.input=h}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const h=u.parse(s[1],1,$n),p=u.parse(s[2],2,il(u.expectedType||es));return h&&p?new Py(p.type.itemType,h,p):null}evaluate(s){const u=this.index.evaluate(s),h=this.input.evaluate(s);if(u<0)throw new mo(`Array index out of bounds: ${u} < 0.`);if(u>h.length-1)throw new mo(`Array index out of bounds: ${u} > ${h.length-1}.`);if(u===Math.floor(u))return h[u];const p=Math.floor(u),_=Math.ceil(u),v=h[p],w=h[_];if(typeof v!="number"||typeof w!="number")throw new mo(`Cannot interpolate between non-number values at index ${u}.`);const A=u-p;return v*(1-A)+w*A}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class yb{constructor(s,u){this.type=os,this.needle=s,this.haystack=u}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const h=u.parse(s[1],1,es),p=u.parse(s[2],2,es);return h&&p?Kx(h.type,[os,Ai,$n,vc,es])?new yb(h,p):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Za(h.type)} instead`):null}evaluate(s){const u=this.needle.evaluate(s),h=this.haystack.evaluate(s);if(h==null)return!1;if(!J0(u,["boolean","string","number","null"]))throw new mo(`Expected first argument to be of type boolean, string, number or null, but found ${Za(Eo(u))} instead.`);if(!J0(h,["string","array"]))throw new mo(`Expected second argument to be of type array or string, but found ${Za(Eo(h))} instead.`);return h.indexOf(u)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class em{constructor(s,u,h){this.type=$n,this.needle=s,this.haystack=u,this.fromIndex=h}static parse(s,u){if(s.length<=2||s.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const h=u.parse(s[1],1,es),p=u.parse(s[2],2,es);if(!h||!p)return null;if(!Kx(h.type,[os,Ai,$n,vc,es]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Za(h.type)} instead`);if(s.length===4){const _=u.parse(s[3],3,$n);return _?new em(h,p,_):null}return new em(h,p)}evaluate(s){const u=this.needle.evaluate(s),h=this.haystack.evaluate(s);if(!J0(u,["boolean","string","number","null"]))throw new mo(`Expected first argument to be of type boolean, string, number or null, but found ${Za(Eo(u))} instead.`);if(!J0(h,["string","array"]))throw new mo(`Expected second argument to be of type array or string, but found ${Za(Eo(h))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(s);return h.indexOf(u,p)}return h.indexOf(u)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const s=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),s]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ug{constructor(s,u,h,p,_,v){this.inputType=s,this.type=u,this.input=h,this.cases=p,this.outputs=_,this.otherwise=v}static parse(s,u){if(s.length<5)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return u.error("Expected an even number of arguments.");let h,p;u.expectedType&&u.expectedType.kind!=="value"&&(p=u.expectedType);const _={},v=[];for(let R=2;R<s.length-1;R+=2){let O=s[R];const D=s[R+1];Array.isArray(O)||(O=[O]);const z=u.concat(R);if(O.length===0)return z.error("Expected at least one branch label.");for(const H of O){if(typeof H!="number"&&typeof H!="string")return z.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return z.error("Numeric branch labels must be integer values.");if(h){if(z.checkSubtype(h,Eo(H)))return null}else h=Eo(H);if(_[String(H)]!==void 0)return z.error("Branch labels must be unique.");_[String(H)]=v.length}const V=u.parse(D,R,p);if(!V)return null;p=p||V.type,v.push(V)}const w=u.parse(s[1],1,es);if(!w)return null;const A=u.parse(s[s.length-1],s.length-1,p);return A?w.type.kind!=="value"&&u.concat(1).checkSubtype(h,w.type)?null:new ug(h,p,w,_,v,A):null}evaluate(s){const u=this.input.evaluate(s);return(cy(Eo(u),this.inputType)&&this.outputs[this.cases[u]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["match",this.input.serialize()],u=Object.keys(this.cases).sort(),h=[],p={};for(const v of u){const w=p[this.cases[v]];w===void 0?(p[this.cases[v]]=h.length,h.push([this.cases[v],[v]])):h[w][1].push(v)}const _=v=>this.inputType.kind==="number"?Number(v):v;for(const[v,w]of h)s.push(w.length===1?_(w[0]):w.map(_)),s.push(this.outputs[v].serialize());return s.push(this.otherwise.serialize()),s}}class cg{constructor(s,u,h){this.type=s,this.branches=u,this.otherwise=h}static parse(s,u){if(s.length<4)return u.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return u.error("Expected an odd number of arguments.");let h;u.expectedType&&u.expectedType.kind!=="value"&&(h=u.expectedType);const p=[];for(let v=1;v<s.length-1;v+=2){const w=u.parse(s[v],v,os);if(!w)return null;const A=u.parse(s[v+1],v+1,h);if(!A)return null;p.push([w,A]),h=h||A.type}const _=u.parse(s[s.length-1],s.length-1,h);return _?new cg(h,p,_):null}evaluate(s){for(const[u,h]of this.branches)if(u.evaluate(s))return h.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[u,h]of this.branches)s(u),s(h);s(this.otherwise)}outputDefined(){return this.branches.every(([s,u])=>u.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["case"];return this.eachChild(u=>{s.push(u.serialize())}),s}}class Oy{constructor(s,u,h,p){this.type=s,this.input=u,this.beginIndex=h,this.endIndex=p}static parse(s,u){if(s.length<=2||s.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const h=u.parse(s[1],1,es),p=u.parse(s[2],2,$n);if(!h||!p)return null;if(!Kx(h.type,[il(es),Ai,es]))return u.error(`Expected first argument to be of type array or string, but found ${Za(h.type)} instead`);if(s.length===4){const _=u.parse(s[3],3,$n);return _?new Oy(h.type,h,p,_):null}return new Oy(h.type,h,p)}evaluate(s){const u=this.input.evaluate(s),h=this.beginIndex.evaluate(s);if(!J0(u,["string","array"]))throw new mo(`Expected first argument to be of type array or string, but found ${Za(Eo(u))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(s);return u.slice(h,p)}return u.slice(h)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const s=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),s]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class vb{constructor(s,u){this.type=il(Ai),this.str=s,this.delimiter=u}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const h=u.parse(s[1],1,Ai),p=u.parse(s[2],2,Ai);return h&&p?new vb(h,p):void 0}evaluate(s){const u=this.str.evaluate(s),h=this.delimiter.evaluate(s);return u.split(h)}eachChild(s){s(this.str),s(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function xb(c,s){return c==="=="||c==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function bb(c,s,u,h){return h.compare(s,u)===0}function tm(c,s,u){const h=c!=="=="&&c!=="!=";return class xie{constructor(_,v,w){this.type=os,this.lhs=_,this.rhs=v,this.collator=w,this.hasUntypedArgument=_.type.kind==="value"||v.type.kind==="value"}static parse(_,v){if(_.length!==3&&_.length!==4)return v.error("Expected two or three arguments.");const w=_[0];let A=v.parse(_[1],1,es);if(!A)return null;if(!xb(w,A.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${Za(A.type)}'.`);let R=v.parse(_[2],2,es);if(!R)return null;if(!xb(w,R.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${Za(R.type)}'.`);if(A.type.kind!==R.type.kind&&A.type.kind!=="value"&&R.type.kind!=="value")return v.error(`Cannot compare types '${Za(A.type)}' and '${Za(R.type)}'.`);h&&(A.type.kind==="value"&&R.type.kind!=="value"?A=new xc(R.type,[A]):A.type.kind!=="value"&&R.type.kind==="value"&&(R=new xc(A.type,[R])));let O=null;if(_.length===4){if(A.type.kind!=="string"&&R.type.kind!=="string"&&A.type.kind!=="value"&&R.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(O=v.parse(_[3],3,uy),!O)return null}return new xie(A,R,O)}evaluate(_){const v=this.lhs.evaluate(_),w=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){const A=Eo(v),R=Eo(w);if(A.kind!==R.kind||A.kind!=="string"&&A.kind!=="number")throw new mo(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${A.kind}, ${R.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const A=Eo(v),R=Eo(w);if(A.kind!=="string"||R.kind!=="string")return s(_,v,w)}return this.collator?u(_,v,w,this.collator.evaluate(_)):s(_,v,w)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[c];return this.eachChild(v=>{_.push(v.serialize())}),_}}}const AI=tm("==",function(c,s,u){return s===u},bb),CI=tm("!=",function(c,s,u){return s!==u},function(c,s,u,h){return!bb(0,s,u,h)}),WE=tm("<",function(c,s,u){return s<u},function(c,s,u,h){return h.compare(s,u)<0}),XE=tm(">",function(c,s,u){return s>u},function(c,s,u,h){return h.compare(s,u)>0}),Ly=tm("<=",function(c,s,u){return s<=u},function(c,s,u,h){return h.compare(s,u)<=0}),kI=tm(">=",function(c,s,u){return s>=u},function(c,s,u,h){return h.compare(s,u)>=0});class Dy{constructor(s,u,h,p,_,v){this.type=Ai,this.number=s,this.locale=u,this.currency=h,this.unit=p,this.minFractionDigits=_,this.maxFractionDigits=v}static parse(s,u){if(s.length!==3)return u.error("Expected two arguments.");const h=u.parse(s[1],1,$n);if(!h)return null;const p=s[2];if(typeof p!="object"||Array.isArray(p))return u.error("NumberFormat options argument must be an object.");let _=null;if(p.locale&&(_=u.parseObjectValue(p.locale,2,"locale",Ai),!_))return null;let v=null;if(p.currency&&(v=u.parseObjectValue(p.currency,2,"currency",Ai),!v))return null;let w=null;if(p.unit&&(w=u.parseObjectValue(p.unit,2,"unit",Ai),!w))return null;let A=null;if(p["min-fraction-digits"]&&(A=u.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",$n),!A))return null;let R=null;return p["max-fraction-digits"]&&(R=u.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",$n),!R)?null:new Dy(h,_,v,w,A,R)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(s):void 0,unit:this.unit?this.unit.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.unit&&s(this.unit),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const s={};return this.locale&&(s.locale=this.locale.serialize()),this.currency&&(s.currency=this.currency.serialize()),this.unit&&(s.unit=this.unit.serialize()),this.minFractionDigits&&(s["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(s["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),s]}}class wb{constructor(s){this.type=$n,this.input=s}static parse(s,u){if(s.length!==2)return u.error(`Expected 1 argument, but found ${s.length-1} instead.`);const h=u.parse(s[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${Za(h.type)} instead.`):new wb(h):null}evaluate(s){const u=this.input.evaluate(s);if(typeof u=="string"||Array.isArray(u))return u.length;throw new mo(`Expected value to be of type string or array, but found ${Za(Eo(u))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}serialize(){const s=["length"];return this.eachChild(u=>{s.push(u.serialize())}),s}}function YE(c){return function(){c=1831565813+(c|=0)|0;let s=Math.imul(c^c>>>15,1|c);return s=s+Math.imul(s^s>>>7,61|s)^s,((s^s>>>14)>>>0)/4294967296}}const nm={"==":AI,"!=":CI,">":XE,"<":WE,">=":kI,"<=":Ly,array:xc,at:My,"at-interpolated":Py,boolean:xc,case:cg,coalesce:lg,collator:Mo,format:Jc,image:Vr,in:yb,"index-of":em,interpolate:yu,"interpolate-hcl":yu,"interpolate-lab":yu,length:wb,let:Ld,literal:Pd,match:ug,number:xc,"number-format":Dy,object:xc,slice:Oy,step:ag,string:xc,"to-boolean":ed,"to-color":ed,"to-number":ed,"to-string":ed,var:Sy,within:Lh,distance:Bf,config:Kp,split:vb};function Tb(c,[s,u,h,p]){s=s.evaluate(c),u=u.evaluate(c),h=h.evaluate(c);const _=p?p.evaluate(c):1,v=Nf(s,u,h,_);if(v)throw new mo(v);return new ts(s/255,u/255,h/255,_)}function Eb(c,[s,u,h,p]){s=s.evaluate(c),u=u.evaluate(c),h=h.evaluate(c);const _=p?p.evaluate(c):1,v=function(R,O,D,z){return typeof R=="number"&&R>=0&&R<=360?typeof O=="number"&&O>=0&&O<=100&&typeof D=="number"&&D>=0&&D<=100?z===void 0||typeof z=="number"&&z>=0&&z<=1?null:`Invalid hsla value [${[R,O,D,z].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof z=="number"?[R,O,D,z]:[R,O,D]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof z=="number"?[R,O,D,z]:[R,O,D]).join(", ")}]: 'h' must be between 0 and 360.`}(s,u,h,_);if(v)throw new mo(v);const w=`hsla(${s}, ${u}%, ${h}%, ${_})`,A=ts.parse(w);if(!A)throw new mo(`Failed to parse HSLA color: ${w}`);return A}function KE(c,s){return c in s}function Sb(c,s){const u=s[c];return u===void 0?null:u}function zh(c){return{type:c}}function jf(c){if(c instanceof Kp)return new Set([c.key]);let s=new Set;return c.eachChild(u=>{s=new Set([...s,...jf(u)])}),s}function Ny(c){if(c instanceof Al&&c.name==="is-active-floor")return!0;let s=!1;return c.eachChild(u=>{!s&&Ny(u)&&(s=!0)}),s}function QE(c){return{result:"success",value:c}}function Fh(c){return{result:"error",value:c}}function Ab(c,s){return!!c&&!!c.parameters&&c.parameters.indexOf(s)>-1}function dg(c){return c["property-type"]==="data-driven"}function JE(c){return Ab(c.expression,"measure-light")}function eS(c){return Ab(c.expression,"zoom")}function zy(c){return!!c.expression&&c.expression.interpolated}function Fy(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function tS(c){return c}function nS(c,s){const u=s.type==="color",h=c.stops&&typeof c.stops[0][0]=="object",p=h||!(h||c.property!==void 0),_=c.type||(zy(s)?"exponential":"interval");if(u&&((c=Object.assign({},c)).stops&&(c.stops=c.stops.map(R=>[R[0],ts.parse(R[1])])),c.default=ts.parse(c.default?c.default:s.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!ZE[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let v,w,A;if(_==="exponential")v=rS;else if(_==="interval")v=RI;else if(_==="categorical"){v=II,w=Object.create(null);for(const R of c.stops)w[R[0]]=R[1];A=typeof c.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);v=iS}if(h){const R={},O=[];for(let V=0;V<c.stops.length;V++){const H=c.stops[V],K=H[0].zoom;R[K]===void 0&&(R[K]={zoom:K,type:c.type,property:c.property,default:c.default,stops:[]},O.push(K)),R[K].stops.push([H[0].value,H[1]])}const D=[];for(const V of O)D.push([R[V].zoom,nS(R[V],s)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:yu.interpolationFactor.bind(void 0,z),zoomStops:D.map(V=>V[0]),evaluate:({zoom:V},H)=>rS({stops:D,base:c.base},s,V).evaluate(V,H)}}if(p){const R=_==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:yu.interpolationFactor.bind(void 0,R),zoomStops:c.stops.map(O=>O[0]),evaluate:({zoom:O})=>v(c,s,O,w,A)}}return{kind:"source",evaluate(R,O){const D=O&&O.properties?O.properties[c.property]:void 0;return D===void 0?nd(c.default,s.default):v(c,s,D,w,A)}}}function nd(c,s,u){return c!==void 0?c:s!==void 0?s:u!==void 0?u:void 0}function II(c,s,u,h,p){return nd(typeof u===p?h[u]:void 0,c.default,s.default)}function RI(c,s,u){if(!Gp(u))return nd(c.default,s.default);const h=c.stops.length;if(h===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[h-1][0])return c.stops[h-1][1];const p=Cy(c.stops.map(_=>_[0]),u);return c.stops[p][1]}function rS(c,s,u){const h=c.base!==void 0?c.base:1;if(!Gp(u))return nd(c.default,s.default);const p=c.stops.length;if(p===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[p-1][0])return c.stops[p-1][1];const _=Cy(c.stops.map(O=>O[0]),u),v=function(O,D,z,V){const H=V-z,K=O-z;return H===0?0:D===1?K/H:(Math.pow(D,K)-1)/(Math.pow(D,H)-1)}(u,h,c.stops[_][0],c.stops[_+1][0]),w=c.stops[_][1],A=c.stops[_+1][1];let R=Y0[s.type]||tS;if(c.colorSpace&&c.colorSpace!=="rgb"){const O=ZE[c.colorSpace];R=(D,z)=>O.reverse(O.interpolate(O.forward(D),O.forward(z),v))}return typeof w.evaluate=="function"?{evaluate(...O){const D=w.evaluate.apply(void 0,O),z=A.evaluate.apply(void 0,O);if(D!==void 0&&z!==void 0)return R(D,z,v)}}:R(w,A,v)}function iS(c,s,u){return s.type==="color"?u=ts.parse(u):s.type==="formatted"?u=El.fromString(u.toString()):s.type==="resolvedImage"?u=Sl.build(u.toString()):Fn(u)===s.type||s.type==="enum"&&s.values[u]||(u=void 0),nd(u,c.default,s.default)}Al.register(nm,{error:[{kind:"error"},[Ai],(c,[s])=>{throw new mo(s.evaluate(c))}],typeof:[Ai,[es],(c,[s])=>Za(Eo(s.evaluate(c)))],"to-rgba":[il($n,4),[zl],(c,[s])=>s.evaluate(c).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[il($n,4),[zl],(c,[s])=>s.evaluate(c).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[zl,[$n,$n,$n],Tb],rgba:[zl,[$n,$n,$n,$n],Tb],hsl:[zl,[$n,$n,$n],Eb],hsla:[zl,[$n,$n,$n,$n],Eb],has:{type:os,overloads:[[[Ai],(c,[s])=>KE(s.evaluate(c),c.properties())],[[Ai,Qc],(c,[s,u])=>KE(s.evaluate(c),u.evaluate(c))]]},get:{type:es,overloads:[[[Ai],(c,[s])=>Sb(s.evaluate(c),c.properties())],[[Ai,Qc],(c,[s,u])=>Sb(s.evaluate(c),u.evaluate(c))]]},"feature-state":[es,[Ai],(c,[s])=>Sb(s.evaluate(c),c.featureState||{})],properties:[Qc,[],c=>c.properties()],"geometry-type":[Ai,[],c=>c.geometryType()],worldview:[Ai,[],c=>c.globals.worldview||""],"is-active-floor":[os,zh(Ai),(c,s)=>{if(!(c.globals.activeFloors&&c.globals.activeFloors.size>0))return!1;const u=c.globals.activeFloors;return s.some(h=>{const p=h.evaluate(c);return u.has(p)})}],id:[es,[],c=>c.id()],zoom:[$n,[],c=>c.globals.zoom],pitch:[$n,[],c=>c.globals.pitch||0],"distance-from-center":[$n,[],c=>c.distanceFromCenter()],"measure-light":[$n,[Ai],(c,[s])=>c.measureLight(s.evaluate(c))],"heatmap-density":[$n,[],c=>c.globals.heatmapDensity||0],"line-progress":[$n,[],c=>c.globals.lineProgress||0],"raster-value":[$n,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[$n,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[$n,[],c=>c.globals.skyRadialProgress||0],accumulated:[es,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[$n,zh($n),(c,s)=>{let u=0;for(const h of s)u+=h.evaluate(c);return u}],"*":[$n,zh($n),(c,s)=>{let u=1;for(const h of s)u*=h.evaluate(c);return u}],"-":{type:$n,overloads:[[[$n,$n],(c,[s,u])=>s.evaluate(c)-u.evaluate(c)],[[$n],(c,[s])=>-s.evaluate(c)]]},"/":[$n,[$n,$n],(c,[s,u])=>s.evaluate(c)/u.evaluate(c)],"%":[$n,[$n,$n],(c,[s,u])=>s.evaluate(c)%u.evaluate(c)],ln2:[$n,[],()=>Math.LN2],pi:[$n,[],()=>Math.PI],e:[$n,[],()=>Math.E],"^":[$n,[$n,$n],(c,[s,u])=>Math.pow(s.evaluate(c),u.evaluate(c))],sqrt:[$n,[$n],(c,[s])=>Math.sqrt(s.evaluate(c))],log10:[$n,[$n],(c,[s])=>Math.log(s.evaluate(c))/Math.LN10],ln:[$n,[$n],(c,[s])=>Math.log(s.evaluate(c))],log2:[$n,[$n],(c,[s])=>Math.log2(s.evaluate(c))],sin:[$n,[$n],(c,[s])=>Math.sin(s.evaluate(c))],cos:[$n,[$n],(c,[s])=>Math.cos(s.evaluate(c))],tan:[$n,[$n],(c,[s])=>Math.tan(s.evaluate(c))],asin:[$n,[$n],(c,[s])=>Math.asin(s.evaluate(c))],acos:[$n,[$n],(c,[s])=>Math.acos(s.evaluate(c))],atan:[$n,[$n],(c,[s])=>Math.atan(s.evaluate(c))],min:[$n,zh($n),(c,s)=>Math.min(...s.map(u=>u.evaluate(c)))],max:[$n,zh($n),(c,s)=>Math.max(...s.map(u=>u.evaluate(c)))],abs:[$n,[$n],(c,[s])=>Math.abs(s.evaluate(c))],round:[$n,[$n],(c,[s])=>{const u=s.evaluate(c);return u<0?-Math.round(-u):Math.round(u)}],floor:[$n,[$n],(c,[s])=>Math.floor(s.evaluate(c))],ceil:[$n,[$n],(c,[s])=>Math.ceil(s.evaluate(c))],"filter-==":[os,[Ai,es],(c,[s,u])=>c.properties()[s.value]===u.value],"filter-id-==":[os,[es],(c,[s])=>c.id()===s.value],"filter-type-==":[os,[Ai],(c,[s])=>c.geometryType()===s.value],"filter-<":[os,[Ai,es],(c,[s,u])=>{const h=c.properties()[s.value],p=u.value;return typeof h==typeof p&&h<p}],"filter-id-<":[os,[es],(c,[s])=>{const u=c.id(),h=s.value;return typeof u==typeof h&&u<h}],"filter->":[os,[Ai,es],(c,[s,u])=>{const h=c.properties()[s.value],p=u.value;return typeof h==typeof p&&h>p}],"filter-id->":[os,[es],(c,[s])=>{const u=c.id(),h=s.value;return typeof u==typeof h&&u>h}],"filter-<=":[os,[Ai,es],(c,[s,u])=>{const h=c.properties()[s.value],p=u.value;return typeof h==typeof p&&h<=p}],"filter-id-<=":[os,[es],(c,[s])=>{const u=c.id(),h=s.value;return typeof u==typeof h&&u<=h}],"filter->=":[os,[Ai,es],(c,[s,u])=>{const h=c.properties()[s.value],p=u.value;return typeof h==typeof p&&h>=p}],"filter-id->=":[os,[es],(c,[s])=>{const u=c.id(),h=s.value;return typeof u==typeof h&&u>=h}],"filter-has":[os,[es],(c,[s])=>s.value in c.properties()],"filter-has-id":[os,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[os,[il(Ai)],(c,[s])=>s.value.indexOf(c.geometryType())>=0],"filter-id-in":[os,[il(es)],(c,[s])=>s.value.indexOf(c.id())>=0],"filter-in-small":[os,[Ai,il(es)],(c,[s,u])=>u.value.indexOf(c.properties()[s.value])>=0],"filter-in-large":[os,[Ai,il(es)],(c,[s,u])=>function(h,p,_,v){for(;_<=v;){const w=_+v>>1;if(p[w]===h)return!0;p[w]>h?v=w-1:_=w+1}return!1}(c.properties()[s.value],u.value,0,u.value.length-1)],all:{type:os,overloads:[[[os,os],(c,[s,u])=>s.evaluate(c)&&u.evaluate(c)],[zh(os),(c,s)=>{for(const u of s)if(!u.evaluate(c))return!1;return!0}]]},any:{type:os,overloads:[[[os,os],(c,[s,u])=>s.evaluate(c)||u.evaluate(c)],[zh(os),(c,s)=>{for(const u of s)if(u.evaluate(c))return!0;return!1}]]},"!":[os,[os],(c,[s])=>!s.evaluate(c)],"is-supported-script":[os,[Ai],(c,[s])=>{const u=c.globals&&c.globals.isSupportedScript;return!u||u(s.evaluate(c))}],upcase:[Ai,[Ai],(c,[s])=>s.evaluate(c).toUpperCase()],downcase:[Ai,[Ai],(c,[s])=>s.evaluate(c).toLowerCase()],concat:[Ai,zh(es),(c,s)=>s.map(u=>Hu(u.evaluate(c))).join("")],"resolved-locale":[Ai,[uy],(c,[s])=>s.evaluate(c).resolvedLocale()],random:[$n,[$n,$n,es],(c,s)=>{const[u,h,p]=s.map(v=>v.evaluate(c));if(u>h||u===h)return u;let _;if(typeof p=="string")_=function(v){let w=0;if(v.length===0)return w;for(let A=0;A<v.length;A++)w=(w<<5)-w+v.charCodeAt(A),w|=0;return w}(p);else{if(typeof p!="number")throw new mo(`Invalid seed input: ${p}`);_=p}return u+YE(_)()*(h-u)}]});class By{constructor(s,u,h,p,_){this.expression=s,this._warningHistory={},this._scope=h,this._options=p,this._iconImageUseTheme=_,this._evaluator=new py(h,p,_),this._defaultValue=u?function(v){return v.type==="color"&&(Fy(v.default)||Array.isArray(v.default))?new ts(0,0,0,0):v.type==="color"?ts.parse(v.default)||null:v.default===void 0?null:v.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null,this.configDependencies=jf(s),this.isIndoorDependent=Ny(s)}evaluateWithoutErrorHandling(s,u,h,p,_,v,w,A){return this._evaluator.globals=s,this._evaluator.feature=u,this._evaluator.featureState=h,this._evaluator.canonical=p||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=A||null,this.expression.evaluate(this._evaluator)}evaluate(s,u,h,p,_,v,w,A,R){this._evaluator||(this._evaluator=new py(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=s,this._evaluator.feature=u||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=A||null,this._evaluator.iconImageUseTheme=R||null;try{const O=this.expression.evaluate(this._evaluator);if(O==null||typeof O=="number"&&O!=O)return this._defaultValue;if(this._enumValues&&!(O in this._enumValues))throw new mo(`Expected value to be one of ${Object.keys(this._enumValues).map(D=>JSON.stringify(D)).join(", ")}, but found ${JSON.stringify(O)} instead.`);return O}catch(O){const D=O;return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${D.message}`)),this._defaultValue}}}function hg(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in nm}function Bh(c,s,u,h,p){const _=new Ay(nm,[],s?function(w){const A={color:zl,string:Ai,number:$n,enum:Ai,boolean:os,formatted:K0,resolvedImage:Q0};return w.type==="array"?il(A[w.value]||es,w.length):A[w.type]}(s):void 0,void 0,void 0,u,h,p),v=_.parse(c,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return v?QE(new By(v,s,u,h,p)):Fh(_.errors)}class rm{constructor(s,u,h,p){this.kind=s,this._styleExpression=u,this.isLightConstant=h,this.isLineProgressConstant=p,this.isStateDependent=s!=="constant"&&!sg(u.expression),this.configDependencies=jf(u.expression),this.isIndoorDependent=Ny(u.expression)}evaluateWithoutErrorHandling(s,u,h,p,_,v){return this._styleExpression.evaluateWithoutErrorHandling(s,u,h,p,_,v)}evaluate(s,u,h,p,_,v,w){return this._styleExpression.evaluate(s,u,h,p,_,v,void 0,void 0,w)}}class Uf{constructor(s,u,h,p,_,v){this.kind=s,this.zoomStops=h,this._styleExpression=u,this.isStateDependent=s!=="camera"&&!sg(u.expression),this.isIndoorDependent=Ny(u.expression),this.isLightConstant=_,this.isLineProgressConstant=v,this.configDependencies=jf(u.expression),this.interpolationType=p}evaluateWithoutErrorHandling(s,u,h,p,_,v){return this._styleExpression.evaluateWithoutErrorHandling(s,u,h,p,_,v)}evaluate(s,u,h,p,_,v){return this._styleExpression.evaluate(s,u,h,p,_,v)}interpolationFactor(s,u,h){return this.interpolationType?yu.interpolationFactor(this.interpolationType,s,u,h):0}}function Cb(c,s,u,h,p){if((c=Bh(c,s,u,h,p)).result==="error")return c;const _=c.value.expression,v=Xp(_);if(!v&&!dg(s))return Fh([new $u("","data expressions not supported")]);const w=Yp(_,["zoom","pitch","distance-from-center"]);if(!w&&!eS(s))return Fh([new $u("","zoom expressions not supported")]);const A=Yp(_,["measure-light"]);if(!A&&!JE(s))return Fh([new $u("","measure-light expression not supported")]);const R=Yp(_,["line-progress"]);if(!R&&!function(z){return Ab(z.expression,"line-progress")}(s))return Fh([new $u("","line-progress expression not supported")]);const O=s.expression&&s.expression.relaxZoomRestriction,D=wc(_);return D||w||O?D instanceof $u?Fh([D]):D instanceof yu&&!zy(s)?Fh([new $u("",'"interpolate" expressions cannot be used with this property')]):QE(D?new Uf(v&&R?"camera":"composite",c.value,D.labels,D instanceof yu?D.interpolation:void 0,A,R):new rm(v&&R?"constant":"source",c.value,A,R)):Fh([new $u("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class jy{constructor(s,u){this._parameters=s,this._specification=u,Object.assign(this,nS(this._parameters,this._specification))}static deserialize(s){return new jy(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function wc(c){let s=null;if(c instanceof Ld)s=wc(c.result);else if(c instanceof lg){for(const u of c.args)if(s=wc(u),s)break}else(c instanceof ag||c instanceof yu)&&c.input instanceof Al&&c.input.name==="zoom"&&(s=c);return s instanceof $u||c.eachChild(u=>{const h=wc(u);h instanceof $u?s=h:s&&h&&s!==h&&(s=new $u("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}var kb,sS,aS=function(){if(sS)return kb;sS=1,kb=s;var c=3;function s(u,h,p){var _=this.cells=[];if(u instanceof ArrayBuffer){this.arrayBuffer=u;var v=new Int32Array(this.arrayBuffer);u=v[0],this.d=(h=v[1])+2*(p=v[2]);for(var w=0;w<this.d*this.d;w++){var A=v[c+w],R=v[c+w+1];_.push(A===R?null:v.subarray(A,R))}var O=v[c+_.length+1];this.keys=v.subarray(v[c+_.length],O),this.bboxes=v.subarray(O),this.insert=this._insertReadonly}else{this.d=h+2*p;for(var D=0;D<this.d*this.d;D++)_.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=u,this.padding=p,this.scale=h/u,this.uid=0;var z=p/h*u;this.min=-z,this.max=u+z}return s.prototype.insert=function(u,h,p,_,v){this._forEachCell(h,p,_,v,this._insertCell,this.uid++),this.keys.push(u),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(v)},s.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},s.prototype._insertCell=function(u,h,p,_,v,w){this.cells[v].push(w)},s.prototype.query=function(u,h,p,_,v){var w=this.min,A=this.max;if(u<=w&&h<=w&&A<=p&&A<=_&&!v)return Array.prototype.slice.call(this.keys);var R=[];return this._forEachCell(u,h,p,_,this._queryCell,R,{},v),R},s.prototype._queryCell=function(u,h,p,_,v,w,A,R){var O=this.cells[v];if(O!==null)for(var D=this.keys,z=this.bboxes,V=0;V<O.length;V++){var H=O[V];if(A[H]===void 0){var K=4*H;(R?R(z[K+0],z[K+1],z[K+2],z[K+3]):u<=z[K+2]&&h<=z[K+3]&&p>=z[K+0]&&_>=z[K+1])?(A[H]=!0,w.push(D[H])):A[H]=!1}}},s.prototype._forEachCell=function(u,h,p,_,v,w,A,R){for(var O=this._convertToCellCoord(u),D=this._convertToCellCoord(h),z=this._convertToCellCoord(p),V=this._convertToCellCoord(_),H=O;H<=z;H++)for(var K=D;K<=V;K++){var re=this.d*K+H;if((!R||R(this._convertFromCellCoord(H),this._convertFromCellCoord(K),this._convertFromCellCoord(H+1),this._convertFromCellCoord(K+1)))&&v.call(this,u,h,p,_,re,w,A,R))return}},s.prototype._convertFromCellCoord=function(u){return(u-this.padding)/this.scale},s.prototype._convertToCellCoord=function(u){return Math.max(0,Math.min(this.d-1,Math.floor(u*this.scale)+this.padding))},s.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var u=this.cells,h=c+this.cells.length+1+1,p=0,_=0;_<this.cells.length;_++)p+=this.cells[_].length;var v=new Int32Array(h+p+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var w=h,A=0;A<u.length;A++){var R=u[A];v[c+A]=w,v.set(R,w),w+=R.length}return v[c+u.length]=w,v.set(this.keys,w),v[c+u.length+1]=w+=this.keys.length,v.set(this.bboxes,w),w+=this.bboxes.length,v.buffer},kb}(),im=Ns(aS);const Vf={};function En(c,s,u={}){Object.defineProperty(c,"_classRegistryKey",{value:s,writable:!1}),Vf[s]={klass:c,omit:u.omit||[]}}En(Object,"Object"),im.serialize=function(c,s){const u=c.toArrayBuffer();return s&&s.add(u),{buffer:u}},im.deserialize=function(c){return new im(c.buffer)},Object.defineProperty(im,"name",{value:"Grid"}),En(im,"Grid"),delete je.prototype.constructor,En(ts,"Color"),En(Error,"Error"),En(El,"Formatted"),En(dy,"FormattedSection"),En(Jl,"AJAXError"),En(Sl,"ResolvedImage"),En(jy,"StylePropertyFunction"),En(By,"StyleExpression",{omit:["_evaluator"]}),En(yl,"ImageId"),En(Md,"ImageVariant"),En(Uf,"ZoomDependentExpression"),En(rm,"ZoomConstantExpression"),En(Al,"CompoundExpression",{omit:["_evaluate"]});for(const c in nm)Vf[nm[c]._classRegistryKey]||En(nm[c],`Expression${c}`);function fg(c){return c&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function Dd(c,s){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(fg(c)||c instanceof ImageBitmap)return s&&s.add(c),c;if(ArrayBuffer.isView(c))return s&&s.add(c.buffer),c;if(c instanceof ImageData)return s&&s.add(c.data.buffer),c;if(Array.isArray(c)){const u=[];for(const h of c)u.push(Dd(h,s));return u}if(c instanceof Map){const u={$name:"Map",entries:[]};for(const[h,p]of c.entries())u.entries.push(Dd(h),Dd(p,s));return u}if(c instanceof Set){const u={$name:"Set"};let h=0;for(const p of c.values())u[++h]=Dd(p);return u}if(typeof c=="bigint")return{$name:"BigInt",value:c.toString()};if(typeof c=="object"){const u=c.constructor,h=u._classRegistryKey;if(!h)throw new Error(`Can't serialize object of unregistered class "${u.name}".`);const p=u.serialize?u.serialize(c,s):{};if(!u.serialize){for(const _ in c)c.hasOwnProperty(_)&&(Vf[h].omit.indexOf(_)>=0||(p[_]=Dd(c[_],s)));c instanceof Error&&(p.message=c.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(p.$name=h),p}throw new Error("can't serialize object of type "+typeof c)}function jh(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||fg(c)||c instanceof ImageBitmap||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(jh);if(typeof c=="object"){const s=c.$name||"Object";if(s==="Map"){const p=c.entries||[],_=new Map;for(let v=0;v<p.length;v+=2)_.set(jh(p[v]),jh(p[v+1]));return _}if(s==="Set"){const p=new Set;for(const _ of Object.keys(c))_!=="$name"&&p.add(jh(c[_]));return p}if(s==="BigInt")return BigInt(c.value);const{klass:u}=Vf[s];if(!u)throw new Error(`Can't deserialize unregistered class "${s}".`);if(u.deserialize)return u.deserialize(c);const h=Object.create(u.prototype);for(const p of Object.keys(c))p!=="$name"&&(h[p]=jh(c[p]));return h}throw new Error("can't deserialize object of type "+typeof c)}const fr={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,Osage:c=>c>=66736&&c<=66815,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function pg(c){for(const s of c)if(Uy(s.charCodeAt(0)))return!0;return!1}function Ib(c){for(const s of c)if(!oS(s.charCodeAt(0)))return!1;return!0}function oS(c){return!(fr.Arabic(c)||fr["Arabic Supplement"](c)||fr["Arabic Extended-A"](c)||fr["Arabic Presentation Forms-A"](c)||fr["Arabic Presentation Forms-B"](c))}function Uy(c){return!(c!==746&&c!==747&&(c<4352||!(fr["Bopomofo Extended"](c)||fr.Bopomofo(c)||fr["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||fr["CJK Compatibility Ideographs"](c)||fr["CJK Compatibility"](c)||fr["CJK Radicals Supplement"](c)||fr["CJK Strokes"](c)||!(!fr["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||fr["CJK Unified Ideographs Extension A"](c)||fr["CJK Unified Ideographs"](c)||fr["Enclosed CJK Letters and Months"](c)||fr["Hangul Compatibility Jamo"](c)||fr["Hangul Jamo Extended-A"](c)||fr["Hangul Jamo Extended-B"](c)||fr["Hangul Jamo"](c)||fr["Hangul Syllables"](c)||fr.Hiragana(c)||fr["Ideographic Description Characters"](c)||fr.Kanbun(c)||fr["Kangxi Radicals"](c)||fr["Katakana Phonetic Extensions"](c)||fr.Katakana(c)&&c!==12540||!(!fr["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!fr["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||fr["Unified Canadian Aboriginal Syllabics"](c)||fr["Unified Canadian Aboriginal Syllabics Extended"](c)||fr["Vertical Forms"](c)||fr["Yijing Hexagram Symbols"](c)||fr["Yi Syllables"](c)||fr["Yi Radicals"](c))))}function Vy(c){return!(Uy(c)||function(s){return!!(fr["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||fr["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||fr["Letterlike Symbols"](s)||fr["Number Forms"](s)||fr["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||fr["Control Pictures"](s)&&s!==9251||fr["Optical Character Recognition"](s)||fr["Enclosed Alphanumerics"](s)||fr["Geometric Shapes"](s)||fr["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||fr["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||fr["CJK Symbols and Punctuation"](s)||fr.Katakana(s)||fr["Private Use Area"](s)||fr["CJK Compatibility Forms"](s)||fr["Small Form Variants"](s)||fr["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(c))}function $y(c){return fr.Arabic(c)||fr["Arabic Supplement"](c)||fr["Arabic Extended-A"](c)||fr["Arabic Presentation Forms-A"](c)||fr["Arabic Presentation Forms-B"](c)}function Rb(c){return c>=1424&&c<=2303||fr["Arabic Presentation Forms-A"](c)||fr["Arabic Presentation Forms-B"](c)}function Nd(c,s){return!(!s&&Rb(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||fr.Khmer(c))}function MI(c){for(const s of c)if(Rb(s.charCodeAt(0)))return!0;return!1}const eu={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Mb=null,Cl=eu.unavailable,zd=null;const mg=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(Cl=eu.error),Mb&&Mb(c)};function Hy(){Gy.fire(new Kc("pluginStateChange",{pluginStatus:Cl,pluginURL:zd}))}const Gy=new Df,gg=function(){return Cl},lS=function(){if(Cl!==eu.deferred||!zd)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Cl=eu.loading,Hy(),zd&&Rd({url:zd},c=>{c?mg(c):(Cl=eu.loaded,Hy())})},Fd={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Cl===eu.loaded||Fd.applyArabicShaping!=null,isLoading:()=>Cl===eu.loading,setState(c){Cl=c.pluginStatus,zd=c.pluginURL},isParsing:()=>Cl===eu.parsing,isParsed:()=>Cl===eu.parsed,getPluginURL:()=>zd};class zs{constructor(s,u){this.zoom=s,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.transition=u.transition,this.pitch=u.pitch,this.brightness=u.brightness,this.worldview=u.worldview,this.activeFloors=u.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(s){return function(u,h){for(const p of u)if(!Nd(p.charCodeAt(0),h))return!1;return!0}(s,Fd.isLoaded())}}class qy{constructor(s,u,h,p,_){this.property=s,this.value=u,this.expression=function(v,w,A,R,O){if(Fy(v))return new jy(v,w);if(hg(v)||Array.isArray(v)&&v.length>0){const D=Cb(v,w,A,R,O);if(D.result==="error")throw new Error(D.value.map(z=>`${z.key}: ${z.message}`).join(", "));return D.value}{let D=v;return typeof v=="string"&&w.type==="color"&&(D=ts.parse(v)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>D}}}(u===void 0?s.specification.default:u,s.specification,h,p,_)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,u,h,p){return this.property.possiblyEvaluate(this,s,u,h,p)}}class Pb{constructor(s,u,h,p){this.property=s,this.value=new qy(s,void 0,u,h,p)}transitioned(s,u){return new cS(this.property,this.value,u,Object.assign({},s.transition,this.transition),s.now)}untransitioned(){return new cS(this.property,this.value,null,{},0)}}class uS{constructor(s,u,h,p){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues),this._scope=u,this._options=h,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(s){return xt(this._values[s].value.value)}setValue(s,u){this._values.hasOwnProperty(s)||(this._values[s]=new Pb(this._values[s].property,this._scope,this._options,this._iconImageUseTheme)),this._values[s].value=new qy(this._values[s].property,u===null?void 0:xt(u),this._scope,this._options,this._iconImageUseTheme),this._values[s].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[s].value.isIndoorDependent())}setTransitionOrValue(s,u){u&&(this._options=u);const h=this._properties.properties;if(s)for(const p in s){const _=s[p];if(p.endsWith("-transition")){const v=p.slice(0,-11);h[v]&&this.setTransition(v,_)}else h.hasOwnProperty(p)&&this.setValue(p,_)}}getTransition(s){return xt(this._values[s].transition)}setTransition(s,u){this._values.hasOwnProperty(s)||(this._values[s]=new Pb(this._values[s].property)),this._values[s].transition=xt(u)||void 0}serialize(){const s={};for(const u of Object.keys(this._values)){const h=this.getValue(u);h!==void 0&&(s[u]=h);const p=this.getTransition(u);p!==void 0&&(s[`${u}-transition`]=p)}return s}transitioned(s,u){const h=new dS(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].transitioned(s,u._values[p]);return h}untransitioned(){const s=new dS(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].untransitioned();return s}isIndoorDependent(){return this._isIndoorDependent}}class cS{constructor(s,u,h,p,_){const v=p.delay||0,w=p.duration||0;_=_||0,this.property=s,this.value=u,this.begin=_+v,this.end=this.begin+w,s.specification.transition&&(p.delay||p.duration)&&(this.prior=h)}possiblyEvaluate(s,u,h){const p=s.now||0,_=this.value.possiblyEvaluate(s,u,h),v=this.prior;if(v){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return v.possiblyEvaluate(s,u,h);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(s,u,h),_,Sr(w))}}return _}}class dS{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,u,h){const p=new Hf(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(s,u,h);return p}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class hS{constructor(s,u,h,p){this._properties=s,this._values=Object.create(s.defaultPropertyValues),this._scope=u,this._options=h,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(s){return xt(this._values[s].value)}setValue(s,u){this._values[s]=new qy(this._values[s].property,u===null?void 0:xt(u),this._scope,this._options,this._iconImageUseTheme),this._values[s].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[s].isIndoorDependent())}serialize(){const s={};for(const u of Object.keys(this._values)){const h=this.getValue(u);h!==void 0&&(s[u]=h)}return s}possiblyEvaluate(s,u,h,p){const _=new Hf(this._properties);for(const v of Object.keys(this._values))_._values[v]=this._values[v].possiblyEvaluate(s,u,h,p);return _}isIndoorDependent(){return this._isIndoorDependent}}class $f{constructor(s,u,h,p){this.property=s,this.value=u,this.parameters=h,this.iconImageUseTheme=p}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,u,h,p){return this.property.evaluate(this.value,this.parameters,s,u,h,p,this.iconImageUseTheme)}}class Hf{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class Wt{constructor(s){this.specification=s}possiblyEvaluate(s,u){return s.expression.evaluate(u)}interpolate(s,u,h){const p=Y0[this.specification.type];return p?p(s,u,h):s}}class an{constructor(s,u){this.specification=s,this.overrides=u}possiblyEvaluate(s,u,h,p,_){return s.expression.kind==="constant"||s.expression.kind==="camera"?new $f(this,{kind:"constant",value:s.expression.evaluate(u,null,{},h,p,void 0,_)},u):new $f(this,s.expression,u,_)}interpolate(s,u,h){if(s.value.kind!=="constant"||u.value.kind!=="constant")return s;if(s.value.value===void 0||u.value.value===void 0)return new $f(this,{kind:"constant",value:void 0},s.parameters);const p=Y0[this.specification.type];return p?new $f(this,{kind:"constant",value:p(s.value.value,u.value.value,h)},s.parameters):s}evaluate(s,u,h,p,_,v,w){return s.kind==="constant"?s.value:s.evaluate(u,h,p,_,v,void 0,w)}}class Gf{constructor(s){this.specification=s}possiblyEvaluate(s,u,h,p){return!!s.expression.evaluate(u,null,{},h,p)}interpolate(){return!1}}class xa{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const u=new zs(0,{});for(const h in s){const p=s[h];p.specification.overridable&&this.overridableProperties.push(h);const _=this.defaultPropertyValues[h]=new qy(p,void 0),v=this.defaultTransitionablePropertyValues[h]=new Pb(p);this.defaultTransitioningPropertyValues[h]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=_.possiblyEvaluate(u)}}}En(an,"DataDrivenProperty"),En(Wt,"DataConstantProperty"),En(Gf,"ColorRampProperty");var Qe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function fS(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Zy(c){if(Array.isArray(c))return c.map(Zy);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const s={};for(const u in c)s[u]=Zy(c[u]);return s}return fS(c)}function rd(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const s of c.slice(1))if(!rd(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}function Wy(c,s="",u=null,h="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};rd(c)||(c=Xy(c));const p=c;let _=!0;try{_=function(O){if(!sm(O))return O;let D=Zy(O);return pS(D),D=qf(D),D}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let v=null,w=null;if(h!=="background"&&h!=="sky"&&h!=="slot"){w=Qe[`filter_${h}`];const O=Bh(_,w,s,u);if(O.result==="error")throw new Error(O.value.map(D=>`${D.key}: ${D.message}`).join(", "));v=(D,z,V)=>O.value.evaluate(D,z,{},V)}let A=null,R=null;if(_!==p){const O=Bh(p,w,s,u);if(O.result==="error")throw new Error(O.value.map(D=>`${D.key}: ${D.message}`).join(", "));A=(D,z,V,H,K)=>O.value.evaluate(D,z,{},V,void 0,void 0,H,K),R=!Xp(O.value.expression)}return{filter:v,dynamicFilter:A||void 0,needGeometry:mS(_),needFeature:!!R}}function qf(c){if(!Array.isArray(c))return c;const s=function(u){if(PI.has(u[0])){for(let h=1;h<u.length;h++)if(sm(u[h]))return!0}return u}(c);return s===!0?s:s.map(u=>qf(u))}function pS(c){let s=!1;const u=[];if(c[0]==="case"){for(let h=1;h<c.length-1;h+=2)s=s||sm(c[h]),u.push(c[h+1]);u.push(c[c.length-1])}else if(c[0]==="match"){s=s||sm(c[1]);for(let h=2;h<c.length-1;h+=2)u.push(c[h+1]);u.push(c[c.length-1])}else if(c[0]==="step"){s=s||sm(c[1]);for(let h=1;h<c.length-1;h+=2)u.push(c[h+1])}s&&(c.length=0,c.push("any",...u));for(let h=1;h<c.length;h++)pS(c[h])}function sm(c){if(!Array.isArray(c))return!1;if((s=c[0])==="pitch"||s==="distance-from-center")return!0;var s;for(let u=1;u<c.length;u++)if(sm(c[u]))return!0;return!1}const PI=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function OI(c,s){return c<s?-1:c>s?1:0}function mS(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let s=1;s<c.length;s++)if(mS(c[s]))return!0;return!1}function Xy(c){if(!c)return!0;const s=c[0];return c.length<=1?s!=="any":s==="=="?Yy(c[1],c[2],"=="):s==="!="?_g(Yy(c[1],c[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Yy(c[1],c[2],s):s==="any"?(u=c.slice(1),["any"].concat(u.map(Xy))):s==="all"?["all"].concat(c.slice(1).map(Xy)):s==="none"?["all"].concat(c.slice(1).map(Xy).map(_g)):s==="in"?Ky(c[1],c.slice(2)):s==="!in"?_g(Ky(c[1],c.slice(2))):s==="has"?Qy(c[1]):s!=="!has"||_g(Qy(c[1]));var u}function Yy(c,s,u){switch(c){case"$type":return[`filter-type-${u}`,s];case"$id":return[`filter-id-${u}`,s];default:return[`filter-${u}`,c,s]}}function Ky(c,s){if(s.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(u=>typeof u!=typeof s[0])?["filter-in-large",c,["literal",s.sort(OI)]]:["filter-in-small",c,["literal",s]]}}function Qy(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function _g(c){return["!",c]}const Zf="";function Tc(c,s){return s?`${c}${Zf}${s}`:c}let gS;const _S=()=>gS||(gS=new xa({"icon-size":new an(Qe.layout_symbol["icon-size"]),"icon-image":new an(Qe.layout_symbol["icon-image"]),"icon-rotate":new an(Qe.layout_symbol["icon-rotate"]),"icon-offset":new an(Qe.layout_symbol["icon-offset"]),"text-size":new an(Qe.layout_symbol["text-size"]),"text-rotate":new an(Qe.layout_symbol["text-rotate"]),"text-offset":new an(Qe.layout_symbol["text-offset"])}));class yS{constructor(s,u,h,p,_,v){const w=Bh(s,Qe.appearance.condition);if(w.result==="success"&&(this.condition=w.value),this.name=u,h){this.properties=new Hf(_S()),this.unevaluatedLayout=new hS(_S(),p,_,v);for(const A in h)this.unevaluatedLayout.setValue(A,h[A])}}isActive(s){return!(this.condition||!s.isHidden||this.name!=="hidden")||this.condition.evaluate(s.globals,s.feature,s.featureState,s.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(s){return this.properties.get(s)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(s){return this.unevaluatedLayout._values[s]}recalculate(s,u,h){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(s,void 0,u,h))}serialize(){const s={};return s.condition=this.condition.expression.serialize(),this.name&&(s.name=this.name),this.unevaluatedLayout&&(s.properties=this.unevaluatedLayout.serialize()),s}hasIconProperties(){const s=this.hasProperty("icon-image"),u=this.hasProperty("icon-size"),h=this.hasProperty("icon-offset"),p=this.hasProperty("icon-rotate");return s||u||h||p}hasTextProperties(){const s=this.hasProperty("text-size"),u=this.hasProperty("text-offset"),h=this.hasProperty("text-rotate");return s||u||h}hasProperty(s){return this.getUnevaluatedProperty(s).value!==void 0}}const vS="-transition",id=new Set(["fill","line","background","hillshade","raster"]);class kl extends Df{constructor(s,u,h,p,_,v){if(super(),this.id=s.id,this.fqid=Tc(this.id,h),this.type=s.type,this.scope=h,this.lut=p,this.options=_,this.iconImageUseTheme=v,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},s.type!=="custom"){if(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type&&s.type!=="background"&&s.type!=="sky"&&s.type!=="slot"){this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter;const w=Bh(this.filter,Qe[`filter_${s.type}`]);w.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...w.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||w.value.isIndoorDependent)}if(s.slot&&(this.slot=s.slot),s.appearances&&this.setAppearances(s.appearances),u.layout&&(this._unevaluatedLayout=new hS(u.layout,this.scope,_,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),u.paint){this._transitionablePaint=new uS(u.paint,this.scope,_);for(const w in s.paint)this.setPaintProperty(w,s.paint[w]);for(const w in s.layout)this.setLayoutProperty(w,s.layout[w]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Hf(u.paint)}}}onAdd(s){}onRemove(s){}isDraped(s){return!this.is3D(!0)&&id.has(this.type)}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,u){if(this.type==="custom"&&s==="visibility")return void(this.visibility=u);const h=this._unevaluatedLayout;h._properties.properties[s]&&(h.setValue(s,u),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...h.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||h.isIndoorDependent(),s==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(s){this.appearances=[],s.forEach(u=>{this.appearances.push(new yS(u.condition,u.name,u.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(s){return s.endsWith(vS)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}isPaintProperty(s){return!!this._transitionablePaint._properties.properties[s]}setPaintProperty(s,u){const h=this._transitionablePaint,p=h._properties.properties;if(s.endsWith(vS)){const D=s.slice(0,-11);return p[D]&&h.setTransition(D,u||void 0),!1}if(!p[s])return!1;const _=h._values[s],v=_.value.isDataDriven(),w=_.value;h.setValue(s,u),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...h.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||h.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(s);const A=h._values[s].value,R=A.isDataDriven(),O=s.endsWith("pattern")||s==="line-dasharray";return R||v||O||this._handleOverridablePaintPropertyUpdate(s,w,A)}_handleSpecialPaintPropertyUpdate(s){}getProgramIds(){return null}getDefaultProgramParams(s,u,h){return null}_handleOverridablePaintPropertyUpdate(s,u,h){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,u){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,u,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,u)}serialize(){const s={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(s.appearances=this.appearances.map(u=>u.serialize())),Mt(s,(u,h)=>!(u===void 0||h==="layout"&&!Object.keys(u).length||h==="paint"&&!Object.keys(u).length))}is3D(s){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const s in this.paint._values){const u=this.paint.get(s);if(u instanceof $f&&dg(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}for(const s of this.appearances)if(!sg(s.condition.expression))return!0;return!1}compileFilter(s){this._filterCompiled||(this._featureFilter=Wy(this.filter,this.scope,s),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(s){this._stats&&(s.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(s,u,h){return{}}queryRadius(s){}queryIntersectsFeature(s,u,h,p,_,v,w,A,R){}}const xS={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class yg{constructor(s,u){this._structArray=s,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const LI=new ArrayBuffer(0);class Js{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(s,u){return s._trim(),u&&s.arrayBuffer&&u.add(s.arrayBuffer),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const u=Object.create(this.prototype);return u.arrayBuffer=s.arrayBuffer,u.length=s.length,s.arrayBuffer?u.capacity=s.arrayBuffer.byteLength/u.bytesPerElement:(u.capacity=0,u.arrayBuffer=LI),u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this._reallocCount++,this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}reserveForAdditional(s){this.reserve(this.length+s)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...s){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...s){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function hi(c,s=1){let u=0,h=0;return{members:c.map(p=>{const _=xS[p.type].BYTES_PER_ELEMENT,v=u=bS(u,Math.max(s,_)),w=p.components||1;return h=Math.max(h,_),u+=_*w,{name:p.name,type:p.type,components:w,offset:v}}),size:bS(u,Math.max(h,s)),alignment:s}}function bS(c,s){return Math.ceil(c/s)*s}class Uh extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u){const h=this.length;return this.resize(h+1),this.emplace(h,s,u)}emplace(s,u,h){const p=2*s;return this.int16[p+0]=u,this.int16[p+1]=h,s}}Uh.prototype.bytesPerElement=4,En(Uh,"StructArrayLayout2i4");class am extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,u,h)}emplace(s,u,h,p){const _=3*s;return this.int16[_+0]=u,this.int16[_+1]=h,this.int16[_+2]=p,s}}am.prototype.bytesPerElement=6,En(am,"StructArrayLayout3i6");class om extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,u,h,p)}emplace(s,u,h,p,_){const v=4*s;return this.int16[v+0]=u,this.int16[v+1]=h,this.int16[v+2]=p,this.int16[v+3]=_,s}}om.prototype.bytesPerElement=8,En(om,"StructArrayLayout4i8");class Bd extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.float32[1*s+0]=u,s}}Bd.prototype.bytesPerElement=4,En(Bd,"StructArrayLayout1f4");class Ob extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,u,h)}emplace(s,u,h,p){const _=4*s,v=2*s;return this.int16[_+0]=u,this.int16[_+1]=h,this.float32[v+1]=p,s}}Ob.prototype.bytesPerElement=8,En(Ob,"StructArrayLayout2i1f8");class Lb extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,u,h)}emplace(s,u,h,p){const _=4*s;return this.int16[_+0]=u,this.int16[_+1]=h,this.int16[_+2]=p,s}}Lb.prototype.bytesPerElement=8,En(Lb,"StructArrayLayout3i8");class Db extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,s,u,h,p,_)}emplace(s,u,h,p,_,v){const w=5*s;return this.int16[w+0]=u,this.int16[w+1]=h,this.int16[w+2]=p,this.int16[w+3]=_,this.int16[w+4]=v,s}}Db.prototype.bytesPerElement=10,En(Db,"StructArrayLayout5i10");class Jy extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_,v,w){const A=this.length;return this.resize(A+1),this.emplace(A,s,u,h,p,_,v,w)}emplace(s,u,h,p,_,v,w,A){const R=6*s,O=12*s,D=3*s;return this.int16[R+0]=u,this.int16[R+1]=h,this.uint8[O+4]=p,this.uint8[O+5]=_,this.uint8[O+6]=v,this.uint8[O+7]=w,this.float32[D+2]=A,s}}Jy.prototype.bytesPerElement=12,En(Jy,"StructArrayLayout2i4ub1f12");class vu extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,u,h)}emplace(s,u,h,p){const _=3*s;return this.float32[_+0]=u,this.float32[_+1]=h,this.float32[_+2]=p,s}}vu.prototype.bytesPerElement=12,En(vu,"StructArrayLayout3f12");class Fl extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,s,u,h,p,_)}emplace(s,u,h,p,_,v){const w=6*s,A=3*s;return this.uint16[w+0]=u,this.uint16[w+1]=h,this.uint16[w+2]=p,this.uint16[w+3]=_,this.float32[A+2]=v,s}}Fl.prototype.bytesPerElement=12,En(Fl,"StructArrayLayout4ui1f12");class Wf extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,u,h,p)}emplace(s,u,h,p,_){const v=4*s;return this.uint16[v+0]=u,this.uint16[v+1]=h,this.uint16[v+2]=p,this.uint16[v+3]=_,s}}Wf.prototype.bytesPerElement=8,En(Wf,"StructArrayLayout4ui8");class e1 extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,s,u,h,p,_,v)}emplace(s,u,h,p,_,v,w){const A=6*s;return this.int16[A+0]=u,this.int16[A+1]=h,this.int16[A+2]=p,this.int16[A+3]=_,this.int16[A+4]=v,this.int16[A+5]=w,s}}e1.prototype.bytesPerElement=12,En(e1,"StructArrayLayout6i12");class Nb extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_,v,w,A,R,O,D,z){const V=this.length;return this.resize(V+1),this.emplace(V,s,u,h,p,_,v,w,A,R,O,D,z)}emplace(s,u,h,p,_,v,w,A,R,O,D,z,V){const H=12*s;return this.int16[H+0]=u,this.int16[H+1]=h,this.int16[H+2]=p,this.int16[H+3]=_,this.uint16[H+4]=v,this.uint16[H+5]=w,this.uint16[H+6]=A,this.uint16[H+7]=R,this.int16[H+8]=O,this.int16[H+9]=D,this.int16[H+10]=z,this.int16[H+11]=V,s}}Nb.prototype.bytesPerElement=24,En(Nb,"StructArrayLayout4i4ui4i24");class zb extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,s,u,h,p,_,v)}emplace(s,u,h,p,_,v,w){const A=10*s,R=5*s;return this.int16[A+0]=u,this.int16[A+1]=h,this.int16[A+2]=p,this.float32[R+2]=_,this.float32[R+3]=v,this.float32[R+4]=w,s}}zb.prototype.bytesPerElement=20,En(zb,"StructArrayLayout3i3f20");class Vh extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,u,h,p)}emplace(s,u,h,p,_){const v=4*s;return this.float32[v+0]=u,this.float32[v+1]=h,this.float32[v+2]=p,this.float32[v+3]=_,s}}Vh.prototype.bytesPerElement=16,En(Vh,"StructArrayLayout4f16");class t1 extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.uint32[1*s+0]=u,s}}t1.prototype.bytesPerElement=4,En(t1,"StructArrayLayout1ul4");class xu extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u){const h=this.length;return this.resize(h+1),this.emplace(h,s,u)}emplace(s,u,h){const p=2*s;return this.uint16[p+0]=u,this.uint16[p+1]=h,s}}xu.prototype.bytesPerElement=4,En(xu,"StructArrayLayout2ui4");class n1 extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_,v,w,A,R,O,D,z,V){const H=this.length;return this.resize(H+1),this.emplace(H,s,u,h,p,_,v,w,A,R,O,D,z,V)}emplace(s,u,h,p,_,v,w,A,R,O,D,z,V,H){const K=20*s,re=10*s;return this.int16[K+0]=u,this.int16[K+1]=h,this.int16[K+2]=p,this.int16[K+3]=_,this.int16[K+4]=v,this.float32[re+3]=w,this.float32[re+4]=A,this.float32[re+5]=R,this.float32[re+6]=O,this.int16[K+14]=D,this.uint32[re+8]=z,this.uint16[K+18]=V,this.uint16[K+19]=H,s}}n1.prototype.bytesPerElement=40,En(n1,"StructArrayLayout5i4f1i1ul2ui40");class r1 extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_,v,w){const A=this.length;return this.resize(A+1),this.emplace(A,s,u,h,p,_,v,w)}emplace(s,u,h,p,_,v,w,A){const R=8*s;return this.int16[R+0]=u,this.int16[R+1]=h,this.int16[R+2]=p,this.int16[R+4]=_,this.int16[R+5]=v,this.int16[R+6]=w,this.int16[R+7]=A,s}}r1.prototype.bytesPerElement=16,En(r1,"StructArrayLayout3i2i2i16");class i1 extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,s,u,h,p,_)}emplace(s,u,h,p,_,v){const w=4*s,A=8*s;return this.float32[w+0]=u,this.float32[w+1]=h,this.float32[w+2]=p,this.int16[A+6]=_,this.int16[A+7]=v,s}}i1.prototype.bytesPerElement=16,En(i1,"StructArrayLayout2f1f2i16");class Fb extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,s,u,h,p,_,v)}emplace(s,u,h,p,_,v,w){const A=20*s,R=5*s;return this.uint8[A+0]=u,this.uint8[A+1]=h,this.float32[R+1]=p,this.float32[R+2]=_,this.float32[R+3]=v,this.float32[R+4]=w,s}}Fb.prototype.bytesPerElement=20,En(Fb,"StructArrayLayout2ub4f20");class to extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,u,h)}emplace(s,u,h,p){const _=3*s;return this.uint16[_+0]=u,this.uint16[_+1]=h,this.uint16[_+2]=p,s}}to.prototype.bytesPerElement=6,En(to,"StructArrayLayout3ui6");class lm extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_,v,w,A,R,O,D,z,V,H,K,re,ne,ue,he,ge,ke){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,s,u,h,p,_,v,w,A,R,O,D,z,V,H,K,re,ne,ue,he,ge,ke)}emplace(s,u,h,p,_,v,w,A,R,O,D,z,V,H,K,re,ne,ue,he,ge,ke,Ee){const Pe=30*s,Be=15*s,$e=60*s;return this.int16[Pe+0]=u,this.int16[Pe+1]=h,this.int16[Pe+2]=p,this.float32[Be+2]=_,this.float32[Be+3]=v,this.uint16[Pe+8]=w,this.uint16[Pe+9]=A,this.uint32[Be+5]=R,this.uint32[Be+6]=O,this.uint32[Be+7]=D,this.uint16[Pe+16]=z,this.uint16[Pe+17]=V,this.uint16[Pe+18]=H,this.float32[Be+10]=K,this.float32[Be+11]=re,this.uint8[$e+48]=ne,this.uint8[$e+49]=ue,this.uint8[$e+50]=he,this.uint32[Be+13]=ge,this.int16[Pe+28]=ke,this.uint8[$e+58]=Ee,s}}lm.prototype.bytesPerElement=60,En(lm,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Bb extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_,v,w,A,R,O,D,z,V,H,K,re,ne,ue,he,ge,ke,Ee,Pe,Be,$e,mt,Xe,vt,kt,It,zt,Bt,Ot){const Lt=this.length;return this.resize(Lt+1),this.emplace(Lt,s,u,h,p,_,v,w,A,R,O,D,z,V,H,K,re,ne,ue,he,ge,ke,Ee,Pe,Be,$e,mt,Xe,vt,kt,It,zt,Bt,Ot)}emplace(s,u,h,p,_,v,w,A,R,O,D,z,V,H,K,re,ne,ue,he,ge,ke,Ee,Pe,Be,$e,mt,Xe,vt,kt,It,zt,Bt,Ot,Lt){const yt=20*s,gt=40*s,Dt=80*s;return this.float32[yt+0]=u,this.float32[yt+1]=h,this.int16[gt+4]=p,this.int16[gt+5]=_,this.int16[gt+6]=v,this.int16[gt+7]=w,this.int16[gt+8]=A,this.int16[gt+9]=R,this.int16[gt+10]=O,this.int16[gt+11]=D,this.int16[gt+12]=z,this.uint16[gt+13]=V,this.uint16[gt+14]=H,this.uint16[gt+15]=K,this.uint16[gt+16]=re,this.uint16[gt+17]=ne,this.uint16[gt+18]=ue,this.uint16[gt+19]=he,this.uint16[gt+20]=ge,this.uint16[gt+21]=ke,this.uint16[gt+22]=Ee,this.uint16[gt+23]=Pe,this.uint16[gt+24]=Be,this.uint16[gt+25]=$e,this.uint16[gt+26]=mt,this.uint16[gt+27]=Xe,this.uint32[yt+14]=vt,this.float32[yt+15]=kt,this.float32[yt+16]=It,this.float32[yt+17]=zt,this.float32[yt+18]=Bt,this.uint8[Dt+76]=Ot,this.uint16[gt+39]=Lt,s}}Bb.prototype.bytesPerElement=80,En(Bb,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class jb extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,s,u,h,p,_,v)}emplace(s,u,h,p,_,v,w){const A=6*s;return this.float32[A+0]=u,this.float32[A+1]=h,this.float32[A+2]=p,this.float32[A+3]=_,this.float32[A+4]=v,this.float32[A+5]=w,s}}jb.prototype.bytesPerElement=24,En(jb,"StructArrayLayout6f24");class Xf extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,s,u,h,p,_)}emplace(s,u,h,p,_,v){const w=5*s;return this.float32[w+0]=u,this.float32[w+1]=h,this.float32[w+2]=p,this.float32[w+3]=_,this.float32[w+4]=v,s}}Xf.prototype.bytesPerElement=20,En(Xf,"StructArrayLayout5f20");class Ub extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_,v,w){const A=this.length;return this.resize(A+1),this.emplace(A,s,u,h,p,_,v,w)}emplace(s,u,h,p,_,v,w,A){const R=7*s;return this.float32[R+0]=u,this.float32[R+1]=h,this.float32[R+2]=p,this.float32[R+3]=_,this.float32[R+4]=v,this.float32[R+5]=w,this.float32[R+6]=A,s}}Ub.prototype.bytesPerElement=28,En(Ub,"StructArrayLayout7f28");class Vb extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_,v,w,A,R,O,D){const z=this.length;return this.resize(z+1),this.emplace(z,s,u,h,p,_,v,w,A,R,O,D)}emplace(s,u,h,p,_,v,w,A,R,O,D,z){const V=11*s;return this.float32[V+0]=u,this.float32[V+1]=h,this.float32[V+2]=p,this.float32[V+3]=_,this.float32[V+4]=v,this.float32[V+5]=w,this.float32[V+6]=A,this.float32[V+7]=R,this.float32[V+8]=O,this.float32[V+9]=D,this.float32[V+10]=z,s}}Vb.prototype.bytesPerElement=44,En(Vb,"StructArrayLayout11f44");class um extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_,v,w,A,R){const O=this.length;return this.resize(O+1),this.emplace(O,s,u,h,p,_,v,w,A,R)}emplace(s,u,h,p,_,v,w,A,R,O){const D=9*s;return this.float32[D+0]=u,this.float32[D+1]=h,this.float32[D+2]=p,this.float32[D+3]=_,this.float32[D+4]=v,this.float32[D+5]=w,this.float32[D+6]=A,this.float32[D+7]=R,this.float32[D+8]=O,s}}um.prototype.bytesPerElement=36,En(um,"StructArrayLayout9f36");class sd extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u){const h=this.length;return this.resize(h+1),this.emplace(h,s,u)}emplace(s,u,h){const p=2*s;return this.float32[p+0]=u,this.float32[p+1]=h,s}}sd.prototype.bytesPerElement=8,En(sd,"StructArrayLayout2f8");class Bl extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,s,u,h,p)}emplace(s,u,h,p,_){const v=6*s;return this.uint32[3*s+0]=u,this.uint16[v+2]=h,this.uint16[v+3]=p,this.uint16[v+4]=_,s}}Bl.prototype.bytesPerElement=12,En(Bl,"StructArrayLayout1ul3ui12");class $h extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.uint16[1*s+0]=u,s}}$h.prototype.bytesPerElement=2,En($h,"StructArrayLayout1ui2");class $b extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_,v,w,A,R,O,D,z,V,H,K,re){const ne=this.length;return this.resize(ne+1),this.emplace(ne,s,u,h,p,_,v,w,A,R,O,D,z,V,H,K,re)}emplace(s,u,h,p,_,v,w,A,R,O,D,z,V,H,K,re,ne){const ue=16*s;return this.float32[ue+0]=u,this.float32[ue+1]=h,this.float32[ue+2]=p,this.float32[ue+3]=_,this.float32[ue+4]=v,this.float32[ue+5]=w,this.float32[ue+6]=A,this.float32[ue+7]=R,this.float32[ue+8]=O,this.float32[ue+9]=D,this.float32[ue+10]=z,this.float32[ue+11]=V,this.float32[ue+12]=H,this.float32[ue+13]=K,this.float32[ue+14]=re,this.float32[ue+15]=ne,s}}$b.prototype.bytesPerElement=64,En($b,"StructArrayLayout16f64");class s1 extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,h,p,_,v,w){const A=this.length;return this.resize(A+1),this.emplace(A,s,u,h,p,_,v,w)}emplace(s,u,h,p,_,v,w,A){const R=10*s,O=5*s;return this.uint16[R+0]=u,this.uint16[R+1]=h,this.uint16[R+2]=p,this.uint16[R+3]=_,this.float32[O+2]=v,this.float32[O+3]=w,this.float32[O+4]=A,s}}s1.prototype.bytesPerElement=20,En(s1,"StructArrayLayout4ui3f20");class Hb extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.int16[1*s+0]=u,s}}Hb.prototype.bytesPerElement=2,En(Hb,"StructArrayLayout1i2");class a1 extends Js{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.uint8[1*s+0]=u,s}}a1.prototype.bytesPerElement=1,En(a1,"StructArrayLayout1ub1");class o1 extends yg{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}o1.prototype.size=40;class wS extends n1{get(s){return new o1(this,s)}}En(wS,"CollisionBoxArray");class l1 extends yg{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(s){this._structArray.uint8[this._pos1+49]=s}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(s){this._structArray.uint8[this._pos1+50]=s}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(s){this._structArray.uint32[this._pos4+13]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(s){this._structArray.uint8[this._pos1+58]=s}}l1.prototype.size=60;class TS extends lm{get(s){return new l1(this,s)}}En(TS,"PlacedSymbolArray");class ES extends yg{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(s){this._structArray.uint32[this._pos4+14]=s}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(s){this._structArray.float32[this._pos4+18]=s}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}ES.prototype.size=80;class Gb extends Bb{get(s){return new ES(this,s)}}En(Gb,"SymbolInstanceArray");class u1 extends Bd{getoffsetX(s){return this.float32[1*s+0]}}En(u1,"GlyphOffsetArray");class SS extends Uh{getx(s){return this.int16[2*s+0]}gety(s){return this.int16[2*s+1]}}En(SS,"SymbolLineVertexArray");class qb extends yg{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}qb.prototype.size=12;class Zb extends Bl{get(s){return new qb(this,s)}}En(Zb,"FeatureIndexArray");class AS extends xu{geta_centroid_pos0(s){return this.uint16[2*s+0]}geta_centroid_pos1(s){return this.uint16[2*s+1]}}En(AS,"FillExtrusionCentroidArray");class c1 extends yg{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}c1.prototype.size=6;class vg extends am{get(s){return new c1(this,s)}}En(vg,"FillExtrusionWallArray");const CS=hi([{name:"a_pos",components:2,type:"Int16"}],4),DI=hi([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),kS=hi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class da{constructor(s=[]){this.segments=s}_prepareSegment(s,u,h,p){let _=this.segments[this.segments.length-1];return s>da.MAX_VERTEX_ARRAY_LENGTH&&Qt(`Max vertices per segment is ${da.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!_||_.vertexLength+s>da.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p)&&(_={vertexOffset:u,primitiveOffset:h,vertexLength:0,primitiveLength:0},p!==void 0&&(_.sortKey=p),this.segments.push(_)),_}prepareSegment(s,u,h,p){return this._prepareSegment(s,u.length,h.length,p)}get(){return this.segments}destroy(){for(const s of this.segments)for(const u in s.vaos)s.vaos[u].destroy()}static simpleSegment(s,u,h,p){return new da([{vertexOffset:s,primitiveOffset:u,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])}}function d1(c,s){return 256*(c=ee(Math.floor(c),0,255))+ee(Math.floor(s),0,255)}da.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,En(da,"SegmentVector");const NI=hi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),zI=hi([{name:"a_pattern_b",components:4,type:"Uint16"}]),FI=hi([{name:"a_dash",components:4,type:"Uint16"}]);class xg{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(s,u,h,p){this.ids.push(Wb(s)),this.positions.push(u,h,p)}eachPosition(s,u){const h=Wb(s);let p=0,_=this.ids.length-1;for(;p<_;){const v=p+_>>1;this.ids[v]>=h?_=v:p=v+1}for(;this.ids[p]===h;)u(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(s,u){const h=new Float64Array(s.ids),p=new Uint32Array(s.positions);return Xb(h,p,0,h.length-1),u&&(u.add(h.buffer),u.add(p.buffer)),{ids:h,positions:p}}static deserialize(s){const u=new xg;let h;u.ids=s.ids,u.positions=s.positions;for(const p of u.ids)p!==h&&u.uniqueIds.push(p),h=p;return u.indexed=!0,u}}function Wb(c){const s=+c;return Number.isSafeInteger(s)?s:oy(String(c))}function Xb(c,s,u,h){for(;u<h;){const p=c[u+h>>1];let _=u-1,v=h+1;for(;;){do _++;while(c[_]<p);do v--;while(c[v]>p);if(_>=v)break;h1(c,_,v),h1(s,3*_,3*v),h1(s,3*_+1,3*v+1),h1(s,3*_+2,3*v+2)}v-u<h-v?(Xb(c,s,u,v),u=v+1):(Xb(c,s,v+1,h),h=v)}}function h1(c,s,u){const h=c[s];c[s]=c[u],c[u]=h}En(xg,"FeaturePositionMap");class jd{constructor(s){this.gl=s.gl,this.initialized=!1}fetchUniformLocation(s,u){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(s,u),this.initialized=!0),!!this.location}set(s,u,h){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class f1 extends jd{constructor(s){super(s),this.current=0}set(s,u,h){this.fetchUniformLocation(s,u)&&this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}}class no extends jd{constructor(s){super(s),this.current=0}set(s,u,h){this.fetchUniformLocation(s,u)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class ad extends jd{constructor(s){super(s),this.current=[0,0]}set(s,u,h){this.fetchUniformLocation(s,u)&&(h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1])))}}class bg extends jd{constructor(s){super(s),this.current=[0,0,0]}set(s,u,h){this.fetchUniformLocation(s,u)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2])))}}class p1 extends jd{constructor(s){super(s),this.current=[0,0,0,0]}set(s,u,h){this.fetchUniformLocation(s,u)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class wg extends jd{constructor(s){super(s),this.current=ts.transparent.toPremultipliedRenderColor(null)}set(s,u,h){this.fetchUniformLocation(s,u)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const BI=new Float32Array(16);class Tg extends jd{constructor(s){super(s),this.current=BI}set(s,u,h){if(this.fetchUniformLocation(s,u)){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let p=1;p<16;p++)if(h[p]!==this.current[p]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}}}const m1=new Float32Array(9),jI=new Float32Array(4);class g1 extends jd{constructor(s){super(s),this.current=jI}set(s,u,h){if(this.fetchUniformLocation(s,u)){for(let p=0;p<4;p++)if(h[p]!==this.current[p]){this.current=h,this.gl.uniformMatrix2fv(this.location,!1,h);break}}}}function Yb(c){return[d1(255*c.r,255*c.g),d1(255*c.b,255*c.a)]}function Eg(c,s,u,h,p,_,v,w){return!!c&&(c.kind==="composite"||c.kind==="source"?c.evaluate(new zs(0,{brightness:_,worldview:w}),s,u,p,h,v)==="none":c.value==="none")}class Sg{constructor(s,u,h,p){this.value=s,this.uniformNames=u.map(_=>`u_${_}`),this.type=h,this.context=p}setUniform(s,u,h,p,_){const v=p.constantOr(this.value);u.set(s,_,v instanceof ts?v.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):v)}getBinding(s,u){return this.type==="color"?new wg(s):new no(s)}}class cm{constructor(s,u){this.uniformNames=u.map(h=>`u_${h}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(s,u){this.pixelRatio=s.pixelRatio||1,this.pattern=s.tl.concat(s.br),this.patternTransition=u?u.tl.concat(u.br):this.pattern}setUniform(s,u,h,p,_){let v=null;_!=="u_pattern"&&_!=="u_dash"||(v=this.pattern),_==="u_pattern_b"&&(v=this.patternTransition),_==="u_pixel_ratio"&&(v=this.pixelRatio),v&&u.set(s,_,v)}getBinding(s,u){return u==="u_pattern"||u==="u_pattern_b"||u==="u_dash"?new p1(s):new no(s)}}class Ud{constructor(s,u,h,p){this.expression=s,this.type=h,this.maxValue=0,this.paintVertexAttributes=u.map(_=>({name:`a_${_}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(s,u,h,p,_,v,w,A){const R=this.paintVertexArray.length,O=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new zs(0,{brightness:v,worldview:A}),u,{},_,p,w):this.expression.kind==="constant"&&this.expression.value,D=Eg(this.lutExpression,u,{},p,_,v,w,A);this.paintVertexArray.resize(s),this._setPaintValue(R,s,O,D?null:this.context.lut)}updatePaintArray(s,u,h,p,_,v,w,A){const R=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:w,worldview:A},h,p,void 0,_):this.expression.kind==="constant"&&this.expression.value,O=Eg(this.lutExpression,h,p,_,void 0,w,void 0,A);this._setPaintValue(s,u,R,O?null:this.context.lut)}_setPaintValue(s,u,h,p){if(this.type==="color"){const _=Yb(h.toPremultipliedRenderColor(p));for(let v=s;v<u;v++)this.paintVertexArray.emplace(v,_[0],_[1])}else{for(let _=s;_<u;_++)this.paintVertexArray.emplace(_,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vd{constructor(s,u,h,p,_,v){this.expression=s,this.uniformNames=u.map(w=>`u_${w}_t`),this.type=h,this.useIntegerZoom=p,this.context=_,this.maxValue=0,this.paintVertexAttributes=u.map(w=>({name:`a_${w}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(s,u,h,p,_,v,w,A){const R=this.expression.evaluate(new zs(this.context.zoom,{brightness:v,worldview:A}),u,{},_,p,w),O=this.expression.evaluate(new zs(this.context.zoom+1,{brightness:v,worldview:A}),u,{},_,p,w),D=Eg(this.lutExpression,u,{},p,_,v,w,A),z=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(z,s,R,O,D?null:this.context.lut)}updatePaintArray(s,u,h,p,_,v,w,A){const R=this.expression.evaluate({zoom:this.context.zoom,brightness:w,worldview:A},h,p,void 0,_),O=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w,worldview:A},h,p,void 0,_),D=Eg(this.lutExpression,h,p,_,void 0,w,void 0,A);this._setPaintValue(s,u,R,O,D?null:this.context.lut)}_setPaintValue(s,u,h,p,_){if(this.type==="color"){const v=Yb(h.toPremultipliedRenderColor(_)),w=Yb(h.toPremultipliedRenderColor(_));for(let A=s;A<u;A++)this.paintVertexArray.emplace(A,v[0],v[1],w[0],w[1])}else{for(let v=s;v<u;v++)this.paintVertexArray.emplace(v,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,u,h,p,_){const v=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,w=ee(this.expression.interpolationFactor(v,this.context.zoom,this.context.zoom+1),0,1);u.set(s,_,w)}getBinding(s,u){return new no(s)}}class $d{constructor(s,u,h,p,_){this.expression=s,this.layerId=_,this.paintVertexAttributes=(h==="array"?FI:NI).members;for(let v=0;v<u.length;++v);this.paintVertexArray=new p,this.paintTransitionVertexArray=new Wf}populatePaintArray(s,u,h,p){const _=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValues(_,s,u.patterns&&u.patterns[this.layerId],h)}updatePaintArray(s,u,h,p,_,v,w){this._setPaintValues(s,u,h.patterns&&h.patterns[this.layerId],v)}_setPaintValues(s,u,h,p){if(!p||!h)return;const _=p[h[0]],v=p[h[1]];if(_){if(_){const{tl:w,br:A,pixelRatio:R}=_;for(let O=s;O<u;O++)this.paintVertexArray.emplace(O,w[0],w[1],A[0],A[1],R)}if(v){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:w,br:A}=v;for(let R=s;R<u;R++)this.paintTransitionVertexArray.emplace(R,w[0],w[1],A[0],A[1])}}}upload(s){const u=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,u)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=s.createVertexBuffer(this.paintTransitionVertexArray,zI.members,u))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Hh{constructor(s,u,h=()=>!0){this.binders={},this._buffers=[],this.context=u;const p=[];for(const _ in s.paint._values){const v=s.paint.get(_);if(_.endsWith("-use-theme")||!h(_)||!(v instanceof $f&&dg(v.property.specification)))continue;const w=VI(_,s.type),A=v.value,R=v.property.specification.type,O=!!v.property.useIntegerZoom,D=_==="line-dasharray"||_.endsWith("pattern"),z=s.paint.get(`${_}-use-theme`),V=_==="line-dasharray"&&s.layout.get("line-cap").value.kind!=="constant"||z&&z.value.kind!=="constant";if(A.kind!=="constant"||V)if(A.kind==="source"||V||D){const H=Kb(_,R,"source");this.binders[_]=D?new $d(A,w,R,H,s.id):new Ud(A,w,R,H),p.push(`/a_${_}`)}else{const H=Kb(_,R,"composite");this.binders[_]=new Vd(A,w,R,O,u,H),p.push(`/z_${_}`)}else this.binders[_]=D?new cm(A.value,w):new Sg(A.value,w,R,u),p.push(`/u_${_}`);z&&(this.binders[_].lutExpression=z.value)}this.cacheKey=p.sort().join("")}getMaxValue(s){const u=this.binders[s];return u instanceof Ud||u instanceof Vd?u.maxValue:0}populatePaintArrays(s,u,h,p,_,v,w,A){for(const R in this.binders){const O=this.binders[R];O.context=this.context,(O instanceof Ud||O instanceof Vd||O instanceof $d)&&O.populatePaintArray(s,u,h,p,_,v,w,A)}}setConstantPatternPositions(s,u){for(const h in this.binders){const p=this.binders[h];p instanceof cm&&p.setConstantPatternPositions(s,u)}}getPatternTransitionVertexBuffer(s){const u=this.binders[s];return u instanceof $d?u.paintTransitionVertexBuffer:null}updatePaintArrays(s,u,h,p,_,v,w,A,R,O){let D=!1;const z=Object.keys(s),V=z.length!==0&&!A,H=V?z:u.uniqueIds;this.context.lut=_.lut;for(const K in this.binders){const re=this.binders[K];if(re.context=this.context,(re instanceof Ud||re instanceof Vd||re instanceof $d)&&re.expression&&re.expression.kind&&re.expression.kind!=="constant"&&(re.expression.isStateDependent===!0||re.expression.isLightConstant===!1)){const ne=_.paint.get(K);re.expression=ne.value;for(const ue of H){const he=s[ue.toString()];u.eachPosition(ue,(ge,ke,Ee)=>{const Pe=p.feature(ge);re.updatePaintArray(ke,Ee,Pe,he,v,w,R,O)})}if(!V)for(const ue of h.uniqueIds){const he=s[ue.toString()];h.eachPosition(ue,(ge,ke,Ee)=>{const Pe=p.feature(ge);re.updatePaintArray(ke,Ee,Pe,he,v,w,R,O)})}D=!0}}return D}defines(){const s=[];for(const u in this.binders){const h=this.binders[u];(h instanceof Sg||h instanceof cm)&&s.push(...h.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s){const u=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof Sg||p instanceof cm||p instanceof Vd)for(const _ of p.uniformNames)u.push({name:_,property:h,binding:p.getBinding(s,_)})}return u}setUniforms(s,u,h,p,_){for(const{name:v,property:w,binding:A}of h)this.binders[w].setUniform(s,A,_,p.get(w),v)}updatePaintBuffers(){this._buffers=[];for(const s in this.binders){const u=this.binders[s];(u instanceof Ud||u instanceof Vd||u instanceof $d)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer),u instanceof $d&&u.paintTransitionVertexBuffer&&this._buffers.push(u.paintTransitionVertexBuffer)}}upload(s){for(const u in this.binders){const h=this.binders[u];(h instanceof Ud||h instanceof Vd||h instanceof $d)&&h.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const u=this.binders[s];(u instanceof Ud||u instanceof Vd||u instanceof $d)&&u.destroy()}}}class Ec{constructor(s,u,h=()=>!0){this.programConfigurations={};for(const p of s)this.programConfigurations[p.id]=new Hh(p,u,h);this.needsUpload=!1,this._featureMap=new xg,this._featureMapWithoutIds=new xg,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(s,u,h,p,_,v,w,A,R){for(const O in this.programConfigurations)this.programConfigurations[O].populatePaintArrays(s,u,p,_,v,w,A,R);u.id!==void 0?this._featureMap.add(u.id,h,this._bufferOffset,s):(this._featureMapWithoutIds.add(this._idlessCounter,h,this._bufferOffset,s),this._idlessCounter+=1),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,u,h,p,_,v,w,A){for(const R of h)this.needsUpload=this.programConfigurations[R.id].updatePaintArrays(s,this._featureMap,this._featureMapWithoutIds,u,R,p,_,v,w||0,A)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}const UI={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function VI(c,s){return UI[c]||[c.replace(`${s}-`,"").replace(/-/g,"_")]}const $I={"line-pattern":{source:Fl,composite:Fl},"fill-pattern":{source:Fl,composite:Fl},"fill-extrusion-pattern":{source:Fl,composite:Fl},"line-dasharray":{source:Wf,composite:Wf}},HI={color:{source:sd,composite:Vh},number:{source:Bd,composite:sd}};function Kb(c,s,u){const h=$I[c];return h&&h[u]||HI[s][u]}En(Sg,"ConstantBinder"),En(cm,"PatternConstantBinder"),En(Ud,"SourceExpressionBinder"),En($d,"PatternCompositeBinder"),En(Vd,"CompositeExpressionBinder"),En(Hh,"ProgramConfiguration",{omit:["_buffers"]}),En(Ec,"ProgramConfigurationSet");const sl=Jt/Math.PI/2,Zu=5,_1=6,GI=16383,dm=64,Qb=[dm,32,16],Wu=-sl,Xu=sl;function Yf(c,s,u,h=sl){return u=cn(u),[c*Math.sin(u)*h,-s*h,c*Math.cos(u)*h]}function hm(c,s,u){return Yf(Math.cos(cn(c)),Math.sin(cn(c)),s,u)}const m=63710088e-1,o=2*Math.PI*m;class d{constructor(s,u){if(isNaN(s)||isNaN(u))throw new Error(`Invalid LngLat object: (${s}, ${u})`);if(this.lng=+s,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new d(ye(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const u=Math.PI/180,h=this.lat*u,p=s.lat*u,_=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((s.lng-this.lng)*u);return m*Math.acos(Math.min(_,1))}toBounds(s=0){const u=360*s/40075017,h=u/Math.cos(Math.PI/180*this.lat);return new g({lng:this.lng-h,lat:this.lat-u},{lng:this.lng+h,lat:this.lat+u})}toEcef(s){return hm(this.lat,this.lng,sl+s*sl/m)}static convert(s){if(s instanceof d)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new d(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new d(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class g{constructor(s,u){s&&(u?this.setSouthWest(s).setNorthEast(u):Array.isArray(s)&&s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1]))}setNorthEast(s){return this._ne=s instanceof d?new d(s.lng,s.lat):d.convert(s),this}setSouthWest(s){return this._sw=s instanceof d?new d(s.lng,s.lat):d.convert(s),this}extend(s){const u=this._sw,h=this._ne;let p,_;if(s instanceof d)p=s,_=s;else{if(!(s instanceof g))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(g.convert(s)):this.extend(d.convert(s)):typeof s=="object"&&s!==null&&s.hasOwnProperty("lat")&&(s.hasOwnProperty("lon")||s.hasOwnProperty("lng"))?this.extend(d.convert(s)):this;if(p=s._sw,_=s._ne,!p||!_)return this}return u||h?(u.lng=Math.min(p.lng,u.lng),u.lat=Math.min(p.lat,u.lat),h.lng=Math.max(_.lng,h.lng),h.lat=Math.max(_.lat,h.lat)):(this._sw=new d(p.lng,p.lat),this._ne=new d(_.lng,_.lat)),this}getCenter(){return new d((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d(this.getWest(),this.getNorth())}getSouthEast(){return new d(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:u,lat:h}=d.convert(s);let p=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(s){if(s)return s instanceof g?s:new g(s)}}const b=0,T=25.5;function E(c){return o*Math.cos(c*Math.PI/180)}function I(c){return(180+c)/360}function M(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function N(c,s){return c/E(s)}function j(c){return 360*c-180}function W(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Z(c,s){return c*E(W(s))}const Y=85.051129;function te(c){return Math.cos(cn(ee(c,-Y,Y)))}function J(c,s){const u=ee(s,b,T),h=Math.pow(2,u);return te(c)*o/(512*h)}function oe(c){return 1/Math.cos(c*Math.PI/180)}function ae(c,s=0){const u=Math.exp(Math.PI*(1-(c.y+s/Jt)/(1<<c.z)*2));return 80150034*u/(u*u+1)/Jt/(1<<c.z)}class pe{constructor(s,u,h=0){this.x=+s,this.y=+u,this.z=+h}static fromLngLat(s,u=0){const h=d.convert(s);return new pe(I(h.lng),M(h.lat),N(u,h.lat))}toLngLat(){return new d(j(this.x),W(this.y))}toAltitude(){return Z(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/o*oe(W(this.y))}}function _e(c,s,u,h,p,_,v,w,A){const R=(s+h)/2,O=(u+p)/2,D=new je(R,O);w(D),function(z,V,H,K,re,ne){const ue=H-re,he=K-ne;return Math.abs((K-V)*ue-(H-z)*he)/Math.hypot(ue,he)}(D.x,D.y,_.x,_.y,v.x,v.y)>=A?(_e(c,s,u,R,O,_,D,w,A),_e(c,R,O,h,p,D,v,w,A)):c.push(v)}function me(c,s,u){let h=c[0],p=h.x,_=h.y;s(h);const v=[h];for(let w=1;w<c.length;w++){const A=c[w],{x:R,y:O}=A;s(A),_e(v,p,_,R,O,h,A,s,u),p=R,_=O,h=A}return v}function Le(c,s,u,h){if(h(s,u)){const p=s.add(u)._mult(.5);Le(c,s,p,h),Le(c,p,u,h)}else c.push(u)}function Ce(c,s){let u=c[0];const h=[u];for(let p=1;p<c.length;p++){const _=c[p];Le(h,u,_,s),u=_}return h}const Re=Math.pow(2,14)-1,Ae=-Re-1;function Te(c,s){const u=Math.round(c.x*s),h=Math.round(c.y*s);return c.x=ee(u,Ae,Re),c.y=ee(h,Ae,Re),(u<c.x||u>c.x+1||h<c.y||h>c.y+1)&&Qt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function ze(c,s,u){const h=c.loadGeometry(),p=c.extent,_=Jt/p;if(s&&u&&u.projection.isReprojectedInTileSpace){const v=1<<s.z,{scale:w,x:A,y:R,projection:O}=u,D=z=>{const V=j((s.x+z.x/p)/v),H=W((s.y+z.y/p)/v),K=O.project(V,H);z.x=(K.x*w-A)*p,z.y=(K.y*w-R)*p};for(let z=0;z<h.length;z++)if(c.type!==1)h[z]=me(h[z],D,1);else{const V=[];for(const H of h[z])H.x<0||H.x>=p||H.y<0||H.y>=p||(D(H),V.push(H));h[z]=V}}for(const v of h)for(const w of v)Te(w,_);return h}function We(c,s){return{type:c.type,id:c.id,properties:c.properties,geometry:s?ze(c):[]}}class Ge{constructor(s,u,h,p,_){this.properties={},this.extent=h,this.type=0,this.id=void 0,this._pbf=s,this._geometry=-1,this._keys=p,this._values=_,s.readFields(ct,this,u)}loadGeometry(){const s=this._pbf;s.pos=this._geometry;const u=s.readVarint()+s.pos,h=[];let p,_=1,v=0,w=0,A=0;for(;s.pos<u;){if(v<=0){const R=s.readVarint();_=7&R,v=R>>3}if(v--,_===1||_===2)w+=s.readSVarint(),A+=s.readSVarint(),_===1&&(p&&h.push(p),p=[]),p&&p.push(new je(w,A));else{if(_!==7)throw new Error(`unknown command ${_}`);p&&p.push(p[0].clone())}}return p&&h.push(p),h}bbox(){const s=this._pbf;s.pos=this._geometry;const u=s.readVarint()+s.pos;let h=1,p=0,_=0,v=0,w=1/0,A=-1/0,R=1/0,O=-1/0;for(;s.pos<u;){if(p<=0){const D=s.readVarint();h=7&D,p=D>>3}if(p--,h===1||h===2)_+=s.readSVarint(),v+=s.readSVarint(),_<w&&(w=_),_>A&&(A=_),v<R&&(R=v),v>O&&(O=v);else if(h!==7)throw new Error(`unknown command ${h}`)}return[w,R,A,O]}toGeoJSON(s,u,h){const p=this.extent*Math.pow(2,h),_=this.extent*s,v=this.extent*u,w=this.loadGeometry();function A(z){return[360*(z.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(z.y+v)/p)*Math.PI))-90]}function R(z){return z.map(A)}let O;if(this.type===1){const z=[];for(const H of w)z.push(H[0]);const V=R(z);O=z.length===1?{type:"Point",coordinates:V[0]}:{type:"MultiPoint",coordinates:V}}else if(this.type===2){const z=w.map(R);O=z.length===1?{type:"LineString",coordinates:z[0]}:{type:"MultiLineString",coordinates:z}}else{if(this.type!==3)throw new Error("unknown feature type");{const z=function(H){const K=H.length;if(K<=1)return[H];const re=[];let ne,ue;for(let he=0;he<K;he++){const ge=ht(H[he]);ge!==0&&(ue===void 0&&(ue=ge<0),ue===ge<0?(ne&&re.push(ne),ne=[H[he]]):ne&&ne.push(H[he]))}return ne&&re.push(ne),re}(w),V=[];for(const H of z)V.push(H.map(R));O=V.length===1?{type:"Polygon",coordinates:V[0]}:{type:"MultiPolygon",coordinates:V}}}const D={type:"Feature",geometry:O,properties:this.properties};return this.id!=null&&(D.id=this.id),D}}function ct(c,s,u){c===1?s.id=u.readVarint():c===2?function(h,p){const _=h.readVarint()+h.pos;for(;h.pos<_;){const v=p._keys[h.readVarint()],w=p._values[h.readVarint()];p.properties[v]=w}}(u,s):c===3?s.type=u.readVarint():c===4&&(s._geometry=u.pos)}function ht(c){let s=0;for(let u,h,p=0,_=c.length,v=_-1;p<_;v=p++)u=c[p],h=c[v],s+=(h.x-u.x)*(u.y+h.y);return s}Ge.types=["Unknown","Point","LineString","Polygon"];class Et{constructor(s,u){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Ut,this,u),this.length=this._features.length}feature(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];const u=this._pbf.readVarint()+this._pbf.pos;return new Ge(this._pbf,u,this.extent,this._keys,this._values)}}function Ut(c,s,u){c===15?s.version=u.readVarint():c===1?s.name=u.readString():c===5?s.extent=u.readVarint():c===2?s._features.push(u.pos):c===3?s._keys.push(u.readString()):c===4&&s._values.push(function(h){let p=null;const _=h.readVarint()+h.pos;for(;h.pos<_;){const v=h.readVarint()>>3;p=v===1?h.readString():v===2?h.readFloat():v===3?h.readDouble():v===4?h.readVarint64():v===5?h.readVarint():v===6?h.readSVarint():v===7?h.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p}(u))}class it{constructor(s,u){this.layers=s.readFields(Ue,{},u)}}function Ue(c,s,u){if(c===3){const h=new Et(u,u.readVarint()+u.pos);h.length&&(s[h.name]=h)}}const _t="3d_elevation_id",ut="level";class Pt{constructor(){this._valid=!1}reset(s){return this.feature=s,this._valid=!0,this._geometry=s.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(s,u){return this._valid&&s(u(this._geometry)),this}require(s,u,h){return this.get(s,!0,u,h)}optional(s,u,h){return this.get(s,!1,u,h)}success(){return this._valid}get(s,u,h,p){const _=this.feature.properties.hasOwnProperty(s)?+this.feature.properties[s]:void 0;return this._valid&&_!==void 0&&!Number.isNaN(_)?h(p?p(_):_):u&&(this._valid=!1),this}}class nn{constructor(s,u){this.featureFunc=s,this.vertexFunc=u}parseFeature(s,u,h){return this.featureFunc(s,u,h)}parseVertex(s,u,h){return this.vertexFunc(s,u,h)}}const _n=new nn((c,s,u)=>c.reset(s).require(_t,h=>{u.id=h}).optional("fixed_height_relative",h=>{u.constantHeight=h},Vt.decodeRelativeHeight).geometry(h=>{u.bounds=h},Od).success(),(c,s,u)=>c.reset(s).require(_t,h=>{u.id=h}).require("elevation_idx",h=>{u.idx=h}).require("extent",h=>{u.extent=h}).require("height_relative",h=>{u.height=h},Vt.decodeRelativeHeight).geometry(h=>{u.position=h},Vt.getPoint).success()),Yt=new nn((c,s,u)=>c.reset(s).require(_t,h=>{u.id=h}).optional("fixed_height",h=>{u.constantHeight=h},Vt.decodeMetricHeight).geometry(h=>{u.bounds=h},Od).success(),(c,s,u)=>c.reset(s).require(_t,h=>{u.id=h}).require("elevation_idx",h=>{u.idx=h}).require("extent",h=>{u.extent=h}).require("height",h=>{u.height=h},Vt.decodeMetricHeight).geometry(h=>{u.position=h},Vt.getPoint).success());class Vt{static getPoint(s){return Zi(s[0][0].x,s[0][0].y)}static decodeRelativeHeight(s){return 1e-4*s*5}static decodeMetricHeight(s){return 1e-4*s}static getVersionSchema(s){return s?s==="1.0.1"?Yt:void 0:_n}static parse(s){const u=[],h=[],p=s.length,_=new Pt;for(let v=0;v<p;v++){const w=s.feature(v),A=w.properties.version,R=Vt.getVersionSchema(A);if(R===void 0){Qt(`Unknown elevation feature version number ${A||"(unknown)"}`);continue}const O=w.properties.type;if(!O)continue;const D=Ge.types[w.type];if(D==="Point"&&O==="curve_point"){const z={};R.parseVertex(_,w,z)&&u.push(z)}else if(D==="Polygon"&&O==="curve_meta"){const z={};R.parseFeature(_,w,z)&&h.push(z)}}return{vertices:u,features:h}}}class On{constructor(s,u){this.pos=s,this.dir=u}intersectsPlane(s,u,h){const p=kr(u,this.dir);if(Math.abs(p)<1e-6)return!1;const _=((s[0]-this.pos[0])*u[0]+(s[1]-this.pos[1])*u[1])/p;return h[0]=this.pos[0]+this.dir[0]*_,h[1]=this.pos[1]+this.dir[1]*_,!0}}class Cn{constructor(s,u){this.pos=s,this.dir=u}intersectsPlane(s,u,h){const p=wn(u,this.dir);if(Math.abs(p)<1e-6)return!1;const _=((s[0]-this.pos[0])*u[0]+(s[1]-this.pos[1])*u[1]+(s[2]-this.pos[2])*u[2])/p;return h[0]=this.pos[0]+this.dir[0]*_,h[1]=this.pos[1]+this.dir[1]*_,h[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(s,u,h){if(function(V,H){var K=V[0],re=V[1],ne=V[2],ue=H[0],he=H[1],ge=H[2];return Math.abs(K-ue)<=y*Math.max(1,Math.abs(K),Math.abs(ue))&&Math.abs(re-he)<=y*Math.max(1,Math.abs(re),Math.abs(he))&&Math.abs(ne-ge)<=y*Math.max(1,Math.abs(ne),Math.abs(ge))}(this.pos,s)||u===0)return h[0]=h[1]=h[2]=0,!1;const[p,_,v]=this.dir,w=this.pos[0]-s[0],A=this.pos[1]-s[1],R=this.pos[2]-s[2],O=p*p+_*_+v*v,D=2*(w*p+A*_+R*v),z=D*D-4*O*(w*w+A*A+R*R-u*u);if(z<0){const V=Math.max(-D/2,0),H=w+p*V,K=A+_*V,re=R+v*V,ne=Math.hypot(H,K,re);return h[0]=H*u/ne,h[1]=K*u/ne,h[2]=re*u/ne,!1}{const V=(-D-Math.sqrt(z))/(2*O);if(V<0){const H=Math.hypot(w,A,R);return h[0]=w*u/H,h[1]=A*u/H,h[2]=R*u/H,!1}return h[0]=w+p*V,h[1]=A+_*V,h[2]=R+v*V,!0}}}class fn{constructor(s,u,h,p,_){this.TL=s,this.TR=u,this.BR=h,this.BL=p,this.horizon=_}static fromInvProjectionMatrix(s,u,h){const p=[-1,1,1],_=[1,1,1],v=[1,-1,1],w=[-1,-1,1],A=rn(p,p,s),R=rn(_,_,s),O=rn(v,v,s),D=rn(w,w,s);return new fn(A,R,O,D,u/h)}}function vn(c,s,u){let h=1/0,p=-1/0;const _=[];for(const v of c){Vn(_,v,s);const w=wn(_,u);h=Math.min(h,w),p=Math.max(p,w)}return[h,p]}function tr(c,s){let u=!0;for(let h=0;h<c.planes.length;h++){const p=c.planes[h];let _=0;for(let v=0;v<s.length;v++)_+=+(wn(p,s[v])+p[3]>=0);if(_===0)return 0;_!==s.length&&(u=!1)}return u?2:1}function Nr(c,s){for(const u of c.projections){const h=vn(s,c.points[0],u.axis);if(u.projection[1]<h[0]||u.projection[0]>h[1])return 0}return 1}function mi(c,s){let u=0;const h=[0,0,0,0];for(let v=0;v<c.length;v++)h[0]=c[v][0],h[1]=c[v][1],h[2]=c[v][2],h[3]=1,(p=h)[0]*(_=s)[0]+p[1]*_[1]+p[2]*_[2]+p[3]*_[3]>=0&&u++;var p,_;return u}class Bi{constructor(s,u){this.points=s||new Array(8).fill([0,0,0]),this.planes=u||new Array(6).fill([0,0,0,0]),this.bounds=Nn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Vn([],this.points[2],this.points[3]),Vn([],this.points[0],this.points[3]),Vn([],this.points[4],this.points[0]),Vn([],this.points[5],this.points[1]),Vn([],this.points[6],this.points[2]),Vn([],this.points[7],this.points[3])];for(const h of this.frustumEdges){const p=[0,-h[2],h[1]],_=[h[2],0,-h[0]];this.projections.push({axis:p,projection:vn(this.points,this.points[0],p)}),this.projections.push({axis:_,projection:vn(this.points,this.points[0],_)})}}static fromInvProjectionMatrix(s,u,h,p){const _=Math.pow(2,h),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>{const O=$i([],R,s),D=1/O[3]/u*_;return(z=O)[0]=(V=O)[0]*(H=[D,D,p?1/O[3]:D,D])[0],z[1]=V[1]*H[1],z[2]=V[2]*H[2],z[3]=V[3]*H[3],z;var z,V,H}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(R=>{const O=qt([],Sn([],Vn([],v[R[0]],v[R[1]]),Vn([],v[R[2]],v[R[1]]))),D=-wn(O,v[R[1]]);return O.concat(D)}),A=[];for(let R=0;R<v.length;R++)A.push([v[R][0],v[R][1],v[R][2]]);return new Bi(A,w)}intersectsPrecise(s,u,h){for(let p=0;p<u.length;p++)if(!mi(s,u[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!mi(s,this.planes[p]))return 0;for(const p of h)for(const _ of this.frustumEdges){const v=Sn([],p,_),w=Nt(v);if(w===0)continue;Fe(v,v,1/w);const A=vn(this.points,this.points[0],v),R=vn(s,this.points[0],v);if(A[0]>R[1]||R[0]>A[1])return 0}return 1}containsPoint(s){for(const u of this.planes){const h=u[3];if(wn([u[0],u[1],u[2]],s)+h<0)return!1}return!0}}class Nn{static fromPoints(s){const u=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const p of s)gn(u,u,p),wt(h,h,p);return new Nn(u,h)}static fromTileIdAndHeight(s,u,h){const p=1<<s.canonical.z,_=s.canonical.x,v=s.canonical.y;return new Nn([_/p,v/p,u],[(_+1)/p,(v+1)/p,h])}static applyTransform(s,u){const h=s.getCorners();for(let p=0;p<h.length;++p)rn(h[p],h[p],u);return Nn.fromPoints(h)}static applyTransformFast(s,u){const h=[u[12],u[13],u[14]],p=[...h];for(let _=0;_<3;_++)for(let v=0;v<3;v++){const w=u[4*v+_],A=w*s.min[v],R=w*s.max[v];h[_]+=Math.min(A,R),p[_]+=Math.max(A,R)}return new Nn(h,p)}static projectAabbCorners(s,u){const h=s.getCorners();for(let p=0;p<h.length;++p)rn(h[p],h[p],u);return h}constructor(s,u){this.min=s,this.max=u,this.center=Fe([],nt([],this.min,this.max),.5)}quadrant(s){const u=[s%2==0,s<2],h=Ct(this.min),p=Ct(this.max);for(let _=0;_<u.length;_++)h[_]=u[_]?this.min[_]:this.center[_],p[_]=u[_]?this.center[_]:this.max[_];return p[2]=this.max[2],new Nn(h,p)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}distanceZ(s){return Math.max(Math.min(this.max[2],s[2]),this.min[2])-s[2]}getCorners(){const s=this.min,u=this.max;return[[s[0],s[1],s[2]],[u[0],s[1],s[2]],[u[0],u[1],s[2]],[s[0],u[1],s[2]],[s[0],s[1],u[2]],[u[0],s[1],u[2]],[u[0],u[1],u[2]],[s[0],u[1],u[2]]]}intersects(s){return this.intersectsAabb(s.bounds)?tr(s,this.getCorners()):0}intersectsFlat(s){return this.intersectsAabb(s.bounds)?tr(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(s,u){return u||this.intersects(s)?Nr(s,this.getCorners()):0}intersectsPreciseFlat(s,u){return u||this.intersectsFlat(s)?Nr(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(s){for(let u=0;u<3;++u)if(this.min[u]>s.max[u]||s.min[u]>this.max[u])return!1;return!0}intersectsAabbXY(s){return!(this.min[0]>s.max[0]||s.min[0]>this.max[0]||this.min[1]>s.max[1]||s.min[1]>this.max[1])}encapsulate(s){for(let u=0;u<3;u++)this.min[u]=Math.min(this.min[u],s.min[u]),this.max[u]=Math.max(this.max[u],s.max[u])}encapsulatePoint(s){for(let u=0;u<3;u++)this.min[u]=Math.min(this.min[u],s[u]),this.max[u]=Math.max(this.max[u],s[u])}closestPoint(s){return[Math.max(Math.min(this.max[0],s[0]),this.min[0]),Math.max(Math.min(this.max[1],s[1]),this.min[1]),Math.max(Math.min(this.max[2],s[2]),this.min[2])]}}En(Nn,"Aabb");class Ni{constructor(s,u){this.feature=s,this.metersToTile=u,this.index=0}get(){const s=this.feature.vertices[this.index],u=this.feature.vertexProps[this.index].dir,h=u[1],p=-u[0],_=(s.extent+1)*this.metersToTile;return[new je(Math.trunc(s.position[0]+h*_),Math.trunc(s.position[1]+p*_)),new je(Math.trunc(s.position[0]-h*_),Math.trunc(s.position[1]-p*_))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Dr{constructor(s,u,h,p,_,v){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[ti(),ti(),ti(),ti(),ti(),ti(),ti()],this.id=s,this.heightRange={min:h,max:h},this.safeArea=u,this.constantHeight=h,this.constantHeight==null&&(this.constantHeight!=null||p.length!==0)){this.vertices=p,this.edges=_,this.edges=this.edges.filter(w=>{return w.a<this.vertices.length&&w.b<this.vertices.length&&!((A=this.vertices[w.a].position)[0]===(R=this.vertices[w.b].position)[0]&&A[1]===R[1]);var A,R}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const w of this.vertices)this.vertexProps.push({dir:Zi(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,w.height),this.heightRange.max=Math.max(this.heightRange.max,w.height);for(const w of this.edges){const A=this.vertices[w.a].position,R=this.vertices[w.b].position,O=Hn(ti(),R,A),D=sn(O),z=Ke(ti(),O,1/D);this.edgeProps.push({vec:O,dir:z,len:D});const V=this.vertexProps[w.a].dir,H=this.vertexProps[w.b].dir;Ln(V,V,z),Ln(H,H,z)}for(const w of this.vertexProps)w.dir[0]===0&&w.dir[1]===0||bn(w.dir,w.dir);this.tessellate(v)}}pointElevation(s){if(this.constantHeight!=null)return this.constantHeight;const u=this.getClosestEdge(s);if(u==null)return 0;const[h,p]=u;return Tr(this.vertices[this.edges[h].a].height,this.vertices[this.edges[h].b].height,p)}computeSlopeNormal(s,u){const h=this.getClosestEdge(s);if(!h)return Rt(0,0,1);const p=h[0],_=this.edges[p],v=this.edgeProps[p].vec,w=Rt(v[0],v[1],(this.vertices[_.b].height-this.vertices[_.a].height)*u),A=Rt(w[1],-w[0],0);Sn(A,A,w);const R=Nt(A);return R>0?Fe(A,A,1/R):en(A,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(s){if(this.edges.length===0)return;let u=0,h=Number.POSITIVE_INFINITY,p=0;const[_,v,w,A,R,O,D]=this._tmpVec2;Is(D,s.x,s.y);const z=new On(D,null);for(let V=0;V<this.edges.length;V++){const H=this.edges[V],K=this.edgeProps[V].dir;z.dir=K;const re=this.vertices[H.a].position,ne=this.vertices[H.b].position,ue=z.intersectsPlane(re,this.vertexProps[H.a].dir,_),he=z.intersectsPlane(ne,this.vertexProps[H.b].dir,v);if(!ue||!he)continue;Hn(w,v,_),Hn(A,D,_);const ge=kr(w,w),ke=ge>0?kr(A,w)/ge:0,Ee=ee(ke,0,1),Pe=Math.abs((ke-Ee)*this.edgeProps[V].len);Hn(R,D,re),Is(O,K[1],-K[0]);const Be=Pe+Math.abs(kr(R,O));Be<h&&(u=V,h=Be,p=Ee)}return[u,p]}tessellate(s){const u=ft(),h=ft(),p=ft(),_=ft();for(let v=this.edges.length-1;v>=0;--v){const w=this.edges[v].a,A=this.edges[v].b,{position:R,height:O,extent:D}=this.vertices[w],{position:z,height:V,extent:H}=this.vertices[A],K=this.vertexProps[w].dir,re=this.vertexProps[A].dir;if(en(u,R[0]/s,R[1]/s,O),en(h,z[0]/s,z[1]/s,V),en(p,K[1],-K[0],0),Fe(p,p,D),en(_,re[1],-re[0],0),Fe(_,_,H),this.distSqLines(Rt(u[0]+.5*p[0],u[1]+.5*p[1],u[2]+.5*p[2]),Rt(h[0]-.5*_[0],h[1]-.5*_[1],h[2]-.5*_[2]),Rt(u[0]-.5*p[0],u[1]-.5*p[1],u[2]-.5*p[2]),Rt(h[0]+.5*_[0],h[1]+.5*_[1],h[2]+.5*_[2]))<=.0025000000000000005)continue;const ne=this.vertices.length,ue=Ln(ti(),R,z);this.vertices.push({position:Ke(ue,ue,.5),height:.5*(O+V),extent:.5*(D+H)});const he=Ln(ti(),K,re);this.vertexProps.push({dir:bn(he,he)}),this.edges.splice(v,1),this.edgeProps.splice(v,1),this.edges.push({a:w,b:ne}),this.edges.push({a:ne,b:A});const ge=Hn(ti(),this.vertices[ne].position,R),ke=sn(ge),Ee={vec:ge,dir:Ke(ti(),ge,1/ke),len:ke};this.edgeProps.push(Ee),this.edgeProps.push(Ee)}}distSqLines(s,u,h,p){const _=pt(ft(),u,s),v=pt(ft(),p,h),w=pt(ft(),s,h),A=wn(_,_),R=wn(_,v),O=wn(_,w),D=wn(v,v),z=wn(v,w),V=A*D-R*R;if(V===0)return mn(Xn(_,h,p,wn(w,v)/wn(v,v)),s);const H=(A*z-R*O)/V;return mn(Xn(_,s,u,(R*z-O*D)/V),Xn(v,h,p,H))}}class Wi{static parseFrom(s,u){const h=Vt.parse(s);if(!h)return[];let{vertices:p,features:_}=h;const v=1/ae(u);_.sort((O,D)=>O.id-D.id),p.sort((O,D)=>O.id-D.id||O.idx-D.idx),p=p.filter((O,D,z)=>D===z.findIndex(V=>V.id===O.id&&V.idx===O.idx));const w=new Array;let A=0;const R=p.length;for(const O of _){if(O.constantHeight){w.push(new Dr(O.id,O.bounds,O.constantHeight));continue}for(;A!==R&&p[A].id<O.id;)A++;if(A===R||p[A].id!==O.id)continue;const D=new Array,z=new Array,V=A;for(;A!==R&&p[A].id===O.id;){const H=p[A];if(D.push({position:H.position,height:H.height,extent:H.extent}),A!==V&&p[A-1].idx===H.idx-1){const K=A-V;z.push({a:K-1,b:K})}A++}w.push(new Dr(O.id,O.bounds,void 0,D,z,v))}return w}static getElevationFeature(s,u){if(!u)return;const h=+s.properties[_t];return Number.isNaN(h)?void 0:u.find(p=>p.id===h)}}class ls{constructor(s,u){this.zScale=1,this.xOffset=0,this.yOffset=0,s.equals(u)||(this.zScale=Math.pow(2,u.z-s.z),this.xOffset=(s.x*this.zScale-u.x)*Jt,this.yOffset=(s.y*this.zScale-u.y)*Jt)}constantElevation(s,u){if(s.constantHeight!=null)return this.computeBiasedHeight(s.constantHeight,u)}pointElevation(s,u,h){const p=this.constantElevation(u,h);return p??(s.x=s.x*this.zScale+this.xOffset,s.y=s.y*this.zScale+this.yOffset,this.computeBiasedHeight(u.pointElevation(s),h))}computeBiasedHeight(s,u){return u<=0?s:s+u*le(0,u,s>=0?s:Math.abs(.5*s))}}En(Dr,"ElevationFeature");class ns{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.fqid),this.index=s.index,this.hasPattern=!1,this.projection=s.projection,this.layoutVertexArray=new Uh,this.indexArray=new to,this.segments=new da,this.programConfigurations=new Ec(s.layers,{zoom:s.zoom,lut:s.lut}),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Bd),this.worldview=s.worldview,this.hasAppearances=null}updateFootprints(s,u){}updateAppearances(s,u,h,p){}populate(s,u,h,p){const _=this.layers[0],v=[];let w=null;_.type==="circle"&&(w=_.layout.get("circle-sort-key"));for(const{feature:R,id:O,index:D,sourceLayerIndex:z}of s){const V=this.layers[0]._featureFilter.needGeometry,H=We(R,V);if(!this.layers[0]._featureFilter.filter(new zs(this.zoom,{worldview:this.worldview,activeFloors:u.activeFloors}),H,h))continue;const K=w?w.evaluate(H,{},h):void 0,re={id:O,properties:R.properties,type:R.type,sourceLayerIndex:z,index:D,geometry:V?H.geometry:ze(R,h,p),patterns:{},sortKey:K};v.push(re)}w&&v.sort((R,O)=>R.sortKey-O.sortKey);let A=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new e1,A=p.projection);for(const R of v){const{geometry:O,index:D,sourceLayerIndex:z}=R,V=s[D].feature;this.addFeature(R,O,D,u.availableImages,h,A,u.brightness,u.elevationFeatures),u.featureIndex.insert(V,O,D,z,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(s,u,h,p,_,v,w){this.programConfigurations.updatePaintArrays(s,u,_,h,p,v,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,CS.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,kS.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=s.createVertexBuffer(this.elevatedLayoutVertexArray,DI.members))),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(s,u,h,p,_,v,w,A){let R;this.elevationMode!=="none"&&(R=Wi.getElevationFeature(s,A));for(const O of u)for(const D of O){const z=D.x,V=D.y;if(z<0||z>=Jt||V<0||V>=Jt)continue;if(v){const re=v.projectTilePoint(z,V,_),ne=v.upVector(_,z,V);this.addGlobeExtVertex(re,ne),this.addGlobeExtVertex(re,ne),this.addGlobeExtVertex(re,ne),this.addGlobeExtVertex(re,ne)}const H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),K=H.vertexLength;if(this.addCircleVertex(z,V,-1,-1),this.addCircleVertex(z,V,1,-1),this.addCircleVertex(z,V,1,1),this.addCircleVertex(z,V,-1,1),this.elevationMode!=="none"){const re=R?R.pointElevation(new je(z,V)):0;this.hasElevation=this.hasElevation||re!==0;for(let ne=0;ne<4;ne++)this.elevatedLayoutVertexArray.emplaceBack(re)}this.indexArray.emplaceBack(K,K+1,K+2),this.indexArray.emplaceBack(K,K+2,K+3),H.vertexLength+=4,H.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,{},p,_,w,void 0,this.worldview)}addCircleVertex(s,u,h,p){this.layoutVertexArray.emplaceBack(2*s+(h+1)/2,2*u+(p+1)/2)}addGlobeExtVertex(s,u){this.globeExtVertexArray.emplaceBack(s.x,s.y,s.z,u[0]*16384,u[1]*16384,u[2]*16384)}}function Di(c,s){for(let u=0;u<c.length;u++)if(xs(s,c[u]))return!0;for(let u=0;u<s.length;u++)if(xs(c,s[u]))return!0;return!!ea(c,s)}function Hr(c,s,u){return!!xs(c,s)||!!qs(s,c,u)}function Gi(c,s){if(c.length===1)return ha(s,c[0]);for(let u=0;u<s.length;u++){const h=s[u];for(let p=0;p<h.length;p++)if(xs(c,h[p]))return!0}for(let u=0;u<c.length;u++)if(ha(s,c[u]))return!0;for(let u=0;u<s.length;u++)if(ea(c,s[u]))return!0;return!1}function ga(c,s,u){if(c.length>1){if(ea(c,s))return!0;for(let h=0;h<s.length;h++)if(qs(s[h],c,u))return!0}for(let h=0;h<c.length;h++)if(qs(c[h],s,u))return!0;return!1}function ea(c,s){if(c.length===0||s.length===0)return!1;for(let u=0;u<c.length-1;u++){const h=c[u],p=c[u+1];for(let _=0;_<s.length-1;_++)if(Xi(h,p,s[_],s[_+1]))return!0}return!1}function Xi(c,s,u,h){return Ar(c,u,h)!==Ar(s,u,h)&&Ar(c,s,u)!==Ar(c,s,h)}function ki(c,s,u){return(c.x-u.x)*(s.y-u.y)-(c.y-u.y)*(s.x-u.x)}function Gr(c,s,u,h){const p=ki(c,s,h),_=ki(c,s,u);if(Math.sign(p)===Math.sign(_))return;const v=ki(u,h,c),w=v+_-p;return Math.sign(v)!==Math.sign(w)?[v/(v-w),_/(_-p)]:void 0}function qs(c,s,u){const h=u*u;if(s.length===1)return c.distSqr(s[0])<h;for(let p=1;p<s.length;p++)if(Pa(c,s[p-1],s[p])<h)return!0;return!1}function Pa(c,s,u){const h=s.distSqr(u);if(h===0)return c.distSqr(s);const p=((c.x-s.x)*(u.x-s.x)+(c.y-s.y)*(u.y-s.y))/h;return c.distSqr(p<0?s:p>1?u:u.sub(s)._mult(p)._add(s))}function ha(c,s){let u,h,p,_=!1;for(let v=0;v<c.length;v++){u=c[v];for(let w=0,A=u.length-1;w<u.length;A=w++)h=u[w],p=u[A],h.y>s.y!=p.y>s.y&&s.x<(p.x-h.x)*(s.y-h.y)/(p.y-h.y)+h.x&&(_=!_)}return _}function xs(c,s){let u=!1;for(let h=0,p=c.length-1;h<c.length;p=h++){const _=c[h],v=c[p];_.y>s.y!=v.y>s.y&&s.x<(v.x-_.x)*(s.y-_.y)/(v.y-_.y)+_.x&&(u=!u)}return u}function Il(c,s,u,h,p){for(const v of c)if(s<=v.x&&u<=v.y&&h>=v.x&&p>=v.y)return!0;const _=[new je(s,u),new je(s,p),new je(h,p),new je(h,u)];if(c.length>2){for(const v of _)if(xs(c,v))return!0}for(let v=0;v<c.length-1;v++)if(Xo(c[v],c[v+1],_))return!0;return!1}function Xo(c,s,u){const h=u[0],p=u[2];if(c.x<h.x&&s.x<h.x||c.x>p.x&&s.x>p.x||c.y<h.y&&s.y<h.y||c.y>p.y&&s.y>p.y)return!1;const _=Ar(c,s,u[0]);return _!==Ar(c,s,u[1])||_!==Ar(c,s,u[2])||_!==Ar(c,s,u[3])}function ro(c,s,u,h,p,_){let v=s.y-c.y,w=c.x-s.x;if(_=_||0){const A=v*v+w*w;if(A===0)return!0;const R=Math.sqrt(A);v/=R,w/=R}return!((u.x-c.x)*v+(u.y-c.y)*w-_<0||(h.x-c.x)*v+(h.y-c.y)*w-_<0||(p.x-c.x)*v+(p.y-c.y)*w-_<0)}function al(c,s,u,h,p,_,v){return!(ro(c,s,h,p,_,v)||ro(s,u,h,p,_,v)||ro(u,c,h,p,_,v)||ro(h,p,c,s,u,v)||ro(p,_,c,s,u,v)||ro(_,h,c,s,u,v))}function ol(c,s,u){const h=s.paint.get(c).value;return h.kind==="constant"?h.value:u.programConfigurations.get(s.id).getMaxValue(c)}function Uo(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function bu(c,s,u,h,p){if(!s[0]&&!s[1])return c;const _=je.convert(s)._mult(p);u==="viewport"&&_._rotate(-h);const v=[];for(let w=0;w<c.length;w++)v.push(c[w].sub(_));return v}function Yu(c,s,u,h){const p=je.convert(c)._mult(h);return s==="viewport"&&p._rotate(-u),p}let jl,ba;function Fa(c,s,u){var h=2*Math.PI*6378137/256/Math.pow(2,u);return[c*h-2*Math.PI*6378137/2,s*h-2*Math.PI*6378137/2]}En(ns,"CircleBucket",{omit:["layers"]});class bs{constructor(s,u,h){this.z=s,this.x=u,this.y=h,this.key=fa(0,s,s,u,h)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}isChildOf(s){const u=this.z-s.z;return s.z===0||s.z<this.z&&s.x===this.x>>u&&s.y===this.y>>u}url(s,u){const h=function(_,v,w){var A=Fa(256*_,256*(v=Math.pow(2,w)-v-1),w),R=Fa(256*(_+1),256*(v+1),w);return A[0]+","+A[1]+","+R[0]+","+R[1]}(this.x,this.y,this.z),p=function(_,v,w){let A,R="";for(let O=_;O>0;O--)A=1<<O-1,R+=(v&A?1:0)+(w&A?2:0);return R}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ha{constructor(s,u){this.wrap=s,this.canonical=u,this.key=fa(s,u.z,u.z,u.x,u.y)}}class _a{constructor(s,u,h,p,_){this.overscaledZ=s,this.wrap=u,this.canonical=new bs(h,+p,+_),this.key=u===0&&s===h?this.canonical.key:fa(u,s,h,p,_)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){const u=this.canonical.z-s;return s>this.canonical.z?new _a(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _a(s,this.wrap,s,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(s,u=!0){if(this.overscaledZ===s&&u)return this.key;if(s>this.canonical.z)return fa(this.wrap*+u,s,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-s;return fa(this.wrap*+u,s,s,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(s){if(s.wrap!==this.wrap)return!1;const u=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.z<this.canonical.z&&s.canonical.x===this.canonical.x>>u&&s.canonical.y===this.canonical.y>>u}children(s){if(this.overscaledZ>=s)return[new _a(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,h=2*this.canonical.x,p=2*this.canonical.y;return[new _a(u,this.wrap,u,h,p),new _a(u,this.wrap,u,h+1,p),new _a(u,this.wrap,u,h,p+1),new _a(u,this.wrap,u,h+1,p+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new _a(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new _a(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ha(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function fa(c,s,u,h,p){const _=1<<Math.min(u,22);let v=_*(p%_)+h%_;return c&&u<22&&(v+=_*_*((c<0?-2*c-1:2*c)%(1<<2*(22-u)))),16*(32*v+u)+(s-u)}const Ku=[c=>{let s=c.canonical.x-1,u=c.wrap;return s<0&&(s=(1<<c.canonical.z)-1,u--),new _a(c.overscaledZ,u,c.canonical.z,s,c.canonical.y)},c=>{let s=c.canonical.x+1,u=c.wrap;return s===1<<c.canonical.z&&(s=0,u++),new _a(c.overscaledZ,u,c.canonical.z,s,c.canonical.y)},c=>new _a(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new _a(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];En(bs,"CanonicalTileID"),En(_a,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Ag=hi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Sc}=Ag,Cg=hi([{name:"a_pos_3",components:3,type:"Int16"}]);var fm=hi([{name:"a_pos",type:"Int16",components:2}]);function od(c){return c*sl/m}const Hd=[new Nn([Wu,Wu,Wu],[Xu,Xu,Xu]),new Nn([Wu,Wu,Wu],[0,0,Xu]),new Nn([0,Wu,Wu],[Xu,0,Xu]),new Nn([Wu,0,Wu],[0,Xu,Xu]),new Nn([0,0,Wu],[Xu,Xu,Xu])];function pm(c,s,u,h=!0){const p=Fe([],c._camera.position,c.worldSize),_=[s,u,1,1];$i(_,_,c.pixelMatrixInverse),Ri(_,_,1/_[3]);const v=qt([],Vn([],_,p)),w=c.globeMatrix,A=[w[12],w[13],w[14]],R=Vn([],A,p),O=Nt(R),D=qt([],R),z=c.worldSize/(2*Math.PI),V=wn(D,v),H=Math.asin(z/O);if(H<Math.acos(V)){if(!h)return null;const mt=[],Xe=[];Fe(mt,v,O/V),qt(Xe,Vn(Xe,mt,R)),qt(v,nt(v,R,Fe(v,Xe,Math.tan(H)*O)))}const K=[];new Cn(p,v).closestPointOnSphere(A,z,K);const re=qt([],Qi(w,0)),ne=qt([],Qi(w,1)),ue=qt([],Qi(w,2)),he=wn(re,K),ge=wn(ne,K),ke=wn(ue,K),Ee=xr(Math.asin(-ge/z));let Pe=xr(Math.atan2(he,ke));Pe=c.center.lng+function(mt,Xe){const vt=(Xe-mt+180)%360-180;return vt<-180?vt+360:vt}(c.center.lng,Pe);const Be=I(Pe),$e=ee(M(Ee),0,1);return new pe(Be,$e)}class Gh{constructor(s,u,h){this.a=Vn([],s,h),this.b=Vn([],u,h),this.center=h;const p=qt([],this.a),_=qt([],this.b);this.angle=Math.acos(wn(p,_))}}function Gd(c,s){if(c.angle===0)return null;let u;return u=c.a[s]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[s]/c.a[s]/Math.sin(c.angle)-1/Math.tan(c.angle)),u<0||u>1?null:function(h,p,_,v){const w=Math.sin(_);return h*(Math.sin((1-v)*_)/w)+p*(Math.sin(v*_)/w)}(c.a[s],c.b[s],c.angle,ee(u,0,1))+c.center[s]}function Ac(c){if(c.z<=1)return Hd[c.z+2*c.y+c.x];const s=qI(IS(c));return Nn.fromPoints(s)}function qd(c,s,u){return Fe(c,c,1-u),jt(c,c,s,u)}function VN(c,s,u){for(const h of c)rn(h,h,s),Fe(h,h,u)}function $N(c,s,u,h){const p=s/c.worldSize,_=c.globeMatrix;if(u.z<=1){const $e=Ac(u).getCorners();return VN($e,_,p),Nn.fromPoints($e)}const v=IS(u,h),w=qI(v,sl+od(c._tileCoverLift));VN(w,_,p);const A=Number.MAX_VALUE,R=[-A,-A,-A],O=[A,A,A];if(v.contains(c.center)){for(const Xe of w)gn(O,O,Xe),wt(R,R,Xe);R[2]=0;const $e=c.point,mt=[$e.x*p,$e.y*p,0];return gn(O,O,mt),wt(R,R,mt),new Nn(O,R)}if(c._tileCoverLift>0){for(const $e of w)gn(O,O,$e),wt(R,R,$e);return new Nn(O,R)}const D=[_[12]*p,_[13]*p,_[14]*p],z=v.getCenter(),V=ee(c.center.lat,-Y,Y),H=ee(z.lat,-Y,Y),K=I(c.center.lng),re=M(V);let ne=K-I(z.lng);const ue=re-M(H);ne>.5?ne-=1:ne<-.5&&(ne+=1);let he=0;Math.abs(ne)>Math.abs(ue)?he=ne>=0?1:3:(he=ue>=0?0:2,jt(D,D,[_[4]*p,_[5]*p,_[6]*p],-Math.sin(cn(ue>=0?v.getSouth():v.getNorth()))*sl));const ge=w[he],ke=w[(he+1)%4],Ee=new Gh(ge,ke,D),Pe=[Gd(Ee,0)||ge[0],Gd(Ee,1)||ge[1],Gd(Ee,2)||ge[2]],Be=mm(c.zoom);if(Be>0){const $e=function({x:Xe,y:vt,z:kt},It,zt,Bt,Ot){const Lt=1/(1<<kt);let yt=Xe*Lt,gt=yt+Lt,Dt=vt*Lt,tn=Dt+Lt,$t=0;const Bn=(yt+gt)/2-Bt;return Bn>.5?$t=-1:Bn<-.5&&($t=1),yt=((yt+$t)*It-(Bt*=It))*zt+Bt,gt=((gt+$t)*It-Bt)*zt+Bt,Dt=(Dt*It-(Ot*=It))*zt+Ot,tn=(tn*It-Ot)*zt+Ot,[[yt,tn,0],[gt,tn,0],[gt,Dt,0],[yt,Dt,0]]}(u,s,c._pixelsPerMercatorPixel,K,re);for(let Xe=0;Xe<w.length;Xe++)qd(w[Xe],$e[Xe],Be);const mt=nt([],$e[he],$e[(he+1)%4]);Fe(mt,mt,.5),qd(Pe,mt,Be)}for(const $e of w)gn(O,O,$e),wt(R,R,$e);return O[2]=Math.min(ge[2],ke[2]),gn(O,O,Pe),wt(R,R,Pe),new Nn(O,R)}function IS({x:c,y:s,z:u},h=!1){const p=1/(1<<u),_=new d(j(c*p),s===(1<<u)-1&&h?-90:W((s+1)*p)),v=new d(j((c+1)*p),s===0&&h?90:W(s*p));return new g(_,v)}function qI(c,s=sl){const u=cn(c.getNorth()),h=cn(c.getSouth()),p=Math.cos(u),_=Math.cos(h),v=Math.sin(u),w=Math.sin(h),A=c.getWest(),R=c.getEast();return[Yf(_,w,A,s),Yf(_,w,R,s),Yf(p,v,R,s),Yf(p,v,A,s)]}function Jb(c,s,u,h){const p=1<<u.z,_=(c/Jt+u.x)/p;return hm(W((s/Jt+u.y)/p),j(_),h)}function RS({min:c,max:s}){return GI/Math.max(s[0]-c[0],s[1]-c[1],s[2]-c[2])}const HN=new Float64Array(16);function MS(c){const s=RS(c),u=ve(HN,[s,s,s]);return X(u,u,yn([],c.min))}function ZI(c){const s=(h=c.min,(u=HN)[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=h[0],u[13]=h[1],u[14]=h[2],u[15]=1,u);var u,h;const p=1/RS(c);return ie(s,s,[p,p,p])}function WI(c){const s=Jt/(2*Math.PI);return c/(2*Math.PI)/s}function GN(c,s){return Jt/(512*Math.pow(2,c))*RS(Ac(s))}function qN(c,s,u,h,p){const _=WI(u),v=[c,s,-u/(2*Math.PI)],w=q(new Float64Array(16));return X(w,w,v),ie(w,w,[_,_,_]),de(w,w,cn(-p)),fe(w,w,cn(-h)),w}function mm(c){return le(Zu,_1,c)}function ZN(c,s){const u=hm(s.lat,s.lng),h=function(H){const K=hm(H._center.lat,H._center.lng);let re=Sn([],Rt(0,1,0),K);const ne=Je([],-H.angle,K);re=rn(re,re,ne),Je(ne,-H._pitch,re);const ue=qt([],K);return Fe(ue,ue,od(H.cameraToCenterDistance/H.pixelsPerMeter)),rn(ue,ue,ne),nt([],K,ue)}(c);return v=(p=pt([],h,u))[0],w=p[1],A=p[2],R=(_=u)[0],O=_[1],D=_[2],V=(z=Math.sqrt((v*v+w*w+A*A)*(R*R+O*O+D*D)))&&wn(p,_)/z,Math.acos(Math.min(Math.max(V,-1),1));var p,_,v,w,A,R,O,D,z,V}function XI(c,s){return ZN(c,s)>Math.PI/2*1.01}const WN=cn(85),wie=Math.cos(WN),Tie=Math.sin(WN),Eie=F(),XN=c=>{const s=[];return c.paint.get("circle-pitch-alignment")==="map"&&s.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&s.push("SCALE_WITH_MAP"),s};function YN(c,s,u,h,p,_,v,w,A){if(_&&c.queryGeometry.isAboveHorizon)return!1;_&&(A*=c.pixelToTileUnitsFactor);const R=c.tileID.canonical,O=u.projection.upVectorScale(R,u.center.lat,u.worldSize).metersToTile;for(const D of s)for(const z of D){const V=z.add(w),H=p&&u.elevation?u.elevation.exaggeration()*p.getElevationAt(V.x,V.y,!0):0,K=u.projection.projectTilePoint(V.x,V.y,R);if(H>0){const he=u.projection.upVector(R,V.x,V.y);K.x+=he[0]*O*H,K.y+=he[1]*O*H,K.z+=he[2]*O*H}const re=_?V:Sie(K.x,K.y,K.z,h),ne=_?c.tilespaceRays.map(he=>Cie(he,H)):c.queryGeometry.screenGeometry,ue=$i([],[K.x,K.y,K.z,1],h);if(!v&&_?A*=ue[3]/u.cameraToCenterDistance:v&&!_&&(A*=u.cameraToCenterDistance/ue[3]),_){const he=W((z.y/Jt+R.y)/(1<<R.z));A/=u.projection.pixelsPerMeter(he,1)/N(1,he)}if(Hr(ne,re,A))return!0}return!1}function Sie(c,s,u,h){const p=$i([],[c,s,u,1],h);return new je(p[0]/p[3],p[1]/p[3])}const KN=Rt(0,0,0),Aie=Rt(0,0,1);function Cie(c,s){const u=ft();return KN[2]=s,c.intersectsPlane(KN,Aie,u),new je(u[0],u[1])}class QN extends ns{}let JN,ez,tz,nz;function rz(c,{width:s,height:u},h,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==s*u*h)throw new RangeError("mismatched image size")}else p=new Uint8Array(s*u*h);return c.width=s,c.height=u,c.data=p,c}function iz(c,s,u){const{width:h,height:p}=s;h===c.width&&p===c.height||(YI(c,s,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,h),height:Math.min(c.height,p)},u,null),c.width=h,c.height=p,c.data=s.data)}function YI(c,s,u,h,p,_,v,w){if(p.width===0||p.height===0)return s;if(p.width>c.width||p.height>c.height||u.x>c.width-p.width||u.y>c.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>s.width||p.height>s.height||h.x>s.width-p.width||h.y>s.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const A=c.data,R=s.data,O=_===4&&w;for(let D=0;D<p.height;D++){const z=((u.y+D)*c.width+u.x)*_,V=((h.y+D)*s.width+h.x)*_;if(O)for(let H=0;H<p.width;H++){const K=z+H*_+3,re=V+H*_;R[re+0]=255,R[re+1]=255,R[re+2]=255,R[re+3]=A[K]}else if(v)for(let H=0;H<p.width;H++){const K=z+H*_,re=V+H*_,ne=new ts(A[K+0]/255,A[K+1]/255,A[K+2]/255,A[K+3]).toNonPremultipliedRenderColor(v).toArray();R[re+0]=ne[0],R[re+1]=ne[1],R[re+2]=ne[2],R[re+3]=ne[3]}else for(let H=0;H<p.width*_;H++)R[V+H]=A[z+H]}return s}En(QN,"HeatmapBucket",{omit:["layers"]});class gm{constructor(s,u){rz(this,s,1,u)}resize(s){iz(this,new gm(s),1)}clone(){return new gm({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,u,h,p,_){YI(s,u,h,p,_,1,null)}}class ll{constructor(s,u){rz(this,s,4,u)}resize(s){iz(this,new ll(s),4)}replace(s,u){u?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new ll({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,u,h,p,_,v,w){YI(s,u,h,p,_,4,v,w)}}class sz{constructor(s,u){this.width=s.width,this.height=s.height,this.data=u instanceof Uint8Array?new Float32Array(u.buffer):u}}function ew(c){const s={},u=c.resolution||256,h=c.clips?c.clips.length:1,p=c.image||new ll({width:u,height:h}),_=(v,w,A)=>{s[c.evaluationKey]=A;const R=c.expression.evaluate(s),O=R?R.toNonPremultipliedRenderColor(null):null;O&&(p.data[v+w+0]=Math.floor(255*O.r),p.data[v+w+1]=Math.floor(255*O.g),p.data[v+w+2]=Math.floor(255*O.b),p.data[v+w+3]=Math.floor(255*O.a))};if(c.clips)for(let v=0,w=0;v<h;++v,w+=4*u)for(let A=0,R=0;A<u;A++,R+=4){const O=A/(u-1),{start:D,end:z}=c.clips[v];_(w,R,D*(1-O)+z*O)}else for(let v=0,w=0;v<u;v++,w+=4)_(0,w,v/(u-1));return p}En(gm,"AlphaImage"),En(ll,"RGBAImage");const kie=hi([{name:"a_pos",components:2,type:"Int16"}],4),Iie=hi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Rie=hi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Mie=hi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function y1(c,s,u=2){const h=s&&s.length,p=h?s[0]*u:c.length;let _=az(c,0,p,u,!0);const v=[];if(!_||_.next===_.prev)return v;let w,A,R;if(h&&(_=function(O,D,z,V){const H=[];for(let K=0,re=D.length;K<re;K++){const ne=az(O,D[K]*V,K<re-1?D[K+1]*V:O.length,V,!1);ne===ne.next&&(ne.steiner=!0),H.push(Bie(ne))}H.sort(Nie);for(let K=0;K<H.length;K++)z=zie(H[K],z);return z}(c,s,_,u)),c.length>80*u){w=c[0],A=c[1];let O=w,D=A;for(let z=u;z<p;z+=u){const V=c[z],H=c[z+1];V<w&&(w=V),H<A&&(A=H),V>O&&(O=V),H>D&&(D=H)}R=Math.max(O-w,D-A),R=R!==0?32767/R:0}return tw(_,v,u,w,A,R,0),v}function az(c,s,u,h,p){let _;if(p===function(v,w,A,R){let O=0;for(let D=w,z=A-R;D<A;D+=R)O+=(v[z]-v[D])*(v[D+1]+v[z+1]),z=D;return O}(c,s,u,h)>0)for(let v=s;v<u;v+=h)_=cz(v/h|0,c[v],c[v+1],_);else for(let v=u-h;v>=s;v-=h)_=cz(v/h|0,c[v],c[v+1],_);return _&&v1(_,_.next)&&(iw(_),_=_.next),_}function kg(c,s){if(!c)return c;s||(s=c);let u,h=c;do if(u=!1,h.steiner||!v1(h,h.next)&&Po(h.prev,h,h.next)!==0)h=h.next;else{if(iw(h),h=s=h.prev,h===h.next)break;u=!0}while(u||h!==s);return s}function tw(c,s,u,h,p,_,v){if(!c)return;!v&&_&&function(A,R,O,D){let z=A;do z.z===0&&(z.z=KI(z.x,z.y,R,O,D)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==A);z.prevZ.nextZ=null,z.prevZ=null,function(V){let H,K=1;do{let re,ne=V;V=null;let ue=null;for(H=0;ne;){H++;let he=ne,ge=0;for(let Ee=0;Ee<K&&(ge++,he=he.nextZ,he);Ee++);let ke=K;for(;ge>0||ke>0&&he;)ge!==0&&(ke===0||!he||ne.z<=he.z)?(re=ne,ne=ne.nextZ,ge--):(re=he,he=he.nextZ,ke--),ue?ue.nextZ=re:V=re,re.prevZ=ue,ue=re;ne=he}ue.nextZ=null,K*=2}while(H>1)}(z)}(c,h,p,_);let w=c;for(;c.prev!==c.next;){const A=c.prev,R=c.next;if(_?Oie(c,h,p,_):Pie(c))s.push(A.i,c.i,R.i),iw(c),c=R.next,w=R.next;else if((c=R)===w){v?v===1?tw(c=Lie(kg(c),s),s,u,h,p,_,2):v===2&&Die(c,s,u,h,p,_):tw(kg(c),s,u,h,p,_,1);break}}}function Pie(c){const s=c.prev,u=c,h=c.next;if(Po(s,u,h)>=0)return!1;const p=s.x,_=u.x,v=h.x,w=s.y,A=u.y,R=h.y,O=Math.min(p,_,v),D=Math.min(w,A,R),z=Math.max(p,_,v),V=Math.max(w,A,R);let H=h.next;for(;H!==s;){if(H.x>=O&&H.x<=z&&H.y>=D&&H.y<=V&&nw(p,w,_,A,v,R,H.x,H.y)&&Po(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function Oie(c,s,u,h){const p=c.prev,_=c,v=c.next;if(Po(p,_,v)>=0)return!1;const w=p.x,A=_.x,R=v.x,O=p.y,D=_.y,z=v.y,V=Math.min(w,A,R),H=Math.min(O,D,z),K=Math.max(w,A,R),re=Math.max(O,D,z),ne=KI(V,H,s,u,h),ue=KI(K,re,s,u,h);let he=c.prevZ,ge=c.nextZ;for(;he&&he.z>=ne&&ge&&ge.z<=ue;){if(he.x>=V&&he.x<=K&&he.y>=H&&he.y<=re&&he!==p&&he!==v&&nw(w,O,A,D,R,z,he.x,he.y)&&Po(he.prev,he,he.next)>=0||(he=he.prevZ,ge.x>=V&&ge.x<=K&&ge.y>=H&&ge.y<=re&&ge!==p&&ge!==v&&nw(w,O,A,D,R,z,ge.x,ge.y)&&Po(ge.prev,ge,ge.next)>=0))return!1;ge=ge.nextZ}for(;he&&he.z>=ne;){if(he.x>=V&&he.x<=K&&he.y>=H&&he.y<=re&&he!==p&&he!==v&&nw(w,O,A,D,R,z,he.x,he.y)&&Po(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;ge&&ge.z<=ue;){if(ge.x>=V&&ge.x<=K&&ge.y>=H&&ge.y<=re&&ge!==p&&ge!==v&&nw(w,O,A,D,R,z,ge.x,ge.y)&&Po(ge.prev,ge,ge.next)>=0)return!1;ge=ge.nextZ}return!0}function Lie(c,s){let u=c;do{const h=u.prev,p=u.next.next;!v1(h,p)&&lz(h,u,u.next,p)&&rw(h,p)&&rw(p,h)&&(s.push(h.i,u.i,p.i),iw(u),iw(u.next),u=c=p),u=u.next}while(u!==c);return kg(u)}function Die(c,s,u,h,p,_){let v=c;do{let w=v.next.next;for(;w!==v.prev;){if(v.i!==w.i&&jie(v,w)){let A=uz(v,w);return v=kg(v,v.next),A=kg(A,A.next),tw(v,s,u,h,p,_,0),void tw(A,s,u,h,p,_,0)}w=w.next}v=v.next}while(v!==c)}function Nie(c,s){let u=c.x-s.x;return u===0&&(u=c.y-s.y,u===0)&&(u=(c.next.y-c.y)/(c.next.x-c.x)-(s.next.y-s.y)/(s.next.x-s.x)),u}function zie(c,s){const u=function(p,_){let v=_;const w=p.x,A=p.y;let R,O=-1/0;if(v1(p,v))return v;do{if(v1(p,v.next))return v.next;if(A<=v.y&&A>=v.next.y&&v.next.y!==v.y){const K=v.x+(A-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(K<=w&&K>O&&(O=K,R=v.x<v.next.x?v:v.next,K===w))return R}v=v.next}while(v!==_);if(!R)return null;const D=R,z=R.x,V=R.y;let H=1/0;v=R;do{if(w>=v.x&&v.x>=z&&w!==v.x&&oz(A<V?w:O,A,z,V,A<V?O:w,A,v.x,v.y)){const K=Math.abs(A-v.y)/(w-v.x);rw(v,p)&&(K<H||K===H&&(v.x>R.x||v.x===R.x&&Fie(R,v)))&&(R=v,H=K)}v=v.next}while(v!==D);return R}(c,s);if(!u)return s;const h=uz(u,c);return kg(h,h.next),kg(u,u.next)}function Fie(c,s){return Po(c.prev,c,s.prev)<0&&Po(s.next,c,c.next)<0}function KI(c,s,u,h,p){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-u)*p|0)|c<<8))|c<<4))|c<<2))|c<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-h)*p|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function Bie(c){let s=c,u=c;do(s.x<u.x||s.x===u.x&&s.y<u.y)&&(u=s),s=s.next;while(s!==c);return u}function oz(c,s,u,h,p,_,v,w){return(p-v)*(s-w)>=(c-v)*(_-w)&&(c-v)*(h-w)>=(u-v)*(s-w)&&(u-v)*(_-w)>=(p-v)*(h-w)}function nw(c,s,u,h,p,_,v,w){return!(c===v&&s===w)&&oz(c,s,u,h,p,_,v,w)}function jie(c,s){return c.next.i!==s.i&&c.prev.i!==s.i&&!function(u,h){let p=u;do{if(p.i!==u.i&&p.next.i!==u.i&&p.i!==h.i&&p.next.i!==h.i&&lz(p,p.next,u,h))return!0;p=p.next}while(p!==u);return!1}(c,s)&&(rw(c,s)&&rw(s,c)&&function(u,h){let p=u,_=!1;const v=(u.x+h.x)/2,w=(u.y+h.y)/2;do p.y>w!=p.next.y>w&&p.next.y!==p.y&&v<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(_=!_),p=p.next;while(p!==u);return _}(c,s)&&(Po(c.prev,c,s.prev)||Po(c,s.prev,s))||v1(c,s)&&Po(c.prev,c,c.next)>0&&Po(s.prev,s,s.next)>0)}function Po(c,s,u){return(s.y-c.y)*(u.x-s.x)-(s.x-c.x)*(u.y-s.y)}function v1(c,s){return c.x===s.x&&c.y===s.y}function lz(c,s,u,h){const p=OS(Po(c,s,u)),_=OS(Po(c,s,h)),v=OS(Po(u,h,c)),w=OS(Po(u,h,s));return p!==_&&v!==w||!(p!==0||!PS(c,u,s))||!(_!==0||!PS(c,h,s))||!(v!==0||!PS(u,c,h))||!(w!==0||!PS(u,s,h))}function PS(c,s,u){return s.x<=Math.max(c.x,u.x)&&s.x>=Math.min(c.x,u.x)&&s.y<=Math.max(c.y,u.y)&&s.y>=Math.min(c.y,u.y)}function OS(c){return c>0?1:c<0?-1:0}function rw(c,s){return Po(c.prev,c,c.next)<0?Po(c,s,c.next)>=0&&Po(c,c.prev,s)>=0:Po(c,s,c.prev)<0||Po(c,c.next,s)<0}function uz(c,s){const u=QI(c.i,c.x,c.y),h=QI(s.i,s.x,s.y),p=c.next,_=s.prev;return c.next=s,s.prev=c,u.next=p,p.prev=u,h.next=u,u.prev=h,_.next=h,h.prev=_,h}function cz(c,s,u,h){const p=QI(c,s,u);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function iw(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function QI(c,s,u){return{i:c,x:s,y:u,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function sw(c,s){const u=c.length;if(u<=1)return[c];const h=[];let p,_;for(let v=0;v<u;v++){const w=lr(c[v]);w!==0&&(c[v].area=Math.abs(w),_===void 0&&(_=w<0),_===w<0?(p&&h.push(p),p=[c[v]]):p.push(c[v]))}if(p&&h.push(p),s>1)for(let v=0;v<h.length;v++)h[v].length<=s||(gy(h[v],s,1,h[v].length-1,Uie),h[v]=h[v].slice(0,s));return h}function Uie(c,s){return s.area-c.area}function dz(c,s,u=1){if(!c)return null;const h=typeof c=="string"?Sl.from(c).getPrimary():c.getPrimary(),p=typeof c=="string"?null:c.getSecondary();for(const _ of[h,p]){if(!_)continue;const v=_.id.toString();s.has(v)||s.set(v,[]),_.scaleSelf(u),s.get(v).push(_)}return{primary:h.toString(),secondary:p?p.toString():null}}function JI(c,s,u,h){const p=h.patternDependencies;let _=!1;for(const v of s){const w=v.paint.get(`${c}-pattern`);w.isConstant()||(_=!0),dz(w.constantOr(null),p,u)&&(_=!0)}return _}function e6(c,s,u,h,p,_){const v=_.patternDependencies;for(const w of s){const A=w.paint.get(`${c}-pattern`).value;if(A.kind!=="constant"){let R=A.evaluate({zoom:h},u,{},_.availableImages);R=R&&R.name?R.name:R;const O=dz(R,v,p);if(!O)continue;const{primary:D,secondary:z}=O;D&&(u.patterns[w.id]=[D,z].filter(Boolean))}}return u}class hz{constructor(){this.polygons=new Map}add(s,...u){const h=this.polygons.get(s);h?h.push(...u):this.polygons.set(s,u)}merge(s){for(const[u,h]of s.polygons)this.add(u,...h)}}class Kf{constructor(){this.portals=[]}static isOnBorder(s,u){return s<=0&&u<=0||s>=Jt&&u>=Jt}static evaluate(s){if(s.length===0)return new Kf;let u=[];for(const A of s)u.push(...A.portals);if(u.length===0)return new Kf;for(const A of u){const R=A.va,O=A.vb;(Kf.isOnBorder(R.x,O.x)||Kf.isOnBorder(R.y,O.y))&&(A.type="border")}const h=u.filter(A=>A.type!=="unevaluated"),p=u.filter(A=>A.type==="unevaluated");if(p.length===0)return new Kf;p.sort((A,R)=>A.hash===R.hash?A.isTunnel===R.isTunnel?0:A.isTunnel?-1:1:A.hash<R.hash?1:-1),u=h.concat(p);let _=h.length,v=_,w=_;do if(v++,v===u.length||u[_].hash!==u[v].hash){if(v-_==2){w<_&&(u[w]=u[_],u[_]=null);const A=u[w],R=u[v-1];A.type=A.isTunnel!==R.isTunnel?"tunnel":"polygon",A.connection={a:A.connection.a,b:R.connection.a},w++}_=v}while(_!==u.length);return u.splice(w),u.sort((A,R)=>A.hash<R.hash?1:-1),{portals:u}}}En(Kf,"ElevationPortalGraph"),En(hz,"ElevationPolygons");class Vie{constructor(s,u,h){this.outPositions=s,this.outNormals=u,this.outIndices=h,this.vertexLookup=new Map}addVertex(s,u,h){let p=s[2];h!=null&&(p*=h);const _=`${s[0]},${s[1]},${s[2]},${u[0]},${u[1]},${u[2]}`,v=this.vertexLookup.get(_);if(v!=null)return v;const w=this.outPositions.length;this.vertexLookup.set(_,w);const A=Math.trunc(16384*u[0]),R=Math.trunc(16384*u[1]),O=Math.trunc(16384*u[2]);return this.outPositions.emplaceBack(s[0],s[1],p),this.outNormals.emplaceBack(A,R,O),w}addTriangle(s,u,h){this.outIndices.emplaceBack(s,u,h)}addTriangles(s,u,h){if(s.length===0)return;const p=h.length===1,_=ft(),v=ft();for(let w=0;w<s.length;w+=3){const A=u[s[w+0]],R=u[s[w+1]],O=u[s[w+2]],D=p?h[0]:h[s[w+1]],z=p?h[0]:h[s[w+2]];en(_,A.x,A.y,p?h[0]:h[s[w+0]]);const V=this.addVertex(_,v);en(_,R.x,R.y,D);const H=this.addVertex(_,v);en(_,O.x,O.y,z);const K=this.addVertex(_,v);this.outIndices.emplaceBack(V,H,K)}}addQuad(s,u,h,p,_,v){const w=this.addVertex(s,_,v),A=this.addVertex(u,_,v),R=this.addVertex(h,_,v),O=this.addVertex(p,_,v);this.addTriangle(w,A,R),this.addTriangle(R,O,w)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class wu{constructor(s,u,h,p){this.unevaluatedPortals=new Kf,this.portalPolygons=new hz,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Ob,this.vertexNormals=new Lb,this.indexArray=new to,this.tileToMeters=ae(s),this.bridgeProgramConfigurations=new Ec(u,{zoom:h,lut:p},_=>_!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Ec(u,{zoom:h,lut:p},_=>_!=="fill-bridge-guard-rail-color")}addVertices(s,u){const h=this.unevalVertices.length;for(let p=0;p<s.length;p++)this.unevalVertices.push(s[p]),this.unevalHeights.push(u[p]);return h}addTriangles(s,u,h){const p=h?this.unevalTunnelTriangles:this.unevalTriangles;for(const _ of s)p.push(_+u)}addRenderableRing(s,u,h,p,_,v){const w=[new je(_.min.x,_.min.y),new je(_.max.x,_.min.y),new je(_.max.x,_.max.y),new je(_.min.x,_.max.y)];for(let A=0;A<h-1;A++){const R=u+A,O=R+1,D=this.unevalVertices[R],z=this.unevalVertices[O];if(!(D.x>=_.min.x&&D.x<=_.max.x&&D.y>=_.min.y&&D.y<=_.max.y||z.x>=_.min.x&&z.x<=_.max.x&&z.y>=_.min.y&&z.y<=_.max.y||Xo(D,z,w))||this.isOnBorder(D.x,z.x)||this.isOnBorder(D.y,z.y))continue;const V=wu.computeEdgeHash(this.unevalVertices[R],this.unevalVertices[O]);let H,K=this.vertexHashLookup.get(wu.computePosHash(D));K!=null?H=K.next:(K=this.vertexHashLookup.get(wu.computePosHash(z)),H=K!=null?K.prev:V),this.unevalEdges.push({polygonIdx:s,a:R,b:O,hash:V,portalHash:H,isTunnel:p,type:"unevaluated",featureInfo:v})}}addPortalCandidates(s,u,h,p,_){if(u.length===0)return;this.portalPolygons.add(s,{geometry:u,zLevel:_});const v=u[0];this.vertexHashLookup.clear();let w=wu.computeEdgeHash(v[v.length-2],v[v.length-1]);for(let A=0;A<v.length-1;A++){const R=v[A+0],O=v[A+1],D=Zi(O.x-R.x,O.y-R.y),z=sn(D);if(z===0)continue;let V="unevaluated";const H=p.pointElevation(R),K=p.pointElevation(O);Math.abs(H)<.01&&Math.abs(K)<.01?V="entrance":(this.isOnBorder(R.x,O.x)||this.isOnBorder(R.y,O.y))&&(V="border");const re=wu.computeEdgeHash(R,O);this.unevaluatedPortals.portals.push({connection:{a:s,b:void 0},va:R,vb:O,vab:D,length:z,hash:re,isTunnel:h,type:V});const ne=wu.computePosHash(R);this.vertexHashLookup.set(ne,{prev:w,next:re}),w=re}}construct(s){if(this.unevalVertices.length===0)return;const u=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),h=z=>{z.primitiveLength=this.indexArray.length-z.primitiveOffset},p=new Vie(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(s.portals,this.unevalEdges);const _=u(),v=u(),w=u(),A=(z,V)=>{z.sort((K,re)=>K.type===V&&re.type!==V?-1:K.type!==V&&re.type===V?1:0);const H=z.findIndex(K=>K.type!==V);return H>=0?H:z.length};let R=0;this.unevalEdges.length>0&&(R=A(this.unevalEdges,"none"),this.constructBridgeStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:R},this.tileToMeters)),h(w);const O=u(),D=u();if(this.unevalEdges.length>0){const z=this.unevalEdges.splice(R),V=A(z,"tunnel")+R;this.unevalEdges.push(...z),this.constructTunnelStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:R},{min:R,max:V})}h(O),p.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),h(D),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),h(v),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),h(_),this.maskSegments=da.simpleSegment(0,D.primitiveOffset,0,D.primitiveLength),this.depthSegments=da.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableBridgeSegments=da.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.renderableTunnelSegments=da.simpleSegment(0,O.primitiveOffset,0,O.primitiveLength),this.shadowCasterSegments=da.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength)}update(s,u,h,p,_,v,w,A){this.bridgeProgramConfigurations.updatePaintArrays(s,u,_,h,p,v,w,A),this.tunnelProgramConfigurations.updatePaintArrays(s,u,_,h,p,v,w,A)}upload(s){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=s.createVertexBuffer(this.vertexPositions,Rie.members),this.vertexBufferNormal=s.createVertexBuffer(this.vertexNormals,Mie.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(s),this.tunnelProgramConfigurations.upload(s))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(s,u,h,p,_){const v=(w,A)=>{for(let R=0;R<A.length-1;R++){const O=A[R].featureIndex,D=A[R+1].vertexStart,z=s.feature(O);w.populatePaintArrays(D,z,O,{},h,u,p,void 0,_)}};v(this.bridgeProgramConfigurations,this.bridgeFeatureSections),v(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(s,u,h,p,_){const v=new Map;for(let w=p;w<_;w++){const A=h[w],R=A.a,O=A.b,D=wu.computePosHash(s[R]),z=wu.computePosHash(s[O]);let V=v.get(D);V||(V={},v.set(D,V));let H=v.get(z);H||(H={},v.set(z,H)),u[R]<=0&&u[O]<=0||(V.to=O,H.from=R)}return v}isTerminalVertex(s,u){const h=wu.computePosHash(this.unevalVertices[s]),p=u.get(h);return!p||!p.from||!p.to}constructBridgeStructures(s,u,h,p,_,v){s.clearVertexLookup();const w=this.computeVertexConnections(u,h,p,_.min,_.max),A=1/v,R=.5*A,O=(zt,Bt)=>en(zt,u[Bt].x,u[Bt].y,h[Bt]*A),D=ft(),z=ft(),V=ft(),H=ft(),K=ft(),re=(zt,Bt)=>{const Ot=w.get(wu.computePosHash(u[Bt])),Lt=Ot.from,yt=Ot.to;if(!Lt||!yt)return;O(D,Lt),O(z,Bt),O(V,yt),sr(H),ar(D,z)||(Vn(K,z,D),qt(H,K)),ar(V,z)||(Vn(K,V,z),nt(H,H,qt(K,K)));const gt=ys(H);return gt>0?Fe(zt,H,1/gt):void 0};let ne=Number.POSITIVE_INFINITY;this.sortSubarray(p,_.min,_.max,(zt,Bt)=>zt.featureInfo.featureIndex-Bt.featureInfo.featureIndex);const ue=ft(),he=ft(),ge=ft(),ke=ft(),Ee=ft(),Pe=ft(),Be=ft(),$e=ft(),mt=ft(),Xe=[ft(),ft(),ft(),ft()],vt=[ft(),ft(),ft(),ft()],kt=[{coord:new je(0,0),height:0},{coord:new je(0,0),height:0}],It=(zt,Bt)=>zt>Bt;for(let zt=_.min;zt<_.max;zt++){const Bt=p[zt];if(!Bt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(kt,u,h,Bt,It))continue;const[Ot,Lt]=kt;if(en(ue,Ot.coord.x,Ot.coord.y,A*Ot.height),en(he,Lt.coord.x,Lt.coord.y,A*Lt.height),ar(ue,he))continue;Vn(ge,he,ue),qt(ge,ge);const yt=re($e,Bt.a)||ge,gt=re(mt,Bt.b)||ge;en(ke,yt[1],-yt[0],0),qt(ke,ke),en(Ee,gt[1],-gt[0],0),qt(Ee,Ee),Sn($e,ke,yt),qt(Pe,$e),Sn($e,Ee,gt),qt(Be,$e),nt(Xe[0],ue,Fe($e,Vn($e,ke,Pe),R)),nt(Xe[1],ue,Fe($e,nt($e,ke,Pe),R)),nt(Xe[2],ue,Fe($e,Pe,R)),Xe[3]=ue,nt(vt[0],he,Fe($e,Vn($e,Ee,Be),R)),nt(vt[1],he,Fe($e,nt($e,Ee,Be),R)),nt(vt[2],he,Fe($e,Be,R)),vt[3]=he,ne=this.addFeatureSection(Bt.featureInfo.featureIndex,ne,this.bridgeFeatureSections,s);const Dt=s.addVertex(Xe[0],ke,v),tn=s.addVertex(Xe[1],ke,v),$t=s.addVertex(vt[0],Ee,v),Bn=s.addVertex(vt[1],Ee,v);s.addTriangle(Dt,tn,$t),s.addTriangle(tn,Bn,$t);const pn=s.addVertex(Xe[1],Pe,v),xn=s.addVertex(Xe[2],Pe,v),Rn=s.addVertex(vt[1],Be,v),Jr=s.addVertex(vt[2],Be,v);s.addTriangle(pn,xn,Rn),s.addTriangle(xn,Jr,Rn),yn(ke,ke),yn(Ee,Ee);const Zt=s.addVertex(Xe[2],ke,v),Pn=s.addVertex(Xe[3],ke,v),Or=s.addVertex(vt[2],Ee,v),gi=s.addVertex(vt[3],Ee,v);s.addTriangle(Zt,Pn,Or),s.addTriangle(Pn,gi,Or);const Ei=this.isTerminalVertex(Bt.a,w),jr=this.isTerminalVertex(Bt.b,w);Ot.height<.01&&Ei&&s.addQuad(Xe[3],Xe[2],Xe[1],Xe[0],yn(yt,yt),v),Lt.height<.01&&jr&&s.addQuad(vt[0],vt[1],vt[2],vt[3],gt,v)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:s.getVertexCount()})}constructTunnelStructures(s,u,h,p,_,v){s.clearVertexLookup();let w=Number.POSITIVE_INFINITY;const A=(ne,ue)=>ne.featureInfo.featureIndex-ue.featureInfo.featureIndex;this.sortSubarray(p,_.min,_.max,A),this.sortSubarray(p,v.min,v.max,A);const R=ne=>qt(ne,ne),O=[{coord:new je(0,0),height:0},{coord:new je(0,0),height:0}],D=(ne,ue)=>ne<ue,z=ft(),V=ft(),H=ft(),K=ft(),re=ft();for(let ne=_.min;ne<_.max;ne++){if(!this.prepareEdgePoints(O,u,h,p[ne],D))continue;const[ue,he]=O,ge=R(en(re,-(he.coord.y-ue.coord.y),he.coord.x-ue.coord.x,0));w=this.addFeatureSection(p[ne].featureInfo.featureIndex,w,this.tunnelFeatureSections,s),s.addQuad(en(z,ue.coord.x,ue.coord.y,ue.height),en(V,he.coord.x,he.coord.y,he.height),en(H,he.coord.x,he.coord.y,p[ne].isTunnel?-.1:0),en(K,ue.coord.x,ue.coord.y,p[ne].isTunnel?-.1:0),ge)}for(let ne=v.min;ne<v.max;ne++){const ue=p[ne];ue.isTunnel&&([ue.a,ue.b]=[ue.b,ue.a]);const he=u[ue.a],ge=u[ue.b],ke=R(en(re,-(ge.y-he.y),ge.x-he.x,0));w=this.addFeatureSection(ue.featureInfo.featureIndex,w,this.tunnelFeatureSections,s),s.addQuad(en(z,ge.x,ge.y,0),en(V,he.x,he.y,0),en(H,he.x,he.y,h[ue.a]+4),en(K,ge.x,ge.y,h[ue.b]+4),ke),s.addQuad(en(z,he.x,he.y,0),en(V,ge.x,ge.y,0),en(H,ge.x,ge.y,h[ue.b]+4),en(K,he.x,he.y,h[ue.a]+4),ke)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:s.getVertexCount()})}setElevatedPoint(s,u,h,p){s.coord.x=u,s.coord.y=h,s.height=p}prepareEdgePoints(s,u,h,p,_){let v=u[p.a].x,w=u[p.a].y,A=u[p.b].x,R=u[p.b].y,O=h[p.a],D=h[p.b];const z=_(O,0),V=_(D,0);if(z&&V)return this.setElevatedPoint(s[0],v,w,O),this.setElevatedPoint(s[1],A,R,D),!0;if(!z&&!V)return!1;if(z){if(!V){const H=D/(D-O);A=Tr(A,v,H),R=Tr(R,w,H),D=Tr(D,O,H)}}else{const H=O/(O-D);v=Tr(v,A,H),w=Tr(w,R,H),O=Tr(O,D,H)}return this.setElevatedPoint(s[0],v,w,O),this.setElevatedPoint(s[1],A,R,D),!0}prepareEdges(s,u){if(u.length===0)return;u.sort((w,A)=>w.hash===A.hash?A.polygonIdx-w.polygonIdx:A.hash>w.hash?1:-1);let h=0,p=0,_=0,v=u[h].polygonIdx;do p++,(p===u.length||u[h].hash!==u[p].hash)&&((p-h==1||u[p-1].polygonIdx!==v)&&(_<h&&(u[_]=u[h],u[h]=null),u[_].type="none",_++),h=p,h!==u.length&&(v=u[h].polygonIdx));while(h!==u.length);if(u.splice(_),u.length!==0&&s.length!==0){u.sort((R,O)=>R.portalHash<O.portalHash?1:-1);let w=0,A=0;for(;w!==u.length&&A!==s.length;){const R=u[w],O=s[A];R.portalHash>O.hash?w++:O.hash>R.portalHash?A++:(R.type=O.type,w++)}}}isOnBorder(s,u){return s<=0&&u<=0||s>=Jt&&u>=Jt}addFeatureSection(s,u,h,p){return s!==u&&(u=s,h.push({featureIndex:s,vertexStart:p.getVertexCount()}),p.clearVertexLookup()),u}sortSubarray(s,u,h,p){const _=s.slice(u,h);_.sort(p),s.splice(u,_.length,..._)}static computeEdgeHash(s,u){return(s.y===u.y&&s.x>u.x||s.y>u.y)&&([s,u]=[u,s]),BigInt(wu.computePosHash(s))<<32n|BigInt(wu.computePosHash(u))}static computePosHash(s){return((65535&s.x)<<16|65535&s.y)>>>0}}var fz,pz={exports:{}},mz=(fz||(fz=1,function(c){function s(Se,Ie){return Se>Ie?1:Se<Ie?-1:0}var u=function(Se,Ie){Se===void 0&&(Se=s),Ie===void 0&&(Ie=!1),this._compare=Se,this._root=null,this._size=0,this._noDuplicates=!!Ie},h={size:{configurable:!0}};function p(Se,Ie,bt,Ft,ln){var un=ln-Ft;if(un>0){var Un=Ft+Math.floor(un/2),Yn={key:Ie[Un],data:bt[Un],parent:Se};return Yn.left=p(Yn,Ie,bt,Ft,Un),Yn.right=p(Yn,Ie,bt,Un+1,ln),Yn}return null}function _(Se,Ie,bt,Ft,ln){if(!(bt>=Ft)){for(var un=Se[bt+Ft>>1],Un=bt-1,Yn=Ft+1;;){do Un++;while(ln(Se[Un],un)<0);do Yn--;while(ln(Se[Yn],un)>0);if(Un>=Yn)break;var zr=Se[Un];Se[Un]=Se[Yn],Se[Yn]=zr,zr=Ie[Un],Ie[Un]=Ie[Yn],Ie[Yn]=zr}_(Se,Ie,bt,Yn,ln),_(Se,Ie,Yn+1,Ft,ln)}}u.prototype.rotateLeft=function(Se){var Ie=Se.right;Ie&&(Se.right=Ie.left,Ie.left&&(Ie.left.parent=Se),Ie.parent=Se.parent),Se.parent?Se===Se.parent.left?Se.parent.left=Ie:Se.parent.right=Ie:this._root=Ie,Ie&&(Ie.left=Se),Se.parent=Ie},u.prototype.rotateRight=function(Se){var Ie=Se.left;Ie&&(Se.left=Ie.right,Ie.right&&(Ie.right.parent=Se),Ie.parent=Se.parent),Se.parent?Se===Se.parent.left?Se.parent.left=Ie:Se.parent.right=Ie:this._root=Ie,Ie&&(Ie.right=Se),Se.parent=Ie},u.prototype._splay=function(Se){for(;Se.parent;){var Ie=Se.parent;Ie.parent?Ie.left===Se&&Ie.parent.left===Ie?(this.rotateRight(Ie.parent),this.rotateRight(Ie)):Ie.right===Se&&Ie.parent.right===Ie?(this.rotateLeft(Ie.parent),this.rotateLeft(Ie)):Ie.left===Se&&Ie.parent.right===Ie?(this.rotateRight(Ie),this.rotateLeft(Ie)):(this.rotateLeft(Ie),this.rotateRight(Ie)):Ie.left===Se?this.rotateRight(Ie):this.rotateLeft(Ie)}},u.prototype.splay=function(Se){for(var Ie,bt,Ft,ln,un;Se.parent;)(bt=(Ie=Se.parent).parent)&&bt.parent?((Ft=bt.parent).left===bt?Ft.left=Se:Ft.right=Se,Se.parent=Ft):(Se.parent=null,this._root=Se),ln=Se.left,un=Se.right,Se===Ie.left?(bt&&(bt.left===Ie?(Ie.right?(bt.left=Ie.right,bt.left.parent=bt):bt.left=null,Ie.right=bt,bt.parent=Ie):(ln?(bt.right=ln,ln.parent=bt):bt.right=null,Se.left=bt,bt.parent=Se)),un?(Ie.left=un,un.parent=Ie):Ie.left=null,Se.right=Ie,Ie.parent=Se):(bt&&(bt.right===Ie?(Ie.left?(bt.right=Ie.left,bt.right.parent=bt):bt.right=null,Ie.left=bt,bt.parent=Ie):(un?(bt.left=un,un.parent=bt):bt.left=null,Se.right=bt,bt.parent=Se)),ln?(Ie.right=ln,ln.parent=Ie):Ie.right=null,Se.left=Ie,Ie.parent=Se)},u.prototype.replace=function(Se,Ie){Se.parent?Se===Se.parent.left?Se.parent.left=Ie:Se.parent.right=Ie:this._root=Ie,Ie&&(Ie.parent=Se.parent)},u.prototype.minNode=function(Se){if(Se===void 0&&(Se=this._root),Se)for(;Se.left;)Se=Se.left;return Se},u.prototype.maxNode=function(Se){if(Se===void 0&&(Se=this._root),Se)for(;Se.right;)Se=Se.right;return Se},u.prototype.insert=function(Se,Ie){var bt=this._root,Ft=null,ln=this._compare;if(this._noDuplicates)for(;bt;){if(Ft=bt,ln(bt.key,Se)===0)return;bt=ln(bt.key,Se)<0?bt.right:bt.left}else for(;bt;)Ft=bt,bt=ln(bt.key,Se)<0?bt.right:bt.left;return bt={key:Se,data:Ie,left:null,right:null,parent:Ft},Ft?ln(Ft.key,bt.key)<0?Ft.right=bt:Ft.left=bt:this._root=bt,this.splay(bt),this._size++,bt},u.prototype.find=function(Se){for(var Ie=this._root,bt=this._compare;Ie;){var Ft=bt(Ie.key,Se);if(Ft<0)Ie=Ie.right;else{if(!(Ft>0))return Ie;Ie=Ie.left}}return null},u.prototype.contains=function(Se){for(var Ie=this._root,bt=this._compare;Ie;){var Ft=bt(Se,Ie.key);if(Ft===0)return!0;Ie=Ft<0?Ie.left:Ie.right}return!1},u.prototype.remove=function(Se){var Ie=this.find(Se);if(!Ie)return!1;if(this.splay(Ie),Ie.left)if(Ie.right){var bt=this.minNode(Ie.right);bt.parent!==Ie&&(this.replace(bt,bt.right),bt.right=Ie.right,bt.right.parent=bt),this.replace(Ie,bt),bt.left=Ie.left,bt.left.parent=bt}else this.replace(Ie,Ie.left);else this.replace(Ie,Ie.right);return this._size--,!0},u.prototype.removeNode=function(Se){if(!Se)return!1;if(this.splay(Se),Se.left)if(Se.right){var Ie=this.minNode(Se.right);Ie.parent!==Se&&(this.replace(Ie,Ie.right),Ie.right=Se.right,Ie.right.parent=Ie),this.replace(Se,Ie),Ie.left=Se.left,Ie.left.parent=Ie}else this.replace(Se,Se.left);else this.replace(Se,Se.right);return this._size--,!0},u.prototype.erase=function(Se){var Ie=this.find(Se);if(Ie){this.splay(Ie);var bt=Ie.left,Ft=Ie.right,ln=null;bt&&(bt.parent=null,ln=this.maxNode(bt),this.splay(ln),this._root=ln),Ft&&(bt?ln.right=Ft:this._root=Ft,Ft.parent=ln),this._size--}},u.prototype.pop=function(){var Se=this._root,Ie=null;if(Se){for(;Se.left;)Se=Se.left;Ie={key:Se.key,data:Se.data},this.remove(Se.key)}return Ie},u.prototype.next=function(Se){var Ie=Se;if(Ie)if(Ie.right)for(Ie=Ie.right;Ie&&Ie.left;)Ie=Ie.left;else for(Ie=Se.parent;Ie&&Ie.right===Se;)Se=Ie,Ie=Ie.parent;return Ie},u.prototype.prev=function(Se){var Ie=Se;if(Ie)if(Ie.left)for(Ie=Ie.left;Ie&&Ie.right;)Ie=Ie.right;else for(Ie=Se.parent;Ie&&Ie.left===Se;)Se=Ie,Ie=Ie.parent;return Ie},u.prototype.forEach=function(Se){for(var Ie=this._root,bt=[],Ft=!1,ln=0;!Ft;)Ie?(bt.push(Ie),Ie=Ie.left):bt.length>0?(Se(Ie=bt.pop(),ln++),Ie=Ie.right):Ft=!0;return this},u.prototype.range=function(Se,Ie,bt,Ft){for(var ln=[],un=this._compare,Un=this._root;ln.length!==0||Un;)if(Un)ln.push(Un),Un=Un.left;else{if(un((Un=ln.pop()).key,Ie)>0)break;if(un(Un.key,Se)>=0&&bt.call(Ft,Un))return this;Un=Un.right}return this},u.prototype.keys=function(){for(var Se=this._root,Ie=[],bt=[],Ft=!1;!Ft;)Se?(Ie.push(Se),Se=Se.left):Ie.length>0?(Se=Ie.pop(),bt.push(Se.key),Se=Se.right):Ft=!0;return bt},u.prototype.values=function(){for(var Se=this._root,Ie=[],bt=[],Ft=!1;!Ft;)Se?(Ie.push(Se),Se=Se.left):Ie.length>0?(Se=Ie.pop(),bt.push(Se.data),Se=Se.right):Ft=!0;return bt},u.prototype.at=function(Se){for(var Ie=this._root,bt=[],Ft=!1,ln=0;!Ft;)if(Ie)bt.push(Ie),Ie=Ie.left;else if(bt.length>0){if(Ie=bt.pop(),ln===Se)return Ie;ln++,Ie=Ie.right}else Ft=!0;return null},u.prototype.load=function(Se,Ie,bt){if(Se===void 0&&(Se=[]),Ie===void 0&&(Ie=[]),bt===void 0&&(bt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Ft=Se.length;return bt&&_(Se,Ie,0,Ft-1,this._compare),this._root=p(null,Se,Ie,0,Ft),this._size=Ft,this},u.prototype.min=function(){var Se=this.minNode(this._root);return Se?Se.key:null},u.prototype.max=function(){var Se=this.maxNode(this._root);return Se?Se.key:null},u.prototype.isEmpty=function(){return this._root===null},h.size.get=function(){return this._size},u.createTree=function(Se,Ie,bt,Ft,ln){return new u(bt,ln).load(Se,Ie,Ft)},Object.defineProperties(u.prototype,h);var v=0,w=1,A=2,R=3,O=0,D=1,z=2,V=3;function H(Se,Ie,bt){Ie===null?(Se.inOut=!1,Se.otherInOut=!0):(Se.isSubject===Ie.isSubject?(Se.inOut=!Ie.inOut,Se.otherInOut=Ie.otherInOut):(Se.inOut=!Ie.otherInOut,Se.otherInOut=Ie.isVertical()?!Ie.inOut:Ie.inOut),Ie&&(Se.prevInResult=!K(Ie,bt)||Ie.isVertical()?Ie.prevInResult:Ie));var Ft=K(Se,bt);Se.resultTransition=Ft?function(ln,un){var Un,Yn=!ln.inOut,zr=!ln.otherInOut;switch(un){case O:Un=Yn&&zr;break;case D:Un=Yn||zr;break;case V:Un=Yn^zr;break;case z:Un=ln.isSubject?Yn&&!zr:zr&&!Yn}return Un?1:-1}(Se,bt):0}function K(Se,Ie){switch(Se.type){case v:switch(Ie){case O:return!Se.otherInOut;case D:return Se.otherInOut;case z:return Se.isSubject&&Se.otherInOut||!Se.isSubject&&!Se.otherInOut;case V:return!0}break;case A:return Ie===O||Ie===D;case R:return Ie===z;case w:return!1}return!1}var re=function(Se,Ie,bt,Ft,ln){this.left=Ie,this.point=Se,this.otherEvent=bt,this.isSubject=Ft,this.type=ln||v,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ne={inResult:{configurable:!0}};function ue(Se,Ie){return Se[0]===Ie[0]&&Se[1]===Ie[1]}re.prototype.isBelow=function(Se){var Ie=this.point,bt=this.otherEvent.point;return this.left?(Ie[0]-Se[0])*(bt[1]-Se[1])-(bt[0]-Se[0])*(Ie[1]-Se[1])>0:(bt[0]-Se[0])*(Ie[1]-Se[1])-(Ie[0]-Se[0])*(bt[1]-Se[1])>0},re.prototype.isAbove=function(Se){return!this.isBelow(Se)},re.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ne.inResult.get=function(){return this.resultTransition!==0},re.prototype.clone=function(){var Se=new re(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Se.contourId=this.contourId,Se.resultTransition=this.resultTransition,Se.prevInResult=this.prevInResult,Se.isExteriorRing=this.isExteriorRing,Se.inOut=this.inOut,Se.otherInOut=this.otherInOut,Se},Object.defineProperties(re.prototype,ne);var he=11102230246251565e-32,ge=134217729,ke=(3+8*he)*he;function Ee(Se,Ie,bt,Ft,ln){var un,Un,Yn,zr,qr=Ie[0],Yr=Ft[0],fi=0,_r=0;Yr>qr==Yr>-qr?(un=qr,qr=Ie[++fi]):(un=Yr,Yr=Ft[++_r]);var Pr=0;if(fi<Se&&_r<bt)for(Yr>qr==Yr>-qr?(Yn=un-((Un=qr+un)-qr),qr=Ie[++fi]):(Yn=un-((Un=Yr+un)-Yr),Yr=Ft[++_r]),un=Un,Yn!==0&&(ln[Pr++]=Yn);fi<Se&&_r<bt;)Yr>qr==Yr>-qr?(Yn=un-((Un=un+qr)-(zr=Un-un))+(qr-zr),qr=Ie[++fi]):(Yn=un-((Un=un+Yr)-(zr=Un-un))+(Yr-zr),Yr=Ft[++_r]),un=Un,Yn!==0&&(ln[Pr++]=Yn);for(;fi<Se;)Yn=un-((Un=un+qr)-(zr=Un-un))+(qr-zr),qr=Ie[++fi],un=Un,Yn!==0&&(ln[Pr++]=Yn);for(;_r<bt;)Yn=un-((Un=un+Yr)-(zr=Un-un))+(Yr-zr),Yr=Ft[++_r],un=Un,Yn!==0&&(ln[Pr++]=Yn);return un===0&&Pr!==0||(ln[Pr++]=un),Pr}function Pe(Se){return new Float64Array(Se)}var Be=33306690738754716e-32,$e=22204460492503146e-32,mt=11093356479670487e-47,Xe=Pe(4),vt=Pe(8),kt=Pe(12),It=Pe(16),zt=Pe(4);function Bt(Se,Ie,bt){var Ft=function(ln,un,Un,Yn,zr,qr){var Yr=(un-qr)*(Un-zr),fi=(ln-zr)*(Yn-qr),_r=Yr-fi;if(Yr===0||fi===0||Yr>0!=fi>0)return _r;var Pr=Math.abs(Yr+fi);return Math.abs(_r)>=Be*Pr?_r:-function(Pi,zi,Fi,rs,ws,fs,ji){var Yi,Zr,bi,oa,mr,pi,gs,Rs,Fs,Ba,Os,gr,pa,is,ta,io,Ao,Wa,Xa=Pi-ws,_o=Fi-ws,Ul=zi-fs,Ls=rs-fs;Xe[0]=(ta=(Rs=Xa-(gs=(pi=ge*Xa)-(pi-Xa)))*(Ba=Ls-(Fs=(pi=ge*Ls)-(pi-Ls)))-((is=Xa*Ls)-gs*Fs-Rs*Fs-gs*Ba))-((Os=ta-(Ao=(Rs=Ul-(gs=(pi=ge*Ul)-(pi-Ul)))*(Ba=_o-(Fs=(pi=ge*_o)-(pi-_o)))-((io=Ul*_o)-gs*Fs-Rs*Fs-gs*Ba)))+(mr=ta-Os))+(mr-Ao),Xe[1]=(pa=is-((gr=is+Os)-(mr=gr-is))+(Os-mr))-((Os=pa-io)+(mr=pa-Os))+(mr-io),Xe[2]=gr-((Wa=gr+Os)-(mr=Wa-gr))+(Os-mr),Xe[3]=Wa;var Oa=function(Wh,Yo){for(var Rl=Yo[0],Eu=1;Eu<4;Eu++)Rl+=Yo[Eu];return Rl}(0,Xe),ja=$e*ji;if(Oa>=ja||-Oa>=ja||(Yi=Pi-(Xa+(mr=Pi-Xa))+(mr-ws),bi=Fi-(_o+(mr=Fi-_o))+(mr-ws),Zr=zi-(Ul+(mr=zi-Ul))+(mr-fs),oa=rs-(Ls+(mr=rs-Ls))+(mr-fs),Yi===0&&Zr===0&&bi===0&&oa===0)||(ja=mt*ji+ke*Math.abs(Oa),(Oa+=Xa*oa+Ls*Yi-(Ul*bi+_o*Zr))>=ja||-Oa>=ja))return Oa;zt[0]=(ta=(Rs=Yi-(gs=(pi=ge*Yi)-(pi-Yi)))*(Ba=Ls-(Fs=(pi=ge*Ls)-(pi-Ls)))-((is=Yi*Ls)-gs*Fs-Rs*Fs-gs*Ba))-((Os=ta-(Ao=(Rs=Zr-(gs=(pi=ge*Zr)-(pi-Zr)))*(Ba=_o-(Fs=(pi=ge*_o)-(pi-_o)))-((io=Zr*_o)-gs*Fs-Rs*Fs-gs*Ba)))+(mr=ta-Os))+(mr-Ao),zt[1]=(pa=is-((gr=is+Os)-(mr=gr-is))+(Os-mr))-((Os=pa-io)+(mr=pa-Os))+(mr-io),zt[2]=gr-((Wa=gr+Os)-(mr=Wa-gr))+(Os-mr),zt[3]=Wa;var tu=Ee(4,Xe,4,zt,vt);zt[0]=(ta=(Rs=Xa-(gs=(pi=ge*Xa)-(pi-Xa)))*(Ba=oa-(Fs=(pi=ge*oa)-(pi-oa)))-((is=Xa*oa)-gs*Fs-Rs*Fs-gs*Ba))-((Os=ta-(Ao=(Rs=Ul-(gs=(pi=ge*Ul)-(pi-Ul)))*(Ba=bi-(Fs=(pi=ge*bi)-(pi-bi)))-((io=Ul*bi)-gs*Fs-Rs*Fs-gs*Ba)))+(mr=ta-Os))+(mr-Ao),zt[1]=(pa=is-((gr=is+Os)-(mr=gr-is))+(Os-mr))-((Os=pa-io)+(mr=pa-Os))+(mr-io),zt[2]=gr-((Wa=gr+Os)-(mr=Wa-gr))+(Os-mr),zt[3]=Wa;var so=Ee(tu,vt,4,zt,kt);zt[0]=(ta=(Rs=Yi-(gs=(pi=ge*Yi)-(pi-Yi)))*(Ba=oa-(Fs=(pi=ge*oa)-(pi-oa)))-((is=Yi*oa)-gs*Fs-Rs*Fs-gs*Ba))-((Os=ta-(Ao=(Rs=Zr-(gs=(pi=ge*Zr)-(pi-Zr)))*(Ba=bi-(Fs=(pi=ge*bi)-(pi-bi)))-((io=Zr*bi)-gs*Fs-Rs*Fs-gs*Ba)))+(mr=ta-Os))+(mr-Ao),zt[1]=(pa=is-((gr=is+Os)-(mr=gr-is))+(Os-mr))-((Os=pa-io)+(mr=pa-Os))+(mr-io),zt[2]=gr-((Wa=gr+Os)-(mr=Wa-gr))+(Os-mr),zt[3]=Wa;var ud=Ee(so,kt,4,zt,It);return It[ud-1]}(ln,un,Un,Yn,zr,qr,Pr)}(Se[0],Se[1],Ie[0],Ie[1],bt[0],bt[1]);return Ft>0?-1:Ft<0?1:0}function Ot(Se,Ie){var bt=Se.point,Ft=Ie.point;return bt[0]>Ft[0]?1:bt[0]<Ft[0]?-1:bt[1]!==Ft[1]?bt[1]>Ft[1]?1:-1:function(ln,un,Un,Yn){return ln.left!==un.left?ln.left?1:-1:Bt(Un,ln.otherEvent.point,un.otherEvent.point)!==0?ln.isBelow(un.otherEvent.point)?-1:1:!ln.isSubject&&un.isSubject?1:-1}(Se,Ie,bt)}function Lt(Se,Ie,bt){var Ft=new re(Ie,!1,Se,Se.isSubject),ln=new re(Ie,!0,Se.otherEvent,Se.isSubject);return ue(Se.point,Se.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Se),Ft.contourId=ln.contourId=Se.contourId,Ot(ln,Se.otherEvent)>0&&(Se.otherEvent.left=!0,ln.left=!1),Se.otherEvent.otherEvent=ln,Se.otherEvent=Ft,bt.push(ln),bt.push(Ft),bt}function yt(Se,Ie){return Se[0]*Ie[1]-Se[1]*Ie[0]}function gt(Se,Ie){return Se[0]*Ie[0]+Se[1]*Ie[1]}function Dt(Se,Ie,bt){var Ft=function(zr,qr,Yr,fi,_r){var Pr=[qr[0]-zr[0],qr[1]-zr[1]],Pi=[fi[0]-Yr[0],fi[1]-Yr[1]];function zi(pi,gs,Rs){return[pi[0]+gs*Rs[0],pi[1]+gs*Rs[1]]}var Fi=[Yr[0]-zr[0],Yr[1]-zr[1]],rs=yt(Pr,Pi),ws=rs*rs,fs=gt(Pr,Pr);if(ws>0){var ji=yt(Fi,Pi)/rs;if(ji<0||ji>1)return null;var Yi=yt(Fi,Pr)/rs;return Yi<0||Yi>1?null:ji===0||ji===1?[zi(zr,ji,Pr)]:Yi===0||Yi===1?[zi(Yr,Yi,Pi)]:[zi(zr,ji,Pr)]}if((ws=(rs=yt(Fi,Pr))*rs)>0)return null;var Zr=gt(Pr,Fi)/fs,bi=Zr+gt(Pr,Pi)/fs,oa=Math.min(Zr,bi),mr=Math.max(Zr,bi);return oa<=1&&mr>=0?oa===1?[zi(zr,oa>0?oa:0,Pr)]:mr===0?[zi(zr,mr<1?mr:1,Pr)]:[zi(zr,oa>0?oa:0,Pr),zi(zr,mr<1?mr:1,Pr)]:null}(Se.point,Se.otherEvent.point,Ie.point,Ie.otherEvent.point),ln=Ft?Ft.length:0;if(ln===0||ln===1&&(ue(Se.point,Ie.point)||ue(Se.otherEvent.point,Ie.otherEvent.point))||ln===2&&Se.isSubject===Ie.isSubject)return 0;if(ln===1)return ue(Se.point,Ft[0])||ue(Se.otherEvent.point,Ft[0])||Lt(Se,Ft[0],bt),ue(Ie.point,Ft[0])||ue(Ie.otherEvent.point,Ft[0])||Lt(Ie,Ft[0],bt),1;var un=[],Un=!1,Yn=!1;return ue(Se.point,Ie.point)?Un=!0:Ot(Se,Ie)===1?un.push(Ie,Se):un.push(Se,Ie),ue(Se.otherEvent.point,Ie.otherEvent.point)?Yn=!0:Ot(Se.otherEvent,Ie.otherEvent)===1?un.push(Ie.otherEvent,Se.otherEvent):un.push(Se.otherEvent,Ie.otherEvent),Un&&Yn||Un?(Ie.type=w,Se.type=Ie.inOut===Se.inOut?A:R,Un&&!Yn&&Lt(un[1].otherEvent,un[0].point,bt),2):Yn?(Lt(un[0],un[1].point,bt),3):un[0]!==un[3].otherEvent?(Lt(un[0],un[1].point,bt),Lt(un[1],un[2].point,bt),3):(Lt(un[0],un[1].point,bt),Lt(un[3].otherEvent,un[2].point,bt),3)}function tn(Se,Ie){if(Se===Ie)return 0;if(Bt(Se.point,Se.otherEvent.point,Ie.point)!==0||Bt(Se.point,Se.otherEvent.point,Ie.otherEvent.point)!==0)return ue(Se.point,Ie.point)?Se.isBelow(Ie.otherEvent.point)?-1:1:Se.point[0]===Ie.point[0]?Se.point[1]<Ie.point[1]?-1:1:Ot(Se,Ie)===1?Ie.isAbove(Se.point)?-1:1:Se.isBelow(Ie.point)?-1:1;if(Se.isSubject!==Ie.isSubject)return Se.isSubject?-1:1;var bt=Se.point,Ft=Ie.point;return bt[0]===Ft[0]&&bt[1]===Ft[1]?(bt=Se.otherEvent.point)[0]===(Ft=Ie.otherEvent.point)[0]&&bt[1]===Ft[1]?0:Se.contourId>Ie.contourId?1:-1:Ot(Se,Ie)===1?1:-1}var $t=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Bn(Se,Ie,bt,Ft){var ln,un=Se+1,Un=Ie[Se].point,Yn=Ie.length;for(un<Yn&&(ln=Ie[un].point);un<Yn&&ln[0]===Un[0]&&ln[1]===Un[1];){if(!bt[un])return un;++un<Yn&&(ln=Ie[un].point)}for(un=Se-1;bt[un]&&un>Ft;)un--;return un}$t.prototype.isExterior=function(){return this.holeOf==null};var pn=Rn,xn=Rn;function Rn(Se,Ie){if(!(this instanceof Rn))return new Rn(Se,Ie);if(this.data=Se||[],this.length=this.data.length,this.compare=Ie||Jr,this.length>0)for(var bt=(this.length>>1)-1;bt>=0;bt--)this._down(bt)}function Jr(Se,Ie){return Se<Ie?-1:Se>Ie?1:0}Rn.prototype={push:function(Se){this.data.push(Se),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Se=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Se}},peek:function(){return this.data[0]},_up:function(Se){for(var Ie=this.data,bt=this.compare,Ft=Ie[Se];Se>0;){var ln=Se-1>>1,un=Ie[ln];if(bt(Ft,un)>=0)break;Ie[Se]=un,Se=ln}Ie[Se]=Ft},_down:function(Se){for(var Ie=this.data,bt=this.compare,Ft=this.length>>1,ln=Ie[Se];Se<Ft;){var un=1+(Se<<1),Un=un+1,Yn=Ie[un];if(Un<this.length&&bt(Ie[Un],Yn)<0&&(un=Un,Yn=Ie[Un]),bt(Yn,ln)>=0)break;Ie[Se]=Yn,Se=un}Ie[Se]=ln}},pn.default=xn;var Zt=Math.max,Pn=Math.min,Or=0;function gi(Se,Ie,bt,Ft,ln,un){var Un,Yn,zr,qr,Yr,fi;for(Un=0,Yn=Se.length-1;Un<Yn;Un++)if(qr=Se[Un+1],Yr=new re(zr=Se[Un],!1,void 0,Ie),fi=new re(qr,!1,Yr,Ie),Yr.otherEvent=fi,zr[0]!==qr[0]||zr[1]!==qr[1]){Yr.contourId=fi.contourId=bt,un||(Yr.isExteriorRing=!1,fi.isExteriorRing=!1),Ot(Yr,fi)>0?fi.left=!0:Yr.left=!0;var _r=zr[0],Pr=zr[1];ln[0]=Pn(ln[0],_r),ln[1]=Pn(ln[1],Pr),ln[2]=Zt(ln[2],_r),ln[3]=Zt(ln[3],Pr),Ft.push(Yr),Ft.push(fi)}}var Ei=[];function jr(Se,Ie,bt){typeof Se[0][0][0]=="number"&&(Se=[Se]),typeof Ie[0][0][0]=="number"&&(Ie=[Ie]);var Ft=function(Pr,Pi,zi){var Fi=null;return Pr.length*Pi.length==0&&(zi===O?Fi=Ei:zi===z?Fi=Pr:zi!==D&&zi!==V||(Fi=Pr.length===0?Pi:Pr)),Fi}(Se,Ie,bt);if(Ft)return Ft===Ei?null:Ft;var ln=[1/0,1/0,-1/0,-1/0],un=[1/0,1/0,-1/0,-1/0],Un=function(Pr,Pi,zi,Fi,rs){var ws,fs,ji,Yi,Zr,bi,oa=new pn(null,Ot);for(ji=0,Yi=Pr.length;ji<Yi;ji++)for(Zr=0,bi=(ws=Pr[ji]).length;Zr<bi;Zr++)(fs=Zr===0)&&Or++,gi(ws[Zr],!0,Or,oa,zi,fs);for(ji=0,Yi=Pi.length;ji<Yi;ji++)for(Zr=0,bi=(ws=Pi[ji]).length;Zr<bi;Zr++)fs=Zr===0,rs===z&&(fs=!1),fs&&Or++,gi(ws[Zr],!1,Or,oa,Fi,fs);return oa}(Se,Ie,ln,un,bt);if(Ft=function(Pr,Pi,zi,Fi,rs){var ws=null;return(zi[0]>Fi[2]||Fi[0]>zi[2]||zi[1]>Fi[3]||Fi[1]>zi[3])&&(rs===O?ws=Ei:rs===z?ws=Pr:rs!==D&&rs!==V||(ws=Pr.concat(Pi))),ws}(Se,Ie,ln,un,bt))return Ft===Ei?null:Ft;for(var Yn=function(Pr){var Pi,zi,Fi=function(ji){var Yi,Zr,bi,oa,mr=[];for(Zr=0,bi=ji.length;Zr<bi;Zr++)((Yi=ji[Zr]).left&&Yi.inResult||!Yi.left&&Yi.otherEvent.inResult)&&mr.push(Yi);for(var pi=!1;!pi;)for(pi=!0,Zr=0,bi=mr.length;Zr<bi;Zr++)Zr+1<bi&&Ot(mr[Zr],mr[Zr+1])===1&&(oa=mr[Zr],mr[Zr]=mr[Zr+1],mr[Zr+1]=oa,pi=!1);for(Zr=0,bi=mr.length;Zr<bi;Zr++)(Yi=mr[Zr]).otherPos=Zr;for(Zr=0,bi=mr.length;Zr<bi;Zr++)(Yi=mr[Zr]).left||(oa=Yi.otherPos,Yi.otherPos=Yi.otherEvent.otherPos,Yi.otherEvent.otherPos=oa);return mr}(Pr),rs={},ws=[],fs=function(){if(!rs[Pi]){var ji=ws.length,Yi=function(mr,pi,gs){var Rs=new $t;if(mr.prevInResult!=null){var Fs=mr.prevInResult,Ba=Fs.outputContourId;if(Fs.resultTransition>0){var Os=pi[Ba];if(Os.holeOf!=null){var gr=Os.holeOf;pi[gr].holeIds.push(gs),Rs.holeOf=gr,Rs.depth=pi[Ba].depth}else pi[Ba].holeIds.push(gs),Rs.holeOf=Ba,Rs.depth=pi[Ba].depth+1}else Rs.holeOf=null,Rs.depth=pi[Ba].depth}else Rs.holeOf=null,Rs.depth=0;return Rs}(Fi[Pi],ws,ji),Zr=function(mr){rs[mr]=!0,mr<Fi.length&&Fi[mr]&&(Fi[mr].outputContourId=ji)},bi=Pi,oa=Pi;for(Yi.points.push(Fi[Pi].point);Zr(bi),Zr(bi=Fi[bi].otherPos),Yi.points.push(Fi[bi].point),!((bi=Bn(bi,Fi,rs,oa))==oa||bi>=Fi.length)&&Fi[bi];);ws.push(Yi)}};for(Pi=0,zi=Fi.length;Pi<zi;Pi++)fs();return ws}(function(Pr,Pi,zi,Fi,rs,ws){for(var fs,ji,Yi,Zr=new u(tn),bi=[],oa=Math.min(Fi[2],rs[2]);Pr.length!==0;){var mr=Pr.pop();if(bi.push(mr),ws===O&&mr.point[0]>oa||ws===z&&mr.point[0]>Fi[2])break;if(mr.left){ji=fs=Zr.insert(mr),fs=fs!==(Yi=Zr.minNode())?Zr.prev(fs):null,ji=Zr.next(ji);var pi=fs?fs.key:null;if(H(mr,pi,ws),ji&&Dt(mr,ji.key,Pr)===2&&(H(mr,pi,ws),H(ji.key,mr,ws)),fs&&Dt(fs.key,mr,Pr)===2){var gs=fs;H(pi,(gs=gs!==Yi?Zr.prev(gs):null)?gs.key:null,ws),H(mr,pi,ws)}}else ji=fs=Zr.find(mr=mr.otherEvent),fs&&ji&&(fs=fs!==Yi?Zr.prev(fs):null,ji=Zr.next(ji),Zr.remove(mr),ji&&fs&&Dt(fs.key,ji.key,Pr))}return bi}(Un,0,0,ln,un,bt)),zr=[],qr=0;qr<Yn.length;qr++){var Yr=Yn[qr];if(Yr.isExterior()){for(var fi=[Yr.points],_r=0;_r<Yr.holeIds.length;_r++)fi.push(Yn[Yr.holeIds[_r]].points);zr.push(fi)}}return zr}var hs={UNION:D,DIFFERENCE:z,INTERSECTION:O,XOR:V};c.diff=function(Se,Ie){return jr(Se,Ie,z)},c.intersection=function(Se,Ie){return jr(Se,Ie,O)},c.operations=hs,c.union=function(Se,Ie){return jr(Se,Ie,D)},c.xor=function(Se,Ie){return jr(Se,Ie,V)},Object.defineProperty(c,"__esModule",{value:!0})}(pz.exports)),pz.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function LS(c,s,u,h){const p=[],_=h===0?(v,w,A,R,O,D)=>{v.push(new je(D,A+(D-w)/(R-w)*(O-A)))}:(v,w,A,R,O,D)=>{v.push(new je(w+(D-A)/(O-A)*(R-w),D))};for(const v of c){const w=[];for(const A of v){if(A.length<=2)continue;const R=[];for(let z=0;z<A.length-1;z++){const V=A[z].x,H=A[z].y,K=A[z+1].x,re=A[z+1].y,ne=h===0?V:H,ue=h===0?K:re;ne<s?ue>s&&_(R,V,H,K,re,s):ne>u?ue<u&&_(R,V,H,K,re,u):R.push(A[z]),ue<s&&ne>=s&&_(R,V,H,K,re,s),ue>u&&ne<=u&&_(R,V,H,K,re,u)}let O=A[A.length-1];const D=h===0?O.x:O.y;D>=s&&D<=u&&R.push(O),R.length&&(O=R[R.length-1],R[0].x===O.x&&R[0].y===O.y||R.push(R[0]),w.push(R))}w.length&&p.push(w)}return p}function $ie(c,s){const u=t6(c),h=t6([s]),p=mz.intersection(u,h);return p==null?[]:gz(p)}function Hie(c,s){let h=t6(c,65536);const p=[];for(;s.valid();s.next()){const[_,v]=s.get(),w=_.x*65536,A=_.y*65536,R=v.x*65536,O=v.y*65536,D=R-w,z=O-A,V=Math.hypot(D,z);if(V===0)continue;const H=Math.trunc(z/V*3),K=-Math.trunc(D/V*3);p.push([[[w,A],[R,O],[R+H,O+K],[w+H,A+K],[w,A]]])}return p.length>0&&(h=mz.diff(h,p)),gz(h,1/65536)}function t6(c,s=1){return[c.map(u=>u.map(h=>[h.x*s,h.y*s]))]}function gz(c,s=1){return c.map(u=>u.map((h,p)=>{const _=h.map(v=>new je(v[0]*s,v[1]*s).round());return p>0&&_.reverse(),_}))}class n6{constructor(s,u){this.layoutVertexArray=new Uh,this.indexArray=new to,this.lineIndexArray=new xu,this.triangleSegments=new da,this.lineSegments=new da,this.programConfigurations=new Ec(s.layers,{zoom:s.zoom,lut:s.lut}),this.uploaded=!1,u&&(this.elevatedLayoutVertexArray=new Bd)}update(s,u,h,p,_,v,w,A){this.programConfigurations.updatePaintArrays(s,u,_,h,p,v,w,A)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,kie.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.lineIndexBuffer=s.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=s.createVertexBuffer(this.elevatedLayoutVertexArray,Iie.members))),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(s,u,h,p,_,v,w){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,u,h,p,_,v,void 0,w)}}class r6{constructor(s){this.zoom=s.zoom,this.pixelRatio=s.pixelRatio,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.fqid),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=s.lut,this.bufferData=new n6(s,!1),this.elevationBufferData=new n6(s,!0),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.projection=s.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=s.sourceLayerIndex,this.worldview=s.worldview,this.hasAppearances=null}updateFootprints(s,u){}updateAppearances(s,u,h,p){}populate(s,u,h,p){this.hasPattern=JI("fill",this.layers,this.pixelRatio,u);const _=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:w,id:A,index:R,sourceLayerIndex:O}of s){const D=this.layers[0]._featureFilter.needGeometry,z=We(w,D);if(!this.layers[0]._featureFilter.filter(new zs(this.zoom,{worldview:this.worldview,activeFloors:u.activeFloors}),z,h))continue;const V=_?_.evaluate(z,{},h,u.availableImages):void 0,H={id:A,properties:w.properties,type:w.type,sourceLayerIndex:O,index:R,geometry:D?z.geometry:ze(w,h,p),patterns:{},sortKey:V};v.push(H)}_&&v.sort((w,A)=>w.sortKey-A.sortKey);for(const w of v){const{geometry:A,index:R,sourceLayerIndex:O}=w;if(this.hasPattern){const D=e6("fill",this.layers,w,this.zoom,this.pixelRatio,u);this.patternFeatures.push(D)}else this.addFeature(w,A,R,h,{},u.availableImages,u.brightness,u.elevationFeatures);u.featureIndex.insert(s[R].feature,A,R,O,this.index)}}update(s,u,h,p,_,v,w){this.bufferData.update(s,u,h,p,_,v,w,this.worldview),this.elevationBufferData.update(s,u,h,p,_,v,w,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(s,u,h,p,_,v,w,this.worldview)}addFeatures(s,u,h,p,_,v){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,u,h,p,v,s.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(s){this.bufferData.upload(s),this.elevationBufferData.upload(s),this.elevatedStructures&&this.elevatedStructures.upload(s)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(s,u,h,p,_,v=[],w,A){const R=sw(u,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(s,R,p,h,A):this.addGeometry(R,this.bufferData),this.bufferData.populatePaintArrays(s,h,_,v,p,w,this.worldview),this.elevationBufferData.populatePaintArrays(s,h,_,v,p,w,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(s,u,h,p,_){this.elevatedStructures&&(this.elevatedStructures.construct(s),this.elevatedStructures.populatePaintArrays(u,h,p,_,this.worldview))}addElevatedRoadFeature(s,u,h,p,_){const v=new Array,w=Wi.getElevationFeature(s,_);if(!w)return void this.addGeometry(u,this.bufferData);{const R=this.clipPolygonsToTile(u,1);R.length>0&&v.push({polygons:R,elevationFeature:w,elevationTileID:h})}const A={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(s,{},h),featureIndex:p};for(const R of v)if(R.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new wu(R.elevationTileID,this.layers,this.zoom,this.lut));const D=R.elevationFeature.isTunnel();let z=0;s.properties.hasOwnProperty(ut)&&(z=+s.properties[ut]);for(const V of R.polygons)this.elevatedStructures.addPortalCandidates(R.elevationFeature.id,V,D,R.elevationFeature,z)}R.elevationFeature.constantHeight==null&&(R.polygons=this.prepareElevatedPolygons(R.polygons,R.elevationFeature,R.elevationTileID));const O=new ls(h,R.elevationTileID);this.addElevatedGeometry(R.polygons,O,R.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,p,A)}}addElevatedGeometry(s,u,h,p,_,v){const w={elevation:h,elevationSampler:u,bias:p,index:_,featureInfo:v},[A,R]=this.addGeometry(s,this.elevationBufferData,w);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:A,max:R}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,A),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,R))}addGeometry(s,u,h){let p=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,v=null;h&&(v=h.elevationSampler.constantElevation(h.elevation,h.bias),v!=null&&(p=v,_=v));const w=(A,R,O)=>{if(h!=null)if(R.push(A),v!=null)u.elevatedLayoutVertexArray.emplaceBack(v),O.push(v);else{const D=h.elevationSampler.pointElevation(A,h.elevation,h.bias);u.elevatedLayoutVertexArray.emplaceBack(D),O.push(D),p=Math.min(p,D),_=Math.max(_,D)}};for(const A of s){let R=0;for(const he of A)R+=he.length;const O=u.triangleSegments.prepareSegment(R,u.layoutVertexArray,u.indexArray),D=O.vertexLength,z=[],V=[],H=[],K=[],re=[],ne=u.layoutVertexArray.length;for(const he of A){if(he.length===0)continue;he!==A[0]&&V.push(z.length/2);const ge=u.lineSegments.prepareSegment(he.length,u.layoutVertexArray,u.lineIndexArray),ke=ge.vertexLength;h&&re.push(u.layoutVertexArray.length-ne),w(he[0],H,K),u.layoutVertexArray.emplaceBack(he[0].x,he[0].y),u.lineIndexArray.emplaceBack(ke+he.length-1,ke),z.push(he[0].x),z.push(he[0].y);for(let Ee=1;Ee<he.length;Ee++)w(he[Ee],H,K),u.layoutVertexArray.emplaceBack(he[Ee].x,he[Ee].y),u.lineIndexArray.emplaceBack(ke+Ee-1,ke+Ee),z.push(he[Ee].x),z.push(he[Ee].y);ge.vertexLength+=he.length,ge.primitiveLength+=he.length}const ue=y1(z,V);for(let he=0;he<ue.length;he+=3)u.indexArray.emplaceBack(D+ue[he],D+ue[he+1],D+ue[he+2]);if(ue.length>0&&h&&this.elevationMode==="hd-road-base"){const he=h.elevation.isTunnel(),ge=h.elevation.safeArea,ke=this.elevatedStructures.addVertices(H,K);this.elevatedStructures.addTriangles(ue,ke,he);const Ee=re.length;if(Ee>0){for(let Pe=0;Pe<Ee-1;Pe++)this.elevatedStructures.addRenderableRing(h.index,re[Pe]+ke,re[Pe+1]-re[Pe],he,ge,h.featureInfo);this.elevatedStructures.addRenderableRing(h.index,re[Ee-1]+ke,H.length-re[Ee-1],he,ge,h.featureInfo)}}O.vertexLength+=R,O.primitiveLength+=ue.length/3}return[p,_]}prepareElevatedPolygons(s,u,h){const p=1/ae(h),_=[];for(const v of s){const w=Hie(v,new Ni(u,p));_.push(...w)}return _}clipPolygonsToTile(s,u){const h=-u,p=-u,_=Jt+u,v=Jt+u;let w=0;const A=[],R=[];for(;w<s.length;w++){const z=s[w],V=Od(z);(V.min.x>=h&&V.max.x<=_&&V.min.y>=p&&V.max.y<=v?A:R).push(z)}if(A.length===s.length)return s;const O=[new je(h,p),new je(_,p),new je(_,v),new je(h,v),new je(h,p)],D=A;for(const z of R)D.push(...$ie(z,O));return D}}let _z,yz,vz,xz;En(r6,"FillBucket",{omit:["layers","patternFeatures"]}),En(n6,"FillBufferData"),En(wu,"ElevatedStructures");class DS{constructor(s,u,h,p){if(this.triangleCount=u.length/3,this.min=new je(0,0),this.max=new je(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||s.length===0)return;const[_,v]=[s[0].clone(),s[0].clone()];for(let D=1;D<s.length;++D){const z=s[D];_.x=Math.min(_.x,z.x),_.y=Math.min(_.y,z.y),v.x=Math.max(v.x,z.x),v.y=Math.max(v.y,z.y)}if(p){const D=Math.ceil(Math.max(v.x-_.x,v.y-_.y)/p);h=Math.max(h,D)}if(h===0)return;this.min=_,this.max=v;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const A=Math.max(w.x,w.y)/h;this.cellsX=Math.max(1,Math.ceil(w.x/A)),this.cellsY=Math.max(1,Math.ceil(w.y/A)),this.xScale=1/A,this.yScale=1/A;const R=[];for(let D=0;D<this.triangleCount;D++){const z=s[u[3*D+0]].sub(this.min),V=s[u[3*D+1]].sub(this.min),H=s[u[3*D+2]].sub(this.min),K=qh(Math.floor(Math.min(z.x,V.x,H.x)),this.xScale,this.cellsX),re=qh(Math.floor(Math.max(z.x,V.x,H.x)),this.xScale,this.cellsX),ne=qh(Math.floor(Math.min(z.y,V.y,H.y)),this.yScale,this.cellsY),ue=qh(Math.floor(Math.max(z.y,V.y,H.y)),this.yScale,this.cellsY),he=new je(0,0),ge=new je(0,0),ke=new je(0,0),Ee=new je(0,0);for(let Pe=ne;Pe<=ue;++Pe){he.y=ge.y=Pe*A,ke.y=Ee.y=(Pe+1)*A;for(let Be=K;Be<=re;++Be)he.x=ke.x=Be*A,ge.x=Ee.x=(Be+1)*A,(al(z,V,H,he,ge,Ee)||al(z,V,H,he,Ee,ke))&&R.push({cellIdx:Pe*this.cellsX+Be,triIdx:D})}}if(R.length===0)return;R.sort((D,z)=>D.cellIdx-z.cellIdx||D.triIdx-z.triIdx);let O=0;for(;O<R.length;){const D=R[O].cellIdx,z={start:this.payload.length,len:0};for(;O<R.length&&R[O].cellIdx===D;)++z.len,this.payload.push(R[O++].triIdx);this.cells[D]=z}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(s,u){if(this.triangleCount===0||this.cells.length===0||s.x>this.max.x||this.min.x>s.x||s.y>this.max.y||this.min.y>s.y)return;const h=qh(s.x-this.min.x,this.xScale,this.cellsX),p=qh(s.y-this.min.y,this.yScale,this.cellsY),_=this.cells[p*this.cellsX+h];if(_){this._lazyInitLookup();for(let v=0;v<_.len;v++){const w=this.payload[_.start+v],A=Math.floor(w/8),R=1<<w%8;if(!(this.lookup[A]&R)&&(this.lookup[A]|=R,u.push(w),u.length===this.triangleCount))return}}}query(s,u,h){if(this.triangleCount===0||this.cells.length===0||s.x>this.max.x||this.min.x>u.x||s.y>this.max.y||this.min.y>u.y)return;this._lazyInitLookup();const p=qh(s.x-this.min.x,this.xScale,this.cellsX),_=qh(u.x-this.min.x,this.xScale,this.cellsX),v=qh(s.y-this.min.y,this.yScale,this.cellsY),w=qh(u.y-this.min.y,this.yScale,this.cellsY);for(let A=v;A<=w;A++)for(let R=p;R<=_;R++){const O=this.cells[A*this.cellsX+R];if(O)for(let D=0;D<O.len;D++){const z=this.payload[O.start+D],V=Math.floor(z/8),H=1<<z%8;if(!(this.lookup[V]&H)&&(this.lookup[V]|=H,h.push(z),h.length===this.triangleCount))return}}}}function qh(c,s,u){return Math.max(0,Math.min(u-1,Math.floor(c*s)))}En(DS,"TriangleGridIndex");class bz{constructor(s){this.zoom=s.zoom,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.fqid),this.index=s.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.footprints=[],this.worldview=s.worldview,this.hasAppearances=null}updateFootprints(s,u){for(const h of this.footprints)u.push({footprint:h,id:s})}updateAppearances(s,u,h,p){}populate(s,u,h,p){const _=[];for(const{feature:v,id:w,index:A,sourceLayerIndex:R}of s){const O=this.layers[0]._featureFilter.needGeometry,D=We(v,O);if(!this.layers[0]._featureFilter.filter(new zs(this.zoom,{worldview:this.worldview,activeFloors:u.activeFloors}),D,h))continue;const z={id:w,properties:v.properties,type:v.type,sourceLayerIndex:R,index:A,geometry:O?D.geometry:ze(v,h,p),patterns:{}};_.push(z)}for(const v of _){const{geometry:w,index:A,sourceLayerIndex:R}=v;this.addFeature(v,w,A,h,{},u.availableImages,u.brightness),u.featureIndex.insert(s[A].feature,w,A,R,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(s){}update(s,u,h,p,_,v,w){}destroy(){}addFeature(s,u,h,p,_,v=[],w){for(const A of sw(u,2)){const R=[],O=[],D=[],z=new je(1/0,1/0),V=new je(-1/0,-1/0);for(const re of A)if(re.length!==0){re!==A[0]&&D.push(O.length/2);for(let ne=0;ne<re.length;ne++)O.push(re[ne].x),O.push(re[ne].y),R.push(re[ne]),z.x=Math.min(z.x,re[ne].x),z.y=Math.min(z.y,re[ne].y),V.x=Math.max(V.x,re[ne].x),V.y=Math.max(V.y,re[ne].y)}const H=y1(O,D),K=new DS(R,H,8,256);this.footprints.push({vertices:R,indices:H,grid:K,min:z,max:V})}}}En(bz,"ClipBucket",{omit:["layers"]});const Gie=hi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),qie=hi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Zie=hi([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),Wie=hi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Xie=hi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Yie=hi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Kie=hi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Qie}=Gie,aw=Number.MAX_SAFE_INTEGER,wz=aw-1;function Tz(c,s,u,h){return c.order<s||c.order===aw||!(c.clipMask&u)||function(p,_){return _.length!==0&&_.find(v=>v===p)===void 0}(h,c.clipScope)}function NS(c,s){return c.x-s.x||c.y-s.y}function Ez(c,s){return NS(c.min,s.min)===0&&NS(c.max,s.max)===0}function i6(c,s){return!(c.min.x>s.max.x||c.max.x<s.min.x||c.min.y>s.max.y||c.max.y<s.min.y)}function zS(c,s){if(c.length!==s.length)return!1;for(let u=0;u<c.length;u++)if(c[u].sourceId!==s[u].sourceId||!Ez(c[u],s[u])||c[u].order!==s[u].order||c[u].clipMask!==s[u].clipMask||!jn(c[u].clipScope,s[u].clipScope))return!1;return!0}function Sz(c,s,u){const h=1/Jt,p=1/(1<<u.canonical.z),_=(s.x*h+u.canonical.x)*p+u.wrap,v=(s.y*h+u.canonical.y)*p;return{min:new je((c.x*h+u.canonical.x)*p+u.wrap,(c.y*h+u.canonical.y)*p),max:new je(_,v)}}function Jie(c,s,u){const h=1<<u.canonical.z,p=((s.x-u.wrap)*h-u.canonical.x)*Jt,_=(s.y*h-u.canonical.y)*Jt;return{min:new je(((c.x-u.wrap)*h-u.canonical.x)*Jt,(c.y*h-u.canonical.y)*Jt),max:new je(p,_)}}function s6(c,s,u,h,p,_,v){const w=c.indices,A=c.vertices,R=[];for(let O=h;O<h+p;O+=3){const D=s[u[O+0]+_],z=s[u[O+1]+_],V=s[u[O+2]+_],H=Math.min(D.x,z.x,V.x),K=Math.max(D.x,z.x,V.x),re=Math.min(D.y,z.y,V.y),ne=Math.max(D.y,z.y,V.y);R.length=0,c.grid.query(new je(H,re),new je(K,ne),R);for(let ue=0;ue<R.length;ue++){const he=R[ue];if(al(A[w[3*he+0]],A[w[3*he+1]],A[w[3*he+2]],D,z,V,v))return!0}}return!1}function Az(c,s,u,h){if(!c||!u)return!1;let p=c.vertices;if(!s.canonical.equals(h.canonical)||s.wrap!==h.wrap){if(u.vertices.length<c.vertices.length)return Az(u,h,c,s);const _=s.canonical,v=h.canonical,w=Math.pow(2,v.z-_.z);p=c.vertices.map(A=>new je((A.x+_.x*Jt)*w-v.x*Jt,(A.y+_.y*Jt)*w-v.y*Jt))}return s6(u,p,c.indices,0,c.indices.length,0,0)}function Cz(c,s,u,h){const p=Math.pow(2,h.z-u.z);return new je((c+u.x*Jt)*p-h.x*Jt,(s+u.y*Jt)*p-h.y*Jt)}function kz(c,s){const u=[];s.grid.queryPoint(c,u);const h=s.indices,p=s.vertices;for(let _=0;_<u.length;_++){const v=u[_];if(xs([p[h[3*v+0]],p[h[3*v+1]],p[h[3*v+2]]],c))return!0}return!1}const a6=[new je(0,0),new je(Jt,0),new je(Jt,Jt),new je(0,Jt)];function Iz(c,s){const u=[];let h=[];if(!s||c.length<2)return[c];if(c.length===2)return Xo(c[0],c[1],a6)?[c]:[];for(let p=0;p<c.length+2;p++){const _=c[p%c.length],v=c[(p+1)%c.length],w=Xo(p===0?c[c.length-1]:c[(p-1)%c.length],_,a6),A=Xo(_,v,a6),R=w||A;R&&h.push(_),R&&A||h.length>0&&(h.length>1&&u.push(h),h=[])}return h.length>1&&u.push(h),u}const o6=Ge.types,ese=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],tse=["fill-extrusion-flood-light-ground-radius"],nse=Math.pow(2,13),rse=Math.pow(2,15)-1,Rz=new je(0,1),Qf=2147483648,Mz=7,Pz=450;function ow(c,s,u,h,p,_,v,w){c.emplaceBack((s<<1)+v,(u<<1)+_,(Math.floor(h*nse)<<1)+p,Math.round(w))}function lw(c,s,u){c.emplaceBack(s.x*Jt,s.y*Jt,u?1:0)}function FS(c,s,u,h,p,_){c.emplaceBack(s.x,s.y,(u.x<<1)+h,(u.y<<1)+p,_)}function uw(c,s,u){c.emplaceBack(s.x,s.y,s.z,u[0]*16384,u[1]*16384,u[2]*16384)}class Oz{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Lz{constructor(){this.centroidXY=new je(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new je(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new je(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new je(this.max.x-this.min.x,this.max.y-this.min.y)}}class Dz{constructor(){this.acc=new je(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(s,u){s.min.x===Number.MAX_VALUE&&(s.min.x=s.max.x=u.x,s.min.y=s.max.y=u.y)}appendEdge(s,u,h){this.accCount++,this.acc._add(u);let p=!!this.borders;u.x<s.min.x?(s.min.x=u.x,p=!0):u.x>s.max.x&&(s.max.x=u.x,p=!0),u.y<s.min.y?(s.min.y=u.y,p=!0):u.y>s.max.y&&(s.max.y=u.y,p=!0),((u.x===0||u.x===Jt)&&u.x===h.x)!=((u.y===0||u.y===Jt)&&u.y===h.y)&&this.processBorderOverlap(u,h),p&&this.checkBorderIntersection(u,h)}checkBorderIntersection(s,u){u.x<0!=s.x<0&&this.addBorderIntersection(0,Tr(u.y,s.y,(0-u.x)/(s.x-u.x))),u.x>Jt!=s.x>Jt&&this.addBorderIntersection(1,Tr(u.y,s.y,(Jt-u.x)/(s.x-u.x))),u.y<0!=s.y<0&&this.addBorderIntersection(2,Tr(u.x,s.x,(0-u.y)/(s.y-u.y))),u.y>Jt!=s.y>Jt&&this.addBorderIntersection(3,Tr(u.x,s.x,(Jt-u.y)/(s.y-u.y)))}addBorderIntersection(s,u){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[s];u<h[0]&&(h[0]=u),u>h[1]&&(h[1]=u)}processBorderOverlap(s,u){if(s.x===u.x){if(s.y===u.y)return;const h=s.x===0?0:1;this.addBorderIntersection(h,u.y),this.addBorderIntersection(h,s.y)}else{const h=s.y===0?2:3;this.addBorderIntersection(h,u.x),this.addBorderIntersection(h,s.x)}}centroid(){return this.accCount===0?new je(0,0):new je(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((s,u)=>s+ +(u[0]!==Number.MAX_VALUE),0):0}}function Nz(c,s){const u=c.add(s)._unit(),h=ee(c.x*u.x+c.y*u.y,-1,1);var p,_,v;return p=Math.acos(h),Math.min(4,Math.max(-4,Math.tan(p)))/4*rse*((_=c).x*(v=s).y-_.y*v.x<0?-1:1)}const ise=[c=>c.x<0,c=>c.x>Jt,c=>c.y<0,c=>c.y>Jt];function sse(c,s,u,h){const p=[4];if(h===0)return p;u._mult(h);const _=c.sub(u),v=s.sub(u),w=[c,s,_,v];for(let A=0;A<4;A++)for(const R of w)if(ise[A](R)){p.push(A);break}return p}class l6{constructor(s){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Db,this.indexArray=new to,this.programConfigurations=new Ec(s.layers,{zoom:s.zoom,lut:s.lut},u=>tse.includes(u)),this._segments=new da,this.hiddenByLandmarkVertexArray=new a1,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new da}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(s,u,h,p=!1){const _=s.length;if(_>2){let v=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*_,this.vertexArray.length,2*this._segmentToGroundQuads[v].length);let A;v!==this._segments.get().length-1&&(v++,this._segmentToGroundQuads[v]=[],this._segmentToRegionTriCounts[v]=[0,0,0,0,0]);{const R=s[0],O=s[1];A=Nz(R.sub(s[_-1])._perp()._unit(),O.sub(R)._perp()._unit())}for(let R=0;R<_;R++){const O=R===_-1?0:R+1,D=s[R],z=s[O],V=s[O===_-1?0:O+1],H=z.sub(D)._perp()._unit(),K=Nz(H,V.sub(z)._perp()._unit()),re=A,ne=K;if(u6(D,z,u)||p&&Bz(D,u)&&Bz(z,u)){A=K;continue}const ue=w.vertexLength;FS(this.vertexArray,D,z,1,1,re),FS(this.vertexArray,D,z,1,0,re),FS(this.vertexArray,D,z,0,1,ne),FS(this.vertexArray,D,z,0,0,ne),w.vertexLength+=4;const he=sse(D,z,H,h);for(const ge of he)this._segmentToGroundQuads[v].push({id:ue,region:ge}),this._segmentToRegionTriCounts[v][ge]+=2,w.primitiveLength+=2;A=K}}}prepareBorderSegments(){if(!this.hasData())return;const s=this._segments.get(),u=s.length;for(let h=0;h<u;h++)this._segmentToGroundQuads[h].sort((p,_)=>p.region-_.region);for(let h=0;h<u;h++){const p=this._segmentToGroundQuads[h],_=s[h],v=this._segmentToRegionTriCounts[h];v.reduce((A,R)=>A+R,0);let w=0;for(let A=0;A<=4;A++){const R=v[A];if(R!==0){let O=this.regionSegments[A];O||(O=this.regionSegments[A]=new da);const D={vertexOffset:_.vertexOffset,primitiveOffset:_.primitiveOffset+w,vertexLength:_.vertexLength,primitiveLength:R};O.get().push(D)}w+=R}for(let A=0;A<p.length;A++){const R=p[A].id;this.indexArray.emplaceBack(R,R+1,R+3),this.indexArray.emplaceBack(R,R+3,R+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(s,u,h,p,_,v,w){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,s,u,h,p,_,v,void 0,w)}upload(s){this.hasData()&&(this.vertexBuffer=s.createVertexBuffer(this.vertexArray,qie.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=s.createVertexBuffer(this.groundRadiusArray,Zie.members)))}uploadPaintProperties(s){this.hasData()&&this.programConfigurations.upload(s)}update(s,u,h,p,_,v,w,A){this.hasData()&&this.programConfigurations.updatePaintArrays(s,u,h,p,_,v,w,A)}updateHiddenByLandmark(s){this.updateHiddenByLandmarkRange(s.groundVertexArrayOffset,s.groundVertexCount,!!(s.flags&Qf))}updateHiddenByLandmarkRange(s,u,h){if(!this.hasData())return;const p=u+s;if(u!==0){for(let _=s;_<p;++_)this.hiddenByLandmarkVertexArray.emplace(_,h?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(s){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=s.createVertexBuffer(this.hiddenByLandmarkVertexArray,Yie.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let s=0;s<=4;s++){const u=this.regionSegments[s];u&&u.destroy()}}}}class BS{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.overscaling=s.overscaling,this.layers=s.layers,this.pixelRatio=s.pixelRatio,this.layerIds=this.layers.map(u=>u.fqid),this.index=s.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=s.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new to,this.footprintVertices=new Uh,this.footprintSegments=[],this.layoutVertexArray=new om,this.centroidVertexArray=new AS,this.wallVertexArray=new vg,this.indexArray=new to,this.programConfigurations=new Ec(s.layers,{zoom:s.zoom,lut:s.lut},u=>ese.includes(u)),this.segments=new da,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.groundEffect=new l6(s),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=s.worldview,this.hasAppearances=null}updateFootprints(s,u){}updateAppearances(s,u,h,p){}populate(s,u,h,p){this.features=[],this.hasPattern=JI("fill-extrusion",this.layers,this.pixelRatio,u),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=ae(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:_,id:v,index:w,sourceLayerIndex:A}of s){const R=this.layers[0]._featureFilter.needGeometry,O=We(_,R);if(!this.layers[0]._featureFilter.filter(new zs(this.zoom,{worldview:this.worldview,activeFloors:u.activeFloors}),O,h))continue;const D={id:v,sourceLayerIndex:A,index:w,geometry:R?O.geometry:ze(_,h,p),properties:_.properties,type:_.type,patterns:{}},z=this.layoutVertexArray.length,V=o6[D.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:_.id,feature:e6("fill-extrusion",this.layers,D,this.zoom,this.pixelRatio,u)});else if(this.wallMode)for(const H of D.geometry)for(const K of Iz(H,V))this.addFeature(_.id,D,[K],w,h,{},u.availableImages,p,u.brightness);else this.addFeature(_.id,D,D.geometry,w,h,{},u.availableImages,p,u.brightness);u.featureIndex.insert(_,D.geometry,w,A,this.index,z)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(s,u,h,p,_,v){for(const{featureId:w,feature:A}of this.features){const R=o6[A.type]==="Polygon",{geometry:O}=A;if(this.wallMode)for(const D of O)for(const z of Iz(D,R))this.addFeature(w,A,[z],A.index,u,h,p,_,v);else this.addFeature(w,A,O,A.index,u,h,p,_,v)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(s,u,h,p,_,v,w){this.programConfigurations.updatePaintArrays(s,u,_,h,p,v,w,this.worldview),this.groundEffect.update(s,u,_,h,p,v,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Qie),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.wallVertexBuffer=s.createVertexBuffer(this.wallVertexArray,Xie.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=s.createVertexBuffer(this.layoutVertexExtArray,Kie.members,!0)),this.groundEffect.upload(s)),this.groundEffect.uploadPaintProperties(s),this.programConfigurations.upload(s),this.uploaded=!0}uploadCentroid(s){this.groundEffect.uploadHiddenByLandmark(s),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,Wie.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,u,h,p,_,v,w,A,R){const O=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(u,{})/this.tileToMeter,D=[new je(0,0),new je(Jt,Jt)],z=A.projection,V=z.name==="globe",H=this.wallMode||o6[u.type]==="Polygon",K=new Dz;K.centroidDataIndex=this.centroidData.length;const re=new Lz;re.buildingId=s,u.properties&&u.properties.hasOwnProperty("building_id")&&(re.buildingId=u.properties.building_id);const ne=this.layers[0].paint.get("fill-extrusion-base").evaluate(u,{},_)<=0,ue=this.layers[0].paint.get("fill-extrusion-height").evaluate(u,{},_);let he;if(re.height=ue,re.vertexArrayOffset=this.layoutVertexArray.length,re.groundVertexArrayOffset=this.groundEffect.vertexArray.length,V&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new e1),this.wallMode){if(V)return void Qt("Non zero fill-extrusion-line-width is not yet supported on globe.");if(h.length!==1)return;he=function(Xe){const vt=Xe[0].x===Xe[Xe.length-1].x&&Xe[0].y===Xe[Xe.length-1].y;(function(xn){let Rn=0;const Jr=xn.length;for(let Zt=0;Zt<Jr;Zt++)Rn+=(xn[(Zt+1)%Jr].x-xn[Zt].x)*(xn[(Zt+1)%Jr].y+xn[Zt].y);return Rn>=0})(Xe)||(Xe=Xe.reverse());const It={geometry:[],joinNormals:[],indices:[]},zt=[],Bt=[],Ot=[];let Lt=Xe.length;for(;Lt>=2&&Xe[Lt-1].equals(Xe[Lt-2]);)Lt--;if(Lt<(vt?3:2))return It;let yt,gt,Dt,tn,$t,Bn=0;for(;Bn<Lt-1&&Xe[Bn].equals(Xe[Bn+1]);)Bn++;vt&&(yt=Xe[Lt-2],$t=Xe[Bn].sub(yt)._unit()._perp());for(let xn=Bn;xn<Lt;xn++){if(Dt=xn===Lt-1?vt?Xe[Bn+1]:void 0:Xe[xn+1],Dt&&Xe[xn].equals(Dt))continue;$t&&(tn=$t),yt&&(gt=yt),yt=Xe[xn],$t=Dt?Dt.sub(yt)._unit()._perp():tn,tn=tn||$t;let Rn=tn.add($t);Rn.x===0&&Rn.y===0||Rn._unit();const Jr=Rn.x*$t.x+Rn.y*$t.y,Zt=Jr!==0?1/Jr:1/0,Pn=tn.x*$t.y-tn.y*$t.x>0;let Or="miter";const gi=2;Or==="miter"&&Zt>gi&&(Or="bevel"),Or==="bevel"&&(Zt>100&&(Or="flipbevel"),Zt<gi&&(Or="miter"));const Ei=(jr,hs,Se,Ie)=>{const bt=new je(jr.x,jr.y),Ft=new je(jr.x,jr.y);bt.x+=hs.x*Ie,bt.y+=hs.y*Ie,Ft.x-=hs.x*Math.max(Se,1),Ft.y-=hs.y*Math.max(Se,1),Ot.push(hs),zt.push(bt),Bt.push(Ft)};if(Or==="miter")Rn._mult(Zt),Ei(yt,Rn,0,0);else if(Or==="flipbevel")Rn=$t.mult(-1),Ei(yt,Rn,0,0),Ei(yt,Rn.mult(-1),0,0);else{const jr=-Math.sqrt(Zt*Zt-1),hs=Pn?jr:0,Se=Pn?0:jr;gt&&Ei(yt,tn,hs,Se),Dt&&Ei(yt,$t,hs,Se)}}It.geometry=[...zt,...Bt.reverse(),zt[0]],It.joinNormals=[...Ot,...Ot.reverse(),Ot[Ot.length-1]];const pn=It.geometry.length-1;for(let xn=0;xn<pn/2;xn++)if(xn+1<pn/2){let Rn=xn,Jr=xn+1,Zt=pn-1-xn,Pn=pn-2-xn;Rn=Rn===0?pn-1:Rn-1,Jr=Jr===0?pn-1:Jr-1,Zt=Zt===0?pn-1:Zt-1,Pn=Pn===0?pn-1:Pn-1,It.indices.push(Zt),It.indices.push(Jr),It.indices.push(Rn),It.indices.push(Zt),It.indices.push(Pn),It.indices.push(Jr)}return It}(h[0]),h=[he.geometry]}const ge=(Xe,vt)=>Xe<(vt.length-1)/2||Xe===vt.length-1,ke=this.wallMode?[h]:sw(h,500);for(let Xe=ke.length-1;Xe>=0;Xe--){const vt=ke[Xe];(vt.length===0||(Ee=vt[0]).every(kt=>kt.x<=0)||Ee.every(kt=>kt.x>=Jt)||Ee.every(kt=>kt.y<=0)||Ee.every(kt=>kt.y>=Jt))&&ke.splice(Xe,1)}var Ee;let Pe;if(V)Pe=$z(ke,D,_);else{Pe=[];for(const Xe of ke)Pe.push({polygon:Xe,bounds:D})}const Be=H?this.edgeRadius:0,$e=Be>0&&this.zoom<17,mt=(Xe,vt)=>{if(Xe.length===0)return!1;const kt=Xe[Xe.length-1];return vt.x===kt.x&&vt.y===kt.y};for(const{polygon:Xe,bounds:vt}of Pe){let kt=0,It=0;for(const Lt of Xe)H&&!Lt[0].equals(Lt[Lt.length-1])&&Lt.push(Lt[0]),It+=H?Lt.length-1:Lt.length;const zt=this.segments.prepareSegment((H?5:4)*It,this.layoutVertexArray,this.indexArray);re.footprintSegIdx<0&&(re.footprintSegIdx=this.footprintSegments.length),re.polygonSegIdx<0&&(re.polygonSegIdx=this.polygonSegments.length);const Bt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ot=new Oz;if(Ot.vertexOffset=this.footprintVertices.length,Ot.indexOffset=3*this.footprintIndices.length,Ot.ringIndices=[],H){const Lt=[],yt=[];kt=zt.vertexLength;for(let Dt=0;Dt<Xe.length;Dt++){const tn=Xe[Dt];tn.length&&Dt!==0&&yt.push(Lt.length/2);const $t=[];let Bn,pn;Bn=tn[1].sub(tn[0])._perp()._unit(),Ot.ringIndices.push(tn.length-1);for(let xn=1;xn<tn.length;xn++){const Rn=tn[xn],Jr=tn[xn===tn.length-1?1:xn+1],Zt=Rn.clone();if(Be){pn=Jr.sub(Rn)._perp()._unit();const Pn=Bn.add(pn)._unit(),Or=Be*Math.min(4,1/(Bn.x*Pn.x+Bn.y*Pn.y));Zt.x+=Or*Pn.x,Zt.y+=Or*Pn.y,Zt.x=Math.round(Zt.x),Zt.y=Math.round(Zt.y),Bn=pn}if(!ne||Be!==0&&!$e||mt($t,Zt)||$t.push(Zt),ow(this.layoutVertexArray,Zt.x,Zt.y,0,0,1,1,0),this.wallMode){const Pn=ge(xn,tn);lw(this.wallVertexArray,he.joinNormals[xn],!Pn)}zt.vertexLength++,this.footprintVertices.emplaceBack(Rn.x,Rn.y),Lt.push(Rn.x,Rn.y),V&&uw(this.layoutVertexExtArray,z.projectTilePoint(Zt.x,Zt.y,_),z.upVector(_,Zt.x,Zt.y))}ne&&(Be===0||$e)&&($t.length!==0&&mt($t,$t[0])&&$t.pop(),this.groundEffect.addData($t,vt,O))}const gt=this.wallMode?he.indices:y1(Lt,yt);for(let Dt=0;Dt<gt.length;Dt+=3)this.footprintIndices.emplaceBack(Ot.vertexOffset+gt[Dt+0],Ot.vertexOffset+gt[Dt+1],Ot.vertexOffset+gt[Dt+2]),this.indexArray.emplaceBack(kt+gt[Dt],kt+gt[Dt+2],kt+gt[Dt+1]),zt.primitiveLength++;Ot.indexCount+=gt.length,Ot.vertexCount+=this.footprintVertices.length-Ot.vertexOffset}for(let Lt=0;Lt<Xe.length;Lt++){const yt=Xe[Lt];K.startRing(re,yt[0]);let gt=yt.length>4&&jz(yt[yt.length-2],yt[0],yt[1]),Dt=Be?ase(yt[yt.length-2],yt[0],yt[1],Be):0;const tn=[];let $t,Bn,pn;Bn=yt[1].sub(yt[0])._perp()._unit();let xn=!0;for(let Rn=1,Jr=0;Rn<yt.length;Rn++){let Zt=yt[Rn-1],Pn=yt[Rn];const Or=yt[Rn===yt.length-1?1:Rn+1];if(K.appendEdge(re,Pn,Zt),u6(Pn,Zt,vt)){Be&&(Bn=Or.sub(Pn)._perp()._unit(),xn=!xn);continue}const gi=Pn.sub(Zt)._perp(),Ei=gi.x/(Math.abs(gi.x)+Math.abs(gi.y)),jr=gi.y>0?1:0,hs=Zt.dist(Pn);if(Jr+hs>32768&&(Jr=0),Be){pn=Or.sub(Pn)._perp()._unit();let Ft=Fz(Zt,Pn,Or,zz(Bn,pn),Be);isNaN(Ft)&&(Ft=0);const ln=Pn.sub(Zt)._unit();Zt=Zt.add(ln.mult(Dt))._round(),Pn=Pn.add(ln.mult(-Ft))._round(),Dt=Ft,Bn=pn,ne&&this.zoom>=17&&(mt(tn,Zt)||tn.push(Zt),mt(tn,Pn)||tn.push(Pn))}const Se=zt.vertexLength,Ie=yt.length>4&&jz(Zt,Pn,Or);let bt=Uz(Jr,gt,xn);if(ow(this.layoutVertexArray,Zt.x,Zt.y,Ei,jr,0,0,bt),ow(this.layoutVertexArray,Zt.x,Zt.y,Ei,jr,0,1,bt),this.wallMode){const Ft=ge(Rn-1,yt),ln=he.joinNormals[Rn-1];lw(this.wallVertexArray,ln,Ft),lw(this.wallVertexArray,ln,Ft)}if(Jr+=hs,bt=Uz(Jr,Ie,!xn),gt=Ie,ow(this.layoutVertexArray,Pn.x,Pn.y,Ei,jr,0,0,bt),ow(this.layoutVertexArray,Pn.x,Pn.y,Ei,jr,0,1,bt),this.wallMode){const Ft=ge(Rn,yt),ln=he.joinNormals[Rn];lw(this.wallVertexArray,ln,Ft),lw(this.wallVertexArray,ln,Ft)}if(zt.vertexLength+=4,this.indexArray.emplaceBack(Se+0,Se+1,Se+2),this.indexArray.emplaceBack(Se+1,Se+3,Se+2),zt.primitiveLength+=2,Be){const Ft=kt+(Rn===1?yt.length-2:Rn-2),ln=Rn===1?kt:Ft+1;if(this.indexArray.emplaceBack(Se+1,Ft,Se+3),this.indexArray.emplaceBack(Ft,ln,Se+3),zt.primitiveLength+=2,$t===void 0&&($t=Se),!u6(Or,yt[Rn],vt)){const un=Rn===yt.length-1?$t:zt.vertexLength;this.indexArray.emplaceBack(Se+2,Se+3,un),this.indexArray.emplaceBack(Se+3,un+1,un),this.indexArray.emplaceBack(Se+3,ln,un+1),zt.primitiveLength+=3}xn=!xn}if(V){const Ft=this.layoutVertexExtArray,ln=z.projectTilePoint(Zt.x,Zt.y,_),un=z.projectTilePoint(Pn.x,Pn.y,_),Un=z.upVector(_,Zt.x,Zt.y),Yn=z.upVector(_,Pn.x,Pn.y);uw(Ft,ln,Un),uw(Ft,ln,Un),uw(Ft,un,Yn),uw(Ft,un,Yn)}}H&&(kt+=yt.length-1),ne&&Be&&this.zoom>=17&&(tn.length!==0&&mt(tn,tn[0])&&tn.pop(),this.groundEffect.addData(tn,vt,O,Be>0))}this.footprintSegments.push(Ot),Bt.triangleCount=this.indexArray.length-Bt.triangleArrayOffset,this.polygonSegments.push(Bt),++re.footprintSegLen,++re.polygonSegLen}if(re.vertexCount=this.layoutVertexArray.length-re.vertexArrayOffset,re.groundVertexCount=this.groundEffect.vertexArray.length-re.groundVertexArrayOffset,re.vertexCount!==0){if(re.centroidXY=K.borders?Rz:this.encodeCentroid(K,re),this.centroidData.push(re),K.borders){this.featuresOnBorder.push(K);const Xe=this.featuresOnBorder.length-1;for(let vt=0;vt<K.borders.length;vt++)K.borders[vt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[vt].push(Xe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,p,v,w,_,R,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(u,p,v,w,_,R,this.worldview),this.maxHeight=Math.max(this.maxHeight,ue)}}sortBorders(){for(let s=0;s<this.borderFeatureIndices.length;s++)this.borderFeatureIndices[s].sort((u,h)=>this.featuresOnBorder[u].borders[s][0]-this.featuresOnBorder[h].borders[s][0])}splitToSubtiles(){const s=[];for(let w=0;w<this.centroidData.length;w++){const A=this.centroidData[w],R=+(A.min.y+A.max.y>Jt),O=2*R+(+(A.min.x+A.max.x>Jt)^R);for(let D=0;D<A.polygonSegLen;D++){const z=A.polygonSegIdx+D;s.push({centroidIdx:w,subtile:O,polygonSegmentIdx:z,triangleSegmentIdx:this.polygonSegments[z].triangleSegIdx})}}const u=new to;s.sort((w,A)=>w.triangleSegmentIdx===A.triangleSegmentIdx?w.subtile-A.subtile:w.triangleSegmentIdx-A.triangleSegmentIdx);let h=0,p=0,_=0;for(const w of s){if(w.triangleSegmentIdx!==h)break;_++}const v=s.length;for(;p!==s.length;){h=s[p].triangleSegmentIdx;let w=0,A=p,R=p;for(let O=A;O<_&&s[O].subtile===w;O++)R++;for(;A!==_;){const O=s[A];w=O.subtile;const D=this.centroidData[O.centroidIdx].min.clone(),z=this.centroidData[O.centroidIdx].max.clone(),V={vertexOffset:this.segments.segments[h].vertexOffset,primitiveOffset:u.length,vertexLength:this.segments.segments[h].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let H=A;H<R;H++){const K=s[H],re=this.polygonSegments[K.polygonSegmentIdx],ne=this.centroidData[K.centroidIdx].min,ue=this.centroidData[K.centroidIdx].max,he=this.indexArray.uint16;for(let ge=re.triangleArrayOffset;ge<re.triangleArrayOffset+re.triangleCount;ge++)u.emplaceBack(he[3*ge],he[3*ge+1],he[3*ge+2]);V.primitiveLength+=re.triangleCount,D.x=Math.min(D.x,ne.x),D.y=Math.min(D.y,ne.y),z.x=Math.max(z.x,ue.x),z.y=Math.max(z.y,ue.y)}V.primitiveLength>0&&this.triangleSubSegments.push({segment:V,min:D,max:z}),A=R;for(let H=A;H<_&&s[H].subtile===s[A].subtile;H++)R++}p=_;for(let O=p;O<v&&s[O].triangleSegmentIdx===s[p].triangleSegmentIdx;O++)_++}u._trim(),this.indexArray=u}getVisibleSegments(s,u,h){const p=new da;if(this.wallMode){for(const K of this.triangleSubSegments)p.segments.push(K.segment);return p}let _=0,v=0;const w=1<<s.canonical.z;if(u){const K=u.getMinMaxForTile(s);K&&(_=K.min,v=K.max)}v+=this.maxHeight;const A=s.toUnwrapped();let R;const O=[A.canonical.x/w+A.wrap,A.canonical.y/w],D=[(A.canonical.x+1)/w+A.wrap,(A.canonical.y+1)/w],z=(K,re,ne)=>[K[0]*(1-ne[0])+re[0]*ne[0],K[1]*(1-ne[1])+re[1]*ne[1]],V=[],H=[];for(const K of this.triangleSubSegments){V[0]=K.min.x/Jt,V[1]=K.min.y/Jt,H[0]=K.max.x/Jt,H[1]=K.max.y/Jt;const re=z(O,D,V),ne=z(O,D,H);if(new Nn([re[0],re[1],_],[ne[0],ne[1],v]).intersectsPrecise(h)===0){R&&(p.segments.push(R),R=void 0);continue}const ue=K.segment;R&&R.vertexOffset!==ue.vertexOffset&&(p.segments.push(R),R=void 0),R?(R.vertexLength+=ue.vertexLength,R.primitiveLength+=ue.primitiveLength):R={vertexOffset:ue.vertexOffset,primitiveLength:ue.primitiveLength,vertexLength:ue.vertexLength,primitiveOffset:ue.primitiveOffset,sortKey:void 0,vaos:{}}}return R&&p.segments.push(R),p}encodeCentroid(s,u){const h=s.centroid(),p=u.span(),_=Math.min(7,Math.round(p.x*this.tileToMeter/10)),v=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new je(ee(h.x,1,Jt-1)<<3|_,ee(h.y,1,Jt-1)<<3|v)}encodeBorderCentroid(s){if(!s.borders)return new je(0,0);const u=s.borders,h=Number.MAX_VALUE;if(u[0][0]!==h||u[1][0]!==h){const p=u[0][0]!==h?0:1;return new je(6|(u[0][0]!==h?0:65528),(u[p][0]+u[p][1])/2<<3|6)}{const p=u[2][0]!==h?2:3;return new je((u[p][0]+u[p][1])/2<<3|6,6|(u[2][0]!==h?0:65528))}}showCentroid(s){const u=this.centroidData[s.centroidDataIndex];u.flags&=2147483647,u.centroidXY.x=0,u.centroidXY.y=0,this.writeCentroidToBuffer(u)}writeCentroidToBuffer(s){this.groundEffect.updateHiddenByLandmark(s);const u=s.vertexArrayOffset,h=s.vertexCount+s.vertexArrayOffset,p=s.flags&Qf?Rz:s.centroidXY,_=this.centroidVertexArray.geta_centroid_pos0(u);if(this.centroidVertexArray.geta_centroid_pos1(u)!==p.y||_!==p.x){for(let v=u;v<h;++v)this.centroidVertexArray.emplace(v,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const s of this.centroidData)this.writeCentroidToBuffer(s)}updateReplacement(s,u,h){if(u.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=u.updateTime;const p=u.getReplacementRegionsForTile(s.toUnwrapped());if(zS(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const v of this.centroidData)v.flags&=2147483647;const _=[];for(const v of this.activeReplacements){if(v.order<h)continue;const w=Math.max(1,Math.pow(2,v.footprintTileId.canonical.z-s.canonical.z));if(v.footprint.buildingIds)for(const A of this.centroidData)A.flags&Qf||v.min.x>A.max.x||A.min.x>v.max.x||v.min.y>A.max.y||A.min.y>v.max.y||v.footprint.buildingIds.has(A.buildingId)&&(A.flags|=Qf);else for(const A of this.centroidData)if(!(A.flags&Qf||v.min.x>A.max.x||A.min.x>v.max.x||v.min.y>A.max.y||A.min.y>v.max.y))for(let R=0;R<A.footprintSegLen;R++){const O=this.footprintSegments[A.footprintSegIdx+R];if(_.length=0,ose(this.footprintVertices,O.vertexOffset,O.vertexCount,v.footprintTileId.canonical,s.canonical,_),s6(v.footprint,_,this.footprintIndices.uint16,O.indexOffset,O.indexCount,-O.vertexOffset,-w)){A.flags|=Qf;break}}}for(const v of this.centroidData)this.writeCentroidToBuffer(v);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(s,u,h){let p=!1;for(let _=0;_<h.footprintSegLen;_++){const v=this.footprintSegments[h.footprintSegIdx+_];let w=0;for(const A of v.ringIndices){for(let R=w,O=A+w-1;R<A+w;O=R++){const D=this.footprintVertices.int16[2*(R+v.vertexOffset)+0],z=this.footprintVertices.int16[2*(R+v.vertexOffset)+1],V=this.footprintVertices.int16[2*(O+v.vertexOffset)+1];z>u!=V>u&&s<(this.footprintVertices.int16[2*(O+v.vertexOffset)+0]-D)*(u-z)/(V-z)+D&&(p=!p)}w=A}}return p}getHeightAtTileCoord(s,u){let h=Number.NEGATIVE_INFINITY,p=!0;const _=4*(s+Jt)*Jt+(u+Jt);if(this.partLookup.hasOwnProperty(_)){const v=this.partLookup[_];return v?{height:v.height,hidden:!!(v.flags&Qf)}:void 0}for(const v of this.centroidData)s>v.max.x||v.min.x>s||u>v.max.y||v.min.y>u||v.height<=h||this.footprintContainsPoint(s,u,v)&&(h=v.height,this.partLookup[_]=v,p=!!(v.flags&Qf));if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:p};this.partLookup[_]=void 0}}function zz(c,s){const u=c.add(s)._unit();return c.x*u.x+c.y*u.y}function ase(c,s,u,h){const p=s.sub(c)._perp()._unit(),_=u.sub(s)._perp()._unit();return Fz(c,s,u,zz(p,_),h)}function Fz(c,s,u,h,p){const _=Math.sqrt(1-h*h);return Math.min(c.dist(s)/3,s.dist(u)/3,p*_/h)}function u6(c,s,u){return c.x<u[0].x&&s.x<u[0].x||c.x>u[1].x&&s.x>u[1].x||c.y<u[0].y&&s.y<u[0].y||c.y>u[1].y&&s.y>u[1].y}function Bz(c,s){return c.x<s[0].x||c.x>s[1].x||c.y<s[0].y||c.y>s[1].y}function jz(c,s,u){if(c.x<0||c.x>=Jt||s.x<0||s.x>=Jt||u.x<0||u.x>=Jt)return!1;const h=u.sub(s),p=h.perp(),_=c.sub(s);return(h.x*_.x+h.y*_.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(_.x*_.x+_.y*_.y))>-.866&&p.x*_.x+p.y*_.y<0}function Uz(c,s,u){const h=s?2|c:-3&c;return u?1|h:-2&h}function Vz(){const c=Math.PI/32,s=Math.tan(c),u=m;return u*Math.sqrt(1+2*s*s)-u}function $z(c,s,u){const h=1<<u.z,p=j(u.x/h),_=j((u.x+1)/h),v=W(u.y/h),w=W((u.y+1)/h);return function(A,R,O,D,z=0,V){const H=[];if(!A.length||!O||!D)return H;const K=(Ee,Pe)=>{for(const Be of Ee)H.push({polygon:Be,bounds:Pe})},re=Math.ceil(Math.log2(O)),ne=Math.ceil(Math.log2(D)),ue=re-ne,he=[];for(let Ee=0;Ee<Math.abs(ue);Ee++)he.push(ue>0?0:1);for(let Ee=0;Ee<Math.min(re,ne);Ee++)he.push(0),he.push(1);let ge=A;if(ge=LS(ge,R[0].y-z,R[1].y+z,1),ge=LS(ge,R[0].x-z,R[1].x+z,0),!ge.length)return H;const ke=[];for(he.length?ke.push({polygons:ge,bounds:R,depth:0}):K(ge,R);ke.length;){const Ee=ke.pop(),Pe=Ee.depth,Be=he[Pe],$e=Ee.bounds[0],mt=Ee.bounds[1],Xe=Be===0?$e.x:$e.y,vt=Be===0?mt.x:mt.y,kt=V?V(Be,Xe,vt):.5*(Xe+vt),It=LS(Ee.polygons,Xe-z,kt+z,Be),zt=LS(Ee.polygons,kt-z,vt+z,Be);if(It.length){const Bt=[$e,new je(Be===0?kt:mt.x,Be===1?kt:mt.y)];he.length>Pe+1?ke.push({polygons:It,bounds:Bt,depth:Pe+1}):K(It,Bt)}if(zt.length){const Bt=[new je(Be===0?kt:$e.x,Be===1?kt:$e.y),mt];he.length>Pe+1?ke.push({polygons:zt,bounds:Bt,depth:Pe+1}):K(zt,Bt)}}return H}(c,s,Math.ceil((_-p)/11.25),Math.ceil((v-w)/11.25),1,(A,R,O)=>{if(A===0)return .5*(R+O);{const D=W((u.y+R/Jt)/h);return(M(.5*(W((u.y+O/Jt)/h)+D))*h-u.y)*Jt}})}function ose(c,s,u,h,p,_){const v=Math.pow(2,h.z-p.z);for(let w=0;w<u;w++){let A=c.int16[2*(w+s)+0],R=c.int16[2*(w+s)+1];A=(A+p.x*Jt)*v-h.x*Jt,R=(R+p.y*Jt)*v-h.y*Jt,_.push(new je(A,R))}}let Hz,Gz;En(BS,"FillExtrusionBucket",{omit:["layers","features"]}),En(Lz,"PartData"),En(Oz,"FootprintSegment"),En(Dz,"BorderCentroidData"),En(l6,"GroundEffect");class Ig extends je{constructor(s,u,h){super(s,u),this.z=h}}class qz extends Ig{constructor(s,u,h,p){super(s,u,h),this.w=p}}function Zz(c,s,u,h){const p=u==="x"?"y":"x",_=(h-c[u])/(s[u]-c[u]);c[p]=Math.round(c[p]+(s[p]-c[p])*_),c[u]=h,c.hasOwnProperty("z")&&(c.z=Tr(c.z,s.z,_)),c.hasOwnProperty("w")&&(c.w=Tr(c.w,s.w,_))}function Wz(c,s,u,h){const p=u,_=h;for(const v of["x","y"]){let w=c,A=s;w[v]>=A[v]&&(w=s,A=c),w[v]<p&&A[v]>p&&Zz(w,A,v,p),w[v]<_&&A[v]>_&&Zz(A,w,v,_)}}function jS(c,s,u,h,p,_){const v=[];for(let w=0;w<c.length;w++){const A=c[w];let R;const O=v.length;let D=0;for(let z=0;z<A.length-1;z++){let V=A[z],H=A[z+1],K=0;const re=D;let ne,ue;_&&(K=Math.hypot(H.x-V.x,H.y-V.y),D+=K,ne=V,ue=H),V.x<s&&H.x<s||(V.x<s?V=new je(s,V.y+(s-V.x)/(H.x-V.x)*(H.y-V.y))._round():H.x<s&&(H=new je(s,V.y+(s-V.x)/(H.x-V.x)*(H.y-V.y))._round()),V.y<u&&H.y<u||(V.y<u?V=new je(V.x+(u-V.y)/(H.y-V.y)*(H.x-V.x),u)._round():H.y<u&&(H=new je(V.x+(u-V.y)/(H.y-V.y)*(H.x-V.x),u)._round()),V.x>=h&&H.x>=h||(V.x>=h?V=new je(h,V.y+(h-V.x)/(H.x-V.x)*(H.y-V.y))._round():H.x>=h&&(H=new je(h,V.y+(h-V.x)/(H.x-V.x)*(H.y-V.y))._round()),V.y>=p&&H.y>=p||(V.y>=p?V=new je(V.x+(p-V.y)/(H.y-V.y)*(H.x-V.x),p)._round():H.y>=p&&(H=new je(V.x+(p-V.y)/(H.y-V.y)*(H.x-V.x),p)._round()),R&&V.equals(R[R.length-1])||(R=[V],v.push(R),_&&_.push({progress:{min:re+Xz(ne,ue,V)*K,max:1},parentIndex:w,prevPoint:ne,nextPoint:ue})),R.push(H),_&&(_[_.length-1].progress.max=re+Xz(ne,ue,H)*K,_[_.length-1].nextPoint=ue)))))}if(_&&D>0)for(let z=O;z<v.length;z++)_[z].progress.min/=D,_[z].progress.max/=D}return v}function lse(c,s,u,h,p){if(c.length<2)return void h.push(c);const _=[];for(;s.valid();){const[R,O]=s.get();for(let D=0;D<c.length-1;D++){const z=c[D],V=c[D+1],H=Gr(z,V,R,O);if(H){const[K]=H,re=new je(Tr(z.x,V.x,K),Tr(z.y,V.y,K));_.push({t:D+K,distance:0,point:re})}}s.next()}if(_.length===0)return void h.push(c);_.sort((R,O)=>R.t-O.t);let v=0,w=0,A=[];for(h.push(A);v!==c.length;){if(w===_.length){for(;v!==c.length;)A.length!==0&&A[A.length-1].equals(c[v])||A.push(c[v]),v++;break}_[w].t<=v?(A.length!==0&&A[A.length-1].equals(_[w].point)||A.push(_[w].point),Math.trunc(_[w].t),w++):(A.length!==0&&A[A.length-1].equals(c[v])||A.push(c[v]),v++)}}function Xz(c,s,u){return c.x!==s.x?(u.x-c.x)/(s.x-c.x):c.y!==s.y?(u.y-c.y)/(s.y-c.y):0}function cw(c,s){return c.x*s.x+c.y*s.y}function Yz(c,s){if(c.length===1){let u=0;const h=s[u++];let p;for(;!p||h.equals(p);)if(p=s[u++],!p)return 1/0;for(;u<s.length;u++){const _=s[u],v=c[0],w=p.sub(h),A=_.sub(h),R=v.sub(h),O=cw(w,w),D=cw(w,A),z=cw(A,A),V=cw(R,w),H=cw(R,A),K=O*z-D*D,re=(z*V-D*H)/K,ne=(O*H-D*V)/K,ue=h.z*(1-re-ne)+p.z*re+_.z*ne;if(isFinite(ue))return ue}return 1/0}{let u=1/0;for(const h of s)u=Math.min(u,h.z);return u}}function Kz(c,s,u){let h=1/0;Gi(u,s)&&(h=Yz(u,s[0]));for(let p=0;p<s.length;p++){const _=s[p],v=c[p];for(let w=0;w<_.length-1;w++){const A=_[w],R=[A,_[w+1],v[w+1],v[w],A];Di(u,R)&&(h=Math.min(h,Yz(u,R)))}}return h!==1/0&&h}function Qz(c,s,u,h,p,_,v,w,A,R,O){return c.projection.name==="globe"?function(D,z,V,H,K,re,ne,ue,he,ge,ke){const Ee=[],Pe=[],Be=D.projection.upVectorScale(ke,D.center.lat,D.worldSize).metersToTile,$e=[0,0,0,1],mt=[0,0,0,1],Xe=(kt,It,zt,Bt)=>{kt[0]=It,kt[1]=zt,kt[2]=Bt,kt[3]=1},vt=Vz();V>0&&(V+=vt),H+=vt;for(const kt of z){const It=[],zt=[];for(const Bt of kt){const Ot=Bt.x+K.x,Lt=Bt.y+K.y,yt=D.projection.projectTilePoint(Ot,Lt,ke),gt=D.projection.upVector(ke,Bt.x,Bt.y);let Dt=V,tn=H;if(ne){const $t=Jz(Ot,Lt,V,H,ne,ue,he,ge);Dt+=$t.base,tn+=$t.top}V!==0?Xe($e,yt.x+gt[0]*Be*Dt,yt.y+gt[1]*Be*Dt,yt.z+gt[2]*Be*Dt):Xe($e,yt.x,yt.y,yt.z),Xe(mt,yt.x+gt[0]*Be*tn,yt.y+gt[1]*Be*tn,yt.z+gt[2]*Be*tn),rn($e,$e,re),rn(mt,mt,re),It.push(new Ig($e[0],$e[1],$e[2])),zt.push(new Ig(mt[0],mt[1],mt[2]))}Ee.push(It),Pe.push(zt)}return[Ee,Pe]}(c,s,u,h,p,_,v,w,A,R,O):v?function(D,z,V,H,K,re,ne,ue,he){const ge=[],ke=[],Ee=[0,0,0,1];for(const Pe of D){const Be=[],$e=[];for(const mt of Pe){const Xe=mt.x+H.x,vt=mt.y+H.y,kt=Jz(Xe,vt,z,V,re,ne,ue,he);Ee[0]=Xe,Ee[1]=vt,Ee[2]=kt.base,Ee[3]=1,$i(Ee,Ee,K),Ee[3]=Math.max(Ee[3],1e-5);const It=new Ig(Ee[0]/Ee[3],Ee[1]/Ee[3],Ee[2]/Ee[3]);Ee[0]=Xe,Ee[1]=vt,Ee[2]=kt.top,Ee[3]=1,$i(Ee,Ee,K),Ee[3]=Math.max(Ee[3],1e-5);const zt=new Ig(Ee[0]/Ee[3],Ee[1]/Ee[3],Ee[2]/Ee[3]);Be.push(It),$e.push(zt)}ge.push(Be),ke.push($e)}return[ge,ke]}(s,u,h,p,_,v,w,A,R):function(D,z,V,H,K){const re=[],ne=[],ue=K[8]*z,he=K[9]*z,ge=K[10]*z,ke=K[11]*z,Ee=K[8]*V,Pe=K[9]*V,Be=K[10]*V,$e=K[11]*V;for(const mt of D){const Xe=[],vt=[];for(const kt of mt){const It=kt.x+H.x,zt=kt.y+H.y,Bt=K[0]*It+K[4]*zt+K[12],Ot=K[1]*It+K[5]*zt+K[13],Lt=K[2]*It+K[6]*zt+K[14],yt=K[3]*It+K[7]*zt+K[15],gt=Bt+ue,Dt=Ot+he,tn=Lt+ge,$t=Math.max(yt+ke,1e-5),Bn=Bt+Ee,pn=Ot+Pe,xn=Lt+Be,Rn=Math.max(yt+$e,1e-5);Xe.push(new Ig(gt/$t,Dt/$t,tn/$t)),vt.push(new Ig(Bn/Rn,pn/Rn,xn/Rn))}re.push(Xe),ne.push(vt)}return[re,ne]}(s,u,h,p,_)}function Jz(c,s,u,h,p,_,v,w){const A=v*p.getElevationAt(c,s,!0,!0),R=_[0]!==0,O=R?_[1]===0?v*(_[0]/Mz-Pz):v*function(D,z,V){const H=Math.floor(z[0]/8),K=Math.floor(z[1]/8),re=10*(z[0]-8*H),ne=10*(z[1]-8*K),ue=D.getElevationAt(H,K,!0,!0),he=D.getMeterToDEM(V),ge=Math.floor(.5*(re*he-1)),ke=Math.floor(.5*(ne*he-1)),Ee=D.tileCoordToPixel(H,K),Pe=2*ge+1,Be=2*ke+1,$e=function(zt,Bt,Ot,Lt,yt){return[zt.getElevationAtPixel(Bt,Ot,!0),zt.getElevationAtPixel(Bt+yt,Ot,!0),zt.getElevationAtPixel(Bt,Ot+yt,!0),zt.getElevationAtPixel(Bt+Lt,Ot+yt,!0)]}(D,Ee.x-ge,Ee.y-ke,Pe,Be),mt=Math.abs($e[0]-$e[1]),Xe=Math.abs($e[2]-$e[3]),vt=Math.abs($e[0]-$e[2])+Math.abs($e[1]-$e[3]),kt=Math.min(.25,.5*he*(mt+Xe)/Pe),It=Math.min(.25,.5*he*vt/Be);return ue+Math.max(kt*re,It*ne)}(p,_,w):A;return{base:A+(u===0?-1:u),top:R?Math.max(O+h,A+u+2):A+h}}class use{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class cse{constructor(){this.tasks={},this.taskQueue=[],Ze(["process"],this),this.invoker=new use(this.process),this.nextId=0}add(s,u){const h=this.nextId++,p=function({type:_,isSymbolTile:v,zoom:w}){return w=w||0,_==="message"?0:_!=="maybePrepare"||v?_!=="parseTile"||v?_==="parseTile"&&v?300-w:_==="maybePrepare"&&v?400-w:500:200-w:100-w}(u);if(p===0){try{s()}finally{}return null}return this.tasks[h]={fn:s,metadata:u,priority:p,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const s=this.pick();if(s===null)return;const u=this.tasks[s];if(delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),!u)return;u.fn()}finally{}}pick(){let s=null,u=1/0;for(let p=0;p<this.taskQueue.length;p++){const _=this.tasks[this.taskQueue[p]];_.priority<u&&(u=_.priority,s=p)}if(s===null)return null;const h=this.taskQueue[s];return this.taskQueue.splice(s,1),h}remove(){this.invoker.remove()}}class e7{constructor(s,u,h){this.target=s,this.parent=u,this.mapId=h,this.callbacks={},this.cancelCallbacks={},Ze(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new cse}send(s,u,h,p,_=!1,v){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(h.metadata=v,this.callbacks[w]=h);const A=new Set;return this.target.postMessage({id:w,type:s,hasCallback:!!h,targetMapId:p,mustQueue:_,sourceMapId:this.mapId,data:Dd(u,A)},A),{cancel:()=>{h&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(s){const u=s.data;if(!u)return;const h=u.id;if(h&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){const p=this.cancelCallbacks[h];delete this.cancelCallbacks[h],p&&p.cancel()}else if(u.mustQueue||ni(self)){const p=this.callbacks[h],_=this.scheduler.add(()=>this.processTask(h,u),p&&p.metadata||{type:"message"});_&&(this.cancelCallbacks[h]=_)}else this.processTask(h,u)}processTask(s,u){if(delete this.cancelCallbacks[s],u.type==="<response>"){const h=this.callbacks[s];delete this.callbacks[s],h&&(u.error?h(jh(u.error)):h(null,jh(u.data)))}else{const h=new Set,p=u.hasCallback?(v,w)=>{this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:v?Dd(v):null,data:Dd(w,h)},h)}:()=>{},_=jh(u.data);if(this.parent[u.type])this.parent[u.type](u.sourceMapId,_,p);else if(this.parent.getWorkerSource){const v=u.type.split("."),{source:w,scope:A}=_;this.parent.getWorkerSource(u.sourceMapId,v[0],w,A)[v[1]](_,p)}else p(new Error(`Could not find function ${u.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var dw={workerUrl:"",workerClass:null,workerParams:void 0};const c6="mapboxgl_preloaded_worker_pool";class Rg{constructor(s){this.active={},this.name=s}acquire(s,u=Rg.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<u;){const p=(h=`${this.name||""}WorkerPool: ${s}-${this.workers.length}`,dw.workerClass!=null?new dw.workerClass:new self.Worker(dw.workerUrl,Object.assign({name:h},dw.workerParams)));this.workers.push(p)}var h;return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.workers&&this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[c6]}numActive(){return Object.keys(this.active).length}}Rg.workerCount=2;class x1{constructor(s,u,h="Worker",p=Rg.workerCount){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=Ve();const _=this.workerPool.acquire(this.id,p);for(let v=0;v<_.length;v++){const w=new x1.Actor(_[v],u,this.id);w.name=`${h} ${v}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,u,h){Ne(this.actors,(p,_)=>{p.send(s,u,_)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}let hw,d6;function US(){return hw||(hw=new Rg),hw}x1.Actor=e7;const h6=4096;class dse{constructor(s){this.module=s,this.memoryStack=this.module.malloc(h6),this.memoryStackNextFree=this.memoryStack}createIntArray(s){const u=this.memoryStackNextFree;return this.memoryStackNextFree+=s.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>h6?-1:(new Int32Array(this.module.heap32.buffer,u,s.length).set(s),u)}createFloatArray(s){const u=this.memoryStackNextFree;return this.memoryStackNextFree+=s.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>h6?-1:(new Float32Array(this.module.heapF32.buffer,u,s.length).set(s),u)}readStringBuffer(s){let u="";for(;this.module.heapU8[s]!==0;)u+=String.fromCharCode(this.module.heapU8[s]),++s;return u}setStyle(s){const u=s.normalScale;this.module.setStyle(u[0],u[1],u[2],s.tileToMeters)}setAOOptions(s,u){this.module.setAOOptions(s?1:0,u)}setMetricOptions(s,u){this.module.setMetricOptions(s?1:0,u)}setStructuralOptions(s){this.module.setStructuralOptions(s?1:0)}setFacadeOptions(s,u){this.module.setFacadeOptions(s,u?1:0)}setFauxFacadeOptions(s,u,h){this.module.setFauxFacadeOptions(s?1:0,u?1:0,h)}setFacadeClassifierOptions(s){this.module.setFacadeClassifierOptions(s)}generateMesh(s,u){this.memoryStackNextFree=this.memoryStack;for(const w of s){const A=this.createIntArray(w.ringIndices),R=this.createFloatArray(w.coordinates);if(A===-1||R===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(w.id,w.sourceId,w.minHeight,w.height,w.roofType,R,A,w.ringIndices.length-1)}for(const w of u){let A;A=w.entrances?JSON.parse(w.entrances):[];const R=this.createFloatArray(A),O=this.createFloatArray(w.coordinates);if(R===-1||O===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(w.sourceId,w.crossPerc,w.distanceToRoad,R,A.length,O,w.coordinates.length)}if(!this.module.generateMesh()){const w=this.module.getLastError();return this.readStringBuffer(w)}const h=this.module.getMeshCount(),p=new Array(h);for(let w=0;w<h;w++){const A=this.module.getPositionsPtr(w),R=this.module.getPositionsLength(w),O=new Float32Array(this.module.heapF32.buffer,A,R),D=this.module.getNormalsPtr(w),z=this.module.getNormalsLength(w),V=new Float32Array(this.module.heapF32.buffer,D,z),H=this.module.getAOPtr(w),K=this.module.getAOLength(w),re=new Float32Array(this.module.heapF32.buffer,H,K),ne=this.module.getUVPtr(w),ue=this.module.getUVLength(w),he=new Float32Array(this.module.heapF32.buffer,ne,ue),ge=this.module.getFauxFacadePtr(w),ke=this.module.getFauxFacadeLength(w),Ee=new Uint8Array(this.module.heapU8.buffer,ge,ke),Pe=this.module.getIndicesPtr(w),Be=this.module.getIndicesLength(w),$e=new Int16Array(this.module.heap16.buffer,Pe,Be),mt=this.module.getBuildingPart(w);p[w]={positions:O,normals:V,ao:re,uv:he,isFauxFacade:Ee,indices:$e,buildingPart:mt}}const _=this.module.getRingCount(),v=[];for(let w=0;w<_;w++){const A=this.module.getRingPtr(w),R=this.module.getRingLength(w),O=new Float32Array(this.module.heapF32.buffer,A,R);v.push(O)}return{meshes:p,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:v}}}let fw,f6,Zd,b1,p6,w1=null,T1=null,t7=null,VS=null;function n7(){return ni(self)&&self.worker.dracoUrl?self.worker.dracoUrl:f6||ri.DRACO_URL}function r7(){if(ni(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(b1)return b1;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return b1=WebAssembly.validate(c)?ri.MESHOPT_SIMD_URL:ri.MESHOPT_URL,b1}function hse(){return VS}const $S={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},fse={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},pw={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function i7(c,s,u){const h=u.json.bufferViews.length,p=u.buffers.length;s.bufferView=h,u.json.bufferViews[h]={buffer:p,byteLength:c.byteLength},u.buffers[p]=c}const m6="KHR_draco_mesh_compression";function pse(c,s){const u=c.extensions&&c.extensions[m6];if(!u)return;const h=new Zd.Decoder,p=l7(s,u.bufferView),_=new Zd.Mesh;if(!h.DecodeArrayToMesh(p,p.byteLength,_))throw new Error("Failed to decode Draco mesh");const v=s.json.accessors[c.indices],w=$S[v.componentType],A=v.count*w.BYTES_PER_ELEMENT,R=Zd._malloc(A);w===Uint16Array?h.GetTrianglesUInt16Array(_,A,R):h.GetTrianglesUInt32Array(_,A,R),i7(Zd.memory.buffer.slice(R,R+A),v,s),Zd._free(R);for(const O of Object.keys(u.attributes)){const D=h.GetAttributeByUniqueId(_,u.attributes[O]),z=s.json.accessors[c.attributes[O]],V=fse[z.componentType],H=z.count*pw[z.type]*$S[z.componentType].BYTES_PER_ELEMENT,K=Zd._malloc(H);h.GetAttributeDataArrayForAllPoints(_,D,Zd[V],H,K),i7(Zd.memory.buffer.slice(K,K+H),z,s),Zd._free(K)}h.destroy(),_.destroy(),delete c.extensions[m6]}const HS="EXT_meshopt_compression";function mse(c,s){if(!c.extensions||!c.extensions[HS])return;const u=c.extensions[HS],h=new Uint8Array(s.buffers[u.buffer],u.byteOffset||0,u.byteLength||0),p=new Uint8Array(u.count*u.byteStride);p6.decodeGltfBuffer(p,u.count,u.byteStride,h,u.mode,u.filter),c.buffer=s.buffers.length,c.byteOffset=0,s.buffers[c.buffer]=p.buffer,delete c.extensions[HS]}const s7=1179937895,a7=new TextDecoder("utf8");function o7(c,s){return new URL(c,s).href}function gse(c,s,u,h){return fetch(o7(c.uri,h)).then(p=>p.arrayBuffer()).then(p=>{s.buffers[u]=p})}function l7(c,s){const u=c.json.bufferViews[s];return new Uint8Array(c.buffers[u.buffer],u.byteOffset||0,u.byteLength)}function _se(c,s,u,h){if(c.uri){const p=o7(c.uri,h);return fetch(p).then(_=>_.blob()).then(_=>createImageBitmap(_)).then(_=>{s.images[u]=_})}if(c.bufferView!==void 0){const p=l7(s,c.bufferView),_=new Blob([p],{type:c.mimeType});return createImageBitmap(_).then(v=>{s.images[u]=v})}}function u7(c,s=0,u){const h={json:null,images:[],buffers:[]};if(new Uint32Array(c,s,1)[0]===s7){const O=new Uint32Array(c,s);let D=2;const z=(O[D++]>>2)-3,V=O[D++]>>2;if(D++,h.json=JSON.parse(a7.decode(O.subarray(D,D+V))),D+=V,D<z){const H=O[D++];D++;const K=s+(D<<2);h.buffers[0]=c.slice(K,K+H)}}else h.json=JSON.parse(a7.decode(new Uint8Array(c,s)));const{buffers:p,images:_,meshes:v,extensionsUsed:w,bufferViews:A}=h.json;let R=Promise.resolve();if(p){const O=[];for(let D=0;D<p.length;D++){const z=p[D];z.uri?O.push(gse(z,h,D,u)):h.buffers[D]||(h.buffers[D]=null)}R=Promise.all(O)}return R.then(()=>{const O=[],D=w&&w.includes(m6),z=w&&w.includes(HS);if(D&&O.push(function(){if(!Zd)return fw??(fw=function(V){let H,K=null;function re(){H=new Uint8Array(K.buffer)}function ne(){throw new Error("Unexpected Draco error.")}const ue={a:{a:ne,d:function(he,ge,ke){return H.copyWithin(he,ge,ge+ke)},c:function(he){const ge=H.length,ke=Math.max(he>>>0,Math.ceil(1.2*ge)),Ee=Math.ceil((ke-ge)/65536);try{return K.grow(Ee),re(),!0}catch{return!1}},b:ne}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(V,ue):V.then(he=>he.arrayBuffer()).then(he=>WebAssembly.instantiate(he,ue))).then(he=>{const{Rb:ge,Qb:ke,P:Ee,T:Pe,X:Be,Ja:$e,La:mt,Qa:Xe,Va:vt,Wa:kt,eb:It,jb:zt,f:Bt,e:Ot,yb:Lt,zb:yt,Ab:gt,Bb:Dt,Db:tn,Gb:$t}=he.instance.exports;K=Ot;const Bn=(()=>{let pn=0,xn=0,Rn=0,Jr=0;return Zt=>{Rn&&(ge(Jr),ge(pn),xn+=Rn,Rn=pn=0),pn||(xn+=128,pn=ke(xn));const Pn=Zt.length+7&-8;let Or=pn;Pn>=xn&&(Rn=Pn,Or=Jr=ke(Pn));for(let gi=0;gi<Zt.length;gi++)H[Or+gi]=Zt[gi];return Or}})();return re(),Bt(),{memory:Ot,_free:ge,_malloc:ke,Mesh:class{constructor(){this.ptr=Ee()}destroy(){Pe(this.ptr)}},Decoder:class{constructor(){this.ptr=$e()}destroy(){zt(this.ptr)}DecodeArrayToMesh(pn,xn,Rn){const Jr=Bn(pn),Zt=mt(this.ptr,Jr,xn,Rn.ptr);return!!Be(Zt)}GetAttributeByUniqueId(pn,xn){return{ptr:Xe(this.ptr,pn.ptr,xn)}}GetTrianglesUInt16Array(pn,xn,Rn){vt(this.ptr,pn.ptr,xn,Rn)}GetTrianglesUInt32Array(pn,xn,Rn){kt(this.ptr,pn.ptr,xn,Rn)}GetAttributeDataArrayForAllPoints(pn,xn,Rn,Jr,Zt){It(this.ptr,pn.ptr,xn.ptr,Rn,Jr,Zt)}},DT_INT8:Lt(),DT_UINT8:yt(),DT_INT16:gt(),DT_UINT16:Dt(),DT_UINT32:tn(),DT_FLOAT32:$t()}})}(fetch(n7())),fw.then(V=>{Zd=V,fw=void 0}))}()),z&&O.push(function(){if(p6)return;const V=function(H){let K;const re=WebAssembly.instantiateStreaming(H,{}).then(he=>{K=he.instance,K.exports.__wasm_call_ctors()}),ne={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ue={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:re,supported:!0,decodeGltfBuffer(he,ge,ke,Ee,Pe,Be){(function($e,mt,Xe,vt,kt,It,zt){const Bt=$e.exports.sbrk,Ot=vt+3&-4,Lt=Bt(Ot*kt),yt=Bt(It.length),gt=new Uint8Array($e.exports.memory.buffer);gt.set(It,yt);const Dt=mt(Lt,vt,kt,yt,It.length);if(Dt===0&&zt&&zt(Lt,Ot,kt),Xe.set(gt.subarray(Lt,Lt+vt*kt)),Bt(Lt-Bt(0)),Dt!==0)throw new Error(`Malformed buffer data: ${Dt}`)})(K,K.exports[ue[Pe]],he,ge,ke,Ee,K.exports[ne[Be]])}}}(fetch(r7()));return V.ready.then(()=>{p6=V})}()),_)for(let V=0;V<_.length;V++)O.push(_se(_[V],h,V,u));return(O.length?Promise.all(O):Promise.resolve()).then(()=>{if(D&&v)for(const{primitives:V}of v)for(const H of V)pse(H,h);if(z&&v&&A)for(const V of A)mse(V,h);return h})})}function c7(c){return fetch(c).then(s=>s.arrayBuffer()).then(s=>u7(s,0,c))}function g6(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function _6(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class y6{constructor(s,u,h,p){this.context=s,this.format=h,this.useMipmap=p&&p.useMipmap,this.texture=s.gl.createTexture(),this.update(u,{premultiply:p&&p.premultiply})}update(s,u){const h=s&&s instanceof HTMLVideoElement&&s.width===0?s.videoWidth:s.width,p=s&&s instanceof HTMLVideoElement&&s.height===0?s.videoHeight:s.height,{context:_}=this,{gl:v}=_,{x:w,y:A}=u&&u.position?u.position:{x:0,y:0},R=w+h,O=A+p;!this.size||this.size[0]===R&&this.size[1]===O||(v.bindTexture(v.TEXTURE_2D,null),v.deleteTexture(this.texture),this.texture=v.createTexture(),this.size=null),v.bindTexture(v.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA8&&(!u||u.premultiply!==!1));const D=s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||ImageBitmap&&s instanceof ImageBitmap;if(!this.size&&R>0&&O>0){const z=this.useMipmap?Math.floor(Math.log2(Math.max(R,O)))+1:1;v.texStorage2D(v.TEXTURE_2D,z,this.format,R,O),this.size=[R,O]}this.size&&(D?v.texSubImage2D(v.TEXTURE_2D,0,w,A,g6(this.format),_6(this.format),s):"data"in s&&s.data&&v.texSubImage2D(v.TEXTURE_2D,0,w,A,h,p,g6(this.format),_6(this.format),s.data)),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(s,u,h=!1){const{context:p}=this,{gl:_}=p;_.bindTexture(_.TEXTURE_2D,this.texture),s!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,s),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap&&!h?s===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),u!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,u),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,u),this.wrapS=u)}bindExtraParam(s,u,h,p,_){const{context:v}=this,{gl:w}=v;w.bindTexture(w.TEXTURE_2D,this.texture),u!==this.magFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,u),this.magFilter=u),s!==this.minFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,this.useMipmap?s===w.NEAREST?w.NEAREST_MIPMAP_NEAREST:w.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),h!==this.wrapS&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,h),this.wrapS=h),p!==this.wrapT&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,p),this.wrapT=p),_!==this.compareMode&&(_?(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.COMPARE_REF_TO_TEXTURE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_FUNC,_)):w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.NONE),this.compareMode=_)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}class mw{constructor(s,u){this.context=s,this.texture=u}bind(s,u){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),s!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,s),this.minFilter=s),u!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,u),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,u),this.wrapS=u)}}const yse=hi([{name:"a_pos_3f",components:3,type:"Float32"}]),vse=hi([{name:"a_color_3f",components:3,type:"Float32"}]),xse=hi([{name:"a_color_4f",components:4,type:"Float32"}]),bse=hi([{name:"a_uv_2f",components:2,type:"Float32"}]),wse=hi([{name:"a_normal_3f",components:3,type:"Float32"}]),Tse=hi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Ese=hi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function d7(c,s){const u=GS(c.projection,c.zoom,c.width,c.height),h=function(_,v,w,A,R){const O=new d(w.lng-180*_m,w.lat),D=new d(w.lng+180*_m,w.lat),z=_.project(O.lng,O.lat),V=_.project(D.lng,D.lat),H=-Math.atan2(V.y-z.y,V.x-z.x),K=pe.fromLngLat(w);K.y=ee(K.y,-1+_m,1-_m);const re=K.toLngLat(),ne=_.project(re.lng,re.lat),ue=pe.fromLngLat(re);ue.x+=_m;const he=ue.toLngLat(),ge=_.project(he.lng,he.lat),ke=f7(ge.x-ne.x,ge.y-ne.y,H),Ee=pe.fromLngLat(re);Ee.y+=_m;const Pe=Ee.toLngLat(),Be=_.project(Pe.lng,Pe.lat),$e=f7(Be.x-ne.x,Be.y-ne.y,H),mt=Math.abs(ke.x)/Math.abs($e.y),Xe=q([]);be(Xe,Xe,-H*(1-(R?0:A)));const vt=q([]);return ie(vt,vt,[1,1-(1-mt)*A,1]),vt[4]=-$e.x/$e.y*A,be(vt,vt,H),$(vt,Xe,vt),vt}(c.projection,0,c.center,u,s),p=h7(c);return ie(h,h,[p,p,1]),h}function h7(c){const s=c.projection,u=GS(c.projection,c.zoom,c.width,c.height),h=v6(s,c.center),p=v6(s,d.convert(s.center));return Math.pow(2,h*u+(1-u)*p)}function GS(c,s,u,h,p=1/0){const _=c.range;if(!_)return 0;const v=Math.min(p,Math.max(u,h)),w=Math.log2(v/1024);return le(_[0]+w,_[1]+w,s)}const _m=1/4e4;function v6(c,s){const u=ee(s.lat,-Y,Y),h=new d(s.lng-180*_m,u),p=new d(s.lng+180*_m,u),_=c.project(h.lng,u),v=c.project(p.lng,u),w=pe.fromLngLat(h),A=pe.fromLngLat(p),R=v.x-_.x,O=v.y-_.y,D=A.x-w.x,z=A.y-w.y,V=Math.sqrt((D*D+z*z)/(R*R+O*O));return Math.log2(V)}function f7(c,s,u){const h=Math.cos(u),p=Math.sin(u);return{x:c*h-s*p,y:c*p+s*h}}function p7(c,s,u){q(c),be(c,c,cn(s[2])),de(c,c,cn(s[0])),fe(c,c,cn(s[1])),ie(c,c,u),$(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function qS(c,s,u,h,p,_,v,w){const A=[u[0]-s[0],u[1]-s[1],0],R=[h[0]-s[0],h[1]-s[1],0];if(Nt(A)<1e-12||Nt(R)<1e-12)return Kt(c);const O=Sn([],A,R);qt(O,O),pt(R,h,s),A[2]=(_-p)*w,R[2]=(v-p)*w;const D=A;return Sn(D,A,R),qt(D,D),Qn(c,O,D)}function ZS(c,s,u=!1){const h=mm(s.zoom),p=function(_,v,w){const A=v.worldSize,R=[_[12],_[13],_[14]],O=W(R[1]/A),D=j(R[0]/A),z=q([]),V=N(1,O)*A,H=N(1,0)*A*J(O,v.zoom),K=1/WI(A);let re=H*K;if(w){const ge=GS(v.projection,v.zoom,v.width,v.height,1024);re=K*v.projection.pixelSpaceConversion(v.center.lat,A,ge)}const ne=hm(O,D);nt(ne,ne,Fe([],qt([],ne),V*re*R[2]));const ue=function(ge){const ke=[ge[0],ge[1],ge[2]];let Ee=[0,1,0];const Pe=Sn([],Ee,ke);return Sn(Ee,ke,Pe),zn(Ee)===0&&(Ee=[0,1,0],Sn(Pe,ke,Ee)),qt(Pe,Pe),qt(Ee,Ee),qt(ke,ke),[Pe[0],Pe[1],Pe[2],0,Ee[0],Ee[1],Ee[2],0,ke[0],ke[1],ke[2],0,ge[0],ge[1],ge[2],1]}(ne);ie(z,z,[re,re,re*V]),X(z,z,[-R[0],-R[1],-R[2]]);const he=$([],v.globeMatrix,ue);return $(he,he,z),$(he,he,_),he}(c,s,u);if(h>0){const _=function(v,w){const A=w.worldSize,R=N(1,0)*A*J(w.center.lat,w.zoom)/WI(A),O=N(1,w.center.lat)*A,D=q([]);fe(D,D,cn(w.center.lng)),de(D,D,cn(w.center.lat)),X(D,D,[0,0,sl]),ie(D,D,[R,R,R*O]);const z=w.point;return X(D,D,[-z.x,-z.y,0]),$(D,D,v),$(D,w.globeMatrix,D)}(c,s);return function(v,w,A){const R=(H,K,re)=>{const ne=Nt(H),ue=Nt(K),he=qd(H,K,re);return Fe(he,he,1/Nt(he)*Tr(ne,ue,re))},O=R([v[0],v[1],v[2]],[w[0],w[1],w[2]],A),D=R([v[4],v[5],v[6]],[w[4],w[5],w[6]],A),z=R([v[8],v[9],v[10]],[w[8],w[9],w[10]],A),V=qd([v[12],v[13],v[14]],[w[12],w[13],w[14]],A);return[O[0],O[1],O[2],0,D[0],D[1],D[2],0,z[0],z[1],z[2],0,V[0],V[1],V[2],1]}(p,_,h)}return p}function x6(c,s,u,h){const p=Nn.projectAabbCorners(h,u);let _=Number.MAX_VALUE;for(let w=0;w<p.length;++w){const A=p[w];A[0]=(.5*A[0]+.5)*s.width,A[1]=(.5-.5*A[1])*s.height,A[2]<_&&(_=A[2])}const v=function(w){const A=[];let R=0;for(let V=1;V<w.length;V++)(w[V][0]<w[R][0]||w[V][0]===w[R][0]&&w[V][1]<w[R][1])&&(R=V);let O,D=R;const z=new Uint8Array(w.length);do{if(z[D])break;A.push(new je(w[D][0],w[D][1])),z[D]=1,O=(D+1)%w.length;for(let V=0;V<w.length;V++){if(w[V][0]===w[O][0]&&w[V][1]===w[O][1]||w[V][0]===w[D][0]&&w[V][1]===w[D][1])continue;const H=[w[V][0]-w[D][0],w[V][1]-w[D][1]],K=[w[O][0]-w[D][0],w[O][1]-w[D][1]],re=H[0]*K[1]-H[1]*K[0];(re>0||re===0&&H[0]*K[0]+H[1]*K[1]>=0&&H[0]*H[0]+H[1]*H[1]>K[0]*K[0]+K[1]*K[1])&&(O=V)}D=O}while(D!==R);return A.length>0&&A.push(A[0]),A}(p);if(Di(c,v))return _}const Mg=64,E1={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function WS(c,s,u,h,p,_,v,w,A,R=!1){const O=u.zoom,D=u.project(h),z=J(h.lat,O),V=1/z;q(c),X(c,c,[D.x+v[0]*V,D.y+v[1]*V,v[2]]);let H=1,K=1;const re=u.worldSize;if(R){if(u.projection.name==="mercator"){let ge=0;u.elevation&&(ge=u.elevation.getAtPointOrZero(new pe(D.x/re,D.y/re),0));const ke=$i([],[D.x,D.y,ge,1],u.projMatrix)[3]/u.cameraToCenterDistance;H=ke,K=ke*J(u.center.lat,O)}else if(u.projection.name==="globe"){const ge=ZS(c,u),ke=[0,0,0,1];$i(ke,ke,$([],u.projMatrix,ge));const Ee=ke[3]/u.cameraToCenterDistance,Pe=mm(O),Be=u.projection.pixelsPerMeter(h.lat,re)*J(h.lat,O),$e=u.projection.pixelsPerMeter(u.center.lat,re)*J(u.center.lat,O);H=Ee/Tr(Be,te(u.center.lat),Pe),K=Ee*z/Be,H*=$e,K*=$e}}else H=V;ie(c,c,[H,H,K]);const ne=[...c],ue=s.orientation,he=[];if(p7(he,[ue[0]+(p?p[0]:0),ue[1]+(p?p[1]:0),ue[2]+(p?p[2]:0)],_),$(c,ne,he),w&&u.elevation){let ge=0;const ke=[];if(A&&u.elevation){ge=function(Pe,Be,$e,mt,Xe){const vt=Be.elevation;if(!vt)return 0;const kt=Nn.projectAabbCorners($e,mt),It=N(1,Xe.lat)*Be.worldSize,zt=function(xn,Rn){const Jr=[0,0,1],Zt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Pn of Zt){const Or=xn[Pn.corners[0]],gi=xn[Pn.corners[1]],Ei=xn[Pn.corners[2]],jr=[gi[0]-Or[0],gi[1]-Or[1],Rn*(gi[2]-Or[2])],hs=Sn(jr,jr,[Ei[0]-Or[0],Ei[1]-Or[1],Rn*(Ei[2]-Or[2])]);qt(hs,hs),Pn.dotProductWithUp=wn(hs,Jr)}return Zt.sort((Pn,Or)=>Pn.dotProductWithUp-Or.dotProductWithUp),Zt[0].corners}(kt,It),Bt=kt[zt[0]],Ot=kt[zt[1]],Lt=kt[zt[2]],yt=kt[zt[3]],gt=vt.getAtPointOrZero(new pe(Bt[0]/Be.worldSize,Bt[1]/Be.worldSize),0),Dt=vt.getAtPointOrZero(new pe(Ot[0]/Be.worldSize,Ot[1]/Be.worldSize),0),tn=vt.getAtPointOrZero(new pe(Lt[0]/Be.worldSize,Lt[1]/Be.worldSize),0),$t=vt.getAtPointOrZero(new pe(yt[0]/Be.worldSize,yt[1]/Be.worldSize),0),Bn=(gt+$t)/2,pn=(Dt+tn)/2;return Bn>pn?Dt<tn?qS(Pe,Ot,yt,Bt,Dt,$t,gt,It):qS(Pe,Lt,Bt,yt,tn,gt,$t,It):gt<$t?qS(Pe,Bt,Ot,Lt,gt,Dt,tn,It):qS(Pe,yt,Lt,Ot,$t,tn,Dt,It),Math.max(Bn,pn)}(ke,u,s.aabb,c,h);const Ee=$([],rt([],ke),he);$(c,ne,Ee)}else ge=u.elevation.getAtPointOrZero(new pe(D.x/re,D.y/re),0);ge!==0&&(c[14]+=ge)}}class m7{constructor(s,u,h,p,_){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=s,this.uri=u,this.position=h!=null?new d(h[0],h[1]):new d(0,0),this.orientation=p??[0,0,0],this.nodes=_,this.uploaded=!1,this.aabb=new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(s,u){$(s.globalMatrix,u,s.localMatrix);const h=this.nodeOverrides.get(s.name);if(h!==void 0){const v=[];_=h.orientation,q(p=v),fe(p,p,cn(_[1])),be(p,p,cn(_[2])),de(p,p,cn(_[0])),$(s.globalMatrix,s.globalMatrix,v)}var p,_;if(s.meshes)for(const v of s.meshes){const w=Nn.applyTransformFast(v.aabb,s.globalMatrix);this.aabb.encapsulate(w)}if(s.children)for(const v of s.children)this._applyTransformations(v,s.globalMatrix)}computeBoundsAndApplyParent(){const s=q([]);this.aabb=new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.nodes)this._applyTransformations(u,s)}computeModelMatrix(s,u,h,p,_,v,w=!1){WS(this.matrix,this,s.transform,this.position,u,h,p,_,v,w)}upload(s){if(!this.uploaded){for(const u of this.nodes)b6(u,s);for(const u of this.nodes)XS(u);this.uploaded=!0}}destroy(){for(const s of this.nodes)w6(s)}}function gw(c,s,u=!1){c.uploaded||(c.gfxTexture=new y6(s,c.image,u?s.gl.R8:s.gl.RGBA8,{useMipmap:c.sampler.minFilter>=s.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function Sse(c,s,u){c.indexBuffer=s.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=s.createVertexBuffer(c.vertexArray,yse.members,!1,!0),c.normalArray&&(c.normalBuffer=s.createVertexBuffer(c.normalArray,wse.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=s.createVertexBuffer(c.texcoordArray,bse.members,!1,!0)),c.colorArray&&(c.colorBuffer=s.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?vse:xse).members,!1,!0)),c.featureArray&&(c.pbrBuffer=s.createVertexBuffer(c.featureArray,Ese.members,!0)),c.segments=da.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const h=c.material;h.pbrMetallicRoughness.baseColorTexture&&gw(h.pbrMetallicRoughness.baseColorTexture,s),h.pbrMetallicRoughness.metallicRoughnessTexture&&gw(h.pbrMetallicRoughness.metallicRoughnessTexture,s),h.normalTexture&&gw(h.normalTexture,s),h.occlusionTexture&&gw(h.occlusionTexture,s,u),h.emissionTexture&&gw(h.emissionTexture,s)}function b6(c,s,u){if(c.meshes)for(const h of c.meshes)Sse(h,s,u);if(c.children)for(const h of c.children)b6(h,s,u)}function XS(c){if(c.meshes)for(const s of c.meshes)s.indexArray.destroy(),s.vertexArray.destroy(),s.colorArray&&s.colorArray.destroy(),s.normalArray&&s.normalArray.destroy(),s.texcoordArray&&s.texcoordArray.destroy(),s.featureArray&&s.featureArray.destroy();if(c.children)for(const s of c.children)XS(s)}function w6(c){if(c.meshes)for(const u of c.meshes)u.vertexBuffer&&(u.vertexBuffer.destroy(),u.indexBuffer.destroy(),u.normalBuffer&&u.normalBuffer.destroy(),u.texcoordBuffer&&u.texcoordBuffer.destroy(),u.colorBuffer&&u.colorBuffer.destroy(),u.pbrBuffer&&u.pbrBuffer.destroy(),u.segments.destroy(),u.material&&((s=u.material).pbrMetallicRoughness.baseColorTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),s.pbrMetallicRoughness.metallicRoughnessTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),s.normalTexture&&s.normalTexture.gfxTexture&&s.normalTexture.gfxTexture.destroy(),s.emissionTexture&&s.emissionTexture.gfxTexture&&s.emissionTexture.gfxTexture.destroy(),s.occlusionTexture&&s.occlusionTexture.gfxTexture&&s.occlusionTexture.gfxTexture.destroy()));var s;if(c.children)for(const u of c.children)w6(u)}function Pg(c,s){const u=c.json.bufferViews[s.bufferView],h=$S[s.componentType];return new h(c.buffers[u.buffer],(s.byteOffset||0)+(u.byteOffset||0),s.count*(u.byteStride&&u.byteStride!==pw[s.type]*h.BYTES_PER_ELEMENT?u.byteStride/h.BYTES_PER_ELEMENT:pw[s.type]))}function T6(c,s,u,h){const p=$S[s.componentType],_=function(O){switch(O){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),v=c.json.bufferViews[s.bufferView],w=v.byteStride?v.byteStride/p.BYTES_PER_ELEMENT:pw[s.type],A=u.float32,R=A.length/u.capacity;for(let O=0,D=0;O<s.count*w;O+=w,D+=R)for(let z=0;z<R;z++)A[D+z]=h[O+z]*_;u._trim()}function Ase(c,s,u){const h=c.indices,p=c.attributes,_={};_.indexArray=new to;const v=s.json.accessors[h],w=v.count/3;_.indexArray.reserve(w);const A=Pg(s,v);for(let z=0;z<w;z++)_.indexArray.emplaceBack(A[3*z],A[3*z+1],A[3*z+2]);_.indexArray._trim(),_.vertexArray=new vu;const R=s.json.accessors[p.POSITION];_.vertexArray.reserve(R.count);const O=Pg(s,R);for(let z=0;z<R.count;z++)_.vertexArray.emplaceBack(O[3*z],O[3*z+1],O[3*z+2]);if(_.vertexArray._trim(),_.aabb=new Nn(R.min,R.max),_.centroid=function(z,V){const H=[0,0,0],K=z.length;if(K>0){for(let re=0;re<K;re++){const ne=3*z[re];H[0]+=V[ne],H[1]+=V[ne+1],H[2]+=V[ne+2]}H[0]/=K,H[1]/=K,H[2]/=K}return H}(A,O),p.COLOR_0!==void 0){const z=s.json.accessors[p.COLOR_0],V=pw[z.type],H=Pg(s,z);_.colorArray=V===3?new vu:new Vh,_.colorArray.resize(z.count),T6(s,z,_.colorArray,H)}if(p.NORMAL!==void 0){_.normalArray=new vu;const z=s.json.accessors[p.NORMAL];_.normalArray.resize(z.count);const V=Pg(s,z);T6(s,z,_.normalArray,V)}if(p.TEXCOORD_0!==void 0&&u.length>0){_.texcoordArray=new sd;const z=s.json.accessors[p.TEXCOORD_0];_.texcoordArray.resize(z.count);const V=Pg(s,z);T6(s,z,_.texcoordArray,V)}if(p._FEATURE_ID_RGBA4444!==void 0){const z=s.json.accessors[p._FEATURE_ID_RGBA4444];s.json.extensionsUsed&&s.json.extensionsUsed.includes("EXT_meshopt_compression")&&(_.featureData=Pg(s,z))}p._FEATURE_RGBA4444!==void 0&&(_.featureData=new Uint32Array(Pg(s,s.json.accessors[p._FEATURE_RGBA4444]).buffer));const D=c.material;return _.material=function(z,V){const{emissiveFactor:H=[0,0,0],alphaMode:K="OPAQUE",alphaCutoff:re=.5,normalTexture:ne,occlusionTexture:ue,emissiveTexture:he,doubleSided:ge,name:ke}=z,{baseColorFactor:Ee=[1,1,1,1],metallicFactor:Pe=1,roughnessFactor:Be=1,baseColorTexture:$e,metallicRoughnessTexture:mt}=z.pbrMetallicRoughness||{},Xe=ue?V[ue.index]:void 0;if(ue&&ue.extensions&&ue.extensions.KHR_texture_transform&&Xe){const vt=ue.extensions.KHR_texture_transform;Xe.offsetScale=[vt.offset[0],vt.offset[1],vt.scale[0],vt.scale[1]]}return{name:ke,pbrMetallicRoughness:{baseColorFactor:new ts(...Ee),metallicFactor:Pe,roughnessFactor:Be,baseColorTexture:$e?V[$e.index]:void 0,metallicRoughnessTexture:mt?V[mt.index]:void 0},doubleSided:ge,emissiveFactor:new ts(...H),alphaMode:K,alphaCutoff:re,normalTexture:ne?V[ne.index]:void 0,occlusionTexture:Xe,emissionTexture:he?V[he.index]:void 0,defined:z.defined===void 0}}(D!==void 0?s.json.materials[D]:{defined:!1},u),_}function g7(c,s,u){const{matrix:h,rotation:p,translation:_,scale:v,mesh:w,extras:A,children:R,name:O}=c,D={};if(D.name=O,D.localMatrix=h||function(z,V,H,K){var re=V[0],ne=V[1],ue=V[2],he=V[3],ge=re+re,ke=ne+ne,Ee=ue+ue,Pe=re*ge,Be=re*ke,$e=re*Ee,mt=ne*ke,Xe=ne*Ee,vt=ue*Ee,kt=he*ge,It=he*ke,zt=he*Ee,Bt=K[0],Ot=K[1],Lt=K[2];return z[0]=(1-(mt+vt))*Bt,z[1]=(Be+zt)*Bt,z[2]=($e-It)*Bt,z[3]=0,z[4]=(Be-zt)*Ot,z[5]=(1-(Pe+vt))*Ot,z[6]=(Xe+kt)*Ot,z[7]=0,z[8]=($e+It)*Lt,z[9]=(Xe-kt)*Lt,z[10]=(1-(Pe+mt))*Lt,z[11]=0,z[12]=H[0],z[13]=H[1],z[14]=H[2],z[15]=1,z}([],p||[0,0,0,1],_||[0,0,0],v||[1,1,1]),D.globalMatrix=U(D.localMatrix),w!==void 0){D.meshes=u[w];const z=D.anchor=[0,0];for(const V of D.meshes){const{min:H,max:K}=V.aabb;z[0]+=H[0]+K[0],z[1]+=H[1]+K[1]}z[0]=Math.floor(z[0]/D.meshes.length/2),z[1]=Math.floor(z[1]/D.meshes.length/2)}if(A&&(A.id&&(D.id=A.id),A.lights&&(D.lights=function(z){if(!z.length)return[];const V=function(ue){const he=atob(ue),ge=new Uint8Array(he.length);for(let ke=0;ke<he.length;ke++)ge[ke]=he.codePointAt(ke);return ge}(z),H=[],K=V.length/24,re=new Uint16Array(V.buffer),ne=new Float32Array(V.buffer);for(let ue=0;ue<K;ue++){const he=re[2*ue*6]/30,ge=re[2*ue*6+1]/30,ke=re[2*ue*6+10]/100,Ee=ne[6*ue+1],Pe=ne[6*ue+2],Be=ne[6*ue+3],$e=ne[6*ue+4],mt=Be-Ee,Xe=$e-Pe,vt=Math.hypot(mt,Xe);H.push({pos:[Ee+.5*mt,Pe+.5*Xe,ge],normal:[Xe/vt,-mt/vt,0],width:vt,height:he,depth:ke,points:[Ee,Pe,Be,$e]})}return H}(A.lights)),A.MAPBOX_geometry_bloom&&(D.isGeometryBloom=A.MAPBOX_geometry_bloom)),R){const z=[];for(const V of R)z.push(g7(s.json.nodes[V],s,u));D.children=z}return D}function Cse(c){if(c.vertices.length===0||c.indices.length===0)return null;const s=new DS(c.vertices,c.indices,8,256),[u,h]=[s.min.clone(),s.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:s,min:u,max:h}}function kse(c){if(!c.extras||!c.extras.ground)return null;const s=c.extras.ground;if(!s||!Array.isArray(s)||s.length===0)return null;const u=s[0];if(!u||!Array.isArray(u)||u.length===0)return null;const h=[];for(const v of u){if(!Array.isArray(v)||v.length!==2)continue;const w=v[0],A=v[1];typeof w=="number"&&typeof A=="number"&&h.push(new je(w,A))}if(h.length<3)return null;h.length>1&&h[h.length-1].equals(h[0])&&h.pop();let p=0;for(let v=0;v<h.length;v++){const w=h[v],A=h[(v+1)%h.length],R=h[(v+2)%h.length];p+=(w.x-A.x)*(R.y-A.y)-(R.x-A.x)*(w.y-A.y)}p>0&&h.reverse();const _=y1(h.flatMap(v=>[v.x,v.y]),[]);return _.length===0?null:{vertices:h,indices:_}}function Ise(c,s){const u=[],h=[];let p=0;const _=[];for(const v of c){p=u.length;const w=v.vertexArray.float32,A=v.indexArray.uint16;for(let R=0;R<v.vertexArray.length;R++)_[0]=w[3*R+0],_[1]=w[3*R+1],_[2]=w[3*R+2],rn(_,_,s),u.push(new je(_[0],_[1]));for(let R=0;R<3*v.indexArray.length;R++)h.push(A[R]+p)}if(h.length%3!=0)return null;for(let v=0;v<h.length;v+=3){const w=u[h[v+0]],A=u[h[v+1]],R=u[h[v+2]];(w.x-A.x)*(R.y-A.y)-(R.x-A.x)*(w.y-A.y)>0&&([h[v+1],h[v+2]]=[h[v+2],h[v+1]])}return{vertices:u,indices:h}}function E6(c){const s=function(A,R){const O=[],D=WebGL2RenderingContext;if(A.json.textures)for(const z of A.json.textures){const V={magFilter:D.LINEAR,minFilter:D.NEAREST,wrapS:D.REPEAT,wrapT:D.REPEAT};z.sampler!==void 0&&Object.assign(V,A.json.samplers[z.sampler]),O.push({image:R[z.source],sampler:V,uploaded:!1})}return O}(c,c.images),u=function(A,R){const O=[];for(const D of A.json.meshes){const z=[];for(const V of D.primitives)z.push(Ase(V,A,R));O.push(z)}return O}(c,s),{scenes:h,scene:p,nodes:_}=c.json,v=h?h[p||0].nodes:[..._.keys()],w=[];for(const A of v)w.push(g7(_[A],c,u));return function(A,R,O){const D={},z=new Set;for(let V=0;V<A.length;V++){const H=O[R[V]];if(!H.extras)continue;const K=H.extras["mapbox:footprint:version"],re=H.extras["mapbox:footprint:id"];(K||re)&&z.add(V),K==="1.0.0"&&re&&(D[re]=V)}for(let V=0;V<A.length;V++){if(z.has(V))continue;const H=A[V],K=O[R[V]];if(!K.extras)continue;let re=null;H.id in D&&(re=Ise(A[D[H.id]].meshes,H.localMatrix)),re||(re=kse(K)),re&&(H.footprint=Cse(re))}if(z.size>0){const V=Array.from(z.values()).sort((H,K)=>H-K);for(let H=V.length-1;H>=0;H--)A.splice(V[H],1)}}(w,v,c.json.nodes),w}function Rse(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const s=c.vertexArray.float32,u=c.aabb.min[0]-1,h=c.aabb.min[1]-1,p=Mg/(c.aabb.max[0]-u+2),_=Mg/(c.aabb.max[1]-h+2);for(let v=0;v<s.length;v+=3){const w=s[v+2],A=(s[v+0]-u)*p|0,R=(s[v+1]-h)*_|0;w>c.heightmap[R*Mg+A]&&(c.heightmap[R*Mg+A]=w)}}function _7(c,s,u,h,p){u.reserve(u.length+4*c.length),h.reserve(h.length+10*c.length),p.reserve(p.length+10*c.length);let _=h.length;for(const v of c){const w=Math.min(10,Math.max(4,1.3*v.height))*s,A=[-v.normal[1],v.normal[0],0],R=Math.min(.29,.1*v.width/v.depth),O=v.width-2*v.depth*s*(R+.01),D=jt([],v.pos,A,O/2),z=jt([],v.pos,A,-O/2),V=[D[0],D[1],D[2]+v.height],H=[z[0],z[1],z[2]+v.height],K=jt([],v.normal,A,R);Fe(K,K,w);const re=jt([],v.normal,A,-R);Fe(re,re,w),nt(K,D,K),nt(re,z,re),D[2]+=.1,z[2]+=.1,h.emplaceBack(K[0],K[1],K[2]),h.emplaceBack(re[0],re[1],re[2]),h.emplaceBack(D[0],D[1],D[2]),h.emplaceBack(z[0],z[1],z[2]),h.emplaceBack(V[0],V[1],V[2]),h.emplaceBack(H[0],H[1],H[2]),h.emplaceBack(D[0],D[1],D[2]),h.emplaceBack(z[0],z[1],z[2]),h.emplaceBack(K[0],K[1],K[2]),h.emplaceBack(re[0],re[1],re[2]);const ne=O/w/2;p.emplaceBack(-ne-R,-1,ne,.8),p.emplaceBack(ne+R,-1,ne,.8),p.emplaceBack(-ne,0,ne,1.3),p.emplaceBack(ne,0,ne,1.3),p.emplaceBack(ne+R,-.8,ne,.7),p.emplaceBack(ne+R,-.8,ne,.7),p.emplaceBack(0,0,ne,1.3),p.emplaceBack(0,0,ne,1.3),p.emplaceBack(ne+R,-1.2,ne,.8),p.emplaceBack(ne+R,-1.2,ne,.8),u.emplaceBack(6+_,4+_,8+_),u.emplaceBack(7+_,9+_,5+_),u.emplaceBack(0+_,1+_,2+_),u.emplaceBack(1+_,3+_,2+_),_+=10}}function Mse(c,s){const u={};u.indexArray=new to,u.vertexArray=new vu,u.colorArray=new Vh,_7(c,s,u.indexArray,u.vertexArray,u.colorArray);const h={defined:!0};h.emissiveFactor=ts.black;const p={};return p.baseColorFactor=ts.white,h.pbrMetallicRoughness=p,u.material=h,u.aabb=new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),u}const y7=hi([{name:"a_pos_3f",components:3,type:"Float32"}]),Pse=hi([{name:"a_normal_3",components:3,type:"Int16"}]),Ose=hi([{name:"a_centroid_3",components:3,type:"Int16"}]),v7=hi([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Lse=hi([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),Dse=hi([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),Nse=hi([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),zse=hi([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),Fse=hi([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),x7=Ge.types,YS=32767;function Bse(c,s){const u=Jt+s;for(const h of c)for(const p of h)if(p.x<-s||p.x>u||p.y<-s||p.y>u)return!1;return!0}function jse(c){switch(c){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${c}`)}}class S6{constructor(){this.layoutVertexArray=new vu,this.layoutAttenuationArray=new Vh,this.layoutColorArray=new xu,this.indexArray=new to,this.indexArrayForConflation=new to,this.segmentsBucket=new da}}class A6{constructor(s){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new da,this.entranceBloom=new S6;const u=66560;this.layoutVertexArray=new vu,this.layoutVertexArray.reserve(u),this.layoutNormalArray=new am,this.layoutNormalArray.reserve(u),this.layoutCentroidArray=new am,this.layoutCentroidArray.reserve(u),this.layoutColorArray=new xu,this.layoutColorArray.reserve(u),this.layoutFloodLightDataArray=new $h,this.layoutFloodLightDataArray.reserve(u),this.layoutAOArray=new a1,this.layoutAOArray.reserve(u),this.indexArray=new to,this.indexArray.reserve(66560),this.indexArrayForConflation=new to,this.segmentsBucket=new da,this.entranceBloom=new S6,s&&(this.layoutFacadePaintArray=new xu,this.layoutFacadeDataArray=new Wf,this.layoutFacadeVerticalRangeArray=new xu)}reserve(s,u,h){this.layoutVertexArray.reserveForAdditional(s),this.layoutCentroidArray.reserveForAdditional(s),this.layoutFloodLightDataArray.reserveForAdditional(s),this.layoutNormalArray.reserveForAdditional(s),this.layoutAOArray.reserveForAdditional(s),this.layoutColorArray.reserveForAdditional(s),this.indexArray.reserveForAdditional(u),h&&(this.layoutFacadePaintArray.reserveForAdditional(s),this.layoutFacadeDataArray.reserveForAdditional(s),this.layoutFacadeVerticalRangeArray.reserveForAdditional(s))}}class b7{constructor(s){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new sd,this.footprintsIndices=new $h,this.footprintsMin=new je(1/0,1/0),this.footprintsMax=new je(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new A6(!1),this.buildingWithFacade=new A6(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=s.zoom,this.canonical=s.canonical,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.fqid),this.index=s.index,this.hasPattern=!1,this.worldview=s.worldview,this.lut=s.lut,this.programConfigurations=new Ec(s.layers,{zoom:s.zoom,lut:s.lut}),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.projection=s.projection,this.groundEffect=new l6(s),this.groundEffect.groundRadiusArray=new Bd,this.hasAppearances=null}updateFootprints(s,u){const h=new DS([],[],1),p={vertices:[],indices:new Uint32Array(0),grid:h,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};u.push({footprint:p,id:s})}updateAppearances(s,u,h,p){}prepare(){return function(){if(VS!=null||t7!=null)return null;if(T1!=null)return T1;const s=fetch(ri.BUILDING_GEN_URL);return T1=function(u){let h,p,_,v,w;function A(){h=new Uint8Array(w.buffer),p=new Int16Array(w.buffer),_=new Int32Array(w.buffer),v=new Float32Array(w.buffer)}function R(){throw new Error("Unexpected BuildingGen error.")}const O=()=>{},D={a:{a:R,f:function(z){const V=h.length,H=Math.max(z>>>0,Math.ceil(1.2*V)),K=Math.ceil((H-V)/65536);try{return w.grow(K),A(),!0}catch{return!1}},g:R,b:O,c:O,d:O,e:O}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(u,D):u.then(z=>z.arrayBuffer()).then(z=>WebAssembly.instantiate(z,D))).then(z=>{const V=z.instance.exports;return(0,V.g)(),w=V.f,A(),new dse({setStyle:V.h,setAOOptions:V.i,setMetricOptions:V.j,setStructuralOptions:V.k,setFacadeOptions:V.l,setFauxFacadeOptions:V.m,setFacadeClassifierOptions:V.n,addFeature:V.o,addFacade:V.p,generateMesh:V.q,getLastError:V.r,getOuterRingLength:V.s,getMeshCount:V.t,getPositionsPtr:V.u,getPositionsLength:V.v,getNormalsPtr:V.w,getNormalsLength:V.x,getAOPtr:V.y,getAOLength:V.z,getUVPtr:V.A,getUVLength:V.B,getFauxFacadePtr:V.C,getFauxFacadeLength:V.D,getIndicesPtr:V.E,getIndicesLength:V.F,getBuildingPart:V.G,getRingCount:V.H,getRingPtr:V.I,getRingLength:V.J,malloc:V.K,free:V.L,heapU8:h,heap16:p,heap32:_,heapF32:v})})}(s).then(u=>(T1=null,VS=u,VS)).catch(u=>{Qt("Could not load building-gen"),T1=null,t7=u}),T1}()}populate(s,u,h,p){const _=hse();if(!_)return;const v=ae(h);this.tileToMeter=v,this.brightness=u.brightness,_.setStyle({normalScale:[1,-1,v],tileToMeters:v}),_.setAOOptions(!1,.3),_.setMetricOptions(!1,16),_.setStructuralOptions(!0),_.setFacadeClassifierOptions(3);const w=new Map,A=new Map;let R=0;for(const{feature:ne}of s){if(x7[ne.type]!=="LineString"){w.set(ne.id,ne.properties.source_id);continue}const ue=this.layers[0]._featureFilter.needGeometry;if(ue&&!this.layers[0]._featureFilter.filter(new zs(this.zoom),ne,h))continue;const he=We(ne,ue);if(!ue&&!this.layers[0]._featureFilter.filter(new zs(this.zoom),he,h))continue;const ge=ue?he.geometry:ze(ne,h,p),ke=[];for(const $e of ge)for(const mt of $e)ke.push(mt.x),ke.push(mt.y);const Ee={coordinates:ke,crossPerc:ne.properties.cross_perc,distanceToRoad:ne.properties.distance_to_road,entrances:ne.properties.entrances,sourceId:0},Pe=ne.properties.source_id;let Be=A.get(Pe);Be||(Be=[],A.set(Pe,Be)),Be.push(Ee),++R}this.maxHeight=0;const O=new Array,D=new Set,z=ne=>{ne!=null&&D.add(ne)},V=(ne,ue)=>{ne!=null&&O.push({buildingId:ne,footprintIndex:ue})},H=64*(s.length-R),K=H/2;this.buildingWithFacade.reserve(H,K,!0),this.buildingWithoutFacade.reserve(2*H,2*K,!1),this.footprintsIndices.reserve(16*(s.length-R)),this.footprintsVertices.reserve(8*(s.length-R));for(const{feature:ne,id:ue,index:he,sourceLayerIndex:ge}of s){if(x7[ne.type]==="LineString")continue;const ke=this.layers[0]._featureFilter.needGeometry;if(ke&&!this.layers[0]._featureFilter.filter(new zs(this.zoom),ne,h))continue;let Ee=null;if(ne.properties&&ne.properties.hasOwnProperty("building_id")&&(Ee=ne.properties.building_id,D.has(Ee)))continue;const Pe=We(ne,ke);if(!ke&&!this.layers[0]._featureFilter.filter(new zs(this.zoom),Pe,h))continue;const Be=ke?Pe.geometry:ze(ne,h,p),$e=sw(Be,500);let mt=!1;for(const gr of $e)if(gr.length!==1){mt=!0;break}if(mt){z(Ee);continue}if(!Bse(Be,163)){z(Ee);continue}const Xe=this.layers[0],vt=jse(Xe.layout.get("building-roof-shape").evaluate(ne,{},h)),kt=Xe.layout.get("building-base").evaluate(ne,{},h),It=Xe.layout.get("building-height").evaluate(ne,{},h),zt=Xe.layout.get("building-flood-light-ground-radius").evaluate(ne,{},h),Bt=Xe.paint.get("building-ambient-occlusion-intensity"),Ot=zt/this.tileToMeter;ne.properties["building-part"]="roof";const Lt=Xe.paint.get("building-color").evaluate(ne,{},this.canonical).toPremultipliedRenderColor(this.lut),yt=Xe.paint.get("building-emissive-strength").evaluate(ne,{},this.canonical);ne.properties["building-part"]="wall";const gt=Xe.paint.get("building-color").evaluate(ne,{},this.canonical).toPremultipliedRenderColor(this.lut),Dt=Xe.paint.get("building-emissive-strength").evaluate(ne,{},this.canonical);ne.properties["building-part"]="window";const tn=Xe.paint.get("building-color").evaluate(ne,{},this.canonical).toPremultipliedRenderColor(this.lut),$t=Xe.paint.get("building-emissive-strength").evaluate(ne,{},this.canonical);ne.properties["building-part"]="door";const Bn=Xe.paint.get("building-color").evaluate(ne,{},this.canonical).toPremultipliedRenderColor(this.lut),pn=Xe.paint.get("building-emissive-strength").evaluate(ne,{},this.canonical);let xn=Xe.layout.get("building-flood-light-wall-radius").evaluate(ne,{},h);xn=ee(xn,0,2048);const Rn=xn/2048*YS,Jr=w.get(ue),Zt=A.get(Jr)||[],Pn=Zt.length!==0&&Xe.layout.get("building-facade").evaluate(ne,{},h);_.setFacadeOptions(4,!0),_.setFauxFacadeOptions(Pn,!1,1);let Or=0,gi=0,Ei=0,jr=0,hs=0,Se=0,Ie=0,bt=0,Ft=0,ln=0,un=0;if(Pn){let gr=Math.round(Xe.layout.get("building-facade-floors").evaluate(ne,{},h));if(kt===0){gr=Math.max(1,gr-(Zt.length>0?1:0));let is=4;if(It>100){const ta=[10,13,15];is=ta[ne.id?ne.id%ta.length:0]}else It<=10&&(is=3);_.setFacadeOptions(is,!0),hs=(It<15?1.3:1.61803)*is/v}else hs=kt/v;Se=It/v,hs=Math.min(hs,Se),Ei=Xe.layout.get("building-facade-unit-width").evaluate(ne,{},h)/v,jr=(Se-hs)/gr,_.setFauxFacadeOptions(!0,!0,Ei);const pa=Xe.layout.get("building-facade-window").evaluate(ne,{},h);Or=pa[0],gi=pa[1],Ie=Math.floor(65535*Math.min(1,hs/Jt)),bt=Math.floor(65535*Math.min(1,Se/Jt)),Ft=Math.floor(255*Or)<<8|Math.floor(255*gi),ln=Math.floor(65535*Math.min(1,Ei/Jt)),un=Math.floor(65535*Math.min(1,jr/Jt))}const Un=Array($e.length),Yn={x:1/0,y:1/0},zr={x:-1/0,y:-1/0},qr={x:0,y:0};let Yr=0;for(let gr=0;gr<$e.length;gr++){const pa=$e[gr];if(pa.length>0){const is=[],ta=Array(pa.length+1);ta[0]=0;for(let io=0;io<pa.length;io++){const Ao=pa[io];for(let Wa=0;Wa<Ao.length;Wa++){const Xa=Ao[Ao.length-Wa-1];Yn.x=Math.min(Yn.x,Xa.x),Yn.y=Math.min(Yn.y,Xa.y),zr.x=Math.max(zr.x,Xa.x),zr.y=Math.max(zr.y,Xa.y),qr.x+=Xa.x,qr.y+=Xa.y,Yr++,is.push(Xa.x),is.push(Xa.y)}ta[io+1]=is.length}Un[gr]={id:ne.id?ne.id:0,height:It,minHeight:kt,sourceId:0,roofType:vt,coordinates:is,ringIndices:ta}}}qr.x/=Yr||1,qr.y/=Yr||1;const fi=_.generateMesh(Un,Zt);if(typeof fi=="string"){Qt(`Unable to generate building ${ne.id}: ${fi}`),z(Ee);continue}if(fi.meshes.length===0||fi.modifiedPolygonRings.length===0){z(Ee);continue}const _r=Pn?this.buildingWithFacade:this.buildingWithoutFacade;let Pr=0;for(const gr of fi.meshes)Pr+=gr.positions.length/3;const Pi=_r.segmentsBucket.prepareSegment(Pr,_r.layoutVertexArray,_r.indexArray),zi=[];let Fi=null,rs=0,ws=-1;const fs=_r.layoutVertexArray.length,ji=fs+Pr;_r.layoutVertexArray.resize(ji),_r.layoutCentroidArray.resize(ji),_r.layoutNormalArray.resize(ji),_r.layoutAOArray.resize(ji),_r.layoutColorArray.resize(ji),_r.layoutFloodLightDataArray.resize(ji),Pn&&(_r.layoutFacadePaintArray.resize(ji),_r.layoutFacadeDataArray.resize(ji),_r.layoutFacadeVerticalRangeArray.resize(ji));const Yi=_r.indexArray.length;let Zr=0,bi=fs;for(const gr of fi.meshes){let pa,is;if(gr.buildingPart===1)pa=Lt,is=yt;else if(gr.buildingPart===0)pa=gt,is=Dt;else if(gr.buildingPart===2)pa=tn,is=$t;else{if(gr.buildingPart!==3)continue;pa=Bn,is=pn}if(is=ee(is,0,1),gr.buildingPart===3){const Ls=new Array;for(let so=0;so<gr.positions.length;so+=12){const ud=gr.positions[so+0],Wh=gr.positions[so+1],Yo=gr.positions[so+3],Rl=gr.positions[so+4],Eu=gr.positions[so+2],bm=gr.positions[so+8]-Eu,z1=1,Qd=Yo-ud,Jd=Rl-Wh,jw=Math.hypot(Qd,Jd);Ls.push({pos:[ud+.5*Qd,Wh+.5*Jd,Eu],normal:[Jd/jw,-Qd/jw,0],width:jw,height:bm,depth:z1,points:[ud,Wh,Yo,Rl]})}const Oa=_r.entranceBloom.segmentsBucket.prepareSegment(10*Ls.length,_r.entranceBloom.layoutVertexArray,_r.entranceBloom.indexArray),ja=_r.entranceBloom.layoutVertexArray.length;rs=_r.entranceBloom.indexArray.length,_7(Ls,.5/this.tileToMeter,_r.entranceBloom.indexArray,_r.entranceBloom.layoutVertexArray,_r.entranceBloom.layoutAttenuationArray);const tu=_r.entranceBloom.layoutVertexArray.length-ja;ws=_r.entranceBloom.indexArray.length-rs;for(let so=0;so<tu;so++)_r.entranceBloom.layoutColorArray.emplaceBack(255*Bn.r<<8|255*Bn.g,255*Bn.b<<8|51*pn);Oa.vertexLength+=tu,Oa.primitiveLength+=ws,Fi={part:gr.buildingPart,vertexOffset:ja,vertexLength:tu}}_r.layoutVertexArray.float32.set(gr.positions,3*bi);const ta=gr.positions.length/3;for(let Ls=0;Ls<ta;++Ls){const Oa=3*Ls;Zr=Math.max(Zr,gr.positions[Oa+2]);const ja=gr.normals[Oa+1]*YS,tu=gr.normals[Oa+2]*YS,so=3*(bi+Ls);_r.layoutNormalArray.int16[so]=gr.normals[Oa]*YS,_r.layoutNormalArray.int16[so+1]=ja,_r.layoutNormalArray.int16[so+2]=tu;const ud=gr.ao[Ls];_r.layoutAOArray.uint8[bi+Ls]=255*ud;const Wh=1+(ud-1)*Bt,Yo=255*pa.b*Wh<<8|255*is;_r.layoutColorArray.uint16[2*(bi+Ls)]=255*pa.r*Wh<<8|255*pa.g*Wh,_r.layoutColorArray.uint16[2*(bi+Ls)+1]=Yo}const io=Math.floor(qr.x),Ao=Math.floor(qr.y),Wa=Math.floor(It);for(let Ls=0;Ls<ta;++Ls){const Oa=3*(bi+Ls);_r.layoutCentroidArray.int16[Oa]=io,_r.layoutCentroidArray.int16[Oa+1]=Ao,_r.layoutCentroidArray.int16[Oa+2]=Wa}if(_r.layoutFloodLightDataArray.uint16.fill(gr.buildingPart===0?Rn:0,bi,bi+ta),Pn){const Ls=255*tn.r<<8|255*tn.g,Oa=255*tn.b<<8|255*$t;for(let ja=0;ja<ta;++ja){const tu=2*(bi+ja);_r.layoutFacadePaintArray.uint16[tu]=Ls,_r.layoutFacadePaintArray.uint16[tu+1]=Oa}for(let ja=0;ja<ta;++ja)if(gr.isFauxFacade[ja]){const tu=Math.min(65535,Math.floor(gr.uv[2*ja]*fi.outerRingLength));_r.layoutFacadeDataArray.emplace(bi+ja,1|tu,Ft,ln,un),_r.layoutFacadeVerticalRangeArray.emplace(bi+ja,Ie,bt)}else _r.layoutFacadeDataArray.emplace(bi+ja,0,0,0,0),_r.layoutFacadeVerticalRangeArray.emplace(bi+ja,0,0)}const Xa=Pi.vertexLength,_o=gr.indices.length/3,Ul=_r.indexArray.length;_r.indexArray.resize(Ul+_o);for(let Ls=0;Ls<_o;++Ls){const Oa=3*Ls,ja=3*Ul+Oa;_r.indexArray.uint16[ja]=Xa+gr.indices[Oa],_r.indexArray.uint16[ja+1]=Xa+gr.indices[Oa+1],_r.indexArray.uint16[ja+2]=Xa+gr.indices[Oa+2]}gr.buildingPart!==1&&gr.buildingPart!==0&&gr.buildingPart!==2&&gr.buildingPart!==3||zi.push({part:gr.buildingPart,vertexOffset:bi,vertexLength:gr.positions.length/3}),bi+=ta,Pi.vertexLength+=ta,Pi.primitiveLength+=gr.indices.length/3}this.maxHeight=Math.max(this.maxHeight,Zr);const oa=_r.indexArray.length-Yi,mr=this.footprintsIndices.length,pi=this.footprintsVertices.length,gs=[],Rs=new je(1/0,1/0),Fs=new je(-1/0,-1/0),Ba=this.groundEffect.vertexArray.length;for(const gr of fi.modifiedPolygonRings){const pa=[],is=new je(1/0,1/0),ta=new je(-1/0,-1/0);for(let io=0;io<gr.length;io+=2){const Ao=gr.length-io-2;is.x=Math.min(is.x,gr[Ao]),is.y=Math.min(is.y,gr[Ao+1]),ta.x=Math.max(ta.x,gr[Ao]),ta.y=Math.max(ta.y,gr[Ao+1]);const Wa=new je(gr[Ao],gr[Ao+1]);pa.push(Wa),gs.push(Wa.x,Wa.y),this.footprintsVertices.emplaceBack(Wa.x,Wa.y)}Rs.x=Math.min(Rs.x,is.x),Rs.y=Math.min(Rs.y,is.y),Fs.x=Math.max(Fs.x,ta.x),Fs.y=Math.max(Fs.y,ta.y),this.groundEffect.addData(pa,[is,ta],Ot)}const Os=this.groundEffect.vertexArray.length-Ba;this.groundEffect.groundRadiusArray.reserveForAdditional(Os);for(let gr=0;gr<Os;gr++)this.groundEffect.groundRadiusArray.emplaceBack(zt);(Yn.x<0||zr.x>Jt||Yn.y<0||zr.y>Jt)&&this.featuresOnBorder.push({featureId:ne.id,footprintIndex:this.footprints.length});{const gr=y1(gs,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+gr.length),this.footprintsIndices.uint16.set(gr,mr),this.buildingIds.add(Ee??ne.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Rs.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Rs.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,Fs.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,Fs.y);const pa={footprintVertexOffset:pi,footprintVertexLength:this.footprintsVertices.length-pi,footprintIndexOffset:mr,footprintIndexLength:this.footprintsIndices.length-mr,min:Rs,max:Fs,hiddenFlags:0,indicesOffset:Yi,indicesLength:oa,bloomIndicesOffset:rs,bloomIndicesLength:ws,groundEffectVertexOffset:Ba,groundEffectVertexLength:Os,hasFauxFacade:Pn,height:Zr,promoteId:ue,feature:Pe,parts:zi,buildingBloom:Fi},is=this.footprints.length;ne.id!==void 0&&this.featureFootprintLookup.set(ne.id,is),V(Ee,is),this.footprints.push(pa)}this.programConfigurations.populatePaintArrays(_r.layoutVertexArray.length,ne,he,{},u.availableImages,h,u.brightness),this.groundEffect.addPaintPropertiesData(ne,he,{},u.availableImages,h,u.brightness),u.featureIndex.insert(ne,Be,he,ge,this.index,fs)}O.forEach(({buildingId:ne,footprintIndex:ue})=>{D.has(ne)&&(this.footprints[ue].hiddenFlags|=4)});const re=new Set;this.buildingIds.forEach((ne,ue,he)=>{D.has(ne)||re.add(ne)}),this.buildingIds=re,this.groundEffect.prepareBorderSegments()}update(s,u,h,p,_,v,w){this.programConfigurations.updatePaintArrays(s,u,_,h,p,v,w),this.groundEffect.update(s,u,_,h,p,v,w),this.evaluate(this.layers[0],s),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(s){const u=h=>{h.layoutVertexBuffer=s.createVertexBuffer(h.layoutVertexArray,y7.members),h.layoutNormalBuffer=s.createVertexBuffer(h.layoutNormalArray,Pse.members),h.layoutCentroidBuffer=s.createVertexBuffer(h.layoutCentroidArray,Ose.members),h.layoutFloodLightDataBuffer=s.createVertexBuffer(h.layoutFloodLightDataArray,Fse.members),h.layoutFacadeDataArray&&h.layoutFacadeDataArray.length&&(h.layoutFacadeDataBuffer=s.createVertexBuffer(h.layoutFacadeDataArray,Dse.members)),h.layoutFacadeVerticalRangeArray&&h.layoutFacadeVerticalRangeArray.length&&(h.layoutFacadeVerticalRangeBuffer=s.createVertexBuffer(h.layoutFacadeVerticalRangeArray,Nse.members)),h.entranceBloom.layoutVertexArray.length&&(h.entranceBloom.layoutVertexBuffer=s.createVertexBuffer(h.entranceBloom.layoutVertexArray,y7.members),h.entranceBloom.layoutAttenuationBuffer=s.createVertexBuffer(h.entranceBloom.layoutAttenuationArray,zse.members)),this.uploadUpdatedColorBuffer(s),this.uploadUpdatedIndexBuffer(s)};this.uploaded||(u(this.buildingWithoutFacade),u(this.buildingWithFacade),this.groundEffect.upload(s)),this.groundEffect.uploadPaintProperties(s),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){const s=u=>{u.layoutVertexBuffer&&(u.layoutVertexBuffer.destroy(),u.layoutNormalBuffer.destroy(),u.layoutColorBuffer.destroy(),u.segmentsBucket.destroy(),u.indexBuffer&&u.indexBuffer.destroy(),u.entranceBloom.layoutVertexBuffer&&(u.entranceBloom.layoutVertexBuffer.destroy(),u.entranceBloom.layoutColorBuffer.destroy(),u.entranceBloom.layoutAttenuationBuffer.destroy(),u.entranceBloom.indexBuffer.destroy(),u.entranceBloom.segmentsBucket.destroy()))};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(s,u,h=!0){let p=!1;const _=h?u:0,v=0|(h?-1:~u);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const w of s){const A=this.footprints[w],R=A.hiddenFlags&v|_;A.hiddenFlags!==R&&(A.hiddenFlags=R,p=!0,this.groundEffect.updateHiddenByLandmarkRange(A.groundEffectVertexOffset,A.groundEffectVertexLength,A.hiddenFlags!==0))}return p&&(this.indexArrayForConflationUploaded=!1),p}uploadUpdatedIndexBuffer(s){if(this.groundEffect.uploadHiddenByLandmark(s),this.indexArrayForConflationUploaded)return;const u=p=>{p.indexArray.length!==0&&(p.indexArrayForConflation.resize(p.indexArray.length),p.indexArrayForConflation.uint16.set(p.indexArray.uint16),p.entranceBloom.indexArrayForConflation.resize(p.entranceBloom.indexArray.length),p.entranceBloom.indexArrayForConflation.uint16.set(p.entranceBloom.indexArray.uint16))};u(this.buildingWithoutFacade),u(this.buildingWithFacade);for(const p of this.footprints){const _=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,v=p.indicesOffset+p.indicesLength;if(p.hiddenFlags!==0){for(let A=p.indicesOffset;A<v;A++)_.indexArrayForConflation.uint16[3*A+0]=0,_.indexArrayForConflation.uint16[3*A+1]=0,_.indexArrayForConflation.uint16[3*A+2]=0;const w=p.bloomIndicesOffset+p.bloomIndicesLength;for(let A=p.bloomIndicesOffset;A<w;A++)_.entranceBloom.indexArrayForConflation.uint16[3*A+0]=0,_.entranceBloom.indexArrayForConflation.uint16[3*A+1]=0,_.entranceBloom.indexArrayForConflation.uint16[3*A+2]=0}}const h=p=>{p.indexArray.length!==0&&(p.indexBuffer?p.indexBuffer.updateData(p.indexArrayForConflation):p.indexBuffer=s.createIndexBuffer(p.indexArrayForConflation,!0),p.entranceBloom.indexBuffer?p.entranceBloom.indexBuffer.updateData(p.entranceBloom.indexArrayForConflation):p.entranceBloom.indexBuffer=s.createIndexBuffer(p.entranceBloom.indexArrayForConflation,!0))};h(this.buildingWithoutFacade),h(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(s){const u=h=>{h.layoutColorBuffer?h.layoutColorBuffer.updateData(h.layoutColorArray):h.layoutColorBuffer=s.createVertexBuffer(h.layoutColorArray,v7.members,!0),h.layoutFacadePaintArray&&(h.layoutFacadePaintBuffer?h.layoutFacadePaintBuffer.updateData(h.layoutFacadePaintArray):h.layoutFacadePaintBuffer=s.createVertexBuffer(h.layoutFacadePaintArray,Lse.members,!0)),h.entranceBloom.layoutColorBuffer?h.entranceBloom.layoutColorBuffer.updateData(h.entranceBloom.layoutColorArray):h.entranceBloom.layoutColorBuffer=s.createVertexBuffer(h.entranceBloom.layoutColorArray,v7.members,!0)};u(this.buildingWithoutFacade),u(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(s,u){const h=s.paint.get("building-ambient-occlusion-intensity");for(const p of this.footprints){if(4&p.hiddenFlags)continue;const _=u[p.promoteId],v=p.feature;v.properties["building-part"]="roof";const w=s.paint.get("building-color").evaluate(v,_,this.canonical).toPremultipliedRenderColor(this.lut),A=s.paint.get("building-emissive-strength").evaluate(v,_,this.canonical);v.properties["building-part"]="wall";const R=s.paint.get("building-color").evaluate(v,_,this.canonical).toPremultipliedRenderColor(this.lut),O=s.paint.get("building-emissive-strength").evaluate(v,_,this.canonical);v.properties["building-part"]="window";const D=s.paint.get("building-color").evaluate(v,_,this.canonical).toPremultipliedRenderColor(this.lut),z=s.paint.get("building-emissive-strength").evaluate(v,_,this.canonical);v.properties["building-part"]="door";const V=s.paint.get("building-color").evaluate(v,_,this.canonical).toPremultipliedRenderColor(this.lut),H=s.paint.get("building-emissive-strength").evaluate(v,_,this.canonical),K=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const ne of p.parts){let ue,he=w;ne.part===1?(he=w,ue=A):ne.part===0?(he=R,ue=O):ne.part===2?(he=D,ue=z):ne.part===3&&(he=V,ue=H),ue=ee(ue,0,1);for(let ge=0;ge<ne.vertexLength;ge++){const ke=ne.vertexOffset+ge,Ee=1+(K.layoutAOArray.uint8[ke]/255-1)*h;K.layoutColorArray.emplace(ke,he.r*Ee*255<<8|he.g*Ee*255,he.b*Ee*255<<8|255*ue),p.hasFauxFacade&&K.layoutFacadePaintArray.emplace(ke,255*D.r<<8|255*D.g,255*D.b<<8|255*z)}}const re=p.buildingBloom;if(re)for(let ne=0;ne<re.vertexLength;ne++)K.entranceBloom.layoutColorArray.emplace(re.vertexOffset+ne,255*V.r<<8|255*V.g,255*V.b<<8|51*H)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(s,u,h){if(u.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=u.updateTime;const p=u.getReplacementRegionsForTile(s.toUnwrapped());if(zS(this.activeReplacements,p))return;this.activeReplacements=p;for(const v of this.footprints)v.hiddenFlags&=-2;const _=[];for(const v of this.activeReplacements){if(v.order<=wz)continue;const w=Math.max(1,Math.pow(2,v.footprintTileId.canonical.z-s.canonical.z));for(const A of this.footprints)A.min.x>v.max.x||A.max.x<v.min.x||A.min.y>v.max.y||A.max.y<v.min.y||(_.length=0,Vse(this.footprintsVertices,A.footprintVertexOffset,A.footprintVertexLength,v.footprintTileId.canonical,s.canonical,_),s6(v.footprint,_,this.footprintsIndices.uint16,A.footprintIndexOffset,A.footprintIndexLength,0,-w)&&(A.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const v of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(v.groundEffectVertexOffset,v.groundEffectVertexLength,v.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(s){if(s.id!==void 0){const u=this.featureFootprintLookup.get(s.id);return this.footprints[u]}return null}getHeightAtTileCoord(s,u){let h=Number.NEGATIVE_INFINITY,p=!0;const _=4*(s+Jt)*Jt+(u+Jt);if(this.footprintLookup.hasOwnProperty(_)){const w=this.footprintLookup[_];return w?{height:w.height,hidden:w.hiddenFlags!==0}:void 0}const v=new je(s,u);for(const w of this.footprints)s>w.max.x||w.min.x>s||u>w.max.y||w.min.y>u||w.height<=h||Use(v,this.footprintsVertices.float32.subarray(2*w.footprintVertexOffset,2*(w.footprintVertexOffset+w.footprintVertexLength)),this.footprintsIndices.uint16.subarray(w.footprintIndexOffset,w.footprintIndexOffset+w.footprintIndexLength))&&(h=w.height,this.footprintLookup[_]=w,p=w.hiddenFlags!==0);if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:p};this.footprintLookup[_]=void 0}}function Use(c,s,u){for(let h=0;h<u.length;h+=3){const p=u[h],_=u[h+1],v=u[h+2],w=s[2*p+0],A=s[2*p+1],R=s[2*_+0],O=s[2*_+1],D=s[2*v+0],z=s[2*v+1],V=(w-D)*(c.y-z)-(A-z)*(c.x-D),H=(R-w)*(c.y-A)-(O-A)*(c.x-w);if(V<0!=H<0&&V!==0&&H!==0)continue;const K=(D-R)*(c.y-O)-(z-O)*(c.x-R);if(K===0||K<0==V+H<=0)return!0}return!1}function Vse(c,s,u,h,p,_){const v=Math.pow(2,h.z-p.z);for(let w=0;w<u;w++){let A=c.float32[2*(w+s)+0],R=c.float32[2*(w+s)+1];A=(A+p.x*Jt)*v-h.x*Jt,R=(R+p.y*Jt)*v-h.y*Jt,_.push(new je(A,R))}}let w7,T7;En(b7,"BuildingBucket",{omit:["layers"]}),En(A6,"BuildingGeometry"),En(S6,"BuildingBloomGeometry");const $se=hi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Hse=hi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Gse}=$se,qse=hi([{name:"a_packed",components:3,type:"Float32"}]),{members:Zse}=qse,Wse=hi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Xse}=Wse;class E7{constructor(s,u){this.width=s,this.height=u,this.nextRow=0,this.image=new gm({width:s,height:u}),this.positions={},this.uploaded=!1}getDash(s,u){const h=this.getKey(s,u);return this.positions[h]}trim(){const s=this.width,u=this.height=tt(this.nextRow);this.image.resize({width:s,height:u})}getKey(s,u){return s.join(",")+u}getDashRanges(s,u,h){const p=[];let _=s.length%2==1?-s[s.length-1]*h:0,v=s[0]*h,w=!0;p.push({left:_,right:v,isDash:w,zeroLength:s[0]===0});let A=s[0];for(let R=1;R<s.length;R++){w=!w;const O=s[R];_=A*h,A+=O,v=A*h,p.push({left:_,right:v,isDash:w,zeroLength:O===0})}return p}addRoundDash(s,u,h){const p=u/2;for(let _=-h;_<=h;_++){const v=this.width*(this.nextRow+h+_);let w=0,A=s[w];for(let R=0;R<this.width;R++){R/A.right>1&&(A=s[++w]);const O=Math.abs(R-A.left),D=Math.abs(R-A.right),z=Math.min(O,D);let V;const H=_/h*(p+1);if(A.isDash){const K=p-Math.abs(H);V=Math.sqrt(z*z+K*K)}else V=p-Math.sqrt(z*z+H*H);this.image.data[v+R]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(s,u){for(let A=s.length-1;A>=0;--A){const R=s[A],O=s[A+1];R.zeroLength?s.splice(A,1):O&&O.isDash===R.isDash&&(O.left=R.left,s.splice(A,1))}const h=s[0],p=s[s.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const _=this.width*this.nextRow;let v=0,w=s[v];for(let A=0;A<this.width;A++){A/w.right>1&&(w=s[++v]);const R=Math.abs(A-w.left),O=Math.abs(A-w.right),D=Math.min(R,O);this.image.data[_+A]=Math.max(0,Math.min(255,(w.isDash?D:-D)+u+128))}}addDash(s,u){const h=this.getKey(s,u);if(this.positions[h])return this.positions[h];const p=u==="round",_=p?7:0,v=2*_+1;if(this.nextRow+v>this.height)return Qt("LineAtlas out of space"),null;s.length===0&&s.push(1);let w=0;for(let O=0;O<s.length;O++)s[O]<0&&(Qt("Negative value is found in line dasharray, replacing values with 0"),s[O]=0),w+=s[O];if(w!==0){const O=this.width/w,D=this.getDashRanges(s,this.width,O);p?this.addRoundDash(D,O,_):this.addRegularDash(D,u==="square"?.5*O:0)}const A=this.nextRow+_;this.nextRow+=v;const R={tl:[A,_],br:[w,0]};return this.positions[h]=R,R}}En(E7,"LineAtlas");const Yse=Ge.types,Kse=Math.cos(Math.PI/180*37.5),Qse=Math.cos(Math.PI/180*5);class C6{constructor(s){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=s.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=s.overscaling,this.pixelRatio=s.pixelRatio,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.fqid),this.index=s.index,this.projection=s.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Jy,this.layoutVertexArray2=new vu,this.patternVertexArray=new vu,this.indexArray=new to,this.programConfigurations=new Ec(s.layers,{zoom:s.zoom,lut:s.lut}),this.segments=new da,this.maxLineLength=0,this.zOffsetVertexArray=new vu,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.tessellationStep=s.tessellationStep?s.tessellationStep:Jt/64,this.worldview=s.worldview,this.hasAppearances=null}updateFootprints(s,u){}updateAppearances(s,u,h,p){}populate(s,u,h,p){this.hasPattern=JI("line",this.layers,this.pixelRatio,u);const _=this.layers[0].layout.get("line-sort-key");this.tileToMeter=ae(h);const v=this.layers[0].layout.get("line-elevation-reference");if(v==="hd-road-markup")this.elevationType="road";else{const z=this.layers[0].layout.get("line-z-offset"),V=z.isConstant()&&!z.constantOr(0);this.elevationType=v!=="sea"&&v!=="ground"&&V?"none":"offset",this.elevationType==="offset"&&v==="none"&&Qt(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const w=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&w!==void 0;const A=[];for(const{feature:z,id:V,index:H,sourceLayerIndex:K}of s){const re=this.layers[0]._featureFilter.needGeometry,ne=We(z,re);if(!this.layers[0]._featureFilter.filter(new zs(this.zoom,{worldview:this.worldview,activeFloors:u.activeFloors}),ne,h))continue;const ue=_?_.evaluate(ne,{},h):void 0,he={id:V,properties:z.properties,type:z.type,sourceLayerIndex:K,index:H,geometry:re?ne.geometry:ze(z,h,p),patterns:{},sortKey:ue};A.push(he)}_&&A.sort((z,V)=>z.sortKey-V.sortKey);const{lineAtlas:R,featureIndex:O}=u,D=this.addConstantDashes(R);for(const z of A){const{geometry:V,index:H,sourceLayerIndex:K}=z;if(D&&this.addFeatureDashes(z,R),this.hasPattern){const re=e6("line",this.layers,z,this.zoom,this.pixelRatio,u);this.patternFeatures.push(re)}else this.addFeature(z,V,H,h,R.positions,u.availableImages,u.brightness,u.elevationFeatures);O.insert(s[H].feature,V,H,K,this.index)}}addConstantDashes(s){let u=!1;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if(p.kind!=="constant"||_.kind!=="constant")u=!0;else{const v=_.value,w=p.value;if(!w)continue;s.addDash(w,v)}}return u}addFeatureDashes(s,u){const h=this.zoom;for(const p of this.layers){const _=p.paint.get("line-dasharray").value,v=p.layout.get("line-cap").value;if(_.kind==="constant"&&v.kind==="constant")continue;let w,A;if(_.kind==="constant"){if(w=_.value,!w)continue}else w=_.evaluate({zoom:h},s);A=v.kind==="constant"?v.value:v.evaluate({zoom:h},s),u.addDash(w,A),s.patterns[p.id]=[u.getKey(w,A)]}}update(s,u,h,p,_,v,w,A){this.programConfigurations.updatePaintArrays(s,u,_,h,p,v,w,A)}addFeatures(s,u,h,p,_,v){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,u,h,p,v,s.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,Zse)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=s.createVertexBuffer(this.patternVertexArray,Xse)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,Hse.members,!0)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Gse),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s,u){let h,p;if(u&&u>0?(h=`mapbox_clip_start_${u}`,p=`mapbox_clip_end_${u}`):(h="mapbox_clip_start",p="mapbox_clip_end"),s.properties&&s.properties.hasOwnProperty(h)&&s.properties.hasOwnProperty(p))return{start:+s.properties[h],end:+s.properties[p]}}addFeature(s,u,h,p,_,v,w,A){const R=this.layers[0].layout,O=R.get("line-join").evaluate(s,{}),D=R.get("line-cap").evaluate(s,{}),z=R.get("line-miter-limit"),V=R.get("line-round-limit");this.lineClips=this.lineFeatureClips(s),this.lineFeature=s;const H=!(!s.properties||!s.properties.hasOwnProperty("mapbox_line_metrics"))&&s.properties.mapbox_line_metrics;this.zOffsetValue=R.get("line-z-offset").value;const K=this.layers[0].paint.get("line-width").value;if(K.kind!=="constant"&&K.isLineProgressConstant===!1&&(this.variableWidthValue=K),this.elevationType==="road"){const re=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(s,u,p,A,O,D,z,V)){const[ne,ue]=this.clipRuntimeLinesToTile(u,1);for(let he=0;he<ne.length;he++){const ge=ne[he],ke=ue[he],Ee={progress:{min:ke.progress.min,max:ke.progress.max},nextDir:this.computeSegNextDir(ke,ge),prevDir:this.computeSegPrevDir(ke,ge)};this.addLine(ge,s,p,O,D,z,V,Ee,H&&ke.parentIndex>0?ke.parentIndex:null)}this.fillNonElevatedRoadSegment(re)}}else for(let re=0;re<u.length;re++)this.addLine(u[re],s,p,O,D,z,V,void 0,H&&re>0?re:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,_,v,p,w,void 0,this.worldview)}computeSegNextDir(s,u){return s.nextPoint.sub(u.at(-2)).unit()}computeSegPrevDir(s,u){return u[1].sub(s.prevPoint).unit()}clipLinesToTile(s,u){return jS(s,-u,-u,Jt+u,Jt+u)}clipRuntimeLinesToTile(s,u){const h=[];return[jS(s,-u,-u,Jt+u,Jt+u,h),h]}addElevatedRoadFeature(s,u,h,p,_,v,w,A){const R=[],O=Wi.getElevationFeature(s,p);if(O){const D=this.clipLinesToTile(u,1),z=this.prepareElevatedLines(D,O,h);for(const V of z)R.push({geometry:V,elevation:O,elevationTileID:h,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(R.length===0)return!1;for(const D of R){const z=this.layoutVertexArray.length;this.addLine(D.geometry,s,h,_,v,w,A);const V=new ls(h,D.elevationTileID);if(D.elevation)for(let H=z;H<this.layoutVertexArray.length;H++){const K=new je(this.layoutVertexArray.int16[6*H]>>1,this.layoutVertexArray.int16[6*H+1]>>1),re=V.pointElevation(K,D.elevation,.05);this.updateHeightRange(re),this.zOffsetVertexArray.emplaceBack(re,0,0)}else this.fillNonElevatedRoadSegment(z)}return!0}prepareElevatedLines(s,u,h){if(u.constantHeight!=null)return s;const p=[],_=1/ae(h);for(const v of s)lse(v,new Ni(u,_),0,p);return p}fillNonElevatedRoadSegment(s){for(let u=s;u<this.layoutVertexArray.length;u++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(s){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,s),this.heightRange.max=Math.max(this.heightRange.max,s)):this.heightRange={min:s,max:s}}addLine(s,u,h,p,_,v,w,A,R){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=R?this.lineFeatureClips(u,R):this.lineClips;const O=p==="none";this.patternJoinNone=this.hasPattern&&O,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const D=A&&A.progress.min>0,z=A&&A.progress.max<1;if(this.lineClips){let $e={min:this.lineClips.start,max:this.lineClips.end},mt=1;if(A){const kt=this.lineClips.end-this.lineClips.start;$e=function(It,zt,Bt){return{min:Ji(It.min,zt,Bt),max:Ji(It.max,zt,Bt)}}(A.progress,{min:0,max:1},$e),kt>0&&(mt=($e.max-$e.min)/kt)}const Xe=+u.properties.mapbox_clip_feature_len,vt=+u.properties.mapbox_clip_seg_len;if(Number.isNaN(Xe)||Number.isNaN(vt)){for(let It=0;It<s.length-1;It++)this.totalDistance+=s[It].dist(s[It+1]);const kt=this.totalDistance/($e.max-$e.min);this.totalFeatureLength=Number.isFinite(kt)?kt:0,this.lineClips.start=$e.min,this.lineClips.end=$e.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Xe,this.distance=vt*mt,this.lineClips.start=$e.min,this.lineClips.end=$e.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const V=Yse[u.type]==="Polygon";let H=s.length;for(;H>=2&&s[H-1].equals(s[H-2]);)H--;let K=0;for(;K<H-1&&s[K].equals(s[K+1]);)K++;if(H<(V?3:2))return;p==="bevel"&&(v=1.05);const re=this.segments.prepareSegment(10*H,this.layoutVertexArray,this.indexArray);let ne,ue,he,ge,ke,Ee,Pe,Be;A&&A.prevDir&&(Ee=A.prevDir.perp()),A&&A.nextDir&&(Pe=A.nextDir.perp()),this.e1=this.e2=-1,V&&(ne=s[H-2],ke=s[K].sub(ne)._unit()._perp());for(let $e=K;$e<H;$e++){if(he=$e===H-1?V?s[K+1]:void 0:s[$e+1],he&&s[$e].equals(he))continue;ke&&(ge=ke),ne&&(ue=ne),ne=s[$e],Be=this.evaluateLineProgressFeatures(ue?ue.dist(ne):0),ke=he?he.sub(ne)._unit()._perp():ge,ge=ge||ke;const mt=ue&&he;let Xe=mt?p:V||O?"butt":_;const vt=ge.x*ke.x+ge.y*ke.y;if(O){const gt=function(Dt){if(Dt.patternJoinNone){const tn=Dt.segmentPoints.length/2,$t=Dt.lineSoFar-Dt.segmentStart;for(let Bn=0;Bn<tn;++Bn){const pn=Dt.segmentPoints[2*Bn+1],xn=Math.round(Dt.segmentPoints[2*Bn])+.5+.25*pn;Dt.patternVertexArray.emplaceBack(xn,$t,Dt.segmentStart),Dt.patternVertexArray.emplaceBack(xn,$t,Dt.segmentStart)}Dt.segmentPoints.length=0}Dt.e1=Dt.e2=-1};if(mt&&vt<Qse){this.updateDistance(ue,ne),this.addCurrentVertex(ne,ge,1,1,re,Be),gt(this),this.addCurrentVertex(ne,ke,-1,-1,re,Be);continue}if(ue){if(!he){this.updateDistance(ue,ne),this.addCurrentVertex(ne,ge,1,1,re,Be),gt(this);continue}Xe="miter"}}let kt=ge.add(ke);kt.x===0&&kt.y===0||kt._unit();const It=kt.x*ke.x+kt.y*ke.y,zt=It!==0?1/It:1/0,Bt=2*Math.sqrt(2-2*It),Ot=It<Kse&&ue&&he,Lt=ge.x*ke.y-ge.y*ke.x>0,yt=this.overscaling<=16?15*Jt/(512*this.overscaling):0;if(mt&&Xe==="round"){if(zt<w)Xe="miter";else if(zt<=2){const gt=k6(ne,-10,Jt+10);Xe=this.elevationType==="offset"&&(gt||this.hasCrossSlope)?"miter":"fakeround"}}if(Xe==="miter"&&zt>v&&(Xe="bevel"),Xe==="bevel"&&(zt>2&&(Xe="flipbevel"),zt<v&&(Xe="miter")),ue&&!(Xe==="miter"&&Ot)&&this.updateDistance(ue,ne),Xe==="miter")if(Ot){const gt=ne.dist(ue);if(gt>2*yt){const tn=ne.sub(ne.sub(ue)._mult(yt/gt)._round());this.updateDistance(ue,tn),this.addCurrentVertex(tn,ge,0,0,re,Be),ue=tn}this.updateDistance(ue,ne),kt._mult(zt),this.addCurrentVertex(ne,kt,0,0,re,Be);const Dt=ne.dist(he);if(Dt>2*yt){const tn=ne.add(he.sub(ne)._mult(yt/Dt)._round());this.updateDistance(ne,tn),this.addCurrentVertex(tn,ke,0,0,re,Be),ne=tn}}else kt._mult(zt),this.addCurrentVertex(ne,kt,0,0,re,Be);else if(Xe==="flipbevel"){if(zt>100)kt=ke.mult(-1);else{const gt=zt*ge.add(ke).mag()/ge.sub(ke).mag();kt._perp()._mult(gt*(Lt?-1:1))}this.addCurrentVertex(ne,kt,0,0,re,Be),this.addCurrentVertex(ne,kt.mult(-1),0,0,re,Be)}else if(Xe==="bevel"||Xe==="fakeround"){Be!=null&&ue&&this.addCurrentVertex(ne,Pe||ge,-1,-1,re,Be);const gt=ne.dist(ue)<=2*yt&&Xe!=="bevel",Dt=kt.mult(Lt?1:-1);Dt._mult(zt);const tn=ke.mult(Lt?-1:1),$t=ge.mult(Lt?-1:1),Bn=this.evaluateLineProgressFeatures(this.distance);if(Be==null&&(this.addHalfVertex(ne,Dt.x,Dt.y,!1,!Lt,0,re,Bn),gt||this.addHalfVertex(ne,Dt.x+2*$t.x,Dt.y+2*$t.y,!1,Lt,0,re,Bn)),Xe==="fakeround"){const pn=Math.round(180*Bt/Math.PI/20);this.addHalfVertex(ne,$t.x,$t.y,!1,Lt,0,re,Bn);for(let xn=0;xn<pn;xn++){let Rn=xn/pn;if(Rn!==.5){const Zt=Rn-.5;Rn+=Rn*Zt*(Rn-1)*((1.0904+vt*(vt*(3.55645-1.43519*vt)-3.2452))*Zt*Zt+(.848013+vt*(.215638*vt-1.06021)))}const Jr=tn.sub($t)._mult(Rn)._add($t)._unit();this.addHalfVertex(ne,Jr.x,Jr.y,!1,Lt,0,re,Bn)}this.addHalfVertex(ne,tn.x,tn.y,!1,Lt,0,re,Bn)}gt||Be!=null||this.addHalfVertex(ne,Dt.x+2*tn.x,Dt.y+2*tn.y,!1,Lt,0,re,Bn),Be!=null&&he&&this.addCurrentVertex(ne,Ee||ke,1,1,re,Be)}else if(Xe==="butt")this.addCurrentVertex(ne,kt,0,0,re,Be);else if(Xe==="square"){if(!ue){const gt=D?0:-1;this.addCurrentVertex(ne,kt,gt,gt,re,Be)}if(this.addCurrentVertex(ne,kt,0,0,re,Be),ue){const gt=z?0:1;this.addCurrentVertex(ne,kt,gt,gt,re,Be)}}else if(Xe==="round"){if(ue){const gt=!mt&&Pe?Pe:ge;this.addCurrentVertex(ne,gt,0,0,re,Be),!mt&&z||this.addCurrentVertex(ne,gt,1,1,re,Be,!0)}if(he){const gt=!mt&&Ee?Ee:ke;!mt&&D||this.addCurrentVertex(ne,gt,-1,-1,re,Be,!0),this.addCurrentVertex(ne,gt,0,0,re,Be)}}}}addVerticesTo(s,u,h,p,_,v,w,A,R,O){const D=(u.w-s.w)/this.tessellationStep|0;let z=0;const V=this.scaledDistance;if(D>1){this.lineSoFar=s.w;const K=(u.x-s.x)/D,re=(u.y-s.y)/D,ne=(u.z-s.z)/D,ue=(u.w-s.w)/D;for(let he=1;he<D;++he){s.x+=K,s.y+=re,s.z+=ne,this.lineSoFar+=ue,z+=ue;const ge=this.evaluateLineProgressFeatures(this.prevDistance+z);this.scaledDistance=(this.prevDistance+z)/this.totalDistance,this.addHalfVertex(s,h,p,O,!1,w,R,ge),this.addHalfVertex(s,_,v,O,!0,-A,R,ge)}}this.lineSoFar=u.w,this.scaledDistance=V;const H=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(u,h,p,O,!1,w,R,H),this.addHalfVertex(u,_,v,O,!0,-A,R,H)}evaluateLineProgressFeatures(s){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+s)/this.totalFeatureLength):Qt(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let u=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(u=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:u}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:u}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:u}}addCurrentVertex(s,u,h,p,_,v,w=!1){const A=u.x+u.y*h,R=u.y-u.x*h,O=u.y*p-u.x,D=-u.y-u.x*p;if(v!=null){const z=this.elevationType==="offset",V=-10,H=Jt+10,K=v.zOffset,re=new qz(s.x,s.y,K,this.lineSoFar),ne=!!z&&k6(s,V,H),ue=this.lineSoFar,he=this.distance;if(this.currentVertex)if(ne){const ge=this.currentVertexIsOutside,ke=this.currentVertex,Ee=new qz(s.x,s.y,K,this.lineSoFar);if(Wz(ke,Ee,V,H),!k6(Ee,V,H)){if(ge){this.e1=this.e2=-1,this.distance-=ke.dist(re),this.lineSoFar=ke.w;const Pe=this.evaluateLineProgressFeatures(ke.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ke,A,R,w,!1,h,_,Pe),this.addHalfVertex(ke,O,D,w,!0,-p,_,Pe),this.prevDistance=this.distance}this.distance=this.prevDistance+ke.dist(Ee),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ke,Ee,A,R,O,D,h,p,_,w),this.distance=he,this.scaledDistance=this.distance/this.totalDistance}}else{const ge=this.currentVertex;if(this.currentVertexIsOutside){Wz(ge,re,V,H),this.e1=this.e2=-1,this.distance-=ge.dist(re),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ge.w;const ke=this.evaluateLineProgressFeatures(ge.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ge,A,R,w,!1,h,_,ke),this.addHalfVertex(ge,O,D,w,!0,-p,_,ke),this.prevDistance=this.distance,this.distance=he,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ge,re,A,R,O,D,h,p,_,w)}else ne||(this.addHalfVertex(s,A,R,w,!1,h,_,v),this.addHalfVertex(s,O,D,w,!0,-p,_,v));this.currentVertex=re,this.currentVertexIsOutside=ne,this.lineSoFar=ue}else this.addHalfVertex(s,A,R,w,!1,h,_,v),this.addHalfVertex(s,O,D,w,!0,-p,_,v)}addHalfVertex({x:s,y:u},h,p,_,v,w,A,R){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),v||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((s<<1)+(_?1:0),(u<<1)+(v?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const D=Tr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,D)}const O=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),A.primitiveLength++),v?this.e2=O:this.e1=O,R!=null&&this.zOffsetVertexArray.emplaceBack(R.zOffset,R.variableWidth,R.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(s,u){this.prevDistance=this.distance,this.distance+=s.dist(u),this.updateScaledDistance()}}function k6(c,s,u){return c.x<s||c.x>u||c.y<s||c.y>u}let S7,A7;function C7(c,s,u){return s*(Jt/(c.tileSize*Math.pow(2,u-c.tileID.overscaledZ)))}En(C6,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const k7=(c,s,u)=>(1-u)*c+u*s;function I7(c,s){return 1/C7(c,1,s.tileZoom)}function R7(c,s,u,h){return c.translatePosMatrix(h||s.tileID.projMatrix,s,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const M7=c=>{const s=[];P7(c)&&s.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&s.push("RENDER_LINE_GRADIENT");const u=c.paint.get("line-trim-offset");u[0]===0&&u[1]===0||s.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&s.push("RENDER_LINE_BORDER");const h=c.layout.get("line-join").constantOr("miter")==="none",p=!!c.paint.get("line-pattern").constantOr(1);return h&&p&&s.push("LINE_JOIN_NONE"),s};function P7(c){const s=c.paint.get("line-dasharray").value;return s.kind!=="constant"||s.value}let I6;const O7=()=>I6||(I6={layout:S7||(S7=new xa({"line-cap":new an(Qe.layout_line["line-cap"]),"line-join":new an(Qe.layout_line["line-join"]),"line-miter-limit":new Wt(Qe.layout_line["line-miter-limit"]),"line-round-limit":new Wt(Qe.layout_line["line-round-limit"]),"line-sort-key":new an(Qe.layout_line["line-sort-key"]),"line-z-offset":new an(Qe.layout_line["line-z-offset"]),"line-elevation-reference":new Wt(Qe.layout_line["line-elevation-reference"]),"line-cross-slope":new Wt(Qe.layout_line["line-cross-slope"]),visibility:new Wt(Qe.layout_line.visibility),"line-width-unit":new Wt(Qe.layout_line["line-width-unit"])})),paint:A7||(A7=new xa({"line-opacity":new an(Qe.paint_line["line-opacity"]),"line-color":new an(Qe.paint_line["line-color"]),"line-translate":new Wt(Qe.paint_line["line-translate"]),"line-translate-anchor":new Wt(Qe.paint_line["line-translate-anchor"]),"line-width":new an(Qe.paint_line["line-width"]),"line-gap-width":new an(Qe.paint_line["line-gap-width"]),"line-offset":new an(Qe.paint_line["line-offset"]),"line-blur":new an(Qe.paint_line["line-blur"]),"line-dasharray":new an(Qe.paint_line["line-dasharray"]),"line-pattern":new an(Qe.paint_line["line-pattern"]),"line-pattern-cross-fade":new Wt(Qe.paint_line["line-pattern-cross-fade"]),"line-gradient":new Gf(Qe.paint_line["line-gradient"]),"line-trim-offset":new Wt(Qe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Wt(Qe.paint_line["line-trim-fade-range"]),"line-trim-color":new Wt(Qe.paint_line["line-trim-color"]),"line-emissive-strength":new an(Qe.paint_line["line-emissive-strength"]),"line-border-width":new an(Qe.paint_line["line-border-width"]),"line-border-color":new an(Qe.paint_line["line-border-color"]),"line-occlusion-opacity":new Wt(Qe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},I6);class Jse extends an{possiblyEvaluate(s,u){return u=new zs(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,transition:u.transition,worldview:u.worldview}),super.possiblyEvaluate(s,u)}evaluate(s,u,h,p){return u=Object.assign({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(s,u,h,p)}}let _w;function L7(c,s){return s>0?s+2*c:c}const eae=hi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),tae=hi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),nae=hi([{name:"a_projected_pos",components:4,type:"Float32"}],4);hi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const rae=hi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),iae=hi([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),sae=hi([{name:"a_texb",components:2,type:"Uint16"}]),aae=hi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),oae=hi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);hi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const D7=hi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),lae=hi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);hi([{name:"triangle",components:3,type:"Uint16"}]),hi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),hi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),hi([{type:"Float32",name:"offsetX"}]),hi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var So=24;function uae(c,s,u){return c.sections.forEach(h=>{h.text=function(p,_,v){const w=_.layout.get("text-transform").evaluate(v,{});return w==="uppercase"?p=p.toLocaleUpperCase():w==="lowercase"&&(p=p.toLocaleLowerCase()),Fd.applyArabicShaping&&(p=Fd.applyArabicShaping(p)),p}(h.text,s,u)}),c}const yw={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function cae(c){return c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""}function dae(c){return c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""}const R6=4294967296,N7=1/R6,z7=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let KS=class{constructor(c=new Uint8Array(16)){this.buf=ArrayBuffer.isView(c)?c:new Uint8Array(c),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(c,s,u=this.length){for(;this.pos<u;){const h=this.readVarint(),p=h>>3,_=this.pos;this.type=7&h,c(p,s,this),this.pos===_&&this.skip(h)}return s}readMessage(c,s){return this.readFields(c,s,this.readVarint()+this.pos)}readFixed32(){const c=this.dataView.getUint32(this.pos,!0);return this.pos+=4,c}readSFixed32(){const c=this.dataView.getInt32(this.pos,!0);return this.pos+=4,c}readFixed64(){const c=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*R6;return this.pos+=8,c}readSFixed64(){const c=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*R6;return this.pos+=8,c}readFloat(){const c=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,c}readDouble(){const c=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,c}readVarint(c){const s=this.buf;let u,h;return h=s[this.pos++],u=127&h,h<128?u:(h=s[this.pos++],u|=(127&h)<<7,h<128?u:(h=s[this.pos++],u|=(127&h)<<14,h<128?u:(h=s[this.pos++],u|=(127&h)<<21,h<128?u:(h=s[this.pos],u|=(15&h)<<28,function(p,_,v){const w=v.buf;let A,R;if(R=w[v.pos++],A=(112&R)>>4,R<128||(R=w[v.pos++],A|=(127&R)<<3,R<128)||(R=w[v.pos++],A|=(127&R)<<10,R<128)||(R=w[v.pos++],A|=(127&R)<<17,R<128)||(R=w[v.pos++],A|=(127&R)<<24,R<128)||(R=w[v.pos++],A|=(1&R)<<31,R<128))return S1(p,A,_);throw new Error("Expected varint not more than 10 bytes")}(u,c,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const c=this.readVarint();return c%2==1?(c+1)/-2:c/2}readBoolean(){return!!this.readVarint()}readString(){const c=this.readVarint()+this.pos,s=this.pos;return this.pos=c,c-s>=12&&z7?z7.decode(this.buf.subarray(s,c)):function(u,h,p){let _="",v=h;for(;v<p;){const w=u[v];let A,R,O,D=null,z=w>239?4:w>223?3:w>191?2:1;if(v+z>p)break;z===1?w<128&&(D=w):z===2?(A=u[v+1],(192&A)==128&&(D=(31&w)<<6|63&A,D<=127&&(D=null))):z===3?(A=u[v+1],R=u[v+2],(192&A)==128&&(192&R)==128&&(D=(15&w)<<12|(63&A)<<6|63&R,(D<=2047||D>=55296&&D<=57343)&&(D=null))):z===4&&(A=u[v+1],R=u[v+2],O=u[v+3],(192&A)==128&&(192&R)==128&&(192&O)==128&&(D=(15&w)<<18|(63&A)<<12|(63&R)<<6|63&O,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,z=1):D>65535&&(D-=65536,_+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),_+=String.fromCharCode(D),v+=z}return _}(this.buf,s,c)}readBytes(){const c=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,c);return this.pos=c,s}readPackedVarint(c=[],s){const u=this.readPackedEnd();for(;this.pos<u;)c.push(this.readVarint(s));return c}readPackedSVarint(c=[]){const s=this.readPackedEnd();for(;this.pos<s;)c.push(this.readSVarint());return c}readPackedBoolean(c=[]){const s=this.readPackedEnd();for(;this.pos<s;)c.push(this.readBoolean());return c}readPackedFloat(c=[]){const s=this.readPackedEnd();for(;this.pos<s;)c.push(this.readFloat());return c}readPackedDouble(c=[]){const s=this.readPackedEnd();for(;this.pos<s;)c.push(this.readDouble());return c}readPackedFixed32(c=[]){const s=this.readPackedEnd();for(;this.pos<s;)c.push(this.readFixed32());return c}readPackedSFixed32(c=[]){const s=this.readPackedEnd();for(;this.pos<s;)c.push(this.readSFixed32());return c}readPackedFixed64(c=[]){const s=this.readPackedEnd();for(;this.pos<s;)c.push(this.readFixed64());return c}readPackedSFixed64(c=[]){const s=this.readPackedEnd();for(;this.pos<s;)c.push(this.readSFixed64());return c}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(c){const s=7&c;if(s===0)for(;this.buf[this.pos++]>127;);else if(s===2)this.pos=this.readVarint()+this.pos;else if(s===5)this.pos+=4;else{if(s!==1)throw new Error(`Unimplemented type: ${s}`);this.pos+=8}}writeTag(c,s){this.writeVarint(c<<3|s)}realloc(c){let s=this.length||16;for(;s<this.pos+c;)s*=2;if(s!==this.length){const u=new Uint8Array(s);u.set(this.buf),this.buf=u,this.dataView=new DataView(u.buffer),this.length=s}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(c){this.realloc(4),this.dataView.setInt32(this.pos,c,!0),this.pos+=4}writeSFixed32(c){this.realloc(4),this.dataView.setInt32(this.pos,c,!0),this.pos+=4}writeFixed64(c){this.realloc(8),this.dataView.setInt32(this.pos,-1&c,!0),this.dataView.setInt32(this.pos+4,Math.floor(c*N7),!0),this.pos+=8}writeSFixed64(c){this.realloc(8),this.dataView.setInt32(this.pos,-1&c,!0),this.dataView.setInt32(this.pos+4,Math.floor(c*N7),!0),this.pos+=8}writeVarint(c){(c=+c||0)>268435455||c<0?function(s,u){let h,p;if(s>=0?(h=s%4294967296|0,p=s/4294967296|0):(h=~(-s%4294967296),p=~(-s/4294967296),4294967295^h?h=h+1|0:(h=0,p=p+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(_,v,w){w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,w.buf[w.pos]=127&(_>>>=7)}(h,0,u),function(_,v){const w=(7&_)<<4;v.buf[v.pos++]|=w|((_>>>=3)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_)))))}(p,u)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))}writeSVarint(c){this.writeVarint(c<0?2*-c-1:2*c)}writeBoolean(c){this.writeVarint(+c)}writeString(c){c=String(c),this.realloc(4*c.length),this.pos++;const s=this.pos;this.pos=function(h,p,_){for(let v,w,A=0;A<p.length;A++){if(v=p.charCodeAt(A),v>55295&&v<57344){if(!w){v>56319||A+1===p.length?(h[_++]=239,h[_++]=191,h[_++]=189):w=v;continue}if(v<56320){h[_++]=239,h[_++]=191,h[_++]=189,w=v;continue}v=w-55296<<10|v-56320|65536,w=null}else w&&(h[_++]=239,h[_++]=191,h[_++]=189,w=null);v<128?h[_++]=v:(v<2048?h[_++]=v>>6|192:(v<65536?h[_++]=v>>12|224:(h[_++]=v>>18|240,h[_++]=v>>12&63|128),h[_++]=v>>6&63|128),h[_++]=63&v|128)}return _}(this.buf,c,this.pos);const u=this.pos-s;u>=128&&F7(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u}writeFloat(c){this.realloc(4),this.dataView.setFloat32(this.pos,c,!0),this.pos+=4}writeDouble(c){this.realloc(8),this.dataView.setFloat64(this.pos,c,!0),this.pos+=8}writeBytes(c){const s=c.length;this.writeVarint(s),this.realloc(s);for(let u=0;u<s;u++)this.buf[this.pos++]=c[u]}writeRawMessage(c,s){this.pos++;const u=this.pos;c(s,this);const h=this.pos-u;h>=128&&F7(u,h,this),this.pos=u-1,this.writeVarint(h),this.pos+=h}writeMessage(c,s,u){this.writeTag(c,2),this.writeRawMessage(s,u)}writePackedVarint(c,s){s.length&&this.writeMessage(c,hae,s)}writePackedSVarint(c,s){s.length&&this.writeMessage(c,fae,s)}writePackedBoolean(c,s){s.length&&this.writeMessage(c,gae,s)}writePackedFloat(c,s){s.length&&this.writeMessage(c,pae,s)}writePackedDouble(c,s){s.length&&this.writeMessage(c,mae,s)}writePackedFixed32(c,s){s.length&&this.writeMessage(c,_ae,s)}writePackedSFixed32(c,s){s.length&&this.writeMessage(c,yae,s)}writePackedFixed64(c,s){s.length&&this.writeMessage(c,vae,s)}writePackedSFixed64(c,s){s.length&&this.writeMessage(c,xae,s)}writeBytesField(c,s){this.writeTag(c,2),this.writeBytes(s)}writeFixed32Field(c,s){this.writeTag(c,5),this.writeFixed32(s)}writeSFixed32Field(c,s){this.writeTag(c,5),this.writeSFixed32(s)}writeFixed64Field(c,s){this.writeTag(c,1),this.writeFixed64(s)}writeSFixed64Field(c,s){this.writeTag(c,1),this.writeSFixed64(s)}writeVarintField(c,s){this.writeTag(c,0),this.writeVarint(s)}writeSVarintField(c,s){this.writeTag(c,0),this.writeSVarint(s)}writeStringField(c,s){this.writeTag(c,2),this.writeString(s)}writeFloatField(c,s){this.writeTag(c,5),this.writeFloat(s)}writeDoubleField(c,s){this.writeTag(c,1),this.writeDouble(s)}writeBooleanField(c,s){this.writeVarintField(c,+s)}};function S1(c,s,u){return u?4294967296*s+(c>>>0):4294967296*(s>>>0)+(c>>>0)}function F7(c,s,u){const h=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));u.realloc(h);for(let p=u.pos-1;p>=c;p--)u.buf[p+h]=u.buf[p]}function hae(c,s){for(let u=0;u<c.length;u++)s.writeVarint(c[u])}function fae(c,s){for(let u=0;u<c.length;u++)s.writeSVarint(c[u])}function pae(c,s){for(let u=0;u<c.length;u++)s.writeFloat(c[u])}function mae(c,s){for(let u=0;u<c.length;u++)s.writeDouble(c[u])}function gae(c,s){for(let u=0;u<c.length;u++)s.writeBoolean(c[u])}function _ae(c,s){for(let u=0;u<c.length;u++)s.writeFixed32(c[u])}function yae(c,s){for(let u=0;u<c.length;u++)s.writeSFixed32(c[u])}function vae(c,s){for(let u=0;u<c.length;u++)s.writeFixed64(c[u])}function xae(c,s){for(let u=0;u<c.length;u++)s.writeSFixed64(c[u])}const M6=3;function bae(c,s,u){s.glyphs=[],c===1&&u.readMessage(wae,s)}function wae(c,s,u){if(c===3){const{id:h,bitmap:p,width:_,height:v,left:w,top:A,advance:R}=u.readMessage(Tae,{});s.glyphs.push({id:h,bitmap:new gm({width:_+2*M6,height:v+2*M6},p),metrics:{width:_,height:v,left:w,top:A,advance:R}})}else c===4?s.ascender=u.readSVarint():c===5&&(s.descender=u.readSVarint())}function Tae(c,s,u){c===1?s.id=u.readVarint():c===2?s.bitmap=u.readBytes():c===3?s.width=u.readVarint():c===4?s.height=u.readVarint():c===5?s.left=u.readSVarint():c===6?s.top=u.readSVarint():c===7&&(s.advance=u.readVarint())}const B7=M6,Tu={horizontal:1,vertical:2,horizontalOnly:3};class vw{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(s,u){const h=new vw;return h.scale=s||1,h.fontStack=u,h}static forImage(s){const u=new vw;return u.image=s,u}}class A1{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,u,h){const p=new A1;for(let _=0;_<s.sections.length;_++){const v=s.sections[_];v.image?p.addImageSection(v,h):p.addTextSection(v,u)}return p}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSections(){return this.sections}getSectionIndex(s){return this.sectionIndex[s]}getCodePoint(s){return this.text.codePointAt(s)}verticalizePunctuation(s){this.text=function(u,h){let p="";for(let _=0;_<u.length;_++){const v=u.charCodeAt(_+1)||null,w=u.charCodeAt(_-1)||null;p+=!h&&(v&&Vy(v)&&!yw[u[_+1]]||w&&Vy(w)&&!yw[u[_-1]])||!yw[u[_]]?u[_]:yw[u[_]]}return p}(this.text,s)}trim(){let s=0;for(let h=0;h<this.text.length&&QS[this.text.charCodeAt(h)];h++)s++;let u=this.text.length;for(let h=this.text.length-1;h>=0&&h>=s&&QS[this.text.charCodeAt(h)];h--)u--;this.text=this.text.substring(s,u),this.sectionIndex=this.sectionIndex.slice(s,u)}substring(s,u){const h=new A1;return h.text=this.text.substring(s,u),h.sectionIndex=this.sectionIndex.slice(s,u),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,u)=>Math.max(s,this.sections[u].scale),0)}addTextSection(s,u){this.text+=s.text,this.sections.push(vw.forText(s.scale,s.fontStack||u));const h=this.sections.length-1;for(let p=0;p<s.text.length;++p)this.sectionIndex.push(h)}addImageSection(s,u){const h=s.image?s.image.getPrimary():null;if(!h)return void Qt("Can't add FormattedSection with an empty image.");h.scaleSelf(u);const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCodePoint(p),this.sections.push(vw.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Qt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function P6(c,s,u,h,p,_,v,w,A,R,O,D,z,V,H,K=1){const re=A1.fromFeature(c,p,K);D===Tu.vertical&&re.verticalizePunctuation(z);let ne=[];const ue=function(Pe,Be,$e,mt,Xe,vt){if(!Pe)return[];const kt=[],It=function(Lt,yt,gt,Dt,tn,$t){let Bn=0;for(let pn=0;pn<Lt.length();pn++){const xn=Lt.getSection(pn);Bn+=j7(Lt.getCodePoint(pn),xn,Dt,tn,yt,$t)}return Bn/Math.max(1,Math.ceil(Bn/gt))}(Pe,Be,$e,mt,Xe,vt),zt=Pe.text.indexOf("")>=0;let Bt=0;for(let Lt=0;Lt<Pe.length();Lt++){const yt=Pe.getSection(Lt),gt=Pe.getCodePoint(Lt);if(QS[gt]||(Bt+=j7(gt,yt,mt,Xe,Be,vt)),Lt<Pe.length()-1){const Dt=!((Ot=gt)<11904||!(fr["Bopomofo Extended"](Ot)||fr.Bopomofo(Ot)||fr["CJK Compatibility Forms"](Ot)||fr["CJK Compatibility Ideographs"](Ot)||fr["CJK Compatibility"](Ot)||fr["CJK Radicals Supplement"](Ot)||fr["CJK Strokes"](Ot)||fr["CJK Symbols and Punctuation"](Ot)||fr["CJK Unified Ideographs Extension A"](Ot)||fr["CJK Unified Ideographs"](Ot)||fr["Enclosed CJK Letters and Months"](Ot)||fr["Halfwidth and Fullwidth Forms"](Ot)||fr.Hiragana(Ot)||fr["Ideographic Description Characters"](Ot)||fr["Kangxi Radicals"](Ot)||fr["Katakana Phonetic Extensions"](Ot)||fr.Katakana(Ot)||fr["Vertical Forms"](Ot)||fr["Yi Radicals"](Ot)||fr["Yi Syllables"](Ot)));(Eae[gt]||Dt||yt.image)&&kt.push(V7(Lt+1,Bt,It,kt,Sae(gt,Pe.getCodePoint(Lt+1),Dt&&zt),!1))}}var Ot;return $7(V7(Pe.length(),Bt,It,kt,0,!0))}(re,R,_,s,h,V),{processBidirectionalText:he,processStyledBidirectionalText:ge}=Fd;if(he&&re.sections.length===1){const Pe=he(re.toString(),ue);for(const Be of Pe){const $e=new A1;$e.text=Be,$e.sections=re.sections;for(let mt=0;mt<Be.length;mt++)$e.sectionIndex.push(0);ne.push($e)}}else if(ge){const Pe=ge(re.text,re.sectionIndex,ue);for(const Be of Pe){const $e=new A1;$e.text=Be[0],$e.sectionIndex=Be[1],$e.sections=re.sections,ne.push($e)}}else ne=function(Pe,Be){const $e=[],mt=Pe.text;let Xe=0;for(const vt of Be)$e.push(Pe.substring(Xe,vt)),Xe=vt;return Xe<mt.length&&$e.push(Pe.substring(Xe,mt.length)),$e}(re,ue);const ke=[],Ee={positionedLines:ke,text:re.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Pe,Be,$e,mt,Xe,vt,kt,It,zt,Bt,Ot,Lt){let yt=0,gt=0,Dt=0;const tn=It==="right"?1:It==="left"?0:.5;let $t=!1;for(const Zt of Xe){const Pn=Zt.getSections();for(const Or of Pn){if(Or.image)continue;const gi=Be[Or.fontStack];if(gi&&($t=gi.ascender!==void 0&&gi.descender!==void 0,!$t))break}if(!$t)break}let Bn=0;for(const Zt of Xe){Zt.trim();const Pn=Zt.getMaxScale(),Or=(Pn-1)*So,gi={positionedGlyphs:[],lineOffset:0};Pe.positionedLines[Bn]=gi;const Ei=gi.positionedGlyphs;let jr=0;if(!Zt.length()){gt+=vt,++Bn;continue}let hs=0,Se=0;for(let bt=0;bt<Zt.length();bt++){const Ft=Zt.getSection(bt),ln=Zt.getSectionIndex(bt),un=Zt.getCodePoint(bt);let Un=Ft.scale,Yn=null,zr=null,qr=null,Yr=So,fi=0,_r=zt;_r===Tu.vertical&&((pn=un)===12312||pn===12313||pn===12316||pn===12540||pn===12448)&&(_r=Tu.horizontal);const Pr=!(_r===Tu.horizontal||!Ot&&!Uy(un)||Ot&&(QS[un]||$y(un)));if(Ft.image){const Pi=mt.get(Ft.image.toString());if(!Pi)continue;qr=Ft.image,Pe.iconsInText=Pe.iconsInText||!0,zr=Pi.paddedRect;const zi=Pi.displaySize;Un=Un*So/Lt,Yn={width:zi[0],height:zi[1],left:0,top:-B7,advance:Pr?zi[1]:zi[0],localGlyph:!1},fi=$t?-Yn.height*Un:Pn*So-17-zi[1]*Un,Yr=Yn.advance;const Fi=(Pr?zi[0]:zi[1])*Un-So*Pn;Fi>0&&Fi>jr&&(jr=Fi)}else{const Pi=$e[Ft.fontStack];if(!Pi)continue;Pi[un]&&(zr=Pi[un]);const zi=Be[Ft.fontStack];if(!zi)continue;const Fi=zi.glyphs[un];if(!Fi)continue;if(Yn=Fi.metrics,Yr=un!==8203?So:0,$t){const rs=zi.ascender!==void 0?Math.abs(zi.ascender):0,ws=zi.descender!==void 0?Math.abs(zi.descender):0,fs=(rs+ws)*Un;hs<fs&&(hs=fs,Se=(rs-ws)/2*Un),fi=-rs*Un}else fi=(Pn-Un)*So-17}Pr?(Pe.verticalizable=!0,Ei.push({glyph:un,image:qr,x:yt,y:gt+fi,vertical:Pr,scale:Un,localGlyph:Yn.localGlyph,fontStack:Ft.fontStack,sectionIndex:ln,metrics:Yn,rect:zr}),yt+=Yr*Un+Bt):(Ei.push({glyph:un,image:qr,x:yt,y:gt+fi,vertical:Pr,scale:Un,localGlyph:Yn.localGlyph,fontStack:Ft.fontStack,sectionIndex:ln,metrics:Yn,rect:zr}),yt+=Yn.advance*Un+Bt)}Ei.length!==0&&(Dt=Math.max(yt-Bt,Dt),$t?H7(Ei,tn,jr,Se,vt*Pn/2):H7(Ei,tn,jr,0,vt/2)),yt=0;const Ie=vt*Pn+jr;gi.lineOffset=Math.max(jr,Or),gt+=Ie,++Bn}var pn;const xn=gt,{horizontalAlign:Rn,verticalAlign:Jr}=O6(kt);(function(Zt,Pn,Or,gi,Ei,jr){const hs=(Pn-Or)*Ei,Se=-jr*gi;for(const Ie of Zt)for(const bt of Ie.positionedGlyphs)bt.x+=hs,bt.y+=Se})(Pe.positionedLines,tn,Rn,Jr,Dt,xn),Pe.top+=-Jr*xn,Pe.bottom=Pe.top+xn,Pe.left+=-Rn*Dt,Pe.right=Pe.left+Dt,Pe.hasBaseline=$t}(Ee,s,u,h,ne,v,w,A,D,R,z,H),!function(Pe){for(const Be of Pe)if(Be.positionedGlyphs.length!==0)return!1;return!0}(ke))return Ee}const QS={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Eae={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function j7(c,s,u,h,p,_){if(s.image){const v=h.get(s.image.toString());return v?v.displaySize[0]*s.scale*So/_+p:0}{const v=u[s.fontStack],w=v&&v.glyphs[c];return w?w.metrics.advance*s.scale+p:0}}function U7(c,s,u,h){const p=Math.pow(c-s,2);return h?c<s?p/2:2*p:p+Math.abs(u)*u}function Sae(c,s,u){let h=0;return c===10&&(h-=1e4),u&&(h+=150),c!==40&&c!==65288||(h+=50),s!==41&&s!==65289||(h+=50),h}function V7(c,s,u,h,p,_){let v=null,w=U7(s,u,p,_);for(const A of h){const R=U7(s-A.x,u,p,_)+A.badness;R<=w&&(v=A,w=R)}return{index:c,x:s,priorBreak:v,badness:w}}function $7(c){return c?$7(c.priorBreak).concat(c.index):[]}function O6(c){let s=.5,u=.5;switch(c){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:s,verticalAlign:u}}function H7(c,s,u,h,p){if(!(s||u||h||p))return;const _=c.length-1,v=c[_],w=(v.x+v.metrics.advance*v.scale)*s;for(let A=0;A<=_;A++)c[A].x-=w,c[A].y+=u+h+p}function L6(c){return c.imagePrimary!==void 0&&c.top!==void 0&&c.bottom!==void 0&&c.left!==void 0&&c.right!==void 0}function JS(c,s,u,h){const{horizontalAlign:p,verticalAlign:_}=O6(h),v=u[0]-c.displaySize[0]*p,w=u[1]-c.displaySize[1]*_;return{imagePrimary:c,imageSecondary:s,top:w,bottom:w+c.displaySize[1],left:v,right:v+c.displaySize[0]}}function D6(c,s,u,h,p,_){const v=c.imagePrimary;let w;if(v.content){const re=v.content,ne=v.pixelRatio||1;w=[re[0]/ne,re[1]/ne,v.displaySize[0]-re[2]/ne,v.displaySize[1]-re[3]/ne]}const A=s.left*_,R=s.right*_;let O,D,z,V;u==="width"||u==="both"?(V=p[0]+A-h[3],D=p[0]+R+h[1]):(V=p[0]+(A+R-v.displaySize[0])/2,D=V+v.displaySize[0]);const H=s.top*_,K=s.bottom*_;return u==="height"||u==="both"?(O=p[1]+H-h[0],z=p[1]+K+h[2]):(O=p[1]+(H+K-v.displaySize[1])/2,z=O+v.displaySize[1]),{imagePrimary:v,imageSecondary:void 0,top:O,right:D,bottom:z,left:V,collisionPadding:w}}function G7(c){return!c.imagePrimary.stretchX}function q7(c){return!c.imagePrimary.stretchY}function Z7(c){return{width:c.right-c.left,height:c.bottom-c.top}}const Wd=128;function C1(c,s,u){const{expression:h}=s;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new zs(c+1,{worldview:u}))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:_}=h;let v=0;for(;v<p.length&&p[v]<=c;)v++;v=Math.max(0,v-1);let w=v;for(;w<p.length&&p[w]<c+1;)w++;w=Math.min(p.length-1,w);const A=p[v],R=p[w];return h.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:R,interpolationType:_}:{kind:"camera",minZoom:A,maxZoom:R,minSize:h.evaluate(new zs(A,{worldview:u})),maxSize:h.evaluate(new zs(R,{worldview:u})),interpolationType:_}}}function N6(c,{uSize:s,uSizeT:u},{lowerSize:h,upperSize:p}){return c.kind==="source"?h/Wd:c.kind==="composite"?Tr(h/Wd,p/Wd,u):s}function k1(c,s,u=1){let h=0,p=0;if(c.kind==="constant")p=c.layoutSize*u;else if(c.kind!=="source"){const{interpolationType:_,minZoom:v,maxZoom:w}=c,A=_?ee(yu.interpolationFactor(_,s,v,w),0,1):0;c.kind==="camera"?p=Tr(c.minSize,c.maxSize,A)*u:h=A*u}return{uSizeT:h,uSize:p}}class Jf extends je{constructor(s,u,h,p,_){super(s,u),this.angle=p,this.z=h,_!==void 0&&(this.segment=_)}clone(){return new Jf(this.x,this.y,this.z,this.angle,this.segment)}}function W7(c,s,u,h,p){if(s.segment===void 0)return!0;let _=s,v=s.segment+1,w=0;for(;w>-u/2;){if(v--,v<0)return!1;w-=c[v].dist(_),_=c[v]}w+=c[v].dist(c[v+1]),v++;const A=[];let R=0;for(;w<u/2;){const O=c[v],D=c[v+1];if(!D)return!1;let z=c[v-1].angleTo(O)-O.angleTo(D);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:w,angleDelta:z}),R+=z;w-A[0].distance>h;)R-=A.shift().angleDelta;if(R>p)return!1;v++,w+=O.dist(D)}return!0}function X7(c){let s=0;for(let u=0;u<c.length-1;u++)s+=c[u].dist(c[u+1]);return s}function Y7(c,s,u){return c?.6*s*u:0}function K7(c,s){return Math.max(c?c.right-c.left:0,s?s.right-s.left:0)}function Aae(c,s,u,h,p,_){const v=Y7(u,p,_),w=K7(u,h)*_;let A=0;const R=X7(c)/2;for(let O=0;O<c.length-1;O++){const D=c[O],z=c[O+1],V=D.dist(z);if(A+V>R){const H=(R-A)/V,K=Tr(D.x,z.x,H),re=Tr(D.y,z.y,H),ne=new Jf(K,re,0,z.angleTo(D),O);return!v||W7(c,ne,w,v,s)?ne:void 0}A+=V}}function Cae(c,s,u,h,p,_,v,w,A){const R=Y7(h,_,v),O=K7(h,p),D=O*v,z=c[0].x===0||c[0].x===A||c[0].y===0||c[0].y===A;return s-D<s/4&&(s=D+s/4),Q7(c,z?s/2*w%s:(O/2+2*_)*v*w%s,s,R,u,D,z,!1,A)}function Q7(c,s,u,h,p,_,v,w,A){const R=_/2,O=X7(c);let D=0,z=s-u,V=[];for(let H=0;H<c.length-1;H++){const K=c[H],re=c[H+1],ne=K.dist(re),ue=re.angleTo(K);for(;z+u<D+ne;){z+=u;const he=(z-D)/ne,ge=Tr(K.x,re.x,he),ke=Tr(K.y,re.y,he);if(ge>=0&&ge<A&&ke>=0&&ke<A&&z-R>=0&&z+R<=O){const Ee=new Jf(ge,ke,0,ue,H);h&&!W7(c,Ee,_,h,p)||V.push(Ee)}}D+=ne}return w||V.length||v||(V=Q7(c,D/2,u,h,p,_,v,!0,A)),V}function J7(c){let s=0,u=0;for(const v of c)s+=v.w*v.h,u=Math.max(u,v.w);c.sort((v,w)=>w.h-v.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),u),h:1/0}];let p=0,_=0;for(const v of c)for(let w=h.length-1;w>=0;w--){const A=h[w];if(!(v.w>A.w||v.h>A.h)){if(v.x=A.x,v.y=A.y,_=Math.max(_,v.y+v.h),p=Math.max(p,v.x+v.w),v.w===A.w&&v.h===A.h){const R=h.pop();R&&w<h.length&&(h[w]=R)}else v.h===A.h?(A.x+=v.w,A.w-=v.w):v.w===A.w?(A.y+=v.h,A.h-=v.h):(h.push({x:A.x+v.w,y:A.y,w:A.w-v.w,h:v.h}),A.y+=v.h,A.h-=v.h);break}}return{w:p,h:_,fill:s/(p*_)||0}}En(Jf,"Anchor");const Og=1;class xw{static getImagePositionScale(s,u,h){if(u&&s){const{sx:p,sy:_}=s;return{x:p,y:_}}return{x:h,y:h}}constructor(s,u,h,p){this.paddedRect=s;const{pixelRatio:_,version:v,stretchX:w,stretchY:A,content:R,sdf:O,usvg:D}=u;this.pixelRatio=_,this.stretchX=w,this.stretchY=A,this.content=R,this.version=v,this.padding=h,this.sdf=O,this.usvg=D,this.scale=xw.getImagePositionScale(p,D,_)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function z6(c,s,u){const h=Md.parse(c),p=function(_,v,w=[1,1]){return{x:0,y:0,w:(_.data?_.data.width:_.width*w[0])+2*v,h:(_.data?_.data.height:_.height*w[1])+2*v}}(s,u,[h.sx,h.sy]);return{bin:p,imagePosition:new xw(p,s,u,h),imageVariant:h}}class e9{constructor(s,u,h){const p=new Map,_=new Map;this.haveRenderCallbacks=[];const v=[];this.addImages(s,p,Og,v),this.addImages(u,_,2,v);const{w,h:A}=J7(v),R=new ll({width:w||1,height:A||1});for(const[O,D]of s.entries()){const z=p.get(O).paddedRect;ll.copy(D.data,R,{x:0,y:0},{x:z.x+Og,y:z.y+Og},D.data,null,D.sdf)}for(const[O,D]of u.entries()){const z=_.get(O),V=z.paddedRect;let H=z.padding;const K=V.x+H,re=V.y+H,ne=D.data.width,ue=D.data.height;H=H>1?H-1:H,ll.copy(D.data,R,{x:0,y:0},{x:K,y:re},D.data,h),ll.copy(D.data,R,{x:0,y:ue-H},{x:K,y:re-H},{width:ne,height:H},h),ll.copy(D.data,R,{x:0,y:0},{x:K,y:re+ue},{width:ne,height:H},h),ll.copy(D.data,R,{x:ne-H,y:0},{x:K-H,y:re},{width:H,height:ue},h),ll.copy(D.data,R,{x:0,y:0},{x:K+ne,y:re},{width:H,height:ue},h),ll.copy(D.data,R,{x:ne-H,y:ue-H},{x:K-H,y:re-H},{width:H,height:H},h),ll.copy(D.data,R,{x:0,y:ue-H},{x:K+ne,y:re-H},{width:H,height:H},h),ll.copy(D.data,R,{x:0,y:0},{x:K+ne,y:re+ue},{width:H,height:H},h),ll.copy(D.data,R,{x:ne-H,y:0},{x:K-H,y:re+ue},{width:H,height:H},h)}this.lut=h,this.image=R,this.iconPositions=p,this.patternPositions=_}addImages(s,u,h,p){for(const[_,v]of s.entries()){const{bin:w,imagePosition:A,imageVariant:R}=z6(_,v,h);u.set(_,A),p.push(w),v.hasRenderCallback&&this.haveRenderCallbacks.push(R.id)}}patchUpdatedImages(s,u,h){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>s.hasImage(p,h)),s.dispatchRenderCallbacks(this.haveRenderCallbacks,h);for(const p of s.getUpdatedImages(h)){for(const _ of this.iconPositions.keys()){const v=Md.parse(_);if(yl.isEqual(v.id,p)){const w=s.getImage(p,h);this.patchUpdatedImage(this.iconPositions.get(_),w,u,null)}}for(const _ of this.patternPositions.keys()){const v=Md.parse(_);if(yl.isEqual(v.id,p)){const w=s.getImage(p,h);this.patchUpdatedImage(this.patternPositions.get(_),w,u,this.lut)}}}}patchUpdatedImage(s,u,h,p=null){if(!s||!u||s.version===u.version)return;s.version=u.version;const[_,v]=s.tl,w=s.sdf;if(this.lut||w){const A={width:u.data.width,height:u.data.height},R=new ll(A);ll.copy(u.data,R,{x:0,y:0},{x:0,y:0},A,p,w),h.update(R,{position:{x:_,y:v}})}else h.update(u.data,{position:{x:_,y:v}})}}En(xw,"ImagePosition"),En(e9,"ImageAtlas");const bw=1e20;function t9(c,s,u,h,p,_,v,w,A){for(let R=s;R<s+h;R++)n9(c,u*_+R,_,p,v,w,A);for(let R=u;R<u+p;R++)n9(c,R*_+s,1,h,v,w,A)}function n9(c,s,u,h,p,_,v){_[0]=0,v[0]=-bw,v[1]=bw,p[0]=c[s];for(let w=1,A=0,R=0;w<h;w++){p[w]=c[s+w*u];const O=w*w;do{const D=_[A];R=(p[w]-p[D]+O-D*D)/(w-D)/2}while(R<=v[A]&&--A>-1);A++,_[A]=w,v[A]=R,v[A+1]=bw}for(let w=0,A=0;w<h;w++){for(;v[A+1]<w;)A++;const R=_[A],O=w-R;c[s+w*u]=p[R]+O*O}}const Xd=2,F6={none:0,ideographs:1,all:2};class I1{constructor(s,u,h){this.requestManager=s,this.localGlyphMode=u,this.localFontFamily=h,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(s){this.url=s}getGlyphs(s,u){const h=[],p=this.url||ri.GLYPHS_URL;for(const _ in s)for(const v of s[_])h.push({stack:_,id:v});Ne(h,({stack:_,id:v},w)=>{let A=this.entries[_];A||(A=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let R=A.glyphs[v];if(R!==void 0)return void w(null,{stack:_,id:v,glyph:R});if(R=this._tinySDF(A,_,v),R)return A.glyphs[v]=R,void w(null,{stack:_,id:v,glyph:R});const O=Math.floor(v/256);if(256*O>65535)return Qt("glyphs > 65535 not supported"),void w(null,{stack:_,id:v,glyph:R});if(A.ranges[O])return void w(null,{stack:_,id:v,glyph:R});let D=A.requests[O];D||(D=A.requests[O]=[],I1.loadGlyphRange(_,O,p,this.requestManager,(z,V)=>{if(V){A.ascender=V.ascender,A.descender=V.descender;for(const H in V.glyphs)this._doesCharSupportLocalGlyph(+H)||(A.glyphs[+H]=V.glyphs[+H]);A.ranges[O]=!0}for(const H of D)H(z,V);delete A.requests[O]})),D.push((z,V)=>{z?w(z):V&&w(null,{stack:_,id:v,glyph:V.glyphs[v]||null})})},(_,v)=>{if(_)u(_);else if(v){const w={};for(const{stack:A,id:R,glyph:O}of v)w[A]===void 0&&(w[A]={}),w[A].glyphs===void 0&&(w[A].glyphs={}),w[A].glyphs[R]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics},w[A].ascender=this.entries[A].ascender,w[A].descender=this.entries[A].descender;u(null,w)}})}_doesCharSupportLocalGlyph(s){return this.localGlyphMode!==F6.none&&(this.localGlyphMode===F6.all?!!this.localFontFamily:!!this.localFontFamily&&(fr["CJK Unified Ideographs"](s)||fr["Hangul Syllables"](s)||fr.Hiragana(s)||fr.Katakana(s)||fr["CJK Symbols and Punctuation"](s)||fr["CJK Unified Ideographs Extension A"](s)||fr["CJK Unified Ideographs Extension B"](s)||fr.Osage(s)))}_tinySDF(s,u,h){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(h))return;let _=s.tinySDF;if(!_){let K="400";/bold/i.test(u)?K="900":/medium/i.test(u)?K="500":/light/i.test(u)&&(K="200"),_=s.tinySDF=new I1.TinySDF({fontFamily:p,fontWeight:K,fontSize:24*Xd,buffer:3*Xd,radius:8*Xd}),_.fontWeight=K}if(this.localGlyphs[_.fontWeight][h])return this.localGlyphs[_.fontWeight][h];const v=String.fromCodePoint(h),{data:w,width:A,height:R,glyphWidth:O,glyphHeight:D,glyphLeft:z,glyphTop:V,glyphAdvance:H}=_.draw(v);return this.localGlyphs[_.fontWeight][h]={id:h,bitmap:new gm({width:A,height:R},w),metrics:{width:O/Xd,height:D/Xd,left:z/Xd,top:V/Xd-27,advance:H/Xd,localGlyph:!0}}}}I1.loadGlyphRange=function(c,s,u,h,p){const _=256*s,v=_+255,w=h.transformRequest(h.normalizeGlyphsURL(u).replace("{fontstack}",c).replace("{range}",`${_}-${v}`),H0.Glyphs);Rd(w,(A,R)=>{if(A)p(A);else if(R){const O={},D=function(z){return new KS(z).readFields(bae,{})}(R);for(const z of D.glyphs)O[z.id]=z;p(null,{glyphs:O,ascender:D.ascender,descender:D.descender})}})},I1.TinySDF=class{constructor({fontSize:c=24,buffer:s=3,radius:u=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:_="normal",fontStyle:v="normal",lang:w=null}={}){this.buffer=s,this.cutoff=h,this.radius=u,this.lang=w;const A=this.size=c+4*s,R=this._createCanvas(A),O=this.ctx=R.getContext("2d",{willReadFrequently:!0});O.font=`${v} ${_} ${c}px ${p}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(c){const s=document.createElement("canvas");return s.width=s.height=c,s}draw(c){const{width:s,actualBoundingBoxAscent:u,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:_}=this.ctx.measureText(c),v=Math.ceil(u),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-p))),A=Math.min(this.size-this.buffer,v+Math.ceil(h)),R=w+2*this.buffer,O=A+2*this.buffer,D=Math.max(R*O,0),z=new Uint8ClampedArray(D),V={data:z,width:R,height:O,glyphWidth:w,glyphHeight:A,glyphTop:v,glyphLeft:0,glyphAdvance:s};if(w===0||A===0)return V;const{ctx:H,buffer:K,gridInner:re,gridOuter:ne}=this;this.lang&&(H.lang=this.lang),H.clearRect(K,K,w,A),H.fillText(c,K,K+v);const ue=H.getImageData(K,K,w,A);ne.fill(bw,0,D),re.fill(0,0,D);for(let he=0;he<A;he++)for(let ge=0;ge<w;ge++){const ke=ue.data[4*(he*w+ge)+3]/255;if(ke===0)continue;const Ee=(he+K)*R+ge+K;if(ke===1)ne[Ee]=0,re[Ee]=bw;else{const Pe=.5-ke;ne[Ee]=Pe>0?Pe*Pe:0,re[Ee]=Pe<0?Pe*Pe:0}}t9(ne,0,0,R,O,R,this.f,this.v,this.z),t9(re,K,K,w,A,R,this.f,this.v,this.z);for(let he=0;he<D;he++){const ge=Math.sqrt(ne[he])-Math.sqrt(re[he]);z[he]=Math.round(255-255*(ge/this.radius+this.cutoff))}return V}};const Zh=Og;function r9(c,s){return c+s[1]-s[0]}function B6(c,s,u,h,p=1){const _=[],v=c.imagePrimary,w=v.pixelRatio,A=v.paddedRect.w-2*Zh,R=v.paddedRect.h-2*Zh,O=(c.right-c.left)*p,D=(c.bottom-c.top)*p,z=v.stretchX||[[0,A]],V=v.stretchY||[[0,R]],H=z.reduce(r9,0),K=V.reduce(r9,0),re=A-H,ne=R-K;let ue=0,he=H,ge=0,ke=K,Ee=0,Pe=re,Be=0,$e=ne;if(v.content&&h){const Xe=v.content;ue=e3(z,0,Xe[0]),ge=e3(V,0,Xe[1]),he=e3(z,Xe[0],Xe[2]),ke=e3(V,Xe[1],Xe[3]),Ee=Xe[0]-ue,Be=Xe[1]-ge,Pe=Xe[2]-Xe[0]-he,$e=Xe[3]-Xe[1]-ke}const mt=(Xe,vt,kt,It)=>{const zt=t3(Xe.stretch-ue,he,O,c.left*p),Bt=n3(Xe.fixed-Ee,Pe,Xe.stretch,H),Ot=t3(vt.stretch-ge,ke,D,c.top*p),Lt=n3(vt.fixed-Be,$e,vt.stretch,K),yt=t3(kt.stretch-ue,he,O,c.left*p),gt=n3(kt.fixed-Ee,Pe,kt.stretch,H),Dt=t3(It.stretch-ge,ke,D,c.top*p),tn=n3(It.fixed-Be,$e,It.stretch,K),$t=new je(zt,Ot),Bn=new je(yt,Ot),pn=new je(yt,Dt),xn=new je(zt,Dt),Rn=new je(Bt/w,Lt/w),Jr=new je(gt/w,tn/w),Zt=s*Math.PI/180;if(Zt){const hs=Math.sin(Zt),Se=Math.cos(Zt),Ie=[Se,-hs,hs,Se];$t._matMult(Ie),Bn._matMult(Ie),xn._matMult(Ie),pn._matMult(Ie)}const Pn=Xe.stretch+Xe.fixed,Or=kt.stretch+kt.fixed,gi=vt.stretch+vt.fixed,Ei=It.stretch+It.fixed,jr=c.imageSecondary;return{tl:$t,tr:Bn,bl:xn,br:pn,texPrimary:{x:v.paddedRect.x+Zh+Pn,y:v.paddedRect.y+Zh+gi,w:Or-Pn,h:Ei-gi},texSecondary:jr?{x:jr.paddedRect.x+Zh+Pn,y:jr.paddedRect.y+Zh+gi,w:Or-Pn,h:Ei-gi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rn,pixelOffsetBR:Jr,minFontScaleX:Pe/w/O,minFontScaleY:$e/w/D,isSDF:u}};if(h&&(v.stretchX||v.stretchY)){const Xe=i9(z,re,H),vt=i9(V,ne,K);for(let kt=0;kt<Xe.length-1;kt++){const It=Xe[kt],zt=Xe[kt+1];for(let Bt=0;Bt<vt.length-1;Bt++)_.push(mt(It,vt[Bt],zt,vt[Bt+1]))}}else _.push(mt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:R+1}));return _}function kae(c,s){const u=c.stretchY||[[0,c.paddedRect.h-2*Zh]];return s&&(c.stretchX||c.stretchY)?s9(c.stretchX||[[0,c.paddedRect.w-2*Zh]])*s9(u):1}function e3(c,s,u){let h=0;for(const p of c)h+=Math.max(s,Math.min(u,p[1]))-Math.max(s,Math.min(u,p[0]));return h}function i9(c,s,u){const h=[{fixed:-Zh,stretch:0}];for(const[p,_]of c){const v=h[h.length-1];h.push({fixed:p-v.stretch,stretch:v.stretch}),h.push({fixed:p-v.stretch,stretch:v.stretch+(_-p)})}return h.push({fixed:s+Zh,stretch:u}),h}function s9(c){return 2*c.length+1}function t3(c,s,u,h){return c/s*u+h}function n3(c,s,u,h){return c-s*u/h}function Iae(c,s,u,h){const p=s+c.positionedLines[h].lineOffset;return h===0?u+p/2:u+(p+(s+c.positionedLines[h-1].lineOffset))/2}function Rae(c,s=1,u=!1){let h=1/0,p=1/0,_=-1/0,v=-1/0;const w=c[0];for(let V=0;V<w.length;V++){const H=w[V];(!V||H.x<h)&&(h=H.x),(!V||H.y<p)&&(p=H.y),(!V||H.x>_)&&(_=H.x),(!V||H.y>v)&&(v=H.y)}const A=Math.min(_-h,v-p);let R=A/2;const O=new vy([],Mae);if(A===0)return new je(h,p);for(let V=h;V<_;V+=A)for(let H=p;H<v;H+=A)O.push(new R1(V+R,H+R,R,c));let D=function(V){let H=0,K=0,re=0;const ne=V[0];for(let ue=0,he=ne.length,ge=he-1;ue<he;ge=ue++){const ke=ne[ue],Ee=ne[ge],Pe=ke.x*Ee.y-Ee.x*ke.y;K+=(ke.x+Ee.x)*Pe,re+=(ke.y+Ee.y)*Pe,H+=3*Pe}return new R1(K/H,re/H,0,V)}(c),z=O.length;for(;O.length;){const V=O.pop();(V.d>D.d||!D.d)&&(D=V,u&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,z)),V.max-D.d<=s||(R=V.h/2,O.push(new R1(V.p.x-R,V.p.y-R,R,c)),O.push(new R1(V.p.x+R,V.p.y-R,R,c)),O.push(new R1(V.p.x-R,V.p.y+R,R,c)),O.push(new R1(V.p.x+R,V.p.y+R,R,c)),z+=4)}return u&&(console.log(`num probes: ${z}`),console.log(`best distance: ${D.d}`)),D.p}function Mae(c,s){return s.max-c.max}class R1{constructor(s,u,h,p){this.p=new je(s,u),this.h=h,this.d=function(_,v){let w=!1,A=1/0;for(let R=0;R<v.length;R++){const O=v[R];for(let D=0,z=O.length,V=z-1;D<z;V=D++){const H=O[D],K=O[V];H.y>_.y!=K.y>_.y&&_.x<(K.x-H.x)*(_.y-H.y)/(K.y-H.y)+H.x&&(w=!w),A=Math.min(A,Pa(_,H,K))}}return(w?1:-1)*Math.sqrt(A)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const Pae=Object.keys,j6=Number.POSITIVE_INFINITY,Oae=Math.sqrt(2);function ym(c,s,u,h,p){const _=L6(c)&&c.collisionPadding?c.collisionPadding:[0,0,0,0],v={top:c.top-_[1],bottom:c.bottom+_[3],left:c.left-_[0],right:c.right+_[2],scaled:!1};return h!==void 0&&function(w,A){w.top*=A,w.bottom*=A,w.left*=A,w.right*=A,w.scaled=!0}(v,h),u&&function(w,A){if(!A)return;const R=cn(A),O=new je(w.left,w.top),D=new je(w.right,w.top),z=new je(w.left,w.bottom),V=new je(w.right,w.bottom),H=new je(0,0);O._rotateAround(R,H),D._rotateAround(R,H),z._rotateAround(R,H),V._rotateAround(R,H),w.left=Math.min(O.x,D.x,z.x,V.x),w.right=Math.max(O.x,D.x,z.x,V.x),w.top=Math.min(O.y,D.y,z.y,V.y),w.bottom=Math.max(O.y,D.y,z.y,V.y)}(v,u),p&&(v.left+=p[0],v.right+=p[0],v.top+=p[1],v.bottom+=p[1]),s?{top:Math.min(s.top,v.top),bottom:Math.max(s.bottom,v.bottom),left:Math.min(s.left,v.left),right:Math.max(s.right,v.right),scaled:s.scaled||v.scaled}:v}function a9(c,[s,u]){let h=0,p=0;if(u===j6){s<0&&(s=0);const _=s/Oae;switch(c){case"top-right":case"top-left":p=_-7;break;case"bottom-right":case"bottom-left":p=7-_;break;case"bottom":p=7-s;break;case"top":p=s-7}switch(c){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=s;break;case"right":h=-s}}else{switch(s=Math.abs(s),u=Math.abs(u),c){case"top-right":case"top-left":case"top":p=u-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-u}switch(c){case"top-right":case"bottom-right":case"right":h=-s;break;case"top-left":case"bottom-left":case"left":h=s}}return[h,p]}function Lae(c,s,u,h,p,_,v,w,A,R,O,D,z,V){const H=c.layers[0],K=H.appearances;if(K.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const re={iconBBox:null,iconVerticalBBox:null},ne={textBBox:null,textVerticalBBox:null},{baseIconRotate:ue,baseTextRotate:he,iconScaleFactor:ge}=function(Ee,Pe,Be){const $e=Ee.get("icon-rotate").evaluate(Pe,{},Be),mt=Ee.get("text-rotate").evaluate(Pe,{},Be),[Xe,vt]=Ee.get("icon-size-scale-range");return{baseIconRotate:$e,baseTextRotate:mt,iconScaleFactor:ee(1,Xe,vt)}}(h,p,_);s&&(re.iconBBox=ym(s,re.iconBBox,ue,v),u)&&(re.iconVerticalBBox=ym(u,re.iconVerticalBBox,ue+90,v));const ke=i3(D.horizontal);ke&&(ne.textBBox=ym(ke,ne.textBBox,he,1,V)),D.vertical&&(ne.textVerticalBBox=ym(D.vertical,ne.textVerticalBBox,he+90,1,V));for(const Ee of K)Ee.hasIconProperties()&&Dae(re,c,H,Ee,p,_,w,ue,v,A,s,R,ge,O),Ee.hasTextProperties()&&Nae(ne,H,Ee,p,_,V,he,z,ke,D.vertical);return{iconBBox:re.iconBBox,iconVerticalBBox:re.iconVerticalBBox,textBBox:ne.textBBox,textVerticalBBox:ne.textVerticalBBox}}function Dae(c,s,u,h,p,_,v,w,A,R,O,D,z,V){const{appearanceIconOffset:H,appearanceIconRotate:K,appearanceIconSize:re}=function(ge,ke,Ee,Pe,Be,$e,mt,Xe){const vt=ge.hasProperty("icon-offset")?ke.getAppearanceValueAndResolveTokens(ge,"icon-offset",Ee,Pe,[]):null,kt=vt&&Array.isArray(vt)?vt:Be,It=ge.hasProperty("icon-rotate")?ke.getAppearanceValueAndResolveTokens(ge,"icon-rotate",Ee,Pe,[]):null,zt=typeof It=="number"?It:$e,Bt=ge.hasProperty("icon-size")?ke.getAppearanceValueAndResolveTokens(ge,"icon-size",Ee,Pe,[]):null;return{appearanceIconOffset:kt,appearanceIconRotate:zt,appearanceIconSize:typeof Bt=="number"?Bt*Xe.iconScaleFactor:mt}}(h,u,p,_,v,w,A,R);let ne=null,ue=null,he=null;h.hasProperty("icon-image")?he=function(ge,ke,Ee,Pe,Be,$e,mt){let Xe=null;const vt=ke.getAppearanceValueAndResolveTokens(Ee,"icon-image",Pe,Be,[]);if(vt){const kt=ge.getResolvedImageFromTokens(vt),It=Ee.getUnevaluatedProperty("icon-size"),zt=ww(kt,C1(ge.zoom,It,ge.worldview),It,Be,ge.zoom,Pe,ge.pixelRatio,mt,ge.worldview);Xe=$e.get(zt.iconPrimary.toString())}return Xe}(s,u,h,p,_,D,z):O&&(he=O.imagePrimary),he&&(ne=JS(he,null,H,V),s.allowVerticalPlacement&&(ue=JS(he,null,H,V))),ne&&(c.iconBBox=ym(ne,c.iconBBox,K,re)),ue&&(c.iconVerticalBBox=ym(ue,c.iconVerticalBBox,K+90,re))}function Nae(c,s,u,h,p,_,v,w,A,R){const{appearanceTextOffset:O,appearanceTextRotate:D,appearanceTextSize:z}=function(H,K,re,ne,ue,he,ge){const ke=H.hasProperty("text-offset")?K.getAppearanceValueAndResolveTokens(H,"text-offset",re,ne,[]):null,Ee=ke&&Array.isArray(ke)?[ke[0]*So,ke[1]*So]:ue,Pe=H.hasProperty("text-rotate")?K.getAppearanceValueAndResolveTokens(H,"text-rotate",re,ne,[]):null,Be=typeof Pe=="number"?Pe:he,$e=H.hasProperty("text-size")?K.getAppearanceValueAndResolveTokens(H,"text-size",re,ne,[]):null;return{appearanceTextOffset:Ee,appearanceTextRotate:Be,appearanceTextSize:typeof $e=="number"?$e:ge}}(u,s,h,p,_,v,w),V=z/w;A&&(c.textBBox=ym(A,c.textBBox,D,V,O)),R&&(c.textVerticalBBox=ym(R,c.textVerticalBBox,D+90,V,O))}function r3(c,s,u,h,p,_,v,w,A){if(!s||!s.usvg)return;const R=Z7(h),O=Z7(p),D=_!=="both"&&_!=="width"||!G7(h)?1:O.width/R.width,z=_!=="both"&&_!=="height"||!q7(h)?1:O.height/R.height;u.scaleSelf(D,z);const V=u.toString();v.set(V,u),w.set(V,s);const{imagePosition:H}=z6(V,s,Og);A.set(V,H)}function o9(c,s,u,h,p,_,v,w,A){if(!c)return;const R=function(O,D,z,V,H,K){if(O.kind==="camera")return O.maxSize;if(O.kind==="composite"){const re=D.possiblyEvaluate(new zs(O.maxZoom,{worldview:K}),z).evaluate(H,{},z),ne=D.possiblyEvaluate(new zs(O.minZoom,{worldview:K}),z).evaluate(H,{},z);return Math.max(re,ne)}return D.possiblyEvaluate(new zs(V,{worldview:K})).evaluate(H,{},z)}(s,u,h,p,_,A);return c.scaleSelf(R*w*v)}function ww(c,s,u,h,p,_,v,w,A){return{iconPrimary:o9(c.getPrimary(),s,u,h,p,_,v,w,A),iconSecondary:o9(c.getSecondary(),s,u,h,p,_,v,w,A)}}function zae(c,s,u){if(!s)return;const h=u.get(c.toString()),p=u.get(s.toString());h&&p&&(h.paddedRect.w===p.paddedRect.w&&h.paddedRect.h===p.paddedRect.h||Qt(`Mismatch in icon variant sizes: ${c.toString()} and ${s.toString()}`),h.usvg!==p.usvg&&Qt(`Mismatch in icon variant image types: ${c.id} and ${s.id}`))}function l9(c,s,u,h){if(!c)return;const p=s.get(u.toString());if(c.imagePrimary=p,h){const _=s.get(h.toString());c.imageSecondary=_}}function Fae(c,s){for(const u in c.horizontal)u9(c.horizontal[u],s);u9(c.vertical,s)}function u9(c,s){if(c){for(const u of c.positionedLines)for(const h of u.positionedGlyphs)if(h.image!==null){const p=h.image.toString();h.rect=s.get(p).paddedRect}}}function U6(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Bae(c,s,u,h,p,_,v,w,A){const R=i3(_.horizontal)||_.vertical,O=u.get("icon-text-fit-padding").evaluate(h,{},p);let D,z=s;return s&&A!=="none"&&(c.allowVerticalPlacement&&_.vertical&&(D=D6(s,_.vertical,A,O,w,v)),R&&(z=D6(s,R,A,O,w,v))),{defaultShapedIcon:z,verticallyShapedIcon:D}}function jae(c,s,u,h,p,_,v,w,A,R,O,D,z,V,H,K,re,ne,ue,he,ge,ke,Ee,Pe){let Be=v.textMaxSize.evaluate(s,{},z);Be===void 0?Be=w*v.textScaleFactor:Be*=v.textScaleFactor;const $e=c.layers[0].layout,mt=So,Xe=w*v.textScaleFactor/mt,vt=i3(u.horizontal)||u.vertical;if(re!=="none"&&c.appearanceFeatureData&&s.index<c.appearanceFeatureData.length){const pn=c.appearanceFeatureData[s.index];pn&&(pn.textShaping=vt,pn.iconTextFitPadding=$e.get("icon-text-fit-padding").evaluate(s,{},z),pn.fontScale=Xe)}const kt=V.name==="globe",It=c.tilePixelRatio*Be/mt,zt=(Dt=c.overscaling,c.zoom>18&&Dt>2&&(Dt>>=1),Math.max(Jt/(512*Dt),1)*$e.get("symbol-spacing")),Bt=$e.get("text-padding")*c.tilePixelRatio,Ot=$e.get("icon-padding")*c.tilePixelRatio,Lt=cn($e.get("text-max-angle")),yt=$e.get("icon-rotation-alignment")==="map"&&he!=="point",gt=zt/2;var Dt;c.hasAnyIconTextFit===!1&&re!=="none"&&(c.hasAnyIconTextFit=!0);const tn=s.properties?+s.properties[_t]:null,$t=tn&&c.elevationFeatureIdToIndex?c.elevationFeatureIdToIndex.get(tn):65535,Bn=(pn,xn,Rn)=>{if(xn.x<0||xn.x>=Jt||xn.y<0||xn.y>=Jt)return;let Jr=null;if(kt){const{x:Zt,y:Pn,z:Or}=V.projectTilePoint(xn.x,xn.y,Rn);Jr={anchor:new Jf(Zt,Pn,Or,0,void 0),up:V.upVector(Rn,xn.x,xn.y)}}(function(Zt,Pn,Or,gi,Ei,jr,hs,Se,Ie,bt,Ft,ln,un,Un,Yn,zr,qr,Yr,fi,_r,Pr,Pi,zi,Fi,rs,ws,fs,ji,Yi,Zr,bi,oa,mr){const pi=Zt.addToLineVertexArray(Pn,gi);let gs,Rs,Fs,Ba,Os,gr,pa,is=0,ta=0,io=0,Ao=0,Wa=-1,Xa=-1;const _o={};let Ul=oy("");const Ls=Or?Or.anchor:Pn,Oa=ji!=="none";let ja=0,tu=0;if(Ie._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Yo=Ie.layout.get("text-offset").evaluate(Pr,{},rs);ja=Yo[0]*So,tu=Yo[1]*So}else ja=Ie.layout.get("text-radial-offset").evaluate(Pr,{},rs)*So,tu=j6;if(Zt.allowVerticalPlacement&&Ei.vertical){const Yo=Ei.vertical;if(Yn)gr=V6(Yo),Se&&(pa=V6(Se));else{const Rl=Ie.layout.get("text-rotate").evaluate(Pr,{},rs)+90;Fs=s3(bt,Ls,Pn,Ft,ln,un,Yo,Un,Rl,zr,oa),Se&&(Ba=s3(bt,Ls,Pn,Ft,ln,un,Se,Yr,Rl,null,bi))}}if(jr){const Yo=Zt.iconSizeData,Rl=Ie.layout.get("icon-rotate").evaluate(Pr,{},rs),Eu=B6(jr,Rl,zi,Oa,Pi.iconScaleFactor),bm=Se?B6(Se,Rl,zi,Oa,Pi.iconScaleFactor):void 0;Rs=s3(bt,Ls,Pn,Ft,ln,un,jr,Yr,Rl,null,Zr);const z1=function(Jd,jw,kF,Qoe,IF,RF,Joe,ele){const MF=Jd.layers[0],PF=MF.appearances;let F1=jw.length;if(kF&&(F1=Math.max(F1,kF.length)),PF.length===0)return F1;const[tle,nle]=Qoe.get("icon-size-scale-range"),rle=ee(1,tle,nle);for(const OF of PF){const LF=OF.getUnevaluatedProperties();if(LF._values["icon-image"].value!==void 0){const DF=MF.getAppearanceValueAndResolveTokens(OF,"icon-image",IF,RF,[]);if(DF){const NF=Jd.getResolvedImageFromTokens(DF);if(NF){const zF=LF._values["icon-size"],ile=ww(NF,C1(Jd.zoom,zF,Jd.worldview),zF,RF,Jd.zoom,IF,Jd.pixelRatio,rle,Jd.worldview),sle=Joe.get(ile.iconPrimary.toString());F1=Math.max(F1,kae(sle,ele))}}}}return F1}(Zt,Eu,bm,Ie.layout,Pr,rs,Zt.iconAtlasPositions,Oa);is=4*z1;let Qd=null;Yo.kind==="source"?(Qd=[Wd*Ie.layout.get("icon-size").evaluate(Pr,{},rs)*Pi.iconScaleFactor],Qd[0]>ep&&Qt(`${Zt.layerIds[0]}: Value for "icon-size" is >= ${Tw}. Reduce your "icon-size".`)):Yo.kind==="composite"&&(Qd=[Wd*Pi.compositeIconSizes[0].evaluate(Pr,{},rs)*Pi.iconScaleFactor,Wd*Pi.compositeIconSizes[1].evaluate(Pr,{},rs)*Pi.iconScaleFactor],(Qd[0]>ep||Qd[1]>ep)&&Qt(`${Zt.layerIds[0]}: Value for "icon-size" is >= ${Tw}. Reduce your "icon-size".`)),Zt.addSymbols(Zt.icon,Eu,Qd,_r,fi,Pr,void 0,Or,Pn,pi.lineStartIndex,pi.lineLength,-1,Fi,rs,ws,fs,Zt.symbolInstances.length,z1),Wa=Zt.icon.placedSymbolArray.length-1,bm&&(ta=4*z1,Zt.addSymbols(Zt.icon,bm,Qd,_r,fi,Pr,Tu.vertical,Or,Pn,pi.lineStartIndex,pi.lineLength,-1,Fi,rs,ws,fs,Zt.symbolInstances.length,z1),Xa=Zt.icon.placedSymbolArray.length-1)}for(const Yo in Ei.horizontal){const Rl=Yo,Eu=Ei.horizontal[Rl];gs||(Ul=oy(Eu.text),Yn?Os=V6(Eu):gs=s3(bt,Ls,Pn,Ft,ln,un,Eu,Un,Ie.layout.get("text-rotate").evaluate(Pr,{},rs),zr,oa));const bm=Eu.positionedLines.length===1;if(io+=c9(Zt,Or,Pn,Eu,hs,Ie,Yn,Pr,zr,pi,Ei.vertical?Tu.horizontal:Tu.horizontalOnly,bm?Pae(Ei.horizontal):[Rl],_o,Wa,Pi,Fi,rs,Zt.symbolInstances.length,ws),bm)break}Ei.vertical&&(Ao+=c9(Zt,Or,Pn,Ei.vertical,hs,Ie,Yn,Pr,zr,pi,Tu.vertical,["vertical"],_o,Xa,Pi,Fi,rs,Zt.symbolInstances.length,ws));let so=-1;const ud=(Yo,Rl)=>Yo?Math.max(Yo,Rl):Rl;so=ud(Os,so),so=ud(gr,so),so=ud(pa,so);const Wh=so>-1?1:0;Zt.glyphOffsetArray.length>=65535&&Qt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Pr.sortKey!==void 0&&Zt.addToSortKeyRanges(Zt.symbolInstances.length,Pr.sortKey),Zt.symbolInstances.emplaceBack(Pn.x,Pn.y,Ls.x,Ls.y,Ls.z,_o.right>=0?_o.right:-1,_o.center>=0?_o.center:-1,_o.left>=0?_o.left:-1,_o.vertical>=0?_o.vertical:-1,Wa,Xa,Ul,gs!==void 0?gs:Zt.collisionBoxArray.length,gs!==void 0?gs+1:Zt.collisionBoxArray.length,Fs!==void 0?Fs:Zt.collisionBoxArray.length,Fs!==void 0?Fs+1:Zt.collisionBoxArray.length,Rs!==void 0?Rs:Zt.collisionBoxArray.length,Rs!==void 0?Rs+1:Zt.collisionBoxArray.length,Ba||Zt.collisionBoxArray.length,Ba?Ba+1:Zt.collisionBoxArray.length,Ft,io,Ao,is,ta,Wh,0,ja,tu,so,0,Oa?1:0,Yi)})(c,xn,Jr,pn,u,h,_,p,c.layers[0],c.collisionBoxArray,s.index,s.sourceLayerIndex,c.index,Bt,ue,R,0,Ot,yt,ne,s,v,O,D,z,H,K,re,$t,ge,ke,Ee)};if(he==="line")for(const pn of jS(s.geometry,0,0,Jt,Jt)){const xn=Cae(pn,zt,Lt,u.vertical||vt,h,mt,It,c.overscaling,Jt);for(const Rn of xn)vt&&Uae(c,vt.text,gt,Rn)||Bn(pn,Rn,z)}else if(he==="line-center"){for(const pn of s.geometry)if(pn.length>1){const xn=Aae(pn,Lt,u.vertical||vt,h,mt,It);xn&&Bn(pn,xn,z)}}else if(s.type==="Polygon")for(const pn of sw(s.geometry,0)){const xn=Rae(pn,16);Bn(pn[0],new Jf(xn.x,xn.y,0,0,void 0),z)}else if(s.type==="LineString")for(const pn of s.geometry)Bn(pn,new Jf(pn[0].x,pn[0].y,0,0,void 0),z);else if(s.type==="Point")for(const pn of s.geometry)for(const xn of pn)Bn([xn],new Jf(xn.x,xn.y,0,0,void 0),z)}const Tw=255,ep=Tw*Wd;function c9(c,s,u,h,p,_,v,w,A,R,O,D,z,V,H,K,re,ne,ue){const he=function(Ee,Pe,Be,$e,mt,Xe,vt,kt){const It=[];if(Pe.positionedLines.length===0)return It;const zt=$e.layout.get("text-rotate").evaluate(Xe,{})*Math.PI/180,Bt=function(Dt){const tn=Dt[0],$t=Dt[1],Bn=tn*$t;return Bn>0?[tn,-$t]:Bn<0?[-tn,$t]:tn===0?[$t,tn]:[$t,-tn]}(Be);let Ot=Math.abs(Pe.top-Pe.bottom);for(const Dt of Pe.positionedLines)Ot-=Dt.lineOffset;const Lt=Pe.positionedLines.length,yt=Ot/Lt;let gt=Pe.top-Be[1];for(let Dt=0;Dt<Lt;++Dt){const tn=Pe.positionedLines[Dt];gt=Iae(Pe,yt,gt,Dt);for(const $t of tn.positionedGlyphs){if(!$t.rect)continue;const Bn=$t.rect||{};let pn=B7+1,xn=!0,Rn=1,Jr=0;if($t.image){const qr=vt.get($t.image.toString());if(!qr)continue;if(qr.sdf){Qt("SDF images are not supported in formatted text and will be ignored.");continue}xn=!1,Rn=qr.pixelRatio,pn=Og/Rn}const Zt=(mt||kt)&&$t.vertical,Pn=$t.metrics.advance*$t.scale/2,Or=$t.metrics,gi=$t.rect;if(gi===null)continue;kt&&Pe.verticalizable&&(Jr=$t.image?Pn-$t.metrics.width*$t.scale/2:0);const Ei=mt?[$t.x+Pn,$t.y]:[0,0];let jr=[0,0],hs=[0,0],Se=!1;mt||(Zt?(hs=[$t.x+Pn+Bt[0],$t.y+Bt[1]-Jr],Se=!0):jr=[$t.x+Pn+Be[0],$t.y+Be[1]-Jr]);const Ie=gi.w*$t.scale/(Rn*($t.localGlyph?Xd:1)),bt=gi.h*$t.scale/(Rn*($t.localGlyph?Xd:1));let Ft,ln,un,Un;if(Zt){const qr=$t.y-gt,Yr=new je(-Pn,Pn-qr),fi=-Math.PI/2,_r=new je(...hs);Ft=new je(-Pn+jr[0],jr[1]),Ft._rotateAround(fi,Yr)._add(_r),Ft.x+=-qr+Pn,Ft.y-=(Or.left-pn)*$t.scale;const Pr=$t.image?Or.advance*$t.scale:So*$t.scale,Pi=String.fromCodePoint($t.glyph);cae(Pi)?Ft.x+=(1-pn)*$t.scale:dae(Pi)?Ft.x+=Pr-Or.height*$t.scale+(-pn-1)*$t.scale:Ft.x+=$t.image||Or.width+2*pn===gi.w&&Or.height+2*pn===gi.h?(Pr-bt)/2:(Pr-(Or.height+2*pn)*$t.scale)/2,ln=new je(Ft.x,Ft.y-Ie),un=new je(Ft.x+bt,Ft.y),Un=new je(Ft.x+bt,Ft.y-Ie)}else{const qr=(Or.left-pn)*$t.scale-Pn+jr[0],Yr=(-Or.top-pn)*$t.scale+jr[1],fi=qr+Ie,_r=Yr+bt;Ft=new je(qr,Yr),ln=new je(fi,Yr),un=new je(qr,_r),Un=new je(fi,_r)}if(zt){let qr;qr=mt?new je(0,0):Se?new je(Bt[0],Bt[1]):new je(Be[0],Be[1]),Ft._rotateAround(zt,qr),ln._rotateAround(zt,qr),un._rotateAround(zt,qr),Un._rotateAround(zt,qr)}const Yn=new je(0,0),zr=new je(0,0);It.push({tl:Ft,tr:ln,bl:un,br:Un,texPrimary:Bn,texSecondary:void 0,writingMode:Pe.writingMode,glyphOffset:Ei,sectionIndex:$t.sectionIndex,isSDF:xn,pixelOffsetTL:Yn,pixelOffsetBR:zr,minFontScaleX:0,minFontScaleY:0})}}return It}(0,h,A,_,v,w,p,c.allowVerticalPlacement),ge=c.textSizeData;let ke=null;ge.kind==="source"?(ke=[Wd*_.layout.get("text-size").evaluate(w,{},re)*H.textScaleFactor],ke[0]>ep&&Qt(`${c.layerIds[0]}: Value for "text-size" is >= ${Tw}. Reduce your "text-size".`)):ge.kind==="composite"&&(ke=[Wd*H.compositeTextSizes[0].evaluate(w,{},re)*H.textScaleFactor,Wd*H.compositeTextSizes[1].evaluate(w,{},re)*H.textScaleFactor],(ke[0]>ep||ke[1]>ep)&&Qt(`${c.layerIds[0]}: Value for "text-size" is >= ${Tw}. Reduce your "text-size".`)),c.addSymbols(c.text,he,ke,A,v,w,O,s,u,R.lineStartIndex,R.lineLength,V,K,re,ue,!1,ne,he.length);for(const Ee of D)z[Ee]=c.text.placedSymbolArray.length-1;return 4*he.length}function i3(c){for(const s in c)return c[s];return null}function s3(c,s,u,h,p,_,v,w,A,R,O){let D,z,V,H;if(D=O?O.top:v.top,z=O?O.bottom:v.bottom,V=O?O.left:v.left,H=O?O.right:v.right,L6(v)&&v.collisionPadding){const K=v.collisionPadding;V-=K[0],D-=K[1],H+=K[2],z+=K[3]}if(A){const K=new je(V,D),re=new je(H,D),ne=new je(V,z),ue=new je(H,z),he=cn(A);let ge=new je(0,0);R&&(ge=new je(R[0],R[1])),K._rotateAround(he,ge),re._rotateAround(he,ge),ne._rotateAround(he,ge),ue._rotateAround(he,ge),V=Math.min(K.x,re.x,ne.x,ue.x),H=Math.max(K.x,re.x,ne.x,ue.x),D=Math.min(K.y,re.y,ne.y,ue.y),z=Math.max(K.y,re.y,ne.y,ue.y)}return c.emplaceBack(s.x,s.y,s.z,u.x,u.y,V,D,H,z,w,h,p,_),c.length-1}function V6(c){L6(c)&&c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const s=c.bottom-c.top;return s>0?Math.max(10,s):null}function Uae(c,s,u,h){const p=c.compareText;if(s in p){const _=p[s];for(let v=_.length-1;v>=0;v--)if(h.dist(_[v])<u)return!0}else p[s]=[];return p[s].push(h),!1}function d9(c,s){const u=c.fovAboveCenter,h=c.elevation?c.elevation.getMinElevationBelowMSL()*s:0,p=(c._camera.position[2]*c.worldSize-h)/Math.cos(c._pitch),_=Math.sin(u)*p/Math.sin(Math.max(Math.PI/2-c._pitch-u,.01));let v=Math.sin(c._pitch)*_+p;const w=p*(1/c._horizonShift);if(!c.elevation||c.elevation.exaggeration()===0){let A=Math.max(c.zoom-17,0);c.isOrthographic&&(A/=10),v*=1+A}return Math.min(1.01*v,w)}function Ew(c,s){if(!s.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:s};const u=Math.pow(2,-c.z),h=c.x*u,p=(c.x+1)*u,_=c.y*u,v=(c.y+1)*u,w=j(h),A=j(p),R=W(_),O=W(v),D=s.project(w,R),z=s.project(A,R),V=s.project(A,O),H=s.project(w,O);let K=Math.min(D.x,z.x,V.x,H.x),re=Math.min(D.y,z.y,V.y,H.y),ne=Math.max(D.x,z.x,V.x,H.x),ue=Math.max(D.y,z.y,V.y,H.y);const he=u/16;function ge(Ee,Pe,Be,$e,mt,Xe){const vt=(Be+mt)/2,kt=($e+Xe)/2,It=s.project(j(vt),W(kt)),zt=Math.max(0,K-It.x,re-It.y,It.x-ne,It.y-ue);K=Math.min(K,It.x),ne=Math.max(ne,It.x),re=Math.min(re,It.y),ue=Math.max(ue,It.y),zt>he&&(ge(Ee,It,Be,$e,vt,kt),ge(It,Pe,vt,kt,mt,Xe))}ge(D,z,h,_,p,_),ge(z,V,p,_,p,v),ge(V,H,p,v,h,v),ge(H,D,h,v,h,_),K-=he,re-=he,ne+=he,ue+=he;const ke=1/Math.max(ne-K,ue-re);return{scale:ke,x:K*ke,y:re*ke,x2:ne*ke,y2:ue*ke,projection:s}}function h9(c,{x:s,y:u},h=0){return new je(((s-h)*c.scale-c.x)*Jt,(u*c.scale-c.y)*Jt)}const Vae=q(new Float32Array(16));class vm{constructor(s){this.spec=s,this.name=s.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(s,u){return{x:0,y:0,z:0}}unproject(s,u){return new d(0,0)}projectTilePoint(s,u,h){return{x:s,y:u,z:0}}locationPoint(s,u,h,p=!0){return s._coordinatePoint(s.locationCoordinate(u,h),p)}pixelsPerMeter(s,u){return N(1,s)*u}pixelSpaceConversion(s,u,h){return 1}farthestPixelDistance(s){return d9(s,s.pixelsPerMeter)}pointCoordinate(s,u,h,p){const _=s.horizonLineFromTop(!1),v=new je(u,Math.max(_,h));return s.rayIntersectionCoordinate(s.pointRayIntersection(v,p))}pointCoordinate3D(s,u,h){const p=new je(u,h);if(s.elevation)return s.elevation.pointCoordinate(p);{const _=this.pointCoordinate(s,p.x,p.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(s,u){if(s.elevation&&s.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(s,u.x,u.y);const h=s.horizonLineFromTop();return u.y<h}createInversionMatrix(s,u){return Vae}createTileMatrix(s,u,h){let p,_,v;const w=h.canonical,A=q(new Float64Array(16));if(this.isReprojectedInTileSpace){const R=Ew(w,this);p=1,_=R.x+h.wrap*R.scale,v=R.y,ie(A,A,[p/R.scale,p/R.scale,s.pixelsPerMeter/u])}else p=u/s.zoomScale(w.z),_=(w.x+Math.pow(2,w.z)*h.wrap)*p,v=w.y*p;return X(A,A,[_,v,0]),ie(A,A,[p/Jt,p/Jt,1]),A}upVector(s,u,h){return[0,0,1]}upVectorScale(s,u,h){return{metersToTile:1}}}class $ae extends vm{constructor(s){super(s),this.range=[4,7],this.center=s.center||[-96,37.5];const[u,h]=this.parallels=s.parallels||[29.5,45.5],p=Math.sin(cn(u));this.n=(p+Math.sin(cn(h)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(s,u){const{n:h,c:p,r0:_}=this,v=cn(s-this.center[0]),w=cn(u),A=Math.sqrt(p-2*h*Math.sin(w))/h;return{x:A*Math.sin(v*h),y:A*Math.cos(v*h)-_,z:0}}unproject(s,u){const{n:h,c:p,r0:_}=this,v=_+u;let w=Math.atan2(s,Math.abs(v))*Math.sign(v);v*h<0&&(w-=Math.PI*Math.sign(s)*Math.sign(v));const A=cn(this.center[0])*h;w=ye(w,-Math.PI-A,Math.PI-A);const R=ee(xr(w/h)+this.center[0],-180,180),O=Math.asin(ee((p-(s*s+v*v)*h*h)/(2*h),-1,1)),D=ee(xr(O),-Y,Y);return new d(R,D)}}const Sw=1.340264,Aw=-.081106,Cw=893e-6,kw=.003796,a3=Math.sqrt(3)/2;class Hae extends vm{project(s,u){u=u/180*Math.PI,s=s/180*Math.PI;const h=Math.asin(a3*Math.sin(u)),p=h*h,_=p*p*p;return{x:.5*(s*Math.cos(h)/(a3*(Sw+3*Aw*p+_*(7*Cw+9*kw*p)))/Math.PI+.5),y:1-.5*(h*(Sw+Aw*p+_*(Cw+kw*p))/Math.PI+1),z:0}}unproject(s,u){s=(2*s-.5)*Math.PI;let h=u=(2*(1-u)-1)*Math.PI,p=h*h,_=p*p*p;for(let O,D,z,V=0;V<12&&(D=h*(Sw+Aw*p+_*(Cw+kw*p))-u,z=Sw+3*Aw*p+_*(7*Cw+9*kw*p),O=D/z,h=ee(h-O,-Math.PI/3,Math.PI/3),p=h*h,_=p*p*p,!(Math.abs(O)<1e-12));++V);const v=a3*s*(Sw+3*Aw*p+_*(7*Cw+9*kw*p))/Math.cos(h),w=Math.asin(Math.sin(h)/a3),A=ee(180*v/Math.PI,-180,180),R=ee(180*w/Math.PI,-Y,Y);return new d(A,R)}}class Gae extends vm{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0}project(s,u){return{x:.5+s/360,y:.5-u/360,z:0}}unproject(s,u){const h=360*(s-.5),p=ee(360*(.5-u),-Y,Y);return new d(h,p)}}const M1=Math.PI/2;function o3(c){return Math.tan((M1+c)/2)}class qae extends vm{constructor(s){super(s),this.center=s.center||[0,30];const[u,h]=this.parallels=s.parallels||[30,30];let p=cn(u),_=cn(h);this.southernCenter=p+_<0,this.southernCenter&&(p=-p,_=-_);const v=Math.cos(p),w=o3(p);this.n=p===_?Math.sin(p):Math.log(v/Math.cos(_))/Math.log(o3(_)/w),this.f=v*Math.pow(o3(p),this.n)/this.n}project(s,u){u=cn(u),this.southernCenter&&(u=-u),s=cn(s-this.center[0]);const h=1e-6,{n:p,f:_}=this;_>0?u<-M1+h&&(u=-M1+h):u>M1-h&&(u=M1-h);const v=_/Math.pow(o3(u),p);let w=v*Math.sin(p*s),A=_-v*Math.cos(p*s);return w=.5*(w/Math.PI+.5),A=.5*(A/Math.PI+.5),{x:w,y:this.southernCenter?A:1-A,z:0}}unproject(s,u){s=(2*s-.5)*Math.PI,this.southernCenter&&(u=1-u),u=(2*(1-u)-.5)*Math.PI;const{n:h,f:p}=this,_=p-u,v=Math.sign(_),w=Math.sign(h)*Math.sqrt(s*s+_*_);let A=Math.atan2(s,Math.abs(_))*v;_*h<0&&(A-=Math.PI*Math.sign(s)*v);const R=ee(xr(A/h)+this.center[0],-180,180),O=ee(xr(2*Math.atan(Math.pow(p/w,1/h))-M1),-Y,Y);return new d(R,this.southernCenter?-O:O)}}class f9 extends vm{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(s,u){return{x:I(s),y:M(u),z:0}}unproject(s,u){const h=j(s),p=W(u);return new d(h,p)}}const p9=cn(Y);class Zae extends vm{project(s,u){const h=(u=cn(u))*u,p=h*h;return{x:.5*((s=cn(s))*(.8707-.131979*h+p*(p*(.003971*h-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(u*(1.007226+h*(.015085+p*(.028874*h-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(s,u){s=(2*s-.5)*Math.PI;let h=u=(2*(1-u)-1)*Math.PI,p=25,_=0,v=h*h;do{v=h*h;const R=v*v;_=(h*(1.007226+v*(.015085+R*(.028874*v-.044475-.005916*R)))-u)/(1.007226+v*(.045255+R*(.259866*v-.311325-.005916*11*R))),h=ee(h-_,-p9,p9)}while(Math.abs(_)>1e-6&&--p>0);v=h*h;const w=ee(xr(s/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),A=xr(h);return new d(w,A)}}const m9=cn(Y);class Wae extends vm{project(s,u){u=cn(u),s=cn(s);const h=Math.cos(u),p=2/Math.PI,_=Math.acos(h*Math.cos(s/2)),v=Math.sin(_)/_,w=.5*(s*p+2*h*Math.sin(s/2)/v)||0,A=.5*(u+Math.sin(u)/v)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(A/Math.PI+1),z:0}}unproject(s,u){let h=s=(2*s-.5)*Math.PI,p=u=(2*(1-u)-1)*Math.PI,_=25;const v=1e-6;let w=0,A=0;do{const R=Math.cos(p),O=Math.sin(p),D=2*O*R,z=O*O,V=R*R,H=Math.cos(h/2),K=Math.sin(h/2),re=2*H*K,ne=K*K,ue=1-V*H*H,he=ue?1/ue:0,ge=ue?Math.acos(R*H)*Math.sqrt(1/ue):0,ke=.5*(2*ge*R*K+2*h/Math.PI)-s,Ee=.5*(ge*O+p)-u,Pe=.5*he*(V*ne+ge*R*H*z)+1/Math.PI,Be=he*(re*D/4-ge*O*K),$e=.125*he*(D*K-ge*O*V*re),mt=.5*he*(z*H+ge*ne*R)+.5,Xe=Be*$e-mt*Pe;w=(Ee*Be-ke*mt)/Xe,A=(ke*$e-Ee*Pe)/Xe,h=ee(h-w,-Math.PI,Math.PI),p=ee(p-A,-m9,m9)}while((Math.abs(w)>v||Math.abs(A)>v)&&--_>0);return new d(xr(h),xr(p))}}class g9 extends vm{constructor(s){super(s),this.center=s.center||[0,0],this.parallels=s.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(cn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(s,u){const{scale:h,cosPhi:p}=this;return{x:cn(s)*p*h+.5,y:-Math.sin(cn(u))/p*h+.5,z:0}}unproject(s,u){const{scale:h,cosPhi:p}=this,_=-(u-.5)/h,v=ee(xr((s-.5)/h)/p,-180,180),w=Math.asin(ee(_*p,-1,1)),A=ee(xr(w),-Y,Y);return new d(v,A)}}class Xae extends f9{constructor(s){super(s),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(s,u,h){const p=Jb(s,u,h);return rn(p,p,MS(Ac(h))),{x:p[0],y:p[1],z:p[2]}}locationPoint(s,u,h){const p=hm(u.lat,u.lng),_=qt([],p),v=h?s._centerAltitude+h:s.elevation?s.elevation.getAtPointOrZero(s.locationCoordinate(u),s._centerAltitude):s._centerAltitude;jt(p,p,_,N(1,0)*Jt*v);const w=q(new Float64Array(16));return $(w,s.pixelMatrix,s.globeMatrix),rn(p,p,w),new je(p[0],p[1])}pixelsPerMeter(s,u){return N(1,0)*u}pixelSpaceConversion(s,u,h){const p=N(1,s)*u,_=Tr(N(1,45)*u,p,h);return this.pixelsPerMeter(s,u)/_}createTileMatrix(s,u,h){const p=ZI(Ac(h.canonical));return $(new Float64Array(16),s.globeMatrix,p)}createInversionMatrix(s,u){const{center:h}=s,p=MS(Ac(u));return fe(p,p,cn(h.lng)),de(p,p,cn(h.lat)),ie(p,p,[s._pixelsPerMercatorPixel,s._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(s,u,h,p){return pm(s,u,h,!0)||new pe(0,0)}pointCoordinate3D(s,u,h){const p=this.pointCoordinate(s,u,h,0);return[p.x,p.y,p.z]}isPointAboveHorizon(s,u){return!pm(s,u.x,u.y,!1)}farthestPixelDistance(s){const u=function(p,_){const v=p.cameraToCenterDistance,w=p._centerAltitude*_,A=p._camera,R=p._camera.forward(),O=nt([],Fe([],R,-v),[0,0,w]),D=p.worldSize/(2*Math.PI),z=[0,0,-D],V=p.width/p.height,H=Math.tan(p.fovAboveCenter),K=Fe([],A.up(),H),re=Fe([],A.right(),H*V),ne=qt([],nt([],nt([],R,K),re)),ue=[];let he;if(new Cn(O,ne).closestPointOnSphere(z,D,ue)){const ge=nt([],ue,z),ke=Vn([],ge,O);he=Math.cos(p.fovAboveCenter)*Nt(ke)}else{const ge=Vn([],O,z),ke=Vn([],z,O);qt(ke,ke);const Ee=Nt(ge)-D;he=Math.sqrt(Ee*(Ee+2*D));const Pe=Math.acos(he/(D+Ee))-Math.acos(wn(R,ke));he*=Math.cos(Pe)}return 1.01*he}(s,this.pixelsPerMeter(s.center.lat,s.worldSize)),h=mm(s.zoom);if(h>0){const p=d9(s,N(1,s.center.lat)*s.worldSize),_=s.worldSize/(2*Math.PI),v=Math.max(s.width,s.height)/s.worldSize*Math.PI;return Tr(u,p+_*(1-Math.cos(v)),Math.pow(h,10))}return u}upVector(s,u,h){return Jb(u,h,s,1)}upVectorScale(s){return{metersToTile:od(RS(Ac(s)))}}}function _9(c){const s=c.parallels,u=!!s&&Math.abs(s[0]+s[1])<.01;switch(c.name){case"mercator":return new f9(c);case"equirectangular":return new Gae(c);case"naturalEarth":return new Zae(c);case"equalEarth":return new Hae(c);case"winkelTripel":return new Wae(c);case"albers":return u?new g9(c):new $ae(c);case"lambertConformalConic":return u?new g9(c):new qae(c);case"globe":return new Xae(c)}throw new Error(`Invalid projection name: ${c.name}`)}const Yae=Ge.types,Kae=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Iw(c,s,u,h,p,_,v,w,A,R,O,D,z){const V=w?Math.min(ep,Math.round(w[0])):0,H=w?Math.min(ep,Math.round(w[1])):0;c.emplaceBack(s,u,Math.round(32*h),Math.round(32*p),_,v,(V<<1)+(A?1:0),0+(H<<1),16*R,16*O,256*D,256*z)}function Rw(c,s,u){c.emplaceBack(s,u)}function Mw(c,s,u,h,p,_,v){c.emplaceBack(s,u,h,p,_,v)}const l3=(c,s,u,h)=>{for(let p=0;p<s;p++)c.emplaceBack(u[0],u[1],u[2],h[0],h[1],h[2])};function P1(c,s,u,h,p){c.emplaceBack(s,u,h,p),c.emplaceBack(s,u,h,p),c.emplaceBack(s,u,h,p),c.emplaceBack(s,u,h,p)}function Qae(c){for(const s of c.sections)if(MI(s.text))return!0;return!1}class $6{constructor(s){this.layoutVertexArray=new Nb,this.indexArray=new to,this.programConfigurations=s,this.segments=new da,this.dynamicLayoutVertexArray=new Vh,this.opacityVertexArray=new t1,this.placedSymbolArray=new TS,this.iconTransitioningVertexArray=new xu,this.globeExtVertexArray=new zb,this.zOffsetVertexArray=new Bd,this.orientationVertexArray=new jb,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(s,u){const h=[],p=this.layoutVertexArray.uint16;for(let _=0;_<u;++_){const v=12*(s+_);h.push(...p.slice(v,v+12))}return h}updateIconVertexData(s,u,h,p,_,v,w,A,R,O,D,z,V){const H=this.layoutVertexArray.uint16,K=12*s;H[K]=u,H[K+1]=h,H[K+2]=p,H[K+3]=_,H[K+4]=v,H[K+5]=w,H[K+6]=A,H[K+7]=R,H[K+8]=O,H[K+9]=D,H[K+10]=z,H[K+11]=V}upload(s,u,h,p,_,v){this.isEmpty()||(h&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,eae.members,!!v),this.indexBuffer=s.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,nae.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,Kae,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=s.createVertexBuffer(this.iconTransitioningVertexArray,sae.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,tae.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||_)&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,rae.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=s.createVertexBuffer(this.orientationVertexArray,iae.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}En($6,"SymbolBuffers");class H6{constructor(s,u,h){this.layoutVertexArray=new s,this.layoutAttributes=u,this.indexArray=new h,this.segments=new da,this.collisionVertexArray=new Fb,this.collisionVertexArrayExt=new Vh}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,aae.members,!0),this.collisionVertexBufferExt=s.createVertexBuffer(this.collisionVertexArrayExt,oae.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}En(H6,"CollisionBuffers");class u3{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(v=>v.fqid),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=q([]),this.placementViewportMatrix=q([]);const u=this.layers[0]._unevaluatedLayout._values;this.worldview=s.worldview,this.localizable=s.localizable,this.textSizeData=C1(this.zoom,u["text-size"],this.worldview),this.iconSizeData=C1(this.zoom,u["icon-size"],this.worldview);const h=this.layers[0].layout,p=h.get("symbol-sort-key"),_=h.get("symbol-z-order");this.lut=s.lut,this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(v=>Tu[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=s.sourceID,this.projection=s.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(s){const u=this.layers[0].getAppearances();return!(!u||u.length===0)&&u.some(h=>h.getProperty(s)!=null)}createArrays(){this.text=new $6(new Ec(this.layers,{zoom:this.zoom,lut:this.lut},s=>s.startsWith("text")||s.startsWith("symbol"))),this.icon=new $6(new Ec(this.layers,{zoom:this.zoom,lut:this.lut},s=>s.startsWith("icon")||s.startsWith("symbol"))),this.glyphOffsetArray=new u1,this.lineVertexArray=new SS,this.symbolInstances=new Gb}calculateGlyphDependencies(s,u,h,p,_){for(const v of s){const w=v.codePointAt(0);if(w===void 0)break;if(u[w]=!0,p&&_&&w<=65535){const A=yw[v];A&&(u[A.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(s,u,h,p,_,v){let w=1;const A=s.getUnevaluatedProperties()._values["icon-size"],R=C1(this.zoom,A,this.worldview),O=k1(R,u);if(R.kind!=="constant"&&R.kind!=="camera"||(w=O.uSize),R.kind==="composite"){const{minZoom:D,maxZoom:z}=R,V=A.possiblyEvaluate(new zs(D,{worldview:this.worldview}),p),H=A.possiblyEvaluate(new zs(z,{worldview:this.worldview}),p),K=V.evaluate(h,{},p,_);w=K+(H.evaluate(h,{},p,_)-K)*O.uSizeT}return R.kind==="source"&&(w=A.possiblyEvaluate(new zs(this.zoom,{worldview:this.worldview}),p).evaluate(h,{},p,_)),w*v}updateFootprints(s,u){}updateReplacement(s,u){if(u.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=u.updateTime;const h=u.getReplacementRegionsForTile(s.toUnwrapped(),!0);return!zS(this.activeReplacements,h)&&(this.activeReplacements=h,!0)}getResolvedImageFromTokens(s){return typeof s=="string"?Sl.build(s):s}populate(s,u,h,p){const _=this.layers[0],v=_.layout,w=this.projection.name==="globe",A=v.get("text-font"),R=v.get("text-field"),O=v.get("icon-image"),[D,z]=v.get("icon-size-scale-range"),V=ee(u.scaleFactor||1,D,z),H=(R.value.kind!=="constant"||R.value.value instanceof El&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),K=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,re=this.hasAnyAppearanceProperty("icon-image"),ne=v.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!H&&!K&&!re)return;const ue=u.iconDependencies,he=u.glyphDependencies,ge=u.availableImages,ke=new zs(this.zoom,{worldview:this.worldview,activeFloors:u.activeFloors}),Ee=Pe=>{const Be=Pe.id.toString();ue.has(Be)?ue.get(Be).push(Pe):ue.set(Be,[Pe])};for(const Pe of s){const{feature:Be,id:$e,index:mt,sourceLayerIndex:Xe}=Pe,vt=_._featureFilter.needGeometry,kt=We(Be,vt);if(!_._featureFilter.filter(ke,kt,h))continue;if(vt||(kt.geometry=ze(Be,h,p)),w&&Be.type!==1&&h.z<=5){const Dt=kt.geometry,tn=.98078528056,$t=(Bn,pn)=>wn(Jb(Bn.x,Bn.y,h,1),Jb(pn.x,pn.y,h,1))<tn;for(let Bn=0;Bn<Dt.length;Bn++)Dt[Bn]=Ce(Dt[Bn],$t)}let It,zt;if(H){const Dt=_.getValueAndResolveTokens("text-field",kt,h,ge),tn=El.factory(Dt);Qae(tn)&&(this.hasRTLText=!0),(!this.hasRTLText||gg()==="unavailable"||this.hasRTLText&&Fd.isParsed())&&(It=uae(tn,_,kt))}if(K){const Dt=_.getValueAndResolveTokens("icon-image",kt,h,ge);zt=this.getResolvedImageFromTokens(Dt)}const Bt=this.layers[0];let Ot=!1;if(!zt&&re){const Dt=Bt.getAppearances();for(const tn of Dt)if(tn.getProperty("icon-image")){const $t=Bt.getAppearanceValueAndResolveTokens(tn,"icon-image",kt,h,ge);if($t){zt=this.getResolvedImageFromTokens($t),Ot=!0;break}}}if(!It&&!zt)continue;const Lt=this.sortFeaturesByKey?ne.evaluate(kt,{},h):void 0,yt={id:$e,text:It,icon:zt,index:mt,sourceLayerIndex:Xe,geometry:kt.geometry,properties:Be.properties,type:Yae[Be.type],sortKey:Lt};if(this.features.push(yt),this.featureToAppearanceIndex[mt]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:$e,properties:Be.properties,usesAppearanceIconAsPlaceholder:Ot,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),zt){const Dt=Bt._unevaluatedLayout._values,{iconPrimary:tn,iconSecondary:$t}=ww(zt,this.iconSizeData,Dt["icon-size"],h,this.zoom,yt,this.pixelRatio,V,this.worldview);Ee(tn),$t&&(this.hasAnySecondaryIcon=!0,Ee($t))}const gt=Bt.getAppearances();if(gt.length!==0&&gt.forEach(Dt=>{if(!Dt.getProperty("icon-image"))return;const tn=this.getCombinedIconPrimary(Dt,Bt,kt,h,ge,yt,V);tn&&Ee(tn)}),It){const Dt=A.evaluate(kt,{},h).join(","),tn=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Tu.vertical)>=0;for(const $t of It.sections)if($t.image){const Bn=$t.image.getPrimary().scaleSelf(this.pixelRatio),pn=Bn.id.toString(),xn=ue.get(pn)||[];xn.push(Bn),ue.set(pn,xn)}else{const Bn=pg(It.toString()),pn=$t.fontStack||Dt,xn=he[pn]=he[pn]||{};this.calculateGlyphDependencies($t.text,xn,tn,this.allowVerticalPlacement,Bn)}}}if(v.get("symbol-placement")==="line"&&(this.features=function(Pe){const Be={},$e={},mt=[];let Xe=0;function vt(Bt){mt.push(Pe[Bt]),Xe++}function kt(Bt,Ot,Lt){const yt=$e[Bt];return delete $e[Bt],$e[Ot]=yt,mt[yt].geometry[0].pop(),mt[yt].geometry[0]=mt[yt].geometry[0].concat(Lt[0]),yt}function It(Bt,Ot,Lt){const yt=Be[Ot];return delete Be[Ot],Be[Bt]=yt,mt[yt].geometry[0].shift(),mt[yt].geometry[0]=Lt[0].concat(mt[yt].geometry[0]),yt}function zt(Bt,Ot,Lt){const yt=Lt?Ot[0][Ot[0].length-1]:Ot[0][0];return`${Bt}:${yt.x}:${yt.y}`}for(let Bt=0;Bt<Pe.length;Bt++){const Ot=Pe[Bt],Lt=Ot.geometry,yt=Ot.text?Ot.text.toString():null;if(!yt){vt(Bt);continue}const gt=zt(yt,Lt),Dt=zt(yt,Lt,!0);if(gt in $e&&Dt in Be&&$e[gt]!==Be[Dt]){const tn=It(gt,Dt,Lt),$t=kt(gt,Dt,mt[tn].geometry);delete Be[gt],delete $e[Dt],$e[zt(yt,mt[$t].geometry,!0)]=$t,mt[tn].geometry=null}else gt in $e?kt(gt,Dt,Lt):Dt in Be?It(gt,Dt,Lt):(vt(Bt),Be[gt]=Xe-1,$e[Dt]=Xe-1)}return mt.filter(Bt=>Bt.geometry)}(this.features)),v.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",u.elevationFeatures){!this.elevationFeatures&&u.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Pe of u.elevationFeatures)this.elevationFeatureIdToIndex.set(Pe.id,this.elevationFeatures.length),this.elevationFeatures.push(Pe)}}else v.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Pe,Be)=>Pe.sortKey-Be.sortKey)}getCombinedIconPrimary(s,u,h,p,_,v,w){let A,R;const O=s.getUnevaluatedProperties();if(O._values["icon-image"].value!==void 0){const D=u.getAppearanceValueAndResolveTokens(s,"icon-image",h,p,_);A=this.getResolvedImageFromTokens(D)}else{const D=u.getValueAndResolveTokens("icon-image",h,p,_);A=this.getResolvedImageFromTokens(D)}if(A){const D=O._values["icon-size"]||u._unevaluatedLayout._values["icon-size"];R=ww(A,C1(this.zoom,D,this.worldview),D,p,this.zoom,v,this.pixelRatio,w,this.worldview).iconPrimary}return R}updateAppearanceBasedIconTextures(s,u,h,p){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const _=this.layers[0];let v=!1,w=0;const A=_.layout,[R,O]=A.get("icon-size-scale-range"),D=ee(1,R,O);for(let z=0;z<this.symbolInstances.length;z++){const V=this.symbolInstances.get(z),H=this.featureToAppearanceIndex[V.featureIndex],K=H!==void 0?this.appearanceFeatureData[H]:void 0;if(K&&V.placedIconSymbolIndex>=0){const re=K.id,ne=u&&re!==void 0?u[String(re)]:void 0,ue={type:"Point",id:K.id,properties:K.properties,geometry:[]},he=this.layers[0].appearances&&this.layers[0].appearances.find(ge=>ge.isActive({globals:p,feature:ue,canonical:s,featureState:ne}));if(K.activeAppearance===he){w+=V.numIconVertices;continue}if(he){K.activeAppearance=he;const ge=this.getCombinedIconPrimary(he,_,ue,s,h,{sortKey:void 0,text:void 0,icon:null,index:V.featureIndex,sourceLayerIndex:V.featureIndex,geometry:[],properties:K.properties,type:"Point",id:K.id},D);if(!ge)continue;const ke=ge.toString(),Ee=this.iconAtlasPositions&&this.iconAtlasPositions.get(ke);if(Ee){const Pe=_.getAppearanceValueAndResolveTokens(he,"icon-offset",ue,s,h),Be=Pe&&Array.isArray(Pe)?Pe:[0,0];let $e=JS(Ee,void 0,Be,_.layout.get("icon-anchor").evaluate(ue,{},s));const mt=_.getAppearanceValueAndResolveTokens(he,"icon-rotate",ue,s,h),Xe=typeof mt=="number"?mt:0,vt=Ee.sdf,kt=_.layout.get("icon-text-fit").constantOr("none");kt!=="none"&&K.textShaping&&K.iconTextFitPadding&&K.fontScale&&($e=D6($e,K.textShaping,kt,K.iconTextFitPadding,Be,K.fontScale));const It=this.calculateEffectiveAppearanceIconSize(he,p.zoom,ue,s,h,D),zt=0,Bt=1+(Math.min(ep,Math.round(It*Wd))<<1),Ot=B6($e,Xe,vt,kt!=="none",D);K.isUsingAppearanceVertexData||(K.isUsingAppearanceVertexData=!0,K.layoutBasedVertexData=this.icon.getIconVertexData(w,V.numIconVertices));for(let yt=0;yt<Ot.length;++yt){const gt=Ot[yt],Dt=K.layoutBasedVertexData[0]||V.tileAnchorX,tn=K.layoutBasedVertexData[1]||V.tileAnchorY,$t=16*gt.pixelOffsetTL.x,Bn=16*gt.pixelOffsetTL.y,pn=16*gt.pixelOffsetBR.x,xn=16*gt.pixelOffsetBR.y,Rn=16*gt.minFontScaleX,Jr=16*gt.minFontScaleY;this.icon.updateIconVertexData(w,Dt,tn,Math.round(32*gt.tl.x),Math.round(32*gt.tl.y),gt.texPrimary.x,gt.texPrimary.y,zt,Bt,$t,Bn,Rn,Jr),this.icon.updateIconVertexData(w+1,Dt,tn,Math.round(32*gt.tr.x),Math.round(32*gt.tr.y),gt.texPrimary.x+gt.texPrimary.w,gt.texPrimary.y,zt,Bt,pn,Bn,Rn,Jr),this.icon.updateIconVertexData(w+2,Dt,tn,Math.round(32*gt.bl.x),Math.round(32*gt.bl.y),gt.texPrimary.x,gt.texPrimary.y+gt.texPrimary.h,zt,Bt,$t,xn,Rn,Jr),this.icon.updateIconVertexData(w+3,Dt,tn,Math.round(32*gt.br.x),Math.round(32*gt.br.y),gt.texPrimary.x+gt.texPrimary.w,gt.texPrimary.y+gt.texPrimary.h,zt,Bt,pn,xn,Rn,Jr),w+=4}const Lt=V.numIconVertices-4*Ot.length;for(let yt=0;yt<Lt;++yt)this.icon.updateIconVertexData(w+yt,0,0,0,0,0,0,0,0,0,0,0,0);v=!0}else w+=V.numIconVertices}else if(K.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(w,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(w+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(w+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(w+3,0,0,0,0,0,0,0,0,0,0,0,0),v=!0),w+=V.numIconVertices,K.activeAppearance=null;else if(K.isUsingAppearanceVertexData){const ke=K.layoutBasedVertexData.length/12;for(let Ee=0;Ee<ke;++Ee){const Pe=Ee*12;this.icon.updateIconVertexData(w+Ee,K.layoutBasedVertexData[Pe+0],K.layoutBasedVertexData[Pe+1],K.layoutBasedVertexData[Pe+2],K.layoutBasedVertexData[Pe+3],K.layoutBasedVertexData[Pe+4],K.layoutBasedVertexData[Pe+5],K.layoutBasedVertexData[Pe+6],K.layoutBasedVertexData[Pe+7],K.layoutBasedVertexData[Pe+8],K.layoutBasedVertexData[Pe+9],K.layoutBasedVertexData[Pe+10],K.layoutBasedVertexData[Pe+11])}w+=ke,K.isUsingAppearanceVertexData=!1,K.activeAppearance=null,v=!0}else w+=V.numIconVertices,K.activeAppearance=null}}return v}update(s,u,h,p,_,v,w){this.text.programConfigurations.updatePaintArrays(s,u,_,h,p,v,w,this.worldview),this.icon.programConfigurations.updatePaintArrays(s,u,_,h,p,v,w,this.worldview)}updateRoadElevation(s){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let u=!1;const h=ae(s),p=1/h;let _=!1,v=!1;for(let w=0;w<this.symbolInstances.length;w++){const A=this.symbolInstances.get(w),R=Rt(1,0,0),O=Rt(0,1,0),{numHorizontalGlyphVertices:D,numVerticalGlyphVertices:z,numIconVertices:V,numVerticalIconVertices:H}=A,K=D>0||z>0,re=V>0,ne=this.elevationFeatures[A.elevationFeatureIndex];if(ne){const ue=new je(A.tileAnchorX,A.tileAnchorY),he=.075+ne.pointElevation(ue);A.zOffset!==he&&(u=!0,A.zOffset=he),he!==0&&(this.hasAnyZOffset=!0);const ge=ne.computeSlopeNormal(ue,p),ke=Qn(Ws(),Rt(0,0,1),ge);Qr(R,R,ke),Qr(O,O,ke),R[2]*=h,O[2]*=h,R[0]===1&&R[1]===0&&R[2]===0&&O[0]===0&&O[1]===1&&O[2]===0||(_=_||K,v=v||re)}if(K&&(l3(this.text.orientationVertexArray,D,R,O),l3(this.text.orientationVertexArray,z,R,O)),re){const{placedIconSymbolIndex:ue,verticalPlacedIconSymbolIndex:he}=A;ue>=0&&l3(this.icon.orientationVertexArray,V,R,O),he>=0&&l3(this.icon.orientationVertexArray,H,R,O)}}_||(this.text.orientationVertexArray=void 0),v||(this.icon.orientationVertexArray=void 0),u&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const s=(_,v,w)=>{h+=v,h>_.length&&_.resize(h);for(let A=-v;A<0;A++)_.emplace(A+h,w)},u=(_,v,w)=>{p+=v,p>_.length&&_.resize(p);for(let A=-v;A<0;A++)_.emplace(A+p,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let h=0,p=0;for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:A,numIconVertices:R}=v,O=v.zOffset,D=R>0;if((w>0||A>0)&&(s(this.text.zOffsetVertexArray,w,O),s(this.text.zOffsetVertexArray,A,O)),D){const{placedIconSymbolIndex:z,verticalPlacedIconSymbolIndex:V}=v;z>=0&&u(this.icon.zOffsetVertexArray,R,O),V>=0&&u(this.icon.zOffsetVertexArray,v.numVerticalIconVertices,O)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s,u,h,p,_){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(v=>v.appearances&&v.appearances.length>0)),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(s,u,h,p){return!!(s&&u&&h)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(s,u,h,p)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=_9(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,u){const h=this.lineVertexArray.length;if(s.segment!==void 0)for(const{x:p,y:_}of u)this.lineVertexArray.emplaceBack(p,_);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(s,u,h,p,_,v,w,A,R,O,D,z,V,H,K,re,ne,ue){const he=s.indexArray,ge=s.layoutVertexArray,ke=s.globeExtVertexArray,Ee=s.segments.prepareSegment(4*ue,ge,he,this.canOverlap?v.sortKey:void 0),Pe=this.glyphOffsetArray.length,Be=Ee.vertexLength,$e=this.allowVerticalPlacement&&w===Tu.vertical?Math.PI/2:0,mt=v.text&&v.text.sections;for(let kt=0;kt<u.length;kt++){const{tl:It,tr:zt,bl:Bt,br:Ot,texPrimary:Lt,texSecondary:yt,pixelOffsetTL:gt,pixelOffsetBR:Dt,minFontScaleX:tn,minFontScaleY:$t,glyphOffset:Bn,isSDF:pn,sectionIndex:xn}=u[kt],Rn=Ee.vertexLength,Jr=Bn[1];if(Iw(ge,R.x,R.y,It.x,Jr+It.y,Lt.x,Lt.y,h,pn,gt.x,gt.y,tn,$t),Iw(ge,R.x,R.y,zt.x,Jr+zt.y,Lt.x+Lt.w,Lt.y,h,pn,Dt.x,gt.y,tn,$t),Iw(ge,R.x,R.y,Bt.x,Jr+Bt.y,Lt.x,Lt.y+Lt.h,h,pn,gt.x,Dt.y,tn,$t),Iw(ge,R.x,R.y,Ot.x,Jr+Ot.y,Lt.x+Lt.w,Lt.y+Lt.h,h,pn,Dt.x,Dt.y,tn,$t),A){const{x:Zt,y:Pn,z:Or}=A.anchor,[gi,Ei,jr]=A.up;Mw(ke,Zt,Pn,Or,gi,Ei,jr),Mw(ke,Zt,Pn,Or,gi,Ei,jr),Mw(ke,Zt,Pn,Or,gi,Ei,jr),Mw(ke,Zt,Pn,Or,gi,Ei,jr),P1(s.dynamicLayoutVertexArray,Zt,Pn,Or,$e)}else P1(s.dynamicLayoutVertexArray,R.x,R.y,R.z,$e);if(re){const Zt=yt||Lt;Rw(s.iconTransitioningVertexArray,Zt.x,Zt.y),Rw(s.iconTransitioningVertexArray,Zt.x+Zt.w,Zt.y),Rw(s.iconTransitioningVertexArray,Zt.x,Zt.y+Zt.h),Rw(s.iconTransitioningVertexArray,Zt.x+Zt.w,Zt.y+Zt.h)}he.emplaceBack(Rn,Rn+1,Rn+2),he.emplaceBack(Rn+1,Rn+2,Rn+3),Ee.vertexLength+=4,Ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Bn[0]),kt!==u.length-1&&xn===u[kt+1].sectionIndex||s.programConfigurations.populatePaintArrays(ge.length,v,v.index,{},V,H,K,mt&&mt[xn],this.worldview)}const Xe=ue-u.length;Xe!==0&&this._addNullVertices(Xe,ge,h,A,ke,s,re,Ee,he);const vt=A?A.anchor:R;s.placedSymbolArray.emplaceBack(vt.x,vt.y,vt.z,R.x,R.y,Pe,this.glyphOffsetArray.length-Pe,Be,O,D,R.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],w,0,0,0,z,0),s.symbolInstanceIndices.push(ne)}_addNullVertices(s,u,h,p,_,v,w,A,R){for(let O=0;O<s;O++){for(let z=0;z<4;z++)Iw(u,0,0,0,0,0,0,h,!1,0,0,0,0),p&&Mw(_,0,0,0,0,0,0),P1(v.dynamicLayoutVertexArray,0,0,0,0),w&&Rw(v.iconTransitioningVertexArray,0,0);const D=A.vertexLength;R.emplaceBack(D,D+1,D+2),R.emplaceBack(D+1,D+2,D+3),A.vertexLength+=4,A.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(s,u,h,p,_,v,w){s.emplaceBack(u,h,p,_,v,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(s,u,h,p,_,v,w){const A=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),R=A.vertexLength,O=w.tileAnchorX,D=w.tileAnchorY;for(let V=0;V<4;V++)h.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(h.collisionVertexArrayExt,u,s.padding,w.zOffset),this._commitLayoutVertex(h.layoutVertexArray,p,_,v,O,D,new je(s.x1,s.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,_,v,O,D,new je(s.x2,s.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,_,v,O,D,new je(s.x2,s.y2)),this._commitLayoutVertex(h.layoutVertexArray,p,_,v,O,D,new je(s.x1,s.y2)),A.vertexLength+=4;const z=h.indexArray;z.emplaceBack(R,R+1),z.emplaceBack(R+1,R+2),z.emplaceBack(R+2,R+3),z.emplaceBack(R+3,R),A.primitiveLength+=4}_addTextDebugCollisionBoxes(s,u,h,p,_,v){for(let w=p;w<_;w++){const A=h.get(w),R=this.getSymbolInstanceTextSize(s,v,u,w);this._addCollisionDebugVertices(A,R,this.textCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(s,u,h,p,_,v){for(let w=p;w<_;w++){const A=h.get(w),R=this.getSymbolInstanceIconSize(s,u,v.placedIconSymbolIndex);this._addCollisionDebugVertices(A,R,this.iconCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,v)}}generateCollisionDebugBuffers(s,u,h){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new H6(r1,D7.members,xu),this.iconCollisionBox=new H6(r1,D7.members,xu);const p=k1(this.iconSizeData,s),_=k1(this.textSizeData,s,h);for(let v=0;v<this.symbolInstances.length;v++){const w=this.symbolInstances.get(v);this._addTextDebugCollisionBoxes(_,s,u,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(_,s,u,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(p,s,u,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(p,s,u,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(s,u,h,p){const _=this.text.placedSymbolArray.get(u.rightJustifiedTextSymbolIndex>=0?u.rightJustifiedTextSymbolIndex:u.centerJustifiedTextSymbolIndex>=0?u.centerJustifiedTextSymbolIndex:u.leftJustifiedTextSymbolIndex>=0?u.leftJustifiedTextSymbolIndex:u.verticalPlacedTextSymbolIndex>=0?u.verticalPlacedTextSymbolIndex:p),v=N6(this.textSizeData,s,_)/So;return this.tilePixelRatio*v}getSymbolInstanceIconSize(s,u,h){const p=this.icon.placedSymbolArray.get(h),_=N6(this.iconSizeData,s,p);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(s,u,h,p){s.emplaceBack(u,-h,-h,p),s.emplaceBack(u,h,-h,p),s.emplaceBack(u,h,h,p),s.emplaceBack(u,-h,h,p)}_updateTextDebugCollisionBoxes(s,u,h,p,_,v,w){for(let A=p;A<_;A++){const R=h.get(A),O=this.getSymbolInstanceTextSize(s,v,u,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,O,R.padding,v.zOffset)}}_updateIconDebugCollisionBoxes(s,u,h,p,_,v,w){for(let A=p;A<_;A++){const R=h.get(A),O=this.getSymbolInstanceIconSize(s,u,v.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,O,R.padding,v.zOffset)}}updateCollisionDebugBuffers(s,u,h,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const _=k1(this.iconSizeData,s,p),v=k1(this.textSizeData,s,h);for(let w=0;w<this.symbolInstances.length;w++){const A=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(v,s,u,A.textBoxStartIndex,A.textBoxEndIndex,A,h),this._updateTextDebugCollisionBoxes(v,s,u,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A,h),this._updateIconDebugCollisionBoxes(_,s,u,A.iconBoxStartIndex,A.iconBoxEndIndex,A,p),this._updateIconDebugCollisionBoxes(_,s,u,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(s,u,h,p,_,v,w,A,R){const O={};if(u<h){const{x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge,featureIndex:ke}=s.get(u);O.textBox={x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge},O.textFeatureIndex=ke}if(p<_){const{x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge,featureIndex:ke}=s.get(p);O.verticalTextBox={x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge},O.verticalTextFeatureIndex=ke}if(v<w){const{x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge,featureIndex:ke}=s.get(v);O.iconBox={x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge},O.iconFeatureIndex=ke}if(A<R){const{x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge,featureIndex:ke}=s.get(A);O.verticalIconBox={x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge},O.verticalIconFeatureIndex=ke}return O}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const h=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(s,u){const h=s.placedSymbolArray.get(u),p=h.vertexStartIndex+4*h.numGlyphs;for(let _=h.vertexStartIndex;_<p;_+=4)s.indexArray.emplaceBack(_,_+1,_+2),s.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(s),h=Math.cos(s),p=[],_=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const A=this.symbolInstances.get(w);p.push(0|Math.round(u*A.tileAnchorX+h*A.tileAnchorY)),_.push(A.featureIndex)}return v.sort((w,A)=>p[w]-p[A]||_[A]-_[w]),v}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let s=0;s<this.symbolInstances.length;++s)this.symbolInstanceIndexesSortedZOffset.push(s)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((s,u)=>this.symbolInstances.get(u).zOffset-this.symbolInstances.get(s).zOffset)}addToSortKeyRanges(s,u){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===u?h.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const h=this.symbolInstances.get(u);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:R}=h;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&_!==p&&this.addIndicesForPlacedSymbol(this.text,_),v>=0&&v!==_&&v!==p&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(s){const u=this.symbolInstances.get(this.text.symbolInstanceIndices[s]).elevationFeatureIndex;let h;return this.elevationFeatures&&u<this.elevationFeatures.length&&(h=this.elevationFeatures[u]),h}}function y9(c,s){return s.replace(/{([^{}]+)}/g,(u,h)=>h in c?String(c[h]):"")}let v9,x9,G6;En(u3,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),u3.addDynamicAttributes=P1;class b9{constructor(s){this.type=s.property.overrides?s.property.overrides.runtimeType:vc,this.defaultValue=s}evaluate(s){if(s.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(s.formattedSection))return u.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}En(b9,"FormatSectionOverride",{omit:["defaultValue"]});const q6=()=>G6||(G6={layout:v9||(v9=new xa({"symbol-placement":new Wt(Qe.layout_symbol["symbol-placement"]),"symbol-spacing":new Wt(Qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Wt(Qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new an(Qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Wt(Qe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Wt(Qe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Wt(Qe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Wt(Qe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Wt(Qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Wt(Qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Wt(Qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new an(Qe.layout_symbol["icon-size"]),"icon-size-scale-range":new Wt(Qe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new an(Qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new an(Qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new an(Qe.layout_symbol["icon-image"]),"icon-image-use-theme":new Wt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new an(Qe.layout_symbol["icon-rotate"]),"icon-padding":new Wt(Qe.layout_symbol["icon-padding"]),"icon-keep-upright":new Wt(Qe.layout_symbol["icon-keep-upright"]),"icon-offset":new an(Qe.layout_symbol["icon-offset"]),"icon-anchor":new an(Qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Wt(Qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Wt(Qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Wt(Qe.layout_symbol["text-rotation-alignment"]),"text-field":new an(Qe.layout_symbol["text-field"]),"text-font":new an(Qe.layout_symbol["text-font"]),"text-size":new an(Qe.layout_symbol["text-size"]),"text-size-scale-range":new Wt(Qe.layout_symbol["text-size-scale-range"]),"text-max-width":new an(Qe.layout_symbol["text-max-width"]),"text-line-height":new an(Qe.layout_symbol["text-line-height"]),"text-letter-spacing":new an(Qe.layout_symbol["text-letter-spacing"]),"text-justify":new an(Qe.layout_symbol["text-justify"]),"text-radial-offset":new an(Qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Wt(Qe.layout_symbol["text-variable-anchor"]),"text-anchor":new an(Qe.layout_symbol["text-anchor"]),"text-max-angle":new Wt(Qe.layout_symbol["text-max-angle"]),"text-writing-mode":new Wt(Qe.layout_symbol["text-writing-mode"]),"text-rotate":new an(Qe.layout_symbol["text-rotate"]),"text-padding":new Wt(Qe.layout_symbol["text-padding"]),"text-keep-upright":new Wt(Qe.layout_symbol["text-keep-upright"]),"text-transform":new an(Qe.layout_symbol["text-transform"]),"text-offset":new an(Qe.layout_symbol["text-offset"]),"text-allow-overlap":new Wt(Qe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Wt(Qe.layout_symbol["text-ignore-placement"]),"text-optional":new Wt(Qe.layout_symbol["text-optional"]),visibility:new Wt(Qe.layout_symbol.visibility)})),paint:x9||(x9=new xa({"icon-opacity":new an(Qe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new an(Qe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new an(Qe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new an(Qe.paint_symbol["text-emissive-strength"]),"icon-color":new an(Qe.paint_symbol["icon-color"]),"icon-halo-color":new an(Qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new an(Qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new an(Qe.paint_symbol["icon-halo-blur"]),"icon-translate":new Wt(Qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Wt(Qe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Wt(Qe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new an(Qe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new an(Qe.paint_symbol["text-occlusion-opacity"]),"text-color":new an(Qe.paint_symbol["text-color"],{runtimeType:zl,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new an(Qe.paint_symbol["text-halo-color"]),"text-halo-width":new an(Qe.paint_symbol["text-halo-width"]),"text-halo-blur":new an(Qe.paint_symbol["text-halo-blur"]),"text-translate":new Wt(Qe.paint_symbol["text-translate"]),"text-translate-anchor":new Wt(Qe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Wt(Qe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Wt(Qe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Wt(Qe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Wt(Qe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new an(Qe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},G6);class c3 extends kl{constructor(s,u,h,p){super(s,q6(),u,h,p,s.layout?s.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=q([]),this.hasOcclusionOpacityProperties=s.paint!==void 0&&("icon-occlusion-opacity"in s.paint||"text-occlusion-opacity"in s.paint)}_handleSpecialPaintPropertyUpdate(s){s!=="icon-occlusion-opacity"&&s!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(s,u){super.recalculate(s,u),this.appearances&&this.appearances.forEach(p=>{p.recalculate(s,u,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const p=[];for(const _ of h)p.indexOf(_)<0&&p.push(_);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(s,u,h,p){return this._saturation===s&&this._contrast===u&&this._brightnessMin===h&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(_,v,w,A){_=Ps(_),v=$r(v);const R=F(),O=_/3,D=1-2*O,z=[D,O,O,0,O,D,O,0,O,O,D,0,0,0,0,1],V=.5-.5*v,H=A-w;return $(R,[H,0,0,0,0,H,0,0,0,0,H,0,w,w,w,1],[v,0,0,0,0,v,0,0,0,0,v,0,V,V,V,1]),$(R,R,z),R}(s,u,h,p),this._saturation=s,this._contrast=u,this._brightnessMin=h,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(s,u,h,p){const _=this.layout.get(s).evaluate(u,{},h,p),v=this._unevaluatedLayout._values[s];return v.isDataDriven()||hg(v.value)||!_?_:y9(u.properties,_)}getAppearanceValueAndResolveTokens(s,u,h,p,_){const v=s.getProperty(u);if(!v)return;const w=v.evaluate(h,{},p,_),A=s.getUnevaluatedProperties()._values[u];return A.isDataDriven()||hg(A.value)||!w||typeof w!="string"?w:y9(h.properties,w)}createBucket(s){return new u3(s)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const s of q6().paint.overridableProperties){if(!c3.hasPaintOverride(this.layout,s))continue;const u=this.paint.get(s),h=new b9(u),p=new By(h,u.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let _=null;_=u.value.kind==="constant"||u.value.kind==="source"?new rm("source",p):new Uf("composite",p,u.value.zoomStops,u.value.interpolationType),this.paint._values[s]=new $f(u.property,_,u.parameters)}}_handleOverridablePaintPropertyUpdate(s,u,h){return!(!this.layout||u.isDataDriven()||h.isDataDriven())&&c3.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,u){const h=s.get("text-field"),p=q6().paint.properties[u];let _=!1;const v=w=>{for(const A of w)if(p.overrides&&p.overrides.hasOverride(A))return void(_=!0)};if(h.value.kind==="constant"&&h.value.value instanceof El)v(h.value.value.sections);else if(h.value.kind==="source"){const w=R=>{_||(R instanceof Pd&&Eo(R.value)===K0?v(R.value.sections):R instanceof Jc?v(R.sections):R.eachChild(w))},A=h.value;A._styleExpression&&w(A._styleExpression.expression)}return _}getProgramIds(){return["symbol"]}getDefaultProgramParams(s,u,h){return{config:new Hh(this,{zoom:u,lut:h}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let w9,T9,E9,S9;var Z6=hi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function d3(c,s,u,h,p,_,v,w){const A=[c,s,1,u,h,1,p,_,1],R=[v,w,1],O=P([],A),[D,z,V]=br(R,R,O);return L(A,A,[D,0,0,0,z,0,0,0,V])}function A9(c,s,u,h,p,_,v,w){const A=function(R,O,D,z,V,H,K,re){const ne=d3(0,0,1,0,1,1,0,1),ue=d3(R,O,D,z,V,H,K,re);return L(ue,ue,P([],ne))}(c,s,u,h,p,_,v,w);return[A[2]/A[8]/Jt,A[5]/A[8]/Jt]}function h3(c){return[c[0],Math.min(Math.max(c[1],-Y),Y)]}class C9 extends Df{constructor(s,u,h,p){super(),this.id=s,this.dispatcher=h,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=u,this._dirty=!1}load(s,u){if(this._loaded=u||!1,this.fire(new Kc("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return s&&(this.coordinates=s),this._loaded=!0,void this._finishLoading();this._imageRequest=ay(this.map._requestManager.transformRequest(this.url,H0.Image),(h,p)=>{this._imageRequest=null,this._loaded=!0,h?this.fire(new W0(h)):p&&(this.image=p instanceof HTMLImageElement?To.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return s.url?(this._imageRequest&&s.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=s.url,this.load(s.coordinates,this._loaded),this):this}setTexture(s){if(!(s.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new mw(this.map.painter.context,s.handle),this.width=s.dimensions[0],this.height=s.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Kc("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(s){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof mw||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(s){if(this.coordinates=s,this._boundsArray=void 0,this._unsupportedCoords=!1,!s.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let u=s[0][1],h=s[0][1];for(const _ of s)_[1]>h&&(h=_[1]),_[1]<u&&(u=_[1]);const p=(h+u)/2;if(p>Y?this.onNorthPole=!0:p<-Y&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const _=s.map(pe.fromLngLat);this.tileID=function(v){let w=1/0,A=1/0,R=-1/0,O=-1/0;for(const K of v)w=Math.min(w,K.x),A=Math.min(A,K.y),R=Math.max(R,K.x),O=Math.max(O,K.y);const D=Math.max(R-w,O-A),z=Math.max(0,Math.floor(-Math.log2(D))),V=Math.pow(2,z);let H=Math.floor((w+R)/2*V);return H>1&&(H-=1),new bs(z,H,Math.floor((A+O)/2*V))}(_),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Kc("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof mw||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(s){for(const ne in this.tiles){const ue=this.tiles[ne];ue.state!=="loaded"&&(ue.state="loaded",ue.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const u=Ew(new bs(0,0,0),this.map.transform.projection),h=[u.projection.project(this.coordinates[0][0],this.coordinates[0][1]),u.projection.project(this.coordinates[1][0],this.coordinates[1][1]),u.projection.project(this.coordinates[2][0],this.coordinates[2][1]),u.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ne){const ue=ne[1].x-ne[0].x,he=ne[1].y-ne[0].y,ge=ne[2].x-ne[1].x,ke=ne[2].y-ne[1].y,Ee=ne[3].x-ne[2].x,Pe=ne[3].y-ne[2].y,Be=ne[0].x-ne[3].x,$e=ne[0].y-ne[3].y,mt=ue*ke-ge*he,Xe=ge*Pe-Ee*ke,vt=Ee*$e-Be*Pe,kt=Be*he-ue*$e;return mt>0&&Xe>0&&vt>0&&kt>0||mt<0&&Xe<0&&vt<0&&kt<0}(h))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=Ew(this.tileID,this.map.transform.projection),[_,v,w,A]=this.coordinates.map(ne=>{const ue=p.projection.project(ne[0],ne[1]);return h9(p,ue)._round()});this.perspectiveTransform=A9(_.x,_.y,v.x,v.y,w.x,w.y,A.x,A.y);const R=this._boundsArray=new om;R.emplaceBack(_.x,_.y,0,0),R.emplaceBack(v.x,v.y,Jt,0),R.emplaceBack(A.x,A.y,0,Jt),R.emplaceBack(w.x,w.y,Jt,Jt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=s.createVertexBuffer(R,Z6.members),this.boundsSegments=da.simpleSegment(0,0,4,2);const O=[],D=[h3((z=this.coordinates)[0]),h3(z[1]),h3(z[2]),h3(z[3])];var z;const[V,H,K,re]=function(ne){let ue=ne[0][0],he=ue,ge=ne[0][1],ke=ge;for(let Ee=1;Ee<ne.length;Ee++)ne[Ee][0]<ue?ue=ne[Ee][0]:ne[Ee][0]>he&&(he=ne[Ee][0]),ne[Ee][1]<ge?ge=ne[Ee][1]:ne[Ee][1]>ke&&(ke=ne[Ee][1]);return[ue,ge,he-ue,ke-ge]}(D);{const ne=new om,[ue,he,ge,ke]=function(Ot){let Lt=Ot[0].x,yt=Lt,gt=Ot[0].y,Dt=gt;for(let tn=1;tn<Ot.length;tn++)Ot[tn].x<Lt?Lt=Ot[tn].x:Ot[tn].x>yt&&(yt=Ot[tn].x),Ot[tn].y<gt?gt=Ot[tn].y:Ot[tn].y>Dt&&(Dt=Ot[tn].y);return[Lt,gt,yt-Lt,Dt-gt]}(h),Ee=Ot=>[(Ot.x-ue)/ge,(Ot.y-he)/ke],[Pe,Be,$e,mt]=h.map(Ee),Xe=function(Ot,Lt,yt,gt,Dt,tn,$t,Bn){const pn=d3(0,0,1,0,1,1,0,1);return L(pn,pn,P([],d3(Ot,Lt,yt,gt,Dt,tn,$t,Bn)))}(Pe[0],Pe[1],Be[0],Be[1],$e[0],$e[1],mt[0],mt[1]);this.elevatedGlobePerspectiveTransform=A9(Pe[0],Pe[1],Be[0],Be[1],$e[0],$e[1],mt[0],mt[1]);const vt=(Ot,Lt)=>{O.push(Ot.lng);const yt=Math.round((Ot.lng-V)/K*Jt),gt=Math.round((Ot.lat-H)/re*Jt),Dt=Ee(Lt),tn=br([],[Dt[0],Dt[1],1],Xe),$t=Math.round(tn[0]/tn[2]*Jt),Bn=Math.round(tn[1]/tn[2]*Jt);ne.emplaceBack(yt,gt,$t,Bn)},kt=h[3].x-h[0].x,It=h[3].y-h[0].y,zt=h[2].x-h[1].x,Bt=h[2].y-h[1].y;for(let Ot=0;Ot<65;Ot++){const Lt=Ot/64,yt=[h[0].x+Lt*kt,h[0].y+Lt*It],gt=[h[1].x+Lt*zt,h[1].y+Lt*Bt],Dt=gt[0]-yt[0],tn=gt[1]-yt[1];for(let $t=0;$t<65;$t++){const Bn=$t/64,pn={x:yt[0]+Dt*Bn,y:yt[1]+tn*Bn};vt(u.projection.unproject(pn.x,pn.y),pn)}}this.elevatedGlobeVertexBuffer=s.createVertexBuffer(ne,Z6.members)}{this.maxLongitudeTriangleSize=0;let ne=[],ue=new to;const he=(ge,ke,Ee)=>{ue.emplaceBack(ge,ke,Ee);const Pe=O[ge],Be=O[ke],$e=O[Ee],mt=Math.min(Math.min(Pe,Be),$e),Xe=Math.max(Math.max(Pe,Be),$e)-mt;Xe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Xe),ne.push(mt+Xe/2)};for(let ge=0;ge<64;ge++)for(let ke=0;ke<64;ke++){const Ee=65*ge+ke,Pe=Ee+1,Be=Ee+65,$e=Be+1;he(Ee,Be,Pe),he(Pe,Be,$e)}[ne,ue]=function(ge,ke){const Ee=Array.from({length:ge.length},($e,mt)=>mt);Ee.sort(($e,mt)=>ge[$e]-ge[mt]);const Pe=[],Be=new to;for(let $e=0;$e<Ee.length;$e++){const mt=Ee[$e];Pe.push(ge[mt]);const Xe=3*mt,vt=Xe+1;Be.emplaceBack(ke.uint16[Xe],ke.uint16[vt],ke.uint16[vt+1])}return[Pe,Be]}(ne,ue),this.elevatedGlobeTrianglesCenterLongitudes=ne,this.elevatedGlobeIndexBuffer=s.createIndexBuffer(ue)}this.elevatedGlobeSegments=da.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,K/Jt,0,re/Jt,0,0,H,V,0])}prepare(){const s=Object.keys(this.tiles).length!==0;if(this.tileID&&!s)return;const u=this.map.painter.context,h=u.gl;!this._dirty||this.texture instanceof mw||(this.texture?this.texture.update(this.image):(this.texture=new y6(u,this.image,h.RGBA8),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),s&&this._prepareData(u)}loadTile(s,u){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},u(null)):(s.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(s){const u=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!u)return null;const h=this.elevatedGlobeTrianglesCenterLongitudes;let p=(_=s+180)+360*Math.round((h[0]-_)/360);var _;const v=new da,w=(D,z)=>{v.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:u.segments[0].vertexLength,primitiveLength:z,sortKey:void 0,vaos:{}})},A=.51*this.maxLongitudeTriangleSize;if(Math.abs(h[0]-p)<=A){const D=Hi(h,0,h.length,p+A);return D===h.length||w(D,vs(h,D+1,h.length,p+360-A)-D),v}p<h[0]&&(p+=360);const R=vs(h,0,h.length,p-A);if(R===h.length)return w(0,h.length),v;w(0,R-0);const O=Hi(h,R+1,h.length,p+A);return O!==h.length&&w(O,h.length-O),v}}const Jae=(Math.pow(256,2)-1)/16907520;class k9 extends kl{constructor(s,u,h,p){super(s,{layout:E9||(E9=new xa({visibility:new Wt(Qe.layout_raster.visibility)})),paint:S9||(S9=new xa({"raster-opacity":new Wt(Qe.paint_raster["raster-opacity"]),"raster-color":new Gf(Qe.paint_raster["raster-color"]),"raster-color-mix":new Wt(Qe.paint_raster["raster-color-mix"]),"raster-color-range":new Wt(Qe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Wt(Qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Wt(Qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Wt(Qe.paint_raster["raster-brightness-max"]),"raster-saturation":new Wt(Qe.paint_raster["raster-saturation"]),"raster-contrast":new Wt(Qe.paint_raster["raster-contrast"]),"raster-resampling":new Wt(Qe.paint_raster["raster-resampling"]),"raster-fade-duration":new Wt(Qe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Wt(Qe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Wt(Qe.paint_raster["raster-array-band"]),"raster-elevation":new Wt(Qe.paint_raster["raster-elevation"]),"raster-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},u,h,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(s){return!(s&&s._source instanceof C9&&(s._source.onNorthPole||s._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(s){s!=="raster-color"&&s!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(s){if(!this.hasColorMap()||!this._curRampRange)return;const u=this._transitionablePaint._values["raster-color"].value.expression,[h,p]=s||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(h)&&isNaN(p)||h===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=ew({expression:u,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:h,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[h,p])}}let I9,R9,M9,P9,O9;class L9 extends kl{constructor(s,u,h,p){super(s,{layout:I9||(I9=new xa({visibility:new Wt(Qe["layout_raster-particle"].visibility)})),paint:R9||(R9=new xa({"raster-particle-array-band":new Wt(Qe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Wt(Qe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Gf(Qe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Wt(Qe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Wt(Qe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Wt(Qe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Wt(Qe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Wt(Qe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},u,h,p),this._updateColorRamp(),this.lastInvalidatedAt=To.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(s){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(s){return!1}_handleSpecialPaintPropertyUpdate(s){s!=="raster-particle-color"&&s!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),s==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const s=this._transitionablePaint._values["raster-particle-color"].value.expression,u=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=ew({expression:s,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:u}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=To.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class eoe extends kl{constructor(s,u){super(s,{},u,null),this.implementation=s,s.slot&&(this.slot=s.slot)}is3D(s){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(s){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)}onRemove(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)}}function W6(c,s,u){const h=[0,0,1],p=Kt([]);return Lr(p,p,u?-cn(c)+Math.PI:cn(c)),An(p,p,-cn(s)),Qr(h,h,p),qt(h,h)}const D9={None:0,Model:1,Symbol:2,FillExtrusion:4};class f3{constructor(s,u,h,p){this.message=(s?`${s}: `:"")+h,p&&(this.identifier=p),u!=null&&u.__line__&&(this.line=u.__line__)}}function X6(c,s){const u=c.indexOf("://")===-1;try{return new URL(c,u&&s?"http://example.com":void 0),!0}catch{return!1}}class N9{constructor(s,u){this.feature=s,this.instancedDataOffset=u,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class z9{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new $b,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(s){const u=16*s,h=this.instancedDataArray.float32;let p=Math.floor(h[u+2]);const _=1.05*(h[u+2]-p);return p/=100,[h[u]%1*1.05,h[u+1]%1*1.05,_,p]}tileCoordinatesForInstance(s){const u=16*s,h=this.instancedDataArray.float32;let p=h[u+0];return p=p>Jt?p-Jt:p,new je(Math.trunc(p),Math.trunc(h[u+1]))}translationForInstance(s){const u=16*s,h=this.instancedDataArray.float32;return[h[u+4],h[u+5],h[u+6]]}rotationScaleForInstance(s){const u=16*s,h=this.instancedDataArray.float32;return[h[u+7],h[u+8],h[u+9],h[u+10],h[u+11],h[u+12],h[u+13],h[u+14],h[u+15]]}transformForInstance(s){const u=16*s,h=this.instancedDataArray.float32;return[h[u+7],h[u+8],h[u+9],h[u+4],h[u+10],h[u+11],h[u+12],h[u+5],h[u+13],h[u+14],h[u+15],h[u+6],0,0,0,1]}}class Y6{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.overscaledZ=this.canonical.z+Math.log2(s.overscaling),this.layers=s.layers,this.layerIds=this.layers.map(u=>u.fqid),this.projection=s.projection,this.index=s.index,this.worldview=s.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=s.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(s,u){}updateAppearances(s,u,h,p){}populate(s,u,h,p){this.tileToMeter=ae(h);const _=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:v,id:w,index:A,sourceLayerIndex:R}of s){const O=w??(v.properties&&v.properties.hasOwnProperty("id")?v.properties.id:void 0),D=We(v,_);if(!this.layers[0]._featureFilter.filter(new zs(this.zoom,{worldview:this.worldview,activeFloors:u.activeFloors}),D,h))continue;const z={id:O,sourceLayerIndex:R,index:A,geometry:_?D.geometry:ze(v,h,p),properties:v.properties,type:v.type,patterns:{}},V=this.addFeature(z,z.geometry,D);V&&u.featureIndex.insert(v,z.geometry,A,R,this.index,this.instancesPerModel[V].instancedDataArray.length,Jt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const s=this.layers[0].modelManager,u=this.layers[0].scope;let h=0;for(const p of this.modelUris){const _=s.getModel(p,u);if(!_)continue;const v=this.instancesPerModel[p];if(v){const w=.5*Tn(_.aabb.max,_.aabb.min)*v.maxScale+v.maxXYTranslationDistance,A=Math.min(Jt,Math.max(w/this.tileToMeter,Jt/32));h=Math.max(A,h)}}return h}update(s,u,h,p){for(const _ in this.instancesPerModel){const v=this.instancesPerModel[_];for(const w in s)v.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(v.features[v.idToFeaturesIndex[w]],s[w],v,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let s=!1;for(const u in this.instancesPerModel){const h=this.instancesPerModel[u];for(const p of h.features){const _=this.layers[0],v=p.feature,w=this.canonical,A=_.paint.get("model-rotation").evaluate(v,{},w),R=_.paint.get("model-scale").evaluate(v,{},w),O=_.paint.get("model-translation").evaluate(v,{},w);ar(p.rotation,A)&&ar(p.scale,R)&&ar(p.translation,O)||(this.evaluate(p,p.featureStates,h,!0),s=!0)}}return s}updateReplacement(s,u,h,p){if(u.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=u.updateTime;const _=u.getReplacementRegionsForTile(s.toUnwrapped(),!0);if(zS(this.activeReplacements,_))return!1;this.activeReplacements=_;let v=!1;for(const w in this.instancesPerModel){const A=this.instancesPerModel[w],R=A.instancedDataArray;for(const O of A.features){const D=O.instancedDataOffset,z=O.instancedDataCount;for(let V=0;V<z;V++){const H=16*(V+D);let K=R.float32[H+0];const re=K>Jt;K=re?K-Jt:K;const ne=Math.floor(K),ue=Math.floor(R.float32[H+1]);let he=!1;for(const ge of this.activeReplacements)if(!Tz(ge,h,D9.Model,p)&&!(ge.min.x>ne||ne>ge.max.x||ge.min.y>ue||ue>ge.max.y)&&(he=kz(Cz(ne,ue,s.canonical,ge.footprintTileId.canonical),ge.footprint),he))break;R.float32[H]=he?K+Jt:K,v=v||he!==re}}}return v}isEmpty(){for(const s in this.instancesPerModel)if(this.instancesPerModel[s].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(s){if(!this.uploaded)for(const u in this.instancesPerModel){const h=this.instancesPerModel[u];h.instancedDataArray.length<0||h.instancedDataArray.length===0||(h.instancedDataBuffer?h.instancedDataBuffer.updateData(h.instancedDataArray):h.instancedDataBuffer=s.createVertexBuffer(h.instancedDataArray,Tse.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(s){for(const h in this.instancesPerModel){const p=this.instancesPerModel[h];p.instancedDataArray.length!==0&&p.instancedDataBuffer&&p.instancedDataBuffer.destroy()}const u=this.layers[0].modelManager;if(s&&u&&this.modelUris&&this.modelsRequested)for(const h of this.modelUris)u.removeModel(h,"",!0)}addFeature(s,u,h){const p=this.layers[0],_=p.layout.get("model-id").evaluate(h,{},this.canonical);if(!_)return Qt(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),_;(X6(_,!1)||this.styleDefinedModelURLs[_]!==void 0)&&(this.modelUris.includes(_)||this.modelUris.push(_)),this.instancesPerModel[_]||(this.instancesPerModel[_]=new z9);const v=this.instancesPerModel[_],w=v.instancedDataArray,A=new N9(h,w.length);for(const R of u)for(const O of R){if(O.x<0||O.x>=Jt||O.y<0||O.y>=Jt)continue;if(this.lookupDim!==0){const z=(this.lookupDim-1)/Jt,V=this.lookupDim*(O.y*z|0)+O.x*z|0;if(this.lookup){if(this.lookup[V]!==0)continue;this.lookup[V]=1}}this.instanceCount++;const D=w.length;w.resize(D+1),v.instancesEvaluatedElevation.push(0),w.float32[16*D]=O.x,w.float32[16*D+1]=O.y}return A.instancedDataCount=v.instancedDataArray.length-A.instancedDataOffset,A.instancedDataCount>0&&(s.id&&(v.idToFeaturesIndex[s.id]=v.features.length),v.features.push(A),this.evaluate(A,{},v,!1)),_}getModelUris(){return this.modelUris}evaluate(s,u,h,p){const _=this.layers[0],v=s.feature,w=this.canonical,A=s.rotation=_.paint.get("model-rotation").evaluate(v,u,w),R=s.scale=_.paint.get("model-scale").evaluate(v,u,w),O=s.translation=_.paint.get("model-translation").evaluate(v,u,w),D=Object.assign({},_.paint.get("model-color").evaluate(v,u,w));D.a=_.paint.get("model-color-mix-intensity").evaluate(v,u,w);const z=[];this.maxVerticalOffset<O[2]&&(this.maxVerticalOffset=O[2]);const V=O[0]*O[0]+O[1]*O[1],H=V>0?Math.sqrt(V):0;h.maxScale=Math.max(Math.max(h.maxScale,R[0]),Math.max(R[1],R[2])),h.maxXYTranslationDistance=Math.max(h.maxXYTranslationDistance,H),this.maxScale=Math.max(Math.max(this.maxScale,R[0]),Math.max(R[1],R[2])),p7(z,A,R);const K=Math.round(100*D.a)+D.b/1.05;for(let re=0;re<s.instancedDataCount;++re){const ne=s.instancedDataOffset+re,ue=16*ne,he=h.instancedDataArray.float32;let ge=0;p&&(ge=he[ue+6]-h.instancesEvaluatedElevation[ne]);const ke=0|he[ue+1];he[ue]=(0|he[ue])+D.r/1.05,he[ue+1]=ke+D.g/1.05,he[ue+2]=K,he[ue+3]=1/(w.z>10?this.tileToMeter:ae(w,ke)),he[ue+4]=O[0],he[ue+5]=O[1],he[ue+6]=O[2]+ge,he[ue+7]=z[0],he[ue+8]=z[1],he[ue+9]=z[2],he[ue+10]=z[4],he[ue+11]=z[5],he[ue+12]=z[6],he[ue+13]=z[8],he[ue+14]=z[9],he[ue+15]=z[10],h.instancesEvaluatedElevation[ne]=O[2]}}}let F9,B9;En(Y6,"ModelBucket",{omit:["layers"]}),En(z9,"PerModelAttributes"),En(N9,"ModelFeature");class O1{constructor(s,u,h){this._demTile=s,this._dem=this._demTile.dem,this._scale=u,this._offset=h}static create(s,u,h){const p=h||s.findDEMTileFor(u);if(!p||!p.dem)return;const _=p.dem,v=p.tileID,w=1<<u.canonical.z-v.canonical.z;return new O1(p,_.dim/Jt/w,[(u.canonical.x/w-v.canonical.x)*_.dim,(u.canonical.y/w-v.canonical.y)*_.dim])}tileCoordToPixel(s,u){const h=u*this._scale+this._offset[1];return new je(Math.floor(s*this._scale+this._offset[0]),Math.floor(h))}getElevationAt(s,u,h,p){const _=s*this._scale+this._offset[0],v=u*this._scale+this._offset[1],w=Math.floor(_),A=Math.floor(v),R=this._dem;return p=!!p,h?Tr(Tr(R.get(w,A,p),R.get(w,A+1,p),v-A),Tr(R.get(w+1,A,p),R.get(w+1,A+1,p),v-A),_-w):R.get(w,A,p)}getElevationAtPixel(s,u,h){return this._dem.get(s,u,!!h)}getMeterToDEM(s){return(1<<this._demTile.tileID.canonical.z)*N(1,s)*this._dem.stride}}const K6=new Float32Array(262144),Lg=new Uint8Array(262144);function j9(c){let s=0;if(c.meshes)for(const u of c.meshes)s=Math.max(s,u.aabb.max[2]);if(c.children)for(const u of c.children)s=Math.max(s,j9(u));return s}function U9(c,s,u){if(c.meshes)for(const h of c.meshes){if(h.aabb.min[0]===1/0)continue;const p=Nn.applyTransform(h.aabb,c.globalMatrix);u.insert(s,p.min[0],p.min[1],p.max[0],p.max[1])}if(c.children)for(const h of c.children)U9(h,s,u)}const V9=["","wall","door","roof","window","lamp","logo"];class $9{constructor(s){this.node=s,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:s.id,geometry:[],properties:{height:j9(s)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let s=0;const u=new Nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const h of this.node.meshes)this.node.lightMeshIndex!==s&&(h.transformedAabb=Nn.applyTransformFast(h.aabb,this.node.globalMatrix),u.encapsulate(h.transformedAabb)),s++;this.aabb=u}return this.aabb}}class p3{constructor(s,u,h,p,_,v,w,A){this.id=h,this.layers=s,this.layerIds=this.layers.map(R=>R.fqid),this.stateDependentLayerIds=this.layers.filter(R=>R.isStateDependent()).map(R=>R.id),this.modelTraits|=E1.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=E1.HasMapboxMeshFeatures),_&&(this.modelTraits|=E1.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=v,this.worldview=A,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const R of u)this.nodesInfo.push(new $9(R)),U9(R,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(s,u){for(const h of this.getNodesInfo()){const p=h.node;p.footprint&&u.push({footprint:p.footprint,id:s})}}updateAppearances(s,u,h,p){}update(s){const u=Object.keys(s).length!==0;if(u&&!this.stateDependentLayers.length)return;const h=u?this.stateDependentLayers:this.layers;if(!jn(s,this.states))for(const p of h)this.evaluate(p,s);this.states=structuredClone(s)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(s){if(!this.needsUpload)return;const u=this.getNodesInfo();for(const h of u){const p=h.node;this.uploaded?this.updatePbrBuffer(p):b6(p,s,!0)}for(const h of u)XS(h.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(s){let u=!1;if(!s.meshes)return u;for(const h of s.meshes)h.pbrBuffer&&(h.pbrBuffer.updateData(h.featureArray),u=!0);return u}needsReEvaluation(s,u,h){const p=s.transform.projectionOptions,_=s.style.getBrightness(),v=this.brightness!==_;if(!this.uploaded||this.dirty||p.name!==this.projection.name||Pw(h.paint.get("model-color").value,v)||Pw(h.paint.get("model-color-mix-intensity").value,v)||Pw(h.paint.get("model-roughness").value,v)||Pw(h.paint.get("model-emissive-strength").value,v)||Pw(h.paint.get("model-height-based-emissive-strength-multiplier").value,v)){this.projection=p,this.brightness=_;const w=this.getNodesInfo();for(const A of w)A.state=null;return!0}return!1}evaluateTransform(s,u){if(s.transform.zoom===this.zoom)return;this.zoom=s.transform.zoom;const h=this.getNodesInfo(),p=this.id.canonical;for(const _ of h){const v=_.feature;_.evaluatedTranslation=u.paint.get("model-translation").evaluate(v,{},p),_.evaluatedScale=u.paint.get("model-scale").evaluate(v,{},p)}}evaluate(s,u){const h=this.getNodesInfo();for(const p of h){if(!p.node.meshes)continue;const _=p.feature,v=u&&u[_.id];if(jn(v,p.state))continue;p.state=structuredClone(v);const w=p.node.meshes&&p.node.meshes[0].featureData,A=p.evaluatedColor[2],R=p.evaluatedRMEA[2],O=this.id.canonical;if(p.hasTranslucentParts=!1,w){for(let D=0;D<V9.length;D++){const z=V9[D];z.length&&(_.properties.part=z);const V=s.paint.get("model-color").evaluate(_,v,O).toPremultipliedRenderColor(null),H=s.paint.get("model-color-mix-intensity").evaluate(_,v,O);p.evaluatedColor[D]=[V.r,V.g,V.b,H],p.evaluatedRMEA[D][0]=s.paint.get("model-roughness").evaluate(_,v,O),p.evaluatedRMEA[D][2]=s.paint.get("model-emissive-strength").evaluate(_,v,O),p.evaluatedRMEA[D][3]=V.a,p.emissionHeightBasedParams[D]=s.paint.get("model-height-based-emissive-strength-multiplier").evaluate(_,v,O),!p.hasTranslucentParts&&V.a<1&&(p.hasTranslucentParts=!0)}delete _.properties.part,noe(p,A!==p.evaluatedColor[2]||R!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=s.paint.get("model-emissive-strength").evaluate(_,v,O);p.evaluatedTranslation=s.paint.get("model-translation").evaluate(_,v,O),p.evaluatedScale=s.paint.get("model-scale").evaluate(_,v,O),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(s,u,h,p){const _=s.findDEMTileFor(h);if(_&&(_.tileID.canonical!==this.terrainTile||u!==this.terrainExaggeration)){if(_.dem&&_.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=_.tileID.overscaledZ;const v=O1.create(s,h,_);if(!v)return;this.modelTraits&E1.HasMapboxMeshFeatures&&this.updateDEM(s,v,h,p);for(const w of this.getNodesInfo()){const A=w.node;if(!A.footprint||!A.footprint.vertices||!A.footprint.vertices.length)continue;const R=A.footprint.vertices;let O=v.getElevationAt(R[0].x,R[0].y,!0,!0);for(let D=1;D<R.length;D++)O=Math.min(O,v.getElevationAt(R[D].x,R[D].y,!0,!0));A.elevation=O}}this.terrainTile=_.tileID.canonical,this.terrainExaggeration=u}}updateDEM(s,u,h,p){let _=u._dem._modifiedForSources[p];if(_===void 0&&(u._dem._modifiedForSources[p]=[],_=u._dem._modifiedForSources[p]),_.includes(h.canonical))return;const v=u._dem.dim;_.push(h.canonical);let w=!1;for(const A of this.getNodesInfo()){const R=A.node;if(!R.footprint||!R.footprint.grid)continue;const O=R.footprint.grid,D=u.tileCoordToPixel(O.min.x,O.min.y),z=u.tileCoordToPixel(O.max.x,O.max.y),V=Math.min(Math.min(v-z.y,D.x),Math.min(D.y,v-z.x));if(V<0)continue;const H=ee(V,2,5);let K=Math.max(0,D.x-H),re=Math.max(0,D.y-H),ne=Math.min(z.x+H,v-1),ue=Math.min(z.y+H,v-1);for(let Ee=re;Ee<=ue;++Ee)for(let Pe=K;Pe<=ne;++Pe)Lg[Ee*v+Pe]=255;let he=0,ge=0;for(let Ee=0;Ee<O.cellsY;++Ee)for(let Pe=0;Pe<O.cellsX;++Pe){if(!O.cells[Ee*O.cellsX+Pe])continue;const Be=u.tileCoordToPixel(O.min.x+Pe/O.xScale,O.min.y+Ee/O.yScale),$e=u.tileCoordToPixel(O.min.x+(Pe+1)/O.xScale,O.min.y+(Ee+1)/O.yScale);for(let mt=Be.y;mt<=Math.min($e.y+1,v-1);++mt)for(let Xe=Be.x;Xe<=Math.min($e.x+1,v-1);++Xe)Lg[mt*v+Xe]===255&&(Lg[mt*v+Xe]=0,he+=u.getElevationAtPixel(Xe,mt),ge++)}const ke=he/ge;K=Math.max(1,D.x-H),re=Math.max(1,D.y-H),ne=Math.min(z.x+H,v-2),ue=Math.min(z.y+H,v-2),w=!0;for(let Ee=re;Ee<=ue;++Ee)for(let Pe=K;Pe<=ne;++Pe)Lg[Ee*v+Pe]===0&&(K6[Ee*v+Pe]=u._dem.set(Pe,Ee,ke));for(let Ee=1;Ee<H;++Ee){K=Math.max(1,D.x-Ee),re=Math.max(1,D.y-Ee),ne=Math.min(z.x+Ee,v-2),ue=Math.min(z.y+Ee,v-2);for(let Pe=re;Pe<=ue;++Pe)for(let Be=K;Be<=ne;++Be){const $e=Pe*v+Be;if(Lg[$e]===255){let mt=0,Xe=0,vt=-1,kt=-1;for(let It=-1;It<=1;++It)for(let zt=-1;zt<=1;++zt){const Bt=(Pe+It)*v+Be+zt;if(Lg[Bt]>=Ee)continue;const Ot=K6[Bt],Lt=Math.abs(Ot);Lt>Xe&&(mt=Ot,Xe=Lt,vt=zt,kt=It)}if(Xe>.1){const It=1-(Ee+.5*Math.abs(vt*kt))/H;let zt=u._dem.get(Be,Pe)+mt*It;const Bt=u._dem.get(Be+vt,Pe+kt),Ot=u._dem.get(Be-vt,Pe-kt,!0);(zt-Bt)*(zt-Ot)>0&&(zt=(Bt+Ot)/2),K6[$e]=u._dem.set(Be,Pe,zt),Lg[$e]=Ee}}}}}w&&(u._demTile.needsDEMTextureUpload=!0,u._dem._timestamp=To.now())}setFilter(s){this.filter=s?Wy(s):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(s=>this.filter.filter(new zs(this.id.overscaledZ,{worldview:this.worldview}),s.feature,this.id.canonical)):this.nodesInfo}destroy(){const s=this.getNodesInfo();for(const u of s)XS(u.node),w6(u.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(s,u){if(u.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=u.updateTime;const h=u.getReplacementRegionsForTile(s.toUnwrapped());for(const p of this.getNodesInfo()){const _=p.node.footprint;p.hiddenByReplacement=!!_&&!h.find(v=>v.footprint===_)}}getHeightAtTileCoord(s,u){const h=[],p=[0,0,0],_=q([]);for(const v of this.getNodesInfo()){const w=v.node.meshes[0],A=w.transformedAabb;if(s<A.min[0]||u<A.min[1]||s>A.max[0]||u>A.max[1])continue;if(v.node.hidden===!0)return{height:1/0,maxHeight:v.feature.properties.height,hidden:!1,verticalScale:v.evaluatedScale[2]};G(_,v.node.globalMatrix),p[0]=s,p[1]=u,rn(p,p,_);const R=(p[0]-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*Mg|0,O=Math.min(63,(p[1]-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*Mg|0)*Mg+Math.min(63,R),D=w.heightmap[O];if(!(D<0&&v.node.footprint))return v.hiddenByReplacement?void 0:{height:D,maxHeight:v.feature.properties.height,hidden:!1,verticalScale:v.evaluatedScale[2]};if(v.node.footprint.grid.query(new je(s,u),new je(s,u),h),h.length>0)return{height:void 0,maxHeight:v.feature.properties.height,hidden:v.hiddenByReplacement,verticalScale:v.evaluatedScale[2]}}}}function Pw(c,s){return c instanceof rm&&!c.isLightConstant&&s}function toe(c,s,u,h,p,_,v,w){let A=(61440&s|(61440&s)>>4)>>8,R=(3840&s|(3840&s)>>4)>>4,O=240&s|(240&s)>>4;u[3]>0&&(A=Tr(A,255*u[0],u[3]),R=Tr(R,255*u[1],u[3]),O=Tr(O,255*u[2],u[3]));const D=A<<8|R,z=O<<8|Math.floor(255*h[3]),V=function(Ee){const Pe=ee(Ee,0,2);return Math.min(Math.round(.5*Pe*255),255)}(h[2])<<8|15*h[0]<<4|15*h[1],H=ee(p[0],0,1),K=ee(p[1],0,1),re=ee(p[2],0,1),ne=ee(p[3],0,1);let ue,he,ge,ke;if(H!==K&&v!==_&&K!==H){const Ee=v-_;he=1/(Ee*(K-H)),ge=-(_+Ee*H)/(Ee*(K-H));const Pe=ee(p[4],-1,1);ke=Math.pow(10,Pe),ue=255*re<<8|255*ne}else ue=65535,he=0,ge=1,ke=1;if(c.emplaceBack(D,z,V,ue,he,ge,ke),w){const Ee=w.length;w.clear();for(let Pe=0;Pe<Ee;Pe++)w.emplaceBack(D,z,V,ue,he,ge,ke)}}function noe(c,s,u){const h=c.node;let p=0;const _=u&E1.HasMeshoptCompression;for(const v of h.meshes){if(h.lights&&h.lightMeshIndex===p||!v.featureData)continue;v.featureArray=new s1,v.featureArray.reserve(v.featureData.length);let w=s;for(const A of v.featureData){const R=_?65535&A:A>>16&65535,O=_?A>>16&65535:65535&A,D=(15&O)<8?15&O:0,z=c.evaluatedRMEA[D],V=c.evaluatedColor[D],H=c.emissionHeightBasedParams[D];let K;if(w&&D===2&&h.lights&&(K=new s1,K.resize(10*h.lights.length)),toe(v.featureArray,R,V,z,H,v.aabb.min[2],v.aabb.max[2],K),K&&w){w=!1;const re=h.meshes[h.lightMeshIndex];re.featureArray=K,re.featureArray._trim()}}v.featureArray._trim(),p++}}En(p3,"Tiled3dModelBucket",{omit:["layers"]}),En($9,"Tiled3dModelFeature");const roe=["id","tile","layer","source","sourceLayer","state"];class Dg{constructor(s,u,h,p,_){this.type="Feature",this._vectorTileFeature=s,this._z=u,this._x=h,this._y=p,this.properties=s?s.properties:{},this.id=_}clone(){const s=new Dg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(s.state=Object.assign({},this.state)),this.layer&&(s.layer=Object.assign({},this.layer)),this.source&&(s.source=this.source),this.sourceLayer&&(s.sourceLayer=this.sourceLayer),s}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const u of roe)this[u]!==void 0&&(s[u]=this[u]);return s}}class Ng extends Df{constructor(s,u,h,p){super(),this.id=s,this.type="model",this.models=[],this._loaded=!1,this._options=u,this._modelsInfo=new Map}load(){const s=[];for(const u in this._options.models){const h=this._options.models[u],p=this._modelsInfo.get(u);if(p){const _=p.model;_.position=h.position!=null?new d(h.position[0],h.position[1]):new d(0,0),_.orientation=h.orientation!=null?h.orientation:[0,0,0],p.modelSpec=h,Ng.applyModelSpecification(_,h),_.computeBoundsAndApplyParent(),this.models.push(_)}else{const _=c7(this.map._requestManager.transformRequest(h.uri,H0.Model).url).then(v=>{if(!v)return;const w=E6(v),A=new m7(u,h.uri,h.position,h.orientation,w);Ng.applyModelSpecification(A,h),A.computeBoundsAndApplyParent(),this.models.push(A),this._modelsInfo.set(u,{modelSpec:h,model:A})}).catch(v=>{this.fire(new W0(new Error(`Could not load model ${u} from ${h.uri}: ${v.message}`)))});s.push(_)}}Promise.allSettled(s).then(()=>{this._loaded=!0,this.fire(new Kc("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(u=>{this._loaded=!0,this.fire(new W0(new Error(`Could not load models: ${u.message}`)))})}static applyModelSpecification(s,u){u.nodeOverrides&&Ng.convertNodeOverrides(s,u.nodeOverrides),u.materialOverrides&&Ng.convertMaterialOverrides(s,u.materialOverrides),u.nodeOverrideNames&&(s.nodeOverrideNames=[...u.nodeOverrideNames]),u.materialOverrideNames&&(s.materialOverrideNames=[...u.materialOverrideNames]),u.featureProperties&&(s.featureProperties=u.featureProperties)}static convertNodeOverrides(s,u){if(Array.isArray(u)&&u.every(h=>typeof h=="string")){s.nodeOverrideNames=[];for(const h of u)s.nodeOverrideNames.push(h)}else Object.entries(u).forEach(([h,p])=>{const _={orientation:[0,0,0]};if(p.hasOwnProperty("orientation")){const v=p.orientation;v&&(_.orientation=v)}s.nodeOverrides.set(h,_)})}static convertMaterialOverrides(s,u){if(Array.isArray(u)&&u.every(h=>typeof h=="string")){s.materialOverrideNames=[];for(const h of u)s.materialOverrideNames.push(h)}else Object.entries(u).forEach(([h,p])=>{const _={color:new ts(1,1,1),colorMix:0,emissionStrength:0,opacity:1},v=p["model-color"];v!==void 0&&(_.color.r=v[0],_.color.g=v[1],_.color.b=v[2]);const w=p["model-color-mix-intensity"];w!==void 0&&(_.colorMix=w);const A=p["model-emissive-strength"];A!==void 0&&(_.emissionStrength=A);const R=p["model-opacity"];R!==void 0&&(_.opacity=R),s.materialOverrides.set(h,_)})}onAdd(s){this.map=s,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(s,u){}serialize(){return this._options}setProperty(s,u){return!1}reload(){const s=Tc(this.id,this.scope);this.map.style.clearSource(s),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(s){this.models=[];const u=new Map;for(const h in s){const p=s[h];if(this._modelsInfo.has(h)){const _=this._modelsInfo.get(h);_&&_.modelSpec.uri===p.uri&&u.set(h,_)}}this._modelsInfo=u,this._options.models=s,this._loaded=!1,this.load()}}function Q6(c,s,u,h){const p=1<<c.z;s.lat=W((h/Jt+c.y)/p),s.lng=j((u/Jt+c.x)/p)}function ioe(c,s,u,h){const p=c.getNodesInfo()[s];if(!p||p.hiddenByReplacement||!p.node.meshes)return;let _=Number.MAX_VALUE;const v=p.node,w=u.tile,A=h.calculatePosMatrix(w.tileID.toUnwrapped(),h.worldSize),R=p.evaluatedScale;let O=0;h.elevation&&v.elevation&&(O=v.elevation*h.elevation.exaggeration()),X(A,A,[(v.anchor?v.anchor[0]:0)*(R[0]-1),(v.anchor?v.anchor[1]:0)*(R[1]-1),O]),ie(A,A,R);const D=u.queryGeometry,z=D.isPointQuery()?D.screenBounds:D.screenGeometry,V=function(K){const re=$([],A,K.globalMatrix);$(re,h.expandedFarZProjMatrix,re);for(let ne=0;ne<K.meshes.length;++ne){const ue=K.meshes[ne];if(ne===K.lightMeshIndex)continue;const he=x6(z,h,re,ue.aabb);he!=null&&(_=Math.min(he,_))}if(K.children)for(const ne of K.children)V(ne)};if(V(v),_===Number.MAX_VALUE)return;const H=new d(0,0);return Q6(w.tileID.canonical,H,p.node.anchor[0],p.node.anchor[1]),{intersectionZ:_,position:H,feature:p.feature}}const soe={circle:class extends kl{constructor(c,s,u,h){super(c,{layout:jl||(jl=new xa({"circle-sort-key":new an(Qe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Wt(Qe.layout_circle["circle-elevation-reference"]),visibility:new Wt(Qe.layout_circle.visibility)})),paint:ba||(ba=new xa({"circle-radius":new an(Qe.paint_circle["circle-radius"]),"circle-color":new an(Qe.paint_circle["circle-color"]),"circle-blur":new an(Qe.paint_circle["circle-blur"]),"circle-opacity":new an(Qe.paint_circle["circle-opacity"]),"circle-translate":new Wt(Qe.paint_circle["circle-translate"]),"circle-translate-anchor":new Wt(Qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Wt(Qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Wt(Qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new an(Qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new an(Qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new an(Qe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Wt(Qe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h)}createBucket(c){return new ns(c)}queryRadius(c){const s=c;return ol("circle-radius",this,s)+ol("circle-stroke-width",this,s)+Uo(this.paint.get("circle-translate"))}queryIntersectsFeature(c,s,u,h,p,_,v,w){const A=Yu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,c.pixelToTileUnitsFactor),R=this.paint.get("circle-radius").evaluate(s,u)+this.paint.get("circle-stroke-width").evaluate(s,u);return YN(c,h,_,v,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",A,R)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,s,u){const h=XN(this);return{config:new Hh(this,{zoom:s,lut:u}),defines:h,overrideFog:!1}}is3D(c){return!c&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends kl{createBucket(c){return new QN(c)}constructor(c,s,u,h){super(c,{layout:JN||(JN=new xa({visibility:new Wt(Qe.layout_heatmap.visibility)})),paint:ez||(ez=new xa({"heatmap-radius":new an(Qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new an(Qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Wt(Qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gf(Qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Wt(Qe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ew({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(c){return ol("heatmap-radius",this,c)}queryIntersectsFeature(c,s,u,h,p,_,v,w){const A=this.paint.get("heatmap-radius").evaluate(s,u);return YN(c,h,_,v,w,!0,!0,new je(0,0),A)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,s,u){return c==="heatmap"?{config:new Hh(this,{zoom:s,lut:u}),overrideFog:!1}:{}}},hillshade:class extends kl{constructor(c,s,u,h){super(c,{layout:tz||(tz=new xa({visibility:new Wt(Qe.layout_hillshade.visibility)})),paint:nz||(nz=new xa({"hillshade-illumination-direction":new Wt(Qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Wt(Qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Wt(Qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Wt(Qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Wt(Qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Wt(Qe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Wt(Qe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,s,u){return{overrideFog:!1}}},fill:class extends kl{constructor(c,s,u,h){super(c,{layout:_z||(_z=new xa({"fill-sort-key":new an(Qe.layout_fill["fill-sort-key"]),visibility:new Wt(Qe.layout_fill.visibility),"fill-elevation-reference":new Wt(Qe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new an(Qe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:yz||(yz=new xa({"fill-antialias":new Wt(Qe.paint_fill["fill-antialias"]),"fill-opacity":new an(Qe.paint_fill["fill-opacity"]),"fill-color":new an(Qe.paint_fill["fill-color"]),"fill-outline-color":new an(Qe.paint_fill["fill-outline-color"]),"fill-translate":new Wt(Qe.paint_fill["fill-translate"]),"fill-translate-anchor":new Wt(Qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new an(Qe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Wt(Qe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Wt(Qe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new an(Qe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new an(Qe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new an(Qe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h)}getProgramIds(){const c=this.paint.get("fill-pattern"),s=c&&c.constantOr(1),u=[s?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&u.push(s&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),u}getDefaultProgramParams(c,s,u){return{config:new Hh(this,{zoom:s,lut:u}),overrideFog:!1}}recalculate(c,s){super.recalculate(c,s);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new r6(c)}queryRadius(){return Uo(this.paint.get("fill-translate"))}queryIntersectsFeature(c,s,u,h,p,_){return!c.queryGeometry.isAboveHorizon&&Gi(bu(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,c.pixelToTileUnitsFactor),h)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(c){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const s=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return c!=null?s&&!c:s}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends kl{constructor(c,s,u,h){super(c,{layout:Hz||(Hz=new xa({visibility:new Wt(Qe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Wt(Qe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Gz||(Gz=new xa({"fill-extrusion-opacity":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new an(Qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new an(Qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new an(Qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new an(Qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new an(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new an(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new an(Qe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new an(Qe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Wt(Qe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new BS(c)}queryRadius(){return Uo(this.paint.get("fill-extrusion-translate"))}is3D(c){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,s,u,h,p,_,v,w,A){const R=Yu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,c.pixelToTileUnitsFactor),O=this.paint.get("fill-extrusion-height").evaluate(s,u),D=this.paint.get("fill-extrusion-base").evaluate(s,u),z=[0,0],V=w&&_.elevation,H=_.elevation?_.elevation.exaggeration():1,K=c.tile.getBucket(this);if(V&&K instanceof BS){const ge=K.centroidVertexArray,ke=A+1;ke<ge.length&&(z[0]=ge.geta_centroid_pos0(ke),z[1]=ge.geta_centroid_pos1(ke))}if(z[0]===0&&z[1]===1)return!1;_.projection.name==="globe"&&(h=$z([h],[new je(0,0),new je(Jt,Jt)],c.tileID.canonical).map(ge=>ge.polygon).flat());const re=V?w:null,[ne,ue]=Qz(_,h,D,O,R,v,re,z,H,_.center.lat,c.tileID.canonical),he=c.queryGeometry;return Kz(ne,ue,he.isPointQuery()?he.screenBounds:he.screenGeometry)}},building:class extends kl{constructor(c,s,u,h){super(c,{layout:w7||(w7=new xa({visibility:new Wt(Qe.layout_building.visibility),"building-facade":new an(Qe.layout_building["building-facade"]),"building-facade-floors":new an(Qe.layout_building["building-facade-floors"]),"building-facade-unit-width":new an(Qe.layout_building["building-facade-unit-width"]),"building-facade-window":new an(Qe.layout_building["building-facade-window"]),"building-roof-shape":new an(Qe.layout_building["building-roof-shape"]),"building-height":new an(Qe.layout_building["building-height"]),"building-base":new an(Qe.layout_building["building-base"]),"building-flood-light-wall-radius":new an(Qe.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new an(Qe.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new an(Qe.layout_building["building-flip-roof-orientation"])})),paint:T7||(T7=new xa({"building-opacity":new Wt(Qe.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Wt(Qe.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Wt(Qe.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Wt(Qe.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Wt(Qe.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Wt(Qe.paint_building["building-vertical-scale"]),"building-cast-shadows":new Wt(Qe.paint_building["building-cast-shadows"]),"building-color":new an(Qe.paint_building["building-color"]),"building-emissive-strength":new an(Qe.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Wt(Qe.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Wt(Qe.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Wt(Qe.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Wt(Qe.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Wt(Qe.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new b7(c)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(c){return!0}queryRadius(c){return 0}queryIntersectsFeature(c,s,u,h,p,_,v,w,A){let R=this.layout.get("building-height").evaluate(s,u);const O=this.layout.get("building-base").evaluate(s,u),D=c.tile.getBucket(this).getFootprint(s);if(D){if(D.hiddenFlags!==0)return!1;R=D.height}const[z,V]=Qz(_,h,O,R,new je(0,0),v,null,[0,0],1,_.center.lat,c.tileID.canonical),H=c.queryGeometry;return Kz(z,V,H.isPointQuery()?H.screenBounds:H.screenGeometry)}},line:class extends kl{constructor(c,s,u,h){const p=O7();super(c,p,s,u,h),p.layout&&(this.layout=new Hf(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const s=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=s._styleExpression&&s._styleExpression.expression instanceof ag,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(c,s){super.recalculate(c,s),this.paint._values["line-floorwidth"]=(()=>{if(_w)return _w;const u=O7();return _w=new Jse(u.paint.properties["line-width"].specification),_w.useIntegerZoom=!0,_w})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new C6(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,s,u){const h=M7(this);return{config:new Hh(this,{zoom:s,lut:u}),defines:h,overrideFog:!1}}queryRadius(c){const s=c,u=L7(ol("line-width",this,s),ol("line-gap-width",this,s)),h=ol("line-offset",this,s);return u/2+Math.abs(h)+Uo(this.paint.get("line-translate"))}queryIntersectsFeature(c,s,u,h,p,_){if(c.queryGeometry.isAboveHorizon)return!1;const v=bu(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,c.pixelToTileUnitsFactor),w=c.pixelToTileUnitsFactor/2*L7(this.paint.get("line-width").evaluate(s,u),this.paint.get("line-gap-width").evaluate(s,u)),A=this.paint.get("line-offset").evaluate(s,u);return A&&(h=function(R,O){const D=[],z=new je(0,0);for(let V=0;V<R.length;V++){const H=R[V],K=[];for(let re=0;re<H.length;re++){const ne=H[re],ue=H[re+1],he=re===0?z:ne.sub(H[re-1])._unit()._perp(),ge=re===H.length-1?z:ue.sub(ne)._unit()._perp(),ke=he._add(ge)._unit();ke._mult(1/(ke.x*ge.x+ke.y*ge.y)),K.push(ke._mult(O)._add(ne))}D.push(K)}return D}(h,A*c.pixelToTileUnitsFactor)),function(R,O,D){for(let z=0;z<O.length;z++){const V=O[z];if(R.length>=3){for(let H=0;H<V.length;H++)if(xs(R,V[H]))return!0}if(ga(R,V,D))return!0}return!1}(v,h,w)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(c){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:c3,background:class extends kl{constructor(c,s,u,h){super(c,{layout:w9||(w9=new xa({visibility:new Wt(Qe.layout_background.visibility)})),paint:T9||(T9=new xa({"background-pitch-alignment":new Wt(Qe.paint_background["background-pitch-alignment"]),"background-color":new Wt(Qe.paint_background["background-color"]),"background-pattern":new Wt(Qe.paint_background["background-pattern"]),"background-opacity":new Wt(Qe.paint_background["background-opacity"]),"background-emissive-strength":new Wt(Qe.paint_background["background-emissive-strength"]),"background-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,s,u){return{overrideFog:!1}}is3D(c){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:k9,"raster-particle":L9,sky:class extends kl{constructor(c,s,u,h){super(c,{layout:M9||(M9=new xa({visibility:new Wt(Qe.layout_sky.visibility)})),paint:P9||(P9=new xa({"sky-type":new Wt(Qe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Wt(Qe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Wt(Qe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Wt(Qe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Wt(Qe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Gf(Qe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Wt(Qe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Wt(Qe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Wt(Qe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ew({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const s=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==s.azimuthal||this._lightPosition.polar!==s.polar}return!1}getCenter(c,s){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),p=!h,_=c.style.light,v=_.properties.get("position");return p&&_.properties.get("anchor")==="viewport"&&Qt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?W6(v.azimuthal,90-v.polar,s):W6(h[0],90-h[1],s)}const u=this.paint.get("sky-gradient-center");return W6(u[0],90-u[1],s)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends kl{constructor(c,s,u,h){super(c,{paint:O9||(O9=new xa({}))},s,null)}},model:class extends kl{constructor(c,s,u,h){super(c,{layout:F9||(F9=new xa({visibility:new Wt(Qe.layout_model.visibility),"model-id":new an(Qe.layout_model["model-id"])})),paint:B9||(B9=new xa({"model-opacity":new an(Qe.paint_model["model-opacity"]),"model-rotation":new an(Qe.paint_model["model-rotation"]),"model-scale":new an(Qe.paint_model["model-scale"]),"model-translation":new an(Qe.paint_model["model-translation"]),"model-color":new an(Qe.paint_model["model-color"]),"model-color-mix-intensity":new an(Qe.paint_model["model-color-mix-intensity"]),"model-type":new Wt(Qe.paint_model["model-type"]),"model-cast-shadows":new Wt(Qe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Wt(Qe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Wt(Qe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new an(Qe.paint_model["model-emissive-strength"]),"model-roughness":new an(Qe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new an(Qe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Wt(Qe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Wt(Qe.paint_model["model-front-cutoff"]),"model-elevation-reference":new Wt(Qe.paint_model["model-elevation-reference"]),"model-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},s,u,h),this.layer=c,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new Y6(c)}getProgramIds(){return["model"]}is3D(c){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof p3?Jt-1:0}queryRenderedFeatures(c,s,u){const h=s.getSource();if(!(h&&h instanceof Ng))return{};const p=h,_={};_[this.id]=[];const v=_[this.id];let w=0;for(const A of p.models){const R=s.getFeatureState(this.sourceLayer,A.id),O={type:"Unknown",id:A.id,properties:A.featureProperties},D=this.paint.get("model-rotation").evaluate(O,R),z=this.paint.get("model-scale").evaluate(O,R),V=this.paint.get("model-translation").evaluate(O,R),H=this.paint.get("model-elevation-reference");let K=[];WS(K,A,u,A.position,D,z,V,H==="ground",H==="ground",!1),u.projection.name==="globe"&&(K=ZS(K,u));const re=$([],u.projMatrix,K),ne=x6(c.isPointQuery()?c.screenBounds:c.screenGeometry,u,re,A.aabb);if(ne!=null){const ue=new Dg(void 0,0,0,0,A.id);ue.layer=this.layer,ue.properties=structuredClone(A.featureProperties),ue.properties.layer=this.id,ue.properties.uri=A.uri,ue.properties.orientation=A.orientation,ue.sourceLayer=this.sourceLayer,ue.geometry={type:"Point",coordinates:[A.position.lng,A.position.lat]},ue.state=R,ue.source=this.source,v.push({featureIndex:w,feature:ue,intersectionZ:ne})}++w}return _}queryIntersectsFeature(c,s,u,h,p,_){if(!this.modelManager)return!1;const v=this.modelManager,w=c.tile.getBucket(this);if(!(w&&w instanceof Y6))return!1;for(const A in w.instancesPerModel){const R=w.instancesPerModel[A],O=s.id!==void 0?s.id:s.properties&&s.properties.hasOwnProperty("id")?s.properties.id:void 0;if(R.idToFeaturesIndex.hasOwnProperty(O)){const D=R.features[R.idToFeaturesIndex[O]],z=v.getModel(A,this.scope);if(!z)return!1;let V=[];const H=new d(0,0),K=w.canonical;let re=Number.MAX_VALUE;for(let ne=0;ne<D.instancedDataCount;++ne){const ue=16*(D.instancedDataOffset+ne),he=R.instancedDataArray.float32,ge=[he[ue+4],he[ue+5],he[ue+6]];Q6(K,H,Math.floor(he[ue]),Math.floor(he[ue+1])),WS(V,z,_,H,D.rotation,D.scale,ge,!1,!1,!1),_.projection.name==="globe"&&(V=ZS(V,_));const ke=$([],_.projMatrix,V),Ee=c.queryGeometry,Pe=x6(Ee.isPointQuery()?Ee.screenBounds:Ee.screenGeometry,_,ke,z.aabb);Pe!=null&&(re=Math.min(Pe,re))}return re!==Number.MAX_VALUE&&re}}return!1}_handleOverridablePaintPropertyUpdate(c,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const s=this._transitionablePaint._values[c];return s!=null&&s.value!=null&&s.value.expression!=null&&s.value.expression instanceof Uf}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends kl{constructor(c,s,u,h){super(c,{layout:vz||(vz=new xa({"clip-layer-types":new Wt(Qe.layout_clip["clip-layer-types"]),"clip-layer-scope":new Wt(Qe.layout_clip["clip-layer-scope"])})),paint:xz||(xz=new xa({}))},s,u,h)}recalculate(c,s){super.recalculate(c,s)}createBucket(c){return new bz(c)}is3D(c){return!0}}},J6=new ts(0,0,0),e5={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},t5={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},m3={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},aoe={PAINT_ORDER_FILL_AND_STROKE:1},Ow={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},H9={MASK_TYPE_LUMINANCE:1};function ooe(c,s,u){c===1&&s.icons.push(function(h,p){return function(_){if(_.usvg_tree.height||(_.usvg_tree.height=_.usvg_tree.width),!_.metadata)return _;const{metadata:v}=_;if(v.content_area){const{content_area:w}=v;w.left==null&&(w.left=0),w.top==null&&(w.top=w.left),w.width==null&&(w.width=_.usvg_tree.width),w.height==null&&(w.height=w.width)}if(v.text_placeholder){const{text_placeholder:w}=v;w.top==null&&(w.top=w.left),w.height==null&&(w.height=w.width)}return v.stretch_x&&v.stretch_x.length&&G9(v,"x"),v.stretch_y&&v.stretch_y.length&&G9(v,"y"),_}(h.readFields(loe,{name:void 0},p))}(u,u.readVarint()+u.pos))}function G9(c,s){const u=[],h=c[`stretch_${s}`];let p=null;for(let _=0;_<h.length;_++)p===null?p=u.length===0?h[0]:u[u.length-1][1]+h[_]:(u.push([p,p+h[_]]),p=null);c[`stretch_${s}_areas`]=u}function loe(c,s,u){c===1?s.name=u.readString():c===2?s.metadata=function(h,p){return h.readFields(uoe,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)}(u,u.readVarint()+u.pos):c===3&&(s.usvg_tree=function(h,p){return h.readFields(hoe,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)}(u,u.readVarint()+u.pos),s.data="usvg_tree")}function uoe(c,s,u){c===1?s.stretch_x=u.readPackedVarint():c===2?s.stretch_y=u.readPackedVarint():c===3?s.content_area=q9(u,u.readVarint()+u.pos):c===4?s.variables.push(function(h,p){return h.readFields(doe,{name:void 0},p)}(u,u.readVarint()+u.pos)):c===5&&(s.text_placeholder=q9(u,u.readVarint()+u.pos))}function q9(c,s){return c.readFields(coe,{},s)}function coe(c,s,u){c===1?s.left=u.readVarint():c===2?s.width=u.readVarint():c===3?s.top=u.readVarint():c===4&&(s.height=u.readVarint())}function doe(c,s,u){c===1?s.name=u.readString():c===2&&(s.rgb_color=y3(u.readVarint()),s.value="rgb_color")}function hoe(c,s,u){c===1?s.width=s.height=u.readVarint():c===2?s.height=u.readVarint():c===3?s.children.push(g3(u,u.readVarint()+u.pos)):c===4?s.linear_gradients.push(function(h,p){return h.readFields(voe,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)}(u,u.readVarint()+u.pos)):c===5?s.radial_gradients.push(function(h,p){return h.readFields(boe,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)}(u,u.readVarint()+u.pos)):c===7?s.clip_paths.push(function(h,p){return h.readFields(woe,{children:[]},p)}(u,u.readVarint()+u.pos)):c===8&&s.masks.push(function(h,p){const _=h.readFields(Toe,{left:0,width:20,mask_type:H9.MASK_TYPE_LUMINANCE,children:[]},p);return _.height==null&&(_.height=_.width),_.top==null&&(_.top=_.left),_}(u,u.readVarint()+u.pos))}function g3(c,s){return c.readFields(foe,{},s)}function foe(c,s,u){c===1?(s.group=function(h,p){return h.readFields(poe,{opacity:255,children:[]},p)}(u,u.readVarint()+u.pos),s.node="group"):c===2&&(s.path=function(h,p){return h.readFields(goe,{paint_order:1,commands:[],step:1,diffs:[],rule:e5.PATH_RULE_NON_ZERO},p)}(u,u.readVarint()+u.pos),s.node="path")}function poe(c,s,u){c===1?s.transform=_3(u,u.readVarint()+u.pos):c===2?s.opacity=u.readVarint():c===5?s.clip_path_idx=u.readVarint():c===6?s.mask_idx=u.readVarint():c===7&&s.children.push(g3(u,u.readVarint()+u.pos))}function _3(c,s){return c.readFields(moe,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},s)}function moe(c,s,u){c===1?s.sx=u.readFloat():c===2?s.ky=u.readFloat():c===3?s.kx=u.readFloat():c===4?s.sy=u.readFloat():c===5?s.tx=u.readFloat():c===6&&(s.ty=u.readFloat())}function goe(c,s,u){c===1?s.fill=function(h,p){return h.readFields(_oe,{rgb_color:J6,paint:"rgb_color",opacity:255},p)}(u,u.readVarint()+u.pos):c===2?s.stroke=function(h,p){return h.readFields(yoe,{rgb_color:J6,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)}(u,u.readVarint()+u.pos):c===3?s.paint_order=u.readVarint():c===5?u.readPackedVarint(s.commands):c===6?s.step=u.readFloat():c===7?u.readPackedSVarint(s.diffs):c===8&&(s.rule=u.readVarint())}function _oe(c,s,u){c===1?(s.rgb_color=y3(u.readVarint()),s.paint="rgb_color"):c===2?(s.linear_gradient_idx=u.readVarint(),s.paint="linear_gradient_idx"):c===3?(s.radial_gradient_idx=u.readVarint(),s.paint="radial_gradient_idx"):c===5&&(s.opacity=u.readVarint())}function y3(c){return new ts((c>>16&255)/255,(c>>8&255)/255,(255&c)/255,1)}function yoe(c,s,u){c===1?(s.rgb_color=y3(u.readVarint()),s.paint="rgb_color"):c===2?(s.linear_gradient_idx=u.readVarint(),s.paint="linear_gradient_idx"):c===3?(s.radial_gradient_idx=u.readVarint(),s.paint="radial_gradient_idx"):c===5?u.readPackedFloat(s.dasharray):c===6?s.dashoffset=u.readFloat():c===7?s.miterlimit=u.readFloat():c===8?s.opacity=u.readVarint():c===9?s.width=u.readFloat():c===10?s.linecap=u.readVarint():c===11&&(s.linejoin=u.readVarint())}function voe(c,s,u){c===1?s.transform=_3(u,u.readVarint()+u.pos):c===2?s.spread_method=u.readVarint():c===3?s.stops.push(Z9(u,u.readVarint()+u.pos)):c===4?s.x1=u.readFloat():c===5?s.y1=u.readFloat():c===6?s.x2=u.readFloat():c===7&&(s.y2=u.readFloat())}function Z9(c,s){return c.readFields(xoe,{offset:0,opacity:255,rgb_color:J6},s)}function xoe(c,s,u){c===1?s.offset=u.readFloat():c===2?s.opacity=u.readVarint():c===3&&(s.rgb_color=y3(u.readVarint()))}function boe(c,s,u){c===1?s.transform=_3(u,u.readVarint()+u.pos):c===2?s.spread_method=u.readVarint():c===3?s.stops.push(Z9(u,u.readVarint()+u.pos)):c===4?s.cx=u.readFloat():c===5?s.cy=u.readFloat():c===6?s.r=u.readFloat():c===7?s.fx=u.readFloat():c===8?s.fy=u.readFloat():c===9&&(s.fr=u.readFloat())}function woe(c,s,u){c===1?s.transform=_3(u,u.readVarint()+u.pos):c===2?s.clip_path_idx=u.readVarint():c===3&&s.children.push(g3(u,u.readVarint()+u.pos))}function Toe(c,s,u){c===1?s.left=s.top=u.readFloat():c===2?s.width=s.height=u.readFloat():c===3?s.top=u.readFloat():c===4?s.height=u.readFloat():c===5?s.mask_type=u.readVarint():c===6?s.mask_idx=u.readVarint():c===7&&s.children.push(g3(u,u.readVarint()+u.pos))}class Eoe{static calculate(s={},u=[]){const h=new Map,p=new Map;if(Object.keys(s).length===0)return h;u.forEach(_=>{p.set(_.name,_.rgb_color||new ts(0,0,0))});for(const[_,v]of Object.entries(s))p.has(_)?h.set(p.get(_).toString(),v):console.warn(`Ignoring unknown image variable "${_}"`);return h}}function L1(c,s=255,u){const h=s/255,p=c.toString(),_=u.has(p)?u.get(p).clone():c.clone();return _.a*=h,_.toString()}function Lw(c,s){if(!Wc()){const u=document.createElement("canvas");return u.width=c,u.height=s,u}return new OffscreenCanvas(c,s)}let n5,Dw=null;function r5(c,s,u,h,p){for(const _ of h.children)W9(c,s,u,_,p)}function W9(c,s,u,h,p){h.group?(c.save(),function(_,v,w,A,R){const O=A.mask_idx!=null?w.masks[A.mask_idx]:null,D=A.clip_path_idx!=null?w.clip_paths[A.clip_path_idx]:null;if(A.transform&&(v=D1(A.transform).preMultiplySelf(v)),!function(H,K,re){return H.opacity!==255||K||re}(A,D!=null,O!=null))return void r5(_,v,w,A,R);const z=Lw(_.canvas.width,_.canvas.height),V=z.getContext("2d");r5(V,v,w,A,R),D&&tF(V,v,w,D),O&&nF(V,v,w,O,R),_.globalAlpha=A.opacity/255,_.drawImage(z,0,0)}(c,s,u,h.group,p),c.restore()):h.path&&(c.save(),function(_,v,w,A,R){_.setTransform(v),A.paint_order===aoe.PAINT_ORDER_FILL_AND_STROKE?(X9(_,w,A,R),K9(_,w,A,R)):(K9(_,w,A,R),X9(_,w,A,R))}(c,s,u,h.path,p),c.restore())}function X9(c,s,u,h){const p=u.fill;if(!p)return;const _=p.opacity/255;switch(c.save(),c.beginPath(),rF(u,c),p.paint){case"rgb_color":c.fillStyle=L1(p.rgb_color,p.opacity,h);break;case"linear_gradient_idx":{const v=s.linear_gradients[p.linear_gradient_idx];v.transform&&c.setTransform(D1(v.transform).preMultiplySelf(c.getTransform())),c.fillStyle=Q9(c,v,_,h);break}case"radial_gradient_idx":{const v=s.radial_gradients[p.radial_gradient_idx];v.transform&&c.setTransform(D1(v.transform).preMultiplySelf(c.getTransform())),c.fillStyle=J9(c,v,_,h)}}c.fill(Y9(u)),c.restore()}function Y9(c){return c.rule===e5.PATH_RULE_NON_ZERO?"nonzero":c.rule===e5.PATH_RULE_EVEN_ODD?"evenodd":void 0}function K9(c,s,u,h){const p=u.stroke;if(!p)return;const _=iF(u);c.lineWidth=p.width,c.miterLimit=p.miterlimit,c.setLineDash(p.dasharray),c.lineDashOffset=p.dashoffset;const v=p.opacity/255;switch(p.paint){case"rgb_color":c.strokeStyle=L1(p.rgb_color,p.opacity,h);break;case"linear_gradient_idx":c.strokeStyle=Q9(c,s.linear_gradients[p.linear_gradient_idx],v,h,!0);break;case"radial_gradient_idx":c.strokeStyle=J9(c,s.radial_gradients[p.radial_gradient_idx],v,h,!0)}switch(p.linejoin){case m3.LINE_JOIN_MITER_CLIP:case m3.LINE_JOIN_MITER:c.lineJoin="miter";break;case m3.LINE_JOIN_ROUND:c.lineJoin="round";break;case m3.LINE_JOIN_BEVEL:c.lineJoin="bevel"}switch(p.linecap){case t5.LINE_CAP_BUTT:c.lineCap="butt";break;case t5.LINE_CAP_ROUND:c.lineCap="round";break;case t5.LINE_CAP_SQUARE:c.lineCap="square"}c.stroke(_)}function Q9(c,s,u,h,p=!1){if(s.stops.length===1){const z=s.stops[0];return L1(z.rgb_color,z.opacity*u,h)}const{x1:_,y1:v,x2:w,y2:A}=s;let R=new DOMPoint(_,v),O=new DOMPoint(w,A);if(p){const z=D1(s.transform);R=z.transformPoint(R),O=z.transformPoint(O)}const D=c.createLinearGradient(R.x,R.y,O.x,O.y);for(const z of s.stops)D.addColorStop(z.offset,L1(z.rgb_color,z.opacity*u,h));return D}function J9(c,s,u,h,p=!1){if(s.stops.length===1){const ne=s.stops[0];return L1(ne.rgb_color,ne.opacity*u,h)}const _=D1(s.transform),{fx:v,fy:w,fr:A,cx:R,cy:O,r:D}=s;let z=new DOMPoint(v,w),V=new DOMPoint(R,O),H=A,K=D;if(p){z=_.transformPoint(z),V=_.transformPoint(V);const ne=(_.a+_.d)/2;H=A*ne,K=s.r*ne}const re=c.createRadialGradient(z.x,z.y,H,V.x,V.y,K);for(const ne of s.stops)re.addColorStop(ne.offset,L1(ne.rgb_color,ne.opacity*u,h));return re}function eF(c,s,u,h){const p=h.transform?D1(h.transform).preMultiplySelf(s):s,_=Lw(c.canvas.width,c.canvas.height),v=_.getContext("2d");for(const A of h.children)if(A.group)eF(v,p,u,A.group);else if(A.path){const R=A.path,O=new Path2D;O.addPath(iF(R),p),v.fill(O,Y9(R))}const w=h.clip_path_idx!=null?u.clip_paths[h.clip_path_idx]:null;w&&tF(v,p,u,w),c.globalCompositeOperation="source-over",c.drawImage(_,0,0)}function tF(c,s,u,h){const p=Lw(c.canvas.width,c.canvas.height);eF(p.getContext("2d"),s,u,h),c.globalCompositeOperation="destination-in",c.drawImage(p,0,0)}function nF(c,s,u,h,p){if(h.children.length===0)return;const _=h.mask_idx!=null?u.masks[h.mask_idx]:null;_&&nF(c,s,u,_,p);const v=c.canvas.width,w=c.canvas.height,A=Lw(v,w),R=A.getContext("2d"),O=h.width,D=h.height,z=h.left,V=h.top,H=new Path2D,K=new Path2D;K.rect(z,V,O,D),H.addPath(K,s),R.clip(H);for(const ue of h.children)W9(R,s,u,ue,p);const re=R.getImageData(0,0,v,w),ne=re.data;if(h.mask_type===H9.MASK_TYPE_LUMINANCE)for(let ue=0;ue<ne.length;ue+=4)ne[ue+3]=ne[ue+3]/255*(.2126*ne[ue]+.7152*ne[ue+1]+.0722*ne[ue+2]);R.putImageData(re,0,0),c.globalCompositeOperation="destination-in",c.drawImage(A,0,0)}function D1(c){return c?new DOMMatrix([c.sx,c.ky,c.kx,c.sy,c.tx,c.ty]):new DOMMatrix}function rF(c,s){const u=c.step;let h=c.diffs[0]*u,p=c.diffs[1]*u;s.moveTo(h,p);for(let _=0,v=2;_<c.commands.length;_++)switch(c.commands[_]){case Ow.PATH_COMMAND_MOVE:h+=c.diffs[v++]*u,p+=c.diffs[v++]*u,s.moveTo(h,p);break;case Ow.PATH_COMMAND_LINE:h+=c.diffs[v++]*u,p+=c.diffs[v++]*u,s.lineTo(h,p);break;case Ow.PATH_COMMAND_QUAD:{const w=h+c.diffs[v++]*u,A=p+c.diffs[v++]*u;h=w+c.diffs[v++]*u,p=A+c.diffs[v++]*u,s.quadraticCurveTo(w,A,h,p);break}case Ow.PATH_COMMAND_CUBIC:{const w=h+c.diffs[v++]*u,A=p+c.diffs[v++]*u,R=w+c.diffs[v++]*u,O=A+c.diffs[v++]*u;h=R+c.diffs[v++]*u,p=O+c.diffs[v++]*u,s.bezierCurveTo(w,A,R,O,h,p);break}case Ow.PATH_COMMAND_CLOSE:s.closePath()}return s}function iF(c){return rF(c,new Path2D)}class v3{constructor(s){this.capacity=s,this.cache=new Map}get(s){if(!this.cache.has(s))return;const u=this.cache.get(s);return this.cache.delete(s),this.cache.set(s,u),u}put(s,u){this.cache.has(s)?this.cache.delete(s):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(s,u)}delete(s){this.cache.delete(s)}}En(v3,"LRUCache");class i5{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(s){return new ll(s,s.data)}getFromCache(s,u,h){return this.cacheMap.has(h)||this.cacheMap.set(h,new v3(150)),this.cacheMap.get(h).get(Tc(s.toString(),u))}setInCache(s,u,h,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new v3(150));const _=this.cacheDependenciesMap.get(p),v=Tc(s.id.toString(),h);_.get(v)||_.set(v,new Set);const w=this.cacheMap.get(p),A=s.toString();_.get(v).add(A),w.put(Tc(s.toString(),h),u)}removeImagesFromCacheByIds(s,u,h=0){if(!this.cacheMap.has(h)||!this.cacheDependenciesMap.has(h))return;const p=this.cacheMap.get(h),_=this.cacheDependenciesMap.get(h);for(const v of s){const w=Tc(v.toString(),u);if(_.has(w)){for(const A of _.get(w))p.delete(A);_.delete(w)}}}rasterize(s,u,h,p){const _=this.getFromCache(s,h,p);if(_)return _.clone();const v=function(A,R){const O=Eoe.calculate(R.params,A.metadata?A.metadata.variables:[]),D=A.usvg_tree,z=D.width,V=D.height,H=Math.max(1,Math.round(z*R.sx)),K=Math.max(1,Math.round(V*R.sy)),re=new DOMMatrix([H/z,0,0,K/V,0,0]);return Dw===null&&(Dw=Lw(10,10),n5=Dw.getContext("2d",{willReadFrequently:!0})),Dw.width=H,Dw.height=K,r5(n5,re,D,D,O),n5.getImageData(0,0,H,K)}(u.icon,s),w=i5._getImage(v);return this.setInCache(s,w,h,p),w.clone()}}class sF{constructor(s){this.size=s,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(s,u){const h=this.toIdx(s,u);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(s,u){return this.leaves[this.toIdx(s,u)]}toIdx(s,u){return u*this.size+s}}function aF(c,s,u,h){let p=0,_=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(h[v])<1e-15){if(u[v]<c[v]||u[v]>s[v])return null}else{const w=1/h[v];let A=(c[v]-u[v])*w,R=(s[v]-u[v])*w;if(A>R){const O=A;A=R,R=O}if(A>p&&(p=A),R<_&&(_=R),p>_)return null}return p}function oF(c,s,u,h,p,_,v,w,A,R,O){const D=h-c,z=p-s,V=_-u,H=v-c,K=w-s,re=A-u,ne=O[1]*re-O[2]*K,ue=O[2]*H-O[0]*re,he=O[0]*K-O[1]*H,ge=D*ne+z*ue+V*he;if(Math.abs(ge)<1e-15)return null;const ke=1/ge,Ee=R[0]-c,Pe=R[1]-s,Be=R[2]-u,$e=(Ee*ne+Pe*ue+Be*he)*ke;if($e<0||$e>1)return null;const mt=Pe*V-Be*z,Xe=Be*D-Ee*V,vt=Ee*z-Pe*D,kt=(O[0]*mt+O[1]*Xe+O[2]*vt)*ke;return kt<0||$e+kt>1?null:(H*mt+K*Xe+re*vt)*ke}function lF(c,s,u){return(c-s)/(u-s)}function uF(c,s,u,h,p,_,v,w,A){const R=1<<u,O=_-h,D=v-p,z=(c+1)/R*O+h,V=(s+0)/R*D+p,H=(s+1)/R*D+p;w[0]=(c+0)/R*O+h,w[1]=V,A[0]=z,A[1]=H}class cF{constructor(s){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=s,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const u=function(_){const v=Math.ceil(Math.log2(_.dim/8)),w=[];let A=Math.ceil(Math.pow(2,v));const R=1/A,O=(V,H,K,re,ne)=>{const ue=re?1:0,he=(V+1)*K-ue,ge=H*K,ke=(H+1)*K-ue;ne[0]=V*K,ne[1]=ge,ne[2]=he,ne[3]=ke};let D=new sF(A);const z=[];for(let V=0;V<A*A;V++){O(V%A,Math.floor(V/A),R,!1,z);const H=xm(z[0],z[1],_),K=xm(z[2],z[1],_),re=xm(z[2],z[3],_),ne=xm(z[0],z[3],_);D.minimums.push(Math.min(H,K,re,ne)),D.maximums.push(Math.max(H,K,re,ne)),D.leaves.push(1)}for(w.push(D),A/=2;A>=1;A/=2){const V=w[w.length-1];D=new sF(A);for(let H=0;H<A*A;H++){O(H%A,Math.floor(H/A),2,!0,z);const K=V.getElevation(z[0],z[1]),re=V.getElevation(z[2],z[1]),ne=V.getElevation(z[2],z[3]),ue=V.getElevation(z[0],z[3]),he=V.isLeaf(z[0],z[1]),ge=V.isLeaf(z[2],z[1]),ke=V.isLeaf(z[2],z[3]),Ee=V.isLeaf(z[0],z[3]),Pe=Math.min(K.min,re.min,ne.min,ue.min),Be=Math.max(K.max,re.max,ne.max,ue.max),$e=he&&ge&&ke&&Ee;D.maximums.push(Be),D.minimums.push(Pe),D.leaves.push(Be-Pe<=5&&$e?1:0)}w.push(D)}return w}(this.dem),h=u.length-1,p=u[h];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(u,0,0,h,0)}raycastRoot(s,u,h,p,_,v,w=1){return aF([s,u,-100],[h,p,this.maximums[0]*w],_,v)}raycast(s,u,h,p,_,v,w=1){if(!this.nodeCount)return null;const A=this.raycastRoot(s,u,h,p,_,v,w);if(A==null)return null;const R=[],O=[],D=[],z=[],V=[{idx:0,t:A,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:H,t:K,nodex:re,nodey:ne,depth:ue}=V.pop();if(this.leaves[H]){uF(re,ne,ue,s,u,h,p,D,z);const ge=1<<ue,ke=(re+0)/ge,Ee=(re+1)/ge,Pe=(ne+0)/ge,Be=(ne+1)/ge,$e=xm(ke,Pe,this.dem)*w,mt=xm(Ee,Pe,this.dem)*w,Xe=xm(Ee,Be,this.dem)*w,vt=xm(ke,Be,this.dem)*w,kt=oF(D[0],D[1],$e,z[0],D[1],mt,z[0],z[1],Xe,_,v),It=oF(z[0],z[1],Xe,D[0],z[1],vt,D[0],D[1],$e,_,v),zt=Math.min(kt!==null?kt:Number.MAX_VALUE,It!==null?It:Number.MAX_VALUE);if(zt!==Number.MAX_VALUE)return zt;{const Bt=jt([],_,v,K);if(dF($e,mt,vt,Xe,lF(Bt[0],D[0],z[0]),lF(Bt[1],D[1],z[1]))>=Bt[2])return K}continue}let he=0;for(let ge=0;ge<this._siblingOffset.length;ge++){uF((re<<1)+this._siblingOffset[ge][0],(ne<<1)+this._siblingOffset[ge][1],ue+1,s,u,h,p,D,z),D[2]=-100,z[2]=this.maximums[this.childOffsets[H]+ge]*w;const ke=aF(D,z,_,v);if(ke!=null){const Ee=ke;R[ge]=Ee;let Pe=!1;for(let Be=0;Be<he&&!Pe;Be++)Ee>=R[O[Be]]&&(O.splice(Be,0,ge),Pe=!0);Pe||(O[he]=ge),he++}}for(let ge=0;ge<he;ge++){const ke=O[ge];V.push({idx:this.childOffsets[H]+ke,t:R[ke],nodex:(re<<1)+this._siblingOffset[ke][0],nodey:(ne<<1)+this._siblingOffset[ke][1],depth:ue+1})}}return null}_addNode(s,u,h){return this.minimums.push(s),this.maximums.push(u),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(s,u,h,p,_){if(s[p].isLeaf(u,h)===1)return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const v=p-1,w=s[v];let A=0,R=0;for(let O=0;O<this._siblingOffset.length;O++){const D=2*u+this._siblingOffset[O][0],z=2*h+this._siblingOffset[O][1],V=w.getElevation(D,z),H=w.isLeaf(D,z),K=this._addNode(V.min,V.max,H);H&&(A|=1<<O),R||(R=K)}for(let O=0;O<this._siblingOffset.length;O++)A&1<<O||this._construct(s,2*u+this._siblingOffset[O][0],2*h+this._siblingOffset[O][1],v,R+O)}}function dF(c,s,u,h,p,_){return Tr(Tr(c,u,_),Tr(s,h,_),p)}function xm(c,s,u){const h=u.dim,p=ee(c*h-.5,0,h-1),_=ee(s*h-.5,0,h-1),v=Math.floor(p),w=Math.floor(_),A=Math.min(v+1,h-1),R=Math.min(w+1,h-1);return dF(u.get(v,w),u.get(A,w),u.get(v,R),u.get(A,R),p-v,_-w)}const Soe={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Aoe(c,s,u){return(256*c*256+256*s+u)/10-1e4}function Coe(c,s,u){return 256*c+s+u/256-32768}class x3{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(s,u,h,p=!1){if(this.uid=s,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return void Qt(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const _=this.dim=u.height-2,v=new Uint32Array(u.data.buffer);if(this.pixels=new Uint8Array(u.data.buffer),this.floatView=new Float32Array(u.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let A=0;A<_;A++)v[this._idx(-1,A)]=v[this._idx(0,A)],v[this._idx(_,A)]=v[this._idx(_-1,A)],v[this._idx(A,-1)]=v[this._idx(A,0)],v[this._idx(A,_)]=v[this._idx(A,_-1)];v[this._idx(-1,-1)]=v[this._idx(0,0)],v[this._idx(_,-1)]=v[this._idx(_-1,0)],v[this._idx(-1,_)]=v[this._idx(0,_-1)],v[this._idx(_,_)]=v[this._idx(_-1,_-1)]}const w=h==="terrarium"?Coe:Aoe;for(let A=0;A<v.length;++A){const R=4*A;this.floatView[A]=w(this.pixels[R],this.pixels[R+1],this.pixels[R+2])}this._timestamp=To.now()}_buildQuadTree(){this._tree=new cF(this)}get(s,u,h=!1){h&&(s=ee(s,-1,this.dim),u=ee(u,-1,this.dim));const p=this._idx(s,u);return this.floatView[p]}set(s,u,h){const p=this._idx(s,u),_=this.floatView[p];return this.floatView[p]=h,h-_}static getUnpackVector(s){return Soe[s]}_idx(s,u){if(s<-1||s>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(s+1)}static pack(s,u){const h=[0,0,0,0],p=x3.getUnpackVector(u);let _=Math.floor((s+p[3])/p[2]);return h[2]=_%256,_=Math.floor(_/256),h[1]=_%256,_=Math.floor(_/256),h[0]=_,h}getPixels(){return new sz({width:this.stride,height:this.stride},this.pixels)}backfillBorder(s,u,h){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let p=u*this.dim,_=u*this.dim+this.dim,v=h*this.dim,w=h*this.dim+this.dim;switch(u){case-1:p=_-1;break;case 1:_=p+1}switch(h){case-1:v=w-1;break;case 1:w=v+1}const A=-u*this.dim,R=-h*this.dim;for(let O=v;O<w;O++)for(let D=p;D<_;D++){const z=4*this._idx(D,O),V=4*this._idx(D+A,O+R);this.pixels[z+0]=s.pixels[V+0],this.pixels[z+1]=s.pixels[V+1],this.pixels[z+2]=s.pixels[V+2],this.pixels[z+3]=s.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function koe(c,s,u){c===1?s.headerLength=u.readFixed32():c===2?s.x=u.readVarint():c===3?s.y=u.readVarint():c===4?s.z=u.readVarint():c===5&&s.layers.push(function(h,p){return h.readFields(Ooe,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(u,u.readVarint()+u.pos))}function Ioe(c,s,u){c===1?(s.delta_filter=function(h,p){return h.readFields(Roe,{blockSize:0},p)}(u,u.readVarint()+u.pos),s.filter="delta_filter"):c===2?(u.readVarint(),s.filter="zigzag_filter"):c===3?(u.readVarint(),s.filter="bitshuffle_filter"):c===4&&(u.readVarint(),s.filter="byteshuffle_filter")}function Roe(c,s,u){c===1&&(s.blockSize=u.readVarint())}function Moe(c,s,u){c===1?(u.readVarint(),s.codec="gzip_data"):c===2?(u.readVarint(),s.codec="jpeg_image"):c===3?(u.readVarint(),s.codec="webp_image"):c===4&&(u.readVarint(),s.codec="png_image")}function Poe(c,s,u){let h=0,p=0;c===1?s.firstByte=u.readFixed64():c===2?s.lastByte=u.readFixed64():c===3?s.filters.push(function(_,v){return _.readFields(Ioe,{},v)}(u,u.readVarint()+u.pos)):c===4?s.codec=function(_,v){return _.readFields(Moe,{},v)}(u,u.readVarint()+u.pos):c===5?p=u.readFloat():c===6?h=u.readFloat():c===7?s.bands.push(u.readString()):c===8?s.offset=u.readDouble():c===9&&(s.scale=u.readDouble()),s.offset===0&&(s.offset=p),s.scale===0&&(s.scale=h)}function Ooe(c,s,u){c===1?s.version=u.readVarint():c===2?s.name=u.readString():c===3?s.units=u.readString():c===4?s.tileSize=u.readVarint():c===5?s.buffer=u.readVarint():c===6?s.pixelFormat=u.readVarint():c===7&&s.dataIndex.push(function(h,p){return h.readFields(Poe,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(u,u.readVarint()+u.pos))}function Loe(c,s,u){if(c===2)(function(h,p,_){h.readFields(Doe,_,p)})(u,u.readVarint()+u.pos,s);else if(c===3)throw new Error("Not implemented")}function Doe(c,s,u){if(c===1){let h=0;const p=u.readVarint()+u.pos;for(;u.pos<p;)s[h++]=u.readVarint()}}function Noe(c,s){if(s.length!==4)throw new Error(`Expected data of dimension 4 but got ${s.length}.`);let u=s[3];for(let h=2;h>=1;h--){const p=h===1?1:0,_=h===2?1:0;for(let v=0;v<s[0];v++){const w=s[1]*v;for(let A=p;A<s[1];A++){const R=s[2]*(A+w);for(let O=_;O<s[2];O++){const D=s[3]*(O+R);for(let z=0;z<s[3];z++){const V=D+z;c[V]+=c[V-u]}}}}u*=s[h]}return c}function zoe(c){for(let s=0,u=c.length;s<u;s++)c[s]=c[s]>>>1^-(1&c[s]);return c}function Foe(c,s){switch(s){case"uint32":return c;case"uint16":for(let u=0;u<c.length;u+=2){const h=c[u],p=c[u+1];c[u]=(240&h)>>4|(61440&h)>>8|(240&p)<<4|61440&p,c[u+1]=15&h|(3840&h)>>4|(15&p)<<8|(3840&p)<<4}return c;case"uint8":for(let u=0;u<c.length;u+=4){const h=c[u],p=c[u+1],_=c[u+2],v=c[u+3];c[u+0]=(192&h)>>6|(192&p)>>4|(192&_)>>2|192&v,c[u+1]=(48&h)>>4|(48&p)>>2|48&_|(48&v)<<2,c[u+2]=(12&h)>>2|12&p|(12&_)<<2|(12&v)<<4,c[u+3]=3&h|(3&p)<<2|(3&_)<<4|(3&v)<<6}return c;default:throw new Error(`Invalid pixel format, "${s}"`)}}En(x3,"DEMData"),En(cF,"DemMinMaxQuadTree",{omit:["dem"]});var Cc=Uint8Array,Nw=Uint16Array,Boe=Int32Array,hF=new Cc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fF=new Cc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),joe=new Cc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pF=function(c,s){for(var u=new Nw(31),h=0;h<31;++h)u[h]=s+=1<<c[h-1];var p=new Boe(u[30]);for(h=1;h<30;++h)for(var _=u[h];_<u[h+1];++_)p[_]=_-u[h]<<5|h;return{b:u,r:p}},mF=pF(hF,2),gF=mF.b,Uoe=mF.r;gF[28]=258,Uoe[258]=28;for(var Voe=pF(fF,0).b,_F=new Nw(32768),go=0;go<32768;++go){var N1=(43690&go)>>1|(21845&go)<<1;_F[go]=((65280&(N1=(61680&(N1=(52428&N1)>>2|(13107&N1)<<2))>>4|(3855&N1)<<4))>>8|(255&N1)<<8)>>1}var zw=function(c,s,u){for(var h=c.length,p=0,_=new Nw(s);p<h;++p)c[p]&&++_[c[p]-1];var v,w=new Nw(s);for(p=1;p<s;++p)w[p]=w[p-1]+_[p-1]<<1;v=new Nw(1<<s);var A=15-s;for(p=0;p<h;++p)if(c[p])for(var R=p<<4|c[p],O=s-c[p],D=w[c[p]-1]++<<O,z=D|(1<<O)-1;D<=z;++D)v[_F[D]>>A]=R;return v},Fw=new Cc(288);for(go=0;go<144;++go)Fw[go]=8;for(go=144;go<256;++go)Fw[go]=9;for(go=256;go<280;++go)Fw[go]=7;for(go=280;go<288;++go)Fw[go]=8;var yF=new Cc(32);for(go=0;go<32;++go)yF[go]=5;var $oe=zw(Fw,9),Hoe=zw(yF,5),s5=function(c){for(var s=c[0],u=1;u<c.length;++u)c[u]>s&&(s=c[u]);return s},Yd=function(c,s,u){var h=s/8|0;return(c[h]|c[h+1]<<8)>>(7&s)&u},a5=function(c,s){var u=s/8|0;return(c[u]|c[u+1]<<8|c[u+2]<<16)>>(7&s)},Goe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Kd=function(c,s,u){var h=new Error(s||Goe[c]);if(h.code=c,Error.captureStackTrace&&Error.captureStackTrace(h,Kd),!u)throw h;return h},qoe=new Cc(0),Zoe=typeof TextDecoder<"u"&&new TextDecoder;try{Zoe.decode(qoe,{stream:!0})}catch{}const Woe={gzip_data:"gzip"};class ld extends Error{constructor(s){super(s),this.name="MRTError"}}const Xoe={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},vF={uint32:1,uint16:2,uint8:4},Yoe={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let o5;class b3{constructor(s=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=s}getLayer(s){const u=this.layers[s];if(!u)throw new ld(`Layer '${s}' not found`);return u}getHeaderLength(s){const u=new Uint8Array(s),h=new DataView(s);if(u[0]!==13)throw new ld("File is not a valid MRT.");return h.getUint32(1,!0)}parseHeader(s){const u=new Uint8Array(s),h=this.getHeaderLength(s);if(u.length<h)throw new ld(`Expected header with length >= ${h} but got buffer of length ${u.length}`);const p=new o5(u.subarray(0,h)).readFields(koe,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new ld(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const _ of p.layers)this.layers[_.name]=new xF(_,{cacheSize:this._cacheSize});return this}createDecodingTask(s){const u=[],h=this.getLayer(s.layerName);for(let p of s.blockIndices){const _=h.dataIndex[p],v=_.firstByte-s.firstByte,w=_.lastByte-s.firstByte;if(h._blocksInProgress.has(p))continue;const A={layerName:h.name,firstByte:v,lastByte:w,pixelFormat:h.pixelFormat,blockIndex:p,blockShape:[_.bands.length].concat(h.bandShape),buffer:h.buffer,codec:_.codec.codec,filters:_.filters.map(R=>R.filter)};h._blocksInProgress.add(p),u.push(A)}return new bF(u,()=>{u.forEach(p=>h._blocksInProgress.delete(p.blockIndex))},(p,_)=>{if(u.forEach(v=>h._blocksInProgress.delete(v.blockIndex)),p)throw p;_.forEach(v=>{this.getLayer(v.layerName).processDecodedData(v)})})}}class xF{constructor({version:s,name:u,units:h,tileSize:p,pixelFormat:_,buffer:v,dataIndex:w},A){if(this.version=s,this.version!==1)throw new ld(`Cannot parse raster layer encoded with MRT version ${s}`);this.name=u,this.units=h,this.tileSize=p,this.buffer=v,this.pixelFormat=Xoe[_],this.dataIndex=w,this.bandShape=[p+2*v,p+2*v,vF[this.pixelFormat]],this._decodedBlocks=new v3(A?A.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return vF[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:s})=>s).flat()}processDecodedData(s){const u=s.blockIndex.toString();this._decodedBlocks.get(u)||this._decodedBlocks.put(u,s.data)}getBlockForBand(s){let u=0;switch(typeof s){case"string":for(const[h,p]of this.dataIndex.entries()){for(const[_,v]of p.bands.entries())if(v===s)return{bandIndex:u+_,blockIndex:h,blockBandIndex:_};u+=p.bands.length}break;case"number":for(const[h,p]of this.dataIndex.entries()){if(s>=u&&s<u+p.bands.length)return{bandIndex:s,blockIndex:h,blockBandIndex:s-u};u+=p.bands.length}break;default:throw new ld(`Invalid band \`${JSON.stringify(s)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(s){let u=1/0,h=-1/0;const p=[],_=new Set;for(const v of s){const{blockIndex:w}=this.getBlockForBand(v);if(w<0)throw new ld(`Invalid band: ${JSON.stringify(v)}`);const A=this.dataIndex[w];p.includes(w)||p.push(w),_.add(w),u=Math.min(u,A.firstByte),h=Math.max(h,A.lastByte)}if(_.size>this.cacheSize)throw new ld(`Number of blocks to decode (${_.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:u,lastByte:h,blockIndices:p}}hasBand(s){const{blockIndex:u}=this.getBlockForBand(s);return u>=0}hasDataForBand(s){const{blockIndex:u}=this.getBlockForBand(s);return u>=0&&!!this._decodedBlocks.get(u.toString())}getBandView(s){const{blockIndex:u,blockBandIndex:h}=this.getBlockForBand(s);if(u<0)throw new ld(`Band not found: ${JSON.stringify(s)}`);const p=this._decodedBlocks.get(u.toString());if(!p)throw new ld(`Data for band ${JSON.stringify(s)} of layer "${this.name}" not decoded.`);const _=this.dataIndex[u],v=this.bandShape.reduce((R,O)=>R*O,1),w=h*v,A=p.subarray(w,w+v);return{data:A,bytes:new Uint8Array(A.buffer).subarray(A.byteOffset,A.byteOffset+A.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:_.offset,scale:_.scale}}}b3.setPbf=function(c){o5=c};class bF{constructor(s,u,h){this.tasks=s,this._onCancel=u,this._onComplete=h,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(s,u){this._finalized||(this._onComplete(s,u),this._finalized=!0)}}b3.performDecoding=function(c,s){const u=new Uint8Array(c);return Promise.all(s.tasks.map(h=>{const{layerName:p,firstByte:_,lastByte:v,pixelFormat:w,blockShape:A,blockIndex:R,filters:O,codec:D}=h,z=u.subarray(_,v+1),V=new Uint32Array(A[0]*A[1]*A[2]);let H;if(D!=="gzip_data")throw new ld(`Unhandled codec: ${D}`);return H=function(K,re){if(!globalThis.DecompressionStream&&re==="gzip_data")return Promise.resolve(((ge=function(Pe){Pe[0]==31&&Pe[1]==139&&Pe[2]==8||Kd(6,"invalid gzip data");var Be=Pe[3],$e=10;4&Be&&($e+=2+(Pe[10]|Pe[11]<<8));for(var mt=(Be>>3&1)+(Be>>4&1);mt>0;mt-=!Pe[$e++]);return $e+(2&Be)}(he=K))+8>he.length&&Kd(6,"invalid gzip data"),function(Pe,Be,$e,mt){var Xe=Pe.length;if(!Xe||Be.f&&!Be.l)return $e||new Cc(0);var vt=!$e,kt=vt||Be.i!=2,It=Be.i;vt&&($e=new Cc(3*Xe));var zt,Bt,Ot=function(fs){var ji=$e.length;if(fs>ji){var Yi=new Cc(Math.max(2*ji,fs));Yi.set($e),$e=Yi}},Lt=Be.f||0,yt=Be.p||0,gt=Be.b||0,Dt=Be.l,tn=Be.d,$t=Be.m,Bn=Be.n,pn=8*Xe;do{if(!Dt){Lt=Yd(Pe,yt,1);var xn=Yd(Pe,yt+1,3);if(yt+=3,!xn){var Rn=Pe[(bt=4+((yt+7)/8|0))-4]|Pe[bt-3]<<8,Jr=bt+Rn;if(Jr>Xe){It&&Kd(0);break}kt&&Ot(gt+Rn),$e.set(Pe.subarray(bt,Jr),gt),Be.b=gt+=Rn,Be.p=yt=8*Jr,Be.f=Lt;continue}if(xn==1)Dt=$oe,tn=Hoe,$t=9,Bn=5;else if(xn==2){var Zt=Yd(Pe,yt,31)+257,Pn=Yd(Pe,yt+10,15)+4,Or=Zt+Yd(Pe,yt+5,31)+1;yt+=14;for(var gi=new Cc(Or),Ei=new Cc(19),jr=0;jr<Pn;++jr)Ei[joe[jr]]=Yd(Pe,yt+3*jr,7);yt+=3*Pn;var hs=s5(Ei),Se=(1<<hs)-1,Ie=zw(Ei,hs);for(jr=0;jr<Or;){var bt,Ft=Ie[Yd(Pe,yt,Se)];if(yt+=15&Ft,(bt=Ft>>4)<16)gi[jr++]=bt;else{var ln=0,un=0;for(bt==16?(un=3+Yd(Pe,yt,3),yt+=2,ln=gi[jr-1]):bt==17?(un=3+Yd(Pe,yt,7),yt+=3):bt==18&&(un=11+Yd(Pe,yt,127),yt+=7);un--;)gi[jr++]=ln}}var Un=gi.subarray(0,Zt),Yn=gi.subarray(Zt);$t=s5(Un),Bn=s5(Yn),Dt=zw(Un,$t),tn=zw(Yn,Bn)}else Kd(1);if(yt>pn){It&&Kd(0);break}}kt&&Ot(gt+131072);for(var zr=(1<<$t)-1,qr=(1<<Bn)-1,Yr=yt;;Yr=yt){var fi=(ln=Dt[a5(Pe,yt)&zr])>>4;if((yt+=15&ln)>pn){It&&Kd(0);break}if(ln||Kd(2),fi<256)$e[gt++]=fi;else{if(fi==256){Yr=yt,Dt=null;break}var _r=fi-254;fi>264&&(_r=Yd(Pe,yt,(1<<(zi=hF[jr=fi-257]))-1)+gF[jr],yt+=zi);var Pr=tn[a5(Pe,yt)&qr],Pi=Pr>>4;if(Pr||Kd(3),yt+=15&Pr,Yn=Voe[Pi],Pi>3){var zi=fF[Pi];Yn+=a5(Pe,yt)&(1<<zi)-1,yt+=zi}if(yt>pn){It&&Kd(0);break}kt&&Ot(gt+131072);var Fi=gt+_r;if(gt<Yn){var rs=0-Yn,ws=Math.min(Yn,Fi);for(rs+gt<0&&Kd(3);gt<ws;++gt)$e[gt]=(void 0)[rs+gt]}for(;gt<Fi;++gt)$e[gt]=$e[gt-Yn]}}Be.l=Dt,Be.p=Yr,Be.b=gt,Be.f=Lt,Dt&&(Lt=1,Be.m=$t,Be.d=tn,Be.n=Bn)}while(!Lt);return gt!=$e.length&&vt?(zt=$e,((Bt=gt)==null||Bt>zt.length)&&(Bt=zt.length),new Cc(zt.subarray(0,Bt))):$e.subarray(0,gt)}(he.subarray(ge,-8),{i:2},new Cc(((ne=he)[(ue=ne.length)-4]|ne[ue-3]<<8|ne[ue-2]<<16|ne[ue-1]<<24)>>>0))));var ne,ue,he,ge;const ke=Woe[re];if(!ke)throw new Error(`Unhandled codec: ${re}`);const Ee=new globalThis.DecompressionStream(ke);return new Response(new Blob([K]).stream().pipeThrough(Ee)).arrayBuffer().then(Pe=>new Uint8Array(Pe))}(z,D).then(K=>(function(re,ne){re.readFields(Loe,ne)}(new o5(K),V),new Yoe[w](V.buffer))),H.then(K=>{for(let re=O.length-1;re>=0;re--)switch(O[re]){case"delta_filter":Noe(K,A);break;case"zigzag_filter":zoe(K);break;case"bitshuffle_filter":Foe(K,w);break;default:throw new ld(`Unhandled filter "${O[re]}"`)}return{layerName:p,blockIndex:R,data:K}}).catch(K=>{throw K})}))},En(bF,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),En(b3,"MapboxRasterTile"),En(xF,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class wF{constructor(s){this._stringToNumber={},this._numberToString=[];for(let u=0;u<s.length;u++){const h=s[u];this._stringToNumber[h]=u,this._numberToString[u]=h}}encode(s){return this._stringToNumber[s]}decode(s){return this._numberToString[s]}}class TF{constructor(s,u){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new im(Jt,16,0),this.featureIndexArray=new Zb,this.promoteId=u,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(s,u,h,p,_,v=0,w=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,_,v);const R=this.grid;for(let O=0;O<u.length;O++){const D=u[O],z=[1/0,1/0,-1/0,-1/0];for(let V=0;V<D.length;V++){const H=D[V];z[0]=Math.min(z[0],H.x),z[1]=Math.min(z[1],H.y),z[2]=Math.max(z[2],H.x),z[3]=Math.max(z[3],H.y)}w!==0&&(z[0]-=w,z[1]-=w,z[2]+=w,z[3]+=w),z[0]<Jt&&z[1]<Jt&&z[2]>=0&&z[3]>=0&&R.insert(A,z[0],z[1],z[2],z[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new it(new KS(this.rawTileData)).layers,this.sourceLayerCoder=new wF(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const s in this.vtLayers)this.vtFeatures[s]=[]}return this.vtLayers}query(s,u){const{tilespaceGeometry:h,transform:p,tileTransform:_,pixelPosMatrix:v,availableImages:w,worldview:A}=u;this.loadVTLayers(),this.serializedLayersCache.clear();const R=u.queryRadius?u.queryRadius:0,O=h.bufferedTilespaceBounds,D=this.grid.query(O.min.x,O.min.y,O.max.x,O.max.y,(K,re,ne,ue)=>Il(h.bufferedTilespaceGeometry,K-R,re-R,ne+R,ue+R));D.sort(Koe);let z=null;p.elevation&&D.length>0&&(z=O1.create(p.elevation,this.tileID));const V={};let H;for(let K=0;K<D.length;K++){const re=D[K];if(re===H)continue;H=re;const ne=this.featureIndexArray.get(re);let ue=null;this.is3DTile?this.loadMatchingModelFeature(V,ne,s,h,p,A):this.loadMatchingFeature(V,ne,s,w,A,(he,ge,ke,Ee=0)=>(ue||(ue=ze(he,this.tileID.canonical,_)),ge.queryIntersectsFeature(h,he,ke,ue,this.z,p,v,z,Ee)))}return V}loadMatchingFeature(s,u,h,p,_,v){const{featureIndex:w,bucketIndex:A,sourceLayerIndex:R,layoutVertexArrayOffset:O}=u,D=this.bucketLayerIDs[A],z=h.layers,V=Object.keys(z);if(V.length&&!dn(V,D))return;const H=h.sourceCache,K=this.sourceLayerCoder.decode(R),re=this.vtLayers[K].feature(w),ne=this.getId(re,K);for(let ue=0;ue<D.length;ue++){const he=D[ue];if(!z[he])continue;const{styleLayer:ge,targets:ke}=z[he];let Ee={};ne!==void 0&&(Ee=H.getFeatureState(ge.sourceLayer,ne));const Pe=!v||v(re,ge,Ee,O);if(!Pe)continue;const Be=new Dg(re,this.z,this.x,this.y,ne);Be.tile=this.tileID.canonical,Be.state=Ee;let $e=this.serializedLayersCache.get(he);$e||($e=ge.serialize(),$e.id=he,this.serializedLayersCache.set(he,$e)),Be.source=$e.source,Be.sourceLayer=$e["source-layer"],Be.layer=Object.assign({},$e),Be.layer.paint=EF($e.paint,ge.paint,re,Ee,p),Be.layer.layout=EF($e.layout,ge.layout,re,Ee,p);let mt=!1;for(const Xe of ke){this.updateFeatureProperties(Be,Xe);const{filter:vt}=Xe;if(vt){if(re.properties=Be.properties,vt.needGeometry){const kt=We(re,!0);if(!vt.filter(new zs(this.tileID.overscaledZ,{worldview:_}),kt,this.tileID.canonical))continue}else if(!vt.filter(new zs(this.tileID.overscaledZ,{worldview:_}),re))continue}mt=!0,Xe.targetId&&this.addFeatureVariant(Be,Xe)}mt&&this.appendToResult(s,he,w,Be,Pe)}}loadMatchingModelFeature(s,u,h,p,_,v){const{featureIndex:w,bucketIndex:A}=u,R=this.bucketLayerIDs[A],O=h.layers,D=Object.keys(O);if(!D.length||dn(D,R))for(let z=0;z<R.length;z++){const V=R[z],{styleLayer:H,targets:K}=O[V];if(H.type!=="model")continue;const re=p.tile,ne=re.getBucket(H);if(!(ne&&ne instanceof p3))continue;const ue=ioe(ne,w,p,_);if(!ue)continue;const{z:he,x:ge,y:ke}=re.tileID.canonical,{feature:Ee,intersectionZ:Pe,position:Be}=ue;let $e={};Ee.id!==void 0&&($e=h.sourceCache.getFeatureState(H.sourceLayer,Ee.id));const mt=new Dg({},he,ge,ke,Ee.id);mt.tile=this.tileID.canonical,mt.state=$e,mt.properties=Ee.properties,mt.geometry={type:"Point",coordinates:[Be.lng,Be.lat]};let Xe=this.serializedLayersCache.get(V);Xe||(Xe=H.serialize(),Xe.id=V,this.serializedLayersCache.set(V,Xe)),mt.source=Xe.source,mt.sourceLayer=Xe["source-layer"],mt.layer=Object.assign({},Xe);let vt=!1;for(const kt of K){this.updateFeatureProperties(mt,kt);const{filter:It}=kt;if(It){if(Ee.properties=mt.properties,It.needGeometry){if(!It.filter(new zs(this.tileID.overscaledZ,{worldview:v}),Ee,this.tileID.canonical))continue}else if(!It.filter(new zs(this.tileID.overscaledZ,{worldview:v}),Ee))continue}vt=!0,kt.targetId&&this.addFeatureVariant(mt,kt)}vt&&this.appendToResult(s,V,w,mt,Pe)}}updateFeatureProperties(s,u,h){if(u.properties){const p={};for(const _ in u.properties){const v=u.properties[_].evaluate({zoom:this.z},s._vectorTileFeature,s.state,s.tile,h);v!=null&&(p[_]=v)}s.properties=p}}addFeatureVariant(s,u,h){const p={target:u.target,namespace:u.namespace,uniqueFeatureID:u.uniqueFeatureID};u.properties&&(p.properties=s.properties),s.variants=s.variants||{},s.variants[u.targetId]=s.variants[u.targetId]||[],s.variants[u.targetId].push(p)}appendToResult(s,u,h,p,_){let v=s[u];v===void 0&&(v=s[u]=[]),v.push({featureIndex:h,feature:p,intersectionZ:_})}lookupSymbolFeatures(s,u,h,p,_,v){const w={};this.loadVTLayers();for(const A of s)this.loadMatchingFeature(w,{bucketIndex:u,sourceLayerIndex:h,featureIndex:A,layoutVertexArrayOffset:0},p,_,v);return w}loadFeature(s){const{featureIndex:u,sourceLayerIndex:h}=s;this.loadVTLayers();const p=this.sourceLayerCoder.decode(h),_=this.vtFeatures[p];if(_[u])return _[u];const v=this.vtLayers[p].feature(u);return _[u]=v,v}hasLayer(s){for(const u of this.bucketLayerIDs)for(const h of u)if(s===h)return!0;return!1}getId(s,u){let h=s.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[u];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const _=Bh(p);if(_.result!=="success"){const v=_.value.map(w=>`${w.key}: ${w.message}`).join(", ");return void Qt(`Failed to create expression for promoteId: ${v}`)}this.promoteIdExpression=_.value}h=this.promoteIdExpression.evaluate({zoom:0},s)}else h=s.properties[p];typeof h=="boolean"&&(h=Number(h))}return h}}function EF(c,s,u,h,p){return at(c,(_,v)=>{const w=s instanceof Hf?s.get(v):null;return w&&w.evaluate?w.evaluate(u,h,void 0,p):w})}function Koe(c,s){return s-c}En(TF,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const SF=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class l5{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,h]=new Uint8Array(s,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=h>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const _=SF[15&h];if(!_)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(s,2,1),[w]=new Uint32Array(s,4,1);return new l5(w,v,_,s)}constructor(s,u=64,h=Float64Array,p){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=h,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const _=SF.indexOf(this.ArrayType),v=2*s*this.ArrayType.BYTES_PER_ELEMENT,w=s*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-w%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${h}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+w+A,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+v+w+A),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+w+A,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=s)}add(s,u){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=s,this.coords[this._pos++]=u,h}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return u5(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,u,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:v,nodeSize:w}=this,A=[0,_.length-1,0],R=[];for(;A.length;){const O=A.pop()||0,D=A.pop()||0,z=A.pop()||0;if(D-z<=w){for(let re=z;re<=D;re++){const ne=v[2*re],ue=v[2*re+1];ne>=s&&ne<=h&&ue>=u&&ue<=p&&R.push(_[re])}continue}const V=z+D>>1,H=v[2*V],K=v[2*V+1];H>=s&&H<=h&&K>=u&&K<=p&&R.push(_[V]),(O===0?s<=H:u<=K)&&(A.push(z),A.push(V-1),A.push(1-O)),(O===0?h>=H:p>=K)&&(A.push(V+1),A.push(D),A.push(1-O))}return R}within(s,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:v}=this,w=[0,p.length-1,0],A=[],R=h*h;for(;w.length;){const O=w.pop()||0,D=w.pop()||0,z=w.pop()||0;if(D-z<=v){for(let re=z;re<=D;re++)CF(_[2*re],_[2*re+1],s,u)<=R&&A.push(p[re]);continue}const V=z+D>>1,H=_[2*V],K=_[2*V+1];CF(H,K,s,u)<=R&&A.push(p[V]),(O===0?s-h<=H:u-h<=K)&&(w.push(z),w.push(V-1),w.push(1-O)),(O===0?s+h>=H:u+h>=K)&&(w.push(V+1),w.push(D),w.push(1-O))}return A}}function u5(c,s,u,h,p,_){if(p-h<=u)return;const v=h+p>>1;AF(c,s,v,h,p,_),u5(c,s,u,h,v-1,1-_),u5(c,s,u,v+1,p,1-_)}function AF(c,s,u,h,p,_){for(;p>h;){if(p-h>600){const R=p-h+1,O=u-h+1,D=Math.log(R),z=.5*Math.exp(2*D/3),V=.5*Math.sqrt(D*z*(R-z)/R)*(O-R/2<0?-1:1);AF(c,s,u,Math.max(h,Math.floor(u-O*z/R+V)),Math.min(p,Math.floor(u+(R-O)*z/R+V)),_)}const v=s[2*u+_];let w=h,A=p;for(Bw(c,s,h,u),s[2*p+_]>v&&Bw(c,s,h,p);w<A;){for(Bw(c,s,w,A),w++,A--;s[2*w+_]<v;)w++;for(;s[2*A+_]>v;)A--}s[2*h+_]===v?Bw(c,s,h,A):(A++,Bw(c,s,A,p)),A<=u&&(h=A+1),u<=A&&(p=A-1)}}function Bw(c,s,u,h){c5(c,u,h),c5(s,2*u,2*h),c5(s,2*u+1,2*h+1)}function c5(c,s,u){const h=c[s];c[s]=c[u],c[u]=h}function CF(c,s,u,h){const p=c-u,_=s-h;return p*p+_*_}i.$=fy,i.A=Md,i.B=Tc,i.C=2,i.D=x1,i.E=Df,i.F=xw,i.G=J7,i.H=hy,i.I=yl,i.J=fS,i.K=Fn,i.L=Gp,i.M=zy,i.N=dg,i.O=eS,i.P=je,i.Q=hg,i.R=H0,i.S=Zy,i.T=y6,i.U=Bh,i.V=f3,i.W=Cb,i.X=Yp,i.Y=Xp,i.Z=sg,i._=Al,i.a=function(c){return ri.API_CDN_URL_REGEX.test(c)},i.a$=W,i.a0=Mr,i.a1=Vu,i.a2=rd,i.a3=class extends f3{},i.a4=Fy,i.a5=JE,i.a6=Qe,i.a7=function(c){const s=c.value;return s?Mr(s)?X6(s,!0)?[]:[new f3(c.key,s,`invalid url "${s}"`)]:[new f3(c.key,s,`string expected, "${Fn(s)}" found`)]:[]},i.a8=uS,i.a9=xa,i.aA=ee,i.aB=$,i.aC=$i,i.aD=sl,i.aE=xs,i.aF=I,i.aG=me,i.aH=function(c,s){const u={};for(let h=0;h<s.length;h++){const p=s[h];p in c&&(u[p]=c[p])}return u},i.aI=g,i.aJ=M,i.aK=class{constructor(c){this.entries={},this.scheduler=c}request(c,s,u,h){const p=this.entries[c]=this.entries[c]||{callbacks:[]};if(p.result){const[_,v]=p.result;return this.scheduler?this.scheduler.add(()=>{h(_,v)},s):h(_,v),()=>{}}return p.callbacks.push(h),p.cancel||(p.cancel=u((_,v)=>{p.result=[_,v];for(const w of p.callbacks)this.scheduler?this.scheduler.add(()=>{w(_,v)},s):w(_,v);setTimeout(()=>delete this.entries[c],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(_=>_!==h),p.callbacks.length||(p.cancel(),delete this.entries[c]))}}},i.aL=function(c,s,u){const h=JSON.stringify(c.request);return c.data&&(this.deduped.entries[h]={result:[null,c.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},p=>{const _=Rd(c.request,(v,w,A)=>{v?p(v):w&&p(null,{rawData:w,vectorTile:u?void 0:new it(new KS(w)),responseHeaders:new Map(A.entries())})});return()=>{_.cancel(),p()}},s)},i.aM=function(c){return c?{cacheControl:c.get("Cache-Control"),expires:c.get("Expires")}:{cacheControl:void 0,expires:void 0}},i.aN=Jl,i.aO=function(c){Uu++,Uu>ny&&(c.getActor().send("enforceCacheSizeLimit",ty),Uu=0)},i.aP=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log2(c)))},i.aQ=_a,i.aR=k9,i.aS=L9,i.aT=d,i.aU=C9,i.aV=function(c,s){const u=document.createElement("video");u.muted=!0,u.onloadstart=function(){s(null,u)};for(let h=0;h<c.length;h++){const p=document.createElement("source");hI(c[h])||(u.crossOrigin="Anonymous"),p.src=c[h],u.appendChild(p)}return{cancel:()=>{}}},i.aW=mw,i.aX=Ng,i.aY=Ze,i.aZ=Ew,i.a_=j,i.aa=Wt,i.ab=class{constructor(c){this.specification=c}possiblyEvaluate(c,s){return Er(c.expression.evaluate(s))}interpolate(c,s,u){return{x:Tr(c.x,s.x,u),y:Tr(c.y,s.y,u),z:Tr(c.z,s.z,u),azimuthal:Tr(c.azimuthal,s.azimuthal,u),polar:Tr(c.polar,s.polar,u)}}},i.ac=zs,i.ad=Uf,i.ae=pe,i.af=rn,i.ag=Nt,i.ah=le,i.ai=Hf,i.aj=mm,i.ak=Tr,i.al=Jt,i.am=Yx,i.an=cn,i.ao=ts,i.ap=class{constructor(c){this.specification=c}possiblyEvaluate(c,s){return function([u,h]){const p=Er([1,u,h]);return{x:p.x,y:p.y,z:p.z}}(c.expression.evaluate(s))}interpolate(c,s,u){return{x:Tr(c.x,s.x,u),y:Tr(c.y,s.y,u),z:Tr(c.z,s.z,u)}}},i.aq=function(c,s,u=0,h=!0){const p=new je(u,u),_=c.sub(p),v=s.add(p),w=[_,new je(v.x,_.y),v,new je(_.x,v.y)];return h&&w.push(_.clone()),w},i.ar=function(c,s){const u=[];for(let h=0;h<c.length;h++){const p=ye(h-1,-1,c.length-1),_=ye(h+1,-1,c.length-1),v=c[h],w=c[_],A=c[p].sub(v).unit(),R=w.sub(v).unit(),O=R.angleWithSep(A.x,A.y),D=A.add(R).unit().mult(-1*s/Math.sin(O/2));u.push(v.add(D))}return u},i.as=h9,i.at=Il,i.au=function(c,s,u=0){return Rt(((s.x-u)*c.scale-c.x)*Jt,(s.y*c.scale-c.y)*Jt,Z(s.z,s.y))},i.av=Vn,i.aw=qt,i.ax=Cn,i.ay=C7,i.az=function(c){let s=1/0,u=1/0,h=-1/0,p=-1/0;for(const _ of c)s=Math.min(s,_.x),u=Math.min(u,_.y),h=Math.max(h,_.x),p=Math.max(p,_.y);return{min:new je(s,u),max:new je(h,p)}},i.b=function(c){return ri.API_FONTS_REGEX.test(c)},i.b$=Cz,i.b0=to,i.b1=om,i.b2=Ve,i.b3=wS,i.b4=u3,i.b5=function(){Fd.isLoading()||Fd.isLoaded()||gg()!=="deferred"||lS()},i.b6=Wy,i.b7=We,i.b8=Dg,i.b9=Ms,i.bA=q,i.bB=be,i.bC=F,i.bD=function(c,s){const{x:u,y:h}=c.point,p=qN(u,h,c.worldSize/c._pixelsPerMercatorPixel,0,0);return $(p,p,ZI(Ac(s)))},i.bE=S,i.bF=sr,i.bG=Tn,i.bH=jt,i.bI=Sn,i.bJ=wn,i.bK=k1,i.bL=Tu,i.bM=N6,i.bN=function(c,s,u,h,p){const _=5*s+2;c.float32[_+0]=u,c.float32[_+1]=h,c.float32[_+2]=p},i.bO=P1,i.bP=Zi,i.bQ=Ke,i.bR=Ln,i.bS=Ta,i.bT=ye,i.bU=function(c,s,u,h){var p=new x(4);return p[0]=c,p[1]=s,p[2]=u,p[3]=h,p},i.bV=class{isDataAvailableAtPoint(c){const s=this._source();if(this.isUsingMockSource()||!s||c.y<0||c.y>1)return!1;const u=s.getSource().maxzoom,h=1<<u,p=Math.floor(c.x),_=Math.floor((c.x-p)*h),v=Math.floor(c.y*h),w=this.findDEMTileFor(new _a(u,p,u,_,v));return!(!w||!w.dem)}getAtPointOrZero(c,s=0){return this.getAtPoint(c,s)||0}getAtPoint(c,s,u=!0){if(this.isUsingMockSource())return null;s==null&&(s=null);const h=this._source();if(!h||c.y<0||c.y>1)return s;const p=h.getSource().maxzoom,_=1<<p,v=Math.floor(c.x),w=c.x-v,A=new _a(p,v,p,Math.floor(w*_),Math.floor(c.y*_)),R=this.findDEMTileFor(A);if(!R||!R.dem)return s;const O=R.dem,D=1<<R.tileID.canonical.z,z=(w*D-R.tileID.canonical.x)*O.dim,V=(c.y*D-R.tileID.canonical.y)*O.dim,H=Math.floor(z),K=Math.floor(V);return(u?this.exaggeration():1)*Tr(Tr(O.get(H,K),O.get(H,K+1),V-K),Tr(O.get(H+1,K),O.get(H+1,K+1),V-K),z-H)}static getAtTileOffset(c,s,u,h){const p=1<<c.canonical.z;return h?h.pointElevation(s):u?u.getAtPointOrZero(new pe(c.wrap+(c.canonical.x+s.x/Jt)/p,(c.canonical.y+s.y/Jt)/p)):0}static getAtTileOffsetFunc(c,s,u,h){return(p,_,v)=>{const w=this.getAtTileOffset(c,p,_,v),A=h.upVector(c.canonical,p.x,p.y);return Fe(A,A,w*h.upVectorScale(c.canonical,s,u).metersToTile),A}}getForTilePoints(c,s,u,h){if(this.isUsingMockSource())return!1;const p=O1.create(this,c,h);return!!p&&(s.forEach(_=>{_[2]=this.exaggeration()*p.getElevationAt(_[0],_[1],u)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const s=this.findDEMTileFor(c);if(!s||!s.dem)return null;const u=s.dem.tree,h=s.tileID,p=1<<c.canonical.z-h.canonical.z;let _=c.canonical.x/p-h.canonical.x,v=c.canonical.y/p-h.canonical.y,w=0;for(let A=0;A<c.canonical.z-h.canonical.z&&!u.leaves[w];A++){_*=2,v*=2;const R=2*Math.floor(v)+Math.floor(_);w=u.childOffsets[w]+R,_%=1,v%=1}return{min:this.exaggeration()*u.minimums[w],max:this.exaggeration()*u.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,s,u){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let s=!1,u=Number.MAX_VALUE,h=Number.MIN_VALUE;for(const p of c){const _=this.getMinMaxForTile(p.tileID);_&&(u=Math.min(u,_.min),h=Math.max(h,_.max),s=!0)}return s?{min:u,max:h}:null}},i.bW=jS,i.bX=Di,i.bY=So,i.bZ=Tz,i.b_=D9,i.ba=C6,i.bb=r6,i.bc=ze,i.bd=Uh,i.be=$h,i.bf=fm,i.bg=da,i.bh=y1,i.bi=Z6,i.bj=function(c,s){const u=mm(s.zoom);if(u===0)return Ac(c);const h=IS(c),p=qI(h),_=I(h.getWest())*s.worldSize,v=I(h.getEast())*s.worldSize,w=M(h.getNorth())*s.worldSize,A=M(h.getSouth())*s.worldSize,R=[_,w,0],O=[v,w,0],D=[_,A,0],z=[v,A,0],V=G([],s.globeMatrix);return rn(R,R,V),rn(O,O,V),rn(D,D,V),rn(z,z,V),p[0]=qd(p[0],D,u),p[1]=qd(p[1],z,u),p[2]=qd(p[2],O,u),p[3]=qd(p[3],R,u),Nn.fromPoints(p)},i.bk=MS,i.bl=G,i.bm=Jb,i.bn=qd,i.bo=am,i.bp=Cg,i.bq=ve,i.br=X,i.bs=b3,i.bt=KS,i.bu=Rd,i.bv=function(c,s){const u=[];for(const h in c)h in s||u.push(h);return u},i.bw=Ne,i.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.by=jn,i.bz=U,i.c=Ro,i.c$=function(c,s,u){let h=0;for(let p=0;p<2;++p)c[p]>0&&(h+=(c[p]-0)*(c[p]-0)),s[p]<0&&(h+=(0-s[p])*(0-s[p]));return h},i.c0=kz,i.c1=O6,i.c2=a9,i.c3=U6,i.c4=l5,i.c5=Fe,i.c6=ys,i.c7=Kt,i.c8=function(c,s,u){u*=.5;var h=s[0],p=s[1],_=s[2],v=s[3],w=Math.sin(u),A=Math.cos(u);return c[0]=h*A+p*w,c[1]=p*A-h*w,c[2]=_*A+v*w,c[3]=v*A-_*w,c},i.c9=An,i.cA=ft,i.cB=Bi,i.cC=h7,i.cD=bs,i.cE=$N,i.cF=function(c,s,u,h,p,_,v,w,A){if(A.name==="globe")return $N(c,s,new bs(u,h,p),!1);const R=Ew({z:u,x:h,y:p},A);return new Nn([(_+R.x/R.scale)*s,s*(R.y/R.scale),v],[(_+R.x2/R.scale)*s,s*(R.y2/R.scale),w])},i.cG=function(c,s,u){return c[0]=Math.min(s[0],u[0]),c[1]=Math.min(s[1],u[1]),c[2]=Math.min(s[2],u[2]),c[3]=Math.min(s[3],u[3]),c},i.cH=function(c,s,u){return c[0]=Math.max(s[0],u[0]),c[1]=Math.max(s[1],u[1]),c[2]=Math.max(s[2],u[2]),c[3]=Math.max(s[3],u[3]),c},i.cI=function(c){const s=Math.round((c+45+360)%360/90)%4;return Qs[s]},i.cJ=Y,i.cK=Ri,i.cL=_1,i.cM=function(c){const s=q(new Float64Array(16));$(s,c.pixelMatrix,c.globeMatrix);const u=[0,Wu,0],h=[0,Xu,0];return rn(u,u,s),rn(h,h,s),[u[0]>0&&u[0]<=c.width&&u[1]>0&&u[1]<=c.height&&!XI(c,new d(c.center.lat,90)),h[0]>0&&h[0]<=c.width&&h[1]>0&&h[1]<=c.height&&!XI(c,new d(c.center.lat,-90))]},i.cN=function(c,s){const{scale:u}=c.tileTransform,h=u*Jt/(c.tileSize*Math.pow(2,s.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return function(p,_,v){var w=_[1],A=_[2],R=_[3],O=v[0],D=v[1];return p[0]=_[0]*O,p[1]=w*O,p[2]=A*D,p[3]=R*D,p}(new Float32Array(4),s.inverseAdjustmentMatrix,[h,h])},i.cO=GS,i.cP=He,i.cQ=d7,i.cR=function(c){const s=d7(c,!0);return S([],[s[0],s[1],s[4],s[5]])},i.cS=ie,i.cT=fn,i.cU=de,i.cV=function(c){const{x:s,y:u}=c.point,{lng:h,lat:p}=c._center;return qN(s,u,c.worldSize,h,p)},i.cW=Oe,i.cX=xr,i.cY=fa,i.cZ=Xo,i.c_=Zu,i.ca=Qi,i.cb=function(c,s){return c[0]=-s[0],c[1]=-s[1],c[2]=-s[2],c[3]=s[3],c},i.cc=rt,i.cd=function(c,s,u,h,p){var _=1/Math.tan(s/2);if(c[0]=_/u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=_,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,p!=null&&p!==1/0){var v=1/(h-p);c[10]=(p+h)*v,c[14]=2*p*h*v}else c[10]=-1,c[14]=-2*h;return c},i.ce=function(c,s,u,h,p,_,v){var w=1/(s-u),A=1/(h-p),R=1/(_-v);return c[0]=-2*w,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*A,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*R,c[11]=0,c[12]=(s+u)*w,c[13]=(p+h)*A,c[14]=(v+_)*R,c[15]=1,c},i.cf=N,i.cg=function(c,s,u){c[4*s+0]=u[0],c[4*s+1]=u[1],c[4*s+2]=u[2],c[4*s+3]=u[3]},i.ch=f1,i.ci=bg,i.cj=no,i.ck=ad,i.cl=Tg,i.cm=_9,i.cn=function(){var c=new x(4);return x!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c},i.co=function(c,s,u){var h=s[0],p=s[1],_=s[2],v=s[3],w=Math.sin(u),A=Math.cos(u);return c[0]=h*A+_*w,c[1]=p*A+v*w,c[2]=h*-w+_*A,c[3]=p*-w+v*A,c},i.cp=function(c,s){return c[0]===s[0]&&c[1]===s[1]&&c[2]===s[2]&&c[3]===s[3]},i.cq=ar,i.cr=function(c){var s=c[0],u=c[1],h=c[2],p=c[3];return Math.sqrt(s*s+u*u+h*h+p*p)},i.cs=dt,i.ct=Qr,i.cu=Ha,i.cv=3,i.cw=2,i.cx=7,i.cy=6,i.cz=Xn,i.d=function(c){return ri.API_TILEJSON_REGEX.test(c)},i.d$=class{constructor(c,s,u,h){this.context=c,this.format=h,this.size=u,this.texture=c.gl.createTexture();const[p,_,v]=this.size,{gl:w}=c;w.bindTexture(w.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in s&&s.data&&w.texImage3D(w.TEXTURE_3D,0,this.format,p,_,v,0,g6(this.format),_6(this.format),s.data)}bind(c,s){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_3D,this.texture),c!==this.minFilter&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MAG_FILTER,c),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MIN_FILTER,c),this.minFilter=c),s!==this.wrapS&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_T,s),this.wrapS=s)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},i.d0=function(c){return c*c*c*c*c},i.d1=E,i.d2=45,i.d3=p1,i.d4=function(c,s,u){const h=Math.sqrt(c*c+s*s+u*u),p=h>0?Math.acos(u/h)*Gn:0;let _=c!==0||s!==0?Math.atan2(-s,-c)*Gn+90:0;return _<0&&(_+=360),[h,_,p]},i.d5=Rt,i.d6=Er,i.d7=ae,i.d8=nt,i.d9=Nn,i.dA=function(c){return c({pluginStatus:Cl,pluginURL:zd}),Gy.on("pluginStateChange",c),c},i.dB=wg,i.dC=class extends jd{constructor(c){super(c),this.current=m1}set(c,s,u){if(this.fetchUniformLocation(c,s)){for(let h=0;h<9;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix3fv(this.location,!1,u);break}}}},i.dD=Sr,i.dE=function(c,s,u){const h=mm(u.zoom),p=c.style.map._antialias,_=c.terrain&&c.terrain.exaggeration()>0;return h===0&&!p&&!_},i.dF=function(c){const s=c.pixelsPerMeter,u=s/N(1,c.center.lat),h=q(new Float64Array(16));return X(h,h,[c.point.x,c.point.y,0]),ie(h,h,[u,u,s]),Float32Array.from(h)},i.dG=IS,i.dH=function(c){const s=Y-5;c=ee(c,-s,s)/s*90;const u=Math.pow(Math.abs(Math.sin(cn(c))),3);return Math.round(u*(Qb.length-1))},i.dI=function(c,s,u,h){const p=s.getNorth(),_=s.getSouth(),v=s.getWest(),w=s.getEast(),A=1<<c.z,R=w-v,O=p-_,D=R/dm,z=-O/Qb[u],V=[0,D,0,z,0,0,p,v,0];if(c.z>0){const H=180/h;L(V,V,[H/R+1,0,0,0,H/O+1,0,-.5*H/D,.5*H/z,1])}return V[2]=A,V[5]=c.x,V[8]=c.y,V},i.dJ=Ac,i.dK=function(c,s,u){const h=q(new Float64Array(16)),p=(s/(1<<c)-.5)*Math.PI*2;return fe(h,u.globeMatrix,p),Float32Array.from(h)},i.dL=sz,i.dM=od,i.dN=function(c,s){return[Math.pow(c[0],2.2)*s,Math.pow(c[1],2.2)*s,Math.pow(c[2],2.2)*s]},i.dO=C,i.dP=function(c,s){var u=Math.sin(s),h=Math.cos(s);return c[0]=h,c[1]=u,c[2]=0,c[3]=-u,c[4]=h,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},i.dQ=br,i.dR=GN,i.dS=$r,i.dT=Ps,i.dU=256,i.dV=function(c,s){const u=[0,0,0];return rn(u,u,MS(Ac(s.canonical))),rn(u,u,c),u},i.dW=c=>({u_matrix:new Tg(c),u_texsize:new ad(c),u_pixels_to_tile_units:new g1(c),u_device_pixel_ratio:new no(c),u_width_scale:new no(c),u_floor_width_scale:new no(c),u_image:new f1(c),u_units_to_pixels:new ad(c),u_tile_units_to_pixels:new no(c),u_alpha_discard_threshold:new no(c),u_trim_offset:new ad(c),u_trim_fade_range:new ad(c),u_trim_color:new p1(c),u_zbias_factor:new no(c),u_tile_to_meter:new no(c),u_ground_shadow_factor:new bg(c),u_pattern_transition:new no(c)}),i.dX=c=>({u_matrix:new Tg(c),u_pixels_to_tile_units:new g1(c),u_device_pixel_ratio:new no(c),u_width_scale:new no(c),u_floor_width_scale:new no(c),u_units_to_pixels:new ad(c),u_dash_image:new f1(c),u_gradient_image:new f1(c),u_image_height:new no(c),u_texsize:new ad(c),u_tile_units_to_pixels:new no(c),u_alpha_discard_threshold:new no(c),u_trim_offset:new ad(c),u_trim_fade_range:new ad(c),u_trim_color:new p1(c),u_zbias_factor:new no(c),u_tile_to_meter:new no(c),u_ground_shadow_factor:new bg(c)}),i.dY=c=>({u_camera_to_center_distance:new no(c),u_extrude_scale:new g1(c),u_device_pixel_ratio:new no(c),u_matrix:new Tg(c),u_inv_rot_matrix:new Tg(c),u_merc_center:new ad(c),u_tile_id:new bg(c),u_zoom_transition:new no(c),u_up_dir:new bg(c),u_emissive_strength:new no(c)}),i.dZ=i1,i.d_=lae,i.da=pt,i.db=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},i.dc=c7,i.dd=E6,i.de=m7,i.df=X6,i.dg=function(c,s){return c.readFields(ooe,{icons:[]},s)},i.dh=US,i.di=I1,i.dj=F6,i.dk=sy,i.dl=mg,i.dm=Vp,i.dn=oy,i.dp=xt,i.dq=function(c){const s=c.indexOf(Zf);return s>=0?c.slice(0,s):c},i.dr=function(c){return c.indexOf(Zf)>=0},i.ds=function(c){const s=c.lastIndexOf(Zf);return s>=0?c.slice(s+1):""},i.dt=function(c){const s=[],u=c.id;return u===void 0&&s.push({message:`layers.${u}: missing required property "id"`}),c.render===void 0&&s.push({message:`layers.${u}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&s.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),s},i.du=function(c,s,u,h){return c.type==="custom"?new eoe(c,s):new soe[c.type](c,s,u,h)},i.dv=Mt,i.dw=function(c){const s=c.indexOf(Zf);return s>=0?c.slice(s+1):""},i.dx=class extends Dg{constructor(c,s){super(c._vectorTileFeature,c._z,c._x,c._y,c.id),c.state&&(this.state=Object.assign({},c.state)),this.target=s.target,this.namespace=s.namespace,s.properties&&(this.properties=s.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=c.source,this.sourceLayer=c.sourceLayer,this.layer=c.layer)}toJSON(){const c=super.toJSON();return c.target=this.target,c.namespace=this.namespace,c}},i.dy=Gy,i.dz=Lf,i.e=ri,i.e$=en,i.e0=XN,i.e1=(c,s,u,h,p,_)=>{const v=c.transform,w=v.projection.name==="globe";let A;if(_.paint.get("circle-pitch-alignment")==="map")if(w){const O=GN(v.zoom,s.canonical)*v._pixelsPerMercatorPixel;A=Float32Array.from([O,0,0,O])}else A=v.calculatePixelsToTileUnitsMatrix(u);else A=new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(v.projection),u_matrix:c.translatePosMatrix(s.projMatrix,u,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:To.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:Eie,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:_.paint.get("circle-emissive-strength")};if(w){R.u_inv_rot_matrix=h,R.u_merc_center=p,R.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],R.u_zoom_transition=mm(v.zoom);const O=p[0]*Jt,D=p[1]*Jt;R.u_up_dir=v.projection.upVector(new bs(0,0,0),O,D)}return R},i.e2=M7,i.e3=Sl,i.e4=(c,s,u,h,p,_,v,w,A,R)=>{const O=c.transform,D=O.pitch<15?k7(.07,.7,ee((14-O.zoom)/5,0,1)):.07,z=u.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:R7(c,s,u,h),u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:O.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:p,u_width_scale:_,u_floor_width_scale:v,u_image:0,u_tile_units_to_pixels:I7(s,O),u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:u.paint.get("line-trim-fade-range"),u_trim_color:u.paint.get("line-trim-color").toPremultipliedRenderColor(z?null:u.lut).toArray01(),u_zbias_factor:D,u_tile_to_meter:ae(s.tileID.canonical,0),u_ground_shadow_factor:A,u_pattern_transition:R}},i.e5=(c,s,u,h,p,_,v,w,A,R)=>{const O=c.transform,D=O.calculatePixelsToTileUnitsMatrix(s),z=u.paint.get("line-trim-color-use-theme").constantOr("default")==="none",V=O.pitch<15?k7(.07,.7,ee((14-O.zoom)/5,0,1)):.07;return{u_matrix:R7(c,s,u,h),u_pixels_to_tile_units:D,u_device_pixel_ratio:_,u_width_scale:v,u_floor_width_scale:w,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:P7(u)&&s.lineAtlasTexture?s.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:I7(s,c.transform),u_alpha_discard_threshold:0,u_trim_offset:A,u_trim_fade_range:u.paint.get("line-trim-fade-range"),u_trim_color:u.paint.get("line-trim-color").toPremultipliedRenderColor(z?null:u.lut).toArray01(),u_zbias_factor:V,u_tile_to_meter:ae(s.tileID.canonical,0),u_ground_shadow_factor:R}},i.e6=tt,i.e7=ew,i.e8=Z,i.e9=Ku,i.eA=function(c,s){var u=2*Math.acos(s[3]),h=Math.sin(u/2);return h>y?(c[0]=s[0]/h,c[1]=s[1]/h,c[2]=s[2]/h):(c[0]=1,c[1]=0,c[2]=0),u},i.eB=Q6,i.eC=WS,i.eD=ZS,i.eE=[1,1,1],i.eF=O1,i.eG=Si,i.eH=function(c,s,u,h){var p=s[0],_=s[1],v=s[2],w=s[3];return c[0]=p+h*(u[0]-p),c[1]=_+h*(u[1]-_),c[2]=v+h*(u[2]-v),c[3]=w+h*(u[3]-w),c},i.eI=E1,i.eJ=xu,i.eK=sd,i.eL=function(c,s,u,h,p,_,v,w,A,R,O,D,z,V,H,K){var re=new x(16);return re[0]=c,re[1]=s,re[2]=u,re[3]=h,re[4]=p,re[5]=_,re[6]=v,re[7]=w,re[8]=A,re[9]=R,re[10]=O,re[11]=D,re[12]=z,re[13]=V,re[14]=H,re[15]=K,re},i.eM=m,i.eN=um,i.eO=Vb,i.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new je(1/0,1/0),max:new je(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,s=!1){const u=Sz(new je(0,0),new je(Jt,Jt),c),h=[];if(s&&!i6(u,this._globalClipBounds))return h;for(const p of this._activeRegions){if(p.hiddenByOverlap||!i6(u,p))continue;const _=Jie(p.min,p.max,c);h.push({min:_.min,max:_.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return h}setSources(c){this._setSources(c.map(s=>({getSourceId:()=>s.cache.id,getFootprints:()=>{const u=[];for(const h of s.cache.getVisibleCoordinates()){const p=s.cache.getTile(h).buckets[s.layer];p&&p.updateFootprints(h.toUnwrapped(),u)}return u},getOrder:()=>s.order,getClipMask:()=>s.clipMask,getClipScope:()=>s.clipScope})))}_addSource(c){const s=c.getFootprints();if(s.length===0)return;const u=c.getOrder(),h=c.getClipMask(),p=c.getClipScope();for(const _ of s){if(!_.footprint)continue;const v=Sz(_.footprint.min,_.footprint.max,_.id);this._activeRegions.push({min:v.min,max:v.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:_.id,footprint:_.footprint,order:u,clipMask:h,clipScope:p})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((s,u)=>s.priority-u.priority||NS(s.min,u.min)||NS(s.max,u.max)||s.order-u.order||s.clipMask-u.clipMask||function(h,p){const _=(v,w)=>v+w;return h.length-p.length||h.reduce(_,"").localeCompare(p.reduce(_,""))}(s.clipScope,u.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let s=0;for(;!c&&s!==this._activeRegions.length;){const u=this._activeRegions[s],h=this._prevRegions[s];c=u.priority!==h.priority||!Ez(u,h)||u.order!==h.order||u.clipMask!==h.clipMask||!jn(u.clipScope,h.clipScope),this._activeRegions[s].hiddenByOverlap=h.hiddenByOverlap,++s}}if(c){++this._updateTime;for(const u of this._activeRegions)u.order!==aw&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,u.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,u.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,u.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,u.max.y));const s=u=>{const h=this._activeRegions;if(u>=h.length)return u;const p=h[u].priority;for(;u<h.length&&h[u].priority===p;)++u;return u};if(this._sourceIds.length>1){let u=0,h=s(u);for(;u!==h;){let p=u;const _=u;for(;p!==h;){const v=this._activeRegions[p];v.hiddenByOverlap=!1;for(let w=0;w<_;w++){const A=this._activeRegions[w];if(!A.hiddenByOverlap&&v.order===aw&&i6(v,A)&&(v.hiddenByOverlap=Az(v.footprint,v.tileId,A.footprint,A.tileId),v.hiddenByOverlap))break}++p}u=h,h=s(u)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let s=c.length-1;s>=0;s--)this._addSource(c[s]);this._computeReplacement()}},i.eQ=aw,i.eR=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,s){const u=new Uh,h=new to,p=[],_=c+1+2,v=s[0]+1,w=s[0]+1+(1+s.length),A=(R,O,D)=>{let z=R===_-1?R-2:R===0?R:R-1;return z+=D?24575:0,[z,O]};for(let R=0;R<_;++R)u.emplaceBack(...A(R,0,!0));for(let R=0;R<v;++R)for(let O=0;O<_;++O)u.emplaceBack(...A(O,R,(O===0||O===_-1)&&!0));for(let R=0;R<s.length;++R){const O=s[R];for(let D=0;D<_;++D)u.emplaceBack(...A(D,O,!0))}for(let R=0;R<s.length;++R){const O=h.length,D=s[R]+1+2,z=new to;for(let K=0;K<D-1;K++){const re=K===D-2,ne=re?_*(w-s.length+R-K):_;for(let ue=0;ue<_-1;ue++){const he=K*_+ue;K===0||re||ue===0||ue===_-2?(z.emplaceBack(he+1,he,he+ne),z.emplaceBack(he+ne,he+ne+1,he+1)):(h.emplaceBack(he+1,he,he+ne),h.emplaceBack(he+ne,he+ne+1,he+1))}}const V=da.simpleSegment(0,O,u.length,h.length-O);for(let K=0;K<z.uint16.length;K+=3)h.emplaceBack(z.uint16[K],z.uint16[K+1],z.uint16[K+2]);const H=da.simpleSegment(0,O,u.length,h.length-O);p.push({withoutSkirts:V,withSkirts:H})}return{vertices:u,indices:h,segments:p}}_createGrid(c){const s=this._fillGridMeshWithLods(dm,Qb);this._gridSegments=s.segments,this._gridBuffer=c.createVertexBuffer(s.vertices,fm.members),this._gridIndexBuffer=c.createIndexBuffer(s.indices,!0)}_createPoles(c){const s=new to;for(let v=0;v<=dm;v++)s.emplaceBack(0,v+1,v+2);this._poleIndexBuffer=c.createIndexBuffer(s,!0);const u=new Xf,h=new Xf,p=new Xf,_=new Xf;this._poleSegments=[];for(let v=0,w=0;v<Zu;v++){const A=360/(1<<v);u.emplaceBack(0,-sl,0,.5,0),h.emplaceBack(0,-sl,0,.5,1),p.emplaceBack(0,-sl,0,.5,.5),_.emplaceBack(0,-sl,0,.5,.5);for(let R=0;R<=dm;R++){let O=R/dm,D=0;const z=Tr(0,A,O),[V,H,K]=Yf(wie,Tie,z,sl);u.emplaceBack(V,H,K,O,D),h.emplaceBack(V,H,K,O,1-D);const re=cn(z);O=.5+.5*Math.sin(re),D=.5+.5*Math.cos(re),p.emplaceBack(V,H,K,O,D),_.emplaceBack(V,H,K,O,1-D)}this._poleSegments.push(da.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(u,Sc,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(h,Sc,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(p,Sc,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(_,Sc,!1)}getGridBuffers(c,s){return[this._gridBuffer,this._gridIndexBuffer,s?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,s){return[s?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,s?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},i.eS=wz,i.eT=Mi,i.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.eV=Ye,i.eW=oe,i.eX=function(c,s,u){return c[0]=s[0]/u[0],c[1]=s[1]/u[1],c[2]=s[2]/u[2],c},i.eY=wr,i.eZ=hm,i.e_=zn,i.ea=BS,i.eb=Vz,i.ec=Qf,i.ed=Pz,i.ee=Mz,i.ef=J,i.eg=function(c,s){if(c===s){var u=s[1],h=s[2],p=s[3],_=s[6],v=s[7],w=s[11];c[1]=s[4],c[2]=s[8],c[3]=s[12],c[4]=u,c[6]=s[9],c[7]=s[13],c[8]=h,c[9]=_,c[11]=s[14],c[12]=p,c[13]=v,c[14]=w}else c[0]=s[0],c[1]=s[4],c[2]=s[8],c[3]=s[12],c[4]=s[1],c[5]=s[5],c[6]=s[9],c[7]=s[13],c[8]=s[2],c[9]=s[6],c[10]=s[10],c[11]=s[14],c[12]=s[3],c[13]=s[7],c[14]=s[11],c[15]=s[15];return c},i.eh=Jae,i.ei=hi,i.ej=Hb,i.ek=256,i.el=ZI,i.em=vu,i.en=fe,i.eo=function(c,s){return c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[4],c[4]=s[5],c[5]=s[6],c[6]=s[8],c[7]=s[9],c[8]=s[10],c},i.ep=Xf,i.eq=YE,i.er=Ub,i.es=function(c,s,u,h,p){return ee((c-s)/(u-s)*(p-h)+h,h,p)},i.et=Lr,i.eu=function(c,s){var u=s[0],h=s[1],p=s[2],_=s[3],v=s[4],w=s[5],A=s[6],R=s[7],O=s[8],D=O*v-w*R,z=-O*_+w*A,V=R*_-v*A,H=u*D+h*z+p*V;return H?(c[0]=D*(H=1/H),c[1]=(-O*h+p*R)*H,c[2]=(w*h-p*v)*H,c[3]=z*H,c[4]=(O*u-p*A)*H,c[5]=(-w*u+p*_)*H,c[6]=V*H,c[7]=(-R*u+h*A)*H,c[8]=(v*u-h*_)*H,c):null},i.ev=2,i.ew=yn,i.ex=Ws,i.ey=we,i.ez=function(c,s){var u=new x(3);we(u,s);var h=1/u[0],p=1/u[1],_=1/u[2],v=s[0]*h,w=s[1]*p,A=s[2]*_,R=s[4]*h,O=s[5]*p,D=s[6]*_,z=s[8]*h,V=s[9]*p,H=s[10]*_,K=v+O+H,re=0;return K>0?(re=2*Math.sqrt(K+1),c[3]=.25*re,c[0]=(D-V)/re,c[1]=(z-A)/re,c[2]=(w-R)/re):v>O&&v>H?(re=2*Math.sqrt(1+v-O-H),c[3]=(D-V)/re,c[0]=.25*re,c[1]=(w+R)/re,c[2]=(z+A)/re):O>H?(re=2*Math.sqrt(1+O-v-H),c[3]=(z-A)/re,c[0]=(w+R)/re,c[1]=.25*re,c[2]=(D+V)/re):(re=2*Math.sqrt(1+H-v-O),c[3]=(w-R)/re,c[0]=(z+A)/re,c[1]=(D+V)/re,c[2]=.25*re),c},i.f=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(s,u)=>String.fromCharCode(+("0x"+u))))},i.f0=function([c,s,u]){const h=Math.hypot(c,s,u),p=Math.atan2(c,u),_=.5*Math.PI-Math.acos(-s/h);return new d(xr(p),xr(_))},i.f1=ks,i.f2=v6,i.f3=function(c){const s=c.navigator?c.navigator.userAgent:null;return!!function(u){if(as==null){const h=u.navigator?u.navigator.userAgent:null;as=!!u.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return as}(c)&&!(!s||!(s.match("Version/15.4")||s.match("Version/15.5")||s.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.f4=function(c,s){ty=c,ny=s},i.f5=XI,i.f6=ZN,i.f7=function(c){const s=[0,0,0],u=q(new Float64Array(16));return $(u,c.pixelMatrix,c.globeMatrix),rn(s,s,u),new je(s[0],s[1])},i.f8=function(){const c=hw;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(c6),hw=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.f9=function(){US().acquire(c6)},i.fA=x3,i.fB=Ge,i.fC=function(c){let s=0;if(new Uint32Array(c,0,1)[0]!==s7){const u=new Uint32Array(c,0,7),[,,h,p,_,v]=u;s=u.byteLength+p+_+v+_,(h!==c.byteLength||s>=c.byteLength)&&Qt("Invalid b3dm header information.")}return u7(c,s)},i.fD=function(c,s){const u=E6(c);for(const h of u){for(const p of h.meshes)Rse(p);h.lights&&(h.lightMeshIndex=h.meshes.length,h.meshes.push(Mse(h.lights,s)))}return u},i.fE=p3,i.fF=ni,i.fG=e7,i.fH=Fd,i.fI=eu,i.fJ=function(c){yc(),Xc!=null&&Xc.then(s=>{s.keys().then(u=>{for(let h=0;h<u.length-c;h++)s.delete(u[h]).catch(p=>Qt(p.message))}).catch(u=>Qt(u.message))}).catch(s=>Qt(s.message))},i.fa=gg,i.fb=function(c,s,u=!1){if(Cl===eu.deferred||Cl===eu.loading||Cl===eu.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");zd=To.resolveURL(c),Cl=eu.deferred,Mb=s,Hy(),u||lS()},i.fc=function(c){b1=To.resolveURL(c),w1||(w1=new x1(US(),new Df)),w1.broadcast("setMeshoptUrl",b1)},i.fd=r7,i.fe=function(c){f6=To.resolveURL(c),w1||(w1=new x1(US(),new Df)),w1.broadcast("setDracoUrl",f6)},i.ff=n7,i.fg=dw,i.fh=function(c){const s=_c();if(!s)return;const u=s.delete(ey);c&&u.then(()=>c()).catch(c)},i.fi=Rg,i.fj=En,i.fk=gm,i.fl=Xd,i.fm=wF,i.fn=TF,i.fo=E7,i.fp=_t,i.fq="hd_road_elevation",i.fr=Wi,i.fs=at,i.ft=Kf,i.fu=z6,i.fv=Og,i.fw=function(c,s,u,h,p,_,v,w=1,A,R,O){c.createArrays(),c.tilePixelRatio=Jt/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const D=c.layers[0].layout,z=c.layers[0]._unevaluatedLayout._values,V={};V.scaleFactor=w,V.textSizeScaleRange=D.get("text-size-scale-range"),V.iconSizeScaleRange=D.get("icon-size-scale-range");const[H,K]=V.textSizeScaleRange,[re,ne]=V.iconSizeScaleRange;V.textScaleFactor=ee(V.scaleFactor,H,K),V.iconScaleFactor=ee(V.scaleFactor,re,ne);const ue=z["text-size"],he=z["icon-size"];if(c.textSizeData.kind==="composite"){const{minZoom:$e,maxZoom:mt}=c.textSizeData;V.compositeTextSizes=[ue.possiblyEvaluate(new zs($e,{worldview:O}),_),ue.possiblyEvaluate(new zs(mt,{worldview:O}),_)]}if(c.iconSizeData.kind==="composite"){const{minZoom:$e,maxZoom:mt}=c.iconSizeData;V.compositeIconSizes=[he.possiblyEvaluate(new zs($e,{worldview:O}),_),he.possiblyEvaluate(new zs(mt,{worldview:O}),_)]}V.layoutTextSize=ue.possiblyEvaluate(new zs(v+1,{worldview:O}),_),V.layoutIconSize=he.possiblyEvaluate(new zs(v+1,{worldview:O}),_),V.textMaxSize=ue.possiblyEvaluate(new zs(18,{worldview:O}),_);const ge=D.get("symbol-placement"),ke=D.get("text-rotation-alignment")==="map"&&ge!=="point",Ee=D.get("text-size");let Pe=!1;const Be=[];for(const $e of c.features){const mt=D.get("text-font").evaluate($e,{},_).join(","),Xe=Ee.evaluate($e,{},_)*V.textScaleFactor,vt=V.layoutTextSize.evaluate($e,{},_)*V.textScaleFactor,kt=V.layoutIconSize.evaluate($e,{},_)*V.iconScaleFactor,It={horizontal:{},vertical:void 0},zt=$e.text;let Bt,Ot=[0,0];if(zt){const jr=zt.toString(),hs=D.get("text-letter-spacing").evaluate($e,{},_)*So,Se=D.get("text-line-height").evaluate($e,{},_)*So,Ie=Ib(jr)?hs:0,bt=D.get("text-anchor").evaluate($e,{},_),Ft=D.get("text-variable-anchor");if(!Ft){const zr=D.get("text-radial-offset").evaluate($e,{},_);if(zr)Ot=a9(bt,[zr*So,j6]);else{const qr=D.get("text-offset").evaluate($e,{},_);Ot=[qr[0]*So,qr[1]*So]}}let ln=ke?"center":D.get("text-justify").evaluate($e,{},_);const un=ge==="point",Un=un?D.get("text-max-width").evaluate($e,{},_)*So:1/0,Yn=zr=>{c.allowVerticalPlacement&&pg(jr)&&(It.vertical=P6(zt,s,u,p,mt,Un,Se,bt,zr,Ie,Ot,Tu.vertical,!0,vt,Xe,A))};if(!ke&&Ft){const zr=ln==="auto"?Ft.map(Yr=>U6(Yr)):[ln];let qr=!1;for(let Yr=0;Yr<zr.length;Yr++){const fi=zr[Yr];if(!It.horizontal[fi])if(qr)It.horizontal[fi]=It.horizontal[0];else{const _r=P6(zt,s,u,p,mt,Un,Se,"center",fi,Ie,Ot,Tu.horizontal,!1,vt,Xe,A);_r&&(It.horizontal[fi]=_r,qr=_r.positionedLines.length===1)}}Yn("left")}else{if(ln==="auto"&&(ln=U6(bt)),un||D.get("text-writing-mode").indexOf("horizontal")>=0||!pg(jr)){const zr=P6(zt,s,u,p,mt,Un,Se,bt,ln,Ie,Ot,Tu.horizontal,!1,vt,Xe,A);zr&&(It.horizontal[ln]=zr)}Yn(un?"left":ln)}}let Lt,yt,gt,Dt,tn,$t,Bn=!1;const pn=D.get("icon-text-fit").evaluate($e,{},_);if($e.icon&&$e.icon.hasPrimary()){const jr=ww($e.icon,c.iconSizeData,z["icon-size"],_,c.zoom,$e,A,V.iconScaleFactor,O);Lt=jr.iconPrimary,gt=jr.iconSecondary;const hs=Lt.toString();if(yt=h.get(hs),yt&&(tn=D.get("icon-offset").evaluate($e,{},_),$t=D.get("icon-anchor").evaluate($e,{},_),Bt=JS(p.get(hs),gt?p.get(gt.toString()):void 0,tn,$t),Bn=yt.sdf,c.sdfIcons===void 0?c.sdfIcons=yt.sdf:c.sdfIcons!==yt.sdf&&Qt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(yt.pixelRatio!==c.pixelRatio||D.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0)),gt){const Se=gt.toString();Dt=h.get(Se)}}Pe=Pe||!(!$e.icon||!$e.icon.hasSecondary());const xn=i3(It.horizontal)||It.vertical;c.iconsInText||(c.iconsInText=!!xn&&xn.iconsInText);const Rn=vt*V.textScaleFactor/So,{defaultShapedIcon:Jr,verticallyShapedIcon:Zt}=Bae(c,Bt,D,$e,_,It,Rn,tn,pn);pn!=="none"&&Bt&&(G7(Bt)||q7(Bt))&&(r3(0,yt,Lt,Bt,Jr,pn,R,h,p),r3(0,Dt,gt,Bt,Jr,pn,R,h,p),Zt&&(r3(0,yt,Lt,Bt,Zt,pn,R,h,p),r3(0,Dt,gt,Bt,Zt,pn,R,h,p))),Bt=Jr;const{iconBBox:Pn,iconVerticalBBox:Or,textBBox:gi,textVerticalBBox:Ei}=Lae(c,Bt,Zt,D,$e,_,kt,tn,V,p,$t,It,vt,Ot);Be.push({feature:$e,shapedTextOrientations:It,shapedText:xn,shapedIcon:Bt,iconPrimary:Lt,iconSecondary:gt,iconOffset:tn,iconAnchor:$t,verticallyShapedIcon:Zt,layoutTextSize:vt,layoutIconSize:kt,textOffset:Ot,isSDFIcon:Bn,iconTextFit:pn,iconCollisionBounds:Pn,iconVerticalCollisionBounds:Or,textCollisionBounds:gi,textVerticalCollisionBounds:Ei})}return{featureData:Be,sizes:V,hasAnySecondaryIcon:Pe,textAlongLine:ke,symbolPlacement:ge}},i.fx=e9,i.fy=function(c,s,u,h,p,_,v,w,A,R){c.iconAtlasPositions=R.iconPositions;const{featureData:O,hasAnySecondaryIcon:D,sizes:z,textAlongLine:V,symbolPlacement:H}=s;for(const K of O){const{shapedIcon:re,verticallyShapedIcon:ne,feature:ue,shapedTextOrientations:he,shapedText:ge,layoutTextSize:ke,textOffset:Ee,isSDFIcon:Pe,iconPrimary:Be,iconSecondary:$e,iconTextFit:mt,iconOffset:Xe,iconCollisionBounds:vt,iconVerticalCollisionBounds:kt,textCollisionBounds:It}=K;l9(re,R.iconPositions,Be,$e),l9(ne,R.iconPositions,Be,$e),Fae(he,R.iconPositions),zae(Be,$e,R.iconPositions),(ge||re)&&jae(c,ue,he,re,ne,A,z,ke,0,Ee,Pe,h,p,v,w,D,mt,Xe,V,H,vt,kt,It)}u&&c.generateCollisionDebugBuffers(_,c.collisionBoxArray,z.textScaleFactor)},i.fz=it,i.g=function(c,s){return Lf(Object.assign(c,{method:"GET"}),s)},i.h=function(c){return c.indexOf("mapbox:")===0},i.i=function(c){return ri.API_STYLE_REGEX.test(c)&&!Ro(c)},i.j=ca,i.k=Yc,i.l=function(c){return decodeURIComponent(atob(c).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.m=function(c,s){return Lf(Object.assign(c,{type:"json"}),s)},i.n=ay,i.o=To,i.p=function(c,s){return Lf(Object.assign(c,{method:"POST"}),s)},i.q=ll,i.r=Wc,i.s=function(c){try{const s=self[c];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=function(){return d6||(d6=new Rg("ImageRasterizer")),d6},i.u=function(){return function c(s){return s?(s^Math.random()*(16>>s/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},i.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},i.w=Qt,i.x=i5,i.y=W0,i.z=Kc}),l(["./shared"],function(i){function y(Ye){const ee=Ye?Ye.url.toString():void 0;return ee?performance.getEntriesByName(ee):[]}function x(Ye){if(typeof Ye=="number"||typeof Ye=="boolean"||typeof Ye=="string"||Ye==null)return JSON.stringify(Ye);if(Array.isArray(Ye)){let le="[";for(const ye of Ye)le+=`${x(ye)},`;return`${le}]`}let ee="{";for(const le of Object.keys(Ye).sort())ee+=`${le}:${x(Ye[le])},`;return`${ee}}`}function S(Ye){let ee="";for(const le of i.bx)ee+=`/${x(Ye[le])}`;return ee}class C{constructor(ee){this.keyCache={},this._layers={},this._layerConfigs={},ee&&this.replace(ee)}replace(ee,le){this._layerConfigs={},this._layers={},this.update(ee,[],le)}update(ee,le,ye){this._options=ye;for(const Me of ee)this._layerConfigs[Me.id]=Me,(this._layers[Me.id]=i.du(Me,this.scope,null,this._options)).compileFilter(ye),this.keyCache[Me.id]&&delete this.keyCache[Me.id];for(const Me of le)delete this.keyCache[Me],delete this._layerConfigs[Me],delete this._layers[Me];this.familiesBySource={};const Ne=function(Me,Ve){const tt={};for(let at=0;at<Me.length;at++){const Mt=Me[at];let xt=Ve&&Ve[Mt.id];xt||(Mt.type==="symbol"?xt=Mt.id:(xt=S(Mt),Mt.type==="line"&&Mt.paint&&function Mn(Qt){return typeof Qt=="string"&&Qt==="line-progress"||(Array.isArray(Qt)?Qt.some(Mn):!(!Qt||typeof Qt!="object")&&Object.values(Qt).some(Mn))}(Mt.paint["line-width"])&&(xt+=`/${x(Mt.paint["line-width"])}`))),Ve&&(Ve[Mt.id]=xt);let dn=tt[xt];dn||(dn=tt[xt]=[]),dn.push(Mt)}const Ze=[];for(const at in tt)Ze.push(tt[at]);return Ze}(Object.values(this._layerConfigs),this.keyCache);for(const Me of Ne){const Ve=Me.map(dn=>this._layers[dn.id]),tt=Ve[0];if(tt.visibility==="none")continue;const Ze=tt.source||"";let at=this.familiesBySource[Ze];at||(at=this.familiesBySource[Ze]={});const Mt=tt.sourceLayer||"_geojsonTileLayer";let xt=at[Mt];xt||(xt=at[Mt]=[]),xt.push(Ve)}}}const P=1*i.fl;class L{constructor(ee){const le={},ye=[];for(const tt in ee){const Ze=ee[tt],at=le[tt]={};for(const Mt in Ze.glyphs){const xt=Ze.glyphs[+Mt];if(!xt||xt.bitmap.width===0||xt.bitmap.height===0)continue;const dn=xt.metrics.localGlyph?P:1,Mn={x:0,y:0,w:xt.bitmap.width+2*dn,h:xt.bitmap.height+2*dn};ye.push(Mn),at[Mt]=Mn}}const{w:Ne,h:Me}=i.G(ye),Ve=new i.fk({width:Ne||1,height:Me||1});for(const tt in ee){const Ze=ee[tt];for(const at in Ze.glyphs){const Mt=Ze.glyphs[+at];if(!Mt||Mt.bitmap.width===0||Mt.bitmap.height===0)continue;const xt=le[tt][at],dn=Mt.metrics.localGlyph?P:1;i.fk.copy(Mt.bitmap,Ve,{x:0,y:0},{x:xt.x+dn,y:xt.y+dn},Mt.bitmap)}}this.image=Ve,this.positions=le}}function F(Ye,ee,le){Ye[ee]?le&&(Ye[ee].center=le):Ye[ee]={floorIds:new Set,center:le||[0,0],floors:{}}}function U(Ye,ee,le,ye){for(const Ne of ee)F(Ye,Ne),Ye[Ne].floors[le]=ye,Ye[Ne].floorIds.add(le)}function q(Ye){return{id:Ye.properties.id.toString(),center:Ye.properties.center.toString().split(";").map(Number)}}function G(Ye){return{id:Ye.properties.id.toString(),isDefault:!!Ye.properties.is_default&&Ye.properties.is_default,connections:Ye.properties.connected_floor_ids?new Set(Ye.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Ye.properties.conflicted_floor_ids?new Set(Ye.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Ye.properties.building_ids?new Set(Ye.properties.building_ids.toString().split(";")):new Set,name:Ye.properties.name.toString(),zIndex:Ye.properties.z_index}}function $(Ye,ee){return ee.every(le=>Ye.properties&&Ye.properties[le]!=null)}function X(Ye){return $(Ye,["type","id","name"])&&Ye.properties.type==="building"}function ie(Ye){return $(Ye,["type","id","name","z_index"])&&Ye.properties.type==="floor"}i.fj(L,"GlyphAtlas");class de{constructor(ee){this.tileID=new i.aQ(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.lut=ee.lut,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.scope=ee.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.request&&ee.request.collectResourceTiming,this.promoteId=ee.promoteId,this.isSymbolTile=ee.isSymbolTile,this.tileTransform=i.aZ(ee.tileID.canonical,ee.projection),this.projection=ee.projection,this.worldview=ee.worldview,this.localizableLayerIds=ee.localizableLayerIds,this.brightness=ee.brightness,this.extraShadowCaster=!!ee.extraShadowCaster,this.tessellationStep=ee.tessellationStep,this.scaleFactor=ee.scaleFactor,this.worldview=ee.worldview,this.indoor=ee.indoor}parse(ee,le,ye,Ne,Me,Ve){this.status="parsing",this.data=ee,this.collisionBoxArray=new i.b3;const tt=new i.fm(Object.keys(ee.layers).sort()),Ze=new i.fn(this.tileID,this.promoteId);Ze.bucketLayerIDs=[];const at={},Mt=new i.fo(256,256),xt={featureIndex:Ze,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Mt,availableImages:ye,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Ar=this.indoor.indoorState.activeFloorsVisible,lr=function(Er,ni,Ms){const as=function(Hi,$r){if(!Hi)return i.w("No source layers defined in indoor specification"),$r;if(Hi.size===0)return $r;const Ps=Hi.difference($r);for(const Ji of Ps)i.w(`Missing source layer required in indoor specification: ${Ji}`);return $r.intersection($r)}(ni.sourceLayers,new Set(Object.keys(Er.layers))),Qi=ni.indoorState,vs=function(Hi,$r,Ps,Ji){const ri=new Set,ca=new Set,Ro=new Set,jo=new Map,wo={},ju=po=>{const gu=jo.get(po)||new Set;for(const _l of ri)if((jo.get(_l)||new Set).has(po)||gu.has(_l))return!0;return!1};for(const po of $r){const gu=Hi.layers[po];if(gu)for(let _l=0;_l<gu.length;_l++){const Wc=gu.feature(_l);if(X(Wc)){const{id:To,center:Mf}=q(Wc);F(wo,To,Mf),ri.add(To)}else if(ie(Wc)){const{id:To,isDefault:Mf,connections:Vp,conflicts:ey,buildings:ty,name:ny,zIndex:$0}=G(Wc);U(wo,ty,To,{name:ny,zIndex:$0}),jo.set(To,ey),(To===Ji||Vp.has(Ji))&&ri.add(To),ca.add(To),Mf&&Ro.add(To)}}else i.w(`indoor source layer not found: ${po}`)}if(Ps)for(const po of Ps)ca.has(po)&&(ju(po)||ri.add(po));for(const po of Ro)ri.has(po)||ju(po)||ri.add(po);return{buildings:wo,activeFloors:ri}}(Er,as,Qi.lastActiveFloors,Qi.selectedFloorId);return Ms.send("setIndoorData",vs),vs}(ee,this.indoor,Me);xt.activeFloors=Ar?lr.activeFloors:void 0}const dn=[],Mn=le.familiesBySource[this.source];for(const Ar in Mn){const lr=ee.layers[Ar];if(!lr)continue;let Er=!1,ni=!1,Ms=!1;for(const $r of Mn[Ar])$r[0].type==="symbol"?Er=!0:ni=!0,$r[0].is3D()&&$r[0].type!=="model"&&(Ms=!0);if(this.extraShadowCaster&&!Ms||this.isSymbolTile===!0&&!Er||this.isSymbolTile===!1&&!ni)continue;lr.version===1&&i.w(`Vector tile source "${this.source}" layer "${Ar}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const as=tt.encode(Ar),Qi=[],vs=this.localizableLayerIds&&this.localizableLayerIds.has(Ar);let Hi=!1;for(let $r=0,Ps=0;$r<lr.length;$r++){const Ji=lr.feature($r),ri=Ze.getId(Ji,Ar),ca=Ji.properties?Ji.properties.worldview:null;if(vs&&this.worldview&&typeof ca=="string")if(ca==="all")Ji.properties.$localized=!0;else{if(!ca.split(",").includes(this.worldview))continue;Ji.properties.$localized=!0,Ji.properties.worldview=this.worldview}!Hi&&Ji.properties&&Ji.properties.hasOwnProperty(i.fp)&&(Hi=!0),Qi.push({feature:Ji,id:ri,index:Ps,sourceLayerIndex:as}),Ps++}Hi&&!xt.elevationFeatures&&ee.layers.hasOwnProperty(i.fq)&&(xt.elevationFeatures=i.fr.parseFrom(ee.layers[i.fq],this.canonical));for(const $r of Mn[Ar]){const Ps=$r[0];if(this.extraShadowCaster&&(!Ps.is3D()||Ps.type==="model")||this.isSymbolTile!==void 0&&Ps.type==="symbol"!==this.isSymbolTile||Ps.minzoom&&this.zoom<Math.floor(Ps.minzoom)||Ps.maxzoom&&this.zoom>=Ps.maxzoom||Ps.visibility==="none")continue;fe($r,this.zoom,xt.brightness,ye,this.worldview);const Ji=at[Ps.id]=Ps.createBucket({index:Ze.bucketLayerIDs.length,layers:$r,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:as,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ne,worldview:this.worldview,localizable:vs});Ze.bucketLayerIDs.push($r.map(ca=>i.B(ca.id,ca.scope)));let ri=Ji.prepare?Ji.prepare():null;ri!=null?(ri=ri.then(()=>Ji.populate(Qi,xt,this.tileID.canonical,this.tileTransform)),dn.push(ri)):Ji.populate(Qi,xt,this.tileID.canonical,this.tileTransform)}}const Qt=()=>{let Ar,lr,Er,ni,Ms,as;Mt.trim();const Qi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},vs=()=>{if(Ar)return this.status="done",Ve(Ar);if(this.extraShadowCaster)this.status="done",Ve(null,{buckets:Object.values(at).filter($r=>!$r.isEmpty()),featureIndex:Ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:xt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(lr&&Er&&ni){const $r=new L(lr),Ps=new Map;for(const[ca,Ro]of Er.entries()){const{imagePosition:jo}=i.fu(ca,Ro,i.fv);Ps.set(ca,jo)}const Ji={};for(const ca in at){const Ro=at[ca];Ro instanceof i.b4&&(fe(Ro.layers,this.zoom,xt.brightness,ye,this.worldview),Ji[ca]=i.fw(Ro,lr,$r.positions,Er,Ps,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Ms,this.worldview))}const ri={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Me,Er,Ms,()=>{ri.iconsPending=!1,Hi(Ji,$r,ri)}),this.rasterizeIfNeeded(Me,ni,as,()=>{ri.patternsPending=!1,Hi(Ji,$r,ri)})}},Hi=($r,Ps,Ji,ri)=>{if(Ji.iconsPending||Ji.patternsPending)return;const ca=new i.fx(Er,ni,this.lut);for(const Ro in at){const jo=at[Ro];if(Ro in $r)i.fy(jo,$r[Ro],this.showCollisionBoxes,ye,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Er,ca);else if(jo.hasPattern&&(jo instanceof i.ba||jo instanceof i.bb||jo instanceof i.ea)){fe(jo.layers,this.zoom,xt.brightness,ye,this.worldview);const wo=Object.fromEntries(ca.patternPositions);jo.addFeatures(xt,this.tileID.canonical,wo,ye,this.tileTransform,this.brightness)}}this.status="done",Ve(null,{buckets:Object.values(at).filter(Ro=>!Ro.isEmpty()),featureIndex:Ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ps.image,lineAtlas:Mt,imageAtlas:ca,brightness:xt.brightness})};if(!this.extraShadowCaster){const $r=i.fs(xt.glyphDependencies,ri=>Object.keys(ri).map(Number));Object.keys($r).length?Me.send("getGlyphs",{uid:this.uid,stacks:$r},(ri,ca)=>{Ar||(Ar=ri,lr=ca,vs())},void 0,!1,Qi):lr={};const Ps=Array.from(xt.iconDependencies.keys()).map(ri=>i.I.parse(ri));Ps.length?Me.send("getImages",{images:Ps,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ri,ca)=>{Ar||(Ar=ri,Er=new Map,Ms=this.updateImageMapAndGetImageTaskQueue(Er,ca,xt.iconDependencies),vs())},void 0,!1,Qi):(Er=new Map,Ms=new Map);const Ji=Array.from(xt.patternDependencies.keys()).map(ri=>i.I.parse(ri));Ji.length?Me.send("getImages",{images:Ji,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ri,ca)=>{Ar||(Ar=ri,ni=new Map,as=this.updateImageMapAndGetImageTaskQueue(ni,ca,xt.patternDependencies),vs())},void 0,!1,Qi):(ni=new Map,as=new Map)}if(xt.elevationFeatures&&xt.elevationFeatures.length>0){const $r=[];for(const Ji of Object.values(at))if(Ji instanceof i.bb){const ri=Ji.getUnevaluatedPortalGraph();ri&&$r.push(ri)}const Ps=i.ft.evaluate($r);for(const Ji of Object.values(at))if(Ji instanceof i.bb){const ri=ee.layers[tt.decode(Ji.sourceLayerIndex)];Ji.setEvaluatedPortalGraph(Ps,ri,this.tileID.canonical,xt.availableImages,xt.brightness)}}vs()};dn.length>0?Promise.allSettled(dn).then(Qt).catch(Ve):Qt()}updateParameters(ee){this.scaleFactor=ee.scaleFactor,this.showCollisionBoxes=ee.showCollisionBoxes,this.projection=ee.projection,this.brightness=ee.brightness,this.tileTransform=i.aZ(ee.tileID.canonical,ee.projection),this.extraShadowCaster=ee.extraShadowCaster,this.lut=ee.lut,this.worldview=ee.worldview,this.indoor=ee.indoor}rasterizeIfNeeded(ee,le,ye,Ne){Array.from(le.values()).some(Me=>Me.usvg)?this.rasterize(ee,le,ye,Ne):Ne()}updateImageMapAndGetImageTaskQueue(ee,le,ye){const Ne=new Map;for(const Me of le.keys()){const Ve=ye.get(Me)||[];for(const tt of Ve){const Ze=tt.toString(),at=le.get(tt.id.toString());at.usvg?Ne.has(Ze)||(Ne.set(Ze,tt),ee.set(Ze,Object.assign({},at))):ee.set(Ze,at)}}return Ne}rasterize(ee,le,ye,Ne){this.rasterizeTask=ee.send("rasterizeImages",{scope:this.scope,tasks:ye},(Me,Ve)=>{if(!Me)for(const[tt,Ze]of Ve.entries()){const at=Object.assign(le.get(tt),{data:Ze});le.set(tt,at)}Ne()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function fe(Ye,ee,le,ye,Ne){const Me=new i.ac(ee,{brightness:le,worldview:Ne});for(const Ve of Ye)Ve.recalculate(Me,ye)}class be extends i.E{constructor(ee,le,ye,Ne,Me,Ve,tt){super(),this.actor=ee,this.layerIndex=le,this.availableImages=ye,this.availableModels=Ne,this.loadVectorData=Ve||i.aL,this.loading={},this.loaded={},this.deduped=new i.aK(ee.scheduler),this.isSpriteLoaded=Me,this.scheduler=ee.scheduler,this.brightness=tt}loadTile(ee,le){const ye=ee.uid,Ne=ee&&ee.request,Me=Ne&&Ne.collectResourceTiming,Ve=this.loading[ye]=new de(ee);Ve.abort=this.loadVectorData(ee,(tt,Ze)=>{const at=!this.loading[ye];if(delete this.loading[ye],Ve.cancelRasterize(),at||tt||!Ze)return Ve.status="done",at||(this.loaded[ye]=Ve),le(tt);const Mt=Ze.rawData,xt={},dn=i.aM(Ze.responseHeaders);dn&&dn.expires&&(xt.expires=dn.expires),dn&&dn.cacheControl&&(xt.cacheControl=dn.cacheControl),Ve.vectorTile=Ze.vectorTile||new i.fz(new i.bt(Mt));const Mn=()=>{Ve.parse(Ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Qt,Ar)=>{if(Qt||!Ar)return le(Qt);const lr={};if(Me){const Er=y(Ne);Er.length>0&&(lr.resourceTiming=JSON.parse(JSON.stringify(Er)))}le(null,Object.assign({rawTileData:Mt.slice(0),responseHeaders:Ze.responseHeaders},Ar,xt,lr))})};this.isSpriteLoaded?Mn():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Mn,{type:"parseTile",isSymbolTile:ee.isSymbolTile,zoom:ee.tileZoom}):Mn()}),this.loaded=this.loaded||{},this.loaded[ye]=Ve})}reloadTile(ee,le){const ye=this.loaded,Ne=ee.uid;if(ye&&ye[Ne]){const Me=ye[Ne];Me.updateParameters(ee);const Ve=(tt,Ze)=>{const at=Me.reloadCallback;at&&(delete Me.reloadCallback,Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,at)),le(tt,Ze)};Me.status==="parsing"?Me.reloadCallback=Ve:Me.status==="done"&&(Me.vectorTile?Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ve):Ve())}else le(null,void 0)}abortTile(ee,le){const ye=ee.uid,Ne=this.loading[ye];Ne&&(Ne.abort&&Ne.abort(),delete this.loading[ye]),le()}removeTile(ee,le){const ye=this.loaded,Ne=ee.uid;ye&&ye[Ne]&&delete ye[Ne],le()}}class ve{loadTile(ee,le){const{uid:ye,encoding:Ne,rawImageData:Me,padding:Ve}=ee,tt=ImageBitmap&&Me instanceof ImageBitmap?this.getImageData(Me,Ve):Me;le(null,new i.fA(ye,tt,Ne,Ve<1))}reloadTile(ee,le){le(null,null)}abortTile(ee,le){le()}removeTile(ee,le){le()}getImageData(ee,le){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ee.width,ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ee.width,this.offscreenCanvas.height=ee.height,this.offscreenCanvasContext.drawImage(ee,0,0,ee.width,ee.height);const ye=this.offscreenCanvasContext.getImageData(-le,-le,ee.width+2*le,ee.height+2*le);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ye}}i.bs.setPbf(i.bt);class Je{constructor(ee){this._mrt=new i.bs(ee.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ee.uid,this.tileID=ee.tileID,this.source=ee.source}parse(ee,le){const ye=this._mrt;this.status="parsing",this._entireBuffer=ee;try{ye.parseHeader(ee),this._isHeaderLoaded=!0;const Ne=[];for(const Me in ye.layers){const Ve=ye.getLayer(Me),tt=Ve.getDataRange(Ve.getBandList()),Ze=ye.createDecodingTask(tt),at=ee.slice(tt.firstByte,tt.lastByte+1),Mt=i.bs.performDecoding(at,Ze).then(xt=>Ze.complete(null,xt)).catch(xt=>Ze.complete(xt,null));Ne.push(Mt)}Promise.allSettled(Ne).then(()=>le(null,ye)).catch(Me=>le(Me))}catch(Ne){le(Ne)}}}class we{constructor(ee){this.actor=ee,this.loading={},this.loaded={}}loadTile(ee,le){const ye=ee.uid,Ne=ee.request,Me=this.loading[ye]=new Je(ee),{cancel:Ve}=i.bu(Ne,(tt,Ze,at)=>{const Mt=!this.loading[ye];if(delete this.loading[ye],Mt||tt||!Ze)return Me.status="done",Mt||(this.loaded[ye]=Me),le(tt);Me.parse(Ze,(xt,dn)=>{if(xt||!dn)return le(xt);le(null,dn,at)}),this.loaded[ye]=Me});Me.abort=Ve}reloadTile(ee,le){le(null,void 0)}abortTile(ee,le){const ye=ee.uid,Ne=this.loading[ye];Ne&&(Ne.abort&&Ne.abort(),delete this.loading[ye]),le()}removeTile(ee,le){const ye=ee.uid;this.loaded[ye]&&delete this.loaded[ye],le()}decodeRasterArray(ee,le){i.bs.performDecoding(ee.buffer,ee.task).then(ye=>le(null,ye)).catch(ye=>le(ye))}}const rt=i.fB.prototype.toGeoJSON;class He{constructor(ee){this._feature=ee,this.extent=i.al,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))}loadGeometry(){if(this._feature.type===1){const ee=[];for(const le of this._feature.geometry)ee.push([new i.P(le[0],le[1])]);return ee}{const ee=[];for(const le of this._feature.geometry){const ye=[];for(const Ne of le)ye.push(new i.P(Ne[0],Ne[1]));ee.push(ye)}return ee}}toGeoJSON(ee,le,ye){return rt.call(this,ee,le,ye)}}class ft{constructor(ee,le){this.name=ee,this.extent=i.al,this.length=le.length,this._jsonFeatures=le}feature(ee){return new He(this._jsonFeatures[ee])}}class Ct{constructor(ee){this.layers={},this.extent=i.al;for(const le of Object.keys(ee))this.layers[le]=new ft(le,ee[le])}}const Nt=64/4096,Rt=128;class en{constructor(){this.features=new Map}clear(){this.features.clear()}load(ee=[],le){for(const ye of ee){const Ne=ye.id;if(Ne==null)continue;let Me=this.features.get(Ne);Me&&this.updateCache(Me,le),ye.geometry?(Me=pt(ye),this.updateCache(Me,le),this.features.set(Ne,Me)):this.features.delete(Ne),this.updateCache(Me,le)}}updateCache(ee,le){for(const{canonical:ye,uid:Ne}of Object.values(le)){const{z:Me,x:Ve,y:tt}=ye;nt(ee,Math.pow(2,Me),Ve,tt)&&delete le[Ne]}}getTile(ee,le,ye){const Ne=Math.pow(2,ee),Me=[];for(const Ve of this.features.values())nt(Ve,Ne,le,ye)&&Me.push(Fe(Ve,Ne,le,ye));return{features:Me}}getFeatures(){return[...this.features.values()]}}function nt({minX:Ye,minY:ee,maxX:le,maxY:ye},Ne,Me,Ve){return Ye<(Me+1+Nt)/Ne&&ee<(Ve+1+Nt)/Ne&&le>(Me-Nt)/Ne&&ye>(Ve-Nt)/Ne}function pt(Ye){const{id:ee,geometry:le,properties:ye}=Ye;if(!le)return;if(le.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ne,coordinates:Me}=le,Ve={id:ee,type:1,geometry:[],tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},tt=Ve.geometry;if(Ne==="Point")Oe(Me,tt,Ve);else if(Ne==="MultiPoint")for(const Ze of Me)Oe(Ze,tt,Ve);else if(Ne==="LineString")Ve.type=2,gn(Me,tt,Ve);else if(Ne==="MultiLineString")Ve.type=2,wt(Me,tt,Ve);else if(Ne==="Polygon")Ve.type=3,wt(Me,tt,Ve,!0);else{if(Ne!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ve.type=3;for(const Ze of Me)wt(Ze,tt,Ve,!0)}return Ve}function Oe([Ye,ee],le,ye){const Ne=i.aF(Ye);let Me=i.aJ(ee);Me=Me<0?0:Me>1?1:Me,le.push(Ne,Me),ye.minX=Math.min(ye.minX,Ne),ye.minY=Math.min(ye.minY,Me),ye.maxX=Math.max(ye.maxX,Ne),ye.maxY=Math.max(ye.maxY,Me)}function gn(Ye,ee,le,ye=!1,Ne=!1){const Me=[];for(const Ve of Ye)Oe(Ve,Me,le);ee.push(Me),ye&&function(Ve,tt){let Ze=0;for(let at=0,Mt=Ve.length,xt=Mt-2;at<Mt;xt=at,at+=2)Ze+=(Ve[at]-Ve[xt])*(Ve[at+1]+Ve[xt+1]);if(Ze>0===tt)for(let at=0,Mt=Ve.length;at<Mt/2;at+=2){const xt=Ve[at],dn=Ve[at+1];Ve[at]=Ve[Mt-2-at],Ve[at+1]=Ve[Mt-1-at],Ve[Mt-2-at]=xt,Ve[Mt-1-at]=dn}}(Me,Ne)}function wt(Ye,ee,le,ye=!1){for(let Ne=0;Ne<Ye.length;Ne++)gn(Ye[Ne],ee,le,ye,Ne===0)}function Fe(Ye,ee,le,ye){const{id:Ne,type:Me,geometry:Ve,tags:tt}=Ye,Ze=[];if(Me===1)(function(at,Mt,xt,dn,Mn){for(let Qt=0;Qt<at.length;Qt+=2){const Ar=Math.round(i.al*(at[Qt+0]*Mt-xt)),lr=Math.round(i.al*(at[Qt+1]*Mt-dn));Mn.push([Ar,lr])}})(Ve,ee,le,ye,Ze);else if(Me===2)for(const at of Ve)jt(at,ee,le,ye,Ze);else if(Me===3)for(const at of Ve)Tn(at,ee,le,ye,Ze);return{id:Ne,type:Me,geometry:Ze,tags:tt}}function jt(Ye,ee,le,ye,Ne){const Me=-Rt,Ve=i.al+Rt;let tt;for(let Ze=0;Ze<Ye.length-2;Ze+=2){let at=Math.round(i.al*(Ye[Ze+0]*ee-le)),Mt=Math.round(i.al*(Ye[Ze+1]*ee-ye)),xt=Math.round(i.al*(Ye[Ze+2]*ee-le)),dn=Math.round(i.al*(Ye[Ze+3]*ee-ye));const Mn=xt-at,Qt=dn-Mt;at<Me&&xt<Me||(at<Me?(Mt+=Math.round(Qt*((Me-at)/Mn)),at=Me):xt<Me&&(dn=Mt+Math.round(Qt*((Me-at)/Mn)),xt=Me),Mt<Me&&dn<Me||(Mt<Me?(at+=Math.round(Mn*((Me-Mt)/Qt)),Mt=Me):dn<Me&&(xt=at+Math.round(Mn*((Me-Mt)/Qt)),dn=Me),at>=Ve&&xt>=Ve||(at>=Ve?(Mt+=Math.round(Qt*((Ve-at)/Mn)),at=Ve):xt>=Ve&&(dn=Mt+Math.round(Qt*((Ve-at)/Mn)),xt=Ve),Mt>=Ve&&dn>=Ve||(Mt>=Ve?(at+=Math.round(Mn*((Ve-Mt)/Qt)),Mt=Ve):dn>=Ve&&(xt=at+Math.round(Mn*((Ve-Mt)/Qt)),dn=Ve),tt&&at===tt[tt.length-1][0]&&Mt===tt[tt.length-1][1]||(tt=[[at,Mt]],Ne.push(tt)),tt.push([xt,dn])))))}}function Tn(Ye,ee,le,ye,Ne){const Me=(le-Nt)/ee,Ve=(ye-Nt)/ee,tt=(le+1+Nt)/ee,Ze=(ye+1+Nt)/ee;function at(dn,Mn){let Qt=0;return dn<Me?Qt|=1:dn>tt&&(Qt|=2),Mn<Ve?Qt|=4:Mn>Ze&&(Qt|=8),Qt}let Mt=[];for(let dn=1;dn<=8;dn*=2){let Mn=Ye[Ye.length-2],Qt=Ye[Ye.length-1],Ar=!(at(Mn,Qt)&dn);for(let lr=0;lr<Ye.length;lr+=2){const Er=Ye[lr],ni=Ye[lr+1],Ms=!(at(Er,ni)&dn);Ms!==Ar&&(8&dn?Mt.push(Mn+(Er-Mn)*(Ze-Qt)/(ni-Qt),Ze):4&dn?Mt.push(Mn+(Er-Mn)*(Ve-Qt)/(ni-Qt),Ve):2&dn?Mt.push(tt,Qt+(ni-Qt)*(tt-Mn)/(Er-Mn)):1&dn&&Mt.push(Me,Qt+(ni-Qt)*(Me-Mn)/(Er-Mn))),Ms&&Mt.push(Er,ni),Mn=Er,Qt=ni,Ar=Ms}if(!(Ye=Mt).length||dn===8)break;Mt=[]}const xt=[];for(let dn=0;dn<Mt.length;dn+=2)xt.push([Math.round(i.al*(Mt[dn]*ee-le)),Math.round(i.al*(Mt[dn+1]*ee-ye))]);Ne.push(xt)}function mn({name:Ye,features:ee},le){le.writeStringField(1,Ye),le.writeVarintField(5,i.al);const ye=new Map,Ne=new Map,Me={keys:ye,values:Ne,feature:null};for(const Ve of ee)Me.feature=Ve,le.writeMessage(2,zn,Me);for(const Ve of ye.keys())le.writeStringField(3,Ve);for(const Ve of Ne.keys())le.writeMessage(4,Xn,Ve)}function zn(Ye,ee){const le=Ye.feature;le.id!==void 0&&Number.isSafeInteger(+le.id)&&ee.writeVarintField(1,+le.id),le.tags&&ee.writeMessage(2,yn,Ye),ee.writeVarintField(3,le.type),ee.writeMessage(4,Sn,le)}function yn({keys:Ye,values:ee,feature:le},ye){for(const Ne of Object.keys(le.tags)){let Me=le.tags[Ne];if(Me===null)continue;let Ve=Ye.get(Ne);Ve===void 0&&(Ve=Ye.size,Ye.set(Ne,Ve)),ye.writeVarint(Ve);const tt=typeof Me;tt!=="string"&&tt!=="boolean"&&tt!=="number"&&(Me=JSON.stringify(Me));let Ze=ee.get(Me);Ze===void 0&&(Ze=ee.size,ee.set(Me,Ze)),ye.writeVarint(Ze)}}function qt(Ye,ee){return(ee<<3)+(7&Ye)}function wn(Ye){return Ye<<1^Ye>>31}function Sn(Ye,ee){const{geometry:le,type:ye}=Ye;let Ne=0,Me=0;if(ye===1){ee.writeVarint(qt(1,le.length));for(const Ve of le){const tt=Ve[0]-Ne,Ze=Ve[1]-Me;ee.writeVarint(wn(tt)),ee.writeVarint(wn(Ze)),Ne+=tt,Me+=Ze}}else for(const Ve of le){ee.writeVarint(qt(1,1));const tt=Ve.length-(ye===3?1:0);for(let Ze=0;Ze<tt;Ze++){Ze===1&&ee.writeVarint(qt(2,tt-1));const at=Ve[Ze][0]-Ne,Mt=Ve[Ze][1]-Me;ee.writeVarint(wn(at)),ee.writeVarint(wn(Mt)),Ne+=at,Me+=Mt}ye===3&&ee.writeVarint(qt(7,1))}}function Xn(Ye,ee){const le=typeof Ye;le==="string"?ee.writeStringField(1,Ye):le==="boolean"?ee.writeBooleanField(7,Ye):le==="number"&&(Ye%1!=0?ee.writeDoubleField(3,Ye):Ye<0?ee.writeSVarintField(6,Ye):ee.writeVarintField(5,Ye))}const rn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ye=>Ye},br=Math.fround||(Qr=new Float32Array(1),Ye=>(Qr[0]=+Ye,Qr[0]));var Qr;const sr=3,ar=5,Vn=6;class wr{constructor(ee){this.options=Object.assign(Object.create(rn),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:le,minZoom:ye,maxZoom:Ne}=this.options;le&&console.time("total time");const Me=`prepare ${ee.length} points`;le&&console.time(Me),this.points=ee;const Ve=[];for(let Ze=0;Ze<ee.length;Ze++){const at=ee[Ze];if(!at.geometry)continue;const[Mt,xt]=at.geometry.coordinates,dn=br(Ri(Mt)),Mn=br(ks(xt));Ve.push(dn,Mn,1/0,Ze,-1,1),this.options.reduce&&Ve.push(0)}let tt=this.trees[Ne+1]=this._createTree(Ve);le&&console.timeEnd(Me);for(let Ze=Ne;Ze>=ye;Ze--){const at=+Date.now();tt=this.trees[Ze]=this._createTree(this._cluster(tt,Ze)),le&&console.log("z%d: %d clusters in %dms",Ze,tt.numItems,+Date.now()-at)}return le&&console.timeEnd("total time"),this}getClusters(ee,le){let ye=((ee[0]+180)%360+360)%360-180;const Ne=Math.max(-90,Math.min(90,ee[1]));let Me=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const Ve=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)ye=-180,Me=180;else if(ye>Me){const xt=this.getClusters([ye,Ne,180,Ve],le),dn=this.getClusters([-180,Ne,Me,Ve],le);return xt.concat(dn)}const tt=this.trees[this._limitZoom(le)],Ze=tt.range(Ri(ye),ks(Ve),Ri(Me),ks(Ne)),at=tt.data,Mt=[];for(const xt of Ze){const dn=this.stride*xt;Mt.push(at[dn+ar]>1?ys(at,dn,this.clusterProps):this.points[at[dn+sr]])}return Mt}getChildren(ee){const le=this._getOriginId(ee),ye=this._getOriginZoom(ee),Ne="No cluster with the specified id.",Me=this.trees[ye];if(!Me)throw new Error(Ne);const Ve=Me.data;if(le*this.stride>=Ve.length)throw new Error(Ne);const tt=this.options.radius/(this.options.extent*Math.pow(2,ye-1)),Ze=Me.within(Ve[le*this.stride],Ve[le*this.stride+1],tt),at=[];for(const Mt of Ze){const xt=Mt*this.stride;Ve[xt+4]===ee&&at.push(Ve[xt+ar]>1?ys(Ve,xt,this.clusterProps):this.points[Ve[xt+sr]])}if(at.length===0)throw new Error(Ne);return at}getLeaves(ee,le,ye){const Ne=[];return this._appendLeaves(Ne,ee,le=le||10,ye=ye||0,0),Ne}getTile(ee,le,ye){const Ne=this.trees[this._limitZoom(ee)],Me=Math.pow(2,ee),{extent:Ve,radius:tt}=this.options,Ze=tt/Ve,at=(ye-Ze)/Me,Mt=(ye+1+Ze)/Me,xt={features:[]};return this._addTileFeatures(Ne.range((le-Ze)/Me,at,(le+1+Ze)/Me,Mt),Ne.data,le,ye,Me,xt),le===0&&this._addTileFeatures(Ne.range(1-Ze/Me,at,1,Mt),Ne.data,Me,ye,Me,xt),le===Me-1&&this._addTileFeatures(Ne.range(0,at,Ze/Me,Mt),Ne.data,-1,ye,Me,xt),xt.features.length?xt:null}getClusterExpansionZoom(ee){let le=this._getOriginZoom(ee)-1;for(;le<=this.options.maxZoom;){const ye=this.getChildren(ee);if(le++,ye.length!==1)break;ee=ye[0].properties.cluster_id}return le}_appendLeaves(ee,le,ye,Ne,Me){const Ve=this.getChildren(le);for(const tt of Ve){const Ze=tt.properties;if(Ze&&Ze.cluster?Me+Ze.point_count<=Ne?Me+=Ze.point_count:Me=this._appendLeaves(ee,Ze.cluster_id,ye,Ne,Me):Me<Ne?Me++:ee.push(tt),ee.length===ye)break}return Me}_createTree(ee){const le=new i.c4(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ye=0;ye<ee.length;ye+=this.stride)le.add(ee[ye],ee[ye+1]);return le.finish(),le.data=ee,le}_addTileFeatures(ee,le,ye,Ne,Me,Ve){for(const tt of ee){const Ze=tt*this.stride,at=le[Ze+ar]>1;let Mt,xt,dn;if(at)Mt=Si(le,Ze,this.clusterProps),xt=le[Ze],dn=le[Ze+1];else{const Ar=this.points[le[Ze+sr]];Mt=Ar.properties;const[lr,Er]=Ar.geometry.coordinates;xt=Ri(lr),dn=ks(Er)}const Mn={type:1,geometry:[[Math.round(this.options.extent*(xt*Me-ye)),Math.round(this.options.extent*(dn*Me-Ne))]],tags:Mt};let Qt;Qt=at||this.options.generateId?le[Ze+sr]:this.points[le[Ze+sr]].id,Qt!==void 0&&(Mn.id=Qt),Ve.features.push(Mn)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,le){const{radius:ye,extent:Ne,reduce:Me,minPoints:Ve}=this.options,tt=ye/(Ne*Math.pow(2,le)),Ze=ee.data,at=[],Mt=this.stride;for(let xt=0;xt<Ze.length;xt+=Mt){if(Ze[xt+2]<=le)continue;Ze[xt+2]=le;const dn=Ze[xt],Mn=Ze[xt+1],Qt=ee.within(Ze[xt],Ze[xt+1],tt),Ar=Ze[xt+ar];let lr=Ar;for(const Er of Qt){const ni=Er*Mt;Ze[ni+2]>le&&(lr+=Ze[ni+ar])}if(lr>Ar&&lr>=Ve){let Er,ni=dn*Ar,Ms=Mn*Ar,as=-1;const Qi=(xt/Mt<<5)+(le+1)+this.points.length;for(const vs of Qt){const Hi=vs*Mt;if(Ze[Hi+2]<=le)continue;Ze[Hi+2]=le;const $r=Ze[Hi+ar];ni+=Ze[Hi]*$r,Ms+=Ze[Hi+1]*$r,Ze[Hi+4]=Qi,Me&&(Er||(Er=this._map(Ze,xt,!0),as=this.clusterProps.length,this.clusterProps.push(Er)),Me(Er,this._map(Ze,Hi)))}Ze[xt+4]=Qi,at.push(ni/lr,Ms/lr,1/0,Qi,-1,lr),Me&&at.push(as)}else{for(let Er=0;Er<Mt;Er++)at.push(Ze[xt+Er]);if(lr>1)for(const Er of Qt){const ni=Er*Mt;if(!(Ze[ni+2]<=le)){Ze[ni+2]=le;for(let Ms=0;Ms<Mt;Ms++)at.push(Ze[ni+Ms])}}}}return at}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,le,ye){if(ee[le+ar]>1){const Ve=this.clusterProps[ee[le+Vn]];return ye?Object.assign({},Ve):Ve}const Ne=this.points[ee[le+sr]].properties,Me=this.options.map(Ne);return ye&&Me===Ne?Object.assign({},Me):Me}}function ys(Ye,ee,le){return{type:"Feature",id:Ye[ee+sr],properties:Si(Ye,ee,le),geometry:{type:"Point",coordinates:[(ye=Ye[ee],360*(ye-.5)),$i(Ye[ee+1])]}};var ye}function Si(Ye,ee,le){const ye=Ye[ee+ar],Ne=ye>=1e4?`${Math.round(ye/1e3)}k`:ye>=1e3?Math.round(ye/100)/10+"k":ye,Me=Ye[ee+Vn],Ve=Me===-1?{}:Object.assign({},le[Me]);return Object.assign(Ve,{cluster:!0,cluster_id:Ye[ee+sr],point_count:ye,point_count_abbreviated:Ne})}function Ri(Ye){return Ye/360+.5}function ks(Ye){const ee=Math.sin(Ye*Math.PI/180),le=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return le<0?0:le>1?1:le}function $i(Ye){const ee=(180-360*Ye)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}function Ws(Ye,ee,le,ye){let Ne=ye;const Me=ee+(le-ee>>1);let Ve,tt=le-ee;const Ze=Ye[ee],at=Ye[ee+1],Mt=Ye[le],xt=Ye[le+1];for(let dn=ee+3;dn<le;dn+=3){const Mn=Kt(Ye[dn],Ye[dn+1],Ze,at,Mt,xt);if(Mn>Ne)Ve=dn,Ne=Mn;else if(Mn===Ne){const Qt=Math.abs(dn-Me);Qt<tt&&(Ve=dn,tt=Qt)}}Ne>ye&&(Ve-ee>3&&Ws(Ye,ee,Ve,ye),Ye[Ve+2]=Ne,le-Ve>3&&Ws(Ye,Ve,le,ye))}function Kt(Ye,ee,le,ye,Ne,Me){let Ve=Ne-le,tt=Me-ye;if(Ve!==0||tt!==0){const Ze=((Ye-le)*Ve+(ee-ye)*tt)/(Ve*Ve+tt*tt);Ze>1?(le=Ne,ye=Me):Ze>0&&(le+=Ve*Ze,ye+=tt*Ze)}return Ve=Ye-le,tt=ee-ye,Ve*Ve+tt*tt}function An(Ye,ee,le,ye){const Ne={id:Ye??null,type:ee,geometry:le,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")Lr(Ne,le);else if(ee==="Polygon")Lr(Ne,le[0]);else if(ee==="MultiLineString")for(const Me of le)Lr(Ne,Me);else if(ee==="MultiPolygon")for(const Me of le)Lr(Ne,Me[0]);return Ne}function Lr(Ye,ee){for(let le=0;le<ee.length;le+=3)Ye.minX=Math.min(Ye.minX,ee[le]),Ye.minY=Math.min(Ye.minY,ee[le+1]),Ye.maxX=Math.max(Ye.maxX,ee[le]),Ye.maxY=Math.max(Ye.maxY,ee[le+1])}function Tt(Ye,ee,le,ye){if(!ee.geometry)return;const Ne=ee.geometry.coordinates;if(Ne&&Ne.length===0)return;const Me=ee.geometry.type,Ve=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2);let tt=[],Ze=ee.id;if(le.promoteId?Ze=ee.properties[le.promoteId]:le.generateId&&(Ze=ye||0),Me==="Point")kn(Ne,tt);else if(Me==="MultiPoint")for(const at of Ne)kn(at,tt);else if(Me==="LineString")nr(Ne,tt,Ve,!1);else if(Me==="MultiLineString"){if(le.lineMetrics){for(const at of Ne)tt=[],nr(at,tt,Ve,!1),Ye.push(An(Ze,"LineString",tt,ee.properties));return}dt(Ne,tt,Ve,!1)}else if(Me==="Polygon")dt(Ne,tt,Ve,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(const at of ee.geometry.geometries)Tt(Ye,{id:Ze,geometry:at,properties:ee.properties},le,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const at of Ne){const Mt=[];dt(at,Mt,Ve,!0),tt.push(Mt)}}Ye.push(An(Ze,Me,tt,ee.properties))}function kn(Ye,ee){ee.push(Qn(Ye[0]),ti(Ye[1]),0)}function nr(Ye,ee,le,ye){let Ne,Me,Ve=0;for(let Ze=0;Ze<Ye.length;Ze++){const at=Qn(Ye[Ze][0]),Mt=ti(Ye[Ze][1]);ee.push(at,Mt,0),Ze>0&&(Ve+=ye?(Ne*Mt-at*Me)/2:Math.sqrt(Math.pow(at-Ne,2)+Math.pow(Mt-Me,2))),Ne=at,Me=Mt}const tt=ee.length-3;ee[2]=1,Ws(ee,0,tt,le),ee[tt+2]=1,ee.size=Math.abs(Ve),ee.start=0,ee.end=ee.size}function dt(Ye,ee,le,ye){for(let Ne=0;Ne<Ye.length;Ne++){const Me=[];nr(Ye[Ne],Me,le,ye),ee.push(Me)}}function Qn(Ye){return Ye/360+.5}function ti(Ye){const ee=Math.sin(Ye*Math.PI/180),le=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return le<0?0:le>1?1:le}function Zi(Ye,ee,le,ye,Ne,Me,Ve,tt){if(ye/=ee,Me>=(le/=ee)&&Ve<ye)return Ye;if(Ve<le||Me>=ye)return null;const Ze=[];for(const at of Ye){const Mt=at.geometry;let xt=at.type;const dn=Ne===0?at.minX:at.minY,Mn=Ne===0?at.maxX:at.maxY;if(dn>=le&&Mn<ye){Ze.push(at);continue}if(Mn<le||dn>=ye)continue;let Qt=[];if(xt==="Point"||xt==="MultiPoint")Is(Mt,Qt,le,ye,Ne);else if(xt==="LineString")Ln(Mt,Qt,le,ye,Ne,!1,tt.lineMetrics);else if(xt==="MultiLineString")Ke(Mt,Qt,le,ye,Ne,!1);else if(xt==="Polygon")Ke(Mt,Qt,le,ye,Ne,!0);else if(xt==="MultiPolygon")for(const Ar of Mt){const lr=[];Ke(Ar,lr,le,ye,Ne,!0),lr.length&&Qt.push(lr)}if(Qt.length){if(tt.lineMetrics&&xt==="LineString"){for(const Ar of Qt)Ze.push(An(at.id,xt,Ar,at.tags));continue}xt!=="LineString"&&xt!=="MultiLineString"||(Qt.length===1?(xt="LineString",Qt=Qt[0]):xt="MultiLineString"),xt!=="Point"&&xt!=="MultiPoint"||(xt=Qt.length===3?"Point":"MultiPoint"),Ze.push(An(at.id,xt,Qt,at.tags))}}return Ze.length?Ze:null}function Is(Ye,ee,le,ye,Ne){for(let Me=0;Me<Ye.length;Me+=3){const Ve=Ye[Me+Ne];Ve>=le&&Ve<=ye&&sn(ee,Ye[Me],Ye[Me+1],Ye[Me+2])}}function Ln(Ye,ee,le,ye,Ne,Me,Ve){let tt=Hn(Ye);const Ze=Ne===0?bn:kr;let at,Mt,xt=Ye.start;for(let lr=0;lr<Ye.length-3;lr+=3){const Er=Ye[lr],ni=Ye[lr+1],Ms=Ye[lr+2],as=Ye[lr+3],Qi=Ye[lr+4],vs=Ne===0?Er:ni,Hi=Ne===0?as:Qi;let $r=!1;Ve&&(at=Math.sqrt(Math.pow(Er-as,2)+Math.pow(ni-Qi,2))),vs<le?Hi>le&&(Mt=Ze(tt,Er,ni,as,Qi,le),Ve&&(tt.start=xt+at*Mt)):vs>ye?Hi<ye&&(Mt=Ze(tt,Er,ni,as,Qi,ye),Ve&&(tt.start=xt+at*Mt)):sn(tt,Er,ni,Ms),Hi<le&&vs>=le&&(Mt=Ze(tt,Er,ni,as,Qi,le),$r=!0),Hi>ye&&vs<=ye&&(Mt=Ze(tt,Er,ni,as,Qi,ye),$r=!0),!Me&&$r&&(Ve&&(tt.end=xt+at*Mt),ee.push(tt),tt=Hn(Ye)),Ve&&(xt+=at)}let dn=Ye.length-3;const Mn=Ye[dn],Qt=Ye[dn+1],Ar=Ne===0?Mn:Qt;Ar>=le&&Ar<=ye&&sn(tt,Mn,Qt,Ye[dn+2]),dn=tt.length-3,Me&&dn>=3&&(tt[dn]!==tt[0]||tt[dn+1]!==tt[1])&&sn(tt,tt[0],tt[1],tt[2]),tt.length&&ee.push(tt)}function Hn(Ye){const ee=[];return ee.size=Ye.size,ee.start=Ye.start,ee.end=Ye.end,ee}function Ke(Ye,ee,le,ye,Ne,Me){for(const Ve of Ye)Ln(Ve,ee,le,ye,Ne,Me,!1)}function sn(Ye,ee,le,ye){Ye.push(ee,le,ye)}function bn(Ye,ee,le,ye,Ne,Me){const Ve=(Me-ee)/(ye-ee);return sn(Ye,Me,le+(Ne-le)*Ve,1),Ve}function kr(Ye,ee,le,ye,Ne,Me){const Ve=(Me-le)/(Ne-le);return sn(Ye,ee+(ye-ee)*Ve,Me,1),Ve}function In(Ye,ee){const le=[];for(let ye=0;ye<Ye.length;ye++){const Ne=Ye[ye],Me=Ne.type;let Ve;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")Ve=Ki(Ne.geometry,ee);else if(Me==="MultiLineString"||Me==="Polygon"){Ve=[];for(const tt of Ne.geometry)Ve.push(Ki(tt,ee))}else if(Me==="MultiPolygon"){Ve=[];for(const tt of Ne.geometry){const Ze=[];for(const at of tt)Ze.push(Ki(at,ee));Ve.push(Ze)}}le.push(An(Ne.id,Me,Ve,Ne.tags))}return le}function Ki(Ye,ee){const le=[];le.size=Ye.size,Ye.start!==void 0&&(le.start=Ye.start,le.end=Ye.end);for(let ye=0;ye<Ye.length;ye+=3)le.push(Ye[ye]+ee,Ye[ye+1],Ye[ye+2]);return le}function Ta(Ye,ee){if(Ye.transformed)return Ye;const le=1<<Ye.z,ye=Ye.x,Ne=Ye.y;for(const Me of Ye.features){const Ve=Me.geometry,tt=Me.type;if(Me.geometry=[],tt===1)for(let Ze=0;Ze<Ve.length;Ze+=2)Me.geometry.push(Ns(Ve[Ze],Ve[Ze+1],ee,le,ye,Ne));else for(let Ze=0;Ze<Ve.length;Ze++){const at=[];for(let Mt=0;Mt<Ve[Ze].length;Mt+=2)at.push(Ns(Ve[Ze][Mt],Ve[Ze][Mt+1],ee,le,ye,Ne));Me.geometry.push(at)}}return Ye.transformed=!0,Ye}function Ns(Ye,ee,le,ye,Ne,Me){return[Math.round(le*(Ye*ye-Ne)),Math.round(le*(ee*ye-Me))]}function Ht(Ye,ee,le,ye,Ne){const Me=ee===Ne.maxZoom?0:Ne.tolerance/((1<<ee)*Ne.extent),Ve={features:[],numPoints:0,numSimplified:0,numFeatures:Ye.length,source:null,x:le,y:ye,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const tt of Ye)Dn(Ve,tt,Me,Ne);return Ve}function Dn(Ye,ee,le,ye){const Ne=ee.geometry,Me=ee.type,Ve=[];if(Ye.minX=Math.min(Ye.minX,ee.minX),Ye.minY=Math.min(Ye.minY,ee.minY),Ye.maxX=Math.max(Ye.maxX,ee.maxX),Ye.maxY=Math.max(Ye.maxY,ee.maxY),Me==="Point"||Me==="MultiPoint")for(let tt=0;tt<Ne.length;tt+=3)Ve.push(Ne[tt],Ne[tt+1]),Ye.numPoints++,Ye.numSimplified++;else if(Me==="LineString")je(Ve,Ne,Ye,le,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(let tt=0;tt<Ne.length;tt++)je(Ve,Ne[tt],Ye,le,Me==="Polygon",tt===0);else if(Me==="MultiPolygon")for(let tt=0;tt<Ne.length;tt++){const Ze=Ne[tt];for(let at=0;at<Ze.length;at++)je(Ve,Ze[at],Ye,le,!0,at===0)}if(Ve.length){let tt=ee.tags||null;if(Me==="LineString"&&ye.lineMetrics){tt={};for(const at in ee.tags)tt[at]=ee.tags[at];tt.mapbox_clip_start=Ne.start/Ne.size,tt.mapbox_clip_end=Ne.end/Ne.size}const Ze={geometry:Ve,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:tt};ee.id!==null&&(Ze.id=ee.id),Ye.features.push(Ze)}}function je(Ye,ee,le,ye,Ne,Me){const Ve=ye*ye;if(ye>0&&ee.size<(Ne?Ve:ye))return void(le.numPoints+=ee.length/3);const tt=[];for(let Ze=0;Ze<ee.length;Ze+=3)(ye===0||ee[Ze+2]>Ve)&&(le.numSimplified++,tt.push(ee[Ze],ee[Ze+1])),le.numPoints++;Ne&&function(Ze,at){let Mt=0;for(let xt=0,dn=Ze.length,Mn=dn-2;xt<dn;Mn=xt,xt+=2)Mt+=(Ze[xt]-Ze[Mn])*(Ze[xt+1]+Ze[Mn+1]);if(Mt>0===at)for(let xt=0,dn=Ze.length;xt<dn/2;xt+=2){const Mn=Ze[xt],Qt=Ze[xt+1];Ze[xt]=Ze[dn-2-xt],Ze[xt+1]=Ze[dn-1-xt],Ze[dn-2-xt]=Mn,Ze[dn-1-xt]=Qt}}(tt,Me),Ye.push(tt)}const jn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ir{constructor(ee,le){const ye=(le=this.options=function(Me,Ve){for(const tt in Ve)Me[tt]=Ve[tt];return Me}(Object.create(jn),le)).debug;if(ye&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ne=function(Me,Ve){const tt=[];if(Me.type==="FeatureCollection")for(let Ze=0;Ze<Me.features.length;Ze++)Tt(tt,Me.features[Ze],Ve,Ze);else Tt(tt,Me.type==="Feature"?Me:{geometry:Me},Ve);return tt}(ee,le);this.tiles={},this.tileCoords=[],ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ne=function(Me,Ve){const tt=Ve.buffer/Ve.extent;let Ze=Me;const at=Zi(Me,1,-1-tt,tt,0,-1,2,Ve),Mt=Zi(Me,1,1-tt,2+tt,0,-1,2,Ve);return(at||Mt)&&(Ze=Zi(Me,1,-tt,1+tt,0,-1,2,Ve)||[],at&&(Ze=In(at,1).concat(Ze)),Mt&&(Ze=Ze.concat(In(Mt,-1)))),Ze}(Ne,le),Ne.length&&this.splitTile(Ne,0,0,0),ye&&(Ne.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ee,le,ye,Ne,Me,Ve,tt){const Ze=[ee,le,ye,Ne],at=this.options,Mt=at.debug;for(;Ze.length;){Ne=Ze.pop(),ye=Ze.pop(),le=Ze.pop(),ee=Ze.pop();const xt=1<<le,dn=Gn(le,ye,Ne);let Mn=this.tiles[dn];if(!Mn&&(Mt>1&&console.time("creation"),Mn=this.tiles[dn]=Ht(ee,le,ye,Ne,at),this.tileCoords.push({z:le,x:ye,y:Ne}),Mt)){Mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,ye,Ne,Mn.numFeatures,Mn.numPoints,Mn.numSimplified),console.timeEnd("creation"));const $r=`z${le}`;this.stats[$r]=(this.stats[$r]||0)+1,this.total++}if(Mn.source=ee,Me==null){if(le===at.indexMaxZoom||Mn.numPoints<=at.indexMaxPoints)continue}else{if(le===at.maxZoom||le===Me)continue;if(Me!=null){const $r=Me-le;if(ye!==Ve>>$r||Ne!==tt>>$r)continue}}if(Mn.source=null,ee.length===0)continue;Mt>1&&console.time("clipping");const Qt=.5*at.buffer/at.extent,Ar=.5-Qt,lr=.5+Qt,Er=1+Qt;let ni=null,Ms=null,as=null,Qi=null,vs=Zi(ee,xt,ye-Qt,ye+lr,0,Mn.minX,Mn.maxX,at),Hi=Zi(ee,xt,ye+Ar,ye+Er,0,Mn.minX,Mn.maxX,at);ee=null,vs&&(ni=Zi(vs,xt,Ne-Qt,Ne+lr,1,Mn.minY,Mn.maxY,at),Ms=Zi(vs,xt,Ne+Ar,Ne+Er,1,Mn.minY,Mn.maxY,at),vs=null),Hi&&(as=Zi(Hi,xt,Ne-Qt,Ne+lr,1,Mn.minY,Mn.maxY,at),Qi=Zi(Hi,xt,Ne+Ar,Ne+Er,1,Mn.minY,Mn.maxY,at),Hi=null),Mt>1&&console.timeEnd("clipping"),Ze.push(ni||[],le+1,2*ye,2*Ne),Ze.push(Ms||[],le+1,2*ye,2*Ne+1),Ze.push(as||[],le+1,2*ye+1,2*Ne),Ze.push(Qi||[],le+1,2*ye+1,2*Ne+1)}}getTile(ee,le,ye){ee=+ee,le=+le,ye=+ye;const Ne=this.options,{extent:Me,debug:Ve}=Ne;if(ee<0||ee>24)return null;const tt=1<<ee,Ze=Gn(ee,le=le+tt&tt-1,ye);if(this.tiles[Ze])return Ta(this.tiles[Ze],Me);Ve>1&&console.log("drilling down to z%d-%d-%d",ee,le,ye);let at,Mt=ee,xt=le,dn=ye;for(;!at&&Mt>0;)Mt--,xt>>=1,dn>>=1,at=this.tiles[Gn(Mt,xt,dn)];return at&&at.source?(Ve>1&&(console.log("found parent tile z%d-%d-%d",Mt,xt,dn),console.time("drilling down")),this.splitTile(at.source,Mt,xt,dn,ee,le,ye),Ve>1&&console.timeEnd("drilling down"),this.tiles[Ze]?Ta(this.tiles[Ze],Me):null):null}}function Gn(Ye,ee,le){return 32*((1<<Ye)*le+ee)+Ye}function cn(Ye,ee){const le=Ye.tileID.canonical;if(!this._geoJSONIndex)return void ee(null,null);const ye=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!ye)return void ee(null,null);const Ne=at=>at.tags&&"3d_elevation_id"in at.tags&&"source"in at.tags&&at.tags.source==="elevation",Me=ye.features.filter(at=>Ne(at));let Ve={_geojsonTileLayer:ye.features};Me.length>0&&(Ve={_geojsonTileLayer:ye.features.filter(at=>!Ne(at)),hd_road_elevation:Me});const tt=new Ct(Ve),Ze=function(at){const Mt=new i.bt;for(const xt of Object.keys(at))Mt.writeMessage(3,mn,{name:xt,features:at[xt]});return Mt.finish()}(Ve).buffer;ee(null,{vectorTile:tt,rawData:Ze})}class xr extends be{constructor(ee,le,ye,Ne,Me,Ve,tt){super(ee,le,ye,Ne,Me,cn,tt),Ve&&(this.loadGeoJSON=Ve),this._dynamicIndex=new en}loadData(ee,le){const ye=ee&&ee.request,Ne=ye&&ye.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ee,(Me,Ve)=>{if(Me||!Ve)return le(Me);if(typeof Ve!="object")return le(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));{try{if(ee.filter){const Ze=i.U(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ze.result==="error")throw new Error(Ze.value.map(at=>`${at.key}: ${at.message}`).join(", "));Ve.features=Ve.features.filter(at=>Ze.value.evaluate({zoom:0},at))}ee.dynamic?(Ve.type==="Feature"&&(Ve={type:"FeatureCollection",features:[Ve]}),ee.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ve.features,this.loaded),ee.cluster&&(Ve.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ee.cluster?new wr(function({superclusterOptions:Ze,clusterProperties:at}){if(!at||!Ze)return Ze;const Mt={},xt={},dn={accumulated:null,zoom:0},Mn={properties:null},Qt=Object.keys(at);for(const Ar of Qt){const[lr,Er]=at[Ar],ni=i.U(Er),Ms=i.U(typeof lr=="string"?[lr,["accumulated"],["get",Ar]]:lr);Mt[Ar]=ni.value,xt[Ar]=Ms.value}return Ze.map=Ar=>{Mn.properties=Ar;const lr={};for(const Er of Qt)lr[Er]=Mt[Er].evaluate(dn,Mn);return lr},Ze.reduce=(Ar,lr)=>{Mn.properties=lr;for(const Er of Qt)dn.accumulated=Ar[Er],Ar[Er]=xt[Er].evaluate(dn,Mn)},Ze}(ee)).load(Ve.features):ee.dynamic?this._dynamicIndex:function(Ze,at){return new Ir(Ze,at)}(Ve,ee.geojsonVtOptions)}catch(Ze){return le(Ze)}const tt={};if(Ne){const Ze=y(ye);Ze&&(tt.resourceTiming={},tt.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Ze)))}le(null,tt)}})}reloadTile(ee,le){const ye=this.loaded;return ye&&ye[ee.uid]?ee.partial?le(null,void 0):super.reloadTile(ee,le):this.loadTile(ee,le)}loadGeoJSON(ee,le){if(ee.request)i.m(ee.request,le);else{if(typeof ee.data!="string")return le(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return le(null,JSON.parse(ee.data))}catch{return le(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(ee,le){try{le(null,this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId))}catch(ye){le(ye)}}getClusterChildren(ee,le){try{le(null,this._geoJSONIndex.getChildren(ee.clusterId))}catch(ye){le(ye)}}getClusterLeaves(ee,le){try{le(null,this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset))}catch(ye){le(ye)}}}class Qs{constructor(ee,le,ye){this.tileID=new i.aQ(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ee.projection,this.brightness=le,this.worldview=ye}parse(ee,le,ye,Ne){this.status="parsing";const Me=new i.aQ(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),Ve=[],tt=le.familiesBySource[ye.source],Ze=new i.fn(Me,ye.promoteId);Ze.bucketLayerIDs=[],Ze.is3DTile=!0,i.fC(ee).then(at=>{if(!at)return Ne(new Error("Could not parse tile"));const Mt=at.json.extensionsUsed&&at.json.extensionsUsed.includes("MAPBOX_mesh_features")||at.json.asset.extras&&at.json.asset.extras.MAPBOX_mesh_features,xt=at.json.extensionsUsed&&at.json.extensionsUsed.includes("EXT_meshopt_compression"),dn=new i.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Mn in tt)for(const Qt of tt[Mn]){const Ar=Qt[0];Ze.bucketLayerIDs.push(Qt.map(ni=>i.B(ni.id,ni.scope))),Ar.recalculate(dn,[]);const lr=i.fD(at,1/i.d7(ye.tileID.canonical)),Er=new i.fE(Qt,lr,Me,Mt,xt,this.brightness,Ze,this.worldview);Mt||(Er.needsUpload=!0),Ve.push(Er),Er.evaluate(Ar)}this.status="done",Ne(null,{buckets:Ve,featureIndex:Ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(at=>Ne(new Error(at.message)))}}class Sr{constructor(ee,le,ye,Ne,Me,Ve,tt,Ze){this.actor=ee,this.layerIndex=le,this.availableImages=ye,this.availableModels=Ne,this.brightness=tt,this.loading={},this.loaded={},this.worldview=Ze}loadTile(ee,le){const ye=ee.uid,Ne=this.loading[ye]=new Qs(ee,this.brightness,this.worldview);i.bu(ee.request,(Me,Ve)=>{const tt=!this.loading[ye];return delete this.loading[ye],tt||Me?(Ne.status="done",tt||(this.loaded[ye]=Ne),le(Me)):Ve&&Ve.byteLength!==0?void Ne.parse(Ve,this.layerIndex,ee,(Ze,at)=>{Ne.status="done",this.loaded=this.loaded||{},this.loaded[ye]=Ne,Ze||!at?le(Ze):le(null,at)}):(Ne.status="done",this.loaded[ye]=Ne,le())})}reloadTile(ee,le){const ye=this.loaded,Ne=ee.uid;if(ye&&ye[Ne]){const Me=ye[Ne];Me.projection=ee.projection,Me.brightness=ee.brightness;const Ve=(tt,Ze)=>{Me.reloadCallback&&(delete Me.reloadCallback,this.loadTile(ee,le)),le(tt,Ze)};Me.status==="parsing"?Me.reloadCallback=Ve:Me.status==="done"&&this.loadTile(ee,le)}}abortTile(ee,le){const ye=ee.uid;this.loading[ye]&&delete this.loading[ye],le()}removeTile(ee,le){const ye=this.loaded,Ne=ee.uid;ye&&ye[Ne]&&delete ye[Ne],le()}}class Mi{constructor(ee){this.self=ee,this.actor=new i.fG(ee,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.cm({name:"mercator"}),this.workerSourceTypes={vector:be,geojson:xr,"raster-dem":ve,"raster-array":we,"batched-model":Sr},this.workerSources={},this.self.registerWorkerSource=(le,ye)=>{if(this.workerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.workerSourceTypes[le]=ye},this.self.registerRTLTextPlugin=le=>{if(i.fH.isParsed())throw new Error("RTL text plugin already registered.");i.fH.setState({pluginStatus:i.fI.parsed,pluginURL:i.fH.getPluginURL()}),i.fH.applyArabicShaping=le.applyArabicShaping,i.fH.processBidirectionalText=le.processBidirectionalText,i.fH.processStyledBidirectionalText=le.processStyledBidirectionalText;for(const ye of this.rtlPluginParsingListeners)ye(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ee,le,ye){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.availableModels[ee],delete this.workerSources[ee],ye()}checkIfReady(ee,le,ye){ye()}setReferrer(ee,le){this.referrer=le}spriteLoaded(ee,le){this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={});const{scope:ye,isLoaded:Ne}=le;if(this.isSpriteLoaded[ee][ye]=Ne,this.workerSources[ee]&&this.workerSources[ee][ye])for(const Me in this.workerSources[ee][ye]){const Ve=this.workerSources[ee][ye][Me];for(const tt in Ve){const Ze=Ve[tt];Ze instanceof be&&(Ze.isSpriteLoaded=Ne,Ze.fire(new i.z("isSpriteLoaded")))}}}setImages(ee,le,ye){this.availableImages[ee]||(this.availableImages[ee]={});const{scope:Ne,images:Me}=le;if(this.availableImages[ee][Ne]=Me,this.workerSources[ee]&&this.workerSources[ee][Ne]){for(const Ve in this.workerSources[ee][Ne]){const tt=this.workerSources[ee][Ne][Ve];for(const Ze in tt)tt[Ze].availableImages=Me}ye()}else ye()}setModels(ee,{scope:le,models:ye},Ne){if(this.availableModels[ee]||(this.availableModels[ee]={}),this.availableModels[ee][le]=ye,this.workerSources[ee]&&this.workerSources[ee][le]){for(const Me in this.workerSources[ee][le]){const Ve=this.workerSources[ee][le][Me];for(const tt in Ve)Ve[tt].availableModels=ye}Ne()}else Ne()}setProjection(ee,le){this.projections[ee]=i.cm(le)}setBrightness(ee,le,ye){this.brightness=le,ye()}setWorldview(ee,le,ye){this.worldview=le,ye()}setLayers(ee,le,ye){this.getLayerIndex(ee,le.scope).replace(le.layers,le.options),ye()}updateLayers(ee,le,ye){this.getLayerIndex(ee,le.scope).update(le.layers,le.removedIds,le.options),ye()}loadTile(ee,le,ye){le.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,le.type,le.source,le.scope).loadTile(le,ye)}decodeRasterArray(ee,le,ye){this.getWorkerSource(ee,le.type,le.source,le.scope).decodeRasterArray(le,ye)}reloadTile(ee,le,ye){le.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,le.type,le.source,le.scope).reloadTile(le,ye)}abortTile(ee,le,ye){this.getWorkerSource(ee,le.type,le.source,le.scope).abortTile(le,ye)}removeTile(ee,le,ye){this.getWorkerSource(ee,le.type,le.source,le.scope).removeTile(le,ye)}removeSource(ee,le,ye){if(!(this.workerSources[ee]&&this.workerSources[ee][le.scope]&&this.workerSources[ee][le.scope][le.type]&&this.workerSources[ee][le.scope][le.type][le.source]))return;const Ne=this.workerSources[ee][le.scope][le.type][le.source];delete this.workerSources[ee][le.scope][le.type][le.source],Ne.removeSource!==void 0?Ne.removeSource(le,ye):ye()}loadWorkerSource(ee,le,ye){try{this.self.importScripts(le.url),ye()}catch(Ne){ye(Ne)}}syncRTLPluginState(ee,le,ye){if(i.fH.isParsed())ye(null,!0);else if(i.fH.isParsing())this.rtlPluginParsingListeners.push(ye);else try{i.fH.setState(le);const Ne=i.fH.getPluginURL();!i.fH.isLoaded()||i.fH.isParsed()||i.fH.isParsing()||Ne==null||(i.fH.setState({pluginStatus:i.fI.parsing,pluginURL:i.fH.getPluginURL()}),this.self.importScripts(Ne),i.fH.isParsed()?ye(null,!0):this.rtlPluginParsingListeners.push(ye))}catch(Ne){ye(Ne)}}setDracoUrl(ee,le){this.dracoUrl=le}getAvailableImages(ee,le){this.availableImages[ee]||(this.availableImages[ee]={});let ye=this.availableImages[ee][le];return ye||(ye=[]),ye}getAvailableModels(ee,le){this.availableModels[ee]||(this.availableModels[ee]={});let ye=this.availableModels[ee][le];return ye||(ye={}),ye}getLayerIndex(ee,le){this.layerIndexes[ee]||(this.layerIndexes[ee]={});let ye=this.layerIndexes[ee][le];return ye||(ye=this.layerIndexes[ee][le]=new C,ye.scope=le),ye}getWorkerSource(ee,le,ye,Ne){const Me=this.workerSources;return Me[ee]||(Me[ee]={}),Me[ee][Ne]||(Me[ee][Ne]={}),Me[ee][Ne][le]||(Me[ee][Ne][le]={}),this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),Me[ee][Ne][le][ye]||(Me[ee][Ne][le][ye]=new this.workerSourceTypes[le]({send:(Ve,tt,Ze,at,Mt,xt)=>this.actor.send(Ve,tt,Ze,ee,Mt,xt),scheduler:this.actor.scheduler},this.getLayerIndex(ee,Ne),this.getAvailableImages(ee,Ne),this.getAvailableModels(ee,Ne),this.isSpriteLoaded[ee][Ne],void 0,this.brightness,this.worldview)),Me[ee][Ne][le][ye]}rasterizeImagesWorker(ee,le,ye){const Ne=new Map;for(const[Me,{image:Ve,imageVariant:tt}]of le.tasks.entries()){const Ze=this.imageRasterizer.rasterize(tt,Ve,le.scope,ee);Ne.set(Me,Ze)}ye(void 0,Ne)}removeRasterizedImages(ee,le,ye){this.imageRasterizer.removeImagesFromCacheByIds(le.imageIds,le.scope,ee),ye()}enforceCacheSizeLimit(ee,le){i.fJ(le)}getWorkerPerformanceMetrics(ee,le,ye){ye(void 0,void 0)}}return i.fF(self)&&(self.worker=new Mi(self)),Mi}),l(["./shared"],function(i){var y="3.17.0";const x={create:"create",load:"load",fullLoad:"fullLoad"},S={mark(m){performance.mark(m)},measure(m,o,d){performance.measure(m,o,d)}};function C(m){const o=m.name.split("?")[0];return i.a(o)&&o.includes("mapbox-gl.js")?"javascript":i.a(o)&&o.includes("mapbox-gl.css")?"css":i.b(o)?"fontRange":i.c(o)?"sprite":i.i(o)?"style":i.d(o)?"tilejson":"other"}var P,L={},F=function(){if(P)return L;function m(g){return!o(g)}function o(g){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,E,I=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(I);try{E=new Worker(M),T=!0}catch{T=!1}return E&&E.terminate(),URL.revokeObjectURL(M),T}()?function(){var T=document.createElement("canvas");T.width=T.height=1;var E=T.getContext("2d");if(!E)return!1;var I=E.getImageData(0,0,1,1);return I&&I.width===T.width}()?(d[b=g&&g.failIfMajorPerformanceCaveat]===void 0&&(d[b]=function(T){var E,I=function(M){var N=document.createElement("canvas"),j=Object.create(m.webGLContextAttributes);return j.failIfMajorPerformanceCaveat=M,N.getContext("webgl2",j)}(T);if(!I)return!1;try{E=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!E||I.isContextLost())&&(I.shaderSource(E,"void main() {}"),I.compileShader(E),I.getShaderParameter(E,I.COMPILE_STATUS)===!0)}(b)),d[b]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var b}P=1,L.supported=m,L.notSupportedReason=o;var d={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},L}();function U(m,o,d){const g=document.createElement(m);return o!=null&&(g.className=o),d&&d.appendChild(g),g}function q(m,o,d){const g=document.createElementNS("http://www.w3.org/2000/svg",m);for(const b of Object.keys(o))g.setAttributeNS(null,b,String(o[b]));return d&&d.appendChild(g),g}const G=typeof document<"u"?document.documentElement&&document.documentElement.style:null,$=G&&G.userSelect!==void 0?"userSelect":"WebkitUserSelect";let X;function ie(){G&&$&&(X=G[$],G[$]="none")}function de(){G&&$&&(G[$]=X)}function fe(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",fe,!0)}function be(){window.addEventListener("click",fe,!0),window.setTimeout(()=>{window.removeEventListener("click",fe,!0)},0)}function ve(m,o){const d=m.getBoundingClientRect();return rt(m,d,o)}function Je(m,o){const d=m.getBoundingClientRect(),g=[];for(let b=0;b<o.length;b++)g.push(rt(m,d,o[b]));return g}function we(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&m.button===2&&m.ctrlKey?0:m.button}function rt(m,o,d){const g=m.offsetWidth===o.width?1:m.offsetWidth/o.width;return new i.P((d.clientX-o.left)*g,(d.clientY-o.top)*g)}const He="01",ft="NO_ACCESS_TOKEN";class Ct{constructor(o,d,g){this._transformRequestFn=o,this._customAccessToken=d,this._silenceAuthErrors=!!g,this._createSkuToken()}_createSkuToken(){const o=function(){let d="";for(let g=0;g<10;g++)d+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",He,d].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,d){return this._transformRequestFn&&this._transformRequestFn(o,d)||{url:o}}normalizeStyleURL(o,d){if(!i.h(o))return o;const g=Rt(o);return g.params.push(`sdk=js-${y}`),g.path=`/styles/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||d)}normalizeGlyphsURL(o,d){if(!i.h(o))return o;const g=Rt(o);return g.path=`/fonts/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||d)}normalizeModelURL(o,d){if(!i.h(o))return o;const g=Rt(o);return g.path=`/models/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||d)}normalizeSourceURL(o,d,g,b){if(!i.h(o))return o;const T=Rt(o);return T.path=`/v4/${T.authority}.json`,T.params.push("secure"),g&&T.params.push(`language=${g}`),b&&T.params.push(`worldview=${b}`),this._makeAPIURL(T,this._customAccessToken||d)}normalizeIconsetURL(o,d){const g=Rt(o);return i.h(o)?(g.path=`/styles/v1${g.path}/iconset.pbf`,this._makeAPIURL(g,this._customAccessToken||d)):en(g)}normalizeSpriteURL(o,d,g,b){const T=Rt(o);return i.h(o)?(T.path=`/styles/v1${T.path}/sprite${d}${g}`,this._makeAPIURL(T,this._customAccessToken||b)):(T.path+=`${d}${g}`,en(T))}normalizeTileURL(o,d,g){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!i.h(o))return o;const b=Rt(o);b.path=b.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${d||g&&b.authority!=="raster"&&g===512?"@2x":""}${i.k.supported?".webp":"$1"}`),b.authority==="raster"?b.path=`/${i.e.RASTER_URL_PREFIX}${b.path}`:b.authority==="rasterarrays"?b.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${b.path}`:b.authority==="3dtiles"?b.path=`/${i.e.TILES3D_URL_PREFIX}${b.path}`:(b.path=b.path.replace(/^.+\/v4\//,"/"),b.path=`/${i.e.TILE_URL_VERSION}${b.path}`);const T=this._customAccessToken||function(E){for(const I of E){const M=I.match(/^access_token=(.*)$/);if(M)return M[1]}return null}(b.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&T&&this._skuToken&&b.params.push(`sku=${this._skuToken}`),this._makeAPIURL(b,T)}canonicalizeTileURL(o,d){const g=Rt(o);if(!g.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!g.path.match(/\.[\w]+$/))return o;let b="mapbox://";g.path.match(/^\/raster\/v1\//)?b+=`raster/${g.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:g.path.match(/^\/rasterarrays\/v1\//)?b+=`rasterarrays/${g.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:b+=`tiles/${g.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let T=g.params;return d&&(T=T.filter(E=>!E.match(/^access_token=/))),T.length&&(b+=`?${T.join("&")}`),b}canonicalizeTileset(o,d){const g=!!d&&i.h(d),b=[];for(const T of o.tiles||[])i.j(T)?b.push(this.canonicalizeTileURL(T,g)):b.push(T);return b}_makeAPIURL(o,d){const g="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",b=Rt(i.e.API_URL);if(o.protocol=b.protocol,o.authority=b.authority,o.protocol==="http"){const T=o.params.indexOf("secure");T>=0&&o.params.splice(T,1)}if(b.path!=="/"&&(o.path=`${b.path}${o.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return en(o);if(d=d||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!d)throw new Error(`An API access token is required to use Mapbox GL. ${g}`);if(d[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${g}`)}return o.params=o.params.filter(T=>T.indexOf("access_token")===-1),o.params.push(`access_token=${d||""}`),en(o)}}const Nt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Rt(m){const o=m.match(Nt);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function en(m){const o=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${o}`}const nt="mapbox.eventData";function pt(m){if(!m)return null;const o=m.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(i.l(o[1]))}catch{return null}}class Oe{constructor(o){this.type=o,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const d=pt(i.e.ACCESS_TOKEN);let g="";return g=d&&d.u?i.f(d.u):i.e.ACCESS_TOKEN||"",o?`${nt}.${o}:${g}`:`${nt}:${g}`}fetchEventData(){const o=i.s("localStorage"),d=this.getStorageKey(),g=this.getStorageKey("uuid"),b=this.getStorageKey("uuidTimestamp");if(o)try{const T=localStorage.getItem(d);T&&(this.eventData=JSON.parse(T));const E=localStorage.getItem(g);E&&(this.anonId=E);const I=localStorage.getItem(b);I&&(this.anonIdTimestamp=Number(I));const M=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<M)&&this.refreshUUID()}catch{i.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=i.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const o=i.s("localStorage"),d=this.getStorageKey(),g=this.getStorageKey("uuid"),b=this.getStorageKey("uuidTimestamp"),T=this.anonId,E=this.anonIdTimestamp;if(o&&T)try{localStorage.setItem(g,T),Object.keys(this.eventData).length>=1&&localStorage.setItem(d,JSON.stringify(this.eventData)),E&&localStorage.setItem(b,E.toString())}catch{i.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,d,g,b){if(!i.e.EVENTS_URL)return;const T=Rt(i.e.EVENTS_URL);T.params.push(`access_token=${b||i.e.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(o).toISOString()},I=d?Object.assign(E,d):E,M={url:en(T),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=i.p(M,N=>{this.pendingRequest=null,g(N),this.saveEventData(),this.processRequests(b)})}queueRequest(o,d){this.queue.push(o),this.processRequests(d)}}class gn extends Oe{constructor(o){super("metrics"),o&&(this.data=o)}postMetricsEvent(o){if(!i.e.EVENTS_URL||!o&&!i.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID();const d=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:d},o)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:d,payload:g}=this.queue.shift();this.postEvent(d,g,()=>{},o)}}const wt=new class extends Oe{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,o){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(d=>i.h(d)||i.j(d))&&this.queueRequest(Date.now(),o)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=pt(i.e.ACCESS_TOKEN),d=o?o.u:i.e.ACCESS_TOKEN;let g=d!==this.eventData.tokenU;i.v(this.anonId)||(this.refreshUUID(),g=!0);const b=this.queue.shift();if(this.eventData.lastSuccess){const T=new Date(this.eventData.lastSuccess),E=new Date(b),I=(b-this.eventData.lastSuccess)/864e5;g=g||I>=1||I<-1||T.getDate()!==E.getDate()}else g=!0;g?this.postEvent(b,{sdkIdentifier:"mapbox-gl-js",sdkVersion:y,skuId:He,"enabled.telemetry":!1,userId:this.anonId},T=>{T||(this.eventData.lastSuccess=b,this.eventData.tokenU=d)},m):this.processRequests()}},Fe=wt.postTurnstileEvent.bind(wt),jt=new class extends Oe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,o,d,g){this.skuToken=o,this.errorCb=g,i.e.EVENTS_URL&&(d||i.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},d):this.errorCb(new Error(ft)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:d}=this.queue.shift();o&&this.success[o]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID(),this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:y,skuId:He,skuToken:this.skuToken,userId:this.anonId},g=>{g?this.errorCb(g):o&&(this.success[o]=!0)},m))}remove(){this.errorCb=null}},Tn=jt.postMapLoadEvent.bind(jt),mn=new class extends Oe{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let o=this.mapInstanceIdMap.get(m);return o||(o=i.u(),this.mapInstanceIdMap.set(m,o)),o}getEventId(m){const o=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,o+1),o}postStyleLoadEvent(m,o){const{map:d,style:g,importedStyles:b}=o;if(!i.e.EVENTS_URL||!m&&!i.e.ACCESS_TOKEN)return;const T=this.getMapInstanceId(d),E={mapInstanceId:T,eventId:this.getEventId(T),style:g};b.length&&(E.importedStyles=b),this.queueRequest({timestamp:Date.now(),payload:E},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:d}=this.queue.shift();this.postEvent(o,d,()=>{},m)}},zn=mn.postStyleLoadEvent.bind(mn),yn=new gn({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),qt=yn.postMetricsEvent.bind(yn),wn=new gn({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),Sn=wn.postMetricsEvent.bind(wn),Xn=new class extends Oe{constructor(){super("gljs.performance")}postPerformanceEvent(m,o){i.e.EVENTS_URL&&(m||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,performanceData:d}=this.queue.shift(),g=function(b){const T=performance.getEntriesByType("resource"),E=performance.getEntriesByType("mark"),I=function(Y){const te={};if(Y){for(const J in Y)if(J!=="other")for(const oe of Y[J]){const ae=`${J}ResolveRangeMin`,pe=`${J}ResolveRangeMax`,_e=`${J}RequestCount`,me=`${J}RequestCachedCount`;te[ae]=Math.min(te[ae]||1/0,oe.startTime),te[pe]=Math.max(te[pe]||-1/0,oe.responseEnd);const Le=Ce=>{te[Ce]===void 0&&(te[Ce]=0),++te[Ce]};oe.transferSize!==void 0&&oe.transferSize===0&&Le(me),Le(_e)}}return te}(function(Y,te){const J={};if(Y)for(const oe of Y){const ae=te(oe);J[ae]===void 0&&(J[ae]=[]),J[ae].push(oe)}return J}(T,C)),M=window.devicePixelRatio,N=navigator.connection||navigator.mozConnection||navigator.webkitConnection,j=N?N.effectiveType:void 0,W={counters:[],metadata:[],attributes:[]},Z=(Y,te,J)=>{J!=null&&Y.push({name:te,value:J.toString()})};for(const Y in I)Z(W.counters,Y,I[Y]);if(b.interactionRange[0]!==1/0&&b.interactionRange[1]!==-1/0&&(Z(W.counters,"interactionRangeMin",b.interactionRange[0]),Z(W.counters,"interactionRangeMax",b.interactionRange[1])),E)for(const Y of Object.values(x)){const te=E.find(J=>J.name===Y);te&&Z(W.counters,Y,te.startTime)}return Z(W.counters,"visibilityHidden",b.visibilityHidden),Z(W.attributes,"style",function(Y){if(Y)for(const te of Y){const J=te.name.split("?")[0];if(i.i(J)){const oe=J.split("/").slice(-2);if(oe.length===2)return`mapbox://styles/${oe[0]}/${oe[1]}`}}}(T)),Z(W.attributes,"terrainEnabled",b.terrainEnabled?"true":"false"),Z(W.attributes,"fogEnabled",b.fogEnabled?"true":"false"),Z(W.attributes,"projection",b.projection),Z(W.attributes,"zoom",b.zoom),Z(W.metadata,"devicePixelRatio",M),Z(W.metadata,"connectionEffectiveType",j),Z(W.metadata,"navigatorUserAgent",navigator.userAgent),Z(W.metadata,"screenWidth",window.screen.width),Z(W.metadata,"screenHeight",window.screen.height),Z(W.metadata,"windowWidth",window.innerWidth),Z(W.metadata,"windowHeight",window.innerHeight),Z(W.metadata,"mapWidth",b.width/M),Z(W.metadata,"mapHeight",b.height/M),Z(W.metadata,"webglRenderer",b.renderer),Z(W.metadata,"webglVendor",b.vendor),Z(W.metadata,"sdkVersion",y),Z(W.metadata,"sdkIdentifier","mapbox-gl-js"),W}(d);for(const b of g.metadata);for(const b of g.counters);for(const b of g.attributes);this.postEvent(o,g,()=>{},m)}},rn=Xn.postPerformanceEvent.bind(Xn),br=new class extends Oe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,o,d,g){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const b=Rt(i.e.API_URL+i.e.SESSION_PATH);b.params.push(`sku=${o||""}`),b.params.push(`access_token=${g||i.e.ACCESS_TOKEN||""}`);const T={url:en(b),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(T,E=>{this.pendingRequest=null,d(E),this.saveEventData(),this.processRequests(g)})}getSessionAPI(m,o,d,g){this.skuToken=o,this.errorCb=g,i.e.SESSION_PATH&&i.e.API_URL&&(d||i.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},d):this.errorCb(new Error(ft)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:d}=this.queue.shift();o&&this.success[o]||this.getSession(d,this.skuToken,g=>{g?this.errorCb(g):o&&(this.success[o]=!0)},m)}remove(){this.errorCb=null}},Qr=br.getSessionAPI.bind(br),sr=new Set;function ar(m,o){o?sr.add(m):sr.delete(m)}class Vn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,d){this._updatedSourceCaches[o]=d,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){const d=o.scope;this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._updatedLayers[d].add(o.id),this.setDirty()}removeLayer(o){const d=o.scope;this._removedLayers[d]=this._removedLayers[d]||{},this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._removedLayers[d][o.id]=o,this._updatedLayers[d].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){const o={};for(const d in this._updatedLayers)o[d]=o[d]||{},o[d].updatedIds=Array.from(this._updatedLayers[d].values());for(const d in this._removedLayers)o[d]=o[d]||{},o[d].removedIds=Object.keys(this._removedLayers[d]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(o){return this._updatedImages[o]?Array.from(this._updatedImages[o].values()):[]}updateImage(o,d){this._updatedImages[d]=this._updatedImages[d]||new Set,this._updatedImages[d].add(i.I.toString(o)),this.setDirty()}resetUpdatedImages(o){this._updatedImages[o]&&this._updatedImages[o].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function wr(m){const{userImage:o}=m;return!!(o&&o.render&&o.render())&&(m.data.replace(new Uint8Array(o.data.buffer)),!0)}class ys extends i.E{constructor(o){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=o,o!=="raster"&&i.r()&&(this.imageRasterizerDispatcher=new i.D(i.t(),this,"Image Rasterizer Worker",1))}addScope(o){this.loaded.set(o,!1),this.imageProviders.set(o,new Map),this.images.set(o,new Map),this.updatedImages.set(o,new Set),this.callbackDispatchedThisFrame.set(o,new Set),this.patterns.set(o,new Map),this.atlasImage.set(o,new i.q({width:1,height:1}))}removeScope(o){this.loaded.delete(o),this.imageProviders.delete(o),this.images.delete(o),this.updatedImages.delete(o),this.callbackDispatchedThisFrame.delete(o),this.patterns.delete(o),this.atlasImage.delete(o);const d=this.atlasTexture.get(o);d&&(d.destroy(),this.atlasTexture.delete(o))}addImageProvider(o,d){this.imageProviders.has(d)||this.imageProviders.set(d,new Map),this.imageProviders.get(d).set(o.id,o)}removeImageProvider(o,d){this.imageProviders.has(d)&&this.imageProviders.get(d).delete(o)}getPendingImageProviders(){const o=[];for(const d of this.imageProviders.values())for(const g of d.values())g.hasPendingRequests()&&o.push(g);return o}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.x),this._imageRasterizer}isLoaded(){for(const o of this.loaded.keys())if(!this.loaded.get(o))return!1;return!0}setLoaded(o,d){if(this.loaded.get(d)!==o&&(this.loaded.set(d,o),o)){for(const{ids:g,callback:b}of this.requestors)this._notify(g,d,b);this.requestors=[]}}hasImage(o,d){return!!this.getImage(o,d)}getImage(o,d){return this.images.get(d).get(o.toString())}addImage(o,d,g){this._validate(o,g)&&this.images.get(d).set(o.toString(),g)}_validate(o,d){let g=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new i.y(new Error(`Image "${o.name}" has invalid "stretchX" value`))),g=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new i.y(new Error(`Image "${o.name}" has invalid "stretchY" value`))),g=!1),this._validateContent(d.content,d)||(this.fire(new i.y(new Error(`Image "${o.name}" has invalid "content" value`))),g=!1),g}_validateStretch(o,d){if(!o)return!0;let g=0;for(const b of o){if(b[0]<g||b[1]<b[0]||d<b[1])return!1;g=b[1]}return!0}_validateContent(o,d){return o?o.length!==4||!d.usvg&&(o[0]<0||d.data.width<o[0]||o[1]<0||d.data.height<o[1]||o[2]<0||d.data.width<o[2]||o[3]<0||d.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,d,g){const b=this.images.get(d).get(o.toString());g.version=b.version+1,this.images.get(d).set(o.toString(),g),this.updatedImages.get(d).add(o),this.removeFromImageRasterizerCache(o,d)}clearUpdatedImages(o){this.updatedImages.get(o).clear()}removeFromImageRasterizerCache(o,d){this.spriteFormat!=="raster"&&(i.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:d}):this.imageRasterizer.removeImagesFromCacheByIds([o],d))}removeImage(o,d){const g=this.images.get(d),b=g.get(o.toString());g.delete(o.toString()),this.patterns.get(d).delete(o.toString()),this.removeFromImageRasterizerCache(o,d),b.userImage&&b.userImage.onRemove&&b.userImage.onRemove()}listImages(o){return Array.from(this.images.get(o).keys()).map(d=>i.I.from(d))}getImages(o,d,g){const b=[],T=[],E=this.imageProviders.get(d);for(const j of o){if(!j.iconsetId){b.push(j);continue}const W=E.get(j.iconsetId);W&&(this.getImage(j,d)?T.push(j):W.addPendingRequest(j))}if(b.length===0)return void this._notify(T,d,g);let I=!0;const M=!!this.loaded.get(d),N=this.images.get(d);if(!M)for(const j of b)N.has(j.toString())||(I=!1);M||I?this._notify(b,d,g):this.requestors.push({ids:b,scope:d,callback:g})}rasterizeImages(o,d){const g=new Map,{tasks:b,scope:T}=o;for(const[E,I]of b.entries()){const M=this.getImage(I.id,T);M&&g.set(E,{image:M,imageVariant:I})}this._rasterizeImages(T,g,d)}_rasterizeImages(o,d,g){if(i.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:d,scope:o},g);else{const b=new Map;for(const[T,{image:E,imageVariant:I}]of d.entries())b.set(T,this.imageRasterizer.rasterize(I,E,o,0));g(void 0,b)}}getUpdatedImages(o){return this.updatedImages.get(o)||new Set}_notify(o,d,g){const b=this.images.get(d),T=new Map;for(const E of o){if(!b.get(E.toString())){if(E.iconsetId)continue;this.fire(new i.z("styleimagemissing",{id:E.name}))}const I=b.get(E.toString());if(!I){i.w(`Image "${E.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const M={data:I.usvg?null:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,usvg:I.usvg,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)};I.usvg&&Object.assign(M,{width:I.icon.usvg_tree.width,height:I.icon.usvg_tree.height}),T.set(i.I.toString(E),M)}g(null,T)}getPixelSize(o){const{width:d,height:g}=this.atlasImage.get(o);return{width:d,height:g}}getPattern(o,d,g){const b=o.toString(),T=this.patterns.get(d),E=T.get(b),I=this.getImage(o,d);if(!I)return null;if(E){if(E.position.version===I.version)return E.position;E.position.version=I.version}else{if(I.usvg&&!I.data){const M=this.getPatternInFlightId(b,d);if(this.patternsInFlight.has(M))return null;this.patternsInFlight.add(M);const N=new i.A(o).scaleSelf(i.o.devicePixelRatio),j=new Map([[N.toString(),{image:I,imageVariant:N}]]);return this._rasterizeImages(d,j,(W,Z)=>this.storePatternImage(N,d,I,g,Z)),null}this.storePattern(o,d,I)}return this._updatePatternAtlas(d,g),T.get(b).position}getPatternInFlightId(o,d){return i.B(o,d)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,d,g,b,T){const E=o.toString(),I=T?T.get(E):void 0;I&&(g.data=I,this.storePattern(o.id,d,g),this._updatePatternAtlas(d,b),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),d)))}storePattern(o,d,g){const b={w:g.data.width+2*i.C,h:g.data.height+2*i.C,x:0,y:0},T=new i.F(b,g,i.C);this.patterns.get(d).set(o.toString(),{bin:b,position:T})}destroyAtlasTextures(){for(const o of this.atlasTexture.values())o&&o.destroy();this.atlasTexture.clear()}bind(o,d){const g=o.gl;let b=this.atlasTexture.get(d);b?this.dirty&&(b.update(this.atlasImage.get(d)),this.dirty=!1):(b=new i.T(o,this.atlasImage.get(d),g.RGBA8),this.atlasTexture.set(d,b)),b.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(o,d){const g=this.patterns.get(o),b=Array.from(g.values()).map(({bin:N})=>N),{w:T,h:E}=i.G(b),I=this.atlasImage.get(o);I.resize({width:T||1,height:E||1});const M=this.images.get(o);for(const[N,{bin:j,position:W}]of g.entries()){let Z=W.padding;const Y=j.x+Z,te=j.y+Z,J=M.get(N).data,oe=J.width,ae=J.height;Z=Z>1?Z-1:Z,i.q.copy(J,I,{x:0,y:0},{x:Y,y:te},{width:oe,height:ae},d),i.q.copy(J,I,{x:0,y:ae-Z},{x:Y,y:te-Z},{width:oe,height:Z},d),i.q.copy(J,I,{x:0,y:0},{x:Y,y:te+ae},{width:oe,height:Z},d),i.q.copy(J,I,{x:oe-Z,y:0},{x:Y-Z,y:te},{width:Z,height:ae},d),i.q.copy(J,I,{x:0,y:0},{x:Y+oe,y:te},{width:Z,height:ae},d),i.q.copy(J,I,{x:oe-Z,y:ae-Z},{x:Y-Z,y:te-Z},{width:Z,height:Z},d),i.q.copy(J,I,{x:0,y:ae-Z},{x:Y+oe,y:te-Z},{width:Z,height:Z},d),i.q.copy(J,I,{x:0,y:0},{x:Y+oe,y:te+ae},{width:Z,height:Z},d),i.q.copy(J,I,{x:oe-Z,y:0},{x:Y-Z,y:te+ae},{width:Z,height:Z},d)}this.dirty=!0}beginFrame(){for(const o of this.images.keys())this.callbackDispatchedThisFrame.set(o,new Set)}dispatchRenderCallbacks(o,d){const g=this.images.get(d);for(const b of o){if(this.callbackDispatchedThisFrame.get(d).has(b.toString()))continue;this.callbackDispatchedThisFrame.get(d).add(b.toString());const T=g.get(b.toString());wr(T)&&this.updateImage(b,d,T)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Si(m){const o=m.value,d=m.valueSpec,g=m.style,b=m.styleSpec,T=m.key,E=m.arrayElementValidator||In;if(!Array.isArray(o))return[new i.V(T,o,`array expected, ${i.K(o)} found`)];if(d.length&&o.length!==d.length)return[new i.V(T,o,`array length ${d.length} expected, length ${o.length} found`)];if(d["min-length"]&&o.length<d["min-length"])return[new i.V(T,o,`array length at least ${d["min-length"]} expected, length ${o.length} found`)];let I={type:d.value,values:d.values,minimum:d.minimum,maximum:d.maximum,function:void 0};b.$version<7&&(I.function=d.function),i.H(d.value)&&(I=d.value);let M=[];for(let N=0;N<o.length;N++)M=M.concat(E({array:o,arrayIndex:N,value:o[N],valueSpec:I,style:g,styleSpec:b,key:`${T}[${N}]`},!0));return M}function Ri(m){const o=m.key,d=m.value,g=m.valueSpec;if(!i.L(d))return[new i.V(o,d,`number expected, ${i.K(d)} found`)];if(d!=d)return[new i.V(o,d,"number expected, NaN found")];if("minimum"in g){let b=g.minimum;if(Array.isArray(g.minimum)&&(b=g.minimum[m.arrayIndex]),d<b)return[new i.V(o,d,`${d} is less than the minimum value ${b}`)]}if("maximum"in g){let b=g.maximum;if(Array.isArray(g.maximum)&&(b=g.maximum[m.arrayIndex]),d>b)return[new i.V(o,d,`${d} is greater than the maximum value ${b}`)]}return[]}function ks(m){const o=m.key,d=m.value;if(!i.H(d))return[new i.V(o,d,`object expected, ${i.K(d)} found`)];const g=m.valueSpec,b=i.J(d.type);let T,E,I,M={};const N=b!=="categorical"&&d.property===void 0,j=!N,W=function(J){const oe=J.stops;return Array.isArray(oe)&&Array.isArray(oe[0])&&i.H(oe[0][0])}(d),Z=Ki({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(J){if(b==="identity")return[new i.V(J.key,J.value,'identity function may not have a "stops" property')];let oe=[];const ae=J.value;return oe=oe.concat(Si({key:J.key,value:ae,valueSpec:J.valueSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:Y})),Array.isArray(ae)&&ae.length===0&&oe.push(new i.V(J.key,ae,"array must have at least one stop")),oe},default:function(J){return In({key:J.key,value:J.value,valueSpec:g,style:J.style,styleSpec:J.styleSpec})}}});return b==="identity"&&N&&Z.push(new i.V(m.key,m.value,'missing required property "property"')),b==="identity"||d.stops||Z.push(new i.V(m.key,m.value,'missing required property "stops"')),b==="exponential"&&g.expression&&!i.M(g)&&Z.push(new i.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(j&&!i.N(g)?Z.push(new i.V(m.key,m.value,"property functions not supported")):N&&!i.O(g)&&Z.push(new i.V(m.key,m.value,"zoom functions not supported"))),b!=="categorical"&&!W||d.property!==void 0||Z.push(new i.V(m.key,m.value,'"property" property is required')),Z;function Y(J){let oe=[];const ae=J.value,pe=J.key;if(!Array.isArray(ae))return[new i.V(pe,ae,`array expected, ${i.K(ae)} found`)];if(ae.length!==2)return[new i.V(pe,ae,`array length 2 expected, length ${ae.length} found`)];if(W){if(!i.H(ae[0]))return[new i.V(pe,ae,`object expected, ${i.K(ae[0])} found`)];const _e=ae[0];if(_e.zoom===void 0)return[new i.V(pe,ae,"object stop key must have zoom")];if(_e.value===void 0)return[new i.V(pe,ae,"object stop key must have value")];const me=i.J(_e.zoom);if(typeof me!="number")return[new i.V(pe,_e.zoom,"stop zoom values must be numbers")];if(I&&I>me)return[new i.V(pe,_e.zoom,"stop zoom values must appear in ascending order")];me!==I&&(I=me,E=void 0,M={}),oe=oe.concat(Ki({key:`${pe}[0]`,value:ae[0],valueSpec:{zoom:{}},style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:Ri,value:te}}))}else oe=oe.concat(te({key:`${pe}[0]`,value:ae[0],style:J.style,styleSpec:J.styleSpec},ae));return i.Q(i.S(ae[1]))?oe.concat([new i.V(`${pe}[1]`,ae[1],"expressions are not allowed in function stops.")]):oe.concat(In({key:`${pe}[1]`,value:ae[1],valueSpec:g,style:J.style,styleSpec:J.styleSpec}))}function te(J,oe){const ae=i.K(J.value),pe=i.J(J.value),_e=J.value!==null?J.value:oe;if(T){if(ae!==T)return[new i.V(J.key,_e,`${ae} stop domain type must match previous stop domain type ${T}`)]}else T=ae;if(ae!=="number"&&ae!=="string"&&ae!=="boolean"&&typeof pe!="number"&&typeof pe!="string"&&typeof pe!="boolean")return[new i.V(J.key,_e,"stop domain value must be a number, string, or boolean")];if(ae!=="number"&&b!=="categorical"){let me=`number expected, ${ae} found`;return i.N(g)&&b===void 0&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(J.key,_e,me)]}return b!=="categorical"||ae!=="number"||typeof pe=="number"&&isFinite(pe)&&Math.floor(pe)===pe?b!=="categorical"&&ae==="number"&&typeof pe=="number"&&typeof E=="number"&&E!==void 0&&pe<E?[new i.V(J.key,_e,"stop domain values must appear in ascending order")]:(E=pe,b==="categorical"&&pe in M?[new i.V(J.key,_e,"stop domain values must be unique")]:(M[pe]=!0,[])):[new i.V(J.key,_e,`integer expected, found ${String(pe)}`)]}}function $i(m){const o=(m.expressionContext==="property"?i.W:i.U)(i.S(m.value),m.valueSpec);if(o.result==="error")return o.value.map(g=>new i.V(`${m.key}${g.key}`,m.value,g.message));const d=o.value.expression||o.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!d.outputDefined())return[new i.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!i.Z(d))return[new i.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return Ws(d,m);if(m.expressionContext==="appearance")return Kt(d,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!i.X(d,["zoom","feature-state"]))return[new i.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!i.Y(d))return[new i.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ws(m,o){const d=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const b of o.valueSpec.expression.parameters)d.delete(b);if(d.size===0)return[];const g=[];return m instanceof i._&&d.has(m.name)?[new i.V(o.key,o.value,`["${m.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(m.eachChild(b=>{g.push(...Ws(b,o))}),g)}function Kt(m,o){const d=new Set;if(o.valueSpec&&o.valueSpec.expression)for(const b of o.valueSpec.expression.parameters)d.add(b);if(d.size===0)return[];const g=[];return m instanceof i._&&!d.has(m.name)?[new i.V(o.key,o.value,`["${m.name}"] is not an allowed parameter`)]:(m.eachChild(b=>{g.push(...Kt(b,o))}),g)}function An(m){const o=m.key,d=m.value,g=m.valueSpec,b=[];return Array.isArray(g.values)?g.values.indexOf(i.J(d))===-1&&b.push(new i.V(o,d,`expected one of [${g.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(g.values).indexOf(i.J(d))===-1&&b.push(new i.V(o,d,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(d)} found`)),b}function Lr(m){return i.a2(i.S(m.value))?$i(Object.assign({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):Tt(m)}function Tt(m){const o=m.value,d=m.key;if(!Array.isArray(o))return[new i.V(d,o,`array expected, ${i.K(o)} found`)];if(o.length<1)return[new i.V(d,o,"filter array must have at least 1 element")];const g=m.styleSpec;let b=An({key:`${d}[0]`,value:o[0],valueSpec:g.filter_operator});const T=()=>{o.length>=2&&(i.a0(o[1])||b.push(new i.V(`${d}[1]`,o[1],`string expected, ${i.K(o[1])} found`)));for(let E=2;E<o.length;E++)i.J(o[1])==="$type"?b=b.concat(An({key:`${d}[${E}]`,value:o[E],valueSpec:g.geometry_type})):i.a0(o[E])||i.L(o[E])||i.$(o[E])||b.push(new i.V(`${d}[${E}]`,o[E],`string, number, or boolean expected, ${i.K(o[E])} found.`))};switch(i.J(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&i.J(o[1])==="$type"&&b.push(new i.V(d,o,`"$type" cannot be use with operator "${o[0]}"`)),o.length!==3&&b.push(new i.V(d,o,`filter array for operator "${o[0]}" must have 3 elements`)),T();break;case"==":case"!=":o.length!==3&&b.push(new i.V(d,o,`filter array for operator "${o[0]}" must have 3 elements`)),T();break;case"in":case"!in":T();break;case"any":case"all":case"none":for(let E=1;E<o.length;E++)b=b.concat(Tt({key:`${d}[${E}]`,value:o[E],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":o.length!==2?b.push(new i.V(d,o,`filter array for "${o[0]}" operator must have 2 elements`)):i.a0(o[1])||b.push(new i.V(`${d}[1]`,o[1],`string expected, ${i.K(o[1])} found`))}return b}function kn(m,o){const d=m.key,g=m.style,b=m.layer,T=m.styleSpec,E=m.value,I=m.objectKey,M=T[`${o}_${m.layerType}`];if(!M)return[];const N=I.match(/^(.*)-use-theme$/);if(N&&M[N[1]])return i.Q(i.S(E))?[].concat(In({key:d,value:E,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:g,styleSpec:T,expressionContext:"property",propertyType:o,propertyKey:I})):In({key:d,value:E,valueSpec:{type:"string"},style:g,styleSpec:T});const j=I.match(/^(.*)-transition$/);if(o==="paint"&&j&&M[j[1]]&&M[j[1]].transition)return In({key:d,value:E,valueSpec:T.transition,style:g,styleSpec:T});const W=m.valueSpec||M[I];if(!W)return[new i.a3(d,E,`unknown property "${I}"`)];let Z;if(i.a0(E)&&i.N(W)&&!W.tokens&&(Z=/^{([^}]+)}$/.exec(E))){const te=`\`{ "type": "identity", "property": ${Z?JSON.stringify(Z[1]):'"_"'} }\``;return[new i.V(d,E,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${te}.`)]}const Y=[];if(m.layerType==="symbol")I!=="text-field"||!g||g.glyphs||g.imports||Y.push(new i.V(d,E,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&i.a4(i.S(E))&&i.J(E.type)==="identity"&&Y.push(new i.V(d,E,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&o==="paint"&&b&&b.layout&&b.layout.hasOwnProperty("model-id")&&i.N(W)&&(i.a5(W)||i.O(W))){const te=i.W(i.S(E),W).value,J="expression"in te&&te.expression||"_styleExpression"in te&&te._styleExpression&&te._styleExpression.expression;J&&!i.X(J,["measure-light"])&&(I==="model-emissive-strength"&&i.Y(J)&&i.Z(J)||Y.push(new i.V(d,E,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Y.concat(In({key:m.key,value:E,valueSpec:W,style:g,styleSpec:T,expressionContext:"property",propertyType:o,propertyKey:I}))}function nr(m){return kn(m,"paint")}function dt(m){return kn(m,"layout")}function Qn(m){let o=[];const d=m.value,g=m.key,b=m.style,T=m.styleSpec;if(!i.H(d))return[new i.V(g,d,"object expected")];d.type||d.ref||o.push(new i.V(g,d,'either "type" or "ref" is required'));let E=i.J(d.type);const I=i.J(d.ref);if(d.id){const M=i.J(d.id);for(let N=0;N<m.arrayIndex;N++){const j=b.layers[N];i.J(j.id)===M&&o.push(new i.V(g,d.id,`duplicate layer id "${M}", previously used at line ${j.id.__line__}`))}}if("ref"in d){let M;["type","source","source-layer","filter","layout"].forEach(N=>{N in d&&o.push(new i.V(g,d[N],`"${N}" is prohibited for ref layers`))}),b.layers.forEach(N=>{i.J(N.id)===I&&(M=N)}),M?M.ref?o.push(new i.V(g,d.ref,"ref cannot reference another ref layer")):E=i.J(M.type):typeof I=="string"&&o.push(new i.V(g,d.ref,`ref layer "${I}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(d.source)if(i.a0(d.source)){const M=b.sources&&b.sources[d.source],N=M&&i.J(M.type);M?N==="vector"&&E==="raster"?o.push(new i.V(g,d.source,`layer "${d.id}" requires a raster source`)):N==="raster"&&E!=="raster"?o.push(new i.V(g,d.source,`layer "${d.id}" requires a vector source`)):N!=="vector"||d["source-layer"]?N==="raster-dem"&&E!=="hillshade"?o.push(new i.V(g,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="raster-array"||["raster","raster-particle"].includes(E)?E==="line"&&d.paint&&(d.paint["line-gradient"]||d.paint["line-trim-offset"])&&N==="geojson"&&!M.lineMetrics?o.push(new i.V(g,d,`layer "${d.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):E==="raster-particle"&&N!=="raster-array"&&o.push(new i.V(g,d.source,`layer "${d.id}" requires a 'raster-array' source.`)):o.push(new i.V(g,d.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new i.V(g,d,`layer "${d.id}" must specify a "source-layer"`)):o.push(new i.V(g,d.source,`source "${d.source}" not found`))}else o.push(new i.V(`${g}.source`,d.source,'"source" must be a string'));else o.push(new i.V(g,d,'missing required property "source"'));return o=o.concat(Ki({key:g,value:d,valueSpec:T.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>In({key:`${g}.type`,value:d.type,valueSpec:T.layer.type,style:m.style,styleSpec:m.styleSpec,object:d,objectKey:"type"}),filter:M=>Lr(Object.assign({layerType:E},M)),layout:M=>Ki({layer:d,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":N=>dt(Object.assign({layerType:E},N))}}),paint:M=>Ki({layer:d,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":N=>nr(Object.assign({layerType:E,layer:d},N))}}),appearances(M){const N=Si({key:M.key,value:M.value,valueSpec:M.valueSpec,style:M.style,styleSpec:M.styleSpec,arrayElementValidator:Z=>function(Y){const{key:te,layer:J,layerType:oe}=Y,ae=i.J(Y.value),pe=i.J(ae.name),_e=i.J(ae.condition),me=Ki({key:te,value:ae,valueSpec:Y.styleSpec.appearance,style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{condition:Le=>function(Ce){const Re=[];return Re.push(...$i({key:Ce.key,value:Ce.object.condition,valueSpec:i.a6.appearance.condition,expressionContext:"appearance"})),Re}(Object.assign({layer:J,layerType:oe},Le)),properties:Le=>function(Ce){const Re=[],{styleSpec:Ae,layer:Te,layerType:ze}=Ce,We=Ae[`paint_${ze}`],Ge=Ae[`layout_${ze}`],ct=Ce.object[Ce.objectKey];for(const ht in ct){const Et=ht in We?"paint":ht in Ge?"layout":void 0;if(!Et){Re.push(new i.V(Ce.key,ht,`unknown property "${ht}" for layer type "${ze}"`));continue}const Ut=Object.assign({},Ce,{key:`${Ce.key}.${ht}`,object:ct,objectKey:ht,layer:Te,layerType:ze,value:ct[ht],valueSpec:Et==="paint"?We[ht]:Ge[ht]});Re.push(...kn(Ut,Et))}return Re}(Object.assign({layer:J,layerType:oe},Le))}});return pe!=="hidden"&&_e===void 0&&me.push(new i.V(Y.key,"name",'Appearance with name different than "hidden" must have a condition')),me}(Object.assign({layerType:E,layer:d},Z))}),j=Array.isArray(M.value)?M.value:[],W=new Set;return j.forEach((Z,Y)=>{const te=i.J(Z.name);if(te)if(W.has(te)){const J=i.J(d.id);N.push(new i.V(M.key,te,`Duplicated appearance name "${te}" for layer "${J}"`))}else W.add(te)}),N}}})),o}function ti({key:m,value:o}){return i.a0(o)?[]:[new i.V(m,o,`string expected, ${i.K(o)} found`)]}const Zi={promoteId:function m({key:o,value:d}){if(i.a0(d))return ti({key:o,value:d});if(Array.isArray(d)){const b=[],T=i.S(d),E=i.U(T);return E.result==="error"&&E.value.forEach(I=>{b.push(new i.V(`${o}${I.key}`,null,`${I.message}`))}),i.X(E.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||b.push(new i.V(`${o}`,null,"promoteId expression should be only feature dependent")),b}if(!i.H(d))return[new i.V(o,d,`string, expression or object expected, "${i.K(d)}" found`)];const g=[];for(const b in d)g.push(...m({key:`${o}.${b}`,value:d[b]}));return g}};function Is(m){const o=m.value,d=m.key,g=m.styleSpec,b=m.style;if(!i.H(o))return[new i.V(d,o,`object expected, ${i.K(o)} found`)];if(!("type"in o))return[new i.V(d,o,'"type" is required')];const T=i.J(o.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(T)&&("url"in o||"tiles"in o||E.push(new i.a3(d,o,'Either "url" or "tiles" is required.'))),T){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(Ki({key:d,value:o,valueSpec:g[`source_${T.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:Zi})),E;case"geojson":if(E=Ki({key:d,value:o,valueSpec:g.source_geojson,style:b,styleSpec:g,objectElementValidators:Zi}),"cluster"in o&&"clusterProperties"in o){if(!i.H(o.clusterProperties))return[new i.V(`${d}.clusterProperties`,o,`object expected, ${i.K(o)} found`)];for(const I in o.clusterProperties){const M=o.clusterProperties[I];if(!Array.isArray(M))return[new i.V(`${d}.clusterProperties.${I}`,M,"array expected")];const[N,j]=M,W=typeof N=="string"?[N,["accumulated"],["get",I]]:N;E.push(...$i({key:`${d}.${I}.map`,value:j,expressionContext:"cluster-map"})),E.push(...$i({key:`${d}.${I}.reduce`,value:W,expressionContext:"cluster-reduce"}))}}return E;case"video":return Ki({key:d,value:o,valueSpec:g.source_video,style:b,styleSpec:g});case"image":return Ki({key:d,value:o,valueSpec:g.source_image,style:b,styleSpec:g});case"canvas":return[new i.V(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return An({key:`${d}.type`,value:o.type,valueSpec:{values:Ln(g)}})}}function Ln(m){return m.source.reduce((o,d)=>{const g=m[d];return g.type.type==="enum"&&(o=o.concat(Object.keys(g.type.values||{}))),o},[])}function Hn(m){const o=m.value,d=m.styleSpec,g=d.light,b=m.style;if(o===void 0)return[];if(!i.H(o))return[new i.V("light",o,`object expected, ${i.K(o)} found`)];let T=[];for(const E in o){const I=E.match(/^(.*)-transition$/),M=E.match(/^(.*)-use-theme$/);T=T.concat(M&&g[M[1]]?In({key:E,value:o[E],valueSpec:{type:"string"},style:b,styleSpec:d}):I&&g[I[1]]&&g[I[1]].transition?In({key:E,value:o[E],valueSpec:d.transition,style:b,styleSpec:d}):g[E]?In({key:E,value:o[E],valueSpec:g[E],style:b,styleSpec:d}):[new i.V(E,o[E],`unknown property "${E}"`)])}return T}function Ke(m){const o=m.value;if(!o)return[];const d=m.key;if(!i.H(o))return[new i.V(d,o,`object expected, ${i.K(o)} found`)];let g=[];const b=m.styleSpec,T=b["light-3d"],E=m.style,I=m.style.lights;for(const j of["type","id"])if(!(j in o))return g=g.concat([new i.V(d,o,`missing property "${j}"`)]),g;if(!i.a0(o.type))return g=g.concat([new i.V(`${d}.type`,o.type,"string expected")]),g;if(I)for(let j=0;j<m.arrayIndex;j++){const W=i.J(o.type),Z=I[j];i.J(Z.type)===W&&g.push(new i.V(d,o.id,`duplicate light type "${o.type}", previously defined at line ${Z.id.__line__}`))}const M=`properties_light_${o.type}`;if(!(M in b))return g=g.concat([new i.V(`${d}.type`,o,`Invalid light type ${o.type}`)]),g;const N=b[M];for(const j in o)if(j==="properties"){const W=o[j];if(!i.H(W))return g=g.concat([new i.V("properties",W,`object expected, ${i.K(W)} found`)]),g;for(const Z in W){const Y=Z.match(/^(.*)-transition$/),te=Z.match(/^(.*)-use-theme$/);g=g.concat(te&&N[te[1]]?In({key:j,value:W[Z],valueSpec:{type:"string"},style:E,styleSpec:b}):Y&&N[Y[1]]&&N[Y[1]].transition?In({key:j,value:o[j],valueSpec:b.transition,style:E,styleSpec:b}):N[Z]?In({key:Z,value:W[Z],valueSpec:N[Z],style:E,styleSpec:b}):[new i.a3(m.key,W[Z],`unknown property "${Z}"`)])}}else g=g.concat(T[j]?In({key:j,value:o[j],valueSpec:T[j],style:E,styleSpec:b}):[new i.a3(j,o[j],`unknown property "${j}"`)]);return g}function sn(m){const o=m.value,d=m.key,g=m.style,b=m.styleSpec,T=b.terrain;if(o==null)return[];if(!i.H(o))return[new i.V("terrain",o,`object expected, ${i.K(o)} found`)];let E=[];for(const I in o){const M=I.match(/^(.*)-transition$/),N=I.match(/^(.*)-use-theme$/);E=E.concat(N&&T[N[1]]?In({key:I,value:o[I],valueSpec:{type:"string"},style:g,styleSpec:b}):M&&T[M[1]]&&T[M[1]].transition?In({key:I,value:o[I],valueSpec:b.transition,style:g,styleSpec:b}):T[I]?In({key:I,value:o[I],valueSpec:T[I],style:g,styleSpec:b}):[new i.a3(I,o[I],`unknown property "${I}"`)])}if(o.source)if(i.a0(o.source)){const I=g.sources&&g.sources[o.source],M=I&&i.J(I.type);I?M!=="raster-dem"&&E.push(new i.V(`${d}.source`,o.source,`terrain cannot be used with a source of type ${M}, it only be used with a "raster-dem" source type`)):E.push(new i.V(`${d}.source`,o.source,`source "${o.source}" not found`))}else E.push(new i.V(`${d}.source`,o.source,"source must be a string"));else E.push(new i.V(d,o,'terrain is missing required property "source"'));return E}function bn(m){const o=m.value,d=m.style,g=m.styleSpec,b=g.fog;if(o===void 0)return[];if(!i.H(o))return[new i.V("fog",o,`object expected, ${i.K(o)} found`)];let T=[];for(const E in o){const I=E.match(/^(.*)-transition$/),M=E.match(/^(.*)-use-theme$/);T=T.concat(M&&b[M[1]]?In({key:E,value:o[E],valueSpec:{type:"string"},style:d,styleSpec:g}):I&&b[I[1]]&&b[I[1]].transition?In({key:E,value:o[E],valueSpec:g.transition,style:d,styleSpec:g}):b[E]?In({key:E,value:o[E],valueSpec:b[E],style:d,styleSpec:g}):[new i.a3(E,o[E],`unknown property "${E}"`)])}return T}const kr={"*":()=>[],array:Si,boolean:function(m){const o=m.value,d=m.key;return i.$(o)?[]:[new i.V(d,o,`boolean expected, ${i.K(o)} found`)]},number:Ri,color:function({key:m,value:o}){return i.a0(o)?i.a1.parseCSSColor(o)===null?[new i.V(m,o,`color expected, "${o}" found`)]:[]:[new i.V(m,o,`color expected, ${i.K(o)} found`)]},enum:An,filter:Lr,function:ks,layer:Qn,object:Ki,source:Is,model:i.a7,light:Hn,"light-3d":Ke,terrain:sn,fog:bn,string:ti,formatted:function(m){return ti(m).length===0?[]:$i(m)},resolvedImage:function(m){return ti(m).length===0?[]:$i(m)},projection:function(m){const o=m.value,d=m.styleSpec,g=d.projection,b=m.style;if(i.H(o)){let T=[];for(const E in o)T=T.concat(In({key:E,value:o[E],valueSpec:g[E],style:b,styleSpec:d}));return T}return i.a0(o)?[]:[new i.V("projection",o,`object or string expected, ${i.K(o)} found`)]},import:function(m){const o=m.key,{value:d,styleSpec:g}=m;if(!i.H(d))return[new i.V(o,d,"import must be an object")];const{data:b,...T}=d;Object.defineProperty(T,"__line__",{value:d.__line__,enumerable:!1});let E=Ki(Object.assign({},m,{value:T,valueSpec:g.import}));return i.J(T.id)===""&&E.push(new i.V(`${m.key}.id`,T,"import id can't be an empty string")),b&&(E=E.concat(Ns(b,g,{key:`${m.key}.data`}))),E},iconset:function(m){const o=m.value,d=m.key,g=m.styleSpec,b=m.style;if(!i.H(o))return[new i.V(d,o,"object expected")];if(!o.type)return[new i.V(d,o,'"type" is required')];const T=i.J(o.type);let E=[];if(E=E.concat(Ki({key:d,value:o,valueSpec:g[`iconset_${T}`],style:b,styleSpec:g})),function(I,M){return!(I!=="source"||!M.source)}(T,o)){const I=b.sources&&b.sources[o.source],M=I&&i.J(I.type);I?M!=="raster-array"&&E.push(new i.V(d,o.source,`iconset cannot be used with a source of type ${String(M)}, it only be used with a "raster-array" source type`)):E.push(new i.V(d,o.source,`source "${o.source}" not found`))}return E}};function In(m,o=!1){const d=m.value,g=m.valueSpec,b=m.styleSpec;if(g.expression){if(i.a4(i.J(d)))return ks(m);if(i.Q(i.S(d)))return $i(m)}if(g.type&&kr[g.type]){const T=kr[g.type](m);return o===!0&&T.length>0&&Array.isArray(m.value)?$i(m):T}return Ki(Object.assign({},m,{valueSpec:g.type?b[g.type]:g}))}function Ki(m){const o=m.key,d=m.value,g=m.valueSpec||{},b=m.objectElementValidators||{},T=m.style,E=m.styleSpec;if(!i.H(d))return[new i.V(o,d,`object expected, ${i.K(d)} found`)];let I=[];for(const M in d){const N=M.split(".")[0];let j;b[N]?j=b[N]:g[N]?j=In:b["*"]?j=b["*"]:g["*"]&&(j=In),j?I=I.concat(j({key:(o&&`${o}.`)+M,value:d[M],valueSpec:g[N]||g["*"],style:T,styleSpec:E,object:d,objectKey:M},d)):I.push(new i.a3(o,d[M],`unknown property "${M}"`))}for(const M in g){if(b[M])continue;const N=g[M];N.required&&N.default===void 0&&d[M]===void 0&&I.push(new i.V(o,d,`missing required property "${M}"`))}return I}function Ta({key:m,value:o}){const d=ti({key:m,value:o});if(d.length)return d;const g=o;return g.indexOf("{fontstack}")===-1&&d.push(new i.V(m,o,'"glyphs" url must include a "{fontstack}" token')),g.indexOf("{range}")===-1&&d.push(new i.V(m,o,'"glyphs" url must include a "{range}" token')),d}function Ns(m,o=i.a6,d={}){return Ki({key:d.key||"",value:m,valueSpec:Object.assign(o.$root,{"*":{type:"*"}}),styleSpec:o,style:m,objectElementValidators:{glyphs:Ta}})}function Ht(m,o=i.a6){return le(Ns(m,o))}const Dn=m=>le(Is(m)),je=m=>le(Hn(m)),jn=m=>le(Ke(m)),Ir=m=>le(sn(m)),Gn=m=>le(bn(m)),cn=m=>le(function(o){const d=o.value,g=o.style,b=o.styleSpec,T=b.snow;if(d===void 0)return[];if(!i.H(d))return[new i.V("snow",d,`object expected, ${i.K(d)} found`)];let E=[];for(const I in d){const M=I.match(/^(.*)-transition$/);E=E.concat(M&&T[M[1]]&&T[M[1]].transition?In({key:I,value:d[I],valueSpec:b.transition,style:g,styleSpec:b}):T[I]?In({key:I,value:d[I],valueSpec:T[I],style:g,styleSpec:b}):[new i.a3(I,d[I],`unknown property "${I}"`)])}return E}(m)),xr=m=>le(function(o){const d=o.value,g=o.style,b=o.styleSpec,T=b.rain;if(d===void 0)return[];if(!i.H(d))return[new i.V("rain",d,`object expected, ${i.K(d)} found`)];let E=[];for(const I in d){const M=I.match(/^(.*)-transition$/);E=E.concat(M&&T[M[1]]&&T[M[1]].transition?In({key:I,value:d[I],valueSpec:b.transition,style:g,styleSpec:b}):T[I]?In({key:I,value:d[I],valueSpec:T[I],style:g,styleSpec:b}):[new i.a3(I,d[I],`unknown property "${I}"`)])}return E}(m)),Qs=m=>le(Qn(m)),Sr=m=>le(Lr(m)),Mi=m=>le(nr(m)),Ye=m=>le(dt(m)),ee=m=>le(i.a7(m));function le(m){return m.slice().sort((o,d)=>o.line&&d.line?o.line-d.line:0)}function ye(m,o){let d=!1;if(o&&o.length)for(const g of o)g instanceof i.a3?i.w(g.message):(m.fire(new i.y(new Error(g.message))),d=!0);return d}const Ne=i.a6.light;let Me;class Ve extends i.E{constructor(o,d="flat"){super(),this._transitionable=new i.a8(Me||(Me=new i.a9({anchor:new i.aa(Ne.anchor),position:new i.ab(Ne.position),color:new i.aa(Ne.color),intensity:new i.aa(Ne.intensity)}))),this.setLight(o,d),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,d,g={}){this._validate(je,o,g)||(this._transitionable.setTransitionOrValue(o),this.id=d)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,g){return(!g||g.validate!==!1)&&ye(this,o.call(Ht,Object.assign({value:d,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}const tt=i.a6.terrain;let Ze=class extends i.E{constructor(m,o,d,g,b){super(),this.scope=d,this._transitionable=new i.a8(new i.a9({source:new i.aa(tt.source),exaggeration:new i.aa(tt.exaggeration)}),d,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o,this.worldview=b}get(){return this._transitionable.serialize()}set(m,o){this._transitionable.setTransitionOrValue(m,o)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new i.ac(m,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const o=m.value.expression;if(!o)return null;let d=-1,g=-1,b=1;for(const T of o.zoomStops)b=o.evaluate(new i.ac(T,{worldview:this.worldview})),b>.01?(d=T,g=-1):g=T;return b<.01&&d>0&&g>d?[d,g]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof i.ad}};const at=45,Mt=65,xt=.05;function dn(m,o,d,g){const b=i.ah(at,Mt,d),[T,E]=Mn(m,g);let I=1-Math.min(1,Math.exp((o-T)/(E-T)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*b*m.alpha}function Mn(m,o){const d=.5/Math.tan(.5*o);return[m.range[0]+d,m.range[1]+d]}function Qt(m,o,d,g,b){const T=i.af([],[o,d,g],b.mercatorFogMatrix);return dn(m,i.ag(T),b.pitch,b._fov)}function Ar(m,o,d,g,b,T,E){const I=[[d,g,0],[b,g,0],[b,T,0],[d,T,0]];let M=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(const j of I){const W=i.af([],j,o),Z=i.ag(W);M=Math.min(M,Z),N=Math.max(N,Z)}return[dn(m,M,E.pitch,E._fov),dn(m,N,E.pitch,E._fov)]}const lr=i.a6.fog;class Er extends i.E{constructor(o,d,g,b){super();const T=new i.a9({range:new i.aa(lr.range),color:new i.aa(lr.color),"color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.aa(lr["high-color"]),"high-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.aa(lr["space-color"]),"space-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.aa(lr["horizon-blend"]),"star-intensity":new i.aa(lr["star-intensity"]),"vertical-range":new i.aa(lr["vertical-range"])});this._transitionable=new i.a8(T,g,new Map(b)),this.set(o,b),this._transitioning=this._transitionable.untransitioned(),this._transform=d,this.properties=new i.ai(T),this.scope=g}get state(){const o=this._transform,d=o.projection.name==="globe",g=i.aj(o.zoom),b=this.properties.get("range"),T=[.5,3];return{range:d?[i.ak(T[0],b[0],g),i.ak(T[1],b[1],g)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,d,g={}){if(this._validate(Gn,o,g))return;const b=Object.assign({},o);for(const T of Object.keys(lr))b[T]===void 0&&(b[T]=lr[T].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,d)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ah(at,Mt,o))*d.a}getOpacityAtLatLng(o,d){return this._transform.projection.supportsFog?function(g,b,T){const E=i.ae.fromLngLat(b),I=T.elevation?T.elevation.getAtPointOrZero(E):0;return Qt(g,E.x,E.y,I,T)}(this.state,o,d):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];const d=this._transform.calculateFogTileMatrix(o.toUnwrapped());return Ar(this.state,d,0,0,i.al,i.al,this._transform)}getOpacityForBounds(o,d,g,b,T){return this._transform.projection.supportsFog?Ar(this.state,o,d,g,b,T,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?Mn(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;const d=[4,5,6,7];for(const g of d){const b=o.points[g];let T;if(b[2]>=0)T=b;else{const E=o.points[g-4];T=i.am(E,b,E[2]/(E[2]-b[2]))}if(Qt(this.state,T[0],T[1],0,this._transform)>=xt)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,g){return(!g||g.validate!==!1)&&ye(this,o.call(Ht,Object.assign({value:d,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let ni,Ms,as,Qi,vs=class extends i.E{constructor(m,o,d,g){super();const b=ni||(ni=new i.a9({density:new i.aa(i.a6.snow.density),intensity:new i.aa(i.a6.snow.intensity),color:new i.aa(i.a6.snow.color),opacity:new i.aa(i.a6.snow.opacity),vignette:new i.aa(i.a6.snow.vignette),"vignette-color":new i.aa(i.a6.snow["vignette-color"]),"center-thinning":new i.aa(i.a6.snow["center-thinning"]),direction:new i.aa(i.a6.snow.direction),"flake-size":new i.aa(i.a6.snow["flake-size"])}));this._transitionable=new i.a8(b,d,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(b),this.scope=d}get state(){const m=this.properties.get("opacity"),o=this.properties.get("color"),d=this.properties.get("direction"),g=i.an(d[0]),b=-Math.max(i.an(d[1]),.01),T=[Math.cos(g)*Math.cos(b),Math.sin(g)*Math.cos(b),Math.sin(b)],E=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=E,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(o.r,o.g,o.b,o.a*m),direction:T,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(m,o,d={}){if(this._validate(cn,m,d))return;const g=Object.assign({},m),b=i.a6.snow;for(const T of Object.keys(b))g[T]===void 0&&(g[T]=b[T].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,o,d){return(!d||d.validate!==!1)&&ye(this,m.call(Ht,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}},Hi=class extends i.E{constructor(m,o,d,g){super();const b=Ms||(Ms=new i.a9({density:new i.aa(i.a6.rain.density),intensity:new i.aa(i.a6.rain.intensity),color:new i.aa(i.a6.rain.color),opacity:new i.aa(i.a6.rain.opacity),vignette:new i.aa(i.a6.rain.vignette),"vignette-color":new i.aa(i.a6.rain["vignette-color"]),"center-thinning":new i.aa(i.a6.rain["center-thinning"]),direction:new i.aa(i.a6.rain.direction),"droplet-size":new i.aa(i.a6.rain["droplet-size"]),"distortion-strength":new i.aa(i.a6.rain["distortion-strength"])}));this._transitionable=new i.a8(b,d,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(b),this.scope=d}get state(){const m=this.properties.get("opacity"),o=this.properties.get("color"),d=this.properties.get("direction"),g=i.an(d[0]),b=-Math.max(i.an(d[1]),.01),T=[Math.cos(g)*Math.cos(b),Math.sin(g)*Math.cos(b),Math.sin(b)],E=this.properties.get("vignette-color");return E.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(o.r,o.g,o.b,o.a*m),direction:T,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(m,o,d={}){if(this._validate(xr,m,d))return;const g=Object.assign({},m),b=i.a6.rain;for(const T of Object.keys(b))g[T]===void 0&&(g[T]=b[T].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,o,d){return(!d||d.validate!==!1)&&ye(this,m.call(Ht,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}};class $r extends i.E{constructor(o,d,g,b){super(),this.scope=g,this._options=o,this.properties=new i.ai(d),this._transitionable=new i.a8(d,g,new Map(b)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,d){this._options=o,this._transitionable.setTransitionOrValue(o.properties,d)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Ps{constructor(o,d,g){this.screenBounds=o,this.cameraPoint=g.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(o,d){let g,b;if(o instanceof i.P||typeof o[0]=="number"){const T=i.P.convert(o);g=[T],b=d.isPointAboveHorizon(T)}else{const T=i.P.convert(o[0]),E=i.P.convert(o[1]),I=T.add(E)._div(2);g=[T,E],b=i.aq(T,E).every(M=>d.isPointAboveHorizon(M))&&d.isPointAboveHorizon(I)}return new Ps(g,b,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return i.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const d=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],b=i.aq(d,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<g.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),i.ar(b,o)}bufferedCameraGeometryGlobe(o){const d=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],b=i.aq(d,g,o),T=this.cameraPoint.clone();switch(3*((T.y>d.y)+(T.y>g.y))+((T.x>d.x)+(T.x>g.x))){case 0:b[0]=T,b[4]=T.clone();break;case 1:b.splice(1,0,T);break;case 2:b[1]=T;break;case 3:b.splice(4,0,T);break;case 5:b.splice(2,0,T);break;case 6:b[3]=T;break;case 7:b.splice(3,0,T);break;case 8:b[2]=T}return b}containsTile(o,d,g,b=0){const T=Math.max(o.queryPadding,o.evaluateQueryRenderedFeaturePadding())/d._pixelsPerMercatorPixel+1,E=g?this._bufferedCameraMercator(T,d):this._bufferedScreenMercator(T,d);let I=o.tileID.wrap+(E.unwrapped?b:0);const M=E.polygon.map(oe=>i.as(o.tileTransform,oe,I));if(!i.at(M,0,0,i.al,i.al))return;I=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const N=this.screenGeometryMercator.polygon.map(oe=>i.au(o.tileTransform,oe,I)),j=N.map(oe=>new i.P(oe[0],oe[1])),W=d.getFreeCameraOptions().position||new i.ae(0,0,0),Z=i.au(o.tileTransform,W,I),Y=N.map(oe=>{const ae=i.av(oe,oe,Z);return i.aw(ae,ae),new i.ax(Z,ae)}),te=i.ay(o,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:j,tilespaceRays:Y,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(J=i.az(M),J.min.x=i.aA(J.min.x,0,i.al),J.min.y=i.aA(J.min.y,0,i.al),J.max.x=i.aA(J.max.x,0,i.al),J.max.y=i.aA(J.max.y,0,i.al),J),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:te};var J}_bufferedScreenMercator(o,d){const g=ca(o);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),d):{polygon:this.bufferedScreenGeometry(o).map(T=>d.pointCoordinate3D(T)),unwrapped:!0},this._screenRaycastCache[g]=b,b}}_bufferedCameraMercator(o,d){const g=ca(o);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),d):{polygon:this.bufferedCameraGeometry(o).map(T=>d.pointCoordinate3D(T)),unwrapped:!0},this._cameraRaycastCache[g]=b,b}}_projectAndResample(o,d){const g=function(T,E){const I=i.aB([],E.pixelMatrix,E.globeMatrix),M=[0,-i.aD,0,1],N=[0,i.aD,0,1],j=[0,0,0,1];i.aC(M,M,I),i.aC(N,N,I),i.aC(j,j,I);const W=new i.P(M[0]/M[3],M[1]/M[3]),Z=new i.P(N[0]/N[3],N[1]/N[3]),Y=i.aE(T,W)&&M[3]<j[3],te=i.aE(T,Z)&&N[3]<j[3];if(!Y&&!te)return null;const J=function(Re,Ae,Te){for(let ze=1;ze<Re.length;ze++){const We=ri(Ae.pointCoordinate3D(Re[ze-1]).x),Ge=ri(Ae.pointCoordinate3D(Re[ze]).x);if(Te<0){if(We<Ge)return{idx:ze,t:-We/(Ge-1-We)}}else if(Ge<We)return{idx:ze,t:(1-We)/(Ge+1-We)}}return null}(T,E,Y?-1:1);if(!J)return null;const{idx:oe,t:ae}=J;let pe=oe>1?Ji(T.slice(0,oe),E):[],_e=oe<T.length?Ji(T.slice(oe),E):[];pe=pe.map(Re=>new i.P(ri(Re.x),Re.y)),_e=_e.map(Re=>new i.P(ri(Re.x),Re.y));const me=[...pe];me.length===0&&me.push(_e[_e.length-1]);const Le=i.ak(me[me.length-1].y,(_e.length===0?pe[0]:_e[0]).y,ae);let Ce;return Ce=Y?[new i.P(0,Le),new i.P(0,0),new i.P(1,0),new i.P(1,Le)]:[new i.P(1,Le),new i.P(1,1),new i.P(0,1),new i.P(0,Le)],me.push(...Ce),_e.length===0?me.push(pe[0]):me.push(..._e),{polygon:me.map(Re=>new i.ae(Re.x,Re.y)),unwrapped:!1}}(o,d);if(g)return g;const b=function(T,E){let I=!1,M=-1/0,N=0;for(let W=0;W<T.length-1;W++)T[W].x>M&&(M=T[W].x,N=W);for(let W=0;W<T.length-1;W++){const Z=(N+W)%(T.length-1),Y=T[Z],te=T[Z+1];Math.abs(Y.x-te.x)>.5&&(Y.x<te.x?(Y.x+=1,Z===0&&(T[T.length-1].x+=1)):(te.x+=1,Z+1===T.length-1&&(T[0].x+=1)),I=!0)}const j=i.aF(E.center.lng);return I&&j<Math.abs(j-1)&&T.forEach(W=>{W.x-=1}),{polygon:T,unwrapped:I}}(Ji(o,d).map(T=>new i.P(ri(T.x),T.y)),d);return{polygon:b.polygon.map(T=>new i.ae(T.x,T.y)),unwrapped:b.unwrapped}}}function Ji(m,o){return i.aG(m,d=>{const g=o.pointCoordinate3D(d);d.x=g.x,d.y=g.y},1/256)}function ri(m){return m<0?1+m%1:m%1}function ca(m){return 100*m|0}function Ro(m,o,d,g,b){const T=function(I,M){if(I)return b(I);if(M){if(m.url&&M.tiles&&m.tiles&&delete m.tiles,M.variants){if(!Array.isArray(M.variants))return b(new Error("variants must be an array"));for(const j of M.variants){if(j==null||typeof j!="object"||j.constructor!==Object)return b(new Error("variant must be an object"));if(!Array.isArray(j.capabilities))return b(new Error("capabilities must be an array"));if(j.capabilities.length===1&&j.capabilities[0]==="meshopt"){M=Object.assign(M,j);break}}}const N=i.aH(Object.assign({},M,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);N.tiles=o.canonicalizeTileset(N,m.url),b(null,N)}},E=function(I,M,N){if(!I)return null;if(!M&&!N)return I;N=N||I.worldview_default;const j=Object.values(I.language||{});if(j.length===0)return null;const W=Object.values(I.worldview||{});if(W.length===0)return null;const Z=j.every(te=>te===M),Y=W.every(te=>te===N);return Z&&Y?I:M in(I.language_options||{})||N in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(m.data,d,g);return E?i.o.frame(()=>T(null,E)):m.url?i.m(o.transformRequest(o.normalizeSourceURL(m.url,null,d,g),i.R.Source),T):i.o.frame(()=>{const{data:I,...M}=m;T(null,M)})}function jo(m,o){const d=Math.pow(2,o.z),g=Math.floor(i.aF(m.getWest())*d),b=Math.floor(i.aJ(m.getNorth())*d),T=Math.ceil(i.aF(m.getEast())*d),E=Math.ceil(i.aJ(m.getSouth())*d);return o.x>=g&&o.x<T&&o.y>=b&&o.y<E}class wo{constructor(o,d,g){this.bounds=o?i.aI.convert(this.validateBounds(o)):null,this.minzoom=d||0,this.maxzoom=g||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}addExtraBounds(o){if(o){this.extraBounds||(this.extraBounds=[]);for(const d of o)this.extraBounds.push(i.aI.convert(this.validateBounds(d)))}}contains(o){if(o.z>this.maxzoom||o.z<this.minzoom||this.bounds&&!jo(this.bounds,o))return!1;if(!this.extraBounds)return!0;for(const d of this.extraBounds)if(jo(d,o))return!0;return!1}static fromTileJSON(o){if(!o.bounds&&!o.extra_bounds)return null;const d=new wo(o.bounds,o.minzoom,o.maxzoom);return d.addExtraBounds(o.extra_bounds),d}}class ju extends i.E{constructor(o,d,g,b){if(super(),this.id=o,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,i.aH(d,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},d),this._collectResourceTiming=!!d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new i.aK}load(o){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map.getWorldview();this._tileJSONRequest=Ro(this._options,this.map._requestManager,d,g,(b,T)=>{if(this._tileJSONRequest=null,this._loaded=!0,b)d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),g&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new i.y(b));else if(T){if(Object.assign(this,T),this.hasWorldviews=!!T.worldview_options,T.worldview_default&&(this.worldviewDefault=T.worldview_default),T.vector_layers){this.vectorLayers=T.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const E of T.vector_layers)this.vectorLayerIds.push(E.id),T.worldview&&T.worldview[E.source]&&this.localizableLayerIds.add(E.id)}this.tileBounds=wo.fromTileJSON(T),Fe(T.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}o&&o(b)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(o,d){const g=o.tileID.canonical.url(this.tiles,this.scheme),b=this.map._requestManager.normalizeTileURL(g),T=this.map._requestManager.transformRequest(b,i.R.Tile),E=this.map.style?this.map.style.getLut(this.scope):null,I=E?{image:E.image.clone()}:null,M={request:T,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&i.h(g)&&(M.localizableLayerIds=this.localizableLayerIds),M.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=d:o.request=o.actor.send("reloadTile",M,N.bind(this));else if(o.actor=this._tileWorkers[b]=this._tileWorkers[b]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",M,N.bind(this),void 0,!0);else{const j=i.aL.call({deduped:this._deduped},M,(W,Z)=>{if(W||!Z)N.call(this,W);else{const Y=i.aM(Z.responseHeaders);M.data={rawData:Z.rawData.slice(0),expires:Y.expires,cacheControl:Y.cacheControl},o.actor&&o.actor.send("loadTile",M,N.bind(this),void 0,!0)}},!0);o.request={cancel:j}}function N(j,W){return delete o.request,o.aborted?d(null):j&&j instanceof i.aN&&j.status!==404?d(j):(W&&W.resourceTiming&&(o.resourceTiming=W.resourceTiming),this.map._refreshExpiredTiles&&W&&o.setExpiryData(W),o.loadVectorData(W,this.map.painter),i.aO(this.dispatcher),d(null,W),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,d){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class po extends i.E{constructor(o,d,g,b){super(),this.id=o,this.dispatcher=g,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},d),Object.assign(this,i.aH(d,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const d=this.map.getWorldview();this._tileJSONRequest=Ro(this._options,this.map._requestManager,null,d,(g,b)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new i.y(g)):b&&(Object.assign(this,b),b.raster_layers&&(this.rasterLayers=b.raster_layers,this.rasterLayerIds=this.rasterLayers.map(T=>T.id)),this.tileBounds=wo.fromTileJSON(b),Fe(b.tiles),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),o&&o(g)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,d){const g=i.o.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);o.request=i.n(this.map._requestManager.transformRequest(b,i.R.Tile),(T,E,I)=>{if(delete o.request,o.aborted)return o.state="unloaded",d(null);if(T)return o.state="errored",d(T);if(!E)return d(null);const M=i.aM(I);this.map._refreshExpiredTiles&&o.setExpiryData(M),o.setTexture(E,this.map.painter),o.state="loaded",i.aO(this.dispatcher),d(null)})}abortTile(o,d){o.request&&(o.request.cancel(),delete o.request),d&&d()}unloadTile(o,d){o.texture&&o.texture instanceof i.T?(o.destroy(!1),o.texture&&o.texture instanceof i.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),d&&d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function gu([m,o],d,g,{scaled:b=!0}={}){const{tileSize:T,buffer:E}=g,{x:I,y:M,z:N}=d;if(!isFinite(I)||!isFinite(M)||!isFinite(N))throw new Error("Invalid MRT header");const j=2**N,W=j*i.aF(m),Z=j*i.aJ(o);return function([Y,te],J,{scaled:oe=!0}={}){if(!J)throw new Error("bandView is undefined");const{data:ae,tileSize:pe,buffer:_e,offset:me,scale:Le,dimension:Ce}=J;if(Y<-_e||Y>pe+_e||te<-_e||te>pe+_e)throw new Error(`Point (${Y}, ${te}) out of bounds for tileSize=${pe}, buffer=${_e}`);const Re=(te+_e)*(pe+2*_e)+(Y+_e);if(new Uint32Array(ae.buffer)[Re]===4294967295)return null;let Ae=[];Ae=oe?[]:new J.data.constructor(Ce);for(let Te=0;Te<Ce;Te++)Ae[Te]=Math.round(1e12*(ae[Ce*Re+Te]*Le+me))/1e12;return Ae}([Math.min(Math.max(-E,Math.floor((W-I)*T)),T-1+E),Math.min(Math.max(-E,Math.floor((Z-M)*T)),T-1+E)],g,{scaled:b})}class _l extends po{constructor(o,d,g,b){super(o,d,g,b),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},d)}triggerRepaint(o){const d=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);d&&d.enabled&&g&&d._clearRenderCacheForTile(g.id,o.tileID),this.map.triggerRepaint()}loadTile(o,d){const g=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(g,i.R.Tile),T={request:b,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=b,o.actor||(o.actor=this.dispatcher.getActor());const E=(I,M,N)=>{if(delete o.request,o.aborted)return o.state="unloaded",d(null);if(I)return I.name==="AbortError"?void 0:(o.state="errored",d(I));if(this.map._refreshExpiredTiles&&M){const j=i.aM(N);o.setExpiryData(j)}if(this.partial&&o.state!=="expired")o.state="empty";else if(!this.partial){if(!M)return d(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=M}d(null)};o.request=this.partial?o.fetchHeader(void 0,E.bind(this)):o.actor.send("loadTile",T,E.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,d){const g=o.texturePerLayer;if(o.flushAllQueues(),g.size){o.destroy(!1);for(const b of g.values())this.map.painter.saveTileTexture(b)}else o.destroy()}prepareTile(o,d,g,b){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBandForRender(d,g,b,(T,E)=>{if(T)return o.state="errored",this.fire(new i.y(T)),void this.triggerRepaint(o);E&&(o._isHeaderLoaded=!0,o.setTexturePerLayer(g,E,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;const d=this.rasterLayers.find(({id:T})=>T===o),g=d&&d.fields,b=g&&g.bands&&g.bands;return b?b[0]:0}getTextureDescriptor(o,d,g){if(!o)return;const b=d.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!b)return;let T=null;d instanceof i.aR?T=d.paint.get("raster-array-band"):d instanceof i.aS&&(T=d.paint.get("raster-particle-array-band"));const E=T||this.getInitialBand(b);if(E==null)return;if(!o.textureDescriptorPerLayer.get(d.id))return void this.prepareTile(o,b,d.id,E);if(o.updateNeeded(d.id,E)&&!g)return;const I=o.textureDescriptorPerLayer.get(d.id);return Object.assign({},I,{texture:o.texturePerLayer.get(d.id)})}getImages(o,d){const g=new Map;for(const b of o)for(const T of d){const[E,I]=T.split("/"),M=b.getLayer(E);if(!M||!M.hasBand(I)||!M.hasDataForBand(I))continue;const{bytes:N,tileSize:j,buffer:W}=M.getBandView(I),Z=j+2*W,Y={data:new i.q({width:Z,height:Z},N),pixelRatio:2,sdf:!1,usvg:!1,version:0};g.set(T,Y)}return g}queryRasterArrayValueByBandId(o,d,g){const b=d._mrt;return new Promise(T=>{const E={},I=new Set;for(const[M,N]of Object.entries(b.layers)){if(g.layerName&&M!==g.layerName)continue;const j={};E[M]=j;for(const{bands:W}of N.dataIndex)for(const Z of W)g.bands&&!g.bands.includes(Z)||(I.add(i.B(M,Z)),d.fetchBand(M,null,Z,Y=>{i.o.frame(()=>{j[Z]=Y?null:gu([o.lng,o.lat],b,N.getBandView(Z)),I.delete(i.B(M,Z)),I.size===0&&T(E)})},!1))}I.size===0&&T(E)})}_loadTileForQuery(o,d){if(this._loadTileLoaded[o.uid])return void d(null,o._mrt);if(this._loadTilePending[o.uid])return void this._loadTilePending[o.uid].push(d);this._loadTilePending[o.uid]=[d];const g=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(g,i.R.Tile);o.actor.send("loadTile",{request:b,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(T,E,I)=>{if(T)return this._loadTilePending[o.uid].forEach(M=>M(T,null)),void delete this._loadTilePending[o.uid];if(!E)return this._loadTilePending[o.uid].forEach(M=>M(null,null)),void delete this._loadTilePending[o.uid];if(this.map._refreshExpiredTiles&&E){const M=i.aM(I);o.setExpiryData(M)}o._mrt=E,o._isHeaderLoaded=!0,o.state="loaded",this._loadTilePending[o.uid].forEach(M=>M(null,E)),this._loadTileLoaded[o.uid]=!0,delete this._loadTilePending[o.uid]},void 0,!0)}queryRasterArrayValueByAllBands(o,d,g){return new Promise((b,T)=>{this._loadTileForQuery(d,(E,I)=>{E?T(E):b(I?this.queryRasterArrayValueByBandId(o,d,g):null)})})}queryRasterArrayValue(o,d){const g=i.aT.convert(o),b=this.findLoadedParent(g);return b&&b._mrt?d.bands||!this.partial?this.queryRasterArrayValueByBandId(g,b,d):this.queryRasterArrayValueByAllBands(g,b,d):Promise.resolve(null)}findLoadedParent(o){const d=i.ae.fromLngLat(o,this.map.transform.tileSize),g=this.maxzoom+1,b=1<<g,T=Math.floor(d.x),E=Math.floor((d.x-T)*b),I=Math.floor(d.y*b),M=this.map.style.getSourceCache(this.id),N=new i.aQ(g,T,g,E,I);return M.findLoadedParent(N,this.minzoom)}}const Wc={vector:ju,raster:po,"raster-dem":class extends po{constructor(m,o,d,g){super(m,o,d,g),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(m,o){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(b,T){b&&(m.state="errored",o(b)),T&&(m.dem=T,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",o(null))}m.request=i.n(this.map._requestManager.transformRequest(d,i.R.Tile),(function(b,T,E){if(delete m.request,m.aborted)m.state="unloaded",o(null);else if(b)m.state="errored",o(b);else if(T){const I=i.aM(E);this.map._refreshExpiredTiles&&m.setExpiryData(I);const M=ImageBitmap&&T instanceof ImageBitmap&&i.r(),N=1-(T.width-i.aP(T.width))/2;N<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const j=M?T:i.o.getImageData(T,N),W={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:j,encoding:this.encoding,padding:N};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",W,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const o=m.canonical,d=Math.pow(2,o.z),g=(o.x-1+d)%d,b=o.x===0?m.wrap-1:m.wrap,T=(o.x+1+d)%d,E=o.x+1===d?m.wrap+1:m.wrap,I={};return I[new i.aQ(m.overscaledZ,b,o.z,g,o.y).key]={backfilled:!1},I[new i.aQ(m.overscaledZ,E,o.z,T,o.y).key]={backfilled:!1},o.y>0&&(I[new i.aQ(m.overscaledZ,b,o.z,g,o.y-1).key]={backfilled:!1},I[new i.aQ(m.overscaledZ,m.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},I[new i.aQ(m.overscaledZ,E,o.z,T,o.y-1).key]={backfilled:!1}),o.y+1<d&&(I[new i.aQ(m.overscaledZ,b,o.z,g,o.y+1).key]={backfilled:!1},I[new i.aQ(m.overscaledZ,m.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},I[new i.aQ(m.overscaledZ,E,o.z,T,o.y+1).key]={backfilled:!1}),I}},"raster-array":_l,geojson:class extends i.E{constructor(m,o,d,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(g),this._data=o.data,this._options=Object.assign({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const b=i.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*b,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*b,extent:i.al,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:i.al,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*b,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new i.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new i.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const o=new Map;for(const d of this._data.features)o.set(d.id,d);for(const d of m.features)o.set(d.id,d);this._data.features=[...o.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},o),this}getClusterChildren(m,o){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},o),this}getClusterLeaves(m,o,d,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:o,offset:d},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.z("dataloading",{dataType:"source"})),this._loaded=!1;const o=Object.assign({append:m},this.workerOptions);o.scope=this.scope;const d=this._data;typeof d=="string"?(o.request=this.map._requestManager.transformRequest(i.o.resolveURL(d),i.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(d),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(g,b)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new i.y(g));else{const T={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(T.resourceTiming=b.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new i.z("data",T)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const m=i.B(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,o){const d=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const g=this.map.style?this.map.style.getLut(this.scope):null,b=g?{image:g.image.clone()}:null,T=this._partialReload,E={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:b,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:m.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:T,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};m.request=this.actor.send(d,E,(I,M)=>T&&!M?(m.state="loaded",o(null)):(delete m.request,m.destroy(!1),m.aborted?o(null):I?o(I):(m.loadVectorData(M,this.map.painter,d==="reloadTile"),o(null))),void 0,d==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,o){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aU{constructor(m,o,d,g){super(m,o,d,g),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const o of m.urls)this.urls.push(this.map._requestManager.transformRequest(o,i.R.Source).url);i.aV(this.urls,(o,d)=>{this._loaded=!0,o?this.fire(new i.y(o)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const o=this.video.seekable;m<o.start(0)||m>o.end(0)?this.fire(new i.y(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,o=m.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(m,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aU,model:i.aX,"batched-model":class extends i.E{constructor(m,o,d,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=d,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(m))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=Ro(this._options,this.map._requestManager,o,d,(g,b)=>{this._tileJSONRequest=null,this._loaded=!0,g?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),d&&d.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new i.y(g))):b&&(Object.assign(this,b),b.bounds&&(this.tileBounds=new wo(b.bounds,this.minzoom,this.maxzoom)),Fe(b.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,o){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(d,i.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.o.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=o;else{if(m.buckets){const T=Object.values(m.buckets);for(const E of T)E.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,b.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,b.bind(this),void 0,!0);function b(T,E){return m.aborted?o(null):T&&T.status!==404?o(T):(this.map._refreshExpiredTiles&&E&&m.setExpiryData(E),m.loadModelData(E,this.map.painter),m.state="loaded",void o(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends i.aU{constructor(m,o,d,g){super(m,o,d,g),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(T=>typeof T!="number"))||this.fire(new i.y(new i.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.y(new i.V(`sources.${m}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new i.y(new i.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new i.y(new i.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.y(new i.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof i.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends i.E{constructor(m,o,d,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=o,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new wo(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,i.aH(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:o,y:d,z:g}=m.canonical;return this._implementation.hasTile({x:o,y:d,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,o){const{x:d,y:g,z:b}=m.tileID.canonical,T=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:d,y:g,z:b},{signal:T.signal})).then((function(E){return delete m.request,m.aborted?(m.state="unloaded",o(null)):E===void 0?(m.state="errored",o(null)):E===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",o(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(E)?(this.loadTileData(m,E),m.state="loaded",void o(null)):(m.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.name!=="AbortError"&&(m.state="errored",o(E))}),m.request.cancel=()=>T.abort()}loadTileData(m,o){m.setTexture(o,this.map.painter)}unloadTile(m,o){if(m.texture&&m.texture instanceof i.T?(m.destroy(!1),m.texture&&m.texture instanceof i.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:d,y:g,z:b}=m.tileID.canonical;this._implementation.unloadTile({x:d,y:g,z:b})}o&&o()}abortTile(m,o){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=i.B(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}}},To=function(m,o,d,g){const b=new Wc[o.type](m,o,d,g);if(b.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${b.id}`);return i.aY(["load","abort","unload","serialize","prepare"],b),b};function Mf(m,o,d=""){return`${d}:${o.id||""}:${o.layer.id}:${function(g){if("layerId"in g)return`layer:${g.layerId}`;{const{featuresetId:b,importId:T}=g;return`featureset:${b}${T?`:import:${T}`:""}`}}(m.target)}`}function Vp(m,o,d,g=""){if(m.uniqueFeatureID){const b=Mf(m,o,g);if(d.has(b))return!0;d.add(b)}return!1}function ey(m,o,d,g,b=!1){const T=o.sourceCache.transform,E=o.sourceCache.tilesIn(m,o.has3DLayers,b);E.sort($0);const I=[];for(const M of E){const N=M.tile.queryRenderedFeatures(o,M,d,g,T,b);Object.keys(N).length&&I.push({wrappedTileID:M.tile.tileID.wrapped().key,queryResults:N})}for(const M in o.layers){const N=o.layers[M];if(N.styleLayer){const j=N.styleLayer.queryRenderedFeatures(m,o.sourceCache,g);Object.keys(j).length&&I.push({wrappedTileID:0,queryResults:j})}}return I.length===0?{}:function(M){const N={},j={};for(const W of M){const Z=W.queryResults,Y=W.wrappedTileID,te=j[Y]=j[Y]||{};for(const J in Z){const oe=Z[J],ae=te[J]=te[J]||{},pe=N[J]=N[J]||[];for(const _e of oe)ae[_e.featureIndex]||(ae[_e.featureIndex]=!0,pe.push(_e))}}return N}(I)}function ty(m,o,d,g,b,T){const E={},I=g.queryRenderedSymbols(m),M=[];for(const N of Object.keys(I).map(Number))M.push(b[N]);M.sort($0);for(const N of M){const j=N.featureIndex.lookupSymbolFeatures(I[N.bucketInstanceId],N.bucketIndex,N.sourceLayerIndex,o,d,T);for(const W in j){const Z=E[W]=E[W]||[],Y=j[W];Y.sort((te,J)=>{const oe=N.featureSortOrder;if(oe){const ae=oe.indexOf(te.featureIndex);return oe.indexOf(J.featureIndex)-ae}return J.featureIndex-te.featureIndex});for(const te of Y)Z.push(te)}}return E}function ny(m,o){const d=m.getRenderableIds().map(T=>m.getTileByID(T)),g=[],b={};for(let T=0;T<d.length;T++){const E=d[T],I=E.tileID.canonical.key;b[I]||(b[I]=!0,E.querySourceFeatures(g,o))}return g}function $0(m,o){const d=m.tileID,g=o.tileID;return d.overscaledZ-g.overscaledZ||d.canonical.y-g.canonical.y||d.wrap-g.wrap||d.canonical.x-g.canonical.x}function Xc(m,o){const d={};if(!o)return d;for(const g of m){const b=g.layerIds.map(T=>o.getLayer(T)).filter(Boolean);if(b.length!==0){g.layers=b,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(T=>b.filter(E=>E.id===T)[0]));for(const T of b)d[T.fqid]=g}}return d}const Nl=32,_c=33,yc=new Uint16Array(8184);for(let m=0;m<2046;m++){let o=m+2,d=0,g=0,b=0,T=0,E=0,I=0;for(1&o?b=T=E=Nl:d=g=I=Nl;(o>>=1)>1;){const N=d+b>>1,j=g+T>>1;1&o?(b=d,T=g,d=E,g=I):(d=b,g=T,b=E,T=I),E=N,I=j}const M=4*m;yc[M+0]=d,yc[M+1]=g,yc[M+2]=b,yc[M+3]=T}const Uu=new Uint16Array(2178),Yc=new Uint8Array(1089),Ch=new Uint16Array(1089);function Pf(m){return m===0?-.03125:m===32?.03125:0}const ry={type:2,extent:i.al,loadGeometry:()=>[[new i.P(0,0),new i.P(i.al+1,0),new i.P(i.al+1,i.al+1),new i.P(0,i.al+1),new i.P(0,0)]]};class Of{constructor(o,d,g,b,T,E){this.tileID=o,this.uid=i.b2(),this.uses=0,this.tileSize=d,this.tileZoom=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=T,b&&b.style&&(this._lastUpdatedBrightness=b.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",b&&b.transform&&(this.projection=b.transform.projection),this.worldview=E,this._hasAppearances=null}registerFadeDuration(o){const d=o+this.timeAdded;d<i.o.now()||this.fadeEndTime&&d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,d,g){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=Xc(o.buckets,d.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const T=this.buckets[b];if(T instanceof i.b4){if(this.hasSymbolBuckets=!0,!g)break;T.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const T=this.buckets[b];if(T instanceof i.b4&&T.hasRTLText){this.hasRTLText=!0,i.b5();break}}this.queryPadding=0;for(const b in this.buckets){const T=this.buckets[b],E=d.style.getOwnLayer(b);if(!E)continue;const I=E.queryRadius(T);this.queryPadding=Math.max(this.queryPadding,I)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new i.b3}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,d,g){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,Xc(o.buckets,d.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o,d){for(const T in this.buckets){const E=this.buckets[T];if(E.uploadPending()){let I={},M=[],N={zoom:0,pitch:0,brightness:0,worldview:""};if(d){if(d.style){M=d.style.listImages();const j=E.layers[0],W=j.sourceLayer||"_geojsonTileLayer",Z=d.style.getLayerSourceCache(j);Z&&(I=Z._state.getState(W,void 0))}N={zoom:d.transform.zoom||0,pitch:d.transform.pitch||0,brightness:d.style.getBrightness()||0,worldview:d.worldview||""}}E.upload(o,this.tileID.canonical,I,M,N)}}const g=o.gl,b=this.imageAtlas;b&&!b.uploaded&&(this.imageAtlasTexture=new i.T(o,b.image,g.RGBA8,{useMipmap:!!b.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(o,this.glyphAtlasImage,g.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(o,this.lineAtlas.image,g.R8),this.lineAtlas.uploaded=!0)}prepare(o,d,g){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,g),!d||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const b=d.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(d)),(this._lastUpdatedBrightness||b||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&b&&Math.abs(this._lastUpdatedBrightness-b)<.001||(this.updateBuckets(d,this._lastUpdatedBrightness!==b),this._lastUpdatedBrightness=b))}evaluateQueryRenderedFeaturePadding(){let o=0;for(const d in this.buckets){const g=this.buckets[d];g.evaluateQueryRenderedFeaturePadding&&(o=Math.max(o,g.evaluateQueryRenderedFeaturePadding()))}return o}queryRenderedFeatures(o,d,g,b,T,E){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=this.evaluateQueryRenderedFeaturePadding(),M=function(N,j){const W=i.bq([],[.5*N.width,.5*-N.height,1]);return i.br(W,W,[1,-1,0]),i.aB(W,W,N.calculateProjMatrix(j.toUnwrapped())),Float32Array.from(W)}(T,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:d,pixelPosMatrix:M,transform:b,availableImages:g,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:I})}querySourceFeatures(o,d){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const b=g.loadVTLayers(),T=d?d.sourceLayer:"",E=b._geojsonTileLayer||b[T];if(!E)return;const I=i.b6(d&&d.filter),{z:M,x:N,y:j}=this.tileID.canonical,W={z:M,x:N,y:j};for(let Z=0;Z<E.length;Z++){const Y=E.feature(Z);if(I.needGeometry){const oe=i.b7(Y,!0);if(!I.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),oe,this.tileID.canonical))continue}else if(!I.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),Y))continue;const te=g.getId(Y,T),J=new i.b8(Y,M,N,j,te);J.tile=W,o.push(J)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){const d=this.expirationTime;if(o.cacheControl){const g=i.b9(o.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const g=Date.now();let b=!1;if(this.expirationTime>g)b=!1;else if(d)if(this.expirationTime<d)b=!0;else{const T=this.expirationTime-d;T?this.expirationTime=g+Math.max(T,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}hasAppearances(o){for(const d in this.buckets)if(o.style.hasLayer(d)&&this.buckets[d].layers.some(g=>g.appearances&&g.appearances.length>0))return!0;return!1}updateBuckets(o,d){if(!this.latestFeatureIndex||!o.style)return;const g=o.style.listImages(),b=o.style.getBrightness();for(const T in this.buckets){if(!o.style.hasLayer(T))continue;const E=this.buckets[T],I=E.layers[0],M=I.sourceLayer||"_geojsonTileLayer",N=o.style.getLayerSourceCache(I);let j={};N&&(j=N._state.getState(M,void 0));const W=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Z=Object.keys(j).length>0&&!d;E.hasAppearances=E.layers.some(J=>J.appearances&&J.appearances.length>0);const Y=Z?E.stateDependentLayers:E.layers;if(Z&&E.stateDependentLayers.length!==0||d){const J=this.latestFeatureIndex.loadVTLayers();E.update(j,J[M],g,W,Y,d,b)}if(Z&&E.stateDependentLayers.length!==0||d||E.hasAppearances){const J={zoom:o.transform.zoom,pitch:o.transform.pitch,brightness:o.style.getBrightness()||0,worldview:o.worldview};E.updateAppearances(this.tileID.canonical,j,g,J)}(E instanceof i.ba||E instanceof i.bb)&&o._terrain&&o._terrain.enabled&&N&&E.uploadPending()&&o._terrain._clearRenderCacheForTile(N.id,this.tileID);const te=o&&o.style&&o.style.getOwnLayer(T);te&&(this.queryPadding=Math.max(this.queryPadding,te.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=i.o.now()+o}setTexture(o,d){const g=d.context,b=g.gl;this.texture=this.texture||d.getTileTexture(o.width),this.texture&&this.texture instanceof i.T?this.texture.update(o):(this.texture=new i.T(g,o,b.RGBA8,{useMipmap:!0}),this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE))}setDependencies(o,d){const g={};for(const b of d)g[b]=!0;this.dependencies[o]=g}hasDependency(o,d){for(const g of o){const b=this.dependencies[g];if(b){for(const T of d)if(b[T])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,d){if(!d||d.name==="mercator"||this._tileDebugBuffer)return;const g=i.bc(ry,this.tileID.canonical,this.tileTransform)[0],b=new i.bd,T=new i.be;for(let E=0;E<g.length;E++){const{x:I,y:M}=g[E];b.emplaceBack(I,M),T.emplaceBack(E)}T.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(T),this._tileDebugBuffer=o.createVertexBuffer(b,i.bf.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,b.length,T.length)}_makeTileBoundsBuffers(o,d){if(this._tileBoundsBuffer||!d||d.name==="mercator")return;const g=i.bc(ry,this.tileID.canonical,this.tileTransform)[0];let b,T;if(this.isRaster){const E=function(I,M){const N=i.aZ(I,M),j=Math.pow(2,I.z);for(let oe=0;oe<_c;oe++)for(let ae=0;ae<_c;ae++){const pe=i.a_((I.x+(ae+Pf(ae))/Nl)/j),_e=i.a$((I.y+(oe+Pf(oe))/Nl)/j),me=M.project(pe,_e),Le=oe*_c+ae;Uu[2*Le+0]=Math.round((me.x*N.scale-N.x)*i.al),Uu[2*Le+1]=Math.round((me.y*N.scale-N.y)*i.al)}Yc.fill(0),Ch.fill(0);for(let oe=2045;oe>=0;oe--){const ae=4*oe,pe=yc[ae+0],_e=yc[ae+1],me=yc[ae+2],Le=yc[ae+3],Ce=pe+me>>1,Re=_e+Le>>1,Ae=Ce+Re-_e,Te=Re+pe-Ce,ze=_e*_c+pe,We=Le*_c+me,Ge=Re*_c+Ce,ct=Math.hypot((Uu[2*ze+0]+Uu[2*We+0])/2-Uu[2*Ge+0],(Uu[2*ze+1]+Uu[2*We+1])/2-Uu[2*Ge+1])>=16;Yc[Ge]=Yc[Ge]||(ct?1:0),oe<1022&&(Yc[Ge]=Yc[Ge]||Yc[(_e+Te>>1)*_c+(pe+Ae>>1)]||Yc[(Le+Te>>1)*_c+(me+Ae>>1)])}const W=new i.b1,Z=new i.b0;let Y=0;function te(oe,ae){const pe=ae*_c+oe;return Ch[pe]===0&&(W.emplaceBack(Uu[2*pe+0],Uu[2*pe+1],oe*i.al/Nl,ae*i.al/Nl),Ch[pe]=++Y),Ch[pe]-1}function J(oe,ae,pe,_e,me,Le){const Ce=oe+pe>>1,Re=ae+_e>>1;if(Math.abs(oe-me)+Math.abs(ae-Le)>1&&Yc[Re*_c+Ce])J(me,Le,oe,ae,Ce,Re),J(pe,_e,me,Le,Ce,Re);else{const Ae=te(oe,ae),Te=te(pe,_e),ze=te(me,Le);Z.emplaceBack(Ae,Te,ze)}}return J(0,0,Nl,Nl,Nl,0),J(Nl,Nl,0,0,0,Nl),{vertices:W,indices:Z}}(this.tileID.canonical,d);b=E.vertices,T=E.indices}else{b=new i.b1,T=new i.b0;for(const{x:I,y:M}of g)b.emplaceBack(I,M,0,0);const E=i.bh(b.int16.subarray(0,4*b.length),void 0,4);for(let I=0;I<E.length;I+=3)T.emplaceBack(E[I],E[I+1],E[I+2])}this._tileBoundsBuffer=o.createVertexBuffer(b,i.bi.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(T),this._tileBoundsSegments=i.bg.simpleSegment(0,0,b.length,T.length)}_makeGlobeTileDebugBuffers(o,d){const g=d.projection;if(!g||g.name!=="globe"||d.freezeTileCoverage)return;const b=this.tileID.canonical,T=i.bj(b,d),E=i.bk(T),I=i.aj(d.zoom);let M;I>0&&(M=i.bl(new Float64Array(16),d.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,b,d,E,M,I),this._makeGlobeTileDebugTextBuffer(o,b,d,E,M,I)}_globePoint(o,d,g,b,T,E,I){let M=i.bm(o,d,g);if(E){const N=1<<g.z,j=i.aF(b.center.lng),W=i.aJ(b.center.lat),Z=(g.x+.5)/N-j;let Y=0;Z>.5?Y=-1:Z<-.5&&(Y=1);let te=(o/i.al+g.x)/N+Y,J=(d/i.al+g.y)/N;te=(te-j)*b._pixelsPerMercatorPixel+j,J=(J-W)*b._pixelsPerMercatorPixel+W;const oe=[te*b.worldSize,J*b.worldSize,0];i.af(oe,oe,E),M=i.bn(M,oe,I)}return i.af(M,M,T)}_makeGlobeTileDebugBorderBuffer(o,d,g,b,T,E){const I=new i.bd,M=new i.be,N=new i.bo,j=(Z,Y,te,J,oe)=>{const ae=(te-Z)/(oe-1),pe=(J-Y)/(oe-1),_e=I.length;for(let me=0;me<oe;me++){const Le=Z+me*ae,Ce=Y+me*pe;I.emplaceBack(Le,Ce);const Re=this._globePoint(Le,Ce,d,g,b,T,E);N.emplaceBack(Re[0],Re[1],Re[2]),M.emplaceBack(_e+me)}},W=i.al;j(0,0,W,0,16),j(W,0,W,W,16),j(W,W,0,W,16),j(0,W,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(M),this._tileDebugBuffer=o.createVertexBuffer(I,i.bf.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(N,i.bp.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,I.length,M.length)}_makeGlobeTileDebugTextBuffer(o,d,g,b,T,E){const I=i.al/4,M=new i.bd,N=new i.b0,j=new i.bo,W=25;N.reserve(32),M.reserve(W),j.reserve(W);const Z=(Y,te)=>W*Y+te;for(let Y=0;Y<W;Y++){const te=Y*I;for(let J=0;J<W;J++){const oe=J*I;M.emplaceBack(oe,te);const ae=this._globePoint(oe,te,d,g,b,T,E);j.emplaceBack(ae[0],ae[1],ae[2])}}for(let Y=0;Y<4;Y++)for(let te=0;te<4;te++){const J=Z(Y,te),oe=Z(Y,te+1),ae=Z(Y+1,te),pe=Z(Y+1,te+1);N.emplaceBack(J,oe,ae),N.emplaceBack(ae,oe,pe)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(N),this._tileDebugTextBuffer=o.createVertexBuffer(M,i.bf.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(j,i.bp.members),this._tileDebugTextSegments=i.bg.simpleSegment(0,0,W,32)}destroy(o=!0){for(const d in this.buckets)this.buckets[d].destroy(o);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),o&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof i.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bs.setPbf(i.bt);class iy extends Of{constructor(o,d,g,b,T){super(o,d,g,b,T),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexturePerLayer(o,d,g){const b=g.context,T=b.gl;let E=this.texturePerLayer.get(o)||g.getTileTexture(d.width);E&&E instanceof i.T?E.update(d,{premultiply:!1}):E=new i.T(b,d,T.RGBA8,{premultiply:!1}),this.texturePerLayer.has(o)||this.texturePerLayer.set(o,E)}flushQueues(o){const d=this._workQueuePerLayer.get(o)||[],g=this._fetchQueuePerLayer.get(o)||[];for(;d.length;)d.pop()();for(;g.length;)g.pop()()}flushAllQueues(){for(const o of this._workQueuePerLayer.keys()){const d=this._workQueuePerLayer.get(o)||[];for(;d.length;)d.pop()()}for(const o of this._fetchQueuePerLayer.keys()){const d=this._fetchQueuePerLayer.get(o)||[];for(;d.length;)d.pop()()}}fetchHeader(o=16384,d){const g=this._mrt=new i.bs(30),b=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=i.bu(b,(T,E,I)=>{if(T)d(T);else try{const M=g.getHeaderLength(E);if(M>o)return void(this.request=this.fetchHeader(M,d));g.parseHeader(E),this._isHeaderLoaded=!0;let N=0;for(const j of Object.values(g.layers))N=Math.max(N,j.dataIndex[j.dataIndex.length-1].lastByte);E.byteLength>=N&&(this.entireBuffer=E),d(null,this.entireBuffer||E,I)}catch(M){d(M)}}),this.request}fetchBandForRender(o,d,g,b){this.fetchBand(o,d,g,T=>{if(T)return void b(T);this.updateTextureDescriptor(o,d,g);const E=this.textureDescriptorPerLayer.get(d);b(null,E?E.img:null)})}fetchBand(o,d,g,b,T=!0){const E=this._mrt;if(!this._isHeaderLoaded||!E)return void b(new Error("Tile header is not ready"));const I=this.actor;if(!I)return void b(new Error("Can't fetch tile band without an actor"));let M;const N=i.B(String(g),i.B(this.tileID.key,o));let j=this._taskQueue.get(N);j?j.add(b):(j=new Set,j.add(b),this._taskQueue.set(N,j));const W=(J,oe)=>{M.complete(J,oe),J?b(J):(j.forEach(ae=>ae(null,oe)),this._taskQueue.delete(N))},Z=(J,oe)=>{if(J)return b(J);const ae=I.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:oe,task:M},W,void 0,!0);if(d!==null){const pe=this._workQueuePerLayer.get(d)||[];pe.push(()=>{ae&&ae.cancel(),M.cancel()}),this._workQueuePerLayer.has(d)||this._workQueuePerLayer.set(d,pe)}};let Y;try{Y=E.getLayer(o)}catch(J){if(this.state==="reloading")return;throw J}if(!Y)return void b(new Error(`Unknown sourceLayer "${o}"`));if(Y.hasDataForBand(g))return j.forEach(J=>J(null,null)),void this._taskQueue.delete(N);const te=Y.getDataRange([g]);if(M=E.createDecodingTask(te),!M||M.tasks.length)if(d!==null&&this.flushQueues(d),this.entireBuffer)Z(null,this.entireBuffer.slice(te.firstByte,te.lastByte+1));else{const J=Object.assign({},this.requestParams,{headers:{Range:`bytes=${te.firstByte}-${te.lastByte}`}}),oe=i.bu(J,Z);if(d!==null){const ae=this._fetchQueuePerLayer.get(d)||[];ae.push(()=>{oe.cancel(),M.cancel()}),this._fetchQueuePerLayer.has(d)||this._fetchQueuePerLayer.set(d,ae)}}}updateNeeded(o,d){return(!this.textureDescriptorPerLayer.get(o)||this.textureDescriptorPerLayer.get(o).band!==d||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(o,d,g){if(!this._mrt)return;const b=this._mrt.getLayer(o);if(!b||!b.hasBand(g)||!b.hasDataForBand(g))return;const{bytes:T,tileSize:E,buffer:I,offset:M,scale:N}=b.getBandView(g),j=E+2*I,W=new i.q({width:j,height:j},T),Z=this.texturePerLayer.get(d);Z&&Z instanceof i.T&&Z.update(W,{premultiply:!1}),this.textureDescriptorPerLayer.set(d,{layer:o,band:g,img:W,buffer:I,offset:M,tileSize:E,format:b.pixelFormat,mix:[N,256*N,65536*N,16777216*N]})}destroy(o=!1){if(super.destroy(o),delete this._mrt,!o)for(const d of this.texturePerLayer.values())d&&d instanceof i.T&&d.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class SE{constructor(o,d){this.max=o,this.onRemove=d,this.reset()}reset(){for(const o in this.data)for(const d of this.data[o])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(o,d,g){const b=o.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);const T={value:d,timeout:void 0};if(g!==void 0&&(T.timeout=setTimeout(()=>{this.remove(o,T)},g)),this.data[b].push(T),this.order.push(b),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const d=this.data[o].shift();return d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),d.value}getByKey(o){const d=this.data[o];return d?d[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,d){if(!this.has(o))return this;const g=o.wrapped().key,b=d===void 0?0:this.data[g].indexOf(d),T=this.data[g][b];return this.data[g].splice(b,1),T.timeout&&clearTimeout(T.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(T.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(o){const d=[];for(const g in this.data)for(const b of this.data[g])o(b.value)||d.push(b);for(const g of d)this.remove(g.value.tileID,g)}}class H0{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,d,g){const b=String(d);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][b]=this.stateChanges[o][b]||{},Object.assign(this.stateChanges[o][b],g),this.deletedStates[o]===null){this.deletedStates[o]={};for(const T in this.state[o])T!==b&&(this.deletedStates[o][T]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][b]===null){this.deletedStates[o][b]={};for(const T in this.state[o][b])g[T]||(this.deletedStates[o][b][T]=null)}else for(const T in g)this.deletedStates[o]&&this.deletedStates[o][b]&&this.deletedStates[o][b][T]===null&&delete this.deletedStates[o][b][T]}removeFeatureState(o,d,g){if(this.deletedStates[o]===null)return;const b=String(d);if(this.deletedStates[o]=this.deletedStates[o]||{},g&&d!==void 0)this.deletedStates[o][b]!==null&&(this.deletedStates[o][b]=this.deletedStates[o][b]||{},this.deletedStates[o][b][g]=null);else if(d!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][b])for(g in this.deletedStates[o][b]={},this.stateChanges[o][b])this.deletedStates[o][b][g]=null;else this.deletedStates[o][b]=null;else this.deletedStates[o]=null}getState(o,d){const g=this.state[o]||{},b=this.stateChanges[o]||{},T=this.deletedStates[o];if(T===null)return{};if(d!==void 0){const I=String(d),M=Object.assign({},g[I],b[I]);if(T){const N=T[d];if(N===null)return{};for(const j in N)delete M[j]}return M}const E=Object.assign({},g,b);if(T)for(const I in T)delete E[I];return E}initializeTileState(o,d){o.refreshFeatureState(d)}coalesceChanges(o,d){const g={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const T={};for(const E in this.stateChanges[b])this.state[b][E]||(this.state[b][E]={}),Object.assign(this.state[b][E],this.stateChanges[b][E]),T[E]=this.state[b][E];g[b]=T}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const T={};if(this.deletedStates[b]===null)for(const E in this.state[b])T[E]={},this.state[b][E]={};else for(const E in this.deletedStates[b]){if(this.deletedStates[b][E]===null)this.state[b][E]={};else if(this.state[b][E])for(const I of Object.keys(this.deletedStates[b][E]))delete this.state[b][E][I];T[E]=this.state[b][E]}g[b]=g[b]||{},Object.assign(g[b],T)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const b in o)o[b].refreshFeatureState(d)}}class Jl extends i.E{constructor(o,d,g){super(),this.id=o,this._onlySymbols=g,d.on("data",b=>{b.dataType==="source"&&b.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&b.dataType==="source"&&b.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),d.on("error",()=>{this._sourceErrored=!0}),this._source=d,this._tiles={},this._cache=new SE(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new H0,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,d){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,d)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const g=this._tiles[d];g.upload(o,this.map?this.map.painter:void 0),g.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(sy).map(o=>o.key)}getRenderableIds(o,d){const g=[];for(const b in this._tiles)this._isIdRenderable(+b,o,d)&&g.push(this._tiles[b]);return o?g.sort((b,T)=>{const E=b.tileID,I=T.tileID,M=new i.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),N=new i.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-I.overscaledZ||N.y-M.y||N.x-M.x}).map(b=>b.tileID.key):g.map(b=>b.tileID).sort(sy).map(b=>b.key)}hasRenderableParent(o){const d=this.findLoadedParent(o,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(o,d,g){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(d||!this._tiles[o].holdingForFade())&&(g||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,d){const g=this._tiles[o];g&&(g.state!=="loading"&&(g.state=d),this._loadTile(g,this._tileLoaded.bind(this,g,o,d)))}_tileLoaded(o,d,g,b,T){if(b){if(o.state="errored",b.status!==404)this._source.fire(new i.y(b,{tile:o}));else{if(this._source.fire(new i.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const I=this.map.painter.terrain;this.update(this.transform,I.getScaledDemTileSize(),!0),I.resetTileLookupCache(this.id)}else this.update(this.transform)}return}o.timeAdded=i.o.now(),g==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(d,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null);let E=new Map;T&&T.responseHeaders&&(E=T.responseHeaders),this._source.fire(new i.z("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id,responseHeaders:E}))}_backfillDEM(o){const d=this.getRenderableIds();for(let b=0;b<d.length;b++){const T=d[b];if(o.neighboringTiles&&o.neighboringTiles[T]){const E=this.getTileByID(T);g(o,E),g(E,o)}}function g(b,T){if(!b.dem||b.dem.borderReady)return;b.needsHillshadePrepare=!0,b.needsDEMTextureUpload=!0;let E=T.tileID.canonical.x-b.tileID.canonical.x;const I=T.tileID.canonical.y-b.tileID.canonical.y,M=Math.pow(2,b.tileID.canonical.z),N=T.tileID.key;E===0&&I===0||Math.abs(I)>1||(Math.abs(E)>1&&(Math.abs(E+M)===1?E+=M:Math.abs(E-M)===1&&(E-=M)),T.dem&&b.dem&&(b.dem.backfillBorder(T.dem,E,I),b.neighboringTiles&&b.neighboringTiles[N]&&(b.neighboringTiles[N].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,d,g,b){for(const T in this._tiles){let E=this._tiles[T];if(b[T]||!E.hasData()||E.tileID.overscaledZ<=d||E.tileID.overscaledZ>g)continue;let I=E.tileID;for(;E&&E.tileID.overscaledZ>d+1;){const N=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[N.key],E&&E.hasData()&&(I=N)}let M=I;for(;M.overscaledZ>d;)if(M=M.scaledTo(M.overscaledZ-1),o[M.key]){b[I.key]=I;break}}}findLoadedParent(o,d){if(o.key in this._loadedParentTiles){const g=this._loadedParentTiles[o.key];return g&&g.tileID.overscaledZ>=d?g:null}for(let g=o.overscaledZ-1;g>=d;g--){const b=o.scaledTo(g),T=this._getLoadedTile(b);if(T)return T}}_getLoadedTile(o){const d=this._tiles[o.key];return d&&d.hasData()?d:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,d){d=d||this._source.tileSize;const g=Math.ceil(o.width/d)+1,b=Math.ceil(o.height/d)+1,T=Math.floor(g*b*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,T):T,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(I)}handleWrapJump(o){const d=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,d){const g={};for(const b in this._tiles){const T=this._tiles[b];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+d),g[T.tileID.key]=T}this._tiles=g;for(const b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(const b in this._tiles)this._setTileReloadTimer(+b,this._tiles[b])}}update(o,d,g,b,T){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!g)return;this.updateCacheSize(o,d),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const E=this._source.type==="batched-model";let I,M=this._source.maxzoom;const N=this.map&&this.map.painter?this.map.painter._terrain:null;if(N&&N.sourceCache===this&&N.attenuationRange()){const Z=N.attenuationRange()[0],Y=Math.floor(Z)-Math.log2(N.getDemUpscale());M>Y&&(M=Y)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(Z=>new i.aQ(Z.canonical.z,Z.wrap,Z.canonical.z,Z.canonical.x,Z.canonical.y));else if(this.tileCoverLift!==0){const Z=o.clone();Z.tileCoverLift=this.tileCoverLift,I=Z.coveringTiles({tileSize:d||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.minzoom<=1&&o.projection.name==="globe"&&(I.push(new i.aQ(1,0,1,0,0)),I.push(new i.aQ(1,0,1,1,0)),I.push(new i.aQ(1,0,1,0,1)),I.push(new i.aQ(1,0,1,1,1)))}else if(I=o.coveringTiles({tileSize:d||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.hasTile){const Z=this._source.hasTile.bind(this._source);I=I.filter(Y=>Z(Y))}}else I=[];if(I.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Lf(this._source.type)){const Z=o.coveringZoomLevel({tileSize:d||this._source.tileSize,roundZoom:this._source.roundZoom&&!g}),Y=Math.min(Z,this._source.maxzoom);if(E){const te=o.extendTileCover(I,Y);for(const J of te)I.push(J)}else if(T){const te=o.extendTileCoverToNearPlane(I,this.transform.getFrustum(Y),Y);for(const J of te)I.push(J)}else if(this.castsShadows&&b){const te=o.extendTileCover(I,Y,b,16);for(const J of te)this._shadowCasterTiles[J.key]=!0,I.push(J)}}const j=this._updateRetainedTiles(I);if(Lf(this._source.type)&&I.length!==0){const Z={},Y={},te=Object.keys(j);for(const oe of te){const ae=j[oe],pe=this._tiles[oe];if(!pe||pe.fadeEndTime&&pe.fadeEndTime<=i.o.now())continue;const _e=this.findLoadedParent(ae,Math.max(ae.overscaledZ-Jl.maxOverzooming,this._source.minzoom));_e&&(this._addTile(_e.tileID),Z[_e.tileID.key]=_e.tileID),Y[oe]=ae}const J=I[I.length-1].overscaledZ;for(const oe in this._tiles){const ae=this._tiles[oe];if(j[oe]||!ae.hasData())continue;let pe=ae.tileID;for(;pe.overscaledZ>J;){pe=pe.scaledTo(pe.overscaledZ-1);const _e=this._tiles[pe.key];if(_e&&_e.hasData()&&Y[pe.key]){j[oe]=ae.tileID;break}}}for(const oe in Z)j[oe]||(this._coveredTiles[oe]=!0,j[oe]=Z[oe])}for(const Z in j)this._tiles[Z].clearFadeHold();const W=i.bv(this._tiles,j);for(const Z of W){const Y=this._tiles[Z];Y.hasSymbolBuckets&&!Y.holdingForFade()?Y.setHoldDuration(this.map._fadeDuration):Y.hasSymbolBuckets&&!Y.symbolFadeFinished()||this._removeTile(+Z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const d={};if(o.length===0)return d;const g={},b=o.reduce((N,j)=>Math.min(N,j.overscaledZ),1/0),T=o[0].overscaledZ,E=Math.max(T-Jl.maxOverzooming,this._source.minzoom),I=Math.max(T+Jl.maxUnderzooming,this._source.minzoom),M={};for(const N of o){const j=this._addTile(N);d[N.key]=N,j.hasData()||b<this._source.maxzoom&&(M[N.key]=N)}this._retainLoadedChildren(M,b,I,d);for(const N of o){let j=this._tiles[N.key];if(j.hasData())continue;if(N.canonical.z>=this._source.maxzoom){const Z=N.children(this._source.maxzoom)[0],Y=this.getTile(Z);if(Y&&Y.hasData()){d[Z.key]=Z;continue}}else{const Z=N.children(this._source.maxzoom);if(d[Z[0].key]&&d[Z[1].key]&&d[Z[2].key]&&d[Z[3].key])continue}let W=j.wasRequested();for(let Z=N.overscaledZ-1;Z>=E;--Z){const Y=N.scaledTo(Z);if(g[Y.key]||(g[Y.key]=!0,j=this.getTile(Y),!j&&W&&(j=this._addTile(Y)),j&&(d[Y.key]=Y,W=j.wasRequested(),j.hasData())))break}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const d=[];let g,b=this._tiles[o].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){g=this._loadedParentTiles[b.key];break}d.push(b.key);const T=b.scaledTo(b.overscaledZ-1);if(g=this._getLoadedTile(T),g)break;b=T}for(const T of d)this._loadedParentTiles[T]=g}}_addTile(o){let d=this._tiles[o.key];if(d)return d.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),d;d=this._cache.getAndRemove(o),d&&(this._setTileReloadTimer(o.key,d),d.tileID=o,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,d)));const g=!!d;if(!g){const b=this.map?this.map.painter:null,T=this._source.tileSize*o.overscaleFactor();d=this._source.type==="raster-array"?new iy(o,T,this.transform.tileZoom,b,this._isRaster):new Of(o,T,this.transform.tileZoom,b,this._isRaster,this._source.worldview),this._loadTile(d,this._tileLoaded.bind(this,d,o.key,d.state))}return d.uses++,this._tiles[o.key]=d,g||this._source.fire(new i.z("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(o,d){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const g=d.getExpiryTimeout();g&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},g))}_removeTile(o){const d=this._tiles[o];d&&(d.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),d.uses>0||(d.hasData()&&d.state!=="reloading"||d.state==="empty"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,d,g){const b=[],T=this.transform;if(!T)return b;const E=T.projection.name==="globe",I=i.aF(T.center.lng);for(const M in this._tiles){const N=this._tiles[M];if(g&&N.clearQueryDebugViz(),N.holdingForFade())continue;let j;if(E){const W=N.tileID.canonical;if(W.z===0){const Z=[Math.abs(i.aA(I,...Rd(W,-1))-I),Math.abs(i.aA(I,...Rd(W,1))-I)];j=[0,2*Z.indexOf(Math.min(...Z))-1]}else{const Z=[Math.abs(i.aA(I,...Rd(W,-1))-I),Math.abs(i.aA(I,...Rd(W,0))-I),Math.abs(i.aA(I,...Rd(W,1))-I)];j=[Z.indexOf(Math.min(...Z))-1]}}else j=[0];for(const W of j){const Z=o.containsTile(N,T,d,W);Z&&b.push(Z)}}return b}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,d){const g=this.getRenderableIds(o,d).map(T=>this._tiles[T].tileID),b=this.transform.projection.name==="globe";for(const T of g)T.projMatrix=this.transform.calculateProjMatrix(T.toUnwrapped()),T.expandedProjMatrix=b?this.transform.calculateProjMatrix(T.toUnwrapped(),!1,!0):T.projMatrix;return g}sortCoordinatesByDistance(o){const d=o.slice(),g=this.transform._camera.position,b=this.transform._camera.forward(),T={};for(const E of d){const I=1/(1<<E.canonical.z);T[E.key]=((E.canonical.x+.5)*I+E.wrap-g[0])*b[0]+((E.canonical.y+.5)*I-g[1])*b[1]-g[2]*b[2]}return d.sort((E,I)=>T[E.key]-T[I.key]),d}hasTransition(){if(this._source.hasTransition())return!0;if(Lf(this._source.type))for(const o in this._tiles){const d=this._tiles[o];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=i.o.now())return!0}return!1}setFeatureState(o,d,g){this._state.updateState(o=o||"_geojsonTileLayer",d,g)}removeFeatureState(o,d,g){this._state.removeFeatureState(o=o||"_geojsonTileLayer",d,g)}getFeatureState(o,d){return this._state.getState(o=o||"_geojsonTileLayer",d)}setDependencies(o,d,g){const b=this._tiles[o];b&&b.setDependencies(d,g)}reloadTilesForDependencies(o,d){for(const g in this._tiles)this._tiles[g].hasDependency(o,d)&&this._reloadTile(+g,"reloading");this._cache.filter(g=>!g.hasDependency(o,d))}_preloadTiles(o,d){if(!this._sourceLoaded){const M=()=>{this._sourceLoaded&&(this._source.off("data",M),this._preloadTiles(o,d))};return void this._source.on("data",M)}const g=new Map,b=Array.isArray(o)?o:[o],T=this.map.painter.terrain,E=this.usedForTerrain&&T?T.getScaledDemTileSize():this._source.tileSize;for(const M of b){const N=M.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const j of N)g.set(j.key,j);this.usedForTerrain&&M.updateElevation(!1)}const I=Array.from(g.values());i.bw(I,(M,N)=>{const j=new Of(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(j,W=>{this._source.type==="raster-dem"&&j.dem&&this._backfillDEM(j),N(W,j)})},d)}}function sy(m,o){const d=Math.abs(2*m.wrap)-+(m.wrap<0),g=Math.abs(2*o.wrap)-+(o.wrap<0);return m.overscaledZ-o.overscaledZ||g-d||o.canonical.y-m.canonical.y||o.canonical.x-m.canonical.x}function Lf(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function Rd(m,o){const d=1<<m.z;return[m.x/d+o,(m.x+1)/d+o]}Jl.maxOverzooming=10,Jl.maxUnderzooming=3;class hI{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const o=!1,d=!1;for(const g in this.style._mergedLayers){const b=this.style._mergedLayers[g];if(b.type==="fill-extrusion"||b.type==="building")this.layers.push({layer:b,visible:o,visibilityChanged:d});else if(b.type==="model"){const T=this.style.getLayerSource(b);T&&T.type==="batched-model"&&this.layers.push({layer:b,visible:o,visibilityChanged:d})}}}onNewFrame(o){this.layersGotHidden=!1;for(const d of this.layers){const g=d.layer;let b=!1;g.type==="fill-extrusion"?b=!g.isHidden(o)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="building"?b=!g.isHidden(o)&&g.paint.get("building-opacity")>0:g.type==="model"&&(b=!g.isHidden(o)&&g.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!b&&d.visible,d.visible=b}}updateZOffset(o,d){this.currentBuildingBuckets=[];for(const b of this.layers){const T=b.layer,E=this.style.getLayerSourceCache(T);let I=1;T.type==="fill-extrusion"?I=b.visible?T.paint.get("fill-extrusion-vertical-scale"):0:T.type==="building"&&(I=b.visible?T.paint.get("building-vertical-scale"):0);let M=E?E.getTile(d):null;if(!M&&E)for(const N in E._tiles){const j=E._tiles[N];if(d.canonical.isChildOf(j.tileID.canonical)){M=j;break}}this.currentBuildingBuckets.push({bucket:M?M.getBucket(T):null,tileID:M?M.tileID:d,verticalScale:I})}o.hasAnyZOffset=!1;let g=!1;for(let b=0;b<o.symbolInstances.length;b++){const T=o.symbolInstances.get(b),E=T.zOffset,I=this._getHeightAtTileOffset(d,T.tileAnchorX,T.tileAnchorY);T.zOffset=I!==Number.NEGATIVE_INFINITY?I:E,g||E===T.zOffset||(g=!0),o.hasAnyZOffset||T.zOffset===0||(o.hasAnyZOffset=!0)}g&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,d,g,b){let T=d,E=g;if(o.canonical.z!==b.canonical.z){const I=b.canonical,M=1/(1<<o.canonical.z-I.z);T=(d+o.canonical.x*i.al)*M-I.x*i.al|0,E=(g+o.canonical.y*i.al)*M-I.y*i.al|0}return{tileX:T,tileY:E}}_getHeightAtTileOffset(o,d,g){let b,T;for(let E=0;E<this.layers.length;++E){const I=this.layers[E].layer;if(I.type!=="fill-extrusion"&&I.type!=="building")continue;const{bucket:M,tileID:N,verticalScale:j}=this.currentBuildingBuckets[E];if(!M)continue;const{tileX:W,tileY:Z}=this._mapCoordToOverlappingTile(o,d,g,N),Y=M.getHeightAtTileCoord(W,Z);Y&&Y.height!==void 0&&(Y.hidden?b=Y.height:T=Math.max(Y.height*j,T||0))}if(T!==void 0)return T;for(let E=0;E<this.layers.length;++E){const I=this.layers[E];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:M,tileID:N}=this.currentBuildingBuckets[E];if(!M)continue;const{tileX:j,tileY:W}=this._mapCoordToOverlappingTile(o,d,g,N),Z=M.getHeightAtTileCoord(j,W);if(Z&&!Z.hidden)return Z.height===void 0&&b!==void 0?Math.min(Z.maxHeight,b)*Z.verticalScale:Z.height?Z.height*Z.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function AE(m,o){const d={};for(const g in m)g!=="ref"&&(d[g]=m[g]);return i.bx.forEach(g=>{g in o&&(d[g]=o[g])}),d}function G0(m){m=m.slice();const o=Object.create(null);for(let d=0;d<m.length;d++)o[m[d].id]=m[d];for(let d=0;d<m.length;d++)"ref"in m[d]&&(m[d]=AE(m[d],o[m[d].ref]));return m}const Li={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function ay(m,o,d){d.push({command:Li.addSource,args:[m,o[m]]})}function Zx(m,o,d){o.push({command:Li.removeSource,args:[m]}),d[m]=!0}function CE(m,o,d,g){Zx(m,d,g),ay(m,o,d)}function kE(m,o,d){let g;for(g in m[d])if(m[d].hasOwnProperty(g)&&g!=="data"&&!i.by(m[d][g],o[d][g]))return!1;for(g in o[d])if(o[d].hasOwnProperty(g)&&g!=="data"&&!i.by(m[d][g],o[d][g]))return!1;return!0}function kh(m,o,d,g,b,T){let E;for(E in o=o||{},m=m||{})m.hasOwnProperty(E)&&(i.by(m[E],o[E])||d.push({command:T,args:[g,E,o[E],b]}));for(E in o)o.hasOwnProperty(E)&&!m.hasOwnProperty(E)&&(i.by(m[E],o[E])||d.push({command:T,args:[g,E,o[E],b]}))}function q0(m){return m.id}function Z0(m,o){return m[o.id]=o,m}function Wx(m,o,d){const g=o.createTileMatrix(m,m.worldSize,d.toUnwrapped());return i.aB(new Float32Array(16),m.projMatrix,g)}function oy(m,o,d){if(o.projection.name===d.projection.name)return m.projMatrix;const g=d.clone();return g.setProjection(o.projection),Wx(g,o.getProjection(),m)}function Kc(m,o,d){return o.name===d.projection.name?m.projMatrix:Wx(d,o,m)}class W0{constructor(o,d){this.reset(o,d)}reset(o,d){this.points=o||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=i.aA(o,0,1);let d=1,g=this._distances[d];const b=o*this.paddedLength+this.padding;for(;g<b&&d<this._distances.length;)g=this._distances[++d];const T=d-1,E=this._distances[T],I=g-E,M=I>0?(b-E)/I:0;return this.points[T].mult(1-M).add(this.points[d].mult(M))}}class Xx{constructor(o,d,g){const b=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(o/g),this.yCellCount=Math.ceil(d/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)b.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=d,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,d,g,b,T){this._forEachCell(d,g,b,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(b),this.bboxes.push(T)}insertCircle(o,d,g,b){this._forEachCell(d-b,g-b,d+b,g+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(d),this.circles.push(g),this.circles.push(b)}_insertBoxCell(o,d,g,b,T,E){this.boxCells[T].push(E)}_insertCircleCell(o,d,g,b,T,E){this.circleCells[T].push(E)}_query(o,d,g,b,T,E){if(g<0||o>this.width||b<0||d>this.height)return!T&&[];const I=[];if(o<=0&&d<=0&&this.width<=g&&this.height<=b){if(T)return!0;for(let M=0;M<this.boxKeys.length;M++)I.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const N=this.circles[3*M],j=this.circles[3*M+1],W=this.circles[3*M+2];I.push({key:this.circleKeys[M],x1:N-W,y1:j-W,x2:N+W,y2:j+W})}return E?I.filter(E):I}return this._forEachCell(o,d,g,b,this._queryCell,I,{hitTest:T,seenUids:{box:{},circle:{}}},E),T?I.length>0:I}_queryCircle(o,d,g,b,T){const E=o-g,I=o+g,M=d-g,N=d+g;if(I<0||E>this.width||N<0||M>this.height)return!b&&[];const j=[];return this._forEachCell(E,M,I,N,this._queryCellCircle,j,{hitTest:b,circle:{x:o,y:d,radius:g},seenUids:{box:{},circle:{}}},T),b?j.length>0:j}query(o,d,g,b,T){return this._query(o,d,g,b,!1,T)}hitTest(o,d,g,b,T){return this._query(o,d,g,b,!0,T)}hitTestCircle(o,d,g,b){return this._queryCircle(o,d,g,!0,b)}_queryCell(o,d,g,b,T,E,I,M){const N=I.seenUids,j=this.boxCells[T];if(j!==null){const Z=this.bboxes;for(const Y of j)if(!N.box[Y]){N.box[Y]=!0;const te=4*Y;if(o<=Z[te+2]&&d<=Z[te+3]&&g>=Z[te+0]&&b>=Z[te+1]&&(!M||M(this.boxKeys[Y]))){if(I.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[Y],x1:Z[te],y1:Z[te+1],x2:Z[te+2],y2:Z[te+3]})}}}const W=this.circleCells[T];if(W!==null){const Z=this.circles;for(const Y of W)if(!N.circle[Y]){N.circle[Y]=!0;const te=3*Y;if(this._circleAndRectCollide(Z[te],Z[te+1],Z[te+2],o,d,g,b)&&(!M||M(this.circleKeys[Y]))){if(I.hitTest)return E.push(!0),!0;{const J=Z[te],oe=Z[te+1],ae=Z[te+2];E.push({key:this.circleKeys[Y],x1:J-ae,y1:oe-ae,x2:J+ae,y2:oe+ae})}}}}}_queryCellCircle(o,d,g,b,T,E,I,M){const N=I.circle,j=I.seenUids,W=this.boxCells[T];if(W!==null){const Y=this.bboxes;for(const te of W)if(!j.box[te]){j.box[te]=!0;const J=4*te;if(this._circleAndRectCollide(N.x,N.y,N.radius,Y[J+0],Y[J+1],Y[J+2],Y[J+3])&&(!M||M(this.boxKeys[te])))return E.push(!0),!0}}const Z=this.circleCells[T];if(Z!==null){const Y=this.circles;for(const te of Z)if(!j.circle[te]){j.circle[te]=!0;const J=3*te;if(this._circlesCollide(Y[J],Y[J+1],Y[J+2],N.x,N.y,N.radius)&&(!M||M(this.circleKeys[te])))return E.push(!0),!0}}}_forEachCell(o,d,g,b,T,E,I,M){const N=this._convertToXCellCoord(o),j=this._convertToYCellCoord(d),W=this._convertToXCellCoord(g),Z=this._convertToYCellCoord(b);for(let Y=N;Y<=W;Y++)for(let te=j;te<=Z;te++)if(T.call(this,o,d,g,b,this.xCellCount*te+Y,E,I,M))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,d,g,b,T,E){const I=b-o,M=T-d,N=g+E;return N*N>I*I+M*M}_circleAndRectCollide(o,d,g,b,T,E,I){const M=(E-b)/2,N=Math.abs(o-(b+M));if(N>M+g)return!1;const j=(I-T)/2,W=Math.abs(d-(T+j));if(W>j+g)return!1;if(N<=M||W<=j)return!0;const Z=N-M,Y=W-j;return Z*Z+Y*Y<=g*g}}const Ih={unknown:0,flipRequired:1,flipNotRequired:2},Df=Math.tan(85*Math.PI/180);function yl(m,o,d,g,b,T,E){const I=i.bC();if(d)if(T.name==="globe"){const M=i.bD(b,o);i.aB(I,I,M)}else{const M=i.bE([],E);I[0]=M[0],I[1]=M[1],I[4]=M[2],I[5]=M[3],g||i.bB(I,I,b.angle)}else i.aB(I,b.labelPlaneMatrix,m);return I}function ly(m,o,d,g,b,T,E){const I=yl(m,o,d,g,b,T,E);return T.name==="globe"&&d||(I[2]=I[6]=I[10]=I[14]=0),I}function X0(m,o,d,g,b,T,E){if(d){if(T.name==="globe"){const I=yl(m,o,d,g,b,T,E);return i.bl(I,I),i.aB(I,m,I),I}{const I=i.bz(m),M=i.bA([]);return M[0]=E[0],M[1]=E[1],M[4]=E[2],M[5]=E[3],i.aB(I,I,M),g||i.bB(I,I,-b.angle),I}}return b.glCoordMatrix}function Vu(m,o,d,g){const b=[m,o,d,1];d?i.aC(b,b,g):$n(b,b,g);const T=b[3];return b[0]/=T,b[1]/=T,b[2]/=T,b}function ts(m,o){return Math.min(.5+m/o*.5,1.5)}function IE(m,o){const d=m[0]/m[3],g=m[1]/m[3];return d>=-o[0]&&d<=o[0]&&g>=-o[1]&&g<=o[1]}function RE(m,o,d,g,b,T,E,I,M,N,j=1){const W=d.transform,Z=g?m.textSizeData:m.iconSizeData,Y=i.bK(Z,d.transform.zoom,j),te=W.projection.name==="globe",J=[256/d.width*2+1,256/d.height*2+1],oe=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;oe.clear();let ae=null;te&&(ae=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const pe=m.lineVertexArray,_e=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,me=d.transform.width/d.transform.height;let Le,Ce=!1;for(let Re=0;Re<_e.length;Re++){const Ae=_e.get(Re),{numGlyphs:Te,writingMode:ze}=Ae;if(ze!==i.bL.vertical||Ce||Le===i.bL.horizontal||(Ce=!0),Le=ze,(Ae.hidden||ze===i.bL.vertical)&&!Ce){vc(Te,oe);continue}Ce=!1;const We=new i.P(Ae.tileAnchorX,Ae.tileAnchorY),Ge=m.elevationType==="road",ct=!!W.elevation||Ge;let{x:ht,y:Et,z:Ut}=W.projection.projectTilePoint(We.x,We.y,N.canonical),it=null;if(ct){const vn=Ge?m.getElevationFeatureForText(Re):null;it={getElevation:M,elevation:W.elevation,elevationFeature:vn};const[tr,Nr,mi]=M(We,W.elevation,vn);ht+=tr,Et+=Nr,Ut+=mi}const Ue=[ht,Et,Ut,1];if(i.aC(Ue,Ue,o),!IE(Ue,J)){vc(Te,oe);continue}const _t=Ue[3],ut=ts(d.transform.getCameraToCenterDistance(W.projection),_t),Pt=i.bM(Z,Y,Ae),nn=E?Pt/ut:Pt*ut,_n=Vu(ht,Et,Ut,b);if(_n[3]<=0){vc(Te,oe);continue}let Yt={};const Vt=i.an(m.layers[0].layout.get("text-max-angle")),On=Math.cos(Vt),Cn=E?null:it,fn=Yx(Ae,nn,!1,I,o,b,T,m.glyphOffsetArray,pe,oe,ae,_n,We,Yt,me,Cn,W.projection,N,E,On);Ce=fn.useVertical,Cn&&fn.needsFlipping&&(Yt={}),(fn.notEnoughRoom||Ce||fn.needsFlipping&&Yx(Ae,nn,!0,I,o,b,T,m.glyphOffsetArray,pe,oe,ae,_n,We,Yt,me,Cn,W.projection,N,E,On).notEnoughRoom)&&vc(Te,oe)}g?(m.text.dynamicLayoutVertexBuffer.updateData(oe),ae&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(ae)):(m.icon.dynamicLayoutVertexBuffer.updateData(oe),ae&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(ae))}function ME(m,o,d,g,b,T,E,I,M,N,j,W,Z,Y,te,J,oe){const{lineStartIndex:ae,glyphStartIndex:pe,segment:_e}=I,me=pe+I.numGlyphs,Le=ae+I.lineLength,Ce=o.getoffsetX(pe),Re=o.getoffsetX(me-1),Ae=$p(m*Ce,d,g,b,T,E,_e,ae,Le,M,N,j,W,Z,!0,Y,te,J,oe);if(!Ae)return null;const Te=$p(m*Re,d,g,b,T,E,_e,ae,Le,M,N,j,W,Z,!0,Y,te,J,oe);return Te?{first:Ae,last:Te}:null}function Tr(m,o,d,g){return m===i.bL.horizontal&&Math.abs(g)>Math.abs(d)?{useVertical:!0}:m===i.bL.vertical?g>0?{needsFlipping:!0}:null:o!==Ih.unknown&&function(b,T){return b===0||Math.abs(T/b)>Df}(d,g)?o===Ih.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null}function Yx(m,o,d,g,b,T,E,I,M,N,j,W,Z,Y,te,J,oe,ae,pe,_e){const me=o/24,Le=m.lineOffsetX*me,Ce=m.lineOffsetY*me,{lineStartIndex:Re,glyphStartIndex:Ae,numGlyphs:Te,segment:ze,writingMode:We,flipState:Ge}=m,ct=Re+m.lineLength,ht=Et=>{if(j){const[_t,ut,Pt]=Et.up,nn=N.length;i.bN(j,nn+0,_t,ut,Pt),i.bN(j,nn+1,_t,ut,Pt),i.bN(j,nn+2,_t,ut,Pt),i.bN(j,nn+3,_t,ut,Pt)}const[Ut,it,Ue]=Et.point;i.bO(N,Ut,it,Ue,Et.angle)};if(Te>1){const Et=ME(me,I,Le,Ce,d,W,Z,m,M,T,Y,J,!1,oe,ae,pe,_e);if(!Et)return{notEnoughRoom:!0};if(g&&!d){let[Ut,it,Ue]=Et.first.point,[_t,ut,Pt]=Et.last.point;[Ut,it]=Vu(Ut,it,Ue,E),[_t,ut]=Vu(_t,ut,Pt,E);const nn=Tr(We,Ge,(_t-Ut)*te,ut-it);if(m.flipState=nn&&nn.needsFlipping?Ih.flipRequired:Ih.flipNotRequired,nn)return nn}ht(Et.first);for(let Ut=Ae+1;Ut<Ae+Te-1;Ut++){const it=$p(me*I.getoffsetX(Ut),Le,Ce,d,W,Z,ze,Re,ct,M,T,Y,J,!1,!1,oe,ae,pe,_e);if(!it)return N.length-=4*(Ut-Ae),{notEnoughRoom:!0};ht(it)}ht(Et.last)}else{if(g&&!d){const Ut=Vu(Z.x,Z.y,0,b),it=Re+ze+1,Ue=new i.P(M.getx(it),M.gety(it)),_t=Vu(Ue.x,Ue.y,0,b),ut=_t[3]>0?_t:$u(Z,Ue,Ut,1,b,void 0,oe,ae.canonical),Pt=Tr(We,Ge,(ut[0]-Ut[0])*te,ut[1]-Ut[1]);if(m.flipState=Pt&&Pt.needsFlipping?Ih.flipRequired:Ih.flipNotRequired,Pt)return Pt}const Et=$p(me*I.getoffsetX(Ae),Le,Ce,d,W,Z,ze,Re,ct,M,T,Y,J,!1,!1,oe,ae,pe,_e);if(!Et)return{notEnoughRoom:!0};ht(Et)}return{}}function Y0(m,o,d,g,b){const{x:T,y:E,z:I}=g.projectTilePoint(m.x,m.y,o);if(!b)return Vu(T,E,I,d);const[M,N,j]=b.getElevation(m,b.elevation,b.elevationFeature);return Vu(T+M,E+N,I+j,d)}function $u(m,o,d,g,b,T,E,I){const M=Y0(m.sub(o)._unit()._add(m),I,b,E,T);return i.av(M,d,M),i.aw(M,M),i.bH(M,d,M,g)}function $p(m,o,d,g,b,T,E,I,M,N,j,W,Z,Y,te,J,oe,ae,pe){const _e=g?m-o:m+o;let me=_e>0?1:-1,Le=0;g&&(me*=-1,Le=Math.PI),me<0&&(Le+=Math.PI);let Ce=I+E+(me>0?0:1)|0,Re=b,Ae=b,Te=0,ze=0;const We=Math.abs(_e),Ge=[],ct=[];let ht=T,Et=ht,Ut=i.bF([]);const it=()=>$u(Et,ht,Ae,We-Te+1,j,Z,J,oe.canonical);for(;Te+ze<=We;){if(Ce+=me,Ce<I||Ce>=M)return null;if(Ae=Re,Et=ht,Ge.push(Ae),Y&&ct.push(Et),ht=new i.P(N.getx(Ce),N.gety(Ce)),Re=W[Ce],!Re){const Cn=Y0(ht,oe.canonical,j,J,Z);Re=Cn[3]>0?W[Ce]=Cn:it()}Te+=ze;const Vt=i.av([],Re,Ae),On=i.bG(Ae,Re);if(d&&On>0&&ze>0&&i.bJ(Ut,Vt)/(ze*On)<pe)return null;ze=On,Ut=Vt}te&&Z&&(W[Ce]&&(Re=it(),ze=i.bG(Ae,Re),Ut=i.av([],Re,Ae)),W[Ce]=Re);const Ue=(We-Te)/ze,_t=ht.sub(Et)._mult(Ue)._add(Et),ut=i.bH([],Ae,Ut,Ue);let Pt=[0,0,1],nn=Ut[0],_n=Ut[1];if(ae&&(Pt=J.upVector(oe.canonical,_t.x,_t.y),Pt[0]!==0||Pt[1]!==0||Pt[2]!==1)){const Vt=[Pt[2],0,-Pt[0]],On=i.bI([],Pt,Vt);i.aw(Vt,Vt),i.aw(On,On),nn=i.bJ(Ut,Vt),_n=i.bJ(Ut,On)}if(d){const Vt=i.bI([],Pt,Ut);i.aw(Vt,Vt),i.bH(ut,ut,Vt,d*me)}const Yt=Le+Math.atan2(_n,nn);return Ge.push(ut),Y&&ct.push(_t),{point:ut,angle:Yt,path:Ge,tilePath:ct,up:Pt}}function vc(m,o){const d=o.length,g=d+4*m;o.resize(g),o.float32.fill(-1/0,4*d,4*g)}function $n(m,o,d){const g=o[0],b=o[1];return m[0]=d[0]*g+d[4]*b+d[12],m[1]=d[1]*g+d[5]*b+d[13],m[3]=d[3]*g+d[7]*b+d[15],m}const Ai=100;class os{constructor(o,d,g=new Xx(o.width+200,o.height+200,25),b=new Xx(o.width+200,o.height+200,25)){this.transform=o,this.grid=g,this.ignoredGrid=b,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Ai,this.screenBottomBoundary=o.height+Ai,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=d}placeCollisionBox(o,d,g,b,T,E,I,M,N,j,W){let Z=g.projectedAnchorX,Y=g.projectedAnchorY,te=g.projectedAnchorZ;const J=g.tileAnchorX,oe=g.tileAnchorY,ae=g.elevation,pe=g.tileID,_e=o.getProjection();if(ae&&pe){const[ct,ht,Et]=_e.upVector(pe.canonical,g.tileAnchorX,g.tileAnchorY),Ut=_e.upVectorScale(pe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Z+=ct*ae*Ut,Y+=ht*ae*Ut,te+=Et*ae*Ut}const me=o.projection.name==="globe",Le=o.projection.name==="globe"?i.aj(this.transform.zoom):0;if(pe&&me&&Le<1&&!E){const ct=1<<pe.canonical.z,ht=i.bP(J,oe);i.bQ(ht,ht,1/i.al),i.bR(ht,ht,i.bP(pe.canonical.x,pe.canonical.y)),i.bQ(ht,ht,1/ct),i.bS(ht,ht,i.bP(b[0],b[1])),ht[0]=i.bT(ht[0],-.5,.5),i.bQ(ht,ht,i.al);const Et=i.bU(ht[0],ht[1],i.al/(2*Math.PI),1);i.aC(Et,Et,T),Z=i.ak(Z,Et[0],Le),Y=i.ak(Y,Et[1],Le),te=i.ak(te,Et[2],Le)}const Ce=this.projectAndGetPerspectiveRatio(j,Z,Y,te,g.tileID,_e.name==="globe"||!!ae||this.transform.pitch>0,_e),Re=N*Ce.perspectiveRatio,Ae=(g.x1*d+I.x-g.padding)*Re+Ce.point.x,Te=(g.y1*d+I.y-g.padding)*Re+Ce.point.y,ze=(g.x2*d+I.x+g.padding)*Re+Ce.point.x,We=(g.y2*d+I.y+g.padding)*Re+Ce.point.y,Ge=Ce.perspectiveRatio<=.55||Ce.occluded;return!this.isInsideGrid(Ae,Te,ze,We)||!M&&this.grid.hitTest(Ae,Te,ze,We,W)||Ge?{box:[],offscreen:!1,occluded:Ce.occluded}:{box:[Ae,Te,ze,We],offscreen:this.isOffscreen(Ae,Te,ze,We),occluded:!1}}placeCollisionCircles(o,d,g,b,T,E,I,M,N,j,W,Z,Y,te,J,oe){const ae=[],pe=this.transform.elevation,_e=o.getProjection(),me=o.elevationType==="road",Le=!!pe||me,Ce=i.bV.getAtTileOffsetFunc(oe,this.transform.center.lat,this.transform.worldSize,_e),Re=new i.P(g.tileAnchorX,g.tileAnchorY),Ae=new i.P(g.tileAnchorX,g.tileAnchorY);let{x:Te,y:ze,z:We}=_e.projectTilePoint(Ae.x,Ae.y,oe.canonical),Ge=null;if(Le){const On=me?o.getElevationFeatureForText(b):null;Ge={getElevation:Ce,elevation:pe,elevationFeature:On};const[Cn,fn,vn]=Ce(Re,pe,On);Te+=Cn,ze+=fn,We+=vn}const ct=_e.name==="globe",ht=this.projectAndGetPerspectiveRatio(M,Te,ze,We,oe,ct||!!pe||this.transform.pitch>0,_e),{perspectiveRatio:Et}=ht,Ut=(Z?I/Et:I*Et)/i.bY,it=Vu(Te,ze,We,N),Ue=g.lineOffsetX*Ut,_t=g.lineOffsetY*Ut,ut=i.an(o.layers[0].layout.get("text-max-angle")),Pt=Math.cos(ut),nn=ht.signedDistanceFromCamera>0?ME(Ut,E,Ue,_t,me&&g.flipState===1,it,Ae,g,T,N,{},Le&&!Z?Ge:null,Z&&Le,_e,oe,Z,Pt):null;let _n=!1,Yt=!1,Vt=!0;if(nn&&!ht.occluded){const On=.5*te*Et+J,Cn=new i.P(-100,-100),fn=new i.P(this.screenRightBoundary,this.screenBottomBoundary),vn=new W0,{first:tr,last:Nr}=nn,mi=tr.path.length;let Bi=[];for(let Dr=mi-1;Dr>=1;Dr--)Bi.push(tr.path[Dr]);for(let Dr=1;Dr<Nr.path.length;Dr++)Bi.push(Nr.path[Dr]);const Nn=2.5*On;j&&(Bi=Bi.map(([Dr,Wi,ls],ns)=>(Le&&!ct&&(ls=Ce(ns<mi-1?tr.tilePath[mi-1-ns]:Nr.tilePath[ns-mi+2],pe,Ge.elevationFeature)[2]),Vu(Dr,Wi,ls,j))),Bi.some(Dr=>Dr[3]<=0)&&(Bi=[]));let Ni=[];if(Bi.length>0){let Dr=1/0,Wi=-1/0,ls=1/0,ns=-1/0;for(const Di of Bi)Dr=Math.min(Dr,Di[0]),ls=Math.min(ls,Di[1]),Wi=Math.max(Wi,Di[0]),ns=Math.max(ns,Di[1]);Wi>=Cn.x&&Dr<=fn.x&&ns>=Cn.y&&ls<=fn.y&&(Ni=[Bi.map(Di=>new i.P(Di[0],Di[1]))],(Dr<Cn.x||Wi>fn.x||ls<Cn.y||ns>fn.y)&&(Ni=i.bW(Ni,Cn.x,Cn.y,fn.x,fn.y)))}for(const Dr of Ni){vn.reset(Dr,.25*On);let Wi=0;Wi=vn.length<=.5*On?1:Math.ceil(vn.paddedLength/Nn)+1;for(let ls=0;ls<Wi;ls++){const ns=ls/Math.max(Wi-1,1),Di=vn.lerp(ns),Hr=Di.x+Ai,Gi=Di.y+Ai;ae.push(Hr,Gi,On,0);const ga=Hr-On,ea=Gi-On,Xi=Hr+On,ki=Gi+On;if(Vt=Vt&&this.isOffscreen(ga,ea,Xi,ki),Yt=Yt||this.isInsideGrid(ga,ea,Xi,ki),!d&&this.grid.hitTestCircle(Hr,Gi,On,Y)&&(_n=!0,!W))return{circles:[],offscreen:!1,collisionDetected:_n,occluded:!1}}}}return{circles:!W&&_n||!Yt?[]:ae,offscreen:Vt,collisionDetected:_n,occluded:ht.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let g=1/0,b=1/0,T=-1/0,E=-1/0;for(const j of o){const W=new i.P(j.x+Ai,j.y+Ai);g=Math.min(g,W.x),b=Math.min(b,W.y),T=Math.max(T,W.x),E=Math.max(E,W.y),d.push(W)}const I=this.grid.query(g,b,T,E).concat(this.ignoredGrid.query(g,b,T,E)),M={},N={};for(const j of I){const W=j.key;if(M[W.bucketInstanceId]===void 0&&(M[W.bucketInstanceId]={}),M[W.bucketInstanceId][W.featureIndex])continue;const Z=[new i.P(j.x1,j.y1),new i.P(j.x2,j.y1),new i.P(j.x2,j.y2),new i.P(j.x1,j.y2)];i.bX(d,Z)&&(M[W.bucketInstanceId][W.featureIndex]=!0,N[W.bucketInstanceId]===void 0&&(N[W.bucketInstanceId]=[]),N[W.bucketInstanceId].push(W.featureIndex))}return N}insertCollisionBox(o,d,g,b,T){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:b,collisionGroupID:T},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,d,g,b,T){const E=d?this.ignoredGrid:this.grid,I={bucketInstanceId:g,featureIndex:b,collisionGroupID:T};for(let M=0;M<o.length;M+=4)E.insertCircle(I,o[M],o[M+1],o[M+2])}projectAndGetPerspectiveRatio(o,d,g,b,T,E,I){const M=[d,g,b,1];let N=!1;b||this.transform.pitch>0?(i.aC(M,M,o),this.fogState&&T&&I.name!=="globe"&&(N=function(Z,Y,te,J,oe,ae){const pe=ae.calculateFogTileMatrix(oe),_e=[Y,te,J];return i.af(_e,_e,pe),dn(Z,i.ag(_e),ae.pitch,ae._fov)}(this.fogState,d,g,b,T.toUnwrapped(),this.transform)>.9)):$n(M,M,o);const j=M[3];return{point:new i.P((M[0]/j+1)/2*this.transform.width+Ai,(-M[1]/j+1)/2*this.transform.height+Ai),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/j*.5,1.5),signedDistanceFromCamera:j,occluded:E&&M[2]>j||N}}isOffscreen(o,d,g,b){return g<Ai||o>=this.screenRightBoundary||b<Ai||d>this.screenBottomBoundary}isInsideGrid(o,d,g,b){return g>=0&&o<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const o=i.bA([]);return i.br(o,o,[-100,-100,0]),o}}class zl{constructor(o,d,g,b){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?d:-d))):b&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Qc{constructor(o,d,g,b,T,E=!1){this.text=new zl(o?o.text:null,d,g,T),this.icon=new zl(o?o.icon:null,d,b,T),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class es{constructor(o,d,g,b=!1){this.text=o,this.icon=d,this.skipFade=g,this.clipped=b}}class uy{constructor(){this.invProjMatrix=i.bC(),this.viewportMatrix=i.bC(),this.circles=[]}}class K0{constructor(o,d,g,b,T){this.bucketInstanceId=o,this.featureIndex=d,this.sourceLayerIndex=g,this.bucketIndex=b,this.tileID=T}}class Q0{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const d=++this.maxGroupID;this.collisionGroups[o]={ID:d,predicate:g=>g.collisionGroupID===d}}return this.collisionGroups[o]}}function il(m,o,d,g,b){const{horizontalAlign:T,verticalAlign:E}=i.c1(m),I=-(T-.5)*o,M=-(E-.5)*d,N=i.c2(m,g);return new i.P(I+N[0]*b,M+N[1]*b)}function Za(m,o,d,g,b){const T=new i.P(m,o);return d&&T._rotate(g?b:-b),T}class fI{constructor(o,d,g,b,T,E){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new os(this.transform,T),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Q0(g),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(o,d,g,b,T=1){const E=g.getBucket(d),I=g.latestFeatureIndex;if(!E||!I||d.fqid!==E.layerIds[0])return;const M=E.layers[0].layout,N=E.layers[0].paint,j=g.collisionBoxArray,W=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),Z=g.tileSize/i.al,Y=g.tileID.toUnwrapped();this.transform.setProjection(E.projection);const te=(J=g.tileID,oe=E.getProjection(),ae=this.transform,oe.name===this.projection?ae.calculateProjMatrix(J.toUnwrapped()):Wx(ae,oe,J));var J,oe,ae;const pe=M.get("text-pitch-alignment")==="map",_e=M.get("text-rotation-alignment")==="map";d.compileFilter(d.options);const me=d.dynamicFilter(),Le=d.dynamicFilterNeedsFeature(),Ce=this.transform.calculatePixelsToTileUnitsMatrix(g),Re=ly(te,g.tileID.canonical,pe,_e,this.transform,E.getProjection(),Ce);let Ae=null;const Te=E.getProjection().createInversionMatrix(this.transform,g.tileID.canonical);if(pe){const Ue=X0(te,g.tileID.canonical,pe,_e,this.transform,E.getProjection(),Ce);Ae=i.aB([],this.transform.labelPlaneMatrix,Ue)}let ze=null;me&&g.latestFeatureIndex&&(ze={unwrappedTileID:Y,dynamicFilter:me,dynamicFilterNeedsFeature:Le}),this.retainedQueryData[E.bucketInstanceId]=new K0(E.bucketInstanceId,I,E.sourceLayerIndex,E.index,g.tileID);const[We,Ge]=E.layers[0].layout.get("text-size-scale-range"),ct=i.aA(T,We,Ge),[ht,Et]=M.get("icon-size-scale-range"),Ut=i.aA(T,ht,Et),it={bucket:E,layout:M,paint:N,posMatrix:te,invMatrix:Te,mercatorCenter:[i.aF(this.transform.center.lng),i.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Re,labelToScreenMatrix:Ae,clippingData:ze,scale:W,textPixelRatio:Z,holdingForFade:g.holdingForFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:i.bK(E.textSizeData,this.transform.zoom,ct),partiallyEvaluatedIconSize:i.bK(E.iconSizeData,this.transform.zoom,Ut),collisionGroup:this.collisionGroups.get(E.sourceID),latestFeatureIndex:g.latestFeatureIndex};if(b)for(const Ue of E.sortKeyRanges){const{sortKey:_t,symbolInstanceStart:ut,symbolInstanceEnd:Pt}=Ue;o.push({sortKey:_t,symbolInstanceStart:ut,symbolInstanceEnd:Pt,parameters:it})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:it})}attemptAnchorPlacement(o,d,g,b,T,E,I,M,N,j,W,Z,Y,te,J,oe,ae,pe,_e,me,Le){const{textOffset0:Ce,textOffset1:Re,crossTileID:Ae}=J,Te=[Ce,Re],ze=il(o,E,I,Te,M),We=this.collisionIndex.placeCollisionBox(ae,M,d,g,b,T,Za(ze.x,ze.y,N,j,this.transform.angle),te,W,Z,Y.predicate);if(_e){const Ge=ae.getSymbolInstanceIconSize(Le,this.transform.zoom,J.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ae,Ge,_e,g,b,T,Za(ze.x,ze.y,N,j,this.transform.angle),te,W,Z,Y.predicate).box.length===0)return}if(We.box.length>0){let Ge;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ae]&&this.prevPlacement.placements[Ae]&&this.prevPlacement.placements[Ae].text&&(Ge=this.prevPlacement.variableOffsets[Ae].anchor),this.variableOffsets[Ae]={textOffset:Te,width:E,height:I,anchor:o,textScale:M,prevAnchor:Ge},this.markUsedJustification(ae,o,J,pe),ae.allowVerticalPlacement&&(this.markUsedOrientation(ae,pe,J),this.placedOrientations[Ae]=pe),{shift:ze,placedGlyphBoxes:We}}}placeLayerBucketPart(o,d,g,b,T=1){const{bucket:E,layout:I,paint:M,posMatrix:N,textLabelPlaneMatrix:j,labelToScreenMatrix:W,clippingData:Z,textPixelRatio:Y,mercatorCenter:te,invMatrix:J,holdingForFade:oe,collisionBoxArray:ae,partiallyEvaluatedTextSize:pe,partiallyEvaluatedIconSize:_e,collisionGroup:me,latestFeatureIndex:Le}=o.parameters,Ce=I.get("text-optional"),Re=I.get("icon-optional"),Ae=I.get("text-allow-overlap"),Te=I.get("icon-allow-overlap"),ze=I.get("text-rotation-alignment")==="map",We=I.get("icon-rotation-alignment")==="map",Ge=I.get("text-pitch-alignment")==="map",ct=M.get("symbol-z-offset"),ht=I.get("symbol-elevation-reference")==="sea",Et=I.get("symbol-placement"),[Ut,it]=I.get("text-size-scale-range"),[Ue,_t]=I.get("icon-size-scale-range"),ut=i.aA(T,Ut,it),Pt=i.aA(T,Ue,_t),nn=I.get("text-variable-anchor"),_n=ze&&Et!=="point",Yt=We&&Et!=="point",Vt=nn&&E.hasTextData(),On=E.hasIconTextFit()&&Vt&&E.hasIconData();this.transform.setProjection(E.projection);const Cn=Vt||_n,fn=Yt||On;let vn=Ae&&(Te||!E.hasIconData()||Re),tr=Te&&(Ae||!E.hasTextData()||Ce);const Nr=!ct.isConstant();!E.collisionArrays&&ae&&E.deserializeCollisionBoxes(ae),g&&b&&E.updateCollisionDebugBuffers(this.transform.zoom,ae,ut,Pt);const mi=(Nn,Ni,Dr)=>{const{crossTileID:Wi,numVerticalGlyphVertices:ls}=Nn;let ns=null;if(Z&&Z.dynamicFilterNeedsFeature||Nr){const ba=this.retainedQueryData[E.bucketInstanceId];ns=Le.loadFeature({featureIndex:Nn.featureIndex,bucketIndex:ba.bucketIndex,sourceLayerIndex:ba.sourceLayerIndex,layoutVertexArrayOffset:0});const Fa=ns.properties?ns.properties.worldview:null;if(E.localizable&&E.worldview&&typeof Fa=="string")if(Fa==="all")ns.properties.$localized=!0;else{if(!Fa.split(",").includes(E.worldview))return;ns.properties.$localized=!0,ns.properties.worldview=E.worldview}}if(Z&&!(0,Z.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:E.worldview},ns,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new i.P(Nn.tileAnchorX,Nn.tileAnchorY),this.transform.calculateDistanceTileData(Z.unwrappedTileID)))return this.placements[Wi]=new es(!1,!1,!1,!0),void d.add(Wi);const Di=ct.evaluate(ns,{});if(d.has(Wi))return;if(oe)return void(this.placements[Wi]=new es(!1,!1,!1));let Hr=!1,Gi=!1,ga=!0,ea=!1,Xi=!1,ki=null,Gr={box:null,offscreen:null,occluded:null},qs={box:null},Pa=null,ha=null,xs=null,Il=0,Xo=0,ro=0;Dr.textFeatureIndex?Il=Dr.textFeatureIndex:Nn.useRuntimeCollisionCircles&&(Il=Nn.featureIndex),Dr.verticalTextFeatureIndex&&(Xo=Dr.verticalTextFeatureIndex);const al=E.elevationFeatures?E.elevationFeatures[Nn.elevationFeatureIndex]:void 0,ol=ba=>{ba.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const Fa=this.transform.elevation;ba.elevation=ht?Di:Di+i.bV.getAtTileOffset(ba.tileID,new i.P(ba.tileAnchorX,ba.tileAnchorY),Fa,al),ba.elevation+=Nn.zOffset},Uo=Dr.textBox;if(Uo){ol(Uo);const ba=bs=>{let Ha=i.bL.horizontal;if(E.allowVerticalPlacement&&!bs&&this.prevPlacement){const _a=this.prevPlacement.placedOrientations[Wi];_a&&(this.placedOrientations[Wi]=_a,Ha=_a,this.markUsedOrientation(E,Ha,Nn))}return Ha},Fa=(bs,Ha)=>{if(E.allowVerticalPlacement&&ls>0&&Dr.verticalTextBox){for(const _a of E.writingModes)if(_a===i.bL.vertical?(Gr=Ha(),qs=Gr):Gr=bs(),Gr&&Gr.box&&Gr.box.length)break}else Gr=bs()};if(nn){let bs=nn;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Wi]){const fa=this.prevPlacement.variableOffsets[Wi];bs.indexOf(fa.anchor)>0&&(bs=bs.filter(Ku=>Ku!==fa.anchor),bs.unshift(fa.anchor))}const Ha=(fa,Ku,Ag)=>{const Sc=E.getSymbolInstanceTextSize(pe,Nn,this.transform.zoom,Ni),Cg=(fa.x2-fa.x1)*Sc+2*fa.padding,fm=(fa.y2-fa.y1)*Sc+2*fa.padding,od=Nn.hasIconTextFit&&!Te?Ku:null;od&&ol(od);let Hd={box:[],offscreen:!1,occluded:!1};const pm=Ae?2*bs.length:bs.length;for(let Gh=0;Gh<pm;++Gh){const Gd=this.attemptAnchorPlacement(bs[Gh%bs.length],fa,te,J,Cn,Cg,fm,Sc,ze,Ge,Y,N,me,Gh>=bs.length,Nn,Ni,E,Ag,od,pe,_e);if(Gd&&(Hd=Gd.placedGlyphBoxes,Hd&&Hd.box&&Hd.box.length)){Hr=!0,ki=Gd.shift;break}}return Hd};Fa(()=>Ha(Uo,Dr.iconBox,i.bL.horizontal),()=>{const fa=Dr.verticalTextBox;return fa&&ol(fa),E.allowVerticalPlacement&&!(Gr&&Gr.box&&Gr.box.length)&&ls>0&&fa?Ha(fa,Dr.verticalIconBox,i.bL.vertical):{box:null,offscreen:null,occluded:null}}),Gr&&(Hr=Gr.box,ga=Gr.offscreen,ea=Gr.occluded);const _a=ba(!(!Gr||!Gr.box));if(!Hr&&this.prevPlacement){const fa=this.prevPlacement.variableOffsets[Wi];fa&&(this.variableOffsets[Wi]=fa,this.markUsedJustification(E,fa.anchor,Nn,_a))}}else{const bs=(Ha,_a)=>{const fa=E.getSymbolInstanceTextSize(pe,Nn,this.transform.zoom,Ni),Ku=this.collisionIndex.placeCollisionBox(E,fa,Ha,te,J,Cn,new i.P(0,0),Ae,Y,N,me.predicate);return Ku&&Ku.box&&Ku.box.length&&(this.markUsedOrientation(E,_a,Nn),this.placedOrientations[Wi]=_a),Ku};Fa(()=>bs(Uo,i.bL.horizontal),()=>{const Ha=Dr.verticalTextBox;return E.allowVerticalPlacement&&ls>0&&Ha?(ol(Ha),bs(Ha,i.bL.vertical)):{box:null,offscreen:null,occluded:null}}),ba(!!(Gr&&Gr.box&&Gr.box.length))}}if(Pa=Gr,Hr=Pa&&Pa.box&&Pa.box.length>0,ga=Pa&&Pa.offscreen,ea=Pa&&Pa.occluded,Nn.useRuntimeCollisionCircles){const ba=Nn.centerJustifiedTextSymbolIndex>=0?Nn.centerJustifiedTextSymbolIndex:Nn.verticalPlacedTextSymbolIndex,Fa=E.text.placedSymbolArray.get(ba),bs=i.bM(E.textSizeData,pe,Fa),Ha=I.get("text-padding");ha=this.collisionIndex.placeCollisionCircles(E,Ae,Fa,ba,E.lineVertexArray,E.glyphOffsetArray,bs,N,j,W,g,Ge,me.predicate,Nn.collisionCircleDiameter*bs/i.bY,Ha,this.retainedQueryData[E.bucketInstanceId].tileID),Hr=Ae||ha.circles.length>0&&!ha.collisionDetected,ga=ga&&ha.offscreen,ea=ha.occluded}if(Dr.iconFeatureIndex&&(ro=Dr.iconFeatureIndex),Dr.iconBox){const ba=Fa=>{ol(Fa);const bs=Nn.hasIconTextFit&&ki?Za(ki.x,ki.y,ze,Ge,this.transform.angle):new i.P(0,0),Ha=E.getSymbolInstanceIconSize(_e,this.transform.zoom,Nn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,Ha,Fa,te,J,fn,bs,Te,Y,N,me.predicate)};qs&&qs.box&&qs.box.length&&Dr.verticalIconBox?(xs=ba(Dr.verticalIconBox),Gi=xs.box.length>0):(xs=ba(Dr.iconBox),Gi=xs.box.length>0),ga=ga&&xs.offscreen,Xi=xs.occluded}const bu=Ce||Nn.numHorizontalGlyphVertices===0&&ls===0,Yu=Re||Nn.numIconVertices===0;if(bu||Yu?Yu?bu||(Gi=Gi&&Hr):Hr=Gi&&Hr:Gi=Hr=Gi&&Hr,Hr&&Pa&&Pa.box&&this.collisionIndex.insertCollisionBox(Pa.box,I.get("text-ignore-placement"),E.bucketInstanceId,qs&&qs.box&&Xo?Xo:Il,me.ID),Gi&&xs&&this.collisionIndex.insertCollisionBox(xs.box,I.get("icon-ignore-placement"),E.bucketInstanceId,ro,me.ID),ha&&(Hr&&this.collisionIndex.insertCollisionCircles(ha.circles,I.get("text-ignore-placement"),E.bucketInstanceId,Il,me.ID),g)){const ba=E.bucketInstanceId;let Fa=this.collisionCircleArrays[ba];Fa===void 0&&(Fa=this.collisionCircleArrays[ba]=new uy);for(let bs=0;bs<ha.circles.length;bs+=4)Fa.circles.push(ha.circles[bs+0]),Fa.circles.push(ha.circles[bs+1]),Fa.circles.push(ha.circles[bs+2]),Fa.circles.push(ha.collisionDetected?1:0)}const jl=E.projection.name!=="globe";vn=vn&&(jl||!ea),tr=tr&&(jl||!Xi),this.placements[Wi]=new es(Hr||vn,Gi||tr,ga||E.justReloaded),d.add(Wi)},Bi=this.retainedQueryData[E.bucketInstanceId].tileID;if(E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,Bi),E.elevationType==="road"&&E.updateRoadElevation(Bi.canonical),E.updateZOffset(),E.sortFeaturesByY){const Nn=E.getSortedSymbolIndexes(this.transform.angle);for(let Ni=Nn.length-1;Ni>=0;--Ni){const Dr=Nn[Ni];mi(E.symbolInstances.get(Dr),Dr,E.collisionArrays[Dr])}E.hasAnyZOffset&&i.w(`${E.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(E.hasAnyZOffset){const Nn=E.getSortedIndexesByZOffset();for(let Ni=0;Ni<Nn.length;++Ni){const Dr=Nn[Ni];mi(E.symbolInstances.get(Dr),Dr,E.collisionArrays[Dr])}}else for(let Nn=o.symbolInstanceStart;Nn<o.symbolInstanceEnd;Nn++)mi(E.symbolInstances.get(Nn),Nn,E.collisionArrays[Nn]);if(g&&E.bucketInstanceId in this.collisionCircleArrays){const Nn=this.collisionCircleArrays[E.bucketInstanceId];i.bl(Nn.invProjMatrix,N),Nn.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(o,d,g,b){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:M,crossTileID:N}=g,j=i.c3(d),W=b===i.bL.vertical?M:j==="left"?T:j==="center"?E:j==="right"?I:-1;T>=0&&(o.text.placedSymbolArray.get(T).crossTileID=W>=0&&T!==W?0:N),E>=0&&(o.text.placedSymbolArray.get(E).crossTileID=W>=0&&E!==W?0:N),I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=W>=0&&I!==W?0:N),M>=0&&(o.text.placedSymbolArray.get(M).crossTileID=W>=0&&M!==W?0:N)}markUsedOrientation(o,d,g){const b=d===i.bL.horizontal||d===i.bL.horizontalOnly?d:0,T=d===i.bL.vertical?d:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:N}=g,j=o.text.placedSymbolArray;E>=0&&(j.get(E).placedOrientation=b),I>=0&&(j.get(I).placedOrientation=b),M>=0&&(j.get(M).placedOrientation=b),N>=0&&(j.get(N).placedOrientation=T)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let g=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const b=d?d.symbolFadeChange(o):1,T=d?d.opacities:{},E=d?d.variableOffsets:{},I=d?d.placedOrientations:{};for(const M in this.placements){const N=this.placements[M],j=T[M];j?(this.opacities[M]=new Qc(j,b,N.text,N.icon,null,N.clipped),g=g||N.text!==j.text.placed||N.icon!==j.icon.placed):(this.opacities[M]=new Qc(null,b,N.text,N.icon,N.skipFade,N.clipped),g=g||N.text||N.icon)}for(const M in T){const N=T[M];if(!this.opacities[M]){const j=new Qc(N,b,!1,!1);j.isHidden()||(this.opacities[M]=j,g=g||N.text.placed||N.icon.placed)}}for(const M in E)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=E[M]);for(const M in I)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=I[M]);g?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:o)}updateLayerOpacities(o,d,g,b){b&&(this.lastReplacementSourceUpdateTime=b.updateTime);const T=new Set;for(const E of d){const I=E.getBucket(o);I&&E.latestFeatureIndex&&o.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,T,E,E.collisionBoxArray,g,b,E.tileID,o.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,E.tileID),I.elevationType==="road"&&I.updateRoadElevation(E.tileID.canonical),I.updateZOffset())}}updateBucketOpacities(o,d,g,b,T,E,I,M){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const N=o.layers[0].layout,j=o.layers[0].paint,W=!!o.layers[0].dynamicFilter(),Z=new Qc(null,0,!1,!1,!0),Y=N.get("text-allow-overlap"),te=N.get("icon-allow-overlap"),J=N.get("text-variable-anchor"),oe=N.get("text-rotation-alignment")==="map",ae=N.get("text-pitch-alignment")==="map",pe=j.get("symbol-z-offset"),_e=N.get("symbol-elevation-reference")==="sea",me=!pe.isConstant(),Le=new Qc(null,0,Y&&(te||!o.hasIconData()||N.get("icon-optional")),te&&(Y||!o.hasTextData()||N.get("text-optional")),!0);!o.collisionArrays&&b&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(b);const Ce=(Ae,Te,ze)=>{for(let We=0;We<Te/4;We++)Ae.opacityVertexArray.emplaceBack(ze)};let Re=0;E&&o.updateReplacement(I,E);for(let Ae=0;Ae<o.symbolInstances.length;Ae++){const Te=o.symbolInstances.get(Ae),{numHorizontalGlyphVertices:ze,numVerticalGlyphVertices:We,crossTileID:Ge,numIconVertices:ct,tileAnchorX:ht,tileAnchorY:Et}=Te;let Ut=null;const it=this.retainedQueryData[o.bucketInstanceId];me&&Te&&it&&(Ut=g.latestFeatureIndex.loadFeature({featureIndex:Te.featureIndex,bucketIndex:it.bucketIndex,sourceLayerIndex:it.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ue=pe.evaluate(Ut,{}),_t=d.has(Ge);let ut=this.opacities[Ge];_t?ut=Z:ut||(ut=Le,this.opacities[Ge]=ut),d.add(Ge);const Pt=ze>0||We>0,nn=ct>0,_n=this.placedOrientations[Ge],Yt=_n===i.bL.vertical,Vt=_n===i.bL.horizontal||_n===i.bL.horizontalOnly;!Pt&&!nn||ut.isHidden()||Re++;let On=!1;if((Pt||nn)&&E)for(const Cn of o.activeReplacements){if(i.bZ(Cn,T,i.b_.Symbol,M)||Cn.min.x>ht||ht>Cn.max.x||Cn.min.y>Et||Et>Cn.max.y)continue;const fn=i.b$(ht,Et,I.canonical,Cn.footprintTileId.canonical);if(On=i.c0(fn,Cn.footprint),On)break}if(Pt){const Cn=On?Nf:Sl(ut.text);Ce(o.text,ze,Yt?Nf:Cn),Ce(o.text,We,Vt?Nf:Cn);const fn=ut.text.isHidden(),{leftJustifiedTextSymbolIndex:vn,centerJustifiedTextSymbolIndex:tr,rightJustifiedTextSymbolIndex:Nr,verticalPlacedTextSymbolIndex:mi}=Te,Bi=o.text.placedSymbolArray,Nn=fn||Yt?1:0;vn>=0&&(Bi.get(vn).hidden=Nn),tr>=0&&(Bi.get(tr).hidden=Nn),Nr>=0&&(Bi.get(Nr).hidden=Nn),mi>=0&&(Bi.get(mi).hidden=fn||Vt?1:0);const Ni=this.variableOffsets[Ge];Ni&&this.markUsedJustification(o,Ni.anchor,Te,_n);const Dr=this.placedOrientations[Ge];Dr&&(this.markUsedJustification(o,"left",Te,Dr),this.markUsedOrientation(o,Dr,Te))}if(nn){const Cn=On?Nf:Sl(ut.icon),{placedIconSymbolIndex:fn,verticalPlacedIconSymbolIndex:vn}=Te,tr=o.icon.placedSymbolArray,Nr=ut.icon.isHidden()?1:0;fn>=0&&(Ce(o.icon,ct,Yt?Nf:Cn),tr.get(fn).hidden=Nr),vn>=0&&(Ce(o.icon,Te.numVerticalIconVertices,Vt?Nf:Cn),tr.get(vn).hidden=Nr)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Cn=o.collisionArrays[Ae];if(Cn){let fn=new i.P(0,0),vn=!0;if(Cn.textBox||Cn.verticalTextBox){if(J){const Nr=this.variableOffsets[Ge];Nr?(fn=il(Nr.anchor,Nr.width,Nr.height,Nr.textOffset,Nr.textScale),oe&&fn._rotate(ae?this.transform.angle:-this.transform.angle)):vn=!1}W&&(vn=!ut.clipped),Cn.textBox&&Rh(o.textCollisionBox.collisionVertexArray,ut.text.placed,!vn||Yt,Ue,_e,fn.x,fn.y),Cn.verticalTextBox&&Rh(o.textCollisionBox.collisionVertexArray,ut.text.placed,!vn||Vt,Ue,_e,fn.x,fn.y)}const tr=vn&&!!(!Vt&&Cn.verticalIconBox);Cn.iconBox&&Rh(o.iconCollisionBox.collisionVertexArray,ut.icon.placed,tr,Ue,_e,Te.hasIconTextFit?fn.x:0,Te.hasIconTextFit?fn.y:0),Cn.verticalIconBox&&Rh(o.iconCollisionBox.collisionVertexArray,ut.icon.placed,!tr,Ue,_e,Te.hasIconTextFit?fn.x:0,Te.hasIconTextFit?fn.y:0)}}}if(o.fullyClipped=Re===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=Ae.invProjMatrix,o.placementViewportMatrix=Ae.viewportMatrix,o.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,d){const g=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*g>o}isStale(){return this.stale}setStale(){this.stale=!0}}function Rh(m,o,d,g,b,T,E){m.emplaceBack(o?1:0,d?1:0,T||0,E||0,g,b?1:0),m.emplaceBack(o?1:0,d?1:0,T||0,E||0,g,b?1:0),m.emplaceBack(o?1:0,d?1:0,T||0,E||0,g,b?1:0),m.emplaceBack(o?1:0,d?1:0,T||0,E||0,g,b?1:0)}const Kx=Math.pow(2,25),J0=Math.pow(2,24),cy=Math.pow(2,17),Qx=Math.pow(2,16),dy=Math.pow(2,9),El=Math.pow(2,8),Md=Math.pow(2,1);function Sl(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const o=m.placed?1:0,d=Math.floor(127*m.opacity);return d*Kx+o*J0+d*cy+o*Qx+d*dy+o*El+d*Md+o}const Nf=0;class Hp{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,d,g,b,T,E){const I=this._bucketParts;for(;this._currentTileIndex<o.length;)if(d.getBucketParts(I,b,o[this._currentTileIndex],this._sortAcrossTiles,E),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((M,N)=>M.sortKey-N.sortKey));this._currentPartIndex<I.length;){const M=I[this._currentPartIndex];if(d.placeLayerBucketPart(M,this._seenCrossTileIDs,g,M.symbolInstanceStart===0,E),this._currentPartIndex++,T())return!0}return!1}}class Eo{constructor(o,d,g,b,T,E,I,M,N){this.placement=new fI(o,T,E,I,M,N),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(o,d,g,b,T){const E=i.o.now(),I=()=>{const M=i.o.now()-E;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=d[o[this._currentPlacementIndex]],N=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&M.visibility!=="none"&&(!M.minzoom||M.minzoom<=N)&&(!M.maxzoom||M.maxzoom>N)){const j=M,W=j.layout.get("symbol-z-elevate"),Z=j.layout.get("symbol-sort-key").constantOr(1)!==void 0,Y=j.layout.get("symbol-z-order"),te=Y==="viewport-y"||Y==="auto"&&!(Y!=="viewport-y"&&Z),J=j.layout.get("text-allow-overlap")||j.layout.get("icon-allow-overlap")||j.layout.get("text-ignore-placement")||j.layout.get("icon-ignore-placement"),oe=te&&J,ae=this._inProgressLayer=this._inProgressLayer||new Hp(j),pe=i.B(M.source,M.scope);if(ae.continuePlacement(W||oe?b[pe]:g[pe],this.placement,this._showCollisionBoxes,M,I,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Hu=512/i.al/2;class Pd{constructor(o,d,g){this.tileID=o,this.bucketInstanceId=g,this.index=new i.c4(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=o.canonical.x*i.al,T=o.canonical.y*i.al;for(let E=0;E<d.length;E++){const{key:I,crossTileID:M,tileAnchorX:N,tileAnchorY:j}=d.get(E),W=Math.floor((b+N)*Hu),Z=Math.floor((T+j)*Hu);this.index.add(W,Z),this.keys.push(I),this.crossTileIDs.push(M)}this.index.finish()}findMatches(o,d,g){const b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),T=Hu/Math.pow(2,d.canonical.z-this.tileID.canonical.z),E=d.canonical.x*i.al,I=d.canonical.y*i.al;for(let M=0;M<o.length;M++){const N=o.get(M);if(N.crossTileID)continue;const{key:j,tileAnchorX:W,tileAnchorY:Z}=N,Y=Math.floor((E+W)*T),te=Math.floor((I+Z)*T),J=this.index.range(Y-b,te-b,Y+b,te+b).sort((oe,ae)=>oe-ae);for(const oe of J){const ae=this.crossTileIDs[oe];if(this.keys[oe]===j&&!g.has(ae)){g.add(ae),N.crossTileID=ae;break}}}}}class mo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Jx{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const d=Math.round((o-this.lng)/360);if(d!==0)for(const g in this.indexes){const b=this.indexes[g],T={};for(const E in b){const I=b[E];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+d),T[I.tileID.key]=I}this.indexes[g]=T}this.lng=o}addBucket(o,d,g){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let T=0;T<d.symbolInstances.length;T++)d.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const b=this.usedCrossTileIDs[o.overscaledZ];for(const T in this.indexes){const E=this.indexes[T];if(Number(T)>o.overscaledZ)for(const I in E){const M=E[I];M.tileID.isChildOf(o)&&M.findMatches(d.symbolInstances,o,b)}else{const I=E[o.scaledTo(Number(T)).key];I&&I.findMatches(d.symbolInstances,o,b)}}for(let T=0;T<d.symbolInstances.length;T++){const E=d.symbolInstances.get(T);E.crossTileID||(E.crossTileID=g.generate(),b.add(E.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Pd(o,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(o,d){for(const g of d.crossTileIDs)this.usedCrossTileIDs[o].delete(g)}removeStaleBuckets(o){let d=!1;for(const g in this.indexes){const b=this.indexes[g];for(const T in b)o[b[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,b[T]),delete b[T],d=!0)}return d}}class xc{constructor(){this.layerIndexes={},this.crossTileIDs=new mo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,d,g,b){let T=this.layerIndexes[o.fqid];T===void 0&&(T=this.layerIndexes[o.fqid]=new Jx);let E=!1;const I={};b.name!=="globe"&&T.handleWrapJump(g);for(const M of d){const N=M.getBucket(o);N&&o.fqid===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(M.tileID,N,this.crossTileIDs)&&(E=!0),I[N.bucketInstanceId]=!0)}return T.removeStaleBuckets(I)&&(E=!0),E}pruneUnusedLayers(o){const d={};o.forEach(g=>{d[g]=!0});for(const g in this.layerIndexes)d[g]||delete this.layerIndexes[g]}}const Jc=771;class Vr{constructor(o,d,g,b){this.blendFunction=o,this.blendColor=d.toNonPremultipliedRenderColor(null),this.mask=g,this.blendEquation=b}}Vr.Replace=[1,0,1,0],Vr.disabled=new Vr(Vr.Replace,i.ao.transparent,[!1,!1,!1,!1]),Vr.unblended=new Vr(Vr.Replace,i.ao.transparent,[!0,!0,!0,!0]),Vr.alphaBlended=new Vr([1,Jc,1,Jc],i.ao.transparent,[!0,!0,!0,!0]),Vr.alphaBlendedNonPremultiplied=new Vr([770,Jc,770,Jc],i.ao.transparent,[!0,!0,!0,!0]),Vr.multiply=new Vr([774,0,774,0],i.ao.transparent,[!0,!0,!0,!0]),Vr.additive=new Vr([1,1,1,1],i.ao.transparent,[!0,!0,!0,!0]);class Fn{constructor(o,d,g){this.func=o,this.mask=d,this.range=g}}Fn.ReadOnly=!1,Fn.ReadWrite=!0,Fn.disabled=new Fn(519,Fn.ReadOnly,[0,1]);const hy=7680;class Mr{constructor(o,d,g,b,T,E){this.test=o,this.ref=d,this.mask=g,this.fail=b,this.depthFail=T,this.pass=E}}Mr.disabled=new Mr({func:519,mask:0},0,0,hy,hy,hy);const Gp=1029,fy=2305;class Rr{constructor(o,d,g){this.enable=o,this.mode=d,this.frontFace=g}}function ed(m,o){const d=i.ca(m,3);i.cc(m,o),i.cg(m,3,d)}function eb(m,o){const d=i.c7([]);return i.c8(d,d,-o),i.c9(d,d,-m),d}function py(m,o){const d=[m[0],m[1],0],g=[o[0],o[1],0];if(i.ag(d)>=1e-15){const E=i.aw([],d);i.c5(g,E,i.bJ(g,E)),o[0]=g[0],o[1]=g[1]}const b=i.bI([],o,m);if(i.c6(b)<1e-15)return null;const T=Math.atan2(-b[1],b[0]);return eb(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),T)}Rr.disabled=new Rr(!1,Gp,fy),Rr.backCCW=new Rr(!0,Gp,fy),Rr.backCW=new Rr(!0,Gp,2304),Rr.frontCW=new Rr(!0,1028,2304),Rr.frontCCW=new Rr(!0,1028,fy);class Al{constructor(o,d){this.position=o,this.orientation=d}get position(){return this._position}set position(o){if(o){const d=o instanceof i.ae?o:new i.ae(o[0],o[1],o[2]);this._renderWorldCopies&&(d.x=i.bT(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(o,d,g){if(this.orientation=null,!this.position)return;const b=this.position,T=g||(this._elevation?this._elevation.getAtPointOrZero(i.ae.fromLngLat(o)):0),E=i.ae.fromLngLat(o,T),I=[E.x-b.x,E.y-b.y,E.z-b.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=py(I,d)}setPitchBearing(o,d){this.orientation=eb(i.an(o),i.an(-d))}}class my{constructor(o,d){this._transform=i.bA([]),this.orientation=d,this.position=o}get mercatorPosition(){const o=this.position;return new i.ae(o[0],o[1],o[2])}get position(){const o=i.ca(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var d;o&&i.cg(this._transform,3,[(d=o)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||i.c7([]),o&&ed(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,d){this._orientation=eb(o,d),ed(this._transform,this._orientation)}forward(){const o=i.ca(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=i.ca(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=i.ca(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,d){const g=new Float64Array(16);return i.bl(g,this.getWorldToCamera(o,d)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,d,g){const b=this.position;i.c5(b,b,-o);const T=new Float64Array(16);return i.bq(T,[g,g,g]),i.br(T,T,b),T[10]*=d,T}getWorldToCamera(o,d){const g=new Float64Array(16),b=new Float64Array(4),T=this.position;return i.cb(b,this._orientation),i.c5(T,T,-o),i.cc(g,b),i.br(g,g,T),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=d,g[9]*=d,g[10]*=d,g[11]*=d,g}getCameraToClipPerspective(o,d,g,b){const T=new Float64Array(16);return i.cd(T,o,d,g,b),T}getCameraToClipOrthographic(o,d,g,b,T,E){const I=new Float64Array(16);return i.ce(I,o,d,g,b,T,E),I}getDistanceToElevation(o,d=!1){const g=o===0?0:i.cf(o,d?i.a$(this.position[1]):this.position[1]),b=this.forward();return(g-this.position[2])/b[2]}clone(){return new my([...this.position],[...this.orientation])}}const Mo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class gy{constructor(o=0,d=0,g=0,b=0){if(isNaN(o)||o<0||isNaN(d)||d<0||isNaN(g)||g<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=d,this.left=g,this.right=b}interpolate(o,d,g){return d.top!=null&&o.top!=null&&(this.top=i.ak(o.top,d.top,g)),d.bottom!=null&&o.bottom!=null&&(this.bottom=i.ak(o.bottom,d.bottom,g)),d.left!=null&&o.left!=null&&(this.left=i.ak(o.left,d.left,g)),d.right!=null&&o.right!=null&&(this.right=i.ak(o.right,d.right,g)),this}getCenter(o,d){const g=i.aA((this.left+o-this.right)/2,0,o),b=i.aA((this.top+d-this.bottom)/2,0,d);return new i.P(g,b)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new gy(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const bc=15;class tb{constructor(o,d,g,b,T,E,I){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=o||0,this._maxZoom=d||22,this._minPitch=g??0,this._maxPitch=b??60,this.setProjection(E),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new i.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new gy,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new my,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const o=new tb(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<bc}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,d=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(o||g)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return i.aH(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=i.cm(this.projectionOptions);const g=this.getProjection(),b=!i.by(d,g);return b&&this._calcMatrices(),this.mercatorFromTransition=!1,b}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.cm({name:"mercator"});const d=o!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bT(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const d=-o*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=i.cn(),i.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const d=i.aA(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=i.an(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const d=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){const o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,d=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!d||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const g=this._elevation;d||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const o=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(o)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let b=0,T=0;for(let E=0;E<d.length;E++){const I=new i.P(d[E][0]*this.width,g+d[E][1]*(this.height-g)),M=o.pointCoordinate(I);if(!M)continue;const N=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);b+=M[3]*N,T+=N}return T===0?NaN:b/T}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*d,b=this._mercatorZfromZoom(o),T=this._mercatorZfromZoom(this._maxZoom),E=Math.max(b-g,T);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}equals(o){const d=this.elevation,g=o.elevation,b=d!=null!=(g!=null)||d&&g&&d.exaggeration()!==g.exaggeration();return this.width===o.width&&this.height===o.height&&this.center.lng===o.center.lng&&this.center.lat===o.center.lat&&this.zoom===o.zoom&&this.bearing===o.bearing&&this.pitch===o.pitch&&this.fov===o.fov&&this.projection.name===o.projection.name&&this._edgeInsets.equals(o.padding)&&!b}computeZoomRelativeTo(o){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let g;g=o.z<this._camera.position[2]?[d.x,d.y,d.z]:[o.x,o.y,o.z];const b=i.ag(i.av([],this._camera.position,g));return i.aA(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let d=!1;if(o.orientation&&!i.cp(o.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(o.orientation)),o.position){const g=[o.position.x,o.position.y,o.position.z];i.cq(g,this._camera.position)||(this._setCameraPosition(g),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,d=new Al;return d.position=new i.ae(o[0],o[1],o[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(o){if(!i.cr(o))return!1;i.cs(o,o);const d=i.ct([],[0,0,-1],o),g=i.ct([],[0,-1,0],o);if(g[2]<0)return!1;const b=py(d,g);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(o){const d=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;o[2]=i.aA(o[2],b/g,b/d),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,d,g){this._unmodified=!1,this._edgeInsets.interpolate(o,d,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const d=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(o){const d=[new i.cu(0,o)];if(this.renderWorldCopies){const g=this.pointCoordinate(new i.P(0,0)),b=this.pointCoordinate(new i.P(this.width,0)),T=this.pointCoordinate(new i.P(this.width,this.height)),E=this.pointCoordinate(new i.P(0,this.height)),I=Math.floor(Math.min(g.x,b.x,T.x,E.x)),M=Math.floor(Math.max(g.x,b.x,T.x,E.x)),N=1;for(let j=I-N;j<=M+N;j++)j!==0&&d.push(new i.cu(j,o))}return d}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,d,g,b){let T=[];const E=g!=null,I=!E;if(I&&this.zoom<d||E&&g[0]===0&&g[1]===0)return T;const M=new Set,N=(W,Z,Y,te,J)=>{const oe=i.cY(Z,W,Y,te,J);M.has(oe)||(T.push(new i.aQ(W,Z,Y,te,J)),M.add(oe))};for(let W=0;W<o.length;W++){const Z=o[W];if(I&&Z.canonical.z!==d||E&&b!==void 0&&b>Z.canonical.z)continue;const Y=Z.canonical,te=Z.overscaledZ,J=Z.wrap,oe=1<<Y.z,ae=Y.x+1<oe,pe=Y.x>0,_e=Y.y+1<oe,me=Y.y>0,Le=Z.wrap-(pe?0:1),Ce=Z.wrap+(ae?0:1),Re=pe?Y.x-1:oe-1,Ae=ae?Y.x+1:0;if(E)g[0]<0?(N(te,Ce,Y.z,Ae,Y.y),g[1]<0&&_e&&(N(te,J,Y.z,Y.x,Y.y+1),N(te,Ce,Y.z,Ae,Y.y+1)),g[1]>0&&me&&(N(te,J,Y.z,Y.x,Y.y-1),N(te,Ce,Y.z,Ae,Y.y-1))):g[0]>0?(N(te,Le,Y.z,Re,Y.y),g[1]<0&&_e&&(N(te,J,Y.z,Y.x,Y.y+1),N(te,Le,Y.z,Re,Y.y+1)),g[1]>0&&me&&(N(te,J,Y.z,Y.x,Y.y-1),N(te,Le,Y.z,Re,Y.y-1))):g[1]<0&&_e?N(te,J,Y.z,Y.x,Y.y+1):me&&N(te,J,Y.z,Y.x,Y.y-1);else{const Te=Z.visibleQuadrants;1&Te&&(N(te,Le,Y.z,Re,Y.y),me&&(N(te,J,Y.z,Y.x,Y.y-1),N(te,Le,Y.z,Re,Y.y-1))),2&Te&&(N(te,Ce,Y.z,Ae,Y.y),me&&(N(te,J,Y.z,Y.x,Y.y-1),N(te,Ce,Y.z,Ae,Y.y-1))),4&Te&&(N(te,Le,Y.z,Re,Y.y),_e&&(N(te,J,Y.z,Y.x,Y.y+1),N(te,Le,Y.z,Re,Y.y+1))),8&Te&&(N(te,Ce,Y.z,Ae,Y.y),_e&&(N(te,J,Y.z,Y.x,Y.y+1),N(te,Ce,Y.z,Ae,Y.y+1)))}}const j=[];for(const W of T)T.some(Z=>W.isChildOf(Z))||j.push(W);if(T=j.filter(W=>!o.some(Z=>!!(W.overscaledZ<d&&Z.isChildOf(W))||W.equals(Z)||W.isChildOf(Z))),I){const W=1<<d,Z=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=[W*Z.x,W*Z.y],te=4,J=te*te;T=T.filter(oe=>{const ae=oe.canonical.x+.5-Y[0],pe=oe.canonical.y+.5-Y[1];return ae*ae+pe*pe<J})}return T}extendTileCoverToNearPlane(o,d,g){const b=[],T=new Set;for(const pe of o)T.add(pe.key);const E=(pe,_e,me,Le,Ce)=>{const Re=i.cY(_e,pe,me,Le,Ce);T.has(Re)||(b.push(new i.aQ(pe,_e,me,Le,Ce)),T.add(Re))},I=o.reduce((pe,_e)=>Math.max(pe,_e.overscaledZ),g),M=1<<g,N=[new i.P(0,0),new i.P(i.al,0),new i.P(i.al,i.al),new i.P(0,i.al)],j=new i.P(0,0),W=new i.P(0,0),Z=(pe,_e)=>{const me=Math.floor(pe[0]),Le=Math.floor(pe[1]),Ce=(pe[0]-me)*i.al,Re=(pe[1]-Le)*i.al,Ae=Math.floor(_e[0]),Te=Math.floor(_e[1]),ze=(_e[0]-Ae)*i.al,We=(_e[1]-Te)*i.al;for(let Ge=-1;Ge<=1;Ge++){const ct=me+Ge;if(!(ct<0||ct>=M)){j.x=Ce-Ge*i.al,W.x=ze-(ct-Ae)*i.al;for(let ht=-1;ht<=1;ht++){const Et=Le+ht;j.y=Re-ht*i.al,W.y=We-(Et-Te)*i.al,i.cZ(j,W,N)&&E(I,0,g,ct,Et)}}}},Y=d.points,te=Y[i.cv],J=Y[i.cw],oe=this._projectToGround(te,Y[i.cx]),ae=this._projectToGround(J,Y[i.cy]);return Z(te,oe),Z(J,ae),b}_projectToGround(o,d){return i.cz(i.cA(),o,d,o[2]/(o[2]-d[2]))}coveringTiles(o){let d=this.coveringZoomLevel(o);const g=d,b=this.elevation&&this.elevation.exaggeration(),T=b&&!o.isTerrainDEM,E=this.projection.name==="mercator";if(o.minzoom!==void 0&&d<o.minzoom)return[];o.maxzoom!==void 0&&d>o.maxzoom&&(d=o.maxzoom);const I=this.locationCoordinate(this.center),M=this.center.lat,N=1<<d,j=[N*I.x,N*I.y,0],W=this.projection.name==="globe",Z=!W,Y=i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,Z),te=W?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=N*i.cf(1,this.center.lat),oe=this._camera.position[2]/i.cf(1,this.center.lat),ae=[N*te.x,N*te.y,oe*(Z?1:J)],pe=W||b,_e=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),me=this.isLODDisabled(!0)?d:0;let Le;if(this._elevation&&o.isTerrainDEM)Le=1e4*this._elevation.exaggeration();else if(this._elevation){const Ue=this._elevation.getMinMaxForVisibleTiles();Le=Ue?Ue.max:this._centerAltitude}else Le=this._centerAltitude;const Ce=o.isTerrainDEM?-Le:this._elevation?this._elevation.getMinElevationBelowMSL():0,Re=this.projection.isReprojectedInTileSpace?i.cC(this):1,Ae=Ue=>{const ut=new i.ae(Ue.x+25e-6,Ue.y,Ue.z),Pt=new i.ae(Ue.x,Ue.y+25e-6,Ue.z),nn=Ue.toLngLat(),_n=ut.toLngLat(),Yt=Pt.toLngLat(),Vt=this.locationCoordinate(nn),On=this.locationCoordinate(_n),Cn=this.locationCoordinate(Yt),fn=Math.hypot(On.x-Vt.x,On.y-Vt.y),vn=Math.hypot(Cn.x-Vt.x,Cn.y-Vt.y);return Math.sqrt(fn*vn)*Re/25e-6},Te=Ue=>{const _t=Le,ut=Ce;return{aabb:i.cF(this,N,0,0,0,Ue,ut,_t,this.projection),zoom:0,x:0,y:0,minZ:ut,maxZ:_t,wrap:Ue,fullyVisible:!1}},ze=[];let We=[];const Ge=d,ct=o.reparseOverscaled?g:d,ht=(oe-this._centerAltitude)*J,Et=Ue=>{if(!this._elevation||!Ue.tileID||!E)return;const _t=this._elevation.getMinMaxForTile(Ue.tileID),ut=Ue.aabb;_t?(ut.min[2]=_t.min,ut.max[2]=_t.max,ut.center[2]=(ut.min[2]+ut.max[2])/2):(Ue.shouldSplit=it(Ue),Ue.shouldSplit||(ut.min[2]=ut.max[2]=ut.center[2]=this._centerAltitude))},Ut=(Ue,_t)=>{if(.707*_t<Ue)return 1;const ut=_t/Ue;return ut/(1.4144271570014144+(Math.pow(1.1,ut-1.4144271570014144+1)-1)/(1.1-1)-1)},it=Ue=>{if(Ue.zoom<me)return!0;if(Ue.zoom===Ge)return!1;if(Ue.shouldSplit!=null)return Ue.shouldSplit;const _t=Ue.aabb.distanceX(ae),ut=Ue.aabb.distanceY(ae);let Pt=ht,nn=1;if(W){Pt=Ue.aabb.distanceZ(ae);const vn=Math.pow(2,Ue.zoom),tr=i.a$((Ue.y+1)/vn),Nr=i.a$(Ue.y/vn),mi=Math.min(Math.max(M,tr),Nr),Bi=i.d1(mi)/i.d1(M);if(nn=mi===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Bi/this._mercatorScaleRatio),this.zoom<=i.c_&&Ue.zoom===Ge-1&&Bi>=.9)return!0}else if(T&&(Pt=Ue.aabb.distanceZ(ae)*J),this.projection.isReprojectedInTileSpace&&g<=5){const vn=Math.pow(2,Ue.zoom),tr=Ae(new i.ae((Ue.x+.5)/vn,(Ue.y+.5)/vn));nn=tr>.85?1:tr}if(!E&&!W){const vn=Math.sqrt(_t*_t+ut*ut+Pt*Pt);let tr=(1<<Ge-Ue.zoom)*_e*nn;return tr*=Ut(Math.max(Pt,ht),vn),vn<tr}let _n=Number.MAX_VALUE,Yt=0;const Vt=Ue.aabb.getCorners(),On=[];for(const vn of Vt){i.av(On,vn,ae),W||(T?On[2]*=J:On[2]=ht);const tr=i.bJ(On,this._camera.forward());tr<_n&&(_n=tr,Yt=Math.abs(On[2]))}let Cn=(1<<Ge-Ue.zoom)*_e*nn;if(Cn*=Ut(Math.max(Yt,ht),_n),_n<Cn)return!0;const fn=Ue.aabb.closestPoint(j);return fn[0]===j[0]&&fn[1]===j[1]};if(this.renderWorldCopies)for(let Ue=1;Ue<=3;Ue++)ze.push(Te(-Ue)),ze.push(Te(Ue));for(ze.push(Te(0));ze.length>0;){const Ue=ze.pop(),_t=Ue.x,ut=Ue.y;let Pt=Ue.fullyVisible;const nn=()=>this.projection.name==="globe"&&(Ue.y===0||Ue.y===(1<<Ue.zoom)-1);if(!Pt){let _n=pe?Ue.aabb.intersects(Y):Ue.aabb.intersectsFlat(Y);if(_n===0&&nn()){const Yt=new i.cD(Ue.zoom,_t,ut);_n=i.cE(this,N,Yt,!0).intersects(Y)}if(_n===0)continue;Pt=_n===2}if(Ue.zoom!==Ge&&it(Ue))for(let _n=0;_n<4;_n++){const Yt=(_t<<1)+_n%2,Vt=(ut<<1)+(_n>>1),On={aabb:E?Ue.aabb.quadrant(_n):i.cF(this,N,Ue.zoom+1,Yt,Vt,Ue.wrap,Ue.minZ,Ue.maxZ,this.projection),zoom:Ue.zoom+1,x:Yt,y:Vt,wrap:Ue.wrap,fullyVisible:Pt,tileID:void 0,shouldSplit:void 0,minZ:Ue.minZ,maxZ:Ue.maxZ};T&&!W&&(On.tileID=new i.aQ(Ue.zoom+1===Ge?ct:Ue.zoom+1,Ue.wrap,Ue.zoom+1,Yt,Vt),Et(On)),ze.push(On)}else{const _n=Ue.zoom===Ge?ct:Ue.zoom;if(o.minzoom&&o.minzoom>_n)continue;let Yt=0;if(!Pt){let fn=pe?Ue.aabb.intersectsPrecise(Y):Ue.aabb.intersectsPreciseFlat(Y);if(fn===0&&nn()){const vn=new i.cD(Ue.zoom,_t,ut);fn=i.cE(this,N,vn,!0).intersectsPrecise(Y)}if(fn===0)continue;if(o.calculateQuadrantVisibility)if(Y.containsPoint(Ue.aabb.center))Yt=15;else for(let vn=0;vn<4;vn++)Ue.aabb.quadrant(vn).intersects(Y)!==0&&(Yt|=1<<vn)}const Vt=j[0]-(.5+_t+(Ue.wrap<<Ue.zoom))*(1<<d-Ue.zoom),On=j[1]-.5-ut,Cn=Ue.tileID?Ue.tileID:new i.aQ(_n,Ue.wrap,Ue.zoom,_t,ut);o.calculateQuadrantVisibility&&(Cn.visibleQuadrants=Yt),We.push({tileID:Cn,distanceSq:Vt*Vt+On*On})}}if(this.fogCullDistSq){const Ue=this.fogCullDistSq,_t=this.horizonLineFromTop();We=We.filter(ut=>{const Pt=[0,0,0,1],nn=[i.al,i.al,0,1],_n=this.calculateFogTileMatrix(ut.tileID.toUnwrapped());i.aC(Pt,Pt,_n),i.aC(nn,nn,_n);const Yt=i.cG([],Pt,nn),Vt=i.cH([],Pt,nn),On=i.c$(Yt,Vt);if(On===0)return!0;let Cn=!1;const fn=this._elevation;if(fn&&On>Ue&&_t!==0){const vn=this.calculateProjMatrix(ut.tileID.toUnwrapped());let tr;o.isTerrainDEM||(tr=fn.getMinMaxForTile(ut.tileID)),tr||(tr={min:Ce,max:Le});const Nr=i.cI(this.rotation),mi=[Nr[0]*i.al,Nr[1]*i.al,tr.max];i.af(mi,mi,vn),Cn=(1-mi[1])*this.height*.5<_t}return On<Ue||Cn})}return We.sort((Ue,_t)=>Ue.distanceSq-_t.distanceSq).map(Ue=>Ue.tileID)}resize(o,d){this.width=o,this.height=d,this.pixelsToGLUnits=[2/o,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log2(o)}project(o){const d=i.aA(o.lat,-i.cJ,i.cJ),g=this.projection.project(o.lng,d);return new i.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,d){let g,b;const T=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;g=(d.x-T.x)/I,b=(d.y-T.y)/I}else{const I=this.pointCoordinate(d),M=this.pointCoordinate(T);g=I.x-M.x,b=I.y-M.y}const E=this.locationCoordinate(o);this.setLocation(new i.ae(E.x-g,E.y-b))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,d){return this.projection.locationPoint(this,o,d)}locationPoint3D(o,d){return this.projection.locationPoint(this,o,d,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,d){return this.coordinateLocation(this.pointCoordinate3D(o,d))}locationCoordinate(o,d){const g=d?i.cf(d,o.lat):void 0,b=this.projection.project(o.lng,o.lat);return new i.ae(b.x,b.y,g)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,d){const g=d??this._centerAltitude,b=[o.x,o.y,0,1],T=[o.x,o.y,1,1];i.aC(b,b,this.pixelMatrixInverse),i.aC(T,T,this.pixelMatrixInverse);const E=T[3];i.cK(b,b,1/b[3]),i.cK(T,T,1/E);const I=b[2],M=T[2];return{p0:b,p1:T,t:I===M?0:(g-I)/(M-I)}}screenPointToMercatorRay(o){const d=[o.x,o.y,0,1],g=[o.x,o.y,1,1];return i.aC(d,d,this.pixelMatrixInverse),i.aC(g,g,this.pixelMatrixInverse),i.cK(d,d,1/d[3]),i.cK(g,g,1/g[3]),d[2]=i.cf(d[2],this._center.lat)*this.worldSize,g[2]=i.cf(g[2],this._center.lat)*this.worldSize,i.cK(d,d,1/this.worldSize),i.cK(g,g,1/this.worldSize),new i.ax([d[0],d[1],d[2]],i.aw([],i.av([],g,d)))}rayIntersectionCoordinate(o){const{p0:d,p1:g,t:b}=o,T=i.cf(d[2],this._center.lat),E=i.cf(g[2],this._center.lat);return new i.ae(i.ak(d[0],g[0],b)/this.worldSize,i.ak(d[1],g[1],b)/this.worldSize,i.ak(T,E,b))}pointCoordinate(o,d=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,d)}pointCoordinate3D(o,d){if(!this.elevation)return this.pointCoordinate(o,d);let g=this.projection.pointCoordinate3D(this,o.x,o.y);if(g)return new i.ae(g[0],g[1],g[2]);let b=0,T=this.horizonLineFromTop();if(o.y>T)return this.pointCoordinate(o,d);const E=.02*T,I=o.clone();for(let M=0;M<10&&T-b>E;M++){I.y=i.ak(b,T,.66);const N=this.projection.pointCoordinate3D(this,I.x,I.y);N?(T=I.y,g=N):b=I.y}return g?new i.ae(g[0],g[1],g[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=i.cL)return!this.isPointAboveHorizon(o);const d=this.pointCoordinate(o);return d.y>=0&&d.y<=1}_coordinatePoint(o,d){const g=d&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,b=[o.x*this.worldSize,o.y*this.worldSize,g+o.toAltitude(),1];return i.aC(b,b,this.pixelMatrix),b[3]>0?new i.P(b[0]/b[3],b[1]/b[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:d}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,T=this.pointLocation3D(new i.P(d,o)),E=this.pointLocation3D(new i.P(b,o)),I=this.pointLocation3D(new i.P(b,g)),M=this.pointLocation3D(new i.P(d,g));let N=Math.min(T.lng,E.lng,I.lng,M.lng),j=Math.max(T.lng,E.lng,I.lng,M.lng),W=Math.min(T.lat,E.lat,I.lat,M.lat),Z=Math.max(T.lat,E.lat,I.lat,M.lat);const Y=Math.pow(2,-this.zoom)/16*270,te=this.projection.name==="globe"?1:4,J=(oe,ae,pe,_e,me)=>{const Le=(oe+pe)/2,Ce=(ae+_e)/2,Re=new i.P(Le,Ce),{lng:Ae,lat:Te}=this.pointLocation3D(Re),ze=Math.max(0,N-Ae,W-Te,Ae-j,Te-Z);N=Math.min(N,Ae),j=Math.max(j,Ae),W=Math.min(W,Te),Z=Math.max(Z,Te),(me<te||ze>Y)&&(J(oe,ae,Le,Ce,me+1),J(Le,Ce,pe,_e,me+1))};if(J(d,o,b,o,1),J(b,o,b,g,1),J(b,g,d,g,1),J(d,g,d,o,1),this.projection.name==="globe"){const[oe,ae]=i.cM(this);oe?(Z=90,j=180,N=-180):ae&&(W=-90,j=180,N=-180)}return new i.aI(new i.aT(N,W),new i.aT(j,Z))}_getBoundsRectangular(o,d){const{top:g,left:b}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,I=new i.P(b,g),M=new i.P(E,g),N=new i.P(E,T),j=new i.P(b,T);let W=this.pointCoordinate(I,o),Z=this.pointCoordinate(M,o);const Y=this.pointCoordinate(N,d),te=this.pointCoordinate(j,d),J=(oe,ae)=>(ae.y-oe.y)/(ae.x-oe.x);return W.y>1&&Z.y>=0?W=new i.ae((1-te.y)/J(te,W)+te.x,1):W.y<0&&Z.y<=1&&(W=new i.ae(-te.y/J(te,W)+te.x,0)),Z.y>1&&W.y>=0?Z=new i.ae((1-Y.y)/J(Y,Z)+Y.x,1):Z.y<0&&W.y<=1&&(Z=new i.ae(-Y.y/J(Y,Z)+Y.x,0)),new i.aI().extend(this.coordinateLocation(W)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(te)).extend(this.coordinateLocation(Y))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=o.visibleDemTiles.reduce((g,b)=>{if(b.dem){const T=b.dem.tree;g.min=Math.min(g.min,T.minimums[0]),g.max=Math.max(g.max,T.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*o.exaggeration(),d.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-d*(1-this._horizonShift);return o?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-i.cJ,this.maxLat=i.cJ,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aF(this.minLng)*this.tileSize,this.worldMaxX=i.aF(this.maxLng)*this.tileSize,this.worldMinY=i.aJ(this.maxLat)*this.tileSize,this.worldMaxY=i.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,d){return this.projection.createTileMatrix(this,d,o)}calculateDistanceTileData(o){const d=o.key,g=this._distanceTileDataCache;if(g[d])return g[d];const b=o.canonical,T=1/this.height,E=this.cameraWorldSize,I=E/this.zoomScale(b.z),M=(b.x+Math.pow(2,b.z)*o.wrap)*I,N=b.y*I,j=this.point;j.x*=E/this.worldSize,j.y*=E/this.worldSize;const W=this.angle,Z=Math.sin(-W),Y=-Math.cos(-W);return g[d]={bearing:[Z,Y],center:[(j.x-M)*T,(j.y-N)*T],scale:I/i.al*T},g[d]}calculateFogTileMatrix(o){const d=o.key,g=this._fogTileMatrixCache;if(g[d])return g[d];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return i.aB(b,this.worldToFogMatrix,b),g[d]=new Float32Array(b),g[d]}calculateProjMatrix(o,d=!1,g=!1){const b=o.key;let T;if(T=g?this._expandedProjMatrixCache:d?this._alignedProjMatrixCache:this._projMatrixCache,T[b])return T[b];const E=this.calculatePosMatrix(o,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:d?this.alignedProjMatrix:this.projMatrix,i.aB(E,I,E),T[b]=new Float32Array(E),T[b]}calculatePixelsToTileUnitsMatrix(o){const d=o.tileID.key,g=this._pixelsToTileUnitsCache;if(g[d])return g[d];const b=i.cN(o,this);return g[d]=b,g[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,d=i.bq([],[o,o,o]);return i.aB(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const d=i.cf(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(d),b=this._camera.forward(),T=i.cf(1,this._center.lat);g[2]/=T,b[2]/=T,i.aw(b,b);const E=o.raycast(g,b,o.exaggeration());if(E){const I=i.bH([],g,b,E),M=new i.ae(I[0],I[1],i.cf(I[2],i.a$(I[1]))),N=(M.z+i.ag([M.x-g[0],M.y-g[1],M.z-g[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const d=this._elevation,g=i.cf(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(g),T=d.getAtPointOrZero(new i.ae(...b)),E=this.pixelsPerMeter/this.worldSize*T,I=this._minimumHeightOverTerrain(),M=b[2]-E;if(M<=I)if(M<0||o){const N=this.locationCoordinate(this._center,this._centerAltitude),j=[b[0],b[1],N.z-b[2]],W=i.ag(j);j[2]-=(I-M)/this._pixelsPerMercatorPixel;const Z=i.ag(j);if(Z===0)return;i.c5(j,j,W/Z*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],N.z*this._pixelsPerMercatorPixel-j[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const Z=this.center;return Z.lat=i.aA(Z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(Z.lng=i.aA(Z.lng,this.minLng,this.maxLng)),this.center=Z,void(this._constraining=!1)}const d=this._unmodified,{x:g,y:b}=this.point;let T=0,E=g,I=b;const M=this.width/2,N=this.height/2,j=this.worldMinY*this.scale,W=this.worldMaxY*this.scale;if(b-N<j&&(I=j+N),b+N>W&&(I=W-N),W-j<this.height&&(T=Math.max(T,this.height/(W-j)),I=(W+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Z=this.worldMinX*this.scale,Y=this.worldMaxX*this.scale,te=this.worldSize/2-(Z+Y)/2;E=(g+te+this.worldSize)%this.worldSize-te,E-M<Z&&(E=Z+M),E+M>Y&&(E=Y-M),Y-Z<this.width&&(T=Math.max(T,this.width/(Y-Z)),E=(Y+Z)/2)}E===g&&I===b||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(E,I))),T&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,d=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.cf(1,this.center.lat)/i.cf(1,i.d2));const b=i.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const T=this.projection.zAxisUnit==="meters"?g:1,E=this._camera.getWorldToCamera(this.worldSize,T);let I;const M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-o.x/this.width,M[9]=2*o.y/this.height,this.isOrthographic){let Te=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ze=Te*this.aspect,We=-ze,Ge=-Te;ze-=o.x,We-=o.x,Te+=o.y,Ge+=o.y,I=this._camera.getCameraToClipOrthographic(We,ze,Ge,Te,this._nearZ,this._farZ),((ct,ht,Et,Ut)=>{for(let it=0;it<16;it++)ct[it]=i.ak(ht[it],Et[it],Ut)})(I,I,M,i.d0(this.pitch>=bc?1:this.pitch/bc))}else I=M;const N=i.cP([],M,E);let j=i.cP([],I,E);if(this.projection.isReprojectedInTileSpace){const Te=this.locationCoordinate(this.center),ze=i.bA([]);i.br(ze,ze,[Te.x*this.worldSize,Te.y*this.worldSize,0]),i.aB(ze,ze,i.cQ(this)),i.br(ze,ze,[-Te.x*this.worldSize,-Te.y*this.worldSize,0]),i.aB(j,j,ze),i.aB(N,N,ze),this.inverseAdjustmentMatrix=i.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cS([],j,[this.worldSize,this.worldSize,this.worldSize/T,1]),this.projMatrix=j,this.invProjMatrix=i.bl(new Float64Array(16),this.projMatrix),d){const Te=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Te[8]=2*-o.x/this.width,Te[9]=2*o.y/this.height,this.expandedFarZProjMatrix=i.cP([],Te,E)}else this.expandedFarZProjMatrix=this.projMatrix;const W=i.bl([],I);this.frustumCorners=i.cT.fromInvProjectionMatrix(W,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!d);const Z=new Float32Array(16);i.bA(Z),i.cS(Z,Z,[1,-1,1]),i.cU(Z,Z,this._pitch),i.bB(Z,Z,this.angle);const Y=i.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.bz(Y);const te=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Y[8]=2*-o.x/this.width,Y[9]=2*(o.y+te)/this.height,this.skyboxMatrix=i.aB(Z,Y,Z);const J=this.point,oe=J.x,ae=J.y,pe=this.width%2/2,_e=this.height%2/2,me=Math.cos(this.angle),Le=Math.sin(this.angle),Ce=oe-Math.round(oe)+me*pe+Le*_e,Re=ae-Math.round(ae)+me*_e+Le*pe,Ae=new Float64Array(j);if(i.br(Ae,Ae,[Ce>.5?Ce-1:Ce,Re>.5?Re-1:Re,0]),this.alignedProjMatrix=Ae,j=i.bC(),i.cS(j,j,[this.width/2,-this.height/2,1]),i.br(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=i.bC(),i.cS(j,j,[1,-1,1]),i.br(j,j,[-1,-1,0]),i.cS(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=i.aB(new Float64Array(16),this.labelPlaneMatrix,N),this._calcFogMatrices(),this._distanceTileDataCache={},j=i.bl(new Float64Array(16),this.pixelMatrix),!j)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=j,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cV(this);const Te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.af(Te,Te,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=j;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,g=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,T=[o,o,d];i.c5(T,T,b),i.c5(g,g,-1),i.cW(g,g,T);const E=i.bC();i.br(E,E,g),i.cS(E,E,T),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,d,b)}_computeCameraPosition(o){const d=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),b=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-o/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-g[0]*T,b.y/this.worldSize-g[1]*T,o/this.worldSize*this._centerAltitude-g[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],b=o[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(T=Math.min((d-g)/b,1)),this._camera.position=i.bH([],this._camera.position,o,T),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,d=this._camera.forward(),{pitch:g,bearing:b}=this._camera.getPitchBearing(),T=i.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.an(this._maxPitch)),I=Math.max((o[2]-T)/Math.cos(g),E),M=this._zoomFromMercatorZ(I);i.bH(o,o,d,I),this._pitch=i.aA(g,i.an(this.minPitch),i.an(this.maxPitch)),this.angle=i.bT(b,-Math.PI,Math.PI),this._setZoom(i.aA(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ae(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,o)*this.tileSize))}zoomFromMercatorZAdjusted(o){let d=0,g=i.cL,b=0,T=1/0;for(;g-d>1e-6&&g>d;){const E=d+.5*(g-d),I=this.tileSize*Math.pow(2,E),M=this.getCameraToCenterDistance(this.projection,E,I),N=this.scaleZoom(M/(Math.max(0,o)*this.tileSize)),j=Math.abs(E-N);j<T&&(T=j,b=E),E<N?d=E:g=E}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,d){const g=Math.min(o.x,d.x),b=Math.max(o.x,d.x),T=Math.min(o.y,d.y),E=Math.max(o.y,d.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new i.P(g,T),new i.P(b,E),new i.P(g,E),new i.P(b,T)],M=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(const j of I){const W=this.pointRayIntersection(j);if(W.t<0)return!0;const Z=this.rayIntersectionCoordinate(W);if(Z.x<M||Z.y<0||Z.x>N||Z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(o,d){const g=i.ag(i.av([],this._camera.position,o)),b=this._zoomFromMercatorZ(g)+d;return g-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([d,g,b],T){const E=[d,g,b,1];i.aC(E,E,T);const I=E[3]=Math.max(E[3],1e-6);return E[0]/=I,E[1]/=I,E[2]/=I,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,o))}}getCameraToCenterDistance(o,d=this.zoom,g=this.worldSize){const b=i.cO(o,d,this.width,this.height,1024),T=o.pixelSpaceConversion(this.center.lat,g,b);let E=.5/Math.tan(.5*this._fov)*this.height*T;return this.isOrthographic&&(E=i.ak(1,E,i.d0(this.pitch>=bc?1:this.pitch/bc))),E}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.aB(o,o,this.globeMatrix),o}getFrustum(o){return i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}const Mh=(m,o)=>{if(o>0&&m.terrain&&i.w("Cutoff is currently disabled on terrain"),o<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const d=m.transform,g=Math.max(Math.abs(d._zoom-(m.minCutoffZoom-1)),1),b=d.isLODDisabled(!1)?i.ah(60,45,d.pitch):i.ah(30,15,d.pitch),T=d._farZ-d._nearZ,E=o*d.height,I=((1-(M=b))*d.cameraToCenterDistance+M*(d._farZ+E))*g;var M;return{shouldRenderCutoff:b<1,uniformValues:{u_cutoff_params:[d._nearZ,d._farZ,(I-d._nearZ)/T,(I-E-d._nearZ)/T]}}},Gu=2048;class eg{constructor(o,d){this.aabb=o,this.lastCascade=d}}class pI{add(o,d){const g=this.receivers[o.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],d.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],d.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],d.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],d.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],d.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],d.max[2])):this.receivers[o.key]=new eg(d,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,d,g){const b=i.d9.fromPoints(o.points);let T=0;for(const E in this.receivers){const I=this.receivers[E];if(!I||!b.intersectsAabb(I.aabb))continue;I.aabb.min=b.closestPoint(I.aabb.min),I.aabb.max=b.closestPoint(I.aabb.max);const M=I.aabb.getCorners();for(let N=0;N<g.length;N++){let j=!0;for(const W of M){const Z=[W[0]*d,W[1]*d,W[2]];if(i.af(Z,Z,g[N].matrix),Z[0]<-1||Z[0]>1||Z[1]<-1||Z[1]>1){j=!1;break}}if(I.lastCascade=N,T=Math.max(T,N),j)break}}return T+1}}class qp{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new pI,this._depthMode=new Fn(o.context.gl.LEQUAL,Fn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,d){const g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!d||!d.properties)return;const b=d.properties.get("shadow-intensity");if(!d.shadowsEnabled()||b<=0||(this._shadowLayerCount=g.style.order.reduce((te,J)=>{const oe=g.style._mergedLayers[J];return te+(oe.hasShadowPass()&&!oe.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const T=g.context,E=Gu,I=Gu;if(this._cascades.length===0||Gu!==this._cascades[0].texture.size[0]){this._cascades=[];for(let te=0;te<2;++te){const J=g._shadowMapDebug,oe=T.gl,ae=T.createFramebuffer(E,I,J?1:0,"texture"),pe=new i.T(T,{width:E,height:I,data:null},oe.DEPTH_COMPONENT16);if(ae.depthAttachment.set(pe.texture),J){const _e=new i.T(T,{width:E,height:I,data:null},oe.RGBA8);ae.colorAttachment0.set(_e.texture)}this._cascades.push({framebuffer:ae,texture:pe,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cB,scale:0})}}this.shadowDirection=ng(d);let M=0;if(o.elevation){const te=o.elevation,J=[1e4,-1e4];te.visibleDemTiles.filter(oe=>oe.dem).forEach(oe=>{const ae=oe.dem.tree;J[0]=Math.min(J[0],ae.minimums[0]),J[1]=Math.max(J[1],ae.maximums[0])}),J[0]!==1e4&&(M=(J[1]-J[0])*te.exaggeration())}const N=1.5*o.cameraToCenterDistance,j=3*N,W=new Float64Array(16);for(let te=0;te<this._cascades.length;++te){const J=this._cascades[te];let oe=o.height/50,ae=1;te===0?ae=N:(oe=N,ae=j);const[pe,_e]=Ph(o,this.shadowDirection,oe,ae,Gu,M);J.scale=o.scale,J.matrix=pe,J.boundingSphereRadius=_e,i.bl(W,J.matrix),J.frustum=i.cB.fromInvProjectionMatrix(W,1,0,!0),J.far=ae}const Z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Z].far,this._cascades[Z].far],this._uniformValues.u_shadow_intensity=b,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Gu,this._uniformValues.u_shadowmap_0=Mo.ShadowMap0,this._uniformValues.u_shadowmap_1=Mo.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Y=g.transform.elevation;for(const te of this._groundShadowTiles){let J={min:0,max:0};if(Y){const oe=Y.getMinMaxForTile(te);oe&&(J=oe)}this.addShadowReceiver(te.toUnwrapped(),J.min,J.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,d){if(!this.enabled)return;const g=this.painter,b=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),b.viewport.set([0,0,Gu,Gu]);for(let T=0;T<this._numCascadesToRender;++T){g.currentShadowCascade=T,b.bindFramebuffer.set(this._cascades[T].framebuffer.framebuffer),b.clear({color:i.ao.white,depth:1});for(const E of o.order){const I=o._mergedLayers[E];if(!I.hasShadowPass()||I.isHidden(g.transform.zoom))continue;const M=o.getLayerSourceCache(I),N=M?d[M.id]:void 0;(I.type==="model"||N&&N.length)&&g.renderLayer(g,M,I,N)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const o=this.painter,d=o.style,g=o.context,b=g.gl,T=d.directionalLight,E=d.ambientLight;if(!T||!E)return;const I=[],M=Mh(o,o.longestCutoffRange);M.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const N=Od(d,T,E),j=new Fn(b.LEQUAL,Fn.ReadOnly,o.depthRangeFor3D),W=new Mr({func:b.EQUAL,mask:255},0,255,b.KEEP,b.KEEP,b.KEEP);for(const Z of this._groundShadowTiles){const Y=Z.toUnwrapped(),te=o.isTileAffectedByFog(Z),J=o.getOrCreateProgram("groundShadow",{defines:I,overrideFog:te});this.setupShadows(Y,J),o.uploadCommonUniforms(g,J,Y,null,M);const oe={u_matrix:o.transform.calculateProjMatrix(Y),u_ground_shadow_factor:N};J.draw(o,b.TRIANGLES,j,W,Vr.multiply,Rr.disabled,oe,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Vr.unblended:Vr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){const d=this.painter.transform,g=d.calculatePosMatrix(o,d.worldSize);return i.aB(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(o){const d=i.bz(o);return i.aB(d,this._cascades[this.painter.currentShadowCascade].matrix,o),d}setupShadows(o,d,g){if(!this.enabled)return;const b=this.painter.transform,T=this.painter.context,E=T.gl,I=this._uniformValues,M=new Float64Array(16),N=b.calculatePosMatrix(o,b.worldSize);for(let j=0;j<this._cascades.length;j++)i.aB(M,this._cascades[j].matrix,N),I[j===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),T.activeTexture.set(E.TEXTURE0+Mo.ShadowMap0+j),this._cascades[j].texture.bindExtraParam(E.LINEAR,E.LINEAR,E.CLAMP_TO_EDGE,E.CLAMP_TO_EDGE,E.GREATER);if(this.useNormalOffset=!!g,this.useNormalOffset){const j=i.d7(o.canonical),W=2/b.tileSize*i.al/Gu,Z=W*this._cascades[0].boundingSphereRadius,Y=W*this._cascades[this._cascades.length-1].boundingSphereRadius,te=(g==="vector-tile"?1:3)*function(J,oe,ae,pe,_e){const me=i.aA((J-22)/-22,0,1);return .125*(1-me)+4*me}(b.zoom);I.u_shadow_normal_offset=[j,Z*te,Y*te],I.u_shadow_bias=[1e-4,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(T,I)}setupShadowsFromMatrix(o,d,g=!1){if(!this.enabled)return;const b=this.painter.context,T=b.gl,E=this._uniformValues,I=new Float64Array(16);for(let M=0;M<2;M++)i.aB(I,this._cascades[M].matrix,o),E[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),b.activeTexture.set(T.TEXTURE0+Mo.ShadowMap0+M),this._cascades[M].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);this.useNormalOffset=g,g?(E.u_shadow_normal_offset=[1,3,3],E.u_shadow_bias=[6e-5,.0012,.012]):E.u_shadow_bias=[36e-5,.0012,.012],d.setShadowUniformValues(b,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,d,g,b){if(b[2]>=0)return{};const T=function(M,N,j){const W=j/(1<<M.canonical.z);return new i.d9([M.canonical.x*W+M.wrap*j,M.canonical.y*W+M.wrap*j,0],[(M.canonical.x+1)*W+M.wrap*j,(M.canonical.y+1)*W+M.wrap*j,N])}(o,d,g).getCorners(),E=d/-b[2];b[0]<0?(i.d8(T[0],T[0],[b[0]*E,0,0]),i.d8(T[3],T[3],[b[0]*E,0,0])):b[0]>0&&(i.d8(T[1],T[1],[b[0]*E,0,0]),i.d8(T[2],T[2],[b[0]*E,0,0])),b[1]<0?(i.d8(T[0],T[0],[0,b[1]*E,0]),i.d8(T[1],T[1],[0,b[1]*E,0])):b[1]>0&&(i.d8(T[2],T[2],[0,b[1]*E,0]),i.d8(T[3],T[3],[0,b[1]*E,0]));const I={};return I.vertices=T,I.planes=[tg(T[1],T[0],T[4]),tg(T[2],T[1],T[5]),tg(T[3],T[2],T[6]),tg(T[0],T[3],T[7])],I}addShadowReceiver(o,d,g){this._receivers.add(o,i.d9.fromTileIdAndHeight(o,d,g))}getMaxCascadeForTile(o){const d=this._receivers.get(o);return d&&d.lastCascade?d.lastCascade:0}}function tg(m,o,d){const g=i.av([],d,o),b=i.av([],m,o),T=i.bI([],g,b),E=i.ag(T);return E===0?[0,0,1,0]:(i.c5(T,T,1/E),[T[0],T[1],T[2],-i.bJ(T,o)])}function ng(m){const o=m.properties.get("direction"),d=i.d4(o.x,o.y,o.z);d[2]=i.aA(d[2],0,75);const g=i.d6([d[0],d[1],d[2]]);return i.d5(g.x,g.y,g.z)}function Od(m,o,d){const g=o.properties.get("color-use-theme")==="none",b=o.properties.get("color"),T=o.properties.get("intensity"),E=o.properties.get("direction"),I=[E.x,E.y,E.z],M=d.properties.get("color-use-theme")==="none",N=d.properties.get("color"),j=d.properties.get("intensity"),W=Math.max(i.bJ([0,0,1],I),0),Z=[0,0,0];i.c5(Z,N.toPremultipliedRenderColor(M?null:m.getLut(o.scope)).toArray01Linear().slice(0,3),j);const Y=[0,0,0];return i.c5(Y,b.toPremultipliedRenderColor(g?null:m.getLut(d.scope)).toArray01Linear().slice(0,3),W*T),i.db([Z[0]>0?Z[0]/(Z[0]+Y[0]):0,Z[1]>0?Z[1]/(Z[1]+Y[1]):0,Z[2]>0?Z[2]/(Z[2]+Y[2]):0])}function Ph(m,o,d,g,b,T){const E=m.zoom,I=m.scale,M=m.worldSize,N=1/M,j=m.aspect,W=Math.sqrt(1+j*j)*Math.tan(.5*m.fovX),Z=W*W,Y=g-d,te=g+d;let J,oe;Z>Y/te?(J=g,oe=g*W):(J=.5*te*(1+Z),oe=.5*Math.sqrt(Y*Y+2*(g*g+d*d)*Z+te*te*Z*Z));const ae=m.projection.pixelsPerMeter(m.center.lat,M),pe=m._camera.getCameraToWorldMercator(),_e=[0,0,-J*N];i.af(_e,_e,pe);let me=oe*N;const Le=m._edgeInsets;if(!(Le.left===0&&Le.top===0&&Le.right===0&&Le.bottom===0||Le.left===Le.right&&Le.top===Le.bottom)){const Pt=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?ae:1),nn=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,d,g);nn[8]=2*-m.centerOffset.x/m.width,nn[9]=2*m.centerOffset.y/m.height;const _n=new Float64Array(16);i.cP(_n,nn,Pt);const Yt=new Float64Array(16);i.bl(Yt,_n);const Vt=i.cB.fromInvProjectionMatrix(Yt,M,E,!0);for(const On of Vt.points){const Cn=((Ce=On)[0]/=I,Ce[1]/=I,Ce[2]=i.cf(Ce[2],m._center.lat),Ce);me=Math.max(me,i.c6(i.da([],_e,Cn)))}}var Ce;me*=b/(b-1);const Re=Math.acos(o[2]),Ae=Math.atan2(-o[0],-o[1]),Te=new my;Te.position=_e,Te.setPitchBearing(Re,Ae);const ze=Te.getWorldToCamera(M,ae),We=me*M,Ge=Math.min(m._mercatorZfromZoom(17)*M*-2,-2*We),ct=Te.getCameraToClipOrthographic(-We,We,-We,We,Ge,(We+T*ae)/o[2]),ht=new Float64Array(16);i.aB(ht,ct,ze);const Et=i.d5(Math.floor(1e6*_e[0])/1e6*M,Math.floor(1e6*_e[1])/1e6*M,0),Ut=.5*b,it=[0,0,0];i.af(it,Et,ht),i.c5(it,it,Ut);const Ue=[Math.floor(it[0]),Math.floor(it[1]),Math.floor(it[2])],_t=[0,0,0];i.av(_t,it,Ue),i.c5(_t,_t,-1/Ut);const ut=new Float64Array(16);return i.bA(ut),i.br(ut,ut,_t),i.aB(ht,ut,ht),[ht,We]}class mI extends i.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(o,d){return i.dc(this.requestManager.transformRequest(d,i.R.Model).url).then(g=>{if(!g)return;const b=i.dd(g),T=new i.de(o,d,void 0,void 0,b);return T.computeBoundsAndApplyParent(),T}).catch(g=>{if(g&&g.status===404)return null;this.fire(new i.y(new Error(`Could not load model ${o} from ${d}: ${g.message}`)))})}load(o,d,g={forceReload:!1}){this.models[d]||(this.models[d]={});const b=Object.keys(o),T=[],E=[];for(const I of b){const M=o[I];this.hasURLBeenRequested(M)&&!g.forceReload||(this.modelByURL[M]={modelId:I,scope:d},T.push(this.loadModel(I,M)),E.push(I)),this.models[d][I]||(this.models[d][I]={model:null,numReferences:1})}this.numModelsLoading[d]=(this.numModelsLoading[d]||0)+E.length,Promise.allSettled(T).then(I=>{for(let M=0;M<I.length;M++){const{status:N}=I[M];if(N==="rejected")continue;const{value:j}=I[M];this.models[d][E[M]]||(this.models[d][E[M]]={model:null,numReferences:1}),this.models[d][E[M]].model=j}this.numModelsLoading[d]-=E.length,this.fire(new i.z("data",{dataType:"style"}))}).catch(I=>{this.fire(new i.y(new Error(`Could not load models: ${I.message}`)))})}isLoaded(){for(const o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,d,g={exactIdMatch:!1}){return!!(g.exactIdMatch?this.getModel(o,d):this.getModelByURL(this.modelUris[d][o]))}getModel(o,d){return this.models[d]||(this.models[d]={}),this.models[d][o]?this.models[d][o].model:void 0}getModelByURL(o){if(!o)return null;const d=this.modelByURL[o];return d?this.models[d.scope][d.modelId].model:null}hasModelBeenAdded(o,d){return this.models[d]&&this.models[d][o]!==void 0}getModelURIs(o){return this.modelUris[o]||{}}addModel(o,d,g){this.models[g]||(this.models[g]={}),this.modelUris[g]||(this.modelUris[g]={});const b=this.requestManager.normalizeModelURL(d);if((this.hasModel(o,g,{exactIdMatch:!0})||this.hasModelBeenAdded(o,g))&&this.modelUris[g][o]===b)this.models[g][o].numReferences++;else if(this.hasURLBeenRequested(b)){const{scope:T,modelId:E}=this.modelByURL[b];this.models[T][E].numReferences++}else this.modelUris[g][o]=b,this.load({[o]:this.modelUris[g][o]},g)}addModelURLs(o,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const g=this.modelUris[d];for(const b in o)g[b]=this.requestManager.normalizeModelURL(o[b])}reloadModels(o){this.load(this.modelUris[o],o,{forceReload:!0})}addModelsFromBucket(o,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const g={};for(const b of o)this.hasModel(b,d,{exactIdMatch:!0})||this.hasURLBeenRequested(b)?this.models[d][b].numReferences++:this.modelUris[d][b]&&!this.hasURLBeenRequested(b)?g[b]=this.modelUris[d][b]:!this.hasURLBeenRequested(b)&&i.df(b,!1)&&(this.modelUris[d][b]=this.requestManager.normalizeModelURL(b),g[b]=this.modelUris[d][b]);this.load(g,d)}hasURLBeenRequested(o){return this.modelByURL[o]!==void 0}removeModel(o,d,g=!1,b=!1){if(this.models[d]&&this.models[d][o]&&(this.models[d][o].numReferences--,this.models[d][o].numReferences===0||b)){const T=this.modelUris[d][o];g||delete this.modelUris[d][o],delete this.modelByURL[T];const E=this.models[d][o].model;if(!E)return;delete this.models[d][o],E.destroy()}}destroy(){for(const o of Object.keys(this.models))for(const d of Object.keys(this.models[o])){const g=this.models[o][d].model;delete this.models[o][d],g&&g.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,d){this.models[d]||(this.models[d]={});for(const g in this.models[d])this.models[d][g].model&&this.models[d][g].model.upload(o.context)}}const nb=i.a6.colorTheme,gI=new i.a9({data:new i.aa(nb.data)});function PE(m){if(!m.metadata||!m.metadata.content_area)return;const o=i.o.devicePixelRatio,{left:d,top:g,width:b,height:T}=m.metadata.content_area,E=d*o,I=g*o;return[E,I,E+b*o,I+T*o]}function OE(m){if(m)return m.map(([o,d])=>[o*i.o.devicePixelRatio,d*i.o.devicePixelRatio])}class rb{constructor(o,d,g){this.id=o,this.scope=d,this.sourceCache=g,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(o){this.missingRequests.has(o.name)||this.pendingRequests.has(o.name)||this.pendingRequests.add(o.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const o=new Map;if(!this.sourceCache.loaded())return o;const d=this.sourceCache.getVisibleCoordinates();if(d.length===0)return o;const g=this.sourceCache.getSource();if(!(g instanceof _l))return o;const b=d.map(E=>this.sourceCache.getTile(E)),T=g.getImages(b,Array.from(this.pendingRequests));for(const[E,I]of T)o.set(i.I.from({name:E,iconsetId:this.id}),I),this.pendingRequests.delete(E);for(const E of this.pendingRequests)this.missingRequests.add(E);return this.pendingRequests.clear(),o}}const Oh=(m,o)=>ye(m,o&&o.filter(d=>d.identifier!=="source.canvas")),LE=i.aH(Li,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),DE=i.aH(Li,["setCenter","setZoom","setBearing","setPitch"]),_y=new Set(["background","sky","slot","custom"]),Lh={version:8,layers:[],sources:{}},rg={duration:300,delay:0};class qu extends i.E{constructor(o,d={}){super(),this.map=o,this.scope=d.scope||"",this.globalId=null,this.fragments=[],this.importDepth=d.importDepth||0,this.importsCache=d.importsCache||new Map,this.resolvedImports=d.resolvedImports||new Set,this.transition=Object.assign({},rg),this._buildingIndex=new hI(this),this.crossTileSymbolIndex=new xc,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=d.styleChanges||new Vn,this._hasDataDrivenEmissive=!1,this.dispatcher=d.dispatcher?d.dispatcher:new i.D(i.dh(),this),d.imageManager?this.imageManager=d.imageManager:(this.imageManager=new ys(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=d.glyphManager?d.glyphManager:new i.di(o._requestManager,d.localFontFamily?i.dj.all:d.localIdeographFontFamily?i.dj.ideographs:i.dj.none,d.localFontFamily||d.localIdeographFontFamily),d.modelManager?this.modelManager=d.modelManager:(this.modelManager=new mI(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=d.configOptions?d.configOptions:new Map,this._configDependentLayers=d.configDependentLayers?d.configDependentLayers:new Set,this._indoorDependentLayers=d.indoorDependentLayers?d.indoorDependentLayers:new Set,this._config=d.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:d.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=d.initialConfig,this.dispatcher.broadcast("setReferrer",i.dk());const g=this;this._rtlTextPluginCallback=qu.registerForPluginStateChange(b=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(T,E)=>{if(i.dl(T),E&&E.every(I=>I))for(const I in g._sourceCaches){const M=g._sourceCaches[I],N=M.getSource().type;N!=="vector"&&N!=="geojson"||M.reload()}})}),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const T=this.getOwnSource(b.sourceId);if(T&&T.vectorLayerIds)for(const E in this._layers){const I=this._layers[E];I.source===T.id&&this._validateLayer(I)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(i.h(o))return o;const d=i.dm(o);if(!d.startsWith("http"))try{return new URL(d,location.href).toString()}catch{return d}return d}return`json://${i.dn(JSON.stringify(o))}`}_diffStyle(o,d,g){this.globalId=this._getGlobalId(o);const b=(T,E)=>{try{E(null,this.setState(T,g))}catch(I){E(I,!1)}};if(typeof o=="string"){const T=this.map._requestManager.normalizeStyleURL(o),E=this.map._requestManager.transformRequest(T,i.R.Style);i.m(E,(I,M)=>{I?this.fire(new i.y(I)):M&&b(M,d)})}else typeof o=="object"&&b(o,d)}loadURL(o,d={}){this.fire(new i.z("dataloading",{dataType:"style"}));const g=typeof d.validate=="boolean"?d.validate:!i.h(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,d.accessToken),this.resolvedImports.add(o);const b=this.importsCache.get(o);if(b)return this._load(b,g);const T=this.map._requestManager.transformRequest(o,i.R.Style);this._request=i.m(T,(E,I)=>{if(this._request=null,E)this.fire(new i.y(E));else if(I)return this.importsCache.set(o,I),this._load(I,g)})}loadJSON(o,d={}){this.fire(new i.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=i.o.frame(()=>{this._request=null,this._load(o,d.validate!==!1)})}loadEmpty(){this.fire(new i.z("dataloading",{dataType:"style"})),this._load(Lh,!1)}_loadImports(o,d,g){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const b=[];for(const T of o){const E=this._createFragmentStyle(T),I=new Promise(j=>{E.once("style.import.load",j),E.once("error",j)}).then(()=>this.mergeAll());if(b.push(I),this.resolvedImports.has(T.url)){E.loadEmpty();continue}const M=T.data||this.importsCache.get(T.url);M?(E.loadJSON(M,{validate:d}),this._isInternalStyle(M)&&(E.globalId=null)):T.url?E.loadURL(T.url,{validate:d}):E.loadEmpty();const N={style:E,id:T.id,config:T.config};if(g){const j=this.fragments.findIndex(({id:W})=>W===g);this.fragments=this.fragments.slice(0,j).concat(N).concat(this.fragments.slice(j))}else this.fragments.push(N)}return Promise.allSettled(b)}getImportGlobalIds(o=this,d=new Set){for(const g of o.fragments)g.style.globalId&&d.add(g.style.globalId),this.getImportGlobalIds(g.style,d);return[...d.values()]}_createFragmentStyle(o){const d=this.scope?i.B(o.id,this.scope):o.id;let g;const b=this._initialConfig&&this._initialConfig[d];(o.config||b)&&(g=Object.assign({},o.config,b));const T=new qu(this.map,{scope:d,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return T.setEventedParent(this.map,{style:T}),T}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,d){if(this._isInternalStyle(o)){const T=Object.assign({},Lh,{imports:[{id:"basemap",data:o,url:""}]},o.center?{center:o.center}:{},o.bearing?{bearing:o.bearing}:{},o.pitch?{pitch:o.pitch}:{},o.zoom?{zoom:o.zoom}:{},o.light?{light:o.light}:{});return this._importedAsBasemap=!0,void this._load(T,d)}if(this.updateConfig(this._config,o.schema),d&&Oh(this,Ht(o)))return;this._loaded=!0,this.stylesheet=i.dp(o);const g=()=>{for(const M in o.sources)this.addSource(M,o.sources[M],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(const M in o.iconsets)this.addIconset(M,o.iconsets[M]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&o.glyphs&&this.glyphManager.setURL(o.glyphs);const T=G0(this.stylesheet.layers);if(this._order=T.map(M=>M.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const M=this.stylesheet.lights[0];this.light=new Ve(M.properties,M.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ve(this.stylesheet.light)),this._layers={};for(const M of T){const N=i.du(M,this.scope,this._styleColorTheme.lut,this.options);N.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(N.fqid),N.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(N.fqid),this._hasAppearances=this._hasAppearances||N.getAppearances().length!==0,N.setEventedParent(this,{layer:{id:N.id}}),this._layers[N.id]=N;const j=this.getOwnLayerSourceCache(N),W=!!this.directionalLight&&this.directionalLight.shadowsEnabled();j&&N.canCastShadows()&&W&&(j.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const E=this.stylesheet.terrain;E&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(E,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.z("data",{dataType:"style"}));const I=this.isRootStyle();o.imports?this._loadImports(o.imports,d).then(()=>{this._reloadImports(),this.fire(new i.z(I?"style.load":"style.import.load"))}).catch(M=>{this.fire(new i.y(new Error("Failed to load imports",M))),this.fire(new i.z(I?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.z(I?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const b=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(b){const T=this._evaluateColorThemeData(b);this._loadColorTheme(T).then(()=>{g()}).catch(E=>{i.w(`Couldn't load color theme from the stylesheet: ${E}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(o=>o.style.hasAppearances())}mergeAll(){let o,d,g,b,T,E,I,M,N,j;const W={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(Z=>{if(Z.stylesheet){if(Z.light!=null&&(o=Z.light),Z.stylesheet.lights)for(const Y of Z.stylesheet.lights)Y.type==="ambient"&&Z.ambientLight!=null&&(d=Z.ambientLight),Y.type==="directional"&&Z.directionalLight!=null&&(g=Z.directionalLight);b=this._prioritizeTerrain(b,Z.terrain,Z.stylesheet.terrain),Z.stylesheet.fog&&Z.fog!=null&&(T=Z.fog),Z.stylesheet.snow&&Z.snow!=null&&(E=Z.snow),Z.stylesheet.rain&&Z.rain!=null&&(I=Z.rain),Z.stylesheet.camera!=null&&(j=Z.stylesheet.camera),Z.stylesheet.projection!=null&&(M=Z.stylesheet.projection),Z.stylesheet.transition!=null&&(N=Z.stylesheet.transition),W[Z.scope]=Z._styleColorTheme}}),this.light=o,this.ambientLight=d,this.directionalLight=g,this.fog=T,this.snow=E,this.rain=I,this._styleColorThemeForScope=W,b===null?delete this.terrain:this.terrain=b,this.camera=j||{"camera-projection":"perspective"},this.projection=M||{name:"mercator"},this.transition=Object.assign({},rg,N),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(o){const d=g=>{for(const b of g.fragments)d(b.style);o(g)};d(this)}_prioritizeTerrain(o,d,g){const b=o&&o.drapeRenderMode===0;return g===null?d&&d.drapeRenderMode===0?d:b?o:null:d!=null&&(!o||b||d&&d.drapeRenderMode===1)?d:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(d=>{o=this._prioritizeTerrain(o,d.terrain,d.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(d=>{d.stylesheet.projection!=null&&(o=d.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){const o={},d={},g={};this.forEachFragmentStyle(b=>{for(const T in b._sourceCaches){const E=i.B(T,b.scope);o[E]=b._sourceCaches[T]}for(const T in b._otherSourceCaches){const E=i.B(T,b.scope);d[E]=b._otherSourceCaches[T]}for(const T in b._symbolSourceCaches){const E=i.B(T,b.scope);g[E]=b._symbolSourceCaches[T]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=d,this._mergedSymbolSourceCaches=g}mergeIndoor(){this.forEachFragmentStyle(o=>{if(o.stylesheet&&o.stylesheet.indoor)for(const d of Object.values(o.stylesheet.indoor)){const g=d,b=i.B(g.sourceId,o.scope);this._mergedIndoor[b]=new Set(g.sourceLayers||[])}})}mergeLayers(){const o={},d=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(E=>{for(const I of E._order){const M=E._layers[I];if(M.type==="slot"){const N=i.dq(I);if(o[N])continue;o[N]=[]}M.slot&&o[M.slot]?o[M.slot].push(M):d.push(M)}}),this._mergedOrder=[];let b=-1;const T=(E=[])=>{for(const I of E)if(I.type==="slot"){const M=i.dq(I.id);o[M]&&T(o[M]),this._mergedSlots.push(M)}else{const M=i.B(I.id,I.scope);this._mergedOrder.push(M),g[M]=I,I.is3D(!!this.terrain)&&(this._has3DLayers=!0,b=this._mergedOrder.length-1),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&(this._clipLayerPresent=!0)}};if(T(d),this._has3DLayers){const E={};for(let I=0;I<this._mergedOrder.length;++I){const M=this._mergedOrder[I];E[M]=I===b?1:I<b?g[M].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((I,M)=>E[I]-E[M])}this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?function(d,g,b,T){const E=Object.assign({},g);for(const M of Object.keys(nb))E[M]===void 0&&(E[M]=nb[M].default);const I=new i.a8(gI,d,new Map(b));return I.setTransitionOrValue(E,b),I.untransitioned().possiblyEvaluate(new i.ac(0,{worldview:void 0}))}(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const d=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((g,b)=>{const T="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void g();let E=o;E.startsWith(T)||(E=T+E);const I=i.I.from("mapbox-reserved-lut"),M=new Image;M.src=E,M.onerror=()=>{this._styleColorTheme.lutLoading=!1,b(new Error("Failed to load image data"))},M.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==d)return void g();this._styleColorTheme.lutLoading=!1;const{width:N,height:j,data:W}=i.o.getImageData(M);if(j>32)return void b(new Error("The height of the image must be less than or equal to 32 pixels."));if(N!==j*j)return void b(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new i.q({width:N,height:j},W),pixelRatio:1,sdf:!1,usvg:!1,version:0});const Z=this.imageManager.getImage(I,this.scope);Z?(this._styleColorTheme.lut={image:Z.data,data:o},g()):b(new Error("Missing LUT image."))}})}getLut(o){const d=this._styleColorThemeForScope[o];return d?d.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(d,g,b){let T,E,I;const M=i.o.devicePixelRatio>1?"@2x":"";let N=i.m(g.transformRequest(g.normalizeSpriteURL(d,M,".json"),i.R.SpriteJSON),(Z,Y)=>{N=null,I||(I=Z,T=Y,W())}),j=i.n(g.transformRequest(g.normalizeSpriteURL(d,M,".png"),i.R.SpriteImage),(Z,Y)=>{j=null,I||(I=Z,E=Y,W())});function W(){if(I)b(I);else if(T&&E){const Z=i.o.getImageData(E),Y={};for(const te in T){const{width:J,height:oe,x:ae,y:pe,sdf:_e,pixelRatio:me,stretchX:Le,stretchY:Ce,content:Re}=T[te],Ae=new i.q({width:J,height:oe});i.q.copy(Z,Ae,{x:ae,y:pe},{x:0,y:0},{width:J,height:oe},null),Y[te]={data:Ae,pixelRatio:me!==void 0?me:1,sdf:_e!==void 0&&_e,stretchX:Le,stretchY:Ce,content:Re,usvg:!1,version:0}}b(null,Y)}}return{cancel(){N&&(N.cancel(),N=null),j&&(j.cancel(),j=null)}}}(o,this.map._requestManager,(d,g)=>{if(this._spriteRequest=null,d)this.fire(new i.y(d));else if(g){const b=new Map;for(const T in g)b.set(i.I.from(T),g[T]);this.addImages(b)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))})}addIconset(o,d){if(d.type==="sprite")return void this._loadSprite(d.url);const g=this.getOwnSourceCache(d.source);if(!g)return void this.fire(new i.y(new Error(`Source "${d.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));const b=g.getSource();if(b.type!=="raster-array")return void this.fire(new i.y(new Error(`Source "${d.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));b.partial=!1;const T=new rb(o,this.scope,g);this.imageManager.addImageProvider(T,this.scope)}removeIconset(o){this.imageManager.removeImageProvider(o,this.scope)}_loadIconset(o){if(!i.h(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);const d=this.map._spriteFormat==="auto";var g,b;this._spriteRequest=(b=(T,E)=>{if(this._spriteRequest=null,T)d?this._loadSprite(o):this.fire(new i.y(T));else if(E){const I=new Map;for(const M in E)I.set(i.I.from(M),E[M]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))},i.bu((g=this.map._requestManager).transformRequest(g.normalizeIconsetURL(o),i.R.Iconset),(T,E)=>{if(T)return void b(T);const I={},M=i.dg(new i.bt(E));for(const N of M.icons){const j={version:1,pixelRatio:i.o.devicePixelRatio,content:PE(N),stretchX:N.metadata?OE(N.metadata.stretch_x_areas):void 0,stretchY:N.metadata?OE(N.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:N};I[N.name]=j}b(null,I)}))}_validateLayer(o){const d=this.getOwnSource(o.source);if(!d)return;const g=o.sourceLayer;g&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(g)===-1)&&this.fire(new i.y(new Error(`Source layer "${g}" does not exist on source "${d.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,d)=>{const g=this.fragments[d];return g&&g.style&&(o.data=g.style.serialize()),o})}_serializeSources(){const o={};for(const d in this._sourceCaches){const g=this._sourceCaches[d].getSource();o[g.id]||(o[g.id]=g.serialize())}return o}_serializeLayers(o){const d=[];for(const g of o){const b=this._layers[g];b&&b.type!=="custom"&&d.push(b.serialize())}return d}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const o in this._mergedLayers){const d=this._mergedLayers[o];if(d._transitionablePaint&&d._transitionablePaint._values){const g=d._transitionablePaint._values["line-emissive-strength"];if(g&&g.value&&g.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){const d=this.getOwnLayer(o);if(d)return d;this.fire(new i.y(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){const d=this.getOwnSource(o);if(d)return d;this.fire(new i.y(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,d){const g=this.map.painter;if(g)for(let b=o.minzoom||0;b<(o.maxzoom||25.5);b++){const T=o.getProgramIds();if(T)for(const E of T){const I=o.getDefaultProgramParams(E,d.zoom,this._styleColorTheme.lut);I&&(g.style=this,this.fog&&(g._fogVisible=!0,I.overrideFog=!0,g.getOrCreateProgram(E,I)),g._fogVisible=!1,I.overrideFog=!1,g.getOrCreateProgram(E,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,g.getOrCreateProgram(E,I)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);const d=this.calculateLightsBrightness();o.brightness=d||0,d!==this._brightness&&(this._brightness=d,this.dispatcher.broadcast("setBrightness",d)),o.worldview!==this._worldview&&(this._worldview=o.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const g=this._changes.isDirty();let b=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const M in I){const{updatedIds:N,removedIds:j}=I[M];(N||j)&&(this._updateWorkerLayers(M,N,j),b=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}const T={};for(const I in this._mergedSourceCaches){const M=this._mergedSourceCaches[I];T[I]=M.used,M.used=!1,M.tileCoverLift=0}for(const I of this._mergedOrder){const M=this._mergedLayers[I];if(M.visibility!=="none"&&M.recalculate(o,this._availableImages),!M.isHidden(o.zoom)){const N=this.getLayerSourceCache(M);N&&(N.used=!0,N.tileCoverLift=Math.max(N.tileCoverLift,M.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(M,o)}):this.precompilePrograms(M,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&b&&this.mergeLayers();const E=this.imageManager.getPendingImageProviders();for(const I of E)I.sourceCache.used=!0;for(const I in T){const M=this._mergedSourceCaches[I];T[I]!==M.used&&M.getSource().fire(new i.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),g&&this.fire(new i.z("data",{dataType:"style"}))}updateImageProviders(){const o=this.imageManager.getPendingImageProviders();for(const d of o){const g=d.resolvePendingRequests(),b=this.getFragmentStyle(d.scope);b&&b.addImages(g)}}_updateTilesForChangedImages(){const o={};for(const d in this._mergedSourceCaches){const g=this._mergedSourceCaches[d].getSource().scope;o[g]=o[g]||this._changes.getUpdatedImages(g),o[g].length!==0&&this._mergedSourceCaches[d].reloadTilesForDependencies(["icons","patterns"],o[g])}for(const d in o)this._changes.resetUpdatedImages(d)}_updateWorkerLayers(o,d,g){const b=this.getFragmentStyle(o);b&&this.dispatcher.broadcast("updateLayers",{layers:d?b._serializeLayers(d):[],scope:o,removedIds:g||[],options:b.options})}setState(o,d){if(this._checkLoaded(),Oh(this,Ht(o)))return!1;(o=i.dp(o)).layers=G0(o.layers);const g=function(E,I){if(!E)return[{command:Li.setStyle,args:[I]}];let M=[];try{if(!i.by(E.version,I.version))return[{command:Li.setStyle,args:[I]}];if(i.by(E.center,I.center)||M.push({command:Li.setCenter,args:[I.center]}),i.by(E.zoom,I.zoom)||M.push({command:Li.setZoom,args:[I.zoom]}),i.by(E.bearing,I.bearing)||M.push({command:Li.setBearing,args:[I.bearing]}),i.by(E.pitch,I.pitch)||M.push({command:Li.setPitch,args:[I.pitch]}),i.by(E.sprite,I.sprite)||M.push({command:Li.setSprite,args:[I.sprite]}),i.by(E.glyphs,I.glyphs)||M.push({command:Li.setGlyphs,args:[I.glyphs]}),i.by(E.imports,I.imports)||function(Y=[],te=[],J){te=te||[];const oe=(Y=Y||[]).map(q0),ae=te.map(q0),pe=Y.reduce(Z0,{}),_e=te.reduce(Z0,{}),me=oe.slice();let Le,Ce,Re,Ae;for(Le=0,Ce=0;Le<oe.length;Le++)Re=oe[Le],_e.hasOwnProperty(Re)?Ce++:(J.push({command:Li.removeImport,args:[Re]}),me.splice(me.indexOf(Re,Ce),1));for(Le=0,Ce=0;Le<ae.length;Le++)Re=ae[ae.length-1-Le],me[me.length-1-Le]!==Re&&(pe.hasOwnProperty(Re)?(J.push({command:Li.removeImport,args:[Re]}),me.splice(me.lastIndexOf(Re,me.length-Ce),1)):Ce++,Ae=me[me.length-Le],J.push({command:Li.addImport,args:[_e[Re],Ae]}),me.splice(me.length-Le,0,Re));for(const Te of te){const ze=pe[Te.id];ze&&(delete ze.data,i.by(ze,Te)||J.push({command:Li.updateImport,args:[Te.id,Te]}))}}(E.imports,I.imports,M),i.by(E.transition,I.transition)||M.push({command:Li.setTransition,args:[I.transition]}),i.by(E.light,I.light)||M.push({command:Li.setLight,args:[I.light]}),i.by(E.fog,I.fog)||M.push({command:Li.setFog,args:[I.fog]}),i.by(E.snow,I.snow)||M.push({command:Li.setSnow,args:[I.snow]}),i.by(E.rain,I.rain)||M.push({command:Li.setRain,args:[I.rain]}),i.by(E.projection,I.projection)||M.push({command:Li.setProjection,args:[I.projection]}),i.by(E.lights,I.lights)||M.push({command:Li.setLights,args:[I.lights]}),i.by(E.camera,I.camera)||M.push({command:Li.setCamera,args:[I.camera]}),i.by(E.iconsets,I.iconsets)||function(Y,te,J){let oe;for(oe in te=te||{},Y=Y||{})Y.hasOwnProperty(oe)&&(te.hasOwnProperty(oe)||J.push({command:Li.removeIconset,args:[oe]}));for(oe in te){if(!te.hasOwnProperty(oe))continue;const ae=te[oe];Y.hasOwnProperty(oe)?i.by(Y[oe],ae)||(J.push({command:Li.removeIconset,args:[oe]}),J.push({command:Li.addIconset,args:[oe,ae]})):J.push({command:Li.addIconset,args:[oe,ae]})}}(E.iconsets,I.iconsets,M),!i.by(E["color-theme"],I["color-theme"]))return[{command:Li.setStyle,args:[I]}];const N={},j=[];(function(Y,te,J,oe){let ae;for(ae in te=te||{},Y=Y||{})Y.hasOwnProperty(ae)&&(te.hasOwnProperty(ae)||Zx(ae,J,oe));for(ae in te){if(!te.hasOwnProperty(ae))continue;const pe=te[ae];Y.hasOwnProperty(ae)?i.by(Y[ae],pe)||(Y[ae].type==="geojson"&&pe.type==="geojson"&&kE(Y,te,ae)?J.push({command:Li.setGeoJSONSourceData,args:[ae,pe.data]}):CE(ae,te,J,oe)):ay(ae,te,J)}})(E.sources,I.sources,j,N);const W=[];E.layers&&E.layers.forEach(Y=>{Y.source&&N[Y.source]?M.push({command:Li.removeLayer,args:[Y.id]}):W.push(Y)});let Z=E.terrain;Z&&N[Z.source]&&(M.push({command:Li.setTerrain,args:[void 0]}),Z=void 0),M=M.concat(j),i.by(Z,I.terrain)||M.push({command:Li.setTerrain,args:[I.terrain]}),function(Y,te,J){te=te||[];const oe=(Y=Y||[]).map(q0),ae=te.map(q0),pe=Y.reduce(Z0,{}),_e=te.reduce(Z0,{}),me=oe.slice(),Le=Object.create(null);let Ce,Re,Ae,Te,ze,We,Ge;for(Ce=0,Re=0;Ce<oe.length;Ce++)Ae=oe[Ce],_e.hasOwnProperty(Ae)?Re++:(J.push({command:Li.removeLayer,args:[Ae]}),me.splice(me.indexOf(Ae,Re),1));for(Ce=0,Re=0;Ce<ae.length;Ce++)Ae=ae[ae.length-1-Ce],me[me.length-1-Ce]!==Ae&&(pe.hasOwnProperty(Ae)?(J.push({command:Li.removeLayer,args:[Ae]}),me.splice(me.lastIndexOf(Ae,me.length-Re),1)):Re++,We=me[me.length-Ce],J.push({command:Li.addLayer,args:[_e[Ae],We]}),me.splice(me.length-Ce,0,Ae),Le[Ae]=!0);for(Ce=0;Ce<ae.length;Ce++)if(Ae=ae[Ce],Te=pe[Ae],ze=_e[Ae],!Le[Ae]&&!i.by(Te,ze))if(i.by(Te.source,ze.source)&&i.by(Te["source-layer"],ze["source-layer"])&&i.by(Te.type,ze.type)){for(Ge in kh(Te.layout,ze.layout,J,Ae,null,Li.setLayoutProperty),kh(Te.paint,ze.paint,J,Ae,null,Li.setPaintProperty),i.by(Te.slot,ze.slot)||J.push({command:Li.setSlot,args:[Ae,ze.slot]}),i.by(Te.filter,ze.filter)||J.push({command:Li.setFilter,args:[Ae,ze.filter]}),i.by(Te.minzoom,ze.minzoom)&&i.by(Te.maxzoom,ze.maxzoom)||J.push({command:Li.setLayerZoomRange,args:[Ae,ze.minzoom,ze.maxzoom]}),Te)Te.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?kh(Te[Ge],ze[Ge],J,Ae,Ge.slice(6),Li.setPaintProperty):i.by(Te[Ge],ze[Ge])||J.push({command:Li.setLayerProperty,args:[Ae,Ge,ze[Ge]]}));for(Ge in ze)ze.hasOwnProperty(Ge)&&!Te.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?kh(Te[Ge],ze[Ge],J,Ae,Ge.slice(6),Li.setPaintProperty):i.by(Te[Ge],ze[Ge])||J.push({command:Li.setLayerProperty,args:[Ae,Ge,ze[Ge]]}))}else J.push({command:Li.removeLayer,args:[Ae]}),We=me[me.lastIndexOf(Ae)+1],J.push({command:Li.addLayer,args:[ze,We]})}(W,I.layers,M)}catch(N){console.warn("Unable to compute style diff:",N),M=[{command:Li.setStyle,args:[I]}]}return M}(this.serialize(),o).filter(E=>!(E.command in DE));if(g.length===0)return!1;const b=g.filter(E=>!(E.command in LE));if(b.length>0)throw new Error(`Unimplemented: ${b.map(E=>E.command).join(", ")}.`);const T=[];return g.forEach(E=>{T.push(this[E.command](...E.args))}),d&&Promise.all(T).then(d).catch(d),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(o){if(o.size===0)return this;for(const[d,g]of o.entries()){if(this.getImage(d))return this.fire(new i.y(new Error(`An image with the name "${d.name}" already exists.`)));this.imageManager.addImage(d,this.scope,g),this._changes.updateImage(d,this.scope)}return this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this}addImage(o,d){return this.getImage(o)?this.fire(new i.y(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,d),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this)}updateImage(o,d,g=!1){this.imageManager.updateImage(o,this.scope,d),g&&(this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(o){return this.modelManager.addModelURLs(o,this.getActualScope()),this._updateWorkerModels(),this.fire(new i.z("data",{dataType:"style"})),this}addModel(o,d,g={}){return this._checkLoaded(),this._validate(ee,`models.${o}`,d,null,g)||(this.modelManager.addModel(o,d,this.getActualScope()),this.fire(new i.z("data",{dataType:"style"}))),this}hasModel(o){return this.modelManager.hasModel(o,this.getActualScope())}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.getActualScope(),!1,!0),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(o,d,g={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(Dn,`sources.${o}`,d,null,g))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const b=To(o,d,this.dispatcher,this);b.scope=this.scope,b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(b.id),source:b.serialize(),sourceId:b.id}));const T=E=>{const I=(E?"symbol:":"other:")+b.id,M=i.B(I,this.scope),N=this._sourceCaches[I]=new Jl(M,b,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[b.id]=N,N.onAdd(this.map)};T(!1),d.type!=="vector"&&d.type!=="geojson"||T(!0),b.onAdd&&b.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();const d=this.getOwnSource(o);if(!d)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===o)return this.fire(new i.y(new Error(`Source "${o}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new i.y(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const b=Object.entries(this.stylesheet.iconsets).find(([T,E])=>E.type==="source"&&E.source===o);if(b)return this.fire(new i.y(new Error(`Source "${o}" cannot be removed while iconset "${b[0]}" is using it.`)))}const g=this.getOwnSourceCaches(o);for(const b of g){const T=i.dq(b.id);delete this._sourceCaches[T],this._changes.discardSourceCacheUpdate(b.id),b.fire(new i.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,d){this._checkLoaded(),this.getOwnSource(o).setData(d),this._changes.setDirty()}getOwnSource(o){const d=this.getOwnSourceCache(o);return d&&d.getSource()}getOwnSources(){const o=[];for(const d in this._otherSourceCaches){const g=this.getOwnSourceCache(d);g&&o.push(g.getSource())}return o}areTilesLoaded(){const o=this._mergedSourceCaches;for(const d in o){const g=o[d]._tiles;for(const b in g){const T=g[b];if(T.state!=="loaded"&&T.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;const d=this._getTransitionParameters();for(const T of o){if(this._validate(jn,"lights",T))return;switch(T.type){case"ambient":if(this.ambientLight){const E=this.ambientLight;E.set(T),E.updateTransitions(d)}else this.ambientLight=new $r(T,as||(as=new i.a9({color:new i.aa(i.a6.properties_light_ambient.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const E=this.directionalLight;E.set(T),E.updateTransitions(d)}else this.directionalLight=new $r(T,Qi||(Qi=new i.a9({direction:new i.ap(i.a6.properties_light_directional.direction),color:new i.aa(i.a6.properties_light_directional.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_directional.intensity),"cast-shadows":new i.aa(i.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new i.aa(i.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.aa(i.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const g=Object.assign(d,{worldview:this.map.getWorldview()}),b=new i.ac(this.z||0,g);this.ambientLight&&this.ambientLight.recalculate(b),this.directionalLight&&this.directionalLight.recalculate(b),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const o=this.directionalLight,d=this.ambientLight;if(!o||!d)return;const g=Z=>.2126*(Z[0]<=.03928?Z[0]/12.92:Math.pow((Z[0]+.055)/1.055,2.4))+.7152*(Z[1]<=.03928?Z[1]/12.92:Math.pow((Z[1]+.055)/1.055,2.4))+.0722*(Z[2]<=.03928?Z[2]/12.92:Math.pow((Z[2]+.055)/1.055,2.4)),b=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),T=o.properties.get("intensity"),E=o.properties.get("direction"),I=1-i.d4(E.x,E.y,E.z)[2]/90,M=g(b)*T*I,N=d.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),j=d.properties.get("intensity"),W=g(N)*j;return Number(((M+W)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(o==null||o===""&&this.isRootStyle())return this;if(i.dr(o)){const d=i.ds(o),g=this.fragments.find(({id:T})=>T===d);if(!g)return;const b=i.dq(o);return g.style.getFragmentStyle(b)}{const d=this.fragments.find(({id:g})=>g===o);return d?d.style:void 0}}setFeaturesetSelectors(o){if(!o)return;const d={},g=(b,T="")=>`${b}::${T}`;this._featuresetSelectors={};for(const b in o){const T=this._featuresetSelectors[b]=[];for(const E of o[b].selectors){if(E.featureNamespace){const M=this.getOwnLayer(E.layer);if(!M){i.w(`Layer is undefined for selector: ${E.layer}`);continue}const N=g(M.source,M.sourceLayer);if(N in d&&d[N]!==E.featureNamespace){i.w(`"featureNamespace ${E.featureNamespace} of featureset ${b}'s selector is not associated to the same source, skip this selector`);continue}d[N]=E.featureNamespace}let I;if(E.properties)for(const M in E.properties){const N=i.U(E.properties[M]);N.result==="success"&&(I=I||{},I[M]=N.value)}T.push({layerId:E.layer,namespace:E.featureNamespace,properties:I,uniqueFeatureID:E._uniqueFeatureID})}}}getFeaturesetDescriptors(o){const d=this.getFragmentStyle(o);if(!d||!d.stylesheet.featuresets)return[];const g=[];for(const b in d.stylesheet.featuresets)g.push({featuresetId:b,importId:d.scope?d.scope:void 0});return g}getFeaturesetLayers(o,d){const g=this.getFragmentStyle(d),b=g.stylesheet.featuresets;if(!b||!b[o])return this.fire(new i.y(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];const T=[];for(const E of b[o].selectors){const I=g.getOwnLayer(E.layer);I&&T.push(I)}return T}getConfigProperty(o,d){const g=this.getFragmentStyle(o);if(!g)return null;const b=i.B(d,g.scope),T=g.options.get(b),E=T?T.value||T.default:null;return E?E.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(o,d){const g=i.B(o,d);return this._mergedIndoor[g]}setIndoorData(o,d){this.map.indoor.setIndoorData(d)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(o,d,g){const b=this.getFragmentStyle(o);if(!b)return;const T=b.stylesheet.schema;if(!T||!T[d])return;const E=i.U(g);if(E.result!=="success")return void Oh(this,E.value);const I=E.value.expression,M=i.B(d,b.scope),N=b.options.get(M);if(!N)return;let j;const{minValue:W,maxValue:Z,stepValue:Y,type:te,values:J}=T[d],oe=i.U(T[d].default);oe.result==="success"&&(j=oe.value.expression),j?(this.options.set(M,Object.assign({},N,{value:I,default:j,minValue:W,maxValue:Z,stepValue:Y,type:te,values:J})),this.updateConfigDependencies(d)):this.fire(new i.y(new Error(`No schema defined for the config option "${d}" in the "${o}" fragment.`)))}getConfig(o){const d=this.getFragmentStyle(o);if(!d)return null;const g=d.stylesheet.schema;if(!g)return null;const b={};for(const T in g){const E=i.B(T,d.scope),I=d.options.get(E),M=I?I.value||I.default:null;b[T]=M?M.serialize():null}return b}setConfig(o,d){const g=this.getFragmentStyle(o);g&&(g.updateConfig(d,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){const d=this.getFragmentStyle(o);return d?d.stylesheet.schema:null}setSchema(o,d){const g=this.getFragmentStyle(o);g&&(g.stylesheet.schema=d,g.updateConfig(g._config,d),this.updateConfigDependencies())}updateConfig(o,d){if(this._config=o,o||d)if(d)for(const g in d){let b,T;const E=i.U(d[g].default);if(E.result==="success"&&(b=E.value.expression),o&&o[g]!==void 0){const Z=i.U(o[g]);Z.result==="success"&&(T=Z.value.expression)}const{minValue:I,maxValue:M,stepValue:N,type:j,values:W}=d[g];if(b){const Z=i.B(g,this.scope);this.options.set(Z,{default:b,value:T,minValue:I,maxValue:M,stepValue:N,type:j,values:W})}else this.fire(new i.y(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new i.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(o,d=()=>!0){for(const g of o){const b=this.getLayer(g);b&&d(b)&&(b.possiblyEvaluateVisibility(),this._updateLayer(b),this._changes.setDirty())}}updateConfigDependencies(o){this._updateLayers(this._configDependentLayers,d=>!o||d.expressionDependencies.configDependencies.has(o)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(d=>{const g=d._styleColorTheme.colorThemeOverride?d._styleColorTheme.colorThemeOverride:d._styleColorTheme.colorTheme;if(g){const b=d._evaluateColorThemeData(g);(!d._styleColorTheme.lut&&b!==""||d._styleColorTheme.lut&&b!==d._styleColorTheme.lut.data)&&d.setColorTheme(g)}}),this._changes.setDirty()}addLayer(o,d,g={}){this._checkLoaded();const b=o.id;if(this._layers[b])return void this.fire(new i.y(new Error(`Layer with id "${b}" already exists on this map`)));let T;if(o.type==="custom"){if(Oh(this,i.dt(o)))return;T=i.du(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(b,o.source),o=i.dp(o),o=Object.assign(o,{source:b})),this._validate(Qs,`layers.${b}`,o,{arrayIndex:-1},g))return;T=i.du(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(T),T.setEventedParent(this,{layer:{id:b}})}const E=i.B(T.source,T.scope);T.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(E),T.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(E);let I=this._order.length;if(d){const W=this._order.indexOf(d);if(W===-1)return void this.fire(new i.y(new Error(`Layer with id "${d}" does not exist on this map.`)));T.slot===this._layers[d].slot?I=W:i.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(I,0,b),this._layerOrderChanged=!0,this._layers[b]=T;const M=this.getOwnLayerSourceCache(T),N=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&T.canCastShadows()&&N&&(M.castsShadows=!0);const j=this._changes.getRemovedLayer(T);if(j&&T.source&&M&&T.type!=="custom"){this._changes.discardLayerRemoval(T);const W=i.B(T.source,T.scope);j.type!==T.type?this._changes.updateSourceCache(W,"clear"):(this._changes.updateSourceCache(W,"reload"),M.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),T.scope=this.scope,this.mergeLayers()}moveLayer(o,d){this._checkLoaded();const g=this._checkLayer(o);if(!g||o===d)return;const b=this._order.indexOf(o);this._order.splice(b,1);let T=this._order.length;if(d){const E=this._order.indexOf(d);if(E===-1)return void this.fire(new i.y(new Error(`Layer with id "${d}" does not exist on this map.`)));g.slot===this._layers[d].slot?T=E:i.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();const d=this._checkLayer(o);if(!d)return;d.setEventedParent(null);const g=this._order.indexOf(o);this._order.splice(g,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(d.fqid),this._indoorDependentLayers.delete(d.fqid),this._changes.removeLayer(d);const b=this.getOwnLayerSourceCache(d);if(b&&b.castsShadows){let T=!1;for(const E in this._layers)if(this._layers[E].source===d.source&&this._layers[E].canCastShadows()){T=!0;break}b.castsShadows=T}d.onRemove&&d.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(const d in this._layers)if(this._layers[d].type===o)return!0;return!1}setLayerZoomRange(o,d,g){this._checkLoaded();const b=this._checkLayer(o);b&&(b.minzoom===d&&b.maxzoom===g||(d!=null&&(b.minzoom=d),g!=null&&(b.maxzoom=g),this._updateLayer(b)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,d){this._checkLoaded();const g=this._checkLayer(o);g&&g.slot!==d&&(g.slot=d,this._updateLayer(g))}setFilter(o,d,g={}){this._checkLoaded();const b=this._checkLayer(o);if(b&&!i.by(b.filter,d))return d==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(Sr,`layers.${b.id}.filter`,d,{layerType:b.type},g)||(b.filter=i.dp(d),this._updateLayer(b)))}getFilter(o){const d=this._checkLayer(o);if(d)return i.dp(d.filter)}setLayoutProperty(o,d,g,b={}){this._checkLoaded();const T=this._checkLayer(o);if(T&&!i.by(T.getLayoutProperty(d),g)){if(g!=null&&(!b||b.validate!==!1)&&Oh(T,Ye.call(Ht,{key:`layers.${o}.layout.${d}`,layerType:T.type,objectKey:d,value:g,styleSpec:i.a6,style:{glyphs:!0,sprite:!0}})))return;T.setLayoutProperty(d,g),T.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),T.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T.fqid),this._updateLayer(T)}}setLayerProperty(o,d,g,b={}){this._checkLoaded();const T=this._checkLayer(o);T&&(d==="appearances"?(T.setAppearances(g),this._changes.setDirty()):T.isPaintProperty(d)?this.setPaintProperty(o,d,g,b):this.setLayoutProperty(o,d,g,b))}getLayoutProperty(o,d){const g=this._checkLayer(o);if(g)return g.getLayoutProperty(d)}setPaintProperty(o,d,g,b={}){this._checkLoaded();const T=this._checkLayer(o);if(!T||i.by(T.getPaintProperty(d),g)||g!=null&&(!b||b.validate!==!1)&&Oh(T,Mi.call(Ht,{key:`layers.${o}.paint.${d}`,layerType:T.type,objectKey:d,value:g,styleSpec:i.a6})))return;const E=T.setPaintProperty(d,g);T.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),T.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T.fqid),E&&this._updateLayer(T),this._changes.updatePaintProperties(T)}getPaintProperty(o,d){const g=this._checkLayer(o);if(g)return g.getPaintProperty(d)}setFeatureState(o,d){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:M,importId:N}=o.target,j=this.getFragmentStyle(N),W=j.getFeaturesetLayers(M);for(const{source:Z,sourceLayer:Y}of W)j.setFeatureState({id:o.id,source:Z,sourceLayer:Y},d)}else if("layerId"in o.target){const{layerId:M}=o.target,N=this.getLayer(M);this.setFeatureState({id:o.id,source:N.source,sourceLayer:N.sourceLayer},d)}return}const g=o.source,b=o.sourceLayer,T=this._checkSource(g);if(!T)return;const E=T.type;if(E==="geojson"&&b)return void this.fire(new i.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!b)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(g);for(const M of I)M.setFeatureState(b,o.id,d)}removeFeatureState(o,d){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:M,importId:N}=o.target,j=this.getFragmentStyle(N),W=j.getFeaturesetLayers(M);for(const{source:Z,sourceLayer:Y}of W)j.removeFeatureState({id:o.id,source:Z,sourceLayer:Y},d)}else if("layerId"in o.target){const{layerId:M}=o.target,N=this.getLayer(M);this.removeFeatureState({id:o.id,source:N.source,sourceLayer:N.sourceLayer},d)}return}const g=o.source,b=this._checkSource(g);if(!b)return;const T=b.type,E=T==="vector"?o.sourceLayer:void 0;if(T==="vector"&&!E)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new i.y(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(g);for(const M of I)M.removeFeatureState(E,o.id,d)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let T;if("featuresetId"in o.target){const{featuresetId:E,importId:I}=o.target,M=this.getFragmentStyle(I),N=M.getFeaturesetLayers(E);for(const{source:j,sourceLayer:W}of N){const Z=M.getFeatureState({id:o.id,source:j,sourceLayer:W});if(Z&&!T)T=Z;else if(!i.by(T,Z))return void this.fire(new i.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){const{layerId:E}=o.target,I=this.getLayer(E);T=this.getFeatureState({id:o.id,source:I.source,sourceLayer:I.sourceLayer})}return T}const d=o.source,g=o.sourceLayer,b=this._checkSource(d);if(b){if(b.type!=="vector"||g)return o.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(d)[0].getFeatureState(g,o.id);this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const o=this.getTerrain(),d=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return i.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:d,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateFilteredLayers(o){for(const d of Object.values(this._mergedLayers))o(d)&&this._updateLayer(d)}_updateLayer(o){this._changes.updateLayer(o);const d=this.getLayerSourceCache(o),g=i.B(o.source,o.scope),b=this._changes.getUpdatedSourceCaches();o.source&&!b[g]&&d&&d.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),d.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const d=I=>this._mergedLayers[I].is3D(!!this.terrain),g=this.order,b={},T=[];for(let I=g.length-1;I>=0;I--){const M=g[I];if(d(M)){b[M]=I;for(const N of o){const j=N[M];if(j)for(const W of j)T.push(W)}}}T.sort((I,M)=>M.intersectionZ-I.intersectionZ);const E=[];for(let I=g.length-1;I>=0;I--){const M=g[I];if(d(M))for(let N=T.length-1;N>=0;N--){const j=T[N].feature;if(j.layer&&b[j.layer.id]<I)break;E.push(j),T.pop()}else for(const N of o){const j=N[M];if(j)for(const W of j)E.push(W.feature)}}return E}queryRasterValue(o,d,g){const b=this.getOwnSource(o);return b?b.type!=="raster-array"?(this.fire(new i.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):b.queryRasterArrayValue(d,g):(this.fire(new i.y(new Error(`Source with id "${o}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(o,d,g){let b;d&&!Array.isArray(d)&&d.filter&&(this._validate(Sr,"queryRenderedFeatures.filter",d.filter,null,d),b=i.b6(d.filter));const T={},E=j=>{if(_y.has(j.type))return;const W=this.getOwnLayerSourceCache(j),Z=T[W.id]=T[W.id]||{sourceCache:W,layers:{},has3DLayers:!1};j.is3D(!!this.terrain)&&(Z.has3DLayers=!0),Z.layers[j.fqid]=Z.layers[j.fqid]||{styleLayer:j,targets:[]},Z.layers[j.fqid].targets.push({filter:b})};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new i.y(new Error("parameters.layers must be an Array."))),[];for(const j of d.layers){const W=this._layers[j];if(!W)return this.fire(new i.y(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];E(W)}}else for(const j in this._layers)E(this._layers[j]);const I=this._queryRenderedFeatures(o,T,g),M=this._flattenAndSortRenderedFeatures(I),N=[];for(const j of M)i.dw(j.layer.id)===this.scope&&N.push(j);return N}queryRenderedFeatureset(o,d,g){let b;d&&!Array.isArray(d)&&d.filter&&(this._validate(Sr,"queryRenderedFeatures.filter",d.filter,null,d),b=i.b6(d.filter));const T="mock",E=[];if(d&&d.target)E.push(Object.assign({},d,{targetId:T,filter:b}));else{const j=this.getFeaturesetDescriptors();for(const W of j)E.push({targetId:T,filter:b,target:W});for(const{style:W}of this.fragments){const Z=W.getFeaturesetDescriptors();for(const Y of Z)E.push({targetId:T,filter:b,target:Y})}}const I=this.queryRenderedTargets(o,E,g),M=[],N=new Set;for(const j of I)for(const W of j.variants[T])Vp(W,j,N)||M.push(new i.dx(j,W));return M}queryRenderedTargets(o,d,g){const b={},T=(I,M,N,j)=>{const W=b[M.id]=b[M.id]||{sourceCache:M,layers:{},has3DLayers:!1};if(W.layers[I.fqid]=W.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(W.has3DLayers=!0),!j)return N.uniqueFeatureID=!1,void W.layers[I.fqid].targets.push(N);W.layers[I.fqid].targets.push(Object.assign({},N,{namespace:j.namespace,properties:j.properties,uniqueFeatureID:j.uniqueFeatureID}))};for(const I of d)if("featuresetId"in I.target){const{featuresetId:M,importId:N}=I.target,j=this.getFragmentStyle(N);if(!j||!j._featuresetSelectors)continue;const W=j._featuresetSelectors[M];if(!W){this.fire(new i.y(new Error(`The featureset '${M}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const Z of W){const Y=j.getOwnLayer(Z.layerId);Y&&!_y.has(Y.type)&&T(Y,j.getOwnLayerSourceCache(Y),I,Z)}}else if("layerId"in I.target){const{layerId:M}=I.target,N=this.getLayer(M);if(!N||_y.has(N.type))continue;T(N,this.getLayerSourceCache(N),I)}const E=this._queryRenderedFeatures(o,b,g);return this._flattenAndSortRenderedFeatures(E)}_queryRenderedFeatures(o,d,g){const b=[],T=!!this.map._showQueryGeometry,E=Ps.createFromScreenPoints(o,g);for(const I in d){const M=ey(E,d[I],this._availableImages,g,T);Object.keys(M).length&&b.push(M)}if(this.placement)for(const I in d){if(!d[I].sourceCache._onlySymbols)continue;const M=ty(E.screenGeometry,d[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(M).length&&b.push(M)}return b}querySourceFeatures(o,d){const g=d&&d.filter;g&&this._validate(Sr,"querySourceFeatures.filter",g,null,d);let b=[];const T=this.getOwnSourceCaches(o);for(const E of T)b=b.concat(ny(E,d));return b}addSourceType(o,d,g){return qu.getSourceType(o)?g(new Error(`A source type called "${o}" already exists.`)):(qu.setSourceType(o,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:d.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,d,g={}){this._checkLoaded();const b=this.light.getLight();let T=!1;for(const I in o)if(!i.by(o[I],b[I])){T=!0;break}if(!T)return;const E=this._getTransitionParameters();this.light.setLight(o,d,g),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,d=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),d===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=o;const b=!("source"in o)||o.source==null;if(d===1){if(this.disableElevatedTerrain)return;if("source"in g&&typeof g.source=="object"){const I="terrain-dem-src";this.addSource(I,g.source),g=i.dp(g),g=Object.assign(g,{source:I})}const T=Object.assign({},g),E={};if(this.terrain&&b){T.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(E.style=I.serialize())}if(this._validate(Ir,"terrain",T,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!b||this.terrain&&d!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,d),this.fire(new i.z("data",{dataType:"style"}))}else{const T=this.terrain,E=T.get();for(const I of Object.keys(i.a6.terrain))!g.hasOwnProperty(I)&&i.a6.terrain[I].default&&(g[I]=i.a6.terrain[I].default);for(const I in o)if(!i.by(o[I],E[I])){T.set(o,this.options),this.stylesheet.terrain=o;const M=this._getTransitionParameters({duration:0});T.updateTransitions(M),this.fire(new i.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const d=this.fog=new Er(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}_createSnow(o){const d=this.snow=new vs(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}_createRain(o){const d=this.rain=new Hi(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog;if(!i.by(d.get(),o)){d.set(o,this.options),this.stylesheet.fog=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const d=this.snow;if(!i.by(d.get(),o)){d.set(o,this.options),this.stylesheet.snow=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const d=this.rain;if(!i.by(d.get(),o)){d.set(o,this.options),this.stylesheet.rain=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){const o=()=>{for(const b in this._layers)this._layers[b].lut=this._styleColorTheme.lut;for(const b in this._sourceCaches)this._sourceCaches[b].clearTiles()},d=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!d)return this._styleColorTheme.lut=null,void o();const g=this._evaluateColorThemeData(d);this._loadColorTheme(g).then(()=>{this.fire(new i.z("colorthemeset")),o()}).catch(b=>{i.w(`Couldn't set color theme: ${b}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,d){const g=this.getFragmentStyle(o);g&&(g._styleColorTheme.colorThemeOverride=d,g._reloadColorTheme())}_getTransitionParameters(o){return{now:i.o.now(),transition:Object.assign(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;const o=[],d=[];for(const g of this._mergedOrder)this.isLayerDraped(this._mergedLayers[g])?o.push(g):d.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...d)}_createTerrain(o,d){const g=this.terrain=new Ze(o,d,this.scope,this.options,this.map.getWorldview());d===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const b=this._getTransitionParameters({duration:0});g.updateTransitions(b)}_force3DLayerUpdate(){for(const o in this._layers){const d=this._layers[o];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const d=this._layers[o];d.type==="symbol"&&this._updateLayer(d)}}_validate(o,d,g,b,T={}){if(T&&T.validate===!1)return!1;const E=Object.assign({},this.serialize());return Oh(this,o.call(Ht,Object.assign({key:d,style:E,value:g,styleSpec:i.a6},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(o){const d=this.getSourceCaches(o);for(const g of d)g.clearTiles()}clearSources(){for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}clearLayers(){for(const o in this._mergedLayers){const d=this._mergedLayers[o];d._clear&&d._clear()}}reloadSource(o){const d=this.getSourceCaches(o);for(const g of d)g.resume(),g.reload()}reloadSources(){for(const o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(o=>{o.modelManager.reloadModels(o.scope)})}updateSources(o){let d;this.directionalLight&&(d=ng(this.directionalLight));const g=new Set,b=new Set;for(const T in this._mergedLayers){const E=this._mergedLayers[T];E.type==="building"&&g.add(E.source),E.hasElevation()&&!b.has(E.source)&&b.add(E.source)}for(const T in this._mergedSourceCaches){const E=this._mergedSourceCaches[T],I=b.has(E._source.id);g.has(E._source.id)&&(E._source.reparseOverscaled=!1),E.update(o,void 0,void 0,d,I)}}_generateCollisionBoxes(){for(const o in this._sourceCaches){const d=this._sourceCaches[o];d.resume(),d.reload()}}_updatePlacement(o,d,g,b,T,E,I=!1){let M=!1,N=!1;const j={},W={};for(const J of this._mergedOrder){const oe=this._mergedLayers[J];if(oe.type!=="symbol")continue;const ae=i.B(oe.source,oe.scope);let pe=j[ae];if(!pe){const me=this.getLayerSourceCache(oe);if(!me)continue;const Le=me.getRenderableIds(!0).map(Ce=>me.getTileByID(Ce));W[ae]=Le.slice(),pe=j[ae]=Le.sort((Ce,Re)=>Re.tileID.overscaledZ-Ce.tileID.overscaledZ||(Ce.tileID.isLessThan(Re.tileID)?-1:1))}const _e=this.crossTileSymbolIndex.addLayer(oe,pe,d.center.lng,d.projection);M=M||_e}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new i.z("neworder"));const Z=!!(this.placement&&!d.equals(this.placement.transform)),Y=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!E||this.placement.lastReplacementSourceUpdateTime!==E.updateTime)),te=(Z||Y||M||this.placement&&this.placement.isStale())&&b===0;if((I||!this.pauseablePlacement||te||b!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.o.now(),d.zoom))&&(this.pauseablePlacement=new Eo(d,this._mergedOrder,I||b===0,g,b,T,this.placement,this.fog&&d.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,j,W,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.o.now()),N=!0),M&&this.pauseablePlacement.placement.setStale()),N||M){this._buildingIndex.onNewFrame(d.zoom);for(let J=0;J<this._mergedOrder.length;J++){const oe=this._mergedLayers[this._mergedOrder[J]];if(oe.type!=="symbol"||oe.visibility==="none")continue;const ae=this.isLayerClipped(oe);this.placement.updateLayerOpacities(oe,j[i.B(oe.source,oe.scope)],J,ae?E:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.o.now())}}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,d){this._checkLoaded();const g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:T})=>T===o.id)!==-1)return void this.fire(new i.y(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!d)return g.push(o),this._loadImports([o],!0);const b=g.findIndex(({id:T})=>T===d);return b===-1&&this.fire(new i.y(new Error(`Import with id "${d}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,b).concat(o).concat(g.slice(b)),this._loadImports([o],!0,d)}updateImport(o,d){this._checkLoaded();const g=this.stylesheet.imports||[],b=this.getImportIndex(o);return b===-1?this:typeof d=="string"?(this.setImportUrl(o,d),this):(d.url&&d.url!==g[b].url&&this.setImportUrl(o,d.url),i.by(d.config,g[b].config)||this.setImportConfig(o,d.config,d.data.schema),i.by(d.data,g[b].data)||this.setImportData(o,d.data),this)}moveImport(o,d){this._checkLoaded();let g=this.stylesheet.imports||[];const b=this.getImportIndex(o);if(b===-1)return this;const T=this.getImportIndex(d);if(T===-1)return this;const E=g[b],I=this.fragments[b];return g=g.filter(({id:M})=>M!==o),this.fragments=this.fragments.filter(({id:M})=>M!==o),this.stylesheet.imports=g.slice(0,T).concat(E).concat(g.slice(T)),this.fragments=this.fragments.slice(0,T).concat(I).concat(this.fragments.slice(T)),this.mergeLayers(),this}setImportUrl(o,d){this._checkLoaded();const g=this.stylesheet.imports||[],b=this.getImportIndex(o);if(b===-1)return this;g[b].url=d;const T=this.fragments[b];return T.style=this._createFragmentStyle(g[b]),T.style.on("style.import.load",()=>this.mergeAll()),T.style.loadURL(d),this}setImportData(o,d){this._checkLoaded();const g=this.getImportIndex(o),b=this.stylesheet.imports||[];return g===-1?this:d?(this.fragments[g].style.setState(d),this._reloadImports(),this):(delete b[g].data,this.setImportUrl(o,b[g].url))}setImportConfig(o,d,g){this._checkLoaded();const b=this.getImportIndex(o),T=this.stylesheet.imports||[];if(b===-1)return this;d?T[b].config=d:delete T[b].config;const E=this.fragments[b];g&&E.style.stylesheet&&(E.style.stylesheet.schema=g);const I=E.style.stylesheet&&E.style.stylesheet.schema;return E.config=d,E.style.updateConfig(d,I),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();const d=this.stylesheet.imports||[],g=this.getImportIndex(o);g!==-1&&(d.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(o){const d=(this.stylesheet.imports||[]).findIndex(g=>g.id===o);return d===-1&&this.fire(new i.y(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),d}getLayer(o){return this._mergedLayers[o]}getSources(){const o=[];for(const d in this._mergedOtherSourceCaches){const g=this._mergedOtherSourceCaches[d];g&&o.push(g.getSource())}return o}getSource(o,d){const g=this.getSourceCache(o,d);return g&&g.getSource()}getLayerSource(o){const d=this.getLayerSourceCache(o);return d&&d.getSource()}getSourceCache(o,d){const g=i.B(o,d);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(o){const d=i.B(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[d]:this._mergedOtherSourceCaches[d]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);const d=[];return this._mergedOtherSourceCaches[o]&&d.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&d.push(this._mergedSymbolSourceCaches[o]),d}updateSourceCaches(){const o=this._changes.getUpdatedSourceCaches();for(const d in o){const g=o[d];g==="reload"?this.reloadSource(d):g==="clear"&&this.clearSource(d)}}updateLayers(o){const d=this._changes.getUpdatedPaintProperties();for(const g of d){const b=this.getLayer(g);b&&b.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o)}getImages(o,d,g){this.imageManager.getImages(d.images,d.scope,g),this._updateTilesForChangedImages();const b=E=>{if(E){const I=d.images.map(M=>i.I.toString(M));E.setDependencies(d.tileID.key,d.type,I)}},T=i.B(d.source,d.scope);b(this._mergedOtherSourceCaches[T]),b(this._mergedSymbolSourceCaches[T]),d.images.some(E=>E.iconsetId)&&this.fire(new i.z("data",{dataType:"style"}))}rasterizeImages(o,d,g){this.imageManager.rasterizeImages(d,g)}getGlyphs(o,d,g){this.glyphManager.getGlyphs(d.stacks,g)}getResource(o,d,g){return i.dz(d,g)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){const d=[];return this._otherSourceCaches[o]&&d.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&d.push(this._symbolSourceCaches[o]),d}_isSourceCacheLoaded(o){const d=this.getOwnSourceCaches(o);return d.length===0?(this.fire(new i.y(new Error(`There is no source with ID '${o}'`))),!1):d.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,d){if(!this._clipLayerPresent&&o.type!=="fill-extrusion"&&o.type!=="building")return!1;const g=o.type==="fill-extrusion"&&(o.sourceLayer==="building"||o.sourceLayer==="procedural_buildings"),b=o.type==="building";if(o.is3D(!!this.terrain)){if(g||b||d&&d.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}qu.getSourceType=function(m){return Wc[m]},qu.setSourceType=function(m,o){Wc[m]=o},qu.registerForPluginStateChange=i.dA;class NE extends i.E{constructor(o){super(),this._style=o,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},i.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(o){o===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=o,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(o){this._activeFloorsVisible=o,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(o){for(const[d,g]of Object.entries(o.buildings))if(this._buildings[d])for(const b of g.floorIds)this._buildings[d].floors[b]||(this._buildings[d].floors[b]=g.floors[b]);else this._buildings[d]=g;for(const d of o.activeFloors)this._activeFloors.add(d);this._updateIndoorSelector()}getIndoorTileOptions(o,d){const g=this._style.getIndoorSourceLayers(o,d);return g&&this._indoorState?{sourceLayers:g,indoorState:this._indoorState}:null}_updateUI(o,d,g){const b=function(T,E,I,M){let N=null,j=Number.MAX_SAFE_INTEGER;if(M<16)return null;for(const[W,Z]of Object.entries(T)){const Y=Z.center;if(Y){const te=E.distanceTo(i.aT.convert(Y));te<j&&I.contains(Y)&&(j=te,N=W)}}return N}(this._buildings,d,g,o);b!==this._closestBuildingId&&(this._closestBuildingId=b,this._updateIndoorSelector())}_updateIndoorSelector(){const o=this._buildings,d=this._closestBuildingId,g=d&&o?o[d]:void 0;if(!g)return void this.fire(new i.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let b=null;for(const E of g.floorIds)if(this._activeFloors&&this._activeFloors.has(E)){b=E;break}const T=Array.from(g.floorIds).map(E=>({id:E,name:g.floors[E].name,zIndex:g.floors[E].zIndex})).sort((E,I)=>I.zIndex-E.zIndex);this.fire(new i.z("selector-update",{selectedFloorId:b,activeFloorsVisible:this._activeFloorsVisible,floors:T}))}_updateActiveFloors(){const o=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:o,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Zp=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Wp=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,ib=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,yy="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",_u=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,vy=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Jt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,sb=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,xy=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,by=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,ab=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const ig=/#include\s+"([^"]+)"/g,td=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,ob=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,zf=new Set(["ifdef","ifndef","elif","if","defined"]),Ff=new Set;Nh(Zp,Ff),Nh(ib,Ff),Nh(Wp,Ff);const Dh={"_prelude_fog.vertex.glsl":vy,"_prelude_terrain.vertex.glsl":_u,"_prelude_shadow.vertex.glsl":by,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Jt,"_prelude_shadow.fragment.glsl":ab,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":sb,"_prelude_raster_particle.glsl":xy},wy={};Ci("",_u),Ci(Jt,vy),Ci(ab,by),Ci(sb,""),Ci(xy,"");const zE=Ci(Wp,ib),Ty=Zp,_I=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Ty,zE.fragmentSource].join(`
`),FE=["precision highp float;",Ty,zE.vertexSource].join(`
`);var lb={background:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:Ci(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Ci(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ci("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ci(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ci(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ci("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ci("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ci("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Ci(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Ci(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ci(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ci(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ci(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ci(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ci("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ci("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ci(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ci(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ci("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ci(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,yy),skyboxGradient:Ci(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,yy),skyboxCapture:Ci(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ci(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ci(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ci(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Ci("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Ci("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Ci("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ci("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Nh(m,o){const d=m.split(`
`);for(let g of d){if(g=g.trimStart(),g[0]!=="#"||!g.includes("if")||g.startsWith("#endif"))continue;const b=g.match(ob);if(b)for(const T of b)zf.has(T)||o.add(T)}}function Ci(m,o){const d=new Set,g=[],b=[];m=m.replace(ig,(E,I)=>(b.push(I),"")),o=o.replace(ig,(E,I)=>(g.push(I),""));let T=new Set(Ff);Nh(m,T),Nh(o,T);for(const E of[...g,...b])wy[E]||(wy[E]=new Set,Nh(Dh[E],wy[E])),T=new Set([...T,...wy[E]]);return{fragmentSource:m=m.replace(td,(E,I,M,N,j)=>(d.add(j),I==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${M} ${N} ${j};
#else
uniform ${M} ${N} u_${j};
#endif
`:I==="initialize"?`
#ifdef HAS_UNIFORM_u_${j}
    ${M} ${N} ${j} = u_${j};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${M} ${N} ${j};
#endif
`:I==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(td,(E,I,M,N,j)=>{const W=`MATERIAL_ATTRIBUTE_OFFSET_${j}`,Z=N==="float"?"vec2":N,Y=`GET_ATTRIBUTE_${Z}(a_${j}, materialInfo, ${W})`,te=j.match(/color/)?"color":Z;return I==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${j}
in ${M} ${N} a_${j};
#endif
`:d.has(j)?I==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
    #if !defined(${W})
        in ${M} ${Z} a_${j};
    #endif
out ${M} ${N} ${j};
#else
uniform ${M} ${N} u_${j};
#endif
`:I==="initialize"?te==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${M} ${N} ${j} = u_${j};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${j})
    #ifdef ${W}
        ${j} = unpack_mix_${te}(${Y}, u_${j}_t);
    #else
        ${j} = unpack_mix_${te}(a_${j}, u_${j}_t);
    #endif
#else
    ${M} ${N} ${j} = u_${j};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${M} ${N} a_${j};
    out ${M} ${N} ${j};
#endif
`:I==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${j} = a_${j};
#endif
`:void 0:I==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
    #if !defined(${W})
        in ${M} ${Z} a_${j};
    #endif
#else
uniform ${M} ${N} u_${j};
#endif
`:I==="define-instanced"?te==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${j}0;
in vec4 a_${j}1;
in vec4 a_${j}2;
in vec4 a_${j}3;
#else
uniform ${M} ${N} u_${j};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${M} ${Z} a_${j};
#else
uniform ${M} ${N} u_${j};
#endif
`:I==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${M} ${N} ${j} = a_${j};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    #ifdef ${W}
        ${M} ${N} ${j} = ${Y};
    #else
        ${M} ${N} ${j} = a_${j};
    #endif
#else
    ${M} ${N} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    #ifdef ${W}
        ${M} ${N} ${j} = unpack_mix_${te}(${Y}, u_${j}_t);
    #else
        ${M} ${N} ${j} = unpack_mix_${te}(a_${j}, u_${j}_t);
    #endif
#else
    ${M} ${N} ${j} = u_${j};
#endif
`}),usedDefines:T,vertexIncludes:g,fragmentIncludes:b}}class yI{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,d,g,b,T,E,I,M){this.context=o;let N=this.boundPaintVertexBuffers.length!==b.length;for(let W=0;!N&&W<b.length;W++)this.boundPaintVertexBuffers[W]!==b[W]&&(N=!0);let j=this.boundDynamicVertexBuffers.length!==I.length;for(let W=0;!j&&W<I.length;W++)this.boundDynamicVertexBuffers[W]!==I[W]&&(j=!0);if(!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==g||N||j||this.boundIndexBuffer!==T||this.boundVertexOffset!==E)this.freshBind(d,g,b,T,E,I,M);else{o.bindVertexArrayOES.set(this.vao);for(const W of I)W&&(W.bind(),M&&W.instanceCount&&W.setVertexAttribDivisor(o.gl,d,M));T&&T.dynamicDraw&&T.bind()}}freshBind(o,d,g,b,T,E,I){const M=this.context,N=M.gl;this.vao&&this.destroy(),this.vao=M.gl.createVertexArray(),M.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=b,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=E,d.enableAttributes(N,o),d.bind(),d.setVertexAttribPointers(N,o,T);for(const j of g)j.enableAttributes(N,o),j.bind(),j.setVertexAttribPointers(N,o,T);for(const j of E)j&&(j.enableAttributes(N,o),j.bind(),j.setVertexAttribPointers(N,o,T),I&&j.instanceCount&&j.setVertexAttribDivisor(N,o,I));b&&b.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function vI(m,o){const d=Math.pow(2,o.canonical.z),g=o.canonical.y;return[new i.ae(0,g/d).toLngLat().lat,new i.ae(0,(g+1)/d).toLngLat().lat]}function xI(m,o,d,g,b,T,E){const I=m.context,M=I.gl,N=d.hillshadeFBO;if(!N)return;m.prepareDrawTile();const j=m.isTileAffectedByFog(o),W=[];m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&W.push("USE_MRT1");const Z=m.getOrCreateProgram("hillshade",{overrideFog:j,defines:W});I.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,N.colorAttachment0.get());const Y=((ae,pe,_e,me)=>{const Le=_e.paint.get("hillshade-shadow-color"),Ce=_e.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Re=_e.paint.get("hillshade-highlight-color"),Ae=_e.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Te=_e.paint.get("hillshade-accent-color"),ze=_e.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",We=_e.paint.get("hillshade-emissive-strength");let Ge=i.an(_e.paint.get("hillshade-illumination-direction"));if(_e.paint.get("hillshade-illumination-anchor")==="viewport")Ge-=ae.transform.angle;else if(ae.style&&ae.style.enable3dLights()&&ae.style.directionalLight){const ht=ae.style.directionalLight.properties.get("direction"),Et=i.d4(ht.x,ht.y,ht.z);Ge=i.an(Et[1])}const ct=!ae.options.moving;return{u_matrix:me||ae.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),ct),u_image:0,u_latrange:vI(0,pe.tileID),u_light:[_e.paint.get("hillshade-exaggeration"),Ge],u_shadow:Le.toPremultipliedRenderColor(Ce?null:_e.lut),u_highlight:Re.toPremultipliedRenderColor(Ae?null:_e.lut),u_emissive_strength:We,u_accent:Te.toPremultipliedRenderColor(ze?null:_e.lut)}})(m,d,g,m.terrain?o.projMatrix:null);m.uploadCommonUniforms(I,Z,o.toUnwrapped());const{tileBoundsBuffer:te,tileBoundsIndexBuffer:J,tileBoundsSegments:oe}=m.getTileBoundsBuffers(d);Z.draw(m,M.TRIANGLES,b,T,E,Rr.disabled,Y,g.id,te,J,oe)}function ub(m,o,d){if(!o.needsDEMTextureUpload)return;const g=m.context,b=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||m.getTileTexture(d.stride);const T=d.getPixels();o.demTexture?o.demTexture.update(T,{premultiply:!1}):o.demTexture=new i.T(g,T,b.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function bI(m,o,d){const g=m.context,b=g.gl;if(!o.dem)return;const T=o.dem;if(g.activeTexture.set(b.TEXTURE1),ub(m,o,T),!o.demTexture)return;o.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const E=T.dim;g.activeTexture.set(b.TEXTURE0);let I=o.hillshadeFBO;if(!I){const Z=new i.T(g,{width:E,height:E,data:null},b.RGBA8);Z.bind(b.LINEAR,b.CLAMP_TO_EDGE),I=o.hillshadeFBO=g.createFramebuffer(E,E,1,"renderbuffer"),I.colorAttachment0.set(Z.texture)}g.bindFramebuffer.set(I.framebuffer),g.viewport.set([0,0,E,E]);const{tileBoundsBuffer:M,tileBoundsIndexBuffer:N,tileBoundsSegments:j}=m.getMercatorTileBoundsBuffers(),W=[];m.linearFloatFilteringSupported()&&W.push("TERRAIN_DEM_FLOAT_FORMAT"),m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&W.push("USE_MRT1"),m.getOrCreateProgram("hillshadePrepare",{defines:W}).draw(m,b.TRIANGLES,Fn.disabled,Mr.disabled,Vr.unblended,Rr.disabled,((Z,Y)=>{const te=Y.stride,J=i.bC();return i.ce(J,0,i.al,-i.al,0,0,1),i.br(J,J,[0,-i.al,0]),{u_matrix:J,u_image:1,u_dimension:[te,te],u_zoom:Z.overscaledZ}})(o.tileID,T),d.id,M,N,j),o.needsHillshadePrepare=!1}class aa{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wI extends aa{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class BE extends aa{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class cb extends aa{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Ey extends aa{getDefault(){return[!0,!0,!0,!0]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class db extends aa{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Bf extends aa{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Xp extends aa{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const d=this.current;(o.func!==d.func||o.ref!==d.ref||o.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class sg extends aa{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Yp extends aa{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=o,this.dirty=!1}}class jE extends aa{getDefault(){return[0,1]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class hb extends aa{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=o,this.dirty=!1}}class UE extends aa{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Kp extends aa{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.BLEND):d.disable(d.BLEND),this.current=o,this.dirty=!1}}class Sy extends aa{getDefault(){const o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Ay extends aa{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class fb extends aa{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class Cy extends aa{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=o,this.dirty=!1}}class ag extends aa{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class VE extends aa{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let $E=class extends aa{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class HE extends aa{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Qp extends aa{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class GE extends aa{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class TI extends aa{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class EI extends aa{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class SI extends aa{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class pb extends aa{getDefault(){return null}set(o){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class mb extends aa{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class gb extends aa{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class _b extends aa{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class qE extends aa{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class ky extends aa{constructor(o,d){super(o),this.context=o,this.parent=d}getDefault(){return null}}class Iy extends ky{constructor(o,d,g=0){super(o,d),this.attachmentPoint=o.gl.COLOR_ATTACHMENT0+g}setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,this.attachmentPoint,d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Jp extends ky{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class og extends ky{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,this.attachment(),d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class ZE extends Jp{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const yu=(m,o,d,g)=>({u_matrix:m,u_image0:0,u_image1:1,u_skirt_height:o,u_ground_shadow_factor:d,u_emissive_texture_available:g}),Ry=(m,o,d,g,b,T,E,I,M,N,j,W,Z,Y,te,J,oe)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:d,u_zoom_transition:b,u_merc_center:T,u_image0:0,u_image1:1,u_frustum_tl:E,u_frustum_tr:I,u_frustum_br:M,u_frustum_bl:N,u_globe_pos:j,u_globe_radius:W,u_viewport:Z,u_grid_matrix:oe?Float32Array.from(oe):new Float32Array(9),u_skirt_height:Y,u_far_z_cutoff:te,u_emissive_texture_available:J});function lg(m,o){return m!=null&&o!=null&&!(!m.hasData()||!o.hasData())&&m.demTexture!=null&&o.demTexture!=null&&m.tileID.key!==o.tileID.key}const Ld=new class{constructor(){this.operations={}}newMorphing(m,o,d,g,b){if(m in this.operations){const T=this.operations[m];T.to.tileID.key!==d.tileID.key&&(T.queued=d)}else this.operations[m]={startTime:g,phase:0,duration:b,from:o,to:d,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const o=this.operations[m];return{from:o.from,to:o.to,phase:o.phase}}update(m){for(const o in this.operations){const d=this.operations[o];for(d.phase=(m-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,m)){delete this.operations[o];break}}}_nextOp(m,o){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=o,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},My={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Py(m,o,d){if(o===0)return 0;const g=o<1&&d===514?.25/o:1;return 6*Math.pow(1.5,22-m)*Math.max(o,1)*g}function yb(m,o){const d=1<<m.z;return!o&&(m.x===0||m.x===d-1)||m.y===0||m.y===d-1}function em(m,o){if(!m.style||!m.style.enable3dLights())return;const d=m.context,g=d.gl;d.activeTexture.set(g.TEXTURE1),o?o.bind(g.LINEAR,g.CLAMP_TO_EDGE):m.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)}const ug=m=>({u_matrix:m});function cg(m,o,d,g,b){if(b>0){const T=i.o.now(),E=(T-m.timeAdded)/b,I=o?(T-o.timeAdded)/b:-1,M=d.getSource(),N=g.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),j=!o||Math.abs(o.tileID.overscaledZ-N)>Math.abs(m.tileID.overscaledZ-N),W=j&&m.refreshedUponExpiration?1:i.aA(j?E:1-I,0,1);return o?{opacity:1,mix:1-W,isFading:E<1}:{opacity:W,mix:0,isFading:E<1}}return{opacity:1,mix:0,isFading:!1}}class Oy extends Jl{constructor(o){const d=To("mock-dem",{type:"raster-dem",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("mock-dem",d,!1),d.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,d){o.state="loaded",d(null)}}class vb extends Jl{constructor(o){const d=To("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,d,g){if(o.freezeTileCoverage)return;this.transform=o;const b=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((T,E)=>{if(T[E.key]="",!this._tiles[E.key]){const I=new Of(E,this._source.tileSize*E.overscaleFactor(),o.tileZoom,void 0,void 0,this._source.worldview);I.state="loaded",this._tiles[E.key]=I}return T},{});for(const T in this._tiles)T in b||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(o){const d=this.proxyCachedFBO[o];if(d!==void 0){const g=Object.values(d);this.renderCachePool.push(...g),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class xb extends i.aQ{constructor(o,d,g){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=d,this.projMatrix=g}}class bb extends i.bV{constructor(o,d){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,b,T]=function(M){const N=new i.bd,j=new i.b0,W=131;N.reserve(17161),j.reserve(33800);const Z=i.al/128,Y=i.al+Z/2,te=Y+Z;for(let oe=-Z;oe<te;oe+=Z)for(let ae=-Z;ae<te;ae+=Z){const pe=ae<0||ae>Y||oe<0||oe>Y?24575:0,_e=i.aA(Math.round(ae),0,i.al),me=i.aA(Math.round(oe),0,i.al);N.emplaceBack(_e+pe,me)}const J=(oe,ae)=>{const pe=ae*W+oe;j.emplaceBack(pe+1,pe,pe+W),j.emplaceBack(pe+W,pe+W+1,pe+1)};for(let oe=1;oe<129;oe++)for(let ae=1;ae<129;ae++)J(ae,oe);return[0,129].forEach(oe=>{for(let ae=0;ae<130;ae++)J(ae,oe),J(oe,ae)}),[N,j,32768]}(),E=o.context;this.gridBuffer=E.createVertexBuffer(g,i.bf.members),this.gridIndexBuffer=E.createIndexBuffer(b),this.gridSegments=i.bg.simpleSegment(0,0,g.length,b.length),this.gridNoSkirtSegments=i.bg.simpleSegment(0,0,g.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new vb(d.map),this.orthoMatrix=i.bC(),i.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.al,0,i.al,0,1);const I=E.gl;this._overlapStencilMode=new Mr({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Oy(d.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,d,g){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);const b=o.terrain.properties,T=o.terrain.drapeRenderMode===0,E=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.o.now();const I=o.terrain&&o.terrain.scope,M=b.get("source"),N=T?this._mockSourceCache:o.getSourceCache(M,I);if(!N)return void i.w(`Couldn't find terrain source "${M}".`);if(this.sourceCache=N,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=E?this.calculateExaggeration(d):b.get("exaggeration"),!d.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;const j=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const W=this.getScaledDemTileSize();this.sourceCache.update(d,W,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,j(),this._initializing=!0),j(),d.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0,this._previousZoom=d.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);const d=this._previousCameraAltitude,g=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=g;const b=d!=null?g-d:Number.MAX_VALUE;if(Math.abs(b)<2)return this._exaggeration;const T=o.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(T);let I=T-this._previousZoom;const M=this._previousUpdateTimestamp;let N=T;this._evaluationZoom!=null&&(N=this._evaluationZoom,Math.abs(T-N)>.5&&(I=.5*(T-N+I)),I*b<0&&(N+=I)),this._evaluationZoom=N;const j=E.getExaggeration(N),W=j===E.getExaggeration(Math.max(0,N-.1));if(W&&Math.abs(j-this._exaggeration)<.01)return j;let Z=Math.min(.1,.00375*(this._updateTimestamp-M));return(W||j<.1||Math.abs(I)<1e-4)&&(Z=Math.min(.2,4*Z)),i.ak(this._exaggeration,j,Z)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.dataType==="source"&&o.coord?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(i.ae.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=d.getIds().map(M=>{const N=d.getTileByID(M).tileID;return N.projMatrix=g.calculateProjMatrix(N.toUnwrapped()),N});(function(M,N){const j=N.transform.pointCoordinate(N.transform.getCameraPoint()),W=new i.P(j.x,j.y);M.sort((Z,Y)=>{if(Y.overscaledZ-Z.overscaledZ)return Y.overscaledZ-Z.overscaledZ;const te=new i.P(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),J=new i.P(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),oe=W.mult(1<<Z.canonical.z);return oe.x-=.5,oe.y-=.5,oe.distSqr(te)-oe.distSqr(J)})})(b,this.painter);const T=this.proxyToSource||{};this.proxyToSource={},b.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const M in E){const N=E[M];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,o[M],T),N.usedForTerrain))continue;const j=o[M];N.getSource().reparseOverscaled&&this._assignTerrainTiles(j)}this.proxiedCoords[d.id]=b.map(M=>new xb(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const N=this.terrainTileForTile[M.key];if(!N)continue;const j=N.tileID.key;j in I||(this._visibleDemTiles.push(N),I[j]=j)}}_assignTerrainTiles(o){this._initializing||o.forEach(d=>{if(this.terrainTileForTile[d.key])return;const g=this._findTileCoveringTileID(d,this.sourceCache);g&&(this.terrainTileForTile[d.key]=g)})}_prepareDEMTextures(){const o=this.painter.context,d=o.gl;for(const g in this.terrainTileForTile){const b=this.terrainTileForTile[g],T=b.dem;!T||b.demTexture&&!b.needsDEMTextureUpload||(o.activeTexture.set(d.TEXTURE1),ub(this.painter,b,T))}}_prepareDemTileUniforms(o,d,g,b){if(!d||d.demTexture==null)return!1;const T=o.tileID.canonical,E=Math.pow(2,d.tileID.canonical.z-T.z),I=b||"";return g[`u_dem_tl${I}`]=[T.x*E%1,T.y*E%1],g[`u_dem_scale${I}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0;const d=this._visibleDemTiles.reduce((g,b)=>{if(!b.dem)return g;const T=b.dem.tree.minimums[0];return T>0&&o++,g+T},0);return o?d/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,d=o.gl;o.activeTexture.set(d.TEXTURE2);const g=this._getLoadedAreaMinimum(),b=new i.dL({width:1,height:1},new Float32Array([g]));this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(b,{premultiply:!1}):T=this._emptyDEMTexture=new i.T(o,b,d.R32F,{premultiply:!1}),T}setupElevationDraw(o,d,g){const b=this.painter.context,T=b.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let I=null,M=null,N=1;if(g&&g.morphing&&this._useVertexMorphing){const Y=g.morphing.srcDemTile,te=g.morphing.dstDemTile;N=g.morphing.phase,Y&&te&&(this._prepareDemTileUniforms(o,Y,E,"_prev")&&(M=Y),this._prepareDemTileUniforms(o,te,E)&&(I=te))}const j=Y=>Y&&Y.demTexture&&this.painter.linearFloatFilteringSupported()?T.LINEAR:T.NEAREST;let W=null;var Z;if(this.enabled?M&&I?(W=I.demTexture,b.activeTexture.set(T.TEXTURE4),M.demTexture.bind(j(M),T.CLAMP_TO_EDGE),E.u_dem_lerp=N):(I=this.terrainTileForTile[o.tileID.key],W=this._prepareDemTileUniforms(o,I,E)?I.demTexture:this.emptyDEMTexture):W=this.emptyDEMTexture,b.activeTexture.set(T.TEXTURE2),W&&(E.u_dem_size=(Z=W).size[0]===1?1:Z.size[0]-2,W.bind(j(I),T.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(g&&g.useDepthForOcclusion,d,E),g&&g.useMeterToDem&&I){const Y=(1<<I.tileID.canonical.z)*i.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=Y}if(g&&g.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),d.setTerrainUniformValues(b,E),this.painter.transform.projection.name==="globe"){const Y=this.globeUniformValues(this.painter.transform,o.tileID.canonical,g&&g.useDenormalizedUpVectorScale);d.setGlobeUniformValues(b,Y)}}globeUniformValues(o,d,g){const b=o.projection;return{u_tile_tl_up:b.upVector(d,0,0),u_tile_tr_up:b.upVector(d,i.al,0),u_tile_br_up:b.upVector(d,i.al,i.al),u_tile_bl_up:b.upVector(d,0,i.al),u_tile_up_scale:g?i.dM(1):b.upVectorScale(d,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const d=this.painter,g=this.painter.context;o.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,T,E,I,M){if(b.transform.projection.name==="globe")(function(N,j,W,Z,Y){const te=N.context,J=te.gl;let oe,ae;const pe=N.transform,_e=i.dE(N,te,pe),me=(ct,ht)=>{if(ae===ht)return;const Et=[My[ht],"PROJECTION_GLOBE_VIEW"];_e&&Et.push("CUSTOM_ANTIALIASING");const Ut=N.isTileAffectedByFog(ct);oe=N.getOrCreateProgram("globeRaster",{defines:Et,overrideFog:Ut}),ae=ht},Le=N.colorModeForRenderPass(),Ce=new Fn(J.LEQUAL,Fn.ReadWrite,N.depthRangeFor3D);Ld.update(Y);const Re=i.dF(pe),Ae=[i.aF(pe.center.lng),i.aJ(pe.center.lat)],Te=N.globeSharedBuffers,ze=[pe.width*i.o.devicePixelRatio,pe.height*i.o.devicePixelRatio],We=Float32Array.from(pe.globeMatrix),Ge={useDenormalizedUpVectorScale:!0};{const ct=N.transform,ht=Py(ct.zoom,j.exaggeration(),j.sourceCache._source.tileSize);ae=-1;const Et=J.TRIANGLES;for(const Ut of Z){const it=W.getTile(Ut),Ue=Mr.disabled,_t=j.prevTerrainTileForTile[Ut.key],ut=j.terrainTileForTile[Ut.key];lg(_t,ut)&&Ld.newMorphing(Ut.key,_t,ut,Y,250),em(N,it.emissiveTexture),te.activeTexture.set(J.TEXTURE0),it.texture&&it.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const Pt=Ld.getMorphValuesForProxy(Ut.key),nn=Pt?1:0;Pt&&Object.assign(Ge,{morphing:{srcDemTile:Pt.from,dstDemTile:Pt.to,phase:i.dD(Pt.phase)}});const _n=i.dG(Ut.canonical),Yt=i.dH(_n.getCenter().lat),Vt=i.dI(Ut.canonical,_n,Yt,ct.worldSize/ct._pixelsPerMercatorPixel),On=i.bk(i.dJ(Ut.canonical)),Cn=N.emissiveMode==="mrt-fallback"?1:0,fn=Ry(ct.expandedFarZProjMatrix,We,Re,On,i.aj(ct.zoom),Ae,ct.frustumCorners.TL,ct.frustumCorners.TR,ct.frustumCorners.BR,ct.frustumCorners.BL,ct.globeCenterInViewSpace,ct.globeRadius,ze,ht,ct._farZ,Cn,Vt);if(me(Ut,nn),oe&&(j.setupElevationDraw(it,oe,Ge),N.uploadCommonUniforms(te,oe,Ut.toUnwrapped()),Te)){const[vn,tr,Nr]=Te.getGridBuffers(Yt,ht!==0);oe.draw(N,Et,Ce,Ue,Le,Rr.backCCW,fn,"globe_raster",vn,tr,Nr)}}}if(Te&&(N.renderDefaultNorthPole||N.renderDefaultSouthPole)){const ct=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];_e&&ct.push("CUSTOM_ANTIALIASING"),oe=N.getOrCreateProgram("globeRaster",{defines:ct});for(const ht of Z){const{x:Et,y:Ut,z:it}=ht.canonical,Ue=Ut===0,_t=Ut===(1<<it)-1,[ut,Pt,nn,_n]=Te.getPoleBuffers(it,!1);if(_n&&(Ue||_t)){const Yt=W.getTile(ht);em(N,Yt.emissiveTexture),te.activeTexture.set(J.TEXTURE0),Yt.texture&&Yt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let Vt=i.dK(it,Et,pe);const On=i.bk(i.dJ(ht.canonical)),Cn=N.emissiveMode==="mrt-fallback"?1:0,fn=(vn,tr)=>vn.draw(N,J.TRIANGLES,Ce,Mr.disabled,Le,Rr.disabled,Ry(pe.expandedFarZProjMatrix,Vt,Vt,On,0,Ae,pe.frustumCorners.TL,pe.frustumCorners.TR,pe.frustumCorners.BR,pe.frustumCorners.BL,pe.globeCenterInViewSpace,pe.globeRadius,ze,0,pe._farZ,Cn),"globe_pole_raster",tr,nn,_n);j.setupElevationDraw(Yt,oe,Ge),N.uploadCommonUniforms(te,oe,ht.toUnwrapped()),Ue&&N.renderDefaultNorthPole&&fn(oe,ut),_t&&N.renderDefaultSouthPole&&(Vt=i.cS(i.bC(),Vt,[1,-1,1]),fn(oe,Pt))}}}})(b,T,E,I,M);else{const N=b.context,j=N.gl;let W,Z;const Y=b.shadowRenderer,te=Mh(b,b.longestCutoffRange),J=Le=>{if(Z===Le)return;const Ce=[];Ce.push(My[Le]),te.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF"),Y&&(Ce.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Y.useNormalOffset&&Ce.push("NORMAL_OFFSET")),W=b.getOrCreateProgram("terrainRaster",{defines:Ce}),Z=Le},oe=b.colorModeForRenderPass(),ae=new Fn(j.LEQUAL,Fn.ReadWrite,b.depthRangeFor3D);Ld.update(M);const pe=b.transform,_e=Py(pe.zoom,T.exaggeration(),T.sourceCache._source.tileSize);let me=[0,0,0];if(Y){const Le=b.style.directionalLight,Ce=b.style.ambientLight;Le&&Ce&&(me=Od(b.style,Le,Ce))}{Z=-1;const Le=j.TRIANGLES,[Ce,Re]=[T.gridIndexBuffer,T.gridSegments];for(const Ae of I){const Te=E.getTile(Ae),ze=Mr.disabled,We=T.prevTerrainTileForTile[Ae.key],Ge=T.terrainTileForTile[Ae.key];lg(We,Ge)&&Ld.newMorphing(Ae.key,We,Ge,M,250),em(b,Te.emissiveTexture),N.activeTexture.set(j.TEXTURE0),Te.texture&&Te.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const ct=Ld.getMorphValuesForProxy(Ae.key),ht=ct?1:0;let Et;ct&&(Et={morphing:{srcDemTile:ct.from,dstDemTile:ct.to,phase:i.dD(ct.phase)}});const Ut=b.emissiveMode==="mrt-fallback"?1:0,it=yu(Ae.projMatrix,yb(Ae.canonical,pe.renderWorldCopies)?_e/10:_e,me,Ut);if(J(ht),!W)continue;T.setupElevationDraw(Te,W,Et);const Ue=Ae.toUnwrapped();Y&&Y.setupShadows(Ue,W),b.uploadCommonUniforms(N,W,Ue,null,te),W.draw(b,Le,ae,ze,oe,Rr.backCCW,it,"terrain_raster",T.gridBuffer,Ce,Re)}}}}(d,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const d=this.painter,g=this.painter.context,b=this.proxySourceCache,T=this.proxiedCoords[b.id],E=this._drapedRenderBatches.shift(),I=d.style.order,M=[];this._updateFBOs(d.emissiveMode==="mrt-fallback");let N=0;for(const j of T){const W=b.getTileByID(j.proxyTileKey),Z=b.proxyCachedFBO[j.key]?b.proxyCachedFBO[j.key][o]:void 0,Y=Z!==void 0?b.renderCache[Z]:this.pool[N++],te=Z!==void 0;if(W.texture=Y.tex,W.emissiveTexture=Y.emissiveTex,te&&!Y.dirty){M.push(W.tileID);continue}g.bindFramebuffer.set(Y.fb.framebuffer);const J=g.gl;let oe;J.drawBuffers(d.emissiveMode==="mrt-fallback"?[J.COLOR_ATTACHMENT0,J.COLOR_ATTACHMENT1]:[J.COLOR_ATTACHMENT0]),this.renderedToTile=!1,Y.dirty&&(g.clear({color:i.ao.transparent,stencil:0}),Y.dirty=!1);for(let ae=E.start;ae<=E.end;++ae){const pe=d.style._mergedLayers[I[ae]];if(pe.isHidden(d.transform.zoom))continue;const _e=d.style.getLayerSourceCache(pe),me=_e?this.proxyToSource[j.key][_e.id]:[j];if(!me)continue;const Le=me;g.viewport.set([0,0,Y.fb.width,Y.fb.height]),oe!==(_e?_e.id:null)&&(this._setupStencil(Y,me,pe,_e),oe=_e?_e.id:null),d.renderLayer(d,_e,pe,Le)}if(J.drawBuffers([J.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const ae of this._pendingGroundEffectLayers){const pe=d.style._mergedLayers[I[ae]];if(pe.isHidden(d.transform.zoom))continue;const _e=d.style.getLayerSourceCache(pe),me=_e?this.proxyToSource[j.key][_e.id]:[j];if(!me)continue;const Le=me;g.viewport.set([0,0,Y.fb.width,Y.fb.height]),oe!==(_e?_e.id:null)&&(this._setupStencil(Y,me,pe,_e),oe=_e?_e.id:null),d.renderLayer(d,_e,pe,Le)}this.renderedToTile?(Y.dirty=!0,M.push(W.tileID)):te||--N,N===5&&(N=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,d.width,d.height]),E.end+1}postRender(){}isLayerOrderingCorrect(o){const d=o.order.length;let g=-1,b=d;for(let T=0;T<d;++T)this._style.isLayerDraped(o._mergedLayers[o.order[T]])?g=Math.max(g,T):b=Math.min(b,T);return b>g}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{o=Math.min(o,d.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,d,g){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(T=>T.dem).map(T=>{const E=T.tileID,I=1<<E.overscaledZ,{x:M,y:N}=E.canonical,j=M/I,W=(M+1)/I,Z=N/I,Y=(N+1)/I;return{minx:j,miny:Z,maxx:W,maxy:Y,t:T.dem.tree.raycastRoot(j,Z,W,Y,o,d,g),tile:T}});b.sort((T,E)=>(T.t!==null?T.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const T of b){if(T.t==null)return null;const E=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,o,d,g);if(E!=null)return E}return null}_createFBO(){const o=this.painter.context,d=o.gl,g=this.drapeBufferSize;o.activeTexture.set(d.TEXTURE0);const b=new i.T(o,{width:g[0],height:g[1],data:null},d.RGBA8);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);const T=o.createFramebuffer(g[0],g[1],1,null);let E;return T.colorAttachment0.set(b.texture),this._emissiveTexture&&(E=new i.T(o,{width:g[0],height:g[1],data:null},d.R8),E.bind(d.LINEAR,d.CLAMP_TO_EDGE),T.createColorAttachment(o,1),T.colorAttachment1.set(E.texture)),T.depthAttachment=new ZE(o,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:T,tex:b,emissiveTex:E,dirty:!1}}_updateFBOs(o){if(this._emissiveTexture!==o){for(const d of this.pool)this._updateFBO(d,o);for(const d of this.proxySourceCache.renderCache)this._updateFBO(d,o);this._emissiveTexture=o}}_updateFBO(o,d){const g=o.fb,b=this.painter.context,T=b.gl,E=this.drapeBufferSize;if(d){const I=new i.T(b,{width:E[0],height:E[1],data:null},T.R8);I.bind(T.LINEAR,T.CLAMP_TO_EDGE),o.emissiveTex=I,g.createColorAttachment(b,1),g.colorAttachment1.set(I.texture)}else o.emissiveTex=void 0,g.removeColorAttachment(b,1);o.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const d=this._style._mergedLayers[o],g=d.isHidden(this.painter.transform.zoom);return d.type==="hillshade"||d.type==="custom"?!g&&d.shouldRedrape():!g&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const g of this._style.getSources())if(g instanceof ju){o=!0;break}if(!o)return;const d={};for(let g=0;g<this._style.order.length;++g){const b=this._style._mergedLayers[this._style.order[g]],T=this._style.getLayerSourceCache(b);if(!T||d[T.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="line")continue;const E=b.widthExpression(),I=b.emissiveStrengthExpression();if(E instanceof i.ad||I instanceof i.ad){d[T.id]=!0;for(const M of this.proxyCoords){const N=this.proxyToSource[M.key][T.id];if(N)for(const j of N)this._clearRenderCacheForTile(T.id,j)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof po){o=!0;break}if(!o)return;const d={};for(let g=0;g<this._style.order.length;++g){const b=this._style._mergedLayers[this._style.order[g]],T=this._style.getLayerSourceCache(b);if(!T||d[T.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;const E=b.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const M=this.proxyToSource[I.key][T.id];if(M)for(const N of M){const j=cg(T.getTile(N),T.findLoadedParent(N,0),T,this.painter.transform,E);(j.opacity!==1||j.mix!==0)&&this._clearRenderCacheForTile(T.id,N)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const o=this._style.order,d=o.length;if(d===0)return;const g=[];this._pendingGroundEffectLayers=[];let b,T=0,E=this._style._mergedLayers[o[T]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++T<d;)E=this._style._mergedLayers[o[T]];for(;T<d;++T){const I=this._style._mergedLayers[o[T]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?b===void 0&&(b=T):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(T),b!==void 0&&(g.push({start:b,end:T-1}),b=void 0)))}if(b!==void 0&&g.push({start:b,end:T-1}),g.length!==0){const I=g[g.length-1];this._pendingGroundEffectLayers.every(M=>M>I.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(o){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const E=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let I=0;I<E.length;++I){const M=Object.values(E[I]);d.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,b=this._tilesDirty;for(let E=g.length-1;E>=0;E--){const I=g[E];if(d.getTileByID(I.key),d.proxyCachedFBO[I.key]!==void 0){const M=o[I.key],N=this.proxyToSource[I.key];let j=0;for(const W in N){const Z=N[W],Y=M[W];if(!Y||Y.length!==Z.length||Z.some((te,J)=>te!==Y[J]||b[W]&&b[W].hasOwnProperty(te.key))){j=-1;break}++j}for(const W in d.proxyCachedFBO[I.key])d.renderCache[d.proxyCachedFBO[I.key][W]].dirty=j<0||j!==Object.values(M).length}}const T=[...this._drapedRenderBatches];T.sort((E,I)=>I.end-I.start-(E.end-E.start));for(const E of T)for(const I of g){if(d.proxyCachedFBO[I.key])continue;let M=d.renderCachePool.pop();M===void 0&&d.renderCache.length<50&&(M=d.renderCache.length,d.renderCache.push(this._createFBO())),M!==void 0&&(d.proxyCachedFBO[I.key]={},d.proxyCachedFBO[I.key][E.start]=M,d.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(o,d,g,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,E=T.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let I;if(g.isTileClipped())I=d.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):Mr.disabled}_renderTileClippingMasks(o,d){const g=this.painter,b=this.painter.context,T=b.gl;g._tileClippingMaskIDs={},b.setColorMode(Vr.disabled),b.setDepthMode(Fn.disabled);const E=g.getOrCreateProgram("clippingMask");for(const I of o){const M=g._tileClippingMaskIDs[I.key]=--d;E.draw(g,T.TRIANGLES,Fn.disabled,new Mr({func:T.ALWAYS,mask:0},M,255,T.KEEP,T.KEEP,T.REPLACE),Vr.disabled,Rr.disabled,ug(I.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(o){const d=this.painter.transform;if(o.x<0||o.x>d.width||o.y<0||o.y>d.height)return null;const g=[o.x,o.y,1,1];i.aC(g,g,d.pixelMatrixInverse),i.cK(g,g,1/g[3]),g[0]/=d.worldSize,g[1]/=d.worldSize;const b=d._camera.position,T=i.cf(1,d.center.lat),E=[b[0],b[1],b[2]/T,0],I=i.da([],g.slice(0,3),E);i.aw(I,I);const M=this.raycast(E,I,this._exaggeration);return M!==null&&M?(i.bH(E,E,I,M),E[3]=E[2],E[2]*=T,E):null}_setupProxiedCoordsForOrtho(o,d,g){if(o.getSource()instanceof i.aU)return this._setupProxiedCoordsForImageSource(o,d,g);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const b=this.proxiedCoords[o.id]=[],T=this.proxyCoords;for(let M=0;M<T.length;M++){const N=T[M],j=this._findTileCoveringTileID(N,o);if(j){const W=this._createProxiedId(N,j,g[N.key]&&g[N.key][o.id]);b.push(W),this.proxyToSource[N.key][o.id]=[W]}}let E=!1;const I=new Set;for(let M=0;M<d.length;M++){const N=o.getTile(d[M]);if(!N||!N.hasData())continue;const j=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(j&&j.tileID.canonical.z!==N.tileID.canonical.z){const W=this.proxyToSource[j.tileID.key][o.id],Z=this._createProxiedId(j.tileID,N,g[j.tileID.key]&&g[j.tileID.key][o.id]);W?W.splice(W.length-1,0,Z):this.proxyToSource[j.tileID.key][o.id]=[Z];const Y=this.proxyToSource[j.tileID.key][o.id];I.has(Y)||I.add(Y),b.push(Z),E=!0}}if(this._sourceTilesOverlap[o.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const M of I)M.sort((N,j)=>j.overscaledZ-N.overscaledZ)}_setupProxiedCoordsForImageSource(o,d,g){if(!o.getSource().loaded())return;const b=this.proxiedCoords[o.id]=[],T=this.proxyCoords,E=o.getSource(),I=E.tileID;if(!I)return;const M=new i.P(I.x,I.y)._div(1<<I.z),N=E.coordinates.map(i.ae.fromLngLat).reduce((W,Z)=>(W.min.x=Math.min(W.min.x,Z.x-M.x),W.min.y=Math.min(W.min.y,Z.y-M.y),W.max.x=Math.max(W.max.x,Z.x-M.x),W.max.y=Math.max(W.max.y,Z.y-M.y),W),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),j=(W,Z)=>{const Y=W.wrap+W.canonical.x/(1<<W.canonical.z),te=W.canonical.y/(1<<W.canonical.z),J=i.al/(1<<W.canonical.z),oe=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),ae=Z.canonical.y/(1<<Z.canonical.z);return Y+J<oe+N.min.x||Y>oe+N.max.x||te+J<ae+N.min.y||te>ae+N.max.y};for(let W=0;W<T.length;W++){const Z=T[W];for(let Y=0;Y<d.length;Y++){const te=o.getTile(d[Y]);if(!te||!te.hasData()||j(Z,te.tileID))continue;const J=this._createProxiedId(Z,te,g[Z.key]&&g[Z.key][o.id]),oe=this.proxyToSource[Z.key][o.id];oe?oe.push(J):this.proxyToSource[Z.key][o.id]=[J],b.push(J)}}}_createProxiedId(o,d,g){let b=this.orthoMatrix;if(g){const T=g.find(E=>E.key===d.tileID.key);if(T)return T}if(d.tileID.key!==o.key){const T=o.canonical.z-d.tileID.canonical.z;let E,I,M;b=i.bC();const N=d.tileID.wrap-o.wrap<<o.overscaledZ;T>0?(E=i.al>>T,I=E*((d.tileID.canonical.x<<T)-o.canonical.x+N),M=E*((d.tileID.canonical.y<<T)-o.canonical.y)):(E=i.al<<-T,I=i.al*(d.tileID.canonical.x-(o.canonical.x+N<<-T)),M=i.al*(d.tileID.canonical.y-(o.canonical.y<<-T))),i.ce(b,0,E,0,E,0,1),i.br(b,b,[I,M,0])}return new xb(d.tileID,o.key,b)}_findTileCoveringTileID(o,d){let g=d.getTile(o);if(g&&g.hasData())return g;const b=this._findCoveringTileCache[d.id],T=b[o.key];if(g=T?d.getTileByID(T):null,g&&g.hasData()||T===null)return g;let E=g?g.tileID:o,I=E.overscaledZ;const M=d.getSource().minzoom,N=[];if(!T){const W=d.getSource().maxzoom;if(o.canonical.z>=W){const Z=o.canonical.z-W;d.getSource().reparseOverscaled?(I=Math.max(o.canonical.z+2,d.transform.tileZoom),E=new i.aQ(I,o.wrap,W,o.canonical.x>>Z,o.canonical.y>>Z)):Z!==0&&(I=W,E=new i.aQ(I,o.wrap,W,o.canonical.x>>Z,o.canonical.y>>Z))}E.key!==o.key&&(N.push(E.key),g=d.getTile(E))}const j=W=>{N.forEach(Z=>{b[Z]=W}),N.length=0};for(I-=1;I>=M&&(!g||!g.hasData());I--){g&&j(g.tileID.key);const W=E.calculateScaledKey(I);if(g=d.getTileByID(W),g&&g.hasData())break;const Z=b[W];if(Z===null)break;Z===void 0?N.push(W):g=d.getTileByID(Z)}return j(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,d){let g=this._tilesDirty[o];g||(g=this._tilesDirty[o]={}),g[d.key]=!0}}function tm(m,o,d){const g=function(I,M,N){const j=i.bJ(M,I),W=i.bJ(N,[.2126,.7152,.0722]),Z=(te,J,oe)=>(1-oe)*te+oe*J,Y=Z(1-.3*Math.min(W,1),1,Math.min(j+1,1));return Z(.92,1,Math.asin(i.aA(M[2],-1,1))/Math.PI+.5)*Y}(m,[0,0,1],o),b=[0,0,0];i.c5(b,d.slice(0,3),g);const T=[0,0,0];i.c5(T,o.slice(0,3),m[2]);const E=[0,0,0];return i.d8(E,b,T),i.db(E)}const AI=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],CI=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class WE{static cacheKey(o,d,g,b){const T=[d];b&&T.push(b.cacheKey);for(const E of g)o.usedDefines.has(E)&&T.push(E);return T.join("/")}constructor(o,d,g,b,T,E){const I=o.gl;this.program=I.createProgram(),this.configuration=b,this.name=d,this.fixedDefines=[...E];const M=`#version 300 es
${(b?b.defines():[]).concat(E.map(J=>`#define ${J}`)).join(`
`)}`,N=[M,_I];for(const J of g.fragmentIncludes)N.push(Dh[J]);N.push(g.fragmentSource);const j=N.join(`
`),W=[M,FE];for(const J of g.vertexIncludes)W.push(Dh[J]);this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&g.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&W.push("uniform int u_instanceID;"),W.push(g.vertexSource);let Z=W.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(Z=Z.replaceAll("gl_InstanceID","u_instanceID"));const Y=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(Y,j),I.compileShader(Y),I.attachShader(this.program,Y);const te=I.createShader(I.VERTEX_SHADER);I.isContextLost()?this.failedToCreate=!0:(I.shaderSource(te,Z),I.compileShader(te),I.attachShader(this.program,te),this.attributes={},I.linkProgram(this.program),I.deleteShader(te),I.deleteShader(Y),this.fixedUniforms=T(o),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=b?b.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(J=>({u_instanceID:new i.ch(J)}))(o)),(E.includes("TERRAIN")||d.includes("symbol")||d.includes("circle"))&&(this.terrainUniforms=(J=>({u_dem:new i.ch(J),u_dem_prev:new i.ch(J),u_dem_tl:new i.ck(J),u_dem_scale:new i.cj(J),u_dem_tl_prev:new i.ck(J),u_dem_scale_prev:new i.cj(J),u_dem_size:new i.cj(J),u_dem_lerp:new i.cj(J),u_exaggeration:new i.cj(J),u_depth:new i.ch(J),u_depth_size_inv:new i.ck(J),u_depth_range_unpack:new i.ck(J),u_occluder_half_size:new i.cj(J),u_occlusion_depth_offset:new i.cj(J),u_meter_to_dem:new i.cj(J),u_label_plane_matrix_inv:new i.cl(J)}))(o)),E.includes("GLOBE")&&(this.globeUniforms=(J=>({u_tile_tl_up:new i.ci(J),u_tile_tr_up:new i.ci(J),u_tile_br_up:new i.ci(J),u_tile_bl_up:new i.ci(J),u_tile_up_scale:new i.cj(J)}))(o)),E.includes("FOG")&&(this.fogUniforms=(J=>({u_fog_matrix:new i.cl(J),u_fog_range:new i.ck(J),u_fog_color:new i.d3(J),u_fog_horizon_blend:new i.cj(J),u_fog_vertical_limit:new i.ck(J),u_fog_temporal_offset:new i.cj(J),u_frustum_tl:new i.ci(J),u_frustum_tr:new i.ci(J),u_frustum_br:new i.ci(J),u_frustum_bl:new i.ci(J),u_globe_pos:new i.ci(J),u_globe_radius:new i.cj(J),u_globe_transition:new i.cj(J),u_is_globe:new i.ch(J),u_viewport:new i.ck(J)}))(o)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(J=>({u_cutoff_params:new i.d3(J)}))(o)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(J=>({u_lighting_ambient_color:new i.ci(J),u_lighting_directional_dir:new i.ci(J),u_lighting_directional_color:new i.ci(J),u_ground_radiance:new i.ci(J)}))(o)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(J=>({u_light_matrix_0:new i.cl(J),u_light_matrix_1:new i.cl(J),u_fade_range:new i.ck(J),u_shadow_normal_offset:new i.ci(J),u_shadow_intensity:new i.cj(J),u_shadow_texel_size:new i.cj(J),u_shadow_map_resolution:new i.cj(J),u_shadow_direction:new i.ci(J),u_shadow_bias:new i.ci(J),u_shadowmap_0:new i.ch(J),u_shadowmap_1:new i.ch(J)}))(o)))}getAttributeLocation(o,d){let g=this.attributes[d];return g===void 0&&(g=this.attributes[d]=o.getAttribLocation(this.program,d)),g}setTerrainUniformValues(o,d){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in d)g[b]&&g[b].set(this.program,b,d[b])}}setGlobeUniformValues(o,d){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in d)g[b]&&g[b].set(this.program,b,d[b])}}setFogUniformValues(o,d){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in d)g[b].set(this.program,b,d[b])}}setCutoffUniformValues(o,d){if(!this.cutoffUniforms)return;const g=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in d)g[b].set(this.program,b,d[b])}}setLightsUniformValues(o,d){if(!this.lightsUniforms)return;const g=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in d)g[b].set(this.program,b,d[b])}}setShadowUniformValues(o,d){if(this.failedToCreate||!this.shadowUniforms)return;const g=this.shadowUniforms;o.program.set(this.program);for(const b in d)g[b].set(this.program,b,d[b])}_drawDebugWireframe(o,d,g,b,T,E,I,M,N,j){const W=o.options.wireframe;if(W.terrain===!1&&W.layers2D===!1&&W.layers3D===!1)return;const Z=o.context;if(!(!(!W.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!W.layers2D||o._terrain&&o._terrain.renderingToTexture||!AI.includes(this.name))||!(!W.layers3D||!CI.includes(this.name))))return;const Y=Z.gl,te=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,T,Z);if(!te)return;const J=[...this.fixedDefines,"DEBUG_WIREFRAME"],oe=o.getOrCreateProgram(this.name,{config:this.configuration,defines:J});Z.program.set(oe.program);const ae=(me,Le,Ce)=>{if(Le[me]&&Ce[me])for(const Re in Le[me])Ce[me][Re]&&Ce[me][Re].set(Ce.program,Re,Le[me][Re].current)};N&&N.setUniforms(oe.program,Z,oe.binderUniforms,I,{zoom:M}),ae("fixedUniforms",this,oe),ae("terrainUniforms",this,oe),ae("globeUniforms",this,oe),ae("fogUniforms",this,oe),ae("lightsUniforms",this,oe),ae("shadowUniforms",this,oe),te.bind(),Z.setColorMode(new Vr([Y.ONE,Y.ONE_MINUS_SRC_ALPHA,Y.ZERO,Y.ONE],i.ao.transparent,[!0,!0,!0,!1])),Z.setDepthMode(new Fn(d.func===Y.LESS?Y.LEQUAL:d.func,Fn.ReadOnly,d.range)),Z.setStencilMode(Mr.disabled);const pe=3*E.primitiveLength*2,_e=3*E.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const me=j||1;for(let Le=0;Le<me;++Le)oe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Le),Y.drawElements(Y.LINES,pe,Y.UNSIGNED_SHORT,_e)}else j&&j>1?Y.drawElementsInstanced(Y.LINES,pe,Y.UNSIGNED_SHORT,_e,j):Y.drawElements(Y.LINES,pe,Y.UNSIGNED_SHORT,_e);T.bind(),Z.program.set(this.program),Z.setDepthMode(d),Z.setStencilMode(g),Z.setColorMode(b)}checkUniforms(o,d,g){if(this.fixedDefines.includes(d)){for(const b of Object.keys(g))if(!g[b].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${b} not set but required by ${d} being defined`)}}draw(o,d,g,b,T,E,I,M,N,j,W,Z,Y,te,J,oe){const ae=o.context,pe=ae.gl;if(this.failedToCreate)return;ae.program.set(this.program),ae.setDepthMode(g),ae.setStencilMode(b),ae.setColorMode(T),ae.setCullFace(E);for(const[Ae,Te]of this.fixedUniformsEntries)Te.set(this.program,Ae,I[Ae]);te&&te.setUniforms(this.program,ae,this.binderUniforms,Z,{zoom:Y});const _e={[pe.POINTS]:1,[pe.LINES]:2,[pe.TRIANGLES]:3,[pe.LINE_STRIP]:1}[d];this.checkUniforms(M,"RENDER_SHADOWS",this.shadowUniforms);const me=J||[],Le=te?te.getPaintVertexBuffers():[],Ce=d===pe.TRIANGLES&&j,Re=oe&&oe>0?1:void 0;for(const Ae of W.get()){const Te=Ae.vaos||(Ae.vaos={});if((Te[M]||(Te[M]=new yI)).bind(ae,this,N,Le,j,Ae.vertexOffset,me,Re),this.forceManualRenderingForInstanceIDShaders){const ze=oe||1;for(let We=0;We<ze;++We)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",We),j?pe.drawElements(d,Ae.primitiveLength*_e,pe.UNSIGNED_SHORT,Ae.primitiveOffset*_e*2):pe.drawArrays(d,Ae.vertexOffset,Ae.vertexLength)}else oe&&oe>1?pe.drawElementsInstanced(d,Ae.primitiveLength*_e,pe.UNSIGNED_SHORT,Ae.primitiveOffset*_e*2,oe):j?pe.drawElements(d,Ae.primitiveLength*_e,pe.UNSIGNED_SHORT,Ae.primitiveOffset*_e*2):pe.drawArrays(d,Ae.vertexOffset,Ae.vertexLength);Ce&&this._drawDebugWireframe(o,g,b,T,j,Ae,Z,Y,te,oe)}}}function XE(m,o,d=0){const g=Math.pow(2,o.tileID.overscaledZ),b=o.tileSize*Math.pow(2,m.transform.tileZoom)/g,T=b*(o.tileID.canonical.x+o.tileID.wrap*g),E=b*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.ay(o,1,m.transform.tileZoom),u_pixel_coord_upper:[T>>16,E>>16],u_pixel_coord_lower:[65535&T,65535&E],u_pattern_transition:d}}const Ly={terrain:0,flat:1},kI=i.bC(),Dy=(m,o,d,g,b,T,E,I,M,N,j,W,Z,Y,te,J,oe,ae)=>{const pe=o.style.light,_e=pe.properties.get("position"),me=[_e.x,_e.y,_e.z],Le=i.dO();pe.properties.get("anchor")==="viewport"&&(i.dP(Le,-o.transform.angle),i.dQ(me,me,Le));const Ce=pe.properties.get("color").toPremultipliedRenderColor(null),Re=o.transform,Ae={u_matrix:m,u_lightpos:me,u_lightintensity:pe.properties.get("intensity"),u_lightcolor:[Ce.r,Ce.g,Ce.b],u_vertical_gradient:+d,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:kI,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Ly[N],u_base_type:Ly[j],u_ao:b,u_edge_radius:T,u_width_scale:E,u_flood_light_color:te,u_vertical_scale:J,u_flood_light_intensity:oe,u_ground_shadow_factor:ae};return Re.projection.name==="globe"&&(Ae.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],Ae.u_zoom_transition=W,Ae.u_inv_rot_matrix=Y,Ae.u_merc_center=Z,Ae.u_up_dir=Re.projection.upVector(new i.cD(0,0,0),Z[0]*i.al,Z[1]*i.al),Ae.u_height_lift=M),Ae},wb=(m,o,d,g,b,T)=>({u_matrix:m,u_edge_radius:o,u_width_scale:d,u_vertical_scale:g,u_height_type:Ly[b],u_base_type:Ly[T]}),YE=(m,o,d,g,b,T,E,I,M,N,j,W,Z,Y,te,J,oe,ae)=>{const pe=Dy(m,o,d,g,b,T,E,I,N,j,W,Z,Y,te,J,oe,1,[0,0,0]),_e={u_height_factor:-Math.pow(2,I.overscaledZ)/M.tileSize/8};return Object.assign(pe,XE(o,M,ae),_e)},nm=(m,o,d,g,b,T,E,I,M,N,j)=>({u_matrix:o,u_opacity:d,u_ao_pass:g?1:0,u_meter_to_tile:b,u_ao:T,u_flood_light_intensity:E,u_flood_light_color:I,u_attenuation:M,u_edge_radius:N,u_fb:0,u_fb_size:j,u_dynamic_offset:1}),Tb=(m,o,d)=>({u_matrix:m,u_emissive_strength:o,u_ground_shadow_factor:d}),Eb=(m,o,d,g,b,T=0)=>Object.assign(Tb(m,o,b),XE(d,g,T)),KE=(m,o,d,g)=>({u_matrix:m,u_world:d,u_emissive_strength:o,u_ground_shadow_factor:g}),Sb=(m,o,d,g,b,T,E=0)=>Object.assign(Eb(m,o,d,g,T,E),{u_world:b}),zh=(m,o)=>({u_matrix:m,u_ground_shadow_factor:o}),jf=(m,o,d,g,b)=>({u_matrix:m,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:d,u_height_scale:g,u_reset_depth:b}),Ny=(m,o,d,g,b,T,E,I,M)=>({u_matrix:m,u_normal_matrix:o,u_opacity:d,u_faux_facade_ao_intensity:g,u_camera_pos:b,u_tile_to_meter:T,u_facade_emissive_chance:E,u_flood_light_color:I,u_flood_light_intensity:M}),QE=m=>({u_matrix:m}),Fh=m=>({u_matrix:m}),Ab=(m,o,d,g,b,T,E,I)=>{const M=i.al/T.tileSize;return{u_matrix:m,u_inv_rot_matrix:o,u_camera_to_center_distance:d.getCameraToCenterDistance(I),u_extrude_scale:[d.pixelsToGLUnits[0]/M,d.pixelsToGLUnits[1]/M],u_zoom_transition:g,u_tile_id:E,u_merc_center:b}},dg=(m,o,d=1)=>({u_matrix:m,u_color:o,u_overlay:0,u_overlay_scale:d}),JE=i.bC(),eS=(m,o,d,g,b,T,E)=>{const I=m.transform,M=I.projection.name==="globe",N=M?i.dR(I.zoom,o.canonical)*I._pixelsPerMercatorPixel:i.ay(d,1,T),j={u_matrix:o.projMatrix,u_extrude_scale:N,u_intensity:E,u_inv_rot_matrix:JE,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){j.u_inv_rot_matrix=g,j.u_merc_center=b,j.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],j.u_zoom_transition=i.aj(I.zoom);const W=b[0]*i.al,Z=b[1]*i.al;j.u_up_dir=I.projection.upVector(new i.cD(0,0,0),W,Z)}return j};function zy(m,[o,d,g,b],[T,E]){if(T===E)return[0,0,0,0];const I=255*(m-1)/(m*(E-T));return[o*I,d*I,g*I,b*I]}function Fy(m,o,[d,g]){return d===g?0:.5/m+(o-d)*(m-1)/(m*(g-d))}const tS=(m,o,d,g,b,T,E,I,M,N,j,W,Z,Y,te,J,oe,ae,pe,_e,me)=>({u_matrix:m,u_normalize_matrix:o,u_globe_matrix:d,u_merc_matrix:g,u_grid_matrix:b,u_tl_parent:T,u_scale_parent:N,u_fade_t:j.mix,u_opacity:j.opacity*W.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:W.paint.get("raster-brightness-min"),u_brightness_high:W.paint.get("raster-brightness-max"),u_saturation_factor:i.dT(W.paint.get("raster-saturation")),u_contrast_factor:i.dS(W.paint.get("raster-contrast")),u_spin_weights:nS(W.paint.get("raster-hue-rotate")),u_perspective_transform:Z,u_raster_elevation:Y,u_zoom_transition:E,u_merc_center:I,u_cutoff_params:M,u_colorization_mix:zy(i.dU,J,ae),u_colorization_offset:Fy(i.dU,oe,ae),u_color_ramp:te,u_texture_offset:[_e/(pe+2*_e),pe/(pe+2*_e)],u_texture_res:[pe+2*_e,pe+2*_e],u_emissive_strength:me});function nS(m){m*=Math.PI/180;const o=Math.sin(m),d=Math.cos(m);return[(2*d+1)/3,(-Math.sqrt(3)*o-d+1)/3,(Math.sqrt(3)*o-d+1)/3]}const nd=.05,II=(m,o,d,g,b,T,E,I,M,N,j,W)=>({u_matrix:m,u_normalize_matrix:o,u_globe_matrix:d,u_merc_matrix:g,u_grid_matrix:b,u_tl_parent:T,u_scale_parent:N,u_fade_t:j.mix,u_opacity:j.opacity,u_image0:0,u_image1:1,u_raster_elevation:W,u_zoom_transition:E,u_merc_center:I,u_cutoff_params:M}),RI=(m,o,d,g,b,T,E,I,M,N)=>({u_particle_texture:m,u_particle_texture_side_len:o,u_tile_offset:d,u_velocity:g,u_color_ramp:T,u_velocity_res:b,u_max_speed:E,u_uv_offset:I,u_data_scale:[255*M[0],255*M[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[nd,nd]}),rS=(m,o,d,g,b,T,E,I,M,N)=>({u_particle_texture:m,u_particle_texture_side_len:o,u_velocity:d,u_velocity_res:g,u_max_speed:b,u_speed_factor:T,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*M[0],255*M[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[nd,nd]}),iS=i.bC(),By=(m,o,d,g,b,T,E,I,M,N,j,W,Z,Y,te,J,oe,ae,pe,_e,me,Le,Ce,Re)=>{const Ae=b.transform,Te={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:Ae.getCameraToCenterDistance(pe),u_rotate_symbol:+d,u_aspect_ratio:Ae.width/Ae.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:E,u_coord_matrix:I,u_is_text:+N,u_elevation_from_sea:M?1:0,u_pitch_with_map:+g,u_texsize:j,u_texsize_icon:W,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:iS,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:iS,u_up_vector:[0,-1,0],u_color_adj_mat:Le,u_icon_transition:Ce||0,u_gamma_scale:g?b.transform.getCameraToCenterDistance(pe)*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:i.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Re||1,u_ground_shadow_factor:_e,u_inv_matrix:i.bl(i.bC(),E),u_normal_scale:me,u_lutTexture:Mo.LUT};return pe.name==="globe"&&(Te.u_tile_id=[Y.canonical.x,Y.canonical.y,1<<Y.canonical.z],Te.u_zoom_transition=te,Te.u_inv_rot_matrix=oe,Te.u_merc_center=J,Te.u_camera_forward=Ae._camera.forward(),Te.u_ecef_origin=i.dV(Ae.globeMatrix,Y.toUnwrapped()),Te.u_tile_matrix=Float32Array.from(Ae.globeMatrix),Te.u_up_vector=ae),Te},hg=(m,o,d,g)=>({u_matrix:m,u_emissive_strength:o,u_opacity:d,u_color:g}),Bh=(m,o,d,g,b,T,E,I,M)=>Object.assign(function(N,j,W,Z,Y,te){const{width:J,height:oe}=Z.imageManager.getPixelSize(j),ae=Math.pow(2,te.tileID.overscaledZ),pe=te.tileSize*Math.pow(2,Z.transform.tileZoom)/ae,_e=pe*(te.tileID.canonical.x+te.tileID.wrap*ae),me=pe*te.tileID.canonical.y;return{u_image:0,u_pattern_tl:W.tl,u_pattern_br:W.br,u_texsize:[J,oe],u_pattern_size:W.displaySize,u_pattern_units_to_pixels:Y?[Z.transform.width,-1*Z.transform.height]:[1/i.ay(te,1,Z.transform.tileZoom),1/i.ay(te,1,Z.transform.tileZoom)],u_pixel_coord_upper:[_e>>16,me>>16],u_pixel_coord_lower:[65535&_e,65535&me]}}(0,T,E,g,I,M),{u_matrix:m,u_emissive_strength:o,u_opacity:d}),rm=new Float32Array(i.bA([])),Uf=(m,o,d,g,b,T,E,I,M,N,j,W,Z,Y=[0,0,0],te,J,oe)=>{const ae=b.style.light,pe=ae.properties.get("position"),_e=[-pe.x,-pe.y,pe.z],me=i.dO();ae.properties.get("anchor")==="viewport"&&(i.dP(me,-b.transform.angle),i.dQ(_e,_e,me));const Le=j.alphaMode==="MASK",Ce=ae.properties.get("color").toNonPremultipliedRenderColor(null),Re=Z.paint.get("model-ambient-occlusion-intensity"),Ae=Z.paint.get("model-color").constantOr(i.ao.white).toNonPremultipliedRenderColor(null);return Ae.a=Z.paint.get("model-color-mix-intensity").constantOr(0),oe&&(Ae.r=oe[0],Ae.g=oe[1],Ae.b=oe[2],Ae.a=oe[3]),J&&(Ae.r=J.color.r,Ae.g=J.color.g,Ae.b=J.color.b,Ae.a=J.colorMix,W=J.emissionStrength,T*=J.opacity),{u_matrix:m,u_lighting_matrix:o,u_normal_matrix:d,u_node_matrix:g||rm,u_lightpos:_e,u_lightintensity:ae.properties.get("intensity"),u_lightcolor:[Ce.r,Ce.g,Ce.b],u_camera_pos:Y,u_opacity:T,u_baseTextureIsAlpha:0,u_alphaMask:+Le,u_alphaCutoff:j.alphaCutoff,u_baseColorFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:I.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:M,u_roughnessFactor:N,u_baseColorTexture:Mo.BaseColor,u_metallicRoughnessTexture:Mo.MetallicRoughness,u_normalTexture:Mo.Normal,u_occlusionTexture:Mo.Occlusion,u_emissionTexture:Mo.Emission,u_lutTexture:Mo.LUT,u_color_mix:Ae.toArray01(),u_aoIntensity:Re,u_emissive_strength:W,u_occlusionTextureTransform:te||[0,0,0,0]}},Cb=(m,o=rm,d=rm)=>({u_matrix:m,u_instance:o,u_node_matrix:d}),jy={fillExtrusion:m=>({u_matrix:new i.cl(m),u_lightpos:new i.ci(m),u_lightintensity:new i.cj(m),u_lightcolor:new i.ci(m),u_vertical_gradient:new i.cj(m),u_opacity:new i.cj(m),u_edge_radius:new i.cj(m),u_width_scale:new i.cj(m),u_ao:new i.ck(m),u_height_type:new i.ch(m),u_base_type:new i.ch(m),u_tile_id:new i.ci(m),u_zoom_transition:new i.cj(m),u_inv_rot_matrix:new i.cl(m),u_merc_center:new i.ck(m),u_up_dir:new i.ci(m),u_height_lift:new i.cj(m),u_flood_light_color:new i.ci(m),u_vertical_scale:new i.cj(m),u_flood_light_intensity:new i.cj(m),u_ground_shadow_factor:new i.ci(m)}),fillExtrusionDepth:m=>({u_matrix:new i.cl(m),u_edge_radius:new i.cj(m),u_width_scale:new i.cj(m),u_vertical_scale:new i.cj(m),u_height_type:new i.ch(m),u_base_type:new i.ch(m)}),fillExtrusionPattern:m=>({u_matrix:new i.cl(m),u_lightpos:new i.ci(m),u_lightintensity:new i.cj(m),u_lightcolor:new i.ci(m),u_vertical_gradient:new i.cj(m),u_height_factor:new i.cj(m),u_edge_radius:new i.cj(m),u_width_scale:new i.cj(m),u_ao:new i.ck(m),u_height_type:new i.ch(m),u_base_type:new i.ch(m),u_tile_id:new i.ci(m),u_zoom_transition:new i.cj(m),u_inv_rot_matrix:new i.cl(m),u_merc_center:new i.ck(m),u_up_dir:new i.ci(m),u_height_lift:new i.cj(m),u_image:new i.ch(m),u_texsize:new i.ck(m),u_pixel_coord_upper:new i.ck(m),u_pixel_coord_lower:new i.ck(m),u_tile_units_to_pixels:new i.cj(m),u_opacity:new i.cj(m),u_pattern_transition:new i.cj(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new i.cl(m),u_opacity:new i.cj(m),u_ao_pass:new i.cj(m),u_meter_to_tile:new i.cj(m),u_ao:new i.ck(m),u_flood_light_intensity:new i.cj(m),u_flood_light_color:new i.ci(m),u_attenuation:new i.cj(m),u_edge_radius:new i.cj(m),u_fb:new i.ch(m),u_fb_size:new i.cj(m),u_dynamic_offset:new i.cj(m)}),fill:m=>({u_matrix:new i.cl(m),u_emissive_strength:new i.cj(m),u_ground_shadow_factor:new i.ci(m)}),fillPattern:m=>({u_matrix:new i.cl(m),u_emissive_strength:new i.cj(m),u_image:new i.ch(m),u_texsize:new i.ck(m),u_pixel_coord_upper:new i.ck(m),u_pixel_coord_lower:new i.ck(m),u_tile_units_to_pixels:new i.cj(m),u_ground_shadow_factor:new i.ci(m),u_pattern_transition:new i.cj(m)}),fillOutline:m=>({u_matrix:new i.cl(m),u_emissive_strength:new i.cj(m),u_world:new i.ck(m),u_ground_shadow_factor:new i.ci(m)}),fillOutlinePattern:m=>({u_matrix:new i.cl(m),u_emissive_strength:new i.cj(m),u_world:new i.ck(m),u_image:new i.ch(m),u_texsize:new i.ck(m),u_pixel_coord_upper:new i.ck(m),u_pixel_coord_lower:new i.ck(m),u_tile_units_to_pixels:new i.cj(m),u_ground_shadow_factor:new i.ci(m),u_pattern_transition:new i.cj(m)}),building:m=>({u_matrix:new i.cl(m),u_normal_matrix:new i.cl(m),u_opacity:new i.cj(m),u_faux_facade_ao_intensity:new i.cj(m),u_camera_pos:new i.ci(m),u_tile_to_meter:new i.cj(m),u_facade_emissive_chance:new i.cj(m),u_flood_light_color:new i.ci(m),u_flood_light_intensity:new i.cj(m)}),buildingBloom:m=>({u_matrix:new i.cl(m)}),buildingDepth:m=>({u_matrix:new i.cl(m)}),elevatedStructuresDepth:m=>({u_matrix:new i.cl(m),u_depth_bias:new i.cj(m)}),elevatedStructures:m=>({u_matrix:new i.cl(m),u_ground_shadow_factor:new i.ci(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new i.cl(m),u_camera_pos:new i.ci(m),u_depth_bias:new i.cj(m),u_height_scale:new i.cj(m),u_reset_depth:new i.cj(m)}),circle:i.dY,collisionBox:m=>({u_matrix:new i.cl(m),u_inv_rot_matrix:new i.cl(m),u_camera_to_center_distance:new i.cj(m),u_extrude_scale:new i.ck(m),u_zoom_transition:new i.cj(m),u_merc_center:new i.ck(m),u_tile_id:new i.ci(m)}),collisionCircle:m=>({u_matrix:new i.cl(m),u_inv_matrix:new i.cl(m),u_camera_to_center_distance:new i.cj(m),u_viewport_size:new i.ck(m)}),debug:m=>({u_color:new i.dB(m),u_matrix:new i.cl(m),u_overlay:new i.ch(m),u_overlay_scale:new i.cj(m)}),clippingMask:m=>({u_matrix:new i.cl(m)}),heatmap:m=>({u_extrude_scale:new i.cj(m),u_intensity:new i.cj(m),u_matrix:new i.cl(m),u_inv_rot_matrix:new i.cl(m),u_merc_center:new i.ck(m),u_tile_id:new i.ci(m),u_zoom_transition:new i.cj(m),u_up_dir:new i.ci(m)}),heatmapTexture:m=>({u_image:new i.ch(m),u_color_ramp:new i.ch(m),u_opacity:new i.cj(m)}),hillshade:m=>({u_matrix:new i.cl(m),u_image:new i.ch(m),u_latrange:new i.ck(m),u_light:new i.ck(m),u_shadow:new i.dB(m),u_highlight:new i.dB(m),u_emissive_strength:new i.cj(m),u_accent:new i.dB(m)}),hillshadePrepare:m=>({u_matrix:new i.cl(m),u_image:new i.ch(m),u_dimension:new i.ck(m),u_zoom:new i.cj(m)}),line:i.dX,linePattern:i.dW,raster:m=>({u_matrix:new i.cl(m),u_normalize_matrix:new i.cl(m),u_globe_matrix:new i.cl(m),u_merc_matrix:new i.cl(m),u_grid_matrix:new i.dC(m),u_tl_parent:new i.ck(m),u_scale_parent:new i.cj(m),u_fade_t:new i.cj(m),u_opacity:new i.cj(m),u_image0:new i.ch(m),u_image1:new i.ch(m),u_brightness_low:new i.cj(m),u_brightness_high:new i.cj(m),u_saturation_factor:new i.cj(m),u_contrast_factor:new i.cj(m),u_spin_weights:new i.ci(m),u_perspective_transform:new i.ck(m),u_raster_elevation:new i.cj(m),u_zoom_transition:new i.cj(m),u_merc_center:new i.ck(m),u_cutoff_params:new i.d3(m),u_colorization_mix:new i.d3(m),u_colorization_offset:new i.cj(m),u_color_ramp:new i.ch(m),u_texture_offset:new i.ck(m),u_texture_res:new i.ck(m),u_emissive_strength:new i.cj(m)}),rasterParticle:m=>({u_matrix:new i.cl(m),u_normalize_matrix:new i.cl(m),u_globe_matrix:new i.cl(m),u_merc_matrix:new i.cl(m),u_grid_matrix:new i.dC(m),u_tl_parent:new i.ck(m),u_scale_parent:new i.cj(m),u_fade_t:new i.cj(m),u_opacity:new i.cj(m),u_image0:new i.ch(m),u_image1:new i.ch(m),u_raster_elevation:new i.cj(m),u_zoom_transition:new i.cj(m),u_merc_center:new i.ck(m),u_cutoff_params:new i.d3(m)}),rasterParticleTexture:m=>({u_texture:new i.ch(m),u_opacity:new i.cj(m)}),rasterParticleDraw:m=>({u_particle_texture:new i.ch(m),u_particle_texture_side_len:new i.cj(m),u_tile_offset:new i.ck(m),u_velocity:new i.ch(m),u_color_ramp:new i.ch(m),u_velocity_res:new i.ck(m),u_max_speed:new i.cj(m),u_uv_offset:new i.ck(m),u_data_scale:new i.ck(m),u_data_offset:new i.cj(m),u_particle_pos_scale:new i.cj(m),u_particle_pos_offset:new i.ck(m)}),rasterParticleUpdate:m=>({u_particle_texture:new i.ch(m),u_particle_texture_side_len:new i.cj(m),u_velocity:new i.ch(m),u_velocity_res:new i.ck(m),u_max_speed:new i.cj(m),u_speed_factor:new i.cj(m),u_reset_rate:new i.cj(m),u_rand_seed:new i.cj(m),u_uv_offset:new i.ck(m),u_data_scale:new i.ck(m),u_data_offset:new i.cj(m),u_particle_pos_scale:new i.cj(m),u_particle_pos_offset:new i.ck(m)}),symbol:m=>({u_is_size_zoom_constant:new i.ch(m),u_is_size_feature_constant:new i.ch(m),u_size_t:new i.cj(m),u_size:new i.cj(m),u_camera_to_center_distance:new i.cj(m),u_rotate_symbol:new i.ch(m),u_aspect_ratio:new i.cj(m),u_fade_change:new i.cj(m),u_matrix:new i.cl(m),u_label_plane_matrix:new i.cl(m),u_coord_matrix:new i.cl(m),u_is_text:new i.ch(m),u_elevation_from_sea:new i.ch(m),u_pitch_with_map:new i.ch(m),u_texsize:new i.ck(m),u_texsize_icon:new i.ck(m),u_texture:new i.ch(m),u_texture_icon:new i.ch(m),u_gamma_scale:new i.cj(m),u_device_pixel_ratio:new i.cj(m),u_tile_id:new i.ci(m),u_zoom_transition:new i.cj(m),u_inv_rot_matrix:new i.cl(m),u_merc_center:new i.ck(m),u_camera_forward:new i.ci(m),u_tile_matrix:new i.cl(m),u_up_vector:new i.ci(m),u_ecef_origin:new i.ci(m),u_is_halo:new i.ch(m),u_icon_transition:new i.cj(m),u_color_adj_mat:new i.cl(m),u_scale_factor:new i.cj(m),u_ground_shadow_factor:new i.ci(m),u_inv_matrix:new i.cl(m),u_normal_scale:new i.cj(m),u_lutTexture:new i.ch(m)}),background:m=>({u_matrix:new i.cl(m),u_emissive_strength:new i.cj(m),u_opacity:new i.cj(m),u_color:new i.dB(m)}),backgroundPattern:m=>({u_matrix:new i.cl(m),u_emissive_strength:new i.cj(m),u_opacity:new i.cj(m),u_image:new i.ch(m),u_pattern_tl:new i.ck(m),u_pattern_br:new i.ck(m),u_texsize:new i.ck(m),u_pattern_size:new i.ck(m),u_pixel_coord_upper:new i.ck(m),u_pixel_coord_lower:new i.ck(m),u_pattern_units_to_pixels:new i.ck(m)}),terrainRaster:m=>({u_matrix:new i.cl(m),u_image0:new i.ch(m),u_image1:new i.ch(m),u_skirt_height:new i.cj(m),u_ground_shadow_factor:new i.ci(m),u_emissive_texture_available:new i.cj(m)}),skybox:m=>({u_matrix:new i.cl(m),u_sun_direction:new i.ci(m),u_cubemap:new i.ch(m),u_opacity:new i.cj(m),u_temporal_offset:new i.cj(m)}),skyboxGradient:m=>({u_matrix:new i.cl(m),u_color_ramp:new i.ch(m),u_center_direction:new i.ci(m),u_radius:new i.cj(m),u_opacity:new i.cj(m),u_temporal_offset:new i.cj(m)}),skyboxCapture:m=>({u_matrix_3f:new i.dC(m),u_sun_direction:new i.ci(m),u_sun_intensity:new i.cj(m),u_color_tint_r:new i.d3(m),u_color_tint_m:new i.d3(m),u_luminance:new i.cj(m)}),globeRaster:m=>({u_proj_matrix:new i.cl(m),u_globe_matrix:new i.cl(m),u_normalize_matrix:new i.cl(m),u_merc_matrix:new i.cl(m),u_zoom_transition:new i.cj(m),u_merc_center:new i.ck(m),u_image0:new i.ch(m),u_image1:new i.ch(m),u_grid_matrix:new i.dC(m),u_skirt_height:new i.cj(m),u_far_z_cutoff:new i.cj(m),u_frustum_tl:new i.ci(m),u_frustum_tr:new i.ci(m),u_frustum_br:new i.ci(m),u_frustum_bl:new i.ci(m),u_globe_pos:new i.ci(m),u_globe_radius:new i.cj(m),u_viewport:new i.ck(m),u_emissive_texture_available:new i.cj(m)}),globeAtmosphere:m=>({u_frustum_tl:new i.ci(m),u_frustum_tr:new i.ci(m),u_frustum_br:new i.ci(m),u_frustum_bl:new i.ci(m),u_horizon:new i.cj(m),u_transition:new i.cj(m),u_fadeout_range:new i.cj(m),u_atmosphere_fog_color:new i.d3(m),u_high_color:new i.d3(m),u_space_color:new i.d3(m),u_temporal_offset:new i.cj(m),u_horizon_angle:new i.cj(m)}),model:m=>({u_matrix:new i.cl(m),u_lighting_matrix:new i.cl(m),u_normal_matrix:new i.cl(m),u_node_matrix:new i.cl(m),u_lightpos:new i.ci(m),u_lightintensity:new i.cj(m),u_lightcolor:new i.ci(m),u_camera_pos:new i.ci(m),u_opacity:new i.cj(m),u_baseColorFactor:new i.d3(m),u_emissiveFactor:new i.d3(m),u_metallicFactor:new i.cj(m),u_roughnessFactor:new i.cj(m),u_baseTextureIsAlpha:new i.ch(m),u_alphaMask:new i.ch(m),u_alphaCutoff:new i.cj(m),u_baseColorTexture:new i.ch(m),u_metallicRoughnessTexture:new i.ch(m),u_normalTexture:new i.ch(m),u_occlusionTexture:new i.ch(m),u_emissionTexture:new i.ch(m),u_lutTexture:new i.ch(m),u_color_mix:new i.d3(m),u_aoIntensity:new i.cj(m),u_emissive_strength:new i.cj(m),u_occlusionTextureTransform:new i.d3(m)}),modelDepth:m=>({u_matrix:new i.cl(m),u_instance:new i.cl(m),u_node_matrix:new i.cl(m)}),groundShadow:m=>({u_matrix:new i.cl(m),u_ground_shadow_factor:new i.ci(m)}),stars:m=>({u_matrix:new i.cl(m),u_up:new i.ci(m),u_right:new i.ci(m),u_intensity_multiplier:new i.cj(m)}),snowParticle:m=>({u_modelview:new i.cl(m),u_projection:new i.cl(m),u_time:new i.cj(m),u_cam_pos:new i.ci(m),u_velocityConeAperture:new i.cj(m),u_velocity:new i.cj(m),u_horizontalOscillationRadius:new i.cj(m),u_horizontalOscillationRate:new i.cj(m),u_boxSize:new i.cj(m),u_billboardSize:new i.cj(m),u_simpleShapeParameters:new i.ck(m),u_screenSize:new i.ck(m),u_thinningCenterPos:new i.ck(m),u_thinningShape:new i.ci(m),u_thinningAffectedRatio:new i.cj(m),u_thinningParticleOffset:new i.cj(m),u_particleColor:new i.d3(m),u_direction:new i.ci(m)}),rainParticle:m=>({u_modelview:new i.cl(m),u_projection:new i.cl(m),u_time:new i.cj(m),u_cam_pos:new i.ci(m),u_texScreen:new i.ch(m),u_velocityConeAperture:new i.cj(m),u_velocity:new i.cj(m),u_boxSize:new i.cj(m),u_rainDropletSize:new i.ck(m),u_distortionStrength:new i.cj(m),u_rainDirection:new i.ci(m),u_color:new i.d3(m),u_screenSize:new i.ck(m),u_thinningCenterPos:new i.ck(m),u_thinningShape:new i.ci(m),u_thinningAffectedRatio:new i.cj(m),u_thinningParticleOffset:new i.cj(m),u_shapeDirectionalPower:new i.cj(m),u_shapeNormalPower:new i.cj(m),u_mode:new i.cj(m)}),vignette:m=>({u_vignetteShape:new i.ci(m),u_vignetteColor:new i.d3(m)}),occlusion:m=>({u_matrix:new i.cl(m),u_anchorPos:new i.ci(m),u_screenSizePx:new i.ck(m),u_occluderSizePx:new i.ck(m),u_color:new i.d3(m)})};class wc{constructor(o,d,g,b){this.id=wc.uniqueIdxCounter,wc.uniqueIdxCounter++,this.context=o;const T=o.gl;this.buffer=T.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),T.bufferData(T.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||b||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=wc.uniqueIdxCounter,wc.uniqueIdxCounter++;const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}wc.uniqueIdxCounter=0;const kb={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class sS{constructor(o,d,g,b,T,E){this.length=d.length,this.attributes=g,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.instanceCount=E,this.context=o;const I=o.gl;this.buffer=I.createBuffer(),o.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||T||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,d){for(let g=0;g<this.attributes.length;g++){const b=d.getAttributeLocation(o,this.attributes[g].name);b!==-1&&o.enableVertexAttribArray(b)}}setVertexAttribPointers(o,d,g){for(let b=0;b<this.attributes.length;b++){const T=this.attributes[b],E=d.getAttributeLocation(o,T.name);E!==-1&&o.vertexAttribPointer(E,T.components,o[kb[T.type]],!1,this.itemSize,T.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(o,d,g){for(let b=0;b<this.attributes.length;b++){const T=d.getAttributeLocation(o,this.attributes[b].name);T!==-1&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(T,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class aS{constructor(o,d,g,b,T){this.context=o,this.width=d,this.height=g;const E=this.framebuffer=o.gl.createFramebuffer();b>0&&(this.colorAttachment0=new Iy(o,E,0)),b>1&&(this.colorAttachment1=new Iy(o,E,1)),T&&(this.depthAttachmentType=T,this.depthAttachment=T==="renderbuffer"?new Jp(o,E):new og(o,E))}createColorAttachment(o,d){d===0?this.colorAttachment0=new Iy(o,this.framebuffer,0):d===1&&(this.colorAttachment1=new Iy(o,this.framebuffer,1))}removeColorAttachment(o,d){const g=this.context.gl;let b;d===0?(b=this.colorAttachment0.get(),this.colorAttachment0=void 0):d===1&&(b=this.colorAttachment1.get(),this.colorAttachment1=void 0),b&&g.deleteTexture(b)}destroy(){const o=this.context.gl;if(this.colorAttachment0){const d=this.colorAttachment0.get();d&&o.deleteTexture(d)}if(this.colorAttachment1){const d=this.colorAttachment1.get();d&&o.deleteTexture(d)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const d=this.depthAttachment.get();d&&o.deleteRenderbuffer(d)}else{const d=this.depthAttachment.get();d&&o.deleteTexture(d)}o.deleteFramebuffer(this.framebuffer)}}class im{constructor(o,d){this.gl=o,this.clearColor=new wI(this),this.clearDepth=new BE(this),this.clearStencil=new cb(this),this.colorMask=new Ey(this),this.depthMask=new db(this),this.stencilMask=new Bf(this),this.stencilFunc=new Xp(this),this.stencilOp=new sg(this),this.stencilTest=new Yp(this),this.depthRange=new jE(this),this.depthTest=new hb(this),this.depthFunc=new UE(this),this.blend=new Kp(this),this.blendFunc=new Sy(this),this.blendColor=new Ay(this),this.blendEquation=new fb(this),this.cullFace=new Cy(this),this.cullFaceSide=new ag(this),this.frontFace=new VE(this),this.program=new $E(this),this.activeTexture=new HE(this),this.viewport=new Qp(this),this.bindFramebuffer=new GE(this),this.bindRenderbuffer=new TI(this),this.bindTexture=new EI(this),this.bindVertexBuffer=new SI(this),this.bindElementBuffer=new pb(this),this.bindVertexArrayOES=new mb(this),this.pixelStoreUnpack=new gb(this),this.pixelStoreUnpackPremultiplyAlpha=new _b(this),this.pixelStoreUnpackFlipY=new qE(this),this.options=d?Object.assign({},d):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=d&&!!d.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=o.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,d,g){return new wc(this,o,d,g)}createVertexBuffer(o,d,g,b,T){return new sS(this,o,d,g,b,T)}createRenderbuffer(o,d,g){const b=this.gl,T=b.createRenderbuffer();return this.bindRenderbuffer.set(T),b.renderbufferStorage(b.RENDERBUFFER,o,d,g),this.bindRenderbuffer.set(null),T}createFramebuffer(o,d,g,b){return new aS(this,o,d,g,b)}clear({color:o,depth:d,stencil:g,colorMask:b}){const T=this.gl;let E=0;o&&(E|=T.COLOR_BUFFER_BIT,this.clearColor.set(o.toNonPremultipliedRenderColor(null)),this.colorMask.set(b||[!0,!0,!0,!0])),d!==void 0&&(E|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),g!==void 0&&(E|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),T.clear(E)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){i.by(o.blendFunction,Vr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Vf;function En(m,o,d,g,b,T,E){const I=m.context,M=I.gl,N=m.transform,j=[i.aF(N.center.lng),i.aJ(N.center.lat)],W=d.layout.get("symbol-placement"),Z=d.layout.get("text-variable-anchor"),Y=d.layout.get("icon-rotation-alignment")==="map",te=d.layout.get("text-rotation-alignment")==="map",J=W!=="point",oe=[];let ae=0,pe=0;for(let Te=0;Te<g.length;Te++){const ze=g[Te],We=o.getTile(ze),Ge=We.getBucket(d);if(!Ge)continue;const ct=Ge.getProjection().createInversionMatrix(N,ze.canonical),ht=[],Et=oy(ze,Ge,N),Ut=!E&&Y&&J,it=E&&te&&J,Ue=Z&&Ge.hasTextData(),_t=Ge.hasIconTextFit()&&Ue&&Ge.hasIconData(),ut=Ut||it||E&&Ue||_t,Pt=Ge.projection.name==="globe",nn=Pt?i.aj(N.zoom):0;Pt&&(ht.push("PROJECTION_GLOBE_VIEW"),ut&&ht.push("PROJECTED_POS_ON_VIEWPORT"));const _n=m.getOrCreateProgram("collisionBox",{defines:ht});let Yt=Et;b[0]===0&&b[1]===0||(Yt=m.translatePosMatrix(Et,We,b,T));const Vt=E?Ge.textCollisionBox:Ge.iconCollisionBox,On=Ge.collisionCircleArray;if(On.length>0){const fn=i.bC(),vn=Yt;i.cP(fn,Ge.placementInvProjMatrix,N.glCoordMatrix),i.cP(fn,fn,Ge.placementViewportMatrix),oe.push({circleArray:On,circleOffset:pe,transform:vn,invTransform:fn,projection:Ge.getProjection()}),ae+=On.length/4,pe=ae}if(!Vt)continue;m.terrain&&m.terrain.setupElevationDraw(We,_n);const Cn=Pt?[ze.canonical.x,ze.canonical.y,1<<ze.canonical.z]:[0,0,0];_n.draw(m,M.LINES,Fn.disabled,Mr.disabled,m.colorModeForRenderPass(),Rr.disabled,Ab(Yt,ct,N,nn,j,We,Cn,Ge.getProjection()),d.id,Vt.layoutVertexBuffer,Vt.indexBuffer,Vt.segments,null,N.zoom,null,[Vt.collisionVertexBuffer,Vt.collisionVertexBufferExt])}if(!E||!oe.length)return;const _e=m.getOrCreateProgram("collisionCircle"),me=new i.dZ;me.resize(4*ae),me._trim();let Le=0;for(const Te of oe)for(let ze=0;ze<Te.circleArray.length/4;ze++){const We=4*ze,Ge=Te.circleArray[We+0],ct=Te.circleArray[We+1],ht=Te.circleArray[We+2],Et=Te.circleArray[We+3];me.emplace(Le++,Ge,ct,ht,Et,0),me.emplace(Le++,Ge,ct,ht,Et,1),me.emplace(Le++,Ge,ct,ht,Et,2),me.emplace(Le++,Ge,ct,ht,Et,3)}(!Vf||Vf.length<2*ae)&&(Vf=function(Te){const ze=2*Te,We=new i.b0;We.resize(ze),We._trim();for(let Ge=0;Ge<ze;Ge++){const ct=6*Ge;We.uint16[ct+0]=4*Ge+0,We.uint16[ct+1]=4*Ge+1,We.uint16[ct+2]=4*Ge+2,We.uint16[ct+3]=4*Ge+2,We.uint16[ct+4]=4*Ge+3,We.uint16[ct+5]=4*Ge+0}return We}(ae));const Ce=I.createIndexBuffer(Vf,!0),Re=I.createVertexBuffer(me,i.d_.members,!0);for(const Te of oe){const ze={u_matrix:Te.transform,u_inv_matrix:Te.invTransform,u_camera_to_center_distance:(Ae=N).getCameraToCenterDistance(Te.projection),u_viewport_size:[Ae.width,Ae.height]};_e.draw(m,M.TRIANGLES,Fn.disabled,Mr.disabled,m.colorModeForRenderPass(),Rr.disabled,ze,d.id,Re,Ce,i.bg.simpleSegment(0,2*Te.circleOffset,Te.circleArray.length,Te.circleArray.length/2),null,N.zoom)}var Ae;Re.destroy(),Ce.destroy()}const fg=i.bC();function Dd(m){const o=m._camera.getWorldToCamera(m.worldSize,1),d=i.aB([],o,m.globeMatrix);i.bl(d,d);const g=[0,0,0],b=[0,1,0,0];return i.aC(b,b,d),g[0]=b[0],g[1]=b[1],g[2]=b[2],i.aw(g,g),g}function jh({width:m,height:o,anchor:d,textOffset:g,textScale:b},T){const{horizontalAlign:E,verticalAlign:I}=i.c1(d),M=-(E-.5)*m,N=-(I-.5)*o,j=i.c2(d,g);return new i.P((M/b+j[0])*T,(N/b+j[1])*T)}function fr(m,o,d,g,b,T,E,I,M,N){const j=m.text.placedSymbolArray,W=m.text.dynamicLayoutVertexArray,Z=m.icon.dynamicLayoutVertexArray,Y={},te=m.getProjection(),J=Kc(E,te,b),oe=b.elevation,ae=te.upVectorScale(E.canonical,b.center.lat,b.worldSize).metersToTile;W.clear();for(let pe=0;pe<j.length;pe++){const _e=j.get(pe),{tileAnchorX:me,tileAnchorY:Le,numGlyphs:Ce}=_e,Re=_e.hidden||!_e.crossTileID||m.allowVerticalPlacement&&!_e.placedOrientation?null:g[_e.crossTileID];if(Re){let Ae=0,Te=0,ze=0;const We=m.elevationType==="road";if(oe||We){const ut=We?m.getElevationFeatureForText(pe):null,Pt=i.bV.getAtTileOffset(E,new i.P(me,Le),oe,ut),[nn,_n,Yt]=te.upVector(E.canonical,me,Le);Ae=Pt*nn*ae,Te=Pt*_n*ae,ze=Pt*Yt*ae}let[Ge,ct,ht,Et]=Vu(_e.projectedAnchorX+Ae,_e.projectedAnchorY+Te,_e.projectedAnchorZ+ze,d?J:T);const Ut=ts(b.getCameraToCenterDistance(te),Et);let it=i.bM(m.textSizeData,M,_e)*Ut/i.bY;d&&(it*=m.tilePixelRatio/I);const Ue=jh(Re,it);d?({x:Ge,y:ct,z:ht}=te.projectTilePoint(me+Ue.x,Le+Ue.y,E.canonical),[Ge,ct,ht]=Vu(Ge+Ae,ct+Te,ht+ze,T)):(o&&Ue._rotate(-b.angle),Ge+=Ue.x,ct+=Ue.y,ht=0);const _t=m.allowVerticalPlacement&&_e.placedOrientation===i.bL.vertical?Math.PI/2:0;for(let ut=0;ut<Ce;ut++)i.bO(W,Ge,ct,ht,_t);N&&_e.associatedIconIndex>=0&&(Y[_e.associatedIconIndex]={x:Ge,y:ct,z:ht,angle:_t})}else vc(Ce,W)}if(N){Z.clear();const pe=m.icon.placedSymbolArray;for(let _e=0;_e<pe.length;_e++){const me=pe.get(_e),{numGlyphs:Le}=me,Ce=Y[_e];if(me.hidden||!Ce)vc(Le,Z);else{const{x:Re,y:Ae,z:Te,angle:ze}=Ce;for(let We=0;We<Le;We++)i.bO(Z,Re,Ae,Te,ze)}}m.icon.dynamicLayoutVertexBuffer.updateData(Z)}m.text.dynamicLayoutVertexBuffer.updateData(W)}function pg(m,o,d,g,b,T,E={}){const I=d.paint.get("icon-translate"),M=d.paint.get("text-translate"),N=d.paint.get("icon-translate-anchor"),j=d.paint.get("text-translate-anchor"),W=d.layout.get("icon-rotation-alignment"),Z=d.layout.get("text-rotation-alignment"),Y=d.layout.get("icon-pitch-alignment"),te=d.layout.get("text-pitch-alignment"),J=d.layout.get("icon-keep-upright"),oe=d.layout.get("text-keep-upright"),ae=d.paint.get("icon-color-saturation"),pe=d.paint.get("icon-color-contrast"),_e=d.paint.get("icon-color-brightness-min"),me=d.paint.get("icon-color-brightness-max"),Le=d.layout.get("symbol-elevation-reference")==="sea",Ce=d.layout.get("icon-image-use-theme")==="none",Re=m.context,Ae=Re.gl,Te=m.transform,ze=W==="map",We=Z==="map",Ge=Y==="map",ct=te==="map",ht=d.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Et=!1;const Ut=m.depthModeForSublayer(0,Fn.ReadOnly),it=new Fn(m.context.gl.LEQUAL,Fn.ReadOnly,m.depthRangeFor3D),Ue=[i.aF(Te.center.lng),i.aJ(Te.center.lat)],_t=d.layout.get("text-variable-anchor"),ut=Te.projection.name==="globe",Pt=[],nn=[0,-1,0];for(const _n of g){const Yt=o.getTile(_n),Vt=Yt.getBucket(d);if(!Vt||Vt.projection.name==="mercator"&&ut||Vt.fullyClipped)continue;const On=Vt.projection.name==="globe",Cn=On?i.aj(Te.zoom):0,fn=Kc(_n,Vt.getProjection(),Te),vn=Te.calculatePixelsToTileUnitsMatrix(Yt),tr=_t&&Vt.hasTextData(),Nr=Vt.hasIconTextFit()&&tr&&Vt.hasIconData(),mi=Vt.getProjection().createInversionMatrix(Te,_n.canonical),Bi=(1<<Yt.tileID.canonical.z)*i.al/m.transform.worldSize,Nn=Xi=>{let ki=[0,0,0];if(Xi){const Gr=m.style.directionalLight,qs=m.style.ambientLight;Gr&&qs&&(ki=Od(m.style,Gr,qs))}return ki},Ni=Xi=>{Te.depthOcclusionForSymbolsAndCircles&&(d.hasOcclusionOpacityProperties||m.terrain)&&(Xi.push("DEPTH_D24"),Xi.push("DEPTH_OCCLUSION"))},Dr=Xi=>{d.lut&&!Ce&&(d.lut.texture||(d.lut.texture=new i.d$(m.context,d.lut.image,[d.lut.image.height,d.lut.image.height,d.lut.image.height],Re.gl.RGBA8)),Re.activeTexture.set(Re.gl.TEXTURE0+Mo.LUT),d.lut.texture&&d.lut.texture.bind(Re.gl.LINEAR,Re.gl.CLAMP_TO_EDGE),Xi.push("APPLY_LUT_ON_GPU"))},Wi=()=>{const Xi=ze&&d.layout.get("symbol-placement")!=="point",ki=[];Ni(ki),Dr(ki);const Gr=Xi||Nr,qs=Vt.elevationType==="road",Pa=m.shadowRenderer,ha=qs&&Ge&&!!Pa&&Pa.enabled,xs=Nn(ha),Il=qs&&Ge&&!m.terrain?it:Ut,Xo=d.paint.get("icon-image-cross-fade");m.terrainRenderModeElevated()&&Ge&&ki.push("PITCH_WITH_MAP_TERRAIN"),On&&(ki.push("PROJECTION_GLOBE_VIEW"),Gr&&ki.push("PROJECTED_POS_ON_VIEWPORT")),Xo>0&&Vt.hasAnySecondaryIcon&&ki.push("ICON_TRANSITION"),!Vt.icon.zOffsetVertexBuffer||qs&&m.terrain||ki.push("Z_OFFSET"),ae===0&&pe===0&&_e===0&&me===1||ki.push("COLOR_ADJUSTMENT"),Vt.sdfIcons&&ki.push("RENDER_SDF"),ha&&ki.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),qs&&Ge&&!m.terrain&&Vt.icon.orientationVertexBuffer&&ki.push("ELEVATED_ROADS");const ro=Vt.icon.programConfigurations.get(d.id),al=m.getOrCreateProgram("symbol",{config:ro,defines:ki}),ol=Yt.imageAtlasTexture?Yt.imageAtlasTexture.size:[0,0],Uo=Vt.iconSizeData,bu=i.bK(Uo,Te.zoom),Yu=Ge||!Te.isOrthographic,jl=yl(fn,Yt.tileID.canonical,Ge,ze,Te,Vt.getProjection(),vn),ba=X0(fn,Yt.tileID.canonical,Ge,ze,Te,Vt.getProjection(),vn),Fa=m.translatePosMatrix(ba,Yt,I,N,!0),bs=m.translatePosMatrix(fn,Yt,I,N),Ha=Gr?fg:jl,_a=ze&&!Ge&&!Xi;let fa=nn;!ut&&!Te.mercatorFromTransition||ze||(fa=Dd(Te));const Ku=On?fa:nn,Ag=d.getColorAdjustmentMatrix(ae,pe,_e,me),Sc=By(Uo.kind,bu,_a,Ge,m,bs,Ha,Fa,Le,!1,ol,[0,0],0,_n,Cn,Ue,mi,Ku,Vt.getProjection(),xs,Bi,Ag,Xo,null),Cg=Yt.imageAtlasTexture?Yt.imageAtlasTexture:null,fm=d.layout.get("icon-size").constantOr(0)!==1||Vt.iconsNeedLinear,od=Vt.sdfIcons||m.options.rotating||m.options.zooming||fm||Yu?Ae.LINEAR:Ae.NEAREST,Hd=Vt.sdfIcons&&d.paint.get("icon-halo-width").constantOr(1)!==0,pm=m.terrain&&Ge&&Xi?i.bl(i.bC(),jl):fg;if(Xi&&Vt.icon){const Gh=i.bV.getAtTileOffsetFunc(_n,Te.center.lat,Te.worldSize,Vt.getProjection()),Gd=ly(fn,Yt.tileID.canonical,Ge,ze,Te,Vt.getProjection(),vn),Ac=d.layout.get("icon-size-scale-range"),qd=i.aA(m.scaleFactor,Ac[0],Ac[1]);RE(Vt,fn,m,!1,Gd,ba,Ge,J,Gh,_n,qd)}return{program:al,buffers:Vt.icon,uniformValues:Sc,atlasTexture:Cg,atlasTextureIcon:null,atlasInterpolation:od,atlasInterpolationIcon:null,isSDF:Vt.sdfIcons,hasHalo:Hd,depthMode:Il,tile:Yt,renderWithShadows:ha,labelPlaneMatrixInv:pm}},ls=()=>{const Xi=We&&d.layout.get("symbol-placement")!=="point",ki=[],Gr=Xi||_t||Nr,qs=Vt.elevationType==="road",Pa=m.shadowRenderer,ha=qs&&ct&&!!Pa&&Pa.enabled,xs=Nn(ha),Il=qs&&ct&&!m.terrain?it:Ut;m.terrainRenderModeElevated()&&ct&&ki.push("PITCH_WITH_MAP_TERRAIN"),On&&(ki.push("PROJECTION_GLOBE_VIEW"),Gr&&ki.push("PROJECTED_POS_ON_VIEWPORT")),!Vt.text.zOffsetVertexBuffer||qs&&m.terrain||ki.push("Z_OFFSET"),Vt.iconsInText&&ki.push("RENDER_TEXT_AND_SYMBOL"),ki.push("RENDER_SDF"),ha&&ki.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),qs&&ct&&!m.terrain&&Vt.text.orientationVertexBuffer&&ki.push("ELEVATED_ROADS"),Ni(ki);const Xo=Vt.text.programConfigurations.get(d.id),ro=m.getOrCreateProgram("symbol",{config:Xo,defines:ki});let al,ol=[0,0],Uo=null;const bu=Vt.textSizeData;Vt.iconsInText&&(ol=Yt.imageAtlasTexture?Yt.imageAtlasTexture.size:[0,0],Uo=Yt.imageAtlasTexture?Yt.imageAtlasTexture:null,al=ct||!Te.isOrthographic||m.options.rotating||m.options.zooming||bu.kind==="composite"||bu.kind==="camera"?Ae.LINEAR:Ae.NEAREST);const Yu=Yt.glyphAtlasTexture?Yt.glyphAtlasTexture.size:[0,0],jl=d.layout.get("text-size-scale-range"),ba=i.aA(m.scaleFactor,jl[0],jl[1]),Fa=i.bK(bu,Te.zoom,ba),bs=yl(fn,Yt.tileID.canonical,ct,We,Te,Vt.getProjection(),vn),Ha=X0(fn,Yt.tileID.canonical,ct,We,Te,Vt.getProjection(),vn),_a=m.translatePosMatrix(Ha,Yt,M,j,!0),fa=m.translatePosMatrix(fn,Yt,M,j),Ku=Gr?fg:bs,Ag=We&&!ct&&!Xi;let Sc=nn;!ut&&!Te.mercatorFromTransition||We||(Sc=Dd(Te));const Cg=By(bu.kind,Fa,Ag,ct,m,fa,Ku,_a,Le,!0,Yu,ol,0,_n,Cn,Ue,mi,On?Sc:nn,Vt.getProjection(),xs,Bi,null,null,ba),fm=Yt.glyphAtlasTexture?Yt.glyphAtlasTexture:null,od=Ae.LINEAR,Hd=d.paint.get("text-halo-width").constantOr(1)!==0,pm=m.terrain&&ct&&Xi?i.bl(i.bC(),bs):fg;if(Xi&&Vt.text){const Gh=i.bV.getAtTileOffsetFunc(_n,Te.center.lat,Te.worldSize,Vt.getProjection()),Gd=ly(fn,Yt.tileID.canonical,ct,We,Te,Vt.getProjection(),vn);RE(Vt,fn,m,!0,Gd,Ha,ct,oe,Gh,_n,ba)}return{program:ro,buffers:Vt.text,uniformValues:Cg,atlasTexture:fm,atlasTextureIcon:Uo,atlasInterpolation:od,atlasInterpolationIcon:al,isSDF:!0,hasHalo:Hd,depthMode:Il,tile:Yt,renderWithShadows:ha,labelPlaneMatrixInv:pm}},ns=Vt.icon.segments.get().length,Di=Vt.text.segments.get().length,Hr=ns&&!E.onlyText?Wi():null,Gi=Di&&!E.onlyIcons?ls():null,ga=d.paint.get("icon-opacity").constantOr(1),ea=d.paint.get("text-opacity").constantOr(1);if(ht&&Vt.canOverlap){Et=!0;const Xi=ga&&!E.onlyText?Vt.icon.segments.get():[],ki=ea&&!E.onlyIcons?Vt.text.segments.get():[];for(const Gr of Xi)Pt.push({segments:new i.bg([Gr]),sortKey:Gr.sortKey,state:Hr});for(const Gr of ki)Pt.push({segments:new i.bg([Gr]),sortKey:Gr.sortKey,state:Gi})}else E.onlyText||Pt.push({segments:ga?Vt.icon.segments:new i.bg([]),sortKey:0,state:Hr}),E.onlyIcons||Pt.push({segments:ea?Vt.text.segments:new i.bg([]),sortKey:0,state:Gi})}Et&&Pt.sort((_n,Yt)=>_n.sortKey-Yt.sortKey);for(const _n of Pt){const Yt=_n.state;if(Yt)if(m.terrain?m.terrain.setupElevationDraw(Yt.tile,Yt.program,{useDepthForOcclusion:Te.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Yt.labelPlaneMatrixInv}):m.setupDepthForOcclusion(Te.depthOcclusionForSymbolsAndCircles,Yt.program),Re.activeTexture.set(Ae.TEXTURE0),Yt.atlasTexture&&Yt.atlasTexture.bind(Yt.atlasInterpolation,Ae.CLAMP_TO_EDGE,!0),Yt.atlasTextureIcon&&(Re.activeTexture.set(Ae.TEXTURE1),Yt.atlasTextureIcon&&Yt.atlasTextureIcon.bind(Yt.atlasInterpolationIcon,Ae.CLAMP_TO_EDGE,!0)),Yt.renderWithShadows&&m.shadowRenderer.setupShadows(Yt.tile.tileID.toUnwrapped(),Yt.program,"vector-tile"),m.uploadCommonLightUniforms(m.context,Yt.program),Yt.hasHalo){const Vt=Yt.uniformValues;Vt.u_is_halo=1,Ib(Yt.buffers,_n.segments,d,m,Yt.program,Yt.depthMode,b,T,Vt,2),Vt.u_is_halo=0}else{if(Yt.isSDF){const Vt=Yt.uniformValues;Yt.hasHalo&&(Vt.u_is_halo=1,Ib(Yt.buffers,_n.segments,d,m,Yt.program,Yt.depthMode,b,T,Vt,1)),Vt.u_is_halo=0}Ib(Yt.buffers,_n.segments,d,m,Yt.program,Yt.depthMode,b,T,Yt.uniformValues,1)}}}function Ib(m,o,d,g,b,T,E,I,M,N){const j=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer,m.orientationVertexBuffer];b.draw(g,g.context.gl.TRIANGLES,T,E,I,Rr.disabled,M,d.id,m.layoutVertexBuffer,m.indexBuffer,o,d.paint,g.transform.zoom,m.programConfigurations.get(d.id),j,N)}function oS(m,o){const d=1<<m.canonical.z,g=(o.x*d-m.canonical.x-m.wrap*d)*i.al,b=(o.y*d-m.canonical.y)*i.al,T=i.e8(o.z,o.y);return i.d5(g,b,T)}function Uy(m,o,d,g,b){if(!d.layout||d.layout.get("fill-elevation-reference")==="none"||d.paint.get("fill-opacity").constantOr(1)===0)return;const T=m.context.gl,E=new Fn(m.context.gl.LEQUAL,Fn.ReadWrite,m.depthRangeFor3D),I=new Fn(m.context.gl.GREATER,Fn.ReadWrite,m.depthRangeFor3D),M=function(Y){let te=.01;return Y.isOrthographic&&(te=i.ak(1e-4,te,i.d0(Y.pitch>=bc?1:Y.pitch/bc))),2*te}(m.transform),N=m.transform.getFreeCameraOptions().position,j="elevatedStructuresDepthReconstruct",W=m.getOrCreateProgram(j,{defines:["DEPTH_RECONSTRUCTION"]}),Z=m.getOrCreateProgram(j);for(const Y of g){const te=o.getTile(Y),J=te.getBucket(d);if(!J)continue;const oe=J.elevatedStructures;if(!oe)continue;const ae=J.elevationBufferData.heightRange,pe=oS(Y.toUnwrapped(),N),_e=m.translatePosMatrix(Y.projMatrix,te,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));let me,Le,Ce,Re;if(b==="initialize"){if(!ae||ae.min>=1||oe.depthSegments.segments[0].primitiveLength===0)continue;me=jf(_e,pe,M,1,0),Le=E,Ce=oe.depthSegments,Re=W}else if(b==="reset"){if(!ae||ae.min>=0||oe.maskSegments.segments[0].primitiveLength===0)continue;me=jf(_e,pe,0,0,1),Le=I,Ce=oe.maskSegments,Re=W}else if(b==="geometry"){if(oe.depthSegments.segments[0].primitiveLength===0)continue;me=jf(_e,pe,M,1,0),Le=E,Ce=oe.depthSegments,Re=Z}Re.draw(m,T.TRIANGLES,Le,Mr.disabled,Vr.disabled,Rr.disabled,me,d.id,oe.vertexBuffer,oe.indexBuffer,Ce,d.paint,m.transform.zoom)}}function Vy(m,o,d,g){const{painter:b,sourceCache:T,layer:E,coords:I,colorMode:M,elevationType:N,terrainEnabled:j,pass:W}=m,Z=b.context.gl,Y=E.paint.get("fill-pattern"),te=E.paint.get("fill-pattern-cross-fade"),J=Y.constantOr(null);let oe=N;N!=="road"||o&&!j||(oe="none");const ae=oe==="road",pe=m.painter.shadowRenderer,_e=ae&&!!pe&&pe.enabled,me=new Fn(b.context.gl.LEQUAL,Fn.ReadOnly,b.depthRangeFor3D);let Le=[0,0,0];if(_e){const Te=b.style.directionalLight,ze=b.style.ambientLight;Te&&ze&&(Le=Od(b.style,Te,ze))}const Ce=Y&&Y.constantOr(1),Re=b.terrain&&b.terrain.renderingToTexture,Ae=(Te,ze)=>{let We,Ge,ct,ht,Et;ze?(We=Ce&&!E.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ct=Z.LINES):(We=Ce?"fillPattern":"fill",ct=Z.TRIANGLES);for(const Ut of I){const it=T.getTile(Ut);if(Ce&&!it.patternsLoaded())continue;const Ue=it.getBucket(E);if(!Ue)continue;const _t=o?Ue.elevationBufferData:Ue.bufferData;if(_t.isEmpty())continue;b.prepareDrawTile();const ut=_t.programConfigurations.get(E.id),Pt=b.isTileAffectedByFog(Ut),nn=[],_n=[];ae&&(nn.push("ELEVATED_ROADS"),_n.push(_t.elevatedLayoutVertexBuffer)),_e&&nn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Re&&d&&nn.push("USE_MRT1"),Ce&&(b.context.activeTexture.set(Z.TEXTURE0),it.imageAtlasTexture&&it.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),ut.updatePaintBuffers());let Yt=!1;if(J&&it.imageAtlas){const vn=it.imageAtlas,tr=i.e3.from(J),Nr=tr.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),mi=tr.getSecondary(),Bi=vn.patternPositions.get(Nr),Nn=mi?vn.patternPositions.get(mi.scaleSelf(i.o.devicePixelRatio).toString()):null;Yt=!!Bi&&!!Nn,Bi&&ut.setConstantPatternPositions(Bi,Nn)}te>0&&(Yt||ut.getPatternTransitionVertexBuffer("fill-pattern"))&&nn.push("FILL_PATTERN_TRANSITION");const Vt=b.getOrCreateProgram(We,{config:ut,overrideFog:Pt,defines:nn}),On=b.translatePosMatrix(Ut.projMatrix,it,E.paint.get("fill-translate"),E.paint.get("fill-translate-anchor"));_e&&pe.setupShadows(it.tileID.toUnwrapped(),Vt,"vector-tile");const Cn=E.paint.get("fill-emissive-strength");if(ze){ht=_t.lineIndexBuffer,Et=_t.lineSegments;const vn=b.terrain&&b.terrain.renderingToTexture?b.terrain.drapeBufferSize:[Z.drawingBufferWidth,Z.drawingBufferHeight];Ge=We==="fillOutlinePattern"&&Ce?Sb(On,Cn,b,it,vn,Le,te):KE(On,Cn,vn,Le)}else ht=_t.indexBuffer,Et=_t.triangleSegments,Ge=Ce?Eb(On,Cn,b,it,Le,te):Tb(On,Cn,Le);b.uploadCommonUniforms(b.context,Vt,Ut.toUnwrapped());let fn=Te;(N==="road"&&!j||N==="offset")&&(fn=me),Vt.draw(b,ct,fn,g||b.stencilModeForClipping(Ut),M,Rr.disabled,Ge,E.id,_t.layoutVertexBuffer,ht,Et,E.paint,b.transform.zoom,ut,_n)}};b.renderPass===W&&Ae(b.depthModeForSublayer(1,b.renderPass==="opaque"?Fn.ReadWrite:Fn.ReadOnly),!1),oe==="none"&&b.renderPass==="translucent"&&E.paint.get("fill-antialias")&&Ae(b.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,Fn.ReadOnly),!0)}function $y(m,o,d,g,b,T,E,I){d.resetLayerRenderingStats(m);const M=m.context,N=M.gl,j=m.transform,W=d.paint.get("fill-extrusion-pattern"),Z=d.paint.get("fill-extrusion-pattern-cross-fade"),Y=W.constantOr(null),te=W.constantOr(1),J=d.paint.get("fill-extrusion-opacity"),oe=m.style.enable3dLights(),ae=d.paint.get(oe&&!te?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),pe=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),ae],_e=d.layout.get("fill-extrusion-edge-radius"),me=_e>0&&!d.paint.get("fill-extrusion-rounded-roof"),Le=me?0:_e,Ce=j.projection.name==="globe"?i.eb():0,Re=j.projection.name==="globe",Ae=Re?i.aj(j.zoom):0,Te=[i.aF(j.center.lng),i.aJ(j.center.lat)],ze=d.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",We=d.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ze?null:d.lut).toArray01().slice(0,3),Ge=d.paint.get("fill-extrusion-flood-light-intensity"),ct=d.paint.get("fill-extrusion-vertical-scale"),ht=d.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Et=d.paint.get("fill-extrusion-height-alignment"),Ut=d.paint.get("fill-extrusion-base-alignment"),it=Mh(m,d.paint.get("fill-extrusion-cutoff-fade-range")),Ue=[];let _t;Re&&Ue.push("PROJECTION_GLOBE_VIEW"),pe[0]>0&&Ue.push("FAUX_AO"),me&&Ue.push("ZERO_ROOF_RADIUS"),I&&Ue.push("HAS_CENTROID"),Ge>0&&Ue.push("FLOOD_LIGHT"),it.shouldRenderCutoff&&Ue.push("RENDER_CUTOFF"),ht&&Ue.push("RENDER_WALL_MODE");const ut=m.renderPass==="shadow",Pt=m.shadowRenderer,nn=ut&&!!Pt,_n=ut?Rr.disabled:Rr.backCCW;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let Yt=[0,0,0];if(Pt){const Cn=m.style.directionalLight,fn=m.style.ambientLight;Cn&&fn&&(Yt=Od(m.style,Cn,fn)),ut||(Ue.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Pt.useNormalOffset&&Ue.push("NORMAL_OFFSET")),_t=Ue.concat(["SHADOWS_SINGLE_CASCADE"])}const Vt=nn?"fillExtrusionDepth":te?"fillExtrusionPattern":"fillExtrusion",On=d.getLayerRenderingStats();for(const Cn of g){const fn=o.getTile(Cn),vn=fn.getBucket(d);if(!vn||vn.projection.name!==j.projection.name)continue;let tr=!1;Pt&&(tr=Pt.getMaxCascadeForTile(Cn.toUnwrapped())===0);const Nr=m.isTileAffectedByFog(Cn),mi=vn.programConfigurations.get(d.id);let Bi=!1;if(Y&&fn.imageAtlas){const Di=fn.imageAtlas,Hr=i.e3.from(Y),Gi=Hr.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),ga=Hr.getSecondary(),ea=Di.patternPositions.get(Gi),Xi=ga?Di.patternPositions.get(ga.scaleSelf(i.o.devicePixelRatio).toString()):null;Bi=!!ea&&!!Xi,ea&&mi.setConstantPatternPositions(ea,Xi)}Z>0&&(Bi||mi.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ue.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Nn=m.getOrCreateProgram(Vt,{config:mi,defines:tr?_t:Ue,overrideFog:Nr});if(m.terrain&&m.terrain.setupElevationDraw(fn,Nn,{useMeterToDem:!0}),!vn.centroidVertexBuffer){const Di=Nn.getAttributeLocation(N,"a_centroid_pos");Di!==-1&&N.vertexAttrib2f(Di,0,0)}!ut&&Pt&&Pt.setupShadows(fn.tileID.toUnwrapped(),Nn,"vector-tile"),te&&(m.context.activeTexture.set(N.TEXTURE0),fn.imageAtlasTexture&&fn.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),mi.updatePaintBuffers());const Ni=d.paint.get("fill-extrusion-vertical-gradient"),Dr=1/vn.tileToMeter;let Wi;if(ut&&Pt){if(zd(fn.tileID,vn.maxHeight,m))continue;const Di=Pt.calculateShadowPassMatrixFromTile(fn.tileID.toUnwrapped());Wi=wb(Di,Le,Dr,ct,Et,Ut)}else{const Di=m.translatePosMatrix(Cn.expandedProjMatrix,fn,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Hr=j.projection.createInversionMatrix(j,Cn.canonical);Wi=te?YE(Di,m,Ni,J,pe,Le,Dr,Cn,fn,Ce,Et,Ut,Ae,Te,Hr,We,ct,Z):Dy(Di,m,Ni,J,pe,Le,Dr,Cn,Ce,Et,Ut,Ae,Te,Hr,We,ct,Ge,Yt)}m.uploadCommonUniforms(M,Nn,Cn.toUnwrapped(),null,it);let ls=vn.segments;if(j.projection.name==="mercator"&&!ut&&(ls=vn.getVisibleSegments(fn.tileID,m.terrain,m.transform.getFrustum(0)),!ls.get().length))continue;if(On)if(ut)for(const Di of ls.get())On.numRenderedVerticesInShadowPass+=Di.primitiveLength;else for(const Di of ls.get())On.numRenderedVerticesInTransparentPass+=Di.primitiveLength;const ns=[];(m.terrain||I)&&ns.push(vn.centroidVertexBuffer),Re&&ns.push(vn.layoutVertexExtBuffer),ht&&ns.push(vn.wallVertexBuffer),Nn.draw(m,M.gl.TRIANGLES,b,T,E,_n,Wi,d.id,vn.layoutVertexBuffer,vn.indexBuffer,ls,d.paint,m.transform.zoom,mi,ns)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}class Rb{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Nd(m,o,d,g,b,T,E,I,M,N,j,W,Z,Y,te,J,oe,ae,pe,_e){const me=o.context,Le=me.gl,Ce=o.transform,Re=o.transform.zoom,Ae=[],Te=m.translate,ze=m.translateAnchor,We=m.edgeRadius,Ge=Mh(o,m.cutoffFadeRange);j==="clear"?(Ae.push("CLEAR_SUBPASS"),_e&&(Ae.push("CLEAR_FROM_TEXTURE"),me.activeTexture.set(Le.TEXTURE0),_e.bind(Le.LINEAR,Le.CLAMP_TO_EDGE))):j==="sdf"?Ae.push("SDF_SUBPASS"):j==="emissive"&&(Ae.push("USE_MRT1"),me.activeTexture.set(Le.TEXTURE0),_e.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)),ae&&Ae.push("HAS_CENTROID"),Ge.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF");const ct=(ht,Et,Ut,it,Ue)=>{let _t=Ae;Et.groundRadiusBuffer!=null&&(_t=Ae.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const ut=Et.programConfigurations.get(g.id),Pt=o.isTileAffectedByFog(ht),nn=o.getOrCreateProgram("fillExtrusionGroundEffect",{config:ut,defines:_t,overrideFog:Pt}),_n=nm(o,it,W,N,Ue,[Z,Y*Ue],te,J,oe,Re>=17?0:We*Ue,_e?_e.size[0]:0),Yt=[];ae&&Yt.push(Et.hiddenByLandmarkVertexBuffer),Et.groundRadiusBuffer!=null&&Yt.push(Et.groundRadiusBuffer),o.uploadCommonUniforms(me,nn,ht.toUnwrapped(),null,Ge),nn.draw(o,me.gl.TRIANGLES,T,E,I,M,_n,g.id,Et.vertexBuffer,Et.indexBuffer,Ut,g.paint,Re,ut,Yt)};for(const ht of b){const Et=d.getTile(ht),Ut=Et.getBucket(g);if(!Ut||Ut.projection.name!==Ce.projection.name||!Ut.groundEffect||Ut.groundEffect&&!Ut.groundEffect.hasData())continue;const it=Ut.groundEffect,Ue=1/Ut.tileToMeter;{const _t=o.translatePosMatrix(ht.projMatrix,Et,Te,ze),ut=it.getDefaultSegment();ct(ht,it,ut,_t,Ue)}if(pe)for(let _t=0;_t<4;_t++){const ut=i.e9[_t](ht),Pt=d.getTile(ut);if(!Pt)continue;const nn=Pt.getBucket(g);if(!nn||nn.projection.name!==Ce.projection.name||!nn.groundEffect||nn.groundEffect&&!nn.groundEffect.hasData())continue;const _n=nn.groundEffect;let Yt,Vt;_t===0?(Yt=[-i.al,0,0],Vt=1):_t===1?(Yt=[i.al,0,0],Vt=0):_t===2?(Yt=[0,-i.al,0],Vt=3):(Yt=[0,i.al,0],Vt=2);const On=_n.regionSegments[Vt];if(!On)continue;const Cn=new Float32Array(16);i.br(Cn,ht.projMatrix,Yt),ct(ht,_n,On,o.translatePosMatrix(Cn,Et,Te,ze),Ue)}}}function MI(m,o,d,g,b,T,E){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();const I=T?T.findDEMTileFor(d):null;if(!(I&&I.dem||E))return;T&&I&&I.dem&&g.selfDEMTileTimestamp!==I.dem._timestamp&&(g.borderDoneWithNeighborZ=[-1,-1,-1,-1],g.selfDEMTileTimestamp=I.dem._timestamp);const M=ae=>new i.P(Math.ceil((ae+i.ed)*i.ee),0),N=ae=>{const pe=o.getSource().minzoom,_e=Le=>{const Ce=o.getTileByID(Le);if(Ce&&Ce.hasData())return Ce.getBucket(b)},me=[0,-1,1];for(const Le of me){if(ae.overscaledZ+Le<pe)continue;const Ce=_e(ae.calculateScaledKey(ae.overscaledZ+Le));if(Ce)return Ce}},j=[0,0,0],W=(ae,pe)=>(j[0]=Math.min(ae.min.y,pe.min.y),j[1]=Math.max(ae.max.y,pe.max.y),j[2]=i.al-pe.min.x>ae.max.x?pe.min.x-i.al:ae.max.x,j),Z=(ae,pe)=>(j[0]=Math.min(ae.min.x,pe.min.x),j[1]=Math.max(ae.max.x,pe.max.x),j[2]=i.al-pe.min.y>ae.max.y?pe.min.y-i.al:ae.max.y,j),Y=[(ae,pe)=>W(ae,pe),(ae,pe)=>W(pe,ae),(ae,pe)=>Z(ae,pe),(ae,pe)=>Z(pe,ae)],te=(ae,pe,_e,me,Le,Ce,Re)=>{if(!T)return 0;const Ae=[[Ce?_e:ae,Ce?ae:_e,0],[Ce?_e:pe,Ce?pe:_e,0]],Te=Re<0?i.al+Re:Re,ze=[Ce?Te:(ae+pe)/2,Ce?(ae+pe)/2:Te,0];return _e===0&&Re<0||_e!==0&&Re>0?T.getForTilePoints(Le,[ze],!0,me):Ae.push(ze),T.getForTilePoints(d,Ae,!0,I),Math.max(Ae[0][2],Ae[1][2],ze[2])/T.exaggeration()};for(let ae=0;ae<4;ae++){const pe=g.borderFeatureIndices[ae];if(pe.length===0)continue;const _e=i.e9[ae](d),me=N(_e);if(!(me&&me instanceof i.ea))continue;const Le=T?T.findDEMTileFor(_e):null;if(!(Le&&Le.dem||E)||(T&&Le&&Le.dem&&g.borderDEMTileTimestamp[ae]!==Le.dem._timestamp&&(g.borderDoneWithNeighborZ[ae]=-1,g.borderDEMTileTimestamp[ae]=Le.dem._timestamp),g.borderDoneWithNeighborZ[ae]===me.canonical.z))continue;me.centroidVertexArray.length===0&&me.createCentroidsBuffer();const Ce=(ae<2?1:5)-ae,Re=me.borderDoneWithNeighborZ[Ce]!==g.canonical.z,Ae=me.borderFeatureIndices[Ce];let Te=0;if(g.canonical.z!==me.canonical.z){for(const ze of pe)g.showCentroid(g.featuresOnBorder[ze]);if(Re)for(const ze of Ae)me.showCentroid(me.featuresOnBorder[ze]);g.borderDoneWithNeighborZ[ae]=me.canonical.z,me.borderDoneWithNeighborZ[Ce]=g.canonical.z}for(const ze of pe){const We=g.featuresOnBorder[ze],Ge=g.centroidData[We.centroidDataIndex],ct=We.borders[ae];let ht;for(;Te<Ae.length;){ht=me.featuresOnBorder[Ae[Te]];const Et=ht.borders[Ce];if(Et[1]>ct[0]+3||Et[0]>ct[0]-3)break;me.showCentroid(ht),Te++}if(ht&&Te<Ae.length){const Et=Te;let Ut=0;for(;!(ht.borders[Ce][0]>ct[1]-3)&&(Ut++,++Te!==Ae.length);)ht=me.featuresOnBorder[Ae[Te]];ht=me.featuresOnBorder[Ae[Et]];let it=!1;if(Ut>=1){const ut=ht.borders[Ce];Math.abs(ct[0]-ut[0])<3&&Math.abs(ct[1]-ut[1])<3&&(Ut=1,it=!0,Te=Et+1)}else if(Ut===0){g.showCentroid(We);continue}const Ue=me.centroidData[ht.centroidDataIndex];E&&it&&(((J=Ge).flags|(oe=Ue).flags)&i.ec?(J.flags|=i.ec,oe.flags|=i.ec):(J.flags&=~i.ec,oe.flags&=~i.ec));const _t=We.intersectsCount()>1||ht.intersectsCount()>1;if(Ut>1)Te=Et,Ge.centroidXY=Ue.centroidXY=new i.P(0,0);else if(Le&&Le.dem&&!_t){const ut=Y[ae](Ge,Ue),Pt=ae%2?i.al-1:0,nn=te(ut[0],Math.min(i.al-1,ut[1]),Pt,Le,_e,ae<2,ut[2]);Ge.centroidXY=Ue.centroidXY=M(nn)}else _t?Ge.centroidXY=Ue.centroidXY=new i.P(0,0):(Ge.centroidXY=g.encodeBorderCentroid(We),Ue.centroidXY=me.encodeBorderCentroid(ht));g.writeCentroidToBuffer(Ge),me.writeCentroidToBuffer(Ue)}else g.showCentroid(We)}g.borderDoneWithNeighborZ[ae]=me.canonical.z,me.borderDoneWithNeighborZ[Ce]=g.canonical.z}var J,oe;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}const eu=[1,0,0],Mb=[0,1,0],Cl=[0,0,1];function zd(m,o,d){const g=d.transform,b=d.shadowRenderer;if(!b)return!0;const T=m.toUnwrapped(),E=g.tileSize*b._cascades[d.currentShadowCascade].scale;let I=o;if(g.elevation){const J=g.elevation.getMinMaxForTile(m);J&&(I+=J.max)}const M=[...b.shadowDirection];M[2]=-M[2];const N=b.computeSimplifiedTileShadowVolume(T,I,E,M);if(!N)return!1;const j=[eu,Mb,Cl,M,[M[0],0,M[2]],[0,M[1],M[2]]],W=g.projection.name==="globe",Z=g.scaleZoom(E),Y=i.cB.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,Z,!W),te=b.getCurrentCascadeFrustum();return Y.intersectsPrecise(N.vertices,N.planes,j)===0||te.intersectsPrecise(N.vertices,N.planes,j)===0}function mg(m){const{painter:o,source:d,layer:g,coords:b}=m;let T=m.defines;const E=o.context,I=o.renderPass==="shadow",M=o.renderPass==="light-beam",N=o.shadowRenderer,j=i.ef(o.transform.center.lat,o.transform.zoom),W=Mh(o,g.paint.get("building-cutoff-fade-range"));W.shouldRenderCutoff&&(T=T.concat("RENDER_CUTOFF")),m.floodLightIntensity>0&&(T=T.concat("FLOOD_LIGHT"));for(const Z of b){const Y=d.getTile(Z),te=Y.getBucket(g);if(!te)continue;N&&N.getMaxCascadeForTile(Z.toUnwrapped())===0&&(T=T.concat("SHADOWS_SINGLE_CASCADE"));const J=te.programConfigurations.get(g.id);let oe,ae,pe,_e=o.translatePosMatrix(Z.expandedProjMatrix,Y,[0,0],"map");if(_e=i.cS(i.bC(),_e,[1,1,m.verticalScale]),I&&N){if(zd(Y.tileID,te.maxHeight*j,o))continue;let Le=N.calculateShadowPassMatrixFromTile(Y.tileID.toUnwrapped());Le=i.cS(i.bC(),Le,[1,1,m.verticalScale]),pe=Fh(Le),oe=ae=o.getOrCreateProgram("buildingDepth",{config:J,defines:T,overrideFog:!1})}else if(M)oe=ae=o.getOrCreateProgram("buildingBloom",{config:J,defines:T,overrideFog:!1}),pe=QE(_e);else{const Le=o.transform.calculatePosMatrix(Z.toUnwrapped(),o.transform.worldSize);i.cS(Le,Le,[1,1,m.verticalScale]);const Ce=i.bC();i.cS(Ce,Le,[1,-1,1/j]),i.bl(Ce,Ce),i.eg(Ce,Ce);const Re=o.transform.getFreeCameraOptions().position,Ae=1<<Z.canonical.z;if(pe=Ny(_e,Ce,m.opacity,m.facadeAOIntensity,[((Re.x-Z.wrap)*Ae-Z.canonical.x)*i.al,(Re.y*Ae-Z.canonical.y)*i.al,Re.z*Ae*i.al],te.tileToMeter,m.facadeEmissiveChance,m.floodLightColor,m.floodLightIntensity),ae=o.getOrCreateProgram("building",{config:J,defines:T,overrideFog:!1}),m.depthOnly===!0)oe=ae;else{const Te=T.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);oe=o.getOrCreateProgram("building",{config:J,defines:Te,overrideFog:!1})}N&&(N.setupShadowsFromMatrix(Le,ae,!0),oe!==ae&&N.setupShadowsFromMatrix(Le,oe,!0))}const me=(Le,Ce)=>{if(M){const Re=Le.entranceBloom;Ce.draw(o,E.gl.TRIANGLES,m.depthMode,Mr.disabled,m.blendMode,Rr.disabled,pe,g.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segmentsBucket,g.paint,o.transform.zoom,J,[Re.layoutAttenuationBuffer,Re.layoutColorBuffer])}else{const Re=Le.segmentsBucket;let Ae=[Le.layoutNormalBuffer,Le.layoutCentroidBuffer,Le.layoutColorBuffer,Le.layoutFloodLightDataBuffer];Le.layoutFacadePaintBuffer&&(Ae=Ae.concat([Le.layoutFacadeDataBuffer,Le.layoutFacadeVerticalRangeBuffer,Le.layoutFacadePaintBuffer])),Ce.draw(o,E.gl.TRIANGLES,m.depthMode,Mr.disabled,m.blendMode,I?Rr.disabled:Rr.backCW,pe,g.id,Le.layoutVertexBuffer,Le.indexBuffer,Re,g.paint,o.transform.zoom,J,Ae)}};o.uploadCommonUniforms(E,ae,Z.toUnwrapped(),null,W),te.buildingWithoutFacade&&me(te.buildingWithoutFacade,ae),te.buildingWithFacade&&(oe!==ae&&o.uploadCommonUniforms(E,oe,Z.toUnwrapped(),null,W),me(te.buildingWithFacade,oe))}}function Hy(m,o,d,g,b,T,E,I,M,N,j,W,Z){const Y=m.context.gl,te=m.depthModeForSublayer(1,Fn.ReadOnly,Y.LEQUAL,!0),J=.1*(1-(oe=j))+3*oe;var oe;const ae=m._showOverdrawInspector,pe=W,_e=new Rb;ae||Nd(_e,m,o,d,g,te,new Mr({func:Y.ALWAYS,mask:255},255,255,Y.KEEP,Y.KEEP,Y.REPLACE),new Vr([Y.ONE,Y.ONE,Y.ONE,Y.ONE],i.ao.transparent,[!1,!1,!1,!0],Y.MIN),Rr.disabled,b,"sdf",T,E,I,M,N,J,pe,!1);{const me=ae?Mr.disabled:new Mr({func:Y.EQUAL,mask:255},255,255,Y.KEEP,Y.DECR,Y.DECR),Le=ae?m.colorModeForRenderPass():new Vr([Y.ONE_MINUS_DST_ALPHA,Y.DST_ALPHA,Y.ONE,Y.ONE],i.ao.transparent,[!0,!0,!0,!0]);Nd(_e,m,o,d,g,te,me,Le,Rr.disabled,b,"color",T,E,I,M,N,J,pe,!1)}}function Gy(m){return[m[0]*i.eh,m[1]*i.eh,m[2]*i.eh,0]}function gg(m,o,d,g,b,T,E,I,M){const N=g.getSource(),j=d.globeSharedBuffers;if(!j)return;let W,Z,Y;if(o&&(W=g.getTile(o)),N instanceof i.aU?(Z=N.texture,Y=i.dK(0,0,d.transform)):W&&o&&(Z=W.texture,Y=i.dK(o.canonical.z,o.canonical.x,d.transform)),!Z||!Y)return;m||(Y=i.cS(i.bC(),Y,[1,-1,1]));const te=d.context,J=te.gl,oe=b.paint.get("raster-resampling")==="nearest"?J.NEAREST:J.LINEAR,ae=d.colorModeForDrapableLayerRenderPass(T),pe=E.defines;pe.push("GLOBE_POLES");const _e=new Fn(J.LEQUAL,Fn.ReadWrite,d.depthRangeFor3D),me=Float32Array.from(d.transform.expandedFarZProjMatrix),Le=Float32Array.from(i.bk(i.dJ(new i.cD(0,0,0))));d.terrain&&d.terrain.prepareDrawTile(),te.activeTexture.set(J.TEXTURE0),Z.bind(oe,J.CLAMP_TO_EDGE),te.activeTexture.set(J.TEXTURE1),Z.bind(oe,J.CLAMP_TO_EDGE),"useMipmap"in Z&&te.extTextureFilterAnisotropic&&d.transform.pitch>20&&J.texParameterf(J.TEXTURE_2D,te.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,te.extTextureFilterAnisotropicMax);const[Ce,Re,Ae,Te]=o?j.getPoleBuffers(o.canonical.z,!1):j.getPoleBuffers(0,!0),ze=b.paint.get("raster-elevation");let We;m?(We=Ce,d.renderDefaultNorthPole=ze!==0):(We=Re,d.renderDefaultSouthPole=ze!==0);const Ge=Gy(E.mix),ct=((Et,Ut,it,Ue,_t,ut,Pt,nn,_n,Yt,Vt,On,Cn)=>tS(Et,Ut,it,new Float32Array(16),new Float32Array(9),[0,0],Ue,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ut,[0,0],nn,2,Yt,Vt,On,1,0,Cn))(me,Le,Y,i.aj(d.transform.zoom),0,b,0,ze,0,Ge,E.offset,E.range,T),ht=d.getOrCreateProgram("raster",{defines:pe});d.uploadCommonUniforms(te,ht,null),ht.draw(d,J.TRIANGLES,_e,M,ae,I,ct,b.id,We,Ae,Te)}function lS(m){const o=m._nearZ,d=m.projection.farthestPixelDistance(m),g=d-o,b=.2*m.height,T=o+b;return[o,d,(T-b-o)/g,(T-o)/g]}function Fd(m,o,d,g){if(m)return o instanceof _l&&m instanceof iy?o.getTextureDescriptor(m,d,!0):{texture:m.texture,mix:Gy(g.mix),offset:g.offset,buffer:0,tileSize:1}}var zs=i.ei([{name:"a_index",type:"Int16",components:1}]);class qy{constructor(o,d,g,b){const T={width:g[0],height:g[1],data:null},E=o.gl;this.targetColorTexture=new i.T(o,T,E.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(o,T,E.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(d,b),this.lastInvalidatedAt=0}updateParticleTexture(o,d){if(this.particleTextureDimension===d.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const g=this.context.gl,b=d.width*d.height;this.particleTexture0=new i.T(this.context,d,g.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,d,g.RGBA8,{premultiply:!1,useMipmap:!1});const T=new i.ej;T.reserve(b);for(let E=0;E<b;E++)T.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(T,zs.members,!0),this.particleSegment=i.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=d.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=i.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Pb(m,o,d){if(!m)return null;const g=o.getTextureDescriptor(m,d,!0);if(!g)return null;let{texture:b,mix:T,offset:E,tileSize:I,buffer:M,format:N}=g;if(!b||!N)return null;let j=!1;return N==="uint32"&&(j=!0,T[3]=0,T=zy(i.ek,T,[0,d.paint.get("raster-particle-max-speed")]),E=Fy(i.ek,E,[0,d.paint.get("raster-particle-max-speed")])),{texture:b,textureOffset:[M/(I+2*M),I/(I+2*M)],tileSize:I,scalarData:j,scale:T,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[N]]}}function uS(m){const o=m._nearZ,d=m.projection.farthestPixelDistance(m),g=d-o,b=.2*m.height,T=o+b;return[o,d,(T-b-o)/g,(T-o)/g]}const cS=new i.ao(1,0,0,1),dS=new i.ao(0,1,0,1),hS=new i.ao(0,0,1,1),$f=new i.ao(1,0,1,1),Hf=new i.ao(0,1,1,1);function Wt(m,o,d,g,b,T){for(let E=0;E<d.length;E++)if(b){const N=new i.ao(g.r*.8,g.g*.8,g.b*.8,1);an(m,o,d[E],g,-1,-1,T),an(m,o,d[E],g,-1,1,T),an(m,o,d[E],g,1,1,T),an(m,o,d[E],g,1,-1,T),an(m,o,d[E],N,0,0,T)}else an(m,o,d[E],g,0,0,T)}function an(m,o,d,g,b,T,E){const I=m.context,M=m.transform,N=I.gl,j=M.projection.name==="globe",W=j?["PROJECTION_GLOBE_VIEW"]:[];let Z=i.bz(d.projMatrix);if(j&&i.aj(M.zoom)>0){const Ge=i.bj(d.canonical,M),ct=i.el(Ge);Z=i.aB(new Float32Array(16),M.globeMatrix,ct),i.aB(Z,M.projMatrix,Z)}const Y=i.bC();Y[12]+=2*b/(i.o.devicePixelRatio*M.width),Y[13]+=2*T/(i.o.devicePixelRatio*M.height),i.aB(Z,Y,Z);const te=m.getOrCreateProgram("debug",{defines:W}),J=o.getTileByID(d.key);m.terrain&&m.terrain.setupElevationDraw(J,te);const oe=Fn.disabled,ae=Mr.disabled,pe=m.colorModeForRenderPass(),_e="$debug";I.activeTexture.set(N.TEXTURE0),m.emptyTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),j?J._makeGlobeTileDebugBuffers(m.context,M):J._makeDebugTileBoundsBuffers(m.context,M.projection);const me=J._tileDebugBuffer||m.debugBuffer,Le=J._tileDebugIndexBuffer||m.debugIndexBuffer,Ce=J._tileDebugSegments||m.debugSegments;if(te.draw(m,N.LINE_STRIP,oe,ae,pe,Rr.disabled,dg(Z,g.toPremultipliedRenderColor(null)),_e,me,Le,Ce,null,null,null,[J._globeTileDebugBorderBuffer]),E){const Ge=J.latestRawTileData,ct=Math.floor((Ge&&Ge.byteLength||0)/1024);let ht=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ht+=` => ${d.overscaledZ}`),ht+=` ${J.state}`,ht+=` ${ct}kb`,function(Et,Ut){Et.initDebugOverlayCanvas();const it=Et.debugOverlayCanvas,Ue=Et.context.gl,_t=Et.debugOverlayCanvas.getContext("2d");_t.clearRect(0,0,it.width,it.height),_t.shadowColor="white",_t.shadowBlur=2,_t.lineWidth=1.5,_t.strokeStyle="white",_t.textBaseline="top",_t.font="bold 36px Open Sans, sans-serif",_t.fillText(Ut,5,5),_t.strokeText(Ut,5,5),Et.debugOverlayTexture.update(it),Et.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(m,ht)}const Re=o.getTile(d).tileSize,Ae=512/Math.min(Re,512)*(d.overscaledZ/M.zoom)*.5,Te=J._tileDebugTextBuffer||m.debugBuffer,ze=J._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,We=J._tileDebugTextSegments||m.debugSegments;te.draw(m,N.TRIANGLES,oe,ae,Vr.alphaBlended,Rr.disabled,dg(Z,i.ao.transparent.toPremultipliedRenderColor(null),Ae),_e,Te,ze,We,null,null,null,[J._globeTileDebugTextBuffer])}function Gf(m,o,d,g){Qe(m,0,o+d/2,m.transform.width,d,g)}function xa(m,o,d,g){Qe(m,o-d/2,0,d,m.transform.height,g)}function Qe(m,o,d,g,b,T){const E=m.context,I=E.gl;I.enable(I.SCISSOR_TEST),I.scissor(o*i.o.devicePixelRatio,d*i.o.devicePixelRatio,g*i.o.devicePixelRatio,b*i.o.devicePixelRatio),E.clear({color:T}),I.disable(I.SCISSOR_TEST)}const fS=i.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Zy}=fS;function rd(m,o,d,g){m.emplaceBack(o,d,g)}class Wy{constructor(o){this.vertexArray=new i.em,this.indices=new i.b0,rd(this.vertexArray,-1,-1,1),rd(this.vertexArray,1,-1,1),rd(this.vertexArray,-1,1,1),rd(this.vertexArray,1,1,1),rd(this.vertexArray,-1,-1,-1),rd(this.vertexArray,1,-1,-1),rd(this.vertexArray,-1,1,-1),rd(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Zy),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=i.bg.simpleSegment(0,0,36,12)}}function qf(m,o,d,g,b,T){const E=m.context.gl,I=o.paint.get("sky-atmosphere-color"),M=o.paint.get("sky-atmosphere-halo-color"),N=o.paint.get("sky-atmosphere-sun-intensity"),j=((W,Z,Y,te,J)=>({u_matrix_3f:W,u_sun_direction:Z,u_sun_intensity:Y,u_color_tint_r:[te.r,te.g,te.b,te.a],u_color_tint_m:[J.r,J.g,J.b,J.a],u_luminance:5e-5}))(i.eo(i.dO(),g),b,N,I.toPremultipliedRenderColor(null),M.toPremultipliedRenderColor(null));E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+T,o.skyboxTexture,0),d.draw(m,E.TRIANGLES,Fn.disabled,Mr.disabled,Vr.unblended,Rr.frontCW,j,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const pS=i.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class sm{constructor(o){const d=new i.ep;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const g=new i.b0;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(d,pS.members),this.indexBuffer=o.createIndexBuffer(g),this.segments=i.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const PI=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class OI{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class mS{constructor(o){this.colorModeAlphaBlendedWriteRGB=new Vr([1,Jc,1,Jc],i.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Vr([1,0,1,0],i.ao.transparent,[!1,!1,!1,!0]),this.params=new OI,this.updateNeeded=!0}update(o){const d=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new sm(d);const g=this.params.sizeRange,b=this.params.intensityRange,T=function(j){const W=i.eq(30),Z=[];for(let Y=0;Y<j;++Y){const te=2*Math.PI*W(),J=Math.acos(1-2*W())-.5*Math.PI;Z.push(i.d5(Math.cos(J)*Math.cos(te),Math.cos(J)*Math.sin(te),Math.sin(J)))}return Z}(this.params.starsCount),E=i.eq(300),I=new i.er,M=new i.b0;let N=0;for(let j=0;j<T.length;++j){const W=i.c5([],T[j],200),Z=Math.max(0,1+.01*g*(1*E()-.5)),Y=Math.max(0,1+.01*b*(1*E()-.5));I.emplaceBack(W[0],W[1],W[2],-1,-1,Z,Y),I.emplaceBack(W[0],W[1],W[2],1,-1,Z,Y),I.emplaceBack(W[0],W[1],W[2],1,1,Z,Y),I.emplaceBack(W[0],W[1],W[2],-1,1,Z,Y),M.emplaceBack(N+0,N+1,N+2),M.emplaceBack(N+0,N+2,N+3),N+=4}this.starsVx=d.createVertexBuffer(I,PI.members),this.starsIdx=d.createIndexBuffer(M),this.starsSegments=i.bg.simpleSegment(0,0,I.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,d){const g=o.context,b=g.gl,T=o.transform,E=new Fn(b.LEQUAL,Fn.ReadOnly,[0,1]),I=i.aj(T.zoom),M=o.style.getLut(d.scope),N=d.properties.get("color-use-theme")==="none",j=d.properties.get("color").toNonPremultipliedRenderColor(N?null:M),W=d.properties.get("high-color-use-theme")==="none",Z=d.properties.get("high-color").toNonPremultipliedRenderColor(W?null:M),Y=d.properties.get("space-color-use-theme")==="none",te=d.properties.get("space-color").toNonPremultipliedRenderColor(Y?null:M),J=5e-4,oe=i.es(d.properties.get("horizon-blend"),0,1,J,.25),ae=i.dE(o,g,T)&&oe===J?T.worldSize/(2*Math.PI*1.025)-1:T.globeRadius,pe=o.frameCounter/1e3%1,_e=i.ag(T.globeCenterInViewSpace),me=Math.sqrt(Math.pow(_e,2)-Math.pow(ae,2)),Le=Math.acos(me/_e),Ce=Re=>{const Ae=T.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Re&&Ae.push("ALPHA_PASS");const Te=o.getOrCreateProgram("globeAtmosphere",{defines:Ae}),ze=((Ge,ct,ht,Et,Ut,it,Ue,_t,ut,Pt,nn,_n)=>({u_frustum_tl:Ge,u_frustum_tr:ct,u_frustum_br:ht,u_frustum_bl:Et,u_horizon:Ut,u_transition:it,u_fadeout_range:Ue,u_atmosphere_fog_color:_t.toArray01(),u_high_color:ut.toArray01(),u_space_color:Pt.toArray01(),u_temporal_offset:nn,u_horizon_angle:_n}))(T.frustumCorners.TL,T.frustumCorners.TR,T.frustumCorners.BR,T.frustumCorners.BL,T.frustumCorners.horizon,I,oe,j,Z,te,pe,Le);o.uploadCommonUniforms(g,Te);const We=this.atmosphereBuffer;We&&Te.draw(o,b.TRIANGLES,E,Mr.disabled,Re?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Rr.backCW,ze,Re?"atmosphere_glow_alpha":"atmosphere_glow",We.vertexBuffer,We.indexBuffer,We.segments)};Ce(!1),Ce(!0)}drawStars(o,d){const g=i.aA(d.properties.get("star-intensity"),0,1);if(g===0)return;const b=o.context,T=b.gl,E=o.transform,I=o.getOrCreateProgram("stars"),M=i.c7([]);i.c9(M,M,-E._pitch),i.c8(M,M,-E.angle),i.c9(M,M,i.an(E._center.lat)),i.et(M,M,-i.an(E._center.lng));const N=i.cc(new Float32Array(16),M),j=i.aB([],E.starsProjMatrix,N),W=i.eo([],N),Z=i.eu([],W),Y=[0,1,0];i.dQ(Y,Y,Z),i.c5(Y,Y,this.params.sizeMultiplier);const te=[1,0,0];i.dQ(te,te,Z),i.c5(te,te,this.params.sizeMultiplier);const J=(oe=Y,ae=te,pe=g,{u_matrix:Float32Array.from(j),u_up:oe,u_right:ae,u_intensity_multiplier:pe});var oe,ae,pe;o.uploadCommonUniforms(b,I),this.starsVx&&this.starsIdx&&I.draw(o,T.TRIANGLES,Fn.disabled,Mr.disabled,this.colorModeAlphaBlendedWriteRGB,Rr.disabled,J,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Xy{constructor(){this.visibleTiles=[]}updateBorders(o,d){const g=[],b=[],T=o._getRenderableCoordinates(!1,!0);for(const M of T){const N=o.getTile(M);if(!N.hasData())continue;const j=N.getBucket(d);j&&(j.isEmpty()||(g.push(M.key),b.push({bucket:j,tileID:M.canonical})))}let E=g.length!==this.visibleTiles.length;if(!E){g.sort();for(let M=0;M<g.length;M++)if(g[M]!==this.visibleTiles[M]){E=!0;break}}if(!E)return;const I=new Set;this.visibleTiles=g,b.sort((M,N)=>M.tileID.z-N.tileID.z||M.tileID.x-N.tileID.x||M.tileID.y-N.tileID.y);for(const M of b){const N=new Array,j=new Array,W=M.bucket;for(const Z of W.featuresOnBorder)I.has(Z.featureId)?j.push(Z.footprintIndex):(I.add(Z.featureId),N.push(Z.footprintIndex));W.updateFootprintHiddenFlags(N,i.ev,!1),W.updateFootprintHiddenFlags(j,i.ev,!0)}}}function Yy(m,o){const d=[...m],g=o.cameraWorldSizeForFog/o.worldSize,b=i.bA([]);return i.cS(b,b,[g,g,1]),i.aB(d,b,d),i.aB(d,o.worldToFogMatrix,d),d}function Ky(m,o,d,g,b){const T=d.material,E=g.context,{baseColorTexture:I,metallicRoughnessTexture:M}=T.pbrMetallicRoughness,{normalTexture:N,occlusionTexture:j,emissionTexture:W}=T;function Z(te,J,oe){if(te&&(m.push(J),E.activeTexture.set(E.gl.TEXTURE0+oe),te.gfxTexture)){const{minFilter:ae,magFilter:pe,wrapS:_e,wrapT:me}=te.sampler;te.gfxTexture.bindExtraParam(ae,pe,_e,me)}}Z(I,"HAS_TEXTURE_u_baseColorTexture",Mo.BaseColor),Z(M,"HAS_TEXTURE_u_metallicRoughnessTexture",Mo.MetallicRoughness),Z(N,"HAS_TEXTURE_u_normalTexture",Mo.Normal),Z(j,"HAS_TEXTURE_u_occlusionTexture",Mo.Occlusion),Z(W,"HAS_TEXTURE_u_emissionTexture",Mo.Emission),b&&(b.texture||(b.texture=new i.d$(g.context,b.image,[b.image.height,b.image.height,b.image.height],E.gl.RGBA8)),E.activeTexture.set(E.gl.TEXTURE0+Mo.LUT),b.texture&&b.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),d.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(d.texcoordBuffer)),d.colorBuffer&&(m.push(d.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(d.colorBuffer)),d.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(d.normalBuffer)),d.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(d.pbrBuffer)),T.alphaMode!=="OPAQUE"&&T.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),T.defined||m.push("DIFFUSE_SHADED");const Y=g.shadowRenderer;Y&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Y.useNormalOffset&&m.push("NORMAL_OFFSET"))}function Qy(m,o,d,g,b,T){const E=m.modelOpacity,I=o.context,M=new Fn(o.context.gl.LEQUAL,m.isLightMesh?Fn.ReadOnly:Fn.ReadWrite,o.depthRangeFor3D),N=o.transform,j=m.mesh,W=j.material,Z=W.pbrMetallicRoughness,Y=o.style.fog;let te;te=o.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:i.aB([],g.zScaleMatrix,m.nodeModelMatrix),i.aB(te,g.negCameraPosMatrix,te);const J=i.bl([],te);i.eg(J,J);const oe=d.paint.get("model-color-use-theme").constantOr("default")==="none",ae=d.paint.get("model-emissive-strength").constantOr(0),pe=Uf(new Float32Array(m.worldViewProjection),new Float32Array(te),new Float32Array(J),null,o,E,Z.baseColorFactor,W.emissiveFactor,Z.metallicFactor,Z.roughnessFactor,W,ae,d,void 0,void 0,m.materialOverride,m.modelColor),_e={defines:[]},me=[],Le=o.shadowRenderer;Le&&(Le.useNormalOffset=!1),Ky(_e.defines,me,j,o,oe?null:d.lut);let Ce=null;if(Y){const Te=Yy(m.nodeModelMatrix,o.transform);if(Ce=new Float32Array(Te),N.projection.name!=="globe"){const ze=j.aabb.min,We=j.aabb.max,[Ge,ct]=Y.getOpacityForBounds(Te,ze[0],ze[1],We[0],We[1]);_e.overrideFog=Ge>=xt||ct>=xt}}const Re=Mh(o,d.paint.get("model-cutoff-fade-range"));Re.shouldRenderCutoff&&_e.defines.push("RENDER_CUTOFF");const Ae=o.getOrCreateProgram("model",_e);o.uploadCommonUniforms(I,Ae,null,Ce,Re),o.renderPass!=="shadow"&&Le&&Le.setupShadowsFromMatrix(m.nodeModelMatrix,Ae),Ae.draw(o,I.gl.TRIANGLES,M,b,T,j.material.doubleSided?Rr.disabled:Rr.backCCW,pe,d.id,j.vertexBuffer,j.indexBuffer,j.segments,d.paint,o.transform.zoom,void 0,me)}function _g(m,o){return m.style._importedAsBasemap?"basemap":o.scope}function Zf(m,o,d,g,b,T,E,I,M,N){const j=m.transform,W=!!o.isGeometryBloom&&o.isGeometryBloom;if(W&&m.renderPass==="shadow")return;const Z=j.projection.name==="globe"?i.eD(d,j):[...d];i.aB(Z,Z,o.globalMatrix);const Y=i.aB([],g,Z);if(o.meshes)for(const te of o.meshes){const J=I.get(te.material.name);if(J&&J.opacity<=0)continue;if(te.material.alphaMode!=="BLEND"){E.push({mesh:te,depth:0,modelIndex:b,worldViewProjection:Y,nodeModelMatrix:Z,isLightMesh:W,materialOverride:J,modelOpacity:M,modelColor:N});continue}const oe=i.af([],te.centroid,Y);!j.isOrthographic&&oe[2]<=0||T.push({mesh:te,depth:oe[2],modelIndex:b,worldViewProjection:Y,nodeModelMatrix:Z,isLightMesh:W,materialOverride:J,modelOpacity:M,modelColor:N})}if(o.children)for(const te of o.children)Zf(m,te,d,g,b,T,E,I,M,N)}function Tc(m,o,d,g){const b=d.shadowRenderer;if(!b)return;const T=b.getShadowPassDepthMode(),E=b.getShadowPassColorMode(),I=b.calculateShadowPassMatrixFromMatrix(o),M=Cb(I);d.getOrCreateProgram("modelDepth",{defines:d._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(d,d.context.gl.TRIANGLES,T,Mr.disabled,E,Rr.disabled,M,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,d.transform.zoom,void 0,void 0)}function gS(m,o,d,g,b,T){for(const E of b){const I=Object.assign({},g);I.part=E;const M={type:"Unknown",id:o,properties:I},N={orientation:m.paint.get("model-rotation").evaluate(M,d)};T.set(E,N)}}function _S(m,o,d,g,b,T){for(const E of b){const I=Object.assign({},g);I.part=E;const M={type:"Unknown",id:o,properties:I},N={color:m.paint.get("model-color").evaluate(M,d),colorMix:m.paint.get("model-color-mix-intensity").evaluate(M,d),opacity:m.paint.get("model-opacity").evaluate(M,d),emissionStrength:m.paint.get("model-emissive-strength").evaluate(M,d)};T.set(E,N)}}function yS(m,o,d,g,b){let T=!1;for(const I of g)I.modelOpacity!==1&&(Qy(I,m,o,b[I.modelIndex],Mr.disabled,Vr.disabled),T=!0);for(const I of g)Qy(I,m,o,b[I.modelIndex],I.modelOpacity!==1?m.stencilModeFor3D():Mr.disabled,m.colorModeForRenderPass());T&&m.resetStencilClippingMasks();const E=Vr.additive;for(const I of d)Qy(I,m,o,b[I.modelIndex],Mr.disabled,I.isLightMesh?E:m.colorModeForRenderPass())}function vS(m,o,d){const g=o.updateZoomBasedPaintProperties(),b=function(T,E,I){let M,N,j,W=T.terrain?T.terrain.exaggeration():0;if(T.terrain&&W>0){const Z=T.terrain,Y=Z.findDEMTileFor(I);Y&&Y.dem?M=i.eF.create(Z,I,Y):W=0}if(W===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),W===E.validForExaggeration&&(W===0||M&&M._demTile&&M._demTile.tileID===E.validForDEMTile.id&&M._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const Z in E.instancesPerModel){const Y=E.instancesPerModel[Z];for(let te=0;te<Y.instancedDataArray.length;++te){const J=(M?W*M.getElevationAt(0|Y.instancedDataArray.float32[16*te],0|Y.instancedDataArray.float32[16*te+1],!0,!0):0)+Y.instancesEvaluatedElevation[te];Y.instancedDataArray.float32[16*te+6]=J,N=N?Math.min(E.terrainElevationMin,J):J,j=j?Math.max(E.terrainElevationMax,J):J}}return E.terrainElevationMin=N||0,E.terrainElevationMax=j||0,E.validForExaggeration=W,E.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,o,d);(g||b)&&(o.uploaded=!1,o.upload(m.context))}const id={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.d9([0,0,0],[i.al,i.al,0])};function kl(m,o){const d=1<<m.canonical.z,g=o.getFreeCameraOptions().position,b=o.elevation,T=m.canonical.x/d,E=(m.canonical.x+1)/d,I=m.canonical.y/d,M=(m.canonical.y+1)/d;let N=o._centerAltitude;if(b){const Y=b.getMinMaxForTile(m);Y&&Y.max>N&&(N=Y.max)}const j=i.aA(g.x,T,E)-g.x,W=i.aA(g.y,I,M)-g.y,Z=i.cf(N,o.center.lat)-g.z;return o._zoomFromMercatorZ(Math.sqrt(j*j+W*W+Z*Z))}function xS(m,o,d,g,b,T,E){const I=m.context,M=m.renderPass==="shadow",N=m.shadowRenderer,j=M&&N?N.getShadowPassDepthMode():new Fn(I.gl.LEQUAL,Fn.ReadWrite,m.depthRangeFor3D),W=m.isTileAffectedByFog(T),Z=m.transform.projection.name==="globe";if(d.meshes)for(const Y of d.meshes){const te=Z?[]:["MODEL_POSITION_ON_GPU"],J=[];let oe,ae,pe;const _e=!Z&&g.instancedDataArray.length>20;_e&&te.push("INSTANCED_ARRAYS");const me=Mh(m,o.paint.get("model-cutoff-fade-range"));if(me.shouldRenderCutoff&&te.push("RENDER_CUTOFF"),M&&N)oe=m.getOrCreateProgram("modelDepth",{defines:te}),ae=Cb(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(d.globalMatrix)),pe=N.getShadowPassColorMode();else{Ky(te,J,Y,m,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),oe=m.getOrCreateProgram("model",{defines:te,overrideFog:W});const Ce=Y.material,Re=Ce.pbrMetallicRoughness,Ae=o.paint.get("model-opacity").constantOr(1),Te=o.paint.get("model-emissive-strength").constantOr(0);ae=Uf(T.expandedProjMatrix,Float32Array.from(d.globalMatrix),new Float32Array(16),null,m,Ae,Re.baseColorFactor,Ce.emissiveFactor,Re.metallicFactor,Re.roughnessFactor,Ce,Te,o,b),N&&(E.shadowUniformsInitialized?oe.setShadowUniformValues(I,N.getShadowUniformValues()):(N.setupShadows(T.toUnwrapped(),oe,"model-tile"),E.shadowUniformsInitialized=!0)),pe=me.shouldRenderCutoff||Ae<1||Ce.alphaMode!=="OPAQUE"?Vr.alphaBlended:Vr.unblended}m.uploadCommonUniforms(I,oe,T.toUnwrapped(),null,me);const Le=Y.material.doubleSided?Rr.disabled:Rr.backCCW;if(_e)J.push(g.instancedDataBuffer),oe.draw(m,I.gl.TRIANGLES,j,Mr.disabled,pe,Le,ae,o.id,Y.vertexBuffer,Y.indexBuffer,Y.segments,o.paint,m.transform.zoom,void 0,J,g.instancedDataArray.length);else{const Ce=M?"u_instance":"u_normal_matrix";for(let Re=0;Re<g.instancedDataArray.length;++Re)ae[Ce]=new Float32Array(g.instancedDataArray.arrayBuffer,64*Re,16),oe.draw(m,I.gl.TRIANGLES,j,Mr.disabled,pe,Le,ae,o.id,Y.vertexBuffer,Y.indexBuffer,Y.segments,o.paint,m.transform.zoom,void 0,J)}}if(d.children)for(const Y of d.children)xS(m,o,Y,g,b,T,E)}const yg=[1,-1,1];function LI(m,o,d,g){if(!d.modelManager)return!0;const b=d.modelManager;if(!d.shadowRenderer)return!0;const T=d.shadowRenderer,E=o.aabb;let I=!0,M=m.maxHeight;if(M===0){let j=0;for(const W in m.instancesPerModel){const Z=b.getModel(W,g);Z?j=Math.max(j,Math.max(Math.max(Z.aabb.max[0],Z.aabb.max[1]),Z.aabb.max[2])):I=!1}M=m.maxScale*j*1.41+m.maxVerticalOffset,I&&(m.maxHeight=M)}E.max[2]=M,E.min[2]+=m.terrainElevationMin,E.max[2]+=m.terrainElevationMax,i.af(E.min,E.min,o.tileMatrix),i.af(E.max,E.max,o.tileMatrix);const N=E.intersects(T.getCurrentCascadeFrustum());return d.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=N===2),N===0}function Js(m,o){const d=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],b=m.uniformValues.u_cutoff_params[2],T=m.uniformValues.u_cutoff_params[3];return g===d||T===b?1:i.aA(((o-d)/(g-d)-b)/(T-b),0,1)}function hi(m,o,d,g){if(o.pitch<20)return 1;const b=o.getWorldToCameraMatrix();i.aB(b,b,m);const T=i.bU(d.min[0],d.min[1],d.min[2],1);let E=i.aC(i.eG(),T,b),I=E,M=E;T[1]=d.max[1],E=i.aC(i.eG(),T,b),I=E[1]<I[1]?E:I,M=E[1]>M[1]?E:M,T[0]=d.max[0],E=i.aC(i.eG(),T,b),I=E[1]<I[1]?E:I,M=E[1]>M[1]?E:M,T[1]=d.min[1],E=i.aC(i.eG(),T,b),I=E[1]<I[1]?E:I,M=E[1]>M[1]?E:M;const N=i.aA(g[0],0,1),j=100*o.pixelsPerMeter*i.aA(g[1],0,1),W=i.aA(g[2],0,1),Z=i.eH(i.eG(),I,M,N),Y=Math.tan(.5*o.fovX),te=-Z[2]*Y;if(j===0)return Z[1]<-Math.abs(te)?W:1;const J=(-Math.abs(te)-Z[1])/j,oe=(pe,_e,me)=>(1-me)*pe+me*_e,ae=i.aA(oe(1,W,J),W,1);return oe(1,ae,i.aA((o.pitch-20)/20,0,1))}class bS{}class Uh{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,d,g){{const W=this._storage.get(d.id);if(W)return W.lastUsedFrameIdx=o,W.buf}const b=g.gl,T=b.getBufferParameter(b.ELEMENT_ARRAY_BUFFER,b.BUFFER_SIZE),E=new ArrayBuffer(T),I=new Int16Array(E);b.getBufferSubData(b.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const M=new i.eJ;for(let W=0;W<T/2;W+=3){const Z=I[W],Y=I[W+1],te=I[W+2];M.emplaceBack(Z,Y),M.emplaceBack(Y,te),M.emplaceBack(te,Z)}const N=g.bindVertexArrayOES.current,j=new bS;return j.buf=new wc(g,M),j.lastUsedFrameIdx=o,this._storage.set(d.id,j),g.bindVertexArrayOES.set(N),j.buf}update(o){for(const[d,g]of this._storage)o-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(d))}destroy(){for(const[o,d]of this._storage)d.buf.destroy(),this._storage.delete(o)}}class am{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const om=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Bd{constructor(o){this.revealStart=11,this.revealRange=2}}const Ob=i.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class Lb{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,d){const g=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const E=new i.eK,I=new i.b0;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(1,1),E.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(E,Ob.members),this.vignetteIdx=o.context.createIndexBuffer(I)}const b=i.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,g);const E={u_vignetteShape:(T={vignetteShape:[d.start,d.range,Math.pow(10,d.fadePower)],vignetteColor:[d.color.r,d.color.g,d.color.b,d.color.a*d.strength]}).vignetteShape,u_vignetteColor:T.vignetteColor};g.draw(o,o.context.gl.TRIANGLES,Fn.disabled,Mr.disabled,Vr.alphaBlended,Rr.disabled,E,"vignette",this.vignetteVx,this.vignetteIdx,b)}var T}}class Db{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,d){const g=o.getFreeCameraOptions().position,b=g.toAltitude(),T=g.toLngLat(),E=i.an(T.lng),I=i.an(T.lat),M=o.pixelsPerMeter/d,N=E*i.eM,j=i.eM*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const W=-this._offsetYPrev+j,Z=-this._elevationPrev+b;this._accumulatedOffsetX+=(-this._offsetXPrev+N)*M,this._accumulatedOffsetY+=W*M,this._accumulatedElevation+=Z*M,this._offsetXPrev=N,this._offsetYPrev=j,this._elevationPrev=b}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Jy(m,o){return[-(m[0]-Math.floor(m[0]/o)*o),-(m[1]-Math.floor(m[1]/o)*o),-(m[2]-Math.floor(m[2]/o)*o)]}function vu(m){const o=i.eq(1323123451230),d=[];for(let g=0;g<m;++g){const b=2*o()-1,T=2*o()-1,E=2*o()-1;d.push(i.d5(b,T,E))}return d}function Fl(m,o,d,g,b){const T=i.aA((b-d)/(g-d),0,1);return(1-T)*m+T*o}class Wf{constructor(o){this._movement=new Db,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Lb,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,d){const g=o.transform;this._movement.update(g,this._ppmScaleFactor);const b=g.starsProjMatrix,T=i.c7([]);i.c9(T,T,i.an(90)-g._pitch),i.c8(T,T,-g.angle);const E=i.cc(new Float32Array(16),T),I=i.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),M=i.eg([],I),N=i.aB([],M,E),j=Date.now()/1e3;return this._accumulatedTimeFromStart+=(j-this._prevTime)*d,this._prevTime=j,{projectionMatrix:b,modelviewMatrix:N}}}class e1 extends Wf{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Bd("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){const d=o.context;if(!this.particlesVx){const g=vu(this.particlesCount),b=new i.eN,T=new i.b0;let E=0;const I=i.eq(1323123451230);for(let M=0;M<g.length;++M){const N=g[M],j=[2*I()-1,I(),I(),I()];b.emplaceBack(N[0],N[1],N[2],-1,-1,...j),b.emplaceBack(N[0],N[1],N[2],1,-1,...j),b.emplaceBack(N[0],N[1],N[2],1,1,...j),b.emplaceBack(N[0],N[1],N[2],-1,1,...j),T.emplaceBack(E+0,E+1,E+2),T.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=d.createVertexBuffer(b,om.members),this.particlesIdx=d.createIndexBuffer(T)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;const d=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},g=o.transform.zoom;if(d.revealStart>g)return;const b=Fl(0,1,d.revealStart,d.revealStart+d.revealRange,g);if(!this.particlesVx||!this.particlesIdx)return;const T=structuredClone(this._params);let E=[-T.direction.x,T.direction.y,-100];i.aw(E,E);const I=structuredClone(this._vignetteParams);I.strength*=b,T.overrideStyleParameters||(T.intensity=o.style.rain.state.density,T.timeFactor=o.style.rain.state.intensity,T.color=structuredClone(o.style.rain.state.color),E=structuredClone(o.style.rain.state.direction),T.screenThinning.intensity=o.style.rain.state.centerThinning,T.dropletSizeX=o.style.rain.state.dropletSize[0],T.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],T.distortionStrength=100*o.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(o.style.rain.state.vignetteColor));const M=this.updateOnRender(o,T.timeFactor),N=o.context,j=N.gl,W=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new i.T(N,{width:o.width,height:o.height,data:null},j.RGBA8)),T.distortionStrength>0&&(N.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),j.copyTexSubImage2D(j.TEXTURE_2D,0,0,0,0,0,o.width,o.height));const Z=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms(N,Z),N.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const Y=[T.color.r,T.color.g,T.color.b,T.color.a],te=(J,oe)=>{const ae=Jy(this._movement.getPosition(),J),pe=T.dropletSizeX,_e=T.dropletSizeX*T.dropletSizeYScale,me=o.width/2,Le=o.height/2,Ce=Fl(0,T.screenThinning.start,0,1,T.screenThinning.intensity),Re=Fl(.001,T.screenThinning.range,0,1,T.screenThinning.intensity),Ae=Fl(0,T.screenThinning.particleOffset,0,1,T.screenThinning.intensity),Te=(ze={modelview:M.modelviewMatrix,projection:M.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ae,velocityConeAperture:T.velocityConeAperture,velocity:T.velocity,boxSize:J,rainDropletSize:[pe,_e],distortionStrength:T.distortionStrength,rainDirection:E,color:Y,screenSize:[W.width,W.height],thinningCenterPos:[me,Le],thinningShape:[Ce,Re,Math.pow(10,T.screenThinning.fadePower)],thinningAffectedRatio:T.screenThinning.affectedRatio,thinningParticleOffset:Ae,shapeDirectionalPower:T.shapeDirPower,shapeNormalPower:T.shapeNormalPower,mode:oe?0:1},{u_modelview:Float32Array.from(ze.modelview),u_projection:Float32Array.from(ze.projection),u_time:ze.time,u_cam_pos:ze.camPos,u_texScreen:0,u_velocityConeAperture:ze.velocityConeAperture,u_velocity:ze.velocity,u_boxSize:ze.boxSize,u_rainDropletSize:ze.rainDropletSize,u_distortionStrength:ze.distortionStrength,u_rainDirection:ze.rainDirection,u_color:ze.color,u_screenSize:ze.screenSize,u_thinningCenterPos:ze.thinningCenterPos,u_thinningShape:ze.thinningShape,u_thinningAffectedRatio:ze.thinningAffectedRatio,u_thinningParticleOffset:ze.thinningParticleOffset,u_shapeDirectionalPower:ze.shapeDirectionalPower,u_shapeNormalPower:ze.shapeNormalPower,u_mode:ze.mode});var ze;const We=Math.round(T.intensity*this.particlesCount),Ge=i.bg.simpleSegment(0,0,4*We,2*We);Z.draw(o,j.TRIANGLES,Fn.disabled,Mr.disabled,Vr.alphaBlended,Rr.disabled,Te,"rain_particles",this.particlesVx,this.particlesIdx,Ge)};T.distortionStrength>0&&te(T.boxSize,!0),te(T.boxSize,!1),this._vignette.draw(o,I)}}const Nb=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class zb extends Wf{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Bd("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){const d=o.context;if(!this.particlesVx){const g=vu(this.particlesCount),b=new i.eO,T=new i.b0;let E=0;const I=i.eq(1323123451230);for(let M=0;M<g.length;++M){const N=g[M],j=I(),W=I(),Z=I(),Y=[M/g.length,j,W,Z],te=[I(),I()];b.emplaceBack(N[0],N[1],N[2],-1,-1,...Y,...te),b.emplaceBack(N[0],N[1],N[2],1,-1,...Y,...te),b.emplaceBack(N[0],N[1],N[2],1,1,...Y,...te),b.emplaceBack(N[0],N[1],N[2],-1,1,...Y,...te),T.emplaceBack(E+0,E+1,E+2),T.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=d.createVertexBuffer(b,Nb.members),this.particlesIdx=d.createIndexBuffer(T)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;const d=structuredClone(this._params);let g=[-d.direction.x,d.direction.y,-100];i.aw(g,g);const b=structuredClone(this._vignetteParams),T=d.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},E=o.transform.zoom;if(T.revealStart>E)return;const I=Fl(0,1,T.revealStart,T.revealStart+T.revealRange,E);b.strength*=I,d.overrideStyleParameters||(d.intensity=o.style.snow.state.density,d.timeFactor=o.style.snow.state.intensity,d.color=structuredClone(o.style.snow.state.color),g=structuredClone(o.style.snow.state.direction),d.screenThinning.intensity=o.style.snow.state.centerThinning,d.billboardSize=2.79*o.style.snow.state.flakeSize,b.strength=1,b.color=structuredClone(o.style.snow.state.vignetteColor));const M=this.updateOnRender(o,d.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const N=o.context,j=N.gl,W=o.transform,Z=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms(N,Z),((Y,te,J)=>{const oe=Jy(this._movement.getPosition(),Y),ae=W.width/2,pe=W.height/2,_e=Fl(0,J.screenThinning.start,0,1,J.screenThinning.intensity),me=Fl(.001,J.screenThinning.range,0,1,J.screenThinning.intensity),Le=Fl(0,J.screenThinning.particleOffset,0,1,J.screenThinning.intensity),Ce=(Re={modelview:M.modelviewMatrix,projection:M.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:oe,velocityConeAperture:J.velocityConeAperture,velocity:J.velocity,horizontalOscillationRadius:J.horizontalOscillationRadius,horizontalOscillationRate:J.horizontalOscillationRate,boxSize:Y,billboardSize:1*J.billboardSize,simpleShapeParameters:[J.shapeFadeStart,J.shapeFadePower],screenSize:[W.width,W.height],thinningCenterPos:[ae,pe],thinningShape:[_e,me,Math.pow(10,J.screenThinning.fadePower)],thinningAffectedRatio:J.screenThinning.affectedRatio,thinningParticleOffset:Le,color:[J.color.r,J.color.g,J.color.b,J.color.a],direction:g},{u_modelview:Float32Array.from(Re.modelview),u_projection:Float32Array.from(Re.projection),u_time:Re.time,u_cam_pos:Re.camPos,u_velocityConeAperture:Re.velocityConeAperture,u_velocity:Re.velocity,u_horizontalOscillationRadius:Re.horizontalOscillationRadius,u_horizontalOscillationRate:Re.horizontalOscillationRate,u_boxSize:Re.boxSize,u_billboardSize:Re.billboardSize,u_simpleShapeParameters:Re.simpleShapeParameters,u_screenSize:Re.screenSize,u_thinningCenterPos:Re.thinningCenterPos,u_thinningShape:Re.thinningShape,u_thinningAffectedRatio:Re.thinningAffectedRatio,u_thinningParticleOffset:Re.thinningParticleOffset,u_particleColor:Re.color,u_direction:Re.direction});var Re;const Ae=Math.round(J.intensity*this.particlesCount),Te=i.bg.simpleSegment(0,0,4*Ae,2*Ae);this.particlesVx&&this.particlesIdx&&Z.draw(o,j.TRIANGLES,Fn.disabled,Mr.disabled,Vr.alphaBlended,Rr.disabled,Ce,"snow_particles",this.particlesVx,this.particlesIdx,Te)})(d.boxSize,0,d),this._vignette.draw(o,b)}}const Vh={symbol:function(m,o,d,g,b){if(m.renderPass!=="translucent")return;const T=Mr.disabled,E=m.colorModeForRenderPass(),I=d.layout.get("text-variable-anchor"),M=d.layout.get("text-size-scale-range"),N=i.aA(m.scaleFactor,M[0],M[1]);I&&function(Z,Y,te,J,oe,ae,pe,_e){const me=Y.transform,Le=oe==="map",Ce=ae==="map";for(const Re of Z){const Ae=J.getTile(Re),Te=Ae.getBucket(te);if(!Te||!Te.text||!Te.text.segments.get().length)continue;const ze=i.bK(Te.textSizeData,me.zoom,_e),We=Kc(Re,Te.getProjection(),me),Ge=me.calculatePixelsToTileUnitsMatrix(Ae),ct=yl(We,Ae.tileID.canonical,Ce,Le,me,Te.getProjection(),Ge),ht=Te.hasIconTextFit()&&Te.hasIconData();ze&&fr(Te,Le,Ce,pe,me,ct,Re,Math.pow(2,me.zoom-Ae.tileID.overscaledZ),ze,ht)}}(g,m,d,o,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b,N);const j=d.paint.get("icon-opacity").constantOr(1)!==0,W=d.paint.get("text-opacity").constantOr(1)!==0;d.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(j||W)?pg(m,o,d,g,T,E):(j&&pg(m,o,d,g,T,E,{onlyIcons:!0}),W&&pg(m,o,d,g,T,E,{onlyText:!0})),o.map.showCollisionBoxes&&(En(m,o,d,g,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),En(m,o,d,g,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(m,o,d,g){if(m.renderPass!=="translucent")return;const b=d.paint.get("circle-opacity"),T=d.paint.get("circle-stroke-width"),E=d.paint.get("circle-stroke-opacity"),I=d.layout.get("circle-sort-key").constantOr(1)!==void 0,M=d.paint.get("circle-emissive-strength");if(b.constantOr(1)===0&&(T.constantOr(1)===0||E.constantOr(1)===0))return;const N=m.context,j=N.gl,W=m.transform,Z=!(!m.terrain||!m.terrain.enabled),Y=d.layout.get("circle-elevation-reference"),te=m.depthModeForSublayer(0,Fn.ReadOnly),J=new Fn(m.context.gl.LEQUAL,Fn.ReadOnly,m.depthRangeFor3D),oe=Y==="none"||Z?te:J,ae=Mr.disabled,pe=m.colorModeForDrapableLayerRenderPass(M),_e=W.projection.name==="globe",me=[i.aF(W.center.lng),i.aJ(W.center.lat)],Le=[];for(let Re=0;Re<g.length;Re++){const Ae=g[Re],Te=o.getTile(Ae),ze=Te.getBucket(d);if(!ze||ze.projection.name!==W.projection.name)continue;const We=ze.programConfigurations.get(d.id),Ge=ze.layoutVertexBuffer,ct=ze.globeExtVertexBuffer,ht=ze.indexBuffer,Et=i.e0(d),Ut=[ct],it=m.isTileAffectedByFog(Ae);_e&&Et.push("PROJECTION_GLOBE_VIEW"),Et.push("DEPTH_D24"),m.terrain&&W.depthOcclusionForSymbolsAndCircles&&Et.push("DEPTH_OCCLUSION"),ze.hasElevation&&!m.terrain&&(Et.push("ELEVATED_ROADS"),Ut.push(ze.elevatedLayoutVertexBuffer));const Ue=m.getOrCreateProgram("circle",{config:We,defines:Et,overrideFog:it}),_t=W.projection.createInversionMatrix(W,Ae.canonical),ut={programConfiguration:We,program:Ue,layoutVertexBuffer:Ge,dynamicBuffers:Ut,indexBuffer:ht,uniformValues:i.e1(m,Ae,Te,_t,me,d),tile:Te};if(I){const Pt=ze.segments.get();for(const nn of Pt)Le.push({segments:new i.bg([nn]),sortKey:nn.sortKey,state:ut})}else Le.push({segments:ze.segments,sortKey:0,state:ut})}I&&Le.sort((Re,Ae)=>Re.sortKey-Ae.sortKey);const Ce={useDepthForOcclusion:W.depthOcclusionForSymbolsAndCircles};for(const Re of Le){const{programConfiguration:Ae,program:Te,layoutVertexBuffer:ze,dynamicBuffers:We,indexBuffer:Ge,uniformValues:ct,tile:ht}=Re.state,Et=Re.segments;m.terrain&&m.terrain.setupElevationDraw(ht,Te,Ce),m.uploadCommonUniforms(N,Te,ht.tileID.toUnwrapped()),Te.draw(m,j.TRIANGLES,oe,ae,pe,Rr.disabled,ct,d.id,ze,Ge,Et,d.paint,W.zoom,Ae,We)}},heatmap:function(m,o,d,g){if(d.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const b=m.context,T=b.gl,E=Mr.disabled,I=new Vr([T.ONE,T.ONE,T.ONE,T.ONE],i.ao.transparent,[!0,!0,!0,!0]);(function(Y,te,J,oe){const ae=Y.gl,pe=te.width*oe,_e=te.height*oe;Y.activeTexture.set(ae.TEXTURE1),Y.viewport.set([0,0,pe,_e]);let me=J.heatmapFbo;if(!me||me&&(me.width!==pe||me.height!==_e)){me&&me.destroy();const Le=ae.createTexture();ae.bindTexture(ae.TEXTURE_2D,Le),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MAG_FILTER,ae.LINEAR),me=J.heatmapFbo=Y.createFramebuffer(pe,_e,1,null),function(Ce,Re,Ae,Te,ze,We){const Ge=Ce.gl;Ge.texImage2D(Ge.TEXTURE_2D,0,Ce.extRenderToTextureHalfFloat?Ge.RGBA16F:Ge.RGBA,ze,We,0,Ge.RGBA,Ce.extRenderToTextureHalfFloat?Ge.HALF_FLOAT:Ge.UNSIGNED_BYTE,null),Te.colorAttachment0.set(Ae)}(Y,0,Le,me,pe,_e)}else ae.bindTexture(ae.TEXTURE_2D,me.colorAttachment0.get()),Y.bindFramebuffer.set(me.framebuffer)})(b,m,d,m.transform.projection.name==="globe"?.5:.25),b.clear({color:i.ao.transparent});const M=m.transform,N=M.projection.name==="globe",j=N?["PROJECTION_GLOBE_VIEW"]:[],W=N?Rr.frontCCW:Rr.disabled,Z=[i.aF(M.center.lng),i.aJ(M.center.lat)];for(let Y=0;Y<g.length;Y++){const te=g[Y];if(o.hasRenderableParent(te))continue;const J=o.getTile(te),oe=J.getBucket(d);if(!oe||oe.projection.name!==M.projection.name)continue;const ae=m.isTileAffectedByFog(te),pe=oe.programConfigurations.get(d.id),_e=m.getOrCreateProgram("heatmap",{config:pe,defines:j,overrideFog:ae}),{zoom:me}=m.transform;m.terrain&&m.terrain.setupElevationDraw(J,_e),m.uploadCommonUniforms(b,_e,te.toUnwrapped());const Le=M.projection.createInversionMatrix(M,te.canonical);_e.draw(m,T.TRIANGLES,Fn.disabled,E,I,W,eS(m,te,J,Le,Z,me,d.paint.get("heatmap-intensity")),d.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,d.paint,m.transform.zoom,pe,N?[oe.globeExtVertexBuffer]:null)}b.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(b,T){const E=b.context,I=E.gl,M=T.heatmapFbo;if(!M)return;E.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,M.colorAttachment0.get()),E.activeTexture.set(I.TEXTURE1);let N=T.colorRampTexture;N||(N=T.colorRampTexture=new i.T(E,T.colorRamp,I.RGBA8)),N.bind(I.LINEAR,I.CLAMP_TO_EDGE),b.getOrCreateProgram("heatmapTexture").draw(b,I.TRIANGLES,Fn.disabled,Mr.disabled,b.colorModeForRenderPass(),Rr.disabled,((j,W,Z,Y)=>({u_image:0,u_color_ramp:1,u_opacity:W.paint.get("heatmap-opacity")}))(0,T),T.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,T.paint,b.transform.zoom)}(m,d))},line:function(m,o,d,g){if(m.renderPass!=="translucent")return;const b=d.paint.get("line-opacity"),T=d.paint.get("line-width");if(b.constantOr(1)===0||T.constantOr(1)===0)return;const E=d.paint.get("line-emissive-strength").isConstant(),I=d.paint.get("line-emissive-strength").constantOr(0),M=d.paint.get("line-occlusion-opacity"),N=d.layout.get("line-elevation-reference"),j=d.layout.get("line-width-unit")==="meters",W=N==="sea",Z=!(!m.terrain||!m.terrain.enabled),Y=m.context,te=Y.gl;if(d.hasElevatedBuckets&&m.transform.projection.name==="globe")return;const J=d.layout.get("line-cross-slope"),oe=J!==void 0,ae=J<1,pe=m.colorModeForDrapableLayerRenderPass(E?I:null),_e=m.terrain&&m.terrain.renderingToTexture,me=_e?1:i.o.devicePixelRatio,Le=d.paint.get("line-dasharray"),Ce=Le.constantOr(1),Re=d.layout.get("line-cap"),Ae=Le.constantOr(null),Te=Re.constantOr(null),ze=d.paint.get("line-pattern"),We=ze.constantOr(1),Ge=d.paint.get("line-pattern-cross-fade"),ct=ze.constantOr(null),ht=d.paint.get("line-opacity").constantOr(1);let Et=!We&&ht!==1||m.depthOcclusion&&M>0&&M<1;const Ut=d.paint.get("line-gradient"),it=We?"linePattern":"line",Ue=i.e2(d);let _t;if(_e&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(Et=!1),M!==0&&m.depthOcclusion){const _n=d.paint._values["line-opacity"];_n&&_n.value&&_n.value.kind==="constant"?_t=_n.value:i.w(`Occlusion opacity for layer ${d.id} is supported only when line-opacity isn't data-driven.`)}T.value.kind!=="constant"&&T.value.isLineProgressConstant===!1&&Ue.push("VARIABLE_LINE_WIDTH"),_e&&(m.emissiveMode!=="dual-source-blending"||E?m.emissiveMode==="mrt-fallback"&&Ue.push("USE_MRT1"):Ue.push("DUAL_SOURCE_BLENDING"));const ut=(_n,Yt,Vt,On,Cn,fn)=>{for(const vn of _n){const tr=o.getTile(vn);if(We&&!tr.patternsLoaded())continue;const Nr=tr.getBucket(d);if(!Nr||Nr.elevationType!=="none"&&!Cn||Nr.elevationType==="none"&&Cn)continue;m.prepareDrawTile();const mi=[...Yt],Bi=m.shadowRenderer,Nn=Nr.elevationType==="road"&&!!Bi&&Bi.enabled;let Ni=[0,0,0];if(Nn){const Gr=m.style.directionalLight,qs=m.style.ambientLight;Gr&&qs&&(Ni=Od(m.style,Gr,qs)),mi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Dr=Nr.programConfigurations.get(d.id);let Wi=!1;if(ct&&tr.imageAtlas){const Gr=i.e3.from(ct),qs=Gr.getPrimary().scaleSelf(me).toString(),Pa=tr.imageAtlas.patternPositions.get(qs),ha=Gr.getSecondary(),xs=ha?tr.imageAtlas.patternPositions.get(ha.scaleSelf(me).toString()):null;Wi=!!Pa&&!!xs,Pa&&Dr.setConstantPatternPositions(Pa,xs)}Ge>0&&(Wi||Dr.getPatternTransitionVertexBuffer("line-pattern"))&&mi.push("LINE_PATTERN_TRANSITION");const ls=m.isTileAffectedByFog(vn),ns=m.getOrCreateProgram(it,{config:Dr,defines:mi,overrideFog:ls});if(!We&&Ae&&Te&&tr.lineAtlas){const Gr=tr.lineAtlas.getDash(Ae,Te);Gr&&Dr.setConstantPatternPositions(Gr)}Nn&&Bi.setupShadows(tr.tileID.toUnwrapped(),ns,"vector-tile");let[Di,Hr]=d.paint.get("line-trim-offset");(Te==="round"||Te==="square")&&Di!==Hr&&(Di===0&&(Di-=1),Hr===1&&(Hr+=1));const Gi=_e?vn.projMatrix:null,ga=j?1/Nr.tileToMeter/i.ay(tr,1,m.transform.zoom):1,ea=j?1/Nr.tileToMeter/i.ay(tr,1,Math.floor(m.transform.zoom)):1,Xi=We?i.e4(m,tr,d,Gi,me,ga,ea,[Di,Hr],Ni,Ge):i.e5(m,tr,d,Gi,Nr.lineClipsArray.length,me,ga,ea,[Di,Hr],Ni);if(Ut){const Gr=Nr.gradients[d.id];let qs=Gr.texture;if(d.gradientVersion!==Gr.version){let Pa=256;if(d.stepInterpolant){const ha=o.getSource().maxzoom,xs=vn.canonical.z===ha?Math.ceil(1<<m.transform.maxZoom-vn.canonical.z):1;Pa=i.aA(i.e6(Nr.maxLineLength/i.al*1024*xs),256,Y.maxTextureSize)}Gr.gradient=i.e7({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Pa,image:Gr.gradient||void 0,clips:Nr.lineClipsArray}),Gr.texture?Gr.texture.update(Gr.gradient):Gr.texture=new i.T(Y,Gr.gradient,te.RGBA8),Gr.version=d.gradientVersion,qs=Gr.texture}Y.activeTexture.set(te.TEXTURE1),qs.bind(d.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}Ce&&(Y.activeTexture.set(te.TEXTURE0),tr.lineAtlasTexture&&tr.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),Dr.updatePaintBuffers()),We&&(Y.activeTexture.set(te.TEXTURE0),tr.imageAtlasTexture&&tr.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),Dr.updatePaintBuffers()),Cn&&!W&&m.terrain.setupElevationDraw(tr,ns),m.uploadCommonUniforms(Y,ns,vn.toUnwrapped());const ki=Gr=>{_t!=null&&(_t.value=ht*M),ns.draw(m,te.TRIANGLES,Vt,Gr,pe,Rr.disabled,Xi,d.id,Nr.layoutVertexBuffer,Nr.indexBuffer,Nr.segments,d.paint,m.transform.zoom,Dr,[Nr.layoutVertexBuffer2,Nr.patternVertexBuffer,Nr.zOffsetVertexBuffer]),_t!=null&&(_t.value=ht)};if(Et&&!Cn){const Gr=m.stencilModeForClipping(vn).ref;Gr===0&&_e&&Y.clear({stencil:0});const qs={func:te.EQUAL,mask:255};Xi.u_alpha_discard_threshold=.8,ki(new Mr(qs,Gr,255,te.KEEP,te.KEEP,te.INVERT)),Xi.u_alpha_discard_threshold=0,ki(new Mr(qs,Gr,255,te.KEEP,te.KEEP,te.KEEP))}else Xi.u_alpha_discard_threshold=Et&&Cn&&fn?.8:0,ki(Cn?On:m.stencilModeForClipping(vn))}};let Pt=m.depthModeForSublayer(0,Fn.ReadOnly);const nn=new Fn(m.depthOcclusion?te.GREATER:te.LEQUAL,Fn.ReadOnly,m.depthRangeFor3D);if(d.hasNonElevatedBuckets){const _n=!_e&&m.terrain;M!==0&&_n?i.w(`Occlusion opacity for layer ${d.id} is supported on terrain only if the layer has line-z-offset enabled.`):_n?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${d.id}.`):ut(g,Ue,Pt,Mr.disabled,!1,!0)}if(d.hasElevatedBuckets){N==="hd-road-markup"?Z||(Pt=nn,Ue.push("ELEVATED_ROADS")):(Ue.push("ELEVATED"),Pt=nn,oe&&Ue.push(ae?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),W&&Ue.push("ELEVATION_REFERENCE_SEA"));const _n=Et?m.stencilModeFor3D():Mr.disabled;m.forceTerrainMode=!0,ut(g,Ue,Pt,_n,!0,!0),Et&&ut(g,Ue,Pt,_n,!0,!1),m.forceTerrainMode=!1}Et&&(m.resetStencilClippingMasks(),_e&&Y.clear({stencil:0})),M===0||m.depthOcclusion||_e||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,o,d,g){const b=d.paint.get("fill-color"),T=d.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const E=d.paint.get("fill-emissive-strength"),I=m.colorModeForDrapableLayerRenderPass(E),M=d.paint.get("fill-pattern"),N=m.opaquePassEnabledForLayer()&&!M.constantOr(1)&&b.constantOr(i.ao.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";let j="none";d.layout.get("fill-elevation-reference")!=="none"?j="road":d.paint.get("fill-z-offset").constantOr(1)!==0&&(j="offset");const W=!(!m.terrain||!m.terrain.enabled),Z={painter:m,sourceCache:o,layer:d,coords:g,colorMode:I,elevationType:j,terrainEnabled:W,pass:N};if(m.renderPass==="shadow")return void(m.shadowRenderer&&j==="road"&&!W&&function(te){const{painter:J,sourceCache:oe,layer:ae,coords:pe}=te,_e=J.context.gl,me=te.painter.shadowRenderer;for(const Le of pe){const Ce=oe.getTile(Le),Re=Ce.getBucket(ae);if(!Re)continue;const Ae=Re.elevatedStructures;if(!Ae||!Ae.shadowCasterSegments||Ae.shadowCasterSegments.segments[0].primitiveLength===0)continue;J.prepareDrawTile();const Te=Re.bufferData.programConfigurations.get(ae.id),ze=J.isTileAffectedByFog(Le),We=J.getOrCreateProgram("elevatedStructuresDepth",{config:Te,overrideFog:ze}),Ge=me.calculateShadowPassMatrixFromTile(Ce.tileID.toUnwrapped());J.uploadCommonUniforms(J.context,We,Le.toUnwrapped());const ct={u_matrix:Ge,u_depth_bias:0};We.draw(J,_e.TRIANGLES,me.getShadowPassDepthMode(),Mr.disabled,me.getShadowPassColorMode(),Rr.disabled,ct,ae.id,Ae.vertexBuffer,Ae.indexBuffer,Ae.shadowCasterSegments,ae.paint,J.transform.zoom,Te)}}(Z));const Y=m.emissiveMode==="mrt-fallback";if(j!=="offset"){if(Vy(Z,!1,Y),j==="road"){const te=!W&&m.renderPass==="translucent";te&&Uy(m,o,d,g,"geometry"),Vy(Z,!0,Y,Mr.disabled),te&&function(J){const{painter:oe,sourceCache:ae,layer:pe,coords:_e,colorMode:me}=J,Le=oe.context.gl,Ce=J.painter.shadowRenderer,Re=!!Ce&&Ce.enabled,Ae=new Fn(oe.context.gl.LEQUAL,Fn.ReadOnly,oe.depthRangeFor3D);let Te=[0,0,0];if(Re){const We=oe.style.directionalLight,Ge=oe.style.ambientLight;We&&Ge&&(Te=Od(oe.style,We,Ge))}const ze=We=>{for(const Ge of _e){const ct=ae.getTile(Ge),ht=ct.getBucket(pe);if(!ht)continue;const Et=ht.elevatedStructures;if(!Et)continue;let Ut,it;if(We?(Ut=Et.renderableBridgeSegments,it=Et.bridgeProgramConfigurations.get(pe.id)):(Ut=Et.renderableTunnelSegments,it=Et.tunnelProgramConfigurations.get(pe.id)),!Ut||Ut.segments[0].primitiveLength===0)continue;it.updatePaintBuffers(),oe.prepareDrawTile();const Ue=oe.isTileAffectedByFog(Ge),_t=[];Re&&_t.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ut=oe.getOrCreateProgram("elevatedStructures",{config:it,overrideFog:Ue,defines:_t}),Pt=oe.translatePosMatrix(Ge.projMatrix,ct,pe.paint.get("fill-translate"),pe.paint.get("fill-translate-anchor"));Re&&Ce.setupShadows(ct.tileID.toUnwrapped(),ut,"vector-tile");const nn=zh(Pt,Te);oe.uploadCommonUniforms(oe.context,ut,Ge.toUnwrapped()),ut.draw(oe,Le.TRIANGLES,Ae,Mr.disabled,me,Rr.backCCW,nn,pe.id,Et.vertexBuffer,Et.indexBuffer,Ut,pe.paint,oe.transform.zoom,it,[Et.vertexBufferNormal])}};ze(!0),ze(!1)}(Z)}}else Vy(Z,!1,Y,m.stencilModeFor3D())},"fill-extrusion":function(m,o,d,g){const b=d.paint.get("fill-extrusion-opacity"),T=m.context,E=T.gl,I=m.terrain,M=I&&I.renderingToTexture;if(b===0)return;const N=m.emissiveMode==="mrt-fallback",j=m.conflationActive&&m.style.isLayerClipped(d,o.getSource()),W=m.style.order.indexOf(d.fqid);if(j&&function(Z,Y,te,J,oe){for(const ae of J){const pe=Y.getTile(ae).getBucket(te);pe&&(pe.updateReplacement(ae,Z.replacementSource,oe),pe.uploadCentroid(Z.context))}}(m,o,d,g,W),I||j)for(const Z of g){const Y=o.getTile(Z).getBucket(d);Y&&MI(m.context,o,Z,Y,d,I,j)}if(m.renderPass==="shadow"&&m.shadowRenderer){const Z=m.shadowRenderer;if(I&&b<.65&&d._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ad)return;const Y=Z.getShadowPassDepthMode(),te=Z.getShadowPassColorMode();$y(m,o,d,g,Y,Mr.disabled,te,j)}else if(m.renderPass==="translucent"){const Z=!d.paint.get("fill-extrusion-pattern").constantOr(1),Y=d.paint.get("fill-extrusion-color").constantOr(i.ao.white);if(!M&&Y.a!==0){const te=new Fn(m.context.gl.LEQUAL,Fn.ReadWrite,m.depthRangeFor3D);b===1&&Z?$y(m,o,d,g,te,Mr.disabled,Vr.unblended,j):($y(m,o,d,g,te,Mr.disabled,Vr.disabled,j),$y(m,o,d,g,te,m.stencilModeFor3D(),m.colorModeForRenderPass(),j),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&Z&&(!I&&m.transform.projection.name!=="globe"||M)){const te=d.paint.get("fill-extrusion-opacity"),J=d.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe=d.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ae=d.paint.get("fill-extrusion-flood-light-intensity"),pe=d.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",_e=d.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(pe?null:d.lut).toArray01().slice(0,3),me=J>0&&oe>0,Le=ae>0,Ce=(Te,ze,We)=>(1-We)*Te+We*ze,Re=new Rb;Re.translate=d.paint.get("fill-extrusion-translate"),Re.translateAnchor=d.paint.get("fill-extrusion-translate-anchor"),Re.edgeRadius=d.layout.get("fill-extrusion-edge-radius"),Re.cutoffFadeRange=d.paint.get("fill-extrusion-cutoff-fade-range");const Ae=Te=>{const ze=m.depthModeForSublayer(1,Fn.ReadOnly,E.LEQUAL,!0),We=d.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ge=Ce(.1,3,We),ct=m._showOverdrawInspector;if(!ct){const ht=new Mr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Et=new Vr([E.ONE,E.ONE,E.ONE,E.ONE],i.ao.transparent,[!1,!1,!1,!0],E.MIN);Nd(Re,m,o,d,g,ze,ht,Et,Rr.disabled,Te,"sdf",te,J,oe,ae,_e,Ge,j,!1)}{const ht=ct?Mr.disabled:new Mr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),Et=ct?m.colorModeForRenderPass():new Vr([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],i.ao.transparent,[!0,!0,!0,!0]);Nd(Re,m,o,d,g,ze,ht,Et,Rr.disabled,Te,"color",te,J,oe,ae,_e,Ge,j,!1)}};if(M){const Te=()=>{const We=I.drapeBufferSize[0],Ge=I.drapeBufferSize[1];let ct=I.framebufferCopyTexture;return ct&&(!ct||ct.size[0]===We&&ct.size[1]===Ge)||(ct&&ct.destroy(),ct=I.framebufferCopyTexture=new i.T(T,new i.q({width:We,height:Ge}),E.RGBA8)),ct.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexSubImage2D(E.TEXTURE_2D,0,0,0,0,0,We,Ge),ct},ze=(We,Ge,ct)=>{const ht=m.depthModeForSublayer(1,Fn.ReadOnly,E.LEQUAL,!1),Et=d.paint.get(We?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ut=Ce(.1,3,Et);{const it=new Vr([E.ONE,E.ONE,E.ONE,E.ONE],i.ao.transparent,[!1,!1,!1,!0]);Nd(Re,m,o,d,g,ht,Mr.disabled,it,Rr.disabled,We,"clear",te,J,oe,ae,_e,Ut,j,Ge)}{const it=new Mr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Ue=new Vr([E.ONE,E.ONE,E.ONE,E.ONE],i.ao.transparent,[!1,!1,!1,!0],E.MIN);Nd(Re,m,o,d,g,ht,it,Ue,Rr.disabled,We,"sdf",te,J,oe,ae,_e,Ut,j,Ge)}N&&!We&&(ct=Te());{const it=We?E.ZERO:E.ONE_MINUS_DST_ALPHA,Ue=new Mr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),_t=new Vr([it,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],i.ao.transparent,[!0,!0,!0,!0]);Nd(Re,m,o,d,g,ht,Ue,_t,Rr.disabled,We,"color",te,J,oe,ae,_e,Ut,j,Ge)}if(!N||We){const it=new Vr([E.ONE,E.ONE,E.ONE,We?E.ZERO:E.ONE],i.ao.transparent,[!1,!1,!1,!0],We?E.FUNC_ADD:E.MAX);Nd(Re,m,o,d,g,ht,Mr.disabled,it,Rr.disabled,We,"clear",te,J,oe,ae,_e,Ut,j,Ge,ct)}else{E.drawBuffers([E.NONE,E.COLOR_ATTACHMENT1]);const it=new Mr({func:E.EQUAL,mask:255},254,255,E.KEEP,E.DECR,E.DECR),Ue=new Vr([E.ONE,E.ONE,E.ONE,E.ONE],i.ao.transparent,[!0,!1,!1,!1],E.MAX);Nd(Re,m,o,d,g,ht,it,Ue,Rr.disabled,We,"emissive",te,J,oe,ae,_e,Ut,j,Ge,ct),E.drawBuffers([E.COLOR_ATTACHMENT0])}};if(me||Le){let We;m.prepareDrawTile(),N&&!me||(We=Te()),me&&ze(!0,!1,We),Le&&ze(!1,!0,We)}}else me&&Ae(!0),Le&&Ae(!1),(me||Le)&&m.resetStencilClippingMasks()}}},building:function(m,o,d,g){m.currentLayer<m.firstLightBeamLayer&&(m.firstLightBeamLayer=m.currentLayer);const b=d.paint.get("building-ambient-occlusion-ground-intensity"),T=d.paint.get("building-ambient-occlusion-ground-radius"),E=d.paint.get("building-ambient-occlusion-ground-attenuation"),I=d.paint.get("building-opacity");if(I<=0)return;let M=b>0&&T>0,N=!0;const j=d.paint.get("building-vertical-scale");if(j<=0)return;m.shadowRenderer||(N=!1);const W=m.conflationActive&&m.style.isLayerClipped(d,o.getSource()),Z=m.style.order.indexOf(d.fqid);if(function(Y,te,J,oe,ae,pe){for(const _e of pe){const me=te.getTile(_e).getBucket(J);me&&(ae&&me.updateReplacement(_e,Y.replacementSource,oe),me.uploadUpdatedIndexBuffer(Y.context))}}(m,o,d,Z,W,g),function(Y,te,J,oe){for(const ae of oe){const pe=te.getTile(ae).getBucket(J);pe&&pe.needsEvaluation()&&pe.uploadUpdatedColorBuffer(Y.context)}}(m,o,d,g),d.resetLayerRenderingStats(m),m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0),m.renderPass==="shadow"&&m.shadowRenderer){const Y=m.shadowRenderer,te=[],J=Y.getShadowPassDepthMode();mg({painter:m,source:o,layer:d,coords:g,defines:te,blendMode:Y.getShadowPassColorMode(),depthMode:J,opacity:I,verticalScale:j,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(m.renderPass==="translucent"){let Y=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];N&&(Y=Y.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),m.shadowRenderer&&m.shadowRenderer.useNormalOffset&&(Y=Y.concat("NORMAL_OFFSET"));const te=d.paint.get("building-facade-emissive-chance"),J=d.paint.get("building-ambient-occlusion-intensity"),oe=d.paint.get("building-flood-light-intensity"),ae=d.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",pe=d.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ae?null:d.lut).toArray01().slice(0,3),_e=d.paint.get("building-flood-light-ground-attenuation"),me=oe>0,Le=new Fn(m.context.gl.LEQUAL,Fn.ReadWrite,m.depthRangeFor3D);I<1&&mg({painter:m,source:o,layer:d,coords:g,defines:Y,blendMode:Vr.disabled,depthMode:Le,opacity:I,verticalScale:j,facadeEmissiveChance:te,facadeAOIntensity:J,floodLightIntensity:oe,floodLightColor:pe,depthOnly:!0});const Ce=m.colorModeForRenderPass();mg({painter:m,source:o,layer:d,coords:g,defines:Y,blendMode:Ce,depthMode:Le,opacity:I,verticalScale:j,facadeEmissiveChance:te,facadeAOIntensity:J,floodLightIntensity:oe,floodLightColor:pe}),M&&Hy(m,o,d,g,!0,I,b,T,oe,pe,E,W),me&&Hy(m,o,d,g,!1,I,b,T,oe,pe,_e,W)}else if(m.renderPass==="light-beam"){const Y=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],te=new Fn(m.context.gl.LEQUAL,Fn.ReadOnly,m.depthRangeFor3D);mg({painter:m,source:o,layer:d,coords:g,defines:Y,blendMode:Vr.alphaBlended,depthMode:te,opacity:I,verticalScale:j,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1),m.resetStencilClippingMasks()},hillshade:function(m,o,d,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const b=m.context,T=m.terrain&&m.terrain.renderingToTexture,[E,I]=m.renderPass!=="translucent"||T?[{},g]:m.stencilConfigForOverlap(g);for(const M of I){const N=o.getTile(M);if(N.needsHillshadePrepare&&m.renderPass==="offscreen")bI(m,N,d);else if(m.renderPass==="translucent"){const j=m.depthModeForSublayer(0,Fn.ReadOnly),W=d.paint.get("hillshade-emissive-strength"),Z=m.colorModeForDrapableLayerRenderPass(W),Y=T&&m.terrain?m.terrain.stencilModeForRTTOverlap(M):E[M.overscaledZ];xI(m,M,N,d,j,Y,Z)}}b.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,o,d,g,b,T){if(m.renderPass!=="translucent"||d.paint.get("raster-opacity")===0)return;const E=m.transform.projection.name==="globe",I=d.paint.get("raster-elevation")!==0,M=I&&E;if(m.renderElevatedRasterBackface&&!M)return;const N=m.context,j=N.gl,W=o.getSource(),Z=function(Ce,Re,Ae,Te,ze){const We=Re.paint.get("raster-color"),Ge=Ce.type==="raster-array",ct=[],ht=Re.paint.get("raster-resampling"),Et=Re.paint.get("raster-color-mix");let Ut=Re.paint.get("raster-color-range");const it=[Et[0],Et[1],Et[2],0],Ue=Et[3];let _t=ht==="nearest"?Te.NEAREST:Te.LINEAR;if(Ge&&(ct.push("RASTER_ARRAY"),We||ct.push("RASTER_COLOR"),ht==="linear"&&ct.push("RASTER_ARRAY_LINEAR"),_t=Te.NEAREST,!Ut&&Ce.rasterLayers)){const ut=Ce.rasterLayers.find(({id:Pt})=>Pt===Re.sourceLayer);ut&&ut.fields&&ut.fields.range&&(Ut=ut.fields.range)}if(Ut=Ut||[0,1],We){ct.push("RASTER_COLOR"),Ae.activeTexture.set(Te.TEXTURE2),Re.updateColorRamp(Ut);let ut=Re.colorRampTexture;ut||(ut=Re.colorRampTexture=new i.T(Ae,Re.colorRamp,Te.RGBA8)),ut.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}return ze&&ct.push("USE_MRT1"),{mix:it,range:Ut,offset:Ue,defines:ct,resampling:_t}}(W,d,N,j,m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback");if(W instanceof i.aU&&!g.length&&!E)return;const Y=d.paint.get("raster-emissive-strength"),te=m.colorModeForDrapableLayerRenderPass(Y),J=m.terrain&&m.terrain.renderingToTexture,oe=!m.options.moving,ae=d.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR;if(W instanceof i.aU&&!g.length&&(W.onNorthPole||W.onSouthPole)){const Ce=I?m.stencilModeFor3D():Mr.disabled;return void gg(!!W.onNorthPole,null,m,o,d,Y,Z,Rr.disabled,Ce)}if(!g.length)return;const[pe,_e]=W instanceof i.aU||J?[{},g]:m.stencilConfigForOverlap(g),me=_e[_e.length-1].overscaledZ;M&&Z.defines.push("PROJECTION_GLOBE_VIEW"),I&&Z.defines.push("RENDER_CUTOFF");const Le=(Ce,Re,Ae)=>{for(const Te of Ce){const ze=Te.toUnwrapped(),We=o.getTile(Te);if(J&&(!We||!We.hasData()))continue;N.activeTexture.set(j.TEXTURE0);const Ge=Fd(We,W,d,Z);if(!Ge||!Ge.texture)continue;const{texture:ct,mix:ht,offset:Et,tileSize:Ut,buffer:it}=Ge;let Ue,_t;J?(Ue=Fn.disabled,_t=Te.projMatrix):I?(Ue=new Fn(j.LEQUAL,Fn.ReadWrite,m.depthRangeFor3D),_t=E?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(ze,oe)):(Ue=m.depthModeForSublayer(Te.overscaledZ-me,d.paint.get("raster-opacity")===1?Fn.ReadWrite:Fn.ReadOnly,j.LESS),_t=m.transform.calculateProjMatrix(ze,oe));const ut=m.terrain&&J?m.terrain.stencilModeForRTTOverlap(Te):pe[Te.overscaledZ],Pt=T?0:d.paint.get("raster-fade-duration");We.registerFadeDuration(Pt);const nn=o.findLoadedParent(Te,0),_n=cg(We,nn,o,m.transform,Pt);let Yt,Vt;!_n.isFading&&We.refreshedUponExpiration&&(We.refreshedUponExpiration=!1),m.terrain&&m.terrain.prepareDrawTile(),N.activeTexture.set(j.TEXTURE0),ct.bind(ae,j.CLAMP_TO_EDGE),N.activeTexture.set(j.TEXTURE1),nn?(nn.texture&&nn.texture.bind(ae,j.CLAMP_TO_EDGE),Yt=Math.pow(2,nn.tileID.overscaledZ-We.tileID.overscaledZ),Vt=[We.tileID.canonical.x*Yt%1,We.tileID.canonical.y*Yt%1]):ct.bind(ae,j.CLAMP_TO_EDGE),"useMipmap"in ct&&N.extTextureFilterAnisotropic&&m.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const On=m.transform;let Cn;const fn=I?lS(On):[0,0,0,0];let vn,tr,Nr,mi,Bi,Nn=0;if(M&&W instanceof i.aU&&W.coordinates.length>3)vn=Float32Array.from(i.bk(i.dJ(new i.cD(0,0,0)))),tr=Float32Array.from(On.globeMatrix),Nr=Float32Array.from(i.dF(On)),mi=[i.aF(On.center.lng),i.aJ(On.center.lat)],Cn=W.elevatedGlobePerspectiveTransform,Bi=W.elevatedGlobeGridMatrix||new Float32Array(9);else if(M){const ls=i.dG(Te.canonical);Nn=i.dH(ls.getCenter().lat),vn=Float32Array.from(i.bk(i.dJ(Te.canonical))),tr=Float32Array.from(On.globeMatrix),Nr=Float32Array.from(i.dF(On)),mi=[i.aF(On.center.lng),i.aJ(On.center.lat)],Cn=[0,0],Bi=Float32Array.from(i.dI(Te.canonical,ls,Nn,On.worldSize/On._pixelsPerMercatorPixel))}else Cn=W instanceof i.aU?W.perspectiveTransform:[0,0],vn=new Float32Array(16),tr=new Float32Array(9),Nr=new Float32Array(16),mi=[0,0],Bi=new Float32Array(9);const Ni=tS(_t,vn,tr,Nr,Bi,Vt||[0,0],i.aj(m.transform.zoom),mi,fn,Yt||1,_n,d,Cn,I?d.paint.get("raster-elevation"):0,2,ht,Et,Z.range,Ut,it,Y),Dr=m.isTileAffectedByFog(Te),Wi=m.getOrCreateProgram("raster",{defines:Z.defines,overrideFog:Dr});if(m.uploadCommonUniforms(N,Wi,ze),W instanceof i.aU){const ls=W.elevatedGlobeVertexBuffer,ns=W.elevatedGlobeIndexBuffer;if(J||!E)W.boundsBuffer&&W.boundsSegments&&Wi.draw(m,j.TRIANGLES,Ue,Mr.disabled,te,Rr.disabled,Ni,d.id,W.boundsBuffer,m.quadTriangleIndexBuffer,W.boundsSegments);else if(ls&&ns){const Di=On.zoom<=i.c_?W.elevatedGlobeSegments:W.getSegmentsForLongitude(On.center.lng);Di&&Wi.draw(m,j.TRIANGLES,Ue,Mr.disabled,te,Re,Ni,d.id,ls,ns,Di)}}else if(M){Ue=new Fn(j.LEQUAL,Fn.ReadOnly,m.depthRangeFor3D);const ls=m.globeSharedBuffers;if(ls){const[ns,Di,Hr]=ls.getGridBuffers(Nn,!1);Wi.draw(m,j.TRIANGLES,Ue,Ae||ut,m.colorModeForRenderPass(),Re,Ni,d.id,ns,Di,Hr)}}else{const{tileBoundsBuffer:ls,tileBoundsIndexBuffer:ns,tileBoundsSegments:Di}=m.getTileBoundsBuffers(We);Wi.draw(m,j.TRIANGLES,Ue,ut,te,Rr.disabled,Ni,d.id,ls,ns,Di)}}if(!(W instanceof i.aU)&&M)for(const Te of Ce){const ze=Te.canonical.y===(1<<Te.canonical.z)-1;Te.canonical.y===0&&gg(!0,Te,m,o,d,Y,Z,Re,Ae||Mr.disabled),ze&&gg(!1,Te,m,o,d,Y,Z,Re===Rr.frontCW?Rr.backCW:Rr.frontCW,Ae||Mr.disabled)}};M?Le(_e,m.renderElevatedRasterBackface?Rr.backCW:Rr.frontCW,m.stencilModeFor3D()):Le(_e,Rr.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,o,d,g,b,T){m.renderPass==="offscreen"&&function(E,I,M,N){if(!N.length)return;const j=E.context,W=j.gl,Z=I.getSource();if(!(Z instanceof _l))return;const Y=Math.ceil(Math.sqrt(M.paint.get("raster-particle-count")));let te=M.particlePositionRGBAImage;if(!te||te.width!==Y){const _e=function(me){const Le=me*me,Ce=new Uint8Array(4*Le),Re=function(Te){return Te|=0,Te=Math.imul(2747636419^Te,2654435769),Te=Math.imul(Te^Te>>>16,2654435769),((Te=Math.imul(Te^Te>>>16,2654435769))>>>0)/4294967296},Ae=1/1.1;for(let Te=0;Te<Le;Te++){const ze=Ae*(Re(2*Te+0)+nd),We=Ae*(Re(2*Te+1)+nd),Ge=255*ze%1,ct=255*We%1,ht=Ge,Et=We-ct/255,Ut=ct;Ce[4*Te+0]=255*(ze-Ge/255),Ce[4*Te+1]=255*ht,Ce[4*Te+2]=255*Et,Ce[4*Te+3]=255*Ut}return Ce}(Y);te=M.particlePositionRGBAImage=new i.q({width:Y,height:Y},_e)}let J=M.particleFramebuffer;J?J.width!==Y&&(J.destroy(),J=M.particleFramebuffer=j.createFramebuffer(Y,Y,1,null)):J=M.particleFramebuffer=j.createFramebuffer(Y,Y,1,null);const oe=[];for(const _e of N){const me=I.getTile(_e);if(!(me instanceof iy))continue;const Le=Pb(me,Z,M);if(!Le)continue;const Ce=[me.tileSize,me.tileSize];let Re=M.tileFramebuffer;Re||(Re=M.tileFramebuffer=j.createFramebuffer(Ce[0],Ce[1],1,null));let Ae=me.rasterParticleState;Ae||(Ae=me.rasterParticleState=new qy(j,_e,Ce,te));const Te=Ae.update(M.lastInvalidatedAt);Ae.particleTextureDimension!==Y&&Ae.updateParticleTexture(_e,te);const ze=Ae.targetColorTexture;Ae.targetColorTexture=Ae.backgroundColorTexture,Ae.backgroundColorTexture=ze;const We=Ae.particleTexture0;Ae.particleTexture0=Ae.particleTexture1,Ae.particleTexture1=We,oe.push([_e,Le,Ae,Te])}if(oe.length===0)return;const ae=i.o.now(),pe=M.previousDrawTimestamp?.001*(ae-M.previousDrawTimestamp):.0167;if(M.previousDrawTimestamp=ae,M.hasColorMap()){j.activeTexture.set(W.TEXTURE0+2);let _e=M.colorRampTexture;_e||(_e=M.colorRampTexture=new i.T(j,M.colorRamp,W.RGBA8)),_e.bind(W.LINEAR,W.CLAMP_TO_EDGE)}j.bindFramebuffer.set(M.tileFramebuffer.framebuffer),function(_e,me,Le){const Ce=_e.context,Re=Ce.gl,Ae=me.tileFramebuffer;Ce.activeTexture.set(Re.TEXTURE0);const Te={u_texture:0,u_opacity:1.05*(We=me.paint.get("raster-particle-fade-opacity-factor"))/(We+.05)},ze=_e.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var We;for(const Ge of Le){const[,,ct,ht]=Ge;Ae.colorAttachment0.set(ct.targetColorTexture.texture),Ce.viewport.set([0,0,Ae.width,Ae.height]),Ce.clear({color:i.ao.transparent}),ht&&(ct.backgroundColorTexture.bind(Re.NEAREST,Re.CLAMP_TO_EDGE),ze.draw(_e,Re.TRIANGLES,Fn.disabled,Mr.disabled,Vr.alphaBlended,Rr.disabled,Te,me.id,_e.viewportBuffer,_e.quadTriangleIndexBuffer,_e.viewportSegments))}}(E,M,oe),function(_e,me,Le,Ce){const Re=_e.context,Ae=Re.gl,Te=Le.tileFramebuffer,ze=_e.transform.projection.name==="globe",We=Le.paint.get("raster-particle-max-speed");for(const Ge of Ce){const[ct,ht,Et]=Ge;Re.activeTexture.set(Ae.TEXTURE0+0),ht.texture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Te.colorAttachment0.set(Et.targetColorTexture.texture);const Ut=_e.getOrCreateProgram("rasterParticleDraw",{defines:ht.defines,overrideFog:!1});Re.activeTexture.set(Ae.TEXTURE0+1);const it=ht.scalarData?[]:[0,1,2,3].map(ut=>i.e9[ut](ct));it.push(ct);const Ue=ct.canonical.x,_t=ct.canonical.y;for(const ut of it){const Pt=me.getTile(ze?ut.wrapped():ut);if(!Pt)continue;const nn=Pt.rasterParticleState;if(!nn)continue;const _n=ut.canonical.x+(1<<ut.canonical.z)*(ut.wrap-ct.wrap),Yt=ut.canonical.y;nn.particleTexture0.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);const Vt=RI(1,nn.particleTexture0.size[0],[_n-Ue,Yt-_t],0,ht.texture.size,2,We,ht.textureOffset,ht.scale,ht.offset);Ut.draw(_e,Ae.POINTS,Fn.disabled,Mr.disabled,Vr.alphaBlended,Rr.disabled,Vt,Le.id,nn.particleIndexBuffer,void 0,nn.particleSegment)}}}(E,I,M,oe),j.bindFramebuffer.set(M.particleFramebuffer.framebuffer),function(_e,me,Le,Ce){const Re=_e.context,Ae=Re.gl,Te=me.paint.get("raster-particle-max-speed"),ze=Ce*me.paint.get("raster-particle-speed-factor")*.15,We=function(ct){return Math.pow(ct,6)}(.01+1*me.paint.get("raster-particle-reset-rate-factor")),Ge=me.particleFramebuffer;Re.viewport.set([0,0,Ge.width,Ge.height]);for(const ct of Le){const[,ht,Et]=ct;Re.activeTexture.set(Ae.TEXTURE0+0),ht.texture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Re.activeTexture.set(Ae.TEXTURE0+1);const Ut=Et.particleTexture0;Ut.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);const it=rS(1,Ut.size[0],0,ht.texture.size,Te,ze,We,ht.textureOffset,ht.scale,ht.offset);Ge.colorAttachment0.set(Et.particleTexture1.texture),Re.clear({color:i.ao.transparent}),_e.getOrCreateProgram("rasterParticleUpdate",{defines:ht.defines}).draw(_e,Ae.TRIANGLES,Fn.disabled,Mr.disabled,Vr.unblended,Rr.disabled,it,me.id,_e.viewportBuffer,_e.quadTriangleIndexBuffer,_e.viewportSegments)}}(E,M,oe,pe)}(m,o,d,g),m.renderPass==="translucent"&&(function(E,I,M,N,j){const W=E.context,Z=W.gl,Y=I.getSource().tileSize,te=5*(1-i.ah(i.cL,i.cL+1,E.transform.zoom))*Y+M.paint.get("raster-particle-elevation"),J=!E.options.moving,oe=E.transform.projection.name==="globe";if(!N.length)return;const[ae,pe]=E.stencilConfigForOverlap(N),_e=[];oe&&_e.push("PROJECTION_GLOBE_VIEW");const me=E.stencilModeFor3D();for(const Le of pe){const Ce=Le.toUnwrapped(),Re=I.getTile(Le);if(!Re.rasterParticleState)continue;const Ae=Re.rasterParticleState,Te=100;Re.registerFadeDuration(Te);const ze=I.findLoadedParent(Le,0),We=cg(Re,ze,I,E.transform,Te);let Ge,ct;E.terrain&&E.terrain.prepareDrawTile(),W.activeTexture.set(Z.TEXTURE0),Ae.targetColorTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),W.activeTexture.set(Z.TEXTURE1),ze&&ze.rasterParticleState?(ze.rasterParticleState.targetColorTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),Ge=Math.pow(2,ze.tileID.overscaledZ-Re.tileID.overscaledZ),ct=[Re.tileID.canonical.x*Ge%1,Re.tileID.canonical.y*Ge%1]):Ae.targetColorTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const ht=oe?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(Ce,J),Et=E.transform,Ut=uS(Et),it=i.dG(Le.canonical),Ue=i.dH(it.getCenter().lat);let _t,ut,Pt,nn,_n;oe?(_t=Float32Array.from(i.bk(i.dJ(Le.canonical))),ut=Float32Array.from(Et.globeMatrix),Pt=Float32Array.from(i.dF(Et)),nn=[i.aF(Et.center.lng),i.aJ(Et.center.lat)],_n=Float32Array.from(i.dI(Le.canonical,it,Ue,Et.worldSize/Et._pixelsPerMercatorPixel))):(_t=new Float32Array(16),ut=new Float32Array(9),Pt=new Float32Array(16),nn=[0,0],_n=new Float32Array(9));const Yt=II(ht,_t,ut,Pt,_n,ct||[0,0],i.aj(E.transform.zoom),nn,Ut,Ge||1,We,te),Vt=E.isTileAffectedByFog(Le),On=E.getOrCreateProgram("rasterParticle",{defines:_e,overrideFog:Vt});if(E.uploadCommonUniforms(W,On,Ce),oe){const Cn=new Fn(Z.LEQUAL,Fn.ReadOnly,E.depthRangeFor3D),fn=0,vn=E.globeSharedBuffers;if(vn){const[tr,Nr,mi]=vn.getGridBuffers(Ue,fn!==0);On.draw(E,Z.TRIANGLES,Cn,me,Vr.alphaBlended,E.renderElevatedRasterBackface?Rr.frontCCW:Rr.backCCW,Yt,M.id,tr,Nr,mi)}}else{const Cn=E.depthModeForSublayer(0,Fn.ReadOnly),fn=ae[Le.overscaledZ],{tileBoundsBuffer:vn,tileBoundsIndexBuffer:tr,tileBoundsSegments:Nr}=E.getTileBoundsBuffers(Re);On.draw(E,Z.TRIANGLES,Cn,fn,Vr.alphaBlended,Rr.disabled,Yt,M.id,vn,tr,Nr)}}E.resetStencilClippingMasks()}(m,o,d,g),m.style.map.triggerRepaint())},background:function(m,o,d,g){const b=d.paint.get("background-color"),T=d.paint.get("background-color-use-theme").constantOr("default")==="none",E=d.paint.get("background-opacity"),I=d.paint.get("background-emissive-strength"),M=d.paint.get("background-pitch-alignment")==="viewport";if(E===0)return;const N=m.context,j=N.gl,W=m.transform,Z=W.tileSize,Y=d.paint.get("background-pattern");let te;if(Y!==void 0&&(Y===null||(te=m.imageManager.getPattern(i.I.from(Y.toString()),d.scope,m.style.getLut(d.scope)),!te)))return;const J=!Y&&b.a===1&&E===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==J)return;const oe=Mr.disabled,ae=m.depthModeForSublayer(0,J==="opaque"?Fn.ReadWrite:Fn.ReadOnly),pe=m.colorModeForDrapableLayerRenderPass(I),_e=Y?"backgroundPattern":"background";let me,Le=g;Le||(me=m.getBackgroundTiles(),Le=Object.values(me).map(Re=>Re.tileID)),Y&&(N.activeTexture.set(j.TEXTURE0),m.imageManager.bind(m.context,d.scope));const Ce=[];if(m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&Ce.push("USE_MRT1"),M){const Re=m.getOrCreateProgram(_e,{overrideFog:!1,overrideRtt:!0,defines:Ce}),Ae=new Float32Array(i.bA([])),Te=new i.aQ(0,0,0,0,0),ze=Y?Bh(Ae,I,E,m,0,d.scope,te,M,{tileID:Te,tileSize:Z}):hg(Ae,I,E,b.toPremultipliedRenderColor(T?null:d.lut));Re.draw(m,j.TRIANGLES,ae,oe,pe,Rr.disabled,ze,d.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const Re of Le){const Ae=m.isTileAffectedByFog(Re),Te=m.getOrCreateProgram(_e,{overrideFog:Ae,defines:Ce}),ze=Re.toUnwrapped(),We=g?Re.projMatrix:m.transform.calculateProjMatrix(ze);m.prepareDrawTile();const Ge=o?o.getTile(Re):me?me[Re.key]:new Of(Re,Z,W.zoom,m),ct=Y?Bh(We,I,E,m,0,d.scope,te,M,{tileID:Re,tileSize:Z}):hg(We,I,E,b.toPremultipliedRenderColor(T?null:d.lut));m.uploadCommonUniforms(N,Te,ze);const{tileBoundsBuffer:ht,tileBoundsIndexBuffer:Et,tileBoundsSegments:Ut}=m.getTileBoundsBuffers(Ge);Te.draw(m,j.TRIANGLES,ae,oe,pe,Rr.disabled,ct,d.id,ht,Et,Ut)}},sky:function(m,o,d){const g=m._atmosphere?i.aj(m.transform.zoom):1,b=d.paint.get("sky-opacity")*g;if(b===0)return;const T=m.context,E=d.paint.get("sky-type"),I=new Fn(T.gl.LEQUAL,Fn.ReadOnly,[0,1]),M=m.frameCounter/1e3%1;E==="atmosphere"?m.renderPass==="offscreen"?d.needsSkyboxCapture(m)&&(function(N,j,W,Z){const Y=N.context,te=Y.gl;let J=j.skyboxFbo;if(!J){J=j.skyboxFbo=Y.createFramebuffer(32,32,1,null),j.skyboxGeometry=new Wy(Y),j.skyboxTexture=Y.gl.createTexture(),te.bindTexture(te.TEXTURE_CUBE_MAP,j.skyboxTexture),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MAG_FILTER,te.LINEAR);for(let _e=0;_e<6;++_e)te.texImage2D(te.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,te.RGBA,32,32,0,te.RGBA,te.UNSIGNED_BYTE,null)}Y.bindFramebuffer.set(J.framebuffer),Y.viewport.set([0,0,32,32]);const oe=j.getCenter(N,!0),ae=N.getOrCreateProgram("skyboxCapture"),pe=new Float64Array(16);i.bA(pe),i.en(pe,pe,.5*-Math.PI),qf(N,j,ae,pe,oe,0),i.bA(pe),i.en(pe,pe,.5*Math.PI),qf(N,j,ae,pe,oe,1),i.bA(pe),i.cU(pe,pe,.5*-Math.PI),qf(N,j,ae,pe,oe,2),i.bA(pe),i.cU(pe,pe,.5*Math.PI),qf(N,j,ae,pe,oe,3),i.bA(pe),qf(N,j,ae,pe,oe,4),i.bA(pe),i.en(pe,pe,Math.PI),qf(N,j,ae,pe,oe,5),Y.viewport.set([0,0,N.width,N.height])}(m,d),d.markSkyboxValid(m)):m.renderPass==="sky"&&function(N,j,W,Z,Y){const te=N.context,J=te.gl,oe=N.transform,ae=N.getOrCreateProgram("skybox");te.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,j.skyboxTexture);const pe=((_e,me,Le,Ce,Re)=>({u_matrix:_e,u_sun_direction:me,u_cubemap:0,u_opacity:Ce,u_temporal_offset:Re}))(oe.skyboxMatrix,j.getCenter(N,!1),0,Z,Y);N.uploadCommonUniforms(te,ae),ae.draw(N,J.TRIANGLES,W,Mr.disabled,N.colorModeForRenderPass(),Rr.backCW,pe,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(m,d,I,b,M):E==="gradient"&&m.renderPass==="sky"&&function(N,j,W,Z,Y){const te=N.context,J=te.gl,oe=N.transform,ae=N.getOrCreateProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new Wy(te)),te.activeTexture.set(J.TEXTURE0);let pe=j.colorRampTexture;pe||(pe=j.colorRampTexture=new i.T(te,j.colorRamp,J.RGBA8)),pe.bind(J.LINEAR,J.CLAMP_TO_EDGE);const _e=((me,Le,Ce,Re,Ae)=>({u_matrix:me,u_color_ramp:0,u_center_direction:Le,u_radius:i.an(Ce),u_opacity:Re,u_temporal_offset:Ae}))(oe.skyboxMatrix,j.getCenter(N,!1),j.paint.get("sky-gradient-radius"),Z,Y);N.uploadCommonUniforms(te,ae),ae.draw(N,J.TRIANGLES,W,Mr.disabled,N.colorModeForRenderPass(),Rr.backCW,_e,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(m,d,I,b,M)},custom:function(m,o,d,g){const b=m.context,T=d.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&d.isDraped(o)){if(m.renderPass==="offscreen"){const E=T.prerender;if(E){if(m.setCustomLayerDefaults(),b.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const I=m.transform.pointMerc;E.call(T,b.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.aj(m.transform.zoom),[I.x,I.y],m.transform.pixelsPerMeterRatio)}else E.call(T,b.gl,m.transform.customLayerMatrix());b.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const I=T.renderToTile;if(I){const M=g[0].canonical,N={x:M.x+g[0].wrap*(T.wrapTileId?0:1<<M.z),y:M.y,z:M.z};b.setDepthMode(Fn.disabled),b.setStencilMode(Mr.disabled),b.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),I.call(T,b.gl,N),b.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),b.setColorMode(m.colorModeForRenderPass()),b.setStencilMode(Mr.disabled);const E=T.renderingMode==="3d"?new Fn(m.context.gl.LEQUAL,Fn.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Fn.ReadOnly);if(b.setDepthMode(E),m.transform.projection.name==="globe"){const I=m.transform.pointMerc;T.render(b.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),i.aj(m.transform.zoom),[I.x,I.y],m.transform.pixelsPerMeterRatio)}else T.render(b.gl,m.transform.customLayerMatrix());b.setDirty(),m.setBaseState(),b.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,o,d,g){if(m.renderPass==="opaque")return;const b=d.paint.get("model-opacity").constantOr(1),T=d.paint.get("model-elevation-reference"),E=T==="ground",I=T==="ground";if(b===0)return;const M=d.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!M||m.terrain&&b<.65&&d._transitionablePaint._values["model-opacity"].value.expression instanceof i.ad))return;const N=m.shadowRenderer,j=d.paint.get("model-receive-shadows");N&&(N.useNormalOffset=!0,j||(N.enabled=!1));const W=()=>{N&&(N.useNormalOffset=!0,j||(N.enabled=!0))},Z=o.getSource();if(m.renderPass==="light-beam"&&Z.type!=="batched-model")return;if(Z.type==="vector"||Z.type==="geojson")return function(me,Le,Ce,Re,Ae){const Te=me.transform,ze=Te.projection.name==="globe",We=Te.getFreeCameraOptions().position;if(!me.modelManager)return;const Ge=me.modelManager;Ce.modelManager=Ge;const ct=me.shadowRenderer;if(!Ce._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ht=Ce._unevaluatedLayout._values["model-id"],Et=Object.assign({},Ce.layout.get("model-id").parameters),Ut=me.style.order.indexOf(Ce.fqid),it=Ce.paint.get("model-opacity").constantOr(1);for(const Ue of Re){const _t=Le.getTile(Ue).getBucket(Ce);if(!_t||_t.projection.name!==Te.projection.name)continue;const ut=_t.getModelUris();if(ut&&!_t.modelsRequested&&(Ge.addModelsFromBucket(ut,Ae),_t.modelsRequested=!0),ze)Et.zoom=Ue.overscaledZ;else{const fn=kl(Ue,Te);Et.zoom=fn}const Pt=ht.possiblyEvaluate(Et);if(vS(me,_t,Ue),id.shadowUniformsInitialized=!1,id.useSingleShadowCascade=!!ct&&ct.getMaxCascadeForTile(Ue.toUnwrapped())===0,me.renderPass==="shadow"&&ct){if(me.currentShadowCascade===1&&_t.isInsideFirstShadowMapFrustum)continue;const fn=Te.calculatePosMatrix(Ue.toUnwrapped(),Te.worldSize);if(id.tileMatrix.set(fn),id.shadowTileMatrix=Float32Array.from(ct.calculateShadowPassMatrixFromMatrix(fn)),id.aabb.min=[0,0,0],id.aabb.max[0]=id.aabb.max[1]=i.al,id.aabb.max[2]=0,LI(_t,id,me,Ce.scope))continue}const nn=1<<Ue.canonical.z,_n=[((We.x-Ue.wrap)*nn-Ue.canonical.x)*i.al,(We.y*nn-Ue.canonical.y)*i.al,We.z*nn*i.al];me.conflationActive&&Object.keys(_t.instancesPerModel).length>0&&me.style.isLayerClipped(Ce,Le.getSource())&&_t.updateReplacement(Ue,me.replacementSource,Ut,Ce.scope)&&(_t.uploaded=!1,_t.upload(me.context));let Yt=0;const Vt=new Array,On=new Array,Cn=new Array;for(let fn in _t.instancesPerModel){const vn=_t.instancesPerModel[fn];vn.features.length>0&&!ze&&(fn=Pt.evaluate(vn.features[0].feature,{}));const tr=Ge.getModel(fn,Ae);if(tr||Ge.hasURLBeenRequested(fn)||_t.modelUris.includes(fn)||(_t.modelUris.push(fn),_t.modelsRequested=!1),tr&&tr.uploaded)if(ze){const Nr=i.c5([],[We.x,We.y,We.z],me.transform.worldSize);i.ew(Nr,Nr);for(let mi=0;mi<vn.instancedDataArray.length;++mi){const Bi=[0,0,0],Nn=[1,1,1],Ni=i.ex(),Dr=vn.tileCoordinatesForInstance(mi),Wi=vn.transformForInstance(mi);i.ey(Nn,Wi),i.ez(Ni,Wi),i.eA(Bi,Ni);const ls=vn.translationForInstance(mi),ns=new i.aT(0,0);i.eB(_t.canonical,ns,Dr.x,Dr.y);const Di=i.bC();i.eC(Di,tr,me.transform,ns,Bi,Nn,ls,!0,!1,!1);const Hr=vn.colorForInstance(mi),Gi=i.bA([]),ga=i.ef(ns.lat,me.transform.zoom),ea=i.bq([],[1,1,1/ga]);i.br(Gi,Gi,Nr),Cn.push({zScaleMatrix:ea,negCameraPosMatrix:Gi});for(const Xi of tr.nodes)Zf(me,Xi,Di,me.transform.expandedFarZProjMatrix,Yt,Vt,On,tr.materialOverrides,it,Hr);++Yt}}else for(const Nr of tr.nodes)xS(me,Ce,Nr,vn,_n,Ue,id)}if(ze)if(me.renderPass==="shadow"){for(const fn of On)Tc(fn.mesh,fn.nodeModelMatrix,me,Ce);for(const fn of Vt)Tc(fn.mesh,fn.nodeModelMatrix,me,Ce)}else yS(me,Ce,Vt,On,Cn)}}(m,o,d,g,_g(m,d)),void W();if(!Z.loaded())return;if(Z.type==="batched-model")return function(me,Le,Ce,Re){Ce.resetLayerRenderingStats(me);const Ae=me.context,Te=me.transform,ze=me.style.fog,We=me.shadowRenderer;if(Te.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${Te.projection.name} projection is not yet implemented`);const Ge=me.transform.getFreeCameraOptions().position,ct=i.c5([],[Ge.x,Ge.y,Ge.z],me.transform.worldSize),ht=i.ew([],ct),Et=i.bA([]),Ut=i.ef(Te.center.lat,Te.zoom),it=i.bq([],[1,1,1/Ut]);i.br(Et,Et,ht);const Ue=Ce.paint.get("model-opacity").constantOr(1),_t=new Fn(Ae.gl.LEQUAL,Fn.ReadWrite,me.depthRangeFor3D),ut=new Fn(Ae.gl.LEQUAL,Fn.ReadOnly,me.depthRangeFor3D),Pt=new i.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),nn=me.renderPass==="shadow",_n=nn&&We?We.getCurrentCascadeFrustum():Te.getFrustum(Te.scaleZoom(Te.worldSize)),Yt=Ce.paint.get("model-front-cutoff"),Vt=Yt[2]<1,On=Mh(me,Ce.paint.get("model-cutoff-fade-range")),Cn=Ce.getLayerRenderingStats();(function(fn,vn,tr,Nr){const mi=fn.terrain?fn.terrain.exaggeration():0,Bi=fn.transform.zoom;for(const Nn of Nr){const Ni=vn.getTile(Nn).getBucket(tr);Ni&&(Ni.setFilter(tr.filter),fn.conflationActive&&Ni.updateReplacement(Nn,fn.replacementSource),Ni.evaluateTransform(fn,tr),fn.terrain&&mi>0&&Ni.elevationUpdate(fn.terrain,mi,Nn,tr.source),Ni.needsReEvaluation(fn,Bi,tr)&&Ni.evaluate(tr))}})(me,Le,Ce,Re),function(){let fn,vn,tr;Vt?(fn=Re.length-1,vn=-1,tr=-1):(fn=0,vn=Re.length,tr=1);const Nr=new Float64Array(16),mi=i.cA(),Bi=new i.P(0,0);for(let Nn=fn;Nn!==vn;Nn+=tr){const Ni=Re[Nn],Dr=Le.getTile(Ni).getBucket(Ce);if(!Dr||!Dr.uploaded)continue;let Wi=!1;We&&(Wi=We.getMaxCascadeForTile(Ni.toUnwrapped())===0);const ls=Te.calculatePosMatrix(Ni.toUnwrapped(),Te.worldSize),ns=Dr.modelTraits;!nn&&Vt&&(i.bl(Nr,ls),i.af(mi,ct,Nr),Bi.x=mi[0],Bi.y=mi[1]);const Di=[];Dr.setFilter(Ce.filter);for(const Hr of Dr.getNodesInfo()){if(Hr.hiddenByReplacement||!Hr.node.meshes)continue;const Gi=Hr.node;let ga=0;me.terrain&&Gi.elevation&&(ga=Gi.elevation*me.terrain.exaggeration());const ea=(()=>{const al=Hr.aabb;return Pt.min=[...al.min],Pt.max=[...al.max],Pt.min[2]+=ga,Pt.max[2]+=ga,i.af(Pt.min,Pt.min,ls),i.af(Pt.max,Pt.max,ls),Pt})(),Xi=Hr.evaluatedScale;if(Xi[0]<=1&&Xi[1]<=1&&Xi[2]<=1&&ea.intersects(_n)===0)continue;if(!nn&&Vt){const al=.16666666666666666;Hr.cameraCollisionOpacity=ct[0]>ea.min[0]&&ct[0]<ea.max[0]&&ct[1]>ea.min[1]&&ct[1]<ea.max[1]&&ct[2]*Ut<ea.max[2]&&Gi.footprint&&i.c0(Bi,Gi.footprint)?Math.max(Hr.cameraCollisionOpacity-al,0):Math.min(1,Hr.cameraCollisionOpacity+al)}const ki=[...ls],Gr=1/i.d7(Ni.canonical),qs=Gi.anchor?Gi.anchor[0]:0,Pa=Gi.anchor?Gi.anchor[1]:0;i.br(ki,ki,[qs*(Xi[0]-1)+Hr.evaluatedTranslation[0]*Gr,Pa*(Xi[1]-1)+Hr.evaluatedTranslation[1]*Gr,ga+Hr.evaluatedTranslation[2]]),i.cq(Xi,i.eE)||i.cS(ki,ki,Xi);const ha=i.aB([],ki,Gi.globalMatrix),xs=i.aB([],Te.expandedFarZProjMatrix,ha),Il=i.aB([],Te.expandedFarZProjMatrix,ki),Xo=i.aC([],[qs,Pa,ga,1],xs)[2];Gi.hidden=!1;let ro=Ue;nn||(Vt&&(ro*=Hr.cameraCollisionOpacity,ro*=hi(ki,Te,Hr.aabb,Yt)),ro*=Js(On,Xo)),ro!==0?Di.push({nodeInfo:Hr,depth:Xo,opacity:ro,wvpForNode:xs,wvpForTile:Il,nodeModelMatrix:ha,tileModelMatrix:ki}):Gi.hidden=!0}nn||Di.sort((Hr,Gi)=>!Vt||Hr.opacity===1&&Gi.opacity===1?Hr.depth<Gi.depth?-1:1:Hr.opacity===1?-1:Gi.opacity===1?1:Hr.depth>Gi.depth?-1:1);for(const Hr of Di){const Gi=Hr.nodeInfo,ga=Gi.node;let ea=i.aB([],it,Hr.tileModelMatrix);i.aB(ea,Et,ea);const Xi=i.bl([],ea);i.eg(Xi,Xi),i.cS(Xi,Xi,yg),ea=i.aB(ea,ea,ga.globalMatrix);const ki=me.renderPass==="light-beam",Gr=Ce.paint.get("model-color-use-theme").constantOr("default")==="none",qs=ns&i.eI.HasMapboxMeshFeatures,Pa=qs?0:Gi.evaluatedRMEA[0][2];for(let ha=0;ha<ga.meshes.length;++ha){const xs=ga.meshes[ha],Il=ha===ga.lightMeshIndex;let Xo=Hr.wvpForNode;if(Il){if(!ki&&!me.terrain&&me.shadowRenderer){me.currentLayer<me.firstLightBeamLayer&&(me.firstLightBeamLayer=me.currentLayer);continue}Xo=Hr.wvpForTile}else if(ki)continue;const ro={defines:[]},al=[];if(!nn&&We&&(We.useNormalOffset=!!xs.normalBuffer),Ky(ro.defines,al,xs,me,Gr?null:Ce.lut),qs||ro.defines.push("DIFFUSE_SHADED"),Wi&&ro.defines.push("SHADOWS_SINGLE_CASCADE"),Cn&&(nn?Cn.numRenderedVerticesInShadowPass+=xs.vertexArray.length:Cn.numRenderedVerticesInTransparentPass+=xs.vertexArray.length),nn){Tc(xs,Hr.nodeModelMatrix,me,Ce);continue}let ol=null;if(ze){const Fa=Yy(Hr.nodeModelMatrix,me.transform);if(ol=new Float32Array(Fa),Te.projection.name!=="globe"){const bs=xs.aabb.min,Ha=xs.aabb.max,[_a,fa]=ze.getOpacityForBounds(Fa,bs[0],bs[1],Ha[0],Ha[1]);ro.overrideFog=_a>=xt||fa>=xt}}const Uo=xs.material;let bu;Uo.occlusionTexture&&Uo.occlusionTexture.offsetScale&&(bu=Uo.occlusionTexture.offsetScale,ro.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Yu=me.getOrCreateProgram("model",ro);!nn&&We&&We.setupShadowsFromMatrix(Hr.tileModelMatrix,Yu,We.useNormalOffset),me.uploadCommonUniforms(Ae,Yu,null,ol);const jl=Uo.pbrMetallicRoughness;jl.metallicFactor=.9,jl.roughnessFactor=.5;const ba=Uf(new Float32Array(Xo),new Float32Array(ea),new Float32Array(Xi),new Float32Array(ga.globalMatrix),me,Hr.opacity,jl.baseColorFactor,Uo.emissiveFactor,jl.metallicFactor,jl.roughnessFactor,Uo,Pa,Ce,[0,0,0],bu);!Il&&(Gi.hasTranslucentParts||Hr.opacity<1)&&Yu.draw(me,Ae.gl.TRIANGLES,_t,Mr.disabled,Vr.disabled,Rr.backCCW,ba,Ce.id,xs.vertexBuffer,xs.indexBuffer,xs.segments,Ce.paint,me.transform.zoom,void 0,al),Yu.draw(me,Ae.gl.TRIANGLES,Il?ut:_t,Mr.disabled,Il||Hr.opacity<1||Gi.hasTranslucentParts?Vr.alphaBlended:Vr.unblended,Rr.backCCW,ba,Ce.id,xs.vertexBuffer,xs.indexBuffer,xs.segments,Ce.paint,me.transform.zoom,void 0,al)}}}}()}(m,o,d,g),void W();if(Z.type!=="model")return;const Y=Z.getModels(),te=[],J=m.transform.getFreeCameraOptions().position,oe=i.c5([],[J.x,J.y,J.z],m.transform.worldSize);i.ew(oe,oe);const ae=[],pe=[];let _e=0;for(const me of Y){const Le=o.getFeatureState("",me.id),Ce={type:"Unknown",id:me.id,properties:me.featureProperties},Re=d.paint.get("model-rotation").evaluate(Ce,Le),Ae=d.paint.get("model-scale").evaluate(Ce,Le),Te=d.paint.get("model-translation").evaluate(Ce,Le),ze=d.paint.get("model-opacity").evaluate(Ce,Le);gS(d,me.id,Le,me.featureProperties,me.nodeOverrideNames,me.nodeOverrides),_S(d,me.id,Le,me.featureProperties,me.materialOverrideNames,me.materialOverrides),me.nodeOverrides.size>0&&me.computeBoundsAndApplyParent(),me.computeModelMatrix(m,Re,Ae,Te,I,E,!1);const We=i.bA([]),Ge=i.ef(me.position.lat,m.transform.zoom),ct=i.bq([],[1,1,1/Ge]);i.br(We,We,oe),te.push({zScaleMatrix:ct,negCameraPosMatrix:We});for(const ht of me.nodes)Zf(m,ht,me.matrix,m.transform.expandedFarZProjMatrix,_e,ae,pe,me.materialOverrides,ze);_e++}if(ae.sort((me,Le)=>Le.depth-me.depth),m.renderPass!=="shadow")yS(m,d,ae,pe,te),W();else{for(const me of pe)Tc(me.mesh,me.nodeModelMatrix,m,d);for(const me of ae)Tc(me.mesh,me.nodeModelMatrix,m,d);W()}}},t1={line:function(m,o,d){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,m._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||m._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){const g=o.getVisibleCoordinates();for(const b of g){const T=o.getTile(b).getBucket(m);if(T&&(T.elevationType!=="none"?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,o,d){const g=o.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(d.modelManager&&d.modelManager.upload(d,_g(d,m)));if(g.type==="batched-model"||g.type!=="model")return;const b=g.getModels();for(const T of b)T.upload(d.context)},raster:function(m,o,d){const g=o.getSource();if(!(g instanceof _l&&g.loaded()))return;const b=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!b)return;const T=m.paint.get("raster-array-band")||g.getInitialBand(b);if(T==null)return;const E=o.getIds().map(I=>o.getTileByID(I));for(const I of E)I.updateNeeded(m.id,T)&&g.prepareTile(I,b,m.id,T)},"raster-particle":function(m,o,d){const g=o.getSource();if(!(g instanceof _l&&g.loaded()))return;const b=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!b)return;const T=m.paint.get("raster-particle-array-band")||g.getInitialBand(b);if(T==null)return;const E=o.getIds().map(I=>o.getTileByID(I));for(const I of E)I.updateNeeded(m.id,T)&&g.prepareTile(I,b,m.id,T)}},xu={fill:Uy},n1={fill:function(m,o,d,g){if(!d.layout||d.layout.get("fill-elevation-reference")==="none"||d.paint.get("fill-opacity").constantOr(1)===0)return;const b=m.context.gl,T=new Fn(b.LEQUAL,Fn.ReadOnly,m.depthRangeFor3D),E=new Mr({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),I=m.transform.getFreeCameraOptions().position,M=m.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const N of g){const j=o.getTile(N),W=j.getBucket(d);if(!W)continue;const Z=W.elevatedStructures;if(!Z||Z.depthSegments.segments[0].primitiveLength===0)continue;const Y=oS(N.toUnwrapped(),I),te=m.translatePosMatrix(N.projMatrix,j,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor")),J=jf(te,Y,0,1,0);M.draw(m,b.TRIANGLES,T,E,Vr.disabled,Rr.disabled,J,d.id,Z.vertexBuffer,Z.indexBuffer,Z.depthSegments,d.paint,m.transform.zoom)}}};class r1{constructor(o,d,g,b,T){this.context=new im(o,d),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=i.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const E=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const M of E)this._debugParams.enabledLayers[M]=!0;for(const M of E);this.occlusionParams=new am,this.setup(),this.numSublayers=Jl.maxUnderzooming+Jl.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new qp(this),this._wireframeDebugCache=new Uh,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new i.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,I,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=b,this.worldview=T,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(o,d){const g=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new bb(this,o));const b=this._terrain;this.transform.elevation=g?b:null,b.update(o,this.transform,d),this.transform.elevation&&!b.enabled&&(this.transform.elevation=null)}_updateFog(o){const d=o.fog;if(!d||this.transform.projection.name==="globe"||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,b]=d.getFovAdjustedRange(this.transform._fov);if(g>b)return void(this.transform.fogCullDistSq=null);const T=g+.78*(b-g);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new bb(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,d){if(this.width=o*i.o.devicePixelRatio,this.height=d*i.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._mergedLayers[g].resize()}setup(){const o=this.context,d=new i.bd;d.emplaceBack(0,0),d.emplaceBack(i.al,0),d.emplaceBack(0,i.al),d.emplaceBack(i.al,i.al),this.tileExtentBuffer=o.createVertexBuffer(d,i.bf.members),this.tileExtentSegments=i.bg.simpleSegment(0,0,4,2);const g=new i.bd;g.emplaceBack(0,0),g.emplaceBack(i.al,0),g.emplaceBack(0,i.al),g.emplaceBack(i.al,i.al),this.debugBuffer=o.createVertexBuffer(g,i.bf.members),this.debugSegments=i.bg.simpleSegment(0,0,4,5);const b=new i.bd;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(b,i.bf.members),this.viewportSegments=i.bg.simpleSegment(0,0,4,2);const T=new i.b1;T.emplaceBack(0,0,0,0),T.emplaceBack(i.al,0,i.al,0),T.emplaceBack(0,i.al,0,i.al),T.emplaceBack(i.al,i.al,i.al,i.al),this.mercatorBoundsBuffer=o.createVertexBuffer(T,i.bi.members),this.mercatorBoundsSegments=i.bg.simpleSegment(0,0,4,2);const E=new i.b0;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(E);const I=new i.be;for(const N of[0,1,3,2,0])I.emplaceBack(N);this.debugIndexBuffer=o.createIndexBuffer(I),this.emptyTexture=new i.T(o,new i.q({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=i.bC();const M=this.context.gl;this.stencilClearMode=new Mr({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,Fn.disabled,this.stencilClearMode,Vr.disabled,Rr.disabled,ug(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,d,g){if(!d||this.currentStencilSource===d.id||!o.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const M of g)if(this._tileClippingMaskIDs[M.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=d.id;const b=this.context,T=b.gl;this.nextStencilID+g.length>256&&this.clearStencil(),b.setColorMode(Vr.disabled),b.setDepthMode(Fn.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of g){const M=d.getTile(I),N=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:j,tileBoundsIndexBuffer:W,tileBoundsSegments:Z}=this.getTileBoundsBuffers(M);E.draw(this,T.TRIANGLES,Fn.disabled,new Mr({func:T.ALWAYS,mask:0},N,255,T.KEEP,T.KEEP,T.REPLACE),Vr.disabled,Rr.disabled,ug(I.projMatrix),"$clipping",j,W,Z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,d=this.context.gl;return new Mr({func:d.NOTEQUAL,mask:255},o,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const d=this.context.gl;return new Mr({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(o){const d=this.context.gl,g=o.sort((E,I)=>I.overscaledZ-E.overscaledZ),b=g[g.length-1].overscaledZ,T=g[0].overscaledZ-b+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const E={};for(let I=0;I<T;I++)E[I+b]=new Mr({func:d.GEQUAL,mask:255},I+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=T,[E,g]}return[{[b]:Mr.disabled},g]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Vr([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new i.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Vr.unblended:Vr.alphaBlended}colorModeForDrapableLayerRenderPass(o){const d=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?o!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new Vr([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.CONSTANT_ALPHA,d.ONE_MINUS_SRC_ALPHA],new i.ao(0,0,0,o??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new Vr([d.ONE,d.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,d.ONE_MINUS_SRC_ALPHA],i.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(o,d,g,b=!1){if(this.depthOcclusion)return new Fn(this.context.gl.GREATER,Fn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!b)return Fn.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Fn(g||this.context.gl.LEQUAL,d,[T,T])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const o=this.context.gl,d=Math.ceil(this.width),g=Math.ceil(this.height),b=this.context.bindFramebuffer.get(),T=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===d&&this.depthFBO.height===g||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),d!==0&&g!==0&&(this.depthFBO=new aS(this.context,d,g,0,"texture"),this.depthTexture=new i.T(this.context,{width:d,height:g,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(b),o.bindTexture(o.TEXTURE_2D,T),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,d,g,0,0,d,g,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,d)=>o+d/this._fpsHistory.length,0))}render(o,d){const g=i.o.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=d;const b=this.style._mergedLayers,T=!(!this.terrain||!this.terrain.enabled),E=()=>this.style._getOrder(T).filter(it=>{const Ue=b[it];return!(Ue.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ue.type]});let I=E(),M=!1,N=!1,j=null,W=0,Z=!1;for(const it of I){const Ue=b[it];Ue.visibility!=="none"&&(Ue.type==="circle"?M=!0:Ue.type==="building"?(j=Ue,++W):Ue.type==="symbol"&&(Ue.hasOcclusionOpacityProperties?N=!0:M=!0))}this.updateEmissiveMode();let Y=I.map(it=>b[it]);const te=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(i.o.now()),this.imageManager.beginFrame();for(const it in te){const Ue=te[it];Ue.used&&(Ue.prepare(this.context),Ue.getSource().usedInConflation&&++W)}let J=!1;for(const it of Y)it.isHidden(this.transform.zoom)||(it.type==="clip"&&(J=!0),this.prepareLayer(it));const oe={},ae={},pe={},_e={},me={};for(const it in te){const Ue=te[it];oe[it]=Ue.getVisibleCoordinates(),ae[it]=oe[it].slice().reverse(),pe[it]=Ue.getVisibleCoordinates(!0).reverse(),_e[it]=Ue.getShadowCasterCoordinates(),me[it]=Ue.sortCoordinatesByDistance(oe[it])}const Le=it=>{const Ue=this.style.getLayerSourceCache(it);return Ue&&Ue.used?Ue.getSource():null};if(W||J||this._clippingActiveLastFrame){const it=[],Ue=[];let _t=0;for(const ut of Y)this.isSourceForClippingOrConflation(ut,Le(ut))&&(it.push(ut),Ue.push(_t)),_t++;if(it&&(J||it.length>1)||this._clippingActiveLastFrame){J=!1;const ut=[];for(let Pt=0;Pt<it.length;Pt++){const nn=it[Pt],_n=Ue[Pt],Yt=this.style.getLayerSourceCache(nn);if(!Yt||!Yt.used||!Yt.getSource().usedInConflation&&nn.type!=="clip"&&nn.type!=="building")continue;let Vt=i.eQ,On=i.b_.None;const Cn=[];let fn=!0;if(nn.type==="building")Vt=i.eS;else if(nn.type==="clip"){Vt=_n;for(const vn of nn.layout.get("clip-layer-types"))On|=vn==="model"?i.b_.Model:vn==="symbol"?i.b_.Symbol:i.b_.FillExtrusion;for(const vn of nn.layout.get("clip-layer-scope"))Cn.push(vn);nn.isHidden(this.transform.zoom)?fn=!1:J=!0}fn&&ut.push({layer:nn.fqid,cache:Yt,order:Vt,clipMask:On,clipScope:Cn})}this.replacementSource.setSources(ut),Z=!0}}this._clippingActiveLastFrame=J,Z||this.replacementSource.clear(),this.conflationActive=Z,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let it=0;it<Y.length;it++){const Ue=Y[it];if(Ue.visibility==="none")continue;const _t=Ue.cutoffRange();if(this.longestCutoffRange=Math.max(_t,this.longestCutoffRange),_t>0){const ut=Le(Ue);ut&&(this.minCutoffZoom=Math.max(ut.minzoom,this.minCutoffZoom)),Ue.minzoom&&(this.minCutoffZoom=Math.max(Ue.minzoom,this.minCutoffZoom))}Ue.is3D(T)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=it),this._lastOcclusionLayer=it)}const Ce=this.style&&this.style.fog;Ce?(this._fogVisible=Ce.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ce.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(pe),this.opaquePassCutoff=0,I=E(),Y=I.map(it=>b[it]));const Re=this._shadowRenderer;if(Re){Re.updateShadowParameters(this.transform,this.style.directionalLight);for(const it in te)for(const Ue of oe[it]){let _t={min:0,max:0};this.terrain&&(_t=this.terrain.getMinMaxForTile(Ue)||_t),Re.addShadowReceiver(Ue.toUnwrapped(),_t.min,_t.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new mS(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Ae=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Ae&&!this._snow&&(this._snow=new zb(this)),!Ae&&this._snow&&(this._snow.destroy(),delete this._snow),Te&&!this._rain&&(this._rain=new e1(this)),!Te&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),j){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Xy);const it=this.style.getLayerSourceCache(j);this.buildingTileBorderManager.updateBorders(it,j)}if(!sr.has(this.context.gl))return;this.renderPass="offscreen";for(const it of Y){const Ue=o.getLayerSourceCache(it);if(!it.hasOffscreenPass()||it.isHidden(this.transform.zoom))continue;const _t=Ue?ae[Ue.id]:void 0;(it.type==="custom"||it.type==="raster"||it.type==="raster-particle"||it.isSky()||_t&&_t.length)&&this.renderLayer(this,Ue,it,_t)}this.depthRangeFor3D=[0,1-(Y.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,_e)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ze=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),We=(()=>{if(d.showOverdrawInspector)return i.ao.black;const it=this.style.fog;if(it&&this.transform.projection.supportsFog){const Ue=this.style.getLut(it.scope);if(!ze){const _t=it.properties.get("color-use-theme")==="none",ut=it.properties.get("color").toNonPremultipliedRenderColor(_t?null:Ue).toArray01();return new i.ao(...ut)}if(ze){const _t=it.properties.get("space-color-use-theme")==="none",ut=it.properties.get("space-color").toNonPremultipliedRenderColor(_t?null:Ue).toArray01();return new i.ao(...ut)}}return i.ao.transparent})();if(this.context.clear({color:We,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ze&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const it=Y[this.currentLayer],Ue=o.getLayerSourceCache(it);if(it.isSky())continue;const _t=Ue?(it.is3D(T)?me:ae)[Ue.id]:void 0;this._renderTileClippingMasks(it,Ue,_t),this.renderLayer(this,Ue,it,_t)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ze&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const it=Y[this.currentLayer],Ue=o.getLayerSourceCache(it);it.isSky()&&this.renderLayer(this,Ue,it,Ue?ae[Ue.id]:void 0)}function Ge(it,Ue){let _t;return Ue&&(_t=(it.type==="symbol"?pe:it.is3D(T)?me:ae)[Ue.id]),_t}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const it=Y[this.currentLayer];if(it.type==="raster"||it.type==="raster-particle"){const Ue=o.getLayerSourceCache(it);this.renderLayer(this,Ue,it,Ge(it,Ue))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ct=0;Re&&(ct=Re.getShadowCastingLayerCount());let ht=!1,Et=-1;for(let it=0;it<I.length;++it){const Ue=Y[it];Ue.isHidden(this.transform.zoom)||Ue.is3D(T)&&(Et=it)}N&&Et===-1&&(M=!0);let Ut=!1;for(;this.currentLayer<I.length;){const it=Y[this.currentLayer],Ue=o.getLayerSourceCache(it);if(it.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(it)){if(it.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ut&&it.is3D(T)&&!T){const _t=this.currentLayer,ut=Pt=>{for(this.currentLayer=0;this.currentLayer<Y.length;this.currentLayer++){const nn=Y[this.currentLayer];if(xu[nn.type]){const _n=this.style.getLayerSourceCache(nn);xu[nn.type](this,_n,nn,Ge(nn,_n),Pt)}}};ut("initialize"),ut("reset"),this.currentLayer=_t,Ut=!0}if(M&&!ht&&this.terrain&&!this.transform.isOrthographic&&(ht=!0,this.blitDepth()),N&&Et!==-1&&this.currentLayer===Et+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(it,Ue,Ue?oe[Ue.id]:void 0),this.renderLayer(this,Ue,it,Ge(it,Ue)),!this.terrain&&Re&&ct>0&&it.hasShadowPass()&&--ct==0){{this.clearStencil(),this.resetStencilClippingMasks();const _t=this.currentLayer;for(this.currentLayer=0;this.currentLayer<Y.length;this.currentLayer++){const ut=Y[this.currentLayer];if(n1[ut.type]){const Pt=this.style.getLayerSourceCache(ut);n1[ut.type](this,Pt,ut,Ge(ut,Pt))}}this.currentLayer=_t}if(Re.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const _t=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=_t;this.currentLayer++){const ut=Y[this.currentLayer];if(!ut.hasLightBeamPass())continue;const Pt=o.getLayerSourceCache(ut);this.renderLayer(this,Pt,ut,Pt?ae[Pt.id]:void 0)}this.currentLayer=_t,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const _t=this.currentLayer;this.depthOcclusion=!0;for(const ut of this.layersWithOcclusionOpacity){this.currentLayer=ut;const Pt=Y[this.currentLayer],nn=o.getLayerSourceCache(Pt),_n=nn?ae[nn.id]:void 0;this.terrain||this._renderTileClippingMasks(Pt,nn,nn?oe[nn.id]:void 0),this.renderLayer(this,nn,Pt,_n)}this.depthOcclusion=!1,this.currentLayer=_t,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let it=null;Y.forEach(Ue=>{const _t=o.getLayerSourceCache(Ue);_t&&!Ue.isHidden(this.transform.zoom)&&_t.getVisibleCoordinates().length&&(!it||it.getSource().maxzoom<_t.getSource().maxzoom)&&(it=_t)}),it&&this.options.showTileBoundaries&&Wt(this,it,it.getVisibleCoordinates(),i.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Wt(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(it){const Ue=it.transform.padding;Gf(it,it.transform.height-(Ue.top||0),3,cS),Gf(it,Ue.bottom||0,3,dS),xa(it,Ue.left||0,3,hS),xa(it,it.transform.width-(Ue.right||0),3,$f);const _t=it.transform.centerPoint;(function(ut,Pt,nn,_n){Qe(ut,Pt-1,nn-10,2,20,_n),Qe(ut,Pt-10,nn-1,20,2,_n)})(it,_t.x,it.transform.height-_t.y,Hf)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Z||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);const{unsupportedLayers:d}=this.transform.projection,g=!d||!d.includes(o.type);if(t1[o.type]&&(g||this.terrain&&o.type==="custom")){const b=this.style.getLayerSourceCache(o);t1[o.type](o,b,this)}this.gpuTimingEnd()}renderLayer(o,d,g,b){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||b&&b.length)&&(this.id=g.id,this.gpuTimingStart(g),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(g.type)&&(!o.terrain||g.type!=="custom")||g.type==="clip"||Vh[g.type](o,d,g,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery,g=this.context.gl;let b=this.gpuTimers[o.id];b||(b=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:g.createQuery()}),b.calls++,g.beginQuery(d.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,d=this.context.gl,g=d.createQuery();this.deferredRenderGpuTimeQueries.push(g),d.beginQuery(o.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const d={};for(const g in o){const b=o[g],T=this.context.extTimerQuery,E=T.getQueryParameter(b.query,this.context.gl.QUERY_RESULT)/1e6;T.deleteQueryEXT(b.query),d[g]=E}return d}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.gl;let g=0;for(const b of o)g+=d.getQueryParameter(b,d.QUERY_RESULT)/1e6,d.deleteQuery(b);return g}translatePosMatrix(o,d,g,b,T){if(!g[0]&&!g[1])return o;const E=T?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(E){const N=Math.sin(E),j=Math.cos(E);g=[g[0]*j-g[1]*N,g[0]*N+g[1]*j]}const I=[T?g[0]:i.ay(d,g[0],this.transform.zoom),T?g[1]:i.ay(d,g[1],this.transform.zoom),0],M=new Float32Array(16);return i.br(M,o,I),M}saveTileTexture(o){if(o.context!==this.context)return;const d=o.size[0],g=this._tileTextures[d];g?g.push(o):this._tileTextures[d]=[o]}getTileTexture(o){const d=this._tileTextures[o];return d&&d.length>0?d.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,d,g){const b=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,T=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(T.push("LIGHTING_3D_MODE"),T.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):b||T.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||T.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(T.push("TERRAIN"),this.linearFloatFilteringSupported()&&T.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&T.push("GLOBE"),!this._fogVisible||b||d!==void 0&&!d||T.push("FOG","FOG_DITHERING"),b&&T.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&T.push("OVERDRAW_INSPECTOR"),T}getOrCreateProgram(o,d){this.cache=this.cache||{};const g=d&&d.defines||[],b=d&&d.config,T=this.currentGlobalDefines(o,d&&d.overrideFog,d&&d.overrideRtt).concat(g),E=WE.cacheKey(lb[o],o,T,b);return this.cache[E]||(this.cache[E]=new WE(this.context,o,lb[o],b,jy[o],T)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,d){if(this.style.enable3dLights()){const g=this.style.directionalLight,b=this.style.ambientLight;if(g&&b){const T=((E,I,M)=>{const N=E.properties.get("direction"),j=E.properties.get("color-use-theme")==="none",W=E.properties.get("color").toNonPremultipliedRenderColor(j?null:M.getLut(E.scope)).toArray01(),Z=E.properties.get("intensity"),Y=I.properties.get("color-use-theme")==="none",te=I.properties.get("color").toNonPremultipliedRenderColor(Y?null:M.getLut(I.scope)).toArray01(),J=I.properties.get("intensity"),oe=[N.x,N.y,N.z],ae=i.dN(te,J),pe=i.dN(W,Z);return{u_lighting_ambient_color:ae,u_lighting_directional_dir:oe,u_lighting_directional_color:pe,u_ground_radiance:tm(oe,pe,ae)}})(g,b,this.style);d.setLightsUniformValues(o,T)}}}uploadCommonUniforms(o,d,g,b,T){if(this.uploadCommonLightUniforms(o,d),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const I=E.getOpacity(this.transform.pitch),M=((N,j,W,Z,Y,te,J,oe,ae,pe,_e,me)=>{const Le=N.transform,Ce=j.properties.get("color-use-theme")==="none",Re=j.properties.get("color").toNonPremultipliedRenderColor(Ce?null:N.style.getLut(j.scope)).toArray01();Re[3]=Z;const Ae=N.frameCounter/1e3%1,[Te,ze]=j.properties.get("vertical-range");return{u_fog_matrix:W?Le.calculateFogTileMatrix(W):me||N.identityMat,u_fog_range:j.getFovAdjustedRange(Le._fov),u_fog_color:Re,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Te,ze),ze],u_fog_temporal_offset:Ae,u_frustum_tl:Y,u_frustum_tr:te,u_frustum_br:J,u_frustum_bl:oe,u_globe_pos:ae,u_globe_radius:pe,u_viewport:_e,u_globe_transition:i.aj(Le.zoom),u_is_globe:+(Le.projection.name==="globe")}})(this,E,g,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.o.devicePixelRatio,this.transform.height*i.o.devicePixelRatio],b);d.setFogUniformValues(o,M)}T&&d.setCutoffUniformValues(o,T.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,d=o.createTexture();return o.bindTexture(o.TEXTURE_2D,d),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,d=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const b of g)d[b.key]=o[b.key]||new Of(b,512,this.transform.tileZoom,this,void 0,this.worldview);return d}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,d){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&o.type!=="building"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building"&&o.sourceLayer!=="procedural_buildings")&&(!d||d.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let d=this._cachedTileFogOpacities[o.key];return d||(this._cachedTileFogOpacities[o.key]=d=this.style.fog.getOpacityForTile(o)),d[0]>=xt||d[1]>=xt}setupDepthForOcclusion(o,d,g){const b=this.context,T=b.gl,E=!!g;var I;g||(g={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),b.activeTexture.set(T.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),g.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],g.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],g.u_occluder_half_size=.5*this.occlusionParams.occluderSize,g.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),b.activeTexture.set(T.TEXTURE0),E||d.setTerrainUniformValues(b,g)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const o=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=o?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function i1(m,o){let d=!1,g=null;const b=()=>{g=null,d&&(m(),g=setTimeout(b,o),d=!1)};return()=>(d=!0,g||b(),g)}class Fb{constructor(o){this._hashName=o&&encodeURIComponent(o),i.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=i1(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const d=to(o);if(this._hashName){const g=this._hashName;let b=!1;const T=location.hash.slice(1).split("&").map(E=>{const I=E.split("=")[0];return I===g?(b=!0,`${I}=${d}`):E}).filter(E=>E);return b||T.push(`${g}=${d}`),`#${T.join("&")}`}return`#${d}`}_getCurrentHash(){const o=location.hash.replace("#","");if(this._hashName){let d;return o.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(d=g)}),(d&&d[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(g=>isNaN(Number(g)))){const g=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(d[3]||0):o.getBearing();return o.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:g,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function to(m,o){const d=m.getCenter(),g=Math.round(100*m.getZoom())/100,b=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,b),E=Math.round(d.lng*T)/T,I=Math.round(d.lat*T)/T,M=m.getBearing(),N=m.getPitch();let j=o?`/${E}/${I}/${g}`:`${g}/${I}/${E}`;return(M||N)&&(j+="/"+Math.round(10*M)/10),N&&(j+=`/${Math.round(N)}`),j}const lm={linearity:.3,easing:i.eT(0,0,.3,1)},Bb=Object.assign({deceleration:2500,maxSpeed:1400},lm),jb=Object.assign({deceleration:20,maxSpeed:1400},lm),Xf=Object.assign({deceleration:1e3,maxSpeed:360},lm),Ub=Object.assign({deceleration:1e3,maxSpeed:90},lm);class Vb{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.o.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,d=i.o.now();for(;o.length>0&&d-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)d.zoom+=T.zoomDelta||0,d.bearing+=T.bearingDelta||0,d.pitch+=T.pitchDelta||0,T.panDelta&&d.pan._add(T.panDelta),T.around&&(d.around=T.around),T.pinchAround&&(d.pinchAround=T.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){const T=sd(d.pan.mag(),g,Object.assign({},Bb,o||{}));b.offset=d.pan.mult(T.amount/d.pan.mag()),b.center=this._map.transform.center,um(b,T)}if(d.zoom){const T=sd(d.zoom,g,jb);b.zoom=this._map.transform.zoom+T.amount,um(b,T)}if(d.bearing){const T=sd(d.bearing,g,Xf);b.bearing=this._map.transform.bearing+i.aA(T.amount,-179,179),um(b,T)}if(d.pitch){const T=sd(d.pitch,g,Ub);b.pitch=this._map.transform.pitch+T.amount,um(b,T)}if(b.zoom||b.bearing){const T=d.pinchAround===void 0?d.around:d.pinchAround;b.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function um(m,o){(!m.duration||m.duration<o.duration)&&(m.duration=o.duration,m.easing=o.easing)}function sd(m,o,d){const{maxSpeed:g,linearity:b,deceleration:T}=d,E=i.aA(m*b/(o/1e3),-g,g),I=Math.abs(E)/(T*b);return{easing:d.easing,duration:1e3*I,amount:E*(I/2)}}class Bl extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,g,b={}){const T=ve(d.getCanvasContainer(),g),E=d.unproject(T);super(o,Object.assign({point:T,lngLat:E,originalEvent:g},b)),this._defaultPrevented=!1,this.target=d}}class $h extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,g){const b=o==="touchend"?g.changedTouches:g.touches,T=Je(d.getCanvasContainer(),b),E=T.map(M=>d.unproject(M)),I=T.reduce((M,N,j,W)=>M.add(N.div(W.length)),new i.P(0,0));super(o,{points:T,point:I,lngLats:E,lngLat:d.unproject(I),originalEvent:g}),this._defaultPrevented=!1}}class $b extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d){super("wheel",{originalEvent:d}),this._defaultPrevented=!1}}class s1{constructor(o,d){this._map=o,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new $b(this._map,o))}mousedown(o,d){return this._mousedownPos=d,this._firePreventable(new Bl(o.type,this._map,o))}mouseup(o){this._map.fire(new Bl(o.type,this._map,o))}preclick(o){const d=new MouseEvent("preclick",o);this._map.fire(new Bl(d.type,this._map,d))}click(o,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Bl(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Bl(o.type,this._map,o))}mouseover(o){this._map.fire(new Bl(o.type,this._map,o))}mouseout(o){this._map.fire(new Bl(o.type,this._map,o))}touchstart(o){return this._firePreventable(new $h(o.type,this._map,o))}touchmove(o){this._map.fire(new $h(o.type,this._map,o))}touchend(o){this._map.fire(new $h(o.type,this._map,o))}touchcancel(o){this._map.fire(new $h(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hb{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Bl(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Bl("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Bl(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class a1{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,d){this.isEnabled()&&o.shiftKey&&o.button===0&&(ie(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(o,d){if(!this._active)return;const g=d,b=this._startPos,T=this._lastPos;if(!b||!T||T.equals(g)||!this._box&&g.dist(b)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=U("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const E=Math.min(b.x,g.x),I=Math.max(b.x,g.x),M=Math.min(b.y,g.y),N=Math.max(b.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${M}px)`,this._box.style.width=I-E+"px",this._box.style.height=N-M+"px")})}mouseupWindow(o,d){if(!this._active)return;const g=this._startPos,b=d;if(g&&o.button===0){if(this.reset(),be(),g.x!==b.x||g.y!==b.y)return this._map.fire(new i.z("boxzoomend",{originalEvent:o})),{cameraAnimation:T=>T.fitScreenCoordinates(g,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),de(),delete this._startPos,delete this._lastPos}_fireEvent(o,d){return this._map.fire(new i.z(o,{originalEvent:d}))}}function o1(m,o){const d={};for(let g=0;g<m.length;g++)d[m[g].identifier]=o[g];return d}class wS{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,d,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),g.length===this.numTouches&&(this.centroid=function(b){const T=new i.P(0,0);for(const E of b)T._add(E);return T.div(b.length)}(d),this.touches=o1(g,d)))}touchmove(o,d,g){if(this.aborted||!this.centroid)return;const b=o1(g,d);for(const T in this.touches){const E=b[T];(!E||E.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(o,d,g){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class l1{constructor(o){this.singleTap=new wS(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,d,g){this.singleTap.touchstart(o,d,g)}touchmove(o,d,g){this.singleTap.touchmove(o,d,g)}touchend(o,d,g){const b=this.singleTap.touchend(o,d,g);if(b){const T=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(b)<30;if(T&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class TS{constructor(){this._zoomIn=new l1({numTouches:1,numTaps:2}),this._zoomOut=new l1({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,d,g){this._zoomIn.touchstart(o,d,g),this._zoomOut.touchstart(o,d,g)}touchmove(o,d,g){this._zoomIn.touchmove(o,d,g),this._zoomOut.touchmove(o,d,g)}touchend(o,d,g){const b=this._zoomIn.touchend(o,d,g),T=this._zoomOut.touchend(o,d,g);return b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(b)},{originalEvent:o})}):T?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(T)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ES={0:1,2:2},Gb={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class u1{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,d){return!1}_move(o,d){return{}}mousedown(o,d){if(this._lastPoint)return;const g=we(o);this._correctButton(o,g)&&(this._lastPoint=d,this._eventButton=g)}mousemoveWindow(o,d){const g=this._lastPoint;if(g){if(o.preventDefault(),this._eventButton!=null&&function(b,T){const E=ES[T];return b.buttons===void 0||(b.buttons&E)!==E}(o,this._eventButton))this.reset();else if(this._moved||!(d.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(g,d)}}mouseupWindow(o){this._lastPoint&&we(o)===this._eventButton&&(this._moved&&be(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class SS extends u1{mousedown(o,d){super.mousedown(o,d),this._lastPoint&&(this._active=!0)}_correctButton(o,d){return d===0&&!o.ctrlKey}_move(o,d){return{around:d,panDelta:d.sub(o)}}}class qb extends u1{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Gb[o.pitchRotateKey]:void 0}_correctButton(o,d){return this._pitchRotateKey?d===0&&o[this._pitchRotateKey]:d===0&&o.ctrlKey||d===2}_move(o,d){const g=.8*(d.x-o.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class Zb extends u1{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Gb[o.pitchRotateKey]:void 0}_correctButton(o,d){return this._pitchRotateKey?d===0&&o[this._pitchRotateKey]:d===0&&o.ctrlKey||d===2}_move(o,d){const g=-.5*(d.y-o.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class AS{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),i.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(o,d,g){return this._calculateTransform(o,d,g)}touchmove(o,d,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!i.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,d,g)}}touchend(o,d,g){this._calculateTransform(o,d,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,d,g){g.length>0&&(this._active=!0);const b=o1(g,d),T=new i.P(0,0),E=new i.P(0,0);let I=0;for(const N in b){const j=b[N],W=this._touches[N];W&&(T._add(j),E._add(j.sub(W)),I++,b[N]=j)}if(this._touches=b,I<this._minTouches||!E.mag())return;const M=E.div(I);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(I),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class c1{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,d,g){return{}}touchstart(o,d,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([d[0],d[1]]))}touchmove(o,d,g){const b=this._firstTwoTouches;if(!b)return;o.preventDefault();const[T,E]=b,I=vg(g,d,T),M=vg(g,d,E);if(!I||!M)return;const N=this._aroundCenter?null:I.add(M).div(2);return this._move([I,M],N,o)}touchend(o,d,g){if(!this._firstTwoTouches)return;const[b,T]=this._firstTwoTouches,E=vg(g,d,b),I=vg(g,d,T);E&&I||(this._active&&be(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function vg(m,o,d){for(let g=0;g<m.length;g++)if(m[g].identifier===d)return o[g]}function CS(m,o){return Math.log2(m/o)}class DI extends c1{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,d){const g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(CS(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:CS(this._distance,g),pinchAround:d}}}function kS(m,o){return 180*m.angleWith(o)/Math.PI}class da extends c1{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,d){const g=this._vector;if(this._vector=o[0].sub(o[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:kS(this._vector,g),pinchAround:d}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const d=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const b=kS(o,g);return Math.abs(b)<d}}function d1(m){return Math.abs(m.y)>Math.abs(m.x)}class NI extends c1{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,d1(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,d,g){const b=this._lastPoints;if(!b)return;const T=o[0].sub(b[0]),E=o[1].sub(b[1]);return this._map._cooperativeGestures&&!i.eU()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(T,E,g.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(T.y+E.y)/2*-.5})}gestureBeginsVertically(o,d,g){if(this._valid!==void 0)return this._valid;const b=o.mag()>=2,T=d.mag()>=2;if(!b&&!T)return;if(!b||!T)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const E=o.y>0==d.y>0;return d1(o)&&d1(d)&&E}}const zI={panStep:100,bearingStep:15,pitchStep:10};class FI{constructor(){const o=zI;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let d=0,g=0,b=0,T=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:o.shiftKey?g=-1:(o.preventDefault(),T=-1);break;case 39:o.shiftKey?g=1:(o.preventDefault(),T=1);break;case 38:o.shiftKey?b=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?b=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,b=0),{cameraAnimation:I=>{const M=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:xg,zoom:d?Math.round(M)+d*(o.shiftKey?2:1):M,bearing:I.getBearing()+g*this._bearingStep,pitch:I.getPitch()+b*this._pitchStep,offset:[-T*this._panStep,-E*this._panStep],center:I.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xg(m){return m*(2-m)}const Wb=4.000244140625,Xb=1/450;class h1{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._handler=d,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Xb,i.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||i.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const g=i.o.now(),b=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,d!==0&&d%Wb==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),o.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=o,this._delta-=d,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=ve(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const N=this._type==="wheel"&&Math.abs(this._delta)>Wb?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&j!==0&&(j=1/j);const W=d(),Z=Math.pow(2,W),Y=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):Z;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(Y*j))),this._type==="wheel"&&(this._startZoom=W,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:d(),b=this._startZoom,T=this._easing;let E,I=!1;if(this._type==="wheel"&&b&&T){const N=Math.min((i.o.now()-this._lastWheelEventTime)/200,1),j=T(N);E=i.ak(b,g,j),N<1?this._frameId||(this._frameId=!0):I=!0}else E=g,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let M=E-d();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let d=i.eV;if(this._prevEase){const g=this._prevEase,b=(i.o.now()-g.start)/g.duration,T=g.easing(b+.01)-g.easing(b),E=.27/Math.sqrt(T*T+1e-4)*.01,I=Math.sqrt(.0729-E*E);d=i.eT(E,I,.25,1)}return this._prevEase={start:i.o.now(),duration:o,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class jd{constructor(o,d){this._clickZoom=o,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class f1{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,d){return o.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(o.shiftKey?-1:1),around:g.unproject(d)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class no{constructor(){this._tap=new l1({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,d,g){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=d[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(o,d,g))}touchmove(o,d,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const b=d[0],T=b.y-this._swipePoint.y;return this._swipePoint=b,o.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(o,d,g)}touchend(o,d,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(o,d,g)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ad{constructor(o,d,g){this._el=o,this._mousePan=d,this._touchPan=g}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class bg{constructor(o,d,g){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=d,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class p1{constructor(o,d,g,b){this._el=o,this._touchZoom=d,this._touchRotate=g,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const wg=m=>m.zoom||m.drag||m.pitch||m.rotate;class BI extends i.z{}class Tg{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,d){const g=i.av([],d,o);this.radius=i.ag(g[2]<0?i.eX([],g,this.constants):[g[0],g[1],0])}projectRay(o){i.eX(o,o,this.constants),i.aw(o,o),i.eY(o,o,this.constants);const d=i.c5([],o,this.radius);if(d[2]>0){const g=i.c5([],[0,0,1],i.bJ(d,[0,0,1])),b=i.c5([],i.aw([],[d[0],d[1],0]),this.radius),T=i.d8([],d,i.c5([],i.av([],i.d8([],b,g),d),2));d[0]=T[0],d[1]=T[1]}return d}}function m1(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class jI{constructor(o,d){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vb(o),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Tg,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),i.aY(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,T,E]of this._listeners){const I=b===document?this.handleWindowEvent:this.handleEvent;b.addEventListener(T,I,E)}}destroy(){for(const[o,d,g]of this._listeners){const b=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(d,b,g)}}_addDefaultHandlers(o){const d=this._map,g=d.getCanvasContainer();this._add("mapEvent",new s1(d,o));const b=d.boxZoom=new a1(d,o);this._add("boxZoom",b);const T=new TS,E=new f1;d.doubleClickZoom=new jd(E,T),this._add("tapZoom",T),this._add("clickZoom",E);const I=new no;this._add("tapDragZoom",I);const M=d.touchPitch=new NI(d);this._add("touchPitch",M);const N=new qb(o),j=new Zb(o);d.dragRotate=new bg(o,N,j),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);const W=new SS(o),Z=new AS(d,o);d.dragPan=new ad(g,W,Z),this._add("mousePan",W),this._add("touchPan",Z,["touchZoom","touchRotate"]);const Y=new da,te=new DI;d.touchZoomRotate=new p1(g,te,Y,I),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Hb(d));const J=d.scrollZoom=new h1(d,this);this._add("scrollZoom",J,["mousePan"]);const oe=d.keyboard=new FI;this._add("keyboard",oe);for(const ae of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[ae]&&d[ae].enable(o[ae])}_add(o,d,g){this._handlers.push({handlerName:o,handler:d,allowed:g}),this._handlersById[o]=d}stop(o){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wg(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,d,g){for(const b in o)if(b!==g&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const d=[];for(const g of o)this._el.contains(g.target)&&d.push(g);return d}handleEvent(o,d){this._updatingCamera=!0;const g=o.type==="renderFrame",b=g?void 0:o,T={needsRenderFrame:!1},E={},I={},M=o.touches?this._getMapTouches(o.touches):void 0,N=M?Je(this._el,M):g?void 0:ve(this._el,o);for(const{handlerName:Z,handler:Y,allowed:te}of this._handlers){if(!Y.isEnabled())continue;let J;this._blockedByActive(I,te,Z)?Y.reset():Y[d||o.type]&&(J=Y[d||o.type](o,N,M),this.mergeHandlerResult(T,E,J,Z,b),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||Y.isActive())&&(I[Z]=Y)}const j={};for(const Z in this._previousActiveHandlers)I[Z]||(j[Z]=b);this._previousActiveHandlers=I,(Object.keys(j).length||m1(T))&&(this._changes.push([T,E,j]),this._triggerRenderFrame()),(Object.keys(I).length||m1(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=T;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))}mergeHandlerResult(o,d,g,b,T){if(!g)return;Object.assign(o,g);const E={handlerName:b,originalEvent:g.originalEvent||T};g.zoomDelta!==void 0&&(d.zoom=E),g.panDelta!==void 0&&(d.drag=E),g.pitchDelta!==void 0&&(d.pitch=E),g.bearingDelta!==void 0&&(d.rotate=E)}_applyChanges(){const o={},d={},g={};for(const[b,T,E]of this._changes)b.panDelta&&(o.panDelta=(o.panDelta||new i.P(0,0))._add(b.panDelta)),b.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(o.around=b.around),b.aroundCoord!==void 0&&(o.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(o.pinchAround=b.pinchAround),b.noInertia&&(o.noInertia=b.noInertia),Object.assign(d,T),Object.assign(g,E);this._updateMapTransform(o,d,g),this._changes=[]}_updateMapTransform(o,d,g){const b=this._map,T=b.transform,E=pe=>[pe.x,pe.y,pe.z];if((pe=>{const _e=this._eventsInProgress.drag;return _e&&!this._handlersById[_e.handlerName].isActive()})()&&!m1(o)){const pe=T.zoom;T.cameraElevationReference="sea",this._originalZoom!=null&&T._orthographicProjectionAtLowPitch&&T.projection.name!=="globe"&&T.pitch===0?(T.cameraElevationReference="ground",T.zoom=this._originalZoom):(T.recenterOnTerrain(),T.cameraElevationReference="ground"),pe!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&b._stop(!0),!m1(o))return void this._fireEvents(d,g,!0);let{panDelta:I,zoomDelta:M,bearingDelta:N,pitchDelta:j,around:W,aroundCoord:Z,pinchAround:Y}=o;T._isCameraConstrained&&(M>0&&(M=0),T._isCameraConstrained=!1),Y!==void 0&&(W=Y),(M||(pe=>d[pe]&&!this._eventsInProgress[pe])("drag"))&&W&&(this._dragOrigin=E(T.pointCoordinate3D(W)),this._originalZoom=T.zoom,this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",b._stop(!0),W=W||b.transform.centerPoint,N&&(T.bearing+=N),j&&(T.pitch+=j),T._updateCameraState();const te=[0,0,0];if(I)if(T.projection.name==="mercator"){const pe=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(W).dir),_e=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(W.sub(I)).dir);te[0]=_e[0]-pe[0],te[1]=_e[1]-pe[1]}else{const pe=T.pointCoordinate(W);if(T.projection.name==="globe"){I=I.rotate(-T.angle);const _e=T._pixelsPerMercatorPixel/T.worldSize;te[0]=-I.x*i.eW(i.a$(pe.y))*_e,te[1]=-I.y*i.eW(T.center.lat)*_e}else{const _e=T.pointCoordinate(W.sub(I));pe&&_e&&(te[0]=_e.x-pe.x,te[1]=_e.y-pe.y)}}const J=T.zoom,oe=[0,0,0];if(M){const pe=E(Z||T.pointCoordinate3D(W)),_e={dir:i.aw([],i.av([],pe,T._camera.position))};if(_e.dir[2]<0){const me=T.zoomDeltaToMovement(pe,M);i.c5(oe,_e.dir,me)}}const ae=i.d8(te,te,oe);T._translateCameraConstrained(ae),M&&Math.abs(T.zoom-J)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(d,g,!0)}_fireEvents(o,d,g){const b=wg(this._eventsInProgress),T=wg(o),E={};for(const j in o){const{originalEvent:W}=o[j];this._eventsInProgress[j]||(E[`${j}start`]=W),this._eventsInProgress[j]=o[j]}!b&&T&&this._fireEvent("movestart",T.originalEvent);for(const j in E)this._fireEvent(j,E[j]);T&&this._fireEvent("move",T.originalEvent);for(const j in o){const{originalEvent:W}=o[j];this._fireEvent(j,W)}const I={};let M;for(const j in this._eventsInProgress){const{handlerName:W,originalEvent:Z}=this._eventsInProgress[j];this._handlersById[W].isActive()||(delete this._eventsInProgress[j],M=d[W]||Z,I[`${j}end`]=M)}for(const j in I)this._fireEvent(j,I[j]);const N=wg(this._eventsInProgress);if(g&&(b||T)&&!N){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),W=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;j?(W(j.bearing||this._map.getBearing())&&(j.bearing=0),this._map.easeTo(j,{originalEvent:M})):(this._map.fire(new i.z("moveend",{originalEvent:M})),W(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,d){this._map.fire(new i.z(o,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new BI("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const g1="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Yb extends i.E{constructor(o,d){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=d.respectPrefersReducedMotion!==!1,i.aY(["_renderFrameCallback"],this)}getCenter(){return new i.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(o,d){return this.jumpTo({center:o},d)}panBy(o,d,g){return o=i.P.convert(o).mult(-1),this.panTo(this.transform.center,Object.assign({offset:o},d),g)}panTo(o,d,g){return this.easeTo(Object.assign({center:o},d),g)}getZoom(){return this.transform.zoom}setZoom(o,d){return this.jumpTo({zoom:o},d),this}zoomTo(o,d,g){return this.easeTo(Object.assign({zoom:o},d),g)}zoomIn(o,d){return this.zoomTo(this.getZoom()+1,o,d),this}zoomOut(o,d){return this.zoomTo(this.getZoom()-1,o,d),this}getBearing(){return this.transform.bearing}setBearing(o,d){return this.jumpTo({bearing:o},d),this}getPadding(){return this.transform.padding}setPadding(o,d){return this.jumpTo({padding:o},d),this}rotateTo(o,d,g){return this.easeTo(Object.assign({bearing:o},d),g)}resetNorth(o,d){return this.rotateTo(0,Object.assign({duration:1e3},o),d),this}resetNorthPitch(o,d){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},o),d),this}snapToNorth(o,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,d):this}getPitch(){return this.transform.pitch}setPitch(o,d){return this.jumpTo({pitch:o},d),this}cameraForBounds(o,d){o=i.aI.convert(o);const g=d&&d.bearing||0,b=d&&d.pitch||0,T=o.getNorthWest(),E=o.getSouthEast();return this._cameraForBounds(this.transform,T,E,g,b,d)}_extendPadding(o){const d={top:0,right:0,bottom:0,left:0};return o==null?Object.assign({},d,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:Object.assign({},d,o)}_extendCameraOptions(o){return(o=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,d){const g=d.max[0]-d.min[0],b=d.max[1]-d.min[1];return g/b>o.aspect?g/(2*Math.tan(.5*o.fovX)*o.aspect):b/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,d,g,b,T,E){const I=o.clone(),M=this._extendCameraOptions(E);I.bearing=b,I.pitch=T;const N=i.aT.convert(d),j=i.aT.convert(g),W=.5*(N.lat+j.lat),Z=.5*(N.lng+j.lng),Y=i.eZ(W,Z),te=i.aw([],Y),J=i.aw([],i.bI([],te,[0,1,0])),oe=i.bI([],J,te),ae=[J[0],J[1],J[2],0,oe[0],oe[1],oe[2],0,te[0],te[1],te[2],0,0,0,0,1],pe=[Y,i.eZ(N.lat,N.lng),i.eZ(j.lat,N.lng),i.eZ(j.lat,j.lng),i.eZ(N.lat,j.lng),i.eZ(W,N.lng),i.eZ(W,j.lng),i.eZ(N.lat,Z),i.eZ(j.lat,Z)];let _e=i.d9.fromPoints(pe.map(ut=>[i.bJ(J,ut),i.bJ(oe,ut),i.bJ(te,ut)]));const me=i.af([],_e.center,ae);i.e_(me)===0&&i.e$(me,0,0,1),i.aw(me,me),i.c5(me,me,i.aD),I.center=i.f0(me);const Le=I.getWorldToCameraMatrix(),Ce=i.bl(new Float64Array(16),Le);_e=i.d9.applyTransform(_e,i.aB([],Le,ae));const Re=this._extendAABB(_e,I,M,b);if(!Re)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");_e=Re,i.af(me,me,Le);const Ae=.5*(_e.max[2]-_e.min[2]),Te=this._minimumAABBFrustumDistance(I,_e),ze=i.c5([],[0,0,1],Ae),We=i.d8(ze,me,ze),Ge=Te+(I.pitch===0?0:i.bG(me,We)),ct=I.globeCenterInViewSpace,ht=i.av([],me,[ct[0],ct[1],ct[2]]);i.aw(ht,ht),i.c5(ht,ht,Ge);const Et=i.d8([],me,ht);i.af(Et,Et,Ce);const Ut=i.eM/i.aD,it=i.ag(Et),Ue=i.cf(Math.max(it*Ut-i.eM,Number.EPSILON),0),_t=Math.min(I.zoomFromMercatorZAdjusted(Ue),M.maxZoom);return _t>.5*(i.c_+i.cL)?(I.setProjection({name:"mercator"}),I.zoom=_t,this._cameraForBounds(I,d,g,b,T,E)):{center:I.center,zoom:_t,bearing:b,pitch:T}}_extendAABB(o,d,g,b){const T=.5*((g.padding.left||0)+(g.padding.right||0)),E=.5*((g.padding.top||0)+(g.padding.bottom||0)),I=E,M=T,N=T,j=E,W=d.width-(M+N),Z=d.height-(I+j),Y=i.av([],o.max,o.min),te=Math.min(W/Y[0],Z/Y[1]),J=Math.min(d.scaleZoom(d.scale*te),g.maxZoom);if(isNaN(J))return null;const oe=d.scale/d.zoomScale(J),ae=new i.d9([o.min[0]-M*oe,o.min[1]-j*oe,o.min[2]],[o.max[0]+N*oe,o.max[1]+I*oe,o.max[2]]),pe=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new i.P(g.offset.x,g.offset.y):i.P.convert(g.offset)).rotate(-i.an(b));return ae.center[0]-=pe.x*oe,ae.center[1]+=pe.y*oe,ae}queryTerrainElevation(o,d){const g=this.transform.elevation;return g?(d=Object.assign({},{exaggerated:!0},d),g.getAtPoint(i.ae.fromLngLat(o),null,d.exaggerated)):null}_cameraForBounds(o,d,g,b,T,E){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,d,g,b,T,E);const I=o.clone(),M=this._extendCameraOptions(E);I.bearing=b,I.pitch=T;const N=i.aT.convert(d),j=i.aT.convert(g),W=new i.aT(N.lng,j.lat),Z=new i.aT(j.lng,N.lat),Y=I.project(N),te=I.project(j),J=this.queryTerrainElevation(N),oe=this.queryTerrainElevation(j),ae=this.queryTerrainElevation(W),pe=this.queryTerrainElevation(Z),_e=[[Y.x,Y.y,Math.min(J||0,oe||0,ae||0,pe||0)],[te.x,te.y,Math.max(J||0,oe||0,ae||0,pe||0)]];let me=i.d9.fromPoints(_e);const Le=I.getWorldToCameraMatrix(),Ce=i.bl(new Float64Array(16),Le);me=i.d9.applyTransform(me,Le);const Re=this._extendAABB(me,I,M,b);if(!Re)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");me=Re;const Ae=.5*i.av([],me.max,me.min)[2],Te=this._minimumAABBFrustumDistance(I,me),ze=[0,0,1,0];i.aC(ze,ze,Le),i.f1(ze,ze);const We=i.c5([],ze,Te+Ae),Ge=i.d8([],me.center,We);i.af(me.center,me.center,Ce),i.af(Ge,Ge,Ce);const ct=I.unproject(new i.P(me.center[0],me.center[1])),ht=i.f2(I.projection,ct),Et=Math.pow(2,ht),Ut=Math.min(I._zoomFromMercatorZ(Ge[2]*I.pixelsPerMeter*Et/I.worldSize),M.maxZoom);return I.mercatorFromTransition&&Ut<.5*(i.c_+i.cL)?(I.setProjection({name:"globe"}),I.zoom=Ut,this._cameraForBounds(I,d,g,b,T,E)):{center:ct,zoom:Ut,bearing:b,pitch:T}}fitBounds(o,d,g){const b=this.cameraForBounds(o,d);return this._fitInternal(b,d,g)}fitScreenCoordinates(o,d,g,b,T){const E=i.P.convert(o),I=i.P.convert(d),M=new i.P(Math.min(E.x,I.x),Math.min(E.y,I.y)),N=new i.P(Math.max(E.x,I.x),Math.max(E.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,I))return this;const j=this.transform.pointLocation3D(M),W=this.transform.pointLocation3D(N),Z=this.transform.pointLocation3D(new i.P(M.x,N.y)),Y=this.transform.pointLocation3D(new i.P(N.x,M.y)),te=[Math.min(j.lng,W.lng,Z.lng,Y.lng),Math.min(j.lat,W.lat,Z.lat,Y.lat)],J=[Math.max(j.lng,W.lng,Z.lng,Y.lng),Math.max(j.lat,W.lat,Z.lat,Y.lat)],oe=b&&b.pitch?b.pitch:this.getPitch(),ae=this._cameraForBounds(this.transform,te,J,g,oe,b);return this._fitInternal(ae,b,T)}_fitInternal(o,d,g){return o?(d=Object.assign(o,d)).linear?this.easeTo(d,g):this.flyTo(d,g):this}jumpTo(o,d){this.stop();const g=o.preloadOnly?this.transform.clone():this.transform;let b=!1,T=!1,E=!1;"zoom"in o&&g.zoom!==+o.zoom&&(b=!0,g.zoom=+o.zoom),o.center!==void 0&&(g.center=i.aT.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(T=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(E=!0,g.pitch=+o.pitch);const I=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!g.isPaddingEqual(I))if(o.retainPadding===!1){const M=g.clone();M.padding=I,g.setLocationAtPoint(g.center,M.centerPoint)}else g.padding=I;return o.preloadOnly?(this._preloadTiles(g),this):(this.fire(new i.z("movestart",d)).fire(new i.z("move",d)),b&&this.fire(new i.z("zoomstart",d)).fire(new i.z("zoom",d)).fire(new i.z("zoomend",d)),T&&this.fire(new i.z("rotatestart",d)).fire(new i.z("rotate",d)).fire(new i.z("rotateend",d)),E&&this.fire(new i.z("pitchstart",d)).fire(new i.z("pitch",d)).fire(new i.z("pitchend",d)),this.fire(new i.z("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(g1),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,d){const g=this.transform;if(!g.projection.supportsFreeCamera)return i.w(g1),this;this.stop();const b=g.zoom,T=g.pitch,E=g.bearing;g.setFreeCameraOptions(o);const I=b!==g.zoom,M=T!==g.pitch,N=E!==g.bearing;return this.fire(new i.z("movestart",d)).fire(new i.z("move",d)),I&&this.fire(new i.z("zoomstart",d)).fire(new i.z("zoom",d)).fire(new i.z("zoomend",d)),N&&this.fire(new i.z("rotatestart",d)).fire(new i.z("rotate",d)).fire(new i.z("rotateend",d)),M&&this.fire(new i.z("pitchstart",d)).fire(new i.z("pitch",d)).fire(new i.z("pitchend",d)),this.fire(new i.z("moveend",d)),this}easeTo(o,d){this._stop(!1,o.easeId),((o=Object.assign({offset:[0,0],duration:500,easing:i.eV},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const g=this.transform,b=this.getZoom(),T=this.getBearing(),E=this.getPitch(),I=this.getPadding(),M="zoom"in o?+o.zoom:b,N="bearing"in o?this._normalizeBearing(o.bearing,T):T,j="pitch"in o?+o.pitch:E,W=this._extendPadding(o.padding),Z=i.P.convert(o.offset);let Y,te,J;if(g.projection.name==="globe"){const ze=i.ae.fromLngLat(g.center),We=Z.rotate(-g.angle);ze.x+=We.x/g.worldSize,ze.y+=We.y/g.worldSize;const Ge=ze.toLngLat(),ct=i.aT.convert(o.center||Ge);this._normalizeCenter(ct),Y=g.centerPoint.add(We),te=new i.P(ze.x,ze.y).mult(g.worldSize),J=new i.P(i.aF(ct.lng),i.aJ(ct.lat)).mult(g.worldSize).sub(te)}else{Y=g.centerPoint.add(Z);const ze=g.pointLocation(Y),We=i.aT.convert(o.center||ze);this._normalizeCenter(We),te=g.project(ze),J=g.project(We).sub(te)}const oe=g.zoomScale(M-b);let ae,pe;o.around&&(ae=i.aT.convert(o.around),pe=g.locationPoint(ae));const _e=this._zooming||M!==b,me=this._rotating||T!==N,Le=this._pitching||j!==E,Ce=!g.isPaddingEqual(W),Re=o.retainPadding===!1?g.clone():g,Ae=ze=>We=>{if(_e&&(ze.zoom=i.ak(b,M,We)),me&&(ze.bearing=i.ak(T,N,We)),Le&&(ze.pitch=i.ak(E,j,We)),Ce&&(Re.interpolatePadding(I,W,We),Y=Re.centerPoint.add(Z)),ae)ze.setLocationAtPoint(ae,pe);else{const Ge=ze.zoomScale(ze.zoom-b),ct=M>b?Math.min(2,oe):Math.max(.5,oe),ht=Math.pow(ct,1-We),Et=ze.unproject(te.add(J.mult(We*ht)).mult(Ge));ze.setLocationAtPoint(ze.renderWorldCopies?Et.wrap():Et,Y)}return o.preloadOnly||this._fireMoveEvents(d),ze};if(o.preloadOnly){const ze=this._emulate(Ae,o.duration,g);return this._preloadTiles(ze),this}const Te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=_e,this._rotating=me,this._pitching=Le,this._padding=Ce,this._easeId=o.easeId,this._prepareEase(d,o.noMoveStart,Te),this._ease(Ae(g),ze=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(d,ze)},o),this}_prepareEase(o,d,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),d||g.moving||this.fire(new i.z("movestart",o)),this._zooming&&!g.zooming&&this.fire(new i.z("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new i.z("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new i.z("pitchstart",o))}_fireMoveEvents(o){this.fire(new i.z("move",o)),this._zooming&&this.fire(new i.z("zoom",o)),this._rotating&&this.fire(new i.z("rotate",o)),this._pitching&&this.fire(new i.z("pitch",o))}_afterEase(o,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,b=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new i.z("zoomend",o)),b&&this.fire(new i.z("rotateend",o)),T&&this.fire(new i.z("pitchend",o)),this.fire(new i.z("moveend",o))}flyTo(o,d){if(this._prefersReducedMotion(o)){const ut=i.aH(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ut,d)}this.stop(),o=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:i.eV},o);const g=this.transform,b=this.getZoom(),T=this.getBearing(),E=this.getPitch(),I=this.getPadding(),M="zoom"in o?i.aA(+o.zoom,g.minZoom,g.maxZoom):b,N="bearing"in o?this._normalizeBearing(o.bearing,T):T,j="pitch"in o?+o.pitch:E,W=this._extendPadding(o.padding),Z=g.zoomScale(M-b),Y=i.P.convert(o.offset);let te=g.centerPoint.add(Y);const J=g.pointLocation(te),oe=i.aT.convert(o.center||J);this._normalizeCenter(oe);const ae=g.project(J),pe=g.project(oe).sub(ae);let _e=o.curve;const me=Math.max(g.width,g.height),Le=me/Z,Ce=pe.mag();if("minZoom"in o){const ut=i.aA(Math.min(o.minZoom,b,M),g.minZoom,g.maxZoom),Pt=me/g.zoomScale(ut-b);_e=Math.sqrt(Pt/Ce*2)}const Re=_e*_e;function Ae(ut){const Pt=(Le*Le-me*me+(ut?-1:1)*Re*Re*Ce*Ce)/(2*(ut?Le:me)*Re*Ce);return Math.log(Math.sqrt(Pt*Pt+1)-Pt)}function Te(ut){return(Math.exp(ut)-Math.exp(-ut))/2}function ze(ut){return(Math.exp(ut)+Math.exp(-ut))/2}const We=Ae(0);let Ge=function(ut){return ze(We)/ze(We+_e*ut)},ct=function(ut){return me*((ze(We)*(Te(Pt=We+_e*ut)/ze(Pt))-Te(We))/Re)/Ce;var Pt},ht=(Ae(1)-We)/_e;if(Math.abs(Ce)<1e-6||!isFinite(ht)){if(Math.abs(me-Le)<1e-6)return this.easeTo(o,d);const ut=Le<me?-1:1;ht=Math.abs(Math.log(Le/me))/_e,ct=function(){return 0},Ge=function(Pt){return Math.exp(ut*_e*Pt)}}o.duration="duration"in o?+o.duration:1e3*ht/("screenSpeed"in o?+o.screenSpeed/_e:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const Et=T!==N,Ut=j!==E,it=!g.isPaddingEqual(W),Ue=o.retainPadding===!1?g.clone():g,_t=ut=>Pt=>{const nn=Pt*ht,_n=1/Ge(nn);ut.zoom=Pt===1?M:b+ut.scaleZoom(_n),Et&&(ut.bearing=i.ak(T,N,Pt)),Ut&&(ut.pitch=i.ak(E,j,Pt)),it&&(Ue.interpolatePadding(I,W,Pt),te=Ue.centerPoint.add(Y));const Yt=Pt===1?oe:ut.unproject(ae.add(pe.mult(ct(nn))).mult(_n));return ut.setLocationAtPoint(ut.renderWorldCopies?Yt.wrap():Yt,te),ut._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(d),ut};if(o.preloadOnly){const ut=this._emulate(_t,o.duration,g);return this._preloadTiles(ut),this}return this._zooming=!0,this._rotating=Et,this._pitching=Ut,this._padding=it,this._prepareEase(d,!1),this._ease(_t(g),()=>this._afterEase(d),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,d)}if(!o){const g=this.handlers;g&&g.stop(!1)}return this}_ease(o,d,g){g.animate===!1||g.duration===0?(o(1),d()):(this._easeStart=i.o.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((i.o.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,d){o=i.bT(o,-180,180);const g=Math.abs(o-d);return Math.abs(o-360-d)<g&&(o-=360),Math.abs(o+360-d)<g&&(o+=360),o}_normalizeCenter(o){const d=this.transform;if(d.maxBounds||d.projection.name!=="globe"&&!d.renderWorldCopies)return;const g=o.lng-d.center.lng;o.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&i.o.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,d,g){const b=Math.ceil(15*d/1e3),T=[],E=o(g.clone());for(let I=0;I<=b;I++){const M=E(I/b);T.push(M.clone())}return T}_preloadTiles(o,d){}}class Eg{constructor(o={}){this.options=o,i.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const d=this.options&&this.options.compact,g=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",g);const b=U("span","mapboxgl-ctrl-icon",this._compactButton);return b.setAttribute("aria-hidden","true"),b.setAttribute("title",g),this._innerContainer=U("div","mapboxgl-ctrl-attrib-inner",this._container),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(o){const g=d.reduce((b,T,E)=>(T.value&&(b+=`${T.key}=${T.value}${E<d.length-1?"&":""}`),b),"?");o.href=`${i.e.FEEDBACK_URL}/${g}#${to(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||(o.dataType!=="source"||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility")&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const d=this._map.style._mergedSourceCaches;for(const b in d){const T=d[b];if(T.used){const E=T.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o.sort((b,T)=>b.length-T.length),o=o.filter((b,T)=>{for(let E=T+1;E<o.length;E++)if(o[E].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const g=o.map(b=>function(T){const E=new DOMParser().parseFromString(T,"text/html");return Array.from(E.body.querySelectorAll("*")).forEach(I=>{const M=I.textContent||"";if(I.tagName!=="A")return void I.replaceWith(E.createTextNode(M));const N=I.getAttribute("href");if(!N||!/^(https?:|mailto:)/i.test(N))return void I.replaceWith(E.createTextNode(M));const j=E.createElement("a");j.href=N,j.textContent=M,j.rel="noopener nofollow";const W=I.getAttribute("class");W&&(j.className=W),I.replaceWith(j)}),E.body.innerHTML}(b)).join(" | ");g!==this._attribHTML&&(this._attribHTML=g,o.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Sg{constructor(){i.aY(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=U("div","mapboxgl-ctrl");const d=U("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const d in o){const g=o[d].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const d=o[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class cm{constructor(){i.aY(["_onIndoorUpdate"],this)}onAdd(o){return this._map=o,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",d=>this._onIndoorUpdate(d)),this._container}_createButton(o,d){const g=U("button",o,this._container);return g.type="button",g.addEventListener("click",d),g}_createSeparator(){return U("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(o,d){this._map&&(o.setAttribute("aria-label",d),o.textContent=d)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(o){if(!o||!o.floors)return this._model=o,void(this._container.style.display="none");const d=this._model;this._model=o,this._container.style.display="inline-block",this._container.style.borderRadius="8px",d&&Array.from(this._container.children).forEach(g=>g.remove()),o.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(o.floors,o.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const o=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const d=this._map;this._model&&d&&d._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});U("span","mapboxgl-ctrl-icon",o).setAttribute("aria-hidden","true"),o.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&o.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(o),this._createSeparator()}_updateBuildingsButtonState(){const o=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");o&&this._model&&(this._model.activeFloorsVisible?o.classList.remove("mapboxgl-ctrl-level-button-selected"):o.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(o,d){for(let g=0;g<o.length;g++){const b=o[g],T=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(b.id)});this._setButtonTitle(T,b.zIndex.toString()),this._model&&b.id===this._model.selectedFloorId&&d&&T.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(T),g<o.length-1&&this._createSeparator()}}}class Ud{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const d=++this._id;return this._queue.push({callback:o,id:d,cancelled:!1}),d}remove(o){const d=this._currentlyRunning,g=d?this._queue.concat(d):this._queue;for(const b of g)if(b.id===o)return void(b.cancelled=!0)}run(o=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const g of d)if(!g.cancelled&&(g.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Vd{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const d=i.dD((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,d,g){this._start=this.getValue(d),this._end=o,this._startTime=d,this._endTime=d+g}}const $d={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Hh extends i.z{constructor(o,d,g,b){const{point:T,lngLat:E,originalEvent:I,target:M}=o;super(o.type,{point:T,lngLat:E,originalEvent:I,target:M}),this.preventDefault=()=>{o.preventDefault()},this.id=d,this.interaction=g,this.feature=b}}class Ec{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,d){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);const g=d.filter;let b=d.type;g&&this.filters.set(o,i.b6(g)),b==="mouseover"&&(b="mouseenter"),b==="mouseout"&&(b="mouseleave");const T=this.interactionsByType.get(b)||new Map;b==="mouseenter"||b==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,d)):T.size===0&&this.map.on(b,this.handleType),T.size===0&&this.interactionsByType.set(b,T),T.set(o,d),this.typeById.set(o,b)}get(o){const d=this.typeById.get(o);if(!d)return;const g=this.interactionsByType.get(d);return g?g.get(o):void 0}remove(o){const d=this.typeById.get(o);if(!d)return;this.typeById.delete(o),this.filters.delete(o);const g=this.interactionsByType.get(d);g&&(g.delete(o),d==="mouseenter"||d==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):g.size===0&&this.map.off(d,this.handleType))}queryTargets(o,d){const g=[];for(const[b,T]of d)T.target&&g.push({targetId:b,target:T.target,filter:this.filters.get(b)});return this.map.style.queryRenderedTargets(o,g,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const d=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());d.length&&(o.type="mouseenter",this.handleType(o,d));const g=new Map;for(const[b,{feature:T}]of this.prevHoveredFeatures)this.hoveredFeatures.has(b)||g.set(T.id,T);g.size&&(o.type="mouseleave",this.handleType(o,Array.from(g.values())))}handleOut(o){const d=Array.from(this.hoveredFeatures.values()).map(({feature:g})=>g);d.length&&(o.type="mouseleave",this.handleType(o,d)),this.hoveredFeatures.clear()}handleType(o,d){const g=o.type==="mouseenter";if(g&&!this.interactionsByType.has(o.type))return void i.w("mouseenter interaction required for mouseleave to work.");const b=Array.from(this.interactionsByType.get(o.type)).reverse(),T=!!d;d=d||this.queryTargets(o.point,b);let E=!1;const I=new Set;for(const M of d){for(const[N,j]of b){if(!j.target)continue;const W=M.variants?M.variants[N]:null;if(W){for(const Z of W){if(Vp(Z,M,I,N))continue;const Y=new i.dx(M,Z),te=Mf(Z,M,N);T&&Y.id!==void 0&&(Y.state=this.map.getFeatureState(Y));const J=g?this.prevHoveredFeatures.get(te):null,oe=new Hh(o,N,j,Y),ae=J?J.stop:j.handler(oe);if(g&&this.hoveredFeatures.set(te,{feature:M,stop:ae}),ae!==!1){E=!0;break}}if(E)break}}if(E)break}if(!E)for(const[M,N]of b){const{handler:j,target:W}=N;if(!W&&j(new Hh(o,M,N,null))!==!1)break}}}function UI(m,o){if(Array.isArray(m)&&Array.isArray(o)){const d=new Set(m),g=new Set(o);return d.size===g.size&&m.every(b=>g.has(b))}return i.by(m,o)}const VI={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},$I={showCompass:!0,showZoom:!0,visualizePitch:!1};class HI{constructor(o,d,g=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new qb({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,g&&(this.mousePitch=new Zb({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),i.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(o,d){this.mouseRotate.mousedown(o,d),this.mousePitch&&this.mousePitch.mousedown(o,d),ie()}move(o,d){const g=this.map,b=this.mouseRotate.mousemoveWindow(o,d),T=b&&b.bearingDelta;if(T&&g.setBearing(g.getBearing()+T),this.mousePitch){const E=this.mousePitch.mousemoveWindow(o,d),I=E&&E.pitchDelta;I&&g.setPitch(g.getPitch()+I)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){de(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(Object.assign({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),ve(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,ve(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Je(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=Je(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Kb(m,o,d){if(m=new i.aT(m.lng,m.lat),o){const g=new i.aT(m.lng-360,m.lat),b=new i.aT(m.lng+360,m.lat),T=360*Math.ceil(Math.abs(m.lng-d.center.lng)/360),E=d.locationPoint3D(m).distSqr(o),I=o.x<0||o.y<0||o.x>d.width||o.y>d.height;d.locationPoint3D(g).distSqr(o)<E&&(I||Math.abs(g.lng-d.center.lng)<T)?m=g:d.locationPoint3D(b).distSqr(o)<E&&(I||Math.abs(b.lng-d.center.lng)<T)&&(m=b)}for(;Math.abs(m.lng-d.center.lng)>180;){const g=d.locationPoint3D(m);if(g.x>=0&&g.y>=0&&g.x<=d.width&&g.y<=d.height)break;m.lng>d.center.lng?m.lng-=360:m.lng+=360}return m}const sl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Zu={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class _1 extends i.E{constructor(o,d){super(),(o instanceof HTMLElement||d)&&(o=Object.assign({element:o},d)),i.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:g="center",color:b="#3FB1CE",scale:T=1,draggable:E=!1,clickTolerance:I=0,rotation:M=Zu.rotation,rotationAlignment:N=Zu.rotationAlignment,pitchAlignment:j=Zu.pitchAlignment,occludedOpacity:W=Zu.occludedOpacity,altitude:Z=Zu.altitude}=o||{};this._anchor=g,this._color=b,this._scale=T,this._draggable=E,this._clickTolerance=I,this._rotation=M,this._rotationAlignment=N,this._pitchAlignment=j,this._occludedOpacity=W,this._altitude=Z,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=i.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",J=>{J.preventDefault()}),this._element.addEventListener("mousedown",J=>{J.preventDefault()});const Y=this._element.classList;for(const J in sl)Y.remove(`mapboxgl-marker-anchor-${J}`);Y.add(`mapboxgl-marker-anchor-${this._anchor}`);const te=o&&o.className?o.className.trim().split(/\s+/):[];Y.add(...te),this._popup=null}_createDefaultMarker(){const o=U("div"),d=q("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){const g=q("radialGradient",{id:"shadowGradient"},q("defs",{},d));q("stop",{offset:"10%","stop-opacity":.4},g),q("stop",{offset:"100%","stop-opacity":.05},g),q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},d)}return q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},d),q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},d),q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},d),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=i.aT.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||Zu.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const d=o.code,g=o.charCode||o.keyCode;d!=="Space"&&d!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(o){const d=o.originalEvent.target,g=this._element;this._popup&&(d===g||g.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,d=this._pos;if(!o||!d)return!1;const g=o.unproject(d,this._altitude),b=o.getFreeCameraOptions();if(!b.position)return!1;const T=b.position.toLngLat();return T.distanceTo(g)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const d=this._pos;if(!d||d.x<0||d.x>o.transform.width||d.y<0||d.y>o.transform.height)return void this._clearFadeTimer();const g=o.unproject(d,this._altitude);let b;o._showingGlobe()&&i.f5(o.transform,this._lngLat)?b=0:(b=1-o._queryFogOpacity(g),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${sl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){const o=this._pos,d=this._map,g=this.getPitchAlignment();if(!d||!o||g!=="map")return"";if(!d._showingGlobe()){const M=d.getPitch();return M?`rotateX(${M}deg)`:""}const b=i.cX(i.f6(d.transform,this._lngLat)),T=o.sub(i.f7(d.transform)),E=Math.abs(T.x)+Math.abs(T.y);if(E===0)return"";const I=b/E;return`rotateX(${-T.y*I}deg) rotateY(${T.x*I}deg)`}_calculateZTransform(){const o=this._pos,d=this._map;if(!d||!o)return"";let g=0;const b=this.getRotationAlignment();if(b==="map")if(d._showingGlobe()){const T=d.project(new i.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),E=d.project(new i.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(T);g=i.cX(Math.atan2(E.y,E.x))-90}else g=-d.getBearing();else if(b==="horizon"){const T=i.ah(4,6,d.getZoom()),E=i.f7(d.transform);E.y+=T*d.transform.height;const I=o.sub(E),M=i.cX(Math.atan2(I.y,I.x));g=(M>90?M-270:M+90)*(1-T)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Kb(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=i.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){const d=this._map;if(!d)return;const g=this._pointerdownPos,b=this._positionDelta;if(g&&b){if(!this._isDragging){const T=this._clickTolerance||d._clickTolerance;if(o.point.dist(g)<T)return;this._isDragging=!0}this._pos=o.point.sub(b),this._lngLat=d.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.z("dragstart"))),this.fire(new i.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.z("dragend")),this._state="inactive"}_addDragHandler(o){const d=this._map,g=this._pos;d&&g&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(g),this._pointerdownPos=o.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const d=this._map;return d&&(o?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||Zu.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||Zu.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||Zu.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||Zu.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const GI={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},dm={maxWidth:100,unit:"metric"},Qb={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Wu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Xu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Yf(m=new i.P(0,0),o="bottom"){if(typeof m=="number"){const d=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(o){case"top":return new i.P(0,m);case"top-left":return new i.P(d,d);case"top-right":return new i.P(-d,d);case"bottom":return new i.P(0,-m);case"bottom-left":return new i.P(d,-d);case"bottom-right":return new i.P(-d,-d);case"left":return new i.P(m,0);case"right":return new i.P(-m,0)}return new i.P(0,0)}return m instanceof i.P||Array.isArray(m)?i.P.convert(m):i.P.convert(m[o]||[0,0])}return{version:y,supported:F.supported,setRTLTextPlugin:i.fb,getRTLTextPluginStatus:i.fa,Map:class extends Yb{constructor(m){S.mark(x.create);const o=m;if((m=Object.assign({},VI,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&i.f3(window)&&(m.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new tb(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Ud,this._domRenderTaskQueue=new Ud,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.b2(),this._locale=Object.assign({},$d,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Vd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new Ct(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},typeof m.container=="string"){const d=document.getElementById(m.container);if(!d)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=d}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,i.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new jI(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||i.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),m.hash&&(this._hash=new Fb(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const d=m.bounds;d&&(this.resize(),this.fitBounds(d,Object.assign({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new Eg({customAttribution:m.customAttribution})),this._logoControl=new Sg,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new i.z(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new i.z(`${d.dataType}dataloading`,d))}),this._interactions=new Ec(this)}_getMapId(){return this._mapId}addControl(m,o){if(o===void 0&&(o=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new i.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[o];return o.indexOf("bottom")!==-1?g.insertBefore(d,g.firstChild):g.appendChild(d),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new i.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(m);return o>-1&&this._controls.splice(o,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new i.z("movestart",m)).fire(new i.z("move",m)),this.fire(new i.z("resize",m)),o&&this.fire(new i.z("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(i.aI.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(o=>o==="auto"?navigator.language:o):m}setLanguage(m){const o=this._parseLanguage(m);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,o=m.projection.name;let d;o==="globe"&&m.zoom>=i.cL?(m.setMercatorFromTransition(),d=!0):o==="mercator"&&m.zoom<i.cL&&(m.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(m,o){return this._updateProjection(m||o||{name:"mercator"})}_updateProjection(m){let o;const d=this.transform.mercatorFromTransition;o=m.name==="globe"&&this.transform.zoom>=i.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate();const g=this.transform.getProjection().name==="mercator"&&d!==this.transform.mercatorFromTransition;return(o||g)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,o){return this.transform.locationPoint3D(i.aT.convert(m),o)}unproject(m,o){return this.transform.pointLocation3D(i.P.convert(m),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,o,d){const g=b=>{let T=[];if(Array.isArray(o)){const E=o.filter(I=>this.getLayer(I));T=E.length?this.queryRenderedFeatures(b,{layers:E}):[]}else T=this.queryRenderedFeatures(b,{target:o});return T};if(m==="mouseenter"||m==="mouseover"){let b=!1;return{listener:d,targets:o,delegates:{mousemove:E=>{const I=g(E.point);I.length?b||(b=!0,d.call(this,new Bl(m,this,E.originalEvent,{features:I}))):b=!1},mouseout:()=>{b=!1}}}}if(m==="mouseleave"||m==="mouseout"){let b=!1;return{listener:d,targets:o,delegates:{mousemove:I=>{g(I.point).length?b=!0:b&&(b=!1,d.call(this,new Bl(m,this,I.originalEvent)))},mouseout:I=>{b&&(b=!1,d.call(this,new Bl(m,this,I.originalEvent)))}}}}{const b=T=>{const E=g(T.point);E.length&&(T.features=E,d.call(this,T),delete T.features)};return{listener:d,targets:o,delegates:{[m]:b}}}}on(m,o,d){if(typeof o=="function"||d===void 0)return super.on(m,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const g=this._createDelegatedListener(m,o,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const b in g.delegates)this.on(b,g.delegates[b]);return this}once(m,o,d){if(typeof o=="function"||d===void 0)return super.once(m,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const g=this._createDelegatedListener(m,o,d);for(const b in g.delegates)this.once(b,g.delegates[b]);return this}off(m,o,d){if(typeof o=="function"||d===void 0)return super.off(m,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const g=this._delegatedListeners?this._delegatedListeners[m]:void 0;return g&&(b=>{for(let T=0;T<b.length;T++){const E=b[T];if(E.listener===d&&UI(E.targets,o)){for(const I in E.delegates)this.off(I,E.delegates[I]);return b.splice(T,1),this}}})(g),this}queryRenderedFeatures(m,o){if(!this.style)return[];if(m===void 0||m instanceof i.P||Array.isArray(m)||o!==void 0||(o=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!o){const T=this.style.queryRenderedFeatures(m,void 0,this.transform),E=this.style.queryRenderedFeatureset(m,void 0,this.transform);return T.concat(E)}let d=!0;if(o.target&&(d=this._isTargetValid(o.target),d&&!o.layers))return this.style.queryRenderedFeatureset(m,o,this.transform);let g=!0;if(o.layers&&Array.isArray(o.layers)){for(const T of o.layers)if(!this._isValidId(T)){g=!1;break}if(g&&!o.target)return this.style.queryRenderedFeatures(m,o,this.transform)}let b=[];return g&&(b=b.concat(this.style.queryRenderedFeatures(m,o,this.transform))),d&&(b=b.concat(this.style.queryRenderedFeatureset(m,o,this.transform))),b}querySourceFeatures(m,o){return!m||typeof m=="string"&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,o)}queryRasterValue(m,o,d){return this._isValidId(m)?this.style.queryRasterValue(m,o,d):Promise.resolve(null)}isPointOnSurface(m){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&i.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(m))}addInteraction(m,o){return this._interactions.add(m,o),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,o){return o=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&m&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(m,(d,g)=>{if(d){const b=typeof d=="string"?d:d instanceof Error?d.message:d.error;i.w(`Unable to perform style diff: ${b}. Rebuilding the style from scratch.`),this._updateStyle(m,o)}else g&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(m,o))}_getUIString(m){const o=this._locale[m];if(o==null)throw new Error(`Missing UI string '${m}'`);return o}_updateStyle(m,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const d=Object.assign({},o);o&&o.config&&(d.initialConfig=o.config,delete d.config),this.style=new qu(this,d).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new qu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new i.y(new Error("IDs can't be empty."))),!1):!i.dr(m)||(this.fire(new i.y(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const o of m)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(m)}addSource(m,o){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,o),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,o,d){this._lazyInitEmptyStyle(),this.style.addSourceType(m,o,d)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,o,{pixelRatio:d=1,sdf:g=!1,stretchX:b,stretchY:T,content:E}={}){this._lazyInitEmptyStyle();const I=i.I.from(m);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){const{width:M,height:N,data:j}=i.o.getImageData(o);this.style.addImage(I,{data:new i.q({width:M,height:N},j),pixelRatio:d,stretchX:b,stretchY:T,content:E,sdf:g,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new i.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:N}=o,j=o;this.style.addImage(I,{data:new i.q({width:M,height:N},new Uint8Array(j.data)),pixelRatio:d,stretchX:b,stretchY:T,content:E,sdf:g,usvg:!1,version:0,userImage:j}),j.onAdd&&j.onAdd(this,m)}}updateImage(m,o){this._lazyInitEmptyStyle();const d=i.I.from(m),g=this.style.getImage(d);if(!g)return void this.fire(new i.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const b=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?i.o.getImageData(o):o,{width:T,height:E,data:I}=b;if(T===void 0||E===void 0)return void this.fire(new i.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(T!==(g.usvg?g.icon.usvg_tree.width:g.data.width)||E!==(g.usvg?g.icon.usvg_tree.height:g.data.height))return void this.fire(new i.y(new Error(`The width and height of the updated image (${T}, ${E})
                must be that same as the previous version of the image
                (${g.data.width}, ${g.data.height})`)));const M=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);let N=!1;g.usvg?(g.data=new i.q({width:T,height:E},new Uint8Array(I)),g.usvg=!1,g.icon=void 0,N=!0):g.data.replace(I,M),this.style.updateImage(d,g,N)}hasImage(m){return m?!!this.style&&!!this.style.getImage(i.I.from(m)):(this.fire(new i.y(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(i.I.from(m))}loadImage(m,o){i.n(this._requestManager.transformRequest(m,i.R.Image),(d,g)=>{o(d,g instanceof HTMLImageElement?i.o.getImageData(g):g)})}listImages(){return this.style.listImages().map(m=>m.name)}addModel(m,o){this._lazyInitEmptyStyle(),this.style.addModel(m,o)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new i.y(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,o){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,o),this._update(!0)):this}getSlot(m){const o=this.getLayer(m);return o&&o.slot||null}setSlot(m,o){return this.style.setSlot(m,o),this.style.mergeLayers(),this._update(!0)}addImport(m,o){return this.style.addImport(m,o).catch(d=>this.fire(new i.y(new Error("Failed to add import",d)))),this}updateImport(m,o){return typeof o!="string"&&o.id!==m?(this.removeImport(m),this.addImport(o)):(this.style.updateImport(m,o),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,o){return this.style.moveImport(m,o),this._update(!0)}moveLayer(m,o){return this._isValidId(m)?(this.style.moveLayer(m,o),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const o=this.style.getOwnLayer(m);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,o,d){return this._isValidId(m)?(this.style.setLayerZoomRange(m,o,d),this._update(!0)):this}setFilter(m,o,d={}){return this._isValidId(m)?(this.style.setFilter(m,o,d),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,o,d,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,o,d,g),this._update(!0)):this}getPaintProperty(m,o){return this._isValidId(m)?this.style.getPaintProperty(m,o):null}setLayoutProperty(m,o,d,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,o,d,g),this._update(!0)):this}getLayoutProperty(m,o){return this._isValidId(m)?this.style.getLayoutProperty(m,o):null}setLayerProperty(m,o,d,g={}){return this._isValidId(m)?(o==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(m,o,d,g),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,o){return this.style.setSchema(m,o),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,o){return this.style.setConfig(m,o),this._update(!0)}getConfigProperty(m,o){return this.style.getConfigProperty(m,o)}setConfigProperty(m,o,d){return this.style.setConfigProperty(m,o,d),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const o=m[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,o),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aT.convert(m),this.transform):0}setFeatureState(m,o){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,o),this._update())}removeFeatureState(m,o){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,o),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_selectIndoorFloor(m){this.indoor.selectFloor(m)}_setIndoorActiveFloorsVisibility(m){this.indoor.setActiveFloorsVisibility(m)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new cm),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let d,g,b,T=this._container;for(;T&&(!g||!b);){const E=window.getComputedStyle(T).transform;E&&E!=="none"&&(d=E.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(g=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(b=d[3])),T=T.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=b?Math.abs(o/b):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new NE(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=U("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=U("div","mapboxgl-canvas-container",m);this._canvas=U("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=U("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(b=>{g[b]=U("div",`mapboxgl-ctrl-${b}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,o){const d=i.o.devicePixelRatio||1;this._canvas.width=d*Math.ceil(m),this._canvas.height=d*Math.ceil(o),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${o}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const o=this._markers.indexOf(m);o!==-1&&this._markers.splice(o,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const o=this._popups.indexOf(m);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const m=Object.assign({},F.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",m);o?(ar(o,!0),this.painter=new r1(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",d=>{d.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.k.testSupport(o)):this.fire(new i.y(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.z("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.z("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let o;this.fire(new i.z("renderstart")),++this._frameId;const d=this.painter.context.extTimerQuery,g=i.o.now(),b=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=b.createQuery(),b.beginQuery(d.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const N=this.transform.zoom,j=this.transform.pitch,W=i.o.now(),Z=new i.ac(N,{now:W,fadeDuration:T,pitch:j,transition:this.style.transition,worldview:this._worldview});this.style.update(Z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(g),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(g);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,S.mark(x.load),this.fire(new i.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const N=i.o.now()-g;b.endQuery(d.TIME_ELAPSED_EXT),setTimeout(()=>{const j=b.getQueryParameter(o,b.QUERY_RESULT)/1e6;b.deleteQuery(o),this.fire(new i.z("gpu-timing-frame",{cpuTime:N,gpuTime:j}))},50)}if(this.listens("gpu-timing-layer")){const N=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(N);this.fire(new i.z("gpu-timing-layer",{layerTimes:j}))},50)}if(this.listens("gpu-timing-deferred-render")){const N=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const j=this.painter.queryGpuTimeDeferredRender(N);this.fire(new i.z("gpu-timing-deferred-render",{gpuTime:j}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(M||this._repaint)this.triggerRepaint();else{const N=this.idle();if(N&&(E=this._updateAverageElevation(g,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),N&&(this.fire(new i.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new i.z("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,S.mark(x.fullLoad),this._performanceMetricsCollection&&rn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const o of this._markers)m&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!m||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(m,o=!1){const d=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);const g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(o||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const b=this.transform.averageElevation;let T=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(T)?T=0:this._averageElevationLastSampledAt=m;const E=Math.abs(b-T);if(E>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(T),d(T);this._averageElevation.easeTo(T,m,300)}else if(E>1e-4)return this._averageElevation.jumpTo(T),d(T)}return!!this._averageElevation.isEasing(m)&&d(this._averageElevation.getValue(m))}_authenticate(){Qr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===ft||m.status===401)){const o=this.painter.context.gl;ar(o,!1),this._logoControl instanceof Sg&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Tn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&zn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&qt(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){Sn(this._requestManager._customAccessToken)}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const d=this.painter.context.gl,g=d.createFramebuffer();function b(T){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,T,0);const E=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,E),E}return d.bindFramebuffer(d.FRAMEBUFFER,g),this._canvasPixelComparison(b(m),o.canvasCopies.map(b),o.timeStamps)}_canvasPixelComparison(m,o,d){let g=d[1]-d[0];const b=m.length/4;for(let T=0;T<o.length;T++){const E=o[T];let I=0;for(let M=0;M<E.length;M+=4)E[M]===m[M]&&E[M+1]===m[M+1]&&E[M+2]===m[M+2]&&E[M+3]===m[M+3]&&(I+=1);g+=(d[T+2]-d[T+1])*(1-I/b)}return g}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),sr.delete(this.painter.context.gl),br.remove(),jt.remove(),this._removed=!0,this.fire(new i.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=i.o.frame(o=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(o)}))}_preloadTiles(m){const o=this.style?this.style.getSourceCaches():[];return i.bw(o,(d,g)=>d._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this.style&&m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,o){i.f4(m,o)}get version(){return y}},NavigationControl:class{constructor(m={}){this.options=Object.assign({},$I,m),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(i.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),U("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),U("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:o}):d.resetNorth({},{originalEvent:o}))}),this._compassIcon=U("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const o=m.getZoom(),d=o===m.getMaxZoom(),g=o===m.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new HI(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,o){const d=U("button",m,this._container);return d.type="button",d.addEventListener("click",o),d}_setButtonTitle(m,o){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${o}`);m.setAttribute("aria-label",d),m.firstElementChild&&m.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends i.E{constructor(m={}){super();const o=navigator.geolocation;this.options=Object.assign({geolocation:o},GI,m),i.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=i1(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const o=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,m(d)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(d=>o(d.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(m){const o=this._map.getMaxBounds(),d=m.coords;return!!o&&(d.longitude<o.getWest()||d.longitude>o.getEast()||d.latitude<o.getSouth()||d.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new i.z("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("geolocate",Object.assign({coords:m.coords,timestamp:m.timestamp},m.toJSON?{toJSON:m.toJSON.bind(m)}:{}))),this._finish()}}_updateCamera(m){const o=new i.aT(m.coords.longitude,m.coords.latitude),d=m.coords.accuracy,g=this._map.getBearing(),b=Object.assign({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(d),b,{geolocateSource:!0})}_updateMarker(m){if(m){const o=new i.aT(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,o=i.cf(1,m._center.lat)*m.worldSize,d=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=U("button","mapboxgl-ctrl-geolocate",this._container),U("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U("div","mapboxgl-user-location"),this._dotElement.appendChild(U("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(U("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new _1({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=U("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _1({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.z("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Eg,ScaleControl:class{constructor(m={}){this.options=Object.assign({},dm,m),i.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,o=this._map,d=o._containerHeight/2,g=o._containerWidth/2-m/2,b=o.unproject([g,d]),T=o.unproject([g+m,d]),E=b.distanceTo(T);if(this.options.unit==="imperial"){const I=3.2808*E;I>5280?this._setScale(m,I/5280,"mile"):this._setScale(m,I,"foot")}else this.options.unit==="nautical"?this._setScale(m,E/1852,"nautical-mile"):E>=1e3?this._setScale(m,E/1e3,"kilometer"):this._setScale(m,E,"meter")}_setScale(m,o,d){this._map._requestDomTask(()=>{const g=function(T){const E=Math.pow(10,`${Math.floor(T)}`.length-1);let I=T/E;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(M){const N=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*N)/N}(I),E*I}(o),b=g/o;this._container.innerHTML=d!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(g):`${g}&nbsp;${Qb[d]}`,this._container.style.width=m*b+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:i.w("Full screen control 'container' must be a DOM element.")),i.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=U("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:cm,Popup:class extends i.E{constructor(m){super(),this.options=Object.assign(Object.create(Wu),m),this._altitude=this.options.altitude,i.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new i.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new i.z("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=i.aT.convert(m),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const o=document.createDocumentFragment(),d=document.createElement("body");let g;for(d.innerHTML=m;g=d.firstChild,g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=U("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(m),this.options.closeButton){const d=this._closeButton=U("button","mapboxgl-popup-close-button",o);d.type="button",d.setAttribute("aria-label","Close popup"),d.innerHTML='<span aria-hidden="true">&#215;</span>',d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let o;return this._classList.delete(m)?o=!1:(this._classList.add(m),o=!0),this._updateClassList(),o}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const o=this._map,d=this._container,g=this._pos;if(!o||!d||!g)return"bottom";const b=d.offsetWidth,T=d.offsetHeight,E=g.x<b/2,I=g.x>o.transform.width-b/2;if(g.y+m<T)return E?"top-left":I?"top-right":"top";if(g.y>o.transform.height-T){if(E)return"bottom-left";if(I)return"bottom-right"}return E?"left":I?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),m.className=o.join(" ")}_update(m){const o=this._map,d=this._content;if(!o||!this._lngLat&&!this._trackPointer||!d)return;let g=this._container;if(g||(g=this._container=U("div","mapboxgl-popup",o.getContainer()),this._tip=U("div","mapboxgl-popup-tip",g),g.appendChild(d)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Kb(this._lngLat,this._pos,o.transform)),!this._trackPointer||m){const b=this._pos=this._trackPointer&&m instanceof i.P?m:o.project(this._lngLat,this._altitude),T=Yf(this.options.offset),E=this._anchor=this._getAnchor(T.y),I=Yf(this.options.offset,E),M=b.add(I).round();o._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${sl[E]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&o._showingGlobe()){const b=i.f5(o.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Xu);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:_1,Style:qu,LngLat:i.aT,LngLatBounds:i.aI,Point:i.P,MercatorCoordinate:i.ae,FreeCameraOptions:Al,Evented:i.E,config:i.e,prewarm:i.f9,clearPrewarmedResources:i.f8,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(m){i.e.ACCESS_TOKEN=m},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(m){i.e.API_URL=m},get workerCount(){return i.fi.workerCount},set workerCount(m){i.fi.workerCount=m},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){i.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){i.fh(m)},get workerUrl(){return i.fg.workerUrl},set workerUrl(m){i.fg.workerUrl=m},get workerClass(){return i.fg.workerClass},set workerClass(m){i.fg.workerClass=m},get workerParams(){return i.fg.workerParams},set workerParams(m){i.fg.workerParams=m},get dracoUrl(){return i.ff()},set dracoUrl(m){i.fe(m)},get meshoptUrl(){return i.fd()},set meshoptUrl(m){i.fc(m)},setNow:i.o.setNow,restoreNow:i.o.restoreNow}});var f=a;return f})})(vie);var XNe=vie.exports;const Pm=UT(XNe);function YNe({onSelect:e,placeholder:t="Cerca indirizzo...",style:n}){const[r,a]=B.useState(""),[l,f]=B.useState([]),[i,y]=B.useState(!1),[x,S]=B.useState(!1),[C,P]=B.useState(-1),L=B.useRef(null),F=B.useRef(null),U=B.useRef(null);B.useEffect(()=>{if(U.current&&clearTimeout(U.current),r.length<3){f([]),S(!1);return}return U.current=setTimeout(async()=>{y(!0);try{const $=await Kn.geocodeSearch(r,5);f($.results||[]),S(!0),P(-1)}catch($){console.error("Errore geocoding:",$),f([])}finally{y(!1)}},300),()=>{U.current&&clearTimeout(U.current)}},[r]),B.useEffect(()=>{function $(X){F.current&&!F.current.contains(X.target)&&S(!1)}return document.addEventListener("mousedown",$),()=>document.removeEventListener("mousedown",$)},[]);const q=$=>{if(!(!x||l.length===0))switch($.key){case"ArrowDown":$.preventDefault(),P(X=>X<l.length-1?X+1:X);break;case"ArrowUp":$.preventDefault(),P(X=>X>0?X-1:-1);break;case"Enter":$.preventDefault(),C>=0&&l[C]&&G(l[C]);break;case"Escape":S(!1);break}},G=$=>{a($.formatted.split(",")[0]),S(!1),e($)};return k.jsxs("div",{ref:F,style:{position:"relative",...n},children:[k.jsxs("div",{style:{position:"relative"},children:[k.jsx("input",{ref:L,type:"text",value:r,onChange:$=>a($.target.value),onKeyDown:q,onFocus:()=>r.length>=3&&l.length>0&&S(!0),placeholder:t,style:{width:"100%",padding:"10px 36px 10px 12px",borderRadius:"8px",border:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"14px",outline:"none"}}),k.jsx("div",{style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:"var(--text-secondary)",fontSize:"16px"},children:i?k.jsx("span",{style:{animation:"spin 1s linear infinite"},children:"..."}):k.jsx("span",{children:""})})]}),x&&l.length>0&&k.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"8px",marginTop:"4px",maxHeight:"300px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},children:l.map(($,X)=>k.jsxs("div",{onClick:()=>G($),onMouseEnter:()=>P(X),style:{padding:"10px 12px",cursor:"pointer",backgroundColor:X===C?"var(--bg-hover)":"transparent",borderBottom:X<l.length-1?"1px solid var(--border)":"none"},children:[k.jsx("div",{style:{fontSize:"14px",color:"var(--text-primary)",marginBottom:"2px"},children:$.formatted.split(",")[0]}),k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:$.formatted.split(",").slice(1).join(",")})]},X))}),x&&l.length===0&&r.length>=3&&!i&&k.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"8px",marginTop:"4px",padding:"12px",textAlign:"center",color:"var(--text-secondary)",fontSize:"14px",zIndex:1e3},children:"Nessun risultato trovato"})]})}Pm.accessToken="pk.eyJ1IjoiZ2VuYWdlbnRhIiwiYSI6ImNtamR6a3UwazBjNHEzZnF4aWxhYzlqMmUifQ.0RcP-1pxFW7rHYvVoJQG5g";const oq="#64748b",lq={commerciale:"#3b82f6",fornisce:"#f97316",influencer:"#eab308",prescrittore:"#a855f7",tecnico:"#6b7280",partner:"#22c55e",collabora:"#14b8a6"},KNe=[{id:"light-v11",nome:"Chiaro",icon:""},{id:"dark-v11",nome:"Scuro",icon:""},{id:"streets-v12",nome:"Strade",icon:""},{id:"outdoors-v12",nome:"Outdoor",icon:""},{id:"satellite-streets-v12",nome:"Satellite",icon:""}];function QNe(e,t,n,r=24){const a=[];for(let f=0;f<=r;f++){const i=f/r*2*Math.PI,y=n*Math.cos(i),S=n*Math.sin(i)/6371e3*(180/Math.PI),C=y/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);a.push([e+C,t+S])}return a}function aM(e,t,n,r,a=15,l=50,f=0,i=0){const y=[],x=[],C=n-e,P=r-t,L=-C,F=P,U=Math.sqrt(L*L+F*F);let q=0,G=0;U>0&&i!==0&&(q=L/U*(i/6371e3)*(180/Math.PI),G=F/U*(i/(6371e3*Math.cos((t+r)/2*Math.PI/180)))*(180/Math.PI));for(let $=0;$<=a;$++){const X=$/a,ie=e+(n-e)*X+G,de=t+(r-t)*X+q;y.push([ie,de]);const fe=f+4*l*X*(1-X);x.push(fe)}return{coordinates:y,elevation:x}}function JNe(e,t,n,r,a=15,l=30){const i=n-e,y=r-t,x=y*(Math.PI/180)*6371e3,S=i*(Math.PI/180)*6371e3*Math.cos((t+r)/2*Math.PI/180),C=Math.sqrt(x*x+S*S),L=Math.min(l,C*.2)/C,F=e+i*L,U=t+y*L,q=n-i*L,G=r-y*L,$=-i,X=y,ie=Math.sqrt($*$+X*X);if(ie===0)return[];const de=a/2,fe=$/ie*(de/6371e3)*(180/Math.PI),be=X/ie*(de/(6371e3*Math.cos((t+r)/2*Math.PI/180)))*(180/Math.PI);return[[F-be,U-fe],[q-be,G-fe],[q+be,G+fe],[F+be,U+fe],[F-be,U-fe]]}function eze(e,t,n){const a=n/2,l=a/6371e3*(180/Math.PI),f=a/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);return[[e-f,t-l],[e+f,t-l],[e+f,t+l],[e-f,t+l],[e-f,t-l]]}function tze(e,t,n){const a=n/2,l=[];for(let f=0;f<3;f++){const i=f/3*2*Math.PI-Math.PI/2,y=a*Math.cos(i),S=a*Math.sin(i)/6371e3*(180/Math.PI),C=y/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);l.push([e+C,t+S])}return l.push(l[0]),l}function nze(e,t,n){const a=n/2,l=a*.4,f=[];for(let i=0;i<10;i++){const y=i/10*2*Math.PI-Math.PI/2,x=i%2===0?a:l,S=x*Math.cos(y),P=x*Math.sin(y)/6371e3*(180/Math.PI),L=S/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);f.push([e+L,t+P])}return f.push(f[0]),f}function rze(e,t,n){const a=n/2,l=a*.3,f=(i,y)=>{const x=y/6371e3*(180/Math.PI),S=i/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);return[e+S,t+x]};return[f(-l,a),f(l,a),f(l,l),f(a,l),f(a,-l),f(l,-l),f(l,-a),f(-l,-a),f(-l,-l),f(-a,-l),f(-a,l),f(-l,l),f(-l,a)]}function ize(e,t,n){const a=n/2,l=[];for(let f=0;f<6;f++){const i=f/6*2*Math.PI,y=a*Math.cos(i),S=a*Math.sin(i)/6371e3*(180/Math.PI),C=y/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);l.push([e+C,t+S])}return l.push(l[0]),l}function oM(e,t){var l,f;if(e.potenziale&&e.potenziale>0){const i=35+e.potenziale/500;return Math.min(Math.max(i,35),350)}let a=0;return e.tipo==="impresa"?a=(((l=e.dati_extra)==null?void 0:l.fatturato_annuo)||0)/1500:e.tipo==="luogo"?a=(((f=e.dati_extra)==null?void 0:f.importo_lavori)||0)/750:a=t*20,Math.min(Math.max(35+a,35),350)}function sze(e,t){return!e.potenziale||e.potenziale<=0||!e.venduto_totale||e.venduto_totale<=0?0:Math.min(e.venduto_totale/e.potenziale,1)*t}function aze(e,t,n,r,a=24){const f=[],i=[];for(let y=0;y<=a;y++){const x=y/a*2*Math.PI,S=r*Math.cos(x),P=r*Math.sin(x)/6371e3*(180/Math.PI),L=S/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);f.push([e+L,t+P]);const F=n*Math.cos(x),q=n*Math.sin(x)/6371e3*(180/Math.PI),G=F/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);i.push([e+G,t+q])}return[f,i.reverse()]}function oze(e,t,n,r){const l=n/2,f=r/2,i=l/6371e3*(180/Math.PI),y=l/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI),x=f/6371e3*(180/Math.PI),S=f/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI),C=[[e-S,t-x],[e+S,t-x],[e+S,t+x],[e-S,t+x],[e-S,t-x]],P=[[e-y,t-i],[e-y,t+i],[e+y,t+i],[e+y,t-i],[e-y,t-i]];return[C,P]}function lze({neuroni:e,sinapsi:t,categorie:n,tipiNeurone:r,selectedId:a,filterSelectedId:l,onSelectNeurone:f,onFocusNeurone:i,onClearFocus:y,onMapMove:x,filtri:S,pickingMode:C=!1,onPickPosition:P,flyToPosition:L,aiStyleChange:F,onAiStyleApplied:U,onStyleChange:q,pickedPosition:G,connectionPickingMode:$=!1,connectionSourceId:X=null,onPickConnectionTarget:ie,quickMapMode:de=!1,onQuickMapClick:fe,onQuickEntityClick:be,onSelectSinapsi:ve,aiMarkers:Je=[],onRemoveAiMarker:we}){const rt=B.useRef(null),He=B.useRef(null),ft=B.useRef(null),Ct=B.useRef(null),Nt=B.useRef(null),[Rt,en]=B.useState(!1),[nt,pt]=B.useState("light-v11"),[Oe,gn]=B.useState(0),[wt,Fe]=B.useState(100),[jt,Tn]=B.useState(!1),[mn,zn]=B.useState(!1),[yn,qt]=B.useState(!1),[wn,Sn]=B.useState(!1),Xn=B.useRef(null),rn=B.useRef(null),br=B.useRef(null),Qr=B.useRef(()=>{}),sr=B.useRef(e),ar=B.useRef(!1),Vn=B.useRef(C),wr=B.useRef(P),ys=B.useRef(f),Si=B.useRef($),Ri=B.useRef(X),ks=B.useRef(ie),$i=B.useRef(de),Ws=B.useRef(fe),Kt=B.useRef(be),An=B.useRef(ve),Lr=B.useRef(x),Tt=B.useRef(null),kn=B.useRef(a),nr=B.useRef(i),dt=B.useRef(y),Qn=B.useRef(new Map),ti=["#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#3b82f6","#8b5cf6","#ec4899"];B.useEffect(()=>{Vn.current=C,wr.current=P},[C,P]),B.useEffect(()=>{ys.current=f},[f]),B.useEffect(()=>{kn.current=a},[a]),B.useEffect(()=>{nr.current=i,dt.current=y},[i,y]),B.useEffect(()=>{Si.current=$,Ri.current=X,ks.current=ie,console.log("DEBUG MapView: connectionPickingMode aggiornato a:",$,"sourceId:",X)},[$,X,ie]),B.useEffect(()=>{$i.current=de,Ws.current=fe,Kt.current=be},[de,fe,be]),B.useEffect(()=>{An.current=ve},[ve]),B.useEffect(()=>{Lr.current=x},[x]),B.useEffect(()=>{sr.current=e},[e]);const Zi=B.useCallback(Ke=>t.filter(sn=>sn.neurone_da===Ke||sn.neurone_a===Ke).length,[t]),Is=B.useCallback(Ke=>{He.current&&(He.current.setStyle(`mapbox://styles/mapbox/${Ke}`),pt(Ke),q==null||q(Ke),He.current.once("style.load",()=>{gn(sn=>sn+1)}),Kn.savePreferenze({mappa_stile:Ke}).catch(console.error))},[q]);B.useEffect(()=>{if(!He.current||!Rt)return;const Ke=He.current,sn=Ke.getStyle();if(!(sn!=null&&sn.layers))return;const bn=wt/100,kr=["neuroni-3d","neuroni-borders","venduto-rings","sinapsi-lines","sinapsi-lines-shadow","sinapsi-hit"];sn.layers.forEach(In=>{if(!kr.some(Ki=>In.id.includes(Ki)))try{switch(In.type){case"background":Ke.setPaintProperty(In.id,"background-opacity",bn);break;case"fill":Ke.setPaintProperty(In.id,"fill-opacity",bn);break;case"line":Ke.setPaintProperty(In.id,"line-opacity",bn);break;case"symbol":Ke.setPaintProperty(In.id,"icon-opacity",bn),Ke.setPaintProperty(In.id,"text-opacity",bn);break;case"raster":Ke.setPaintProperty(In.id,"raster-opacity",bn);break;case"fill-extrusion":Ke.setPaintProperty(In.id,"fill-extrusion-opacity",bn);break}}catch{}})},[wt,Rt,Oe]);const Ln=B.useCallback(()=>{He.current&&(Xn.current&&clearTimeout(Xn.current),Xn.current=setTimeout(()=>{if(!He.current)return;const Ke=He.current.getCenter(),sn=He.current.getZoom(),bn=He.current.getPitch(),kr=He.current.getBearing();Kn.savePreferenze({mappa_center:[Ke.lng,Ke.lat],mappa_zoom:sn,mappa_pitch:bn,mappa_bearing:kr}).catch(console.error)},1e3))},[]);B.useEffect(()=>{Qr.current=Ln},[Ln]),B.useEffect(()=>{if(wn)return br.current&&clearTimeout(br.current),br.current=setTimeout(()=>{Kn.savePreferenze({mappa_trasparenza:wt}).catch(console.error)},500),()=>{br.current&&clearTimeout(br.current)}},[wt,wn]);const Hn=B.useCallback(()=>{rn.current&&clearTimeout(rn.current),zn(!1),rn.current=setTimeout(()=>{zn(!0),setTimeout(()=>{Tn(!1),zn(!1)},300)},2e3)},[]);return B.useEffect(()=>(jt?Hn():rn.current&&clearTimeout(rn.current),()=>{rn.current&&clearTimeout(rn.current)}),[jt,Hn]),B.useEffect(()=>{Rt&&!wn&&(async()=>{try{const sn=await Kn.getPreferenze();He.current&&wn===!1&&(sn!=null&&sn.mappa_stile&&(He.current.setStyle(`mapbox://styles/mapbox/${sn.mappa_stile}`),pt(sn.mappa_stile),He.current.once("style.load",()=>{gn(bn=>bn+1)})),sn!=null&&sn.mappa_center&&(sn!=null&&sn.mappa_zoom)&&He.current.jumpTo({center:sn.mappa_center,zoom:sn.mappa_zoom,pitch:sn.mappa_pitch??60,bearing:sn.mappa_bearing??-17.6}),(sn==null?void 0:sn.mappa_trasparenza)!=null&&Fe(sn.mappa_trasparenza)),Sn(!0)}catch(sn){console.error("Errore caricamento preferenze:",sn),Sn(!0)}})()},[Rt,wn]),B.useEffect(()=>{if(!(!rt.current||He.current))return He.current=new Pm.Map({container:rt.current,style:"mapbox://styles/mapbox/light-v11",center:[9.19,45.46],zoom:12,pitch:60,bearing:-17.6,antialias:!0}),He.current.addControl(new Pm.NavigationControl,"top-right"),ft.current=new Pm.Popup({closeButton:!1,closeOnClick:!1,offset:15}),Ct.current=new Pm.Popup({closeButton:!0,closeOnClick:!0,offset:[0,-20],maxWidth:"280px",className:"sales-popup"}),He.current.on("load",()=>{console.log("Mappa caricata"),en(!0)}),He.current.on("click",Ke=>{var kr;if(Vn.current&&wr.current){wr.current(Ke.lngLat.lat,Ke.lngLat.lng);return}const sn=(kr=He.current)==null?void 0:kr.queryRenderedFeatures(Ke.point,{layers:["neuroni-3d"]});(!sn||sn.length===0)&&(ft.current&&ft.current.remove(),dt.current&&dt.current(Ke.lngLat.lat,Ke.lngLat.lng),$i.current&&Ws.current&&Ws.current(Ke.lngLat.lat,Ke.lngLat.lng,Ke.point.x,Ke.point.y))}),He.current.on("moveend",()=>{Qr.current(),Tt.current&&clearTimeout(Tt.current),Tt.current=setTimeout(()=>{if(He.current&&Lr.current){const Ke=He.current.getCenter(),sn=He.current.getZoom();Lr.current({lat:Ke.lat,lng:Ke.lng},sn)}},1e3)}),()=>{var Ke,sn,bn;(Ke=ft.current)==null||Ke.remove(),(sn=Ct.current)==null||sn.remove(),Xn.current&&clearTimeout(Xn.current),Tt.current&&clearTimeout(Tt.current),(bn=He.current)==null||bn.remove(),He.current=null}},[]),B.useEffect(()=>{!He.current||!Rt||!L||He.current.flyTo({center:[L.lng,L.lat],zoom:L.zoom??14,pitch:L.pitch??60,bearing:L.bearing??He.current.getBearing(),duration:1500})},[L,Rt]),B.useEffect(()=>{!He.current||!Rt||!F||(console.log("AI: Cambio stile mappa a",F),He.current.setStyle(`mapbox://styles/mapbox/${F}`),pt(F),He.current.once("style.load",()=>{gn(Ke=>Ke+1),U==null||U()}))},[F,Rt,U]),B.useEffect(()=>{if(!He.current||!Rt)return;const Ke=He.current.getCanvas(),sn=He.current.getContainer();C?(Ke.style.cursor="crosshair",sn.style.cursor="crosshair",sn.classList.add("picking-mode")):de?(Ke.style.cursor="crosshair",sn.style.cursor="crosshair",sn.classList.add("quick-map-mode")):(Ke.style.cursor="",sn.style.cursor="",sn.classList.remove("picking-mode"),sn.classList.remove("quick-map-mode"))},[C,de,Rt]),B.useEffect(()=>{if(!(!He.current||!Rt)){if(Nt.current&&(Nt.current.remove(),Nt.current=null),G){const Ke=document.createElement("div");Ke.innerHTML=`
        <svg width="30" height="40" viewBox="0 0 30 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 0C6.716 0 0 6.716 0 15c0 10.5 15 25 15 25s15-14.5 15-25C30 6.716 23.284 0 15 0z" fill="#ef4444"/>
          <circle cx="15" cy="14" r="6" fill="white"/>
        </svg>
      `,Ke.style.cursor="pointer",Nt.current=new Pm.Marker({element:Ke,anchor:"bottom"}).setLngLat([G.lng,G.lat]).addTo(He.current)}return()=>{Nt.current&&(Nt.current.remove(),Nt.current=null)}}},[G,Rt]),B.useEffect(()=>{if(!He.current||!Rt)return;const Ke=He.current;if(!Ke.isStyleLoaded()){console.log("DEBUG MapView: stile non ancora caricato, riprovo tra 100ms...");const bn=setTimeout(()=>{console.log("DEBUG MapView: riprovo dopo delay, isStyleLoaded:",Ke.isStyleLoaded()),gn(kr=>kr+1)},100);return()=>clearTimeout(bn)}let sn=e.filter(bn=>bn.lat&&bn.lng);if(console.log("DEBUG MapView neuroni:",{totali:e.length,conCoordinate:sn.length,tipiNeuroneCaricati:r.length,primi:e.slice(0,2).map(bn=>({id:bn.id,nome:bn.nome,lat:bn.lat,lng:bn.lng}))}),S.tipiSelezionati.length>0){const bn=S.tipiSelezionati.map(kr=>kr.toLowerCase());sn=sn.filter(kr=>{var In;return bn.includes((In=kr.tipo)==null?void 0:In.toLowerCase())})}if(S.categorieSelezionate.length>0&&(sn=sn.filter(bn=>bn.categorie.some(kr=>S.categorieSelezionate.some(In=>In.toLowerCase()===kr.toLowerCase())))),S.ricerca.trim()){const bn=S.ricerca.toLowerCase().trim();sn=sn.filter(kr=>{var In;return kr.nome.toLowerCase().includes(bn)||((In=kr.indirizzo)==null?void 0:In.toLowerCase().includes(bn))||kr.categorie.some(Ki=>Ki.toLowerCase().includes(bn))})}if(r.length!==0){console.log("DEBUG MapView: inizia creazione features, neuroniConCoord:",sn.length);try{const bn=Gn=>{if(!Gn||Gn.length===0)return oq;const cn=Gn[0].toLowerCase(),xr=n.find(Qs=>Qs.nome.toLowerCase()===cn);return(xr==null?void 0:xr.colore)||oq},kr=Gn=>{const cn=r.find(xr=>xr.nome.toLowerCase()===Gn.toLowerCase());return cn!=null&&cn.forma&&["cerchio","quadrato","triangolo","stella","croce","esagono"].includes(cn.forma)?cn.forma:"cerchio"},In=(Gn,cn,xr,Qs)=>{switch(Gn){case"quadrato":return eze(cn,xr,Qs);case"triangolo":return tze(cn,xr,Qs);case"stella":return nze(cn,xr,Qs);case"croce":return rze(cn,xr,Qs);case"esagono":return ize(cn,xr,Qs);case"cerchio":default:return QNe(cn,xr,Qs/2,24)}},Ta={type:"FeatureCollection",features:sn.map(Gn=>{const cn=kr(Gn.tipo),Qs=cn!=="cerchio"?50:40,Sr=Gn.dimensione?Number(Gn.dimensione):Qs,Mi=oM(Gn,Zi(Gn.id)),Ye=Number(Gn.lng),ee=Number(Gn.lat),le=In(cn,Ye,ee,Sr),ye=Array.isArray(Gn.categorie)?Gn.categorie:[],Ne=bn(ye);return{type:"Feature",properties:{id:Gn.id,nome:Gn.nome,tipo:Gn.tipo,categorie:ye.join(", "),color:Ne,height:Mi,base_height:0},geometry:{type:"Polygon",coordinates:[le]}}})},Ns=Ke.getSource("neuroni");console.log("DEBUG MapView source neuroni:",Ns?"esiste, aggiorno dati":"non esiste, creo layer"),Ns?Ns.setData(Ta):(Ke.addSource("neuroni",{type:"geojson",data:Ta}),Ke.addLayer({id:"neuroni-3d",type:"fill-extrusion",source:"neuroni",paint:{"fill-extrusion-color":["get","color"],"fill-extrusion-height":["get","height"],"fill-extrusion-base":0,"fill-extrusion-opacity":.9,"fill-extrusion-vertical-gradient":!0}}),Ke.addLayer({id:"neuroni-outline",type:"line",source:"neuroni",paint:{"line-color":"#1e293b","line-width":2,"line-opacity":.6}}));const Ht=sn.filter(Gn=>Gn.venduto_totale&&Gn.venduto_totale>0&&Gn.potenziale&&Gn.potenziale>0).map(Gn=>{const xr=kr(Gn.tipo)==="quadrato",Qs=xr?50:40,Sr=Gn.dimensione?Number(Gn.dimensione):Qs,Mi=oM(Gn,Zi(Gn.id)),Ye=sze(Gn,Mi),ee=Number(Gn.lng),le=Number(Gn.lat),ye=3,Ne=xr?oze(ee,le,Sr,Sr+ye*2):aze(ee,le,Sr/2,Sr/2+ye,24);return{type:"Feature",properties:{id:Gn.id,venduto_height:Ye,ring_height:4},geometry:{type:"Polygon",coordinates:Ne}}}),Dn={type:"FeatureCollection",features:Ht},je=Ke.getSource("venduto-rings");je?je.setData(Dn):Ht.length>0&&(Ke.addSource("venduto-rings",{type:"geojson",data:Dn}),Ke.addLayer({id:"venduto-ring",type:"fill-extrusion",source:"venduto-rings",paint:{"fill-extrusion-color":"#22c55e","fill-extrusion-height":["+",["get","venduto_height"],["get","ring_height"]],"fill-extrusion-base":["get","venduto_height"],"fill-extrusion-opacity":.95}}));let jn=t.filter(Gn=>{const cn=Gn.lat_da&&Gn.lng_da&&Gn.lat_a&&Gn.lng_a;return cn||console.warn("DEBUG sinapsi senza coordinate:",{id:Gn.id,nome_da:Gn.nome_da,nome_a:Gn.nome_a,lat_da:Gn.lat_da,lng_da:Gn.lng_da,lat_a:Gn.lat_a,lng_a:Gn.lng_a}),cn});const Ir=l??a;if(console.log("DEBUG MapView sinapsi - stato completo:",{mostraConnessioni:S.mostraConnessioni,soloConnessioniSelezionate:S.soloConnessioniSelezionate,selectedId:a,filterSelectedId:l,idPerFiltro:Ir,sinapsiTotali:t.length,sinapsiConCoord:jn.length}),!S.mostraConnessioni)console.log("DEBUG: mostraConnessioni=false -> nascondo tutte"),jn=[];else if(S.soloConnessioniSelezionate)if(Ir){const Gn=jn.length;console.log("DEBUG soloConnessioniSelezionate: filtro per idPerFiltro=",Ir),jn=jn.filter(cn=>cn.neurone_da===Ir||cn.neurone_a===Ir),console.log("DEBUG soloConnessioniSelezionate: da",Gn,"a",jn.length)}else console.log("DEBUG soloConnessioniSelezionate=true ma idPerFiltro=null -> nascondo tutte"),jn=[];if(jn.length>0){const Gn=new Map(e.map(Me=>[Me.id,Me])),cn=40,xr=20,Qs=8,Sr=["#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#3b82f6","#8b5cf6","#ec4899"],Mi=[],Ye=[];jn.forEach(Me=>{const Ve=Gn.get(Me.neurone_da),tt=Gn.get(Me.neurone_a),Ze=(Ve==null?void 0:Ve.lng)??Number(Me.lng_da),at=(Ve==null?void 0:Ve.lat)??Number(Me.lat_da),Mt=(tt==null?void 0:tt.lng)??Number(Me.lng_a),xt=(tt==null?void 0:tt.lat)??Number(Me.lat_a),dn=Me.famiglie_transazioni||[],Mn=Array.isArray(Me.tipo_connessione)&&Me.tipo_connessione.length>0?Me.tipo_connessione.filter(as=>as.toLowerCase()!=="commerciale"):[],Qt={id:Me.id,tipo:Me.tipo_connessione,valore:Number(Me.valore)||1,certezza:Me.certezza,neurone_da_nome:(Ve==null?void 0:Ve.nome)||"Sconosciuto",neurone_a_nome:(tt==null?void 0:tt.nome)||"Sconosciuto",neurone_da_tipo:(Ve==null?void 0:Ve.tipo)||"",neurone_a_tipo:(tt==null?void 0:tt.tipo)||""},Ar=dn.length>0,lr=(Me.tipo_connessione||[]).some(as=>as.toLowerCase()==="commerciale");if(Ar){const vs=-((dn.length-1)*Qs)/2;dn.forEach((Hi,$r)=>{const Ps=vs+$r*Qs,Ji=Hi.famiglia_colore||Sr[$r%Sr.length],ri=aM(Ze,at,Mt,xt,15,cn,0,Ps),ca={...Qt,tipoSingolo:"transazione",famigliaNome:Hi.famiglia_nome,famigliaId:Hi.famiglia_id,tipoColor:Ji,baseHeight:0,elevation:ri.elevation,volume:Hi.volume};Mi.push({type:"Feature",properties:ca,geometry:{type:"LineString",coordinates:ri.coordinates}})})}else if(lr||Mn.length===0){const as=aM(Ze,at,Mt,xt,15,cn,0,0),Qi={...Qt,tipoSingolo:lr?"commerciale":"connessione",tipoColor:lr?lq.commerciale||"#3b82f6":"#94a3b8",baseHeight:0,elevation:as.elevation};Mi.push({type:"Feature",properties:Qi,geometry:{type:"LineString",coordinates:as.coordinates}})}Mn.forEach((as,Qi)=>{const vs=(Qi+1)*(cn+xr),Hi=aM(Ze,at,Mt,xt,15,cn,vs,0),$r=as.toLowerCase(),Ps=lq[$r]||"#94a3b8",Ji={...Qt,tipoSingolo:as,tipoColor:Ps,baseHeight:vs,elevation:Hi.elevation};Mi.push({type:"Feature",properties:Ji,geometry:{type:"LineString",coordinates:Hi.coordinates}})});const ni=(1+Mn.length)*(cn+xr),Ms=JNe(Ze,at,Mt,xt,20,35);Ms.length>0&&Ye.push({type:"Feature",properties:{...Qt,maxHeight:ni},geometry:{type:"Polygon",coordinates:[Ms]}})});const ee={type:"FeatureCollection",features:Mi},le={type:"FeatureCollection",features:Ye},ye=Ke.getSource("sinapsi"),Ne=Ke.getSource("sinapsi-volumes");ye&&Ne?(ye.setData(ee),Ne.setData(le)):(Ke.addSource("sinapsi",{type:"geojson",lineMetrics:!0,data:ee}),Ke.addSource("sinapsi-volumes",{type:"geojson",data:le}),Ke.addLayer({id:"sinapsi-lines-shadow",type:"line",source:"sinapsi",layout:{"line-z-offset":["+",["coalesce",["get","baseHeight"],0],["interpolate",["linear"],["line-progress"],...Array.from({length:16},(Me,Ve)=>{const tt=Ve/15;return[tt,4*40*tt*(1-tt)-3]}).flat()]]},paint:{"line-color":"#000000","line-width":6,"line-opacity":.3,"line-blur":2}}),Ke.addLayer({id:"sinapsi-lines",type:"line",source:"sinapsi",layout:{"line-z-offset":["+",["coalesce",["get","baseHeight"],0],["interpolate",["linear"],["line-progress"],...Array.from({length:16},(Me,Ve)=>{const tt=Ve/15;return[tt,4*40*tt*(1-tt)]}).flat()]]},paint:{"line-color":["coalesce",["get","tipoColor"],"#94a3b8"],"line-width":4,"line-opacity":.9}}),Ke.addLayer({id:"sinapsi-hit",type:"fill-extrusion",source:"sinapsi-volumes",paint:{"fill-extrusion-color":"#ff0000","fill-extrusion-height":["coalesce",["get","maxHeight"],60],"fill-extrusion-base":0,"fill-extrusion-opacity":0}}))}else{const Gn=Ke.getSource("sinapsi"),cn=Ke.getSource("sinapsi-volumes");Gn&&Gn.setData({type:"FeatureCollection",features:[]}),cn&&cn.setData({type:"FeatureCollection",features:[]})}if(!ar.current){let Gn=null;Ke.on("mouseenter","neuroni-3d",cn=>{if(Ke.getCanvas().style.cursor="pointer",cn.features&&cn.features[0]&&ft.current){const xr=cn.features[0].properties,Qs=(xr==null?void 0:xr.height)||35,Sr=Ke.getPitch(),Mi=Ke.getZoom(),Ye=Math.pow(2,(Mi-14)*.7),ee=Math.sin(Sr*Math.PI/180),le=Qs*Ye*ee*.35,ye=20+Math.min(le,120);ft.current.setOffset([0,-ye]),ft.current.setLngLat(cn.lngLat).setHTML(`<strong>${xr==null?void 0:xr.nome}</strong><br/><span style="color:#64748b;font-size:12px">${xr==null?void 0:xr.categorie}</span>`).addTo(Ke)}}),Ke.on("mouseleave","neuroni-3d",()=>{var cn;Ke.getCanvas().style.cursor="",(cn=ft.current)==null||cn.remove()}),Ke.on("click","neuroni-3d",cn=>{var xr;if(!Vn.current&&cn.features&&cn.features[0]){const Qs=(xr=cn.features[0].properties)==null?void 0:xr.id,Sr=sr.current.find(Mi=>Mi.id===Qs);if(Si.current&&Sr){if(console.log("DEBUG MapView click: connectionPickingMode attivo, neurone:",Sr.nome,"sourceId:",Ri.current),Sr.id===Ri.current){alert("Non puoi collegare un'entit a se stessa!");return}ks.current&&(console.log("DEBUG MapView: chiamando onPickConnectionTarget per:",Sr.nome),ks.current(Sr));return}if($i.current&&Sr&&Kt.current){Kt.current(Sr,cn.point.x,cn.point.y);return}Gn?(clearTimeout(Gn),Gn=null,Sr!=null&&Sr.lat&&(Sr!=null&&Sr.lng)&&Ke.flyTo({center:[Sr.lng,Sr.lat],zoom:16,pitch:60,duration:1e3})):Gn=setTimeout(async()=>{var Mi,Ye,ee,le,ye;if(Gn=null,Sr&&kn.current&&Sr.id!==kn.current){(Mi=Ct.current)==null||Mi.remove(),ys.current(Sr);return}if(Sr&&Sr.lat&&Sr.lng&&Ct.current){(Ye=ft.current)==null||Ye.remove(),nr.current&&nr.current(Sr.id);const Ne=oM(Sr,Zi(Sr.id)),Me=Ke.getPitch(),Ve=Ke.getZoom(),tt=Math.pow(2,(Ve-14)*.7),Ze=Math.sin(Me*Math.PI/180),at=Ne*tt*Ze*.35,Mt=20+Math.min(at,120);Ct.current.setOffset([0,-Mt]);const xt=`
                  <div style="padding: 8px; min-width: 200px;">
                    <div style="font-weight: 600; font-size: 14px; margin-bottom: 8px;">${Sr.nome}</div>
                    <div style="color: #64748b; font-size: 12px;">Caricamento...</div>
                  </div>
                `;Ct.current.setLngLat([Sr.lng,Sr.lat]).setHTML(xt).addTo(Ke);try{const dn=await Kn.get(`/vendite?neurone_id=${Sr.id}`),Mn=dn.data.data||[],Qt=dn.data.potenziale||0,Ar=dn.data.totale_venduto||0,lr=Qt>0?Math.round(Ar/Qt*100):0;let Er="";if(Mn.length>0){Er='<div style="display: flex; align-items: flex-end; gap: 3px; height: 50px; margin: 8px 0;">';const as=Qt>0?Qt:Math.max(...Mn.map(Qi=>Qi.importo),1);Mn.forEach((Qi,vs)=>{const Hi=Math.max(Qi.importo/as*100,5),$r=ti[vs%ti.length];Er+=`<div title="${Qi.famiglia_nome||"Prodotto"}: ${Qi.importo.toLocaleString("it-IT")}" style="width: 20px; height: ${Hi}%; background: ${$r}; border-radius: 2px 2px 0 0;"></div>`}),Er+="</div>"}const ni=Ar>0||Qt>0,Ms=`
                    <div style="padding: 8px; min-width: 220px;">
                      <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">${Sr.nome}</div>
                      <div style="color: #64748b; font-size: 11px; margin-bottom: 8px;">${Sr.tipo} ${(ee=Sr.categorie)!=null&&ee.length?" "+Sr.categorie.join(", "):""}</div>

                      ${ni?`
                        <div style="margin-bottom: 4px;">
                          <div style="display: flex; justify-content: space-between; font-size: 11px; color: #64748b;">
                            <span>Venduto: ${Ar.toLocaleString("it-IT")}</span>
                            ${Qt>0?`<span style="font-weight: 600; color: ${lr>=100?"#22c55e":"#1e293b"};">${lr}%</span>`:""}
                          </div>
                          ${Qt>0?`
                            <div style="height: 6px; background: #e2e8f0; border-radius: 3px; margin-top: 2px;">
                              <div style="height: 100%; width: ${Math.min(lr,100)}%; background: ${lr>=100?"#22c55e":lr>=50?"#eab308":"#ef4444"}; border-radius: 3px;"></div>
                            </div>
                            <div style="font-size: 10px; color: #94a3b8; margin-top: 2px;">Potenziale: ${Qt.toLocaleString("it-IT")}</div>
                          `:""}
                        </div>
                        ${Er}
                      `:`
                        <div style="font-size: 11px; color: #94a3b8; margin-bottom: 8px;">Nessun dato vendite</div>
                      `}

                      <div style="display: flex; gap: 8px; margin-top: 8px;">
                        <button id="btn-quick-${Sr.id}" style="width: 40px; padding: 8px; background: #f59e0b; color: white; border: none; border-radius: 6px; font-size: 18px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                          +
                        </button>
                        <button id="btn-dettagli-${Sr.id}" style="flex: 1; padding: 8px 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer;">
                          Dettagli 
                        </button>
                      </div>
                    </div>
                  `;(le=Ct.current)==null||le.setHTML(Ms),setTimeout(()=>{const as=document.getElementById(`btn-dettagli-${Sr.id}`);as&&(as.onclick=()=>{var vs;(vs=Ct.current)==null||vs.remove(),ys.current(Sr)});const Qi=document.getElementById(`btn-quick-${Sr.id}`);Qi&&Kt.current&&He.current&&(Qi.onclick=()=>{var Hi,$r;const vs=(Hi=He.current)==null?void 0:Hi.project([Sr.lng,Sr.lat]);($r=Ct.current)==null||$r.remove(),vs&&Kt.current(Sr,vs.x,vs.y)})},50)}catch(dn){console.error("Errore caricamento vendite per popup:",dn);const Mn=`
                    <div style="padding: 8px; min-width: 200px;">
                      <div style="font-weight: 600; font-size: 14px; margin-bottom: 8px;">${Sr.nome}</div>
                      <div style="display: flex; gap: 8px;">
                        <button id="btn-quick-${Sr.id}" style="width: 40px; padding: 8px; background: #f59e0b; color: white; border: none; border-radius: 6px; font-size: 18px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                          +
                        </button>
                        <button id="btn-dettagli-${Sr.id}" style="flex: 1; padding: 8px 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer;">
                          Dettagli 
                        </button>
                      </div>
                    </div>
                  `;(ye=Ct.current)==null||ye.setHTML(Mn),setTimeout(()=>{const Qt=document.getElementById(`btn-dettagli-${Sr.id}`);Qt&&(Qt.onclick=()=>{var lr;(lr=Ct.current)==null||lr.remove(),ys.current(Sr)});const Ar=document.getElementById(`btn-quick-${Sr.id}`);Ar&&Kt.current&&He.current&&(Ar.onclick=()=>{var Er,ni;const lr=(Er=He.current)==null?void 0:Er.project([Sr.lng,Sr.lat]);(ni=Ct.current)==null||ni.remove(),lr&&Kt.current(Sr,lr.x,lr.y)})},50)}}},250)}}),Ke.on("mouseenter","sinapsi-hit",cn=>{if(Ke.getCanvas().style.cursor="pointer",cn.features&&cn.features[0]&&ft.current){const xr=cn.features[0].properties,Qs=(xr==null?void 0:xr.tipo)||"Connessione",Sr=(xr==null?void 0:xr.certezza)||"",Mi=(xr==null?void 0:xr.neurone_da_nome)||"",Ye=(xr==null?void 0:xr.neurone_a_nome)||"",ee=Qs.charAt(0).toUpperCase()+Qs.slice(1),le=Sr==="certo"?"#22c55e":Sr==="probabile"?"#eab308":"#94a3b8";ft.current.setOffset([0,-10]),ft.current.setLngLat(cn.lngLat).setHTML(`
              <div style="padding: 4px 8px;">
                <strong style="font-size: 13px;">${ee}</strong>
                <div style="font-size: 11px; color: #64748b; margin-top: 2px;">
                  ${Mi}  ${Ye}
                </div>
                ${Sr?`<div style="font-size: 10px; color: ${le}; margin-top: 2px;"> ${Sr}</div>`:""}
              </div>
            `).addTo(Ke)}}),Ke.on("mouseleave","sinapsi-hit",()=>{var cn;Ke.getCanvas().style.cursor="",(cn=ft.current)==null||cn.remove()}),Ke.on("click","sinapsi-hit",async cn=>{var xr,Qs,Sr;if(!(Vn.current||Si.current||$i.current)&&cn.features&&cn.features[0]&&Ct.current){const Mi=cn.features[0].properties,Ye=Mi==null?void 0:Mi.id;let ee=(Mi==null?void 0:Mi.tipo)||"Connessione";const le=(Mi==null?void 0:Mi.certezza)||"",ye=(Mi==null?void 0:Mi.neurone_da_nome)||"Sconosciuto",Ne=(Mi==null?void 0:Mi.neurone_a_nome)||"Sconosciuto",Me=(Mi==null?void 0:Mi.neurone_da_tipo)||"",Ve=(Mi==null?void 0:Mi.neurone_a_tipo)||"";(xr=ft.current)==null||xr.remove();let tt="Connessione";try{if(typeof ee=="string"&&ee.startsWith("[")){const Mn=JSON.parse(ee);Array.isArray(Mn)&&Mn.length>0&&(tt=Mn.map(Qt=>Qt.charAt(0).toUpperCase()+Qt.slice(1)).join(", "))}else typeof ee=="string"&&(tt=ee.charAt(0).toUpperCase()+ee.slice(1))}catch{tt=String(ee)}const Ze=le==="certo"?"#22c55e":le==="probabile"?"#eab308":"#94a3b8",at=le==="certo"?"Certo":le==="probabile"?"Probabile":"Ipotetico";let Mt="";const xt=tt.toLowerCase();xt.includes("vendita")||xt.includes("acquisto")||xt.includes("commerciale")?Mt="":xt.includes("collabora")?Mt="":xt.includes("influencer")||xt.includes("influenza")||xt.includes("prescrittore")?Mt="":xt.includes("partner")?Mt="":xt.includes("forni")?Mt="":xt.includes("client")?Mt="":xt.includes("tecnico")&&(Mt="");const dn=`
            <div style="padding: 10px; min-width: 220px;">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <span style="font-size: 20px;">${Mt}</span>
                <span style="font-weight: 600; font-size: 15px;">${tt}</span>
              </div>
              <div style="background: #f8fafc; border-radius: 6px; padding: 8px; margin-bottom: 8px;">
                <div style="font-size: 13px; font-weight: 500;">${ye}</div>
                <div style="text-align: center; color: #94a3b8; margin: 4px 0;"></div>
                <div style="font-size: 13px; font-weight: 500;">${Ne}</div>
              </div>
              <div style="text-align: center; color: #94a3b8; font-size: 11px;">Caricamento dati...</div>
            </div>
          `;Ct.current.setOffset([0,-10]),Ct.current.setLngLat(cn.lngLat).setHTML(dn).addTo(Ke);try{const Qt=await Kn.getSinapsiById(Ye),Ar=Qt.dati_oggettivi||{volume_totale:0,numero_transazioni:0,ultima_transazione:null},lr=Ar.volume_totale||0,Er=Ar.numero_transazioni||0,ni=Ar.ultima_transazione,Ms=Qt.influenza||0,as=Qt.qualita_relazione||0,Qi=Qt.importanza_strategica||0,vs=Qt.affidabilita||0,Hi=Qt.potenziale||0,$r=(wo,ju)=>{if(wo===0)return"";const po="".repeat(wo)+"".repeat(5-wo);return`<div style="display: flex; justify-content: space-between; font-size: 11px; margin: 2px 0;">
                <span style="color: #64748b;">${ju}</span>
                <span style="color: #f59e0b;">${po}</span>
              </div>`},Ps=Ms||as||Qi||vs||Hi,Ji=Ps?`
              <div style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed #e2e8f0;">
                <div style="font-size: 10px; color: #94a3b8; margin-bottom: 4px; text-transform: uppercase;">Valutazione Soggettiva</div>
                ${$r(Ms,"Influenza")}
                ${$r(as,"Qualit rel.")}
                ${$r(Qi,"Strategicit")}
                ${$r(vs,"Affidabilit")}
                ${$r(Hi,"Potenziale")}
              </div>
            `:"",ri=lr>0||Er>0,ca=ri?`
              <div style="margin-top: 8px; padding: 8px; background: #f0fdf4; border-radius: 6px;">
                <div style="font-size: 10px; color: #22c55e; margin-bottom: 4px; text-transform: uppercase;">Dati Oggettivi</div>
                <div style="display: flex; justify-content: space-between; font-size: 12px;">
                  <span>Volume</span>
                  <span style="font-weight: 600;">${lr.toLocaleString("it-IT")}</span>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 12px;">
                  <span>Transazioni</span>
                  <span style="font-weight: 600;">${Er}</span>
                </div>
                ${ni?`<div style="font-size: 10px; color: #64748b; margin-top: 4px;">Ultima: ${new Date(ni).toLocaleDateString("it-IT")}</div>`:""}
              </div>
            `:"",Ro=!ri&&!Ps?`
              <div style="margin-top: 8px; padding: 8px; background: #f8fafc; border-radius: 6px; text-align: center;">
                <div style="font-size: 11px; color: #94a3b8;">Nessun dato registrato</div>
              </div>
            `:"",jo=`
              <div style="padding: 10px; min-width: 220px; max-width: 280px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                  <span style="font-size: 20px;">${Mt}</span>
                  <span style="font-weight: 600; font-size: 15px;">${tt}</span>
                  <span style="margin-left: auto; font-size: 10px; color: ${Ze};"> ${at}</span>
                </div>

                <div style="background: #f8fafc; border-radius: 6px; padding: 8px;">
                  <div style="font-size: 13px; font-weight: 500;">${ye}</div>
                  ${Me?`<div style="font-size: 10px; color: #94a3b8;">${Me}</div>`:""}
                  <div style="text-align: center; color: #94a3b8; margin: 4px 0;"></div>
                  <div style="font-size: 13px; font-weight: 500;">${Ne}</div>
                  ${Ve?`<div style="font-size: 10px; color: #94a3b8;">${Ve}</div>`:""}
                </div>

                ${ca}
                ${Ji}
                ${Ro}

                <button id="btn-sinapsi-dettagli-${Ye}" style="
                  width: 100%;
                  margin-top: 10px;
                  padding: 8px 12px;
                  background: #6366f1;
                  color: white;
                  border: none;
                  border-radius: 6px;
                  font-size: 13px;
                  font-weight: 500;
                  cursor: pointer;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  gap: 6px;
                ">
                  Dettagli <span style="font-size: 16px;"></span>
                </button>
              </div>
            `;(Qs=Ct.current)==null||Qs.setHTML(jo),setTimeout(()=>{const wo=document.getElementById(`btn-sinapsi-dettagli-${Ye}`);wo&&An.current&&(wo.onclick=()=>{var ju;(ju=Ct.current)==null||ju.remove(),An.current(Ye)})},50)}catch(Mn){console.error("Errore caricamento dati sinapsi:",Mn);const Qt=`
              <div style="padding: 10px; min-width: 220px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                  <span style="font-size: 20px;">${Mt}</span>
                  <span style="font-weight: 600; font-size: 15px;">${tt}</span>
                </div>
                <div style="background: #f8fafc; border-radius: 6px; padding: 8px;">
                  <div style="font-size: 13px; font-weight: 500;">${ye}</div>
                  <div style="text-align: center; color: #94a3b8; margin: 4px 0;"></div>
                  <div style="font-size: 13px; font-weight: 500;">${Ne}</div>
                </div>
                <div style="font-size: 11px; color: ${Ze}; margin-top: 8px;"> ${at}</div>
              </div>
            `;(Sr=Ct.current)==null||Sr.setHTML(Qt)}}}),ar.current=!0}}catch(bn){console.error("DEBUG MapView ERRORE nella creazione layer:",bn)}}},[e,t,n,r,a,l,Rt,S,Zi,Oe]),B.useEffect(()=>{if(!He.current||!Rt)return;const Ke=new Set(Je.map(bn=>bn.id));new Set(Qn.current.keys()).forEach(bn=>{if(!Ke.has(bn)){const kr=Qn.current.get(bn);kr&&(kr.remove(),Qn.current.delete(bn))}}),Je.forEach(bn=>{if(!Qn.current.has(bn.id)){const kr=document.createElement("div");kr.className="ai-marker",kr.style.cssText=`
          width: 30px;
          height: 40px;
          cursor: pointer;
          display: flex;
          flex-direction: column;
          align-items: center;
        `,kr.innerHTML=`
          <svg width="30" height="40" viewBox="0 0 30 40" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 40V2" stroke="${bn.color}" stroke-width="3" stroke-linecap="round"/>
            <path d="M4 2L26 8L4 16" fill="${bn.color}"/>
          </svg>
        `;const In=document.createElement("div");In.style.cssText="padding: 8px; min-width: 120px;",In.innerHTML=`
          <div style="font-weight: 600; margin-bottom: 4px;">${bn.label}</div>
          <div style="font-size: 11px; color: #666; margin-bottom: 8px;">
            Piazzato da Agea
          </div>
          <button id="remove-marker-${bn.id}" style="
            background: #ef4444;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            width: 100%;
          ">
            Rimuovi
          </button>
        `;const Ki=new Pm.Popup({offset:[0,-35],closeButton:!0,closeOnClick:!1}).setDOMContent(In),Ta=new Pm.Marker({element:kr,anchor:"bottom"}).setLngLat([bn.lng,bn.lat]).setPopup(Ki).addTo(He.current);kr.addEventListener("click",()=>{Ta.togglePopup()}),Ki.on("open",()=>{const Ns=document.getElementById(`remove-marker-${bn.id}`);Ns&&(Ns.onclick=()=>{we==null||we(bn.id),Ta.remove()})}),Qn.current.set(bn.id,Ta)}})},[Je,Rt,we]),k.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[k.jsx("div",{ref:rt,style:{width:"100%",height:"100%"}}),k.jsx("div",{style:{position:"absolute",top:"10px",left:"50%",transform:"translateX(-50%)",width:"320px",maxWidth:"calc(100% - 20px)",zIndex:10},children:k.jsx(YNe,{placeholder:"Cerca indirizzo sulla mappa...",onSelect:Ke=>{He.current&&Ke.lat&&Ke.lng&&He.current.flyTo({center:[Ke.lng,Ke.lat],zoom:17,pitch:60,duration:2e3})}})}),n.length>0&&yn&&k.jsxs("div",{style:{position:"absolute",bottom:"66px",left:"10px",background:"white",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",fontSize:"12px",zIndex:10,padding:"10px 12px",maxHeight:"180px",overflowY:"auto"},children:[n.slice(0,10).map(Ke=>k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[k.jsx("div",{style:{width:10,height:10,borderRadius:"3px",background:Ke.colore,flexShrink:0}}),k.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"90px",fontSize:"11px",color:"#334155"},children:Ke.nome})]},Ke.id)),n.length>10&&k.jsxs("div",{style:{fontSize:"10px",color:"#64748b"},children:["+",n.length-10," altre..."]}),k.jsx("div",{style:{fontSize:"9px",color:"#64748b",borderTop:"1px solid #e2e8f0",paddingTop:"6px",marginTop:"4px"},children:"Altezza = valore/relazioni"})]}),n.length>0&&k.jsxs("div",{onClick:()=>qt(!yn),style:{position:"absolute",bottom:"30px",left:"10px",background:"white",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",padding:"8px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",userSelect:"none",zIndex:10},children:[k.jsx("span",{style:{fontWeight:600,fontSize:"11px",color:"#1e293b"},children:"Legenda"}),k.jsx("span",{style:{fontSize:"8px",color:"#64748b",transform:yn?"rotate(180deg)":"none",transition:"transform 0.2s ease"},children:""})]}),k.jsxs("div",{style:{position:"absolute",bottom:"30px",right:"10px",display:"flex",flexDirection:"column",gap:"8px",zIndex:10},children:[jt&&k.jsxs("div",{onMouseMove:Hn,onTouchStart:Hn,style:{background:"white",padding:"10px 12px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",minWidth:"180px",opacity:mn?0:1,transition:"opacity 0.3s ease"},children:[k.jsxs("div",{style:{fontSize:"11px",color:"#64748b",marginBottom:"6px",display:"flex",justifyContent:"space-between"},children:[k.jsx("span",{children:"Trasparenza mappa"}),k.jsxs("span",{style:{fontWeight:600},children:[100-wt,"%"]})]}),k.jsx("input",{type:"range",min:"10",max:"100",value:wt,onChange:Ke=>{Fe(Number(Ke.target.value)),Hn()},style:{width:"100%",height:"6px",cursor:"pointer",accentColor:"#3b82f6"}}),k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"9px",color:"#94a3b8",marginTop:"2px"},children:[k.jsx("span",{children:"3D visibile"}),k.jsx("span",{children:"Mappa solida"})]})]}),k.jsxs("div",{style:{display:"flex",gap:"4px",background:"white",padding:"6px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:[k.jsx("button",{onClick:()=>Tn(!jt),title:jt?"Nascondi controlli":"Trasparenza mappa",style:{width:"32px",height:"32px",border:jt?"2px solid #3b82f6":"1px solid #e2e8f0",borderRadius:"6px",background:jt?"#eff6ff":"white",cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),k.jsx("div",{style:{width:"1px",background:"#e2e8f0",margin:"4px 2px"}}),KNe.map(Ke=>k.jsx("button",{onClick:()=>Is(Ke.id),title:Ke.nome,style:{width:"32px",height:"32px",border:nt===Ke.id?"2px solid #3b82f6":"1px solid #e2e8f0",borderRadius:"6px",background:nt===Ke.id?"#eff6ff":"white",cursor:"pointer",fontSize:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:Ke.icon},Ke.id))]})]})]})}function uze({excludeId:e,onSelect:t,onClose:n,onSwitchToMap:r}){const[a,l]=B.useState([]),[f,i]=B.useState(!0),[y,x]=B.useState(""),[S,C]=B.useState(null);B.useEffect(()=>{(async()=>{i(!0);try{const{data:U}=await Kn.getNeuroni({limit:500});l(U.filter(q=>q.id!==e).map(q=>({id:q.id,nome:q.nome,tipo:q.tipo,categorie:q.categorie||[],indirizzo:q.indirizzo||void 0})))}catch(U){console.error("Errore caricamento entit:",U)}finally{i(!1)}})()},[e]);const P=B.useMemo(()=>{const F=new Set(a.map(U=>U.tipo));return Array.from(F).sort()},[a]),L=B.useMemo(()=>{let F=a;if(S&&(F=F.filter(U=>U.tipo===S)),y.trim()){const U=y.toLowerCase();F=F.filter(q=>q.nome.toLowerCase().includes(U)||q.tipo.toLowerCase().includes(U)||q.categorie.some(G=>G.toLowerCase().includes(U))||q.indirizzo&&q.indirizzo.toLowerCase().includes(U))}return F},[a,S,y]);return k.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,padding:"16px"},onClick:n,children:k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"12px",width:"100%",maxWidth:"600px",maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden"},onClick:F=>F.stopPropagation(),children:[k.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[k.jsx("h2",{style:{fontSize:"18px",fontWeight:600,margin:0},children:"Seleziona entit"}),k.jsx("button",{onClick:n,style:{background:"transparent",border:"none",fontSize:"24px",cursor:"pointer",color:"var(--text-secondary)",padding:"4px 8px"},children:""})]}),k.jsxs("div",{style:{padding:"12px 20px",borderBottom:"1px solid var(--border-color)"},children:[k.jsx("input",{type:"text",className:"form-input",placeholder:"Cerca per nome, tipo, categoria, indirizzo...",value:y,onChange:F=>x(F.target.value),autoFocus:!0,style:{fontSize:"15px"}}),k.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"12px",flexWrap:"wrap"},children:[k.jsxs("button",{onClick:()=>C(null),style:{padding:"6px 12px",borderRadius:"16px",border:"none",fontSize:"13px",cursor:"pointer",background:S===null?"var(--primary)":"var(--bg-primary)",color:S===null?"white":"var(--text-primary)"},children:["Tutti (",a.length,")"]}),P.map(F=>{const U=a.filter(q=>q.tipo===F).length;return k.jsxs("button",{onClick:()=>C(S===F?null:F),style:{padding:"6px 12px",borderRadius:"16px",border:"none",fontSize:"13px",cursor:"pointer",background:S===F?"var(--primary)":"var(--bg-primary)",color:S===F?"white":"var(--text-primary)"},children:[F," (",U,")"]},F)})]})]}),k.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 12px"},children:f?k.jsx("div",{style:{padding:"40px",textAlign:"center",color:"var(--text-secondary)"},children:"Caricamento..."}):L.length===0?k.jsx("div",{style:{padding:"40px",textAlign:"center",color:"var(--text-secondary)"},children:"Nessuna entit trovata"}):L.map(F=>k.jsxs("div",{onClick:()=>t(F),style:{padding:"12px 16px",marginBottom:"4px",borderRadius:"8px",cursor:"pointer",background:"var(--bg-primary)",transition:"background 0.15s"},onMouseEnter:U=>{U.currentTarget.style.background="var(--primary)",U.currentTarget.style.color="white"},onMouseLeave:U=>{U.currentTarget.style.background="var(--bg-primary)",U.currentTarget.style.color="inherit"},children:[k.jsx("div",{style:{fontWeight:500,marginBottom:"2px"},children:F.nome}),k.jsxs("div",{style:{fontSize:"12px",opacity:.8},children:[F.tipo,F.categorie.length>0&&`  ${F.categorie.join(", ")}`]}),F.indirizzo&&k.jsx("div",{style:{fontSize:"11px",opacity:.6,marginTop:"4px"},children:F.indirizzo})]},F.id))}),r&&k.jsxs("div",{style:{padding:"12px 20px",borderTop:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"},children:[k.jsx("span",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:"oppure"}),k.jsx("button",{onClick:r,className:"btn btn-primary",style:{fontSize:"14px"},children:"Seleziona su mappa"})]})]})})}function cze({neuroneCorrente:e,sinapsiDaModificare:t,personalAccess:n,onClose:r,onSaved:a,onRequestMapPick:l,preselectedEntity:f}){var Xn;const i=!!t,[y,x]=B.useState((f==null?void 0:f.id)||(t?t.neurone_da===e.id?t.neurone_a:t.neurone_da:"")),[S,C]=B.useState((f==null?void 0:f.nome)||(t?t.neurone_da===e.id?t.nome_a||"":t.nome_da||"":"")),[P,L]=B.useState((t==null?void 0:t.tipo_connessione)||[]),[F,U]=B.useState((t==null?void 0:t.data_inizio)||new Date().toISOString().split("T")[0]),[q,G]=B.useState((t==null?void 0:t.data_fine)||""),[$,X]=B.useState(((Xn=t==null?void 0:t.valore)==null?void 0:Xn.toString())||""),[ie,de]=B.useState((t==null?void 0:t.certezza)||"ipotesi"),[fe,be]=B.useState((t==null?void 0:t.fonte)||""),[ve,Je]=B.useState((t==null?void 0:t.data_verifica)||""),[we,rt]=B.useState((t==null?void 0:t.livello)||"aziendale"),[He,ft]=B.useState((t==null?void 0:t.note)||""),[Ct,Nt]=B.useState((t==null?void 0:t.famiglia_prodotto_id)||null),[Rt,en]=B.useState(!1),[nt,pt]=B.useState([]),[Oe,gn]=B.useState([]),[wt,Fe]=B.useState(!1),[jt,Tn]=B.useState(null);B.useEffect(()=>{(async()=>{try{const[br,Qr]=await Promise.all([Kn.getTipiSinapsi(),Kn.getFamiglieProdotto()]);pt(br.data),gn(Qr.data)}catch(br){console.error("Errore caricamento dati:",br)}})()},[]);const mn=rn=>{x(rn.id),C(rn.nome),en(!1)},zn=()=>{en(!1),r(),l==null||l()},yn=rn=>{L(br=>br.includes(rn)?br.filter(Qr=>Qr!==rn):[...br,rn])},qt=async rn=>{var br,Qr;if(rn.preventDefault(),Tn(null),!y){Tn("Seleziona un neurone da collegare");return}if(P.length===0){Tn("Seleziona almeno un tipo di connessione");return}Fe(!0);try{const sr={neurone_da:e.id,neurone_a:y,tipo_connessione:P,famiglia_prodotto_id:Ct||null,data_inizio:F,data_fine:q||null,valore:$?parseFloat($):null,certezza:ie,fonte:fe||null,data_verifica:ve||null,livello:we,note:He||null};if(console.log("DEBUG sinapsi submit:",sr),i&&t)await Kn.updateSinapsi(t.id,sr);else{const ar=await Kn.createSinapsi(sr);console.log("DEBUG sinapsi created:",ar)}a(),r()}catch(sr){console.error("Errore salvataggio sinapsi:",sr);let ar="Errore durante il salvataggio";if(sr&&typeof sr=="object"){const Vn=sr;(Qr=(br=Vn.response)==null?void 0:br.data)!=null&&Qr.error?ar=Vn.response.data.error:Vn.message&&(ar=Vn.message)}Tn(ar)}finally{Fe(!1)}},wn=(rn,br=0)=>rn.flatMap(Qr=>[{id:Qr.id,nome:Qr.nome,level:br},...Qr.children?wn(Qr.children,br+1):[]]),Sn=wn(Oe);return k.jsxs(k.Fragment,{children:[k.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:r,children:k.jsxs("div",{className:"card",style:{width:"100%",maxWidth:"500px",maxHeight:"90vh",overflow:"auto",padding:"24px"},onClick:rn=>rn.stopPropagation(),children:[k.jsx("h2",{style:{marginBottom:"16px",fontSize:"18px",fontWeight:600},children:i?"Modifica Connessione":"Nuova Connessione"}),k.jsxs("form",{onSubmit:qt,children:[k.jsxs("div",{style:{marginBottom:"16px",padding:"12px",background:"var(--bg-secondary)",borderRadius:"8px"},children:[k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:"Da"}),k.jsx("div",{style:{fontWeight:500},children:e.nome})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Collega a"}),y?k.jsxs("div",{style:{padding:"12px 16px",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--primary)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[k.jsx("div",{children:k.jsx("div",{style:{fontWeight:600,color:"var(--primary)"},children:S})}),k.jsx("button",{type:"button",onClick:()=>{x(""),C("")},style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",fontSize:"18px"},children:""})]}):k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("button",{type:"button",onClick:()=>en(!0),className:"btn",style:{flex:1,padding:"12px"},children:"Cerca nella lista"}),l&&k.jsx("button",{type:"button",onClick:zn,className:"btn btn-primary",style:{flex:1,padding:"12px"},children:"Seleziona su mappa"})]})]}),k.jsxs("div",{className:"form-group",children:[k.jsxs("label",{className:"form-label",children:["Tipi Connessione",P.length>0&&k.jsxs("span",{style:{fontWeight:400,color:"var(--text-secondary)",marginLeft:"8px"},children:["(",P.length," selezionati)"]})]}),nt.length===0?k.jsxs("div",{style:{padding:"12px",background:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"8px",color:"#92400e",fontSize:"13px"},children:["Nessun tipo connessione configurato.",k.jsx("br",{}),k.jsx("span",{style:{fontWeight:500},children:"Menu utente (in alto a destra)  Impostazioni  Connessioni"})]}):k.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",padding:"12px",background:"var(--bg-primary)",borderRadius:"8px",border:"1px solid var(--border-color)",maxHeight:"200px",overflowY:"auto"},children:nt.map(rn=>{const br=P.includes(rn.nome);return k.jsxs("button",{type:"button",onClick:()=>yn(rn.nome),style:{padding:"6px 12px",borderRadius:"16px",border:"none",cursor:"pointer",fontSize:"13px",fontWeight:br?600:400,background:br?rn.colore||"var(--primary)":"var(--bg-secondary)",color:br?"white":"var(--text-primary)",transition:"all 0.15s ease"},children:[br&&" ",rn.nome.replace(/_/g," ")]},rn.id)})})]}),Sn.length>0&&k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Prodotto (opzionale)"}),k.jsxs("select",{className:"form-input",value:Ct||"",onChange:rn=>Nt(rn.target.value||null),children:[k.jsx("option",{value:"",children:"-- Nessun prodotto --"}),Sn.map(rn=>k.jsxs("option",{value:rn.id,children:["  ".repeat(rn.level),rn.nome]},rn.id))]})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Certezza"}),k.jsx("div",{style:{display:"flex",gap:"8px"},children:["ipotesi","probabile","certo"].map(rn=>k.jsxs("button",{type:"button",className:`btn ${ie===rn?"btn-primary":""}`,onClick:()=>de(rn),style:{flex:1},children:[rn==="ipotesi"&&""," ",rn==="probabile"&&""," ",rn==="certo"&&""," ",rn]},rn))})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Fonte informazione"}),k.jsx("input",{type:"text",className:"form-input",placeholder:"Es: visto sul cantiere, me l'ha detto Mario...",value:fe,onChange:rn=>be(rn.target.value)})]}),k.jsxs("div",{style:{display:"flex",gap:"12px"},children:[k.jsxs("div",{className:"form-group",style:{flex:1},children:[k.jsx("label",{className:"form-label",children:"Data inizio"}),k.jsx("input",{type:"date",className:"form-input",value:F,onChange:rn=>U(rn.target.value),required:!0})]}),k.jsxs("div",{className:"form-group",style:{flex:1},children:[k.jsx("label",{className:"form-label",children:"Data fine"}),k.jsx("input",{type:"date",className:"form-input",value:q,onChange:rn=>G(rn.target.value)})]})]}),ie==="certo"&&k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Data verifica"}),k.jsx("input",{type:"date",className:"form-input",value:ve,onChange:rn=>Je(rn.target.value)})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Valore economico (opzionale)"}),k.jsx("input",{type:"number",className:"form-input",placeholder:"Es: 5000",value:$,onChange:rn=>X(rn.target.value),step:"0.01"})]}),n&&k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Visibilit"}),k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("button",{type:"button",className:`btn ${we==="aziendale"?"btn-primary":""}`,onClick:()=>rt("aziendale"),style:{flex:1},children:"Aziendale"}),k.jsx("button",{type:"button",className:`btn ${we==="personale"?"btn-primary":""}`,onClick:()=>rt("personale"),style:{flex:1},children:" Personale"})]})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Note"}),k.jsx("textarea",{className:"form-input",placeholder:"Note aggiuntive...",value:He,onChange:rn=>ft(rn.target.value),rows:3,style:{resize:"vertical"}})]}),jt&&k.jsx("div",{style:{padding:"12px",background:"#fee",color:"#c00",borderRadius:"4px",marginBottom:"16px"},children:jt}),k.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[k.jsx("button",{type:"button",className:"btn",onClick:r,disabled:wt,children:"Annulla"}),k.jsx("button",{type:"submit",className:"btn btn-primary",disabled:wt||!y||P.length===0,children:wt?"Salvataggio...":i?"Salva modifiche":"Crea connessione"})]})]})]})}),Rt&&k.jsx(uze,{excludeId:e.id,onSelect:mn,onClose:()=>en(!1),onSwitchToMap:l?zn:void 0})]})}function dze({neurone:e,personalAccess:t,categorie:n,onClose:r,onSelectNeurone:a,onEdit:l,onRequestConnectionMapPick:f,connectionTargetEntity:i,onClearConnectionTarget:y,onSinapsiCreated:x}){console.log("DEBUG DetailPanel render, connectionTargetEntity:",i);const{data:S}=DNe(e.id),{data:C=[],isLoading:P}=_ie(e.id),{data:L=[],isLoading:F}=UNe(t?e.id:null),{invalidateSinapsiNeurone:U,invalidateNote:q}=wE(),G=S||e,[$,X]=B.useState("info"),ie=P||F,fe=(()=>{if(G.categorie.length>0&&n.length>0){const Je=G.categorie[0],we=n.find(rt=>rt.nome===Je);if(we!=null&&we.colore)return we.colore}return{persona:"#3b82f6",impresa:"#22c55e",cantiere:"#f97316",ente:"#8b5cf6"}[G.tipo]||"#6b7280"})();MNe("detail-panel-state","panel","Pannello Dettaglio Entit",{entita:G.nome,tipo:G.tipo,tabAttiva:$==="vendite"?"transazioni":$,tabDisponibili:["info","transazioni","connessioni","note"],numeroConnessioni:C.length,numeroNote:L.length,haAccessoPersonale:t},"Il pannello laterale destro che mostra i dettagli dell'entit selezionata"),sM({id:"panel_switch_tab",name:"Cambia Tab Pannello",description:"Cambia la tab attiva nel pannello dettagli. Tab disponibili: info, transazioni, connessioni, note",parameters:[{name:"tab",type:"select",options:["info","transazioni","connessioni","note"],description:"La tab da attivare",required:!0}],handler:async({tab:ve})=>{const we={info:"info",transazioni:"vendite",connessioni:"connessioni",note:"note"}[ve];return we?ve==="note"&&!t?{success:!1,message:"Tab Note richiede accesso personale (PIN)"}:(X(we),{success:!0,message:`Tab cambiata in "${ve}"`}):{success:!1,message:`Tab "${ve}" non valida. Usa: info, transazioni, connessioni, note`}}}),sM({id:"panel_edit_entity",name:"Modifica Entit",description:"Apre il form di modifica per l'entit correntemente visualizzata",parameters:[],handler:async()=>l?(l(),{success:!0,message:`Aperto form modifica per "${G.nome}"`}):{success:!1,message:"Modifica non disponibile per questa entit"}}),sM({id:"panel_close",name:"Chiudi Pannello",description:"Chiude il pannello dettagli",parameters:[],handler:async()=>(r(),{success:!0,message:"Pannello chiuso"})}),B.useEffect(()=>{i&&X("connessioni")},[i]);const be=()=>`badge badge-${G.tipo}`;return k.jsxs("div",{className:"detail-panel",children:[k.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"flex-start",gap:"12px",background:`linear-gradient(135deg, ${fe}20 0%, ${fe}05 100%)`,borderLeft:`4px solid ${fe}`},children:[k.jsxs("div",{style:{flex:1},children:[k.jsxs("h2",{style:{fontSize:"18px",fontWeight:600,marginBottom:"4px",color:fe},children:[G.nome,G.has_note&&!t&&k.jsx("span",{className:"icon-lock",title:"Ha note personali (richiede PIN)",children:""})]}),k.jsxs("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:[k.jsx("span",{className:be(),children:G.tipo}),G.categorie.map(ve=>k.jsx("span",{className:"badge",children:ve},ve))]})]}),k.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[l&&k.jsx("button",{onClick:l,style:{background:fe,border:"none",color:"white",padding:"6px 12px",borderRadius:"6px",fontSize:"12px",cursor:"pointer",fontWeight:500},children:" Modifica"}),k.jsx("button",{onClick:r,style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:fe,lineHeight:1},children:""})]})]}),k.jsx("div",{role:"tablist","aria-label":"Sezioni dettaglio entit","data-ai-container":"tabs",style:{display:"flex",borderBottom:"1px solid var(--border-color)"},children:["info","vendite","connessioni","note"].map(ve=>{const Je=ve==="vendite"?"transazioni":ve,we=$===ve;return k.jsxs("button",{role:"tab","aria-selected":we,"aria-controls":`tabpanel-${ve}`,"data-ai-name":`Tab ${Je}`,onClick:()=>X(ve),style:{flex:1,padding:"12px",border:"none",background:we?"var(--bg-secondary)":"transparent",borderBottom:we?"2px solid var(--color-primary)":"2px solid transparent",cursor:"pointer",fontWeight:we?600:400,textTransform:"capitalize",fontSize:"13px"},children:[Je,ve==="connessioni"&&` (${C.length})`,ve==="note"&&t&&` (${L.length})`,ve==="note"&&!t&&G.has_note&&" "]},ve)})}),k.jsx("div",{style:{padding:"16px",overflowY:"auto"},children:ie?k.jsx("p",{style:{color:"var(--text-secondary)"},children:"Caricamento..."}):k.jsxs(k.Fragment,{children:[$==="info"&&k.jsx(hze,{neurone:G}),$==="vendite"&&k.jsx(mze,{neurone:G}),$==="connessioni"&&k.jsx(fze,{sinapsi:C,neurone:G,personalAccess:t,onSelectNeurone:a,onSinapsiChange:()=>{U(G.id),x==null||x()},onRequestMapPick:f,preselectedEntity:i,onClearPreselected:y}),$==="note"&&k.jsx(pze,{note:L,personalAccess:t,neuroneId:G.id,onNoteChange:()=>q(G.id)})]})})]})}function hze({neurone:e}){const{invalidateNeurone:t}=wE(),[n,r]=B.useState(!1),[a,l]=B.useState({is_acquirente:e.is_acquirente,is_venditore:e.is_venditore,is_intermediario:e.is_intermediario,is_influencer:e.is_influencer}),{data:f=[]}=yie(),i=f.find(L=>L.nome.toLowerCase()===e.tipo.toLowerCase()),y=(i==null?void 0:i.id)||null,{data:x=[],isLoading:S}=BNe(y);B.useEffect(()=>{l({is_acquirente:e.is_acquirente,is_venditore:e.is_venditore,is_intermediario:e.is_intermediario,is_influencer:e.is_influencer})},[e.is_acquirente,e.is_venditore,e.is_intermediario,e.is_influencer]);const C=async L=>{r(!0);const F=!a[L];try{await Kn.updateNeurone(e.id,{[L]:F}),l(U=>({...U,[L]:F})),t(e.id)}catch(U){console.error("Errore aggiornamento natura:",U)}finally{r(!1)}},P=L=>{if(!e.dati_extra)return null;const F=e.dati_extra[L.nome];return F==null||F===""?null:String(F)};return k.jsxs("div",{children:[k.jsxs("div",{style:{marginBottom:"20px",padding:"12px",background:"var(--bg-secondary)",borderRadius:"8px"},children:[k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"8px"},children:"Natura commerciale"}),k.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",background:a.is_acquirente?"rgba(59, 130, 246, 0.15)":"var(--bg-primary)",border:`1px solid ${a.is_acquirente?"#3b82f6":"var(--border-color)"}`,borderRadius:"6px",cursor:n?"wait":"pointer",fontSize:"13px",opacity:n?.6:1},children:[k.jsx("input",{type:"checkbox",checked:!!a.is_acquirente,onChange:()=>C("is_acquirente"),disabled:n})," Acquirente"]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",background:a.is_venditore?"rgba(34, 197, 94, 0.15)":"var(--bg-primary)",border:`1px solid ${a.is_venditore?"#22c55e":"var(--border-color)"}`,borderRadius:"6px",cursor:n?"wait":"pointer",fontSize:"13px",opacity:n?.6:1},children:[k.jsx("input",{type:"checkbox",checked:!!a.is_venditore,onChange:()=>C("is_venditore"),disabled:n})," Venditore"]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",background:a.is_intermediario?"rgba(234, 179, 8, 0.15)":"var(--bg-primary)",border:`1px solid ${a.is_intermediario?"#eab308":"var(--border-color)"}`,borderRadius:"6px",cursor:n?"wait":"pointer",fontSize:"13px",opacity:n?.6:1},children:[k.jsx("input",{type:"checkbox",checked:!!a.is_intermediario,onChange:()=>C("is_intermediario"),disabled:n})," Intermediario"]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",background:a.is_influencer?"rgba(168, 85, 247, 0.15)":"var(--bg-primary)",border:`1px solid ${a.is_influencer?"#a855f7":"var(--border-color)"}`,borderRadius:"6px",cursor:n?"wait":"pointer",fontSize:"13px",opacity:n?.6:1},children:[k.jsx("input",{type:"checkbox",checked:!!a.is_influencer,onChange:()=>C("is_influencer"),disabled:n})," Influencer"]})]}),k.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)",marginTop:"8px",fontStyle:"italic"},children:"Modifica la natura commerciale specifica per questa entit"})]}),e.indirizzo&&k.jsx(Z1,{label:"Indirizzo",value:e.indirizzo}),e.telefono&&k.jsx(Z1,{label:"Telefono",value:e.telefono}),e.email&&k.jsx(Z1,{label:"Email",value:e.email}),e.sito_web&&k.jsx(Z1,{label:"Sito web",value:e.sito_web}),e.lat&&e.lng&&k.jsx(Z1,{label:"Coordinate",value:`${e.lat}, ${e.lng}`}),S?k.jsx("div",{style:{marginTop:"16px",color:"var(--text-secondary)",fontSize:"13px"},children:"Caricamento campi..."}):x.length>0?k.jsxs("div",{style:{marginTop:"16px"},children:[k.jsx("h4",{style:{fontSize:"14px",fontWeight:600,marginBottom:"8px"},children:"Dettagli aggiuntivi"}),x.map(L=>{const F=P(L);return k.jsxs("div",{style:{marginBottom:"12px"},children:[k.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"2px",display:"flex",alignItems:"center",gap:"4px"},children:[L.etichetta,L.obbligatorio&&k.jsx("span",{style:{color:"#ef4444",fontSize:"10px"},children:"*"})]}),k.jsx("div",{style:{fontSize:"14px",color:F?"var(--text-primary)":"var(--text-secondary)",fontStyle:F?"normal":"italic",padding:F?"0":"4px 8px",background:F?"transparent":"var(--bg-secondary)",borderRadius:"4px",border:F?"none":"1px dashed var(--border-color)"},children:F||"Non compilato"})]},L.id)})]}):e.dati_extra&&Object.keys(e.dati_extra).length>0?k.jsxs("div",{style:{marginTop:"16px"},children:[k.jsx("h4",{style:{fontSize:"14px",fontWeight:600,marginBottom:"8px"},children:"Dettagli aggiuntivi"}),Object.entries(e.dati_extra).map(([L,F])=>k.jsx(Z1,{label:L.replace(/_/g," "),value:String(F)},L))]}):null]})}function Z1({label:e,value:t}){return k.jsxs("div",{style:{marginBottom:"12px"},children:[k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"2px"},children:e}),k.jsx("div",{style:{fontSize:"14px"},children:t})]})}function fze({sinapsi:e,neurone:t,personalAccess:n,onSelectNeurone:r,onSinapsiChange:a,onRequestMapPick:l,preselectedEntity:f,onClearPreselected:i}){const[y,x]=B.useState(!1),[S,C]=B.useState(void 0);B.useEffect(()=>{console.log("DEBUG ConnessioniTab preselectedEntity:",f),f&&(console.log("DEBUG: Aprendo form con preselectedEntity:",f.nome),C(void 0),x(!0))},[f]);const P=()=>{C(void 0),x(!0)},L=()=>{x(!1),i==null||i()},F=(G,$)=>{$.stopPropagation(),C(G),x(!0)},U=async(G,$)=>{if($.stopPropagation(),!!window.confirm(`Eliminare la connessione con "${G.neurone_da===t.id?G.nome_a:G.nome_da}"?`))try{await Kn.deleteSinapsi(G.id),a()}catch(X){console.error("Errore eliminazione sinapsi:",X),alert("Errore durante l'eliminazione")}},q=G=>{switch(G){case"ipotesi":return"";case"probabile":return"";case"certo":return"";default:return""}};return k.jsxs("div",{children:[k.jsx("button",{className:"btn btn-primary",onClick:P,style:{width:"100%",marginBottom:"16px"},children:"+ Aggiungi connessione"}),e.length===0?k.jsx("p",{style:{color:"var(--text-secondary)"},children:"Nessuna connessione"}):e.map(G=>{const $=G.neurone_da===t.id,X=$?G.nome_a:G.nome_da,ie=$?G.neurone_a:G.neurone_da;return k.jsxs("div",{className:"card",style:{padding:"12px",cursor:r?"pointer":"default",transition:"background 0.15s"},onClick:()=>r==null?void 0:r(ie),onMouseEnter:de=>{r&&(de.currentTarget.style.background="var(--bg-secondary)")},onMouseLeave:de=>{r&&(de.currentTarget.style.background="")},children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[k.jsxs("div",{children:[k.jsxs("div",{style:{fontWeight:500,marginBottom:"4px",color:"var(--color-primary)"},children:[$?"":""," ",X]}),k.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:[Array.isArray(G.tipo_connessione)?G.tipo_connessione.map(de=>de.replace(/_/g," ")).join("  "):String(G.tipo_connessione||"").replace(/_/g," "),G.prodotto_nome&&k.jsxs("span",{style:{marginLeft:"6px",background:"var(--bg-tertiary)",padding:"2px 6px",borderRadius:"4px"},children:[" ",G.prodotto_nome]})]})]}),k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("span",{title:G.certezza,children:q(G.certezza)}),k.jsx("button",{onClick:de=>F(G,de),style:{background:"none",border:"none",cursor:"pointer",fontSize:"14px",opacity:.6},title:"Modifica",children:""}),k.jsx("button",{onClick:de=>U(G,de),style:{background:"none",border:"none",cursor:"pointer",fontSize:"14px",opacity:.6,color:"#ef4444"},title:"Elimina",children:""})]})]}),k.jsxs("div",{style:{marginTop:"8px",fontSize:"12px",color:"var(--text-secondary)"},children:[G.data_inizio," ",G.data_fine?` ${G.data_fine}`:" oggi",G.valore&&`  ${G.valore.toLocaleString()}`]}),G.fonte&&k.jsxs("div",{style:{marginTop:"6px",fontSize:"11px",color:"var(--text-secondary)",fontStyle:"italic"},children:[" ",G.fonte]}),G.certezza==="certo"&&G.data_verifica&&k.jsxs("div",{style:{marginTop:"4px",fontSize:"11px",color:"var(--color-success)"},children:[" Verificato il ",G.data_verifica]}),G.note&&k.jsx("div",{style:{marginTop:"8px",padding:"8px",background:"var(--bg-secondary)",borderRadius:"4px",fontSize:"13px"},children:G.note})]},G.id)}),y&&k.jsx(cze,{neuroneCorrente:t,sinapsiDaModificare:S,personalAccess:n,onClose:L,onSaved:()=>{a(),i==null||i()},onRequestMapPick:l,preselectedEntity:f})]})}function pze({note:e,personalAccess:t,neuroneId:n,onNoteChange:r}){const[a,l]=B.useState(""),[f,i]=B.useState(!1);if(!t)return k.jsxs("div",{style:{textAlign:"center",padding:"32px",color:"var(--text-secondary)"},children:[k.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),k.jsx("p",{children:"Inserisci il PIN per vedere le note personali"})]});const y=async()=>{if(a.trim()){i(!0);try{await Kn.createNota(n,a),r(),l("")}catch(x){console.error("Errore salvataggio nota:",x)}finally{i(!1)}}};return k.jsxs("div",{children:[k.jsxs("div",{style:{marginBottom:"16px"},children:[k.jsx("textarea",{className:"form-input",placeholder:"Aggiungi una nota personale...",value:a,onChange:x=>l(x.target.value),rows:3,style:{resize:"vertical"}}),k.jsx("button",{className:"btn btn-primary",onClick:y,disabled:!a.trim()||f,style:{marginTop:"8px"},children:f?"Salvataggio...":"Aggiungi nota"})]}),e.length===0?k.jsx("p",{style:{color:"var(--text-secondary)"},children:"Nessuna nota personale"}):e.map(x=>k.jsxs("div",{className:"card",style:{padding:"12px"},children:[k.jsx("div",{style:{whiteSpace:"pre-wrap"},children:x.testo}),k.jsx("div",{style:{marginTop:"8px",fontSize:"11px",color:"var(--text-secondary)"},children:new Date(x.data_modifica).toLocaleString("it-IT")})]},x.id))]})}function mze({neurone:e}){const{data:t,isLoading:n}=VNe(e.id),{data:r=[]}=jNe(),{data:a=[]}=_ie(e.id),{invalidateVendite:l,invalidateNeuroniESinapsi:f}=wE(),[i,y]=B.useState(!1),[x,S]=B.useState(!1),[C,P]=B.useState(""),L=(t==null?void 0:t.data)||[],F=(t==null?void 0:t.potenziale)||0,U=(t==null?void 0:t.totale_venduto)||0,q=a.map(ve=>{const Je=ve.neurone_da===e.id;return{id:Je?ve.neurone_a:ve.neurone_da,nome:Je?ve.nome_a||"Sconosciuto":ve.nome_da||"Sconosciuto",sinapsi_id:ve.id}}).filter((ve,Je,we)=>Je===we.findIndex(rt=>rt.id===ve.id)),G=()=>e.is_intermediario||e.is_influencer?"Valore Potenziale":e.is_venditore&&!e.is_acquirente?"Potenziale di vendita":"Potenziale di acquisto",$=["#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#3b82f6","#8b5cf6","#ec4899","#6366f1","#84cc16"],X=n,ie=async()=>{y(!0);try{await Kn.post("/vendite",{neurone_id:e.id,potenziale:parseFloat(C)||0}),S(!1),l(e.id)}catch(ve){console.error("Errore salvataggio potenziale:",ve)}finally{y(!1)}},de=async(ve,Je,we,rt,He,ft="vendita")=>{y(!0);try{await Kn.post("/vendite",{neurone_id:e.id,famiglia_id:ve,importo:Je,data_vendita:we||new Date().toISOString().split("T")[0],controparte_id:rt||null,sinapsi_id:He||null,tipo_transazione:ft}),l(e.id),rt&&f()}catch(Ct){console.error("Errore salvataggio vendita:",Ct)}finally{y(!1)}},fe=async ve=>{if(window.confirm("Sei sicuro di voler eliminare questa vendita?")){y(!0);try{await Kn.delete(`/vendite/${ve}`),l(e.id),f()}catch(Je){console.error("Errore eliminazione vendita:",Je)}finally{y(!1)}}},be=F>0?Math.round(U/F*100):0;return X?k.jsx("p",{style:{color:"var(--text-secondary)"},children:"Caricamento..."}):k.jsxs("div",{children:[k.jsxs("div",{style:{marginBottom:"20px",padding:"16px",background:"var(--bg-secondary)",borderRadius:"8px"},children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[k.jsx("label",{style:{fontWeight:600,fontSize:"14px"},children:G()}),x?k.jsxs("div",{style:{display:"flex",gap:"4px"},children:[k.jsx("button",{onClick:ie,disabled:i,style:{background:"var(--primary)",color:"white",border:"none",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",cursor:"pointer"},children:"Salva"}),k.jsx("button",{onClick:()=>S(!1),style:{background:"var(--bg-primary)",border:"1px solid var(--border-color)",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",cursor:"pointer"},children:""})]}):k.jsx("button",{onClick:()=>{S(!0),P(F.toString())},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"12px"},children:" Modifica"})]}),x?k.jsx("input",{type:"number",className:"form-input",value:C,onChange:ve=>P(ve.target.value),placeholder:"es: 100000",style:{fontSize:"18px",fontWeight:600},autoFocus:!0}):k.jsxs("div",{style:{fontSize:"24px",fontWeight:700,color:"var(--primary)"},children:["",F.toLocaleString("it-IT")]})]}),k.jsxs("div",{style:{marginBottom:"20px"},children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[k.jsxs("span",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:["Venduto: ",U.toLocaleString("it-IT")]}),k.jsxs("span",{style:{fontSize:"12px",fontWeight:600,color:be>=100?"#22c55e":"var(--text-primary)"},children:[be,"%"]})]}),k.jsx("div",{style:{height:"12px",background:"var(--bg-secondary)",borderRadius:"6px",overflow:"hidden"},children:k.jsx("div",{style:{height:"100%",width:`${Math.min(be,100)}%`,background:be>=100?"#22c55e":be>=50?"#eab308":"#ef4444",borderRadius:"6px",transition:"width 0.3s ease"}})})]}),k.jsx(gze,{famiglie:r,controparti:q,neurone:e,onSave:de,saving:i}),k.jsxs("div",{style:{marginTop:"20px"},children:[k.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,marginBottom:"12px"},children:["Storico vendite (",L.length,")"]}),L.length===0?k.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"13px"},children:"Nessuna transazione registrata. Usa il form sopra per aggiungerne una."}):k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:L.map((ve,Je)=>{const we=r.find(Ct=>Ct.id===ve.famiglia_id),rt=ve.colore||(we==null?void 0:we.colore)||$[Je%$.length],He=ve.tipo_transazione==="acquisto",ft=!!ve.controparte_id;return k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 12px",background:"var(--bg-primary)",borderRadius:"6px",borderLeft:`4px solid ${rt}`},children:[k.jsx("div",{style:{fontSize:"16px",width:"24px",textAlign:"center"},children:He?"":""}),k.jsxs("div",{style:{flex:1},children:[k.jsxs("div",{style:{fontSize:"13px",fontWeight:500,display:"flex",alignItems:"center",gap:"6px"},children:[ve.famiglia_nome||(we==null?void 0:we.nome)||"Prodotto",ft&&k.jsx("span",{style:{fontSize:"10px",padding:"2px 6px",background:He?"rgba(59, 130, 246, 0.15)":"rgba(34, 197, 94, 0.15)",color:He?"#3b82f6":"#22c55e",borderRadius:"4px"},children:" Bilaterale"})]}),k.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:[" ",ve.data_vendita?new Date(ve.data_vendita).toLocaleDateString("it-IT"):"-",ve.controparte_nome&&k.jsxs("span",{children:["  ",He?"da":"a"," ",k.jsx("strong",{children:ve.controparte_nome})]})]})]}),k.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:He?"#ef4444":rt},children:[He?"-":"+","",ve.importo.toLocaleString("it-IT")]}),k.jsx("button",{onClick:()=>fe(ve.id),disabled:i,style:{background:"none",border:"none",color:"#ef4444",cursor:"pointer",padding:"4px",fontSize:"12px",opacity:.6},title:"Elimina transazione",children:""})]},ve.id)})})]}),F>0&&L.length>0&&(()=>{const ve=L.reduce((Je,we)=>(Je[we.famiglia_id]=(Je[we.famiglia_id]||0)+we.importo,Je),{});return k.jsxs("div",{style:{marginTop:"24px",padding:"16px",background:"var(--bg-secondary)",borderRadius:"8px"},children:[k.jsx("h4",{style:{fontSize:"13px",fontWeight:600,marginBottom:"12px",color:"var(--text-secondary)"},children:"Anteprima 3D (totale per prodotto)"}),k.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:"4px",height:"100px",padding:"0 20px"},children:Object.entries(ve).map(([Je,we],rt)=>{var Nt;const He=r.find(Rt=>Rt.id===Je),ft=(He==null?void 0:He.colore)||$[rt%$.length],Ct=F>0?we/F*100:0;return k.jsx("div",{title:`${((Nt=He==null?void 0:He.nome)==null?void 0:Nt.trim())||"Prodotto"}: ${we.toLocaleString("it-IT")}`,style:{width:"24px",height:`${Math.max(Ct,5)}%`,background:ft,borderRadius:"2px 2px 0 0",transition:"height 0.3s ease"}},Je)})}),k.jsxs("div",{style:{borderTop:"2px dashed var(--border-color)",marginTop:"8px",paddingTop:"8px",fontSize:"11px",color:"var(--text-secondary)",textAlign:"center"},children:["Linea venduto totale: ",be,"%"]})]})})()]})}function gze({famiglie:e,controparti:t,neurone:n,onSave:r,saving:a}){var X;const[l,f]=B.useState(""),[i,y]=B.useState(""),[x,S]=B.useState(new Date().toISOString().split("T")[0]),[C,P]=B.useState(""),[L,F]=B.useState("vendita"),[U,q]=B.useState(!1);B.useEffect(()=>{n.is_acquirente&&!n.is_venditore?F("acquisto"):F("vendita")},[n.is_acquirente,n.is_venditore]),B.useEffect(()=>{t.length===1&&!C&&P(t[0].id)},[t,C]);const G=()=>{if(!l||!i)return;const ie=t.find(fe=>fe.id===C),de=ie==null?void 0:ie.sinapsi_id;r(l,parseFloat(i),x,C||void 0,de,L),y("")},$=()=>L==="acquisto"?n.is_venditore?"Acquistato da":"Comprato da":n.is_acquirente?"Venduto a":"Fornito a";return U?k.jsxs("div",{style:{padding:"16px",background:"var(--bg-secondary)",borderRadius:"8px",marginBottom:"12px"},children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[k.jsx("h4",{style:{fontSize:"14px",fontWeight:600},children:"Nuova transazione"}),k.jsx("button",{onClick:()=>q(!1),style:{background:"none",border:"none",fontSize:"18px",cursor:"pointer",color:"var(--text-secondary)"},children:""})]}),k.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"4px",display:"block"},children:"Tipo transazione"}),k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("button",{type:"button",onClick:()=>F("vendita"),style:{flex:1,padding:"8px",border:"none",borderRadius:"6px",cursor:"pointer",background:L==="vendita"?"#22c55e":"var(--bg-primary)",color:L==="vendita"?"white":"var(--text-primary)",fontWeight:L==="vendita"?600:400},children:" Vendita"}),k.jsx("button",{type:"button",onClick:()=>F("acquisto"),style:{flex:1,padding:"8px",border:"none",borderRadius:"6px",cursor:"pointer",background:L==="acquisto"?"#3b82f6":"var(--bg-primary)",color:L==="acquisto"?"white":"var(--text-primary)",fontWeight:L==="acquisto"?600:400},children:" Acquisto"})]})]}),k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"4px",display:"block"},children:"Prodotto *"}),k.jsxs("select",{className:"form-input",value:l,onChange:ie=>f(ie.target.value),children:[k.jsx("option",{value:"",children:"Seleziona prodotto..."}),e.map(ie=>k.jsx("option",{value:ie.id,children:ie.nome.trim()},ie.id))]})]}),k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"4px",display:"block"},children:$()}),k.jsxs("select",{className:"form-input",value:C,onChange:ie=>P(ie.target.value),children:[k.jsx("option",{value:"",children:" Cliente generico/occasionale"}),t.map(ie=>k.jsx("option",{value:ie.id,children:ie.nome},ie.id))]}),C?k.jsxs("div",{style:{marginTop:"6px",padding:"8px",background:L==="acquisto"?"rgba(59, 130, 246, 0.1)":"rgba(34, 197, 94, 0.1)",borderRadius:"4px",fontSize:"11px",color:L==="acquisto"?"#3b82f6":"#22c55e"},children:[' Transazione bilaterale: verr registrata anche su "',(X=t.find(ie=>ie.id===C))==null?void 0:X.nome,'"']}):k.jsx("div",{style:{marginTop:"6px",padding:"8px",background:"rgba(156, 163, 175, 0.1)",borderRadius:"4px",fontSize:"11px",color:"#6b7280"},children:" Per tracciare chi compra/vende, prima crea una connessione con l'entit"})]}),k.jsxs("div",{style:{display:"flex",gap:"12px"},children:[k.jsxs("div",{style:{flex:1},children:[k.jsx("label",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"4px",display:"block"},children:"Importo () *"}),k.jsx("input",{type:"number",className:"form-input",value:i,onChange:ie=>y(ie.target.value),placeholder:"es: 5000"})]}),k.jsxs("div",{style:{flex:1},children:[k.jsx("label",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"4px",display:"block"},children:"Data *"}),k.jsx("input",{type:"date",className:"form-input",value:x,onChange:ie=>S(ie.target.value)})]})]}),k.jsx("button",{onClick:G,disabled:a||!l||!i,className:"btn btn-primary",style:{marginTop:"8px"},children:a?"Salvataggio...":C?"Salva (bilaterale)":"Salva (cliente generico)"})]})]}):k.jsx("button",{onClick:()=>q(!0),className:"btn btn-primary",style:{width:"100%",marginBottom:"12px"},children:"+ Nuova transazione"})}const Cm=24*60*60*1e3,_ze=[{label:"1 anno",years:1},{label:"3 anni",years:3},{label:"5 anni",years:5},{label:"10 anni",years:10}],iu=e=>{const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`};function yze({dataInizio:e,dataFine:t,onChange:n}){const r=new Date;r.setHours(12,0,0,0);const[a,l]=B.useState(3),[f,i]=B.useState(!1),[y,x]=B.useState(e),[S,C]=B.useState(t),P=new Date(r.getTime()-a*365*Cm),L=new Date(r.getTime()+365*Cm),F=P.getTime(),U=L.getTime(),q=Math.round((r.getTime()-F)/Cm),G=yn=>Math.round((yn-F)/Cm),$=yn=>F+yn*Cm,X=0,ie=G(U),de=(yn,qt,wn)=>Math.max(qt,Math.min(wn,yn)),fe=e?de(G(new Date(e).getTime()),X,ie):X,be=t?de(G(new Date(t).getTime()),X,ie):ie,[ve,Je]=B.useState(fe),[we,rt]=B.useState(be),[He,ft]=B.useState(!1),[Ct,Nt]=B.useState(!1),[Rt,en]=B.useState(!1);B.useEffect(()=>{if(!He){const yn=e?de(G(new Date(e).getTime()),X,ie):X,qt=t?de(G(new Date(t).getTime()),X,ie):ie;Je(yn),rt(qt)}},[e,t,He,a,F,U]),B.useEffect(()=>{x(e),C(t)},[e,t]);const nt=yn=>{const qt=$(yn);return new Date(qt).toLocaleDateString("it-IT",{day:"2-digit",month:"short",year:"numeric"})},pt=yn=>{const qt=$(yn);return new Date(qt).toLocaleDateString("it-IT",{month:"short",year:"numeric"})},Oe=()=>{ft(!1);const yn=iu(new Date($(ve))),qt=iu(new Date($(we)));n(yn,qt)},gn=yn=>{const qt=de(ve+yn,X,we-1);Je(qt),n(iu(new Date($(qt))),iu(new Date($(we))))},wt=yn=>{const qt=de(we+yn,ve+1,ie);rt(qt),n(iu(new Date($(ve))),iu(new Date($(qt))))},Fe=yn=>{const qt=new Date(yn).getTime(),wn=de(G(qt),X,we-1);Je(wn),Nt(!1),n(iu(new Date($(wn))),iu(new Date($(we))))},jt=yn=>{const qt=new Date(yn).getTime(),wn=de(G(qt),ve+1,ie);rt(wn),en(!1),n(iu(new Date($(ve))),iu(new Date($(wn))))},Tn=yn=>{const qt=$(we),wn=new Date(qt),Sn=new Date(qt-yn*30*Cm),Xn=Math.max(Sn.getTime(),F),rn=new Date(Xn),br=G(Xn);Je(br),n(iu(rn),iu(wn))},mn=()=>{if(y&&S){const yn=new Date(y),qt=new Date(S);if(yn<=qt){const wn=yn.getTime();if(wn<F){const Sn=Math.ceil((r.getTime()-wn)/(365*Cm));l(Math.max(Sn,a))}n(y,S),i(!1)}}},zn={flex:1,height:"8px",borderRadius:"4px",background:"linear-gradient(to right, #e2e8f0 0%, #3b82f6 50%, #e2e8f0 100%)",cursor:"pointer",WebkitAppearance:"none",appearance:"none"};return k.jsxs("div",{className:"time-slider",style:{background:"var(--bg-primary)",borderTop:"1px solid var(--border)",padding:"12px 16px"},children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",flexWrap:"wrap",gap:"8px"},children:[k.jsxs("button",{onClick:()=>i(!f),style:{fontSize:"14px",fontWeight:600,color:"var(--text-primary)",background:f?"var(--bg-secondary)":"transparent",border:"1px solid transparent",borderColor:f?"var(--border)":"transparent",padding:"4px 8px",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",transition:"all 0.2s"},title:"Clicca per impostare date personalizzate",children:[k.jsxs("span",{children:["Periodo: ",nt(ve)," - ",nt(we)]}),k.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:k.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),k.jsxs("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:[k.jsx("button",{className:"btn",style:{padding:"4px 10px",fontSize:"12px",fontWeight:600,borderRadius:"4px",minWidth:"40px",background:"#22c55e",color:"white",border:"none"},onClick:()=>{const yn=iu(r),qt=iu(new Date(r.getTime()-365*Cm));n(qt,yn)},title:"Imposta periodo: ultimo anno fino a oggi",children:"Oggi"}),[{label:"1M",months:1},{label:"3M",months:3},{label:"6M",months:6},{label:"1A",months:12},{label:"2A",months:24},{label:"Tutto",months:36}].map(({label:yn,months:qt})=>k.jsx("button",{className:"btn btn-secondary",style:{padding:"4px 10px",fontSize:"12px",fontWeight:500,borderRadius:"4px",minWidth:"40px"},onClick:()=>Tn(qt),children:yn},yn))]})]}),k.jsxs("div",{style:{display:"flex",gap:"16px",alignItems:"center",background:"var(--bg-secondary)",padding:"12px",borderRadius:"8px"},children:[k.jsx("span",{style:{fontSize:"11px",color:"var(--text-secondary)",minWidth:"65px"},children:pt(X)}),k.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"12px"},children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[k.jsx("span",{style:{fontSize:"12px",fontWeight:500,width:"25px",color:"#3b82f6"},children:"Da:"}),k.jsx("button",{onClick:()=>gn(-1),style:{padding:"2px 6px",fontSize:"14px",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",cursor:"pointer",color:"var(--text-primary)"},title:"-1 giorno",children:""}),k.jsx("input",{type:"range",min:X,max:ie,step:1,value:ve,onChange:yn=>{ft(!0);let qt=Number(yn.target.value);qt>=we&&(qt=we-1),Je(qt)},onMouseUp:Oe,onTouchEnd:Oe,onBlur:Oe,style:zn}),k.jsx("button",{onClick:()=>gn(1),style:{padding:"2px 6px",fontSize:"14px",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",cursor:"pointer",color:"var(--text-primary)"},title:"+1 giorno",children:""}),Ct?k.jsx("input",{type:"date",defaultValue:iu(new Date($(ve))),onChange:yn=>yn.target.value&&Fe(yn.target.value),onBlur:()=>Nt(!1),autoFocus:!0,style:{fontSize:"11px",padding:"2px 4px",width:"110px"}}):k.jsx("span",{onClick:()=>Nt(!0),style:{fontSize:"11px",color:"var(--text-secondary)",minWidth:"80px",textAlign:"right",cursor:"pointer",textDecoration:"underline dotted"},title:"Clicca per modificare",children:nt(ve)})]}),k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[k.jsx("span",{style:{fontSize:"12px",fontWeight:500,width:"25px",color:"#22c55e"},children:"A:"}),k.jsx("button",{onClick:()=>wt(-1),style:{padding:"2px 6px",fontSize:"14px",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",cursor:"pointer",color:"var(--text-primary)"},title:"-1 giorno",children:""}),k.jsx("input",{type:"range",min:X,max:ie,step:1,value:we,onChange:yn=>{ft(!0);let qt=Number(yn.target.value);qt<=ve&&(qt=ve+1),rt(qt)},onMouseUp:Oe,onTouchEnd:Oe,onBlur:Oe,style:zn}),k.jsx("button",{onClick:()=>wt(1),style:{padding:"2px 6px",fontSize:"14px",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",cursor:"pointer",color:"var(--text-primary)"},title:"+1 giorno",children:""}),Rt?k.jsx("input",{type:"date",defaultValue:iu(new Date($(we))),onChange:yn=>yn.target.value&&jt(yn.target.value),onBlur:()=>en(!1),autoFocus:!0,style:{fontSize:"11px",padding:"2px 4px",width:"110px"}}):k.jsxs("span",{onClick:()=>en(!0),style:{fontSize:"11px",color:we>q?"#f97316":"var(--text-secondary)",fontWeight:we>q?600:400,minWidth:"80px",textAlign:"right",cursor:"pointer",textDecoration:"underline dotted"},title:"Clicca per modificare",children:[nt(we),we>q?" (futuro)":""]})]})]}),k.jsx("span",{style:{fontSize:"11px",color:"var(--text-secondary)",minWidth:"65px",textAlign:"right"},children:pt(ie)})]}),f&&k.jsxs("div",{style:{marginTop:"12px",padding:"12px",background:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:[k.jsxs("div",{style:{display:"flex",gap:"16px",flexWrap:"wrap",alignItems:"flex-end"},children:[k.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[k.jsx("div",{style:{fontSize:"12px",fontWeight:500,marginBottom:"8px",color:"var(--text-secondary)"},children:"Date personalizzate"}),k.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[k.jsx("input",{type:"date",value:y,onChange:yn=>x(yn.target.value),style:{padding:"6px 8px",borderRadius:"4px",border:"1px solid var(--border)",background:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"13px"}}),k.jsx("span",{style:{color:"var(--text-secondary)"},children:"-"}),k.jsx("input",{type:"date",value:S,onChange:yn=>C(yn.target.value),style:{padding:"6px 8px",borderRadius:"4px",border:"1px solid var(--border)",background:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"13px"}}),k.jsx("button",{onClick:mn,className:"btn btn-primary",style:{padding:"6px 12px",fontSize:"12px"},children:"Applica"})]})]}),k.jsxs("div",{children:[k.jsx("div",{style:{fontSize:"12px",fontWeight:500,marginBottom:"8px",color:"var(--text-secondary)"},children:"Estensione slider"}),k.jsx("div",{style:{display:"flex",gap:"4px"},children:_ze.map(({label:yn,years:qt})=>k.jsx("button",{onClick:()=>l(qt),className:`btn ${a===qt?"btn-primary":"btn-secondary"}`,style:{padding:"6px 10px",fontSize:"11px"},children:yn},qt))})]})]}),k.jsx("div",{style:{marginTop:"10px",fontSize:"11px",color:"var(--text-secondary)",fontStyle:"italic"},children:'I preset (1M, 3M, ecc.) calcolano indietro dalla data "A:" selezionata'})]}),k.jsx("style",{children:`
        .time-slider input[type="range"] {
          -webkit-appearance: none;
          appearance: none;
          background: #e2e8f0;
          height: 6px;
          border-radius: 3px;
          outline: none;
        }
        .time-slider input[type="range"]::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
          width: 18px;
          height: 18px;
          border-radius: 50%;
          background: #3b82f6;
          cursor: pointer;
          border: 2px solid white;
          box-shadow: 0 2px 6px rgba(0,0,0,0.2);
          transition: transform 0.1s;
        }
        .time-slider input[type="range"]::-webkit-slider-thumb:hover {
          transform: scale(1.15);
        }
        .time-slider input[type="range"]::-webkit-slider-thumb:active {
          transform: scale(1.25);
          background: #2563eb;
        }
        .time-slider input[type="range"]::-moz-range-thumb {
          width: 18px;
          height: 18px;
          border-radius: 50%;
          background: #3b82f6;
          cursor: pointer;
          border: 2px solid white;
          box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        .time-slider input[type="range"]::-moz-range-thumb:hover {
          transform: scale(1.15);
        }
      `})]})}function vze({onVerify:e,onClose:t}){const[n,r]=B.useState(""),[a,l]=B.useState(""),[f,i]=B.useState(!1),y=B.useRef(null);B.useEffect(()=>{setTimeout(()=>{var S;return(S=y.current)==null?void 0:S.focus()},100)},[]),B.useEffect(()=>{const S=C=>{C.key==="Escape"&&t()};return window.addEventListener("keydown",S),()=>window.removeEventListener("keydown",S)},[t]);const x=async S=>{var C;if(S.preventDefault(),!!n.trim()){l(""),i(!0);try{await e(n),t()}catch{l("PIN non valido"),r(""),(C=y.current)==null||C.focus()}finally{i(!1)}}};return k.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:S=>{S.target===S.currentTarget&&t()},children:k.jsxs("div",{style:{background:"white",padding:"32px",borderRadius:"16px",width:"100%",maxWidth:"360px",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[k.jsxs("div",{style:{textAlign:"center",marginBottom:"24px"},children:[k.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),k.jsx("h2",{style:{fontSize:"20px",fontWeight:600,marginBottom:"8px"},children:"Area Personale"}),k.jsx("p",{style:{color:"#6b7280",fontSize:"14px"},children:"Inserisci il PIN per vedere i tuoi dati privati"})]}),k.jsxs("form",{onSubmit:x,children:[k.jsx("input",{ref:y,type:"password",inputMode:"numeric",value:n,onChange:S=>r(S.target.value.replace(/\D/g,"")),placeholder:"PIN",maxLength:10,style:{width:"100%",fontSize:"32px",textAlign:"center",letterSpacing:"12px",padding:"16px",border:"2px solid #e5e7eb",borderRadius:"12px",marginBottom:"16px",boxSizing:"border-box"}}),a&&k.jsx("div",{style:{padding:"12px",marginBottom:"16px",background:"#fef2f2",color:"#dc2626",borderRadius:"8px",fontSize:"14px",textAlign:"center"},children:a}),k.jsxs("div",{style:{display:"flex",gap:"12px"},children:[k.jsx("button",{type:"button",onClick:t,style:{flex:1,padding:"14px",border:"1px solid #e5e7eb",borderRadius:"10px",background:"white",fontSize:"15px",cursor:"pointer"},children:"Annulla"}),k.jsx("button",{type:"submit",disabled:!n.trim()||f,style:{flex:1,padding:"14px",border:"none",borderRadius:"10px",background:"#6366f1",color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",opacity:!n.trim()||f?.5:1},children:f?"...":"Sblocca"})]})]})]})})}function xze({onSetPin:e,onClose:t}){const[n,r]=B.useState(""),[a,l]=B.useState(""),[f,i]=B.useState(""),[y,x]=B.useState(!1),S=B.useRef(null);B.useEffect(()=>{setTimeout(()=>{var P;return(P=S.current)==null?void 0:P.focus()},100)},[]),B.useEffect(()=>{const P=L=>{L.key==="Escape"&&t()};return window.addEventListener("keydown",P),()=>window.removeEventListener("keydown",P)},[t]);const C=async P=>{if(P.preventDefault(),!!n.trim()){if(n.length<4){i("PIN deve essere almeno 4 cifre");return}if(!/^[0-9]+$/.test(n)){i("PIN deve contenere solo numeri");return}if(n!==a){i("I PIN non coincidono");return}i(""),x(!0);try{await e(n),t()}catch{i("Errore nel salvare il PIN")}finally{x(!1)}}};return k.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:P=>{P.target===P.currentTarget&&t()},children:k.jsxs("div",{style:{background:"white",padding:"32px",borderRadius:"16px",width:"100%",maxWidth:"360px",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[k.jsxs("div",{style:{textAlign:"center",marginBottom:"24px"},children:[k.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),k.jsx("h2",{style:{fontSize:"20px",fontWeight:600,marginBottom:"8px"},children:"Crea il tuo PIN"}),k.jsx("p",{style:{color:"#6b7280",fontSize:"14px"},children:"Il PIN protegge i tuoi dati personali. Solo tu potrai vederli."})]}),k.jsxs("form",{onSubmit:C,children:[k.jsxs("div",{style:{marginBottom:"12px"},children:[k.jsx("label",{style:{fontSize:"13px",color:"#6b7280",display:"block",marginBottom:"4px"},children:"Nuovo PIN (min 4 cifre)"}),k.jsx("input",{ref:S,type:"password",inputMode:"numeric",value:n,onChange:P=>r(P.target.value.replace(/\D/g,"")),placeholder:"",maxLength:10,style:{width:"100%",fontSize:"24px",textAlign:"center",letterSpacing:"8px",padding:"12px",border:"2px solid #e5e7eb",borderRadius:"10px",boxSizing:"border-box"}})]}),k.jsxs("div",{style:{marginBottom:"16px"},children:[k.jsx("label",{style:{fontSize:"13px",color:"#6b7280",display:"block",marginBottom:"4px"},children:"Conferma PIN"}),k.jsx("input",{type:"password",inputMode:"numeric",value:a,onChange:P=>l(P.target.value.replace(/\D/g,"")),placeholder:"",maxLength:10,style:{width:"100%",fontSize:"24px",textAlign:"center",letterSpacing:"8px",padding:"12px",border:"2px solid #e5e7eb",borderRadius:"10px",boxSizing:"border-box"}})]}),f&&k.jsx("div",{style:{padding:"12px",marginBottom:"16px",background:"#fef2f2",color:"#dc2626",borderRadius:"8px",fontSize:"14px",textAlign:"center"},children:f}),k.jsxs("div",{style:{display:"flex",gap:"12px"},children:[k.jsx("button",{type:"button",onClick:t,style:{flex:1,padding:"14px",border:"1px solid #e5e7eb",borderRadius:"10px",background:"white",fontSize:"15px",cursor:"pointer"},children:"Annulla"}),k.jsx("button",{type:"submit",disabled:!n||!a||y,style:{flex:1,padding:"14px",border:"none",borderRadius:"10px",background:"#22c55e",color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",opacity:!n||!a||y?.5:1},children:y?"...":"Salva PIN"})]})]})]})})}function bze(){const[e,t]=B.useState([]),[n,r]=B.useState(!0),[a,l]=B.useState(!1),[f,i]=B.useState(null),[y,x]=B.useState(!1),[S,C]=B.useState(""),[P,L]=B.useState(null),[F,U]=B.useState(""),[q,G]=B.useState("aziendale"),[$,X]=B.useState("#3b82f6"),[ie,de]=B.useState(null),[fe,be]=B.useState(""),[ve,Je]=B.useState(""),[we,rt]=B.useState(""),[He,ft]=B.useState(new Set);B.useEffect(()=>{Ct()},[]);const Ct=async()=>{r(!0);try{const{data:jt}=await Kn.getFamiglieProdotto();t(jt);const Tn=new Set,mn=zn=>{zn.forEach(yn=>{yn.children&&yn.children.length>0&&(Tn.add(yn.id),mn(yn.children))})};mn(jt),ft(Tn)}catch(jt){console.error("Errore caricamento famiglie:",jt),i({type:"error",text:"Errore caricamento famiglie prodotto"})}finally{r(!1)}},Nt=async()=>{var jt,Tn;if(S.trim()){l(!0),i(null);try{await Kn.createFamigliaProdotto({nome:S.trim(),parent_id:P,descrizione:F.trim()||void 0,visibilita:q,colore:$}),i({type:"success",text:"Famiglia creata!"}),C(""),L(null),U(""),G("aziendale"),X("#3b82f6"),x(!1),Ct()}catch(mn){i({type:"error",text:((Tn=(jt=mn.response)==null?void 0:jt.data)==null?void 0:Tn.error)||"Errore creazione famiglia"})}finally{l(!1)}}},Rt=async jt=>{var Tn,mn;if(fe.trim()){l(!0);try{await Kn.updateFamigliaProdotto(jt,{nome:fe.trim(),descrizione:ve.trim()||void 0,colore:we||void 0}),de(null),Ct()}catch(zn){i({type:"error",text:((mn=(Tn=zn.response)==null?void 0:Tn.data)==null?void 0:mn.error)||"Errore modifica famiglia"})}finally{l(!1)}}},en=async(jt,Tn,mn)=>{var yn,qt;const zn=mn>0?`Eliminare "${Tn}" e le sue ${mn} sottofamiglie?`:`Eliminare "${Tn}"?`;if(confirm(zn)){l(!0);try{await Kn.deleteFamigliaProdotto(jt),Ct()}catch(wn){i({type:"error",text:((qt=(yn=wn.response)==null?void 0:yn.data)==null?void 0:qt.error)||"Errore eliminazione famiglia"})}finally{l(!1)}}},nt=jt=>{ft(Tn=>{const mn=new Set(Tn);return mn.has(jt)?mn.delete(jt):mn.add(jt),mn})},pt=jt=>{de(jt.id),be(jt.nome),Je(jt.descrizione||""),rt(jt.colore||"#3b82f6")},Oe=jt=>{L(jt),x(!0)},gn=(jt,Tn=0)=>jt.flatMap(mn=>[{id:mn.id,nome:mn.nome,level:Tn},...mn.children?gn(mn.children,Tn+1):[]]),wt=gn(e),Fe=(jt,Tn=0)=>jt.map(mn=>k.jsxs("div",{children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 12px",paddingLeft:`${12+Tn*24}px`,background:Tn===0?"var(--bg-primary)":"transparent",borderRadius:Tn===0?"8px":"0",borderBottom:Tn>0?"1px solid var(--border-color)":"none"},children:[mn.children&&mn.children.length>0?k.jsx("button",{onClick:()=>nt(mn.id),style:{background:"none",border:"none",cursor:"pointer",fontSize:"12px",color:"var(--text-secondary)",width:"20px"},children:He.has(mn.id)?"":""}):k.jsx("span",{style:{width:"20px"}}),ie===mn.id?k.jsxs(k.Fragment,{children:[k.jsx("input",{type:"color",value:we,onChange:zn=>rt(zn.target.value),style:{width:"32px",height:"32px",padding:"0",border:"2px solid var(--border-color)",borderRadius:"6px",cursor:"pointer"},title:"Colore parabola sulla mappa"}),k.jsx("input",{type:"text",className:"form-input",value:fe,onChange:zn=>be(zn.target.value),style:{flex:1},autoFocus:!0}),k.jsx("button",{className:"btn btn-primary",onClick:()=>Rt(mn.id),disabled:a,style:{padding:"4px 12px",fontSize:"12px"},children:"Salva"}),k.jsx("button",{className:"btn btn-secondary",onClick:()=>de(null),style:{padding:"4px 12px",fontSize:"12px"},children:""})]}):k.jsxs(k.Fragment,{children:[k.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"50%",backgroundColor:mn.colore||"#94a3b8",border:"2px solid rgba(255,255,255,0.3)",flexShrink:0},title:`Colore: ${mn.colore||"default"}`}),k.jsxs("div",{style:{flex:1},children:[k.jsx("span",{style:{fontWeight:Tn===0?600:400},children:mn.nome}),mn.descrizione&&k.jsxs("span",{style:{fontSize:"12px",color:"var(--text-secondary)",marginLeft:"8px"},children:["- ",mn.descrizione]})]}),k.jsx("button",{onClick:()=>Oe(mn.id),title:"Aggiungi sottofamiglia",style:{padding:"4px 8px",background:"var(--bg-secondary)",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"+"}),k.jsx("button",{onClick:()=>pt(mn),style:{padding:"4px 8px",background:"var(--bg-secondary)",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"Modifica"}),k.jsx("button",{onClick:()=>en(mn.id,mn.nome,mn.num_figli||0),style:{padding:"4px 8px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:""})]})]}),mn.children&&mn.children.length>0&&He.has(mn.id)&&k.jsx("div",{style:{marginLeft:"0"},children:Fe(mn.children,Tn+1)})]},mn.id));return k.jsxs("div",{children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[k.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"13px",margin:0},children:"Organizza i prodotti in famiglie e sottofamiglie gerarchiche"}),k.jsx("button",{className:"btn btn-primary",onClick:()=>{x(!0),L(null)},style:{padding:"6px 12px",fontSize:"13px"},children:"+ Nuova Famiglia"})]}),f&&k.jsx("div",{style:{padding:"12px",borderRadius:"8px",background:f.type==="success"?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:f.type==="success"?"#22c55e":"#ef4444",marginBottom:"16px"},children:f.text}),y&&k.jsxs("div",{style:{background:"var(--bg-primary)",padding:"16px",borderRadius:"8px",marginBottom:"16px"},children:[k.jsx("h4",{style:{fontSize:"14px",fontWeight:600,marginBottom:"12px"},children:P?"Nuova sottofamiglia":"Nuova famiglia principale"}),k.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",marginBottom:"12px"},children:[k.jsxs("div",{style:{flex:1,minWidth:"150px"},children:[k.jsx("label",{style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"var(--text-secondary)"},children:"Nome"}),k.jsx("input",{type:"text",className:"form-input",value:S,onChange:jt=>C(jt.target.value),placeholder:"es: Pitture",autoFocus:!0})]}),k.jsxs("div",{style:{flex:1,minWidth:"150px"},children:[k.jsx("label",{style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"var(--text-secondary)"},children:"Famiglia padre"}),k.jsxs("select",{className:"form-input",value:P||"",onChange:jt=>L(jt.target.value||null),children:[k.jsx("option",{value:"",children:"-- Nessuna (radice) --"}),wt.map(jt=>k.jsxs("option",{value:jt.id,children:["  ".repeat(jt.level),jt.nome]},jt.id))]})]})]}),k.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",marginBottom:"12px"},children:[k.jsxs("div",{style:{flex:2,minWidth:"200px"},children:[k.jsx("label",{style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"var(--text-secondary)"},children:"Descrizione (opzionale)"}),k.jsx("input",{type:"text",className:"form-input",value:F,onChange:jt=>U(jt.target.value),placeholder:"es: Tutte le pitture per interni ed esterni"})]}),k.jsxs("div",{style:{minWidth:"80px"},children:[k.jsx("label",{style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"var(--text-secondary)"},children:"Colore mappa"}),k.jsx("input",{type:"color",value:$,onChange:jt=>X(jt.target.value),style:{width:"100%",height:"38px",padding:"2px",border:"1px solid var(--border-color)",borderRadius:"6px",cursor:"pointer"}})]}),k.jsxs("div",{style:{minWidth:"120px"},children:[k.jsx("label",{style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"var(--text-secondary)"},children:"Visibilit"}),k.jsxs("select",{className:"form-input",value:q,onChange:jt=>G(jt.target.value),children:[k.jsx("option",{value:"aziendale",children:"Aziendale"}),k.jsx("option",{value:"personale",children:"Personale"})]})]})]}),k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("button",{className:"btn btn-primary",onClick:Nt,disabled:a||!S.trim(),children:a?"...":"Crea"}),k.jsx("button",{className:"btn btn-secondary",onClick:()=>{x(!1),C(""),L(null),U(""),G("aziendale"),X("#3b82f6")},children:"Annulla"})]})]}),n?k.jsx("p",{style:{color:"var(--text-secondary)"},children:"Caricamento..."}):e.length===0?k.jsxs("div",{style:{textAlign:"center",padding:"48px",color:"var(--text-secondary)"},children:[k.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),k.jsx("p",{children:"Nessuna famiglia prodotto definita."}),k.jsx("p",{style:{fontSize:"13px"},children:"Crea la prima famiglia per organizzare i tuoi prodotti."})]}):k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:Fe(e)}),e.length===0&&!y&&k.jsxs("div",{style:{marginTop:"24px",padding:"16px",background:"var(--bg-primary)",borderRadius:"8px"},children:[k.jsx("h4",{style:{fontSize:"13px",fontWeight:600,marginBottom:"8px"},children:"Esempio struttura:"}),k.jsx("pre",{style:{fontSize:"12px",color:"var(--text-secondary)",margin:0},children:`PITTURE
 Idropitture
 Smalti
 Primer/Fissativi

CAPPOTTO
 Pannelli EPS
 Rasante
 Finitura`})]})]})}const lM={cerchio:"",quadrato:"",triangolo:"",stella:"",croce:"",esagono:""};function wze(){const[e,t]=B.useState([]),[n,r]=B.useState([]),[a,l]=B.useState({}),[f,i]=B.useState([]),[y,x]=B.useState(!0),[S,C]=B.useState(new Set),[P,L]=B.useState(null),[F,U]=B.useState(""),[q,G]=B.useState(!1),[$,X]=B.useState(null),[ie,de]=B.useState(!1),[fe,be]=B.useState(null),[ve,Je]=B.useState(!1),[we,rt]=B.useState(""),[He,ft]=B.useState("cerchio"),[Ct,Nt]=B.useState("#3b82f6"),[Rt,en]=B.useState(""),[nt,pt]=B.useState(""),[Oe,gn]=B.useState("testo"),[wt,Fe]=B.useState(!1),[jt,Tn]=B.useState(!1),[mn,zn]=B.useState(!1),[yn,qt]=B.useState(!1),[wn,Sn]=B.useState(!1),[Xn,rn]=B.useState(null);B.useEffect(()=>{br()},[]);const br=async()=>{x(!0);try{const[Tt,kn,nr]=await Promise.all([Kn.get("/tipi"),Kn.get("/tipologie"),Kn.get("/tipi-connessione")]);t(Tt.data.data),r(kn.data.data),i(nr.data.data),C(new Set(Tt.data.data.map(dt=>dt.id)))}catch(Tt){console.error("Errore caricamento:",Tt),sr("error","Errore caricamento dati")}finally{x(!1)}},Qr=async Tt=>{try{const kn=await Kn.get(`/campi?tipo=${Tt}`);l(nr=>({...nr,[Tt]:kn.data.data}))}catch(kn){console.error("Errore caricamento campi:",kn)}},sr=(Tt,kn)=>{rn({type:Tt,text:kn}),setTimeout(()=>rn(null),3e3)},ar=Tt=>{C(kn=>{const nr=new Set(kn);return nr.has(Tt)?nr.delete(Tt):nr.add(Tt),nr})},Vn=async()=>{if(we.trim()){Sn(!0);try{const Tt=await Kn.post("/tipi",{nome:we.trim(),forma:He,is_acquirente:wt,is_venditore:jt,is_intermediario:mn,is_influencer:yn});t(kn=>[...kn,{id:Tt.data.id,nome:we.trim(),forma:He,ordine:kn.length,is_acquirente:wt,is_venditore:jt,is_intermediario:mn,is_influencer:yn}]),C(kn=>new Set([...kn,Tt.data.id])),rt(""),Fe(!1),Tn(!1),zn(!1),qt(!1),G(!1),sr("success","Tipo creato")}catch{sr("error","Errore creazione tipo")}finally{Sn(!1)}}},wr=async(Tt,kn)=>{Sn(!0);try{await Kn.put(`/tipi/${Tt}`,kn),t(nr=>nr.map(dt=>dt.id===Tt?{...dt,...kn}:dt)),L(null),sr("success","Tipo aggiornato")}catch{sr("error","Errore aggiornamento")}finally{Sn(!1)}},ys=async Tt=>{var kn,nr;if(confirm("Eliminare questo tipo e tutte le sue tipologie?")){Sn(!0);try{await Kn.delete(`/tipi/${Tt}`),t(dt=>dt.filter(Qn=>Qn.id!==Tt)),r(dt=>dt.filter(Qn=>Qn.tipo_id!==Tt)),sr("success","Tipo eliminato")}catch(dt){sr("error",((nr=(kn=dt.response)==null?void 0:kn.data)==null?void 0:nr.error)||"Errore eliminazione")}finally{Sn(!1)}}},Si=async Tt=>{if(we.trim()){Sn(!0);try{const kn=await Kn.post("/tipologie",{tipo_id:Tt,nome:we.trim(),colore:Ct});r(nr=>[...nr,{id:kn.data.id,tipo_id:Tt,nome:we.trim(),colore:Ct,ordine:nr.filter(dt=>dt.tipo_id===Tt).length}]),rt(""),Nt("#3b82f6"),X(null),sr("success","Tipologia creata")}catch{sr("error","Errore creazione tipologia")}finally{Sn(!1)}}},Ri=async(Tt,kn)=>{Sn(!0);try{await Kn.put(`/tipologie/${Tt}`,kn),r(nr=>nr.map(dt=>dt.id===Tt?{...dt,...kn}:dt)),L(null),sr("success","Tipologia aggiornata")}catch{sr("error","Errore aggiornamento")}finally{Sn(!1)}},ks=async Tt=>{if(confirm("Eliminare questa tipologia?")){Sn(!0);try{await Kn.delete(`/tipologie/${Tt}`),r(kn=>kn.filter(nr=>nr.id!==Tt)),sr("success","Tipologia eliminata")}catch{sr("error","Errore eliminazione")}finally{Sn(!1)}}},$i=async()=>{if(we.trim()){Sn(!0);try{const Tt=await Kn.post("/tipi-connessione",{nome:we.trim(),colore:Ct});i(kn=>[...kn,{id:Tt.data.id,nome:we.trim(),colore:Ct,ordine:kn.length}]),rt(""),Nt("#64748b"),de(!1),sr("success","Tipo connessione creato")}catch{sr("error","Errore creazione")}finally{Sn(!1)}}},Ws=async Tt=>{var kn,nr;if(confirm("Eliminare questo tipo connessione?")){Sn(!0);try{await Kn.delete(`/tipi-connessione/${Tt}`),i(dt=>dt.filter(Qn=>Qn.id!==Tt)),sr("success","Tipo connessione eliminato")}catch(dt){sr("error",((nr=(kn=dt.response)==null?void 0:kn.data)==null?void 0:nr.error)||"Errore eliminazione")}finally{Sn(!1)}}},Kt=async Tt=>{var kn;if(!(!Rt.trim()||!nt.trim())){Sn(!0);try{const dt={id:(await Kn.post("/campi",{tipo_id:Tt,nome:Rt.trim().toLowerCase().replace(/\s+/g,"_"),etichetta:nt.trim(),tipo_dato:Oe})).data.id,tipo_id:Tt,nome:Rt.trim().toLowerCase().replace(/\s+/g,"_"),etichetta:nt.trim(),tipo_dato:Oe,obbligatorio:!1,ordine:((kn=a[Tt])==null?void 0:kn.length)||0};l(Qn=>({...Qn,[Tt]:[...Qn[Tt]||[],dt]})),en(""),pt(""),gn("testo"),Je(!1),sr("success","Campo creato")}catch{sr("error","Errore creazione campo")}finally{Sn(!1)}}},An=async(Tt,kn,nr)=>{Sn(!0);try{await Kn.put(`/campi/${Tt}`,nr),l(dt=>({...dt,[kn]:dt[kn].map(Qn=>Qn.id===Tt?{...Qn,...nr}:Qn)})),L(null),sr("success","Campo aggiornato")}catch{sr("error","Errore aggiornamento campo")}finally{Sn(!1)}},Lr=async(Tt,kn)=>{if(confirm("Eliminare questo campo?")){Sn(!0);try{await Kn.delete(`/campi/${Tt}`),l(nr=>({...nr,[kn]:nr[kn].filter(dt=>dt.id!==Tt)})),sr("success","Campo eliminato")}catch{sr("error","Errore eliminazione")}finally{Sn(!1)}}};return y?k.jsx("div",{style:{padding:24,color:"var(--text-secondary)"},children:"Caricamento..."}):k.jsxs("div",{style:{padding:16,maxWidth:600},children:[Xn&&k.jsx("div",{style:{padding:12,marginBottom:16,borderRadius:8,background:Xn.type==="success"?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:Xn.type==="success"?"#22c55e":"#ef4444"},children:Xn.text}),k.jsxs("div",{style:{marginBottom:32},children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[k.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:600},children:"Tipi Entit"}),k.jsx("button",{className:"btn btn-primary",onClick:()=>G(!0),style:{padding:"6px 12px",fontSize:13},children:"+ Nuovo Tipo"})]}),q&&k.jsxs("div",{style:{background:"var(--bg-secondary)",padding:16,borderRadius:8,marginBottom:16,border:"1px solid var(--border-color)"},children:[k.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"flex-end"},children:[k.jsxs("div",{style:{flex:1,minWidth:150},children:[k.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4,color:"var(--text-secondary)"},children:"Nome"}),k.jsx("input",{type:"text",className:"form-input",value:we,onChange:Tt=>rt(Tt.target.value),placeholder:"es: Cantiere",autoFocus:!0})]}),k.jsxs("div",{style:{width:120},children:[k.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4,color:"var(--text-secondary)"},children:"Forma"}),k.jsx("select",{className:"form-input",value:He,onChange:Tt=>ft(Tt.target.value),children:Object.entries(lM).map(([Tt,kn])=>k.jsxs("option",{value:Tt,children:[kn," ",Tt]},Tt))})]})]}),k.jsxs("div",{style:{marginTop:12},children:[k.jsx("label",{style:{display:"block",fontSize:12,marginBottom:8,color:"var(--text-secondary)"},children:"Natura commerciale (default per questo tipo)"}),k.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap"},children:[k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13,cursor:"pointer"},children:[k.jsx("input",{type:"checkbox",checked:wt,onChange:Tt=>Fe(Tt.target.checked)}),k.jsx("span",{title:"Compra prodotti/servizi",children:" Acquirente"})]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13,cursor:"pointer"},children:[k.jsx("input",{type:"checkbox",checked:jt,onChange:Tt=>Tn(Tt.target.checked)}),k.jsx("span",{title:"Vende prodotti/servizi",children:" Venditore"})]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13,cursor:"pointer"},children:[k.jsx("input",{type:"checkbox",checked:mn,onChange:Tt=>zn(Tt.target.checked)}),k.jsx("span",{title:"Compra e rivende",children:" Intermediario"})]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13,cursor:"pointer"},children:[k.jsx("input",{type:"checkbox",checked:yn,onChange:Tt=>qt(Tt.target.checked)}),k.jsx("span",{title:"Prescrive/influenza acquisti",children:" Influencer"})]})]})]}),k.jsxs("div",{style:{display:"flex",gap:12,marginTop:16},children:[k.jsx("button",{className:"btn btn-primary",onClick:Vn,disabled:wn||!we.trim(),children:"Crea"}),k.jsx("button",{className:"btn btn-secondary",onClick:()=>{G(!1),rt("")},children:"Annulla"})]})]}),k.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.map(Tt=>{const kn=S.has(Tt.id),nr=n.filter(dt=>dt.tipo_id===Tt.id);return k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:8,border:"1px solid var(--border-color)",overflow:"hidden"},children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"12px 16px",cursor:"pointer",background:kn?"var(--bg-primary)":"transparent"},onClick:()=>ar(Tt.id),children:[k.jsx("span",{style:{fontSize:12,color:"var(--text-secondary)",width:16,textAlign:"center"},children:kn?"":""}),k.jsx("span",{style:{fontSize:20,width:28,textAlign:"center"},children:lM[Tt.forma]||""}),P===Tt.id?k.jsx("input",{type:"text",className:"form-input",value:F,onChange:dt=>U(dt.target.value),onBlur:()=>{F.trim()&&F!==Tt.nome?wr(Tt.id,{nome:F.trim()}):L(null)},onKeyDown:dt=>{dt.key==="Enter"?wr(Tt.id,{nome:F.trim()}):dt.key==="Escape"&&L(null)},onClick:dt=>dt.stopPropagation(),autoFocus:!0,style:{flex:1}}):k.jsx("span",{style:{flex:1,fontWeight:500},onDoubleClick:dt=>{dt.stopPropagation(),L(Tt.id),U(Tt.nome)},children:Tt.nome}),k.jsxs("span",{style:{fontSize:11,color:"var(--text-secondary)"},children:[nr.length," tipologie"]}),k.jsxs("div",{style:{display:"flex",gap:4},onClick:dt=>dt.stopPropagation(),children:[k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:2,fontSize:11,cursor:"pointer",padding:"2px 4px",background:Tt.is_acquirente?"rgba(59, 130, 246, 0.2)":"var(--bg-primary)",borderRadius:4},title:"Acquirente",children:[k.jsx("input",{type:"checkbox",checked:!!Tt.is_acquirente,onChange:dt=>wr(Tt.id,{is_acquirente:dt.target.checked}),style:{width:12,height:12}}),""]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:2,fontSize:11,cursor:"pointer",padding:"2px 4px",background:Tt.is_venditore?"rgba(34, 197, 94, 0.2)":"var(--bg-primary)",borderRadius:4},title:"Venditore",children:[k.jsx("input",{type:"checkbox",checked:!!Tt.is_venditore,onChange:dt=>wr(Tt.id,{is_venditore:dt.target.checked}),style:{width:12,height:12}}),""]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:2,fontSize:11,cursor:"pointer",padding:"2px 4px",background:Tt.is_intermediario?"rgba(234, 179, 8, 0.2)":"var(--bg-primary)",borderRadius:4},title:"Intermediario",children:[k.jsx("input",{type:"checkbox",checked:!!Tt.is_intermediario,onChange:dt=>wr(Tt.id,{is_intermediario:dt.target.checked}),style:{width:12,height:12}}),""]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:2,fontSize:11,cursor:"pointer",padding:"2px 4px",background:Tt.is_influencer?"rgba(168, 85, 247, 0.2)":"var(--bg-primary)",borderRadius:4},title:"Influencer",children:[k.jsx("input",{type:"checkbox",checked:!!Tt.is_influencer,onChange:dt=>wr(Tt.id,{is_influencer:dt.target.checked}),style:{width:12,height:12}}),""]})]}),k.jsx("select",{className:"form-input",value:Tt.forma,onChange:dt=>{dt.stopPropagation(),wr(Tt.id,{forma:dt.target.value})},onClick:dt=>dt.stopPropagation(),style:{width:100,padding:"4px 8px",fontSize:12},children:Object.entries(lM).map(([dt,Qn])=>k.jsxs("option",{value:dt,children:[Qn," ",dt]},dt))}),k.jsx("button",{onClick:dt=>{dt.stopPropagation(),be(fe===Tt.id?null:Tt.id),a[Tt.id]||Qr(Tt.id)},style:{padding:"4px 8px",background:fe===Tt.id?"var(--primary)":"var(--bg-primary)",color:fe===Tt.id?"white":"var(--text-primary)",border:"none",borderRadius:4,cursor:"pointer",fontSize:11},title:"Campi personalizzati",children:"Campi"}),k.jsx("button",{onClick:dt=>{dt.stopPropagation(),ys(Tt.id)},style:{padding:"4px 8px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",border:"none",borderRadius:4,cursor:"pointer",fontSize:11},children:""})]}),fe===Tt.id&&k.jsxs("div",{style:{padding:16,background:"var(--bg-primary)",borderTop:"1px solid var(--border-color)"},children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[k.jsx("span",{style:{fontSize:13,fontWeight:500},children:"Campi personalizzati"}),k.jsx("button",{className:"btn btn-primary",onClick:()=>Je(!0),style:{padding:"4px 8px",fontSize:11},children:"+ Campo"})]}),ve&&k.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"},children:[k.jsx("input",{type:"text",className:"form-input",placeholder:"Etichetta (es: Progettista)",value:nt,onChange:dt=>{pt(dt.target.value),en(dt.target.value.toLowerCase().replace(/\s+/g,"_"))},style:{flex:1,minWidth:150}}),k.jsxs("select",{className:"form-input",value:Oe,onChange:dt=>gn(dt.target.value),style:{width:100},children:[k.jsx("option",{value:"testo",children:"Testo"}),k.jsx("option",{value:"textarea",children:"Area testo"}),k.jsx("option",{value:"numero",children:"Numero"}),k.jsx("option",{value:"data",children:"Data"}),k.jsx("option",{value:"email",children:"Email"}),k.jsx("option",{value:"telefono",children:"Telefono"}),k.jsx("option",{value:"url",children:"URL"}),k.jsx("option",{value:"select",children:"Select"})]}),k.jsx("button",{className:"btn btn-primary",onClick:()=>Kt(Tt.id),disabled:wn,children:"Crea"}),k.jsx("button",{className:"btn btn-secondary",onClick:()=>Je(!1),children:""})]}),(a[Tt.id]||[]).length===0?k.jsx("p",{style:{color:"var(--text-secondary)",fontSize:12,margin:0},children:"Nessun campo personalizzato"}):k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:(a[Tt.id]||[]).map(dt=>k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 8px",background:"var(--bg-secondary)",borderRadius:4,fontSize:12},children:[P===dt.id?k.jsx("input",{type:"text",className:"form-input",value:F,onChange:Qn=>U(Qn.target.value),onBlur:()=>{F.trim()&&F!==dt.etichetta?An(dt.id,Tt.id,{etichetta:F.trim()}):L(null)},onKeyDown:Qn=>{Qn.key==="Enter"?An(dt.id,Tt.id,{etichetta:F.trim()}):Qn.key==="Escape"&&L(null)},autoFocus:!0,style:{flex:1,fontSize:12}}):k.jsx("span",{style:{flex:1},children:dt.etichetta}),k.jsxs("select",{className:"form-input",value:dt.tipo_dato,onChange:Qn=>An(dt.id,Tt.id,{tipo_dato:Qn.target.value}),style:{width:90,padding:"2px 4px",fontSize:11},children:[k.jsx("option",{value:"testo",children:"Testo"}),k.jsx("option",{value:"textarea",children:"Area testo"}),k.jsx("option",{value:"numero",children:"Numero"}),k.jsx("option",{value:"data",children:"Data"}),k.jsx("option",{value:"email",children:"Email"}),k.jsx("option",{value:"telefono",children:"Telefono"}),k.jsx("option",{value:"url",children:"URL"}),k.jsx("option",{value:"select",children:"Select"})]}),k.jsx("button",{onClick:()=>{L(dt.id),U(dt.etichetta)},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:12},title:"Modifica etichetta",children:""}),k.jsx("button",{onClick:()=>Lr(dt.id,Tt.id),style:{background:"none",border:"none",color:"#ef4444",cursor:"pointer",fontSize:11},title:"Elimina campo",children:""})]},dt.id))})]}),kn&&k.jsxs("div",{style:{padding:"0 16px 12px 48px"},children:[nr.map(dt=>k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 0",borderBottom:"1px solid var(--border-color)"},children:[k.jsx("span",{style:{fontSize:10,color:"var(--text-secondary)"},children:""}),k.jsx("input",{type:"color",value:dt.colore,onChange:Qn=>Ri(dt.id,{colore:Qn.target.value}),style:{width:24,height:24,padding:0,border:"none",borderRadius:4,cursor:"pointer"}}),P===dt.id?k.jsx("input",{type:"text",className:"form-input",value:F,onChange:Qn=>U(Qn.target.value),onBlur:()=>{F.trim()&&F!==dt.nome?Ri(dt.id,{nome:F.trim()}):L(null)},onKeyDown:Qn=>{Qn.key==="Enter"?Ri(dt.id,{nome:F.trim()}):Qn.key==="Escape"&&L(null)},autoFocus:!0,style:{flex:1,fontSize:13}}):k.jsx("span",{style:{flex:1,fontSize:13},onDoubleClick:()=>{L(dt.id),U(dt.nome)},children:dt.nome}),k.jsx("button",{onClick:()=>ks(dt.id),style:{padding:"2px 6px",background:"none",color:"#ef4444",border:"none",cursor:"pointer",fontSize:11,opacity:.6},children:""})]},dt.id)),$===Tt.id?k.jsxs("div",{style:{display:"flex",gap:8,padding:"8px 0",alignItems:"center"},children:[k.jsx("span",{style:{fontSize:10,color:"var(--text-secondary)"},children:""}),k.jsx("input",{type:"color",value:Ct,onChange:dt=>Nt(dt.target.value),style:{width:24,height:24,padding:0,border:"none",borderRadius:4}}),k.jsx("input",{type:"text",className:"form-input",placeholder:"Nome tipologia",value:we,onChange:dt=>rt(dt.target.value),onKeyDown:dt=>{dt.key==="Enter"&&Si(Tt.id),dt.key==="Escape"&&(X(null),rt(""))},autoFocus:!0,style:{flex:1,fontSize:13}}),k.jsx("button",{className:"btn btn-primary",onClick:()=>Si(Tt.id),style:{padding:"4px 8px",fontSize:11},children:""}),k.jsx("button",{className:"btn btn-secondary",onClick:()=>{X(null),rt("")},style:{padding:"4px 8px",fontSize:11},children:""})]}):k.jsxs("button",{onClick:()=>X(Tt.id),style:{display:"flex",alignItems:"center",gap:8,padding:"8px 0",background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:12,width:"100%"},children:[k.jsx("span",{style:{fontSize:10,color:"var(--text-secondary)"},children:""}),"+ Aggiungi tipologia"]})]})]},Tt.id)}),e.length===0&&k.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",padding:24},children:"Nessun tipo definito. Crea il primo tipo per iniziare."})]})]}),k.jsx("hr",{style:{border:"none",borderTop:"1px solid var(--border-color)",margin:"24px 0"}}),k.jsxs("div",{children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[k.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:600},children:"Tipi Connessione"}),k.jsx("button",{className:"btn btn-primary",onClick:()=>de(!0),style:{padding:"6px 12px",fontSize:13},children:"+ Nuovo Tipo"})]}),ie&&k.jsx("div",{style:{background:"var(--bg-secondary)",padding:16,borderRadius:8,marginBottom:16,border:"1px solid var(--border-color)"},children:k.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-end"},children:[k.jsxs("div",{style:{flex:1},children:[k.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4,color:"var(--text-secondary)"},children:"Nome"}),k.jsx("input",{type:"text",className:"form-input",value:we,onChange:Tt=>rt(Tt.target.value),placeholder:"es: Fornisce",autoFocus:!0})]}),k.jsx("input",{type:"color",value:Ct,onChange:Tt=>Nt(Tt.target.value),style:{width:40,height:38,padding:0,border:"none",borderRadius:4}}),k.jsx("button",{className:"btn btn-primary",onClick:$i,disabled:wn||!we.trim(),children:"Crea"}),k.jsx("button",{className:"btn btn-secondary",onClick:()=>{de(!1),rt(""),Nt("#64748b")},children:"Annulla"})]})}),k.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[f.map(Tt=>k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"12px 16px",background:"var(--bg-secondary)",borderRadius:8,border:"1px solid var(--border-color)"},children:[k.jsx("div",{style:{width:40,height:4,background:Tt.colore,borderRadius:2}}),k.jsx("input",{type:"color",value:Tt.colore,onChange:kn=>{const nr={colore:kn.target.value};Kn.put(`/tipi-connessione/${Tt.id}`,nr),i(dt=>dt.map(Qn=>Qn.id===Tt.id?{...Qn,...nr}:Qn))},style:{width:24,height:24,padding:0,border:"none",borderRadius:4,cursor:"pointer"}}),k.jsx("span",{style:{flex:1,fontWeight:500},children:Tt.nome}),Tt.num_connessioni!==void 0&&k.jsxs("span",{style:{fontSize:11,color:"var(--text-secondary)"},children:[Tt.num_connessioni," connessioni"]}),k.jsx("button",{onClick:()=>Ws(Tt.id),style:{padding:"4px 8px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",border:"none",borderRadius:4,cursor:"pointer",fontSize:11},children:""})]},Tt.id)),f.length===0&&k.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",padding:24},children:"Nessun tipo connessione definito."})]})]})]})}function Tze({user:e,onClose:t,onUserUpdate:n}){var Tt,kn,nr;const[r,a]=B.useState("profilo"),l=B.useRef(null),[f,i]=B.useState(e.nome),[y,x]=B.useState(e.foto_url||""),[S,C]=B.useState(null),[P,L]=B.useState(!1),[F,U]=B.useState(!1),[q,G]=B.useState(null),[$,X]=B.useState(""),[ie,de]=B.useState(""),[fe,be]=B.useState(""),[ve,Je]=B.useState(!1),[we,rt]=B.useState(null),[He,ft]=B.useState([]),[Ct,Nt]=B.useState(!1),[Rt,en]=B.useState(null),[nt,pt]=B.useState(!1),[Oe,gn]=B.useState(!1),[wt,Fe]=B.useState(""),[jt,Tn]=B.useState(!1),[mn,zn]=B.useState(null),yn=e.ruolo_azienda==="admin",[qt,wn]=B.useState(null),[Sn,Xn]=B.useState(!1),[rn,br]=B.useState(!1),[Qr,sr]=B.useState(null),ar=e.codice_pairing?`${window.location.origin}/genagenta/register?codice=${e.codice_pairing}`:"",Vn=async()=>{try{await navigator.clipboard.writeText(ar),gn(!0),setTimeout(()=>gn(!1),2e3)}catch{const dt=document.createElement("textarea");dt.value=ar,document.body.appendChild(dt),dt.select(),document.execCommand("copy"),document.body.removeChild(dt),gn(!0),setTimeout(()=>gn(!1),2e3)}},wr=()=>{const dt=`Unisciti al team ${e.nome_azienda||"aziendale"} su GenAgenTa!

Clicca qui per registrarti:
${ar}

Oppure usa il codice: ${e.codice_pairing}`;window.open(`https://wa.me/?text=${encodeURIComponent(dt)}`,"_blank")},ys=async()=>{var dt,Qn;if(wt.trim()){Tn(!0),zn(null);try{const ti=await Kn.invitaCollega(wt.trim());zn({type:"success",text:ti.message}),Fe("")}catch(ti){zn({type:"error",text:((Qn=(dt=ti.response)==null?void 0:dt.data)==null?void 0:Qn.error)||"Errore invio invito"})}finally{Tn(!1)}}};B.useEffect(()=>{r==="team"&&e.azienda_id&&ks()},[r,e.azienda_id]),B.useEffect(()=>{r==="agea"&&Si()},[r]);const Si=async()=>{Xn(!0),sr(null);try{const dt=await Kn.getAgeaMemory();wn(dt.memory)}catch(dt){console.error("Errore caricamento memoria Agea:",dt),sr({type:"error",text:"Errore caricamento memoria"})}finally{Xn(!1)}},Ri=async()=>{if(confirm("Sei sicuro di voler cancellare la memoria di Agea? Non ricorder pi le conversazioni passate.")){br(!0),sr(null);try{await Kn.resetAgeaMemory(),sr({type:"success",text:"Memoria di Agea azzerata!"}),await Si()}catch(dt){console.error("Errore reset memoria:",dt),sr({type:"error",text:"Errore reset memoria"})}finally{br(!1)}}},ks=async()=>{Nt(!0);try{const dt=await Kn.getAziendaMembri();ft(dt.data)}catch(dt){console.error("Errore caricamento membri:",dt)}finally{Nt(!1)}},$i=async dt=>{var Zi,Is,Ln;const Qn=(Zi=dt.target.files)==null?void 0:Zi[0];if(!Qn)return;if(Qn.size>2*1024*1024){G({type:"error",text:"File troppo grande (max 2MB)"});return}if(!["image/jpeg","image/png","image/gif","image/webp"].includes(Qn.type)){G({type:"error",text:"Tipo file non permesso. Usa JPG, PNG, GIF o WebP"});return}const ti=new FileReader;ti.onload=Hn=>{var Ke;return C((Ke=Hn.target)==null?void 0:Ke.result)},ti.readAsDataURL(Qn),L(!0),G(null);try{const Hn=await Kn.uploadFoto(Qn);x(Hn.foto_url),C(null),n({foto_url:Hn.foto_url}),G({type:"success",text:"Foto caricata!"})}catch(Hn){G({type:"error",text:((Ln=(Is=Hn.response)==null?void 0:Is.data)==null?void 0:Ln.error)||"Errore caricamento foto"}),C(null)}finally{L(!1),l.current&&(l.current.value="")}},Ws=async()=>{var dt,Qn;U(!0),G(null);try{await Kn.updateProfile({nome:f}),n({nome:f}),G({type:"success",text:"Profilo aggiornato!"})}catch(ti){G({type:"error",text:((Qn=(dt=ti.response)==null?void 0:dt.data)==null?void 0:Qn.error)||"Errore aggiornamento profilo"})}finally{U(!1)}},Kt=async()=>{var dt,Qn;if(ie!==fe){rt({type:"error",text:"Le password non coincidono"});return}if(ie.length<6){rt({type:"error",text:"La password deve essere di almeno 6 caratteri"});return}Je(!0),rt(null);try{await Kn.changePassword({password_attuale:$,nuova_password:ie,conferma_password:fe}),rt({type:"success",text:"Password aggiornata!"}),X(""),de(""),be("")}catch(ti){rt({type:"error",text:((Qn=(dt=ti.response)==null?void 0:dt.data)==null?void 0:Qn.error)||"Errore cambio password"})}finally{Je(!1)}},An=async(dt,Qn)=>{var ti,Zi;if(confirm(`Sei sicuro di voler rimuovere ${Qn} dall'azienda?`)){en(dt);try{await Kn.removeAziendaMembro(dt),ft(He.filter(Is=>Is.id!==dt))}catch(Is){alert(((Zi=(ti=Is.response)==null?void 0:ti.data)==null?void 0:Zi.error)||"Errore rimozione membro")}finally{en(null)}}},Lr=dt=>dt.split(" ").map(Qn=>Qn[0]).join("").toUpperCase().slice(0,2);return k.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},onClick:dt=>dt.target===dt.currentTarget&&t(),children:k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"16px",width:"100%",maxWidth:"600px",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:[k.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[k.jsx("h2",{style:{fontSize:"18px",fontWeight:600},children:"Impostazioni"}),k.jsx("button",{onClick:t,style:{background:"transparent",border:"none",fontSize:"24px",cursor:"pointer",color:"var(--text-secondary)",lineHeight:1},children:""})]}),k.jsx("div",{style:{display:"flex",borderBottom:"1px solid var(--border-color)",padding:"0 24px"},children:[{id:"profilo",label:" Profilo"},{id:"categorie",label:" Entit"},{id:"prodotti",label:" Prodotti"},...e.azienda_id?[{id:"team",label:" Team"}]:[],{id:"agea",label:" Agea"},{id:"password",label:" Password"},{id:"info",label:" Info"}].map(dt=>k.jsx("button",{onClick:()=>a(dt.id),style:{padding:"12px 16px",background:"transparent",border:"none",borderBottom:r===dt.id?"2px solid var(--primary)":"2px solid transparent",color:r===dt.id?"var(--primary)":"var(--text-secondary)",cursor:"pointer",fontSize:"14px",fontWeight:500},children:dt.label},dt.id))}),k.jsxs("div",{style:{padding:"24px",overflowY:"auto",flex:1},children:[r==="profilo"&&k.jsxs("div",{children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"24px"},children:[k.jsxs("div",{style:{position:"relative"},children:[k.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:S||y?`url(${S||y}) center/cover`:"linear-gradient(135deg, var(--primary), #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",fontWeight:600,color:"white",opacity:P?.5:1},children:!(S||y)&&Lr(f)}),P&&k.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center"},children:k.jsx("div",{style:{fontSize:"12px"},children:"..."})})]}),k.jsxs("div",{children:[k.jsx("div",{style:{fontWeight:600,fontSize:"16px"},children:f}),k.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"13px",marginBottom:"8px"},children:e.email}),k.jsx("input",{ref:l,type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",onChange:$i,style:{display:"none"}}),k.jsx("button",{type:"button",onClick:()=>{var dt;return(dt=l.current)==null?void 0:dt.click()},disabled:P,style:{padding:"6px 12px",background:"var(--bg-primary)",border:"1px solid var(--border-color)",borderRadius:"6px",color:"var(--text-primary)",cursor:"pointer",fontSize:"12px"},children:P?"Caricamento...":"Cambia foto"})]})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Nome visualizzato"}),k.jsx("input",{type:"text",className:"form-input",value:f,onChange:dt=>i(dt.target.value),placeholder:"Il tuo nome"})]}),q&&k.jsx("div",{style:{padding:"12px",borderRadius:"8px",background:q.type==="success"?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:q.type==="success"?"#22c55e":"#ef4444",marginBottom:"16px"},children:q.text}),k.jsx("button",{className:"btn btn-primary",onClick:Ws,disabled:F||!f.trim(),style:{width:"100%"},children:F?"Salvataggio...":"Salva modifiche"})]}),r==="password"&&k.jsxs("div",{children:[k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Password attuale"}),k.jsx("input",{type:"password",className:"form-input",value:$,onChange:dt=>X(dt.target.value),placeholder:"Inserisci la password attuale"})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Nuova password"}),k.jsx("input",{type:"password",className:"form-input",value:ie,onChange:dt=>de(dt.target.value),placeholder:"Minimo 6 caratteri"})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Conferma nuova password"}),k.jsx("input",{type:"password",className:"form-input",value:fe,onChange:dt=>be(dt.target.value),placeholder:"Ripeti la nuova password"})]}),we&&k.jsx("div",{style:{padding:"12px",borderRadius:"8px",background:we.type==="success"?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:we.type==="success"?"#22c55e":"#ef4444",marginBottom:"16px"},children:we.text}),k.jsx("button",{className:"btn btn-primary",onClick:Kt,disabled:ve||!$||!ie||!fe,style:{width:"100%"},children:ve?"Aggiornamento...":"Cambia password"})]}),r==="team"&&k.jsxs("div",{children:[yn&&e.codice_pairing&&k.jsx("div",{style:{marginBottom:"24px"},children:k.jsxs("button",{className:"btn btn-primary",onClick:()=>pt(!0),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[k.jsx("span",{style:{fontSize:"18px"},children:"+"}),"Invita collega"]})}),nt&&k.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3},onClick:dt=>dt.target===dt.currentTarget&&pt(!1),children:k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"16px",padding:"24px",width:"90%",maxWidth:"400px"},children:[k.jsx("h3",{style:{marginBottom:"16px",fontSize:"18px",fontWeight:600},children:"Invita un collega"}),k.jsxs("div",{style:{marginBottom:"24px"},children:[k.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"14px",marginBottom:"12px"},children:"Inserisci l'email del collega. Quando aprir l'app vedr la richiesta di unirsi al team."}),k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("input",{type:"email",className:"form-input",value:wt,onChange:dt=>Fe(dt.target.value),placeholder:"email@collega.it",style:{flex:1}}),k.jsx("button",{className:"btn btn-primary",onClick:ys,disabled:jt||!wt.trim(),children:jt?"...":"Invita"})]}),mn&&k.jsx("div",{style:{marginTop:"8px",padding:"8px 12px",borderRadius:"6px",fontSize:"13px",background:mn.type==="success"?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:mn.type==="success"?"#22c55e":"#ef4444"},children:mn.text})]}),k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[k.jsx("div",{style:{flex:1,height:"1px",background:"var(--border-color)"}}),k.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:"oppure condividi"}),k.jsx("div",{style:{flex:1,height:"1px",background:"var(--border-color)"}})]}),k.jsxs("div",{style:{textAlign:"center",marginBottom:"16px"},children:[k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"4px"},children:"Codice team:"}),k.jsx("div",{style:{fontFamily:"monospace",fontSize:"20px",fontWeight:700,color:"var(--primary)",letterSpacing:"2px"},children:e.codice_pairing})]}),k.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:[k.jsx("button",{className:"btn btn-secondary",onClick:Vn,style:{flex:1},children:Oe?" Copiato!":"Copia link"}),k.jsx("button",{className:"btn btn-primary",onClick:wr,style:{flex:1,background:"#25D366"},children:"WhatsApp"})]}),k.jsx("button",{className:"btn btn-secondary",onClick:()=>{pt(!1),zn(null),Fe("")},style:{width:"100%"},children:"Chiudi"})]})}),k.jsxs("h3",{style:{fontSize:"14px",fontWeight:600,marginBottom:"16px"},children:["Membri del team (",He.length,")"]}),Ct?k.jsx("p",{style:{color:"var(--text-secondary)"},children:"Caricamento..."}):k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:He.map(dt=>k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",background:"var(--bg-primary)",borderRadius:"8px"},children:[k.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:dt.foto_url?`url(${dt.foto_url}) center/cover`:"linear-gradient(135deg, var(--primary), #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:600,color:"white",flexShrink:0},children:!dt.foto_url&&Lr(dt.nome)}),k.jsxs("div",{style:{flex:1,minWidth:0},children:[k.jsxs("div",{style:{fontWeight:500,display:"flex",alignItems:"center",gap:"8px"},children:[dt.nome,dt.is_me&&k.jsx("span",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:"(tu)"}),dt.ruolo_azienda==="admin"&&k.jsx("span",{style:{background:"var(--primary)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"10px"},children:"Admin"})]}),k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:dt.email})]}),yn&&!dt.is_me&&dt.ruolo_azienda!=="admin"&&k.jsx("button",{onClick:()=>An(dt.id,dt.nome),disabled:Rt===dt.id,style:{padding:"6px 12px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"12px"},children:Rt===dt.id?"...":"Rimuovi"})]},dt.id))})]}),r==="categorie"&&k.jsx(wze,{}),r==="prodotti"&&k.jsx(bze,{}),r==="agea"&&k.jsxs("div",{children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"24px",padding:"16px",background:"linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1))",borderRadius:"12px"},children:[k.jsx("div",{style:{width:"60px",height:"60px",borderRadius:"50%",background:"linear-gradient(135deg, #6366f1, #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"28px"},children:""}),k.jsxs("div",{children:[k.jsx("div",{style:{fontSize:"18px",fontWeight:600},children:"Agea"}),k.jsx("div",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:"La tua assistente AI personale"})]})]}),Qr&&k.jsx("div",{style:{padding:"12px",borderRadius:"8px",background:Qr.type==="success"?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:Qr.type==="success"?"#22c55e":"#ef4444",marginBottom:"16px"},children:Qr.text}),Sn?k.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",padding:"40px 0"},children:"Caricamento memoria..."}):qt?k.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[qt.ultimo_aggiornamento&&k.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:["Ultimo aggiornamento: ",new Date(qt.ultimo_aggiornamento).toLocaleString("it-IT")]}),k.jsxs("div",{style:{background:"var(--bg-primary)",borderRadius:"12px",padding:"16px"},children:[k.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("span",{children:""})," Argomenti recenti"]}),(kn=(Tt=qt.utente)==null?void 0:Tt.interessi_recenti)!=null&&kn.length?k.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:qt.utente.interessi_recenti.map((dt,Qn)=>k.jsx("span",{style:{padding:"4px 12px",background:"rgba(99, 102, 241, 0.1)",color:"var(--primary)",borderRadius:"20px",fontSize:"13px"},children:dt},Qn))}):k.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"13px",margin:0},children:"Nessun argomento memorizzato ancora"})]}),k.jsxs("div",{style:{background:"var(--bg-primary)",borderRadius:"12px",padding:"16px"},children:[k.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("span",{children:""})," Entit seguite"]}),qt.entita_importanti&&Object.keys(qt.entita_importanti).length>0?k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:Object.entries(qt.entita_importanti).slice(0,5).map(([dt,Qn])=>k.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",background:"var(--bg-secondary)",borderRadius:"8px"},children:[k.jsxs("div",{children:[k.jsx("div",{style:{fontWeight:500,fontSize:"13px"},children:Qn.nome}),Qn.note_agea&&k.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:Qn.note_agea})]}),Qn.volte_menzionata&&k.jsxs("span",{style:{fontSize:"11px",color:"var(--text-secondary)",background:"var(--bg-primary)",padding:"2px 8px",borderRadius:"10px"},children:[Qn.volte_menzionata,"x"]})]},dt))}):k.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"13px",margin:0},children:"Nessuna entit importante memorizzata"})]}),k.jsxs("div",{style:{background:"var(--bg-primary)",borderRadius:"12px",padding:"16px"},children:[k.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("span",{children:""})," Insights salvati"]}),(nr=qt.insights_salvati)!=null&&nr.length?k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:qt.insights_salvati.slice(0,3).map((dt,Qn)=>k.jsxs("div",{style:{padding:"10px 12px",background:"var(--bg-secondary)",borderRadius:"8px",borderLeft:"3px solid var(--primary)"},children:[k.jsx("div",{style:{fontSize:"13px"},children:dt.insight}),k.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)",marginTop:"4px"},children:[dt.entita&&k.jsxs("span",{children:[dt.entita,"  "]}),new Date(dt.data).toLocaleDateString("it-IT")]})]},Qn))}):k.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"13px",margin:0},children:"Nessun insight salvato ancora"})]}),k.jsxs("div",{style:{marginTop:"8px",paddingTop:"16px",borderTop:"1px solid var(--border-color)"},children:[k.jsx("button",{onClick:Ri,disabled:rn,style:{width:"100%",padding:"12px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.2)",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:500},children:rn?"Cancellazione...":" Cancella memoria di Agea"}),k.jsx("p",{style:{fontSize:"11px",color:"var(--text-secondary)",textAlign:"center",marginTop:"8px"},children:"Agea non ricorder pi le conversazioni passate"})]})]}):k.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",padding:"40px 0"},children:"Memoria non disponibile"})]}),r==="info"&&k.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",padding:"40px 20px",minHeight:"300px"},children:[k.jsx("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",background:"linear-gradient(135deg, var(--primary), #8b5cf6)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"GenAgenTa"}),k.jsx("div",{style:{fontSize:"13px",color:"var(--text-secondary)",marginBottom:"32px"},children:"v1.0.1"}),k.jsx("div",{style:{fontSize:"14px",color:"var(--text-primary)",marginBottom:"8px"},children:" 2025 Gennaro Colacioppo. All rights reserved."}),k.jsx("div",{style:{fontSize:"13px",color:"var(--text-secondary)",marginBottom:"24px"},children:"Interface Design Registered."}),k.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[k.jsx("a",{href:"https://www.gruppogea.net",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",textDecoration:"none",fontSize:"14px"},children:"www.gruppogea.net"}),k.jsx("a",{href:"mailto:infoph@gruppogea.net",style:{color:"var(--primary)",textDecoration:"none",fontSize:"14px"},children:"infoph@gruppogea.net"})]})]})]})]})})}function Eze({user:e,onLogout:t,onUserUpdate:n}){const[r,a]=B.useState(!1),[l,f]=B.useState(!1),[i,y]=B.useState(!1),[x,S]=B.useState(()=>localStorage.getItem("theme")||"dark"),C=B.useRef(null);B.useEffect(()=>{const q=G=>{C.current&&!C.current.contains(G.target)&&a(!1)};return document.addEventListener("mousedown",q),()=>document.removeEventListener("mousedown",q)},[]),B.useEffect(()=>{document.documentElement.setAttribute("data-theme",x),localStorage.setItem("theme",x)},[x]);const P=async()=>{e.codice_pairing&&(await navigator.clipboard.writeText(e.codice_pairing),f(!0),setTimeout(()=>f(!1),2e3))},L=()=>{S(q=>q==="dark"?"light":"dark")},F=e.nome.split(" ").map(q=>q[0]).join("").toUpperCase().slice(0,2),U=q=>({width:`${q}px`,height:`${q}px`,borderRadius:"50%",background:e.foto_url?`url(${e.foto_url}) center/cover`:"linear-gradient(135deg, var(--primary), #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${q*.375}px`,fontWeight:600,color:"white"});return k.jsxs(k.Fragment,{children:[k.jsxs("div",{ref:C,style:{position:"relative"},children:[k.jsxs("button",{onClick:()=>a(!r),style:{display:"flex",alignItems:"center",gap:"10px",padding:"6px 12px 6px 6px",background:r?"var(--bg-secondary)":"transparent",border:"1px solid var(--border-color)",borderRadius:"24px",color:"var(--text-primary)",cursor:"pointer",fontSize:"14px",transition:"all 0.2s"},onMouseEnter:q=>{r||(q.currentTarget.style.background="var(--bg-secondary)")},onMouseLeave:q=>{r||(q.currentTarget.style.background="transparent")},children:[k.jsx("div",{style:U(32),children:!e.foto_url&&F}),k.jsx("span",{style:{fontWeight:500},children:e.nome}),k.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",style:{transform:r?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},children:k.jsx("path",{d:"M2.5 4.5L6 8L9.5 4.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]}),r&&k.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",right:0,minWidth:"300px",background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"16px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",zIndex:1e3,overflow:"hidden"},children:[k.jsxs("div",{style:{padding:"20px",background:"linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1))",borderBottom:"1px solid var(--border-color)"},children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[k.jsx("div",{style:U(48),children:!e.foto_url&&F}),k.jsxs("div",{children:[k.jsx("div",{style:{fontWeight:600,fontSize:"15px"},children:e.nome}),k.jsx("div",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:e.email})]})]}),e.nome_azienda&&k.jsxs("div",{style:{marginTop:"12px",padding:"8px 12px",background:"var(--bg-primary)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("span",{style:{fontSize:"16px"},children:""}),k.jsx("span",{style:{fontSize:"13px",fontWeight:500},children:e.nome_azienda})]}),e.ruolo_azienda==="admin"&&k.jsx("span",{style:{background:"var(--primary)",color:"white",padding:"3px 8px",borderRadius:"4px",fontSize:"10px",fontWeight:600,textTransform:"uppercase"},children:"Admin"})]})]}),e.codice_pairing&&e.ruolo_azienda==="admin"&&k.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--border-color)"},children:[k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"8px",fontWeight:500},children:" Invita colleghi"}),k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("div",{style:{flex:1,padding:"10px 12px",background:"var(--bg-primary)",borderRadius:"8px",fontFamily:"monospace",fontSize:"15px",letterSpacing:"2px",color:"var(--primary)",fontWeight:600,textAlign:"center"},children:e.codice_pairing}),k.jsx("button",{onClick:P,style:{padding:"10px 14px",background:l?"#22c55e":"var(--primary)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"12px",fontWeight:600,transition:"all 0.2s",whiteSpace:"nowrap"},children:l?" Copiato!":"Copia"})]})]}),k.jsxs("div",{style:{padding:"8px"},children:[k.jsxs("button",{onClick:()=>{a(!1),y(!0)},style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",borderRadius:"8px",color:"var(--text-primary)",cursor:"pointer",fontSize:"14px",textAlign:"left",display:"flex",alignItems:"center",gap:"10px",transition:"background 0.2s"},onMouseEnter:q=>{q.currentTarget.style.background="var(--bg-hover)"},onMouseLeave:q=>{q.currentTarget.style.background="transparent"},children:[k.jsx("span",{style:{fontSize:"16px"},children:""}),k.jsx("span",{children:"Impostazioni"})]}),k.jsxs("button",{onClick:L,style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",borderRadius:"8px",color:"var(--text-primary)",cursor:"pointer",fontSize:"14px",textAlign:"left",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"background 0.2s"},onMouseEnter:q=>{q.currentTarget.style.background="var(--bg-hover)"},onMouseLeave:q=>{q.currentTarget.style.background="transparent"},children:[k.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[k.jsx("span",{style:{fontSize:"16px"},children:x==="dark"?"":""}),k.jsxs("span",{children:["Tema ",x==="dark"?"scuro":"chiaro"]})]}),k.jsx("div",{style:{width:"44px",height:"24px",background:x==="dark"?"var(--primary)":"#94a3b8",borderRadius:"12px",position:"relative",transition:"background 0.2s"},children:k.jsx("div",{style:{width:"20px",height:"20px",background:"white",borderRadius:"50%",position:"absolute",top:"2px",left:x==="dark"?"22px":"2px",transition:"left 0.2s"}})})]}),k.jsx("div",{style:{height:"1px",background:"var(--border-color)",margin:"8px 0"}}),k.jsxs("button",{onClick:()=>{a(!1),t()},style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",borderRadius:"8px",color:"#ef4444",cursor:"pointer",fontSize:"14px",textAlign:"left",display:"flex",alignItems:"center",gap:"10px",transition:"background 0.2s"},onMouseEnter:q=>{q.currentTarget.style.background="rgba(239, 68, 68, 0.1)"},onMouseLeave:q=>{q.currentTarget.style.background="transparent"},children:[k.jsx("span",{style:{fontSize:"16px"},children:""}),k.jsx("span",{children:"Esci"})]})]})]})]}),i&&k.jsx(Tze,{user:e,onClose:()=>y(!1),onUserUpdate:q=>{n==null||n(q)}})]})}function Sze({invito:e,onAccept:t,onDecline:n}){const[r,a]=B.useState(!1),[l,f]=B.useState(""),i=async()=>{var x,S;a(!0),f("");try{await Kn.accettaInvito(e.id),t()}catch(C){f(((S=(x=C.response)==null?void 0:x.data)==null?void 0:S.error)||"Errore durante l'accettazione"),a(!1)}},y=async()=>{a(!0);try{await Kn.rifiutaInvito(e.id),n()}catch{n()}};return k.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3},children:k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"16px",padding:"32px",width:"90%",maxWidth:"400px",textAlign:"center"},children:[k.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"50%",background:"linear-gradient(135deg, var(--primary), #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",fontSize:"28px"},children:""}),k.jsx("h2",{style:{fontSize:"20px",fontWeight:600,marginBottom:"12px"},children:"Hai ricevuto un invito!"}),k.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"15px",marginBottom:"8px"},children:[k.jsx("strong",{children:e.invitato_da})," ti ha invitato a unirti al team:"]}),k.jsx("div",{style:{background:"var(--bg-primary)",padding:"16px",borderRadius:"12px",marginBottom:"24px"},children:k.jsx("div",{style:{fontSize:"18px",fontWeight:600,color:"var(--primary)"},children:e.nome_azienda})}),l&&k.jsx("div",{style:{padding:"12px",borderRadius:"8px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",marginBottom:"16px",fontSize:"14px"},children:l}),k.jsxs("div",{style:{display:"flex",gap:"12px"},children:[k.jsx("button",{className:"btn btn-secondary",onClick:y,disabled:r,style:{flex:1},children:"Rifiuta"}),k.jsx("button",{className:"btn btn-primary",onClick:i,disabled:r,style:{flex:1},children:r?"Un momento...":"Accetta"})]})]})})}const uq={cerchio:"",quadrato:"",triangolo:"",stella:"",croce:"",L:"L",C:"C",W:"W",Z:"Z"};function Aze({neurone:e,categorie:t=[],onSave:n,onClose:r,onDelete:a,onRequestMapPick:l,pickedPosition:f,isPickingMap:i=!1,onPositionFound:y}){const x=!!e,[S,C]=B.useState(window.innerWidth<=768),[P,L]=B.useState(0),[F,U]=B.useState(!1),G=x?(()=>{if(e!=null&&e.categorie&&e.categorie.length>0&&t.length>0){const sn=e.categorie[0],bn=t.find(kr=>kr.nome.toLowerCase()===sn.toLowerCase());if(bn!=null&&bn.colore)return bn.colore}return{persona:"#3b82f6",impresa:"#22c55e",cantiere:"#f97316",ente:"#8b5cf6"}[(e==null?void 0:e.tipo)||""]||"#6366f1"})():"#6366f1",$=async()=>{if(P===0){L(1);return}if(P===1){L(2);return}U(!0);try{await(a==null?void 0:a())}catch(Ke){console.error("Errore eliminazione:",Ke),alert("Errore durante l'eliminazione")}finally{U(!1),L(0)}},X=()=>{L(0)},[ie,de]=B.useState([]),[fe,be]=B.useState([]),[ve,Je]=B.useState(!0),[we,rt]=B.useState(""),[He,ft]=B.useState(""),[Ct,Nt]=B.useState(""),[Rt,en]=B.useState(""),[nt,pt]=B.useState((e==null?void 0:e.nome)||""),[Oe,gn]=B.useState((e==null?void 0:e.indirizzo)||""),[wt,Fe]=B.useState((e==null?void 0:e.telefono)||""),[jt,Tn]=B.useState((e==null?void 0:e.email)||""),[mn,zn]=B.useState((e==null?void 0:e.visibilita)||"aziendale"),[yn,qt]=B.useState(!1),[wn,Sn]=B.useState(""),[Xn,rn]=B.useState(!1),[br,Qr]=B.useState(!1),[sr,ar]=B.useState((e==null?void 0:e.lat)!=null?Number(e.lat):null),[Vn,wr]=B.useState((e==null?void 0:e.lng)!=null?Number(e.lng):null),[ys,Si]=B.useState((e==null?void 0:e.dimensione)!=null?String(e.dimensione):""),[Ri,ks]=B.useState([]),[$i,Ws]=B.useState(!1),Kt=(e==null?void 0:e.dati_extra)||{},[An,Lr]=B.useState(Object.fromEntries(Object.entries(Kt).map(([Ke,sn])=>[Ke,sn!=null?String(sn):""])));B.useEffect(()=>{if(e){pt(e.nome||""),gn(e.indirizzo||""),Fe(e.telefono||""),Tn(e.email||""),zn(e.visibilita||"aziendale"),ar(e.lat!=null?Number(e.lat):null),wr(e.lng!=null?Number(e.lng):null),Si(e.dimensione!=null?String(e.dimensione):"");const Ke=e.dati_extra||{};if(Lr(Object.fromEntries(Object.entries(Ke).map(([sn,bn])=>[sn,bn!=null?String(bn):""]))),L(0),Sn(""),ie.length>0){const sn=ie.find(bn=>{var kr;return bn.nome.toLowerCase()===((kr=e.tipo)==null?void 0:kr.toLowerCase())});if(sn){rt(sn.id),Nt(sn.id);const bn=fe.find(kr=>{var In;return kr.tipo_id===sn.id&&((In=e.categorie)==null?void 0:In.includes(kr.nome.toLowerCase()))});bn?(ft(bn.id),en(bn.id)):(ft(""),en(""))}}}},[e==null?void 0:e.id]),B.useEffect(()=>{Tt()},[]);const Tt=async()=>{Je(!0);try{const[Ke,sn]=await Promise.all([Kn.get("/tipi"),Kn.get("/tipologie")]),bn=Ke.data.data.map(In=>({id:In.id,nome:In.nome,forma:In.forma,ordine:In.ordine})),kr=sn.data.data.map(In=>({id:In.id,tipo_id:In.tipo_id,nome:In.nome,colore:In.colore,ordine:In.ordine}));if(de(bn),be(kr),e){const In=bn.find(Ki=>{var Ta;return Ki.nome.toLowerCase()===((Ta=e.tipo)==null?void 0:Ta.toLowerCase())});if(In){rt(In.id),Nt(In.id);const Ki=kr.find(Ta=>{var Ns;return Ta.tipo_id===In.id&&((Ns=e.categorie)==null?void 0:Ns.includes(Ta.nome.toLowerCase()))});Ki&&(ft(Ki.id),en(Ki.id))}}else bn.length>0&&rt(bn[0].id)}catch(Ke){console.error("Errore caricamento tipi:",Ke),Sn("Errore caricamento tipi. Vai in Impostazioni  Categorie per crearli.")}finally{Je(!1)}},kn=fe.filter(Ke=>Ke.tipo_id===we),nr=ie.find(Ke=>Ke.id===we);B.useEffect(()=>{if(!we){ks([]);return}(async()=>{Ws(!0);try{const sn=await Kn.get(`/campi?tipo=${we}`);ks(sn.data.data||[])}catch(sn){console.error("Errore caricamento campi:",sn),ks([])}finally{Ws(!1)}})()},[we]);const dt=(Ke,sn)=>{Lr(bn=>({...bn,[Ke]:sn}))},Qn=Ke=>{if(!x||Ke===Ct){rt(Ke),ft("");return}window.confirm("Attenzione: stai cambiando il tipo dell'entit. Questo potrebbe influenzare la visualizzazione sulla mappa e i campi personalizzati. Vuoi procedere?")&&(rt(Ke),ft(""))},ti=Ke=>{if(!x||Ke===Rt){ft(Ke);return}window.confirm("Attenzione: stai cambiando la categoria dell'entit. Questo potrebbe influenzare il colore e il raggruppamento. Vuoi procedere?")&&ft(Ke)};B.useEffect(()=>{const Ke=()=>C(window.innerWidth<=768);return window.addEventListener("resize",Ke),()=>window.removeEventListener("resize",Ke)},[]),B.useEffect(()=>{f&&(ar(f.lat),wr(f.lng),fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${f.lat}&lon=${f.lng}`).then(Ke=>Ke.json()).then(Ke=>{Ke.display_name&&gn(Ke.display_name)}).catch(()=>{}))},[f]);const Zi=async()=>{if(Oe.trim()){rn(!0),Sn("");try{const sn=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(Oe)}&limit=1`)).json();if(sn.length>0){const bn=parseFloat(sn[0].lat),kr=parseFloat(sn[0].lon);ar(bn),wr(kr),gn(sn[0].display_name),y==null||y(bn,kr)}else Sn("Indirizzo non trovato")}catch{Sn("Errore ricerca indirizzo")}finally{rn(!1)}}},Is=()=>{if(!navigator.geolocation){Sn("GPS non supportato");return}Qr(!0),Sn(""),navigator.geolocation.getCurrentPosition(async Ke=>{const sn=Ke.coords.latitude,bn=Ke.coords.longitude;ar(sn),wr(bn),y==null||y(sn,bn);try{const In=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${sn}&lon=${bn}`)).json();In.display_name&&gn(In.display_name)}catch{}Qr(!1)},Ke=>{Sn("Errore GPS: "+Ke.message),Qr(!1)},{enableHighAccuracy:!0,timeout:1e4})},Ln=async()=>{var kr,In,Ki,Ta;if(Sn(""),!nt.trim()){Sn("Il nome  obbligatorio");return}if(!we){Sn("Seleziona un tipo");return}if(!He){Sn("Seleziona una categoria");return}const Ke=((kr=ie.find(Ns=>Ns.id===we))==null?void 0:kr.nome)||"",sn=((In=fe.find(Ns=>Ns.id===He))==null?void 0:In.nome)||"";let bn=null;if(Ri.length>0){bn={};for(const Ns of Ri){const Ht=An[Ns.nome];Ht!==void 0&&Ht!==""&&(Ns.tipo_dato==="numero"?bn[Ns.nome]=parseFloat(Ht)||null:bn[Ns.nome]=Ht)}Object.keys(bn).length===0&&(bn=null)}qt(!0);try{const Ns={nome:nt.trim(),tipo:Ke,categorie:[sn],visibilita:mn,indirizzo:Oe||null,lat:sr||null,lng:Vn||null,telefono:wt||null,email:jt||null,dimensione:ys?parseFloat(ys):null,dati_extra:bn};if(x&&e)await Kn.updateNeurone(e.id,Ns),n({...e,...Ns});else{const Ht=await Kn.createNeurone(Ns);n({id:Ht.id,...Ns})}}catch(Ns){Sn(((Ta=(Ki=Ns.response)==null?void 0:Ki.data)==null?void 0:Ta.error)||"Errore salvataggio")}finally{qt(!1)}},Hn=(Ke,sn=!1)=>{const bn=An[Ke.nome]||"",kr=sn?{fontSize:"12px",padding:"6px 8px"}:{};switch(Ke.tipo_dato){case"textarea":return k.jsx("textarea",{className:"form-input",value:bn,onChange:In=>dt(Ke.nome,In.target.value),placeholder:Ke.etichetta,rows:3,style:{...kr,resize:"vertical"}});case"numero":return k.jsx("input",{type:"number",className:"form-input",value:bn,onChange:In=>dt(Ke.nome,In.target.value),placeholder:Ke.etichetta,style:kr});case"data":return k.jsx("input",{type:"date",className:"form-input",value:bn,onChange:In=>dt(Ke.nome,In.target.value),style:kr});case"email":return k.jsx("input",{type:"email",className:"form-input",value:bn,onChange:In=>dt(Ke.nome,In.target.value),placeholder:Ke.etichetta,style:kr});case"telefono":return k.jsx("input",{type:"tel",className:"form-input",value:bn,onChange:In=>dt(Ke.nome,In.target.value),placeholder:Ke.etichetta,style:kr});case"url":return k.jsx("input",{type:"url",className:"form-input",value:bn,onChange:In=>dt(Ke.nome,In.target.value),placeholder:Ke.etichetta,style:kr});case"select":return k.jsxs("select",{className:"form-input",value:bn,onChange:In=>dt(Ke.nome,In.target.value),style:kr,children:[k.jsx("option",{value:"",children:"Seleziona..."}),(Ke.opzioni||[]).map(In=>k.jsx("option",{value:In,children:In},In))]});default:return k.jsx("input",{type:"text",className:"form-input",value:bn,onChange:In=>dt(Ke.nome,In.target.value),placeholder:Ke.etichetta,style:kr})}};return i?k.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,background:"var(--primary)",color:"white",padding:"12px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",zIndex:2e3,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:[k.jsx("span",{style:{fontWeight:600},children:"Tocca la mappa per selezionare la posizione"}),k.jsx("button",{onClick:r,style:{background:"rgba(255,255,255,0.2)",border:"none",color:"white",padding:"6px 12px",borderRadius:"6px",cursor:"pointer",fontSize:"13px"},children:"Annulla"})]}):!ve&&ie.length===0?k.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},onClick:r,children:k.jsxs("div",{style:{background:"var(--bg-secondary)",padding:"24px",borderRadius:"12px",maxWidth:"400px",textAlign:"center"},onClick:Ke=>Ke.stopPropagation(),children:[k.jsx("h3",{style:{marginBottom:"12px"},children:"Configura prima le entit"}),k.jsxs("p",{style:{color:"var(--text-secondary)",marginBottom:"16px"},children:["Per creare entit devi prima definire almeno un tipo e una tipologia. Vai in ",k.jsx("strong",{children:"Impostazioni  Entit"})," per configurarli."]}),k.jsx("button",{className:"btn btn-primary",onClick:r,children:"Ho capito"})]})}):S?k.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:2e3,display:"flex",flexDirection:"column"},children:[k.jsxs("div",{style:{background:"var(--bg-secondary)",maxHeight:"60vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 4px 20px rgba(0,0,0,0.3)",borderRadius:"0 0 12px 12px"},children:[k.jsxs("div",{style:{padding:"10px 14px",borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0,background:x?`linear-gradient(135deg, ${G}20 0%, ${G}05 100%)`:void 0,borderLeft:x?`4px solid ${G}`:void 0},children:[k.jsxs("h2",{style:{fontSize:"15px",fontWeight:600,margin:0,color:x?G:void 0},children:[x?"Modifica":"Nuovo"," ",nr?nr.nome:"Neurone"]}),k.jsx("button",{onClick:r,style:{background:"transparent",border:"none",fontSize:"18px",cursor:"pointer",color:x?G:"var(--text-secondary)",padding:"2px 6px"},children:""})]}),ve?k.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:"Caricamento..."}):k.jsxs(k.Fragment,{children:[k.jsxs("div",{style:{padding:"10px 14px",overflowY:"auto",flex:1},children:[k.jsxs("div",{style:{marginBottom:"10px"},children:[k.jsx("label",{style:{fontSize:"11px",color:"var(--text-secondary)",marginBottom:"4px",display:"block"},children:"Tipo"}),k.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:ie.map(Ke=>k.jsxs("button",{type:"button",onClick:()=>Qn(Ke.id),style:{padding:"6px 10px",border:"none",borderRadius:"6px",fontSize:"12px",fontWeight:we===Ke.id?600:400,cursor:"pointer",background:we===Ke.id?"var(--primary)":"var(--bg-primary)",color:we===Ke.id?"white":"var(--text-primary)",display:"flex",alignItems:"center",gap:"4px"},children:[k.jsx("span",{children:uq[Ke.forma]})," ",Ke.nome]},Ke.id))})]}),we&&k.jsxs("div",{style:{marginBottom:"10px"},children:[k.jsx("label",{style:{fontSize:"11px",color:"var(--text-secondary)",marginBottom:"4px",display:"block"},children:"Categoria"}),kn.length===0?k.jsx("p",{style:{fontSize:"11px",color:"#f59e0b"},children:"Nessuna categoria per questo tipo. Creala in Impostazioni."}):k.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:kn.map(Ke=>k.jsx("button",{type:"button",onClick:()=>ti(Ke.id),style:{padding:"4px 8px",borderRadius:"8px",border:He===Ke.id?"2px solid white":"none",boxShadow:He===Ke.id?"0 0 0 2px var(--primary)":"none",fontSize:"11px",cursor:"pointer",background:Ke.colore,color:"white",fontWeight:500},children:Ke.nome},Ke.id))})]}),k.jsx("input",{type:"text",className:"form-input",value:nt,onChange:Ke=>pt(Ke.target.value),placeholder:"Nome *",style:{fontSize:"13px",marginBottom:"8px",padding:"8px 10px"}}),k.jsxs("div",{style:{display:"flex",gap:"4px",marginBottom:"8px"},children:[k.jsx("input",{type:"text",className:"form-input",value:Oe,onChange:Ke=>{gn(Ke.target.value),ar(null),wr(null)},placeholder:"Indirizzo...",style:{flex:1,fontSize:"12px",padding:"6px 8px"}}),k.jsx("button",{type:"button",onClick:Zi,disabled:Xn||!Oe.trim(),style:{padding:"6px 8px",border:"none",borderRadius:"6px",background:"var(--bg-primary)",cursor:"pointer",fontSize:"12px"},children:Xn?"...":""})]}),k.jsxs("div",{style:{display:"flex",gap:"4px",marginBottom:"8px"},children:[k.jsx("button",{type:"button",onClick:Is,disabled:br,style:{flex:1,padding:"6px",border:"none",borderRadius:"6px",background:"var(--bg-primary)",cursor:"pointer",fontSize:"11px"},children:br?"...":" GPS"}),l&&k.jsx("button",{type:"button",onClick:l,style:{flex:1,padding:"6px",border:"none",borderRadius:"6px",background:"var(--primary)",color:"white",cursor:"pointer",fontSize:"11px",fontWeight:600},children:" Mappa"})]}),sr!=null&&Vn!=null&&k.jsxs("div",{style:{fontSize:"10px",color:"var(--text-secondary)",marginBottom:"6px"},children:[" ",Number(sr).toFixed(4),", ",Number(Vn).toFixed(4)]}),k.jsxs("div",{style:{display:"flex",gap:"4px",marginBottom:"8px"},children:[k.jsx("input",{type:"tel",className:"form-input",value:wt,onChange:Ke=>Fe(Ke.target.value),placeholder:"Telefono",style:{flex:1,fontSize:"12px",padding:"6px 8px"}}),k.jsx("input",{type:"email",className:"form-input",value:jt,onChange:Ke=>Tn(Ke.target.value),placeholder:"Email",style:{flex:1,fontSize:"12px",padding:"6px 8px"}})]}),k.jsxs("div",{style:{display:"flex",gap:"10px",fontSize:"11px",marginBottom:"6px"},children:[k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"3px",cursor:"pointer"},children:[k.jsx("input",{type:"radio",name:"visibilita",checked:mn==="aziendale",onChange:()=>zn("aziendale")})," Aziendale"]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"3px",cursor:"pointer"},children:[k.jsx("input",{type:"radio",name:"visibilita",checked:mn==="personale",onChange:()=>zn("personale")})," Personale"]})]}),k.jsxs("div",{style:{marginBottom:"8px"},children:[k.jsx("label",{style:{fontSize:"10px",color:"var(--text-secondary)"},children:"Dimensione (m)"}),k.jsx("input",{type:"number",className:"form-input",value:ys,onChange:Ke=>Si(Ke.target.value),placeholder:"Auto",min:"10",max:"200",step:"5",style:{fontSize:"12px",padding:"6px 8px"}})]}),Ri.length>0&&k.jsxs("div",{style:{marginTop:"10px",padding:"10px",background:"var(--bg-primary)",borderRadius:"8px"},children:[k.jsxs("label",{style:{fontSize:"11px",color:"var(--text-secondary)",marginBottom:"6px",display:"block",fontWeight:500},children:["Dettagli ",(nr==null?void 0:nr.nome)||"entit"]}),$i?k.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:"Caricamento..."}):k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:Ri.map(Ke=>k.jsxs("div",{children:[k.jsxs("label",{style:{fontSize:"10px",color:"var(--text-secondary)"},children:[Ke.etichetta,Ke.obbligatorio&&" *"]}),Hn(Ke,!0)]},Ke.id))})]}),wn&&k.jsx("div",{style:{padding:"6px",borderRadius:"4px",background:"rgba(239,68,68,0.1)",color:"#ef4444",fontSize:"11px"},children:wn}),x&&a&&k.jsxs("div",{style:{marginTop:"16px",paddingTop:"12px",borderTop:"1px dashed var(--border-color)"},children:[P>0&&k.jsx("div",{style:{padding:"8px",marginBottom:"8px",background:P===1?"#fef3c7":"#fee2e2",borderRadius:"6px",fontSize:"11px",color:P===1?"#92400e":"#b91c1c"},children:P===1?k.jsxs(k.Fragment,{children:[k.jsx("strong",{children:"Attenzione!"}),' Stai per eliminare "',e==null?void 0:e.nome,'". Clicca di nuovo per confermare.']}):k.jsxs(k.Fragment,{children:[k.jsx("strong",{children:"ULTIMA CONFERMA!"})," L'eliminazione  irreversibile."]})}),k.jsxs("div",{style:{display:"flex",gap:"6px"},children:[k.jsx("button",{onClick:$,disabled:F,style:{flex:1,padding:"8px",border:P>0?"none":"1px solid #ef4444",borderRadius:"6px",background:P>0?"#ef4444":"transparent",color:P>0?"white":"#ef4444",cursor:"pointer",fontSize:"12px",fontWeight:500},children:F?"...":P===0?" Elimina":P===1?"Conferma?":"ELIMINA!"}),P>0&&k.jsx("button",{onClick:X,style:{padding:"8px 12px",border:"1px solid var(--border-color)",borderRadius:"6px",background:"transparent",cursor:"pointer",fontSize:"12px"},children:"Annulla"})]})]})]}),k.jsxs("div",{style:{padding:"10px 14px",borderTop:"1px solid var(--border-color)",display:"flex",gap:"6px",flexShrink:0},children:[k.jsx("button",{onClick:r,style:{flex:1,padding:"8px",border:"1px solid var(--border-color)",borderRadius:"6px",background:"transparent",cursor:"pointer",fontSize:"13px"},children:"Annulla"}),k.jsx("button",{onClick:Ln,disabled:yn,style:{flex:1,padding:"8px",border:"none",borderRadius:"6px",background:x?G:"var(--primary)",color:"white",cursor:"pointer",fontSize:"13px",fontWeight:600},children:yn?"...":"Salva"})]})]})]}),k.jsx("div",{style:{flex:1,background:"rgba(0,0,0,0.3)"},onClick:r})]}):k.jsxs("div",{style:{position:"fixed",top:0,left:"280px",bottom:0,width:"380px",background:"var(--bg-secondary)",boxShadow:"4px 0 20px rgba(0,0,0,0.15)",zIndex:1500,display:"flex",flexDirection:"column",animation:"slideInLeft 0.3s ease-out"},children:[k.jsx("style",{children:`
        @keyframes slideInLeft {
          from { transform: translateX(-100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
      `}),k.jsxs("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:[k.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"space-between",background:x?`linear-gradient(135deg, ${G}20 0%, ${G}05 100%)`:void 0,borderLeft:x?`4px solid ${G}`:void 0},children:[k.jsxs("h2",{style:{fontSize:"18px",fontWeight:600,margin:0,color:x?G:void 0},children:[x?"Modifica":"Nuovo"," ",nr?nr.nome:"Neurone"]}),k.jsx("button",{onClick:r,style:{background:"transparent",border:"none",fontSize:"22px",cursor:"pointer",color:x?G:"var(--text-secondary)",padding:"4px 8px"},children:""})]}),ve?k.jsx("div",{style:{padding:"40px",textAlign:"center",color:"var(--text-secondary)"},children:"Caricamento tipi..."}):k.jsxs(k.Fragment,{children:[k.jsxs("div",{style:{padding:"20px",overflowY:"auto",flex:1},children:[k.jsxs("div",{style:{marginBottom:"16px"},children:[k.jsx("label",{style:{fontSize:"13px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:"Tipo *"}),k.jsx("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:ie.map(Ke=>k.jsxs("button",{type:"button",onClick:()=>Qn(Ke.id),style:{padding:"10px 16px",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:we===Ke.id?600:400,cursor:"pointer",background:we===Ke.id?"var(--primary)":"var(--bg-primary)",color:we===Ke.id?"white":"var(--text-primary)",display:"flex",alignItems:"center",gap:"6px"},children:[k.jsx("span",{style:{fontSize:"18px"},children:uq[Ke.forma]})," ",Ke.nome]},Ke.id))})]}),we&&k.jsxs("div",{style:{marginBottom:"16px"},children:[k.jsx("label",{style:{fontSize:"13px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:"Categoria *"}),kn.length===0?k.jsx("p",{style:{fontSize:"13px",color:"#f59e0b",padding:"12px",background:"rgba(245, 158, 11, 0.1)",borderRadius:"8px"},children:"Nessuna categoria per questo tipo. Vai in Impostazioni  Categorie per crearne."}):k.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:kn.map(Ke=>k.jsx("button",{type:"button",onClick:()=>ti(Ke.id),style:{padding:"8px 14px",borderRadius:"10px",border:He===Ke.id?"2px solid white":"2px solid transparent",boxShadow:He===Ke.id?"0 0 0 2px var(--primary)":"none",fontSize:"13px",cursor:"pointer",background:Ke.colore,color:"white",fontWeight:500},children:Ke.nome},Ke.id))})]}),k.jsxs("div",{style:{marginBottom:"16px"},children:[k.jsx("label",{style:{fontSize:"13px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:"Nome *"}),k.jsx("input",{type:"text",className:"form-input",value:nt,onChange:Ke=>pt(Ke.target.value),placeholder:"Inserisci nome..."})]}),k.jsxs("div",{style:{marginBottom:"16px"},children:[k.jsx("label",{style:{fontSize:"13px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:"Posizione"}),k.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[k.jsx("input",{type:"text",className:"form-input",value:Oe,onChange:Ke=>{gn(Ke.target.value),ar(null),wr(null)},placeholder:"Via Roma 1, Milano",style:{flex:1}}),k.jsx("button",{type:"button",onClick:Zi,disabled:Xn||!Oe.trim(),style:{padding:"8px 12px",border:"none",borderRadius:"8px",background:"var(--bg-primary)",cursor:"pointer"},children:Xn?"...":""})]}),k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("button",{type:"button",onClick:Is,disabled:br,style:{flex:1,padding:"10px",border:"none",borderRadius:"8px",background:"var(--bg-primary)",cursor:"pointer",fontSize:"13px"},children:br?"Localizzazione...":" Posizione GPS"}),l&&k.jsx("button",{type:"button",onClick:l,style:{flex:1,padding:"10px",border:"none",borderRadius:"8px",background:"var(--primary)",color:"white",cursor:"pointer",fontSize:"13px",fontWeight:600},children:" Scegli su mappa"})]}),sr!=null&&Vn!=null&&k.jsxs("div",{style:{marginTop:"8px",fontSize:"12px",color:"var(--text-secondary)"},children:["Coordinate: ",Number(sr).toFixed(5),", ",Number(Vn).toFixed(5)]})]}),k.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginBottom:"16px"},children:[k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"13px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:"Telefono"}),k.jsx("input",{type:"tel",className:"form-input",value:wt,onChange:Ke=>Fe(Ke.target.value),placeholder:"+39 333 1234567"})]}),k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"13px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:"Email"}),k.jsx("input",{type:"email",className:"form-input",value:jt,onChange:Ke=>Tn(Ke.target.value),placeholder:"email@esempio.it"})]})]}),k.jsxs("div",{style:{marginBottom:"16px"},children:[k.jsx("label",{style:{fontSize:"13px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:"Visibilit"}),k.jsxs("div",{style:{display:"flex",gap:"16px"},children:[k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",fontSize:"14px"},children:[k.jsx("input",{type:"radio",name:"visibilita-desktop",checked:mn==="aziendale",onChange:()=>zn("aziendale")})," Aziendale (visibile ai colleghi)"]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",fontSize:"14px"},children:[k.jsx("input",{type:"radio",name:"visibilita-desktop",checked:mn==="personale",onChange:()=>zn("personale")})," Personale (solo tu)"]})]})]}),k.jsxs("div",{style:{marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("label",{style:{fontSize:"13px",color:"var(--text-secondary)",whiteSpace:"nowrap"},children:"Dimensione (m)"}),k.jsx("input",{type:"number",className:"form-input",value:ys,onChange:Ke=>Si(Ke.target.value),placeholder:"50",min:"10",max:"200",step:"10",style:{width:"80px"}}),k.jsx("span",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:"10-200"})]}),Ri.length>0&&k.jsxs("div",{style:{marginBottom:"12px",padding:"10px",background:"var(--bg-primary)",borderRadius:"6px"},children:[k.jsxs("label",{style:{fontSize:"12px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:["Dettagli ",(nr==null?void 0:nr.nome)||""]}),$i?k.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:"Caricamento..."}):k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:Ri.map(Ke=>k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[k.jsxs("label",{style:{fontSize:"11px",color:"var(--text-secondary)",width:"100px",flexShrink:0},children:[Ke.etichetta,Ke.obbligatorio&&"*"]}),k.jsx("div",{style:{flex:1},children:Hn(Ke)})]},Ke.id))})]}),wn&&k.jsx("div",{style:{padding:"10px",borderRadius:"8px",background:"rgba(239,68,68,0.1)",color:"#ef4444",fontSize:"13px"},children:wn}),x&&a&&k.jsxs("div",{style:{marginTop:"24px",paddingTop:"16px",borderTop:"1px dashed var(--border-color)"},children:[P>0&&k.jsx("div",{style:{padding:"12px",marginBottom:"12px",background:P===1?"#fef3c7":"#fee2e2",borderRadius:"8px",fontSize:"13px",color:P===1?"#92400e":"#b91c1c"},children:P===1?k.jsxs(k.Fragment,{children:[k.jsx("strong",{children:"Attenzione!"}),' Stai per eliminare "',e==null?void 0:e.nome,'". Clicca di nuovo per confermare.']}):k.jsxs(k.Fragment,{children:[k.jsx("strong",{children:"ULTIMA CONFERMA!"})," L'eliminazione  irreversibile."]})}),k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("button",{onClick:$,disabled:F,style:{padding:"10px 16px",border:P>0?"none":"1px solid #ef4444",borderRadius:"8px",background:P>0?"#ef4444":"transparent",color:P>0?"white":"#ef4444",cursor:"pointer",fontSize:"13px",fontWeight:500},children:F?"Eliminazione...":P===0?" Elimina entit":P===1?"Conferma?":"ELIMINA!"}),P>0&&k.jsx("button",{onClick:X,style:{padding:"10px 16px",border:"1px solid var(--border-color)",borderRadius:"8px",background:"transparent",cursor:"pointer",fontSize:"13px"},children:"Annulla"})]})]})]}),k.jsxs("div",{style:{padding:"16px 20px",borderTop:"1px solid var(--border-color)",display:"flex",gap:"12px"},children:[k.jsx("button",{onClick:r,style:{flex:1,padding:"12px",border:"1px solid var(--border-color)",borderRadius:"8px",background:"transparent",cursor:"pointer",fontSize:"14px"},children:"Annulla"}),k.jsx("button",{onClick:Ln,disabled:yn,style:{flex:1,padding:"12px",border:"none",borderRadius:"8px",background:x?G:"var(--primary)",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:600},children:yn?"Salvataggio...":"Salva"})]})]})]})]})}function i2({value:e,onChange:t,label:n,disabled:r=!1}){const[a,l]=B.useState(0);return k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[k.jsx("span",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:n}),k.jsx("div",{style:{display:"flex",gap:"2px"},children:[1,2,3,4,5].map(f=>k.jsx("button",{type:"button",disabled:r,onClick:()=>t(e===f?0:f),onMouseEnter:()=>l(f),onMouseLeave:()=>l(0),style:{background:"none",border:"none",cursor:r?"default":"pointer",fontSize:"18px",color:f<=(a||e)?"#f59e0b":"#d1d5db",transition:"color 0.15s",padding:"0 1px"},children:""},f))})]})}const cq=[{value:"commerciale",label:"Commerciale",icon:""},{value:"fornisce",label:"Fornisce",icon:""},{value:"influencer",label:"Influencer",icon:""},{value:"prescrittore",label:"Prescrittore",icon:""},{value:"tecnico",label:"Tecnico",icon:""},{value:"partner",label:"Partner",icon:""},{value:"collabora",label:"Collabora",icon:""}];function Cze({sinapsiId:e,onClose:t,onSaved:n}){const{data:r,isLoading:a}=zNe(e),{invalidateSinapsiById:l,invalidateSinapsi:f}=wE(),[i,y]=B.useState(!1),[x,S]=B.useState(""),[C,P]=B.useState([]),[L,F]=B.useState("ipotesi"),[U,q]=B.useState(0),[G,$]=B.useState(0),[X,ie]=B.useState(0),[de,fe]=B.useState(0),[be,ve]=B.useState(0),[Je,we]=B.useState(""),rt=(r==null?void 0:r.dati_oggettivi)||null;B.useEffect(()=>{if(r){const pt=Array.isArray(r.tipo_connessione)?r.tipo_connessione:[];P(pt),F(r.certezza||"ipotesi"),q(r.influenza||0),$(r.qualita_relazione||0),ie(r.importanza_strategica||0),fe(r.affidabilita||0),ve(r.potenziale||0),we(r.note_relazione||"")}},[r]);const He=async()=>{y(!0),S("");try{await Kn.updateSinapsi(e,{tipo_connessione:C.length>0?C:void 0,certezza:L,influenza:U||void 0,qualita_relazione:G||void 0,importanza_strategica:X||void 0,affidabilita:de||void 0,potenziale:be||void 0,note_relazione:Je||void 0}),l(e),f(),n==null||n(),t()}catch(pt){console.error("Errore salvataggio:",pt),S("Errore salvataggio"),y(!1)}},ft=()=>C.length>0?C.map(pt=>pt.charAt(0).toUpperCase()+pt.slice(1)).join(", "):"Connessione",Ct=()=>{if(C.length===0)return"";const pt=C[0].toLowerCase(),Oe=cq.find(gn=>gn.value===pt);return(Oe==null?void 0:Oe.icon)||""},Nt=()=>{switch(L){case"certo":return{color:"#22c55e",label:"Certo"};case"probabile":return{color:"#eab308",label:"Probabile"};default:return{color:"#94a3b8",label:"Ipotetico"}}},Rt=pt=>{C.includes(pt)?P(C.filter(Oe=>Oe!==pt)):P([...C,pt])};if(a)return k.jsx("div",{className:"detail-panel",children:k.jsx("div",{style:{padding:"40px",textAlign:"center",color:"var(--text-secondary)"},children:"Caricamento..."})});if(!r)return k.jsx("div",{className:"detail-panel",children:k.jsxs("div",{style:{padding:"20px"},children:[k.jsx("button",{onClick:t,style:{float:"right",background:"none",border:"none",fontSize:"24px",cursor:"pointer"},children:""}),k.jsx("p",{style:{color:"var(--text-secondary)"},children:"Connessione non trovata"})]})});const en=Nt(),nt=(pt,Oe)=>{const gn=parseInt(pt.slice(1,3),16),wt=parseInt(pt.slice(3,5),16),Fe=parseInt(pt.slice(5,7),16);return`rgba(${gn}, ${wt}, ${Fe}, ${Oe})`};return k.jsxs("div",{className:"detail-panel",children:[k.jsx("div",{style:{padding:"16px",borderBottom:"1px solid var(--border-color)",background:`linear-gradient(135deg, ${nt(en.color,.15)} 0%, ${nt(en.color,.02)} 100%)`,borderLeft:`4px solid ${en.color}`},children:k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[k.jsx("div",{children:k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[k.jsx("span",{style:{fontSize:"24px"},children:Ct()}),k.jsx("h2",{style:{fontSize:"18px",fontWeight:600,margin:0,color:en.color},children:ft()}),k.jsxs("span",{style:{fontSize:"12px",color:en.color},children:[" ",en.label]})]})}),k.jsx("button",{onClick:t,style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:en.color},children:""})]})}),k.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px"},children:[k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"8px",padding:"12px",marginBottom:"16px"},children:[k.jsx("div",{style:{fontWeight:500,fontSize:"14px"},children:r.nome_da||"Entit 1"}),r.tipo_da&&k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:r.tipo_da}),k.jsx("div",{style:{textAlign:"center",color:"var(--text-secondary)",margin:"8px 0",fontSize:"16px"},children:""}),k.jsx("div",{style:{fontWeight:500,fontSize:"14px"},children:r.nome_a||"Entit 2"}),r.tipo_a&&k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:r.tipo_a})]}),k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"8px",padding:"12px",marginBottom:"16px"},children:[k.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)",fontWeight:600,marginBottom:"8px",textTransform:"uppercase"},children:"Tipo Connessione"}),k.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:cq.map(pt=>k.jsxs("button",{onClick:()=>Rt(pt.value),style:{padding:"6px 10px",borderRadius:"16px",border:C.includes(pt.value)?"2px solid var(--primary)":"1px solid var(--border-color)",background:C.includes(pt.value)?"rgba(99, 102, 241, 0.1)":"transparent",cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",gap:"4px"},children:[k.jsx("span",{children:pt.icon}),k.jsx("span",{children:pt.label})]},pt.value))})]}),k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"8px",padding:"12px",marginBottom:"16px"},children:[k.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)",fontWeight:600,marginBottom:"8px",textTransform:"uppercase"},children:"Certezza"}),k.jsx("div",{style:{display:"flex",gap:"8px"},children:[{value:"ipotesi",label:"Ipotetico",color:"#94a3b8"},{value:"probabile",label:"Probabile",color:"#eab308"},{value:"certo",label:"Certo",color:"#22c55e"}].map(pt=>k.jsxs("button",{onClick:()=>F(pt.value),style:{flex:1,padding:"8px 12px",borderRadius:"8px",border:L===pt.value?`2px solid ${pt.color}`:"1px solid var(--border-color)",background:L===pt.value?`${pt.color}15`:"transparent",cursor:"pointer",fontSize:"12px",fontWeight:L===pt.value?600:400,color:L===pt.value?pt.color:"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[k.jsx("span",{style:{color:pt.color},children:""}),pt.label]},pt.value))})]}),rt&&(rt.volume_totale>0||rt.numero_transazioni>0)&&k.jsxs("div",{style:{background:"#f0fdf4",borderRadius:"8px",padding:"12px",marginBottom:"16px"},children:[k.jsx("div",{style:{fontSize:"11px",color:"#22c55e",fontWeight:600,marginBottom:"8px",textTransform:"uppercase"},children:"Dati Oggettivi"}),k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[k.jsx("span",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:"Volume totale"}),k.jsxs("span",{style:{fontSize:"13px",fontWeight:600},children:["",rt.volume_totale.toLocaleString("it-IT")]})]}),k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[k.jsx("span",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:"Transazioni"}),k.jsx("span",{style:{fontSize:"13px",fontWeight:600},children:rt.numero_transazioni})]}),rt.ultima_transazione&&k.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)",marginTop:"8px"},children:["Ultima: ",new Date(rt.ultima_transazione).toLocaleDateString("it-IT")]})]}),k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"8px",padding:"12px",marginBottom:"16px"},children:[k.jsx("div",{style:{fontSize:"11px",color:"#f59e0b",fontWeight:600,marginBottom:"12px",textTransform:"uppercase"},children:"Valutazione Soggettiva"}),k.jsx(i2,{label:"Influenza",value:U,onChange:q}),k.jsx(i2,{label:"Qualit relazione",value:G,onChange:$}),k.jsx(i2,{label:"Importanza strategica",value:X,onChange:ie}),k.jsx(i2,{label:"Affidabilit",value:de,onChange:fe}),k.jsx(i2,{label:"Potenziale",value:be,onChange:ve}),k.jsxs("div",{style:{marginTop:"12px"},children:[k.jsx("label",{style:{fontSize:"13px",color:"var(--text-secondary)",display:"block",marginBottom:"4px"},children:"Note sulla relazione"}),k.jsx("textarea",{value:Je,onChange:pt=>we(pt.target.value),placeholder:"Appunti sulla relazione...",style:{width:"100%",padding:"8px",borderRadius:"6px",border:"1px solid var(--border-color)",fontSize:"13px",resize:"vertical",minHeight:"60px",background:"var(--bg-primary)"}})]})]}),k.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:[r.data_inizio&&k.jsxs("div",{style:{marginBottom:"4px"},children:[k.jsx("strong",{children:"Dal:"})," ",new Date(r.data_inizio).toLocaleDateString("it-IT")]}),r.fonte&&k.jsxs("div",{style:{marginBottom:"4px"},children:[k.jsx("strong",{children:"Fonte:"})," ",r.fonte]})]}),x&&k.jsx("div",{style:{padding:"8px",background:"rgba(239,68,68,0.1)",borderRadius:"6px",color:"#ef4444",fontSize:"12px",marginTop:"12px"},children:x})]}),k.jsxs("div",{style:{padding:"12px 16px",borderTop:"1px solid var(--border-color)",display:"flex",gap:"8px"},children:[k.jsx("button",{onClick:t,style:{flex:1,padding:"10px",border:"1px solid var(--border-color)",borderRadius:"8px",background:"transparent",cursor:"pointer",fontSize:"14px"},children:"Chiudi"}),k.jsx("button",{onClick:He,disabled:i,style:{flex:1,padding:"10px",border:"none",borderRadius:"8px",background:"#6366f1",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:600},children:i?"Salvataggio...":"Salva"})]})]})}function kze({position:e,onClose:t,onCreateEntity:n,tipiNeurone:r=[],categorieDisponibili:a=[]}){const[l,f]=B.useState("tipo"),[i,y]=B.useState(null),[x,S]=B.useState([]),[C,P]=B.useState(""),L=r,U=i?a.filter(de=>de.tipo_id===i.id):[],q=de=>{S(fe=>fe.includes(de)?fe.filter(be=>be!==de):[...fe,de])},G=de=>{y(de),S([]),f("categoria")},$=()=>{x.length!==0&&f("nome")},X=()=>{!i||x.length===0||n({nome:C||`${i.nome} ${new Date().toLocaleDateString("it-IT")}`,tipo:i.nome,categorie:x,lat:e.lat,lng:e.lng})},ie=de=>{switch(de){case"quadrato":return"";case"cerchio":return"";case"triangolo":return"";case"stella":return"";case"croce":return"";default:return""}};return k.jsxs("div",{style:F_,children:[k.jsxs("div",{style:TE,children:[k.jsxs("span",{style:{fontWeight:600},children:[l==="tipo"&&"Scegli tipo",l==="categoria"&&`${i==null?void 0:i.nome} - Categorie`,l==="nome"&&"Nome (opzionale)"]}),k.jsx("button",{onClick:t,style:EE,children:""})]}),l==="tipo"&&k.jsx("div",{style:m_,children:L.map(de=>k.jsxs("button",{onClick:()=>G(de),style:Oze,children:[k.jsx("span",{style:{marginRight:"8px"},children:ie(de.forma)}),de.nome]},de.id))}),l==="categoria"&&k.jsxs("div",{style:m_,children:[k.jsx("div",{style:{marginBottom:"8px",fontSize:"12px",color:"#6b7280"},children:"Seleziona una o pi categorie"}),k.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:U.map(de=>{const fe=x.includes(de.nome);return k.jsxs("button",{onClick:()=>q(de.nome),style:{...bie,background:fe?de.colore:"#e5e7eb",color:fe?"white":"#374151",fontWeight:fe?600:400},children:[fe&&" ",de.nome]},de.id)})}),k.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"12px"},children:[k.jsx("button",{onClick:()=>f("tipo"),style:dq,children:" Indietro"}),k.jsx("button",{onClick:$,disabled:x.length===0,style:{...ak,opacity:x.length===0?.5:1},children:"Avanti "})]})]}),l==="nome"&&k.jsxs("div",{style:m_,children:[k.jsx("input",{type:"text",value:C,onChange:de=>P(de.target.value),placeholder:`${i==null?void 0:i.nome} ${new Date().toLocaleDateString("it-IT")}`,style:xA,autoFocus:!0}),k.jsx("div",{style:{fontSize:"11px",color:"#6b7280",marginBottom:"12px"},children:"Lascia vuoto per nome automatico"}),k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("button",{onClick:()=>f("categoria"),style:dq,children:" Indietro"}),k.jsx("button",{onClick:X,style:ak,children:"Crea"})]})]})]})}function Ize({neurone:e,onClose:t,onVendi:n,onCompra:r,onConnetti:a}){return k.jsxs("div",{style:F_,children:[k.jsxs("div",{style:TE,children:[k.jsx("span",{style:{fontWeight:600,fontSize:"14px"},children:e.nome}),k.jsx("button",{onClick:t,style:EE,children:""})]}),k.jsxs("div",{style:m_,children:[k.jsx("button",{onClick:n,style:{...G2,background:"#10b981"},children:" Vendi a..."}),k.jsx("button",{onClick:r,style:{...G2,background:"#3b82f6"},children:" Compra da..."}),k.jsx("button",{onClick:a,style:{...G2,background:"#8b5cf6"},children:" Connetti con..."})]})]})}function Rze({action:e,onClose:t,onSelectOnMap:n,onSelectFromList:r}){const a={vendi:"A chi vendi?",compra:"Da chi compri?",connetti:"Con chi connetti?"};return k.jsxs("div",{style:F_,children:[k.jsxs("div",{style:TE,children:[k.jsx("span",{style:{fontWeight:600},children:a[e]}),k.jsx("button",{onClick:t,style:EE,children:""})]}),k.jsxs("div",{style:m_,children:[k.jsx("button",{onClick:n,style:{...G2,background:"#f59e0b"},children:" Clicca su mappa"}),k.jsx("button",{onClick:r,style:{...G2,background:"#6366f1"},children:" Cerca nella lista"})]})]})}function Mze({onClose:e,onConfirm:t}){const[n,r]=B.useState([]),[a,l]=B.useState([]),[f,i]=B.useState(!0);B.useEffect(()=>{(async()=>{try{const S=await Kn.getTipiSinapsi();r(S.data)}catch(S){console.error("Errore:",S)}finally{i(!1)}})()},[]);const y=x=>{l(S=>S.includes(x)?S.filter(C=>C!==x):[...S,x])};return f?k.jsx("div",{style:F_,children:k.jsx("div",{style:{padding:"20px"},children:"Caricamento..."})}):k.jsxs("div",{style:F_,children:[k.jsxs("div",{style:TE,children:[k.jsx("span",{style:{fontWeight:600},children:"Tipo connessione"}),k.jsx("button",{onClick:e,style:EE,children:""})]}),k.jsxs("div",{style:m_,children:[k.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",marginBottom:"12px"},children:n.map(x=>{const S=a.includes(x.nome);return k.jsxs("button",{onClick:()=>y(x.nome),style:{...bie,background:S?x.colore:"#e5e7eb",color:S?"white":"#374151",fontWeight:S?600:400},children:[S&&" ",x.nome]},x.id)})}),k.jsx("button",{onClick:()=>t(a),disabled:a.length===0,style:{...ak,opacity:a.length===0?.5:1},children:"Conferma"})]})]})}function Pze({sourceNeurone:e,targetNeurone:t,action:n,onClose:r,onConfirm:a}){const[l,f]=B.useState([]),[i,y]=B.useState(""),[x,S]=B.useState(""),[C,P]=B.useState(new Date().toISOString().split("T")[0]),[L,F]=B.useState(!0);B.useEffect(()=>{(async()=>{try{const $=await Kn.getFamiglieProdotto();f($.data),$.data.length>0&&y($.data[0].id)}catch($){console.error("Errore:",$)}finally{F(!1)}})()},[]);const U=()=>{!i||!x||a({famigliaId:i,importo:parseFloat(x),data:C})},q=n==="vendi"?`${e.nome} vende a ${t.nome}`:`${e.nome} compra da ${t.nome}`;return L?k.jsx("div",{style:F_,children:k.jsx("div",{style:{padding:"20px"},children:"Caricamento..."})}):k.jsxs("div",{style:{...F_,minWidth:"280px"},children:[k.jsxs("div",{style:TE,children:[k.jsx("span",{style:{fontWeight:600,fontSize:"13px"},children:q}),k.jsx("button",{onClick:r,style:EE,children:""})]}),k.jsx("div",{style:m_,children:l.length===0?k.jsx("div",{style:{padding:"12px",background:"#fef3c7",borderRadius:"8px",fontSize:"13px",color:"#92400e"},children:"Nessuna famiglia prodotto configurata."}):k.jsxs(k.Fragment,{children:[k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"12px",color:"#6b7280",marginBottom:"4px",display:"block"},children:"Prodotto"}),k.jsx("select",{value:i,onChange:G=>y(G.target.value),style:{...xA,marginBottom:"8px"},children:l.map(G=>k.jsx("option",{value:G.id,children:G.nome},G.id))})]}),k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"12px",color:"#6b7280",marginBottom:"4px",display:"block"},children:"Importo ()"}),k.jsx("input",{type:"number",value:x,onChange:G=>S(G.target.value),placeholder:"0.00",style:{...xA,marginBottom:"8px"},autoFocus:!0})]}),k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"12px",color:"#6b7280",marginBottom:"4px",display:"block"},children:"Data"}),k.jsx("input",{type:"date",value:C,onChange:G=>P(G.target.value),style:{...xA,marginBottom:"12px"}})]}),k.jsx("button",{onClick:U,disabled:!i||!x,style:{...ak,opacity:!i||!x?.5:1,background:n==="vendi"?"#10b981":"#3b82f6"},children:n==="vendi"?"Registra Vendita":"Registra Acquisto"})]})})]})}const F_={background:"white",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.25)",minWidth:"220px",maxWidth:"300px",overflow:"hidden"},TE={display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #e5e7eb",background:"#f9fafb"},EE={background:"none",border:"none",fontSize:"16px",cursor:"pointer",color:"#6b7280",padding:"4px"},m_={padding:"12px 16px",display:"flex",flexDirection:"column",gap:"8px"},Oze={display:"flex",alignItems:"center",width:"100%",padding:"10px 12px",border:"none",borderRadius:"8px",background:"#f3f4f6",cursor:"pointer",fontSize:"14px",textAlign:"left",transition:"background 0.15s"},G2={display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",padding:"12px",border:"none",borderRadius:"8px",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:500},bie={padding:"6px 12px",borderRadius:"16px",border:"none",cursor:"pointer",fontSize:"13px",transition:"all 0.15s"},dq={flex:1,padding:"10px",border:"1px solid #d1d5db",borderRadius:"8px",background:"white",cursor:"pointer",fontSize:"13px"},ak={flex:1,padding:"10px",border:"none",borderRadius:"8px",background:"#3b82f6",color:"white",cursor:"pointer",fontSize:"13px",fontWeight:500},xA={width:"100%",padding:"10px 12px",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"14px",marginBottom:"4px"},hq=[e=>`Ciao ${e}! `,e=>`Ben rivisto, ${e}!`,e=>`Eccomi ${e}!`,e=>`Ehi ${e}!`,e=>`Buongiorno ${e}!`,e=>`Ciao ${e}, sono qui!`],Lze=[{label:" Analizza i dati",prompt:"Fammi un'analisi generale sui miei dati: clienti, vendite, trend..."},{label:" Cerca qualcosa",prompt:""},{label:" Esplora la mappa",prompt:"Mostrami una panoramica della mappa con le entit principali"},{label:" Dammi un consiglio",prompt:"Guardando i miei dati, c' qualcosa che dovrei sapere? Clienti dormienti, opportunit, problemi?"}],_4="genagenta_ai_chat_history";function Dze({isOpen:e,onClose:t,onAction:n,selectedEntity:r,visibilityContext:a,userActions:l,userName:f="utente",initialMessage:i,onInitialMessageSent:y,aiMarkers:x=[],onClearAiMarkers:S,copilotContext:C}){const[P,L]=B.useState([]),[F,U]=B.useState(""),[q,G]=B.useState(!1),[$,X]=B.useState("thinking"),[ie,de]=B.useState({messagesCount:0,threshold:25}),fe=B.useRef(null),be=B.useRef(null),{exportForAi:ve,executeAction:Je}=UN(),[we,rt]=B.useState({x:20,y:20}),[He,ft]=B.useState(!1),Ct=B.useRef({x:0,y:0,posX:0,posY:0}),Nt=wt=>{wt.target.closest("button")||(ft(!0),Ct.current={x:wt.clientX,y:wt.clientY,posX:we.x,posY:we.y},wt.preventDefault())};B.useEffect(()=>{if(!He)return;const wt=jt=>{const Tn=Ct.current.x-jt.clientX,mn=Ct.current.y-jt.clientY;rt({x:Math.max(0,Ct.current.posX+Tn),y:Math.max(0,Ct.current.posY+mn)})},Fe=()=>{ft(!1)};return document.addEventListener("mousemove",wt),document.addEventListener("mouseup",Fe),()=>{document.removeEventListener("mousemove",wt),document.removeEventListener("mouseup",Fe)}},[He]);const Rt=B.useMemo(()=>{const wt=hq[Math.floor(Math.random()*hq.length)];return wt(f.split(" ")[0])},[f]);B.useEffect(()=>{try{const wt=localStorage.getItem(_4);if(wt){const jt=JSON.parse(wt).map(Tn=>({...Tn,timestamp:new Date(Tn.timestamp)}));L(jt)}}catch(wt){console.error("Errore caricamento chat salvata:",wt)}},[]),B.useEffect(()=>{P.length>0&&localStorage.setItem(_4,JSON.stringify(P))},[P]),B.useEffect(()=>{var wt;(wt=fe.current)==null||wt.scrollIntoView({behavior:"smooth"})},[P]),B.useEffect(()=>{e&&setTimeout(()=>{var wt;return(wt=be.current)==null?void 0:wt.focus()},100)},[e]),B.useEffect(()=>{e&&i&&!q&&(U(i),y==null||y(),setTimeout(()=>{const wt=document.querySelector("[data-ai-submit]");wt==null||wt.click()},100))},[e,i]);const en=()=>{L([]),localStorage.removeItem(_4),S==null||S()},nt=(wt,Fe)=>{if(!a)return{visible:!0};const{activeFilters:jt}=a;return jt.tipoNeurone&&wt&&jt.tipoNeurone.toLowerCase()!==wt.toLowerCase()?{visible:!1,filteredOutBy:`filtro tipo attivo: "${jt.tipoNeurone}"`}:jt.categoria&&Fe&&jt.categoria!==Fe?{visible:!1,filteredOutBy:`filtro categoria attivo: "${jt.categoria}"`}:{visible:!0}},pt=async wt=>{var Fe,jt,Tn,mn,zn,yn,qt,wn,Sn,Xn;console.log("Eseguo pending_action:",wt);try{let rn,br,Qr;switch(wt.action_type){case"createNeurone":rn=await Kn.createNeurone(wt.payload),br=(Fe=wt.payload)==null?void 0:Fe.tipo,Qr=(Tn=(jt=wt.payload)==null?void 0:jt.categorie)==null?void 0:Tn[0];break;case"updateNeurone":if(!wt.entity_id)throw new Error("entity_id mancante");await Kn.updateNeurone(wt.entity_id,wt.payload),rn={success:!0,id:wt.entity_id},br=(mn=wt.payload)==null?void 0:mn.tipo;break;case"deleteNeurone":if(!wt.entity_id)throw new Error("entity_id mancante");await Kn.deleteNeurone(wt.entity_id),rn={success:!0,deleted:wt.entity_id};break;case"createSinapsi":rn=await Kn.createSinapsi(wt.payload);break;case"deleteSinapsi":if(!wt.sinapsi_id)throw new Error("sinapsi_id mancante");await Kn.deleteSinapsi(wt.sinapsi_id),rn={success:!0,deleted:wt.sinapsi_id};break;case"createVendita":rn=await Kn.createVendita(wt.payload);break;case"deleteSale":if(!wt.sale_id)throw new Error("sale_id mancante");rn=await Kn.deleteVendita(wt.sale_id);break;case"createNota":const ar=wt.payload;rn=await Kn.createNota(ar.neurone_id,ar.testo);break;case"callApi":wt.method==="POST"?(rn=(await Kn.post(wt.endpoint,wt.payload)).data,(zn=wt.endpoint)!=null&&zn.includes("neuroni")&&(br=(yn=wt.payload)==null?void 0:yn.tipo,Qr=(wn=(qt=wt.payload)==null?void 0:qt.categorie)==null?void 0:wn[0])):wt.method==="PUT"?rn=(await Kn.put(wt.endpoint,wt.payload)).data:wt.method==="DELETE"&&(rn=(await Kn.delete(wt.endpoint)).data);break;default:throw new Error(`Tipo azione non supportato: ${wt.action_type}`)}if(console.log("Pending action completata:",rn),["createNeurone","updateNeurone"].includes(wt.action_type)||wt.action_type==="callApi"&&((Sn=wt.endpoint)==null?void 0:Sn.includes("neuroni"))&&wt.method==="POST"){const ar=nt(br,Qr);return console.log("Visibility check:",{entityType:br,entityCategoria:Qr,visibility:ar}),{success:!0,data:rn,visibility:ar}}return{success:!0,data:rn}}catch(rn){console.error("Errore esecuzione pending_action:",rn);let br="Errore sconosciuto";if(rn&&typeof rn=="object"&&"response"in rn){const Qr=rn;(Xn=Qr.response)!=null&&Xn.data&&(br=Qr.response.data.error||Qr.response.data.message||"Errore API")}else rn instanceof Error&&(br=rn.message);return{success:!1,error:br}}},Oe=async()=>{var jt,Tn,mn,zn,yn;if(!F.trim()||q)return;const wt={role:"user",content:F.trim(),timestamp:new Date};L(qt=>[...qt,wt]),U(""),G(!0);const Fe=P.length>=25;X(Fe?"compacting":"thinking");try{const wn=P.slice(-30).map(sr=>({role:sr.role,content:sr.content.length>1500?sr.content.substring(0,1500)+"...[troncato]":sr.content,tool_summary:sr.tool_summary}));Fe&&(X("compacting"),await new Promise(sr=>setTimeout(sr,500))),X("thinking");let Sn=!0,Xn=null,rn=null,br=0;const Qr=10;for(;Sn&&br<Qr;){if(br++,rn){const ar=rn._actionResult;delete rn._actionResult,Xn=await Kn.aiChatContinue(rn,ar)}else{const ar=ve(),Vn={};r&&(Vn.selectedEntity=r),l&&l.length>0&&(Vn.userActions=l),x&&x.length>0&&(Vn.aiMarkers=x),C&&(Vn.copilotContext=C),ar&&(Vn.uiState=ar),console.log("=== AI CHAT CONTEXT DEBUG ==="),console.log("selectedEntity:",r),console.log("userActions count:",(l==null?void 0:l.length)||0),console.log("aiMarkers count:",(x==null?void 0:x.length)||0),console.log("copilotContext length:",(C==null?void 0:C.length)||0),console.log("uiState length:",(ar==null?void 0:ar.length)||0),console.log("=============================");try{const wr=await Kn.aiDualBrain(wt.content,Object.keys(Vn).length>0?Vn:void 0);if(wr.success)Xn={response:(wr.delegated?`${wr.agea_message||""}

${wr.engineer_result||""}`:wr.response||"").trim(),status:"complete",actions:[{agent:wr.agent,delegated:wr.delegated}]};else throw new Error(wr.error||"Dual Brain error")}catch(wr){console.warn("Dual Brain fallback to old API:",wr),Xn=await Kn.aiChat(wt.content,wn,Object.keys(Vn).length>0?Vn:void 0)}}if(Xn.status==="pending_action"&&Xn.pending_action){if(console.log("Pending action ricevuta:",Xn.pending_action),Xn.partial_response){const Vn={role:"assistant",content:Xn.partial_response+" ",timestamp:new Date};L(wr=>[...wr.filter(Si=>!Si.content.endsWith(" ")),Vn])}const ar=await pt(Xn.pending_action);if(rn={...Xn.resume_context||{},_actionResult:ar},ar.success){const Vn=Xn.pending_action.action_type,wr=Xn.pending_action.endpoint||"",ys=Xn.pending_action.method||"",Si=["createNeurone","updateNeurone","deleteNeurone"].includes(Vn),Ri=["createSinapsi","deleteSinapsi"].includes(Vn),ks=Vn==="callApi"&&(wr.includes("neuroni")||wr.includes("sinapsi"));console.log("DEBUG refresh check:",{actionType:Vn,endpoint:wr,method:ys,isNeuroniAction:Si,isSinapsiAction:Ri,isCallApiOnNeuroni:ks,willRefresh:Si||Ri||ks}),(Si||Ri||ks)&&(console.log("TRIGGERING refresh_neuroni!"),n==null||n({type:"refresh_neuroni"}))}continue}if(Sn=!1,L(ar=>ar.filter(Vn=>!Vn.content.endsWith(" "))),Xn.context&&(de({messagesCount:Xn.context.messages_count||0,threshold:Xn.context.compaction_threshold||25}),Xn.context.did_compaction&&Xn.context.compaction_summary)){console.log("Compaction ricevuta, reset history con riassunto");const ar={role:"assistant",content:`[Riassunto: ${Xn.context.compaction_summary}]`,timestamp:new Date},Vn={role:"assistant",content:Xn.response||"Fatto!",timestamp:new Date},wr=[ar,wt,Vn];if(L(wr),localStorage.setItem(_4,JSON.stringify(wr)),Xn.actions&&Array.isArray(Xn.actions))for(const ys of Xn.actions){const Si=ys;console.log("Eseguo azione AI (post-compaction):",Si),Si.type==="ui_action"&&Si.action_id?await Je(Si.action_id,Si.action_params||{}):n&&n(Si)}return}const sr={role:"assistant",content:Xn.response||"Fatto!",timestamp:new Date,tool_summary:Xn.tool_summary};if(L(ar=>[...ar,sr]),Xn.actions&&Array.isArray(Xn.actions))for(const ar of Xn.actions){const Vn=ar;if(console.log("Eseguo azione AI:",Vn),Vn.type==="ui_action"&&Vn.action_id){console.log("Eseguo UI action:",Vn.action_id,Vn.action_params);const wr=await Je(Vn.action_id,Vn.action_params||{});console.log("UI action result:",wr)}else n&&n(Vn)}}if(br>=Qr){console.warn("Frontend execution: raggiunto limite loop");const sr={role:"assistant",content:"Ho completato diverse operazioni. C' altro che posso fare?",timestamp:new Date};L(ar=>[...ar,sr])}}catch(qt){console.error("Errore AI:",qt);let wn="";if(qt&&typeof qt=="object"){const Xn=qt;(Tn=(jt=Xn.response)==null?void 0:jt.data)!=null&&Tn.error?wn=Xn.response.data.error:(zn=(mn=Xn.response)==null?void 0:mn.data)!=null&&zn.message?wn=Xn.response.data.message:(yn=Xn.response)!=null&&yn.status?wn=`Errore HTTP ${Xn.response.status}`:Xn.message&&(wn=Xn.message)}if(wn)try{X("thinking");const Xn=`[ERRORE SISTEMA] Ho ricevuto questo errore tecnico mentre provavo a eseguire la tua richiesta:

"${wn}"

Spiega all'utente cosa  successo in modo semplice e, se possibile, suggerisci come risolvere o cosa provare.`,rn=await Kn.aiChat(Xn,P.slice(-5),{selectedEntity:r||void 0});if(rn.response){const br={role:"assistant",content:rn.response,timestamp:new Date};L(Qr=>[...Qr,br]);return}}catch{console.error("Anche la chiamata di interpretazione errore  fallita")}const Sn={role:"assistant",content:wn?`Ops!  C' stato un problema tecnico:

**${wn}**

Potrebbe essere un problema temporaneo - riprova tra poco.`:"Ahia!  Mi sa che ho fatto un pasticcio... Forse dovremmo dare un'occhiata lato software, da qui non riesco proprio!",timestamp:new Date};L(Xn=>[...Xn,Sn])}finally{G(!1),X("thinking"),setTimeout(()=>{var qt;return(qt=be.current)==null?void 0:qt.focus()},100)}},gn=wt=>{wt.key==="Enter"&&!wt.shiftKey&&(wt.preventDefault(),Oe())};return e?k.jsxs("div",{style:{position:"fixed",bottom:`${we.y}px`,right:`${we.x}px`,width:"400px",height:"500px",backgroundColor:"var(--bg-secondary)",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",display:"flex",flexDirection:"column",zIndex:1e3,border:"1px solid var(--border)"},children:[k.jsxs("div",{onMouseDown:Nt,style:{padding:"12px 16px",borderBottom:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"var(--bg-primary)",borderRadius:"12px 12px 0 0",cursor:He?"grabbing":"grab",userSelect:"none"},children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[k.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",background:"linear-gradient(135deg, #3b82f6, #8b5cf6)",boxShadow:"0 0 12px rgba(59, 130, 246, 0.6), 0 0 24px rgba(139, 92, 246, 0.3)"}}),k.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:"Agea"}),P.length>0&&k.jsx("span",{style:{marginLeft:"8px",padding:"2px 8px",backgroundColor:"rgba(59, 130, 246, 0.1)",borderRadius:"10px",fontSize:"11px",color:"var(--text-secondary)"},children:P.length}),r&&k.jsx("span",{title:`Contesto: ${r.nome}`,style:{marginLeft:"4px",padding:"2px 6px",backgroundColor:"rgba(34, 197, 94, 0.15)",borderRadius:"10px",fontSize:"10px",color:"#22c55e",maxWidth:"100px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.nome})]}),k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[x.length>0&&k.jsxs("button",{onClick:S,title:`Rimuovi ${x.length} segnaposto`,style:{background:"none",border:"1px solid #f97316",borderRadius:"6px",fontSize:"11px",cursor:"pointer",color:"#f97316",padding:"4px 8px",display:"flex",alignItems:"center",gap:"4px"},children:[" ",x.length]}),P.length>0&&k.jsx("button",{onClick:en,title:"Nuova sessione",style:{background:"none",border:"1px solid var(--border-color)",borderRadius:"6px",fontSize:"11px",cursor:"pointer",color:"var(--text-secondary)",padding:"4px 8px"},children:"Nuova"}),k.jsx("button",{onClick:t,style:{background:"none",border:"none",fontSize:"20px",cursor:"pointer",color:"var(--text-secondary)",padding:"4px"},children:""})]})]}),k.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"12px",display:"flex",flexDirection:"column",gap:"12px"},children:[P.length===0&&k.jsxs("div",{style:{textAlign:"center",color:"var(--text-secondary)",padding:"20px",fontSize:"14px"},children:[k.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"50%",background:"linear-gradient(135deg, #3b82f6, #8b5cf6)",margin:"0 auto 16px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 20px rgba(59, 130, 246, 0.4)"},children:k.jsx("span",{style:{fontSize:"24px"},children:""})}),k.jsx("p",{style:{marginBottom:"8px",fontSize:"16px",fontWeight:600,color:"var(--text-primary)"},children:Rt}),k.jsx("p",{style:{fontSize:"13px",opacity:.8,marginBottom:"20px"},children:"Hai gi qualche idea, o partiamo da un'analisi?"}),k.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"},children:Lze.map((wt,Fe)=>k.jsx("button",{onClick:()=>{var jt;wt.prompt?(U(wt.prompt),setTimeout(()=>{var mn;const Tn=new KeyboardEvent("keydown",{key:"Enter"});(mn=be.current)==null||mn.dispatchEvent(Tn)},100)):(jt=be.current)==null||jt.focus()},style:{padding:"12px 10px",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"10px",cursor:"pointer",color:"var(--text-primary)",fontSize:"12px",fontWeight:500,transition:"all 0.2s ease",textAlign:"center"},onMouseOver:jt=>{jt.currentTarget.style.background="var(--bg-hover)",jt.currentTarget.style.borderColor="var(--primary)"},onMouseOut:jt=>{jt.currentTarget.style.background="var(--bg-primary)",jt.currentTarget.style.borderColor="var(--border)"},children:wt.label},Fe))})]}),P.map((wt,Fe)=>k.jsx("div",{style:{display:"flex",justifyContent:wt.role==="user"?"flex-end":"flex-start"},children:k.jsx("div",{style:{maxWidth:"85%",padding:"10px 14px",borderRadius:"12px",backgroundColor:wt.role==="user"?"#3b82f6":"var(--bg-primary)",color:wt.role==="user"?"white":"var(--text-primary)",fontSize:"14px",lineHeight:"1.5",whiteSpace:"pre-wrap"},children:wt.content})},Fe)),q&&k.jsx("div",{style:{display:"flex",justifyContent:"flex-start"},children:k.jsx("div",{style:{padding:"10px 14px",borderRadius:"12px",backgroundColor:"var(--bg-primary)",color:"var(--text-secondary)",fontSize:"14px"},children:$==="compacting"?k.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("span",{style:{fontSize:"12px"},children:""}),"Sto riassumendo la conversazione",k.jsx("span",{className:"dots-animation",children:"..."})]}):k.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("span",{className:"thinking-dot"}),"Sto pensando",k.jsx("span",{className:"dots-animation",children:"..."})]})})}),k.jsx("div",{ref:fe})]}),k.jsxs("div",{style:{padding:"12px",borderTop:"1px solid var(--border)",display:"flex",gap:"8px"},children:[k.jsx("textarea",{ref:be,value:F,onChange:wt=>U(wt.target.value),onKeyDown:gn,placeholder:"Scrivi un messaggio...",disabled:q,style:{flex:1,padding:"10px 12px",borderRadius:"8px",border:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"14px",resize:"none",minHeight:"44px",maxHeight:"100px"},rows:1}),k.jsx("button",{"data-ai-submit":!0,onClick:Oe,disabled:!F.trim()||q,style:{padding:"10px 16px",borderRadius:"8px",border:"none",backgroundColor:F.trim()&&!q?"#3b82f6":"#6b7280",color:"white",cursor:F.trim()&&!q?"pointer":"not-allowed",fontSize:"14px",fontWeight:500},children:"Invia"})]})]}):null}function Nze({selectedEntity:e,focusedEntity:t,activeFilters:n,sinapsi:r=[],neuroni:a=[],onSuggestionClick:l,isChatOpen:f=!1}){const[i,y]=B.useState([]),[x,S]=B.useState(!0);B.useEffect(()=>{y([]),S(!0)},[e==null?void 0:e.id,t==null?void 0:t.id]);const C=B.useMemo(()=>{var q,G,$,X;const F=[],U=e||t;if(U){const ie=r.filter(de=>de.neurone_da===U.id||de.neurone_a===U.id);ie.length>0?F.push({id:"analizza-connessioni",text:`Analizza ${ie.length} connessioni`,icon:"",action:`Analizza le connessioni di ${U.nome}`,priority:10}):F.push({id:"suggerisci-connessioni",text:"Suggerisci connessioni",icon:"",action:`Quali connessioni potrei creare per ${U.nome}?`,priority:8}),((q=U.tipo)!=null&&q.toLowerCase().includes("cliente")||(G=U.tipo)!=null&&G.toLowerCase().includes("impresa"))&&F.push({id:"storico-vendite",text:"Vedi storico vendite",icon:"",action:`Mostrami lo storico vendite di ${U.nome}`,priority:9}),(($=U.tipo)!=null&&$.toLowerCase().includes("cantiere")||(X=U.tipo)!=null&&X.toLowerCase().includes("luogo"))&&F.push({id:"attivita-cantiere",text:"Analizza attivit",icon:"",action:`Quali attivit ci sono state su ${U.nome}?`,priority:9}),F.push({id:"info-entita",text:"Maggiori info",icon:"",action:`Dimmi tutto quello che sai su ${U.nome}`,priority:5})}if(n){const ie=[...n.tipiAttivi,...n.categorieAttive].filter(Boolean);ie.length>0&&a.length>0&&F.push({id:"analizza-filtro",text:`Analizza ${a.length} risultati`,icon:"",action:`Analizza le ${a.length} entit filtrate: ${ie.join(", ")}`,priority:7}),n.ricerca&&n.ricerca.length>2&&F.push({id:"espandi-ricerca",text:"Espandi ricerca",icon:"",action:`Cerca entit simili a "${n.ricerca}"`,priority:6})}return!U&&(!n||n.tipiAttivi.length===0)&&(a.length>10&&F.push({id:"overview-generale",text:"Panoramica generale",icon:"",action:"Dammi una panoramica generale della mia rete",priority:4}),F.push({id:"trend-vendite",text:"Trend vendite",icon:"",action:"Come stanno andando le vendite questo mese?",priority:3})),F.filter(ie=>!i.includes(ie.id)).sort((ie,de)=>de.priority-ie.priority).slice(0,3)},[e,t,n,r,a,i]);if(f||!x||C.length===0)return null;const P=F=>{l(F.action),y(U=>[...U,F.id])},L=()=>{S(!1)};return k.jsxs("div",{style:{position:"fixed",bottom:"100px",right:"24px",zIndex:1500,display:"flex",flexDirection:"column",gap:"8px",maxWidth:"280px"},children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:"4px"},children:[k.jsx("span",{style:{fontSize:"11px",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px"},children:" Suggerimenti"}),k.jsx("button",{onClick:L,style:{background:"transparent",border:"none",color:"var(--text-secondary)",cursor:"pointer",fontSize:"14px",padding:"2px 6px",borderRadius:"4px"},title:"Chiudi suggerimenti",children:""})]}),C.map((F,U)=>k.jsxs("button",{onClick:()=>P(F),style:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 14px",background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"12px",cursor:"pointer",textAlign:"left",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease",animation:`slideIn 0.3s ease ${U*.1}s both`},onMouseEnter:q=>{q.currentTarget.style.background="var(--bg-primary)",q.currentTarget.style.borderColor="var(--primary)",q.currentTarget.style.transform="translateX(-4px)"},onMouseLeave:q=>{q.currentTarget.style.background="var(--bg-secondary)",q.currentTarget.style.borderColor="var(--border-color)",q.currentTarget.style.transform="translateX(0)"},children:[k.jsx("span",{style:{fontSize:"18px"},children:F.icon}),k.jsx("span",{style:{fontSize:"13px",color:"var(--text-primary)",fontWeight:500},children:F.text})]},F.id)),k.jsx("style",{children:`
        @keyframes slideIn {
          from {
            opacity: 0;
            transform: translateX(20px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
      `})]})}function zze(){const{user:e,personalAccess:t,verifyPin:n,exitPersonalMode:r,logout:a,updateUser:l}=jN(),[f,i]=B.useState({dataInizio:new Date(Date.now()-365*24*60*60*1e3).toISOString().split("T")[0],dataFine:new Date().toISOString().split("T")[0],tipoNeurone:null,categoria:null,certezza:null,valoreMin:null,raggio:null,centro:null,mostraConnessioni:!0,soloConnessioniSelezionate:!1,tipiSelezionati:[],categorieSelezionate:[],ricerca:""}),{data:y=[],isLoading:x}=LNe(f),{data:S=[],isLoading:C}=NNe(f),{data:P=[]}=yie(),{data:L=[]}=FNe(),{invalidateNeuroniESinapsi:F,invalidateNeuroni:U,invalidateSinapsi:q}=wE(),G=x||C,[$,X]=B.useState(null),[ie,de]=B.useState(!1),[fe,be]=B.useState(null),[ve,Je]=B.useState(null),[we,rt]=B.useState(!1),[He,ft]=B.useState(!1),[Ct,Nt]=B.useState(!1),[Rt,en]=B.useState(null),[nt,pt]=B.useState(!1),[Oe,gn]=B.useState(null),[wt,Fe]=B.useState(null),[jt,Tn]=B.useState(null),[mn,zn]=B.useState([]),[yn,qt]=B.useState(null),[wn,Sn]=B.useState(!1),[Xn,rn]=B.useState(null),[br,Qr]=B.useState(null),[sr,ar]=B.useState(!1),[Vn,wr]=B.useState(null),[ys,Si]=B.useState(null),[Ri,ks]=B.useState(null),[$i,Ws]=B.useState(null),[Kt,An]=B.useState(null),[Lr,Tt]=B.useState(null),[kn,nr]=B.useState(null),[dt,Qn]=B.useState([]),ti=(Ht,Dn)=>{const je={type:Ht,timestamp:new Date().toISOString(),data:Dn};Qn(jn=>Ht==="map_move"?[...jn.filter(Gn=>Gn.type!=="map_move").slice(-9),je]:[...jn.slice(-9),je]),console.log("User action logged:",je)},Zi=B.useRef(!1),Is=B.useRef(null),Ln=B.useRef(null);B.useEffect(()=>{Zi.current=wn},[wn]),B.useEffect(()=>{Is.current=br},[br]),B.useEffect(()=>{Ln.current=$i,console.log("DEBUG quickAction aggiornato a:",$i)},[$i]),B.useEffect(()=>{ie&&$&&fe&&$.id!==fe.id&&be($)},[$,ie,fe]),B.useEffect(()=>{$&&nr($.id)},[$]);const Hn=Ht=>{i(Dn=>{const je=typeof Ht=="function"?Ht(Dn):Ht,jn=[];return Dn.tipoNeurone!==je.tipoNeurone&&jn.push(`tipo: ${je.tipoNeurone||"tutti"}`),Dn.categoria!==je.categoria&&jn.push(`categoria: ${je.categoria||"tutte"}`),Dn.ricerca!==je.ricerca&&jn.push(`ricerca: "${je.ricerca}"`),JSON.stringify(Dn.tipiSelezionati)!==JSON.stringify(je.tipiSelezionati)&&jn.push(`tipi: ${je.tipiSelezionati.length>0?je.tipiSelezionati.join(", "):"tutti"}`),JSON.stringify(Dn.categorieSelezionate)!==JSON.stringify(je.categorieSelezionate)&&jn.push(`categorie: ${je.categorieSelezionate.length>0?je.categorieSelezionate.join(", "):"tutte"}`),jn.length>0&&ti("filter_change",{filterName:"filtri",filterValue:jn.join("; ")}),je})},Ke=GNe({neuroni:y,sinapsi:S,filtri:f,selectedNeurone:$,selectedSinapsiId:Lr,aiMarkers:mn,userActions:dt,tipiNeurone:P,mapViewport:yn,categorie:L}),sn=qNe(Ke);KLe({description:"Current state of the GenAgenta CRM application",value:sn}),m4({name:"fly_to",description:"Sposta la vista della mappa verso una localit. Usa questo quando l'utente chiede di andare in un posto (es: 'vai a Roma', 'mostrami Milano').",parameters:[{name:"location",type:"string",description:"Nome della localit (es: 'Roma', 'Milano centro', 'Via Roma 1, Torino')",required:!0},{name:"zoom",type:"number",description:"Livello di zoom (1-20, default 14)",required:!1}],handler:async({location:Ht,zoom:Dn})=>{var je;console.log("CopilotKit Action: fly_to",Ht,Dn);try{const jn=await Kn.geocodeSearch(Ht);if(jn!=null&&jn.success&&((je=jn.results)==null?void 0:je.length)>0){const Ir=jn.results[0];return Fe({lat:Ir.lat,lng:Ir.lng,zoom:Dn||14}),`Ho spostato la mappa su ${Ht}`}return`Non ho trovato "${Ht}"`}catch{return`Errore nella ricerca di "${Ht}"`}}}),m4({name:"set_map_style",description:"Cambia lo stile/visualizzazione della mappa. Usa questo quando l'utente chiede di cambiare vista (es: 'metti satellite', 'vista scura', 'mappa stradale').",parameters:[{name:"style",type:"string",description:"Stile mappa: 'satellite-v9' (satellitare), 'streets-v12' (stradale), 'dark-v11' (scuro), 'light-v11' (chiaro), 'outdoors-v12' (outdoor)",required:!0}],handler:async({style:Ht})=>(console.log("CopilotKit Action: set_map_style",Ht),Tn(Ht),`Ho cambiato la mappa in vista ${{"satellite-v9":"satellitare","streets-v12":"stradale","dark-v11":"scuro","light-v11":"chiaro","outdoors-v12":"outdoor"}[Ht]||Ht}`)}),m4({name:"select_entity",description:"Seleziona un'entit sulla mappa per mostrare i suoi dettagli. Usa questo quando l'utente chiede di vedere un'entit specifica.",parameters:[{name:"entity_id",type:"string",description:"ID dell'entit da selezionare",required:!0}],handler:async({entity_id:Ht})=>{console.log("CopilotKit Action: select_entity",Ht);const Dn=y.find(je=>je.id===Ht);return Dn?(X(Dn),Dn.lat&&Dn.lng&&Fe({lat:Dn.lat,lng:Dn.lng,zoom:16}),`Ho selezionato "${Dn.nome}"`):`Entit con ID ${Ht} non trovata`}}),m4({name:"search_entities",description:"Cerca entit per nome o tipo. Usa questo quando l'utente chiede di cercare qualcosa (es: 'cerca clienti', 'trova Mario Rossi').",parameters:[{name:"query",type:"string",description:"Testo da cercare nel nome delle entit",required:!1},{name:"type",type:"string",description:"Tipo di entit (cantiere, cliente, fornitore, tecnico, rivendita)",required:!1}],handler:async({query:Ht,type:Dn})=>{console.log("CopilotKit Action: search_entities",Ht,Dn);let je=y;if(Dn&&(je=je.filter(Ir=>{var Gn;return((Gn=Ir.tipo)==null?void 0:Gn.toLowerCase())===Dn.toLowerCase()})),Ht){const Ir=Ht.toLowerCase();je=je.filter(Gn=>Gn.nome.toLowerCase().includes(Ir))}if(je.length===0)return"Nessuna entit trovata";const jn=je.slice(0,5).map(Ir=>`- ${Ir.nome} (${Ir.tipo})`).join(`
`);return`Ho trovato ${je.length} entit:
${jn}${je.length>5?`
...e altre ${je.length-5}`:""}`}}),B.useEffect(()=>{(async()=>{try{const Dn=await Kn.getInvitiPendenti();Dn.has_invite&&Dn.invito&&Je(Dn.invito)}catch(Dn){console.error("Errore controllo inviti:",Dn)}})()},[]);const bn=async Ht=>{try{const Dn=await Kn.getNeurone(Ht.id);X(Dn),Tt(null),ti("panel_open",{panelName:"detail_panel"})}catch(Dn){console.error("Errore caricamento dettaglio:",Dn)}},kr=async Ht=>{try{await n(Ht),window.location.reload()}catch{throw new Error("PIN non valido")}},In=async Ht=>{await Kn.setPin(Ht),e&&l({...e,has_pin:!0})},Ki=()=>{zn([])},Ta=Ht=>{zn(Dn=>Dn.filter(je=>je.id!==Ht))},Ns=Ht=>{switch(console.log("AI Action ricevuta:",Ht),Ht.type){case"map_fly_to":Ht.lat!==void 0&&Ht.lng!==void 0&&Fe({lat:Ht.lat,lng:Ht.lng,zoom:Ht.zoom,pitch:Ht.pitch,bearing:Ht.bearing});break;case"map_set_style":Ht.style&&Tn(Ht.style);break;case"map_select_entity":if(Ht.entity_id){const Dn=y.find(je=>je.id===Ht.entity_id);Dn&&(X(Dn),nr(Dn.id),Dn.lat&&Dn.lng&&Fe({lat:Dn.lat,lng:Dn.lng}))}break;case"map_show_connections":if(Ht.entity_id){const Dn=y.find(je=>je.id===Ht.entity_id);Dn&&(nr(Dn.id),X(Dn))}break;case"ui_open_panel":if(Ht.panel==="entity_detail"&&Ht.entity_id){const Dn=y.find(je=>je.id===Ht.entity_id);Dn&&X(Dn)}break;case"ui_notification":Ht.notification_message&&console.log(`[${Ht.notification_type||"info"}] ${Ht.notification_message}`);break;case"refresh_neuroni":console.log("AI Action: refresh_neuroni (+ sinapsi) via invalidation"),F();break;case"map_place_marker":Ht.lat!==void 0&&Ht.lng!==void 0&&(zn(Dn=>{if(Dn.length>=20)return console.warn("Limite di 20 marker raggiunto"),Dn;const je={id:crypto.randomUUID(),lat:Ht.lat,lng:Ht.lng,label:Ht.label||"Segnaposto",color:Ht.color||"red",timestamp:new Date().toISOString()};return[...Dn,je]}),Ht.fly_to&&Fe({lat:Ht.lat,lng:Ht.lng,zoom:16}));break;case"map_remove_marker":Ht.marker_id&&zn(Dn=>Dn.filter(je=>je.id!==Ht.marker_id));break;case"map_clear_markers":zn([]);break}};return k.jsxs("div",{className:"app-container",children:[k.jsx(ZNe,{neuroni:y,selectedId:($==null?void 0:$.id)||null,onSelect:bn,filtri:f,onFiltriChange:Hn,loading:G,onAddNeurone:()=>de(!0),onQuickMapMode:()=>ar(!0),tipiNeurone:P,categorie:L}),k.jsxs("div",{className:"main-content",children:[k.jsxs("header",{className:"header",children:[k.jsx("h1",{style:{fontSize:"18px",fontWeight:600},children:"GenAgenTa 7"}),k.jsx("div",{style:{flex:1}}),k.jsx("button",{onClick:()=>{t?r():e!=null&&e.has_pin?rt(!0):ft(!0)},title:t?"Chiudi area personale":e!=null&&e.has_pin?"Sblocca area personale":"Imposta PIN",style:{background:t?"rgba(34, 197, 94, 0.2)":"transparent",border:t?"2px solid #22c55e":"1px solid rgba(255,255,255,0.2)",borderRadius:"8px",padding:"8px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:t?"#22c55e":"rgba(255,255,255,0.7)",fontSize:"14px",marginRight:"12px"},children:t?"":""}),k.jsx("button",{onClick:()=>{const Ht=!Ct;ti(Ht?"panel_open":"panel_close",{panelName:"agea_chat"}),Nt(Ht)},title:"Agea - Assistente AI",style:{background:Ct?"rgba(59, 130, 246, 0.15)":"transparent",border:"none",borderRadius:"50%",width:"36px",height:"36px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",marginRight:"12px",transition:"all 0.3s ease"},children:k.jsx("div",{style:{width:Ct?"14px":"10px",height:Ct?"14px":"10px",borderRadius:"50%",background:Ct?"linear-gradient(135deg, #3b82f6, #8b5cf6)":"linear-gradient(135deg, #60a5fa, #a78bfa)",boxShadow:Ct?"0 0 16px rgba(59, 130, 246, 0.7), 0 0 32px rgba(139, 92, 246, 0.4)":"0 0 8px rgba(96, 165, 250, 0.5)",transition:"all 0.3s ease",animation:Ct?"none":"pulse 2s ease-in-out infinite"}})}),e&&k.jsx(Eze,{user:e,onLogout:a,onUserUpdate:l})]}),k.jsxs("div",{className:"content-area",style:wn?{cursor:"crosshair"}:void 0,children:[k.jsx(lze,{neuroni:y,sinapsi:S,categorie:L,tipiNeurone:P,selectedId:($==null?void 0:$.id)||null,filterSelectedId:kn||($==null?void 0:$.id)||null,onSelectNeurone:bn,onFocusNeurone:Ht=>{nr(Ht);const Dn=y.find(je=>je.id===Ht);Dn&&ti("select_entity",{entityId:Dn.id,entityName:Dn.nome,entityType:Dn.tipo||void 0})},onClearFocus:(Ht,Dn)=>{nr(null),Ht!==void 0&&Dn!==void 0?ti("map_click",{lat:Ht,lng:Dn}):ti("deselect",{})},onMapMove:(Ht,Dn)=>{ti("map_move",{center:Ht,zoom:Dn}),qt({center:Ht,zoom:Dn})},filtri:f,pickingMode:nt,onPickPosition:(Ht,Dn)=>{gn({lat:Ht,lng:Dn}),pt(!1)},flyToPosition:wt,aiStyleChange:jt,onAiStyleApplied:()=>Tn(null),pickedPosition:Oe,connectionPickingMode:wn,connectionSourceId:(br==null?void 0:br.id)||null,onPickConnectionTarget:Ht=>{const Dn=Ln.current;if(console.log("DEBUG onPickConnectionTarget:",Ht.nome,"quickAction:",Dn),Dn==="vendi"||Dn==="compra"){An(Ht),Sn(!1),ar(!0),wr("transactionForm"),Si({lat:Ht.lat||0,lng:Ht.lng||0,x:window.innerWidth/2-140,y:window.innerHeight/2-150});return}const je={id:Ht.id,nome:Ht.nome,tipo:Ht.tipo};rn(je),Sn(!1),br&&X(br)},quickMapMode:sr,onQuickMapClick:(Ht,Dn,je,jn)=>{Si({lat:Ht,lng:Dn,x:je,y:jn}),wr("create")},onQuickEntityClick:(Ht,Dn,je)=>{ar(!0),ks(Ht),Si({lat:Ht.lat||0,lng:Ht.lng||0,x:Dn,y:je}),wr("entityActions")},onSelectSinapsi:Ht=>{Tt(Ht),X(null)},aiMarkers:mn,onRemoveAiMarker:Ta}),wn&&k.jsxs("div",{style:{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",background:"var(--primary)",color:"white",padding:"12px 24px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:1e3,display:"flex",alignItems:"center",gap:"12px"},children:[k.jsx("span",{children:"Clicca su un'entit per collegarla"}),k.jsx("button",{onClick:()=>{Zi.current=!1,Is.current=null,Sn(!1),rn(null),br&&X(br),Qr(null)},style:{background:"rgba(255,255,255,0.2)",border:"none",color:"white",padding:"4px 12px",borderRadius:"4px",cursor:"pointer"},children:"Annulla"})]}),sr&&!Vn&&k.jsxs("div",{style:{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",background:"#f59e0b",color:"white",padding:"12px 24px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:1e3,display:"flex",alignItems:"center",gap:"12px"},children:[k.jsx("span",{children:" Clicca sulla mappa o su un'entit"}),k.jsx("button",{onClick:()=>{ar(!1),wr(null),Si(null)},style:{background:"rgba(255,255,255,0.2)",border:"none",color:"white",padding:"4px 12px",borderRadius:"4px",cursor:"pointer"},children:"Annulla"})]}),Vn&&ys&&k.jsxs("div",{style:{position:"absolute",left:Math.min(ys.x,window.innerWidth-320),top:Math.min(ys.y,window.innerHeight-400),zIndex:1001},children:[Vn==="create"&&k.jsx(kze,{position:{lat:ys.lat,lng:ys.lng},tipiNeurone:P,categorieDisponibili:L,onClose:()=>{wr(null),Si(null)},onCreateEntity:async Ht=>{try{const Dn=await Kn.createNeurone({nome:Ht.nome,tipo:Ht.tipo,categorie:Ht.categorie,visibilita:"aziendale",lat:Ht.lat,lng:Ht.lng}),je=await Kn.getNeurone(Dn.id);U(),X(je),ar(!1),wr(null),Si(null)}catch(Dn){console.error("Errore creazione:",Dn)}}}),Vn==="entityActions"&&Ri&&k.jsx(Ize,{neurone:Ri,onClose:()=>{wr(null),Si(null),ks(null)},onVendi:()=>{Ws("vendi"),wr("selectTarget")},onCompra:()=>{Ws("compra"),wr("selectTarget")},onConnetti:()=>{Ws("connetti"),wr("selectTarget")}}),Vn==="selectTarget"&&Ri&&$i&&k.jsx(Rze,{sourceNeurone:Ri,action:$i,onClose:()=>{wr(null),Ws(null),ks(null),Si(null)},onSelectOnMap:()=>{wr(null),ar(!1),Qr(Ri),Sn(!0)},onSelectFromList:()=>{X(Ri),ar(!1),wr(null),Ws(null),ks(null),Si(null)}}),Vn==="connectionType"&&k.jsx(Mze,{onClose:()=>{wr(null),An(null),ks(null),Ws(null),Si(null)},onConfirm:async Ht=>{if(!(!Ri||!Kt))try{await Kn.createSinapsi({neurone_da:Ri.id,neurone_a:Kt.id,tipo_connessione:Ht,data_inizio:new Date().toISOString().split("T")[0],certezza:"ipotesi",livello:"aziendale"}),q(),ar(!1),wr(null),An(null),ks(null),Ws(null),Si(null)}catch(Dn){console.error("Errore creazione connessione:",Dn)}}}),Vn==="transactionForm"&&Ri&&Kt&&$i&&($i==="vendi"||$i==="compra")&&k.jsx(Pze,{sourceNeurone:Ri,targetNeurone:Kt,action:$i,onClose:()=>{wr(null),An(null),ks(null),Ws(null),Si(null),ar(!1)},onConfirm:async Ht=>{try{const Dn=$i==="vendi",je=Dn?Ri.id:Kt.id,jn=Dn?Kt.id:Ri.id,Ir=await Kn.getNeuroneSinapsi(Ri.id);let Gn;const cn=Ir.data.find(xr=>xr.neurone_da===Ri.id&&xr.neurone_a===Kt.id||xr.neurone_da===Kt.id&&xr.neurone_a===Ri.id);cn?(Gn=cn.id,console.log("DEBUG: Usando sinapsi esistente:",Gn)):(Gn=(await Kn.createSinapsi({neurone_da:Ri.id,neurone_a:Kt.id,tipo_connessione:["commerciale"],certezza:"certo",data_inizio:new Date().toISOString().split("T")[0]})).id,console.log("DEBUG: Creata nuova sinapsi:",Gn)),await Kn.createVendita({neurone_id:je,famiglia_id:Ht.famigliaId,importo:Ht.importo,data_vendita:Ht.data,controparte_id:jn,sinapsi_id:Gn,tipo_transazione:"vendita"}),F(),ar(!1),wr(null),An(null),ks(null),Ws(null),Si(null)}catch(Dn){console.error("Errore creazione vendita:",Dn)}}})]}),$&&!wn&&k.jsx(dze,{neurone:$,personalAccess:t,categorie:L,onClose:()=>{ti("panel_close",{panelName:"detail_panel"}),X(null),Sn(!1),rn(null)},onSelectNeurone:async Ht=>{const Dn=y.find(je=>je.id===Ht);if(Dn)bn(Dn);else try{const je=await Kn.getNeurone(Ht);X(je)}catch(je){console.error("Errore caricamento neurone:",je)}},onEdit:()=>{be($),de(!0)},onRequestConnectionMapPick:()=>{Is.current=$,Zi.current=!0,Qr($),Sn(!0)},connectionTargetEntity:Xn,onClearConnectionTarget:()=>{Is.current=null,rn(null),Qr(null)},onSinapsiCreated:q}),Lr&&!wn&&k.jsx(Cze,{sinapsiId:Lr,onClose:()=>{ti("panel_close",{panelName:"sinapsi_panel"}),Tt(null)},onSaved:q})]}),k.jsx(yze,{dataInizio:f.dataInizio||"",dataFine:f.dataFine||"",onChange:(Ht,Dn)=>Hn(je=>({...je,dataInizio:Ht,dataFine:Dn}))})]}),we&&k.jsx(vze,{onVerify:kr,onClose:()=>rt(!1)}),He&&k.jsx(xze,{onSetPin:In,onClose:()=>ft(!1)}),ve&&k.jsx(Sze,{invito:ve,onAccept:()=>{Je(null),window.location.reload()},onDecline:()=>Je(null)}),ie&&k.jsx(Aze,{neurone:fe||void 0,categorie:L,onSave:Ht=>{U(),X(Ht),de(!1),be(null),gn(null),pt(!1),Fe(null)},onClose:()=>{de(!1),be(null),pt(!1),gn(null),Fe(null)},onDelete:fe?async()=>{try{await Kn.deleteNeurone(fe.id),F(),X(null),de(!1),be(null)}catch(Ht){console.error("Errore eliminazione:",Ht),alert("Errore durante l'eliminazione")}}:void 0,onRequestMapPick:()=>pt(!0),pickedPosition:Oe,isPickingMap:nt,onPositionFound:(Ht,Dn)=>Fe({lat:Ht,lng:Dn})}),k.jsx(Nze,{selectedEntity:$,focusedEntity:kn?y.find(Ht=>Ht.id===kn):null,activeFilters:{tipiAttivi:f.tipiSelezionati||[],categorieAttive:f.categorieSelezionate||[],ricerca:f.ricerca||""},sinapsi:S,neuroni:y,isChatOpen:Ct,onSuggestionClick:Ht=>{en(Ht),Nt(!0)}}),k.jsx(Dze,{isOpen:Ct,onClose:()=>Nt(!1),onAction:Ns,selectedEntity:$||(kn?y.find(Ht=>Ht.id===kn):null)||null,visibilityContext:{visibleNeuroniIds:y.map(Ht=>Ht.id),activeFilters:{tipoNeurone:f.tipoNeurone,categoria:f.categoria}},userActions:dt,userName:e==null?void 0:e.nome,initialMessage:Rt,onInitialMessageSent:()=>en(null),aiMarkers:mn,onClearAiMarkers:Ki,copilotContext:sn})]})}const Fze=new uhe({defaultOptions:{queries:{staleTime:1e3*60*5,refetchOnWindowFocus:!0}}});function Bze({children:e}){const{isAuthenticated:t,isLoading:n}=jN();return n?k.jsx("div",{className:"login-container",children:k.jsx("div",{className:"login-card",children:k.jsx("p",{style:{textAlign:"center"},children:"Caricamento..."})})}):t?k.jsx(k.Fragment,{children:e}):k.jsx(Sde,{to:"/login",replace:!0})}function jze(){return k.jsx(che,{client:Fze,children:k.jsx($Le,{runtimeUrl:"/api/ai/copilot-runtime",agent:"default",children:k.jsx(RNe,{children:k.jsx(Dde,{children:k.jsxs(Cde,{children:[k.jsx(M4,{path:"/login",element:k.jsx(PNe,{})}),k.jsx(M4,{path:"/register",element:k.jsx(ONe,{})}),k.jsx(M4,{path:"/*",element:k.jsx(Bze,{children:k.jsx(zze,{})})})]})})})})})}const Uze=localStorage.getItem("theme")||"dark";document.documentElement.setAttribute("data-theme",Uze);uM.createRoot(document.getElementById("root")).render(k.jsx(cs.StrictMode,{children:k.jsx(jze,{})}));const Vze=Object.freeze(Object.defineProperty({__proto__:null,Mermaid:bre},Symbol.toStringTag,{value:"Module"}));export{bh as C,BPe as D,KT as _,OX as a,gH as b,fp as c,E8 as d,UT as g,XEe as h,k as j,v9e as k,B as r,LX as s,Hs as u,Y1 as v,jee as z};
