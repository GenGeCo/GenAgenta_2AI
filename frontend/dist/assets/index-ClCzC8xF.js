var Dae=Object.defineProperty;var V9=e=>{throw TypeError(e)};var Nae=(e,t,n)=>t in e?Dae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var yi=(e,t,n)=>Nae(e,typeof t!="symbol"?t+"":t,n),M6=(e,t,n)=>t.has(e)||V9("Cannot "+n);var At=(e,t,n)=>(M6(e,t,"read from private field"),n?n.call(e):t.get(e)),Vi=(e,t,n)=>t.has(e)?V9("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Kr=(e,t,n,r)=>(M6(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),la=(e,t,n)=>(M6(e,t,"access private method"),n);var ZS=(e,t,n,r)=>({set _(a){Kr(e,t,a,n)},get _(){return At(e,t,r)}});function zae(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in e)){const u=Object.getOwnPropertyDescriptor(r,a);u&&Object.defineProperty(e,a,u.get?u:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function n(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(a){if(a.ep)return;a.ep=!0;const u=n(a);fetch(a.href,u)}})();var ep=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fT(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var dG={exports:{}},CC={},hG={exports:{}},ea={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pT=Symbol.for("react.element"),Fae=Symbol.for("react.portal"),Bae=Symbol.for("react.fragment"),jae=Symbol.for("react.strict_mode"),Uae=Symbol.for("react.profiler"),Vae=Symbol.for("react.provider"),$ae=Symbol.for("react.context"),Hae=Symbol.for("react.forward_ref"),Gae=Symbol.for("react.suspense"),qae=Symbol.for("react.memo"),Wae=Symbol.for("react.lazy"),$9=Symbol.iterator;function Zae(e){return e===null||typeof e!="object"?null:(e=$9&&e[$9]||e["@@iterator"],typeof e=="function"?e:null)}var fG={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},pG=Object.assign,mG={};function Zv(e,t,n){this.props=e,this.context=t,this.refs=mG,this.updater=n||fG}Zv.prototype.isReactComponent={};Zv.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Zv.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function gG(){}gG.prototype=Zv.prototype;function G8(e,t,n){this.props=e,this.context=t,this.refs=mG,this.updater=n||fG}var q8=G8.prototype=new gG;q8.constructor=G8;pG(q8,Zv.prototype);q8.isPureReactComponent=!0;var H9=Array.isArray,_G=Object.prototype.hasOwnProperty,W8={current:null},yG={key:!0,ref:!0,__self:!0,__source:!0};function vG(e,t,n){var r,a={},u=null,f=null;if(t!=null)for(r in t.ref!==void 0&&(f=t.ref),t.key!==void 0&&(u=""+t.key),t)_G.call(t,r)&&!yG.hasOwnProperty(r)&&(a[r]=t[r]);var s=arguments.length-2;if(s===1)a.children=n;else if(1<s){for(var v=Array(s),x=0;x<s;x++)v[x]=arguments[x+2];a.children=v}if(e&&e.defaultProps)for(r in s=e.defaultProps,s)a[r]===void 0&&(a[r]=s[r]);return{$$typeof:pT,type:e,key:u,ref:f,props:a,_owner:W8.current}}function Xae(e,t){return{$$typeof:pT,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Z8(e){return typeof e=="object"&&e!==null&&e.$$typeof===pT}function Yae(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var G9=/\/+/g;function P6(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Yae(""+e.key):t.toString(36)}function H3(e,t,n,r,a){var u=typeof e;(u==="undefined"||u==="boolean")&&(e=null);var f=!1;if(e===null)f=!0;else switch(u){case"string":case"number":f=!0;break;case"object":switch(e.$$typeof){case pT:case Fae:f=!0}}if(f)return f=e,a=a(f),e=r===""?"."+P6(f,0):r,H9(a)?(n="",e!=null&&(n=e.replace(G9,"$&/")+"/"),H3(a,t,n,"",function(x){return x})):a!=null&&(Z8(a)&&(a=Xae(a,n+(!a.key||f&&f.key===a.key?"":(""+a.key).replace(G9,"$&/")+"/")+e)),t.push(a)),1;if(f=0,r=r===""?".":r+":",H9(e))for(var s=0;s<e.length;s++){u=e[s];var v=r+P6(u,s);f+=H3(u,t,n,v,a)}else if(v=Zae(e),typeof v=="function")for(e=v.call(e),s=0;!(u=e.next()).done;)u=u.value,v=r+P6(u,s++),f+=H3(u,t,n,v,a);else if(u==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return f}function XS(e,t,n){if(e==null)return e;var r=[],a=0;return H3(e,r,"","",function(u){return t.call(n,u,a++)}),r}function Kae(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ku={current:null},G3={transition:null},Qae={ReactCurrentDispatcher:ku,ReactCurrentBatchConfig:G3,ReactCurrentOwner:W8};function xG(){throw Error("act(...) is not supported in production builds of React.")}ea.Children={map:XS,forEach:function(e,t,n){XS(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return XS(e,function(){t++}),t},toArray:function(e){return XS(e,function(t){return t})||[]},only:function(e){if(!Z8(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ea.Component=Zv;ea.Fragment=Bae;ea.Profiler=Uae;ea.PureComponent=G8;ea.StrictMode=jae;ea.Suspense=Gae;ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Qae;ea.act=xG;ea.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=pG({},e.props),a=e.key,u=e.ref,f=e._owner;if(t!=null){if(t.ref!==void 0&&(u=t.ref,f=W8.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(v in t)_G.call(t,v)&&!yG.hasOwnProperty(v)&&(r[v]=t[v]===void 0&&s!==void 0?s[v]:t[v])}var v=arguments.length-2;if(v===1)r.children=n;else if(1<v){s=Array(v);for(var x=0;x<v;x++)s[x]=arguments[x+2];r.children=s}return{$$typeof:pT,type:e.type,key:a,ref:u,props:r,_owner:f}};ea.createContext=function(e){return e={$$typeof:$ae,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Vae,_context:e},e.Consumer=e};ea.createElement=vG;ea.createFactory=function(e){var t=vG.bind(null,e);return t.type=e,t};ea.createRef=function(){return{current:null}};ea.forwardRef=function(e){return{$$typeof:Hae,render:e}};ea.isValidElement=Z8;ea.lazy=function(e){return{$$typeof:Wae,_payload:{_status:-1,_result:e},_init:Kae}};ea.memo=function(e,t){return{$$typeof:qae,type:e,compare:t===void 0?null:t}};ea.startTransition=function(e){var t=G3.transition;G3.transition={};try{e()}finally{G3.transition=t}};ea.unstable_act=xG;ea.useCallback=function(e,t){return ku.current.useCallback(e,t)};ea.useContext=function(e){return ku.current.useContext(e)};ea.useDebugValue=function(){};ea.useDeferredValue=function(e){return ku.current.useDeferredValue(e)};ea.useEffect=function(e,t){return ku.current.useEffect(e,t)};ea.useId=function(){return ku.current.useId()};ea.useImperativeHandle=function(e,t,n){return ku.current.useImperativeHandle(e,t,n)};ea.useInsertionEffect=function(e,t){return ku.current.useInsertionEffect(e,t)};ea.useLayoutEffect=function(e,t){return ku.current.useLayoutEffect(e,t)};ea.useMemo=function(e,t){return ku.current.useMemo(e,t)};ea.useReducer=function(e,t,n){return ku.current.useReducer(e,t,n)};ea.useRef=function(e){return ku.current.useRef(e)};ea.useState=function(e){return ku.current.useState(e)};ea.useSyncExternalStore=function(e,t,n){return ku.current.useSyncExternalStore(e,t,n)};ea.useTransition=function(){return ku.current.useTransition()};ea.version="18.3.1";hG.exports=ea;var B=hG.exports;const ca=fT(B),mT=zae({__proto__:null,default:ca},[B]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jae=B,eoe=Symbol.for("react.element"),toe=Symbol.for("react.fragment"),noe=Object.prototype.hasOwnProperty,roe=Jae.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ioe={key:!0,ref:!0,__self:!0,__source:!0};function bG(e,t,n){var r,a={},u=null,f=null;n!==void 0&&(u=""+n),t.key!==void 0&&(u=""+t.key),t.ref!==void 0&&(f=t.ref);for(r in t)noe.call(t,r)&&!ioe.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:eoe,type:e,key:u,ref:f,props:a,_owner:roe.current}}CC.Fragment=toe;CC.jsx=bG;CC.jsxs=bG;dG.exports=CC;var k=dG.exports,kR={},wG={exports:{}},Lc={},TG={exports:{}},EG={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(tt,mt){var Pe=tt.length;tt.push(mt);e:for(;0<Pe;){var gn=Pe-1>>>1,Et=tt[gn];if(0<a(Et,mt))tt[gn]=mt,tt[Pe]=Et,Pe=gn;else break e}}function n(tt){return tt.length===0?null:tt[0]}function r(tt){if(tt.length===0)return null;var mt=tt[0],Pe=tt.pop();if(Pe!==mt){tt[0]=Pe;e:for(var gn=0,Et=tt.length,ze=Et>>>1;gn<ze;){var $t=2*(gn+1)-1,Cn=tt[$t],fn=$t+1,Nn=tt[fn];if(0>a(Cn,Pe))fn<Et&&0>a(Nn,Cn)?(tt[gn]=Nn,tt[fn]=Pe,gn=fn):(tt[gn]=Cn,tt[$t]=Pe,gn=$t);else if(fn<Et&&0>a(Nn,Pe))tt[gn]=Nn,tt[fn]=Pe,gn=fn;else break e}}return mt}function a(tt,mt){var Pe=tt.sortIndex-mt.sortIndex;return Pe!==0?Pe:tt.id-mt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;e.unstable_now=function(){return u.now()}}else{var f=Date,s=f.now();e.unstable_now=function(){return f.now()-s}}var v=[],x=[],A=1,C=null,P=3,L=!1,F=!1,U=!1,q=typeof setTimeout=="function"?setTimeout:null,G=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function X(tt){for(var mt=n(x);mt!==null;){if(mt.callback===null)r(x);else if(mt.startTime<=tt)r(x),mt.sortIndex=mt.expirationTime,t(v,mt);else break;mt=n(x)}}function ie(tt){if(U=!1,X(tt),!F)if(n(v)!==null)F=!0,Nt(de);else{var mt=n(x);mt!==null&&Kt(ie,mt.startTime-tt)}}function de(tt,mt){F=!1,U&&(U=!1,G(ve),ve=-1),L=!0;var Pe=P;try{for(X(mt),C=n(v);C!==null&&(!(C.expirationTime>mt)||tt&&!qe());){var gn=C.callback;if(typeof gn=="function"){C.callback=null,P=C.priorityLevel;var Et=gn(C.expirationTime<=mt);mt=e.unstable_now(),typeof Et=="function"?C.callback=Et:C===n(v)&&r(v),X(mt)}else r(v);C=n(v)}if(C!==null)var ze=!0;else{var $t=n(x);$t!==null&&Kt(ie,$t.startTime-mt),ze=!1}return ze}finally{C=null,P=Pe,L=!1}}var fe=!1,be=null,ve=-1,Qe=5,we=-1;function qe(){return!(e.unstable_now()-we<Qe)}function Je(){if(be!==null){var tt=e.unstable_now();we=tt;var mt=!0;try{mt=be(!0,tt)}finally{mt?ft():(fe=!1,be=null)}}else fe=!1}var ft;if(typeof $=="function")ft=function(){$(Je)};else if(typeof MessageChannel<"u"){var Mt=new MessageChannel,Pt=Mt.port2;Mt.port1.onmessage=Je,ft=function(){Pt.postMessage(null)}}else ft=function(){q(Je,0)};function Nt(tt){be=tt,fe||(fe=!0,ft())}function Kt(tt,mt){ve=q(function(){tt(e.unstable_now())},mt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(tt){tt.callback=null},e.unstable_continueExecution=function(){F||L||(F=!0,Nt(de))},e.unstable_forceFrameRate=function(tt){0>tt||125<tt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Qe=0<tt?Math.floor(1e3/tt):5},e.unstable_getCurrentPriorityLevel=function(){return P},e.unstable_getFirstCallbackNode=function(){return n(v)},e.unstable_next=function(tt){switch(P){case 1:case 2:case 3:var mt=3;break;default:mt=P}var Pe=P;P=mt;try{return tt()}finally{P=Pe}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(tt,mt){switch(tt){case 1:case 2:case 3:case 4:case 5:break;default:tt=3}var Pe=P;P=tt;try{return mt()}finally{P=Pe}},e.unstable_scheduleCallback=function(tt,mt,Pe){var gn=e.unstable_now();switch(typeof Pe=="object"&&Pe!==null?(Pe=Pe.delay,Pe=typeof Pe=="number"&&0<Pe?gn+Pe:gn):Pe=gn,tt){case 1:var Et=-1;break;case 2:Et=250;break;case 5:Et=1073741823;break;case 4:Et=1e4;break;default:Et=5e3}return Et=Pe+Et,tt={id:A++,callback:mt,priorityLevel:tt,startTime:Pe,expirationTime:Et,sortIndex:-1},Pe>gn?(tt.sortIndex=Pe,t(x,tt),n(v)===null&&tt===n(x)&&(U?(G(ve),ve=-1):U=!0,Kt(ie,Pe-gn))):(tt.sortIndex=Et,t(v,tt),F||L||(F=!0,Nt(de))),tt},e.unstable_shouldYield=qe,e.unstable_wrapCallback=function(tt){var mt=P;return function(){var Pe=P;P=mt;try{return tt.apply(this,arguments)}finally{P=Pe}}}})(EG);TG.exports=EG;var soe=TG.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aoe=B,Mc=soe;function sr(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var SG=new Set,y2={};function v_(e,t){wv(e,t),wv(e+"Capture",t)}function wv(e,t){for(y2[e]=t,e=0;e<t.length;e++)SG.add(t[e])}var up=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),IR=Object.prototype.hasOwnProperty,ooe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,q9={},W9={};function loe(e){return IR.call(W9,e)?!0:IR.call(q9,e)?!1:ooe.test(e)?W9[e]=!0:(q9[e]=!0,!1)}function uoe(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function coe(e,t,n,r){if(t===null||typeof t>"u"||uoe(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Iu(e,t,n,r,a,u,f){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=u,this.removeEmptyString=f}var jl={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){jl[e]=new Iu(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];jl[t]=new Iu(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){jl[e]=new Iu(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){jl[e]=new Iu(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){jl[e]=new Iu(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){jl[e]=new Iu(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){jl[e]=new Iu(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){jl[e]=new Iu(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){jl[e]=new Iu(e,5,!1,e.toLowerCase(),null,!1,!1)});var X8=/[\-:]([a-z])/g;function Y8(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(X8,Y8);jl[t]=new Iu(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(X8,Y8);jl[t]=new Iu(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(X8,Y8);jl[t]=new Iu(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){jl[e]=new Iu(e,1,!1,e.toLowerCase(),null,!1,!1)});jl.xlinkHref=new Iu("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){jl[e]=new Iu(e,1,!1,e.toLowerCase(),null,!0,!0)});function K8(e,t,n,r){var a=jl.hasOwnProperty(t)?jl[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(coe(t,n,a,r)&&(n=null),r||a===null?loe(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=n===null?a.type===3?!1:"":n:(t=a.attributeName,r=a.attributeNamespace,n===null?e.removeAttribute(t):(a=a.type,n=a===3||a===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var bp=aoe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,YS=Symbol.for("react.element"),O1=Symbol.for("react.portal"),L1=Symbol.for("react.fragment"),Q8=Symbol.for("react.strict_mode"),RR=Symbol.for("react.profiler"),AG=Symbol.for("react.provider"),CG=Symbol.for("react.context"),J8=Symbol.for("react.forward_ref"),MR=Symbol.for("react.suspense"),PR=Symbol.for("react.suspense_list"),eO=Symbol.for("react.memo"),_m=Symbol.for("react.lazy"),kG=Symbol.for("react.offscreen"),Z9=Symbol.iterator;function mw(e){return e===null||typeof e!="object"?null:(e=Z9&&e[Z9]||e["@@iterator"],typeof e=="function"?e:null)}var Ro=Object.assign,O6;function Ow(e){if(O6===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);O6=t&&t[1]||""}return`
`+O6+e}var L6=!1;function D6(e,t){if(!e||L6)return"";L6=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(x){var r=x}Reflect.construct(e,[],t)}else{try{t.call()}catch(x){r=x}e.call(t.prototype)}else{try{throw Error()}catch(x){r=x}e()}}catch(x){if(x&&r&&typeof x.stack=="string"){for(var a=x.stack.split(`
`),u=r.stack.split(`
`),f=a.length-1,s=u.length-1;1<=f&&0<=s&&a[f]!==u[s];)s--;for(;1<=f&&0<=s;f--,s--)if(a[f]!==u[s]){if(f!==1||s!==1)do if(f--,s--,0>s||a[f]!==u[s]){var v=`
`+a[f].replace(" at new "," at ");return e.displayName&&v.includes("<anonymous>")&&(v=v.replace("<anonymous>",e.displayName)),v}while(1<=f&&0<=s);break}}}finally{L6=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Ow(e):""}function doe(e){switch(e.tag){case 5:return Ow(e.type);case 16:return Ow("Lazy");case 13:return Ow("Suspense");case 19:return Ow("SuspenseList");case 0:case 2:case 15:return e=D6(e.type,!1),e;case 11:return e=D6(e.type.render,!1),e;case 1:return e=D6(e.type,!0),e;default:return""}}function OR(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case L1:return"Fragment";case O1:return"Portal";case RR:return"Profiler";case Q8:return"StrictMode";case MR:return"Suspense";case PR:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case CG:return(e.displayName||"Context")+".Consumer";case AG:return(e._context.displayName||"Context")+".Provider";case J8:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case eO:return t=e.displayName||null,t!==null?t:OR(e.type)||"Memo";case _m:t=e._payload,e=e._init;try{return OR(e(t))}catch{}}return null}function hoe(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return OR(t);case 8:return t===Q8?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function t0(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function IG(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function foe(e){var t=IG(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var a=n.get,u=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(f){r=""+f,u.call(this,f)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(f){r=""+f},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function KS(e){e._valueTracker||(e._valueTracker=foe(e))}function RG(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=IG(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function G4(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function LR(e,t){var n=t.checked;return Ro({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function X9(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=t0(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function MG(e,t){t=t.checked,t!=null&&K8(e,"checked",t,!1)}function DR(e,t){MG(e,t);var n=t0(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?NR(e,t.type,n):t.hasOwnProperty("defaultValue")&&NR(e,t.type,t0(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Y9(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function NR(e,t,n){(t!=="number"||G4(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Lw=Array.isArray;function Z1(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+t0(n),t=null,a=0;a<e.length;a++){if(e[a].value===n){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function zR(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(sr(91));return Ro({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function K9(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(sr(92));if(Lw(n)){if(1<n.length)throw Error(sr(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:t0(n)}}function PG(e,t){var n=t0(t.value),r=t0(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function Q9(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function OG(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function FR(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?OG(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var QS,LG=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(QS=QS||document.createElement("div"),QS.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=QS.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function v2(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Yw={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},poe=["Webkit","ms","Moz","O"];Object.keys(Yw).forEach(function(e){poe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Yw[t]=Yw[e]})});function DG(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Yw.hasOwnProperty(e)&&Yw[e]?(""+t).trim():t+"px"}function NG(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,a=DG(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}var moe=Ro({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function BR(e,t){if(t){if(moe[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(sr(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(sr(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(sr(61))}if(t.style!=null&&typeof t.style!="object")throw Error(sr(62))}}function jR(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var UR=null;function tO(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var VR=null,X1=null,Y1=null;function J9(e){if(e=yT(e)){if(typeof VR!="function")throw Error(sr(280));var t=e.stateNode;t&&(t=PC(t),VR(e.stateNode,e.type,t))}}function zG(e){X1?Y1?Y1.push(e):Y1=[e]:X1=e}function FG(){if(X1){var e=X1,t=Y1;if(Y1=X1=null,J9(e),t)for(e=0;e<t.length;e++)J9(t[e])}}function BG(e,t){return e(t)}function jG(){}var N6=!1;function UG(e,t,n){if(N6)return e(t,n);N6=!0;try{return BG(e,t,n)}finally{N6=!1,(X1!==null||Y1!==null)&&(jG(),FG())}}function x2(e,t){var n=e.stateNode;if(n===null)return null;var r=PC(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(sr(231,t,typeof n));return n}var $R=!1;if(up)try{var gw={};Object.defineProperty(gw,"passive",{get:function(){$R=!0}}),window.addEventListener("test",gw,gw),window.removeEventListener("test",gw,gw)}catch{$R=!1}function goe(e,t,n,r,a,u,f,s,v){var x=Array.prototype.slice.call(arguments,3);try{t.apply(n,x)}catch(A){this.onError(A)}}var Kw=!1,q4=null,W4=!1,HR=null,_oe={onError:function(e){Kw=!0,q4=e}};function yoe(e,t,n,r,a,u,f,s,v){Kw=!1,q4=null,goe.apply(_oe,arguments)}function voe(e,t,n,r,a,u,f,s,v){if(yoe.apply(this,arguments),Kw){if(Kw){var x=q4;Kw=!1,q4=null}else throw Error(sr(198));W4||(W4=!0,HR=x)}}function x_(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function VG(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function eF(e){if(x_(e)!==e)throw Error(sr(188))}function xoe(e){var t=e.alternate;if(!t){if(t=x_(e),t===null)throw Error(sr(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(a===null)break;var u=a.alternate;if(u===null){if(r=a.return,r!==null){n=r;continue}break}if(a.child===u.child){for(u=a.child;u;){if(u===n)return eF(a),e;if(u===r)return eF(a),t;u=u.sibling}throw Error(sr(188))}if(n.return!==r.return)n=a,r=u;else{for(var f=!1,s=a.child;s;){if(s===n){f=!0,n=a,r=u;break}if(s===r){f=!0,r=a,n=u;break}s=s.sibling}if(!f){for(s=u.child;s;){if(s===n){f=!0,n=u,r=a;break}if(s===r){f=!0,r=u,n=a;break}s=s.sibling}if(!f)throw Error(sr(189))}}if(n.alternate!==r)throw Error(sr(190))}if(n.tag!==3)throw Error(sr(188));return n.stateNode.current===n?e:t}function $G(e){return e=xoe(e),e!==null?HG(e):null}function HG(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=HG(e);if(t!==null)return t;e=e.sibling}return null}var GG=Mc.unstable_scheduleCallback,tF=Mc.unstable_cancelCallback,boe=Mc.unstable_shouldYield,woe=Mc.unstable_requestPaint,$o=Mc.unstable_now,Toe=Mc.unstable_getCurrentPriorityLevel,nO=Mc.unstable_ImmediatePriority,qG=Mc.unstable_UserBlockingPriority,Z4=Mc.unstable_NormalPriority,Eoe=Mc.unstable_LowPriority,WG=Mc.unstable_IdlePriority,kC=null,ef=null;function Soe(e){if(ef&&typeof ef.onCommitFiberRoot=="function")try{ef.onCommitFiberRoot(kC,e,void 0,(e.current.flags&128)===128)}catch{}}var nh=Math.clz32?Math.clz32:koe,Aoe=Math.log,Coe=Math.LN2;function koe(e){return e>>>=0,e===0?32:31-(Aoe(e)/Coe|0)|0}var JS=64,e3=4194304;function Dw(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function X4(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,a=e.suspendedLanes,u=e.pingedLanes,f=n&268435455;if(f!==0){var s=f&~a;s!==0?r=Dw(s):(u&=f,u!==0&&(r=Dw(u)))}else f=n&~a,f!==0?r=Dw(f):u!==0&&(r=Dw(u));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,u=t&-t,a>=u||a===16&&(u&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-nh(t),a=1<<n,r|=e[n],t&=~a;return r}function Ioe(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Roe(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,u=e.pendingLanes;0<u;){var f=31-nh(u),s=1<<f,v=a[f];v===-1?(!(s&n)||s&r)&&(a[f]=Ioe(s,t)):v<=t&&(e.expiredLanes|=s),u&=~s}}function GR(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function ZG(){var e=JS;return JS<<=1,!(JS&4194240)&&(JS=64),e}function z6(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gT(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-nh(t),e[t]=n}function Moe(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-nh(n),u=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~u}}function rO(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-nh(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var Na=0;function XG(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var YG,iO,KG,QG,JG,qR=!1,t3=[],Um=null,Vm=null,$m=null,b2=new Map,w2=new Map,Em=[],Poe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function nF(e,t){switch(e){case"focusin":case"focusout":Um=null;break;case"dragenter":case"dragleave":Vm=null;break;case"mouseover":case"mouseout":$m=null;break;case"pointerover":case"pointerout":b2.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":w2.delete(t.pointerId)}}function _w(e,t,n,r,a,u){return e===null||e.nativeEvent!==u?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:u,targetContainers:[a]},t!==null&&(t=yT(t),t!==null&&iO(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function Ooe(e,t,n,r,a){switch(t){case"focusin":return Um=_w(Um,e,t,n,r,a),!0;case"dragenter":return Vm=_w(Vm,e,t,n,r,a),!0;case"mouseover":return $m=_w($m,e,t,n,r,a),!0;case"pointerover":var u=a.pointerId;return b2.set(u,_w(b2.get(u)||null,e,t,n,r,a)),!0;case"gotpointercapture":return u=a.pointerId,w2.set(u,_w(w2.get(u)||null,e,t,n,r,a)),!0}return!1}function eq(e){var t=Rg(e.target);if(t!==null){var n=x_(t);if(n!==null){if(t=n.tag,t===13){if(t=VG(n),t!==null){e.blockedOn=t,JG(e.priority,function(){KG(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function q3(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=WR(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);UR=r,n.target.dispatchEvent(r),UR=null}else return t=yT(n),t!==null&&iO(t),e.blockedOn=n,!1;t.shift()}return!0}function rF(e,t,n){q3(e)&&n.delete(t)}function Loe(){qR=!1,Um!==null&&q3(Um)&&(Um=null),Vm!==null&&q3(Vm)&&(Vm=null),$m!==null&&q3($m)&&($m=null),b2.forEach(rF),w2.forEach(rF)}function yw(e,t){e.blockedOn===t&&(e.blockedOn=null,qR||(qR=!0,Mc.unstable_scheduleCallback(Mc.unstable_NormalPriority,Loe)))}function T2(e){function t(a){return yw(a,e)}if(0<t3.length){yw(t3[0],e);for(var n=1;n<t3.length;n++){var r=t3[n];r.blockedOn===e&&(r.blockedOn=null)}}for(Um!==null&&yw(Um,e),Vm!==null&&yw(Vm,e),$m!==null&&yw($m,e),b2.forEach(t),w2.forEach(t),n=0;n<Em.length;n++)r=Em[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<Em.length&&(n=Em[0],n.blockedOn===null);)eq(n),n.blockedOn===null&&Em.shift()}var K1=bp.ReactCurrentBatchConfig,Y4=!0;function Doe(e,t,n,r){var a=Na,u=K1.transition;K1.transition=null;try{Na=1,sO(e,t,n,r)}finally{Na=a,K1.transition=u}}function Noe(e,t,n,r){var a=Na,u=K1.transition;K1.transition=null;try{Na=4,sO(e,t,n,r)}finally{Na=a,K1.transition=u}}function sO(e,t,n,r){if(Y4){var a=WR(e,t,n,r);if(a===null)W6(e,t,r,K4,n),nF(e,r);else if(Ooe(a,e,t,n,r))r.stopPropagation();else if(nF(e,r),t&4&&-1<Poe.indexOf(e)){for(;a!==null;){var u=yT(a);if(u!==null&&YG(u),u=WR(e,t,n,r),u===null&&W6(e,t,r,K4,n),u===a)break;a=u}a!==null&&r.stopPropagation()}else W6(e,t,r,null,n)}}var K4=null;function WR(e,t,n,r){if(K4=null,e=tO(r),e=Rg(e),e!==null)if(t=x_(e),t===null)e=null;else if(n=t.tag,n===13){if(e=VG(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return K4=e,null}function tq(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Toe()){case nO:return 1;case qG:return 4;case Z4:case Eoe:return 16;case WG:return 536870912;default:return 16}default:return 16}}var Lm=null,aO=null,W3=null;function nq(){if(W3)return W3;var e,t=aO,n=t.length,r,a="value"in Lm?Lm.value:Lm.textContent,u=a.length;for(e=0;e<n&&t[e]===a[e];e++);var f=n-e;for(r=1;r<=f&&t[n-r]===a[u-r];r++);return W3=a.slice(e,1<r?1-r:void 0)}function Z3(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function n3(){return!0}function iF(){return!1}function Dc(e){function t(n,r,a,u,f){this._reactName=n,this._targetInst=a,this.type=r,this.nativeEvent=u,this.target=f,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(n=e[s],this[s]=n?n(u):u[s]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?n3:iF,this.isPropagationStopped=iF,this}return Ro(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=n3)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=n3)},persist:function(){},isPersistent:n3}),t}var Xv={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},oO=Dc(Xv),_T=Ro({},Xv,{view:0,detail:0}),zoe=Dc(_T),F6,B6,vw,IC=Ro({},_T,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:lO,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==vw&&(vw&&e.type==="mousemove"?(F6=e.screenX-vw.screenX,B6=e.screenY-vw.screenY):B6=F6=0,vw=e),F6)},movementY:function(e){return"movementY"in e?e.movementY:B6}}),sF=Dc(IC),Foe=Ro({},IC,{dataTransfer:0}),Boe=Dc(Foe),joe=Ro({},_T,{relatedTarget:0}),j6=Dc(joe),Uoe=Ro({},Xv,{animationName:0,elapsedTime:0,pseudoElement:0}),Voe=Dc(Uoe),$oe=Ro({},Xv,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Hoe=Dc($oe),Goe=Ro({},Xv,{data:0}),aF=Dc(Goe),qoe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Woe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zoe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Xoe(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Zoe[e])?!!t[e]:!1}function lO(){return Xoe}var Yoe=Ro({},_T,{key:function(e){if(e.key){var t=qoe[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Z3(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Woe[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:lO,charCode:function(e){return e.type==="keypress"?Z3(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Z3(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Koe=Dc(Yoe),Qoe=Ro({},IC,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),oF=Dc(Qoe),Joe=Ro({},_T,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:lO}),ele=Dc(Joe),tle=Ro({},Xv,{propertyName:0,elapsedTime:0,pseudoElement:0}),nle=Dc(tle),rle=Ro({},IC,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),ile=Dc(rle),sle=[9,13,27,32],uO=up&&"CompositionEvent"in window,Qw=null;up&&"documentMode"in document&&(Qw=document.documentMode);var ale=up&&"TextEvent"in window&&!Qw,rq=up&&(!uO||Qw&&8<Qw&&11>=Qw),lF=" ",uF=!1;function iq(e,t){switch(e){case"keyup":return sle.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sq(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var D1=!1;function ole(e,t){switch(e){case"compositionend":return sq(t);case"keypress":return t.which!==32?null:(uF=!0,lF);case"textInput":return e=t.data,e===lF&&uF?null:e;default:return null}}function lle(e,t){if(D1)return e==="compositionend"||!uO&&iq(e,t)?(e=nq(),W3=aO=Lm=null,D1=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return rq&&t.locale!=="ko"?null:t.data;default:return null}}var ule={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cF(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!ule[e.type]:t==="textarea"}function aq(e,t,n,r){zG(r),t=Q4(t,"onChange"),0<t.length&&(n=new oO("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Jw=null,E2=null;function cle(e){_q(e,0)}function RC(e){var t=F1(e);if(RG(t))return e}function dle(e,t){if(e==="change")return t}var oq=!1;if(up){var U6;if(up){var V6="oninput"in document;if(!V6){var dF=document.createElement("div");dF.setAttribute("oninput","return;"),V6=typeof dF.oninput=="function"}U6=V6}else U6=!1;oq=U6&&(!document.documentMode||9<document.documentMode)}function hF(){Jw&&(Jw.detachEvent("onpropertychange",lq),E2=Jw=null)}function lq(e){if(e.propertyName==="value"&&RC(E2)){var t=[];aq(t,E2,e,tO(e)),UG(cle,t)}}function hle(e,t,n){e==="focusin"?(hF(),Jw=t,E2=n,Jw.attachEvent("onpropertychange",lq)):e==="focusout"&&hF()}function fle(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return RC(E2)}function ple(e,t){if(e==="click")return RC(t)}function mle(e,t){if(e==="input"||e==="change")return RC(t)}function gle(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var sh=typeof Object.is=="function"?Object.is:gle;function S2(e,t){if(sh(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!IR.call(t,a)||!sh(e[a],t[a]))return!1}return!0}function fF(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function pF(e,t){var n=fF(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=fF(n)}}function uq(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?uq(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function cq(){for(var e=window,t=G4();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=G4(e.document)}return t}function cO(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function _le(e){var t=cq(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&uq(n.ownerDocument.documentElement,n)){if(r!==null&&cO(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=n.textContent.length,u=Math.min(r.start,a);r=r.end===void 0?u:Math.min(r.end,a),!e.extend&&u>r&&(a=r,r=u,u=a),a=pF(n,u);var f=pF(n,r);a&&f&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==f.node||e.focusOffset!==f.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),u>r?(e.addRange(t),e.extend(f.node,f.offset)):(t.setEnd(f.node,f.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var yle=up&&"documentMode"in document&&11>=document.documentMode,N1=null,ZR=null,e2=null,XR=!1;function mF(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;XR||N1==null||N1!==G4(r)||(r=N1,"selectionStart"in r&&cO(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),e2&&S2(e2,r)||(e2=r,r=Q4(ZR,"onSelect"),0<r.length&&(t=new oO("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=N1)))}function r3(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var z1={animationend:r3("Animation","AnimationEnd"),animationiteration:r3("Animation","AnimationIteration"),animationstart:r3("Animation","AnimationStart"),transitionend:r3("Transition","TransitionEnd")},$6={},dq={};up&&(dq=document.createElement("div").style,"AnimationEvent"in window||(delete z1.animationend.animation,delete z1.animationiteration.animation,delete z1.animationstart.animation),"TransitionEvent"in window||delete z1.transitionend.transition);function MC(e){if($6[e])return $6[e];if(!z1[e])return e;var t=z1[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in dq)return $6[e]=t[n];return e}var hq=MC("animationend"),fq=MC("animationiteration"),pq=MC("animationstart"),mq=MC("transitionend"),gq=new Map,gF="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _0(e,t){gq.set(e,t),v_(t,[e])}for(var H6=0;H6<gF.length;H6++){var G6=gF[H6],vle=G6.toLowerCase(),xle=G6[0].toUpperCase()+G6.slice(1);_0(vle,"on"+xle)}_0(hq,"onAnimationEnd");_0(fq,"onAnimationIteration");_0(pq,"onAnimationStart");_0("dblclick","onDoubleClick");_0("focusin","onFocus");_0("focusout","onBlur");_0(mq,"onTransitionEnd");wv("onMouseEnter",["mouseout","mouseover"]);wv("onMouseLeave",["mouseout","mouseover"]);wv("onPointerEnter",["pointerout","pointerover"]);wv("onPointerLeave",["pointerout","pointerover"]);v_("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));v_("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));v_("onBeforeInput",["compositionend","keypress","textInput","paste"]);v_("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));v_("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));v_("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nw="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ble=new Set("cancel close invalid load scroll toggle".split(" ").concat(Nw));function _F(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,voe(r,t,void 0,e),e.currentTarget=null}function _q(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var u=void 0;if(t)for(var f=r.length-1;0<=f;f--){var s=r[f],v=s.instance,x=s.currentTarget;if(s=s.listener,v!==u&&a.isPropagationStopped())break e;_F(a,s,x),u=v}else for(f=0;f<r.length;f++){if(s=r[f],v=s.instance,x=s.currentTarget,s=s.listener,v!==u&&a.isPropagationStopped())break e;_F(a,s,x),u=v}}}if(W4)throw e=HR,W4=!1,HR=null,e}function lo(e,t){var n=t[eM];n===void 0&&(n=t[eM]=new Set);var r=e+"__bubble";n.has(r)||(yq(t,e,2,!1),n.add(r))}function q6(e,t,n){var r=0;t&&(r|=4),yq(n,e,r,t)}var i3="_reactListening"+Math.random().toString(36).slice(2);function A2(e){if(!e[i3]){e[i3]=!0,SG.forEach(function(n){n!=="selectionchange"&&(ble.has(n)||q6(n,!1,e),q6(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[i3]||(t[i3]=!0,q6("selectionchange",!1,t))}}function yq(e,t,n,r){switch(tq(t)){case 1:var a=Doe;break;case 4:a=Noe;break;default:a=sO}n=a.bind(null,t,n,e),a=void 0,!$R||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):a!==void 0?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function W6(e,t,n,r,a){var u=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var f=r.tag;if(f===3||f===4){var s=r.stateNode.containerInfo;if(s===a||s.nodeType===8&&s.parentNode===a)break;if(f===4)for(f=r.return;f!==null;){var v=f.tag;if((v===3||v===4)&&(v=f.stateNode.containerInfo,v===a||v.nodeType===8&&v.parentNode===a))return;f=f.return}for(;s!==null;){if(f=Rg(s),f===null)return;if(v=f.tag,v===5||v===6){r=u=f;continue e}s=s.parentNode}}r=r.return}UG(function(){var x=u,A=tO(n),C=[];e:{var P=gq.get(e);if(P!==void 0){var L=oO,F=e;switch(e){case"keypress":if(Z3(n)===0)break e;case"keydown":case"keyup":L=Koe;break;case"focusin":F="focus",L=j6;break;case"focusout":F="blur",L=j6;break;case"beforeblur":case"afterblur":L=j6;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":L=sF;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":L=Boe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":L=ele;break;case hq:case fq:case pq:L=Voe;break;case mq:L=nle;break;case"scroll":L=zoe;break;case"wheel":L=ile;break;case"copy":case"cut":case"paste":L=Hoe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":L=oF}var U=(t&4)!==0,q=!U&&e==="scroll",G=U?P!==null?P+"Capture":null:P;U=[];for(var $=x,X;$!==null;){X=$;var ie=X.stateNode;if(X.tag===5&&ie!==null&&(X=ie,G!==null&&(ie=x2($,G),ie!=null&&U.push(C2($,ie,X)))),q)break;$=$.return}0<U.length&&(P=new L(P,F,null,n,A),C.push({event:P,listeners:U}))}}if(!(t&7)){e:{if(P=e==="mouseover"||e==="pointerover",L=e==="mouseout"||e==="pointerout",P&&n!==UR&&(F=n.relatedTarget||n.fromElement)&&(Rg(F)||F[cp]))break e;if((L||P)&&(P=A.window===A?A:(P=A.ownerDocument)?P.defaultView||P.parentWindow:window,L?(F=n.relatedTarget||n.toElement,L=x,F=F?Rg(F):null,F!==null&&(q=x_(F),F!==q||F.tag!==5&&F.tag!==6)&&(F=null)):(L=null,F=x),L!==F)){if(U=sF,ie="onMouseLeave",G="onMouseEnter",$="mouse",(e==="pointerout"||e==="pointerover")&&(U=oF,ie="onPointerLeave",G="onPointerEnter",$="pointer"),q=L==null?P:F1(L),X=F==null?P:F1(F),P=new U(ie,$+"leave",L,n,A),P.target=q,P.relatedTarget=X,ie=null,Rg(A)===x&&(U=new U(G,$+"enter",F,n,A),U.target=X,U.relatedTarget=q,ie=U),q=ie,L&&F)t:{for(U=L,G=F,$=0,X=U;X;X=v1(X))$++;for(X=0,ie=G;ie;ie=v1(ie))X++;for(;0<$-X;)U=v1(U),$--;for(;0<X-$;)G=v1(G),X--;for(;$--;){if(U===G||G!==null&&U===G.alternate)break t;U=v1(U),G=v1(G)}U=null}else U=null;L!==null&&yF(C,P,L,U,!1),F!==null&&q!==null&&yF(C,q,F,U,!0)}}e:{if(P=x?F1(x):window,L=P.nodeName&&P.nodeName.toLowerCase(),L==="select"||L==="input"&&P.type==="file")var de=dle;else if(cF(P))if(oq)de=mle;else{de=fle;var fe=hle}else(L=P.nodeName)&&L.toLowerCase()==="input"&&(P.type==="checkbox"||P.type==="radio")&&(de=ple);if(de&&(de=de(e,x))){aq(C,de,n,A);break e}fe&&fe(e,P,x),e==="focusout"&&(fe=P._wrapperState)&&fe.controlled&&P.type==="number"&&NR(P,"number",P.value)}switch(fe=x?F1(x):window,e){case"focusin":(cF(fe)||fe.contentEditable==="true")&&(N1=fe,ZR=x,e2=null);break;case"focusout":e2=ZR=N1=null;break;case"mousedown":XR=!0;break;case"contextmenu":case"mouseup":case"dragend":XR=!1,mF(C,n,A);break;case"selectionchange":if(yle)break;case"keydown":case"keyup":mF(C,n,A)}var be;if(uO)e:{switch(e){case"compositionstart":var ve="onCompositionStart";break e;case"compositionend":ve="onCompositionEnd";break e;case"compositionupdate":ve="onCompositionUpdate";break e}ve=void 0}else D1?iq(e,n)&&(ve="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(ve="onCompositionStart");ve&&(rq&&n.locale!=="ko"&&(D1||ve!=="onCompositionStart"?ve==="onCompositionEnd"&&D1&&(be=nq()):(Lm=A,aO="value"in Lm?Lm.value:Lm.textContent,D1=!0)),fe=Q4(x,ve),0<fe.length&&(ve=new aF(ve,e,null,n,A),C.push({event:ve,listeners:fe}),be?ve.data=be:(be=sq(n),be!==null&&(ve.data=be)))),(be=ale?ole(e,n):lle(e,n))&&(x=Q4(x,"onBeforeInput"),0<x.length&&(A=new aF("onBeforeInput","beforeinput",null,n,A),C.push({event:A,listeners:x}),A.data=be))}_q(C,t)})}function C2(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Q4(e,t){for(var n=t+"Capture",r=[];e!==null;){var a=e,u=a.stateNode;a.tag===5&&u!==null&&(a=u,u=x2(e,n),u!=null&&r.unshift(C2(e,u,a)),u=x2(e,t),u!=null&&r.push(C2(e,u,a))),e=e.return}return r}function v1(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function yF(e,t,n,r,a){for(var u=t._reactName,f=[];n!==null&&n!==r;){var s=n,v=s.alternate,x=s.stateNode;if(v!==null&&v===r)break;s.tag===5&&x!==null&&(s=x,a?(v=x2(n,u),v!=null&&f.unshift(C2(n,v,s))):a||(v=x2(n,u),v!=null&&f.push(C2(n,v,s)))),n=n.return}f.length!==0&&e.push({event:t,listeners:f})}var wle=/\r\n?/g,Tle=/\u0000|\uFFFD/g;function vF(e){return(typeof e=="string"?e:""+e).replace(wle,`
`).replace(Tle,"")}function s3(e,t,n){if(t=vF(t),vF(e)!==t&&n)throw Error(sr(425))}function J4(){}var YR=null,KR=null;function QR(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var JR=typeof setTimeout=="function"?setTimeout:void 0,Ele=typeof clearTimeout=="function"?clearTimeout:void 0,xF=typeof Promise=="function"?Promise:void 0,Sle=typeof queueMicrotask=="function"?queueMicrotask:typeof xF<"u"?function(e){return xF.resolve(null).then(e).catch(Ale)}:JR;function Ale(e){setTimeout(function(){throw e})}function Z6(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"){if(r===0){e.removeChild(a),T2(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=a}while(n);T2(t)}function Hm(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function bF(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Yv=Math.random().toString(36).slice(2),Wh="__reactFiber$"+Yv,k2="__reactProps$"+Yv,cp="__reactContainer$"+Yv,eM="__reactEvents$"+Yv,Cle="__reactListeners$"+Yv,kle="__reactHandles$"+Yv;function Rg(e){var t=e[Wh];if(t)return t;for(var n=e.parentNode;n;){if(t=n[cp]||n[Wh]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=bF(e);e!==null;){if(n=e[Wh])return n;e=bF(e)}return t}e=n,n=e.parentNode}return null}function yT(e){return e=e[Wh]||e[cp],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function F1(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(sr(33))}function PC(e){return e[k2]||null}var tM=[],B1=-1;function y0(e){return{current:e}}function co(e){0>B1||(e.current=tM[B1],tM[B1]=null,B1--)}function ro(e,t){B1++,tM[B1]=e.current,e.current=t}var n0={},nu=y0(n0),Yu=y0(!1),Qg=n0;function Tv(e,t){var n=e.type.contextTypes;if(!n)return n0;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},u;for(u in n)a[u]=t[u];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Ku(e){return e=e.childContextTypes,e!=null}function eA(){co(Yu),co(nu)}function wF(e,t,n){if(nu.current!==n0)throw Error(sr(168));ro(nu,t),ro(Yu,n)}function vq(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(sr(108,hoe(e)||"Unknown",a));return Ro({},n,r)}function tA(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||n0,Qg=nu.current,ro(nu,e),ro(Yu,Yu.current),!0}function TF(e,t,n){var r=e.stateNode;if(!r)throw Error(sr(169));n?(e=vq(e,t,Qg),r.__reactInternalMemoizedMergedChildContext=e,co(Yu),co(nu),ro(nu,e)):co(Yu),ro(Yu,n)}var Zf=null,OC=!1,X6=!1;function xq(e){Zf===null?Zf=[e]:Zf.push(e)}function Ile(e){OC=!0,xq(e)}function v0(){if(!X6&&Zf!==null){X6=!0;var e=0,t=Na;try{var n=Zf;for(Na=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}Zf=null,OC=!1}catch(a){throw Zf!==null&&(Zf=Zf.slice(e+1)),GG(nO,v0),a}finally{Na=t,X6=!1}}return null}var j1=[],U1=0,nA=null,rA=0,nd=[],rd=0,Jg=null,tp=1,np="";function Ag(e,t){j1[U1++]=rA,j1[U1++]=nA,nA=e,rA=t}function bq(e,t,n){nd[rd++]=tp,nd[rd++]=np,nd[rd++]=Jg,Jg=e;var r=tp;e=np;var a=32-nh(r)-1;r&=~(1<<a),n+=1;var u=32-nh(t)+a;if(30<u){var f=a-a%5;u=(r&(1<<f)-1).toString(32),r>>=f,a-=f,tp=1<<32-nh(t)+a|n<<a|r,np=u+e}else tp=1<<u|n<<a|r,np=e}function dO(e){e.return!==null&&(Ag(e,1),bq(e,1,0))}function hO(e){for(;e===nA;)nA=j1[--U1],j1[U1]=null,rA=j1[--U1],j1[U1]=null;for(;e===Jg;)Jg=nd[--rd],nd[rd]=null,np=nd[--rd],nd[rd]=null,tp=nd[--rd],nd[rd]=null}var Cc=null,Sc=null,yo=!1,eh=null;function wq(e,t){var n=od(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function EF(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Cc=e,Sc=Hm(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Cc=e,Sc=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Jg!==null?{id:tp,overflow:np}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=od(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,Cc=e,Sc=null,!0):!1;default:return!1}}function nM(e){return(e.mode&1)!==0&&(e.flags&128)===0}function rM(e){if(yo){var t=Sc;if(t){var n=t;if(!EF(e,t)){if(nM(e))throw Error(sr(418));t=Hm(n.nextSibling);var r=Cc;t&&EF(e,t)?wq(r,n):(e.flags=e.flags&-4097|2,yo=!1,Cc=e)}}else{if(nM(e))throw Error(sr(418));e.flags=e.flags&-4097|2,yo=!1,Cc=e}}}function SF(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Cc=e}function a3(e){if(e!==Cc)return!1;if(!yo)return SF(e),yo=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!QR(e.type,e.memoizedProps)),t&&(t=Sc)){if(nM(e))throw Tq(),Error(sr(418));for(;t;)wq(e,t),t=Hm(t.nextSibling)}if(SF(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(sr(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Sc=Hm(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Sc=null}}else Sc=Cc?Hm(e.stateNode.nextSibling):null;return!0}function Tq(){for(var e=Sc;e;)e=Hm(e.nextSibling)}function Ev(){Sc=Cc=null,yo=!1}function fO(e){eh===null?eh=[e]:eh.push(e)}var Rle=bp.ReactCurrentBatchConfig;function xw(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(sr(309));var r=n.stateNode}if(!r)throw Error(sr(147,e));var a=r,u=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===u?t.ref:(t=function(f){var s=a.refs;f===null?delete s[u]:s[u]=f},t._stringRef=u,t)}if(typeof e!="string")throw Error(sr(284));if(!n._owner)throw Error(sr(290,e))}return e}function o3(e,t){throw e=Object.prototype.toString.call(t),Error(sr(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function AF(e){var t=e._init;return t(e._payload)}function Eq(e){function t(G,$){if(e){var X=G.deletions;X===null?(G.deletions=[$],G.flags|=16):X.push($)}}function n(G,$){if(!e)return null;for(;$!==null;)t(G,$),$=$.sibling;return null}function r(G,$){for(G=new Map;$!==null;)$.key!==null?G.set($.key,$):G.set($.index,$),$=$.sibling;return G}function a(G,$){return G=Zm(G,$),G.index=0,G.sibling=null,G}function u(G,$,X){return G.index=X,e?(X=G.alternate,X!==null?(X=X.index,X<$?(G.flags|=2,$):X):(G.flags|=2,$)):(G.flags|=1048576,$)}function f(G){return e&&G.alternate===null&&(G.flags|=2),G}function s(G,$,X,ie){return $===null||$.tag!==6?($=n5(X,G.mode,ie),$.return=G,$):($=a($,X),$.return=G,$)}function v(G,$,X,ie){var de=X.type;return de===L1?A(G,$,X.props.children,ie,X.key):$!==null&&($.elementType===de||typeof de=="object"&&de!==null&&de.$$typeof===_m&&AF(de)===$.type)?(ie=a($,X.props),ie.ref=xw(G,$,X),ie.return=G,ie):(ie=t4(X.type,X.key,X.props,null,G.mode,ie),ie.ref=xw(G,$,X),ie.return=G,ie)}function x(G,$,X,ie){return $===null||$.tag!==4||$.stateNode.containerInfo!==X.containerInfo||$.stateNode.implementation!==X.implementation?($=r5(X,G.mode,ie),$.return=G,$):($=a($,X.children||[]),$.return=G,$)}function A(G,$,X,ie,de){return $===null||$.tag!==7?($=qg(X,G.mode,ie,de),$.return=G,$):($=a($,X),$.return=G,$)}function C(G,$,X){if(typeof $=="string"&&$!==""||typeof $=="number")return $=n5(""+$,G.mode,X),$.return=G,$;if(typeof $=="object"&&$!==null){switch($.$$typeof){case YS:return X=t4($.type,$.key,$.props,null,G.mode,X),X.ref=xw(G,null,$),X.return=G,X;case O1:return $=r5($,G.mode,X),$.return=G,$;case _m:var ie=$._init;return C(G,ie($._payload),X)}if(Lw($)||mw($))return $=qg($,G.mode,X,null),$.return=G,$;o3(G,$)}return null}function P(G,$,X,ie){var de=$!==null?$.key:null;if(typeof X=="string"&&X!==""||typeof X=="number")return de!==null?null:s(G,$,""+X,ie);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case YS:return X.key===de?v(G,$,X,ie):null;case O1:return X.key===de?x(G,$,X,ie):null;case _m:return de=X._init,P(G,$,de(X._payload),ie)}if(Lw(X)||mw(X))return de!==null?null:A(G,$,X,ie,null);o3(G,X)}return null}function L(G,$,X,ie,de){if(typeof ie=="string"&&ie!==""||typeof ie=="number")return G=G.get(X)||null,s($,G,""+ie,de);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case YS:return G=G.get(ie.key===null?X:ie.key)||null,v($,G,ie,de);case O1:return G=G.get(ie.key===null?X:ie.key)||null,x($,G,ie,de);case _m:var fe=ie._init;return L(G,$,X,fe(ie._payload),de)}if(Lw(ie)||mw(ie))return G=G.get(X)||null,A($,G,ie,de,null);o3($,ie)}return null}function F(G,$,X,ie){for(var de=null,fe=null,be=$,ve=$=0,Qe=null;be!==null&&ve<X.length;ve++){be.index>ve?(Qe=be,be=null):Qe=be.sibling;var we=P(G,be,X[ve],ie);if(we===null){be===null&&(be=Qe);break}e&&be&&we.alternate===null&&t(G,be),$=u(we,$,ve),fe===null?de=we:fe.sibling=we,fe=we,be=Qe}if(ve===X.length)return n(G,be),yo&&Ag(G,ve),de;if(be===null){for(;ve<X.length;ve++)be=C(G,X[ve],ie),be!==null&&($=u(be,$,ve),fe===null?de=be:fe.sibling=be,fe=be);return yo&&Ag(G,ve),de}for(be=r(G,be);ve<X.length;ve++)Qe=L(be,G,ve,X[ve],ie),Qe!==null&&(e&&Qe.alternate!==null&&be.delete(Qe.key===null?ve:Qe.key),$=u(Qe,$,ve),fe===null?de=Qe:fe.sibling=Qe,fe=Qe);return e&&be.forEach(function(qe){return t(G,qe)}),yo&&Ag(G,ve),de}function U(G,$,X,ie){var de=mw(X);if(typeof de!="function")throw Error(sr(150));if(X=de.call(X),X==null)throw Error(sr(151));for(var fe=de=null,be=$,ve=$=0,Qe=null,we=X.next();be!==null&&!we.done;ve++,we=X.next()){be.index>ve?(Qe=be,be=null):Qe=be.sibling;var qe=P(G,be,we.value,ie);if(qe===null){be===null&&(be=Qe);break}e&&be&&qe.alternate===null&&t(G,be),$=u(qe,$,ve),fe===null?de=qe:fe.sibling=qe,fe=qe,be=Qe}if(we.done)return n(G,be),yo&&Ag(G,ve),de;if(be===null){for(;!we.done;ve++,we=X.next())we=C(G,we.value,ie),we!==null&&($=u(we,$,ve),fe===null?de=we:fe.sibling=we,fe=we);return yo&&Ag(G,ve),de}for(be=r(G,be);!we.done;ve++,we=X.next())we=L(be,G,ve,we.value,ie),we!==null&&(e&&we.alternate!==null&&be.delete(we.key===null?ve:we.key),$=u(we,$,ve),fe===null?de=we:fe.sibling=we,fe=we);return e&&be.forEach(function(Je){return t(G,Je)}),yo&&Ag(G,ve),de}function q(G,$,X,ie){if(typeof X=="object"&&X!==null&&X.type===L1&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case YS:e:{for(var de=X.key,fe=$;fe!==null;){if(fe.key===de){if(de=X.type,de===L1){if(fe.tag===7){n(G,fe.sibling),$=a(fe,X.props.children),$.return=G,G=$;break e}}else if(fe.elementType===de||typeof de=="object"&&de!==null&&de.$$typeof===_m&&AF(de)===fe.type){n(G,fe.sibling),$=a(fe,X.props),$.ref=xw(G,fe,X),$.return=G,G=$;break e}n(G,fe);break}else t(G,fe);fe=fe.sibling}X.type===L1?($=qg(X.props.children,G.mode,ie,X.key),$.return=G,G=$):(ie=t4(X.type,X.key,X.props,null,G.mode,ie),ie.ref=xw(G,$,X),ie.return=G,G=ie)}return f(G);case O1:e:{for(fe=X.key;$!==null;){if($.key===fe)if($.tag===4&&$.stateNode.containerInfo===X.containerInfo&&$.stateNode.implementation===X.implementation){n(G,$.sibling),$=a($,X.children||[]),$.return=G,G=$;break e}else{n(G,$);break}else t(G,$);$=$.sibling}$=r5(X,G.mode,ie),$.return=G,G=$}return f(G);case _m:return fe=X._init,q(G,$,fe(X._payload),ie)}if(Lw(X))return F(G,$,X,ie);if(mw(X))return U(G,$,X,ie);o3(G,X)}return typeof X=="string"&&X!==""||typeof X=="number"?(X=""+X,$!==null&&$.tag===6?(n(G,$.sibling),$=a($,X),$.return=G,G=$):(n(G,$),$=n5(X,G.mode,ie),$.return=G,G=$),f(G)):n(G,$)}return q}var Sv=Eq(!0),Sq=Eq(!1),iA=y0(null),sA=null,V1=null,pO=null;function mO(){pO=V1=sA=null}function gO(e){var t=iA.current;co(iA),e._currentValue=t}function iM(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Q1(e,t){sA=e,pO=V1=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Xu=!0),e.firstContext=null)}function dd(e){var t=e._currentValue;if(pO!==e)if(e={context:e,memoizedValue:t,next:null},V1===null){if(sA===null)throw Error(sr(308));V1=e,sA.dependencies={lanes:0,firstContext:e}}else V1=V1.next=e;return t}var Mg=null;function _O(e){Mg===null?Mg=[e]:Mg.push(e)}function Aq(e,t,n,r){var a=t.interleaved;return a===null?(n.next=n,_O(t)):(n.next=a.next,a.next=n),t.interleaved=n,dp(e,r)}function dp(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var ym=!1;function yO(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Cq(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ip(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Gm(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,xa&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,dp(e,n)}return a=r.interleaved,a===null?(t.next=t,_O(r)):(t.next=a.next,a.next=t),r.interleaved=t,dp(e,n)}function X3(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,rO(e,n)}}function CF(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var a=null,u=null;if(n=n.firstBaseUpdate,n!==null){do{var f={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};u===null?a=u=f:u=u.next=f,n=n.next}while(n!==null);u===null?a=u=t:u=u.next=t}else a=u=t;n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:u,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function aA(e,t,n,r){var a=e.updateQueue;ym=!1;var u=a.firstBaseUpdate,f=a.lastBaseUpdate,s=a.shared.pending;if(s!==null){a.shared.pending=null;var v=s,x=v.next;v.next=null,f===null?u=x:f.next=x,f=v;var A=e.alternate;A!==null&&(A=A.updateQueue,s=A.lastBaseUpdate,s!==f&&(s===null?A.firstBaseUpdate=x:s.next=x,A.lastBaseUpdate=v))}if(u!==null){var C=a.baseState;f=0,A=x=v=null,s=u;do{var P=s.lane,L=s.eventTime;if((r&P)===P){A!==null&&(A=A.next={eventTime:L,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var F=e,U=s;switch(P=t,L=n,U.tag){case 1:if(F=U.payload,typeof F=="function"){C=F.call(L,C,P);break e}C=F;break e;case 3:F.flags=F.flags&-65537|128;case 0:if(F=U.payload,P=typeof F=="function"?F.call(L,C,P):F,P==null)break e;C=Ro({},C,P);break e;case 2:ym=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,P=a.effects,P===null?a.effects=[s]:P.push(s))}else L={eventTime:L,lane:P,tag:s.tag,payload:s.payload,callback:s.callback,next:null},A===null?(x=A=L,v=C):A=A.next=L,f|=P;if(s=s.next,s===null){if(s=a.shared.pending,s===null)break;P=s,s=P.next,P.next=null,a.lastBaseUpdate=P,a.shared.pending=null}}while(!0);if(A===null&&(v=C),a.baseState=v,a.firstBaseUpdate=x,a.lastBaseUpdate=A,t=a.shared.interleaved,t!==null){a=t;do f|=a.lane,a=a.next;while(a!==t)}else u===null&&(a.shared.lanes=0);t_|=f,e.lanes=f,e.memoizedState=C}}function kF(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=n,typeof a!="function")throw Error(sr(191,a));a.call(r)}}}var vT={},tf=y0(vT),I2=y0(vT),R2=y0(vT);function Pg(e){if(e===vT)throw Error(sr(174));return e}function vO(e,t){switch(ro(R2,t),ro(I2,e),ro(tf,vT),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:FR(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=FR(t,e)}co(tf),ro(tf,t)}function Av(){co(tf),co(I2),co(R2)}function kq(e){Pg(R2.current);var t=Pg(tf.current),n=FR(t,e.type);t!==n&&(ro(I2,e),ro(tf,n))}function xO(e){I2.current===e&&(co(tf),co(I2))}var Co=y0(0);function oA(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Y6=[];function bO(){for(var e=0;e<Y6.length;e++)Y6[e]._workInProgressVersionPrimary=null;Y6.length=0}var Y3=bp.ReactCurrentDispatcher,K6=bp.ReactCurrentBatchConfig,e_=0,Io=null,dl=null,Tl=null,lA=!1,t2=!1,M2=0,Mle=0;function ql(){throw Error(sr(321))}function wO(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sh(e[n],t[n]))return!1;return!0}function TO(e,t,n,r,a,u){if(e_=u,Io=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Y3.current=e===null||e.memoizedState===null?Dle:Nle,e=n(r,a),t2){u=0;do{if(t2=!1,M2=0,25<=u)throw Error(sr(301));u+=1,Tl=dl=null,t.updateQueue=null,Y3.current=zle,e=n(r,a)}while(t2)}if(Y3.current=uA,t=dl!==null&&dl.next!==null,e_=0,Tl=dl=Io=null,lA=!1,t)throw Error(sr(300));return e}function EO(){var e=M2!==0;return M2=0,e}function Bh(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tl===null?Io.memoizedState=Tl=e:Tl=Tl.next=e,Tl}function hd(){if(dl===null){var e=Io.alternate;e=e!==null?e.memoizedState:null}else e=dl.next;var t=Tl===null?Io.memoizedState:Tl.next;if(t!==null)Tl=t,dl=e;else{if(e===null)throw Error(sr(310));dl=e,e={memoizedState:dl.memoizedState,baseState:dl.baseState,baseQueue:dl.baseQueue,queue:dl.queue,next:null},Tl===null?Io.memoizedState=Tl=e:Tl=Tl.next=e}return Tl}function P2(e,t){return typeof t=="function"?t(e):t}function Q6(e){var t=hd(),n=t.queue;if(n===null)throw Error(sr(311));n.lastRenderedReducer=e;var r=dl,a=r.baseQueue,u=n.pending;if(u!==null){if(a!==null){var f=a.next;a.next=u.next,u.next=f}r.baseQueue=a=u,n.pending=null}if(a!==null){u=a.next,r=r.baseState;var s=f=null,v=null,x=u;do{var A=x.lane;if((e_&A)===A)v!==null&&(v=v.next={lane:0,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null}),r=x.hasEagerState?x.eagerState:e(r,x.action);else{var C={lane:A,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null};v===null?(s=v=C,f=r):v=v.next=C,Io.lanes|=A,t_|=A}x=x.next}while(x!==null&&x!==u);v===null?f=r:v.next=s,sh(r,t.memoizedState)||(Xu=!0),t.memoizedState=r,t.baseState=f,t.baseQueue=v,n.lastRenderedState=r}if(e=n.interleaved,e!==null){a=e;do u=a.lane,Io.lanes|=u,t_|=u,a=a.next;while(a!==e)}else a===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function J6(e){var t=hd(),n=t.queue;if(n===null)throw Error(sr(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,u=t.memoizedState;if(a!==null){n.pending=null;var f=a=a.next;do u=e(u,f.action),f=f.next;while(f!==a);sh(u,t.memoizedState)||(Xu=!0),t.memoizedState=u,t.baseQueue===null&&(t.baseState=u),n.lastRenderedState=u}return[u,r]}function Iq(){}function Rq(e,t){var n=Io,r=hd(),a=t(),u=!sh(r.memoizedState,a);if(u&&(r.memoizedState=a,Xu=!0),r=r.queue,SO(Oq.bind(null,n,r,e),[e]),r.getSnapshot!==t||u||Tl!==null&&Tl.memoizedState.tag&1){if(n.flags|=2048,O2(9,Pq.bind(null,n,r,a,t),void 0,null),Sl===null)throw Error(sr(349));e_&30||Mq(n,t,a)}return a}function Mq(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=Io.updateQueue,t===null?(t={lastEffect:null,stores:null},Io.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Pq(e,t,n,r){t.value=n,t.getSnapshot=r,Lq(t)&&Dq(e)}function Oq(e,t,n){return n(function(){Lq(t)&&Dq(e)})}function Lq(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sh(e,n)}catch{return!0}}function Dq(e){var t=dp(e,1);t!==null&&rh(t,e,1,-1)}function IF(e){var t=Bh();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:P2,lastRenderedState:e},t.queue=e,e=e.dispatch=Lle.bind(null,Io,e),[t.memoizedState,e]}function O2(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=Io.updateQueue,t===null?(t={lastEffect:null,stores:null},Io.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function Nq(){return hd().memoizedState}function K3(e,t,n,r){var a=Bh();Io.flags|=e,a.memoizedState=O2(1|t,n,void 0,r===void 0?null:r)}function LC(e,t,n,r){var a=hd();r=r===void 0?null:r;var u=void 0;if(dl!==null){var f=dl.memoizedState;if(u=f.destroy,r!==null&&wO(r,f.deps)){a.memoizedState=O2(t,n,u,r);return}}Io.flags|=e,a.memoizedState=O2(1|t,n,u,r)}function RF(e,t){return K3(8390656,8,e,t)}function SO(e,t){return LC(2048,8,e,t)}function zq(e,t){return LC(4,2,e,t)}function Fq(e,t){return LC(4,4,e,t)}function Bq(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function jq(e,t,n){return n=n!=null?n.concat([e]):null,LC(4,4,Bq.bind(null,t,e),n)}function AO(){}function Uq(e,t){var n=hd();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&wO(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Vq(e,t){var n=hd();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&wO(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function $q(e,t,n){return e_&21?(sh(n,t)||(n=ZG(),Io.lanes|=n,t_|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Xu=!0),e.memoizedState=n)}function Ple(e,t){var n=Na;Na=n!==0&&4>n?n:4,e(!0);var r=K6.transition;K6.transition={};try{e(!1),t()}finally{Na=n,K6.transition=r}}function Hq(){return hd().memoizedState}function Ole(e,t,n){var r=Wm(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Gq(e))qq(t,n);else if(n=Aq(e,t,n,r),n!==null){var a=Au();rh(n,e,r,a),Wq(n,t,r)}}function Lle(e,t,n){var r=Wm(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Gq(e))qq(t,a);else{var u=e.alternate;if(e.lanes===0&&(u===null||u.lanes===0)&&(u=t.lastRenderedReducer,u!==null))try{var f=t.lastRenderedState,s=u(f,n);if(a.hasEagerState=!0,a.eagerState=s,sh(s,f)){var v=t.interleaved;v===null?(a.next=a,_O(t)):(a.next=v.next,v.next=a),t.interleaved=a;return}}catch{}finally{}n=Aq(e,t,a,r),n!==null&&(a=Au(),rh(n,e,r,a),Wq(n,t,r))}}function Gq(e){var t=e.alternate;return e===Io||t!==null&&t===Io}function qq(e,t){t2=lA=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Wq(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,rO(e,n)}}var uA={readContext:dd,useCallback:ql,useContext:ql,useEffect:ql,useImperativeHandle:ql,useInsertionEffect:ql,useLayoutEffect:ql,useMemo:ql,useReducer:ql,useRef:ql,useState:ql,useDebugValue:ql,useDeferredValue:ql,useTransition:ql,useMutableSource:ql,useSyncExternalStore:ql,useId:ql,unstable_isNewReconciler:!1},Dle={readContext:dd,useCallback:function(e,t){return Bh().memoizedState=[e,t===void 0?null:t],e},useContext:dd,useEffect:RF,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,K3(4194308,4,Bq.bind(null,t,e),n)},useLayoutEffect:function(e,t){return K3(4194308,4,e,t)},useInsertionEffect:function(e,t){return K3(4,2,e,t)},useMemo:function(e,t){var n=Bh();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Bh();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ole.bind(null,Io,e),[r.memoizedState,e]},useRef:function(e){var t=Bh();return e={current:e},t.memoizedState=e},useState:IF,useDebugValue:AO,useDeferredValue:function(e){return Bh().memoizedState=e},useTransition:function(){var e=IF(!1),t=e[0];return e=Ple.bind(null,e[1]),Bh().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=Io,a=Bh();if(yo){if(n===void 0)throw Error(sr(407));n=n()}else{if(n=t(),Sl===null)throw Error(sr(349));e_&30||Mq(r,t,n)}a.memoizedState=n;var u={value:n,getSnapshot:t};return a.queue=u,RF(Oq.bind(null,r,u,e),[e]),r.flags|=2048,O2(9,Pq.bind(null,r,u,n,t),void 0,null),n},useId:function(){var e=Bh(),t=Sl.identifierPrefix;if(yo){var n=np,r=tp;n=(r&~(1<<32-nh(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=M2++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=Mle++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Nle={readContext:dd,useCallback:Uq,useContext:dd,useEffect:SO,useImperativeHandle:jq,useInsertionEffect:zq,useLayoutEffect:Fq,useMemo:Vq,useReducer:Q6,useRef:Nq,useState:function(){return Q6(P2)},useDebugValue:AO,useDeferredValue:function(e){var t=hd();return $q(t,dl.memoizedState,e)},useTransition:function(){var e=Q6(P2)[0],t=hd().memoizedState;return[e,t]},useMutableSource:Iq,useSyncExternalStore:Rq,useId:Hq,unstable_isNewReconciler:!1},zle={readContext:dd,useCallback:Uq,useContext:dd,useEffect:SO,useImperativeHandle:jq,useInsertionEffect:zq,useLayoutEffect:Fq,useMemo:Vq,useReducer:J6,useRef:Nq,useState:function(){return J6(P2)},useDebugValue:AO,useDeferredValue:function(e){var t=hd();return dl===null?t.memoizedState=e:$q(t,dl.memoizedState,e)},useTransition:function(){var e=J6(P2)[0],t=hd().memoizedState;return[e,t]},useMutableSource:Iq,useSyncExternalStore:Rq,useId:Hq,unstable_isNewReconciler:!1};function Xd(e,t){if(e&&e.defaultProps){t=Ro({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function sM(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:Ro({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var DC={isMounted:function(e){return(e=e._reactInternals)?x_(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Au(),a=Wm(e),u=ip(r,a);u.payload=t,n!=null&&(u.callback=n),t=Gm(e,u,a),t!==null&&(rh(t,e,a,r),X3(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Au(),a=Wm(e),u=ip(r,a);u.tag=1,u.payload=t,n!=null&&(u.callback=n),t=Gm(e,u,a),t!==null&&(rh(t,e,a,r),X3(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Au(),r=Wm(e),a=ip(n,r);a.tag=2,t!=null&&(a.callback=t),t=Gm(e,a,r),t!==null&&(rh(t,e,r,n),X3(t,e,r))}};function MF(e,t,n,r,a,u,f){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,u,f):t.prototype&&t.prototype.isPureReactComponent?!S2(n,r)||!S2(a,u):!0}function Zq(e,t,n){var r=!1,a=n0,u=t.contextType;return typeof u=="object"&&u!==null?u=dd(u):(a=Ku(t)?Qg:nu.current,r=t.contextTypes,u=(r=r!=null)?Tv(e,a):n0),t=new t(n,u),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=DC,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=u),t}function PF(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&DC.enqueueReplaceState(t,t.state,null)}function aM(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},yO(e);var u=t.contextType;typeof u=="object"&&u!==null?a.context=dd(u):(u=Ku(t)?Qg:nu.current,a.context=Tv(e,u)),a.state=e.memoizedState,u=t.getDerivedStateFromProps,typeof u=="function"&&(sM(e,t,u,n),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&DC.enqueueReplaceState(a,a.state,null),aA(e,n,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function Cv(e,t){try{var n="",r=t;do n+=doe(r),r=r.return;while(r);var a=n}catch(u){a=`
Error generating stack: `+u.message+`
`+u.stack}return{value:e,source:t,stack:a,digest:null}}function e5(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function oM(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var Fle=typeof WeakMap=="function"?WeakMap:Map;function Xq(e,t,n){n=ip(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){dA||(dA=!0,_M=r),oM(e,t)},n}function Yq(e,t,n){n=ip(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){oM(e,t)}}var u=e.stateNode;return u!==null&&typeof u.componentDidCatch=="function"&&(n.callback=function(){oM(e,t),typeof r!="function"&&(qm===null?qm=new Set([this]):qm.add(this));var f=t.stack;this.componentDidCatch(t.value,{componentStack:f!==null?f:""})}),n}function OF(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new Fle;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Qle.bind(null,e,t,n),t.then(e,e))}function LF(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function DF(e,t,n,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=ip(-1,1),t.tag=2,Gm(n,t,1))),n.lanes|=1),e)}var Ble=bp.ReactCurrentOwner,Xu=!1;function xu(e,t,n,r){t.child=e===null?Sq(t,null,n,r):Sv(t,e.child,n,r)}function NF(e,t,n,r,a){n=n.render;var u=t.ref;return Q1(t,a),r=TO(e,t,n,r,u,a),n=EO(),e!==null&&!Xu?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,hp(e,t,a)):(yo&&n&&dO(t),t.flags|=1,xu(e,t,r,a),t.child)}function zF(e,t,n,r,a){if(e===null){var u=n.type;return typeof u=="function"&&!LO(u)&&u.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=u,Kq(e,t,u,r,a)):(e=t4(n.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(u=e.child,!(e.lanes&a)){var f=u.memoizedProps;if(n=n.compare,n=n!==null?n:S2,n(f,r)&&e.ref===t.ref)return hp(e,t,a)}return t.flags|=1,e=Zm(u,r),e.ref=t.ref,e.return=t,t.child=e}function Kq(e,t,n,r,a){if(e!==null){var u=e.memoizedProps;if(S2(u,r)&&e.ref===t.ref)if(Xu=!1,t.pendingProps=r=u,(e.lanes&a)!==0)e.flags&131072&&(Xu=!0);else return t.lanes=e.lanes,hp(e,t,a)}return lM(e,t,n,r,a)}function Qq(e,t,n){var r=t.pendingProps,a=r.children,u=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ro(H1,wc),wc|=n;else{if(!(n&1073741824))return e=u!==null?u.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ro(H1,wc),wc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=u!==null?u.baseLanes:n,ro(H1,wc),wc|=r}else u!==null?(r=u.baseLanes|n,t.memoizedState=null):r=n,ro(H1,wc),wc|=r;return xu(e,t,a,n),t.child}function Jq(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function lM(e,t,n,r,a){var u=Ku(n)?Qg:nu.current;return u=Tv(t,u),Q1(t,a),n=TO(e,t,n,r,u,a),r=EO(),e!==null&&!Xu?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,hp(e,t,a)):(yo&&r&&dO(t),t.flags|=1,xu(e,t,n,a),t.child)}function FF(e,t,n,r,a){if(Ku(n)){var u=!0;tA(t)}else u=!1;if(Q1(t,a),t.stateNode===null)Q3(e,t),Zq(t,n,r),aM(t,n,r,a),r=!0;else if(e===null){var f=t.stateNode,s=t.memoizedProps;f.props=s;var v=f.context,x=n.contextType;typeof x=="object"&&x!==null?x=dd(x):(x=Ku(n)?Qg:nu.current,x=Tv(t,x));var A=n.getDerivedStateFromProps,C=typeof A=="function"||typeof f.getSnapshotBeforeUpdate=="function";C||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(s!==r||v!==x)&&PF(t,f,r,x),ym=!1;var P=t.memoizedState;f.state=P,aA(t,r,f,a),v=t.memoizedState,s!==r||P!==v||Yu.current||ym?(typeof A=="function"&&(sM(t,n,A,r),v=t.memoizedState),(s=ym||MF(t,n,s,r,P,v,x))?(C||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(t.flags|=4194308)):(typeof f.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=v),f.props=r,f.state=v,f.context=x,r=s):(typeof f.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{f=t.stateNode,Cq(e,t),s=t.memoizedProps,x=t.type===t.elementType?s:Xd(t.type,s),f.props=x,C=t.pendingProps,P=f.context,v=n.contextType,typeof v=="object"&&v!==null?v=dd(v):(v=Ku(n)?Qg:nu.current,v=Tv(t,v));var L=n.getDerivedStateFromProps;(A=typeof L=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(s!==C||P!==v)&&PF(t,f,r,v),ym=!1,P=t.memoizedState,f.state=P,aA(t,r,f,a);var F=t.memoizedState;s!==C||P!==F||Yu.current||ym?(typeof L=="function"&&(sM(t,n,L,r),F=t.memoizedState),(x=ym||MF(t,n,x,r,P,F,v)||!1)?(A||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(r,F,v),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(r,F,v)),typeof f.componentDidUpdate=="function"&&(t.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof f.componentDidUpdate!="function"||s===e.memoizedProps&&P===e.memoizedState||(t.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&P===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=F),f.props=r,f.state=F,f.context=v,r=x):(typeof f.componentDidUpdate!="function"||s===e.memoizedProps&&P===e.memoizedState||(t.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&P===e.memoizedState||(t.flags|=1024),r=!1)}return uM(e,t,n,r,u,a)}function uM(e,t,n,r,a,u){Jq(e,t);var f=(t.flags&128)!==0;if(!r&&!f)return a&&TF(t,n,!1),hp(e,t,u);r=t.stateNode,Ble.current=t;var s=f&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&f?(t.child=Sv(t,e.child,null,u),t.child=Sv(t,null,s,u)):xu(e,t,s,u),t.memoizedState=r.state,a&&TF(t,n,!0),t.child}function eW(e){var t=e.stateNode;t.pendingContext?wF(e,t.pendingContext,t.pendingContext!==t.context):t.context&&wF(e,t.context,!1),vO(e,t.containerInfo)}function BF(e,t,n,r,a){return Ev(),fO(a),t.flags|=256,xu(e,t,n,r),t.child}var cM={dehydrated:null,treeContext:null,retryLane:0};function dM(e){return{baseLanes:e,cachePool:null,transitions:null}}function tW(e,t,n){var r=t.pendingProps,a=Co.current,u=!1,f=(t.flags&128)!==0,s;if((s=f)||(s=e!==null&&e.memoizedState===null?!1:(a&2)!==0),s?(u=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),ro(Co,a&1),e===null)return rM(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(f=r.children,e=r.fallback,u?(r=t.mode,u=t.child,f={mode:"hidden",children:f},!(r&1)&&u!==null?(u.childLanes=0,u.pendingProps=f):u=FC(f,r,0,null),e=qg(e,r,n,null),u.return=t,e.return=t,u.sibling=e,t.child=u,t.child.memoizedState=dM(n),t.memoizedState=cM,e):CO(t,f));if(a=e.memoizedState,a!==null&&(s=a.dehydrated,s!==null))return jle(e,t,f,r,s,a,n);if(u){u=r.fallback,f=t.mode,a=e.child,s=a.sibling;var v={mode:"hidden",children:r.children};return!(f&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=v,t.deletions=null):(r=Zm(a,v),r.subtreeFlags=a.subtreeFlags&14680064),s!==null?u=Zm(s,u):(u=qg(u,f,n,null),u.flags|=2),u.return=t,r.return=t,r.sibling=u,t.child=r,r=u,u=t.child,f=e.child.memoizedState,f=f===null?dM(n):{baseLanes:f.baseLanes|n,cachePool:null,transitions:f.transitions},u.memoizedState=f,u.childLanes=e.childLanes&~n,t.memoizedState=cM,r}return u=e.child,e=u.sibling,r=Zm(u,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function CO(e,t){return t=FC({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function l3(e,t,n,r){return r!==null&&fO(r),Sv(t,e.child,null,n),e=CO(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function jle(e,t,n,r,a,u,f){if(n)return t.flags&256?(t.flags&=-257,r=e5(Error(sr(422))),l3(e,t,f,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(u=r.fallback,a=t.mode,r=FC({mode:"visible",children:r.children},a,0,null),u=qg(u,a,f,null),u.flags|=2,r.return=t,u.return=t,r.sibling=u,t.child=r,t.mode&1&&Sv(t,e.child,null,f),t.child.memoizedState=dM(f),t.memoizedState=cM,u);if(!(t.mode&1))return l3(e,t,f,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var s=r.dgst;return r=s,u=Error(sr(419)),r=e5(u,r,void 0),l3(e,t,f,r)}if(s=(f&e.childLanes)!==0,Xu||s){if(r=Sl,r!==null){switch(f&-f){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|f)?0:a,a!==0&&a!==u.retryLane&&(u.retryLane=a,dp(e,a),rh(r,e,a,-1))}return OO(),r=e5(Error(sr(421))),l3(e,t,f,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=Jle.bind(null,e),a._reactRetry=t,null):(e=u.treeContext,Sc=Hm(a.nextSibling),Cc=t,yo=!0,eh=null,e!==null&&(nd[rd++]=tp,nd[rd++]=np,nd[rd++]=Jg,tp=e.id,np=e.overflow,Jg=t),t=CO(t,r.children),t.flags|=4096,t)}function jF(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),iM(e.return,t,n)}function t5(e,t,n,r,a){var u=e.memoizedState;u===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(u.isBackwards=t,u.rendering=null,u.renderingStartTime=0,u.last=r,u.tail=n,u.tailMode=a)}function nW(e,t,n){var r=t.pendingProps,a=r.revealOrder,u=r.tail;if(xu(e,t,r.children,n),r=Co.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&jF(e,n,t);else if(e.tag===19)jF(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ro(Co,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;n!==null;)e=n.alternate,e!==null&&oA(e)===null&&(a=n),n=n.sibling;n=a,n===null?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),t5(t,!1,a,n,u);break;case"backwards":for(n=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&oA(e)===null){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}t5(t,!0,n,null,u);break;case"together":t5(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Q3(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function hp(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),t_|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(sr(153));if(t.child!==null){for(e=t.child,n=Zm(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Zm(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Ule(e,t,n){switch(t.tag){case 3:eW(t),Ev();break;case 5:kq(t);break;case 1:Ku(t.type)&&tA(t);break;case 4:vO(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;ro(iA,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(ro(Co,Co.current&1),t.flags|=128,null):n&t.child.childLanes?tW(e,t,n):(ro(Co,Co.current&1),e=hp(e,t,n),e!==null?e.sibling:null);ro(Co,Co.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return nW(e,t,n);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),ro(Co,Co.current),r)break;return null;case 22:case 23:return t.lanes=0,Qq(e,t,n)}return hp(e,t,n)}var rW,hM,iW,sW;rW=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};hM=function(){};iW=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Pg(tf.current);var u=null;switch(n){case"input":a=LR(e,a),r=LR(e,r),u=[];break;case"select":a=Ro({},a,{value:void 0}),r=Ro({},r,{value:void 0}),u=[];break;case"textarea":a=zR(e,a),r=zR(e,r),u=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=J4)}BR(n,r);var f;n=null;for(x in a)if(!r.hasOwnProperty(x)&&a.hasOwnProperty(x)&&a[x]!=null)if(x==="style"){var s=a[x];for(f in s)s.hasOwnProperty(f)&&(n||(n={}),n[f]="")}else x!=="dangerouslySetInnerHTML"&&x!=="children"&&x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(y2.hasOwnProperty(x)?u||(u=[]):(u=u||[]).push(x,null));for(x in r){var v=r[x];if(s=a!=null?a[x]:void 0,r.hasOwnProperty(x)&&v!==s&&(v!=null||s!=null))if(x==="style")if(s){for(f in s)!s.hasOwnProperty(f)||v&&v.hasOwnProperty(f)||(n||(n={}),n[f]="");for(f in v)v.hasOwnProperty(f)&&s[f]!==v[f]&&(n||(n={}),n[f]=v[f])}else n||(u||(u=[]),u.push(x,n)),n=v;else x==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,s=s?s.__html:void 0,v!=null&&s!==v&&(u=u||[]).push(x,v)):x==="children"?typeof v!="string"&&typeof v!="number"||(u=u||[]).push(x,""+v):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&(y2.hasOwnProperty(x)?(v!=null&&x==="onScroll"&&lo("scroll",e),u||s===v||(u=[])):(u=u||[]).push(x,v))}n&&(u=u||[]).push("style",n);var x=u;(t.updateQueue=x)&&(t.flags|=4)}};sW=function(e,t,n,r){n!==r&&(t.flags|=4)};function bw(e,t){if(!yo)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Wl(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Vle(e,t,n){var r=t.pendingProps;switch(hO(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wl(t),null;case 1:return Ku(t.type)&&eA(),Wl(t),null;case 3:return r=t.stateNode,Av(),co(Yu),co(nu),bO(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(a3(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,eh!==null&&(xM(eh),eh=null))),hM(e,t),Wl(t),null;case 5:xO(t);var a=Pg(R2.current);if(n=t.type,e!==null&&t.stateNode!=null)iW(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(sr(166));return Wl(t),null}if(e=Pg(tf.current),a3(t)){r=t.stateNode,n=t.type;var u=t.memoizedProps;switch(r[Wh]=t,r[k2]=u,e=(t.mode&1)!==0,n){case"dialog":lo("cancel",r),lo("close",r);break;case"iframe":case"object":case"embed":lo("load",r);break;case"video":case"audio":for(a=0;a<Nw.length;a++)lo(Nw[a],r);break;case"source":lo("error",r);break;case"img":case"image":case"link":lo("error",r),lo("load",r);break;case"details":lo("toggle",r);break;case"input":X9(r,u),lo("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!u.multiple},lo("invalid",r);break;case"textarea":K9(r,u),lo("invalid",r)}BR(n,u),a=null;for(var f in u)if(u.hasOwnProperty(f)){var s=u[f];f==="children"?typeof s=="string"?r.textContent!==s&&(u.suppressHydrationWarning!==!0&&s3(r.textContent,s,e),a=["children",s]):typeof s=="number"&&r.textContent!==""+s&&(u.suppressHydrationWarning!==!0&&s3(r.textContent,s,e),a=["children",""+s]):y2.hasOwnProperty(f)&&s!=null&&f==="onScroll"&&lo("scroll",r)}switch(n){case"input":KS(r),Y9(r,u,!0);break;case"textarea":KS(r),Q9(r);break;case"select":case"option":break;default:typeof u.onClick=="function"&&(r.onclick=J4)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{f=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=OG(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=f.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=f.createElement(n,{is:r.is}):(e=f.createElement(n),n==="select"&&(f=e,r.multiple?f.multiple=!0:r.size&&(f.size=r.size))):e=f.createElementNS(e,n),e[Wh]=t,e[k2]=r,rW(e,t,!1,!1),t.stateNode=e;e:{switch(f=jR(n,r),n){case"dialog":lo("cancel",e),lo("close",e),a=r;break;case"iframe":case"object":case"embed":lo("load",e),a=r;break;case"video":case"audio":for(a=0;a<Nw.length;a++)lo(Nw[a],e);a=r;break;case"source":lo("error",e),a=r;break;case"img":case"image":case"link":lo("error",e),lo("load",e),a=r;break;case"details":lo("toggle",e),a=r;break;case"input":X9(e,r),a=LR(e,r),lo("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=Ro({},r,{value:void 0}),lo("invalid",e);break;case"textarea":K9(e,r),a=zR(e,r),lo("invalid",e);break;default:a=r}BR(n,a),s=a;for(u in s)if(s.hasOwnProperty(u)){var v=s[u];u==="style"?NG(e,v):u==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,v!=null&&LG(e,v)):u==="children"?typeof v=="string"?(n!=="textarea"||v!=="")&&v2(e,v):typeof v=="number"&&v2(e,""+v):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(y2.hasOwnProperty(u)?v!=null&&u==="onScroll"&&lo("scroll",e):v!=null&&K8(e,u,v,f))}switch(n){case"input":KS(e),Y9(e,r,!1);break;case"textarea":KS(e),Q9(e);break;case"option":r.value!=null&&e.setAttribute("value",""+t0(r.value));break;case"select":e.multiple=!!r.multiple,u=r.value,u!=null?Z1(e,!!r.multiple,u,!1):r.defaultValue!=null&&Z1(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=J4)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Wl(t),null;case 6:if(e&&t.stateNode!=null)sW(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(sr(166));if(n=Pg(R2.current),Pg(tf.current),a3(t)){if(r=t.stateNode,n=t.memoizedProps,r[Wh]=t,(u=r.nodeValue!==n)&&(e=Cc,e!==null))switch(e.tag){case 3:s3(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&s3(r.nodeValue,n,(e.mode&1)!==0)}u&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Wh]=t,t.stateNode=r}return Wl(t),null;case 13:if(co(Co),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(yo&&Sc!==null&&t.mode&1&&!(t.flags&128))Tq(),Ev(),t.flags|=98560,u=!1;else if(u=a3(t),r!==null&&r.dehydrated!==null){if(e===null){if(!u)throw Error(sr(318));if(u=t.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(sr(317));u[Wh]=t}else Ev(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Wl(t),u=!1}else eh!==null&&(xM(eh),eh=null),u=!0;if(!u)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||Co.current&1?hl===0&&(hl=3):OO())),t.updateQueue!==null&&(t.flags|=4),Wl(t),null);case 4:return Av(),hM(e,t),e===null&&A2(t.stateNode.containerInfo),Wl(t),null;case 10:return gO(t.type._context),Wl(t),null;case 17:return Ku(t.type)&&eA(),Wl(t),null;case 19:if(co(Co),u=t.memoizedState,u===null)return Wl(t),null;if(r=(t.flags&128)!==0,f=u.rendering,f===null)if(r)bw(u,!1);else{if(hl!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(f=oA(e),f!==null){for(t.flags|=128,bw(u,!1),r=f.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)u=n,e=r,u.flags&=14680066,f=u.alternate,f===null?(u.childLanes=0,u.lanes=e,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=f.childLanes,u.lanes=f.lanes,u.child=f.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=f.memoizedProps,u.memoizedState=f.memoizedState,u.updateQueue=f.updateQueue,u.type=f.type,e=f.dependencies,u.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ro(Co,Co.current&1|2),t.child}e=e.sibling}u.tail!==null&&$o()>kv&&(t.flags|=128,r=!0,bw(u,!1),t.lanes=4194304)}else{if(!r)if(e=oA(f),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),bw(u,!0),u.tail===null&&u.tailMode==="hidden"&&!f.alternate&&!yo)return Wl(t),null}else 2*$o()-u.renderingStartTime>kv&&n!==1073741824&&(t.flags|=128,r=!0,bw(u,!1),t.lanes=4194304);u.isBackwards?(f.sibling=t.child,t.child=f):(n=u.last,n!==null?n.sibling=f:t.child=f,u.last=f)}return u.tail!==null?(t=u.tail,u.rendering=t,u.tail=t.sibling,u.renderingStartTime=$o(),t.sibling=null,n=Co.current,ro(Co,r?n&1|2:n&1),t):(Wl(t),null);case 22:case 23:return PO(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?wc&1073741824&&(Wl(t),t.subtreeFlags&6&&(t.flags|=8192)):Wl(t),null;case 24:return null;case 25:return null}throw Error(sr(156,t.tag))}function $le(e,t){switch(hO(t),t.tag){case 1:return Ku(t.type)&&eA(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Av(),co(Yu),co(nu),bO(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return xO(t),null;case 13:if(co(Co),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(sr(340));Ev()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return co(Co),null;case 4:return Av(),null;case 10:return gO(t.type._context),null;case 22:case 23:return PO(),null;case 24:return null;default:return null}}var u3=!1,Yl=!1,Hle=typeof WeakSet=="function"?WeakSet:Set,Qr=null;function $1(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){zo(e,t,r)}else n.current=null}function fM(e,t,n){try{n()}catch(r){zo(e,t,r)}}var UF=!1;function Gle(e,t){if(YR=Y4,e=cq(),cO(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var a=r.anchorOffset,u=r.focusNode;r=r.focusOffset;try{n.nodeType,u.nodeType}catch{n=null;break e}var f=0,s=-1,v=-1,x=0,A=0,C=e,P=null;t:for(;;){for(var L;C!==n||a!==0&&C.nodeType!==3||(s=f+a),C!==u||r!==0&&C.nodeType!==3||(v=f+r),C.nodeType===3&&(f+=C.nodeValue.length),(L=C.firstChild)!==null;)P=C,C=L;for(;;){if(C===e)break t;if(P===n&&++x===a&&(s=f),P===u&&++A===r&&(v=f),(L=C.nextSibling)!==null)break;C=P,P=C.parentNode}C=L}n=s===-1||v===-1?null:{start:s,end:v}}else n=null}n=n||{start:0,end:0}}else n=null;for(KR={focusedElem:e,selectionRange:n},Y4=!1,Qr=t;Qr!==null;)if(t=Qr,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Qr=e;else for(;Qr!==null;){t=Qr;try{var F=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(F!==null){var U=F.memoizedProps,q=F.memoizedState,G=t.stateNode,$=G.getSnapshotBeforeUpdate(t.elementType===t.type?U:Xd(t.type,U),q);G.__reactInternalSnapshotBeforeUpdate=$}break;case 3:var X=t.stateNode.containerInfo;X.nodeType===1?X.textContent="":X.nodeType===9&&X.documentElement&&X.removeChild(X.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(sr(163))}}catch(ie){zo(t,t.return,ie)}if(e=t.sibling,e!==null){e.return=t.return,Qr=e;break}Qr=t.return}return F=UF,UF=!1,F}function n2(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var u=a.destroy;a.destroy=void 0,u!==void 0&&fM(t,n,u)}a=a.next}while(a!==r)}}function NC(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function pM(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function aW(e){var t=e.alternate;t!==null&&(e.alternate=null,aW(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Wh],delete t[k2],delete t[eM],delete t[Cle],delete t[kle])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function oW(e){return e.tag===5||e.tag===3||e.tag===4}function VF(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||oW(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function mM(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=J4));else if(r!==4&&(e=e.child,e!==null))for(mM(e,t,n),e=e.sibling;e!==null;)mM(e,t,n),e=e.sibling}function gM(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(gM(e,t,n),e=e.sibling;e!==null;)gM(e,t,n),e=e.sibling}var Ll=null,Qd=!1;function am(e,t,n){for(n=n.child;n!==null;)lW(e,t,n),n=n.sibling}function lW(e,t,n){if(ef&&typeof ef.onCommitFiberUnmount=="function")try{ef.onCommitFiberUnmount(kC,n)}catch{}switch(n.tag){case 5:Yl||$1(n,t);case 6:var r=Ll,a=Qd;Ll=null,am(e,t,n),Ll=r,Qd=a,Ll!==null&&(Qd?(e=Ll,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Ll.removeChild(n.stateNode));break;case 18:Ll!==null&&(Qd?(e=Ll,n=n.stateNode,e.nodeType===8?Z6(e.parentNode,n):e.nodeType===1&&Z6(e,n),T2(e)):Z6(Ll,n.stateNode));break;case 4:r=Ll,a=Qd,Ll=n.stateNode.containerInfo,Qd=!0,am(e,t,n),Ll=r,Qd=a;break;case 0:case 11:case 14:case 15:if(!Yl&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var u=a,f=u.destroy;u=u.tag,f!==void 0&&(u&2||u&4)&&fM(n,t,f),a=a.next}while(a!==r)}am(e,t,n);break;case 1:if(!Yl&&($1(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){zo(n,t,s)}am(e,t,n);break;case 21:am(e,t,n);break;case 22:n.mode&1?(Yl=(r=Yl)||n.memoizedState!==null,am(e,t,n),Yl=r):am(e,t,n);break;default:am(e,t,n)}}function $F(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new Hle),t.forEach(function(r){var a=eue.bind(null,e,r);n.has(r)||(n.add(r),r.then(a,a))})}}function Hd(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var a=n[r];try{var u=e,f=t,s=f;e:for(;s!==null;){switch(s.tag){case 5:Ll=s.stateNode,Qd=!1;break e;case 3:Ll=s.stateNode.containerInfo,Qd=!0;break e;case 4:Ll=s.stateNode.containerInfo,Qd=!0;break e}s=s.return}if(Ll===null)throw Error(sr(160));lW(u,f,a),Ll=null,Qd=!1;var v=a.alternate;v!==null&&(v.return=null),a.return=null}catch(x){zo(a,t,x)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)uW(t,e),t=t.sibling}function uW(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Hd(t,e),Nh(e),r&4){try{n2(3,e,e.return),NC(3,e)}catch(U){zo(e,e.return,U)}try{n2(5,e,e.return)}catch(U){zo(e,e.return,U)}}break;case 1:Hd(t,e),Nh(e),r&512&&n!==null&&$1(n,n.return);break;case 5:if(Hd(t,e),Nh(e),r&512&&n!==null&&$1(n,n.return),e.flags&32){var a=e.stateNode;try{v2(a,"")}catch(U){zo(e,e.return,U)}}if(r&4&&(a=e.stateNode,a!=null)){var u=e.memoizedProps,f=n!==null?n.memoizedProps:u,s=e.type,v=e.updateQueue;if(e.updateQueue=null,v!==null)try{s==="input"&&u.type==="radio"&&u.name!=null&&MG(a,u),jR(s,f);var x=jR(s,u);for(f=0;f<v.length;f+=2){var A=v[f],C=v[f+1];A==="style"?NG(a,C):A==="dangerouslySetInnerHTML"?LG(a,C):A==="children"?v2(a,C):K8(a,A,C,x)}switch(s){case"input":DR(a,u);break;case"textarea":PG(a,u);break;case"select":var P=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!u.multiple;var L=u.value;L!=null?Z1(a,!!u.multiple,L,!1):P!==!!u.multiple&&(u.defaultValue!=null?Z1(a,!!u.multiple,u.defaultValue,!0):Z1(a,!!u.multiple,u.multiple?[]:"",!1))}a[k2]=u}catch(U){zo(e,e.return,U)}}break;case 6:if(Hd(t,e),Nh(e),r&4){if(e.stateNode===null)throw Error(sr(162));a=e.stateNode,u=e.memoizedProps;try{a.nodeValue=u}catch(U){zo(e,e.return,U)}}break;case 3:if(Hd(t,e),Nh(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{T2(t.containerInfo)}catch(U){zo(e,e.return,U)}break;case 4:Hd(t,e),Nh(e);break;case 13:Hd(t,e),Nh(e),a=e.child,a.flags&8192&&(u=a.memoizedState!==null,a.stateNode.isHidden=u,!u||a.alternate!==null&&a.alternate.memoizedState!==null||(RO=$o())),r&4&&$F(e);break;case 22:if(A=n!==null&&n.memoizedState!==null,e.mode&1?(Yl=(x=Yl)||A,Hd(t,e),Yl=x):Hd(t,e),Nh(e),r&8192){if(x=e.memoizedState!==null,(e.stateNode.isHidden=x)&&!A&&e.mode&1)for(Qr=e,A=e.child;A!==null;){for(C=Qr=A;Qr!==null;){switch(P=Qr,L=P.child,P.tag){case 0:case 11:case 14:case 15:n2(4,P,P.return);break;case 1:$1(P,P.return);var F=P.stateNode;if(typeof F.componentWillUnmount=="function"){r=P,n=P.return;try{t=r,F.props=t.memoizedProps,F.state=t.memoizedState,F.componentWillUnmount()}catch(U){zo(r,n,U)}}break;case 5:$1(P,P.return);break;case 22:if(P.memoizedState!==null){GF(C);continue}}L!==null?(L.return=P,Qr=L):GF(C)}A=A.sibling}e:for(A=null,C=e;;){if(C.tag===5){if(A===null){A=C;try{a=C.stateNode,x?(u=a.style,typeof u.setProperty=="function"?u.setProperty("display","none","important"):u.display="none"):(s=C.stateNode,v=C.memoizedProps.style,f=v!=null&&v.hasOwnProperty("display")?v.display:null,s.style.display=DG("display",f))}catch(U){zo(e,e.return,U)}}}else if(C.tag===6){if(A===null)try{C.stateNode.nodeValue=x?"":C.memoizedProps}catch(U){zo(e,e.return,U)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===e)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===e)break e;for(;C.sibling===null;){if(C.return===null||C.return===e)break e;A===C&&(A=null),C=C.return}A===C&&(A=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:Hd(t,e),Nh(e),r&4&&$F(e);break;case 21:break;default:Hd(t,e),Nh(e)}}function Nh(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(oW(n)){var r=n;break e}n=n.return}throw Error(sr(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(v2(a,""),r.flags&=-33);var u=VF(e);gM(e,u,a);break;case 3:case 4:var f=r.stateNode.containerInfo,s=VF(e);mM(e,s,f);break;default:throw Error(sr(161))}}catch(v){zo(e,e.return,v)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function qle(e,t,n){Qr=e,cW(e)}function cW(e,t,n){for(var r=(e.mode&1)!==0;Qr!==null;){var a=Qr,u=a.child;if(a.tag===22&&r){var f=a.memoizedState!==null||u3;if(!f){var s=a.alternate,v=s!==null&&s.memoizedState!==null||Yl;s=u3;var x=Yl;if(u3=f,(Yl=v)&&!x)for(Qr=a;Qr!==null;)f=Qr,v=f.child,f.tag===22&&f.memoizedState!==null?qF(a):v!==null?(v.return=f,Qr=v):qF(a);for(;u!==null;)Qr=u,cW(u),u=u.sibling;Qr=a,u3=s,Yl=x}HF(e)}else a.subtreeFlags&8772&&u!==null?(u.return=a,Qr=u):HF(e)}}function HF(e){for(;Qr!==null;){var t=Qr;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Yl||NC(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Yl)if(n===null)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:Xd(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var u=t.updateQueue;u!==null&&kF(t,u,r);break;case 3:var f=t.updateQueue;if(f!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}kF(t,f,n)}break;case 5:var s=t.stateNode;if(n===null&&t.flags&4){n=s;var v=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":v.autoFocus&&n.focus();break;case"img":v.src&&(n.src=v.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var x=t.alternate;if(x!==null){var A=x.memoizedState;if(A!==null){var C=A.dehydrated;C!==null&&T2(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(sr(163))}Yl||t.flags&512&&pM(t)}catch(P){zo(t,t.return,P)}}if(t===e){Qr=null;break}if(n=t.sibling,n!==null){n.return=t.return,Qr=n;break}Qr=t.return}}function GF(e){for(;Qr!==null;){var t=Qr;if(t===e){Qr=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Qr=n;break}Qr=t.return}}function qF(e){for(;Qr!==null;){var t=Qr;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{NC(4,t)}catch(v){zo(t,n,v)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(v){zo(t,a,v)}}var u=t.return;try{pM(t)}catch(v){zo(t,u,v)}break;case 5:var f=t.return;try{pM(t)}catch(v){zo(t,f,v)}}}catch(v){zo(t,t.return,v)}if(t===e){Qr=null;break}var s=t.sibling;if(s!==null){s.return=t.return,Qr=s;break}Qr=t.return}}var Wle=Math.ceil,cA=bp.ReactCurrentDispatcher,kO=bp.ReactCurrentOwner,ud=bp.ReactCurrentBatchConfig,xa=0,Sl=null,il=null,Fl=0,wc=0,H1=y0(0),hl=0,L2=null,t_=0,zC=0,IO=0,r2=null,Zu=null,RO=0,kv=1/0,Wf=null,dA=!1,_M=null,qm=null,c3=!1,Dm=null,hA=0,i2=0,yM=null,J3=-1,e4=0;function Au(){return xa&6?$o():J3!==-1?J3:J3=$o()}function Wm(e){return e.mode&1?xa&2&&Fl!==0?Fl&-Fl:Rle.transition!==null?(e4===0&&(e4=ZG()),e4):(e=Na,e!==0||(e=window.event,e=e===void 0?16:tq(e.type)),e):1}function rh(e,t,n,r){if(50<i2)throw i2=0,yM=null,Error(sr(185));gT(e,n,r),(!(xa&2)||e!==Sl)&&(e===Sl&&(!(xa&2)&&(zC|=n),hl===4&&Sm(e,Fl)),Qu(e,r),n===1&&xa===0&&!(t.mode&1)&&(kv=$o()+500,OC&&v0()))}function Qu(e,t){var n=e.callbackNode;Roe(e,t);var r=X4(e,e===Sl?Fl:0);if(r===0)n!==null&&tF(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&tF(n),t===1)e.tag===0?Ile(WF.bind(null,e)):xq(WF.bind(null,e)),Sle(function(){!(xa&6)&&v0()}),n=null;else{switch(XG(r)){case 1:n=nO;break;case 4:n=qG;break;case 16:n=Z4;break;case 536870912:n=WG;break;default:n=Z4}n=yW(n,dW.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function dW(e,t){if(J3=-1,e4=0,xa&6)throw Error(sr(327));var n=e.callbackNode;if(J1()&&e.callbackNode!==n)return null;var r=X4(e,e===Sl?Fl:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=fA(e,r);else{t=r;var a=xa;xa|=2;var u=fW();(Sl!==e||Fl!==t)&&(Wf=null,kv=$o()+500,Gg(e,t));do try{Yle();break}catch(s){hW(e,s)}while(!0);mO(),cA.current=u,xa=a,il!==null?t=0:(Sl=null,Fl=0,t=hl)}if(t!==0){if(t===2&&(a=GR(e),a!==0&&(r=a,t=vM(e,a))),t===1)throw n=L2,Gg(e,0),Sm(e,r),Qu(e,$o()),n;if(t===6)Sm(e,r);else{if(a=e.current.alternate,!(r&30)&&!Zle(a)&&(t=fA(e,r),t===2&&(u=GR(e),u!==0&&(r=u,t=vM(e,u))),t===1))throw n=L2,Gg(e,0),Sm(e,r),Qu(e,$o()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(sr(345));case 2:Cg(e,Zu,Wf);break;case 3:if(Sm(e,r),(r&130023424)===r&&(t=RO+500-$o(),10<t)){if(X4(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){Au(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=JR(Cg.bind(null,e,Zu,Wf),t);break}Cg(e,Zu,Wf);break;case 4:if(Sm(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var f=31-nh(r);u=1<<f,f=t[f],f>a&&(a=f),r&=~u}if(r=a,r=$o()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Wle(r/1960))-r,10<r){e.timeoutHandle=JR(Cg.bind(null,e,Zu,Wf),r);break}Cg(e,Zu,Wf);break;case 5:Cg(e,Zu,Wf);break;default:throw Error(sr(329))}}}return Qu(e,$o()),e.callbackNode===n?dW.bind(null,e):null}function vM(e,t){var n=r2;return e.current.memoizedState.isDehydrated&&(Gg(e,t).flags|=256),e=fA(e,t),e!==2&&(t=Zu,Zu=n,t!==null&&xM(t)),e}function xM(e){Zu===null?Zu=e:Zu.push.apply(Zu,e)}function Zle(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var a=n[r],u=a.getSnapshot;a=a.value;try{if(!sh(u(),a))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Sm(e,t){for(t&=~IO,t&=~zC,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-nh(t),r=1<<n;e[n]=-1,t&=~r}}function WF(e){if(xa&6)throw Error(sr(327));J1();var t=X4(e,0);if(!(t&1))return Qu(e,$o()),null;var n=fA(e,t);if(e.tag!==0&&n===2){var r=GR(e);r!==0&&(t=r,n=vM(e,r))}if(n===1)throw n=L2,Gg(e,0),Sm(e,t),Qu(e,$o()),n;if(n===6)throw Error(sr(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Cg(e,Zu,Wf),Qu(e,$o()),null}function MO(e,t){var n=xa;xa|=1;try{return e(t)}finally{xa=n,xa===0&&(kv=$o()+500,OC&&v0())}}function n_(e){Dm!==null&&Dm.tag===0&&!(xa&6)&&J1();var t=xa;xa|=1;var n=ud.transition,r=Na;try{if(ud.transition=null,Na=1,e)return e()}finally{Na=r,ud.transition=n,xa=t,!(xa&6)&&v0()}}function PO(){wc=H1.current,co(H1)}function Gg(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Ele(n)),il!==null)for(n=il.return;n!==null;){var r=n;switch(hO(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&eA();break;case 3:Av(),co(Yu),co(nu),bO();break;case 5:xO(r);break;case 4:Av();break;case 13:co(Co);break;case 19:co(Co);break;case 10:gO(r.type._context);break;case 22:case 23:PO()}n=n.return}if(Sl=e,il=e=Zm(e.current,null),Fl=wc=t,hl=0,L2=null,IO=zC=t_=0,Zu=r2=null,Mg!==null){for(t=0;t<Mg.length;t++)if(n=Mg[t],r=n.interleaved,r!==null){n.interleaved=null;var a=r.next,u=n.pending;if(u!==null){var f=u.next;u.next=a,r.next=f}n.pending=r}Mg=null}return e}function hW(e,t){do{var n=il;try{if(mO(),Y3.current=uA,lA){for(var r=Io.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}lA=!1}if(e_=0,Tl=dl=Io=null,t2=!1,M2=0,kO.current=null,n===null||n.return===null){hl=1,L2=t,il=null;break}e:{var u=e,f=n.return,s=n,v=t;if(t=Fl,s.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){var x=v,A=s,C=A.tag;if(!(A.mode&1)&&(C===0||C===11||C===15)){var P=A.alternate;P?(A.updateQueue=P.updateQueue,A.memoizedState=P.memoizedState,A.lanes=P.lanes):(A.updateQueue=null,A.memoizedState=null)}var L=LF(f);if(L!==null){L.flags&=-257,DF(L,f,s,u,t),L.mode&1&&OF(u,x,t),t=L,v=x;var F=t.updateQueue;if(F===null){var U=new Set;U.add(v),t.updateQueue=U}else F.add(v);break e}else{if(!(t&1)){OF(u,x,t),OO();break e}v=Error(sr(426))}}else if(yo&&s.mode&1){var q=LF(f);if(q!==null){!(q.flags&65536)&&(q.flags|=256),DF(q,f,s,u,t),fO(Cv(v,s));break e}}u=v=Cv(v,s),hl!==4&&(hl=2),r2===null?r2=[u]:r2.push(u),u=f;do{switch(u.tag){case 3:u.flags|=65536,t&=-t,u.lanes|=t;var G=Xq(u,v,t);CF(u,G);break e;case 1:s=v;var $=u.type,X=u.stateNode;if(!(u.flags&128)&&(typeof $.getDerivedStateFromError=="function"||X!==null&&typeof X.componentDidCatch=="function"&&(qm===null||!qm.has(X)))){u.flags|=65536,t&=-t,u.lanes|=t;var ie=Yq(u,s,t);CF(u,ie);break e}}u=u.return}while(u!==null)}mW(n)}catch(de){t=de,il===n&&n!==null&&(il=n=n.return);continue}break}while(!0)}function fW(){var e=cA.current;return cA.current=uA,e===null?uA:e}function OO(){(hl===0||hl===3||hl===2)&&(hl=4),Sl===null||!(t_&268435455)&&!(zC&268435455)||Sm(Sl,Fl)}function fA(e,t){var n=xa;xa|=2;var r=fW();(Sl!==e||Fl!==t)&&(Wf=null,Gg(e,t));do try{Xle();break}catch(a){hW(e,a)}while(!0);if(mO(),xa=n,cA.current=r,il!==null)throw Error(sr(261));return Sl=null,Fl=0,hl}function Xle(){for(;il!==null;)pW(il)}function Yle(){for(;il!==null&&!boe();)pW(il)}function pW(e){var t=_W(e.alternate,e,wc);e.memoizedProps=e.pendingProps,t===null?mW(e):il=t,kO.current=null}function mW(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=$le(n,t),n!==null){n.flags&=32767,il=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{hl=6,il=null;return}}else if(n=Vle(n,t,wc),n!==null){il=n;return}if(t=t.sibling,t!==null){il=t;return}il=t=e}while(t!==null);hl===0&&(hl=5)}function Cg(e,t,n){var r=Na,a=ud.transition;try{ud.transition=null,Na=1,Kle(e,t,n,r)}finally{ud.transition=a,Na=r}return null}function Kle(e,t,n,r){do J1();while(Dm!==null);if(xa&6)throw Error(sr(327));n=e.finishedWork;var a=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(sr(177));e.callbackNode=null,e.callbackPriority=0;var u=n.lanes|n.childLanes;if(Moe(e,u),e===Sl&&(il=Sl=null,Fl=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||c3||(c3=!0,yW(Z4,function(){return J1(),null})),u=(n.flags&15990)!==0,n.subtreeFlags&15990||u){u=ud.transition,ud.transition=null;var f=Na;Na=1;var s=xa;xa|=4,kO.current=null,Gle(e,n),uW(n,e),_le(KR),Y4=!!YR,KR=YR=null,e.current=n,qle(n),woe(),xa=s,Na=f,ud.transition=u}else e.current=n;if(c3&&(c3=!1,Dm=e,hA=a),u=e.pendingLanes,u===0&&(qm=null),Soe(n.stateNode),Qu(e,$o()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(dA)throw dA=!1,e=_M,_M=null,e;return hA&1&&e.tag!==0&&J1(),u=e.pendingLanes,u&1?e===yM?i2++:(i2=0,yM=e):i2=0,v0(),null}function J1(){if(Dm!==null){var e=XG(hA),t=ud.transition,n=Na;try{if(ud.transition=null,Na=16>e?16:e,Dm===null)var r=!1;else{if(e=Dm,Dm=null,hA=0,xa&6)throw Error(sr(331));var a=xa;for(xa|=4,Qr=e.current;Qr!==null;){var u=Qr,f=u.child;if(Qr.flags&16){var s=u.deletions;if(s!==null){for(var v=0;v<s.length;v++){var x=s[v];for(Qr=x;Qr!==null;){var A=Qr;switch(A.tag){case 0:case 11:case 15:n2(8,A,u)}var C=A.child;if(C!==null)C.return=A,Qr=C;else for(;Qr!==null;){A=Qr;var P=A.sibling,L=A.return;if(aW(A),A===x){Qr=null;break}if(P!==null){P.return=L,Qr=P;break}Qr=L}}}var F=u.alternate;if(F!==null){var U=F.child;if(U!==null){F.child=null;do{var q=U.sibling;U.sibling=null,U=q}while(U!==null)}}Qr=u}}if(u.subtreeFlags&2064&&f!==null)f.return=u,Qr=f;else e:for(;Qr!==null;){if(u=Qr,u.flags&2048)switch(u.tag){case 0:case 11:case 15:n2(9,u,u.return)}var G=u.sibling;if(G!==null){G.return=u.return,Qr=G;break e}Qr=u.return}}var $=e.current;for(Qr=$;Qr!==null;){f=Qr;var X=f.child;if(f.subtreeFlags&2064&&X!==null)X.return=f,Qr=X;else e:for(f=$;Qr!==null;){if(s=Qr,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:NC(9,s)}}catch(de){zo(s,s.return,de)}if(s===f){Qr=null;break e}var ie=s.sibling;if(ie!==null){ie.return=s.return,Qr=ie;break e}Qr=s.return}}if(xa=a,v0(),ef&&typeof ef.onPostCommitFiberRoot=="function")try{ef.onPostCommitFiberRoot(kC,e)}catch{}r=!0}return r}finally{Na=n,ud.transition=t}}return!1}function ZF(e,t,n){t=Cv(n,t),t=Xq(e,t,1),e=Gm(e,t,1),t=Au(),e!==null&&(gT(e,1,t),Qu(e,t))}function zo(e,t,n){if(e.tag===3)ZF(e,e,n);else for(;t!==null;){if(t.tag===3){ZF(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(qm===null||!qm.has(r))){e=Cv(n,e),e=Yq(t,e,1),t=Gm(t,e,1),e=Au(),t!==null&&(gT(t,1,e),Qu(t,e));break}}t=t.return}}function Qle(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=Au(),e.pingedLanes|=e.suspendedLanes&n,Sl===e&&(Fl&n)===n&&(hl===4||hl===3&&(Fl&130023424)===Fl&&500>$o()-RO?Gg(e,0):IO|=n),Qu(e,t)}function gW(e,t){t===0&&(e.mode&1?(t=e3,e3<<=1,!(e3&130023424)&&(e3=4194304)):t=1);var n=Au();e=dp(e,t),e!==null&&(gT(e,t,n),Qu(e,n))}function Jle(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),gW(e,n)}function eue(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(sr(314))}r!==null&&r.delete(t),gW(e,n)}var _W;_W=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Yu.current)Xu=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return Xu=!1,Ule(e,t,n);Xu=!!(e.flags&131072)}else Xu=!1,yo&&t.flags&1048576&&bq(t,rA,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Q3(e,t),e=t.pendingProps;var a=Tv(t,nu.current);Q1(t,n),a=TO(null,t,r,e,a,n);var u=EO();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ku(r)?(u=!0,tA(t)):u=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,yO(t),a.updater=DC,t.stateNode=a,a._reactInternals=t,aM(t,r,e,n),t=uM(null,t,r,!0,u,n)):(t.tag=0,yo&&u&&dO(t),xu(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Q3(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=nue(r),e=Xd(r,e),a){case 0:t=lM(null,t,r,e,n);break e;case 1:t=FF(null,t,r,e,n);break e;case 11:t=NF(null,t,r,e,n);break e;case 14:t=zF(null,t,r,Xd(r.type,e),n);break e}throw Error(sr(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Xd(r,a),lM(e,t,r,a,n);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Xd(r,a),FF(e,t,r,a,n);case 3:e:{if(eW(t),e===null)throw Error(sr(387));r=t.pendingProps,u=t.memoizedState,a=u.element,Cq(e,t),aA(t,r,null,n);var f=t.memoizedState;if(r=f.element,u.isDehydrated)if(u={element:r,isDehydrated:!1,cache:f.cache,pendingSuspenseBoundaries:f.pendingSuspenseBoundaries,transitions:f.transitions},t.updateQueue.baseState=u,t.memoizedState=u,t.flags&256){a=Cv(Error(sr(423)),t),t=BF(e,t,r,n,a);break e}else if(r!==a){a=Cv(Error(sr(424)),t),t=BF(e,t,r,n,a);break e}else for(Sc=Hm(t.stateNode.containerInfo.firstChild),Cc=t,yo=!0,eh=null,n=Sq(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ev(),r===a){t=hp(e,t,n);break e}xu(e,t,r,n)}t=t.child}return t;case 5:return kq(t),e===null&&rM(t),r=t.type,a=t.pendingProps,u=e!==null?e.memoizedProps:null,f=a.children,QR(r,a)?f=null:u!==null&&QR(r,u)&&(t.flags|=32),Jq(e,t),xu(e,t,f,n),t.child;case 6:return e===null&&rM(t),null;case 13:return tW(e,t,n);case 4:return vO(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Sv(t,null,r,n):xu(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Xd(r,a),NF(e,t,r,a,n);case 7:return xu(e,t,t.pendingProps,n),t.child;case 8:return xu(e,t,t.pendingProps.children,n),t.child;case 12:return xu(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,u=t.memoizedProps,f=a.value,ro(iA,r._currentValue),r._currentValue=f,u!==null)if(sh(u.value,f)){if(u.children===a.children&&!Yu.current){t=hp(e,t,n);break e}}else for(u=t.child,u!==null&&(u.return=t);u!==null;){var s=u.dependencies;if(s!==null){f=u.child;for(var v=s.firstContext;v!==null;){if(v.context===r){if(u.tag===1){v=ip(-1,n&-n),v.tag=2;var x=u.updateQueue;if(x!==null){x=x.shared;var A=x.pending;A===null?v.next=v:(v.next=A.next,A.next=v),x.pending=v}}u.lanes|=n,v=u.alternate,v!==null&&(v.lanes|=n),iM(u.return,n,t),s.lanes|=n;break}v=v.next}}else if(u.tag===10)f=u.type===t.type?null:u.child;else if(u.tag===18){if(f=u.return,f===null)throw Error(sr(341));f.lanes|=n,s=f.alternate,s!==null&&(s.lanes|=n),iM(f,n,t),f=u.sibling}else f=u.child;if(f!==null)f.return=u;else for(f=u;f!==null;){if(f===t){f=null;break}if(u=f.sibling,u!==null){u.return=f.return,f=u;break}f=f.return}u=f}xu(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Q1(t,n),a=dd(a),r=r(a),t.flags|=1,xu(e,t,r,n),t.child;case 14:return r=t.type,a=Xd(r,t.pendingProps),a=Xd(r.type,a),zF(e,t,r,a,n);case 15:return Kq(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Xd(r,a),Q3(e,t),t.tag=1,Ku(r)?(e=!0,tA(t)):e=!1,Q1(t,n),Zq(t,r,a),aM(t,r,a,n),uM(null,t,r,!0,e,n);case 19:return nW(e,t,n);case 22:return Qq(e,t,n)}throw Error(sr(156,t.tag))};function yW(e,t){return GG(e,t)}function tue(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function od(e,t,n,r){return new tue(e,t,n,r)}function LO(e){return e=e.prototype,!(!e||!e.isReactComponent)}function nue(e){if(typeof e=="function")return LO(e)?1:0;if(e!=null){if(e=e.$$typeof,e===J8)return 11;if(e===eO)return 14}return 2}function Zm(e,t){var n=e.alternate;return n===null?(n=od(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function t4(e,t,n,r,a,u){var f=2;if(r=e,typeof e=="function")LO(e)&&(f=1);else if(typeof e=="string")f=5;else e:switch(e){case L1:return qg(n.children,a,u,t);case Q8:f=8,a|=8;break;case RR:return e=od(12,n,t,a|2),e.elementType=RR,e.lanes=u,e;case MR:return e=od(13,n,t,a),e.elementType=MR,e.lanes=u,e;case PR:return e=od(19,n,t,a),e.elementType=PR,e.lanes=u,e;case kG:return FC(n,a,u,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case AG:f=10;break e;case CG:f=9;break e;case J8:f=11;break e;case eO:f=14;break e;case _m:f=16,r=null;break e}throw Error(sr(130,e==null?e:typeof e,""))}return t=od(f,n,t,a),t.elementType=e,t.type=r,t.lanes=u,t}function qg(e,t,n,r){return e=od(7,e,r,t),e.lanes=n,e}function FC(e,t,n,r){return e=od(22,e,r,t),e.elementType=kG,e.lanes=n,e.stateNode={isHidden:!1},e}function n5(e,t,n){return e=od(6,e,null,t),e.lanes=n,e}function r5(e,t,n){return t=od(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function rue(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=z6(0),this.expirationTimes=z6(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=z6(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function DO(e,t,n,r,a,u,f,s,v){return e=new rue(e,t,n,s,v),t===1?(t=1,u===!0&&(t|=8)):t=0,u=od(3,null,null,t),e.current=u,u.stateNode=e,u.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},yO(u),e}function iue(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:O1,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function vW(e){if(!e)return n0;e=e._reactInternals;e:{if(x_(e)!==e||e.tag!==1)throw Error(sr(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ku(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(sr(171))}if(e.tag===1){var n=e.type;if(Ku(n))return vq(e,n,t)}return t}function xW(e,t,n,r,a,u,f,s,v){return e=DO(n,r,!0,e,a,u,f,s,v),e.context=vW(null),n=e.current,r=Au(),a=Wm(n),u=ip(r,a),u.callback=t??null,Gm(n,u,a),e.current.lanes=a,gT(e,a,r),Qu(e,r),e}function BC(e,t,n,r){var a=t.current,u=Au(),f=Wm(a);return n=vW(n),t.context===null?t.context=n:t.pendingContext=n,t=ip(u,f),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Gm(a,t,f),e!==null&&(rh(e,a,f,u),X3(e,a,f)),f}function pA(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function XF(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function NO(e,t){XF(e,t),(e=e.alternate)&&XF(e,t)}function sue(){return null}var bW=typeof reportError=="function"?reportError:function(e){console.error(e)};function zO(e){this._internalRoot=e}jC.prototype.render=zO.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(sr(409));BC(e,t,null,null)};jC.prototype.unmount=zO.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;n_(function(){BC(null,e,null,null)}),t[cp]=null}};function jC(e){this._internalRoot=e}jC.prototype.unstable_scheduleHydration=function(e){if(e){var t=QG();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Em.length&&t!==0&&t<Em[n].priority;n++);Em.splice(n,0,e),n===0&&eq(e)}};function FO(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function UC(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function YF(){}function aue(e,t,n,r,a){if(a){if(typeof r=="function"){var u=r;r=function(){var x=pA(f);u.call(x)}}var f=xW(t,r,e,0,null,!1,!1,"",YF);return e._reactRootContainer=f,e[cp]=f.current,A2(e.nodeType===8?e.parentNode:e),n_(),f}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var s=r;r=function(){var x=pA(v);s.call(x)}}var v=DO(e,0,!1,null,null,!1,!1,"",YF);return e._reactRootContainer=v,e[cp]=v.current,A2(e.nodeType===8?e.parentNode:e),n_(function(){BC(t,v,n,r)}),v}function VC(e,t,n,r,a){var u=n._reactRootContainer;if(u){var f=u;if(typeof a=="function"){var s=a;a=function(){var v=pA(f);s.call(v)}}BC(t,f,e,a)}else f=aue(n,t,e,a,r);return pA(f)}YG=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Dw(t.pendingLanes);n!==0&&(rO(t,n|1),Qu(t,$o()),!(xa&6)&&(kv=$o()+500,v0()))}break;case 13:n_(function(){var r=dp(e,1);if(r!==null){var a=Au();rh(r,e,1,a)}}),NO(e,1)}};iO=function(e){if(e.tag===13){var t=dp(e,134217728);if(t!==null){var n=Au();rh(t,e,134217728,n)}NO(e,134217728)}};KG=function(e){if(e.tag===13){var t=Wm(e),n=dp(e,t);if(n!==null){var r=Au();rh(n,e,t,r)}NO(e,t)}};QG=function(){return Na};JG=function(e,t){var n=Na;try{return Na=e,t()}finally{Na=n}};VR=function(e,t,n){switch(t){case"input":if(DR(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=PC(r);if(!a)throw Error(sr(90));RG(r),DR(r,a)}}}break;case"textarea":PG(e,n);break;case"select":t=n.value,t!=null&&Z1(e,!!n.multiple,t,!1)}};BG=MO;jG=n_;var oue={usingClientEntryPoint:!1,Events:[yT,F1,PC,zG,FG,MO]},ww={findFiberByHostInstance:Rg,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},lue={bundleType:ww.bundleType,version:ww.version,rendererPackageName:ww.rendererPackageName,rendererConfig:ww.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:bp.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=$G(e),e===null?null:e.stateNode},findFiberByHostInstance:ww.findFiberByHostInstance||sue,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var d3=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!d3.isDisabled&&d3.supportsFiber)try{kC=d3.inject(lue),ef=d3}catch{}}Lc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=oue;Lc.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!FO(t))throw Error(sr(200));return iue(e,t,null,n)};Lc.createRoot=function(e,t){if(!FO(e))throw Error(sr(299));var n=!1,r="",a=bW;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=DO(e,1,!1,null,null,n,!1,r,a),e[cp]=t.current,A2(e.nodeType===8?e.parentNode:e),new zO(t)};Lc.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(sr(188)):(e=Object.keys(e).join(","),Error(sr(268,e)));return e=$G(t),e=e===null?null:e.stateNode,e};Lc.flushSync=function(e){return n_(e)};Lc.hydrate=function(e,t,n){if(!UC(t))throw Error(sr(200));return VC(null,e,t,!0,n)};Lc.hydrateRoot=function(e,t,n){if(!FO(e))throw Error(sr(405));var r=n!=null&&n.hydratedSources||null,a=!1,u="",f=bW;if(n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(u=n.identifierPrefix),n.onRecoverableError!==void 0&&(f=n.onRecoverableError)),t=xW(t,null,e,1,n??null,a,!1,u,f),e[cp]=t.current,A2(e),r)for(e=0;e<r.length;e++)n=r[e],a=n._getVersion,a=a(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new jC(t)};Lc.render=function(e,t,n){if(!UC(t))throw Error(sr(200));return VC(null,e,t,!1,n)};Lc.unmountComponentAtNode=function(e){if(!UC(e))throw Error(sr(40));return e._reactRootContainer?(n_(function(){VC(null,null,e,!1,function(){e._reactRootContainer=null,e[cp]=null})}),!0):!1};Lc.unstable_batchedUpdates=MO;Lc.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!UC(n))throw Error(sr(200));if(e==null||e._reactInternals===void 0)throw Error(sr(38));return VC(e,t,n,!1,r)};Lc.version="18.3.1-next-f1338f8080-20240426";function wW(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(wW)}catch(e){console.error(e)}}wW(),wG.exports=Lc;var xT=wG.exports;const uue=fT(xT);var KF=xT;kR.createRoot=KF.createRoot,kR.hydrateRoot=KF.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function D2(){return D2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},D2.apply(this,arguments)}var Nm;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Nm||(Nm={}));const QF="popstate";function cue(e){e===void 0&&(e={});function t(r,a){let{pathname:u,search:f,hash:s}=r.location;return bM("",{pathname:u,search:f,hash:s},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(r,a){return typeof a=="string"?a:mA(a)}return hue(t,n,null,e)}function Wo(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function BO(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function due(){return Math.random().toString(36).substr(2,8)}function JF(e,t){return{usr:e.state,key:e.key,idx:t}}function bM(e,t,n,r){return n===void 0&&(n=null),D2({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Kv(t):t,{state:n,key:t&&t.key||r||due()})}function mA(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function Kv(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function hue(e,t,n,r){r===void 0&&(r={});let{window:a=document.defaultView,v5Compat:u=!1}=r,f=a.history,s=Nm.Pop,v=null,x=A();x==null&&(x=0,f.replaceState(D2({},f.state,{idx:x}),""));function A(){return(f.state||{idx:null}).idx}function C(){s=Nm.Pop;let q=A(),G=q==null?null:q-x;x=q,v&&v({action:s,location:U.location,delta:G})}function P(q,G){s=Nm.Push;let $=bM(U.location,q,G);x=A()+1;let X=JF($,x),ie=U.createHref($);try{f.pushState(X,"",ie)}catch(de){if(de instanceof DOMException&&de.name==="DataCloneError")throw de;a.location.assign(ie)}u&&v&&v({action:s,location:U.location,delta:1})}function L(q,G){s=Nm.Replace;let $=bM(U.location,q,G);x=A();let X=JF($,x),ie=U.createHref($);f.replaceState(X,"",ie),u&&v&&v({action:s,location:U.location,delta:0})}function F(q){let G=a.location.origin!=="null"?a.location.origin:a.location.href,$=typeof q=="string"?q:mA(q);return $=$.replace(/ $/,"%20"),Wo(G,"No window.location.(origin|href) available to create URL for href: "+$),new URL($,G)}let U={get action(){return s},get location(){return e(a,f)},listen(q){if(v)throw new Error("A history only accepts one active listener");return a.addEventListener(QF,C),v=q,()=>{a.removeEventListener(QF,C),v=null}},createHref(q){return t(a,q)},createURL:F,encodeLocation(q){let G=F(q);return{pathname:G.pathname,search:G.search,hash:G.hash}},push:P,replace:L,go(q){return f.go(q)}};return U}var eB;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(eB||(eB={}));function fue(e,t,n){return n===void 0&&(n="/"),pue(e,t,n)}function pue(e,t,n,r){let a=typeof t=="string"?Kv(t):t,u=jO(a.pathname||"/",n);if(u==null)return null;let f=TW(e);mue(f);let s=null;for(let v=0;s==null&&v<f.length;++v){let x=Cue(u);s=Eue(f[v],x)}return s}function TW(e,t,n,r){t===void 0&&(t=[]),n===void 0&&(n=[]),r===void 0&&(r="");let a=(u,f,s)=>{let v={relativePath:s===void 0?u.path||"":s,caseSensitive:u.caseSensitive===!0,childrenIndex:f,route:u};v.relativePath.startsWith("/")&&(Wo(v.relativePath.startsWith(r),'Absolute route path "'+v.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),v.relativePath=v.relativePath.slice(r.length));let x=Xm([r,v.relativePath]),A=n.concat(v);u.children&&u.children.length>0&&(Wo(u.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+x+'".')),TW(u.children,t,A,x)),!(u.path==null&&!u.index)&&t.push({path:x,score:wue(x,u.index),routesMeta:A})};return e.forEach((u,f)=>{var s;if(u.path===""||!((s=u.path)!=null&&s.includes("?")))a(u,f);else for(let v of EW(u.path))a(u,f,v)}),t}function EW(e){let t=e.split("/");if(t.length===0)return[];let[n,...r]=t,a=n.endsWith("?"),u=n.replace(/\?$/,"");if(r.length===0)return a?[u,""]:[u];let f=EW(r.join("/")),s=[];return s.push(...f.map(v=>v===""?u:[u,v].join("/"))),a&&s.push(...f),s.map(v=>e.startsWith("/")&&v===""?"/":v)}function mue(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:Tue(t.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const gue=/^:[\w-]+$/,_ue=3,yue=2,vue=1,xue=10,bue=-2,tB=e=>e==="*";function wue(e,t){let n=e.split("/"),r=n.length;return n.some(tB)&&(r+=bue),t&&(r+=yue),n.filter(a=>!tB(a)).reduce((a,u)=>a+(gue.test(u)?_ue:u===""?vue:xue),r)}function Tue(e,t){return e.length===t.length&&e.slice(0,-1).every((r,a)=>r===t[a])?e[e.length-1]-t[t.length-1]:0}function Eue(e,t,n){let{routesMeta:r}=e,a={},u="/",f=[];for(let s=0;s<r.length;++s){let v=r[s],x=s===r.length-1,A=u==="/"?t:t.slice(u.length)||"/",C=Sue({path:v.relativePath,caseSensitive:v.caseSensitive,end:x},A),P=v.route;if(!C)return null;Object.assign(a,C.params),f.push({params:a,pathname:Xm([u,C.pathname]),pathnameBase:Pue(Xm([u,C.pathnameBase])),route:P}),C.pathnameBase!=="/"&&(u=Xm([u,C.pathnameBase]))}return f}function Sue(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=Aue(e.path,e.caseSensitive,e.end),a=t.match(n);if(!a)return null;let u=a[0],f=u.replace(/(.)\/+$/,"$1"),s=a.slice(1);return{params:r.reduce((x,A,C)=>{let{paramName:P,isOptional:L}=A;if(P==="*"){let U=s[C]||"";f=u.slice(0,u.length-U.length).replace(/(.)\/+$/,"$1")}const F=s[C];return L&&!F?x[P]=void 0:x[P]=(F||"").replace(/%2F/g,"/"),x},{}),pathname:u,pathnameBase:f,pattern:e}}function Aue(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),BO(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let r=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,s,v)=>(r.push({paramName:s,isOptional:v!=null}),v?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),r]}function Cue(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return BO(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function jO(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&r!=="/"?null:e.slice(n)||"/"}const kue=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Iue=e=>kue.test(e);function Rue(e,t){t===void 0&&(t="/");let{pathname:n,search:r="",hash:a=""}=typeof e=="string"?Kv(e):e,u;if(n)if(Iue(n))u=n;else{if(n.includes("//")){let f=n;n=n.replace(/\/\/+/g,"/"),BO(!1,"Pathnames cannot have embedded double slashes - normalizing "+(f+" -> "+n))}n.startsWith("/")?u=nB(n.substring(1),"/"):u=nB(n,t)}else u=t;return{pathname:u,search:Oue(r),hash:Lue(a)}}function nB(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?n.length>1&&n.pop():a!=="."&&n.push(a)}),n.length>1?n.join("/"):"/"}function i5(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Mue(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function UO(e,t){let n=Mue(e);return t?n.map((r,a)=>a===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function VO(e,t,n,r){r===void 0&&(r=!1);let a;typeof e=="string"?a=Kv(e):(a=D2({},e),Wo(!a.pathname||!a.pathname.includes("?"),i5("?","pathname","search",a)),Wo(!a.pathname||!a.pathname.includes("#"),i5("#","pathname","hash",a)),Wo(!a.search||!a.search.includes("#"),i5("#","search","hash",a)));let u=e===""||a.pathname==="",f=u?"/":a.pathname,s;if(f==null)s=n;else{let C=t.length-1;if(!r&&f.startsWith("..")){let P=f.split("/");for(;P[0]==="..";)P.shift(),C-=1;a.pathname=P.join("/")}s=C>=0?t[C]:"/"}let v=Rue(a,s),x=f&&f!=="/"&&f.endsWith("/"),A=(u||f===".")&&n.endsWith("/");return!v.pathname.endsWith("/")&&(x||A)&&(v.pathname+="/"),v}const Xm=e=>e.join("/").replace(/\/\/+/g,"/"),Pue=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Oue=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Lue=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Due(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const SW=["post","put","patch","delete"];new Set(SW);const Nue=["get",...SW];new Set(Nue);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function N2(){return N2=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},N2.apply(this,arguments)}const $O=B.createContext(null),zue=B.createContext(null),x0=B.createContext(null),$C=B.createContext(null),b0=B.createContext({outlet:null,matches:[],isDataRoute:!1}),AW=B.createContext(null);function Fue(e,t){let{relative:n}=t===void 0?{}:t;Qv()||Wo(!1);let{basename:r,navigator:a}=B.useContext(x0),{hash:u,pathname:f,search:s}=kW(e,{relative:n}),v=f;return r!=="/"&&(v=f==="/"?r:Xm([r,f])),a.createHref({pathname:v,search:s,hash:u})}function Qv(){return B.useContext($C)!=null}function Jv(){return Qv()||Wo(!1),B.useContext($C).location}function CW(e){B.useContext(x0).static||B.useLayoutEffect(e)}function bT(){let{isDataRoute:e}=B.useContext(b0);return e?Kue():Bue()}function Bue(){Qv()||Wo(!1);let e=B.useContext($O),{basename:t,future:n,navigator:r}=B.useContext(x0),{matches:a}=B.useContext(b0),{pathname:u}=Jv(),f=JSON.stringify(UO(a,n.v7_relativeSplatPath)),s=B.useRef(!1);return CW(()=>{s.current=!0}),B.useCallback(function(x,A){if(A===void 0&&(A={}),!s.current)return;if(typeof x=="number"){r.go(x);return}let C=VO(x,JSON.parse(f),u,A.relative==="path");e==null&&t!=="/"&&(C.pathname=C.pathname==="/"?t:Xm([t,C.pathname])),(A.replace?r.replace:r.push)(C,A.state,A)},[t,r,f,u,e])}function kW(e,t){let{relative:n}=t===void 0?{}:t,{future:r}=B.useContext(x0),{matches:a}=B.useContext(b0),{pathname:u}=Jv(),f=JSON.stringify(UO(a,r.v7_relativeSplatPath));return B.useMemo(()=>VO(e,JSON.parse(f),u,n==="path"),[e,f,u,n])}function jue(e,t){return Uue(e,t)}function Uue(e,t,n,r){Qv()||Wo(!1);let{navigator:a}=B.useContext(x0),{matches:u}=B.useContext(b0),f=u[u.length-1],s=f?f.params:{};f&&f.pathname;let v=f?f.pathnameBase:"/";f&&f.route;let x=Jv(),A;if(t){var C;let q=typeof t=="string"?Kv(t):t;v==="/"||(C=q.pathname)!=null&&C.startsWith(v)||Wo(!1),A=q}else A=x;let P=A.pathname||"/",L=P;if(v!=="/"){let q=v.replace(/^\//,"").split("/");L="/"+P.replace(/^\//,"").split("/").slice(q.length).join("/")}let F=fue(e,{pathname:L}),U=que(F&&F.map(q=>Object.assign({},q,{params:Object.assign({},s,q.params),pathname:Xm([v,a.encodeLocation?a.encodeLocation(q.pathname).pathname:q.pathname]),pathnameBase:q.pathnameBase==="/"?v:Xm([v,a.encodeLocation?a.encodeLocation(q.pathnameBase).pathname:q.pathnameBase])})),u,n,r);return t&&U?B.createElement($C.Provider,{value:{location:N2({pathname:"/",search:"",hash:"",state:null,key:"default"},A),navigationType:Nm.Pop}},U):U}function Vue(){let e=Yue(),t=Due(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return B.createElement(B.Fragment,null,B.createElement("h2",null,"Unexpected Application Error!"),B.createElement("h3",{style:{fontStyle:"italic"}},t),n?B.createElement("pre",{style:a},n):null,null)}const $ue=B.createElement(Vue,null);class Hue extends B.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?B.createElement(b0.Provider,{value:this.props.routeContext},B.createElement(AW.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Gue(e){let{routeContext:t,match:n,children:r}=e,a=B.useContext($O);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),B.createElement(b0.Provider,{value:t},r)}function que(e,t,n,r){var a;if(t===void 0&&(t=[]),n===void 0&&(n=null),r===void 0&&(r=null),e==null){var u;if(!n)return null;if(n.errors)e=n.matches;else if((u=r)!=null&&u.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let f=e,s=(a=n)==null?void 0:a.errors;if(s!=null){let A=f.findIndex(C=>C.route.id&&(s==null?void 0:s[C.route.id])!==void 0);A>=0||Wo(!1),f=f.slice(0,Math.min(f.length,A+1))}let v=!1,x=-1;if(n&&r&&r.v7_partialHydration)for(let A=0;A<f.length;A++){let C=f[A];if((C.route.HydrateFallback||C.route.hydrateFallbackElement)&&(x=A),C.route.id){let{loaderData:P,errors:L}=n,F=C.route.loader&&P[C.route.id]===void 0&&(!L||L[C.route.id]===void 0);if(C.route.lazy||F){v=!0,x>=0?f=f.slice(0,x+1):f=[f[0]];break}}}return f.reduceRight((A,C,P)=>{let L,F=!1,U=null,q=null;n&&(L=s&&C.route.id?s[C.route.id]:void 0,U=C.route.errorElement||$ue,v&&(x<0&&P===0?(Que("route-fallback"),F=!0,q=null):x===P&&(F=!0,q=C.route.hydrateFallbackElement||null)));let G=t.concat(f.slice(0,P+1)),$=()=>{let X;return L?X=U:F?X=q:C.route.Component?X=B.createElement(C.route.Component,null):C.route.element?X=C.route.element:X=A,B.createElement(Gue,{match:C,routeContext:{outlet:A,matches:G,isDataRoute:n!=null},children:X})};return n&&(C.route.ErrorBoundary||C.route.errorElement||P===0)?B.createElement(Hue,{location:n.location,revalidation:n.revalidation,component:U,error:L,children:$(),routeContext:{outlet:null,matches:G,isDataRoute:!0}}):$()},null)}var IW=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(IW||{}),RW=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(RW||{});function Wue(e){let t=B.useContext($O);return t||Wo(!1),t}function Zue(e){let t=B.useContext(zue);return t||Wo(!1),t}function Xue(e){let t=B.useContext(b0);return t||Wo(!1),t}function MW(e){let t=Xue(),n=t.matches[t.matches.length-1];return n.route.id||Wo(!1),n.route.id}function Yue(){var e;let t=B.useContext(AW),n=Zue(),r=MW();return t!==void 0?t:(e=n.errors)==null?void 0:e[r]}function Kue(){let{router:e}=Wue(IW.UseNavigateStable),t=MW(RW.UseNavigateStable),n=B.useRef(!1);return CW(()=>{n.current=!0}),B.useCallback(function(a,u){u===void 0&&(u={}),n.current&&(typeof a=="number"?e.navigate(a):e.navigate(a,N2({fromRouteId:t},u)))},[e,t])}const rB={};function Que(e,t,n){rB[e]||(rB[e]=!0)}function Jue(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function ece(e){let{to:t,replace:n,state:r,relative:a}=e;Qv()||Wo(!1);let{future:u,static:f}=B.useContext(x0),{matches:s}=B.useContext(b0),{pathname:v}=Jv(),x=bT(),A=VO(t,UO(s,u.v7_relativeSplatPath),v,a==="path"),C=JSON.stringify(A);return B.useEffect(()=>x(JSON.parse(C),{replace:n,state:r,relative:a}),[x,C,a,n,r]),null}function n4(e){Wo(!1)}function tce(e){let{basename:t="/",children:n=null,location:r,navigationType:a=Nm.Pop,navigator:u,static:f=!1,future:s}=e;Qv()&&Wo(!1);let v=t.replace(/^\/*/,"/"),x=B.useMemo(()=>({basename:v,navigator:u,static:f,future:N2({v7_relativeSplatPath:!1},s)}),[v,s,u,f]);typeof r=="string"&&(r=Kv(r));let{pathname:A="/",search:C="",hash:P="",state:L=null,key:F="default"}=r,U=B.useMemo(()=>{let q=jO(A,v);return q==null?null:{location:{pathname:q,search:C,hash:P,state:L,key:F},navigationType:a}},[v,A,C,P,L,F,a]);return U==null?null:B.createElement(x0.Provider,{value:x},B.createElement($C.Provider,{children:n,value:U}))}function nce(e){let{children:t,location:n}=e;return jue(wM(t),n)}new Promise(()=>{});function wM(e,t){t===void 0&&(t=[]);let n=[];return B.Children.forEach(e,(r,a)=>{if(!B.isValidElement(r))return;let u=[...t,a];if(r.type===B.Fragment){n.push.apply(n,wM(r.props.children,u));return}r.type!==n4&&Wo(!1),!r.props.index||!r.props.children||Wo(!1);let f={id:r.props.id||u.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(f.children=wM(r.props.children,u)),n.push(f)}),n}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function TM(){return TM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},TM.apply(this,arguments)}function rce(e,t){if(e==null)return{};var n={},r=Object.keys(e),a,u;for(u=0;u<r.length;u++)a=r[u],!(t.indexOf(a)>=0)&&(n[a]=e[a]);return n}function ice(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function sce(e,t){return e.button===0&&(!t||t==="_self")&&!ice(e)}function EM(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let r=e[n];return t.concat(Array.isArray(r)?r.map(a=>[n,a]):[[n,r]])},[]))}function ace(e,t){let n=EM(e);return t&&t.forEach((r,a)=>{n.has(a)||t.getAll(a).forEach(u=>{n.append(a,u)})}),n}const oce=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],lce="6";try{window.__reactRouterVersion=lce}catch{}const uce="startTransition",iB=mT[uce];function cce(e){let{basename:t,children:n,future:r,window:a}=e,u=B.useRef();u.current==null&&(u.current=cue({window:a,v5Compat:!0}));let f=u.current,[s,v]=B.useState({action:f.action,location:f.location}),{v7_startTransition:x}=r||{},A=B.useCallback(C=>{x&&iB?iB(()=>v(C)):v(C)},[v,x]);return B.useLayoutEffect(()=>f.listen(A),[f,A]),B.useEffect(()=>Jue(r),[r]),B.createElement(tce,{basename:t,children:n,location:s.location,navigationType:s.action,navigator:f,future:r})}const dce=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",hce=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,PW=B.forwardRef(function(t,n){let{onClick:r,relative:a,reloadDocument:u,replace:f,state:s,target:v,to:x,preventScrollReset:A,viewTransition:C}=t,P=rce(t,oce),{basename:L}=B.useContext(x0),F,U=!1;if(typeof x=="string"&&hce.test(x)&&(F=x,dce))try{let X=new URL(window.location.href),ie=x.startsWith("//")?new URL(X.protocol+x):new URL(x),de=jO(ie.pathname,L);ie.origin===X.origin&&de!=null?x=de+ie.search+ie.hash:U=!0}catch{}let q=Fue(x,{relative:a}),G=fce(x,{replace:f,state:s,target:v,preventScrollReset:A,relative:a,viewTransition:C});function $(X){r&&r(X),X.defaultPrevented||G(X)}return B.createElement("a",TM({},P,{href:F||q,onClick:U||u?r:$,ref:n,target:v}))});var sB;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(sB||(sB={}));var aB;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(aB||(aB={}));function fce(e,t){let{target:n,replace:r,state:a,preventScrollReset:u,relative:f,viewTransition:s}=t===void 0?{}:t,v=bT(),x=Jv(),A=kW(e,{relative:f});return B.useCallback(C=>{if(sce(C,n)){C.preventDefault();let P=r!==void 0?r:mA(x)===mA(A);v(e,{replace:P,state:a,preventScrollReset:u,relative:f,viewTransition:s})}},[x,v,A,r,a,n,e,u,f,s])}function pce(e){let t=B.useRef(EM(e)),n=B.useRef(!1),r=Jv(),a=B.useMemo(()=>ace(r.search,n.current?null:t.current),[r.search]),u=bT(),f=B.useCallback((s,v)=>{const x=EM(typeof s=="function"?s(a):s);n.current=!0,u("?"+x,v)},[u,a]);return[a,f]}var wT=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},mce={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},Am,H8,QH,gce=(QH=class{constructor(){Vi(this,Am,mce);Vi(this,H8,!1)}setTimeoutProvider(e){Kr(this,Am,e)}setTimeout(e,t){return At(this,Am).setTimeout(e,t)}clearTimeout(e){At(this,Am).clearTimeout(e)}setInterval(e,t){return At(this,Am).setInterval(e,t)}clearInterval(e){At(this,Am).clearInterval(e)}},Am=new WeakMap,H8=new WeakMap,QH),Og=new gce;function _ce(e){setTimeout(e,0)}var r_=typeof window>"u"||"Deno"in globalThis;function qu(){}function yce(e,t){return typeof e=="function"?e(t):e}function SM(e){return typeof e=="number"&&e>=0&&e!==1/0}function OW(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Ym(e,t){return typeof e=="function"?e(t):e}function td(e,t){return typeof e=="function"?e(t):e}function oB(e,t){const{type:n="all",exact:r,fetchStatus:a,predicate:u,queryKey:f,stale:s}=e;if(f){if(r){if(t.queryHash!==HO(f,t.options))return!1}else if(!F2(t.queryKey,f))return!1}if(n!=="all"){const v=t.isActive();if(n==="active"&&!v||n==="inactive"&&v)return!1}return!(typeof s=="boolean"&&t.isStale()!==s||a&&a!==t.state.fetchStatus||u&&!u(t))}function lB(e,t){const{exact:n,status:r,predicate:a,mutationKey:u}=e;if(u){if(!t.options.mutationKey)return!1;if(n){if(z2(t.options.mutationKey)!==z2(u))return!1}else if(!F2(t.options.mutationKey,u))return!1}return!(r&&t.state.status!==r||a&&!a(t))}function HO(e,t){return((t==null?void 0:t.queryKeyHashFn)||z2)(e)}function z2(e){return JSON.stringify(e,(t,n)=>CM(n)?Object.keys(n).sort().reduce((r,a)=>(r[a]=n[a],r),{}):n)}function F2(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(n=>F2(e[n],t[n])):!1}var vce=Object.prototype.hasOwnProperty;function LW(e,t){if(e===t)return e;const n=uB(e)&&uB(t);if(!n&&!(CM(e)&&CM(t)))return t;const a=(n?e:Object.keys(e)).length,u=n?t:Object.keys(t),f=u.length,s=n?new Array(f):{};let v=0;for(let x=0;x<f;x++){const A=n?x:u[x],C=e[A],P=t[A];if(C===P){s[A]=C,(n?x<a:vce.call(e,A))&&v++;continue}if(C===null||P===null||typeof C!="object"||typeof P!="object"){s[A]=P;continue}const L=LW(C,P);s[A]=L,L===C&&v++}return a===f&&v===a?e:s}function AM(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function uB(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function CM(e){if(!cB(e))return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(!cB(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function cB(e){return Object.prototype.toString.call(e)==="[object Object]"}function xce(e){return new Promise(t=>{Og.setTimeout(t,e)})}function kM(e,t,n){return typeof n.structuralSharing=="function"?n.structuralSharing(e,t):n.structuralSharing!==!1?LW(e,t):t}function bce(e,t,n=0){const r=[...e,t];return n&&r.length>n?r.slice(1):r}function wce(e,t,n=0){const r=[t,...e];return n&&r.length>n?r.slice(0,-1):r}var GO=Symbol();function DW(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===GO?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function NW(e,t){return typeof e=="function"?e(...t):!!e}function Tce(e,t,n){let r=!1,a;return Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(a??(a=t()),r||(r=!0,a.aborted?n():a.addEventListener("abort",n,{once:!0})),a)}),e}var Ng,Cm,cv,JH,Ece=(JH=class extends wT{constructor(){super();Vi(this,Ng);Vi(this,Cm);Vi(this,cv);Kr(this,cv,t=>{if(!r_&&window.addEventListener){const n=()=>t();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){At(this,Cm)||this.setEventListener(At(this,cv))}onUnsubscribe(){var t;this.hasListeners()||((t=At(this,Cm))==null||t.call(this),Kr(this,Cm,void 0))}setEventListener(t){var n;Kr(this,cv,t),(n=At(this,Cm))==null||n.call(this),Kr(this,Cm,t(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(t){At(this,Ng)!==t&&(Kr(this,Ng,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(n=>{n(t)})}isFocused(){var t;return typeof At(this,Ng)=="boolean"?At(this,Ng):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},Ng=new WeakMap,Cm=new WeakMap,cv=new WeakMap,JH),qO=new Ece;function IM(){let e,t;const n=new Promise((a,u)=>{e=a,t=u});n.status="pending",n.catch(()=>{});function r(a){Object.assign(n,a),delete n.resolve,delete n.reject}return n.resolve=a=>{r({status:"fulfilled",value:a}),e(a)},n.reject=a=>{r({status:"rejected",reason:a}),t(a)},n}var Sce=_ce;function Ace(){let e=[],t=0,n=s=>{s()},r=s=>{s()},a=Sce;const u=s=>{t?e.push(s):a(()=>{n(s)})},f=()=>{const s=e;e=[],s.length&&a(()=>{r(()=>{s.forEach(v=>{n(v)})})})};return{batch:s=>{let v;t++;try{v=s()}finally{t--,t||f()}return v},batchCalls:s=>(...v)=>{u(()=>{s(...v)})},schedule:u,setNotifyFunction:s=>{n=s},setBatchNotifyFunction:s=>{r=s},setScheduler:s=>{a=s}}}var Nl=Ace(),dv,km,hv,eG,Cce=(eG=class extends wT{constructor(){super();Vi(this,dv,!0);Vi(this,km);Vi(this,hv);Kr(this,hv,t=>{if(!r_&&window.addEventListener){const n=()=>t(!0),r=()=>t(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r)}}})}onSubscribe(){At(this,km)||this.setEventListener(At(this,hv))}onUnsubscribe(){var t;this.hasListeners()||((t=At(this,km))==null||t.call(this),Kr(this,km,void 0))}setEventListener(t){var n;Kr(this,hv,t),(n=At(this,km))==null||n.call(this),Kr(this,km,t(this.setOnline.bind(this)))}setOnline(t){At(this,dv)!==t&&(Kr(this,dv,t),this.listeners.forEach(r=>{r(t)}))}isOnline(){return At(this,dv)}},dv=new WeakMap,km=new WeakMap,hv=new WeakMap,eG),gA=new Cce;function kce(e){return Math.min(1e3*2**e,3e4)}function zW(e){return(e??"online")==="online"?gA.isOnline():!0}var RM=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function FW(e){let t=!1,n=0,r;const a=IM(),u=()=>a.status!=="pending",f=U=>{var q;if(!u()){const G=new RM(U);P(G),(q=e.onCancel)==null||q.call(e,G)}},s=()=>{t=!0},v=()=>{t=!1},x=()=>qO.isFocused()&&(e.networkMode==="always"||gA.isOnline())&&e.canRun(),A=()=>zW(e.networkMode)&&e.canRun(),C=U=>{u()||(r==null||r(),a.resolve(U))},P=U=>{u()||(r==null||r(),a.reject(U))},L=()=>new Promise(U=>{var q;r=G=>{(u()||x())&&U(G)},(q=e.onPause)==null||q.call(e)}).then(()=>{var U;r=void 0,u()||(U=e.onContinue)==null||U.call(e)}),F=()=>{if(u())return;let U;const q=n===0?e.initialPromise:void 0;try{U=q??e.fn()}catch(G){U=Promise.reject(G)}Promise.resolve(U).then(C).catch(G=>{var fe;if(u())return;const $=e.retry??(r_?0:3),X=e.retryDelay??kce,ie=typeof X=="function"?X(n,G):X,de=$===!0||typeof $=="number"&&n<$||typeof $=="function"&&$(n,G);if(t||!de){P(G);return}n++,(fe=e.onFail)==null||fe.call(e,n,G),xce(ie).then(()=>x()?void 0:L()).then(()=>{t?P(G):F()})})};return{promise:a,status:()=>a.status,cancel:f,continue:()=>(r==null||r(),a),cancelRetry:s,continueRetry:v,canStart:A,start:()=>(A()?F():L().then(F),a)}}var zg,tG,BW=(tG=class{constructor(){Vi(this,zg)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),SM(this.gcTime)&&Kr(this,zg,Og.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(r_?1/0:5*60*1e3))}clearGcTimeout(){At(this,zg)&&(Og.clearTimeout(At(this,zg)),Kr(this,zg,void 0))}},zg=new WeakMap,tG),Fg,fv,ed,Bg,wl,lT,jg,Yd,Hf,nG,Ice=(nG=class extends BW{constructor(t){super();Vi(this,Yd);Vi(this,Fg);Vi(this,fv);Vi(this,ed);Vi(this,Bg);Vi(this,wl);Vi(this,lT);Vi(this,jg);Kr(this,jg,!1),Kr(this,lT,t.defaultOptions),this.setOptions(t.options),this.observers=[],Kr(this,Bg,t.client),Kr(this,ed,At(this,Bg).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,Kr(this,Fg,hB(this.options)),this.state=t.state??At(this,Fg),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=At(this,wl))==null?void 0:t.promise}setOptions(t){if(this.options={...At(this,lT),...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=hB(this.options);n.data!==void 0&&(this.setState(dB(n.data,n.dataUpdatedAt)),Kr(this,Fg,n))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&At(this,ed).remove(this)}setData(t,n){const r=kM(this.state.data,t,this.options);return la(this,Yd,Hf).call(this,{data:r,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),r}setState(t,n){la(this,Yd,Hf).call(this,{type:"setState",state:t,setStateOptions:n})}cancel(t){var r,a;const n=(r=At(this,wl))==null?void 0:r.promise;return(a=At(this,wl))==null||a.cancel(t),n?n.then(qu).catch(qu):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(At(this,Fg))}isActive(){return this.observers.some(t=>td(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===GO||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>Ym(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!OW(this.state.dataUpdatedAt,t)}onFocus(){var n;const t=this.observers.find(r=>r.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(n=At(this,wl))==null||n.continue()}onOnline(){var n;const t=this.observers.find(r=>r.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(n=At(this,wl))==null||n.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),At(this,ed).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(n=>n!==t),this.observers.length||(At(this,wl)&&(At(this,jg)?At(this,wl).cancel({revert:!0}):At(this,wl).cancelRetry()),this.scheduleGc()),At(this,ed).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||la(this,Yd,Hf).call(this,{type:"invalidate"})}async fetch(t,n){var v,x,A,C,P,L,F,U,q,G,$,X;if(this.state.fetchStatus!=="idle"&&((v=At(this,wl))==null?void 0:v.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(At(this,wl))return At(this,wl).continueRetry(),At(this,wl).promise}if(t&&this.setOptions(t),!this.options.queryFn){const ie=this.observers.find(de=>de.options.queryFn);ie&&this.setOptions(ie.options)}const r=new AbortController,a=ie=>{Object.defineProperty(ie,"signal",{enumerable:!0,get:()=>(Kr(this,jg,!0),r.signal)})},u=()=>{const ie=DW(this.options,n),fe=(()=>{const be={client:At(this,Bg),queryKey:this.queryKey,meta:this.meta};return a(be),be})();return Kr(this,jg,!1),this.options.persister?this.options.persister(ie,fe,this):ie(fe)},s=(()=>{const ie={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:At(this,Bg),state:this.state,fetchFn:u};return a(ie),ie})();(x=this.options.behavior)==null||x.onFetch(s,this),Kr(this,fv,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((A=s.fetchOptions)==null?void 0:A.meta))&&la(this,Yd,Hf).call(this,{type:"fetch",meta:(C=s.fetchOptions)==null?void 0:C.meta}),Kr(this,wl,FW({initialPromise:n==null?void 0:n.initialPromise,fn:s.fetchFn,onCancel:ie=>{ie instanceof RM&&ie.revert&&this.setState({...At(this,fv),fetchStatus:"idle"}),r.abort()},onFail:(ie,de)=>{la(this,Yd,Hf).call(this,{type:"failed",failureCount:ie,error:de})},onPause:()=>{la(this,Yd,Hf).call(this,{type:"pause"})},onContinue:()=>{la(this,Yd,Hf).call(this,{type:"continue"})},retry:s.options.retry,retryDelay:s.options.retryDelay,networkMode:s.options.networkMode,canRun:()=>!0}));try{const ie=await At(this,wl).start();if(ie===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(ie),(L=(P=At(this,ed).config).onSuccess)==null||L.call(P,ie,this),(U=(F=At(this,ed).config).onSettled)==null||U.call(F,ie,this.state.error,this),ie}catch(ie){if(ie instanceof RM){if(ie.silent)return At(this,wl).promise;if(ie.revert){if(this.state.data===void 0)throw ie;return this.state.data}}throw la(this,Yd,Hf).call(this,{type:"error",error:ie}),(G=(q=At(this,ed).config).onError)==null||G.call(q,ie,this),(X=($=At(this,ed).config).onSettled)==null||X.call($,this.state.data,ie,this),ie}finally{this.scheduleGc()}}},Fg=new WeakMap,fv=new WeakMap,ed=new WeakMap,Bg=new WeakMap,wl=new WeakMap,lT=new WeakMap,jg=new WeakMap,Yd=new WeakSet,Hf=function(t){const n=r=>{switch(t.type){case"failed":return{...r,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...jW(r.data,this.options),fetchMeta:t.meta??null};case"success":const a={...r,...dB(t.data,t.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Kr(this,fv,t.manual?a:void 0),a;case"error":const u=t.error;return{...r,error:u,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:u,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...t.state}}};this.state=n(this.state),Nl.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),At(this,ed).notify({query:this,type:"updated",action:t})})},nG);function jW(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:zW(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function dB(e,t){return{data:e,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:!1,status:"success"}}function hB(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,n=t!==void 0,r=n?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Hu,ua,uT,yu,Ug,pv,Yf,Im,cT,mv,gv,Vg,$g,Rm,_v,Oa,zw,MM,PM,OM,LM,DM,NM,zM,UW,rG,Rce=(rG=class extends wT{constructor(t,n){super();Vi(this,Oa);Vi(this,Hu);Vi(this,ua);Vi(this,uT);Vi(this,yu);Vi(this,Ug);Vi(this,pv);Vi(this,Yf);Vi(this,Im);Vi(this,cT);Vi(this,mv);Vi(this,gv);Vi(this,Vg);Vi(this,$g);Vi(this,Rm);Vi(this,_v,new Set);this.options=n,Kr(this,Hu,t),Kr(this,Im,null),Kr(this,Yf,IM()),this.bindMethods(),this.setOptions(n)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(At(this,ua).addObserver(this),fB(At(this,ua),this.options)?la(this,Oa,zw).call(this):this.updateResult(),la(this,Oa,LM).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return FM(At(this,ua),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return FM(At(this,ua),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,la(this,Oa,DM).call(this),la(this,Oa,NM).call(this),At(this,ua).removeObserver(this)}setOptions(t){const n=this.options,r=At(this,ua);if(this.options=At(this,Hu).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof td(this.options.enabled,At(this,ua))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");la(this,Oa,zM).call(this),At(this,ua).setOptions(this.options),n._defaulted&&!AM(this.options,n)&&At(this,Hu).getQueryCache().notify({type:"observerOptionsUpdated",query:At(this,ua),observer:this});const a=this.hasListeners();a&&pB(At(this,ua),r,this.options,n)&&la(this,Oa,zw).call(this),this.updateResult(),a&&(At(this,ua)!==r||td(this.options.enabled,At(this,ua))!==td(n.enabled,At(this,ua))||Ym(this.options.staleTime,At(this,ua))!==Ym(n.staleTime,At(this,ua)))&&la(this,Oa,MM).call(this);const u=la(this,Oa,PM).call(this);a&&(At(this,ua)!==r||td(this.options.enabled,At(this,ua))!==td(n.enabled,At(this,ua))||u!==At(this,Rm))&&la(this,Oa,OM).call(this,u)}getOptimisticResult(t){const n=At(this,Hu).getQueryCache().build(At(this,Hu),t),r=this.createResult(n,t);return Pce(this,r)&&(Kr(this,yu,r),Kr(this,pv,this.options),Kr(this,Ug,At(this,ua).state)),r}getCurrentResult(){return At(this,yu)}trackResult(t,n){return new Proxy(t,{get:(r,a)=>(this.trackProp(a),n==null||n(a),a==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&At(this,Yf).status==="pending"&&At(this,Yf).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(r,a))})}trackProp(t){At(this,_v).add(t)}getCurrentQuery(){return At(this,ua)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const n=At(this,Hu).defaultQueryOptions(t),r=At(this,Hu).getQueryCache().build(At(this,Hu),n);return r.fetch().then(()=>this.createResult(r,n))}fetch(t){return la(this,Oa,zw).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),At(this,yu)))}createResult(t,n){var Qe;const r=At(this,ua),a=this.options,u=At(this,yu),f=At(this,Ug),s=At(this,pv),x=t!==r?t.state:At(this,uT),{state:A}=t;let C={...A},P=!1,L;if(n._optimisticResults){const we=this.hasListeners(),qe=!we&&fB(t,n),Je=we&&pB(t,r,n,a);(qe||Je)&&(C={...C,...jW(A.data,t.options)}),n._optimisticResults==="isRestoring"&&(C.fetchStatus="idle")}let{error:F,errorUpdatedAt:U,status:q}=C;L=C.data;let G=!1;if(n.placeholderData!==void 0&&L===void 0&&q==="pending"){let we;u!=null&&u.isPlaceholderData&&n.placeholderData===(s==null?void 0:s.placeholderData)?(we=u.data,G=!0):we=typeof n.placeholderData=="function"?n.placeholderData((Qe=At(this,gv))==null?void 0:Qe.state.data,At(this,gv)):n.placeholderData,we!==void 0&&(q="success",L=kM(u==null?void 0:u.data,we,n),P=!0)}if(n.select&&L!==void 0&&!G)if(u&&L===(f==null?void 0:f.data)&&n.select===At(this,cT))L=At(this,mv);else try{Kr(this,cT,n.select),L=n.select(L),L=kM(u==null?void 0:u.data,L,n),Kr(this,mv,L),Kr(this,Im,null)}catch(we){Kr(this,Im,we)}At(this,Im)&&(F=At(this,Im),L=At(this,mv),U=Date.now(),q="error");const $=C.fetchStatus==="fetching",X=q==="pending",ie=q==="error",de=X&&$,fe=L!==void 0,ve={status:q,fetchStatus:C.fetchStatus,isPending:X,isSuccess:q==="success",isError:ie,isInitialLoading:de,isLoading:de,data:L,dataUpdatedAt:C.dataUpdatedAt,error:F,errorUpdatedAt:U,failureCount:C.fetchFailureCount,failureReason:C.fetchFailureReason,errorUpdateCount:C.errorUpdateCount,isFetched:C.dataUpdateCount>0||C.errorUpdateCount>0,isFetchedAfterMount:C.dataUpdateCount>x.dataUpdateCount||C.errorUpdateCount>x.errorUpdateCount,isFetching:$,isRefetching:$&&!X,isLoadingError:ie&&!fe,isPaused:C.fetchStatus==="paused",isPlaceholderData:P,isRefetchError:ie&&fe,isStale:WO(t,n),refetch:this.refetch,promise:At(this,Yf),isEnabled:td(n.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const we=ft=>{ve.status==="error"?ft.reject(ve.error):ve.data!==void 0&&ft.resolve(ve.data)},qe=()=>{const ft=Kr(this,Yf,ve.promise=IM());we(ft)},Je=At(this,Yf);switch(Je.status){case"pending":t.queryHash===r.queryHash&&we(Je);break;case"fulfilled":(ve.status==="error"||ve.data!==Je.value)&&qe();break;case"rejected":(ve.status!=="error"||ve.error!==Je.reason)&&qe();break}}return ve}updateResult(){const t=At(this,yu),n=this.createResult(At(this,ua),this.options);if(Kr(this,Ug,At(this,ua).state),Kr(this,pv,this.options),At(this,Ug).data!==void 0&&Kr(this,gv,At(this,ua)),AM(n,t))return;Kr(this,yu,n);const r=()=>{if(!t)return!0;const{notifyOnChangeProps:a}=this.options,u=typeof a=="function"?a():a;if(u==="all"||!u&&!At(this,_v).size)return!0;const f=new Set(u??At(this,_v));return this.options.throwOnError&&f.add("error"),Object.keys(At(this,yu)).some(s=>{const v=s;return At(this,yu)[v]!==t[v]&&f.has(v)})};la(this,Oa,UW).call(this,{listeners:r()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&la(this,Oa,LM).call(this)}},Hu=new WeakMap,ua=new WeakMap,uT=new WeakMap,yu=new WeakMap,Ug=new WeakMap,pv=new WeakMap,Yf=new WeakMap,Im=new WeakMap,cT=new WeakMap,mv=new WeakMap,gv=new WeakMap,Vg=new WeakMap,$g=new WeakMap,Rm=new WeakMap,_v=new WeakMap,Oa=new WeakSet,zw=function(t){la(this,Oa,zM).call(this);let n=At(this,ua).fetch(this.options,t);return t!=null&&t.throwOnError||(n=n.catch(qu)),n},MM=function(){la(this,Oa,DM).call(this);const t=Ym(this.options.staleTime,At(this,ua));if(r_||At(this,yu).isStale||!SM(t))return;const r=OW(At(this,yu).dataUpdatedAt,t)+1;Kr(this,Vg,Og.setTimeout(()=>{At(this,yu).isStale||this.updateResult()},r))},PM=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(At(this,ua)):this.options.refetchInterval)??!1},OM=function(t){la(this,Oa,NM).call(this),Kr(this,Rm,t),!(r_||td(this.options.enabled,At(this,ua))===!1||!SM(At(this,Rm))||At(this,Rm)===0)&&Kr(this,$g,Og.setInterval(()=>{(this.options.refetchIntervalInBackground||qO.isFocused())&&la(this,Oa,zw).call(this)},At(this,Rm)))},LM=function(){la(this,Oa,MM).call(this),la(this,Oa,OM).call(this,la(this,Oa,PM).call(this))},DM=function(){At(this,Vg)&&(Og.clearTimeout(At(this,Vg)),Kr(this,Vg,void 0))},NM=function(){At(this,$g)&&(Og.clearInterval(At(this,$g)),Kr(this,$g,void 0))},zM=function(){const t=At(this,Hu).getQueryCache().build(At(this,Hu),this.options);if(t===At(this,ua))return;const n=At(this,ua);Kr(this,ua,t),Kr(this,uT,t.state),this.hasListeners()&&(n==null||n.removeObserver(this),t.addObserver(this))},UW=function(t){Nl.batch(()=>{t.listeners&&this.listeners.forEach(n=>{n(At(this,yu))}),At(this,Hu).getQueryCache().notify({query:At(this,ua),type:"observerResultsUpdated"})})},rG);function Mce(e,t){return td(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function fB(e,t){return Mce(e,t)||e.state.data!==void 0&&FM(e,t,t.refetchOnMount)}function FM(e,t,n){if(td(t.enabled,e)!==!1&&Ym(t.staleTime,e)!=="static"){const r=typeof n=="function"?n(e):n;return r==="always"||r!==!1&&WO(e,t)}return!1}function pB(e,t,n,r){return(e!==t||td(r.enabled,e)===!1)&&(!n.suspense||e.state.status!=="error")&&WO(e,n)}function WO(e,t){return td(t.enabled,e)!==!1&&e.isStaleByTime(Ym(t.staleTime,e))}function Pce(e,t){return!AM(e.getCurrentResult(),t)}function mB(e){return{onFetch:(t,n)=>{var A,C,P,L,F;const r=t.options,a=(P=(C=(A=t.fetchOptions)==null?void 0:A.meta)==null?void 0:C.fetchMore)==null?void 0:P.direction,u=((L=t.state.data)==null?void 0:L.pages)||[],f=((F=t.state.data)==null?void 0:F.pageParams)||[];let s={pages:[],pageParams:[]},v=0;const x=async()=>{let U=!1;const q=X=>{Tce(X,()=>t.signal,()=>U=!0)},G=DW(t.options,t.fetchOptions),$=async(X,ie,de)=>{if(U)return Promise.reject();if(ie==null&&X.pages.length)return Promise.resolve(X);const be=(()=>{const qe={client:t.client,queryKey:t.queryKey,pageParam:ie,direction:de?"backward":"forward",meta:t.options.meta};return q(qe),qe})(),ve=await G(be),{maxPages:Qe}=t.options,we=de?wce:bce;return{pages:we(X.pages,ve,Qe),pageParams:we(X.pageParams,ie,Qe)}};if(a&&u.length){const X=a==="backward",ie=X?Oce:gB,de={pages:u,pageParams:f},fe=ie(r,de);s=await $(de,fe,X)}else{const X=e??u.length;do{const ie=v===0?f[0]??r.initialPageParam:gB(r,s);if(v>0&&ie==null)break;s=await $(s,ie),v++}while(v<X)}return s};t.options.persister?t.fetchFn=()=>{var U,q;return(q=(U=t.options).persister)==null?void 0:q.call(U,x,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n)}:t.fetchFn=x}}}function gB(e,{pages:t,pageParams:n}){const r=t.length-1;return t.length>0?e.getNextPageParam(t[r],t,n[r],n):void 0}function Oce(e,{pages:t,pageParams:n}){var r;return t.length>0?(r=e.getPreviousPageParam)==null?void 0:r.call(e,t[0],t,n[0],n):void 0}var dT,Vh,vu,Hg,$h,hm,iG,Lce=(iG=class extends BW{constructor(t){super();Vi(this,$h);Vi(this,dT);Vi(this,Vh);Vi(this,vu);Vi(this,Hg);Kr(this,dT,t.client),this.mutationId=t.mutationId,Kr(this,vu,t.mutationCache),Kr(this,Vh,[]),this.state=t.state||Dce(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){At(this,Vh).includes(t)||(At(this,Vh).push(t),this.clearGcTimeout(),At(this,vu).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){Kr(this,Vh,At(this,Vh).filter(n=>n!==t)),this.scheduleGc(),At(this,vu).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){At(this,Vh).length||(this.state.status==="pending"?this.scheduleGc():At(this,vu).remove(this))}continue(){var t;return((t=At(this,Hg))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var f,s,v,x,A,C,P,L,F,U,q,G,$,X,ie,de,fe,be,ve,Qe;const n=()=>{la(this,$h,hm).call(this,{type:"continue"})},r={client:At(this,dT),meta:this.options.meta,mutationKey:this.options.mutationKey};Kr(this,Hg,FW({fn:()=>this.options.mutationFn?this.options.mutationFn(t,r):Promise.reject(new Error("No mutationFn found")),onFail:(we,qe)=>{la(this,$h,hm).call(this,{type:"failed",failureCount:we,error:qe})},onPause:()=>{la(this,$h,hm).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>At(this,vu).canRun(this)}));const a=this.state.status==="pending",u=!At(this,Hg).canStart();try{if(a)n();else{la(this,$h,hm).call(this,{type:"pending",variables:t,isPaused:u}),await((s=(f=At(this,vu).config).onMutate)==null?void 0:s.call(f,t,this,r));const qe=await((x=(v=this.options).onMutate)==null?void 0:x.call(v,t,r));qe!==this.state.context&&la(this,$h,hm).call(this,{type:"pending",context:qe,variables:t,isPaused:u})}const we=await At(this,Hg).start();return await((C=(A=At(this,vu).config).onSuccess)==null?void 0:C.call(A,we,t,this.state.context,this,r)),await((L=(P=this.options).onSuccess)==null?void 0:L.call(P,we,t,this.state.context,r)),await((U=(F=At(this,vu).config).onSettled)==null?void 0:U.call(F,we,null,this.state.variables,this.state.context,this,r)),await((G=(q=this.options).onSettled)==null?void 0:G.call(q,we,null,t,this.state.context,r)),la(this,$h,hm).call(this,{type:"success",data:we}),we}catch(we){try{await((X=($=At(this,vu).config).onError)==null?void 0:X.call($,we,t,this.state.context,this,r))}catch(qe){Promise.reject(qe)}try{await((de=(ie=this.options).onError)==null?void 0:de.call(ie,we,t,this.state.context,r))}catch(qe){Promise.reject(qe)}try{await((be=(fe=At(this,vu).config).onSettled)==null?void 0:be.call(fe,void 0,we,this.state.variables,this.state.context,this,r))}catch(qe){Promise.reject(qe)}try{await((Qe=(ve=this.options).onSettled)==null?void 0:Qe.call(ve,void 0,we,t,this.state.context,r))}catch(qe){Promise.reject(qe)}throw la(this,$h,hm).call(this,{type:"error",error:we}),we}finally{At(this,vu).runNext(this)}}},dT=new WeakMap,Vh=new WeakMap,vu=new WeakMap,Hg=new WeakMap,$h=new WeakSet,hm=function(t){const n=r=>{switch(t.type){case"failed":return{...r,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...r,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:t.error,failureCount:r.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=n(this.state),Nl.batch(()=>{At(this,Vh).forEach(r=>{r.onMutationUpdate(t)}),At(this,vu).notify({mutation:this,type:"updated",action:t})})},iG);function Dce(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Kf,Kd,hT,sG,Nce=(sG=class extends wT{constructor(t={}){super();Vi(this,Kf);Vi(this,Kd);Vi(this,hT);this.config=t,Kr(this,Kf,new Set),Kr(this,Kd,new Map),Kr(this,hT,0)}build(t,n,r){const a=new Lce({client:t,mutationCache:this,mutationId:++ZS(this,hT)._,options:t.defaultMutationOptions(n),state:r});return this.add(a),a}add(t){At(this,Kf).add(t);const n=h3(t);if(typeof n=="string"){const r=At(this,Kd).get(n);r?r.push(t):At(this,Kd).set(n,[t])}this.notify({type:"added",mutation:t})}remove(t){if(At(this,Kf).delete(t)){const n=h3(t);if(typeof n=="string"){const r=At(this,Kd).get(n);if(r)if(r.length>1){const a=r.indexOf(t);a!==-1&&r.splice(a,1)}else r[0]===t&&At(this,Kd).delete(n)}}this.notify({type:"removed",mutation:t})}canRun(t){const n=h3(t);if(typeof n=="string"){const r=At(this,Kd).get(n),a=r==null?void 0:r.find(u=>u.state.status==="pending");return!a||a===t}else return!0}runNext(t){var r;const n=h3(t);if(typeof n=="string"){const a=(r=At(this,Kd).get(n))==null?void 0:r.find(u=>u!==t&&u.state.isPaused);return(a==null?void 0:a.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Nl.batch(()=>{At(this,Kf).forEach(t=>{this.notify({type:"removed",mutation:t})}),At(this,Kf).clear(),At(this,Kd).clear()})}getAll(){return Array.from(At(this,Kf))}find(t){const n={exact:!0,...t};return this.getAll().find(r=>lB(n,r))}findAll(t={}){return this.getAll().filter(n=>lB(t,n))}notify(t){Nl.batch(()=>{this.listeners.forEach(n=>{n(t)})})}resumePausedMutations(){const t=this.getAll().filter(n=>n.state.isPaused);return Nl.batch(()=>Promise.all(t.map(n=>n.continue().catch(qu))))}},Kf=new WeakMap,Kd=new WeakMap,hT=new WeakMap,sG);function h3(e){var t;return(t=e.options.scope)==null?void 0:t.id}var Hh,aG,zce=(aG=class extends wT{constructor(t={}){super();Vi(this,Hh);this.config=t,Kr(this,Hh,new Map)}build(t,n,r){const a=n.queryKey,u=n.queryHash??HO(a,n);let f=this.get(u);return f||(f=new Ice({client:t,queryKey:a,queryHash:u,options:t.defaultQueryOptions(n),state:r,defaultOptions:t.getQueryDefaults(a)}),this.add(f)),f}add(t){At(this,Hh).has(t.queryHash)||(At(this,Hh).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const n=At(this,Hh).get(t.queryHash);n&&(t.destroy(),n===t&&At(this,Hh).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Nl.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return At(this,Hh).get(t)}getAll(){return[...At(this,Hh).values()]}find(t){const n={exact:!0,...t};return this.getAll().find(r=>oB(n,r))}findAll(t={}){const n=this.getAll();return Object.keys(t).length>0?n.filter(r=>oB(t,r)):n}notify(t){Nl.batch(()=>{this.listeners.forEach(n=>{n(t)})})}onFocus(){Nl.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Nl.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Hh=new WeakMap,aG),Do,Mm,Pm,yv,vv,Om,xv,bv,oG,Fce=(oG=class{constructor(e={}){Vi(this,Do);Vi(this,Mm);Vi(this,Pm);Vi(this,yv);Vi(this,vv);Vi(this,Om);Vi(this,xv);Vi(this,bv);Kr(this,Do,e.queryCache||new zce),Kr(this,Mm,e.mutationCache||new Nce),Kr(this,Pm,e.defaultOptions||{}),Kr(this,yv,new Map),Kr(this,vv,new Map),Kr(this,Om,0)}mount(){ZS(this,Om)._++,At(this,Om)===1&&(Kr(this,xv,qO.subscribe(async e=>{e&&(await this.resumePausedMutations(),At(this,Do).onFocus())})),Kr(this,bv,gA.subscribe(async e=>{e&&(await this.resumePausedMutations(),At(this,Do).onOnline())})))}unmount(){var e,t;ZS(this,Om)._--,At(this,Om)===0&&((e=At(this,xv))==null||e.call(this),Kr(this,xv,void 0),(t=At(this,bv))==null||t.call(this),Kr(this,bv,void 0))}isFetching(e){return At(this,Do).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return At(this,Mm).findAll({...e,status:"pending"}).length}getQueryData(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=At(this,Do).get(t.queryHash))==null?void 0:n.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=At(this,Do).build(this,t),r=n.state.data;return r===void 0?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(Ym(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(r))}getQueriesData(e){return At(this,Do).findAll(e).map(({queryKey:t,state:n})=>{const r=n.data;return[t,r]})}setQueryData(e,t,n){const r=this.defaultQueryOptions({queryKey:e}),a=At(this,Do).get(r.queryHash),u=a==null?void 0:a.state.data,f=yce(t,u);if(f!==void 0)return At(this,Do).build(this,r).setData(f,{...n,manual:!0})}setQueriesData(e,t,n){return Nl.batch(()=>At(this,Do).findAll(e).map(({queryKey:r})=>[r,this.setQueryData(r,t,n)]))}getQueryState(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=At(this,Do).get(t.queryHash))==null?void 0:n.state}removeQueries(e){const t=At(this,Do);Nl.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=At(this,Do);return Nl.batch(()=>(n.findAll(e).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},r=Nl.batch(()=>At(this,Do).findAll(e).map(a=>a.cancel(n)));return Promise.all(r).then(qu).catch(qu)}invalidateQueries(e,t={}){return Nl.batch(()=>(At(this,Do).findAll(e).forEach(n=>{n.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},r=Nl.batch(()=>At(this,Do).findAll(e).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let u=a.fetch(void 0,n);return n.throwOnError||(u=u.catch(qu)),a.state.fetchStatus==="paused"?Promise.resolve():u}));return Promise.all(r).then(qu)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=At(this,Do).build(this,t);return n.isStaleByTime(Ym(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(qu).catch(qu)}fetchInfiniteQuery(e){return e.behavior=mB(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(qu).catch(qu)}ensureInfiniteQueryData(e){return e.behavior=mB(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return gA.isOnline()?At(this,Mm).resumePausedMutations():Promise.resolve()}getQueryCache(){return At(this,Do)}getMutationCache(){return At(this,Mm)}getDefaultOptions(){return At(this,Pm)}setDefaultOptions(e){Kr(this,Pm,e)}setQueryDefaults(e,t){At(this,yv).set(z2(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...At(this,yv).values()],n={};return t.forEach(r=>{F2(e,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(e,t){At(this,vv).set(z2(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...At(this,vv).values()],n={};return t.forEach(r=>{F2(e,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...At(this,Pm).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=HO(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===GO&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...At(this,Pm).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){At(this,Do).clear(),At(this,Mm).clear()}},Do=new WeakMap,Mm=new WeakMap,Pm=new WeakMap,yv=new WeakMap,vv=new WeakMap,Om=new WeakMap,xv=new WeakMap,bv=new WeakMap,oG),VW=B.createContext(void 0),$W=e=>{const t=B.useContext(VW);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},Bce=({client:e,children:t})=>(B.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),k.jsx(VW.Provider,{value:e,children:t})),HW=B.createContext(!1),jce=()=>B.useContext(HW);HW.Provider;function Uce(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Vce=B.createContext(Uce()),$ce=()=>B.useContext(Vce),Hce=(e,t,n)=>{const r=n!=null&&n.state.error&&typeof e.throwOnError=="function"?NW(e.throwOnError,[n.state.error,n]):e.throwOnError;(e.suspense||e.experimental_prefetchInRender||r)&&(t.isReset()||(e.retryOnMount=!1))},Gce=e=>{B.useEffect(()=>{e.clearReset()},[e])},qce=({result:e,errorResetBoundary:t,throwOnError:n,query:r,suspense:a})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(a&&e.data===void 0||NW(n,[e.error,r])),Wce=e=>{if(e.suspense){const n=a=>a==="static"?a:Math.max(a??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...a)=>n(r(...a)):n(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Zce=(e,t)=>e.isLoading&&e.isFetching&&!t,Xce=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,_B=(e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()});function Yce(e,t,n){var P,L,F,U;const r=jce(),a=$ce(),u=$W(),f=u.defaultQueryOptions(e);(L=(P=u.getDefaultOptions().queries)==null?void 0:P._experimental_beforeQuery)==null||L.call(P,f);const s=u.getQueryCache().get(f.queryHash);f._optimisticResults=r?"isRestoring":"optimistic",Wce(f),Hce(f,a,s),Gce(a);const v=!u.getQueryCache().get(f.queryHash),[x]=B.useState(()=>new t(u,f)),A=x.getOptimisticResult(f),C=!r&&e.subscribed!==!1;if(B.useSyncExternalStore(B.useCallback(q=>{const G=C?x.subscribe(Nl.batchCalls(q)):qu;return x.updateResult(),G},[x,C]),()=>x.getCurrentResult(),()=>x.getCurrentResult()),B.useEffect(()=>{x.setOptions(f)},[f,x]),Xce(f,A))throw _B(f,x,a);if(qce({result:A,errorResetBoundary:a,throwOnError:f.throwOnError,query:s,suspense:f.suspense}))throw A.error;if((U=(F=u.getDefaultOptions().queries)==null?void 0:F._experimental_afterQuery)==null||U.call(F,f,A),f.experimental_prefetchInRender&&!r_&&Zce(A,r)){const q=v?_B(f,x,a):s==null?void 0:s.promise;q==null||q.catch(qu).finally(()=>{x.updateResult()})}return f.notifyOnChangeProps?A:x.trackResult(A)}function ch(e,t){return Yce(e,Rce)}function Kce(e){return typeof e=="object"&&e!==null}function Qce(e,t){if(!!!e)throw new Error("Unexpected invariant triggered.")}const Jce=/\r\n|[\n\r]/g;function BM(e,t){let n=0,r=1;for(const a of e.body.matchAll(Jce)){if(typeof a.index=="number"||Qce(!1),a.index>=t)break;n=a.index+a[0].length,r+=1}return{line:r,column:t+1-n}}function ede(e){return GW(e.source,BM(e.source,e.start))}function GW(e,t){const n=e.locationOffset.column-1,r="".padStart(n)+e.body,a=t.line-1,u=e.locationOffset.line-1,f=t.line+u,s=t.line===1?n:0,v=t.column+s,x=`${e.name}:${f}:${v}
`,A=r.split(/\r\n|[\n\r]/g),C=A[a];if(C.length>120){const P=Math.floor(v/80),L=v%80,F=[];for(let U=0;U<C.length;U+=80)F.push(C.slice(U,U+80));return x+yB([[`${f} |`,F[0]],...F.slice(1,P+1).map(U=>["|",U]),["|","^".padStart(L)],["|",F[P+1]]])}return x+yB([[`${f-1} |`,A[a-1]],[`${f} |`,C],["|","^".padStart(v)],[`${f+1} |`,A[a+1]]])}function yB(e){const t=e.filter(([r,a])=>a!==void 0),n=Math.max(...t.map(([r])=>r.length));return t.map(([r,a])=>r.padStart(n)+(a?" "+a:"")).join(`
`)}function tde(e){const t=e[0];return t==null||"kind"in t||"length"in t?{nodes:t,source:e[1],positions:e[2],path:e[3],originalError:e[4],extensions:e[5]}:t}class ZO extends Error{constructor(t,...n){var r,a,u;const{nodes:f,source:s,positions:v,path:x,originalError:A,extensions:C}=tde(n);super(t),this.name="GraphQLError",this.path=x??void 0,this.originalError=A??void 0,this.nodes=vB(Array.isArray(f)?f:f?[f]:void 0);const P=vB((r=this.nodes)===null||r===void 0?void 0:r.map(F=>F.loc).filter(F=>F!=null));this.source=s??(P==null||(a=P[0])===null||a===void 0?void 0:a.source),this.positions=v??(P==null?void 0:P.map(F=>F.start)),this.locations=v&&s?v.map(F=>BM(s,F)):P==null?void 0:P.map(F=>BM(F.source,F.start));const L=Kce(A==null?void 0:A.extensions)?A==null?void 0:A.extensions:void 0;this.extensions=(u=C??L)!==null&&u!==void 0?u:Object.create(null),Object.defineProperties(this,{message:{writable:!0,enumerable:!0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),A!=null&&A.stack?Object.defineProperty(this,"stack",{value:A.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,ZO):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}get[Symbol.toStringTag](){return"GraphQLError"}toString(){let t=this.message;if(this.nodes)for(const n of this.nodes)n.loc&&(t+=`

`+ede(n.loc));else if(this.source&&this.locations)for(const n of this.locations)t+=`

`+GW(this.source,n);return t}toJSON(){const t={message:this.message};return this.locations!=null&&(t.locations=this.locations),this.path!=null&&(t.path=this.path),this.extensions!=null&&Object.keys(this.extensions).length>0&&(t.extensions=this.extensions),t}}function vB(e){return e===void 0||e.length===0?void 0:e}function jM(e,t="unset"){try{return JSON.parse(e)}catch{return t==="unset"?null:t}}var zm=(e=>(e.CRITICAL="critical",e.WARNING="warning",e.INFO="info",e))(zm||{}),qW=(e=>(e.BANNER="banner",e.TOAST="toast",e.SILENT="silent",e.DEV_ONLY="dev_only",e))(qW||{}),b_={COPILOT_ERROR:"CopilotError",COPILOT_API_DISCOVERY_ERROR:"CopilotApiDiscoveryError",COPILOT_REMOTE_ENDPOINT_DISCOVERY_ERROR:"CopilotKitRemoteEndpointDiscoveryError",COPILOT_KIT_AGENT_DISCOVERY_ERROR:"CopilotKitAgentDiscoveryError",COPILOT_KIT_LOW_LEVEL_ERROR:"CopilotKitLowLevelError",CONFIGURATION_ERROR:"ConfigurationError",MISSING_PUBLIC_API_KEY_ERROR:"MissingPublicApiKeyError"},B2=(e=>(e.NETWORK_ERROR="NETWORK_ERROR",e.NOT_FOUND="NOT_FOUND",e.AGENT_NOT_FOUND="AGENT_NOT_FOUND",e.API_NOT_FOUND="API_NOT_FOUND",e.REMOTE_ENDPOINT_NOT_FOUND="REMOTE_ENDPOINT_NOT_FOUND",e.AUTHENTICATION_ERROR="AUTHENTICATION_ERROR",e.MISUSE="MISUSE",e.UNKNOWN="UNKNOWN",e.VERSION_MISMATCH="VERSION_MISMATCH",e.CONFIGURATION_ERROR="CONFIGURATION_ERROR",e.MISSING_PUBLIC_API_KEY_ERROR="MISSING_PUBLIC_API_KEY_ERROR",e.UPGRADE_REQUIRED_ERROR="UPGRADE_REQUIRED_ERROR",e))(B2||{}),x1="https://docs.copilotkit.ai",G1=e=>`See more: [${e}](${e})`,j2={NETWORK_ERROR:{statusCode:503,troubleshootingUrl:`${x1}/troubleshooting/common-issues#i-am-getting-a-network-errors--api-not-found`,visibility:"banner",severity:"critical"},NOT_FOUND:{statusCode:404,troubleshootingUrl:`${x1}/troubleshooting/common-issues#i-am-getting-a-network-errors--api-not-found`,visibility:"banner",severity:"critical"},AGENT_NOT_FOUND:{statusCode:500,troubleshootingUrl:`${x1}/coagents/troubleshooting/common-issues#i-am-getting-agent-not-found-error`,visibility:"banner",severity:"critical"},API_NOT_FOUND:{statusCode:404,troubleshootingUrl:`${x1}/troubleshooting/common-issues#i-am-getting-a-network-errors--api-not-found`,visibility:"banner",severity:"critical"},REMOTE_ENDPOINT_NOT_FOUND:{statusCode:404,troubleshootingUrl:`${x1}/troubleshooting/common-issues#i-am-getting-copilotkits-remote-endpoint-not-found-error`,visibility:"banner",severity:"critical"},AUTHENTICATION_ERROR:{statusCode:401,troubleshootingUrl:`${x1}/troubleshooting/common-issues#authentication-errors`,visibility:"banner",severity:"critical"},MISUSE:{statusCode:400,troubleshootingUrl:null,visibility:"dev_only",severity:"warning"},UNKNOWN:{statusCode:500,visibility:"toast",severity:"critical"},CONFIGURATION_ERROR:{statusCode:400,troubleshootingUrl:null,severity:"warning",visibility:"banner"},MISSING_PUBLIC_API_KEY_ERROR:{statusCode:400,troubleshootingUrl:null,severity:"critical",visibility:"banner"},UPGRADE_REQUIRED_ERROR:{statusCode:402,troubleshootingUrl:null,severity:"warning",visibility:"banner"},VERSION_MISMATCH:{statusCode:400,troubleshootingUrl:null,visibility:"dev_only",severity:"info"}},Km=class extends ZO{constructor({message:e="Unknown error occurred",code:t,severity:n,visibility:r}){const a=b_.COPILOT_ERROR,u=j2[t],{statusCode:f}=u,s=r??u.visibility??"toast",v=n??("severity"in u?u.severity:void 0);super(e,{extensions:{name:a,statusCode:f,code:t,visibility:s,severity:v,troubleshootingUrl:"troubleshootingUrl"in u?u.troubleshootingUrl:null,originalError:{message:e,stack:new Error().stack}}}),this.code=t,this.name=a,this.statusCode=f,this.severity=v,this.visibility=s}},WW=class extends Km{constructor(e={}){const t=e.url??"";let n="";t!=null&&t.includes("/info")?n="when fetching CopilotKit info":t.includes("/actions/execute")?n="when attempting to execute actions.":t.includes("/agents/state")?n="when attempting to get agent state.":t.includes("/agents/execute")&&(n="when attempting to execute agent(s).");const r=e.message??(e.url?`Failed to find CopilotKit API endpoint at url ${e.url} ${n}`:"Failed to find CopilotKit API endpoint."),a=e.code??"API_NOT_FOUND",u=`${r}.

${G1(j2[a].troubleshootingUrl)}`;super({message:u,code:a}),this.name=b_.COPILOT_API_DISCOVERY_ERROR}},nde=class extends WW{constructor(e){const t=(e==null?void 0:e.message)??(e!=null&&e.url?`Failed to find or contact remote endpoint at url ${e.url}`:"Failed to find or contact remote endpoint");super({message:t,code:"REMOTE_ENDPOINT_NOT_FOUND"}),this.name=b_.COPILOT_REMOTE_ENDPOINT_DISCOVERY_ERROR}},rde=class extends Km{constructor(e){const{agentName:t,availableAgents:n}=e,r="AGENT_NOT_FOUND",a=G1(j2[r].troubleshootingUrl);let u;if(n.length){const f=n.map(s=>s.name).join(", ");t?u=`Agent '${t}' was not found. Available agents are: ${f}. Please verify the agent name in your configuration and ensure it matches one of the available agents.

${a}`:u=`The requested agent was not found. Available agents are: ${f}. Please verify the agent name in your configuration and ensure it matches one of the available agents.

${a}`}else u=`${t?`Agent '${t}'`:"The requested agent"} was not found. Please set up at least one agent before proceeding. ${a}`;super({message:u,code:r}),this.name=b_.COPILOT_KIT_AGENT_DISCOVERY_ERROR}},ide=class extends Km{constructor({error:e,url:t,message:n}){let r="NETWORK_ERROR";const a=e.code,u=n??ade({errorCode:a,url:t});super({message:u,code:r}),this.name=b_.COPILOT_KIT_LOW_LEVEL_ERROR}},ZW=class extends Km{constructor(e){super({message:e,code:"CONFIGURATION_ERROR"}),this.name=b_.CONFIGURATION_ERROR,this.severity="warning"}},sde=class extends ZW{constructor(e){super(e),this.name=b_.MISSING_PUBLIC_API_KEY_ERROR,this.severity="critical"}},ade=({errorCode:e,url:t})=>{const n=j2.NETWORK_ERROR.troubleshootingUrl,r=(a=`Failed to fetch from url ${t}.`)=>`${a}.

Possible reasons:
- -The server may have an error preventing it from returning a response (Check the server logs for more info).
- -The server might be down or unreachable
- -There might be a network issue (e.g., DNS failure, connection timeout) 
- -The URL might be incorrect
- -The server is not running on the specified port

${G1(n)}`;if(t.includes("/info"))return r(`Failed to fetch CopilotKit agents/action information from url ${t}.`);if(t.includes("/actions/execute"))return r(`Fetch call to ${t} to execute actions failed.`);if(t.includes("/agents/state"))return r(`Fetch call to ${t} to get agent state failed.`);if(t.includes("/agents/execute"))return r(`Fetch call to ${t} to execute agent(s) failed.`);switch(e){case"ECONNREFUSED":return`Connection to ${t} was refused. Ensure the server is running and accessible.

${G1(n)}`;case"ENOTFOUND":return`The server on ${t} could not be found. Check the URL or your network configuration.

${G1(j2.NOT_FOUND.troubleshootingUrl)}`;case"ETIMEDOUT":return`The connection to ${t} timed out. The server might be overloaded or taking too long to respond.

${G1(n)}`;default:return}};const ode=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function lde(e){return typeof e=="string"&&ode.test(e)}function ude(e){if(!lde(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=t&255,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=t&255,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=t&255,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=t&255,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=t&255,n}var Pl=[];for(var s5=0;s5<256;++s5)Pl.push((s5+256).toString(16).slice(1));function XW(e,t=0){return(Pl[e[t+0]]+Pl[e[t+1]]+Pl[e[t+2]]+Pl[e[t+3]]+"-"+Pl[e[t+4]]+Pl[e[t+5]]+"-"+Pl[e[t+6]]+Pl[e[t+7]]+"-"+Pl[e[t+8]]+Pl[e[t+9]]+"-"+Pl[e[t+10]]+Pl[e[t+11]]+Pl[e[t+12]]+Pl[e[t+13]]+Pl[e[t+14]]+Pl[e[t+15]]).toLowerCase()}var f3,cde=new Uint8Array(16);function dde(){if(!f3&&(f3=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!f3))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return f3(cde)}function hde(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}var fde="6ba7b810-9dad-11d1-80b4-00c04fd430c8",pde="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function mde(e,t,n){function r(a,u,f,s){var v;if(typeof a=="string"&&(a=hde(a)),typeof u=="string"&&(u=ude(u)),((v=u)===null||v===void 0?void 0:v.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var x=new Uint8Array(16+a.length);if(x.set(u),x.set(a,u.length),x=n(x),x[6]=x[6]&15|t,x[8]=x[8]&63|128,f){s=s||0;for(var A=0;A<16;++A)f[s+A]=x[A];return f}return XW(x)}try{r.name=e}catch{}return r.DNS=fde,r.URL=pde,r}var gde=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const xB={randomUUID:gde};function YW(e,t,n){if(xB.randomUUID&&!e)return xB.randomUUID();e=e||{};var r=e.random||(e.rng||dde)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,XW(r)}function _de(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}}function a5(e,t){return e<<t|e>>>32-t}function yde(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof e=="string"){var r=unescape(encodeURIComponent(e));e=[];for(var a=0;a<r.length;++a)e.push(r.charCodeAt(a))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var u=e.length/4+2,f=Math.ceil(u/16),s=new Array(f),v=0;v<f;++v){for(var x=new Uint32Array(16),A=0;A<16;++A)x[A]=e[v*64+A*4]<<24|e[v*64+A*4+1]<<16|e[v*64+A*4+2]<<8|e[v*64+A*4+3];s[v]=x}s[f-1][14]=(e.length-1)*8/Math.pow(2,32),s[f-1][14]=Math.floor(s[f-1][14]),s[f-1][15]=(e.length-1)*8&4294967295;for(var C=0;C<f;++C){for(var P=new Uint32Array(80),L=0;L<16;++L)P[L]=s[C][L];for(var F=16;F<80;++F)P[F]=a5(P[F-3]^P[F-8]^P[F-14]^P[F-16],1);for(var U=n[0],q=n[1],G=n[2],$=n[3],X=n[4],ie=0;ie<80;++ie){var de=Math.floor(ie/20),fe=a5(U,5)+_de(de,q,G,$)+X+t[de]+P[ie]>>>0;X=$,$=G,G=a5(q,30)>>>0,q=U,U=fe}n[0]=n[0]+U>>>0,n[1]=n[1]+q>>>0,n[2]=n[2]+G>>>0,n[3]=n[3]+$>>>0,n[4]=n[4]+X>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,n[0]&255,n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,n[1]&255,n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,n[2]&255,n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,n[3]&255,n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,n[4]&255]}var vde=mde("v5",80,yde);function KW(){return"ck-"+YW()}function QW(){return YW()}function UM(e){if(typeof e=="function")return e.toString();if(Array.isArray(e))return e.map(UM);if(e!==null&&typeof e=="object"){const t={};for(const n of Object.keys(e))t[n]=UM(e[n]);return t}return e}function bB(e,t){const r="e4b01160-ff74-4c6e-9b27-d53cd930fe8e",a=typeof e=="string"?e:JSON.stringify(UM(e));return vde(a,r)}var JW="https://api.cloud.copilotkit.ai",xde="v1",bde=`${JW}/copilotkit/${xde}`,eZ="X-CopilotCloud-Public-Api-Key",VM=function(e,t){return VM=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])},VM(e,t)};function ex(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");VM(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var Zh=function(){return Zh=Object.assign||function(t){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var u in n)Object.prototype.hasOwnProperty.call(n,u)&&(t[u]=n[u])}return t},Zh.apply(this,arguments)};function tZ(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n}function wde(e,t,n,r){function a(u){return u instanceof n?u:new n(function(f){f(u)})}return new(n||(n=Promise))(function(u,f){function s(A){try{x(r.next(A))}catch(C){f(C)}}function v(A){try{x(r.throw(A))}catch(C){f(C)}}function x(A){A.done?u(A.value):a(A.value).then(s,v)}x((r=r.apply(e,t||[])).next())})}function nZ(e,t){var n={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},r,a,u,f=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return f.next=s(0),f.throw=s(1),f.return=s(2),typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function s(x){return function(A){return v([x,A])}}function v(x){if(r)throw new TypeError("Generator is already executing.");for(;f&&(f=0,x[0]&&(n=0)),n;)try{if(r=1,a&&(u=x[0]&2?a.return:x[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,x[1])).done)return u;switch(a=0,u&&(x=[x[0]&2,u.value]),x[0]){case 0:case 1:u=x;break;case 4:return n.label++,{value:x[1],done:!1};case 5:n.label++,a=x[1],x=[0];continue;case 7:x=n.ops.pop(),n.trys.pop();continue;default:if(u=n.trys,!(u=u.length>0&&u[u.length-1])&&(x[0]===6||x[0]===2)){n=0;continue}if(x[0]===3&&(!u||x[1]>u[0]&&x[1]<u[3])){n.label=x[1];break}if(x[0]===6&&n.label<u[1]){n.label=u[1],u=x;break}if(u&&n.label<u[2]){n.label=u[2],n.ops.push(x);break}u[2]&&n.ops.pop(),n.trys.pop();continue}x=t.call(e,n)}catch(A){x=[6,A],a=0}finally{r=u=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function Iv(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function $M(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),a,u=[],f;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)u.push(a.value)}catch(s){f={error:s}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(f)throw f.error}}return u}function _A(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,u;r<a;r++)(u||!(r in t))&&(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return e.concat(u||Array.prototype.slice.call(t))}function ev(e){return this instanceof ev?(this.v=e,this):new ev(e)}function Tde(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),a,u=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",f),a[Symbol.asyncIterator]=function(){return this},a;function f(L){return function(F){return Promise.resolve(F).then(L,C)}}function s(L,F){r[L]&&(a[L]=function(U){return new Promise(function(q,G){u.push([L,U,q,G])>1||v(L,U)})},F&&(a[L]=F(a[L])))}function v(L,F){try{x(r[L](F))}catch(U){P(u[0][3],U)}}function x(L){L.value instanceof ev?Promise.resolve(L.value.v).then(A,C):P(u[0][2],L)}function A(L){v("next",L)}function C(L){v("throw",L)}function P(L,F){L(F),u.shift(),u.length&&v(u[0][0],u[0][1])}}function Ede(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof Iv=="function"?Iv(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(u){n[u]=e[u]&&function(f){return new Promise(function(s,v){f=e[u](f),a(s,v,f.done,f.value)})}}function a(u,f,s,v){Promise.resolve(v).then(function(x){u({value:x,done:s})},f)}}const Sde="modulepreload",Ade=function(e){return"/"+e},wB={},TT=function(t,n,r){let a=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),s=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));a=Promise.allSettled(n.map(v=>{if(v=Ade(v),v in wB)return;wB[v]=!0;const x=v.endsWith(".css"),A=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${A}`))return;const C=document.createElement("link");if(C.rel=x?"stylesheet":Sde,x||(C.as="script"),C.crossOrigin="",C.href=v,s&&C.setAttribute("nonce",s),document.head.appendChild(C),x)return new Promise((P,L)=>{C.addEventListener("load",P),C.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${v}`)))})}))}function u(f){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=f,window.dispatchEvent(s),!s.defaultPrevented)throw f}return a.then(f=>{for(const s of f||[])s.status==="rejected"&&u(s.reason);return t().catch(u)})};function TB(e){return` \r
	`.indexOf(e)>=0}function rZ(e){for(var t=["topLevel"],n=0,r,a,u,f=function($){return t.push($)},s=function($){return t[t.length-1]=$},v=function($){r==null&&(r=n,a=t.length,u=$)},x=function($){$===u&&(r=void 0,a=void 0,u=void 0)},A=function(){return t.pop()},C=function(){return n--},P=function($){if("0"<=$&&$<="9"){f("number");return}switch($){case'"':f("string");return;case"-":f("numberNeedsDigit");return;case"t":f("true");return;case"f":f("false");return;case"n":f("null");return;case"[":f("arrayNeedsValue");return;case"{":f("objectNeedsKey");return}},L=e.length;n<L;n++){var F=e[n];switch(t[t.length-1]){case"topLevel":P(F);break;case"string":switch(F){case'"':A();break;case"\\":v("stringEscape"),f("stringEscaped");break}break;case"stringEscaped":F==="u"?f("stringUnicode"):(x("stringEscape"),A());break;case"stringUnicode":n-e.lastIndexOf("u",n)===4&&(x("stringEscape"),A());break;case"number":F==="."?s("numberNeedsDigit"):F==="e"||F==="E"?s("numberNeedsExponent"):(F<"0"||F>"9")&&(C(),A());break;case"numberNeedsDigit":s("number");break;case"numberNeedsExponent":s(F==="+"||F==="-"?"numberNeedsDigit":"number");break;case"true":case"false":case"null":(F<"a"||F>"z")&&(C(),A());break;case"arrayNeedsValue":F==="]"?A():TB(F)||(x("collectionItem"),s("arrayNeedsComma"),P(F));break;case"arrayNeedsComma":F==="]"?A():F===","&&(v("collectionItem"),s("arrayNeedsValue"));break;case"objectNeedsKey":F==="}"?A():F==='"'&&(v("collectionItem"),s("objectNeedsColon"),f("string"));break;case"objectNeedsColon":F===":"&&s("objectNeedsValue");break;case"objectNeedsValue":TB(F)||(x("collectionItem"),s("objectNeedsComma"),P(F));break;case"objectNeedsComma":F==="}"?A():F===","&&(v("collectionItem"),s("objectNeedsKey"));break}}a!=null&&(t.length=a);for(var U=[r!=null?e.slice(0,r):e],q=function($){return U.push($.slice(e.length-e.lastIndexOf($[0])))},G=t.length-1;G>=0;G--)switch(t[G]){case"string":U.push('"');break;case"numberNeedsDigit":case"numberNeedsExponent":U.push("0");break;case"true":q("true");break;case"false":q("false");break;case"null":q("null");break;case"arrayNeedsValue":case"arrayNeedsComma":U.push("]");break;case"objectNeedsKey":case"objectNeedsColon":case"objectNeedsValue":case"objectNeedsComma":U.push("}");break}return U.join("")}var Cde=Object.defineProperty,kde=Object.defineProperties,Ide=Object.getOwnPropertyDescriptors,yA=Object.getOwnPropertySymbols,iZ=Object.prototype.hasOwnProperty,sZ=Object.prototype.propertyIsEnumerable,EB=(e,t,n)=>t in e?Cde(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ga=(e,t)=>{for(var n in t||(t={}))iZ.call(t,n)&&EB(e,n,t[n]);if(yA)for(var n of yA(t))sZ.call(t,n)&&EB(e,n,t[n]);return e},Xl=(e,t)=>kde(e,Ide(t)),o5=e=>typeof e=="symbol"?e:e+"",Fm=(e,t)=>{var n={};for(var r in e)iZ.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&yA)for(var r of yA(e))t.indexOf(r)<0&&sZ.call(e,r)&&(n[r]=e[r]);return n},Rv=(e,t,n)=>new Promise((r,a)=>{var u=v=>{try{s(n.next(v))}catch(x){a(x)}},f=v=>{try{s(n.throw(v))}catch(x){a(x)}},s=v=>v.done?r(v.value):Promise.resolve(v.value).then(u,f);s((n=n.apply(e,t)).next())}),Rde=1e3*60*5,Mde=class{constructor(){this.activeKey=null,this.intervalId=null,this.instanceCount=0,this.lastResponse=null}start(e,t){return Rv(this,null,function*(){if(this.instanceCount++,this.activeKey===e)return;this.intervalId&&clearInterval(this.intervalId);const n=()=>Rv(this,null,function*(){try{const a=yield fetch(`${JW}/ciu`,{method:"GET",headers:{[eZ]:e}}).then(u=>u.json());return this.lastResponse=a,t==null||t(a),a}catch{return null}}),r=yield n();return this.intervalId=setInterval(n,Rde),this.activeKey=e,r})}getLastResponse(){return this.lastResponse}stop(){this.instanceCount--,this.instanceCount===0&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null,this.activeKey=null,this.lastResponse=null)}},aZ=B.createContext(void 0);function Pde(e){if(e.severity)switch(e.severity){case zm.CRITICAL:return"critical";case zm.WARNING:return"warning";case zm.INFO:return"info";default:return"info"}const t=e.message.toLowerCase();return t.includes("api key")||t.includes("401")||t.includes("unauthorized")||t.includes("authentication")||t.includes("incorrect api key")?"critical":"info"}function Ode(e){switch(e){case"critical":return{background:"#fee2e2",border:"#dc2626",text:"#7f1d1d",icon:"#dc2626"};case"warning":return{background:"#fef3c7",border:"#d97706",text:"#78350f",icon:"#d97706"};case"info":return{background:"#dbeafe",border:"#2563eb",text:"#1e3a8a",icon:"#2563eb"}}}function oZ(){const e=B.useContext(aZ);if(!e)throw new Error("useToast must be used within a ToastProvider");return e}function Lde({enabled:e,children:t}){const[n,r]=B.useState([]),[a,u]=B.useState(null),f=B.useCallback(C=>{r(P=>P.filter(L=>L.id!==C))},[]),s=B.useCallback(C=>{var P;if(!e)return;const L=(P=C.id)!=null?P:Math.random().toString(36).substring(2,9);r(F=>F.find(U=>U.id===L)?F:[...F,Xl(Ga({},C),{id:L})]),C.duration&&setTimeout(()=>{f(L)},C.duration)},[e,f]),v=B.useCallback(C=>{!e&&C!==null||u(C)},[e]),x=B.useCallback(C=>{console.warn("addGraphQLErrorsToast is deprecated. All errors now show as banners.")},[]),A={toasts:n,addToast:s,addGraphQLErrorsToast:x,removeToast:f,enabled:e,bannerError:a,setBannerError:v};return k.jsxs(aZ.Provider,{value:A,children:[a&&(()=>{const C=Pde(a),P=Ode(C);return k.jsx("div",{style:{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",zIndex:9999,backgroundColor:P.background,border:`1px solid ${P.border}`,borderLeft:`4px solid ${P.border}`,borderRadius:"8px",padding:"12px 16px",fontSize:"13px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",backdropFilter:"blur(8px)",maxWidth:"min(90vw, 700px)",width:"100%",boxSizing:"border-box",overflow:"hidden"},children:k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"10px"},children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flex:1,minWidth:0},children:[k.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:P.border,flexShrink:0}}),k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",flex:1,minWidth:0},children:[k.jsx("div",{style:{color:P.text,lineHeight:"1.4",fontWeight:"400",fontSize:"13px",flex:1,wordBreak:"break-all",overflowWrap:"break-word",maxWidth:"550px",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:10,WebkitBoxOrient:"vertical"},children:(()=>{let L=a.message;const F=L.match(/'message':\s*'([^']+)'/);return F?F[1]:(L=L.split(" - ")[0],L=L.split(": Error code")[0],L=L.replace(/:\s*\d{3}$/,""),L=L.replace(/See more:.*$/g,""),L=L.trim(),L||"Configuration error occurred.")})()}),(()=>{const L=a.message,F=/\[([^\]]+)\]\(([^)]+)\)/g,U=/(https?:\/\/[^\s)]+)/g;let q=null,G="See More";const $=F.exec(L);if($)q=$[2],G="See More";else{const X=U.exec(L);X&&(q=X[0].replace(/[.,;:'"]*$/,""),G="See More")}return q?k.jsx("button",{onClick:()=>window.open(q,"_blank","noopener,noreferrer"),style:{background:P.border,color:"white",border:"none",borderRadius:"5px",padding:"4px 10px",fontSize:"11px",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease",flexShrink:0},onMouseEnter:X=>{X.currentTarget.style.opacity="0.9",X.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:X=>{X.currentTarget.style.opacity="1",X.currentTarget.style.transform="translateY(0)"},children:G}):null})()]})]}),k.jsx("button",{onClick:()=>v(null),style:{background:"transparent",border:"none",color:P.text,cursor:"pointer",padding:"2px",borderRadius:"3px",fontSize:"14px",lineHeight:"1",opacity:.6,transition:"all 0.2s ease",flexShrink:0},title:"Dismiss",onMouseEnter:L=>{L.currentTarget.style.opacity="1",L.currentTarget.style.background="rgba(0, 0, 0, 0.05)"},onMouseLeave:L=>{L.currentTarget.style.opacity="0.6",L.currentTarget.style.background="transparent"},children:""})]})})})(),t]})}function SB(e){if(e)throw e}var r4=Object.prototype.hasOwnProperty,lZ=Object.prototype.toString,AB=Object.defineProperty,CB=Object.getOwnPropertyDescriptor,kB=function(t){return typeof Array.isArray=="function"?Array.isArray(t):lZ.call(t)==="[object Array]"},IB=function(t){if(!t||lZ.call(t)!=="[object Object]")return!1;var n=r4.call(t,"constructor"),r=t.constructor&&t.constructor.prototype&&r4.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!n&&!r)return!1;var a;for(a in t);return typeof a>"u"||r4.call(t,a)},RB=function(t,n){AB&&n.name==="__proto__"?AB(t,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):t[n.name]=n.newValue},MB=function(t,n){if(n==="__proto__")if(r4.call(t,n)){if(CB)return CB(t,n).value}else return;return t[n]},Dde=function e(){var t,n,r,a,u,f,s=arguments[0],v=1,x=arguments.length,A=!1;for(typeof s=="boolean"&&(A=s,s=arguments[1]||{},v=2),(s==null||typeof s!="object"&&typeof s!="function")&&(s={});v<x;++v)if(t=arguments[v],t!=null)for(n in t)r=MB(s,n),a=MB(t,n),s!==a&&(A&&a&&(IB(a)||(u=kB(a)))?(u?(u=!1,f=r&&kB(r)?r:[]):f=r&&IB(r)?r:{},RB(s,{name:n,newValue:e(A,f,a)})):typeof a<"u"&&RB(s,{name:n,newValue:a}));return s};const l5=fT(Dde);function HM(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function Nde(){const e=[],t={run:n,use:r};return t;function n(...a){let u=-1;const f=a.pop();if(typeof f!="function")throw new TypeError("Expected function as last argument, not "+f);s(null,...a);function s(v,...x){const A=e[++u];let C=-1;if(v){f(v);return}for(;++C<a.length;)(x[C]===null||x[C]===void 0)&&(x[C]=a[C]);a=x,A?zde(A,s)(...x):f(null,...x)}}function r(a){if(typeof a!="function")throw new TypeError("Expected `middelware` to be a function, not "+a);return e.push(a),t}}function zde(e,t){let n;return r;function r(...f){const s=e.length>f.length;let v;s&&f.push(a);try{v=e.apply(this,f)}catch(x){const A=x;if(s&&n)throw A;return a(A)}s||(v&&v.then&&typeof v.then=="function"?v.then(u,a):v instanceof Error?a(v):u(v))}function a(f,...s){n||(n=!0,t(f,...s))}function u(f){a(null,f)}}const PB=document.createElement("i");function XO(e){const t="&"+e+";";PB.innerHTML=t;const n=PB.textContent;return n.charCodeAt(n.length-1)===59&&e!=="semi"||n===t?!1:n}const OB=9,LB=32;function Fde(e){const t=String(e),n=/\r?\n|\r/g;let r=n.exec(t),a=0;const u=[];for(;r;)u.push(DB(t.slice(a,r.index),a>0,!0),r[0]),a=r.index+r[0].length,r=n.exec(t);return u.push(DB(t.slice(a),a>0,!1)),u.join("")}function DB(e,t,n){let r=0,a=e.length;if(t){let u=e.codePointAt(r);for(;u===OB||u===LB;)r++,u=e.codePointAt(r)}if(n){let u=e.codePointAt(a-1);for(;u===OB||u===LB;)a--,u=e.codePointAt(a-1)}return a>r?e.slice(r,a):""}function vA(e){const t=String(e||"").trim();return t?t.split(/[ \t\n\r\f]+/g):[]}function uZ(e){return e.join(" ").trim()}function xA(e){const t=[],n=String(e||"");let r=n.indexOf(","),a=0,u=!1;for(;!u;){r===-1&&(r=n.length,u=!0);const f=n.slice(a,r).trim();(f||!u)&&t.push(f),a=r+1,r=n.indexOf(",",a)}return t}function cZ(e,t){const n=t||{};return(e[e.length-1]===""?[...e,""]:e).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}function dZ({severity:e=zm.CRITICAL,message:t="",onClose:n,actions:r}){if(!t||!e)return null;const u={[zm.INFO]:{bg:"#f8fafc",border:"#e2e8f0",text:"#475569",accent:"#3b82f6"},[zm.WARNING]:{bg:"#fffbeb",border:"#fbbf24",text:"#92400e",accent:"#f59e0b"},[zm.CRITICAL]:{bg:"#fef2f2",border:"#fecaca",text:"#dc2626",accent:"#ef4444"}}[e];return k.jsxs(k.Fragment,{children:[k.jsx("style",{children:`
          @keyframes slideUp {
            from { opacity: 0; transform: translateX(-50%) translateY(8px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
          }
          
          .usage-banner {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            width: min(600px, calc(100vw - 32px));
            z-index: 10000;
            animation: slideUp 0.2s cubic-bezier(0.16, 1, 0.3, 1);
          }
          
          .banner-content {
            background: linear-gradient(135deg, ${u.bg} 0%, ${u.bg}f5 100%);
            border: 1px solid ${u.border};
            border-radius: 12px;
            padding: 18px 20px;
            box-shadow: 
              0 4px 24px rgba(0, 0, 0, 0.08),
              0 2px 8px rgba(0, 0, 0, 0.04),
              inset 0 1px 0 rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            gap: 16px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            backdrop-filter: blur(12px);
            position: relative;
            overflow: hidden;
          }
          
          .banner-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, ${u.accent}40, transparent);
          }
          
          .banner-message {
            color: ${u.text};
            font-size: 14px;
            line-height: 1.5;
            font-weight: 500;
            flex: 1;
            letter-spacing: -0.01em;
          }
          
          .close-btn {
            background: rgba(0, 0, 0, 0.05);
            border: none;
            color: ${u.text};
            cursor: pointer;
            padding: 0;
            border-radius: 6px;
            opacity: 0.6;
            transition: all 0.15s cubic-bezier(0.16, 1, 0.3, 1);
            font-size: 14px;
            line-height: 1;
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
          }
          
          .close-btn:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.08);
            transform: scale(1.05);
          }
          
          .btn-primary {
            background: linear-gradient(135deg, ${u.accent} 0%, ${u.accent}e6 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 18px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s cubic-bezier(0.16, 1, 0.3, 1);
            font-family: inherit;
            flex-shrink: 0;
            box-shadow: 
              0 2px 8px ${u.accent}30,
              inset 0 1px 0 rgba(255, 255, 255, 0.2);
            letter-spacing: -0.01em;
          }
          
          .btn-primary:hover {
            transform: translateY(-1px) scale(1.02);
            box-shadow: 
              0 4px 12px ${u.accent}40,
              inset 0 1px 0 rgba(255, 255, 255, 0.25);
          }
          
          .btn-primary:active {
            transform: translateY(0) scale(0.98);
            transition: all 0.08s cubic-bezier(0.16, 1, 0.3, 1);
          }
          
          @media (max-width: 640px) {
            .usage-banner {
              width: calc(100vw - 24px);
            }
            
            .banner-content {
              padding: 16px;
              gap: 12px;
            }
            
            .banner-message {
              font-size: 13px;
              line-height: 1.45;
            }
            
            .btn-primary {
              padding: 8px 14px;
              font-size: 12px;
            }
            
            .close-btn {
              width: 22px;
              height: 22px;
              font-size: 12px;
            }
          }
        `}),k.jsx("div",{className:"usage-banner",children:k.jsxs("div",{className:"banner-content",children:[k.jsx("div",{className:"banner-message",children:t}),(r==null?void 0:r.primary)&&k.jsx("button",{className:"btn-primary",onClick:r.primary.onClick,children:r.primary.label}),n&&k.jsx("button",{className:"close-btn",onClick:n,title:"Close",children:""})]})})]})}var hZ=e=>{switch(e.code){case B2.MISSING_PUBLIC_API_KEY_ERROR:return{primary:{label:"Show me how",onClick:()=>window.open("https://docs.copilotkit.ai/premium#how-do-i-get-access-to-premium-features","_blank","noopener,noreferrer")}};case B2.UPGRADE_REQUIRED_ERROR:return{primary:{label:"Upgrade",onClick:()=>window.open("https://cloud.copilotkit.ai","_blank","noopener,noreferrer")}};default:return}},NB=new Mde,Bde=class extends ca.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidMount(){this.props.publicApiKey&&NB.start(this.props.publicApiKey,e=>{this.setState(t=>{var n;return(e==null?void 0:e.severity)!==((n=t.status)==null?void 0:n.severity)?{status:e??void 0}:null})})}componentWillUnmount(){NB.stop()}componentDidCatch(e,t){console.error("CopilotKit Error:",e,t)}render(){var e,t,n,r;if(this.state.hasError){if(this.state.error instanceof Km)return k.jsxs(k.Fragment,{children:[this.props.children,this.props.showUsageBanner&&k.jsx(dZ,{severity:(t=(e=this.state.status)==null?void 0:e.severity)!=null?t:this.state.error.severity,message:(r=(n=this.state.status)==null?void 0:n.message)!=null?r:this.state.error.message,actions:hZ(this.state.error)})]});throw this.state.error}return this.props.children}};function jde(){return typeof window>"u"?!1:window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname==="0.0.0.0"}function U2(e){return e!==void 0?e:jde()}var fZ={actions:{},setAction:()=>{},removeAction:()=>{},setRegisteredActions:()=>"",removeRegisteredAction:()=>{},chatComponentsCache:{current:{actions:{},coAgentStateRenders:{}}},getContextString:(e,t)=>xg(),addContext:()=>"",removeContext:()=>{},getAllContext:()=>[],getFunctionCallHandler:()=>xg(),isLoading:!1,setIsLoading:()=>xg(),chatInstructions:"",setChatInstructions:()=>xg(),additionalInstructions:[],setAdditionalInstructions:()=>xg(),getDocumentsContext:e=>xg(),addDocumentContext:()=>xg(),removeDocumentContext:()=>{},copilotApiConfig:new class{get chatApiEndpoint(){throw new Error("Remember to wrap your app in a `<CopilotKit> {...} </CopilotKit>` !!!")}get headers(){return{}}get body(){return{}}},chatSuggestionConfiguration:{},addChatSuggestionConfiguration:()=>{},removeChatSuggestionConfiguration:()=>{},showDevConsole:!1,coagentStates:{},setCoagentStates:()=>{},coagentStatesRef:{current:{}},setCoagentStatesWithRef:()=>{},agentSession:null,setAgentSession:()=>{},forwardedParameters:{},agentLock:null,threadId:"",setThreadId:()=>{},runId:null,setRunId:()=>{},chatAbortControllerRef:{current:null},availableAgents:[],extensions:{},setExtensions:()=>{},interruptActions:{},setInterruptAction:()=>{},removeInterruptAction:()=>{},interruptEventQueue:{},addInterruptEvent:()=>{},resolveInterruptEvent:()=>{},onError:()=>{},bannerError:null,setBannerError:()=>{},internalErrorHandlers:{},setInternalErrorHandler:()=>{},removeInternalErrorHandler:()=>{}},pZ=ca.createContext(fZ);function Ude(){const e=ca.useContext(pZ);if(e===fZ)throw new Error("Remember to wrap your app in a `<CopilotKit> {...} </CopilotKit>` !!!");return e}function xg(e){throw new Error("Remember to wrap your app in a `<CopilotKit> {...} </CopilotKit>` !!!")}var Vde={messages:[],setMessages:()=>[],suggestions:[],setSuggestions:()=>[]},$de=ca.createContext(Vde),mZ=B.createContext(null);function Hde(){const e=B.useContext(mZ);if(!e)throw new Error("useMessagesTap must be used inside <MessagesTapProvider>");return e}function Gde({children:e}){const t=B.useRef([]),n=B.useRef({getMessagesFromTap:()=>t.current,updateTapMessages:r=>{t.current=r}});return k.jsx(mZ.Provider,{value:n.current,children:e})}function qde({children:e}){const[t,n]=B.useState([]);B.useRef(void 0),B.useRef(void 0),B.useRef(void 0);const{updateTapMessages:r}=Hde(),{threadId:a,agentSession:u,showDevConsole:f,onError:s,copilotApiConfig:v}=Ude(),{setBannerError:x}=oZ(),A=B.useCallback((U,q)=>Rv(this,null,function*(){if(!(!s||!v.publicApiKey))try{const G={type:"error",timestamp:Date.now(),context:{source:"ui",request:{operation:"loadAgentState",url:v.chatApiEndpoint,startTime:Date.now()},technical:{environment:"browser",userAgent:typeof navigator<"u"?navigator.userAgent:void 0,stackTrace:q instanceof Error?q.stack:void 0}},error:U};yield s(G)}catch(G){console.error("Error in CopilotMessages onError handler:",G)}}),[s,v.publicApiKey,v.chatApiEndpoint]),C=U=>{const q=U.extensions,G=q==null?void 0:q.originalError;if(G!=null&&G.stack){if(G.stack.includes("CopilotApiDiscoveryError"))return new WW({message:G.message});if(G.stack.includes("CopilotKitRemoteEndpointDiscoveryError"))return new nde({message:G.message});if(G.stack.includes("CopilotKitAgentDiscoveryError"))return new rde({agentName:"",availableAgents:[]})}const $=(G==null?void 0:G.message)||U.message,X=q==null?void 0:q.code;return X?new Km({message:$,code:X}):null};B.useCallback(U=>{var q;if((q=U.graphQLErrors)!=null&&q.length){const G=U.graphQLErrors,$=X=>{const ie=X.extensions,de=ie==null?void 0:ie.visibility;if(!U2(f)){console.error("CopilotKit Error (hidden in production):",X.message);return}if(de===qW.SILENT){console.error("CopilotKit Silent Error:",X.message);return}const be=C(X);if(be)x(be),A(be,X);else{const ve=new Km({message:X.message,code:B2.UNKNOWN});x(ve),A(ve,X)}};G.forEach($)}else if(!U2(f))console.error("CopilotKit Error (hidden in production):",U);else{const $=new Km({message:(U==null?void 0:U.message)||String(U),code:B2.UNKNOWN});x($),A($,U)}},[x,f,A]),B.useEffect(()=>{r(t)},[t,r]);const P=B.useMemo(()=>e,[e]),[L,F]=B.useState([]);return k.jsx($de.Provider,{value:{messages:t,setMessages:n,suggestions:L,setSuggestions:F},children:P})}var gZ=(e,t)=>e.reduce((n,r)=>{if(r.id!==t){const a=Xl(Ga({},r),{children:gZ(r.children,t)});n.push(a)}return n},[]),_Z=(e,t,n)=>n?e.map(r=>r.id===n?Xl(Ga({},r),{children:[...r.children,t]}):r.children.length?Xl(Ga({},r),{children:_Z(r.children,t,n)}):r):[...e,t],yZ=(e,t)=>t===0?(e+1).toString():t===1?String.fromCharCode(65+e):t===2?String.fromCharCode(97+e):"-",vZ=(e,t="",n=0)=>{const r=" ".repeat(3).repeat(n),a=t.length+r.length,u=" ".repeat(a),f=e.value.split(`
`),s=`${r}${t}${f[0]}`,v=f.slice(1).map(C=>`${u}${C}`).join(`
`);let x=`${s}
`;v&&(x+=`${v}
`);const A=" ".repeat(t.length);return e.children.forEach((C,P)=>x+=vZ(C,`${A}${yZ(P,n+1)}. `,n+1)),x};function Wde(e,t){switch(t.type){case"ADD_NODE":{const{value:n,parentId:r,id:a}=t,u={id:a,value:n,children:[],categories:new Set(t.categories)};try{return _Z(e,u,r)}catch(f){return console.error(`Error while adding node with id ${a}: ${f}`),e}}case"REMOVE_NODE":return gZ(e,t.id);default:return e}}var Zde=()=>{const[e,t]=B.useReducer(Wde,[]),n=B.useCallback((f,s,v)=>{const x=KW();return t({type:"ADD_NODE",value:f,parentId:v,id:x,categories:s}),x},[]),r=B.useCallback(f=>{t({type:"REMOVE_NODE",id:f})},[]),a=B.useCallback(()=>e,[e]),u=B.useCallback(f=>{const s=new Set(f);let v="";return e.forEach((x,A)=>{Yde(s,x.categories)&&(A!==0&&(v+=`
`),v+=vZ(x,`${yZ(A,0)}. `))}),v},[e]);return{tree:e,addElement:n,printTree:u,removeElement:r,getAllElements:a}},Xde=Zde;function Yde(e,t){const[n,r]=e.size<=t.size?[e,t]:[t,e];for(let a of n)if(r.has(a))return!0;return!1}var Kde=()=>{const[e,t]=B.useReducer(Jde,new Map),n=B.useCallback((u,f)=>{const s=KW();return t({type:"ADD_ELEMENT",value:u,id:s,categories:f}),s},[]),r=B.useCallback(u=>{t({type:"REMOVE_ELEMENT",id:u})},[]),a=B.useCallback(u=>{const f=new Set(u),s=[];return e.forEach(v=>{ehe(f,v.categories)&&s.push(v.value)}),s},[e]);return{addElement:n,removeElement:r,allElements:a}},Qde=Kde;function Jde(e,t){switch(t.type){case"ADD_ELEMENT":{const{value:n,id:r,categories:a}=t,u={id:r,value:n,categories:new Set(a)},f=new Map(e);return f.set(r,u),f}case"REMOVE_ELEMENT":{const n=new Map(e);return n.delete(t.id),n}default:return e}}function ehe(e,t){const[n,r]=e.size<=t.size?[e,t]:[t,e];for(let a of n)if(r.has(a))return!0;return!1}var xZ=B.createContext(void 0);function the({children:e}){const[t,n]=B.useState({}),r=B.useCallback((f,s)=>{n(v=>Xl(Ga({},v),{[f]:s}))},[]),a=B.useCallback(f=>{n(s=>{const v=Ga({},s);return delete v[f],v})},[]),u=B.useRef({});return k.jsx(xZ.Provider,{value:{coAgentStateRenders:t,setCoAgentStateRender:r,removeCoAgentStateRender:a,claimsRef:u},children:e})}function nhe(){const e=B.useContext(xZ);if(!e)throw new Error("useCoAgentStateRenders must be used within CoAgentStateRendersProvider");return e}var _a;(function(e){e.assertEqual=a=>{};function t(a){}e.assertIs=t;function n(a){throw new Error}e.assertNever=n,e.arrayToEnum=a=>{const u={};for(const f of a)u[f]=f;return u},e.getValidEnumValues=a=>{const u=e.objectKeys(a).filter(s=>typeof a[a[s]]!="number"),f={};for(const s of u)f[s]=a[s];return e.objectValues(f)},e.objectValues=a=>e.objectKeys(a).map(function(u){return a[u]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const u=[];for(const f in a)Object.prototype.hasOwnProperty.call(a,f)&&u.push(f);return u},e.find=(a,u)=>{for(const f of a)if(u(f))return f},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,u=" | "){return a.map(f=>typeof f=="string"?`'${f}'`:f).join(u)}e.joinValues=r,e.jsonStringifyReplacer=(a,u)=>typeof u=="bigint"?u.toString():u})(_a||(_a={}));var zB;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(zB||(zB={}));const Jr=_a.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),vm=e=>{switch(typeof e){case"undefined":return Jr.undefined;case"string":return Jr.string;case"number":return Number.isNaN(e)?Jr.nan:Jr.number;case"boolean":return Jr.boolean;case"function":return Jr.function;case"bigint":return Jr.bigint;case"symbol":return Jr.symbol;case"object":return Array.isArray(e)?Jr.array:e===null?Jr.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?Jr.promise:typeof Map<"u"&&e instanceof Map?Jr.map:typeof Set<"u"&&e instanceof Set?Jr.set:typeof Date<"u"&&e instanceof Date?Jr.date:Jr.object;default:return Jr.unknown}},lr=_a.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);let i_=class bZ extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(u){return u.message},r={_errors:[]},a=u=>{for(const f of u.issues)if(f.code==="invalid_union")f.unionErrors.map(a);else if(f.code==="invalid_return_type")a(f.returnTypeError);else if(f.code==="invalid_arguments")a(f.argumentsError);else if(f.path.length===0)r._errors.push(n(f));else{let s=r,v=0;for(;v<f.path.length;){const x=f.path[v];v===f.path.length-1?(s[x]=s[x]||{_errors:[]},s[x]._errors.push(n(f))):s[x]=s[x]||{_errors:[]},s=s[x],v++}}};return a(this),r}static assert(t){if(!(t instanceof bZ))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,_a.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const a of this.issues)if(a.path.length>0){const u=a.path[0];n[u]=n[u]||[],n[u].push(t(a))}else r.push(t(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}};i_.create=e=>new i_(e);const GM=(e,t)=>{let n;switch(e.code){case lr.invalid_type:e.received===Jr.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case lr.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,_a.jsonStringifyReplacer)}`;break;case lr.unrecognized_keys:n=`Unrecognized key(s) in object: ${_a.joinValues(e.keys,", ")}`;break;case lr.invalid_union:n="Invalid input";break;case lr.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${_a.joinValues(e.options)}`;break;case lr.invalid_enum_value:n=`Invalid enum value. Expected ${_a.joinValues(e.options)}, received '${e.received}'`;break;case lr.invalid_arguments:n="Invalid function arguments";break;case lr.invalid_return_type:n="Invalid function return type";break;case lr.invalid_date:n="Invalid date";break;case lr.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:_a.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case lr.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case lr.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case lr.custom:n="Invalid input";break;case lr.invalid_intersection_types:n="Intersection results could not be merged";break;case lr.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case lr.not_finite:n="Number must be finite";break;default:n=t.defaultError,_a.assertNever(e)}return{message:n}};let rhe=GM;function ihe(){return rhe}const she=e=>{const{data:t,path:n,errorMaps:r,issueData:a}=e,u=[...n,...a.path||[]],f={...a,path:u};if(a.message!==void 0)return{...a,path:u,message:a.message};let s="";const v=r.filter(x=>!!x).slice().reverse();for(const x of v)s=x(f,{data:t,defaultError:s}).message;return{...a,path:u,message:s}};function zr(e,t){const n=ihe(),r=she({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===GM?void 0:GM].filter(a=>!!a)});e.common.issues.push(r)}let Pc=class wZ{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const a of n){if(a.status==="aborted")return ss;a.status==="dirty"&&t.dirty(),r.push(a.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const a of n){const u=await a.key,f=await a.value;r.push({key:u,value:f})}return wZ.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const a of n){const{key:u,value:f}=a;if(u.status==="aborted"||f.status==="aborted")return ss;u.status==="dirty"&&t.dirty(),f.status==="dirty"&&t.dirty(),u.value!=="__proto__"&&(typeof f.value<"u"||a.alwaysSet)&&(r[u.value]=f.value)}return{status:t.value,value:r}}};const ss=Object.freeze({status:"aborted"}),Fw=e=>({status:"dirty",value:e}),gd=e=>({status:"valid",value:e}),FB=e=>e.status==="aborted",BB=e=>e.status==="dirty",Mv=e=>e.status==="valid",bA=e=>typeof Promise<"u"&&e instanceof Promise;var pi;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(pi||(pi={}));let af=class{constructor(t,n,r,a){this._cachedPath=[],this.parent=t,this.data=n,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};const jB=(e,t)=>{if(Mv(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new i_(e.common.issues);return this._error=n,this._error}}};function Ns(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:a}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(f,s)=>{const{message:v}=e;return f.code==="invalid_enum_value"?{message:v??s.defaultError}:typeof s.data>"u"?{message:v??r??s.defaultError}:f.code!=="invalid_type"?{message:s.defaultError}:{message:v??n??s.defaultError}},description:a}}let sa=class{get description(){return this._def.description}_getType(t){return vm(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:vm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Pc,ctx:{common:t.parent.common,data:t.data,parsedType:vm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(bA(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){const r={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:vm(t)},a=this._parseSync({data:t,path:r.path,parent:r});return jB(r,a)}"~validate"(t){var r,a;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:vm(t)};if(!this["~standard"].async)try{const u=this._parseSync({data:t,path:[],parent:n});return Mv(u)?{value:u.value}:{issues:n.common.issues}}catch(u){(a=(r=u==null?void 0:u.message)==null?void 0:r.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:n}).then(u=>Mv(u)?{value:u.value}:{issues:n.common.issues})}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:vm(t)},a=this._parse({data:t,path:r.path,parent:r}),u=await(bA(a)?a:Promise.resolve(a));return jB(r,u)}refine(t,n){const r=a=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,u)=>{const f=t(a),s=()=>u.addIssue({code:lr.custom,...r(a)});return typeof Promise<"u"&&f instanceof Promise?f.then(v=>v?!0:(s(),!1)):f?!0:(s(),!1)})}refinement(t,n){return this._refinement((r,a)=>t(r)?!0:(a.addIssue(typeof n=="function"?n(r,a):n),!1))}_refinement(t){return new s_({schema:this,typeName:as.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return sp.create(this,this._def)}nullable(){return a_.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Pv.create(this)}promise(){return kA.create(this,this._def)}or(t){return TA.create([this,t],this._def)}and(t){return EA.create(this,t,this._def)}transform(t){return new s_({...Ns(this._def),schema:this,typeName:as.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new IA({...Ns(this._def),innerType:this,defaultValue:n,typeName:as.ZodDefault})}brand(){return new IZ({typeName:as.ZodBranded,type:this,...Ns(this._def)})}catch(t){const n=typeof t=="function"?t:()=>t;return new RA({...Ns(this._def),innerType:this,catchValue:n,typeName:as.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return Ihe.create(this,t)}readonly(){return MA.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const ahe=/^c[^\s-]{8,}$/i,ohe=/^[0-9a-z]+$/,lhe=/^[0-9A-HJKMNP-TV-Z]{26}$/i,uhe=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,che=/^[a-z0-9_-]{21}$/i,dhe=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,hhe=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,fhe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,phe="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let u5;const mhe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ghe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,_he=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,yhe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,vhe=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,xhe=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,TZ="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",bhe=new RegExp(`^${TZ}$`);function EZ(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function whe(e){return new RegExp(`^${EZ(e)}$`)}function The(e){let t=`${TZ}T${EZ(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function Ehe(e,t){return!!((t==="v4"||!t)&&mhe.test(e)||(t==="v6"||!t)&&_he.test(e))}function She(e,t){if(!dhe.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||t&&a.alg!==t)}catch{return!1}}function Ahe(e,t){return!!((t==="v4"||!t)&&ghe.test(e)||(t==="v6"||!t)&&yhe.test(e))}let wA=class Bw extends sa{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==Jr.string){const u=this._getOrReturnCtx(t);return zr(u,{code:lr.invalid_type,expected:Jr.string,received:u.parsedType}),ss}const r=new Pc;let a;for(const u of this._def.checks)if(u.kind==="min")t.data.length<u.value&&(a=this._getOrReturnCtx(t,a),zr(a,{code:lr.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),r.dirty());else if(u.kind==="max")t.data.length>u.value&&(a=this._getOrReturnCtx(t,a),zr(a,{code:lr.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),r.dirty());else if(u.kind==="length"){const f=t.data.length>u.value,s=t.data.length<u.value;(f||s)&&(a=this._getOrReturnCtx(t,a),f?zr(a,{code:lr.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}):s&&zr(a,{code:lr.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}),r.dirty())}else if(u.kind==="email")fhe.test(t.data)||(a=this._getOrReturnCtx(t,a),zr(a,{validation:"email",code:lr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="emoji")u5||(u5=new RegExp(phe,"u")),u5.test(t.data)||(a=this._getOrReturnCtx(t,a),zr(a,{validation:"emoji",code:lr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="uuid")uhe.test(t.data)||(a=this._getOrReturnCtx(t,a),zr(a,{validation:"uuid",code:lr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="nanoid")che.test(t.data)||(a=this._getOrReturnCtx(t,a),zr(a,{validation:"nanoid",code:lr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="cuid")ahe.test(t.data)||(a=this._getOrReturnCtx(t,a),zr(a,{validation:"cuid",code:lr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="cuid2")ohe.test(t.data)||(a=this._getOrReturnCtx(t,a),zr(a,{validation:"cuid2",code:lr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="ulid")lhe.test(t.data)||(a=this._getOrReturnCtx(t,a),zr(a,{validation:"ulid",code:lr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),zr(a,{validation:"url",code:lr.invalid_string,message:u.message}),r.dirty()}else u.kind==="regex"?(u.regex.lastIndex=0,u.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),zr(a,{validation:"regex",code:lr.invalid_string,message:u.message}),r.dirty())):u.kind==="trim"?t.data=t.data.trim():u.kind==="includes"?t.data.includes(u.value,u.position)||(a=this._getOrReturnCtx(t,a),zr(a,{code:lr.invalid_string,validation:{includes:u.value,position:u.position},message:u.message}),r.dirty()):u.kind==="toLowerCase"?t.data=t.data.toLowerCase():u.kind==="toUpperCase"?t.data=t.data.toUpperCase():u.kind==="startsWith"?t.data.startsWith(u.value)||(a=this._getOrReturnCtx(t,a),zr(a,{code:lr.invalid_string,validation:{startsWith:u.value},message:u.message}),r.dirty()):u.kind==="endsWith"?t.data.endsWith(u.value)||(a=this._getOrReturnCtx(t,a),zr(a,{code:lr.invalid_string,validation:{endsWith:u.value},message:u.message}),r.dirty()):u.kind==="datetime"?The(u).test(t.data)||(a=this._getOrReturnCtx(t,a),zr(a,{code:lr.invalid_string,validation:"datetime",message:u.message}),r.dirty()):u.kind==="date"?bhe.test(t.data)||(a=this._getOrReturnCtx(t,a),zr(a,{code:lr.invalid_string,validation:"date",message:u.message}),r.dirty()):u.kind==="time"?whe(u).test(t.data)||(a=this._getOrReturnCtx(t,a),zr(a,{code:lr.invalid_string,validation:"time",message:u.message}),r.dirty()):u.kind==="duration"?hhe.test(t.data)||(a=this._getOrReturnCtx(t,a),zr(a,{validation:"duration",code:lr.invalid_string,message:u.message}),r.dirty()):u.kind==="ip"?Ehe(t.data,u.version)||(a=this._getOrReturnCtx(t,a),zr(a,{validation:"ip",code:lr.invalid_string,message:u.message}),r.dirty()):u.kind==="jwt"?She(t.data,u.alg)||(a=this._getOrReturnCtx(t,a),zr(a,{validation:"jwt",code:lr.invalid_string,message:u.message}),r.dirty()):u.kind==="cidr"?Ahe(t.data,u.version)||(a=this._getOrReturnCtx(t,a),zr(a,{validation:"cidr",code:lr.invalid_string,message:u.message}),r.dirty()):u.kind==="base64"?vhe.test(t.data)||(a=this._getOrReturnCtx(t,a),zr(a,{validation:"base64",code:lr.invalid_string,message:u.message}),r.dirty()):u.kind==="base64url"?xhe.test(t.data)||(a=this._getOrReturnCtx(t,a),zr(a,{validation:"base64url",code:lr.invalid_string,message:u.message}),r.dirty()):_a.assertNever(u);return{status:r.value,value:t.data}}_regex(t,n,r){return this.refinement(a=>t.test(a),{validation:n,code:lr.invalid_string,...pi.errToObj(r)})}_addCheck(t){return new Bw({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...pi.errToObj(t)})}url(t){return this._addCheck({kind:"url",...pi.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...pi.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...pi.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...pi.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...pi.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...pi.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...pi.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...pi.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...pi.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...pi.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...pi.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...pi.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...pi.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...pi.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...pi.errToObj(t)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...pi.errToObj(n)})}includes(t,n){return this._addCheck({kind:"includes",value:t,position:n==null?void 0:n.position,...pi.errToObj(n==null?void 0:n.message)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...pi.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...pi.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...pi.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...pi.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...pi.errToObj(n)})}nonempty(t){return this.min(1,pi.errToObj(t))}trim(){return new Bw({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Bw({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Bw({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}};wA.create=e=>new wA({checks:[],typeName:as.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...Ns(e)});function Che(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,a=n>r?n:r,u=Number.parseInt(e.toFixed(a).replace(".","")),f=Number.parseInt(t.toFixed(a).replace(".",""));return u%f/10**a}let qM=class WM extends sa{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==Jr.number){const u=this._getOrReturnCtx(t);return zr(u,{code:lr.invalid_type,expected:Jr.number,received:u.parsedType}),ss}let r;const a=new Pc;for(const u of this._def.checks)u.kind==="int"?_a.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),zr(r,{code:lr.invalid_type,expected:"integer",received:"float",message:u.message}),a.dirty()):u.kind==="min"?(u.inclusive?t.data<u.value:t.data<=u.value)&&(r=this._getOrReturnCtx(t,r),zr(r,{code:lr.too_small,minimum:u.value,type:"number",inclusive:u.inclusive,exact:!1,message:u.message}),a.dirty()):u.kind==="max"?(u.inclusive?t.data>u.value:t.data>=u.value)&&(r=this._getOrReturnCtx(t,r),zr(r,{code:lr.too_big,maximum:u.value,type:"number",inclusive:u.inclusive,exact:!1,message:u.message}),a.dirty()):u.kind==="multipleOf"?Che(t.data,u.value)!==0&&(r=this._getOrReturnCtx(t,r),zr(r,{code:lr.not_multiple_of,multipleOf:u.value,message:u.message}),a.dirty()):u.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),zr(r,{code:lr.not_finite,message:u.message}),a.dirty()):_a.assertNever(u);return{status:a.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,pi.toString(n))}gt(t,n){return this.setLimit("min",t,!1,pi.toString(n))}lte(t,n){return this.setLimit("max",t,!0,pi.toString(n))}lt(t,n){return this.setLimit("max",t,!1,pi.toString(n))}setLimit(t,n,r,a){return new WM({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:pi.toString(a)}]})}_addCheck(t){return new WM({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:pi.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:pi.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:pi.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:pi.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:pi.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:pi.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:pi.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:pi.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:pi.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&_a.isInteger(t.value))}get isFinite(){let t=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(n)&&Number.isFinite(t)}};qM.create=e=>new qM({checks:[],typeName:as.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...Ns(e)});let UB=class ZM extends sa{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==Jr.bigint)return this._getInvalidInput(t);let r;const a=new Pc;for(const u of this._def.checks)u.kind==="min"?(u.inclusive?t.data<u.value:t.data<=u.value)&&(r=this._getOrReturnCtx(t,r),zr(r,{code:lr.too_small,type:"bigint",minimum:u.value,inclusive:u.inclusive,message:u.message}),a.dirty()):u.kind==="max"?(u.inclusive?t.data>u.value:t.data>=u.value)&&(r=this._getOrReturnCtx(t,r),zr(r,{code:lr.too_big,type:"bigint",maximum:u.value,inclusive:u.inclusive,message:u.message}),a.dirty()):u.kind==="multipleOf"?t.data%u.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),zr(r,{code:lr.not_multiple_of,multipleOf:u.value,message:u.message}),a.dirty()):_a.assertNever(u);return{status:a.value,value:t.data}}_getInvalidInput(t){const n=this._getOrReturnCtx(t);return zr(n,{code:lr.invalid_type,expected:Jr.bigint,received:n.parsedType}),ss}gte(t,n){return this.setLimit("min",t,!0,pi.toString(n))}gt(t,n){return this.setLimit("min",t,!1,pi.toString(n))}lte(t,n){return this.setLimit("max",t,!0,pi.toString(n))}lt(t,n){return this.setLimit("max",t,!1,pi.toString(n))}setLimit(t,n,r,a){return new ZM({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:pi.toString(a)}]})}_addCheck(t){return new ZM({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:pi.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:pi.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:pi.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:pi.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:pi.toString(n)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}};UB.create=e=>new UB({checks:[],typeName:as.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...Ns(e)});let XM=class extends sa{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==Jr.boolean){const r=this._getOrReturnCtx(t);return zr(r,{code:lr.invalid_type,expected:Jr.boolean,received:r.parsedType}),ss}return gd(t.data)}};XM.create=e=>new XM({typeName:as.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...Ns(e)});let VB=class SZ extends sa{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==Jr.date){const u=this._getOrReturnCtx(t);return zr(u,{code:lr.invalid_type,expected:Jr.date,received:u.parsedType}),ss}if(Number.isNaN(t.data.getTime())){const u=this._getOrReturnCtx(t);return zr(u,{code:lr.invalid_date}),ss}const r=new Pc;let a;for(const u of this._def.checks)u.kind==="min"?t.data.getTime()<u.value&&(a=this._getOrReturnCtx(t,a),zr(a,{code:lr.too_small,message:u.message,inclusive:!0,exact:!1,minimum:u.value,type:"date"}),r.dirty()):u.kind==="max"?t.data.getTime()>u.value&&(a=this._getOrReturnCtx(t,a),zr(a,{code:lr.too_big,message:u.message,inclusive:!0,exact:!1,maximum:u.value,type:"date"}),r.dirty()):_a.assertNever(u);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new SZ({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:pi.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:pi.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}};VB.create=e=>new VB({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:as.ZodDate,...Ns(e)});let $B=class extends sa{_parse(t){if(this._getType(t)!==Jr.symbol){const r=this._getOrReturnCtx(t);return zr(r,{code:lr.invalid_type,expected:Jr.symbol,received:r.parsedType}),ss}return gd(t.data)}};$B.create=e=>new $B({typeName:as.ZodSymbol,...Ns(e)});let YM=class extends sa{_parse(t){if(this._getType(t)!==Jr.undefined){const r=this._getOrReturnCtx(t);return zr(r,{code:lr.invalid_type,expected:Jr.undefined,received:r.parsedType}),ss}return gd(t.data)}};YM.create=e=>new YM({typeName:as.ZodUndefined,...Ns(e)});let KM=class extends sa{_parse(t){if(this._getType(t)!==Jr.null){const r=this._getOrReturnCtx(t);return zr(r,{code:lr.invalid_type,expected:Jr.null,received:r.parsedType}),ss}return gd(t.data)}};KM.create=e=>new KM({typeName:as.ZodNull,...Ns(e)});let QM=class extends sa{constructor(){super(...arguments),this._any=!0}_parse(t){return gd(t.data)}};QM.create=e=>new QM({typeName:as.ZodAny,...Ns(e)});let HB=class extends sa{constructor(){super(...arguments),this._unknown=!0}_parse(t){return gd(t.data)}};HB.create=e=>new HB({typeName:as.ZodUnknown,...Ns(e)});let r0=class extends sa{_parse(t){const n=this._getOrReturnCtx(t);return zr(n,{code:lr.invalid_type,expected:Jr.never,received:n.parsedType}),ss}};r0.create=e=>new r0({typeName:as.ZodNever,...Ns(e)});let GB=class extends sa{_parse(t){if(this._getType(t)!==Jr.undefined){const r=this._getOrReturnCtx(t);return zr(r,{code:lr.invalid_type,expected:Jr.void,received:r.parsedType}),ss}return gd(t.data)}};GB.create=e=>new GB({typeName:as.ZodVoid,...Ns(e)});let Pv=class i4 extends sa{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),a=this._def;if(n.parsedType!==Jr.array)return zr(n,{code:lr.invalid_type,expected:Jr.array,received:n.parsedType}),ss;if(a.exactLength!==null){const f=n.data.length>a.exactLength.value,s=n.data.length<a.exactLength.value;(f||s)&&(zr(n,{code:f?lr.too_big:lr.too_small,minimum:s?a.exactLength.value:void 0,maximum:f?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(zr(n,{code:lr.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(zr(n,{code:lr.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((f,s)=>a.type._parseAsync(new af(n,f,n.path,s)))).then(f=>Pc.mergeArray(r,f));const u=[...n.data].map((f,s)=>a.type._parseSync(new af(n,f,n.path,s)));return Pc.mergeArray(r,u)}get element(){return this._def.type}min(t,n){return new i4({...this._def,minLength:{value:t,message:pi.toString(n)}})}max(t,n){return new i4({...this._def,maxLength:{value:t,message:pi.toString(n)}})}length(t,n){return new i4({...this._def,exactLength:{value:t,message:pi.toString(n)}})}nonempty(t){return this.min(1,t)}};Pv.create=(e,t)=>new Pv({type:e,minLength:null,maxLength:null,exactLength:null,typeName:as.ZodArray,...Ns(t)});function k1(e){if(e instanceof fp){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=sp.create(k1(r))}return new fp({...e._def,shape:()=>t})}else return e instanceof Pv?new Pv({...e._def,type:k1(e.element)}):e instanceof sp?sp.create(k1(e.unwrap())):e instanceof a_?a_.create(k1(e.unwrap())):e instanceof V2?V2.create(e.items.map(t=>k1(t))):e}let fp=class Wd extends sa{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=_a.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==Jr.object){const x=this._getOrReturnCtx(t);return zr(x,{code:lr.invalid_type,expected:Jr.object,received:x.parsedType}),ss}const{status:r,ctx:a}=this._processInputParams(t),{shape:u,keys:f}=this._getCached(),s=[];if(!(this._def.catchall instanceof r0&&this._def.unknownKeys==="strip"))for(const x in a.data)f.includes(x)||s.push(x);const v=[];for(const x of f){const A=u[x],C=a.data[x];v.push({key:{status:"valid",value:x},value:A._parse(new af(a,C,a.path,x)),alwaysSet:x in a.data})}if(this._def.catchall instanceof r0){const x=this._def.unknownKeys;if(x==="passthrough")for(const A of s)v.push({key:{status:"valid",value:A},value:{status:"valid",value:a.data[A]}});else if(x==="strict")s.length>0&&(zr(a,{code:lr.unrecognized_keys,keys:s}),r.dirty());else if(x!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const x=this._def.catchall;for(const A of s){const C=a.data[A];v.push({key:{status:"valid",value:A},value:x._parse(new af(a,C,a.path,A)),alwaysSet:A in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const x=[];for(const A of v){const C=await A.key,P=await A.value;x.push({key:C,value:P,alwaysSet:A.alwaysSet})}return x}).then(x=>Pc.mergeObjectSync(r,x)):Pc.mergeObjectSync(r,v)}get shape(){return this._def.shape()}strict(t){return pi.errToObj,new Wd({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,r)=>{var u,f;const a=((f=(u=this._def).errorMap)==null?void 0:f.call(u,n,r).message)??r.defaultError;return n.code==="unrecognized_keys"?{message:pi.errToObj(t).message??a}:{message:a}}}:{}})}strip(){return new Wd({...this._def,unknownKeys:"strip"})}passthrough(){return new Wd({...this._def,unknownKeys:"passthrough"})}extend(t){return new Wd({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Wd({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:as.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new Wd({...this._def,catchall:t})}pick(t){const n={};for(const r of _a.objectKeys(t))t[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new Wd({...this._def,shape:()=>n})}omit(t){const n={};for(const r of _a.objectKeys(this.shape))t[r]||(n[r]=this.shape[r]);return new Wd({...this._def,shape:()=>n})}deepPartial(){return k1(this)}partial(t){const n={};for(const r of _a.objectKeys(this.shape)){const a=this.shape[r];t&&!t[r]?n[r]=a:n[r]=a.optional()}return new Wd({...this._def,shape:()=>n})}required(t){const n={};for(const r of _a.objectKeys(this.shape))if(t&&!t[r])n[r]=this.shape[r];else{let u=this.shape[r];for(;u instanceof sp;)u=u._def.innerType;n[r]=u}return new Wd({...this._def,shape:()=>n})}keyof(){return kZ(_a.objectKeys(this.shape))}};fp.create=(e,t)=>new fp({shape:()=>e,unknownKeys:"strip",catchall:r0.create(),typeName:as.ZodObject,...Ns(t)});fp.strictCreate=(e,t)=>new fp({shape:()=>e,unknownKeys:"strict",catchall:r0.create(),typeName:as.ZodObject,...Ns(t)});fp.lazycreate=(e,t)=>new fp({shape:e,unknownKeys:"strip",catchall:r0.create(),typeName:as.ZodObject,...Ns(t)});let TA=class extends sa{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function a(u){for(const s of u)if(s.result.status==="valid")return s.result;for(const s of u)if(s.result.status==="dirty")return n.common.issues.push(...s.ctx.common.issues),s.result;const f=u.map(s=>new i_(s.ctx.common.issues));return zr(n,{code:lr.invalid_union,unionErrors:f}),ss}if(n.common.async)return Promise.all(r.map(async u=>{const f={...n,common:{...n.common,issues:[]},parent:null};return{result:await u._parseAsync({data:n.data,path:n.path,parent:f}),ctx:f}})).then(a);{let u;const f=[];for(const v of r){const x={...n,common:{...n.common,issues:[]},parent:null},A=v._parseSync({data:n.data,path:n.path,parent:x});if(A.status==="valid")return A;A.status==="dirty"&&!u&&(u={result:A,ctx:x}),x.common.issues.length&&f.push(x.common.issues)}if(u)return n.common.issues.push(...u.ctx.common.issues),u.result;const s=f.map(v=>new i_(v));return zr(n,{code:lr.invalid_union,unionErrors:s}),ss}}get options(){return this._def.options}};TA.create=(e,t)=>new TA({options:e,typeName:as.ZodUnion,...Ns(t)});const Gf=e=>e instanceof tP?Gf(e.schema):e instanceof s_?Gf(e.innerType()):e instanceof AA?[e.value]:e instanceof HC?e.options:e instanceof CA?_a.objectValues(e.enum):e instanceof IA?Gf(e._def.innerType):e instanceof YM?[void 0]:e instanceof KM?[null]:e instanceof sp?[void 0,...Gf(e.unwrap())]:e instanceof a_?[null,...Gf(e.unwrap())]:e instanceof IZ||e instanceof MA?Gf(e.unwrap()):e instanceof RA?Gf(e._def.innerType):[];let khe=class AZ extends sa{_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==Jr.object)return zr(n,{code:lr.invalid_type,expected:Jr.object,received:n.parsedType}),ss;const r=this.discriminator,a=n.data[r],u=this.optionsMap.get(a);return u?n.common.async?u._parseAsync({data:n.data,path:n.path,parent:n}):u._parseSync({data:n.data,path:n.path,parent:n}):(zr(n,{code:lr.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),ss)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,n,r){const a=new Map;for(const u of n){const f=Gf(u.shape[t]);if(!f.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const s of f){if(a.has(s))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(s)}`);a.set(s,u)}}return new AZ({typeName:as.ZodDiscriminatedUnion,discriminator:t,options:n,optionsMap:a,...Ns(r)})}};function JM(e,t){const n=vm(e),r=vm(t);if(e===t)return{valid:!0,data:e};if(n===Jr.object&&r===Jr.object){const a=_a.objectKeys(t),u=_a.objectKeys(e).filter(s=>a.indexOf(s)!==-1),f={...e,...t};for(const s of u){const v=JM(e[s],t[s]);if(!v.valid)return{valid:!1};f[s]=v.data}return{valid:!0,data:f}}else if(n===Jr.array&&r===Jr.array){if(e.length!==t.length)return{valid:!1};const a=[];for(let u=0;u<e.length;u++){const f=e[u],s=t[u],v=JM(f,s);if(!v.valid)return{valid:!1};a.push(v.data)}return{valid:!0,data:a}}else return n===Jr.date&&r===Jr.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}let EA=class extends sa{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=(u,f)=>{if(FB(u)||FB(f))return ss;const s=JM(u.value,f.value);return s.valid?((BB(u)||BB(f))&&n.dirty(),{status:n.value,value:s.data}):(zr(r,{code:lr.invalid_intersection_types}),ss)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([u,f])=>a(u,f)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};EA.create=(e,t,n)=>new EA({left:e,right:t,typeName:as.ZodIntersection,...Ns(n)});let V2=class CZ extends sa{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==Jr.array)return zr(r,{code:lr.invalid_type,expected:Jr.array,received:r.parsedType}),ss;if(r.data.length<this._def.items.length)return zr(r,{code:lr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ss;!this._def.rest&&r.data.length>this._def.items.length&&(zr(r,{code:lr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const u=[...r.data].map((f,s)=>{const v=this._def.items[s]||this._def.rest;return v?v._parse(new af(r,f,r.path,s)):null}).filter(f=>!!f);return r.common.async?Promise.all(u).then(f=>Pc.mergeArray(n,f)):Pc.mergeArray(n,u)}get items(){return this._def.items}rest(t){return new CZ({...this._def,rest:t})}};V2.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new V2({items:e,typeName:as.ZodTuple,rest:null,...Ns(t)})};class SA extends sa{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==Jr.object)return zr(r,{code:lr.invalid_type,expected:Jr.object,received:r.parsedType}),ss;const a=[],u=this._def.keyType,f=this._def.valueType;for(const s in r.data)a.push({key:u._parse(new af(r,s,r.path,s)),value:f._parse(new af(r,r.data[s],r.path,s)),alwaysSet:s in r.data});return r.common.async?Pc.mergeObjectAsync(n,a):Pc.mergeObjectSync(n,a)}get element(){return this._def.valueType}static create(t,n,r){return n instanceof sa?new SA({keyType:t,valueType:n,typeName:as.ZodRecord,...Ns(r)}):new SA({keyType:wA.create(),valueType:t,typeName:as.ZodRecord,...Ns(n)})}}let qB=class extends sa{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==Jr.map)return zr(r,{code:lr.invalid_type,expected:Jr.map,received:r.parsedType}),ss;const a=this._def.keyType,u=this._def.valueType,f=[...r.data.entries()].map(([s,v],x)=>({key:a._parse(new af(r,s,r.path,[x,"key"])),value:u._parse(new af(r,v,r.path,[x,"value"]))}));if(r.common.async){const s=new Map;return Promise.resolve().then(async()=>{for(const v of f){const x=await v.key,A=await v.value;if(x.status==="aborted"||A.status==="aborted")return ss;(x.status==="dirty"||A.status==="dirty")&&n.dirty(),s.set(x.value,A.value)}return{status:n.value,value:s}})}else{const s=new Map;for(const v of f){const x=v.key,A=v.value;if(x.status==="aborted"||A.status==="aborted")return ss;(x.status==="dirty"||A.status==="dirty")&&n.dirty(),s.set(x.value,A.value)}return{status:n.value,value:s}}}};qB.create=(e,t,n)=>new qB({valueType:t,keyType:e,typeName:as.ZodMap,...Ns(n)});let WB=class eP extends sa{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==Jr.set)return zr(r,{code:lr.invalid_type,expected:Jr.set,received:r.parsedType}),ss;const a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(zr(r,{code:lr.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(zr(r,{code:lr.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());const u=this._def.valueType;function f(v){const x=new Set;for(const A of v){if(A.status==="aborted")return ss;A.status==="dirty"&&n.dirty(),x.add(A.value)}return{status:n.value,value:x}}const s=[...r.data.values()].map((v,x)=>u._parse(new af(r,v,r.path,x)));return r.common.async?Promise.all(s).then(v=>f(v)):f(s)}min(t,n){return new eP({...this._def,minSize:{value:t,message:pi.toString(n)}})}max(t,n){return new eP({...this._def,maxSize:{value:t,message:pi.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}};WB.create=(e,t)=>new WB({valueType:e,minSize:null,maxSize:null,typeName:as.ZodSet,...Ns(t)});let tP=class extends sa{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}};tP.create=(e,t)=>new tP({getter:e,typeName:as.ZodLazy,...Ns(t)});let AA=class extends sa{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return zr(n,{received:n.data,code:lr.invalid_literal,expected:this._def.value}),ss}return{status:"valid",value:t.data}}get value(){return this._def.value}};AA.create=(e,t)=>new AA({value:e,typeName:as.ZodLiteral,...Ns(t)});function kZ(e,t){return new HC({values:e,typeName:as.ZodEnum,...Ns(t)})}let HC=class nP extends sa{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return zr(n,{expected:_a.joinValues(r),received:n.parsedType,code:lr.invalid_type}),ss}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const n=this._getOrReturnCtx(t),r=this._def.values;return zr(n,{received:n.data,code:lr.invalid_enum_value,options:r}),ss}return gd(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return nP.create(t,{...this._def,...n})}exclude(t,n=this._def){return nP.create(this.options.filter(r=>!t.includes(r)),{...this._def,...n})}};HC.create=kZ;let CA=class extends sa{_parse(t){const n=_a.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==Jr.string&&r.parsedType!==Jr.number){const a=_a.objectValues(n);return zr(r,{expected:_a.joinValues(a),received:r.parsedType,code:lr.invalid_type}),ss}if(this._cache||(this._cache=new Set(_a.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const a=_a.objectValues(n);return zr(r,{received:r.data,code:lr.invalid_enum_value,options:a}),ss}return gd(t.data)}get enum(){return this._def.values}};CA.create=(e,t)=>new CA({values:e,typeName:as.ZodNativeEnum,...Ns(t)});let kA=class extends sa{unwrap(){return this._def.type}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==Jr.promise&&n.common.async===!1)return zr(n,{code:lr.invalid_type,expected:Jr.promise,received:n.parsedType}),ss;const r=n.parsedType===Jr.promise?n.data:Promise.resolve(n.data);return gd(r.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}};kA.create=(e,t)=>new kA({type:e,typeName:as.ZodPromise,...Ns(t)});let s_=class extends sa{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===as.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=this._def.effect||null,u={addIssue:f=>{zr(r,f),f.fatal?n.abort():n.dirty()},get path(){return r.path}};if(u.addIssue=u.addIssue.bind(u),a.type==="preprocess"){const f=a.transform(r.data,u);if(r.common.async)return Promise.resolve(f).then(async s=>{if(n.value==="aborted")return ss;const v=await this._def.schema._parseAsync({data:s,path:r.path,parent:r});return v.status==="aborted"?ss:v.status==="dirty"||n.value==="dirty"?Fw(v.value):v});{if(n.value==="aborted")return ss;const s=this._def.schema._parseSync({data:f,path:r.path,parent:r});return s.status==="aborted"?ss:s.status==="dirty"||n.value==="dirty"?Fw(s.value):s}}if(a.type==="refinement"){const f=s=>{const v=a.refinement(s,u);if(r.common.async)return Promise.resolve(v);if(v instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(r.common.async===!1){const s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?ss:(s.status==="dirty"&&n.dirty(),f(s.value),{status:n.value,value:s.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(s=>s.status==="aborted"?ss:(s.status==="dirty"&&n.dirty(),f(s.value).then(()=>({status:n.value,value:s.value}))))}if(a.type==="transform")if(r.common.async===!1){const f=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Mv(f))return ss;const s=a.transform(f.value,u);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:s}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(f=>Mv(f)?Promise.resolve(a.transform(f.value,u)).then(s=>({status:n.value,value:s})):ss);_a.assertNever(a)}};s_.create=(e,t,n)=>new s_({schema:e,typeName:as.ZodEffects,effect:t,...Ns(n)});s_.createWithPreprocess=(e,t,n)=>new s_({schema:t,effect:{type:"preprocess",transform:e},typeName:as.ZodEffects,...Ns(n)});let sp=class extends sa{_parse(t){return this._getType(t)===Jr.undefined?gd(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};sp.create=(e,t)=>new sp({innerType:e,typeName:as.ZodOptional,...Ns(t)});let a_=class extends sa{_parse(t){return this._getType(t)===Jr.null?gd(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};a_.create=(e,t)=>new a_({innerType:e,typeName:as.ZodNullable,...Ns(t)});let IA=class extends sa{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===Jr.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};IA.create=(e,t)=>new IA({innerType:e,typeName:as.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...Ns(t)});let RA=class extends sa{_parse(t){const{ctx:n}=this._processInputParams(t),r={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return bA(a)?a.then(u=>({status:"valid",value:u.status==="valid"?u.value:this._def.catchValue({get error(){return new i_(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new i_(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};RA.create=(e,t)=>new RA({innerType:e,typeName:as.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...Ns(t)});let ZB=class extends sa{_parse(t){if(this._getType(t)!==Jr.nan){const r=this._getOrReturnCtx(t);return zr(r,{code:lr.invalid_type,expected:Jr.nan,received:r.parsedType}),ss}return{status:"valid",value:t.data}}};ZB.create=e=>new ZB({typeName:as.ZodNaN,...Ns(e)});let IZ=class extends sa{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}},Ihe=class RZ extends sa{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const u=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return u.status==="aborted"?ss:u.status==="dirty"?(n.dirty(),Fw(u.value)):this._def.out._parseAsync({data:u.value,path:r.path,parent:r})})();{const a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?ss:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(t,n){return new RZ({in:t,out:n,typeName:as.ZodPipeline})}},MA=class extends sa{_parse(t){const n=this._def.innerType._parse(t),r=a=>(Mv(a)&&(a.value=Object.freeze(a.value)),a);return bA(n)?n.then(a=>r(a)):r(n)}unwrap(){return this._def.innerType}};MA.create=(e,t)=>new MA({innerType:e,typeName:as.ZodReadonly,...Ns(t)});var as;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(as||(as={}));const ei=wA.create,Rhe=qM.create,Mhe=XM.create,fd=QM.create;r0.create;const Qm=Pv.create,dh=fp.create,YO=TA.create,KO=khe.create;EA.create;V2.create;const MZ=SA.create,cs=AA.create;HC.create;const Phe=CA.create;kA.create;sp.create;a_.create;var Ohe=dh({name:ei(),arguments:ei()}),Lhe=dh({id:ei(),type:cs("function"),function:Ohe}),GC=dh({id:ei(),role:ei(),content:ei().optional(),name:ei().optional()}),Dhe=dh({type:cs("text"),text:ei()}),PZ=dh({type:cs("binary"),mimeType:ei(),id:ei().optional(),url:ei().optional(),data:ei().optional(),filename:ei().optional()}),OZ=(e,t)=>{!e.id&&!e.url&&!e.data&&t.addIssue({code:lr.custom,message:"BinaryInputContent requires at least one of id, url, or data.",path:["id"]})};PZ.superRefine((e,t)=>{OZ(e,t)});var Nhe=KO("type",[Dhe,PZ]),zhe=Nhe.superRefine((e,t)=>{e.type==="binary"&&OZ(e,t)}),Fhe=GC.extend({role:cs("developer"),content:ei()}),Bhe=GC.extend({role:cs("system"),content:ei()}),jhe=GC.extend({role:cs("assistant"),content:ei().optional(),toolCalls:Qm(Lhe).optional()}),Uhe=GC.extend({role:cs("user"),content:YO([ei(),Qm(zhe)])}),Vhe=dh({id:ei(),content:ei(),role:cs("tool"),toolCallId:ei(),error:ei().optional()}),$he=dh({id:ei(),role:cs("activity"),activityType:ei(),content:MZ(fd())}),LZ=KO("role",[Fhe,Bhe,jhe,Uhe,Vhe,$he]);YO([cs("developer"),cs("system"),cs("assistant"),cs("user"),cs("tool"),cs("activity")]);var Hhe=dh({description:ei(),value:ei()}),Ghe=dh({name:ei(),description:ei(),parameters:fd()}),qhe=dh({threadId:ei(),runId:ei(),parentRunId:ei().optional(),state:fd(),messages:Qm(LZ),tools:Qm(Ghe),context:Qm(Hhe),forwardedProps:fd()}),Whe=fd(),Lo=class extends Error{constructor(e){super(e)}},rP=class extends Lo{constructor(){super("Connect not implemented. This method is not supported by the current agent.")}},DZ=YO([cs("developer"),cs("system"),cs("assistant"),cs("user")]),Hn=(e=>(e.TEXT_MESSAGE_START="TEXT_MESSAGE_START",e.TEXT_MESSAGE_CONTENT="TEXT_MESSAGE_CONTENT",e.TEXT_MESSAGE_END="TEXT_MESSAGE_END",e.TEXT_MESSAGE_CHUNK="TEXT_MESSAGE_CHUNK",e.THINKING_TEXT_MESSAGE_START="THINKING_TEXT_MESSAGE_START",e.THINKING_TEXT_MESSAGE_CONTENT="THINKING_TEXT_MESSAGE_CONTENT",e.THINKING_TEXT_MESSAGE_END="THINKING_TEXT_MESSAGE_END",e.TOOL_CALL_START="TOOL_CALL_START",e.TOOL_CALL_ARGS="TOOL_CALL_ARGS",e.TOOL_CALL_END="TOOL_CALL_END",e.TOOL_CALL_CHUNK="TOOL_CALL_CHUNK",e.TOOL_CALL_RESULT="TOOL_CALL_RESULT",e.THINKING_START="THINKING_START",e.THINKING_END="THINKING_END",e.STATE_SNAPSHOT="STATE_SNAPSHOT",e.STATE_DELTA="STATE_DELTA",e.MESSAGES_SNAPSHOT="MESSAGES_SNAPSHOT",e.ACTIVITY_SNAPSHOT="ACTIVITY_SNAPSHOT",e.ACTIVITY_DELTA="ACTIVITY_DELTA",e.RAW="RAW",e.CUSTOM="CUSTOM",e.RUN_STARTED="RUN_STARTED",e.RUN_FINISHED="RUN_FINISHED",e.RUN_ERROR="RUN_ERROR",e.STEP_STARTED="STEP_STARTED",e.STEP_FINISHED="STEP_FINISHED",e))(Hn||{}),ho=dh({type:Phe(Hn),timestamp:Rhe().optional(),rawEvent:fd().optional()}),Zhe=ho.extend({type:cs("TEXT_MESSAGE_START"),messageId:ei(),role:DZ.default("assistant")}),NZ=ho.extend({type:cs("TEXT_MESSAGE_CONTENT"),messageId:ei(),delta:ei().refine(e=>e.length>0,"Delta must not be an empty string")}),Xhe=ho.extend({type:cs("TEXT_MESSAGE_END"),messageId:ei()}),Yhe=ho.extend({type:cs("TEXT_MESSAGE_CHUNK"),messageId:ei().optional(),role:DZ.optional(),delta:ei().optional()}),Khe=ho.extend({type:cs("THINKING_TEXT_MESSAGE_START")}),Qhe=NZ.omit({messageId:!0,type:!0}).extend({type:cs("THINKING_TEXT_MESSAGE_CONTENT")}),Jhe=ho.extend({type:cs("THINKING_TEXT_MESSAGE_END")}),efe=ho.extend({type:cs("TOOL_CALL_START"),toolCallId:ei(),toolCallName:ei(),parentMessageId:ei().optional()}),tfe=ho.extend({type:cs("TOOL_CALL_ARGS"),toolCallId:ei(),delta:ei()}),nfe=ho.extend({type:cs("TOOL_CALL_END"),toolCallId:ei()}),rfe=ho.extend({messageId:ei(),type:cs("TOOL_CALL_RESULT"),toolCallId:ei(),content:ei(),role:cs("tool").optional()}),ife=ho.extend({type:cs("TOOL_CALL_CHUNK"),toolCallId:ei().optional(),toolCallName:ei().optional(),parentMessageId:ei().optional(),delta:ei().optional()}),sfe=ho.extend({type:cs("THINKING_START"),title:ei().optional()}),afe=ho.extend({type:cs("THINKING_END")}),ofe=ho.extend({type:cs("STATE_SNAPSHOT"),snapshot:Whe}),lfe=ho.extend({type:cs("STATE_DELTA"),delta:Qm(fd())}),ufe=ho.extend({type:cs("MESSAGES_SNAPSHOT"),messages:Qm(LZ)}),cfe=ho.extend({type:cs("ACTIVITY_SNAPSHOT"),messageId:ei(),activityType:ei(),content:MZ(fd()),replace:Mhe().optional().default(!0)}),dfe=ho.extend({type:cs("ACTIVITY_DELTA"),messageId:ei(),activityType:ei(),patch:Qm(fd())}),hfe=ho.extend({type:cs("RAW"),event:fd(),source:ei().optional()}),ffe=ho.extend({type:cs("CUSTOM"),name:ei(),value:fd()}),pfe=ho.extend({type:cs("RUN_STARTED"),threadId:ei(),runId:ei(),parentRunId:ei().optional(),input:qhe.optional()}),mfe=ho.extend({type:cs("RUN_FINISHED"),threadId:ei(),runId:ei(),result:fd().optional()}),gfe=ho.extend({type:cs("RUN_ERROR"),message:ei(),code:ei().optional()}),_fe=ho.extend({type:cs("STEP_STARTED"),stepName:ei()}),yfe=ho.extend({type:cs("STEP_FINISHED"),stepName:ei()}),zZ=KO("type",[Zhe,NZ,Xhe,Yhe,sfe,afe,Khe,Qhe,Jhe,efe,tfe,nfe,ife,rfe,ofe,lfe,ufe,cfe,dfe,hfe,ffe,pfe,mfe,gfe,_fe,yfe]);function Fo(e){return typeof e=="function"}function vfe(e){return Fo(e==null?void 0:e.lift)}function cf(e){return function(t){if(vfe(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}var FZ=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function BZ(e){return Fo(e==null?void 0:e.then)}function QO(e){var t=function(r){Error.call(r),r.stack=new Error().stack},n=e(t);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var c5=QO(function(e){return function(n){e(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,a){return a+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function iP(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var qC=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,n,r,a,u;if(!this.closed){this.closed=!0;var f=this._parentage;if(f)if(this._parentage=null,Array.isArray(f))try{for(var s=Iv(f),v=s.next();!v.done;v=s.next()){var x=v.value;x.remove(this)}}catch(U){t={error:U}}finally{try{v&&!v.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}else f.remove(this);var A=this.initialTeardown;if(Fo(A))try{A()}catch(U){u=U instanceof c5?U.errors:[U]}var C=this._finalizers;if(C){this._finalizers=null;try{for(var P=Iv(C),L=P.next();!L.done;L=P.next()){var F=L.value;try{XB(F)}catch(U){u=u??[],U instanceof c5?u=_A(_A([],$M(u)),$M(U.errors)):u.push(U)}}}catch(U){r={error:U}}finally{try{L&&!L.done&&(a=P.return)&&a.call(P)}finally{if(r)throw r.error}}}if(u)throw new c5(u)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)XB(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(t)}},e.prototype._hasParent=function(t){var n=this._parentage;return n===t||Array.isArray(n)&&n.includes(t)},e.prototype._addParent=function(t){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t},e.prototype._removeParent=function(t){var n=this._parentage;n===t?this._parentage=null:Array.isArray(n)&&iP(n,t)},e.prototype.remove=function(t){var n=this._finalizers;n&&iP(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),jZ=qC.EMPTY;function UZ(e){return e instanceof qC||e&&"closed"in e&&Fo(e.remove)&&Fo(e.add)&&Fo(e.unsubscribe)}function XB(e){Fo(e)?e():e.unsubscribe()}var xfe={Promise:void 0},bfe={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,_A([e,t],$M(n)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function VZ(e){bfe.setTimeout(function(){throw e})}function sP(){}function s4(e){e()}var JO=function(e){ex(t,e);function t(n){var r=e.call(this)||this;return r.isStopped=!1,n?(r.destination=n,UZ(n)&&n.add(r)):r.destination=Efe,r}return t.create=function(n,r,a){return new aP(n,r,a)},t.prototype.next=function(n){this.isStopped||this._next(n)},t.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(n){this.destination.next(n)},t.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(qC),wfe=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var n=this.partialObserver;if(n.next)try{n.next(t)}catch(r){p3(r)}},e.prototype.error=function(t){var n=this.partialObserver;if(n.error)try{n.error(t)}catch(r){p3(r)}else p3(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(n){p3(n)}},e}(),aP=function(e){ex(t,e);function t(n,r,a){var u=e.call(this)||this,f;return Fo(n)||!n?f={next:n??void 0,error:r??void 0,complete:a??void 0}:f=n,u.destination=new wfe(f),u}return t}(JO);function p3(e){VZ(e)}function Tfe(e){throw e}var Efe={closed:!0,next:sP,error:Tfe,complete:sP},eL=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function tL(e){return e}function YB(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return $Z(e)}function $Z(e){return e.length===0?tL:e.length===1?e[0]:function(n){return e.reduce(function(r,a){return a(r)},n)}}var Cu=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(t,n,r){var a=this,u=Afe(t)?t:new aP(t,n,r);return s4(function(){var f=a,s=f.operator,v=f.source;u.add(s?s.call(u,v):v?a._subscribe(u):a._trySubscribe(u))}),u},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(n){t.error(n)}},e.prototype.forEach=function(t,n){var r=this;return n=KB(n),new n(function(a,u){var f=new aP({next:function(s){try{t(s)}catch(v){u(v),f.unsubscribe()}},error:u,complete:a});r.subscribe(f)})},e.prototype._subscribe=function(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)},e.prototype[eL]=function(){return this},e.prototype.pipe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return $Z(t)(this)},e.prototype.toPromise=function(t){var n=this;return t=KB(t),new t(function(r,a){var u;n.subscribe(function(f){return u=f},function(f){return a(f)},function(){return r(u)})})},e.create=function(t){return new e(t)},e}();function KB(e){var t;return(t=e??xfe.Promise)!==null&&t!==void 0?t:Promise}function Sfe(e){return e&&Fo(e.next)&&Fo(e.error)&&Fo(e.complete)}function Afe(e){return e&&e instanceof JO||Sfe(e)&&UZ(e)}function HZ(e){return Fo(e[eL])}function GZ(e){return Symbol.asyncIterator&&Fo(e==null?void 0:e[Symbol.asyncIterator])}function qZ(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Cfe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var WZ=Cfe();function ZZ(e){return Fo(e==null?void 0:e[WZ])}function XZ(e){return Tde(this,arguments,function(){var n,r,a,u;return nZ(this,function(f){switch(f.label){case 0:n=e.getReader(),f.label=1;case 1:f.trys.push([1,,9,10]),f.label=2;case 2:return[4,ev(n.read())];case 3:return r=f.sent(),a=r.value,u=r.done,u?[4,ev(void 0)]:[3,5];case 4:return[2,f.sent()];case 5:return[4,ev(a)];case 6:return[4,f.sent()];case 7:return f.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function YZ(e){return Fo(e==null?void 0:e.getReader)}function wp(e){if(e instanceof Cu)return e;if(e!=null){if(HZ(e))return kfe(e);if(FZ(e))return Ife(e);if(BZ(e))return Rfe(e);if(GZ(e))return KZ(e);if(ZZ(e))return Mfe(e);if(YZ(e))return Pfe(e)}throw qZ(e)}function kfe(e){return new Cu(function(t){var n=e[eL]();if(Fo(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Ife(e){return new Cu(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}function Rfe(e){return new Cu(function(t){e.then(function(n){t.closed||(t.next(n),t.complete())},function(n){return t.error(n)}).then(null,VZ)})}function Mfe(e){return new Cu(function(t){var n,r;try{for(var a=Iv(e),u=a.next();!u.done;u=a.next()){var f=u.value;if(t.next(f),t.closed)return}}catch(s){n={error:s}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}t.complete()})}function KZ(e){return new Cu(function(t){Ofe(e,t).catch(function(n){return t.error(n)})})}function Pfe(e){return KZ(XZ(e))}function Ofe(e,t){var n,r,a,u;return wde(this,void 0,void 0,function(){var f,s;return nZ(this,function(v){switch(v.label){case 0:v.trys.push([0,5,6,11]),n=Ede(e),v.label=1;case 1:return[4,n.next()];case 2:if(r=v.sent(),!!r.done)return[3,4];if(f=r.value,t.next(f),t.closed)return[2];v.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=v.sent(),a={error:s},[3,11];case 6:return v.trys.push([6,,9,10]),r&&!r.done&&(u=n.return)?[4,u.call(n)]:[3,8];case 7:v.sent(),v.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function of(e,t,n,r,a){return new Lfe(e,t,n,r,a)}var Lfe=function(e){ex(t,e);function t(n,r,a,u,f,s){var v=e.call(this,n)||this;return v.onFinalize=f,v.shouldUnsubscribe=s,v._next=r?function(x){try{r(x)}catch(A){n.error(A)}}:e.prototype._next,v._error=u?function(x){try{u(x)}catch(A){n.error(A)}finally{this.unsubscribe()}}:e.prototype._error,v._complete=a?function(){try{a()}catch(x){n.error(x)}finally{this.unsubscribe()}}:e.prototype._complete,v}return t.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},t}(JO),QZ={now:function(){return(QZ.delegate||Date).now()},delegate:void 0};function Dfe(e){return e&&Fo(e.schedule)}function Nfe(e){return e[e.length-1]}function zfe(e){return Dfe(Nfe(e))?e.pop():void 0}function Wg(e,t,n,r,a){r===void 0&&(r=0),a===void 0&&(a=!1);var u=t.schedule(function(){n(),a?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(u),!a)return u}function oP(e){return cf(function(t,n){var r=null,a=!1,u;r=t.subscribe(of(n,void 0,void 0,function(f){u=wp(e(f,oP(e)(t))),r?(r.unsubscribe(),r=null,u.subscribe(n)):a=!0})),a&&(r.unsubscribe(),r=null,u.subscribe(n))})}function JZ(e,t){return t===void 0&&(t=0),cf(function(n,r){n.subscribe(of(r,function(a){return Wg(r,e,function(){return r.next(a)},t)},function(){return Wg(r,e,function(){return r.complete()},t)},function(a){return Wg(r,e,function(){return r.error(a)},t)}))})}function eX(e,t){return t===void 0&&(t=0),cf(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function Ffe(e,t){return wp(e).pipe(eX(t),JZ(t))}function Bfe(e,t){return wp(e).pipe(eX(t),JZ(t))}function jfe(e,t){return new Cu(function(n){var r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}function Ufe(e,t){return new Cu(function(n){var r;return Wg(n,t,function(){r=e[WZ](),Wg(n,t,function(){var a,u,f;try{a=r.next(),u=a.value,f=a.done}catch(s){n.error(s);return}f?n.complete():n.next(u)},0,!0)}),function(){return Fo(r==null?void 0:r.return)&&r.return()}})}function tX(e,t){if(!e)throw new Error("Iterable cannot be null");return new Cu(function(n){Wg(n,t,function(){var r=e[Symbol.asyncIterator]();Wg(n,t,function(){r.next().then(function(a){a.done?n.complete():n.next(a.value)})},0,!0)})})}function Vfe(e,t){return tX(XZ(e),t)}function $fe(e,t){if(e!=null){if(HZ(e))return Ffe(e,t);if(FZ(e))return jfe(e,t);if(BZ(e))return Bfe(e,t);if(GZ(e))return tX(e,t);if(ZZ(e))return Ufe(e,t);if(YZ(e))return Vfe(e,t)}throw qZ(e)}function PA(e,t){return t?$fe(e,t):wp(e)}function lP(e,t){return cf(function(n,r){var a=0;n.subscribe(of(r,function(u){r.next(e.call(t,u,a++))}))})}function Hfe(e,t,n,r,a,u,f,s){var v=[],x=0,A=0,C=!1,P=function(){C&&!v.length&&!x&&t.complete()},L=function(U){return x<r?F(U):v.push(U)},F=function(U){x++;var q=!1;wp(n(U,A++)).subscribe(of(t,function(G){t.next(G)},function(){q=!0},void 0,function(){if(q)try{x--;for(var G=function(){var $=v.shift();f||F($)};v.length&&x<r;)G();P()}catch($){t.error($)}}))};return e.subscribe(of(t,L,function(){C=!0,P()})),function(){}}function i0(e,t,n){return n===void 0&&(n=1/0),Fo(t)?i0(function(r,a){return lP(function(u,f){return t(r,u,a,f)})(wp(e(r,a)))},n):(typeof t=="number"&&(n=t),cf(function(r,a){return Hfe(r,a,e,n)}))}function Gfe(e){return e===void 0&&(e=1/0),i0(tL,e)}function nX(e,t){return Fo(t)?i0(e,t,1):i0(e,1)}var qfe=QO(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),o_=function(e){ex(t,e);function t(){var n=e.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return t.prototype.lift=function(n){var r=new QB(this,this);return r.operator=n,r},t.prototype._throwIfClosed=function(){if(this.closed)throw new qfe},t.prototype.next=function(n){var r=this;s4(function(){var a,u;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var f=Iv(r.currentObservers),s=f.next();!s.done;s=f.next()){var v=s.value;v.next(n)}}catch(x){a={error:x}}finally{try{s&&!s.done&&(u=f.return)&&u.call(f)}finally{if(a)throw a.error}}}})},t.prototype.error=function(n){var r=this;s4(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var a=r.observers;a.length;)a.shift().error(n)}})},t.prototype.complete=function(){var n=this;s4(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(n){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,n)},t.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},t.prototype._innerSubscribe=function(n){var r=this,a=this,u=a.hasError,f=a.isStopped,s=a.observers;return u||f?jZ:(this.currentObservers=null,s.push(n),new qC(function(){r.currentObservers=null,iP(s,n)}))},t.prototype._checkFinalizedStatuses=function(n){var r=this,a=r.hasError,u=r.thrownError,f=r.isStopped;a?n.error(u):f&&n.complete()},t.prototype.asObservable=function(){var n=new Cu;return n.source=this,n},t.create=function(n,r){return new QB(n,r)},t}(Cu),QB=function(e){ex(t,e);function t(n,r){var a=e.call(this)||this;return a.destination=n,a.source=r,a}return t.prototype.next=function(n){var r,a;(a=(r=this.destination)===null||r===void 0?void 0:r.next)===null||a===void 0||a.call(r,n)},t.prototype.error=function(n){var r,a;(a=(r=this.destination)===null||r===void 0?void 0:r.error)===null||a===void 0||a.call(r,n)},t.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},t.prototype._subscribe=function(n){var r,a;return(a=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&a!==void 0?a:jZ},t}(o_);function Wfe(e){return cf(function(t,n){var r=!1;t.subscribe(of(n,function(a){r=!0,n.next(a)},function(){r||n.next(e),n.complete()}))})}var rX=new Cu(function(e){return e.complete()});function Vo(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=zfe(e);return PA(e,n)}function Eo(e,t){var n=Fo(e)?e:function(){return e},r=function(a){return a.error(n())};return new Cu(r)}var Zfe=QO(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function uP(e){return cf(function(t,n){try{t.subscribe(n)}finally{n.add(e)}})}var iX=function(e){ex(t,e);function t(n,r,a){n===void 0&&(n=1/0),r===void 0&&(r=1/0),a===void 0&&(a=QZ);var u=e.call(this)||this;return u._bufferSize=n,u._windowTime=r,u._timestampProvider=a,u._buffer=[],u._infiniteTimeWindow=!0,u._infiniteTimeWindow=r===1/0,u._bufferSize=Math.max(1,n),u._windowTime=Math.max(1,r),u}return t.prototype.next=function(n){var r=this,a=r.isStopped,u=r._buffer,f=r._infiniteTimeWindow,s=r._timestampProvider,v=r._windowTime;a||(u.push(n),!f&&u.push(s.now()+v)),this._trimBuffer(),e.prototype.next.call(this,n)},t.prototype._subscribe=function(n){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(n),a=this,u=a._infiniteTimeWindow,f=a._buffer,s=f.slice(),v=0;v<s.length&&!n.closed;v+=u?1:2)n.next(s[v]);return this._checkFinalizedStatuses(n),r},t.prototype._trimBuffer=function(){var n=this,r=n._bufferSize,a=n._timestampProvider,u=n._buffer,f=n._infiniteTimeWindow,s=(f?1:2)*r;if(r<1/0&&s<u.length&&u.splice(0,u.length-s),!f){for(var v=a.now(),x=0,A=1;A<u.length&&u[A]<=v;A+=2)x=A;x&&u.splice(0,x+1)}},t}(o_);function Xfe(e,t){return cf(function(n,r){var a=null,u=0,f=!1,s=function(){return f&&!a&&r.complete()};n.subscribe(of(r,function(v){a==null||a.unsubscribe();var x=0,A=u++;wp(e(v,A)).subscribe(a=of(r,function(C){return r.next(t?t(v,C,A,x++):C)},function(){a=null,s()}))},function(){f=!0,s()}))})}function JB(e){return cf(function(t,n){wp(e).subscribe(of(n,function(){return n.complete()},sP)),!n.closed&&t.subscribe(n)})}function Yfe(e,t,n){var r=Fo(e)||t||n?{next:e,error:t,complete:n}:e;return r?cf(function(a,u){var f;(f=r.subscribe)===null||f===void 0||f.call(r);var s=!0;a.subscribe(of(u,function(v){var x;(x=r.next)===null||x===void 0||x.call(r,v),u.next(v)},function(){var v;s=!1,(v=r.complete)===null||v===void 0||v.call(r),u.complete()},function(v){var x;s=!1,(x=r.error)===null||x===void 0||x.call(r,v),u.error(v)},function(){var v,x;s&&((v=r.unsubscribe)===null||v===void 0||v.call(r)),(x=r.finalize)===null||x===void 0||x.call(r)}))}):tL}function ej(e,t){return new Promise(function(n,r){var a=!1,u;e.subscribe({next:function(f){u=f,a=!0},error:r,complete:function(){a?n(u):r(new Zfe)}})})}function Kfe(e){return new Cu(function(t){wp(e()).subscribe(t)})}const Ol=[];for(let e=0;e<256;++e)Ol.push((e+256).toString(16).slice(1));function Qfe(e,t=0){return(Ol[e[t+0]]+Ol[e[t+1]]+Ol[e[t+2]]+Ol[e[t+3]]+"-"+Ol[e[t+4]]+Ol[e[t+5]]+"-"+Ol[e[t+6]]+Ol[e[t+7]]+"-"+Ol[e[t+8]]+Ol[e[t+9]]+"-"+Ol[e[t+10]]+Ol[e[t+11]]+Ol[e[t+12]]+Ol[e[t+13]]+Ol[e[t+14]]+Ol[e[t+15]]).toLowerCase()}let d5;const Jfe=new Uint8Array(16);function epe(){if(!d5){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");d5=crypto.getRandomValues.bind(crypto)}return d5(Jfe)}const tpe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),tj={randomUUID:tpe};function I1(e,t,n){var a;if(tj.randomUUID&&!e)return tj.randomUUID();e=e||{};const r=e.random??((a=e.rng)==null?void 0:a.call(e))??epe();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Qfe(r)}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var npe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,a){r.__proto__=a}||function(r,a){for(var u in a)a.hasOwnProperty(u)&&(r[u]=a[u])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),rpe=Object.prototype.hasOwnProperty;function cP(e,t){return rpe.call(e,t)}function dP(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var a in e)cP(e,a)&&r.push(a);return r}function Ac(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function hP(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function kg(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function sX(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function fP(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(fP(e[t]))return!0}else if(typeof e=="object"){for(var r=dP(e),a=r.length,u=0;u<a;u++)if(fP(e[r[u]]))return!0}}return!1}function nj(e,t){var n=[e];for(var r in t){var a=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof a<"u"&&n.push(r+": "+a)}return n.join(`
`)}var aX=function(e){npe(t,e);function t(n,r,a,u,f){var s=this.constructor,v=e.call(this,nj(n,{name:r,index:a,operation:u,tree:f}))||this;return v.name=r,v.index=a,v.operation=u,v.tree=f,Object.setPrototypeOf(v,s.prototype),v.message=nj(n,{name:r,index:a,operation:u,tree:f}),v}return t}(Error),No=aX,ipe=Ac,q1={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=OA(n,this.path);r&&(r=Ac(r));var a=Zg(n,{op:"remove",path:this.from}).removed;return Zg(n,{op:"add",path:this.path,value:a}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=OA(n,this.from);return Zg(n,{op:"add",path:this.path,value:Ac(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:$2(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},spe={add:function(e,t,n){return hP(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:q1.move,copy:q1.copy,test:q1.test,_get:q1._get};function OA(e,t){if(t=="")return e;var n={op:"_get",path:t};return Zg(e,n),n.value}function Zg(e,t,n,r,a,u){if(n===void 0&&(n=!1),r===void 0&&(r=!0),a===void 0&&(a=!0),u===void 0&&(u=0),n&&(typeof n=="function"?n(t,0,e,t.path):LA(t,0)),t.path===""){var f={newDocument:e};if(t.op==="add")return f.newDocument=t.value,f;if(t.op==="replace")return f.newDocument=t.value,f.removed=e,f;if(t.op==="move"||t.op==="copy")return f.newDocument=OA(e,t.from),t.op==="move"&&(f.removed=e),f;if(t.op==="test"){if(f.test=$2(e,t.value),f.test===!1)throw new No("Test operation failed","TEST_OPERATION_FAILED",u,t,e);return f.newDocument=e,f}else{if(t.op==="remove")return f.removed=e,f.newDocument=null,f;if(t.op==="_get")return t.value=e,f;if(n)throw new No("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",u,t,e);return f}}else{r||(e=Ac(e));var s=t.path||"",v=s.split("/"),x=e,A=1,C=v.length,P=void 0,L=void 0,F=void 0;for(typeof n=="function"?F=n:F=LA;;){if(L=v[A],L&&L.indexOf("~")!=-1&&(L=sX(L)),a&&(L=="__proto__"||L=="prototype"&&A>0&&v[A-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&P===void 0&&(x[L]===void 0?P=v.slice(0,A).join("/"):A==C-1&&(P=t.path),P!==void 0&&F(t,0,e,P)),A++,Array.isArray(x)){if(L==="-")L=x.length;else{if(n&&!hP(L))throw new No("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",u,t,e);hP(L)&&(L=~~L)}if(A>=C){if(n&&t.op==="add"&&L>x.length)throw new No("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",u,t,e);var f=spe[t.op].call(t,x,L,e);if(f.test===!1)throw new No("Test operation failed","TEST_OPERATION_FAILED",u,t,e);return f}}else if(A>=C){var f=q1[t.op].call(t,x,L,e);if(f.test===!1)throw new No("Test operation failed","TEST_OPERATION_FAILED",u,t,e);return f}if(x=x[L],n&&A<C&&(!x||typeof x!="object"))throw new No("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",u,t,e)}}}function Ov(e,t,n,r,a){if(r===void 0&&(r=!0),a===void 0&&(a=!0),n&&!Array.isArray(t))throw new No("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Ac(e));for(var u=new Array(t.length),f=0,s=t.length;f<s;f++)u[f]=Zg(e,t[f],n,!0,a,f),e=u[f].newDocument;return u.newDocument=e,u}function ape(e,t,n){var r=Zg(e,t);if(r.test===!1)throw new No("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function LA(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new No("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(q1[e.op]){if(typeof e.path!="string")throw new No("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new No('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new No("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new No("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&fP(e.value))throw new No("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var a=e.path.split("/").length,u=r.split("/").length;if(a!==u+1&&a!==u)throw new No("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new No("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var f={op:"_get",path:e.from,value:void 0},s=oX([f],n);if(s&&s.name==="OPERATION_PATH_UNRESOLVABLE")throw new No("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new No("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function oX(e,t,n){try{if(!Array.isArray(e))throw new No("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Ov(Ac(t),Ac(e),n||!0);else{n=n||LA;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(a){if(a instanceof No)return a;throw a}}function $2(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),a,u,f;if(n&&r){if(u=e.length,u!=t.length)return!1;for(a=u;a--!==0;)if(!$2(e[a],t[a]))return!1;return!0}if(n!=r)return!1;var s=Object.keys(e);if(u=s.length,u!==Object.keys(t).length)return!1;for(a=u;a--!==0;)if(!t.hasOwnProperty(s[a]))return!1;for(a=u;a--!==0;)if(f=s[a],!$2(e[f],t[f]))return!1;return!0}return e!==e&&t!==t}const ope=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:No,_areEquals:$2,applyOperation:Zg,applyPatch:Ov,applyReducer:ape,deepClone:ipe,getValueByPointer:OA,validate:oX,validator:LA},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var nL=new WeakMap,lpe=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),upe=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function cpe(e){return nL.get(e)}function dpe(e,t){return e.observers.get(t)}function hpe(e,t){e.observers.delete(t.callback)}function fpe(e,t){t.unobserve()}function ppe(e,t){var n=[],r,a=cpe(e);if(!a)a=new lpe(e),nL.set(e,a);else{var u=dpe(a,t);r=u&&u.observer}if(r)return r;if(r={},a.value=Ac(e),t){r.callback=t,r.next=null;var f=function(){pP(r)},s=function(){clearTimeout(r.next),r.next=setTimeout(f)};typeof window<"u"&&(window.addEventListener("mouseup",s),window.addEventListener("keyup",s),window.addEventListener("mousedown",s),window.addEventListener("keydown",s),window.addEventListener("change",s))}return r.patches=n,r.object=e,r.unobserve=function(){pP(r),clearTimeout(r.next),hpe(a,r),typeof window<"u"&&(window.removeEventListener("mouseup",s),window.removeEventListener("keyup",s),window.removeEventListener("mousedown",s),window.removeEventListener("keydown",s),window.removeEventListener("change",s))},a.observers.set(t,new upe(t,r)),r}function pP(e,t){t===void 0&&(t=!1);var n=nL.get(e.object);rL(n.value,e.object,e.patches,"",t),e.patches.length&&Ov(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function rL(e,t,n,r,a){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var u=dP(t),f=dP(e),s=!1,v=f.length-1;v>=0;v--){var x=f[v],A=e[x];if(cP(t,x)&&!(t[x]===void 0&&A!==void 0&&Array.isArray(t)===!1)){var C=t[x];typeof A=="object"&&A!=null&&typeof C=="object"&&C!=null&&Array.isArray(A)===Array.isArray(C)?rL(A,C,n,r+"/"+kg(x),a):A!==C&&(a&&n.push({op:"test",path:r+"/"+kg(x),value:Ac(A)}),n.push({op:"replace",path:r+"/"+kg(x),value:Ac(C)}))}else Array.isArray(e)===Array.isArray(t)?(a&&n.push({op:"test",path:r+"/"+kg(x),value:Ac(A)}),n.push({op:"remove",path:r+"/"+kg(x)}),s=!0):(a&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!s&&u.length==f.length))for(var v=0;v<u.length;v++){var x=u[v];!cP(e,x)&&t[x]!==void 0&&n.push({op:"add",path:r+"/"+kg(x),value:Ac(t[x])})}}}function mpe(e,t,n){n===void 0&&(n=!1);var r=[];return rL(e,t,r,"",n),r}const gpe=Object.freeze(Object.defineProperty({__proto__:null,compare:mpe,generate:pP,observe:ppe,unobserve:fpe},Symbol.toStringTag,{value:"Module"}));Object.assign({},ope,gpe,{JsonPatchError:aX,deepClone:Ac,escapePathComponent:kg,unescapePathComponent:sX});function _pe(){let e=0,t=0;for(let r=0;r<28;r+=7){let a=this.buf[this.pos++];if(e|=(a&127)<<r,!(a&128))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(n&15)<<28,t=(n&112)>>4,!(n&128))return this.assertBounds(),[e,t];for(let r=3;r<=31;r+=7){let a=this.buf[this.pos++];if(t|=(a&127)<<r,!(a&128))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function h5(e,t,n){for(let u=0;u<28;u=u+7){const f=e>>>u,s=!(!(f>>>7)&&t==0),v=(s?f|128:f)&255;if(n.push(v),!s)return}const r=e>>>28&15|(t&7)<<4,a=!!(t>>3);if(n.push((a?r|128:r)&255),!!a){for(let u=3;u<31;u=u+7){const f=t>>>u,s=!!(f>>>7),v=(s?f|128:f)&255;if(n.push(v),!s)return}n.push(t>>>31&1)}}const a4=4294967296;function rj(e){const t=e[0]==="-";t&&(e=e.slice(1));const n=1e6;let r=0,a=0;function u(f,s){const v=Number(e.slice(f,s));a*=n,r=r*n+v,r>=a4&&(a=a+(r/a4|0),r=r%a4)}return u(-24,-18),u(-18,-12),u(-12,-6),u(-6),t?uX(r,a):iL(r,a)}function ype(e,t){let n=iL(e,t);const r=n.hi&2147483648;r&&(n=uX(n.lo,n.hi));const a=lX(n.lo,n.hi);return r?"-"+a:a}function lX(e,t){if({lo:e,hi:t}=vpe(e,t),t<=2097151)return String(a4*t+e);const n=e&16777215,r=(e>>>24|t<<8)&16777215,a=t>>16&65535;let u=n+r*6777216+a*6710656,f=r+a*8147497,s=a*2;const v=1e7;return u>=v&&(f+=Math.floor(u/v),u%=v),f>=v&&(s+=Math.floor(f/v),f%=v),s.toString()+ij(f)+ij(u)}function vpe(e,t){return{lo:e>>>0,hi:t>>>0}}function iL(e,t){return{lo:e|0,hi:t|0}}function uX(e,t){return t=~t,e?e=~e+1:t+=1,iL(e,t)}const ij=e=>{const t=String(e);return"0000000".slice(t.length)+t};function sj(e,t){if(e>=0){for(;e>127;)t.push(e&127|128),e=e>>>7;t.push(e)}else{for(let n=0;n<9;n++)t.push(e&127|128),e=e>>7;t.push(1)}}function xpe(){let e=this.buf[this.pos++],t=e&127;if(!(e&128))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<7,!(e&128))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<14,!(e&128))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<21,!(e&128))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(e&15)<<28;for(let n=5;e&128&&n<10;n++)e=this.buf[this.pos++];if(e&128)throw new Error("invalid varint");return this.assertBounds(),t>>>0}var aj={};const Xh=bpe();function bpe(){const e=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof e.getBigInt64=="function"&&typeof e.getBigUint64=="function"&&typeof e.setBigInt64=="function"&&typeof e.setBigUint64=="function"&&(!!globalThis.Deno||typeof process!="object"||typeof aj!="object"||aj.BUF_BIGINT_DISABLE!=="1")){const n=BigInt("-9223372036854775808"),r=BigInt("9223372036854775807"),a=BigInt("0"),u=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(f){const s=typeof f=="bigint"?f:BigInt(f);if(s>r||s<n)throw new Error(`invalid int64: ${f}`);return s},uParse(f){const s=typeof f=="bigint"?f:BigInt(f);if(s>u||s<a)throw new Error(`invalid uint64: ${f}`);return s},enc(f){return e.setBigInt64(0,this.parse(f),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(f){return e.setBigInt64(0,this.uParse(f),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec(f,s){return e.setInt32(0,f,!0),e.setInt32(4,s,!0),e.getBigInt64(0,!0)},uDec(f,s){return e.setInt32(0,f,!0),e.setInt32(4,s,!0),e.getBigUint64(0,!0)}}}return{zero:"0",supported:!1,parse(n){return typeof n!="string"&&(n=n.toString()),oj(n),n},uParse(n){return typeof n!="string"&&(n=n.toString()),lj(n),n},enc(n){return typeof n!="string"&&(n=n.toString()),oj(n),rj(n)},uEnc(n){return typeof n!="string"&&(n=n.toString()),lj(n),rj(n)},dec(n,r){return ype(n,r)},uDec(n,r){return lX(n,r)}}}function oj(e){if(!/^-?[0-9]+$/.test(e))throw new Error("invalid int64: "+e)}function lj(e){if(!/^[0-9]+$/.test(e))throw new Error("invalid uint64: "+e)}const f5=Symbol.for("@bufbuild/protobuf/text-encoding");function cX(){if(globalThis[f5]==null){const e=new globalThis.TextEncoder,t=new globalThis.TextDecoder;globalThis[f5]={encodeUtf8(n){return e.encode(n)},decodeUtf8(n){return t.decode(n)},checkUtf8(n){try{return encodeURIComponent(n),!0}catch{return!1}}}}return globalThis[f5]}var xm;(function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"})(xm||(xm={}));const wpe=34028234663852886e22,Tpe=-34028234663852886e22,Epe=4294967295,Spe=2147483647,Ape=-2147483648;class $a{constructor(t=cX().encodeUtf8){this.encodeUtf8=t,this.stack=[],this.chunks=[],this.buf=[]}finish(){this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]);let t=0;for(let a=0;a<this.chunks.length;a++)t+=this.chunks[a].length;let n=new Uint8Array(t),r=0;for(let a=0;a<this.chunks.length;a++)n.set(this.chunks[a],r),r+=this.chunks[a].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,n){return this.uint32((t<<3|n)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(uj(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return p5(t),sj(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let n=this.encodeUtf8(t);return this.uint32(n.byteLength),this.raw(n)}float(t){Cpe(t);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,t,!0),this.raw(n)}double(t){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,t,!0),this.raw(n)}fixed32(t){uj(t);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,t,!0),this.raw(n)}sfixed32(t){p5(t);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,t,!0),this.raw(n)}sint32(t){return p5(t),t=(t<<1^t>>31)>>>0,sj(t,this.buf),this}sfixed64(t){let n=new Uint8Array(8),r=new DataView(n.buffer),a=Xh.enc(t);return r.setInt32(0,a.lo,!0),r.setInt32(4,a.hi,!0),this.raw(n)}fixed64(t){let n=new Uint8Array(8),r=new DataView(n.buffer),a=Xh.uEnc(t);return r.setInt32(0,a.lo,!0),r.setInt32(4,a.hi,!0),this.raw(n)}int64(t){let n=Xh.enc(t);return h5(n.lo,n.hi,this.buf),this}sint64(t){const n=Xh.enc(t),r=n.hi>>31,a=n.lo<<1^r,u=(n.hi<<1|n.lo>>>31)^r;return h5(a,u,this.buf),this}uint64(t){const n=Xh.uEnc(t);return h5(n.lo,n.hi,this.buf),this}}class Si{constructor(t,n=cX().decodeUtf8){this.decodeUtf8=n,this.varint64=_pe,this.uint32=xpe,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength)}tag(){let t=this.uint32(),n=t>>>3,r=t&7;if(n<=0||r<0||r>5)throw new Error("illegal tag: field no "+n+" wire type "+r);return[n,r]}skip(t,n){let r=this.pos;switch(t){case xm.Varint:for(;this.buf[this.pos++]&128;);break;case xm.Bit64:this.pos+=4;case xm.Bit32:this.pos+=4;break;case xm.LengthDelimited:let a=this.uint32();this.pos+=a;break;case xm.StartGroup:for(;;){const[u,f]=this.tag();if(f===xm.EndGroup){if(n!==void 0&&u!==n)throw new Error("invalid end group tag");break}this.skip(f,u)}break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return Xh.dec(...this.varint64())}uint64(){return Xh.uDec(...this.varint64())}sint64(){let[t,n]=this.varint64(),r=-(t&1);return t=(t>>>1|(n&1)<<31)^r,n=n>>>1^r,Xh.dec(t,n)}bool(){let[t,n]=this.varint64();return t!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Xh.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Xh.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),n=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(n,n+t)}string(){return this.decodeUtf8(this.bytes())}}function p5(e){if(typeof e=="string")e=Number(e);else if(typeof e!="number")throw new Error("invalid int32: "+typeof e);if(!Number.isInteger(e)||e>Spe||e<Ape)throw new Error("invalid int32: "+e)}function uj(e){if(typeof e=="string")e=Number(e);else if(typeof e!="number")throw new Error("invalid uint32: "+typeof e);if(!Number.isInteger(e)||e>Epe||e<0)throw new Error("invalid uint32: "+e)}function Cpe(e){if(typeof e=="string"){const t=e;if(e=Number(e),Number.isNaN(e)&&t!=="NaN")throw new Error("invalid float32: "+t)}else if(typeof e!="number")throw new Error("invalid float32: "+typeof e);if(Number.isFinite(e)&&(e>wpe||e<Tpe))throw new Error("invalid float32: "+e)}function m5(){return{fields:{}}}var jw={encode(e,t=new $a){return Object.entries(e.fields).forEach(([n,r])=>{r!==void 0&&mP.encode({key:n,value:r},t.uint32(10).fork()).join()}),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=m5();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;const f=mP.decode(n,n.uint32());f.value!==void 0&&(a.fields[f.key]=f.value);continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return jw.fromPartial(e??{})},fromPartial(e){var t;const n=m5();return n.fields=Object.entries((t=e.fields)!=null?t:{}).reduce((r,[a,u])=>(u!==void 0&&(r[a]=u),r),{}),n},wrap(e){const t=m5();if(e!==void 0)for(const n of Object.keys(e))t.fields[n]=e[n];return t},unwrap(e){const t={};if(e.fields)for(const n of Object.keys(e.fields))t[n]=e.fields[n];return t}};function cj(){return{key:"",value:void 0}}var mP={encode(e,t=new $a){return e.key!==""&&t.uint32(10).string(e.key),e.value!==void 0&&ba.encode(ba.wrap(e.value),t.uint32(18).fork()).join(),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=cj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.key=n.string();continue}case 2:{if(u!==18)break;a.value=ba.unwrap(ba.decode(n,n.uint32()));continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return mP.fromPartial(e??{})},fromPartial(e){var t,n;const r=cj();return r.key=(t=e.key)!=null?t:"",r.value=(n=e.value)!=null?n:void 0,r}};function g5(){return{nullValue:void 0,numberValue:void 0,stringValue:void 0,boolValue:void 0,structValue:void 0,listValue:void 0}}var ba={encode(e,t=new $a){return e.nullValue!==void 0&&t.uint32(8).int32(e.nullValue),e.numberValue!==void 0&&t.uint32(17).double(e.numberValue),e.stringValue!==void 0&&t.uint32(26).string(e.stringValue),e.boolValue!==void 0&&t.uint32(32).bool(e.boolValue),e.structValue!==void 0&&jw.encode(jw.wrap(e.structValue),t.uint32(42).fork()).join(),e.listValue!==void 0&&Uw.encode(Uw.wrap(e.listValue),t.uint32(50).fork()).join(),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=g5();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==8)break;a.nullValue=n.int32();continue}case 2:{if(u!==17)break;a.numberValue=n.double();continue}case 3:{if(u!==26)break;a.stringValue=n.string();continue}case 4:{if(u!==32)break;a.boolValue=n.bool();continue}case 5:{if(u!==42)break;a.structValue=jw.unwrap(jw.decode(n,n.uint32()));continue}case 6:{if(u!==50)break;a.listValue=Uw.unwrap(Uw.decode(n,n.uint32()));continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return ba.fromPartial(e??{})},fromPartial(e){var t,n,r,a,u,f;const s=g5();return s.nullValue=(t=e.nullValue)!=null?t:void 0,s.numberValue=(n=e.numberValue)!=null?n:void 0,s.stringValue=(r=e.stringValue)!=null?r:void 0,s.boolValue=(a=e.boolValue)!=null?a:void 0,s.structValue=(u=e.structValue)!=null?u:void 0,s.listValue=(f=e.listValue)!=null?f:void 0,s},wrap(e){const t=g5();if(e===null)t.nullValue=0;else if(typeof e=="boolean")t.boolValue=e;else if(typeof e=="number")t.numberValue=e;else if(typeof e=="string")t.stringValue=e;else if(globalThis.Array.isArray(e))t.listValue=e;else if(typeof e=="object")t.structValue=e;else if(typeof e<"u")throw new globalThis.Error("Unsupported any value type: "+typeof e);return t},unwrap(e){if(e.stringValue!==void 0)return e.stringValue;if((e==null?void 0:e.numberValue)!==void 0)return e.numberValue;if((e==null?void 0:e.boolValue)!==void 0)return e.boolValue;if((e==null?void 0:e.structValue)!==void 0)return e.structValue;if((e==null?void 0:e.listValue)!==void 0)return e.listValue;if((e==null?void 0:e.nullValue)!==void 0)return null}};function _5(){return{values:[]}}var Uw={encode(e,t=new $a){for(const n of e.values)ba.encode(ba.wrap(n),t.uint32(10).fork()).join();return t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=_5();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.values.push(ba.unwrap(ba.decode(n,n.uint32())));continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return Uw.fromPartial(e??{})},fromPartial(e){var t;const n=_5();return n.values=((t=e.values)==null?void 0:t.map(r=>r))||[],n},wrap(e){const t=_5();return t.values=e??[],t},unwrap(e){return e!=null&&e.hasOwnProperty("values")&&globalThis.Array.isArray(e.values)?e.values:e}},dX=(e=>(e[e.ADD=0]="ADD",e[e.REMOVE=1]="REMOVE",e[e.REPLACE=2]="REPLACE",e[e.MOVE=3]="MOVE",e[e.COPY=4]="COPY",e[e.TEST=5]="TEST",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(dX||{});function dj(){return{op:0,path:"",from:void 0,value:void 0}}var o4={encode(e,t=new $a){return e.op!==0&&t.uint32(8).int32(e.op),e.path!==""&&t.uint32(18).string(e.path),e.from!==void 0&&t.uint32(26).string(e.from),e.value!==void 0&&ba.encode(ba.wrap(e.value),t.uint32(34).fork()).join(),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=dj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==8)break;a.op=n.int32();continue}case 2:{if(u!==18)break;a.path=n.string();continue}case 3:{if(u!==26)break;a.from=n.string();continue}case 4:{if(u!==34)break;a.value=ba.unwrap(ba.decode(n,n.uint32()));continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return o4.fromPartial(e??{})},fromPartial(e){var t,n,r,a;const u=dj();return u.op=(t=e.op)!=null?t:0,u.path=(n=e.path)!=null?n:"",u.from=(r=e.from)!=null?r:void 0,u.value=(a=e.value)!=null?a:void 0,u}};function hj(){return{id:"",type:"",function:void 0}}var l4={encode(e,t=new $a){return e.id!==""&&t.uint32(10).string(e.id),e.type!==""&&t.uint32(18).string(e.type),e.function!==void 0&&u4.encode(e.function,t.uint32(26).fork()).join(),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=hj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.id=n.string();continue}case 2:{if(u!==18)break;a.type=n.string();continue}case 3:{if(u!==26)break;a.function=u4.decode(n,n.uint32());continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return l4.fromPartial(e??{})},fromPartial(e){var t,n;const r=hj();return r.id=(t=e.id)!=null?t:"",r.type=(n=e.type)!=null?n:"",r.function=e.function!==void 0&&e.function!==null?u4.fromPartial(e.function):void 0,r}};function fj(){return{name:"",arguments:""}}var u4={encode(e,t=new $a){return e.name!==""&&t.uint32(10).string(e.name),e.arguments!==""&&t.uint32(18).string(e.arguments),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=fj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.name=n.string();continue}case 2:{if(u!==18)break;a.arguments=n.string();continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return u4.fromPartial(e??{})},fromPartial(e){var t,n;const r=fj();return r.name=(t=e.name)!=null?t:"",r.arguments=(n=e.arguments)!=null?n:"",r}};function pj(){return{id:"",role:"",content:void 0,name:void 0,toolCalls:[],toolCallId:void 0,error:void 0}}var c4={encode(e,t=new $a){e.id!==""&&t.uint32(10).string(e.id),e.role!==""&&t.uint32(18).string(e.role),e.content!==void 0&&t.uint32(26).string(e.content),e.name!==void 0&&t.uint32(34).string(e.name);for(const n of e.toolCalls)l4.encode(n,t.uint32(42).fork()).join();return e.toolCallId!==void 0&&t.uint32(50).string(e.toolCallId),e.error!==void 0&&t.uint32(58).string(e.error),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=pj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.id=n.string();continue}case 2:{if(u!==18)break;a.role=n.string();continue}case 3:{if(u!==26)break;a.content=n.string();continue}case 4:{if(u!==34)break;a.name=n.string();continue}case 5:{if(u!==42)break;a.toolCalls.push(l4.decode(n,n.uint32()));continue}case 6:{if(u!==50)break;a.toolCallId=n.string();continue}case 7:{if(u!==58)break;a.error=n.string();continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return c4.fromPartial(e??{})},fromPartial(e){var t,n,r,a,u,f,s;const v=pj();return v.id=(t=e.id)!=null?t:"",v.role=(n=e.role)!=null?n:"",v.content=(r=e.content)!=null?r:void 0,v.name=(a=e.name)!=null?a:void 0,v.toolCalls=((u=e.toolCalls)==null?void 0:u.map(x=>l4.fromPartial(x)))||[],v.toolCallId=(f=e.toolCallId)!=null?f:void 0,v.error=(s=e.error)!=null?s:void 0,v}},hX=(e=>(e[e.TEXT_MESSAGE_START=0]="TEXT_MESSAGE_START",e[e.TEXT_MESSAGE_CONTENT=1]="TEXT_MESSAGE_CONTENT",e[e.TEXT_MESSAGE_END=2]="TEXT_MESSAGE_END",e[e.TOOL_CALL_START=3]="TOOL_CALL_START",e[e.TOOL_CALL_ARGS=4]="TOOL_CALL_ARGS",e[e.TOOL_CALL_END=5]="TOOL_CALL_END",e[e.STATE_SNAPSHOT=6]="STATE_SNAPSHOT",e[e.STATE_DELTA=7]="STATE_DELTA",e[e.MESSAGES_SNAPSHOT=8]="MESSAGES_SNAPSHOT",e[e.RAW=9]="RAW",e[e.CUSTOM=10]="CUSTOM",e[e.RUN_STARTED=11]="RUN_STARTED",e[e.RUN_FINISHED=12]="RUN_FINISHED",e[e.RUN_ERROR=13]="RUN_ERROR",e[e.STEP_STARTED=14]="STEP_STARTED",e[e.STEP_FINISHED=15]="STEP_FINISHED",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(hX||{});function mj(){return{type:0,timestamp:void 0,rawEvent:void 0}}var ki={encode(e,t=new $a){return e.type!==0&&t.uint32(8).int32(e.type),e.timestamp!==void 0&&t.uint32(16).int64(e.timestamp),e.rawEvent!==void 0&&ba.encode(ba.wrap(e.rawEvent),t.uint32(26).fork()).join(),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=mj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==8)break;a.type=n.int32();continue}case 2:{if(u!==16)break;a.timestamp=kpe(n.int64());continue}case 3:{if(u!==26)break;a.rawEvent=ba.unwrap(ba.decode(n,n.uint32()));continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return ki.fromPartial(e??{})},fromPartial(e){var t,n,r;const a=mj();return a.type=(t=e.type)!=null?t:0,a.timestamp=(n=e.timestamp)!=null?n:void 0,a.rawEvent=(r=e.rawEvent)!=null?r:void 0,a}};function gj(){return{baseEvent:void 0,messageId:"",role:void 0}}var d4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.messageId!==""&&t.uint32(18).string(e.messageId),e.role!==void 0&&t.uint32(26).string(e.role),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=gj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.messageId=n.string();continue}case 3:{if(u!==26)break;a.role=n.string();continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return d4.fromPartial(e??{})},fromPartial(e){var t,n;const r=gj();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,r.messageId=(t=e.messageId)!=null?t:"",r.role=(n=e.role)!=null?n:void 0,r}};function _j(){return{baseEvent:void 0,messageId:"",delta:""}}var h4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.messageId!==""&&t.uint32(18).string(e.messageId),e.delta!==""&&t.uint32(26).string(e.delta),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=_j();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.messageId=n.string();continue}case 3:{if(u!==26)break;a.delta=n.string();continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return h4.fromPartial(e??{})},fromPartial(e){var t,n;const r=_j();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,r.messageId=(t=e.messageId)!=null?t:"",r.delta=(n=e.delta)!=null?n:"",r}};function yj(){return{baseEvent:void 0,messageId:""}}var f4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.messageId!==""&&t.uint32(18).string(e.messageId),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=yj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.messageId=n.string();continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return f4.fromPartial(e??{})},fromPartial(e){var t;const n=yj();return n.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,n.messageId=(t=e.messageId)!=null?t:"",n}};function vj(){return{baseEvent:void 0,toolCallId:"",toolCallName:"",parentMessageId:void 0}}var p4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.toolCallId!==""&&t.uint32(18).string(e.toolCallId),e.toolCallName!==""&&t.uint32(26).string(e.toolCallName),e.parentMessageId!==void 0&&t.uint32(34).string(e.parentMessageId),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=vj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.toolCallId=n.string();continue}case 3:{if(u!==26)break;a.toolCallName=n.string();continue}case 4:{if(u!==34)break;a.parentMessageId=n.string();continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return p4.fromPartial(e??{})},fromPartial(e){var t,n,r;const a=vj();return a.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,a.toolCallId=(t=e.toolCallId)!=null?t:"",a.toolCallName=(n=e.toolCallName)!=null?n:"",a.parentMessageId=(r=e.parentMessageId)!=null?r:void 0,a}};function xj(){return{baseEvent:void 0,toolCallId:"",delta:""}}var m4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.toolCallId!==""&&t.uint32(18).string(e.toolCallId),e.delta!==""&&t.uint32(26).string(e.delta),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=xj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.toolCallId=n.string();continue}case 3:{if(u!==26)break;a.delta=n.string();continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return m4.fromPartial(e??{})},fromPartial(e){var t,n;const r=xj();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,r.toolCallId=(t=e.toolCallId)!=null?t:"",r.delta=(n=e.delta)!=null?n:"",r}};function bj(){return{baseEvent:void 0,toolCallId:""}}var g4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.toolCallId!==""&&t.uint32(18).string(e.toolCallId),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=bj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.toolCallId=n.string();continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return g4.fromPartial(e??{})},fromPartial(e){var t;const n=bj();return n.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,n.toolCallId=(t=e.toolCallId)!=null?t:"",n}};function wj(){return{baseEvent:void 0,snapshot:void 0}}var _4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.snapshot!==void 0&&ba.encode(ba.wrap(e.snapshot),t.uint32(18).fork()).join(),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=wj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.snapshot=ba.unwrap(ba.decode(n,n.uint32()));continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return _4.fromPartial(e??{})},fromPartial(e){var t;const n=wj();return n.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,n.snapshot=(t=e.snapshot)!=null?t:void 0,n}};function Tj(){return{baseEvent:void 0,delta:[]}}var y4={encode(e,t=new $a){e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join();for(const n of e.delta)o4.encode(n,t.uint32(18).fork()).join();return t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=Tj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.delta.push(o4.decode(n,n.uint32()));continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return y4.fromPartial(e??{})},fromPartial(e){var t;const n=Tj();return n.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,n.delta=((t=e.delta)==null?void 0:t.map(r=>o4.fromPartial(r)))||[],n}};function Ej(){return{baseEvent:void 0,messages:[]}}var v4={encode(e,t=new $a){e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join();for(const n of e.messages)c4.encode(n,t.uint32(18).fork()).join();return t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=Ej();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.messages.push(c4.decode(n,n.uint32()));continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return v4.fromPartial(e??{})},fromPartial(e){var t;const n=Ej();return n.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,n.messages=((t=e.messages)==null?void 0:t.map(r=>c4.fromPartial(r)))||[],n}};function Sj(){return{baseEvent:void 0,event:void 0,source:void 0}}var x4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.event!==void 0&&ba.encode(ba.wrap(e.event),t.uint32(18).fork()).join(),e.source!==void 0&&t.uint32(26).string(e.source),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=Sj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.event=ba.unwrap(ba.decode(n,n.uint32()));continue}case 3:{if(u!==26)break;a.source=n.string();continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return x4.fromPartial(e??{})},fromPartial(e){var t,n;const r=Sj();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,r.event=(t=e.event)!=null?t:void 0,r.source=(n=e.source)!=null?n:void 0,r}};function Aj(){return{baseEvent:void 0,name:"",value:void 0}}var b4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.name!==""&&t.uint32(18).string(e.name),e.value!==void 0&&ba.encode(ba.wrap(e.value),t.uint32(26).fork()).join(),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=Aj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.name=n.string();continue}case 3:{if(u!==26)break;a.value=ba.unwrap(ba.decode(n,n.uint32()));continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return b4.fromPartial(e??{})},fromPartial(e){var t,n;const r=Aj();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,r.name=(t=e.name)!=null?t:"",r.value=(n=e.value)!=null?n:void 0,r}};function Cj(){return{baseEvent:void 0,threadId:"",runId:""}}var w4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.threadId!==""&&t.uint32(18).string(e.threadId),e.runId!==""&&t.uint32(26).string(e.runId),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=Cj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.threadId=n.string();continue}case 3:{if(u!==26)break;a.runId=n.string();continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return w4.fromPartial(e??{})},fromPartial(e){var t,n;const r=Cj();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,r.threadId=(t=e.threadId)!=null?t:"",r.runId=(n=e.runId)!=null?n:"",r}};function kj(){return{baseEvent:void 0,threadId:"",runId:"",result:void 0}}var T4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.threadId!==""&&t.uint32(18).string(e.threadId),e.runId!==""&&t.uint32(26).string(e.runId),e.result!==void 0&&ba.encode(ba.wrap(e.result),t.uint32(34).fork()).join(),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=kj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.threadId=n.string();continue}case 3:{if(u!==26)break;a.runId=n.string();continue}case 4:{if(u!==34)break;a.result=ba.unwrap(ba.decode(n,n.uint32()));continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return T4.fromPartial(e??{})},fromPartial(e){var t,n,r;const a=kj();return a.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,a.threadId=(t=e.threadId)!=null?t:"",a.runId=(n=e.runId)!=null?n:"",a.result=(r=e.result)!=null?r:void 0,a}};function Ij(){return{baseEvent:void 0,code:void 0,message:""}}var E4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.code!==void 0&&t.uint32(18).string(e.code),e.message!==""&&t.uint32(26).string(e.message),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=Ij();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.code=n.string();continue}case 3:{if(u!==26)break;a.message=n.string();continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return E4.fromPartial(e??{})},fromPartial(e){var t,n;const r=Ij();return r.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,r.code=(t=e.code)!=null?t:void 0,r.message=(n=e.message)!=null?n:"",r}};function Rj(){return{baseEvent:void 0,stepName:""}}var S4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.stepName!==""&&t.uint32(18).string(e.stepName),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=Rj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.stepName=n.string();continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return S4.fromPartial(e??{})},fromPartial(e){var t;const n=Rj();return n.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,n.stepName=(t=e.stepName)!=null?t:"",n}};function Mj(){return{baseEvent:void 0,stepName:""}}var A4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.stepName!==""&&t.uint32(18).string(e.stepName),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=Mj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.stepName=n.string();continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return A4.fromPartial(e??{})},fromPartial(e){var t;const n=Mj();return n.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,n.stepName=(t=e.stepName)!=null?t:"",n}};function Pj(){return{baseEvent:void 0,messageId:void 0,role:void 0,delta:void 0}}var C4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.messageId!==void 0&&t.uint32(18).string(e.messageId),e.role!==void 0&&t.uint32(26).string(e.role),e.delta!==void 0&&t.uint32(34).string(e.delta),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=Pj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.messageId=n.string();continue}case 3:{if(u!==26)break;a.role=n.string();continue}case 4:{if(u!==34)break;a.delta=n.string();continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return C4.fromPartial(e??{})},fromPartial(e){var t,n,r;const a=Pj();return a.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,a.messageId=(t=e.messageId)!=null?t:void 0,a.role=(n=e.role)!=null?n:void 0,a.delta=(r=e.delta)!=null?r:void 0,a}};function Oj(){return{baseEvent:void 0,toolCallId:void 0,toolCallName:void 0,parentMessageId:void 0,delta:void 0}}var k4={encode(e,t=new $a){return e.baseEvent!==void 0&&ki.encode(e.baseEvent,t.uint32(10).fork()).join(),e.toolCallId!==void 0&&t.uint32(18).string(e.toolCallId),e.toolCallName!==void 0&&t.uint32(26).string(e.toolCallName),e.parentMessageId!==void 0&&t.uint32(34).string(e.parentMessageId),e.delta!==void 0&&t.uint32(42).string(e.delta),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=Oj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.baseEvent=ki.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.toolCallId=n.string();continue}case 3:{if(u!==26)break;a.toolCallName=n.string();continue}case 4:{if(u!==34)break;a.parentMessageId=n.string();continue}case 5:{if(u!==42)break;a.delta=n.string();continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return k4.fromPartial(e??{})},fromPartial(e){var t,n,r,a;const u=Oj();return u.baseEvent=e.baseEvent!==void 0&&e.baseEvent!==null?ki.fromPartial(e.baseEvent):void 0,u.toolCallId=(t=e.toolCallId)!=null?t:void 0,u.toolCallName=(n=e.toolCallName)!=null?n:void 0,u.parentMessageId=(r=e.parentMessageId)!=null?r:void 0,u.delta=(a=e.delta)!=null?a:void 0,u}};function Lj(){return{textMessageStart:void 0,textMessageContent:void 0,textMessageEnd:void 0,toolCallStart:void 0,toolCallArgs:void 0,toolCallEnd:void 0,stateSnapshot:void 0,stateDelta:void 0,messagesSnapshot:void 0,raw:void 0,custom:void 0,runStarted:void 0,runFinished:void 0,runError:void 0,stepStarted:void 0,stepFinished:void 0,textMessageChunk:void 0,toolCallChunk:void 0}}var fX={encode(e,t=new $a){return e.textMessageStart!==void 0&&d4.encode(e.textMessageStart,t.uint32(10).fork()).join(),e.textMessageContent!==void 0&&h4.encode(e.textMessageContent,t.uint32(18).fork()).join(),e.textMessageEnd!==void 0&&f4.encode(e.textMessageEnd,t.uint32(26).fork()).join(),e.toolCallStart!==void 0&&p4.encode(e.toolCallStart,t.uint32(34).fork()).join(),e.toolCallArgs!==void 0&&m4.encode(e.toolCallArgs,t.uint32(42).fork()).join(),e.toolCallEnd!==void 0&&g4.encode(e.toolCallEnd,t.uint32(50).fork()).join(),e.stateSnapshot!==void 0&&_4.encode(e.stateSnapshot,t.uint32(58).fork()).join(),e.stateDelta!==void 0&&y4.encode(e.stateDelta,t.uint32(66).fork()).join(),e.messagesSnapshot!==void 0&&v4.encode(e.messagesSnapshot,t.uint32(74).fork()).join(),e.raw!==void 0&&x4.encode(e.raw,t.uint32(82).fork()).join(),e.custom!==void 0&&b4.encode(e.custom,t.uint32(90).fork()).join(),e.runStarted!==void 0&&w4.encode(e.runStarted,t.uint32(98).fork()).join(),e.runFinished!==void 0&&T4.encode(e.runFinished,t.uint32(106).fork()).join(),e.runError!==void 0&&E4.encode(e.runError,t.uint32(114).fork()).join(),e.stepStarted!==void 0&&S4.encode(e.stepStarted,t.uint32(122).fork()).join(),e.stepFinished!==void 0&&A4.encode(e.stepFinished,t.uint32(130).fork()).join(),e.textMessageChunk!==void 0&&C4.encode(e.textMessageChunk,t.uint32(138).fork()).join(),e.toolCallChunk!==void 0&&k4.encode(e.toolCallChunk,t.uint32(146).fork()).join(),t},decode(e,t){const n=e instanceof Si?e:new Si(e),r=t===void 0?n.len:n.pos+t,a=Lj();for(;n.pos<r;){const u=n.uint32();switch(u>>>3){case 1:{if(u!==10)break;a.textMessageStart=d4.decode(n,n.uint32());continue}case 2:{if(u!==18)break;a.textMessageContent=h4.decode(n,n.uint32());continue}case 3:{if(u!==26)break;a.textMessageEnd=f4.decode(n,n.uint32());continue}case 4:{if(u!==34)break;a.toolCallStart=p4.decode(n,n.uint32());continue}case 5:{if(u!==42)break;a.toolCallArgs=m4.decode(n,n.uint32());continue}case 6:{if(u!==50)break;a.toolCallEnd=g4.decode(n,n.uint32());continue}case 7:{if(u!==58)break;a.stateSnapshot=_4.decode(n,n.uint32());continue}case 8:{if(u!==66)break;a.stateDelta=y4.decode(n,n.uint32());continue}case 9:{if(u!==74)break;a.messagesSnapshot=v4.decode(n,n.uint32());continue}case 10:{if(u!==82)break;a.raw=x4.decode(n,n.uint32());continue}case 11:{if(u!==90)break;a.custom=b4.decode(n,n.uint32());continue}case 12:{if(u!==98)break;a.runStarted=w4.decode(n,n.uint32());continue}case 13:{if(u!==106)break;a.runFinished=T4.decode(n,n.uint32());continue}case 14:{if(u!==114)break;a.runError=E4.decode(n,n.uint32());continue}case 15:{if(u!==122)break;a.stepStarted=S4.decode(n,n.uint32());continue}case 16:{if(u!==130)break;a.stepFinished=A4.decode(n,n.uint32());continue}case 17:{if(u!==138)break;a.textMessageChunk=C4.decode(n,n.uint32());continue}case 18:{if(u!==146)break;a.toolCallChunk=k4.decode(n,n.uint32());continue}}if((u&7)===4||u===0)break;n.skip(u&7)}return a},create(e){return fX.fromPartial(e??{})},fromPartial(e){const t=Lj();return t.textMessageStart=e.textMessageStart!==void 0&&e.textMessageStart!==null?d4.fromPartial(e.textMessageStart):void 0,t.textMessageContent=e.textMessageContent!==void 0&&e.textMessageContent!==null?h4.fromPartial(e.textMessageContent):void 0,t.textMessageEnd=e.textMessageEnd!==void 0&&e.textMessageEnd!==null?f4.fromPartial(e.textMessageEnd):void 0,t.toolCallStart=e.toolCallStart!==void 0&&e.toolCallStart!==null?p4.fromPartial(e.toolCallStart):void 0,t.toolCallArgs=e.toolCallArgs!==void 0&&e.toolCallArgs!==null?m4.fromPartial(e.toolCallArgs):void 0,t.toolCallEnd=e.toolCallEnd!==void 0&&e.toolCallEnd!==null?g4.fromPartial(e.toolCallEnd):void 0,t.stateSnapshot=e.stateSnapshot!==void 0&&e.stateSnapshot!==null?_4.fromPartial(e.stateSnapshot):void 0,t.stateDelta=e.stateDelta!==void 0&&e.stateDelta!==null?y4.fromPartial(e.stateDelta):void 0,t.messagesSnapshot=e.messagesSnapshot!==void 0&&e.messagesSnapshot!==null?v4.fromPartial(e.messagesSnapshot):void 0,t.raw=e.raw!==void 0&&e.raw!==null?x4.fromPartial(e.raw):void 0,t.custom=e.custom!==void 0&&e.custom!==null?b4.fromPartial(e.custom):void 0,t.runStarted=e.runStarted!==void 0&&e.runStarted!==null?w4.fromPartial(e.runStarted):void 0,t.runFinished=e.runFinished!==void 0&&e.runFinished!==null?T4.fromPartial(e.runFinished):void 0,t.runError=e.runError!==void 0&&e.runError!==null?E4.fromPartial(e.runError):void 0,t.stepStarted=e.stepStarted!==void 0&&e.stepStarted!==null?S4.fromPartial(e.stepStarted):void 0,t.stepFinished=e.stepFinished!==void 0&&e.stepFinished!==null?A4.fromPartial(e.stepFinished):void 0,t.textMessageChunk=e.textMessageChunk!==void 0&&e.textMessageChunk!==null?C4.fromPartial(e.textMessageChunk):void 0,t.toolCallChunk=e.toolCallChunk!==void 0&&e.toolCallChunk!==null?k4.fromPartial(e.toolCallChunk):void 0,t}};function kpe(e){const t=globalThis.Number(e.toString());if(t>globalThis.Number.MAX_SAFE_INTEGER)throw new globalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");if(t<globalThis.Number.MIN_SAFE_INTEGER)throw new globalThis.Error("Value is smaller than Number.MIN_SAFE_INTEGER");return t}function Ipe(e){var t;const n=fX.decode(e),r=Object.values(n).find(a=>a!==void 0);if(!r)throw new Error("Invalid event");if(r.type=hX[r.baseEvent.type],r.timestamp=r.baseEvent.timestamp,r.rawEvent=r.baseEvent.rawEvent,r.type===Hn.MESSAGES_SNAPSHOT)for(const a of r.messages){const u=a;((t=u.toolCalls)==null?void 0:t.length)===0&&(u.toolCalls=void 0)}if(r.type===Hn.STATE_DELTA)for(const a of r.delta)a.op=dX[a.op].toLowerCase(),Object.keys(a).forEach(u=>{a[u]===void 0&&delete a[u]});return Object.keys(r).forEach(a=>{r[a]===void 0&&delete r[a]}),zZ.parse(r)}var Rpe="application/vnd.ag-ui.event+proto",ya;(function(e){e.assertEqual=a=>{};function t(a){}e.assertIs=t;function n(a){throw new Error}e.assertNever=n,e.arrayToEnum=a=>{const u={};for(const f of a)u[f]=f;return u},e.getValidEnumValues=a=>{const u=e.objectKeys(a).filter(s=>typeof a[a[s]]!="number"),f={};for(const s of u)f[s]=a[s];return e.objectValues(f)},e.objectValues=a=>e.objectKeys(a).map(function(u){return a[u]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const u=[];for(const f in a)Object.prototype.hasOwnProperty.call(a,f)&&u.push(f);return u},e.find=(a,u)=>{for(const f of a)if(u(f))return f},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,u=" | "){return a.map(f=>typeof f=="string"?`'${f}'`:f).join(u)}e.joinValues=r,e.jsonStringifyReplacer=(a,u)=>typeof u=="bigint"?u.toString():u})(ya||(ya={}));var Dj;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(Dj||(Dj={}));const ai=ya.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),bm=e=>{switch(typeof e){case"undefined":return ai.undefined;case"string":return ai.string;case"number":return Number.isNaN(e)?ai.nan:ai.number;case"boolean":return ai.boolean;case"function":return ai.function;case"bigint":return ai.bigint;case"symbol":return ai.symbol;case"object":return Array.isArray(e)?ai.array:e===null?ai.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?ai.promise:typeof Map<"u"&&e instanceof Map?ai.map:typeof Set<"u"&&e instanceof Set?ai.set:typeof Date<"u"&&e instanceof Date?ai.date:ai.object;default:return ai.unknown}},mr=ya.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);let l_=class pX extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(u){return u.message},r={_errors:[]},a=u=>{for(const f of u.issues)if(f.code==="invalid_union")f.unionErrors.map(a);else if(f.code==="invalid_return_type")a(f.returnTypeError);else if(f.code==="invalid_arguments")a(f.argumentsError);else if(f.path.length===0)r._errors.push(n(f));else{let s=r,v=0;for(;v<f.path.length;){const x=f.path[v];v===f.path.length-1?(s[x]=s[x]||{_errors:[]},s[x]._errors.push(n(f))):s[x]=s[x]||{_errors:[]},s=s[x],v++}}};return a(this),r}static assert(t){if(!(t instanceof pX))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ya.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const a of this.issues)if(a.path.length>0){const u=a.path[0];n[u]=n[u]||[],n[u].push(t(a))}else r.push(t(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}};l_.create=e=>new l_(e);const gP=(e,t)=>{let n;switch(e.code){case mr.invalid_type:e.received===ai.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case mr.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,ya.jsonStringifyReplacer)}`;break;case mr.unrecognized_keys:n=`Unrecognized key(s) in object: ${ya.joinValues(e.keys,", ")}`;break;case mr.invalid_union:n="Invalid input";break;case mr.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${ya.joinValues(e.options)}`;break;case mr.invalid_enum_value:n=`Invalid enum value. Expected ${ya.joinValues(e.options)}, received '${e.received}'`;break;case mr.invalid_arguments:n="Invalid function arguments";break;case mr.invalid_return_type:n="Invalid function return type";break;case mr.invalid_date:n="Invalid date";break;case mr.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:ya.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case mr.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case mr.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case mr.custom:n="Invalid input";break;case mr.invalid_intersection_types:n="Intersection results could not be merged";break;case mr.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case mr.not_finite:n="Number must be finite";break;default:n=t.defaultError,ya.assertNever(e)}return{message:n}};let Mpe=gP;function Ppe(){return Mpe}const Ope=e=>{const{data:t,path:n,errorMaps:r,issueData:a}=e,u=[...n,...a.path||[]],f={...a,path:u};if(a.message!==void 0)return{...a,path:u,message:a.message};let s="";const v=r.filter(x=>!!x).slice().reverse();for(const x of v)s=x(f,{data:t,defaultError:s}).message;return{...a,path:u,message:s}};function Br(e,t){const n=Ppe(),r=Ope({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===gP?void 0:gP].filter(a=>!!a)});e.common.issues.push(r)}let ah=class mX{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const a of n){if(a.status==="aborted")return us;a.status==="dirty"&&t.dirty(),r.push(a.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const a of n){const u=await a.key,f=await a.value;r.push({key:u,value:f})}return mX.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const a of n){const{key:u,value:f}=a;if(u.status==="aborted"||f.status==="aborted")return us;u.status==="dirty"&&t.dirty(),f.status==="dirty"&&t.dirty(),u.value!=="__proto__"&&(typeof f.value<"u"||a.alwaysSet)&&(r[u.value]=f.value)}return{status:t.value,value:r}}};const us=Object.freeze({status:"aborted"}),Vw=e=>({status:"dirty",value:e}),_d=e=>({status:"valid",value:e}),Nj=e=>e.status==="aborted",zj=e=>e.status==="dirty",Lv=e=>e.status==="valid",DA=e=>typeof Promise<"u"&&e instanceof Promise;var mi;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(mi||(mi={}));let s0=class{constructor(t,n,r,a){this._cachedPath=[],this.parent=t,this.data=n,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};const Fj=(e,t)=>{if(Lv(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new l_(e.common.issues);return this._error=n,this._error}}};function $s(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:a}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(f,s)=>{const{message:v}=e;return f.code==="invalid_enum_value"?{message:v??s.defaultError}:typeof s.data>"u"?{message:v??r??s.defaultError}:f.code!=="invalid_type"?{message:s.defaultError}:{message:v??n??s.defaultError}},description:a}}let ma=class{get description(){return this._def.description}_getType(t){return bm(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:bm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new ah,ctx:{common:t.parent.common,data:t.data,parsedType:bm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(DA(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){const r={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:bm(t)},a=this._parseSync({data:t,path:r.path,parent:r});return Fj(r,a)}"~validate"(t){var r,a;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:bm(t)};if(!this["~standard"].async)try{const u=this._parseSync({data:t,path:[],parent:n});return Lv(u)?{value:u.value}:{issues:n.common.issues}}catch(u){(a=(r=u==null?void 0:u.message)==null?void 0:r.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:n}).then(u=>Lv(u)?{value:u.value}:{issues:n.common.issues})}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:bm(t)},a=this._parse({data:t,path:r.path,parent:r}),u=await(DA(a)?a:Promise.resolve(a));return Fj(r,u)}refine(t,n){const r=a=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,u)=>{const f=t(a),s=()=>u.addIssue({code:mr.custom,...r(a)});return typeof Promise<"u"&&f instanceof Promise?f.then(v=>v?!0:(s(),!1)):f?!0:(s(),!1)})}refinement(t,n){return this._refinement((r,a)=>t(r)?!0:(a.addIssue(typeof n=="function"?n(r,a):n),!1))}_refinement(t){return new u_({schema:this,typeName:fs.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return ap.create(this,this._def)}nullable(){return c_.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Dv.create(this)}promise(){return BA.create(this,this._def)}or(t){return NA.create([this,t],this._def)}and(t){return zA.create(this,t,this._def)}transform(t){return new u_({...$s(this._def),schema:this,typeName:fs.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new jA({...$s(this._def),innerType:this,defaultValue:n,typeName:fs.ZodDefault})}brand(){return new bX({typeName:fs.ZodBranded,type:this,...$s(this._def)})}catch(t){const n=typeof t=="function"?t:()=>t;return new UA({...$s(this._def),innerType:this,catchValue:n,typeName:fs.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return nme.create(this,t)}readonly(){return VA.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const Lpe=/^c[^\s-]{8,}$/i,Dpe=/^[0-9a-z]+$/,Npe=/^[0-9A-HJKMNP-TV-Z]{26}$/i,zpe=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Fpe=/^[a-z0-9_-]{21}$/i,Bpe=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,jpe=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Upe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Vpe="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let y5;const $pe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Hpe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Gpe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,qpe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Wpe=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Zpe=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,gX="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Xpe=new RegExp(`^${gX}$`);function _X(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function Ype(e){return new RegExp(`^${_X(e)}$`)}function Kpe(e){let t=`${gX}T${_X(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function Qpe(e,t){return!!((t==="v4"||!t)&&$pe.test(e)||(t==="v6"||!t)&&Gpe.test(e))}function Jpe(e,t){if(!Bpe.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||t&&a.alg!==t)}catch{return!1}}function eme(e,t){return!!((t==="v4"||!t)&&Hpe.test(e)||(t==="v6"||!t)&&qpe.test(e))}let _P=class $w extends ma{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==ai.string){const u=this._getOrReturnCtx(t);return Br(u,{code:mr.invalid_type,expected:ai.string,received:u.parsedType}),us}const r=new ah;let a;for(const u of this._def.checks)if(u.kind==="min")t.data.length<u.value&&(a=this._getOrReturnCtx(t,a),Br(a,{code:mr.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),r.dirty());else if(u.kind==="max")t.data.length>u.value&&(a=this._getOrReturnCtx(t,a),Br(a,{code:mr.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),r.dirty());else if(u.kind==="length"){const f=t.data.length>u.value,s=t.data.length<u.value;(f||s)&&(a=this._getOrReturnCtx(t,a),f?Br(a,{code:mr.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}):s&&Br(a,{code:mr.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}),r.dirty())}else if(u.kind==="email")Upe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"email",code:mr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="emoji")y5||(y5=new RegExp(Vpe,"u")),y5.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"emoji",code:mr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="uuid")zpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"uuid",code:mr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="nanoid")Fpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"nanoid",code:mr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="cuid")Lpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"cuid",code:mr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="cuid2")Dpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"cuid2",code:mr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="ulid")Npe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"ulid",code:mr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),Br(a,{validation:"url",code:mr.invalid_string,message:u.message}),r.dirty()}else u.kind==="regex"?(u.regex.lastIndex=0,u.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"regex",code:mr.invalid_string,message:u.message}),r.dirty())):u.kind==="trim"?t.data=t.data.trim():u.kind==="includes"?t.data.includes(u.value,u.position)||(a=this._getOrReturnCtx(t,a),Br(a,{code:mr.invalid_string,validation:{includes:u.value,position:u.position},message:u.message}),r.dirty()):u.kind==="toLowerCase"?t.data=t.data.toLowerCase():u.kind==="toUpperCase"?t.data=t.data.toUpperCase():u.kind==="startsWith"?t.data.startsWith(u.value)||(a=this._getOrReturnCtx(t,a),Br(a,{code:mr.invalid_string,validation:{startsWith:u.value},message:u.message}),r.dirty()):u.kind==="endsWith"?t.data.endsWith(u.value)||(a=this._getOrReturnCtx(t,a),Br(a,{code:mr.invalid_string,validation:{endsWith:u.value},message:u.message}),r.dirty()):u.kind==="datetime"?Kpe(u).test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{code:mr.invalid_string,validation:"datetime",message:u.message}),r.dirty()):u.kind==="date"?Xpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{code:mr.invalid_string,validation:"date",message:u.message}),r.dirty()):u.kind==="time"?Ype(u).test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{code:mr.invalid_string,validation:"time",message:u.message}),r.dirty()):u.kind==="duration"?jpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"duration",code:mr.invalid_string,message:u.message}),r.dirty()):u.kind==="ip"?Qpe(t.data,u.version)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"ip",code:mr.invalid_string,message:u.message}),r.dirty()):u.kind==="jwt"?Jpe(t.data,u.alg)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"jwt",code:mr.invalid_string,message:u.message}),r.dirty()):u.kind==="cidr"?eme(t.data,u.version)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"cidr",code:mr.invalid_string,message:u.message}),r.dirty()):u.kind==="base64"?Wpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"base64",code:mr.invalid_string,message:u.message}),r.dirty()):u.kind==="base64url"?Zpe.test(t.data)||(a=this._getOrReturnCtx(t,a),Br(a,{validation:"base64url",code:mr.invalid_string,message:u.message}),r.dirty()):ya.assertNever(u);return{status:r.value,value:t.data}}_regex(t,n,r){return this.refinement(a=>t.test(a),{validation:n,code:mr.invalid_string,...mi.errToObj(r)})}_addCheck(t){return new $w({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...mi.errToObj(t)})}url(t){return this._addCheck({kind:"url",...mi.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...mi.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...mi.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...mi.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...mi.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...mi.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...mi.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...mi.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...mi.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...mi.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...mi.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...mi.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...mi.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...mi.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...mi.errToObj(t)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...mi.errToObj(n)})}includes(t,n){return this._addCheck({kind:"includes",value:t,position:n==null?void 0:n.position,...mi.errToObj(n==null?void 0:n.message)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...mi.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...mi.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...mi.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...mi.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...mi.errToObj(n)})}nonempty(t){return this.min(1,mi.errToObj(t))}trim(){return new $w({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new $w({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new $w({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}};_P.create=e=>new _P({checks:[],typeName:fs.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...$s(e)});function tme(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,a=n>r?n:r,u=Number.parseInt(e.toFixed(a).replace(".","")),f=Number.parseInt(t.toFixed(a).replace(".",""));return u%f/10**a}let Bj=class yP extends ma{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==ai.number){const u=this._getOrReturnCtx(t);return Br(u,{code:mr.invalid_type,expected:ai.number,received:u.parsedType}),us}let r;const a=new ah;for(const u of this._def.checks)u.kind==="int"?ya.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),Br(r,{code:mr.invalid_type,expected:"integer",received:"float",message:u.message}),a.dirty()):u.kind==="min"?(u.inclusive?t.data<u.value:t.data<=u.value)&&(r=this._getOrReturnCtx(t,r),Br(r,{code:mr.too_small,minimum:u.value,type:"number",inclusive:u.inclusive,exact:!1,message:u.message}),a.dirty()):u.kind==="max"?(u.inclusive?t.data>u.value:t.data>=u.value)&&(r=this._getOrReturnCtx(t,r),Br(r,{code:mr.too_big,maximum:u.value,type:"number",inclusive:u.inclusive,exact:!1,message:u.message}),a.dirty()):u.kind==="multipleOf"?tme(t.data,u.value)!==0&&(r=this._getOrReturnCtx(t,r),Br(r,{code:mr.not_multiple_of,multipleOf:u.value,message:u.message}),a.dirty()):u.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),Br(r,{code:mr.not_finite,message:u.message}),a.dirty()):ya.assertNever(u);return{status:a.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,mi.toString(n))}gt(t,n){return this.setLimit("min",t,!1,mi.toString(n))}lte(t,n){return this.setLimit("max",t,!0,mi.toString(n))}lt(t,n){return this.setLimit("max",t,!1,mi.toString(n))}setLimit(t,n,r,a){return new yP({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:mi.toString(a)}]})}_addCheck(t){return new yP({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:mi.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:mi.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:mi.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:mi.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:mi.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:mi.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:mi.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:mi.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:mi.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&ya.isInteger(t.value))}get isFinite(){let t=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(n)&&Number.isFinite(t)}};Bj.create=e=>new Bj({checks:[],typeName:fs.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...$s(e)});let jj=class vP extends ma{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==ai.bigint)return this._getInvalidInput(t);let r;const a=new ah;for(const u of this._def.checks)u.kind==="min"?(u.inclusive?t.data<u.value:t.data<=u.value)&&(r=this._getOrReturnCtx(t,r),Br(r,{code:mr.too_small,type:"bigint",minimum:u.value,inclusive:u.inclusive,message:u.message}),a.dirty()):u.kind==="max"?(u.inclusive?t.data>u.value:t.data>=u.value)&&(r=this._getOrReturnCtx(t,r),Br(r,{code:mr.too_big,type:"bigint",maximum:u.value,inclusive:u.inclusive,message:u.message}),a.dirty()):u.kind==="multipleOf"?t.data%u.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),Br(r,{code:mr.not_multiple_of,multipleOf:u.value,message:u.message}),a.dirty()):ya.assertNever(u);return{status:a.value,value:t.data}}_getInvalidInput(t){const n=this._getOrReturnCtx(t);return Br(n,{code:mr.invalid_type,expected:ai.bigint,received:n.parsedType}),us}gte(t,n){return this.setLimit("min",t,!0,mi.toString(n))}gt(t,n){return this.setLimit("min",t,!1,mi.toString(n))}lte(t,n){return this.setLimit("max",t,!0,mi.toString(n))}lt(t,n){return this.setLimit("max",t,!1,mi.toString(n))}setLimit(t,n,r,a){return new vP({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:mi.toString(a)}]})}_addCheck(t){return new vP({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:mi.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:mi.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:mi.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:mi.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:mi.toString(n)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}};jj.create=e=>new jj({checks:[],typeName:fs.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...$s(e)});let xP=class extends ma{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==ai.boolean){const r=this._getOrReturnCtx(t);return Br(r,{code:mr.invalid_type,expected:ai.boolean,received:r.parsedType}),us}return _d(t.data)}};xP.create=e=>new xP({typeName:fs.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...$s(e)});let Uj=class yX extends ma{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==ai.date){const u=this._getOrReturnCtx(t);return Br(u,{code:mr.invalid_type,expected:ai.date,received:u.parsedType}),us}if(Number.isNaN(t.data.getTime())){const u=this._getOrReturnCtx(t);return Br(u,{code:mr.invalid_date}),us}const r=new ah;let a;for(const u of this._def.checks)u.kind==="min"?t.data.getTime()<u.value&&(a=this._getOrReturnCtx(t,a),Br(a,{code:mr.too_small,message:u.message,inclusive:!0,exact:!1,minimum:u.value,type:"date"}),r.dirty()):u.kind==="max"?t.data.getTime()>u.value&&(a=this._getOrReturnCtx(t,a),Br(a,{code:mr.too_big,message:u.message,inclusive:!0,exact:!1,maximum:u.value,type:"date"}),r.dirty()):ya.assertNever(u);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new yX({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:mi.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:mi.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}};Uj.create=e=>new Uj({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:fs.ZodDate,...$s(e)});let Vj=class extends ma{_parse(t){if(this._getType(t)!==ai.symbol){const r=this._getOrReturnCtx(t);return Br(r,{code:mr.invalid_type,expected:ai.symbol,received:r.parsedType}),us}return _d(t.data)}};Vj.create=e=>new Vj({typeName:fs.ZodSymbol,...$s(e)});let bP=class extends ma{_parse(t){if(this._getType(t)!==ai.undefined){const r=this._getOrReturnCtx(t);return Br(r,{code:mr.invalid_type,expected:ai.undefined,received:r.parsedType}),us}return _d(t.data)}};bP.create=e=>new bP({typeName:fs.ZodUndefined,...$s(e)});let wP=class extends ma{_parse(t){if(this._getType(t)!==ai.null){const r=this._getOrReturnCtx(t);return Br(r,{code:mr.invalid_type,expected:ai.null,received:r.parsedType}),us}return _d(t.data)}};wP.create=e=>new wP({typeName:fs.ZodNull,...$s(e)});let TP=class extends ma{constructor(){super(...arguments),this._any=!0}_parse(t){return _d(t.data)}};TP.create=e=>new TP({typeName:fs.ZodAny,...$s(e)});let $j=class extends ma{constructor(){super(...arguments),this._unknown=!0}_parse(t){return _d(t.data)}};$j.create=e=>new $j({typeName:fs.ZodUnknown,...$s(e)});let a0=class extends ma{_parse(t){const n=this._getOrReturnCtx(t);return Br(n,{code:mr.invalid_type,expected:ai.never,received:n.parsedType}),us}};a0.create=e=>new a0({typeName:fs.ZodNever,...$s(e)});let Hj=class extends ma{_parse(t){if(this._getType(t)!==ai.undefined){const r=this._getOrReturnCtx(t);return Br(r,{code:mr.invalid_type,expected:ai.void,received:r.parsedType}),us}return _d(t.data)}};Hj.create=e=>new Hj({typeName:fs.ZodVoid,...$s(e)});let Dv=class I4 extends ma{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),a=this._def;if(n.parsedType!==ai.array)return Br(n,{code:mr.invalid_type,expected:ai.array,received:n.parsedType}),us;if(a.exactLength!==null){const f=n.data.length>a.exactLength.value,s=n.data.length<a.exactLength.value;(f||s)&&(Br(n,{code:f?mr.too_big:mr.too_small,minimum:s?a.exactLength.value:void 0,maximum:f?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(Br(n,{code:mr.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(Br(n,{code:mr.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((f,s)=>a.type._parseAsync(new s0(n,f,n.path,s)))).then(f=>ah.mergeArray(r,f));const u=[...n.data].map((f,s)=>a.type._parseSync(new s0(n,f,n.path,s)));return ah.mergeArray(r,u)}get element(){return this._def.type}min(t,n){return new I4({...this._def,minLength:{value:t,message:mi.toString(n)}})}max(t,n){return new I4({...this._def,maxLength:{value:t,message:mi.toString(n)}})}length(t,n){return new I4({...this._def,exactLength:{value:t,message:mi.toString(n)}})}nonempty(t){return this.min(1,t)}};Dv.create=(e,t)=>new Dv({type:e,minLength:null,maxLength:null,exactLength:null,typeName:fs.ZodArray,...$s(t)});function R1(e){if(e instanceof pp){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=ap.create(R1(r))}return new pp({...e._def,shape:()=>t})}else return e instanceof Dv?new Dv({...e._def,type:R1(e.element)}):e instanceof ap?ap.create(R1(e.unwrap())):e instanceof c_?c_.create(R1(e.unwrap())):e instanceof H2?H2.create(e.items.map(t=>R1(t))):e}let pp=class Zd extends ma{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=ya.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==ai.object){const x=this._getOrReturnCtx(t);return Br(x,{code:mr.invalid_type,expected:ai.object,received:x.parsedType}),us}const{status:r,ctx:a}=this._processInputParams(t),{shape:u,keys:f}=this._getCached(),s=[];if(!(this._def.catchall instanceof a0&&this._def.unknownKeys==="strip"))for(const x in a.data)f.includes(x)||s.push(x);const v=[];for(const x of f){const A=u[x],C=a.data[x];v.push({key:{status:"valid",value:x},value:A._parse(new s0(a,C,a.path,x)),alwaysSet:x in a.data})}if(this._def.catchall instanceof a0){const x=this._def.unknownKeys;if(x==="passthrough")for(const A of s)v.push({key:{status:"valid",value:A},value:{status:"valid",value:a.data[A]}});else if(x==="strict")s.length>0&&(Br(a,{code:mr.unrecognized_keys,keys:s}),r.dirty());else if(x!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const x=this._def.catchall;for(const A of s){const C=a.data[A];v.push({key:{status:"valid",value:A},value:x._parse(new s0(a,C,a.path,A)),alwaysSet:A in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const x=[];for(const A of v){const C=await A.key,P=await A.value;x.push({key:C,value:P,alwaysSet:A.alwaysSet})}return x}).then(x=>ah.mergeObjectSync(r,x)):ah.mergeObjectSync(r,v)}get shape(){return this._def.shape()}strict(t){return mi.errToObj,new Zd({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,r)=>{var u,f;const a=((f=(u=this._def).errorMap)==null?void 0:f.call(u,n,r).message)??r.defaultError;return n.code==="unrecognized_keys"?{message:mi.errToObj(t).message??a}:{message:a}}}:{}})}strip(){return new Zd({...this._def,unknownKeys:"strip"})}passthrough(){return new Zd({...this._def,unknownKeys:"passthrough"})}extend(t){return new Zd({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Zd({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:fs.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new Zd({...this._def,catchall:t})}pick(t){const n={};for(const r of ya.objectKeys(t))t[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new Zd({...this._def,shape:()=>n})}omit(t){const n={};for(const r of ya.objectKeys(this.shape))t[r]||(n[r]=this.shape[r]);return new Zd({...this._def,shape:()=>n})}deepPartial(){return R1(this)}partial(t){const n={};for(const r of ya.objectKeys(this.shape)){const a=this.shape[r];t&&!t[r]?n[r]=a:n[r]=a.optional()}return new Zd({...this._def,shape:()=>n})}required(t){const n={};for(const r of ya.objectKeys(this.shape))if(t&&!t[r])n[r]=this.shape[r];else{let u=this.shape[r];for(;u instanceof ap;)u=u._def.innerType;n[r]=u}return new Zd({...this._def,shape:()=>n})}keyof(){return xX(ya.objectKeys(this.shape))}};pp.create=(e,t)=>new pp({shape:()=>e,unknownKeys:"strip",catchall:a0.create(),typeName:fs.ZodObject,...$s(t)});pp.strictCreate=(e,t)=>new pp({shape:()=>e,unknownKeys:"strict",catchall:a0.create(),typeName:fs.ZodObject,...$s(t)});pp.lazycreate=(e,t)=>new pp({shape:e,unknownKeys:"strip",catchall:a0.create(),typeName:fs.ZodObject,...$s(t)});let NA=class extends ma{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function a(u){for(const s of u)if(s.result.status==="valid")return s.result;for(const s of u)if(s.result.status==="dirty")return n.common.issues.push(...s.ctx.common.issues),s.result;const f=u.map(s=>new l_(s.ctx.common.issues));return Br(n,{code:mr.invalid_union,unionErrors:f}),us}if(n.common.async)return Promise.all(r.map(async u=>{const f={...n,common:{...n.common,issues:[]},parent:null};return{result:await u._parseAsync({data:n.data,path:n.path,parent:f}),ctx:f}})).then(a);{let u;const f=[];for(const v of r){const x={...n,common:{...n.common,issues:[]},parent:null},A=v._parseSync({data:n.data,path:n.path,parent:x});if(A.status==="valid")return A;A.status==="dirty"&&!u&&(u={result:A,ctx:x}),x.common.issues.length&&f.push(x.common.issues)}if(u)return n.common.issues.push(...u.ctx.common.issues),u.result;const s=f.map(v=>new l_(v));return Br(n,{code:mr.invalid_union,unionErrors:s}),us}}get options(){return this._def.options}};NA.create=(e,t)=>new NA({options:e,typeName:fs.ZodUnion,...$s(t)});const qf=e=>e instanceof AP?qf(e.schema):e instanceof u_?qf(e.innerType()):e instanceof FA?[e.value]:e instanceof WC?e.options:e instanceof kP?ya.objectValues(e.enum):e instanceof jA?qf(e._def.innerType):e instanceof bP?[void 0]:e instanceof wP?[null]:e instanceof ap?[void 0,...qf(e.unwrap())]:e instanceof c_?[null,...qf(e.unwrap())]:e instanceof bX||e instanceof VA?qf(e.unwrap()):e instanceof UA?qf(e._def.innerType):[];class sL extends ma{_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==ai.object)return Br(n,{code:mr.invalid_type,expected:ai.object,received:n.parsedType}),us;const r=this.discriminator,a=n.data[r],u=this.optionsMap.get(a);return u?n.common.async?u._parseAsync({data:n.data,path:n.path,parent:n}):u._parseSync({data:n.data,path:n.path,parent:n}):(Br(n,{code:mr.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),us)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,n,r){const a=new Map;for(const u of n){const f=qf(u.shape[t]);if(!f.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const s of f){if(a.has(s))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(s)}`);a.set(s,u)}}return new sL({typeName:fs.ZodDiscriminatedUnion,discriminator:t,options:n,optionsMap:a,...$s(r)})}}function EP(e,t){const n=bm(e),r=bm(t);if(e===t)return{valid:!0,data:e};if(n===ai.object&&r===ai.object){const a=ya.objectKeys(t),u=ya.objectKeys(e).filter(s=>a.indexOf(s)!==-1),f={...e,...t};for(const s of u){const v=EP(e[s],t[s]);if(!v.valid)return{valid:!1};f[s]=v.data}return{valid:!0,data:f}}else if(n===ai.array&&r===ai.array){if(e.length!==t.length)return{valid:!1};const a=[];for(let u=0;u<e.length;u++){const f=e[u],s=t[u],v=EP(f,s);if(!v.valid)return{valid:!1};a.push(v.data)}return{valid:!0,data:a}}else return n===ai.date&&r===ai.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}let zA=class extends ma{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=(u,f)=>{if(Nj(u)||Nj(f))return us;const s=EP(u.value,f.value);return s.valid?((zj(u)||zj(f))&&n.dirty(),{status:n.value,value:s.data}):(Br(r,{code:mr.invalid_intersection_types}),us)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([u,f])=>a(u,f)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};zA.create=(e,t,n)=>new zA({left:e,right:t,typeName:fs.ZodIntersection,...$s(n)});let H2=class vX extends ma{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==ai.array)return Br(r,{code:mr.invalid_type,expected:ai.array,received:r.parsedType}),us;if(r.data.length<this._def.items.length)return Br(r,{code:mr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),us;!this._def.rest&&r.data.length>this._def.items.length&&(Br(r,{code:mr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const u=[...r.data].map((f,s)=>{const v=this._def.items[s]||this._def.rest;return v?v._parse(new s0(r,f,r.path,s)):null}).filter(f=>!!f);return r.common.async?Promise.all(u).then(f=>ah.mergeArray(n,f)):ah.mergeArray(n,u)}get items(){return this._def.items}rest(t){return new vX({...this._def,rest:t})}};H2.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new H2({items:e,typeName:fs.ZodTuple,rest:null,...$s(t)})};let Gj=class extends ma{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==ai.map)return Br(r,{code:mr.invalid_type,expected:ai.map,received:r.parsedType}),us;const a=this._def.keyType,u=this._def.valueType,f=[...r.data.entries()].map(([s,v],x)=>({key:a._parse(new s0(r,s,r.path,[x,"key"])),value:u._parse(new s0(r,v,r.path,[x,"value"]))}));if(r.common.async){const s=new Map;return Promise.resolve().then(async()=>{for(const v of f){const x=await v.key,A=await v.value;if(x.status==="aborted"||A.status==="aborted")return us;(x.status==="dirty"||A.status==="dirty")&&n.dirty(),s.set(x.value,A.value)}return{status:n.value,value:s}})}else{const s=new Map;for(const v of f){const x=v.key,A=v.value;if(x.status==="aborted"||A.status==="aborted")return us;(x.status==="dirty"||A.status==="dirty")&&n.dirty(),s.set(x.value,A.value)}return{status:n.value,value:s}}}};Gj.create=(e,t,n)=>new Gj({valueType:t,keyType:e,typeName:fs.ZodMap,...$s(n)});let qj=class SP extends ma{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==ai.set)return Br(r,{code:mr.invalid_type,expected:ai.set,received:r.parsedType}),us;const a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(Br(r,{code:mr.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(Br(r,{code:mr.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());const u=this._def.valueType;function f(v){const x=new Set;for(const A of v){if(A.status==="aborted")return us;A.status==="dirty"&&n.dirty(),x.add(A.value)}return{status:n.value,value:x}}const s=[...r.data.values()].map((v,x)=>u._parse(new s0(r,v,r.path,x)));return r.common.async?Promise.all(s).then(v=>f(v)):f(s)}min(t,n){return new SP({...this._def,minSize:{value:t,message:mi.toString(n)}})}max(t,n){return new SP({...this._def,maxSize:{value:t,message:mi.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}};qj.create=(e,t)=>new qj({valueType:e,minSize:null,maxSize:null,typeName:fs.ZodSet,...$s(t)});let AP=class extends ma{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}};AP.create=(e,t)=>new AP({getter:e,typeName:fs.ZodLazy,...$s(t)});let FA=class extends ma{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return Br(n,{received:n.data,code:mr.invalid_literal,expected:this._def.value}),us}return{status:"valid",value:t.data}}get value(){return this._def.value}};FA.create=(e,t)=>new FA({value:e,typeName:fs.ZodLiteral,...$s(t)});function xX(e,t){return new WC({values:e,typeName:fs.ZodEnum,...$s(t)})}let WC=class CP extends ma{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return Br(n,{expected:ya.joinValues(r),received:n.parsedType,code:mr.invalid_type}),us}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const n=this._getOrReturnCtx(t),r=this._def.values;return Br(n,{received:n.data,code:mr.invalid_enum_value,options:r}),us}return _d(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return CP.create(t,{...this._def,...n})}exclude(t,n=this._def){return CP.create(this.options.filter(r=>!t.includes(r)),{...this._def,...n})}};WC.create=xX;let kP=class extends ma{_parse(t){const n=ya.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==ai.string&&r.parsedType!==ai.number){const a=ya.objectValues(n);return Br(r,{expected:ya.joinValues(a),received:r.parsedType,code:mr.invalid_type}),us}if(this._cache||(this._cache=new Set(ya.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const a=ya.objectValues(n);return Br(r,{received:r.data,code:mr.invalid_enum_value,options:a}),us}return _d(t.data)}get enum(){return this._def.values}};kP.create=(e,t)=>new kP({values:e,typeName:fs.ZodNativeEnum,...$s(t)});let BA=class extends ma{unwrap(){return this._def.type}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==ai.promise&&n.common.async===!1)return Br(n,{code:mr.invalid_type,expected:ai.promise,received:n.parsedType}),us;const r=n.parsedType===ai.promise?n.data:Promise.resolve(n.data);return _d(r.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}};BA.create=(e,t)=>new BA({type:e,typeName:fs.ZodPromise,...$s(t)});let u_=class extends ma{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===fs.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=this._def.effect||null,u={addIssue:f=>{Br(r,f),f.fatal?n.abort():n.dirty()},get path(){return r.path}};if(u.addIssue=u.addIssue.bind(u),a.type==="preprocess"){const f=a.transform(r.data,u);if(r.common.async)return Promise.resolve(f).then(async s=>{if(n.value==="aborted")return us;const v=await this._def.schema._parseAsync({data:s,path:r.path,parent:r});return v.status==="aborted"?us:v.status==="dirty"||n.value==="dirty"?Vw(v.value):v});{if(n.value==="aborted")return us;const s=this._def.schema._parseSync({data:f,path:r.path,parent:r});return s.status==="aborted"?us:s.status==="dirty"||n.value==="dirty"?Vw(s.value):s}}if(a.type==="refinement"){const f=s=>{const v=a.refinement(s,u);if(r.common.async)return Promise.resolve(v);if(v instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(r.common.async===!1){const s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?us:(s.status==="dirty"&&n.dirty(),f(s.value),{status:n.value,value:s.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(s=>s.status==="aborted"?us:(s.status==="dirty"&&n.dirty(),f(s.value).then(()=>({status:n.value,value:s.value}))))}if(a.type==="transform")if(r.common.async===!1){const f=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Lv(f))return us;const s=a.transform(f.value,u);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:s}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(f=>Lv(f)?Promise.resolve(a.transform(f.value,u)).then(s=>({status:n.value,value:s})):us);ya.assertNever(a)}};u_.create=(e,t,n)=>new u_({schema:e,typeName:fs.ZodEffects,effect:t,...$s(n)});u_.createWithPreprocess=(e,t,n)=>new u_({schema:t,effect:{type:"preprocess",transform:e},typeName:fs.ZodEffects,...$s(n)});let ap=class extends ma{_parse(t){return this._getType(t)===ai.undefined?_d(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};ap.create=(e,t)=>new ap({innerType:e,typeName:fs.ZodOptional,...$s(t)});let c_=class extends ma{_parse(t){return this._getType(t)===ai.null?_d(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};c_.create=(e,t)=>new c_({innerType:e,typeName:fs.ZodNullable,...$s(t)});let jA=class extends ma{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===ai.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};jA.create=(e,t)=>new jA({innerType:e,typeName:fs.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...$s(t)});let UA=class extends ma{_parse(t){const{ctx:n}=this._processInputParams(t),r={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return DA(a)?a.then(u=>({status:"valid",value:u.status==="valid"?u.value:this._def.catchValue({get error(){return new l_(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new l_(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};UA.create=(e,t)=>new UA({innerType:e,typeName:fs.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...$s(t)});let Wj=class extends ma{_parse(t){if(this._getType(t)!==ai.nan){const r=this._getOrReturnCtx(t);return Br(r,{code:mr.invalid_type,expected:ai.nan,received:r.parsedType}),us}return{status:"valid",value:t.data}}};Wj.create=e=>new Wj({typeName:fs.ZodNaN,...$s(e)});let bX=class extends ma{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}},nme=class wX extends ma{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const u=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return u.status==="aborted"?us:u.status==="dirty"?(n.dirty(),Vw(u.value)):this._def.out._parseAsync({data:u.value,path:r.path,parent:r})})();{const a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?us:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(t,n){return new wX({in:t,out:n,typeName:fs.ZodPipeline})}},VA=class extends ma{_parse(t){const n=this._def.innerType._parse(t),r=a=>(Lv(a)&&(a.value=Object.freeze(a.value)),a);return DA(n)?n.then(a=>r(a)):r(n)}unwrap(){return this._def.innerType}};VA.create=(e,t)=>new VA({innerType:e,typeName:fs.ZodReadonly,...$s(t)});var fs;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(fs||(fs={}));const va=_P.create,Zj=xP.create,aL=TP.create;a0.create;Dv.create;const Nc=pp.create;NA.create;const rme=sL.create;zA.create;H2.create;const df=FA.create,TX=WC.create;BA.create;ap.create;c_.create;const ime=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Xj=e=>{if(typeof e!="string")throw new TypeError("Invalid argument expected string");const t=e.match(ime);if(!t)throw new Error(`Invalid argument not valid semver ('${e}' received)`);return t.shift(),t},Yj=e=>e==="*"||e==="x"||e==="X",Kj=e=>{const t=parseInt(e,10);return isNaN(t)?e:t},sme=(e,t)=>typeof e!=typeof t?[String(e),String(t)]:[e,t],ame=(e,t)=>{if(Yj(e)||Yj(t))return 0;const[n,r]=sme(Kj(e),Kj(t));return n>r?1:n<r?-1:0},Qj=(e,t)=>{for(let n=0;n<Math.max(e.length,t.length);n++){const r=ame(e[n]||"0",t[n]||"0");if(r!==0)return r}return 0},ome=(e,t)=>{const n=Xj(e),r=Xj(t),a=n.pop(),u=r.pop(),f=Qj(n,r);return f!==0?f:a&&u?Qj(a.split("."),u.split(".")):a||u?a?-1:1:0};var lme={},ume=Object.defineProperty,cme=Object.defineProperties,dme=Object.getOwnPropertyDescriptors,$A=Object.getOwnPropertySymbols,EX=Object.prototype.hasOwnProperty,SX=Object.prototype.propertyIsEnumerable,Jj=(e,t,n)=>t in e?ume(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Kl=(e,t)=>{for(var n in t||(t={}))EX.call(t,n)&&Jj(e,n,t[n]);if($A)for(var n of $A(t))SX.call(t,n)&&Jj(e,n,t[n]);return e},o0=(e,t)=>cme(e,dme(t)),hme=(e,t)=>{var n={};for(var r in e)EX.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&$A)for(var r of $A(e))t.indexOf(r)<0&&SX.call(e,r)&&(n[r]=e[r]);return n},ja=e=>{if(typeof structuredClone=="function")return structuredClone(e);try{return JSON.parse(JSON.stringify(e))}catch{return Kl({},e)}};async function So(e,t,n,r){let a=t,u=n,f;for(let s of e)try{let v=await r(s,ja(a),ja(u));if(v===void 0)continue;if(v.messages!==void 0&&(a=v.messages),v.state!==void 0&&(u=v.state),f=v.stopPropagation,f===!0)break}catch(v){lme.JEST_WORKER_ID!==void 0||console.error("Subscriber error:",v);continue}return Kl(Kl(Kl({},JSON.stringify(a)!==JSON.stringify(t)?{messages:a}:{}),JSON.stringify(u)!==JSON.stringify(n)?{state:u}:{}),f!==void 0?{stopPropagation:f}:{})}var AX=(e,t,n,r)=>{let a=ja(n.messages),u=ja(e.state),f={},s=x=>{x.messages!==void 0&&(a=x.messages,f.messages=x.messages),x.state!==void 0&&(u=x.state,f.state=x.state)},v=()=>{let x=ja(f);return f={},x.messages!==void 0||x.state!==void 0?Vo(x):rX};return t.pipe(nX(async x=>{var A,C,P,L;let F=await So(r,a,u,(U,q,G)=>{var $;return($=U.onEvent)==null?void 0:$.call(U,{event:x,agent:n,input:e,messages:q,state:G})});if(s(F),F.stopPropagation===!0)return v();switch(x.type){case Hn.TEXT_MESSAGE_START:{let U=await So(r,a,u,(q,G,$)=>{var X;return(X=q.onTextMessageStartEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});if(s(U),U.stopPropagation!==!0){let{messageId:q,role:G="assistant"}=x,$={id:q,role:G,content:""};a.push($),s({messages:a})}return v()}case Hn.TEXT_MESSAGE_CONTENT:{let{messageId:U,delta:q}=x,G=a.find(X=>X.id===U);if(!G)return console.warn(`TEXT_MESSAGE_CONTENT: No message found with ID '${U}'`),v();let $=await So(r,a,u,(X,ie,de)=>{var fe;return(fe=X.onTextMessageContentEvent)==null?void 0:fe.call(X,{event:x,messages:ie,state:de,agent:n,input:e,textMessageBuffer:typeof G.content=="string"?G.content:""})});if(s($),$.stopPropagation!==!0){let X=typeof G.content=="string"?G.content:"";G.content=`${X}${q}`,s({messages:a})}return v()}case Hn.TEXT_MESSAGE_END:{let{messageId:U}=x,q=a.find($=>$.id===U);if(!q)return console.warn(`TEXT_MESSAGE_END: No message found with ID '${U}'`),v();let G=await So(r,a,u,($,X,ie)=>{var de;return(de=$.onTextMessageEndEvent)==null?void 0:de.call($,{event:x,messages:X,state:ie,agent:n,input:e,textMessageBuffer:typeof q.content=="string"?q.content:""})});return s(G),await Promise.all(r.map($=>{var X;(X=$.onNewMessage)==null||X.call($,{message:q,messages:a,state:u,agent:n,input:e})})),v()}case Hn.TOOL_CALL_START:{let U=await So(r,a,u,(q,G,$)=>{var X;return(X=q.onToolCallStartEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});if(s(U),U.stopPropagation!==!0){let{toolCallId:q,toolCallName:G,parentMessageId:$}=x,X;$&&a.length>0&&a[a.length-1].id===$?X=a[a.length-1]:(X={id:$||q,role:"assistant",toolCalls:[]},a.push(X)),X.toolCalls!=null||(X.toolCalls=[]),X.toolCalls.push({id:q,type:"function",function:{name:G,arguments:""}}),s({messages:a})}return v()}case Hn.TOOL_CALL_ARGS:{let{toolCallId:U,delta:q}=x,G=a.find(ie=>{var de;return(de=ie.toolCalls)==null?void 0:de.some(fe=>fe.id===U)});if(!G)return console.warn(`TOOL_CALL_ARGS: No message found containing tool call with ID '${U}'`),v();let $=G.toolCalls.find(ie=>ie.id===U);if(!$)return console.warn(`TOOL_CALL_ARGS: No tool call found with ID '${U}'`),v();let X=await So(r,a,u,(ie,de,fe)=>{var be;let ve=$.function.arguments,Qe=$.function.name,we={};try{we=rZ(ve)}catch{}return(be=ie.onToolCallArgsEvent)==null?void 0:be.call(ie,{event:x,messages:de,state:fe,agent:n,input:e,toolCallBuffer:ve,toolCallName:Qe,partialToolCallArgs:we})});return s(X),X.stopPropagation!==!0&&($.function.arguments+=q,s({messages:a})),v()}case Hn.TOOL_CALL_END:{let{toolCallId:U}=x,q=a.find(X=>{var ie;return(ie=X.toolCalls)==null?void 0:ie.some(de=>de.id===U)});if(!q)return console.warn(`TOOL_CALL_END: No message found containing tool call with ID '${U}'`),v();let G=q.toolCalls.find(X=>X.id===U);if(!G)return console.warn(`TOOL_CALL_END: No tool call found with ID '${U}'`),v();let $=await So(r,a,u,(X,ie,de)=>{var fe;let be=G.function.arguments,ve=G.function.name,Qe={};try{Qe=JSON.parse(be)}catch{}return(fe=X.onToolCallEndEvent)==null?void 0:fe.call(X,{event:x,messages:ie,state:de,agent:n,input:e,toolCallName:ve,toolCallArgs:Qe})});return s($),await Promise.all(r.map(X=>{var ie;(ie=X.onNewToolCall)==null||ie.call(X,{toolCall:G,messages:a,state:u,agent:n,input:e})})),v()}case Hn.TOOL_CALL_RESULT:{let U=await So(r,a,u,(q,G,$)=>{var X;return(X=q.onToolCallResultEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});if(s(U),U.stopPropagation!==!0){let{messageId:q,toolCallId:G,content:$,role:X}=x,ie={id:q,toolCallId:G,role:X||"tool",content:$};a.push(ie),await Promise.all(r.map(de=>{var fe;(fe=de.onNewMessage)==null||fe.call(de,{message:ie,messages:a,state:u,agent:n,input:e})})),s({messages:a})}return v()}case Hn.STATE_SNAPSHOT:{let U=await So(r,a,u,(q,G,$)=>{var X;return(X=q.onStateSnapshotEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});if(s(U),U.stopPropagation!==!0){let{snapshot:q}=x;u=q,s({state:u})}return v()}case Hn.STATE_DELTA:{let U=await So(r,a,u,(q,G,$)=>{var X;return(X=q.onStateDeltaEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});if(s(U),U.stopPropagation!==!0){let{delta:q}=x;try{u=Ov(u,q,!0,!1).newDocument,s({state:u})}catch(G){let $=G instanceof Error?G.message:String(G);console.warn(`Failed to apply state patch:
Current state: ${JSON.stringify(u,null,2)}
Patch operations: ${JSON.stringify(q,null,2)}
Error: ${$}`)}}return v()}case Hn.MESSAGES_SNAPSHOT:{let U=await So(r,a,u,(q,G,$)=>{var X;return(X=q.onMessagesSnapshotEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});if(s(U),U.stopPropagation!==!0){let{messages:q}=x;a=q,s({messages:a})}return v()}case Hn.ACTIVITY_SNAPSHOT:{let U=x,q=a.findIndex(de=>de.id===U.messageId),G=q>=0?a[q]:void 0,$=(G==null?void 0:G.role)==="activity"?G:void 0,X=(A=U.replace)!=null?A:!0,ie=await So(r,a,u,(de,fe,be)=>{var ve;return(ve=de.onActivitySnapshotEvent)==null?void 0:ve.call(de,{event:U,messages:fe,state:be,agent:n,input:e,activityMessage:$,existingMessage:G})});if(s(ie),ie.stopPropagation!==!0){let de={id:U.messageId,role:"activity",activityType:U.activityType,content:ja(U.content)},fe;q===-1?(a.push(de),fe=de):$?X&&(a[q]=o0(Kl({},$),{activityType:U.activityType,content:ja(U.content)})):X&&(a[q]=de,fe=de),s({messages:a}),fe&&await Promise.all(r.map(be=>{var ve;return(ve=be.onNewMessage)==null?void 0:ve.call(be,{message:fe,messages:a,state:u,agent:n,input:e})}))}return v()}case Hn.ACTIVITY_DELTA:{let U=x,q=a.findIndex(ie=>ie.id===U.messageId);if(q===-1)return console.warn(`ACTIVITY_DELTA: No message found with ID '${U.messageId}' to apply patch`),v();let G=a[q];if(G.role!=="activity")return console.warn(`ACTIVITY_DELTA: Message '${U.messageId}' is not an activity message`),v();let $=G,X=await So(r,a,u,(ie,de,fe)=>{var be;return(be=ie.onActivityDeltaEvent)==null?void 0:be.call(ie,{event:U,messages:de,state:fe,agent:n,input:e,activityMessage:$})});if(s(X),X.stopPropagation!==!0)try{let ie=ja((C=$.content)!=null?C:{}),de=Ov(ie,(P=U.patch)!=null?P:[],!0,!1).newDocument;a[q]=o0(Kl({},$),{content:ja(de),activityType:U.activityType}),s({messages:a})}catch(ie){let de=ie instanceof Error?ie.message:String(ie);console.warn(`Failed to apply activity patch for '${U.messageId}': ${de}`)}return v()}case Hn.RAW:{let U=await So(r,a,u,(q,G,$)=>{var X;return(X=q.onRawEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});return s(U),v()}case Hn.CUSTOM:{let U=await So(r,a,u,(q,G,$)=>{var X;return(X=q.onCustomEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});return s(U),v()}case Hn.RUN_STARTED:{let U=await So(r,a,u,(q,G,$)=>{var X;return(X=q.onRunStartedEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});if(s(U),U.stopPropagation!==!0){let q=x;if((L=q.input)!=null&&L.messages){for(let G of q.input.messages)a.find($=>$.id===G.id)||a.push(G);s({messages:a})}}return v()}case Hn.RUN_FINISHED:{let U=await So(r,a,u,(q,G,$)=>{var X;return(X=q.onRunFinishedEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e,result:x.result})});return s(U),v()}case Hn.RUN_ERROR:{let U=await So(r,a,u,(q,G,$)=>{var X;return(X=q.onRunErrorEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});return s(U),v()}case Hn.STEP_STARTED:{let U=await So(r,a,u,(q,G,$)=>{var X;return(X=q.onStepStartedEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});return s(U),v()}case Hn.STEP_FINISHED:{let U=await So(r,a,u,(q,G,$)=>{var X;return(X=q.onStepFinishedEvent)==null?void 0:X.call(q,{event:x,messages:G,state:$,agent:n,input:e})});return s(U),v()}case Hn.TEXT_MESSAGE_CHUNK:throw new Error("TEXT_MESSAGE_CHUNK must be tranformed before being applied");case Hn.TOOL_CALL_CHUNK:throw new Error("TOOL_CALL_CHUNK must be tranformed before being applied");case Hn.THINKING_START:return v();case Hn.THINKING_END:return v();case Hn.THINKING_TEXT_MESSAGE_START:return v();case Hn.THINKING_TEXT_MESSAGE_CONTENT:return v();case Hn.THINKING_TEXT_MESSAGE_END:return v()}return x.type,v()}),Gfe(),r.length>0?Wfe({}):x=>x)},v5=e=>t=>{let n=new Map,r=new Map,a=!1,u=!1,f=!1,s=new Map,v=!1,x=!1,A=!1,C=()=>{n.clear(),r.clear(),s.clear(),v=!1,x=!1,a=!1,u=!1,A=!0};return t.pipe(i0(P=>{let L=P.type;if(e&&console.debug("[VERIFY]:",JSON.stringify(P)),u)return Eo(()=>new Lo(`Cannot send event type '${L}': The run has already errored with 'RUN_ERROR'. No further events can be sent.`));if(a&&L!==Hn.RUN_ERROR&&L!==Hn.RUN_STARTED)return Eo(()=>new Lo(`Cannot send event type '${L}': The run has already finished with 'RUN_FINISHED'. Start a new run with 'RUN_STARTED'.`));if(f){if(L===Hn.RUN_STARTED){if(A&&!a)return Eo(()=>new Lo("Cannot send 'RUN_STARTED' while a run is still active. The previous run must be finished with 'RUN_FINISHED' before starting a new run."));a&&C()}}else if(f=!0,L!==Hn.RUN_STARTED&&L!==Hn.RUN_ERROR)return Eo(()=>new Lo("First event must be 'RUN_STARTED'"));switch(L){case Hn.TEXT_MESSAGE_START:{let F=P.messageId;return n.has(F)?Eo(()=>new Lo(`Cannot send 'TEXT_MESSAGE_START' event: A text message with ID '${F}' is already in progress. Complete it with 'TEXT_MESSAGE_END' first.`)):(n.set(F,!0),Vo(P))}case Hn.TEXT_MESSAGE_CONTENT:{let F=P.messageId;return n.has(F)?Vo(P):Eo(()=>new Lo(`Cannot send 'TEXT_MESSAGE_CONTENT' event: No active text message found with ID '${F}'. Start a text message with 'TEXT_MESSAGE_START' first.`))}case Hn.TEXT_MESSAGE_END:{let F=P.messageId;return n.has(F)?(n.delete(F),Vo(P)):Eo(()=>new Lo(`Cannot send 'TEXT_MESSAGE_END' event: No active text message found with ID '${F}'. A 'TEXT_MESSAGE_START' event must be sent first.`))}case Hn.TOOL_CALL_START:{let F=P.toolCallId;return r.has(F)?Eo(()=>new Lo(`Cannot send 'TOOL_CALL_START' event: A tool call with ID '${F}' is already in progress. Complete it with 'TOOL_CALL_END' first.`)):(r.set(F,!0),Vo(P))}case Hn.TOOL_CALL_ARGS:{let F=P.toolCallId;return r.has(F)?Vo(P):Eo(()=>new Lo(`Cannot send 'TOOL_CALL_ARGS' event: No active tool call found with ID '${F}'. Start a tool call with 'TOOL_CALL_START' first.`))}case Hn.TOOL_CALL_END:{let F=P.toolCallId;return r.has(F)?(r.delete(F),Vo(P)):Eo(()=>new Lo(`Cannot send 'TOOL_CALL_END' event: No active tool call found with ID '${F}'. A 'TOOL_CALL_START' event must be sent first.`))}case Hn.STEP_STARTED:{let F=P.stepName;return s.has(F)?Eo(()=>new Lo(`Step "${F}" is already active for 'STEP_STARTED'`)):(s.set(F,!0),Vo(P))}case Hn.STEP_FINISHED:{let F=P.stepName;return s.has(F)?(s.delete(F),Vo(P)):Eo(()=>new Lo(`Cannot send 'STEP_FINISHED' for step "${F}" that was not started`))}case Hn.RUN_STARTED:return A=!0,Vo(P);case Hn.RUN_FINISHED:{if(s.size>0){let F=Array.from(s.keys()).join(", ");return Eo(()=>new Lo(`Cannot send 'RUN_FINISHED' while steps are still active: ${F}`))}if(n.size>0){let F=Array.from(n.keys()).join(", ");return Eo(()=>new Lo(`Cannot send 'RUN_FINISHED' while text messages are still active: ${F}`))}if(r.size>0){let F=Array.from(r.keys()).join(", ");return Eo(()=>new Lo(`Cannot send 'RUN_FINISHED' while tool calls are still active: ${F}`))}return a=!0,Vo(P)}case Hn.RUN_ERROR:return u=!0,Vo(P);case Hn.CUSTOM:return Vo(P);case Hn.THINKING_TEXT_MESSAGE_START:return v?x?Eo(()=>new Lo("Cannot send 'THINKING_TEXT_MESSAGE_START' event: A thinking message is already in progress. Complete it with 'THINKING_TEXT_MESSAGE_END' first.")):(x=!0,Vo(P)):Eo(()=>new Lo("Cannot send 'THINKING_TEXT_MESSAGE_START' event: A thinking step is not in progress. Create one with 'THINKING_START' first."));case Hn.THINKING_TEXT_MESSAGE_CONTENT:return x?Vo(P):Eo(()=>new Lo("Cannot send 'THINKING_TEXT_MESSAGE_CONTENT' event: No active thinking message found. Start a message with 'THINKING_TEXT_MESSAGE_START' first."));case Hn.THINKING_TEXT_MESSAGE_END:return x?(x=!1,Vo(P)):Eo(()=>new Lo("Cannot send 'THINKING_TEXT_MESSAGE_END' event: No active thinking message found. A 'THINKING_TEXT_MESSAGE_START' event must be sent first."));case Hn.THINKING_START:return v?Eo(()=>new Lo("Cannot send 'THINKING_START' event: A thinking step is already in progress. End it with 'THINKING_END' first.")):(v=!0,Vo(P));case Hn.THINKING_END:return v?(v=!1,Vo(P)):Eo(()=>new Lo("Cannot send 'THINKING_END' event: No active thinking step found. A 'THINKING_START' event must be sent first."));default:return Vo(P)}}))},R4=(e,t)=>Kfe(()=>PA(fetch(e,t))).pipe(Xfe(n=>{var r;if(!n.ok){let f=n.headers.get("content-type")||"";return PA(n.text()).pipe(i0(s=>{let v=s;if(f.includes("application/json"))try{v=JSON.parse(s)}catch{}let x=new Error(`HTTP ${n.status}: ${typeof v=="string"?v:JSON.stringify(v)}`);return x.status=n.status,x.payload=v,Eo(()=>x)}))}let a={type:"headers",status:n.status,headers:n.headers},u=(r=n.body)==null?void 0:r.getReader();return u?new Cu(f=>(f.next(a),(async()=>{try{for(;;){let{done:s,value:v}=await u.read();if(s)break;let x={type:"data",data:v};f.next(x)}f.complete()}catch(s){f.error(s)}})(),()=>{u.cancel().catch(s=>{if((s==null?void 0:s.name)!=="AbortError")throw s})})):Eo(()=>new Error("Failed to getReader() from response"))})),fme=e=>{let t=new o_,n=new TextDecoder("utf-8",{fatal:!1}),r="";e.subscribe({next:u=>{if(u.type!=="headers"&&u.type==="data"&&u.data){let f=n.decode(u.data,{stream:!0});r+=f;let s=r.split(/\n\n/);r=s.pop()||"";for(let v of s)a(v)}},error:u=>t.error(u),complete:()=>{r&&(r+=n.decode(),a(r)),t.complete()}});function a(u){let f=u.split(`
`),s=[];for(let v of f)v.startsWith("data: ")&&s.push(v.slice(6));if(s.length>0)try{let v=s.join(`
`),x=JSON.parse(v);t.next(x)}catch(v){t.error(v)}}return t.asObservable()},pme=e=>{let t=new o_,n=new Uint8Array(0);e.subscribe({next:a=>{if(a.type!=="headers"&&a.type==="data"&&a.data){let u=new Uint8Array(n.length+a.data.length);u.set(n,0),u.set(a.data,n.length),n=u,r()}},error:a=>t.error(a),complete:()=>{if(n.length>0)try{r()}catch{console.warn("Incomplete or invalid protocol buffer data at stream end")}t.complete()}});function r(){for(;n.length>=4;){let a=4+new DataView(n.buffer,n.byteOffset,4).getUint32(0,!1);if(n.length<a)break;try{let u=n.slice(4,a),f=Ipe(u);t.next(f),n=n.slice(a)}catch(u){let f=u instanceof Error?u.message:String(u);t.error(new Error(`Failed to decode protocol buffer message: ${f}`));return}}}return t.asObservable()},M4=e=>{let t=new o_,n=new iX,r=!1;return e.subscribe({next:a=>{n.next(a),a.type==="headers"&&!r?(r=!0,a.headers.get("content-type")===Rpe?pme(n).subscribe({next:u=>t.next(u),error:u=>t.error(u),complete:()=>t.complete()}):fme(n).subscribe({next:u=>{try{let f=zZ.parse(u);t.next(f)}catch(f){t.error(f)}},error:u=>{if((u==null?void 0:u.name)==="AbortError"){t.next({type:Hn.RUN_ERROR,rawEvent:u}),t.complete();return}return t.error(u)},complete:()=>t.complete()})):r||t.error(new Error("No headers event received before data events"))},error:a=>{n.error(a),t.error(a)},complete:()=>{n.complete()}}),t.asObservable()},Qa=TX(["TextMessageStart","TextMessageContent","TextMessageEnd","ActionExecutionStart","ActionExecutionArgs","ActionExecutionEnd","ActionExecutionResult","AgentStateMessage","MetaEvent","RunStarted","RunFinished","RunError","NodeStarted","NodeFinished"]),mme=TX(["LangGraphInterruptEvent","PredictState","Exit"]),gme=Nc({type:df(Qa.enum.TextMessageStart),messageId:va(),parentMessageId:va().optional(),role:va().optional()}),_me=Nc({type:df(Qa.enum.TextMessageContent),messageId:va(),content:va()}),yme=Nc({type:df(Qa.enum.TextMessageEnd),messageId:va()}),vme=Nc({type:df(Qa.enum.ActionExecutionStart),actionExecutionId:va(),actionName:va(),parentMessageId:va().optional()}),xme=Nc({type:df(Qa.enum.ActionExecutionArgs),actionExecutionId:va(),args:va()}),bme=Nc({type:df(Qa.enum.ActionExecutionEnd),actionExecutionId:va()}),wme=Nc({type:df(Qa.enum.ActionExecutionResult),actionName:va(),actionExecutionId:va(),result:va()}),Tme=Nc({type:df(Qa.enum.AgentStateMessage),threadId:va(),agentName:va(),nodeName:va(),runId:va(),active:Zj(),role:va(),state:va(),running:Zj()}),Eme=Nc({type:df(Qa.enum.MetaEvent),name:mme,value:aL()}),Sme=Nc({type:df(Qa.enum.RunError),message:va(),code:va().optional()});rme("type",[gme,_me,yme,vme,xme,bme,wme,Tme,Eme,Sme]);Nc({id:va(),role:va(),content:va(),parentMessageId:va().optional()});Nc({id:va(),name:va(),arguments:aL(),parentMessageId:va().optional()});Nc({id:va(),result:aL(),actionExecutionId:va(),actionName:va()});var Ame=e=>{if(typeof e=="string")return e;if(!Array.isArray(e))return;let t=e.filter(n=>n.type==="text").map(n=>n.text).filter(n=>n.length>0);if(t.length!==0)return t.join(`
`)},Cme=(e,t,n)=>r=>{let a={},u=!0,f=!0,s="",v=null,x=null,A=[],C={},P=L=>{typeof L=="object"&&L!==null&&("messages"in L&&delete L.messages,a=L)};return r.pipe(i0(L=>{switch(L.type){case Hn.TEXT_MESSAGE_START:{let F=L;return[{type:Qa.enum.TextMessageStart,messageId:F.messageId,role:F.role}]}case Hn.TEXT_MESSAGE_CONTENT:{let F=L;return[{type:Qa.enum.TextMessageContent,messageId:F.messageId,content:F.delta}]}case Hn.TEXT_MESSAGE_END:{let F=L;return[{type:Qa.enum.TextMessageEnd,messageId:F.messageId}]}case Hn.TOOL_CALL_START:{let F=L;return A.push({id:F.toolCallId,type:"function",function:{name:F.toolCallName,arguments:""}}),f=!0,C[F.toolCallId]=F.toolCallName,[{type:Qa.enum.ActionExecutionStart,actionExecutionId:F.toolCallId,actionName:F.toolCallName,parentMessageId:F.parentMessageId}]}case Hn.TOOL_CALL_ARGS:{let F=L,U=A.find(G=>G.id===F.toolCallId);if(!U)return console.warn(`TOOL_CALL_ARGS: No tool call found with ID '${F.toolCallId}'`),[];U.function.arguments+=F.delta;let q=!1;if(x){let G=x.find($=>$.tool==U.function.name);if(G)try{let $=JSON.parse(rZ(U.function.arguments));G.tool_argument&&G.tool_argument in $?(P(o0(Kl({},a),{[G.state_key]:$[G.tool_argument]})),q=!0):G.tool_argument||(P(o0(Kl({},a),{[G.state_key]:$})),q=!0)}catch{}}return[{type:Qa.enum.ActionExecutionArgs,actionExecutionId:F.toolCallId,args:F.delta},...q?[{type:Qa.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:s,runId:t,running:u,role:"assistant",state:JSON.stringify(a),active:f}]:[]]}case Hn.TOOL_CALL_END:{let F=L;return[{type:Qa.enum.ActionExecutionEnd,actionExecutionId:F.toolCallId}]}case Hn.TOOL_CALL_RESULT:{let F=L;return[{type:Qa.enum.ActionExecutionResult,actionExecutionId:F.toolCallId,result:F.content,actionName:C[F.toolCallId]||"unknown"}]}case Hn.RAW:return[];case Hn.CUSTOM:{let F=L;switch(F.name){case"Exit":u=!1;break;case"PredictState":x=F.value;break}return[{type:Qa.enum.MetaEvent,name:F.name,value:F.value}]}case Hn.STATE_SNAPSHOT:return P(L.snapshot),[{type:Qa.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:s,runId:t,running:u,role:"assistant",state:JSON.stringify(a),active:f}];case Hn.STATE_DELTA:{let F=Ov(a,L.delta,!0,!1);return F?(P(F.newDocument),[{type:Qa.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:s,runId:t,running:u,role:"assistant",state:JSON.stringify(a),active:f}]):[]}case Hn.MESSAGES_SNAPSHOT:return v=L.messages,[{type:Qa.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:s,runId:t,running:u,role:"assistant",state:JSON.stringify(Kl(Kl({},a),v?{messages:v}:{})),active:!0}];case Hn.RUN_STARTED:return[];case Hn.RUN_FINISHED:return v&&(a.messages=v),Object.keys(a).length===0?[]:[{type:Qa.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:s,runId:t,running:u,role:"assistant",state:JSON.stringify(Kl(Kl({},a),v?{messages:kme(v)}:{})),active:!1}];case Hn.RUN_ERROR:{let F=L;return[{type:Qa.enum.RunError,message:F.message,code:F.code}]}case Hn.STEP_STARTED:return s=L.stepName,A=[],x=null,[{type:Qa.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:s,runId:t,running:u,role:"assistant",state:JSON.stringify(a),active:!0}];case Hn.STEP_FINISHED:return A=[],x=null,[{type:Qa.enum.AgentStateMessage,threadId:e,agentName:n,nodeName:s,runId:t,running:u,role:"assistant",state:JSON.stringify(a),active:!1}];default:return[]}}))};function kme(e){var t;let n=[];for(let r of e)if(r.role==="assistant"||r.role==="user"||r.role==="system"){let a=Ame(r.content);if(a){let u={id:r.id,role:r.role,content:a};n.push(u)}if(r.role==="assistant"&&r.toolCalls&&r.toolCalls.length>0)for(let u of r.toolCalls){let f={id:u.id,name:u.function.name,arguments:JSON.parse(u.function.arguments),parentMessageId:r.id};n.push(f)}}else if(r.role==="tool"){let a="unknown";for(let f of e)if(f.role==="assistant"&&(t=f.toolCalls)!=null&&t.length){for(let s of f.toolCalls)if(s.id===r.toolCallId){a=s.function.name;break}}let u={id:r.id,result:r.content,actionExecutionId:r.toolCallId,actionName:a};n.push(u)}return n}var P4=e=>t=>{let n,r,a,u=()=>{if(!n||a!=="text")throw new Error("No text message to close");let v={type:Hn.TEXT_MESSAGE_END,messageId:n.messageId};return a=void 0,n=void 0,e&&console.debug("[TRANSFORM]: TEXT_MESSAGE_END",JSON.stringify(v)),v},f=()=>{if(!r||a!=="tool")throw new Error("No tool call to close");let v={type:Hn.TOOL_CALL_END,toolCallId:r.toolCallId};return a=void 0,r=void 0,e&&console.debug("[TRANSFORM]: TOOL_CALL_END",JSON.stringify(v)),v},s=()=>a==="text"?[u()]:a==="tool"?[f()]:[];return t.pipe(i0(v=>{switch(v.type){case Hn.TEXT_MESSAGE_START:case Hn.TEXT_MESSAGE_CONTENT:case Hn.TEXT_MESSAGE_END:case Hn.TOOL_CALL_START:case Hn.TOOL_CALL_ARGS:case Hn.TOOL_CALL_END:case Hn.TOOL_CALL_RESULT:case Hn.STATE_SNAPSHOT:case Hn.STATE_DELTA:case Hn.MESSAGES_SNAPSHOT:case Hn.CUSTOM:case Hn.RUN_STARTED:case Hn.RUN_FINISHED:case Hn.RUN_ERROR:case Hn.STEP_STARTED:case Hn.STEP_FINISHED:case Hn.THINKING_START:case Hn.THINKING_END:case Hn.THINKING_TEXT_MESSAGE_START:case Hn.THINKING_TEXT_MESSAGE_CONTENT:case Hn.THINKING_TEXT_MESSAGE_END:return[...s(),v];case Hn.RAW:case Hn.ACTIVITY_SNAPSHOT:case Hn.ACTIVITY_DELTA:return[v];case Hn.TEXT_MESSAGE_CHUNK:let x=v,A=[];if((a!=="text"||x.messageId!==void 0&&x.messageId!==(n==null?void 0:n.messageId))&&A.push(...s()),a!=="text"){if(x.messageId===void 0)throw new Error("First TEXT_MESSAGE_CHUNK must have a messageId");n={messageId:x.messageId},a="text";let L={type:Hn.TEXT_MESSAGE_START,messageId:x.messageId,role:x.role||"assistant"};A.push(L),e&&console.debug("[TRANSFORM]: TEXT_MESSAGE_START",JSON.stringify(L))}if(x.delta!==void 0){let L={type:Hn.TEXT_MESSAGE_CONTENT,messageId:n.messageId,delta:x.delta};A.push(L),e&&console.debug("[TRANSFORM]: TEXT_MESSAGE_CONTENT",JSON.stringify(L))}return A;case Hn.TOOL_CALL_CHUNK:let C=v,P=[];if((a!=="tool"||C.toolCallId!==void 0&&C.toolCallId!==(r==null?void 0:r.toolCallId))&&P.push(...s()),a!=="tool"){if(C.toolCallId===void 0)throw new Error("First TOOL_CALL_CHUNK must have a toolCallId");if(C.toolCallName===void 0)throw new Error("First TOOL_CALL_CHUNK must have a toolCallName");r={toolCallId:C.toolCallId,toolCallName:C.toolCallName,parentMessageId:C.parentMessageId},a="tool";let L={type:Hn.TOOL_CALL_START,toolCallId:C.toolCallId,toolCallName:C.toolCallName,parentMessageId:C.parentMessageId};P.push(L),e&&console.debug("[TRANSFORM]: TOOL_CALL_START",JSON.stringify(L))}if(C.delta!==void 0){let L={type:Hn.TOOL_CALL_ARGS,toolCallId:r.toolCallId,delta:C.delta};P.push(L),e&&console.debug("[TRANSFORM]: TOOL_CALL_ARGS",JSON.stringify(L))}return P}return v.type,[]}),uP(()=>{s()}))},CX=class{runNext(t,n){return n.run(t).pipe(P4(!1))}runNextWithState(t,n){let r=ja(t.messages||[]),a=ja(t.state||{}),u=new iX;return AX(t,u,n,[]).subscribe(f=>{f.messages!==void 0&&(r=f.messages),f.state!==void 0&&(a=f.state)}),this.runNext(t,n).pipe(nX(async f=>(u.next(f),await new Promise(s=>setTimeout(s,0)),{event:f,messages:ja(r),state:ja(a)})))}},Ime=class extends CX{constructor(t){super(),this.fn=t}run(t,n){return this.fn(t,n)}};function Rme(e){let t=e.content;if(Array.isArray(t)){let n=t.filter(r=>typeof r=="object"&&r!==null&&"type"in r&&r.type==="text"&&typeof r.text=="string").map(r=>r.text).join("");return o0(Kl({},e),{content:n})}return typeof t=="string"?e:o0(Kl({},e),{content:""})}var Mme=class extends CX{run(t,n){let r=t,{parentRunId:a}=r,u=hme(r,["parentRunId"]),f=o0(Kl({},u),{messages:u.messages.map(Rme)});return this.runNext(f,n)}},Pme={version:"0.0.42"},Ome=class{constructor({agentId:t,description:n,threadId:r,initialMessages:a,initialState:u,debug:f}={}){this.debug=!1,this.subscribers=[],this.isRunning=!1,this.middlewares=[],this.agentId=t,this.description=n??"",this.threadId=r??I1(),this.messages=ja(a??[]),this.state=ja(u??{}),this.debug=f??!1,ome(this.maxVersion,"0.0.39")<=0&&this.middlewares.unshift(new Mme)}get maxVersion(){return Pme.version}subscribe(t){return this.subscribers.push(t),{unsubscribe:()=>{this.subscribers=this.subscribers.filter(n=>n!==t)}}}use(...t){let n=t.map(r=>typeof r=="function"?new Ime(r):r);return this.middlewares.push(...n),this}async runAgent(t,n){var r;try{this.isRunning=!0,this.agentId=(r=this.agentId)!=null?r:I1();let a=this.prepareRunAgentInput(t),u,f=new Set(this.messages.map(C=>C.id)),s=[{onRunFinishedEvent:C=>{u=C.result}},...this.subscribers,n??{}];await this.onInitialize(a,s),this.activeRunDetach$=new o_;let v;this.activeRunCompletionPromise=new Promise(C=>{v=C});let x=YB(()=>this.middlewares.length===0?this.run(a):this.middlewares.reduceRight((C,P)=>({run:L=>P.run(L,C)}),this).run(a),P4(this.debug),v5(this.debug),C=>C.pipe(JB(this.activeRunDetach$)),C=>this.apply(a,C,s),C=>this.processApplyEvents(a,C,s),oP(C=>(this.isRunning=!1,this.onError(a,C,s))),uP(()=>{this.isRunning=!1,this.onFinalize(a,s),v==null||v(),v=void 0,this.activeRunCompletionPromise=void 0,this.activeRunDetach$=void 0}));await ej(x(Vo(null)));let A=ja(this.messages).filter(C=>!f.has(C.id));return{result:u,newMessages:A}}finally{this.isRunning=!1}}connect(t){throw new rP}async connectAgent(t,n){var r;try{this.isRunning=!0,this.agentId=(r=this.agentId)!=null?r:I1();let a=this.prepareRunAgentInput(t),u,f=new Set(this.messages.map(C=>C.id)),s=[{onRunFinishedEvent:C=>{u=C.result}},...this.subscribers,n??{}];await this.onInitialize(a,s),this.activeRunDetach$=new o_;let v;this.activeRunCompletionPromise=new Promise(C=>{v=C});let x=YB(()=>this.connect(a),P4(this.debug),v5(this.debug),C=>C.pipe(JB(this.activeRunDetach$)),C=>this.apply(a,C,s),C=>this.processApplyEvents(a,C,s),oP(C=>(this.isRunning=!1,C instanceof rP?rX:this.onError(a,C,s))),uP(()=>{this.isRunning=!1,this.onFinalize(a,s),v==null||v(),v=void 0,this.activeRunCompletionPromise=void 0,this.activeRunDetach$=void 0}));await ej(x(Vo(null)));let A=ja(this.messages).filter(C=>!f.has(C.id));return{result:u,newMessages:A}}finally{this.isRunning=!1}}abortRun(){}async detachActiveRun(){var t,n;if(!this.activeRunDetach$)return;let r=(t=this.activeRunCompletionPromise)!=null?t:Promise.resolve();this.activeRunDetach$.next(),(n=this.activeRunDetach$)==null||n.complete(),await r}apply(t,n,r){return AX(t,n,this,r)}processApplyEvents(t,n,r){return n.pipe(Yfe(a=>{a.messages&&(this.messages=a.messages,r.forEach(u=>{var f;(f=u.onMessagesChanged)==null||f.call(u,{messages:this.messages,state:this.state,agent:this,input:t})})),a.state&&(this.state=a.state,r.forEach(u=>{var f;(f=u.onStateChanged)==null||f.call(u,{state:this.state,messages:this.messages,agent:this,input:t})}))}))}prepareRunAgentInput(t){var n,r,a;let u=ja(this.messages).filter(f=>f.role!=="activity");return{threadId:this.threadId,runId:(t==null?void 0:t.runId)||I1(),tools:ja((n=t==null?void 0:t.tools)!=null?n:[]),context:ja((r=t==null?void 0:t.context)!=null?r:[]),forwardedProps:ja((a=t==null?void 0:t.forwardedProps)!=null?a:{}),state:ja(this.state),messages:u}}async onInitialize(t,n){let r=await So(n,this.messages,this.state,(a,u,f)=>{var s;return(s=a.onRunInitialized)==null?void 0:s.call(a,{messages:u,state:f,agent:this,input:t})});(r.messages!==void 0||r.state!==void 0)&&(r.messages&&(this.messages=r.messages,t.messages=r.messages,n.forEach(a=>{var u;(u=a.onMessagesChanged)==null||u.call(a,{messages:this.messages,state:this.state,agent:this,input:t})})),r.state&&(this.state=r.state,t.state=r.state,n.forEach(a=>{var u;(u=a.onStateChanged)==null||u.call(a,{state:this.state,messages:this.messages,agent:this,input:t})})))}onError(t,n,r){return PA(So(r,this.messages,this.state,(a,u,f)=>{var s;return(s=a.onRunFailed)==null?void 0:s.call(a,{error:n,messages:u,state:f,agent:this,input:t})})).pipe(lP(a=>{let u=a;if((u.messages!==void 0||u.state!==void 0)&&(u.messages!==void 0&&(this.messages=u.messages,r.forEach(f=>{var s;(s=f.onMessagesChanged)==null||s.call(f,{messages:this.messages,state:this.state,agent:this,input:t})})),u.state!==void 0&&(this.state=u.state,r.forEach(f=>{var s;(s=f.onStateChanged)==null||s.call(f,{state:this.state,messages:this.messages,agent:this,input:t})}))),u.stopPropagation!==!0)throw console.error("Agent execution failed:",n),n;return{}}))}async onFinalize(t,n){let r=await So(n,this.messages,this.state,(a,u,f)=>{var s;return(s=a.onRunFinalized)==null?void 0:s.call(a,{messages:u,state:f,agent:this,input:t})});(r.messages!==void 0||r.state!==void 0)&&(r.messages!==void 0&&(this.messages=r.messages,n.forEach(a=>{var u;(u=a.onMessagesChanged)==null||u.call(a,{messages:this.messages,state:this.state,agent:this,input:t})})),r.state!==void 0&&(this.state=r.state,n.forEach(a=>{var u;(u=a.onStateChanged)==null||u.call(a,{state:this.state,messages:this.messages,agent:this,input:t})})))}clone(){let t=Object.create(Object.getPrototypeOf(this));return t.agentId=this.agentId,t.description=this.description,t.threadId=this.threadId,t.messages=ja(this.messages),t.state=ja(this.state),t.debug=this.debug,t.isRunning=this.isRunning,t.subscribers=[...this.subscribers],t.middlewares=[...this.middlewares],t}addMessage(t){this.messages.push(t),(async()=>{var n,r,a;for(let u of this.subscribers)await((n=u.onNewMessage)==null?void 0:n.call(u,{message:t,messages:this.messages,state:this.state,agent:this}));if(t.role==="assistant"&&t.toolCalls)for(let u of t.toolCalls)for(let f of this.subscribers)await((r=f.onNewToolCall)==null?void 0:r.call(f,{toolCall:u,messages:this.messages,state:this.state,agent:this}));for(let u of this.subscribers)await((a=u.onMessagesChanged)==null?void 0:a.call(u,{messages:this.messages,state:this.state,agent:this}))})()}addMessages(t){this.messages.push(...t),(async()=>{var n,r,a;for(let u of t){for(let f of this.subscribers)await((n=f.onNewMessage)==null?void 0:n.call(f,{message:u,messages:this.messages,state:this.state,agent:this}));if(u.role==="assistant"&&u.toolCalls)for(let f of u.toolCalls)for(let s of this.subscribers)await((r=s.onNewToolCall)==null?void 0:r.call(s,{toolCall:f,messages:this.messages,state:this.state,agent:this}))}for(let u of this.subscribers)await((a=u.onMessagesChanged)==null?void 0:a.call(u,{messages:this.messages,state:this.state,agent:this}))})()}setMessages(t){this.messages=ja(t),(async()=>{var n;for(let r of this.subscribers)await((n=r.onMessagesChanged)==null?void 0:n.call(r,{messages:this.messages,state:this.state,agent:this}))})()}setState(t){this.state=ja(t),(async()=>{var n;for(let r of this.subscribers)await((n=r.onStateChanged)==null?void 0:n.call(r,{messages:this.messages,state:this.state,agent:this}))})()}legacy_to_be_removed_runAgentBridged(t){var n;this.agentId=(n=this.agentId)!=null?n:I1();let r=this.prepareRunAgentInput(t);return(this.middlewares.length===0?this.run(r):this.middlewares.reduceRight((a,u)=>({run:f=>u.run(f,a)}),this).run(r)).pipe(P4(this.debug),v5(this.debug),Cme(this.threadId,r.runId,this.agentId),a=>a.pipe(lP(u=>(this.debug&&console.debug("[LEGACY]:",JSON.stringify(u)),u))))}},HA=class extends Ome{constructor(t){var n;super(t),this.abortController=new AbortController,this.url=t.url,this.headers=ja((n=t.headers)!=null?n:{})}requestInit(t){return{method:"POST",headers:o0(Kl({},this.headers),{"Content-Type":"application/json",Accept:"text/event-stream"}),body:JSON.stringify(t),signal:this.abortController.signal}}runAgent(t,n){var r;return this.abortController=(r=t==null?void 0:t.abortController)!=null?r:new AbortController,super.runAgent(t,n)}abortRun(){this.abortController.abort(),super.abortRun()}run(t){let n=R4(this.url,this.requestInit(t));return M4(n)}clone(){var t;let n=super.clone();n.url=this.url,n.headers=ja((t=this.headers)!=null?t:{});let r=new AbortController,a=this.abortController.signal;return a.aborted&&r.abort(a.reason),n.abortController=r,n}};const Lme=(e,t)=>{const n=new Array(e.length+t.length);for(let r=0;r<e.length;r++)n[r]=e[r];for(let r=0;r<t.length;r++)n[e.length+r]=t[r];return n},Dme=(e,t)=>({classGroupId:e,validator:t}),kX=(e=new Map,t=null,n)=>({nextPart:e,validators:t,classGroupId:n}),GA="-",eU=[],Nme="arbitrary..",zme=e=>{const t=Bme(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:f=>{if(f.startsWith("[")&&f.endsWith("]"))return Fme(f);const s=f.split(GA),v=s[0]===""&&s.length>1?1:0;return IX(s,v,t)},getConflictingClassGroupIds:(f,s)=>{if(s){const v=r[f],x=n[f];return v?x?Lme(x,v):v:x||eU}return n[f]||eU}}},IX=(e,t,n)=>{if(e.length-t===0)return n.classGroupId;const a=e[t],u=n.nextPart.get(a);if(u){const x=IX(e,t+1,u);if(x)return x}const f=n.validators;if(f===null)return;const s=t===0?e.join(GA):e.slice(t).join(GA),v=f.length;for(let x=0;x<v;x++){const A=f[x];if(A.validator(s))return A.classGroupId}},Fme=e=>e.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const t=e.slice(1,-1),n=t.indexOf(":"),r=t.slice(0,n);return r?Nme+r:void 0})(),Bme=e=>{const{theme:t,classGroups:n}=e;return jme(n,t)},jme=(e,t)=>{const n=kX();for(const r in e){const a=e[r];oL(a,n,r,t)}return n},oL=(e,t,n,r)=>{const a=e.length;for(let u=0;u<a;u++){const f=e[u];Ume(f,t,n,r)}},Ume=(e,t,n,r)=>{if(typeof e=="string"){Vme(e,t,n);return}if(typeof e=="function"){$me(e,t,n,r);return}Hme(e,t,n,r)},Vme=(e,t,n)=>{const r=e===""?t:RX(t,e);r.classGroupId=n},$me=(e,t,n,r)=>{if(Gme(e)){oL(e(r),t,n,r);return}t.validators===null&&(t.validators=[]),t.validators.push(Dme(n,e))},Hme=(e,t,n,r)=>{const a=Object.entries(e),u=a.length;for(let f=0;f<u;f++){const[s,v]=a[f];oL(v,RX(t,s),n,r)}},RX=(e,t)=>{let n=e;const r=t.split(GA),a=r.length;for(let u=0;u<a;u++){const f=r[u];let s=n.nextPart.get(f);s||(s=kX(),n.nextPart.set(f,s)),n=s}return n},Gme=e=>"isThemeGetter"in e&&e.isThemeGetter===!0,qme=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=Object.create(null),r=Object.create(null);const a=(u,f)=>{n[u]=f,t++,t>e&&(t=0,r=n,n=Object.create(null))};return{get(u){let f=n[u];if(f!==void 0)return f;if((f=r[u])!==void 0)return a(u,f),f},set(u,f){u in n?n[u]=f:a(u,f)}}},IP="!",tU=":",Wme=[],nU=(e,t,n,r,a)=>({modifiers:e,hasImportantModifier:t,baseClassName:n,maybePostfixModifierPosition:r,isExternal:a}),Zme=e=>{const{prefix:t,experimentalParseClassName:n}=e;let r=a=>{const u=[];let f=0,s=0,v=0,x;const A=a.length;for(let U=0;U<A;U++){const q=a[U];if(f===0&&s===0){if(q===tU){u.push(a.slice(v,U)),v=U+1;continue}if(q==="/"){x=U;continue}}q==="["?f++:q==="]"?f--:q==="("?s++:q===")"&&s--}const C=u.length===0?a:a.slice(v);let P=C,L=!1;C.endsWith(IP)?(P=C.slice(0,-1),L=!0):C.startsWith(IP)&&(P=C.slice(1),L=!0);const F=x&&x>v?x-v:void 0;return nU(u,L,P,F)};if(t){const a=t+tU,u=r;r=f=>f.startsWith(a)?u(f.slice(a.length)):nU(Wme,!1,f,void 0,!0)}if(n){const a=r;r=u=>n({className:u,parseClassName:a})}return r},Xme=e=>{const t=new Map;return e.orderSensitiveModifiers.forEach((n,r)=>{t.set(n,1e6+r)}),n=>{const r=[];let a=[];for(let u=0;u<n.length;u++){const f=n[u],s=f[0]==="[",v=t.has(f);s||v?(a.length>0&&(a.sort(),r.push(...a),a=[]),r.push(f)):a.push(f)}return a.length>0&&(a.sort(),r.push(...a)),r}},Yme=e=>({cache:qme(e.cacheSize),parseClassName:Zme(e),sortModifiers:Xme(e),...zme(e)}),Kme=/\s+/,Qme=(e,t)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:a,sortModifiers:u}=t,f=[],s=e.trim().split(Kme);let v="";for(let x=s.length-1;x>=0;x-=1){const A=s[x],{isExternal:C,modifiers:P,hasImportantModifier:L,baseClassName:F,maybePostfixModifierPosition:U}=n(A);if(C){v=A+(v.length>0?" "+v:v);continue}let q=!!U,G=r(q?F.substring(0,U):F);if(!G){if(!q){v=A+(v.length>0?" "+v:v);continue}if(G=r(F),!G){v=A+(v.length>0?" "+v:v);continue}q=!1}const $=P.length===0?"":P.length===1?P[0]:u(P).join(":"),X=L?$+IP:$,ie=X+G;if(f.indexOf(ie)>-1)continue;f.push(ie);const de=a(G,q);for(let fe=0;fe<de.length;++fe){const be=de[fe];f.push(X+be)}v=A+(v.length>0?" "+v:v)}return v},Jme=(...e)=>{let t=0,n,r,a="";for(;t<e.length;)(n=e[t++])&&(r=MX(n))&&(a&&(a+=" "),a+=r);return a},MX=e=>{if(typeof e=="string")return e;let t,n="";for(let r=0;r<e.length;r++)e[r]&&(t=MX(e[r]))&&(n&&(n+=" "),n+=t);return n},e0e=(e,...t)=>{let n,r,a,u;const f=v=>{const x=t.reduce((A,C)=>C(A),e());return n=Yme(x),r=n.cache.get,a=n.cache.set,u=s,s(v)},s=v=>{const x=r(v);if(x)return x;const A=Qme(v,n);return a(v,A),A};return u=f,(...v)=>u(Jme(...v))},t0e=[],ul=e=>{const t=n=>n[e]||t0e;return t.isThemeGetter=!0,t},PX=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,OX=/^\((?:(\w[\w-]*):)?(.+)\)$/i,n0e=/^\d+\/\d+$/,r0e=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,i0e=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,s0e=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,a0e=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,o0e=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,b1=e=>n0e.test(e),Us=e=>!!e&&!Number.isNaN(Number(e)),om=e=>!!e&&Number.isInteger(Number(e)),x5=e=>e.endsWith("%")&&Us(e.slice(0,-1)),Vf=e=>r0e.test(e),l0e=()=>!0,u0e=e=>i0e.test(e)&&!s0e.test(e),LX=()=>!1,c0e=e=>a0e.test(e),d0e=e=>o0e.test(e),h0e=e=>!ii(e)&&!si(e),f0e=e=>tx(e,zX,LX),ii=e=>PX.test(e),bg=e=>tx(e,FX,u0e),b5=e=>tx(e,y0e,Us),rU=e=>tx(e,DX,LX),p0e=e=>tx(e,NX,d0e),m3=e=>tx(e,BX,c0e),si=e=>OX.test(e),Tw=e=>nx(e,FX),m0e=e=>nx(e,v0e),iU=e=>nx(e,DX),g0e=e=>nx(e,zX),_0e=e=>nx(e,NX),g3=e=>nx(e,BX,!0),tx=(e,t,n)=>{const r=PX.exec(e);return r?r[1]?t(r[1]):n(r[2]):!1},nx=(e,t,n=!1)=>{const r=OX.exec(e);return r?r[1]?t(r[1]):n:!1},DX=e=>e==="position"||e==="percentage",NX=e=>e==="image"||e==="url",zX=e=>e==="length"||e==="size"||e==="bg-size",FX=e=>e==="length",y0e=e=>e==="number",v0e=e=>e==="family-name",BX=e=>e==="shadow",x0e=()=>{const e=ul("color"),t=ul("font"),n=ul("text"),r=ul("font-weight"),a=ul("tracking"),u=ul("leading"),f=ul("breakpoint"),s=ul("container"),v=ul("spacing"),x=ul("radius"),A=ul("shadow"),C=ul("inset-shadow"),P=ul("text-shadow"),L=ul("drop-shadow"),F=ul("blur"),U=ul("perspective"),q=ul("aspect"),G=ul("ease"),$=ul("animate"),X=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ie=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],de=()=>[...ie(),si,ii],fe=()=>["auto","hidden","clip","visible","scroll"],be=()=>["auto","contain","none"],ve=()=>[si,ii,v],Qe=()=>[b1,"full","auto",...ve()],we=()=>[om,"none","subgrid",si,ii],qe=()=>["auto",{span:["full",om,si,ii]},om,si,ii],Je=()=>[om,"auto",si,ii],ft=()=>["auto","min","max","fr",si,ii],Mt=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],Pt=()=>["start","end","center","stretch","center-safe","end-safe"],Nt=()=>["auto",...ve()],Kt=()=>[b1,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...ve()],tt=()=>[e,si,ii],mt=()=>[...ie(),iU,rU,{position:[si,ii]}],Pe=()=>["no-repeat",{repeat:["","x","y","space","round"]}],gn=()=>["auto","cover","contain",g0e,f0e,{size:[si,ii]}],Et=()=>[x5,Tw,bg],ze=()=>["","none","full",x,si,ii],$t=()=>["",Us,Tw,bg],Cn=()=>["solid","dashed","dotted","double"],fn=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Nn=()=>[Us,x5,iU,rU],bn=()=>["","none",F,si,ii],Vt=()=>["none",Us,si,ii],En=()=>["none",Us,si,ii],Sn=()=>[Us,si,ii],Un=()=>[b1,"full",...ve()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Vf],breakpoint:[Vf],color:[l0e],container:[Vf],"drop-shadow":[Vf],ease:["in","out","in-out"],font:[h0e],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Vf],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Vf],shadow:[Vf],spacing:["px",Us],text:[Vf],"text-shadow":[Vf],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",b1,ii,si,q]}],container:["container"],columns:[{columns:[Us,ii,si,s]}],"break-after":[{"break-after":X()}],"break-before":[{"break-before":X()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:de()}],overflow:[{overflow:fe()}],"overflow-x":[{"overflow-x":fe()}],"overflow-y":[{"overflow-y":fe()}],overscroll:[{overscroll:be()}],"overscroll-x":[{"overscroll-x":be()}],"overscroll-y":[{"overscroll-y":be()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:Qe()}],"inset-x":[{"inset-x":Qe()}],"inset-y":[{"inset-y":Qe()}],start:[{start:Qe()}],end:[{end:Qe()}],top:[{top:Qe()}],right:[{right:Qe()}],bottom:[{bottom:Qe()}],left:[{left:Qe()}],visibility:["visible","invisible","collapse"],z:[{z:[om,"auto",si,ii]}],basis:[{basis:[b1,"full","auto",s,...ve()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Us,b1,"auto","initial","none",ii]}],grow:[{grow:["",Us,si,ii]}],shrink:[{shrink:["",Us,si,ii]}],order:[{order:[om,"first","last","none",si,ii]}],"grid-cols":[{"grid-cols":we()}],"col-start-end":[{col:qe()}],"col-start":[{"col-start":Je()}],"col-end":[{"col-end":Je()}],"grid-rows":[{"grid-rows":we()}],"row-start-end":[{row:qe()}],"row-start":[{"row-start":Je()}],"row-end":[{"row-end":Je()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":ft()}],"auto-rows":[{"auto-rows":ft()}],gap:[{gap:ve()}],"gap-x":[{"gap-x":ve()}],"gap-y":[{"gap-y":ve()}],"justify-content":[{justify:[...Mt(),"normal"]}],"justify-items":[{"justify-items":[...Pt(),"normal"]}],"justify-self":[{"justify-self":["auto",...Pt()]}],"align-content":[{content:["normal",...Mt()]}],"align-items":[{items:[...Pt(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...Pt(),{baseline:["","last"]}]}],"place-content":[{"place-content":Mt()}],"place-items":[{"place-items":[...Pt(),"baseline"]}],"place-self":[{"place-self":["auto",...Pt()]}],p:[{p:ve()}],px:[{px:ve()}],py:[{py:ve()}],ps:[{ps:ve()}],pe:[{pe:ve()}],pt:[{pt:ve()}],pr:[{pr:ve()}],pb:[{pb:ve()}],pl:[{pl:ve()}],m:[{m:Nt()}],mx:[{mx:Nt()}],my:[{my:Nt()}],ms:[{ms:Nt()}],me:[{me:Nt()}],mt:[{mt:Nt()}],mr:[{mr:Nt()}],mb:[{mb:Nt()}],ml:[{ml:Nt()}],"space-x":[{"space-x":ve()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":ve()}],"space-y-reverse":["space-y-reverse"],size:[{size:Kt()}],w:[{w:[s,"screen",...Kt()]}],"min-w":[{"min-w":[s,"screen","none",...Kt()]}],"max-w":[{"max-w":[s,"screen","none","prose",{screen:[f]},...Kt()]}],h:[{h:["screen","lh",...Kt()]}],"min-h":[{"min-h":["screen","lh","none",...Kt()]}],"max-h":[{"max-h":["screen","lh",...Kt()]}],"font-size":[{text:["base",n,Tw,bg]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,si,b5]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",x5,ii]}],"font-family":[{font:[m0e,ii,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[a,si,ii]}],"line-clamp":[{"line-clamp":[Us,"none",si,b5]}],leading:[{leading:[u,...ve()]}],"list-image":[{"list-image":["none",si,ii]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",si,ii]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:tt()}],"text-color":[{text:tt()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Cn(),"wavy"]}],"text-decoration-thickness":[{decoration:[Us,"from-font","auto",si,bg]}],"text-decoration-color":[{decoration:tt()}],"underline-offset":[{"underline-offset":[Us,"auto",si,ii]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:ve()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",si,ii]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",si,ii]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:mt()}],"bg-repeat":[{bg:Pe()}],"bg-size":[{bg:gn()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},om,si,ii],radial:["",si,ii],conic:[om,si,ii]},_0e,p0e]}],"bg-color":[{bg:tt()}],"gradient-from-pos":[{from:Et()}],"gradient-via-pos":[{via:Et()}],"gradient-to-pos":[{to:Et()}],"gradient-from":[{from:tt()}],"gradient-via":[{via:tt()}],"gradient-to":[{to:tt()}],rounded:[{rounded:ze()}],"rounded-s":[{"rounded-s":ze()}],"rounded-e":[{"rounded-e":ze()}],"rounded-t":[{"rounded-t":ze()}],"rounded-r":[{"rounded-r":ze()}],"rounded-b":[{"rounded-b":ze()}],"rounded-l":[{"rounded-l":ze()}],"rounded-ss":[{"rounded-ss":ze()}],"rounded-se":[{"rounded-se":ze()}],"rounded-ee":[{"rounded-ee":ze()}],"rounded-es":[{"rounded-es":ze()}],"rounded-tl":[{"rounded-tl":ze()}],"rounded-tr":[{"rounded-tr":ze()}],"rounded-br":[{"rounded-br":ze()}],"rounded-bl":[{"rounded-bl":ze()}],"border-w":[{border:$t()}],"border-w-x":[{"border-x":$t()}],"border-w-y":[{"border-y":$t()}],"border-w-s":[{"border-s":$t()}],"border-w-e":[{"border-e":$t()}],"border-w-t":[{"border-t":$t()}],"border-w-r":[{"border-r":$t()}],"border-w-b":[{"border-b":$t()}],"border-w-l":[{"border-l":$t()}],"divide-x":[{"divide-x":$t()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":$t()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Cn(),"hidden","none"]}],"divide-style":[{divide:[...Cn(),"hidden","none"]}],"border-color":[{border:tt()}],"border-color-x":[{"border-x":tt()}],"border-color-y":[{"border-y":tt()}],"border-color-s":[{"border-s":tt()}],"border-color-e":[{"border-e":tt()}],"border-color-t":[{"border-t":tt()}],"border-color-r":[{"border-r":tt()}],"border-color-b":[{"border-b":tt()}],"border-color-l":[{"border-l":tt()}],"divide-color":[{divide:tt()}],"outline-style":[{outline:[...Cn(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Us,si,ii]}],"outline-w":[{outline:["",Us,Tw,bg]}],"outline-color":[{outline:tt()}],shadow:[{shadow:["","none",A,g3,m3]}],"shadow-color":[{shadow:tt()}],"inset-shadow":[{"inset-shadow":["none",C,g3,m3]}],"inset-shadow-color":[{"inset-shadow":tt()}],"ring-w":[{ring:$t()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:tt()}],"ring-offset-w":[{"ring-offset":[Us,bg]}],"ring-offset-color":[{"ring-offset":tt()}],"inset-ring-w":[{"inset-ring":$t()}],"inset-ring-color":[{"inset-ring":tt()}],"text-shadow":[{"text-shadow":["none",P,g3,m3]}],"text-shadow-color":[{"text-shadow":tt()}],opacity:[{opacity:[Us,si,ii]}],"mix-blend":[{"mix-blend":[...fn(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":fn()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Us]}],"mask-image-linear-from-pos":[{"mask-linear-from":Nn()}],"mask-image-linear-to-pos":[{"mask-linear-to":Nn()}],"mask-image-linear-from-color":[{"mask-linear-from":tt()}],"mask-image-linear-to-color":[{"mask-linear-to":tt()}],"mask-image-t-from-pos":[{"mask-t-from":Nn()}],"mask-image-t-to-pos":[{"mask-t-to":Nn()}],"mask-image-t-from-color":[{"mask-t-from":tt()}],"mask-image-t-to-color":[{"mask-t-to":tt()}],"mask-image-r-from-pos":[{"mask-r-from":Nn()}],"mask-image-r-to-pos":[{"mask-r-to":Nn()}],"mask-image-r-from-color":[{"mask-r-from":tt()}],"mask-image-r-to-color":[{"mask-r-to":tt()}],"mask-image-b-from-pos":[{"mask-b-from":Nn()}],"mask-image-b-to-pos":[{"mask-b-to":Nn()}],"mask-image-b-from-color":[{"mask-b-from":tt()}],"mask-image-b-to-color":[{"mask-b-to":tt()}],"mask-image-l-from-pos":[{"mask-l-from":Nn()}],"mask-image-l-to-pos":[{"mask-l-to":Nn()}],"mask-image-l-from-color":[{"mask-l-from":tt()}],"mask-image-l-to-color":[{"mask-l-to":tt()}],"mask-image-x-from-pos":[{"mask-x-from":Nn()}],"mask-image-x-to-pos":[{"mask-x-to":Nn()}],"mask-image-x-from-color":[{"mask-x-from":tt()}],"mask-image-x-to-color":[{"mask-x-to":tt()}],"mask-image-y-from-pos":[{"mask-y-from":Nn()}],"mask-image-y-to-pos":[{"mask-y-to":Nn()}],"mask-image-y-from-color":[{"mask-y-from":tt()}],"mask-image-y-to-color":[{"mask-y-to":tt()}],"mask-image-radial":[{"mask-radial":[si,ii]}],"mask-image-radial-from-pos":[{"mask-radial-from":Nn()}],"mask-image-radial-to-pos":[{"mask-radial-to":Nn()}],"mask-image-radial-from-color":[{"mask-radial-from":tt()}],"mask-image-radial-to-color":[{"mask-radial-to":tt()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":ie()}],"mask-image-conic-pos":[{"mask-conic":[Us]}],"mask-image-conic-from-pos":[{"mask-conic-from":Nn()}],"mask-image-conic-to-pos":[{"mask-conic-to":Nn()}],"mask-image-conic-from-color":[{"mask-conic-from":tt()}],"mask-image-conic-to-color":[{"mask-conic-to":tt()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:mt()}],"mask-repeat":[{mask:Pe()}],"mask-size":[{mask:gn()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",si,ii]}],filter:[{filter:["","none",si,ii]}],blur:[{blur:bn()}],brightness:[{brightness:[Us,si,ii]}],contrast:[{contrast:[Us,si,ii]}],"drop-shadow":[{"drop-shadow":["","none",L,g3,m3]}],"drop-shadow-color":[{"drop-shadow":tt()}],grayscale:[{grayscale:["",Us,si,ii]}],"hue-rotate":[{"hue-rotate":[Us,si,ii]}],invert:[{invert:["",Us,si,ii]}],saturate:[{saturate:[Us,si,ii]}],sepia:[{sepia:["",Us,si,ii]}],"backdrop-filter":[{"backdrop-filter":["","none",si,ii]}],"backdrop-blur":[{"backdrop-blur":bn()}],"backdrop-brightness":[{"backdrop-brightness":[Us,si,ii]}],"backdrop-contrast":[{"backdrop-contrast":[Us,si,ii]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Us,si,ii]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Us,si,ii]}],"backdrop-invert":[{"backdrop-invert":["",Us,si,ii]}],"backdrop-opacity":[{"backdrop-opacity":[Us,si,ii]}],"backdrop-saturate":[{"backdrop-saturate":[Us,si,ii]}],"backdrop-sepia":[{"backdrop-sepia":["",Us,si,ii]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":ve()}],"border-spacing-x":[{"border-spacing-x":ve()}],"border-spacing-y":[{"border-spacing-y":ve()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",si,ii]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Us,"initial",si,ii]}],ease:[{ease:["linear","initial",G,si,ii]}],delay:[{delay:[Us,si,ii]}],animate:[{animate:["none",$,si,ii]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[U,si,ii]}],"perspective-origin":[{"perspective-origin":de()}],rotate:[{rotate:Vt()}],"rotate-x":[{"rotate-x":Vt()}],"rotate-y":[{"rotate-y":Vt()}],"rotate-z":[{"rotate-z":Vt()}],scale:[{scale:En()}],"scale-x":[{"scale-x":En()}],"scale-y":[{"scale-y":En()}],"scale-z":[{"scale-z":En()}],"scale-3d":["scale-3d"],skew:[{skew:Sn()}],"skew-x":[{"skew-x":Sn()}],"skew-y":[{"skew-y":Sn()}],transform:[{transform:[si,ii,"","none","gpu","cpu"]}],"transform-origin":[{origin:de()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Un()}],"translate-x":[{"translate-x":Un()}],"translate-y":[{"translate-y":Un()}],"translate-z":[{"translate-z":Un()}],"translate-none":["translate-none"],accent:[{accent:tt()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:tt()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",si,ii]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":ve()}],"scroll-mx":[{"scroll-mx":ve()}],"scroll-my":[{"scroll-my":ve()}],"scroll-ms":[{"scroll-ms":ve()}],"scroll-me":[{"scroll-me":ve()}],"scroll-mt":[{"scroll-mt":ve()}],"scroll-mr":[{"scroll-mr":ve()}],"scroll-mb":[{"scroll-mb":ve()}],"scroll-ml":[{"scroll-ml":ve()}],"scroll-p":[{"scroll-p":ve()}],"scroll-px":[{"scroll-px":ve()}],"scroll-py":[{"scroll-py":ve()}],"scroll-ps":[{"scroll-ps":ve()}],"scroll-pe":[{"scroll-pe":ve()}],"scroll-pt":[{"scroll-pt":ve()}],"scroll-pr":[{"scroll-pr":ve()}],"scroll-pb":[{"scroll-pb":ve()}],"scroll-pl":[{"scroll-pl":ve()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",si,ii]}],fill:[{fill:["none",...tt()]}],"stroke-w":[{stroke:[Us,Tw,bg,b5]}],stroke:[{stroke:["none",...tt()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},uo=e0e(x0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b0e=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),w0e=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,r)=>r?r.toUpperCase():n.toLowerCase()),sU=e=>{const t=w0e(e);return t.charAt(0).toUpperCase()+t.slice(1)},jX=(...e)=>e.filter((t,n,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===n).join(" ").trim(),T0e=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var E0e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S0e=B.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:a="",children:u,iconNode:f,...s},v)=>B.createElement("svg",{ref:v,...E0e,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:jX("lucide",a),...!u&&!T0e(s)&&{"aria-hidden":"true"},...s},[...f.map(([x,A])=>B.createElement(x,A)),...Array.isArray(u)?u:[u]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ul=(e,t)=>{const n=B.forwardRef(({className:r,...a},u)=>B.createElement(S0e,{ref:u,iconNode:t,className:jX(`lucide-${b0e(sU(e))}`,`lucide-${e}`,r),...a}));return n.displayName=sU(e),n};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A0e=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],C0e=Ul("arrow-up",A0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k0e=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],lL=Ul("check",k0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I0e=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],R0e=Ul("chevron-down",I0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M0e=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],P0e=Ul("chevron-left",M0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O0e=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],UX=Ul("chevron-right",O0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L0e=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],VX=Ul("copy",L0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D0e=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],N0e=Ul("loader-circle",D0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z0e=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],F0e=Ul("message-circle",z0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B0e=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],j0e=Ul("mic",B0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U0e=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],V0e=Ul("plus",U0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $0e=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],H0e=Ul("refresh-cw",$0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G0e=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],q0e=Ul("square-pen",G0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W0e=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Z0e=Ul("square",W0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X0e=[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]],Y0e=Ul("thumbs-down",X0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K0e=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],Q0e=Ul("thumbs-up",K0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J0e=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],ege=Ul("volume-2",J0e);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tge=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],uL=Ul("x",tge);var $X={},RP={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Allow=e.ALL=e.COLLECTION=e.ATOM=e.SPECIAL=e.INF=e._INFINITY=e.INFINITY=e.NAN=e.BOOL=e.NULL=e.OBJ=e.ARR=e.NUM=e.STR=void 0,e.STR=1,e.NUM=2,e.ARR=4,e.OBJ=8,e.NULL=16,e.BOOL=32,e.NAN=64,e.INFINITY=128,e._INFINITY=256,e.INF=e.INFINITY|e._INFINITY,e.SPECIAL=e.NULL|e.BOOL|e.INF|e.NAN,e.ATOM=e.STR|e.NUM|e.SPECIAL,e.COLLECTION=e.ARR|e.OBJ,e.ALL=e.ATOM|e.COLLECTION,e.Allow={STR:e.STR,NUM:e.NUM,ARR:e.ARR,OBJ:e.OBJ,NULL:e.NULL,BOOL:e.BOOL,NAN:e.NAN,INFINITY:e.INFINITY,_INFINITY:e._INFINITY,INF:e.INF,SPECIAL:e.SPECIAL,ATOM:e.ATOM,COLLECTION:e.COLLECTION,ALL:e.ALL},e.default=e.Allow})(RP);(function(e){var t=ep&&ep.__createBinding||(Object.create?function(x,A,C,P){P===void 0&&(P=C);var L=Object.getOwnPropertyDescriptor(A,C);(!L||("get"in L?!A.__esModule:L.writable||L.configurable))&&(L={enumerable:!0,get:function(){return A[C]}}),Object.defineProperty(x,P,L)}:function(x,A,C,P){P===void 0&&(P=C),x[P]=A[C]}),n=ep&&ep.__exportStar||function(x,A){for(var C in x)C!=="default"&&!Object.prototype.hasOwnProperty.call(A,C)&&t(A,x,C)};Object.defineProperty(e,"__esModule",{value:!0}),e.Allow=e.MalformedJSON=e.PartialJSON=e.parseJSON=e.parse=void 0;const r=RP;Object.defineProperty(e,"Allow",{enumerable:!0,get:function(){return r.Allow}}),n(RP,e);class a extends Error{}e.PartialJSON=a;class u extends Error{}e.MalformedJSON=u;function f(x,A=r.Allow.ALL){if(typeof x!="string")throw new TypeError(`expecting str, got ${typeof x}`);if(!x.trim())throw new Error(`${x} is empty`);return s(x.trim(),A)}e.parseJSON=f;const s=(x,A)=>{const C=x.length;let P=0;const L=de=>{throw new a(`${de} at position ${P}`)},F=de=>{throw new u(`${de} at position ${P}`)},U=()=>(ie(),P>=C&&L("Unexpected end of input"),x[P]==='"'?q():x[P]==="{"?G():x[P]==="["?$():x.substring(P,P+4)==="null"||r.Allow.NULL&A&&C-P<4&&"null".startsWith(x.substring(P))?(P+=4,null):x.substring(P,P+4)==="true"||r.Allow.BOOL&A&&C-P<4&&"true".startsWith(x.substring(P))?(P+=4,!0):x.substring(P,P+5)==="false"||r.Allow.BOOL&A&&C-P<5&&"false".startsWith(x.substring(P))?(P+=5,!1):x.substring(P,P+8)==="Infinity"||r.Allow.INFINITY&A&&C-P<8&&"Infinity".startsWith(x.substring(P))?(P+=8,1/0):x.substring(P,P+9)==="-Infinity"||r.Allow._INFINITY&A&&1<C-P&&C-P<9&&"-Infinity".startsWith(x.substring(P))?(P+=9,-1/0):x.substring(P,P+3)==="NaN"||r.Allow.NAN&A&&C-P<3&&"NaN".startsWith(x.substring(P))?(P+=3,NaN):X()),q=()=>{const de=P;let fe=!1;for(P++;P<C&&(x[P]!=='"'||fe&&x[P-1]==="\\");)fe=x[P]==="\\"?!fe:!1,P++;if(x.charAt(P)=='"')try{return JSON.parse(x.substring(de,++P-Number(fe)))}catch(be){F(String(be))}else if(r.Allow.STR&A)try{return JSON.parse(x.substring(de,P-Number(fe))+'"')}catch{return JSON.parse(x.substring(de,x.lastIndexOf("\\"))+'"')}L("Unterminated string literal")},G=()=>{P++,ie();const de={};try{for(;x[P]!=="}";){if(ie(),P>=C&&r.Allow.OBJ&A)return de;const fe=q();ie(),P++;try{const be=U();de[fe]=be}catch(be){if(r.Allow.OBJ&A)return de;throw be}ie(),x[P]===","&&P++}}catch{if(r.Allow.OBJ&A)return de;L("Expected '}' at end of object")}return P++,de},$=()=>{P++;const de=[];try{for(;x[P]!=="]";)de.push(U()),ie(),x[P]===","&&P++}catch{if(r.Allow.ARR&A)return de;L("Expected ']' at end of array")}return P++,de},X=()=>{if(P===0){x==="-"&&F("Not sure what '-' is");try{return JSON.parse(x)}catch(fe){if(r.Allow.NUM&A)try{return JSON.parse(x.substring(0,x.lastIndexOf("e")))}catch{}F(String(fe))}}const de=P;for(x[P]==="-"&&P++;x[P]&&",]}".indexOf(x[P])===-1;)P++;P==C&&!(r.Allow.NUM&A)&&L("Unterminated number literal");try{return JSON.parse(x.substring(de,P))}catch{x.substring(de,P)==="-"&&L("Not sure what '-' is");try{return JSON.parse(x.substring(de,x.lastIndexOf("e")))}catch(be){F(String(be))}}},ie=()=>{for(;P<C&&` 
\r	`.includes(x[P]);)P++};return U()},v=f;e.parse=v})($X);function nf(){return I1()}function HX(e){try{return $X.parse(e)}catch{return{}}}var GX=console,rx="default";function aU(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function w_(...e){return t=>{let n=!1;const r=e.map(a=>{const u=aU(a,t);return!n&&typeof u=="function"&&(n=!0),u});if(n)return()=>{for(let a=0;a<r.length;a++){const u=r[a];typeof u=="function"?u():aU(e[a],null)}}}}function ru(...e){return B.useCallback(w_(...e),e)}var nge=Symbol.for("react.lazy"),qA=mT[" use ".trim().toString()];function rge(e){return typeof e=="object"&&e!==null&&"then"in e}function qX(e){return e!=null&&typeof e=="object"&&"$$typeof"in e&&e.$$typeof===nge&&"_payload"in e&&rge(e._payload)}function ige(e){const t=age(e),n=B.forwardRef((r,a)=>{let{children:u,...f}=r;qX(u)&&typeof qA=="function"&&(u=qA(u._payload));const s=B.Children.toArray(u),v=s.find(lge);if(v){const x=v.props.children,A=s.map(C=>C===v?B.Children.count(x)>1?B.Children.only(null):B.isValidElement(x)?x.props.children:null:C);return k.jsx(t,{...f,ref:a,children:B.isValidElement(x)?B.cloneElement(x,void 0,A):null})}return k.jsx(t,{...f,ref:a,children:u})});return n.displayName=`${e}.Slot`,n}var sge=ige("Slot");function age(e){const t=B.forwardRef((n,r)=>{let{children:a,...u}=n;if(qX(a)&&typeof qA=="function"&&(a=qA(a._payload)),B.isValidElement(a)){const f=cge(a),s=uge(u,a.props);return a.type!==B.Fragment&&(s.ref=r?w_(r,f):f),B.cloneElement(a,s)}return B.Children.count(a)>1?B.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var oge=Symbol("radix.slottable");function lge(e){return B.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===oge}function uge(e,t){const n={...t};for(const r in t){const a=e[r],u=t[r];/^on[A-Z]/.test(r)?a&&u?n[r]=(...s)=>{const v=u(...s);return a(...s),v}:a&&(n[r]=a):r==="style"?n[r]={...a,...u}:r==="className"&&(n[r]=[a,u].filter(Boolean).join(" "))}return{...e,...n}}function cge(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function WX(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(n=WX(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function cL(){for(var e,t,n=0,r="",a=arguments.length;n<a;n++)(e=arguments[n])&&(t=WX(e))&&(r&&(r+=" "),r+=t);return r}const oU=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,lU=cL,dge=(e,t)=>n=>{var r;if((t==null?void 0:t.variants)==null)return lU(e,n==null?void 0:n.class,n==null?void 0:n.className);const{variants:a,defaultVariants:u}=t,f=Object.keys(a).map(x=>{const A=n==null?void 0:n[x],C=u==null?void 0:u[x];if(A===null)return null;const P=oU(A)||oU(C);return a[x][P]}),s=n&&Object.entries(n).reduce((x,A)=>{let[C,P]=A;return P===void 0||(x[C]=P),x},{}),v=t==null||(r=t.compoundVariants)===null||r===void 0?void 0:r.reduce((x,A)=>{let{class:C,className:P,...L}=A;return Object.entries(L).every(F=>{let[U,q]=F;return Array.isArray(q)?q.includes({...u,...s}[U]):{...u,...s}[U]===q})?[...x,C,P]:x},[]);return lU(e,f,v,n==null?void 0:n.class,n==null?void 0:n.className)};function js(e,t,{checkForDefaultPrevented:n=!0}={}){return function(a){if(e==null||e(a),n===!1||!a.defaultPrevented)return t==null?void 0:t(a)}}function ix(e,t=[]){let n=[];function r(u,f){const s=B.createContext(f),v=n.length;n=[...n,f];const x=C=>{var G;const{scope:P,children:L,...F}=C,U=((G=P==null?void 0:P[e])==null?void 0:G[v])||s,q=B.useMemo(()=>F,Object.values(F));return k.jsx(U.Provider,{value:q,children:L})};x.displayName=u+"Provider";function A(C,P){var U;const L=((U=P==null?void 0:P[e])==null?void 0:U[v])||s,F=B.useContext(L);if(F)return F;if(f!==void 0)return f;throw new Error(`\`${C}\` must be used within \`${u}\``)}return[x,A]}const a=()=>{const u=n.map(f=>B.createContext(f));return function(s){const v=(s==null?void 0:s[e])||u;return B.useMemo(()=>({[`__scope${e}`]:{...s,[e]:v}}),[s,v])}};return a.scopeName=e,[r,hge(a,...t)]}function hge(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(u){const f=r.reduce((s,{useScope:v,scopeName:x})=>{const C=v(u)[`__scope${x}`];return{...s,...C}},{});return B.useMemo(()=>({[`__scope${t.scopeName}`]:f}),[f])}};return n.scopeName=t.scopeName,n}function fge(e){const t=pge(e),n=B.forwardRef((r,a)=>{const{children:u,...f}=r,s=B.Children.toArray(u),v=s.find(gge);if(v){const x=v.props.children,A=s.map(C=>C===v?B.Children.count(x)>1?B.Children.only(null):B.isValidElement(x)?x.props.children:null:C);return k.jsx(t,{...f,ref:a,children:B.isValidElement(x)?B.cloneElement(x,void 0,A):null})}return k.jsx(t,{...f,ref:a,children:u})});return n.displayName=`${e}.Slot`,n}function pge(e){const t=B.forwardRef((n,r)=>{const{children:a,...u}=n;if(B.isValidElement(a)){const f=yge(a),s=_ge(u,a.props);return a.type!==B.Fragment&&(s.ref=r?w_(r,f):f),B.cloneElement(a,s)}return B.Children.count(a)>1?B.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var mge=Symbol("radix.slottable");function gge(e){return B.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===mge}function _ge(e,t){const n={...t};for(const r in t){const a=e[r],u=t[r];/^on[A-Z]/.test(r)?a&&u?n[r]=(...s)=>{const v=u(...s);return a(...s),v}:a&&(n[r]=a):r==="style"?n[r]={...a,...u}:r==="className"&&(n[r]=[a,u].filter(Boolean).join(" "))}return{...e,...n}}function yge(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var vge=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Vl=vge.reduce((e,t)=>{const n=fge(`Primitive.${t}`),r=B.forwardRef((a,u)=>{const{asChild:f,...s}=a,v=f?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),k.jsx(v,{...s,ref:u})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function ZX(e,t){e&&xT.flushSync(()=>e.dispatchEvent(t))}function lf(e){const t=B.useRef(e);return B.useEffect(()=>{t.current=e}),B.useMemo(()=>(...n)=>{var r;return(r=t.current)==null?void 0:r.call(t,...n)},[])}function xge(e,t=globalThis==null?void 0:globalThis.document){const n=lf(e);B.useEffect(()=>{const r=a=>{a.key==="Escape"&&n(a)};return t.addEventListener("keydown",r,{capture:!0}),()=>t.removeEventListener("keydown",r,{capture:!0})},[n,t])}var bge="DismissableLayer",MP="dismissableLayer.update",wge="dismissableLayer.pointerDownOutside",Tge="dismissableLayer.focusOutside",uU,XX=B.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),dL=B.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:a,onFocusOutside:u,onInteractOutside:f,onDismiss:s,...v}=e,x=B.useContext(XX),[A,C]=B.useState(null),P=(A==null?void 0:A.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,L]=B.useState({}),F=ru(t,be=>C(be)),U=Array.from(x.layers),[q]=[...x.layersWithOutsidePointerEventsDisabled].slice(-1),G=U.indexOf(q),$=A?U.indexOf(A):-1,X=x.layersWithOutsidePointerEventsDisabled.size>0,ie=$>=G,de=Age(be=>{const ve=be.target,Qe=[...x.branches].some(we=>we.contains(ve));!ie||Qe||(a==null||a(be),f==null||f(be),be.defaultPrevented||s==null||s())},P),fe=Cge(be=>{const ve=be.target;[...x.branches].some(we=>we.contains(ve))||(u==null||u(be),f==null||f(be),be.defaultPrevented||s==null||s())},P);return xge(be=>{$===x.layers.size-1&&(r==null||r(be),!be.defaultPrevented&&s&&(be.preventDefault(),s()))},P),B.useEffect(()=>{if(A)return n&&(x.layersWithOutsidePointerEventsDisabled.size===0&&(uU=P.body.style.pointerEvents,P.body.style.pointerEvents="none"),x.layersWithOutsidePointerEventsDisabled.add(A)),x.layers.add(A),cU(),()=>{n&&x.layersWithOutsidePointerEventsDisabled.size===1&&(P.body.style.pointerEvents=uU)}},[A,P,n,x]),B.useEffect(()=>()=>{A&&(x.layers.delete(A),x.layersWithOutsidePointerEventsDisabled.delete(A),cU())},[A,x]),B.useEffect(()=>{const be=()=>L({});return document.addEventListener(MP,be),()=>document.removeEventListener(MP,be)},[]),k.jsx(Vl.div,{...v,ref:F,style:{pointerEvents:X?ie?"auto":"none":void 0,...e.style},onFocusCapture:js(e.onFocusCapture,fe.onFocusCapture),onBlurCapture:js(e.onBlurCapture,fe.onBlurCapture),onPointerDownCapture:js(e.onPointerDownCapture,de.onPointerDownCapture)})});dL.displayName=bge;var Ege="DismissableLayerBranch",Sge=B.forwardRef((e,t)=>{const n=B.useContext(XX),r=B.useRef(null),a=ru(t,r);return B.useEffect(()=>{const u=r.current;if(u)return n.branches.add(u),()=>{n.branches.delete(u)}},[n.branches]),k.jsx(Vl.div,{...e,ref:a})});Sge.displayName=Ege;function Age(e,t=globalThis==null?void 0:globalThis.document){const n=lf(e),r=B.useRef(!1),a=B.useRef(()=>{});return B.useEffect(()=>{const u=s=>{if(s.target&&!r.current){let v=function(){YX(wge,n,x,{discrete:!0})};const x={originalEvent:s};s.pointerType==="touch"?(t.removeEventListener("click",a.current),a.current=v,t.addEventListener("click",a.current,{once:!0})):v()}else t.removeEventListener("click",a.current);r.current=!1},f=window.setTimeout(()=>{t.addEventListener("pointerdown",u)},0);return()=>{window.clearTimeout(f),t.removeEventListener("pointerdown",u),t.removeEventListener("click",a.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function Cge(e,t=globalThis==null?void 0:globalThis.document){const n=lf(e),r=B.useRef(!1);return B.useEffect(()=>{const a=u=>{u.target&&!r.current&&YX(Tge,n,{originalEvent:u},{discrete:!1})};return t.addEventListener("focusin",a),()=>t.removeEventListener("focusin",a)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function cU(){const e=new CustomEvent(MP);document.dispatchEvent(e)}function YX(e,t,n,{discrete:r}){const a=n.originalEvent.target,u=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&a.addEventListener(e,t,{once:!0}),r?ZX(a,u):a.dispatchEvent(u)}var l0=globalThis!=null&&globalThis.document?B.useLayoutEffect:()=>{},kge=mT[" useId ".trim().toString()]||(()=>{}),Ige=0;function Nv(e){const[t,n]=B.useState(kge());return l0(()=>{n(r=>r??String(Ige++))},[e]),t?`radix-${t}`:""}const Rge=["top","right","bottom","left"],u0=Math.min,Tc=Math.max,WA=Math.round,_3=Math.floor,rf=e=>({x:e,y:e}),Mge={left:"right",right:"left",bottom:"top",top:"bottom"},Pge={start:"end",end:"start"};function PP(e,t,n){return Tc(e,u0(t,n))}function mp(e,t){return typeof e=="function"?e(t):e}function gp(e){return e.split("-")[0]}function sx(e){return e.split("-")[1]}function hL(e){return e==="x"?"y":"x"}function fL(e){return e==="y"?"height":"width"}const Oge=new Set(["top","bottom"]);function Yh(e){return Oge.has(gp(e))?"y":"x"}function pL(e){return hL(Yh(e))}function Lge(e,t,n){n===void 0&&(n=!1);const r=sx(e),a=pL(e),u=fL(a);let f=a==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return t.reference[u]>t.floating[u]&&(f=ZA(f)),[f,ZA(f)]}function Dge(e){const t=ZA(e);return[OP(e),t,OP(t)]}function OP(e){return e.replace(/start|end/g,t=>Pge[t])}const dU=["left","right"],hU=["right","left"],Nge=["top","bottom"],zge=["bottom","top"];function Fge(e,t,n){switch(e){case"top":case"bottom":return n?t?hU:dU:t?dU:hU;case"left":case"right":return t?Nge:zge;default:return[]}}function Bge(e,t,n,r){const a=sx(e);let u=Fge(gp(e),n==="start",r);return a&&(u=u.map(f=>f+"-"+a),t&&(u=u.concat(u.map(OP)))),u}function ZA(e){return e.replace(/left|right|bottom|top/g,t=>Mge[t])}function jge(e){return{top:0,right:0,bottom:0,left:0,...e}}function KX(e){return typeof e!="number"?jge(e):{top:e,right:e,bottom:e,left:e}}function XA(e){const{x:t,y:n,width:r,height:a}=e;return{width:r,height:a,top:n,left:t,right:t+r,bottom:n+a,x:t,y:n}}function fU(e,t,n){let{reference:r,floating:a}=e;const u=Yh(t),f=pL(t),s=fL(f),v=gp(t),x=u==="y",A=r.x+r.width/2-a.width/2,C=r.y+r.height/2-a.height/2,P=r[s]/2-a[s]/2;let L;switch(v){case"top":L={x:A,y:r.y-a.height};break;case"bottom":L={x:A,y:r.y+r.height};break;case"right":L={x:r.x+r.width,y:C};break;case"left":L={x:r.x-a.width,y:C};break;default:L={x:r.x,y:r.y}}switch(sx(t)){case"start":L[f]-=P*(n&&x?-1:1);break;case"end":L[f]+=P*(n&&x?-1:1);break}return L}const Uge=async(e,t,n)=>{const{placement:r="bottom",strategy:a="absolute",middleware:u=[],platform:f}=n,s=u.filter(Boolean),v=await(f.isRTL==null?void 0:f.isRTL(t));let x=await f.getElementRects({reference:e,floating:t,strategy:a}),{x:A,y:C}=fU(x,r,v),P=r,L={},F=0;for(let U=0;U<s.length;U++){const{name:q,fn:G}=s[U],{x:$,y:X,data:ie,reset:de}=await G({x:A,y:C,initialPlacement:r,placement:P,strategy:a,middlewareData:L,rects:x,platform:f,elements:{reference:e,floating:t}});A=$??A,C=X??C,L={...L,[q]:{...L[q],...ie}},de&&F<=50&&(F++,typeof de=="object"&&(de.placement&&(P=de.placement),de.rects&&(x=de.rects===!0?await f.getElementRects({reference:e,floating:t,strategy:a}):de.rects),{x:A,y:C}=fU(x,P,v)),U=-1)}return{x:A,y:C,placement:P,strategy:a,middlewareData:L}};async function G2(e,t){var n;t===void 0&&(t={});const{x:r,y:a,platform:u,rects:f,elements:s,strategy:v}=e,{boundary:x="clippingAncestors",rootBoundary:A="viewport",elementContext:C="floating",altBoundary:P=!1,padding:L=0}=mp(t,e),F=KX(L),q=s[P?C==="floating"?"reference":"floating":C],G=XA(await u.getClippingRect({element:(n=await(u.isElement==null?void 0:u.isElement(q)))==null||n?q:q.contextElement||await(u.getDocumentElement==null?void 0:u.getDocumentElement(s.floating)),boundary:x,rootBoundary:A,strategy:v})),$=C==="floating"?{x:r,y:a,width:f.floating.width,height:f.floating.height}:f.reference,X=await(u.getOffsetParent==null?void 0:u.getOffsetParent(s.floating)),ie=await(u.isElement==null?void 0:u.isElement(X))?await(u.getScale==null?void 0:u.getScale(X))||{x:1,y:1}:{x:1,y:1},de=XA(u.convertOffsetParentRelativeRectToViewportRelativeRect?await u.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:$,offsetParent:X,strategy:v}):$);return{top:(G.top-de.top+F.top)/ie.y,bottom:(de.bottom-G.bottom+F.bottom)/ie.y,left:(G.left-de.left+F.left)/ie.x,right:(de.right-G.right+F.right)/ie.x}}const Vge=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:r,placement:a,rects:u,platform:f,elements:s,middlewareData:v}=t,{element:x,padding:A=0}=mp(e,t)||{};if(x==null)return{};const C=KX(A),P={x:n,y:r},L=pL(a),F=fL(L),U=await f.getDimensions(x),q=L==="y",G=q?"top":"left",$=q?"bottom":"right",X=q?"clientHeight":"clientWidth",ie=u.reference[F]+u.reference[L]-P[L]-u.floating[F],de=P[L]-u.reference[L],fe=await(f.getOffsetParent==null?void 0:f.getOffsetParent(x));let be=fe?fe[X]:0;(!be||!await(f.isElement==null?void 0:f.isElement(fe)))&&(be=s.floating[X]||u.floating[F]);const ve=ie/2-de/2,Qe=be/2-U[F]/2-1,we=u0(C[G],Qe),qe=u0(C[$],Qe),Je=we,ft=be-U[F]-qe,Mt=be/2-U[F]/2+ve,Pt=PP(Je,Mt,ft),Nt=!v.arrow&&sx(a)!=null&&Mt!==Pt&&u.reference[F]/2-(Mt<Je?we:qe)-U[F]/2<0,Kt=Nt?Mt<Je?Mt-Je:Mt-ft:0;return{[L]:P[L]+Kt,data:{[L]:Pt,centerOffset:Mt-Pt-Kt,...Nt&&{alignmentOffset:Kt}},reset:Nt}}}),$ge=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,r;const{placement:a,middlewareData:u,rects:f,initialPlacement:s,platform:v,elements:x}=t,{mainAxis:A=!0,crossAxis:C=!0,fallbackPlacements:P,fallbackStrategy:L="bestFit",fallbackAxisSideDirection:F="none",flipAlignment:U=!0,...q}=mp(e,t);if((n=u.arrow)!=null&&n.alignmentOffset)return{};const G=gp(a),$=Yh(s),X=gp(s)===s,ie=await(v.isRTL==null?void 0:v.isRTL(x.floating)),de=P||(X||!U?[ZA(s)]:Dge(s)),fe=F!=="none";!P&&fe&&de.push(...Bge(s,U,F,ie));const be=[s,...de],ve=await G2(t,q),Qe=[];let we=((r=u.flip)==null?void 0:r.overflows)||[];if(A&&Qe.push(ve[G]),C){const Mt=Lge(a,f,ie);Qe.push(ve[Mt[0]],ve[Mt[1]])}if(we=[...we,{placement:a,overflows:Qe}],!Qe.every(Mt=>Mt<=0)){var qe,Je;const Mt=(((qe=u.flip)==null?void 0:qe.index)||0)+1,Pt=be[Mt];if(Pt&&(!(C==="alignment"?$!==Yh(Pt):!1)||we.every(tt=>Yh(tt.placement)===$?tt.overflows[0]>0:!0)))return{data:{index:Mt,overflows:we},reset:{placement:Pt}};let Nt=(Je=we.filter(Kt=>Kt.overflows[0]<=0).sort((Kt,tt)=>Kt.overflows[1]-tt.overflows[1])[0])==null?void 0:Je.placement;if(!Nt)switch(L){case"bestFit":{var ft;const Kt=(ft=we.filter(tt=>{if(fe){const mt=Yh(tt.placement);return mt===$||mt==="y"}return!0}).map(tt=>[tt.placement,tt.overflows.filter(mt=>mt>0).reduce((mt,Pe)=>mt+Pe,0)]).sort((tt,mt)=>tt[1]-mt[1])[0])==null?void 0:ft[0];Kt&&(Nt=Kt);break}case"initialPlacement":Nt=s;break}if(a!==Nt)return{reset:{placement:Nt}}}return{}}}};function pU(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function mU(e){return Rge.some(t=>e[t]>=0)}const Hge=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:r="referenceHidden",...a}=mp(e,t);switch(r){case"referenceHidden":{const u=await G2(t,{...a,elementContext:"reference"}),f=pU(u,n.reference);return{data:{referenceHiddenOffsets:f,referenceHidden:mU(f)}}}case"escaped":{const u=await G2(t,{...a,altBoundary:!0}),f=pU(u,n.floating);return{data:{escapedOffsets:f,escaped:mU(f)}}}default:return{}}}}},QX=new Set(["left","top"]);async function Gge(e,t){const{placement:n,platform:r,elements:a}=e,u=await(r.isRTL==null?void 0:r.isRTL(a.floating)),f=gp(n),s=sx(n),v=Yh(n)==="y",x=QX.has(f)?-1:1,A=u&&v?-1:1,C=mp(t,e);let{mainAxis:P,crossAxis:L,alignmentAxis:F}=typeof C=="number"?{mainAxis:C,crossAxis:0,alignmentAxis:null}:{mainAxis:C.mainAxis||0,crossAxis:C.crossAxis||0,alignmentAxis:C.alignmentAxis};return s&&typeof F=="number"&&(L=s==="end"?F*-1:F),v?{x:L*A,y:P*x}:{x:P*x,y:L*A}}const qge=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,r;const{x:a,y:u,placement:f,middlewareData:s}=t,v=await Gge(t,e);return f===((n=s.offset)==null?void 0:n.placement)&&(r=s.arrow)!=null&&r.alignmentOffset?{}:{x:a+v.x,y:u+v.y,data:{...v,placement:f}}}}},Wge=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:r,placement:a}=t,{mainAxis:u=!0,crossAxis:f=!1,limiter:s={fn:q=>{let{x:G,y:$}=q;return{x:G,y:$}}},...v}=mp(e,t),x={x:n,y:r},A=await G2(t,v),C=Yh(gp(a)),P=hL(C);let L=x[P],F=x[C];if(u){const q=P==="y"?"top":"left",G=P==="y"?"bottom":"right",$=L+A[q],X=L-A[G];L=PP($,L,X)}if(f){const q=C==="y"?"top":"left",G=C==="y"?"bottom":"right",$=F+A[q],X=F-A[G];F=PP($,F,X)}const U=s.fn({...t,[P]:L,[C]:F});return{...U,data:{x:U.x-n,y:U.y-r,enabled:{[P]:u,[C]:f}}}}}},Zge=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:n,y:r,placement:a,rects:u,middlewareData:f}=t,{offset:s=0,mainAxis:v=!0,crossAxis:x=!0}=mp(e,t),A={x:n,y:r},C=Yh(a),P=hL(C);let L=A[P],F=A[C];const U=mp(s,t),q=typeof U=="number"?{mainAxis:U,crossAxis:0}:{mainAxis:0,crossAxis:0,...U};if(v){const X=P==="y"?"height":"width",ie=u.reference[P]-u.floating[X]+q.mainAxis,de=u.reference[P]+u.reference[X]-q.mainAxis;L<ie?L=ie:L>de&&(L=de)}if(x){var G,$;const X=P==="y"?"width":"height",ie=QX.has(gp(a)),de=u.reference[C]-u.floating[X]+(ie&&((G=f.offset)==null?void 0:G[C])||0)+(ie?0:q.crossAxis),fe=u.reference[C]+u.reference[X]+(ie?0:(($=f.offset)==null?void 0:$[C])||0)-(ie?q.crossAxis:0);F<de?F=de:F>fe&&(F=fe)}return{[P]:L,[C]:F}}}},Xge=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var n,r;const{placement:a,rects:u,platform:f,elements:s}=t,{apply:v=()=>{},...x}=mp(e,t),A=await G2(t,x),C=gp(a),P=sx(a),L=Yh(a)==="y",{width:F,height:U}=u.floating;let q,G;C==="top"||C==="bottom"?(q=C,G=P===(await(f.isRTL==null?void 0:f.isRTL(s.floating))?"start":"end")?"left":"right"):(G=C,q=P==="end"?"top":"bottom");const $=U-A.top-A.bottom,X=F-A.left-A.right,ie=u0(U-A[q],$),de=u0(F-A[G],X),fe=!t.middlewareData.shift;let be=ie,ve=de;if((n=t.middlewareData.shift)!=null&&n.enabled.x&&(ve=X),(r=t.middlewareData.shift)!=null&&r.enabled.y&&(be=$),fe&&!P){const we=Tc(A.left,0),qe=Tc(A.right,0),Je=Tc(A.top,0),ft=Tc(A.bottom,0);L?ve=F-2*(we!==0||qe!==0?we+qe:Tc(A.left,A.right)):be=U-2*(Je!==0||ft!==0?Je+ft:Tc(A.top,A.bottom))}await v({...t,availableWidth:ve,availableHeight:be});const Qe=await f.getDimensions(s.floating);return F!==Qe.width||U!==Qe.height?{reset:{rects:!0}}:{}}}};function ZC(){return typeof window<"u"}function ax(e){return JX(e)?(e.nodeName||"").toLowerCase():"#document"}function kc(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function hf(e){var t;return(t=(JX(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function JX(e){return ZC()?e instanceof Node||e instanceof kc(e).Node:!1}function oh(e){return ZC()?e instanceof Element||e instanceof kc(e).Element:!1}function uf(e){return ZC()?e instanceof HTMLElement||e instanceof kc(e).HTMLElement:!1}function gU(e){return!ZC()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof kc(e).ShadowRoot}const Yge=new Set(["inline","contents"]);function ET(e){const{overflow:t,overflowX:n,overflowY:r,display:a}=lh(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!Yge.has(a)}const Kge=new Set(["table","td","th"]);function Qge(e){return Kge.has(ax(e))}const Jge=[":popover-open",":modal"];function XC(e){return Jge.some(t=>{try{return e.matches(t)}catch{return!1}})}const e_e=["transform","translate","scale","rotate","perspective"],t_e=["transform","translate","scale","rotate","perspective","filter"],n_e=["paint","layout","strict","content"];function mL(e){const t=gL(),n=oh(e)?lh(e):e;return e_e.some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||t_e.some(r=>(n.willChange||"").includes(r))||n_e.some(r=>(n.contain||"").includes(r))}function r_e(e){let t=c0(e);for(;uf(t)&&!zv(t);){if(mL(t))return t;if(XC(t))return null;t=c0(t)}return null}function gL(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const i_e=new Set(["html","body","#document"]);function zv(e){return i_e.has(ax(e))}function lh(e){return kc(e).getComputedStyle(e)}function YC(e){return oh(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function c0(e){if(ax(e)==="html")return e;const t=e.assignedSlot||e.parentNode||gU(e)&&e.host||hf(e);return gU(t)?t.host:t}function eY(e){const t=c0(e);return zv(t)?e.ownerDocument?e.ownerDocument.body:e.body:uf(t)&&ET(t)?t:eY(t)}function q2(e,t,n){var r;t===void 0&&(t=[]),n===void 0&&(n=!0);const a=eY(e),u=a===((r=e.ownerDocument)==null?void 0:r.body),f=kc(a);if(u){const s=LP(f);return t.concat(f,f.visualViewport||[],ET(a)?a:[],s&&n?q2(s):[])}return t.concat(a,q2(a,[],n))}function LP(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function tY(e){const t=lh(e);let n=parseFloat(t.width)||0,r=parseFloat(t.height)||0;const a=uf(e),u=a?e.offsetWidth:n,f=a?e.offsetHeight:r,s=WA(n)!==u||WA(r)!==f;return s&&(n=u,r=f),{width:n,height:r,$:s}}function _L(e){return oh(e)?e:e.contextElement}function tv(e){const t=_L(e);if(!uf(t))return rf(1);const n=t.getBoundingClientRect(),{width:r,height:a,$:u}=tY(t);let f=(u?WA(n.width):n.width)/r,s=(u?WA(n.height):n.height)/a;return(!f||!Number.isFinite(f))&&(f=1),(!s||!Number.isFinite(s))&&(s=1),{x:f,y:s}}const s_e=rf(0);function nY(e){const t=kc(e);return!gL()||!t.visualViewport?s_e:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function a_e(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==kc(e)?!1:t}function d_(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1);const a=e.getBoundingClientRect(),u=_L(e);let f=rf(1);t&&(r?oh(r)&&(f=tv(r)):f=tv(e));const s=a_e(u,n,r)?nY(u):rf(0);let v=(a.left+s.x)/f.x,x=(a.top+s.y)/f.y,A=a.width/f.x,C=a.height/f.y;if(u){const P=kc(u),L=r&&oh(r)?kc(r):r;let F=P,U=LP(F);for(;U&&r&&L!==F;){const q=tv(U),G=U.getBoundingClientRect(),$=lh(U),X=G.left+(U.clientLeft+parseFloat($.paddingLeft))*q.x,ie=G.top+(U.clientTop+parseFloat($.paddingTop))*q.y;v*=q.x,x*=q.y,A*=q.x,C*=q.y,v+=X,x+=ie,F=kc(U),U=LP(F)}}return XA({width:A,height:C,x:v,y:x})}function KC(e,t){const n=YC(e).scrollLeft;return t?t.left+n:d_(hf(e)).left+n}function rY(e,t){const n=e.getBoundingClientRect(),r=n.left+t.scrollLeft-KC(e,n),a=n.top+t.scrollTop;return{x:r,y:a}}function o_e(e){let{elements:t,rect:n,offsetParent:r,strategy:a}=e;const u=a==="fixed",f=hf(r),s=t?XC(t.floating):!1;if(r===f||s&&u)return n;let v={scrollLeft:0,scrollTop:0},x=rf(1);const A=rf(0),C=uf(r);if((C||!C&&!u)&&((ax(r)!=="body"||ET(f))&&(v=YC(r)),uf(r))){const L=d_(r);x=tv(r),A.x=L.x+r.clientLeft,A.y=L.y+r.clientTop}const P=f&&!C&&!u?rY(f,v):rf(0);return{width:n.width*x.x,height:n.height*x.y,x:n.x*x.x-v.scrollLeft*x.x+A.x+P.x,y:n.y*x.y-v.scrollTop*x.y+A.y+P.y}}function l_e(e){return Array.from(e.getClientRects())}function u_e(e){const t=hf(e),n=YC(e),r=e.ownerDocument.body,a=Tc(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),u=Tc(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight);let f=-n.scrollLeft+KC(e);const s=-n.scrollTop;return lh(r).direction==="rtl"&&(f+=Tc(t.clientWidth,r.clientWidth)-a),{width:a,height:u,x:f,y:s}}const _U=25;function c_e(e,t){const n=kc(e),r=hf(e),a=n.visualViewport;let u=r.clientWidth,f=r.clientHeight,s=0,v=0;if(a){u=a.width,f=a.height;const A=gL();(!A||A&&t==="fixed")&&(s=a.offsetLeft,v=a.offsetTop)}const x=KC(r);if(x<=0){const A=r.ownerDocument,C=A.body,P=getComputedStyle(C),L=A.compatMode==="CSS1Compat"&&parseFloat(P.marginLeft)+parseFloat(P.marginRight)||0,F=Math.abs(r.clientWidth-C.clientWidth-L);F<=_U&&(u-=F)}else x<=_U&&(u+=x);return{width:u,height:f,x:s,y:v}}const d_e=new Set(["absolute","fixed"]);function h_e(e,t){const n=d_(e,!0,t==="fixed"),r=n.top+e.clientTop,a=n.left+e.clientLeft,u=uf(e)?tv(e):rf(1),f=e.clientWidth*u.x,s=e.clientHeight*u.y,v=a*u.x,x=r*u.y;return{width:f,height:s,x:v,y:x}}function yU(e,t,n){let r;if(t==="viewport")r=c_e(e,n);else if(t==="document")r=u_e(hf(e));else if(oh(t))r=h_e(t,n);else{const a=nY(e);r={x:t.x-a.x,y:t.y-a.y,width:t.width,height:t.height}}return XA(r)}function iY(e,t){const n=c0(e);return n===t||!oh(n)||zv(n)?!1:lh(n).position==="fixed"||iY(n,t)}function f_e(e,t){const n=t.get(e);if(n)return n;let r=q2(e,[],!1).filter(s=>oh(s)&&ax(s)!=="body"),a=null;const u=lh(e).position==="fixed";let f=u?c0(e):e;for(;oh(f)&&!zv(f);){const s=lh(f),v=mL(f);!v&&s.position==="fixed"&&(a=null),(u?!v&&!a:!v&&s.position==="static"&&!!a&&d_e.has(a.position)||ET(f)&&!v&&iY(e,f))?r=r.filter(A=>A!==f):a=s,f=c0(f)}return t.set(e,r),r}function p_e(e){let{element:t,boundary:n,rootBoundary:r,strategy:a}=e;const f=[...n==="clippingAncestors"?XC(t)?[]:f_e(t,this._c):[].concat(n),r],s=f[0],v=f.reduce((x,A)=>{const C=yU(t,A,a);return x.top=Tc(C.top,x.top),x.right=u0(C.right,x.right),x.bottom=u0(C.bottom,x.bottom),x.left=Tc(C.left,x.left),x},yU(t,s,a));return{width:v.right-v.left,height:v.bottom-v.top,x:v.left,y:v.top}}function m_e(e){const{width:t,height:n}=tY(e);return{width:t,height:n}}function g_e(e,t,n){const r=uf(t),a=hf(t),u=n==="fixed",f=d_(e,!0,u,t);let s={scrollLeft:0,scrollTop:0};const v=rf(0);function x(){v.x=KC(a)}if(r||!r&&!u)if((ax(t)!=="body"||ET(a))&&(s=YC(t)),r){const L=d_(t,!0,u,t);v.x=L.x+t.clientLeft,v.y=L.y+t.clientTop}else a&&x();u&&!r&&a&&x();const A=a&&!r&&!u?rY(a,s):rf(0),C=f.left+s.scrollLeft-v.x-A.x,P=f.top+s.scrollTop-v.y-A.y;return{x:C,y:P,width:f.width,height:f.height}}function w5(e){return lh(e).position==="static"}function vU(e,t){if(!uf(e)||lh(e).position==="fixed")return null;if(t)return t(e);let n=e.offsetParent;return hf(e)===n&&(n=n.ownerDocument.body),n}function sY(e,t){const n=kc(e);if(XC(e))return n;if(!uf(e)){let a=c0(e);for(;a&&!zv(a);){if(oh(a)&&!w5(a))return a;a=c0(a)}return n}let r=vU(e,t);for(;r&&Qge(r)&&w5(r);)r=vU(r,t);return r&&zv(r)&&w5(r)&&!mL(r)?n:r||r_e(e)||n}const __e=async function(e){const t=this.getOffsetParent||sY,n=this.getDimensions,r=await n(e.floating);return{reference:g_e(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function y_e(e){return lh(e).direction==="rtl"}const v_e={convertOffsetParentRelativeRectToViewportRelativeRect:o_e,getDocumentElement:hf,getClippingRect:p_e,getOffsetParent:sY,getElementRects:__e,getClientRects:l_e,getDimensions:m_e,getScale:tv,isElement:oh,isRTL:y_e};function aY(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function x_e(e,t){let n=null,r;const a=hf(e);function u(){var s;clearTimeout(r),(s=n)==null||s.disconnect(),n=null}function f(s,v){s===void 0&&(s=!1),v===void 0&&(v=1),u();const x=e.getBoundingClientRect(),{left:A,top:C,width:P,height:L}=x;if(s||t(),!P||!L)return;const F=_3(C),U=_3(a.clientWidth-(A+P)),q=_3(a.clientHeight-(C+L)),G=_3(A),X={rootMargin:-F+"px "+-U+"px "+-q+"px "+-G+"px",threshold:Tc(0,u0(1,v))||1};let ie=!0;function de(fe){const be=fe[0].intersectionRatio;if(be!==v){if(!ie)return f();be?f(!1,be):r=setTimeout(()=>{f(!1,1e-7)},1e3)}be===1&&!aY(x,e.getBoundingClientRect())&&f(),ie=!1}try{n=new IntersectionObserver(de,{...X,root:a.ownerDocument})}catch{n=new IntersectionObserver(de,X)}n.observe(e)}return f(!0),u}function b_e(e,t,n,r){r===void 0&&(r={});const{ancestorScroll:a=!0,ancestorResize:u=!0,elementResize:f=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:v=!1}=r,x=_L(e),A=a||u?[...x?q2(x):[],...q2(t)]:[];A.forEach(G=>{a&&G.addEventListener("scroll",n,{passive:!0}),u&&G.addEventListener("resize",n)});const C=x&&s?x_e(x,n):null;let P=-1,L=null;f&&(L=new ResizeObserver(G=>{let[$]=G;$&&$.target===x&&L&&(L.unobserve(t),cancelAnimationFrame(P),P=requestAnimationFrame(()=>{var X;(X=L)==null||X.observe(t)})),n()}),x&&!v&&L.observe(x),L.observe(t));let F,U=v?d_(e):null;v&&q();function q(){const G=d_(e);U&&!aY(U,G)&&n(),U=G,F=requestAnimationFrame(q)}return n(),()=>{var G;A.forEach($=>{a&&$.removeEventListener("scroll",n),u&&$.removeEventListener("resize",n)}),C==null||C(),(G=L)==null||G.disconnect(),L=null,v&&cancelAnimationFrame(F)}}const w_e=qge,T_e=Wge,E_e=$ge,S_e=Xge,A_e=Hge,xU=Vge,C_e=Zge,k_e=(e,t,n)=>{const r=new Map,a={platform:v_e,...n},u={...a.platform,_c:r};return Uge(e,t,{...a,platform:u})};var I_e=typeof document<"u",R_e=function(){},O4=I_e?B.useLayoutEffect:R_e;function YA(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,r,a;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(r=n;r--!==0;)if(!YA(e[r],t[r]))return!1;return!0}if(a=Object.keys(e),n=a.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(t,a[r]))return!1;for(r=n;r--!==0;){const u=a[r];if(!(u==="_owner"&&e.$$typeof)&&!YA(e[u],t[u]))return!1}return!0}return e!==e&&t!==t}function oY(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function bU(e,t){const n=oY(e);return Math.round(t*n)/n}function T5(e){const t=B.useRef(e);return O4(()=>{t.current=e}),t}function M_e(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:a,elements:{reference:u,floating:f}={},transform:s=!0,whileElementsMounted:v,open:x}=e,[A,C]=B.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[P,L]=B.useState(r);YA(P,r)||L(r);const[F,U]=B.useState(null),[q,G]=B.useState(null),$=B.useCallback(tt=>{tt!==fe.current&&(fe.current=tt,U(tt))},[]),X=B.useCallback(tt=>{tt!==be.current&&(be.current=tt,G(tt))},[]),ie=u||F,de=f||q,fe=B.useRef(null),be=B.useRef(null),ve=B.useRef(A),Qe=v!=null,we=T5(v),qe=T5(a),Je=T5(x),ft=B.useCallback(()=>{if(!fe.current||!be.current)return;const tt={placement:t,strategy:n,middleware:P};qe.current&&(tt.platform=qe.current),k_e(fe.current,be.current,tt).then(mt=>{const Pe={...mt,isPositioned:Je.current!==!1};Mt.current&&!YA(ve.current,Pe)&&(ve.current=Pe,xT.flushSync(()=>{C(Pe)}))})},[P,t,n,qe,Je]);O4(()=>{x===!1&&ve.current.isPositioned&&(ve.current.isPositioned=!1,C(tt=>({...tt,isPositioned:!1})))},[x]);const Mt=B.useRef(!1);O4(()=>(Mt.current=!0,()=>{Mt.current=!1}),[]),O4(()=>{if(ie&&(fe.current=ie),de&&(be.current=de),ie&&de){if(we.current)return we.current(ie,de,ft);ft()}},[ie,de,ft,we,Qe]);const Pt=B.useMemo(()=>({reference:fe,floating:be,setReference:$,setFloating:X}),[$,X]),Nt=B.useMemo(()=>({reference:ie,floating:de}),[ie,de]),Kt=B.useMemo(()=>{const tt={position:n,left:0,top:0};if(!Nt.floating)return tt;const mt=bU(Nt.floating,A.x),Pe=bU(Nt.floating,A.y);return s?{...tt,transform:"translate("+mt+"px, "+Pe+"px)",...oY(Nt.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:mt,top:Pe}},[n,s,Nt.floating,A.x,A.y]);return B.useMemo(()=>({...A,update:ft,refs:Pt,elements:Nt,floatingStyles:Kt}),[A,ft,Pt,Nt,Kt])}const P_e=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:r,padding:a}=typeof e=="function"?e(n):e;return r&&t(r)?r.current!=null?xU({element:r.current,padding:a}).fn(n):{}:r?xU({element:r,padding:a}).fn(n):{}}}},O_e=(e,t)=>({...w_e(e),options:[e,t]}),L_e=(e,t)=>({...T_e(e),options:[e,t]}),D_e=(e,t)=>({...C_e(e),options:[e,t]}),N_e=(e,t)=>({...E_e(e),options:[e,t]}),z_e=(e,t)=>({...S_e(e),options:[e,t]}),F_e=(e,t)=>({...A_e(e),options:[e,t]}),B_e=(e,t)=>({...P_e(e),options:[e,t]});var j_e="Arrow",lY=B.forwardRef((e,t)=>{const{children:n,width:r=10,height:a=5,...u}=e;return k.jsx(Vl.svg,{...u,ref:t,width:r,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:k.jsx("polygon",{points:"0,0 30,0 15,10"})})});lY.displayName=j_e;var U_e=lY;function V_e(e){const[t,n]=B.useState(void 0);return l0(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const r=new ResizeObserver(a=>{if(!Array.isArray(a)||!a.length)return;const u=a[0];let f,s;if("borderBoxSize"in u){const v=u.borderBoxSize,x=Array.isArray(v)?v[0]:v;f=x.inlineSize,s=x.blockSize}else f=e.offsetWidth,s=e.offsetHeight;n({width:f,height:s})});return r.observe(e,{box:"border-box"}),()=>r.unobserve(e)}else n(void 0)},[e]),t}var yL="Popper",[uY,QC]=ix(yL),[$_e,cY]=uY(yL),dY=e=>{const{__scopePopper:t,children:n}=e,[r,a]=B.useState(null);return k.jsx($_e,{scope:t,anchor:r,onAnchorChange:a,children:n})};dY.displayName=yL;var hY="PopperAnchor",fY=B.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:r,...a}=e,u=cY(hY,n),f=B.useRef(null),s=ru(t,f),v=B.useRef(null);return B.useEffect(()=>{const x=v.current;v.current=(r==null?void 0:r.current)||f.current,x!==v.current&&u.onAnchorChange(v.current)}),r?null:k.jsx(Vl.div,{...a,ref:s})});fY.displayName=hY;var vL="PopperContent",[H_e,G_e]=uY(vL),pY=B.forwardRef((e,t)=>{var Nn,bn,Vt,En,Sn,Un;const{__scopePopper:n,side:r="bottom",sideOffset:a=0,align:u="center",alignOffset:f=0,arrowPadding:s=0,avoidCollisions:v=!0,collisionBoundary:x=[],collisionPadding:A=0,sticky:C="partial",hideWhenDetached:P=!1,updatePositionStrategy:L="optimized",onPlaced:F,...U}=e,q=cY(vL,n),[G,$]=B.useState(null),X=ru(t,nn=>$(nn)),[ie,de]=B.useState(null),fe=V_e(ie),be=(fe==null?void 0:fe.width)??0,ve=(fe==null?void 0:fe.height)??0,Qe=r+(u!=="center"?"-"+u:""),we=typeof A=="number"?A:{top:0,right:0,bottom:0,left:0,...A},qe=Array.isArray(x)?x:[x],Je=qe.length>0,ft={padding:we,boundary:qe.filter(W_e),altBoundary:Je},{refs:Mt,floatingStyles:Pt,placement:Nt,isPositioned:Kt,middlewareData:tt}=M_e({strategy:"fixed",placement:Qe,whileElementsMounted:(...nn)=>b_e(...nn,{animationFrame:L==="always"}),elements:{reference:q.anchor},middleware:[O_e({mainAxis:a+ve,alignmentAxis:f}),v&&L_e({mainAxis:!0,crossAxis:!1,limiter:C==="partial"?D_e():void 0,...ft}),v&&N_e({...ft}),z_e({...ft,apply:({elements:nn,rects:wr,availableWidth:Xr,availableHeight:ar})=>{const{width:tr,height:Vn}=wr.reference,xr=nn.floating.style;xr.setProperty("--radix-popper-available-width",`${Xr}px`),xr.setProperty("--radix-popper-available-height",`${ar}px`),xr.setProperty("--radix-popper-anchor-width",`${tr}px`),xr.setProperty("--radix-popper-anchor-height",`${Vn}px`)}}),ie&&B_e({element:ie,padding:s}),Z_e({arrowWidth:be,arrowHeight:ve}),P&&F_e({strategy:"referenceHidden",...ft})]}),[mt,Pe]=_Y(Nt),gn=lf(F);l0(()=>{Kt&&(gn==null||gn())},[Kt,gn]);const Et=(Nn=tt.arrow)==null?void 0:Nn.x,ze=(bn=tt.arrow)==null?void 0:bn.y,$t=((Vt=tt.arrow)==null?void 0:Vt.centerOffset)!==0,[Cn,fn]=B.useState();return l0(()=>{G&&fn(window.getComputedStyle(G).zIndex)},[G]),k.jsx("div",{ref:Mt.setFloating,"data-radix-popper-content-wrapper":"",style:{...Pt,transform:Kt?Pt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Cn,"--radix-popper-transform-origin":[(En=tt.transformOrigin)==null?void 0:En.x,(Sn=tt.transformOrigin)==null?void 0:Sn.y].join(" "),...((Un=tt.hide)==null?void 0:Un.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:k.jsx(H_e,{scope:n,placedSide:mt,onArrowChange:de,arrowX:Et,arrowY:ze,shouldHideArrow:$t,children:k.jsx(Vl.div,{"data-side":mt,"data-align":Pe,...U,ref:X,style:{...U.style,animation:Kt?void 0:"none"}})})})});pY.displayName=vL;var mY="PopperArrow",q_e={top:"bottom",right:"left",bottom:"top",left:"right"},gY=B.forwardRef(function(t,n){const{__scopePopper:r,...a}=t,u=G_e(mY,r),f=q_e[u.placedSide];return k.jsx("span",{ref:u.onArrowChange,style:{position:"absolute",left:u.arrowX,top:u.arrowY,[f]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[u.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[u.placedSide],visibility:u.shouldHideArrow?"hidden":void 0},children:k.jsx(U_e,{...a,ref:n,style:{...a.style,display:"block"}})})});gY.displayName=mY;function W_e(e){return e!==null}var Z_e=e=>({name:"transformOrigin",options:e,fn(t){var q,G,$;const{placement:n,rects:r,middlewareData:a}=t,f=((q=a.arrow)==null?void 0:q.centerOffset)!==0,s=f?0:e.arrowWidth,v=f?0:e.arrowHeight,[x,A]=_Y(n),C={start:"0%",center:"50%",end:"100%"}[A],P=(((G=a.arrow)==null?void 0:G.x)??0)+s/2,L=((($=a.arrow)==null?void 0:$.y)??0)+v/2;let F="",U="";return x==="bottom"?(F=f?C:`${P}px`,U=`${-v}px`):x==="top"?(F=f?C:`${P}px`,U=`${r.floating.height+v}px`):x==="right"?(F=`${-v}px`,U=f?C:`${L}px`):x==="left"&&(F=`${r.floating.width+v}px`,U=f?C:`${L}px`),{data:{x:F,y:U}}}});function _Y(e){const[t,n="center"]=e.split("-");return[t,n]}var xL=dY,yY=fY,vY=pY,xY=gY,X_e="Portal",bL=B.forwardRef((e,t)=>{var s;const{container:n,...r}=e,[a,u]=B.useState(!1);l0(()=>u(!0),[]);const f=n||a&&((s=globalThis==null?void 0:globalThis.document)==null?void 0:s.body);return f?uue.createPortal(k.jsx(Vl.div,{...r,ref:t}),f):null});bL.displayName=X_e;function Y_e(e,t){return B.useReducer((n,r)=>t[n][r]??n,e)}var T_=e=>{const{present:t,children:n}=e,r=K_e(t),a=typeof n=="function"?n({present:r.isPresent}):B.Children.only(n),u=ru(r.ref,Q_e(a));return typeof n=="function"||r.isPresent?B.cloneElement(a,{ref:u}):null};T_.displayName="Presence";function K_e(e){const[t,n]=B.useState(),r=B.useRef(null),a=B.useRef(e),u=B.useRef("none"),f=e?"mounted":"unmounted",[s,v]=Y_e(f,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return B.useEffect(()=>{const x=y3(r.current);u.current=s==="mounted"?x:"none"},[s]),l0(()=>{const x=r.current,A=a.current;if(A!==e){const P=u.current,L=y3(x);e?v("MOUNT"):L==="none"||(x==null?void 0:x.display)==="none"?v("UNMOUNT"):v(A&&P!==L?"ANIMATION_OUT":"UNMOUNT"),a.current=e}},[e,v]),l0(()=>{if(t){let x;const A=t.ownerDocument.defaultView??window,C=L=>{const U=y3(r.current).includes(CSS.escape(L.animationName));if(L.target===t&&U&&(v("ANIMATION_END"),!a.current)){const q=t.style.animationFillMode;t.style.animationFillMode="forwards",x=A.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=q)})}},P=L=>{L.target===t&&(u.current=y3(r.current))};return t.addEventListener("animationstart",P),t.addEventListener("animationcancel",C),t.addEventListener("animationend",C),()=>{A.clearTimeout(x),t.removeEventListener("animationstart",P),t.removeEventListener("animationcancel",C),t.removeEventListener("animationend",C)}}else v("ANIMATION_END")},[t,v]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:B.useCallback(x=>{r.current=x?getComputedStyle(x):null,n(x)},[])}}function y3(e){return(e==null?void 0:e.animationName)||"none"}function Q_e(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var J_e=Symbol("radix.slottable");function eye(e){const t=({children:n})=>k.jsx(k.Fragment,{children:n});return t.displayName=`${e}.Slottable`,t.__radixId=J_e,t}var tye=mT[" useInsertionEffect ".trim().toString()]||l0;function JC({prop:e,defaultProp:t,onChange:n=()=>{},caller:r}){const[a,u,f]=nye({defaultProp:t,onChange:n}),s=e!==void 0,v=s?e:a;{const A=B.useRef(e!==void 0);B.useEffect(()=>{const C=A.current;C!==s&&console.warn(`${r} is changing from ${C?"controlled":"uncontrolled"} to ${s?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),A.current=s},[s,r])}const x=B.useCallback(A=>{var C;if(s){const P=rye(A)?A(e):A;P!==e&&((C=f.current)==null||C.call(f,P))}else u(A)},[s,e,u,f]);return[v,x]}function nye({defaultProp:e,onChange:t}){const[n,r]=B.useState(e),a=B.useRef(n),u=B.useRef(t);return tye(()=>{u.current=t},[t]),B.useEffect(()=>{var f;a.current!==n&&((f=u.current)==null||f.call(u,n),a.current=n)},[n,a]),[n,r,u]}function rye(e){return typeof e=="function"}var iye=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),sye="VisuallyHidden",bY=B.forwardRef((e,t)=>k.jsx(Vl.span,{...e,ref:t,style:{...iye,...e.style}}));bY.displayName=sye;var aye=bY,[ek]=ix("Tooltip",[QC]),tk=QC(),wY="TooltipProvider",oye=700,DP="tooltip.open",[lye,wL]=ek(wY),TY=e=>{const{__scopeTooltip:t,delayDuration:n=oye,skipDelayDuration:r=300,disableHoverableContent:a=!1,children:u}=e,f=B.useRef(!0),s=B.useRef(!1),v=B.useRef(0);return B.useEffect(()=>{const x=v.current;return()=>window.clearTimeout(x)},[]),k.jsx(lye,{scope:t,isOpenDelayedRef:f,delayDuration:n,onOpen:B.useCallback(()=>{window.clearTimeout(v.current),f.current=!1},[]),onClose:B.useCallback(()=>{window.clearTimeout(v.current),v.current=window.setTimeout(()=>f.current=!0,r)},[r]),isPointerInTransitRef:s,onPointerInTransitChange:B.useCallback(x=>{s.current=x},[]),disableHoverableContent:a,children:u})};TY.displayName=wY;var W2="Tooltip",[uye,ST]=ek(W2),EY=e=>{const{__scopeTooltip:t,children:n,open:r,defaultOpen:a,onOpenChange:u,disableHoverableContent:f,delayDuration:s}=e,v=wL(W2,e.__scopeTooltip),x=tk(t),[A,C]=B.useState(null),P=Nv(),L=B.useRef(0),F=f??v.disableHoverableContent,U=s??v.delayDuration,q=B.useRef(!1),[G,$]=JC({prop:r,defaultProp:a??!1,onChange:be=>{be?(v.onOpen(),document.dispatchEvent(new CustomEvent(DP))):v.onClose(),u==null||u(be)},caller:W2}),X=B.useMemo(()=>G?q.current?"delayed-open":"instant-open":"closed",[G]),ie=B.useCallback(()=>{window.clearTimeout(L.current),L.current=0,q.current=!1,$(!0)},[$]),de=B.useCallback(()=>{window.clearTimeout(L.current),L.current=0,$(!1)},[$]),fe=B.useCallback(()=>{window.clearTimeout(L.current),L.current=window.setTimeout(()=>{q.current=!0,$(!0),L.current=0},U)},[U,$]);return B.useEffect(()=>()=>{L.current&&(window.clearTimeout(L.current),L.current=0)},[]),k.jsx(xL,{...x,children:k.jsx(uye,{scope:t,contentId:P,open:G,stateAttribute:X,trigger:A,onTriggerChange:C,onTriggerEnter:B.useCallback(()=>{v.isOpenDelayedRef.current?fe():ie()},[v.isOpenDelayedRef,fe,ie]),onTriggerLeave:B.useCallback(()=>{F?de():(window.clearTimeout(L.current),L.current=0)},[de,F]),onOpen:ie,onClose:de,disableHoverableContent:F,children:n})})};EY.displayName=W2;var NP="TooltipTrigger",SY=B.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,a=ST(NP,n),u=wL(NP,n),f=tk(n),s=B.useRef(null),v=ru(t,s,a.onTriggerChange),x=B.useRef(!1),A=B.useRef(!1),C=B.useCallback(()=>x.current=!1,[]);return B.useEffect(()=>()=>document.removeEventListener("pointerup",C),[C]),k.jsx(yY,{asChild:!0,...f,children:k.jsx(Vl.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...r,ref:v,onPointerMove:js(e.onPointerMove,P=>{P.pointerType!=="touch"&&!A.current&&!u.isPointerInTransitRef.current&&(a.onTriggerEnter(),A.current=!0)}),onPointerLeave:js(e.onPointerLeave,()=>{a.onTriggerLeave(),A.current=!1}),onPointerDown:js(e.onPointerDown,()=>{a.open&&a.onClose(),x.current=!0,document.addEventListener("pointerup",C,{once:!0})}),onFocus:js(e.onFocus,()=>{x.current||a.onOpen()}),onBlur:js(e.onBlur,a.onClose),onClick:js(e.onClick,a.onClose)})})});SY.displayName=NP;var TL="TooltipPortal",[cye,dye]=ek(TL,{forceMount:void 0}),AY=e=>{const{__scopeTooltip:t,forceMount:n,children:r,container:a}=e,u=ST(TL,t);return k.jsx(cye,{scope:t,forceMount:n,children:k.jsx(T_,{present:n||u.open,children:k.jsx(bL,{asChild:!0,container:a,children:r})})})};AY.displayName=TL;var Fv="TooltipContent",CY=B.forwardRef((e,t)=>{const n=dye(Fv,e.__scopeTooltip),{forceMount:r=n.forceMount,side:a="top",...u}=e,f=ST(Fv,e.__scopeTooltip);return k.jsx(T_,{present:r||f.open,children:f.disableHoverableContent?k.jsx(kY,{side:a,...u,ref:t}):k.jsx(hye,{side:a,...u,ref:t})})}),hye=B.forwardRef((e,t)=>{const n=ST(Fv,e.__scopeTooltip),r=wL(Fv,e.__scopeTooltip),a=B.useRef(null),u=ru(t,a),[f,s]=B.useState(null),{trigger:v,onClose:x}=n,A=a.current,{onPointerInTransitChange:C}=r,P=B.useCallback(()=>{s(null),C(!1)},[C]),L=B.useCallback((F,U)=>{const q=F.currentTarget,G={x:F.clientX,y:F.clientY},$=gye(G,q.getBoundingClientRect()),X=_ye(G,$),ie=yye(U.getBoundingClientRect()),de=xye([...X,...ie]);s(de),C(!0)},[C]);return B.useEffect(()=>()=>P(),[P]),B.useEffect(()=>{if(v&&A){const F=q=>L(q,A),U=q=>L(q,v);return v.addEventListener("pointerleave",F),A.addEventListener("pointerleave",U),()=>{v.removeEventListener("pointerleave",F),A.removeEventListener("pointerleave",U)}}},[v,A,L,P]),B.useEffect(()=>{if(f){const F=U=>{const q=U.target,G={x:U.clientX,y:U.clientY},$=(v==null?void 0:v.contains(q))||(A==null?void 0:A.contains(q)),X=!vye(G,f);$?P():X&&(P(),x())};return document.addEventListener("pointermove",F),()=>document.removeEventListener("pointermove",F)}},[v,A,f,x,P]),k.jsx(kY,{...e,ref:u})}),[fye,pye]=ek(W2,{isInside:!1}),mye=eye("TooltipContent"),kY=B.forwardRef((e,t)=>{const{__scopeTooltip:n,children:r,"aria-label":a,onEscapeKeyDown:u,onPointerDownOutside:f,...s}=e,v=ST(Fv,n),x=tk(n),{onClose:A}=v;return B.useEffect(()=>(document.addEventListener(DP,A),()=>document.removeEventListener(DP,A)),[A]),B.useEffect(()=>{if(v.trigger){const C=P=>{const L=P.target;L!=null&&L.contains(v.trigger)&&A()};return window.addEventListener("scroll",C,{capture:!0}),()=>window.removeEventListener("scroll",C,{capture:!0})}},[v.trigger,A]),k.jsx(dL,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:u,onPointerDownOutside:f,onFocusOutside:C=>C.preventDefault(),onDismiss:A,children:k.jsxs(vY,{"data-state":v.stateAttribute,...x,...s,ref:t,style:{...s.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[k.jsx(mye,{children:r}),k.jsx(fye,{scope:n,isInside:!0,children:k.jsx(aye,{id:v.contentId,role:"tooltip",children:a||r})})]})})});CY.displayName=Fv;var IY="TooltipArrow",RY=B.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,a=tk(n);return pye(IY,n).isInside?null:k.jsx(xY,{...a,...r,ref:t})});RY.displayName=IY;function gye(e,t){const n=Math.abs(t.top-e.y),r=Math.abs(t.bottom-e.y),a=Math.abs(t.right-e.x),u=Math.abs(t.left-e.x);switch(Math.min(n,r,a,u)){case u:return"left";case a:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function _ye(e,t,n=5){const r=[];switch(t){case"top":r.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case"bottom":r.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case"left":r.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case"right":r.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n});break}return r}function yye(e){const{top:t,right:n,bottom:r,left:a}=e;return[{x:a,y:t},{x:n,y:t},{x:n,y:r},{x:a,y:r}]}function vye(e,t){const{x:n,y:r}=e;let a=!1;for(let u=0,f=t.length-1;u<t.length;f=u++){const s=t[u],v=t[f],x=s.x,A=s.y,C=v.x,P=v.y;A>r!=P>r&&n<(C-x)*(r-A)/(P-A)+x&&(a=!a)}return a}function xye(e){const t=e.slice();return t.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),bye(t)}function bye(e){if(e.length<=1)return e.slice();const t=[];for(let r=0;r<e.length;r++){const a=e[r];for(;t.length>=2;){const u=t[t.length-1],f=t[t.length-2];if((u.x-f.x)*(a.y-f.y)>=(u.y-f.y)*(a.x-f.x))t.pop();else break}t.push(a)}t.pop();const n=[];for(let r=e.length-1;r>=0;r--){const a=e[r];for(;n.length>=2;){const u=n[n.length-1],f=n[n.length-2];if((u.x-f.x)*(a.y-f.y)>=(u.y-f.y)*(a.x-f.x))n.pop();else break}n.push(a)}return n.pop(),t.length===1&&n.length===1&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}var wye=TY,Tye=EY,Eye=SY,Sye=AY,Aye=CY,Cye=RY;function wU(e){const t=kye(e),n=B.forwardRef((r,a)=>{const{children:u,...f}=r,s=B.Children.toArray(u),v=s.find(Rye);if(v){const x=v.props.children,A=s.map(C=>C===v?B.Children.count(x)>1?B.Children.only(null):B.isValidElement(x)?x.props.children:null:C);return k.jsx(t,{...f,ref:a,children:B.isValidElement(x)?B.cloneElement(x,void 0,A):null})}return k.jsx(t,{...f,ref:a,children:u})});return n.displayName=`${e}.Slot`,n}function kye(e){const t=B.forwardRef((n,r)=>{const{children:a,...u}=n;if(B.isValidElement(a)){const f=Pye(a),s=Mye(u,a.props);return a.type!==B.Fragment&&(s.ref=r?w_(r,f):f),B.cloneElement(a,s)}return B.Children.count(a)>1?B.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Iye=Symbol("radix.slottable");function Rye(e){return B.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Iye}function Mye(e,t){const n={...t};for(const r in t){const a=e[r],u=t[r];/^on[A-Z]/.test(r)?a&&u?n[r]=(...s)=>{const v=u(...s);return a(...s),v}:a&&(n[r]=a):r==="style"?n[r]={...a,...u}:r==="className"&&(n[r]=[a,u].filter(Boolean).join(" "))}return{...e,...n}}function Pye(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function MY(e){const t=e+"CollectionProvider",[n,r]=ix(t),[a,u]=n(t,{collectionRef:{current:null},itemMap:new Map}),f=U=>{const{scope:q,children:G}=U,$=ca.useRef(null),X=ca.useRef(new Map).current;return k.jsx(a,{scope:q,itemMap:X,collectionRef:$,children:G})};f.displayName=t;const s=e+"CollectionSlot",v=wU(s),x=ca.forwardRef((U,q)=>{const{scope:G,children:$}=U,X=u(s,G),ie=ru(q,X.collectionRef);return k.jsx(v,{ref:ie,children:$})});x.displayName=s;const A=e+"CollectionItemSlot",C="data-radix-collection-item",P=wU(A),L=ca.forwardRef((U,q)=>{const{scope:G,children:$,...X}=U,ie=ca.useRef(null),de=ru(q,ie),fe=u(A,G);return ca.useEffect(()=>(fe.itemMap.set(ie,{ref:ie,...X}),()=>void fe.itemMap.delete(ie))),k.jsx(P,{[C]:"",ref:de,children:$})});L.displayName=A;function F(U){const q=u(e+"CollectionConsumer",U);return ca.useCallback(()=>{const $=q.collectionRef.current;if(!$)return[];const X=Array.from($.querySelectorAll(`[${C}]`));return Array.from(q.itemMap.values()).sort((fe,be)=>X.indexOf(fe.ref.current)-X.indexOf(be.ref.current))},[q.collectionRef,q.itemMap])}return[{Provider:f,Slot:x,ItemSlot:L},F,r]}var Oye=B.createContext(void 0);function PY(e){const t=B.useContext(Oye);return e||t||"ltr"}var E5=0;function Lye(){B.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??TU()),document.body.insertAdjacentElement("beforeend",e[1]??TU()),E5++,()=>{E5===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),E5--}},[])}function TU(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var S5="focusScope.autoFocusOnMount",A5="focusScope.autoFocusOnUnmount",EU={bubbles:!1,cancelable:!0},Dye="FocusScope",OY=B.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:a,onUnmountAutoFocus:u,...f}=e,[s,v]=B.useState(null),x=lf(a),A=lf(u),C=B.useRef(null),P=ru(t,U=>v(U)),L=B.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;B.useEffect(()=>{if(r){let U=function(X){if(L.paused||!s)return;const ie=X.target;s.contains(ie)?C.current=ie:fm(C.current,{select:!0})},q=function(X){if(L.paused||!s)return;const ie=X.relatedTarget;ie!==null&&(s.contains(ie)||fm(C.current,{select:!0}))},G=function(X){if(document.activeElement===document.body)for(const de of X)de.removedNodes.length>0&&fm(s)};document.addEventListener("focusin",U),document.addEventListener("focusout",q);const $=new MutationObserver(G);return s&&$.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",U),document.removeEventListener("focusout",q),$.disconnect()}}},[r,s,L.paused]),B.useEffect(()=>{if(s){AU.add(L);const U=document.activeElement;if(!s.contains(U)){const G=new CustomEvent(S5,EU);s.addEventListener(S5,x),s.dispatchEvent(G),G.defaultPrevented||(Nye(Uye(LY(s)),{select:!0}),document.activeElement===U&&fm(s))}return()=>{s.removeEventListener(S5,x),setTimeout(()=>{const G=new CustomEvent(A5,EU);s.addEventListener(A5,A),s.dispatchEvent(G),G.defaultPrevented||fm(U??document.body,{select:!0}),s.removeEventListener(A5,A),AU.remove(L)},0)}}},[s,x,A,L]);const F=B.useCallback(U=>{if(!n&&!r||L.paused)return;const q=U.key==="Tab"&&!U.altKey&&!U.ctrlKey&&!U.metaKey,G=document.activeElement;if(q&&G){const $=U.currentTarget,[X,ie]=zye($);X&&ie?!U.shiftKey&&G===ie?(U.preventDefault(),n&&fm(X,{select:!0})):U.shiftKey&&G===X&&(U.preventDefault(),n&&fm(ie,{select:!0})):G===$&&U.preventDefault()}},[n,r,L.paused]);return k.jsx(Vl.div,{tabIndex:-1,...f,ref:P,onKeyDown:F})});OY.displayName=Dye;function Nye(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(fm(r,{select:t}),document.activeElement!==n)return}function zye(e){const t=LY(e),n=SU(t,e),r=SU(t.reverse(),e);return[n,r]}function LY(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const a=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||a?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function SU(e,t){for(const n of e)if(!Fye(n,{upTo:t}))return n}function Fye(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function Bye(e){return e instanceof HTMLInputElement&&"select"in e}function fm(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&Bye(e)&&t&&e.select()}}var AU=jye();function jye(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=CU(e,t),e.unshift(t)},remove(t){var n;e=CU(e,t),(n=e[0])==null||n.resume()}}}function CU(e,t){const n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function Uye(e){return e.filter(t=>t.tagName!=="A")}var C5="rovingFocusGroup.onEntryFocus",Vye={bubbles:!1,cancelable:!0},AT="RovingFocusGroup",[zP,DY,$ye]=MY(AT),[Hye,NY]=ix(AT,[$ye]),[Gye,qye]=Hye(AT),zY=B.forwardRef((e,t)=>k.jsx(zP.Provider,{scope:e.__scopeRovingFocusGroup,children:k.jsx(zP.Slot,{scope:e.__scopeRovingFocusGroup,children:k.jsx(Wye,{...e,ref:t})})}));zY.displayName=AT;var Wye=B.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:a=!1,dir:u,currentTabStopId:f,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:v,onEntryFocus:x,preventScrollOnEntryFocus:A=!1,...C}=e,P=B.useRef(null),L=ru(t,P),F=PY(u),[U,q]=JC({prop:f,defaultProp:s??null,onChange:v,caller:AT}),[G,$]=B.useState(!1),X=lf(x),ie=DY(n),de=B.useRef(!1),[fe,be]=B.useState(0);return B.useEffect(()=>{const ve=P.current;if(ve)return ve.addEventListener(C5,X),()=>ve.removeEventListener(C5,X)},[X]),k.jsx(Gye,{scope:n,orientation:r,dir:F,loop:a,currentTabStopId:U,onItemFocus:B.useCallback(ve=>q(ve),[q]),onItemShiftTab:B.useCallback(()=>$(!0),[]),onFocusableItemAdd:B.useCallback(()=>be(ve=>ve+1),[]),onFocusableItemRemove:B.useCallback(()=>be(ve=>ve-1),[]),children:k.jsx(Vl.div,{tabIndex:G||fe===0?-1:0,"data-orientation":r,...C,ref:L,style:{outline:"none",...e.style},onMouseDown:js(e.onMouseDown,()=>{de.current=!0}),onFocus:js(e.onFocus,ve=>{const Qe=!de.current;if(ve.target===ve.currentTarget&&Qe&&!G){const we=new CustomEvent(C5,Vye);if(ve.currentTarget.dispatchEvent(we),!we.defaultPrevented){const qe=ie().filter(Nt=>Nt.focusable),Je=qe.find(Nt=>Nt.active),ft=qe.find(Nt=>Nt.id===U),Pt=[Je,ft,...qe].filter(Boolean).map(Nt=>Nt.ref.current);jY(Pt,A)}}de.current=!1}),onBlur:js(e.onBlur,()=>$(!1))})})}),FY="RovingFocusGroupItem",BY=B.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:a=!1,tabStopId:u,children:f,...s}=e,v=Nv(),x=u||v,A=qye(FY,n),C=A.currentTabStopId===x,P=DY(n),{onFocusableItemAdd:L,onFocusableItemRemove:F,currentTabStopId:U}=A;return B.useEffect(()=>{if(r)return L(),()=>F()},[r,L,F]),k.jsx(zP.ItemSlot,{scope:n,id:x,focusable:r,active:a,children:k.jsx(Vl.span,{tabIndex:C?0:-1,"data-orientation":A.orientation,...s,ref:t,onMouseDown:js(e.onMouseDown,q=>{r?A.onItemFocus(x):q.preventDefault()}),onFocus:js(e.onFocus,()=>A.onItemFocus(x)),onKeyDown:js(e.onKeyDown,q=>{if(q.key==="Tab"&&q.shiftKey){A.onItemShiftTab();return}if(q.target!==q.currentTarget)return;const G=Yye(q,A.orientation,A.dir);if(G!==void 0){if(q.metaKey||q.ctrlKey||q.altKey||q.shiftKey)return;q.preventDefault();let X=P().filter(ie=>ie.focusable).map(ie=>ie.ref.current);if(G==="last")X.reverse();else if(G==="prev"||G==="next"){G==="prev"&&X.reverse();const ie=X.indexOf(q.currentTarget);X=A.loop?Kye(X,ie+1):X.slice(ie+1)}setTimeout(()=>jY(X))}}),children:typeof f=="function"?f({isCurrentTabStop:C,hasTabStop:U!=null}):f})})});BY.displayName=FY;var Zye={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Xye(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Yye(e,t,n){const r=Xye(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return Zye[r]}function jY(e,t=!1){const n=document.activeElement;for(const r of e)if(r===n||(r.focus({preventScroll:t}),document.activeElement!==n))return}function Kye(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var Qye=zY,Jye=BY;function e1e(e){const t=t1e(e),n=B.forwardRef((r,a)=>{const{children:u,...f}=r,s=B.Children.toArray(u),v=s.find(r1e);if(v){const x=v.props.children,A=s.map(C=>C===v?B.Children.count(x)>1?B.Children.only(null):B.isValidElement(x)?x.props.children:null:C);return k.jsx(t,{...f,ref:a,children:B.isValidElement(x)?B.cloneElement(x,void 0,A):null})}return k.jsx(t,{...f,ref:a,children:u})});return n.displayName=`${e}.Slot`,n}function t1e(e){const t=B.forwardRef((n,r)=>{const{children:a,...u}=n;if(B.isValidElement(a)){const f=s1e(a),s=i1e(u,a.props);return a.type!==B.Fragment&&(s.ref=r?w_(r,f):f),B.cloneElement(a,s)}return B.Children.count(a)>1?B.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var n1e=Symbol("radix.slottable");function r1e(e){return B.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===n1e}function i1e(e,t){const n={...t};for(const r in t){const a=e[r],u=t[r];/^on[A-Z]/.test(r)?a&&u?n[r]=(...s)=>{const v=u(...s);return a(...s),v}:a&&(n[r]=a):r==="style"?n[r]={...a,...u}:r==="className"&&(n[r]=[a,u].filter(Boolean).join(" "))}return{...e,...n}}function s1e(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var a1e=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},w1=new WeakMap,v3=new WeakMap,x3={},k5=0,UY=function(e){return e&&(e.host||UY(e.parentNode))},o1e=function(e,t){return t.map(function(n){if(e.contains(n))return n;var r=UY(n);return r&&e.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},l1e=function(e,t,n,r){var a=o1e(t,Array.isArray(e)?e:[e]);x3[n]||(x3[n]=new WeakMap);var u=x3[n],f=[],s=new Set,v=new Set(a),x=function(C){!C||s.has(C)||(s.add(C),x(C.parentNode))};a.forEach(x);var A=function(C){!C||v.has(C)||Array.prototype.forEach.call(C.children,function(P){if(s.has(P))A(P);else try{var L=P.getAttribute(r),F=L!==null&&L!=="false",U=(w1.get(P)||0)+1,q=(u.get(P)||0)+1;w1.set(P,U),u.set(P,q),f.push(P),U===1&&F&&v3.set(P,!0),q===1&&P.setAttribute(n,"true"),F||P.setAttribute(r,"true")}catch(G){console.error("aria-hidden: cannot operate on ",P,G)}})};return A(t),s.clear(),k5++,function(){f.forEach(function(C){var P=w1.get(C)-1,L=u.get(C)-1;w1.set(C,P),u.set(C,L),P||(v3.has(C)||C.removeAttribute(r),v3.delete(C)),L||C.removeAttribute(n)}),k5--,k5||(w1=new WeakMap,w1=new WeakMap,v3=new WeakMap,x3={})}},u1e=function(e,t,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),a=a1e(e);return a?(r.push.apply(r,Array.from(a.querySelectorAll("[aria-live], script"))),l1e(r,a,n,"aria-hidden")):function(){return null}},L4="right-scroll-bar-position",D4="width-before-scroll-bar",c1e="with-scroll-bars-hidden",d1e="--removed-body-scroll-bar-size";function I5(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function h1e(e,t){var n=B.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(r){var a=n.value;a!==r&&(n.value=r,n.callback(r,a))}}}})[0];return n.callback=t,n.facade}var f1e=typeof window<"u"?B.useLayoutEffect:B.useEffect,kU=new WeakMap;function p1e(e,t){var n=h1e(null,function(r){return e.forEach(function(a){return I5(a,r)})});return f1e(function(){var r=kU.get(n);if(r){var a=new Set(r),u=new Set(e),f=n.current;a.forEach(function(s){u.has(s)||I5(s,null)}),u.forEach(function(s){a.has(s)||I5(s,f)})}kU.set(n,e)},[e]),n}function m1e(e){return e}function g1e(e,t){t===void 0&&(t=m1e);var n=[],r=!1,a={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(u){var f=t(u,r);return n.push(f),function(){n=n.filter(function(s){return s!==f})}},assignSyncMedium:function(u){for(r=!0;n.length;){var f=n;n=[],f.forEach(u)}n={push:function(s){return u(s)},filter:function(){return n}}},assignMedium:function(u){r=!0;var f=[];if(n.length){var s=n;n=[],s.forEach(u),f=n}var v=function(){var A=f;f=[],A.forEach(u)},x=function(){return Promise.resolve().then(v)};x(),n={push:function(A){f.push(A),x()},filter:function(A){return f=f.filter(A),n}}}};return a}function _1e(e){e===void 0&&(e={});var t=g1e(null);return t.options=Zh({async:!0,ssr:!1},e),t}var VY=function(e){var t=e.sideCar,n=tZ(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw new Error("Sidecar medium not found");return B.createElement(r,Zh({},n))};VY.isSideCarExport=!0;function y1e(e,t){return e.useMedium(t),VY}var $Y=_1e(),R5=function(){},nk=B.forwardRef(function(e,t){var n=B.useRef(null),r=B.useState({onScrollCapture:R5,onWheelCapture:R5,onTouchMoveCapture:R5}),a=r[0],u=r[1],f=e.forwardProps,s=e.children,v=e.className,x=e.removeScrollBar,A=e.enabled,C=e.shards,P=e.sideCar,L=e.noRelative,F=e.noIsolation,U=e.inert,q=e.allowPinchZoom,G=e.as,$=G===void 0?"div":G,X=e.gapMode,ie=tZ(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),de=P,fe=p1e([n,t]),be=Zh(Zh({},ie),a);return B.createElement(B.Fragment,null,A&&B.createElement(de,{sideCar:$Y,removeScrollBar:x,shards:C,noRelative:L,noIsolation:F,inert:U,setCallbacks:u,allowPinchZoom:!!q,lockRef:n,gapMode:X}),f?B.cloneElement(B.Children.only(s),Zh(Zh({},be),{ref:fe})):B.createElement($,Zh({},be,{className:v,ref:fe}),s))});nk.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};nk.classNames={fullWidth:D4,zeroRight:L4};var v1e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function x1e(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=v1e();return t&&e.setAttribute("nonce",t),e}function b1e(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function w1e(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var T1e=function(){var e=0,t=null;return{add:function(n){e==0&&(t=x1e())&&(b1e(t,n),w1e(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},E1e=function(){var e=T1e();return function(t,n){B.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},HY=function(){var e=E1e(),t=function(n){var r=n.styles,a=n.dynamic;return e(r,a),null};return t},S1e={left:0,top:0,right:0,gap:0},M5=function(e){return parseInt(e||"",10)||0},A1e=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],r=t[e==="padding"?"paddingTop":"marginTop"],a=t[e==="padding"?"paddingRight":"marginRight"];return[M5(n),M5(r),M5(a)]},C1e=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return S1e;var t=A1e(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},k1e=HY(),nv="data-scroll-locked",I1e=function(e,t,n,r){var a=e.left,u=e.top,f=e.right,s=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(c1e,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(s,"px ").concat(r,`;
  }
  body[`).concat(nv,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(a,`px;
    padding-top: `).concat(u,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(s,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(L4,` {
    right: `).concat(s,"px ").concat(r,`;
  }
  
  .`).concat(D4,` {
    margin-right: `).concat(s,"px ").concat(r,`;
  }
  
  .`).concat(L4," .").concat(L4,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(D4," .").concat(D4,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(nv,`] {
    `).concat(d1e,": ").concat(s,`px;
  }
`)},IU=function(){var e=parseInt(document.body.getAttribute(nv)||"0",10);return isFinite(e)?e:0},R1e=function(){B.useEffect(function(){return document.body.setAttribute(nv,(IU()+1).toString()),function(){var e=IU()-1;e<=0?document.body.removeAttribute(nv):document.body.setAttribute(nv,e.toString())}},[])},M1e=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,a=r===void 0?"margin":r;R1e();var u=B.useMemo(function(){return C1e(a)},[a]);return B.createElement(k1e,{styles:I1e(u,!t,a,n?"":"!important")})},FP=!1;if(typeof window<"u")try{var b3=Object.defineProperty({},"passive",{get:function(){return FP=!0,!0}});window.addEventListener("test",b3,b3),window.removeEventListener("test",b3,b3)}catch{FP=!1}var T1=FP?{passive:!1}:!1,P1e=function(e){return e.tagName==="TEXTAREA"},GY=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!P1e(e)&&n[t]==="visible")},O1e=function(e){return GY(e,"overflowY")},L1e=function(e){return GY(e,"overflowX")},RU=function(e,t){var n=t.ownerDocument,r=t;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var a=qY(e,r);if(a){var u=WY(e,r),f=u[1],s=u[2];if(f>s)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},D1e=function(e){var t=e.scrollTop,n=e.scrollHeight,r=e.clientHeight;return[t,n,r]},N1e=function(e){var t=e.scrollLeft,n=e.scrollWidth,r=e.clientWidth;return[t,n,r]},qY=function(e,t){return e==="v"?O1e(t):L1e(t)},WY=function(e,t){return e==="v"?D1e(t):N1e(t)},z1e=function(e,t){return e==="h"&&t==="rtl"?-1:1},F1e=function(e,t,n,r,a){var u=z1e(e,window.getComputedStyle(t).direction),f=u*r,s=n.target,v=t.contains(s),x=!1,A=f>0,C=0,P=0;do{if(!s)break;var L=WY(e,s),F=L[0],U=L[1],q=L[2],G=U-q-u*F;(F||G)&&qY(e,s)&&(C+=G,P+=F);var $=s.parentNode;s=$&&$.nodeType===Node.DOCUMENT_FRAGMENT_NODE?$.host:$}while(!v&&s!==document.body||v&&(t.contains(s)||t===s));return(A&&Math.abs(C)<1||!A&&Math.abs(P)<1)&&(x=!0),x},w3=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},MU=function(e){return[e.deltaX,e.deltaY]},PU=function(e){return e&&"current"in e?e.current:e},B1e=function(e,t){return e[0]===t[0]&&e[1]===t[1]},j1e=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},U1e=0,E1=[];function V1e(e){var t=B.useRef([]),n=B.useRef([0,0]),r=B.useRef(),a=B.useState(U1e++)[0],u=B.useState(HY)[0],f=B.useRef(e);B.useEffect(function(){f.current=e},[e]),B.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(a));var U=_A([e.lockRef.current],(e.shards||[]).map(PU),!0).filter(Boolean);return U.forEach(function(q){return q.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),U.forEach(function(q){return q.classList.remove("allow-interactivity-".concat(a))})}}},[e.inert,e.lockRef.current,e.shards]);var s=B.useCallback(function(U,q){if("touches"in U&&U.touches.length===2||U.type==="wheel"&&U.ctrlKey)return!f.current.allowPinchZoom;var G=w3(U),$=n.current,X="deltaX"in U?U.deltaX:$[0]-G[0],ie="deltaY"in U?U.deltaY:$[1]-G[1],de,fe=U.target,be=Math.abs(X)>Math.abs(ie)?"h":"v";if("touches"in U&&be==="h"&&fe.type==="range")return!1;var ve=window.getSelection(),Qe=ve&&ve.anchorNode,we=Qe?Qe===fe||Qe.contains(fe):!1;if(we)return!1;var qe=RU(be,fe);if(!qe)return!0;if(qe?de=be:(de=be==="v"?"h":"v",qe=RU(be,fe)),!qe)return!1;if(!r.current&&"changedTouches"in U&&(X||ie)&&(r.current=de),!de)return!0;var Je=r.current||de;return F1e(Je,q,U,Je==="h"?X:ie)},[]),v=B.useCallback(function(U){var q=U;if(!(!E1.length||E1[E1.length-1]!==u)){var G="deltaY"in q?MU(q):w3(q),$=t.current.filter(function(de){return de.name===q.type&&(de.target===q.target||q.target===de.shadowParent)&&B1e(de.delta,G)})[0];if($&&$.should){q.cancelable&&q.preventDefault();return}if(!$){var X=(f.current.shards||[]).map(PU).filter(Boolean).filter(function(de){return de.contains(q.target)}),ie=X.length>0?s(q,X[0]):!f.current.noIsolation;ie&&q.cancelable&&q.preventDefault()}}},[]),x=B.useCallback(function(U,q,G,$){var X={name:U,delta:q,target:G,should:$,shadowParent:$1e(G)};t.current.push(X),setTimeout(function(){t.current=t.current.filter(function(ie){return ie!==X})},1)},[]),A=B.useCallback(function(U){n.current=w3(U),r.current=void 0},[]),C=B.useCallback(function(U){x(U.type,MU(U),U.target,s(U,e.lockRef.current))},[]),P=B.useCallback(function(U){x(U.type,w3(U),U.target,s(U,e.lockRef.current))},[]);B.useEffect(function(){return E1.push(u),e.setCallbacks({onScrollCapture:C,onWheelCapture:C,onTouchMoveCapture:P}),document.addEventListener("wheel",v,T1),document.addEventListener("touchmove",v,T1),document.addEventListener("touchstart",A,T1),function(){E1=E1.filter(function(U){return U!==u}),document.removeEventListener("wheel",v,T1),document.removeEventListener("touchmove",v,T1),document.removeEventListener("touchstart",A,T1)}},[]);var L=e.removeScrollBar,F=e.inert;return B.createElement(B.Fragment,null,F?B.createElement(u,{styles:j1e(a)}):null,L?B.createElement(M1e,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function $1e(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const H1e=y1e($Y,V1e);var ZY=B.forwardRef(function(e,t){return B.createElement(nk,Zh({},e,{ref:t,sideCar:H1e}))});ZY.classNames=nk.classNames;var BP=["Enter"," "],G1e=["ArrowDown","PageUp","Home"],XY=["ArrowUp","PageDown","End"],q1e=[...G1e,...XY],W1e={ltr:[...BP,"ArrowRight"],rtl:[...BP,"ArrowLeft"]},Z1e={ltr:["ArrowLeft"],rtl:["ArrowRight"]},CT="Menu",[Z2,X1e,Y1e]=MY(CT),[E_,YY]=ix(CT,[Y1e,QC,NY]),kT=QC(),KY=NY(),[QY,w0]=E_(CT),[K1e,IT]=E_(CT),JY=e=>{const{__scopeMenu:t,open:n=!1,children:r,dir:a,onOpenChange:u,modal:f=!0}=e,s=kT(t),[v,x]=B.useState(null),A=B.useRef(!1),C=lf(u),P=PY(a);return B.useEffect(()=>{const L=()=>{A.current=!0,document.addEventListener("pointerdown",F,{capture:!0,once:!0}),document.addEventListener("pointermove",F,{capture:!0,once:!0})},F=()=>A.current=!1;return document.addEventListener("keydown",L,{capture:!0}),()=>{document.removeEventListener("keydown",L,{capture:!0}),document.removeEventListener("pointerdown",F,{capture:!0}),document.removeEventListener("pointermove",F,{capture:!0})}},[]),k.jsx(xL,{...s,children:k.jsx(QY,{scope:t,open:n,onOpenChange:C,content:v,onContentChange:x,children:k.jsx(K1e,{scope:t,onClose:B.useCallback(()=>C(!1),[C]),isUsingKeyboardRef:A,dir:P,modal:f,children:r})})})};JY.displayName=CT;var Q1e="MenuAnchor",EL=B.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,a=kT(n);return k.jsx(yY,{...a,...r,ref:t})});EL.displayName=Q1e;var SL="MenuPortal",[J1e,eK]=E_(SL,{forceMount:void 0}),tK=e=>{const{__scopeMenu:t,forceMount:n,children:r,container:a}=e,u=w0(SL,t);return k.jsx(J1e,{scope:t,forceMount:n,children:k.jsx(T_,{present:n||u.open,children:k.jsx(bL,{asChild:!0,container:a,children:r})})})};tK.displayName=SL;var cd="MenuContent",[eve,AL]=E_(cd),nK=B.forwardRef((e,t)=>{const n=eK(cd,e.__scopeMenu),{forceMount:r=n.forceMount,...a}=e,u=w0(cd,e.__scopeMenu),f=IT(cd,e.__scopeMenu);return k.jsx(Z2.Provider,{scope:e.__scopeMenu,children:k.jsx(T_,{present:r||u.open,children:k.jsx(Z2.Slot,{scope:e.__scopeMenu,children:f.modal?k.jsx(tve,{...a,ref:t}):k.jsx(nve,{...a,ref:t})})})})}),tve=B.forwardRef((e,t)=>{const n=w0(cd,e.__scopeMenu),r=B.useRef(null),a=ru(t,r);return B.useEffect(()=>{const u=r.current;if(u)return u1e(u)},[]),k.jsx(CL,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:js(e.onFocusOutside,u=>u.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),nve=B.forwardRef((e,t)=>{const n=w0(cd,e.__scopeMenu);return k.jsx(CL,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),rve=e1e("MenuContent.ScrollLock"),CL=B.forwardRef((e,t)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:a,onOpenAutoFocus:u,onCloseAutoFocus:f,disableOutsidePointerEvents:s,onEntryFocus:v,onEscapeKeyDown:x,onPointerDownOutside:A,onFocusOutside:C,onInteractOutside:P,onDismiss:L,disableOutsideScroll:F,...U}=e,q=w0(cd,n),G=IT(cd,n),$=kT(n),X=KY(n),ie=X1e(n),[de,fe]=B.useState(null),be=B.useRef(null),ve=ru(t,be,q.onContentChange),Qe=B.useRef(0),we=B.useRef(""),qe=B.useRef(0),Je=B.useRef(null),ft=B.useRef("right"),Mt=B.useRef(0),Pt=F?ZY:B.Fragment,Nt=F?{as:rve,allowPinchZoom:!0}:void 0,Kt=mt=>{var Nn,bn;const Pe=we.current+mt,gn=ie().filter(Vt=>!Vt.disabled),Et=document.activeElement,ze=(Nn=gn.find(Vt=>Vt.ref.current===Et))==null?void 0:Nn.textValue,$t=gn.map(Vt=>Vt.textValue),Cn=mve($t,Pe,ze),fn=(bn=gn.find(Vt=>Vt.textValue===Cn))==null?void 0:bn.ref.current;(function Vt(En){we.current=En,window.clearTimeout(Qe.current),En!==""&&(Qe.current=window.setTimeout(()=>Vt(""),1e3))})(Pe),fn&&setTimeout(()=>fn.focus())};B.useEffect(()=>()=>window.clearTimeout(Qe.current),[]),Lye();const tt=B.useCallback(mt=>{var gn,Et;return ft.current===((gn=Je.current)==null?void 0:gn.side)&&_ve(mt,(Et=Je.current)==null?void 0:Et.area)},[]);return k.jsx(eve,{scope:n,searchRef:we,onItemEnter:B.useCallback(mt=>{tt(mt)&&mt.preventDefault()},[tt]),onItemLeave:B.useCallback(mt=>{var Pe;tt(mt)||((Pe=be.current)==null||Pe.focus(),fe(null))},[tt]),onTriggerLeave:B.useCallback(mt=>{tt(mt)&&mt.preventDefault()},[tt]),pointerGraceTimerRef:qe,onPointerGraceIntentChange:B.useCallback(mt=>{Je.current=mt},[]),children:k.jsx(Pt,{...Nt,children:k.jsx(OY,{asChild:!0,trapped:a,onMountAutoFocus:js(u,mt=>{var Pe;mt.preventDefault(),(Pe=be.current)==null||Pe.focus({preventScroll:!0})}),onUnmountAutoFocus:f,children:k.jsx(dL,{asChild:!0,disableOutsidePointerEvents:s,onEscapeKeyDown:x,onPointerDownOutside:A,onFocusOutside:C,onInteractOutside:P,onDismiss:L,children:k.jsx(Qye,{asChild:!0,...X,dir:G.dir,orientation:"vertical",loop:r,currentTabStopId:de,onCurrentTabStopIdChange:fe,onEntryFocus:js(v,mt=>{G.isUsingKeyboardRef.current||mt.preventDefault()}),preventScrollOnEntryFocus:!0,children:k.jsx(vY,{role:"menu","aria-orientation":"vertical","data-state":vK(q.open),"data-radix-menu-content":"",dir:G.dir,...$,...U,ref:ve,style:{outline:"none",...U.style},onKeyDown:js(U.onKeyDown,mt=>{const gn=mt.target.closest("[data-radix-menu-content]")===mt.currentTarget,Et=mt.ctrlKey||mt.altKey||mt.metaKey,ze=mt.key.length===1;gn&&(mt.key==="Tab"&&mt.preventDefault(),!Et&&ze&&Kt(mt.key));const $t=be.current;if(mt.target!==$t||!q1e.includes(mt.key))return;mt.preventDefault();const fn=ie().filter(Nn=>!Nn.disabled).map(Nn=>Nn.ref.current);XY.includes(mt.key)&&fn.reverse(),fve(fn)}),onBlur:js(e.onBlur,mt=>{mt.currentTarget.contains(mt.target)||(window.clearTimeout(Qe.current),we.current="")}),onPointerMove:js(e.onPointerMove,X2(mt=>{const Pe=mt.target,gn=Mt.current!==mt.clientX;if(mt.currentTarget.contains(Pe)&&gn){const Et=mt.clientX>Mt.current?"right":"left";ft.current=Et,Mt.current=mt.clientX}}))})})})})})})});nK.displayName=cd;var ive="MenuGroup",kL=B.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return k.jsx(Vl.div,{role:"group",...r,ref:t})});kL.displayName=ive;var sve="MenuLabel",rK=B.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return k.jsx(Vl.div,{...r,ref:t})});rK.displayName=sve;var KA="MenuItem",OU="menu.itemSelect",rk=B.forwardRef((e,t)=>{const{disabled:n=!1,onSelect:r,...a}=e,u=B.useRef(null),f=IT(KA,e.__scopeMenu),s=AL(KA,e.__scopeMenu),v=ru(t,u),x=B.useRef(!1),A=()=>{const C=u.current;if(!n&&C){const P=new CustomEvent(OU,{bubbles:!0,cancelable:!0});C.addEventListener(OU,L=>r==null?void 0:r(L),{once:!0}),ZX(C,P),P.defaultPrevented?x.current=!1:f.onClose()}};return k.jsx(iK,{...a,ref:v,disabled:n,onClick:js(e.onClick,A),onPointerDown:C=>{var P;(P=e.onPointerDown)==null||P.call(e,C),x.current=!0},onPointerUp:js(e.onPointerUp,C=>{var P;x.current||(P=C.currentTarget)==null||P.click()}),onKeyDown:js(e.onKeyDown,C=>{const P=s.searchRef.current!=="";n||P&&C.key===" "||BP.includes(C.key)&&(C.currentTarget.click(),C.preventDefault())})})});rk.displayName=KA;var iK=B.forwardRef((e,t)=>{const{__scopeMenu:n,disabled:r=!1,textValue:a,...u}=e,f=AL(KA,n),s=KY(n),v=B.useRef(null),x=ru(t,v),[A,C]=B.useState(!1),[P,L]=B.useState("");return B.useEffect(()=>{const F=v.current;F&&L((F.textContent??"").trim())},[u.children]),k.jsx(Z2.ItemSlot,{scope:n,disabled:r,textValue:a??P,children:k.jsx(Jye,{asChild:!0,...s,focusable:!r,children:k.jsx(Vl.div,{role:"menuitem","data-highlighted":A?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...u,ref:x,onPointerMove:js(e.onPointerMove,X2(F=>{r?f.onItemLeave(F):(f.onItemEnter(F),F.defaultPrevented||F.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:js(e.onPointerLeave,X2(F=>f.onItemLeave(F))),onFocus:js(e.onFocus,()=>C(!0)),onBlur:js(e.onBlur,()=>C(!1))})})})}),ave="MenuCheckboxItem",sK=B.forwardRef((e,t)=>{const{checked:n=!1,onCheckedChange:r,...a}=e;return k.jsx(cK,{scope:e.__scopeMenu,checked:n,children:k.jsx(rk,{role:"menuitemcheckbox","aria-checked":QA(n)?"mixed":n,...a,ref:t,"data-state":ML(n),onSelect:js(a.onSelect,()=>r==null?void 0:r(QA(n)?!0:!n),{checkForDefaultPrevented:!1})})})});sK.displayName=ave;var aK="MenuRadioGroup",[ove,lve]=E_(aK,{value:void 0,onValueChange:()=>{}}),oK=B.forwardRef((e,t)=>{const{value:n,onValueChange:r,...a}=e,u=lf(r);return k.jsx(ove,{scope:e.__scopeMenu,value:n,onValueChange:u,children:k.jsx(kL,{...a,ref:t})})});oK.displayName=aK;var lK="MenuRadioItem",uK=B.forwardRef((e,t)=>{const{value:n,...r}=e,a=lve(lK,e.__scopeMenu),u=n===a.value;return k.jsx(cK,{scope:e.__scopeMenu,checked:u,children:k.jsx(rk,{role:"menuitemradio","aria-checked":u,...r,ref:t,"data-state":ML(u),onSelect:js(r.onSelect,()=>{var f;return(f=a.onValueChange)==null?void 0:f.call(a,n)},{checkForDefaultPrevented:!1})})})});uK.displayName=lK;var IL="MenuItemIndicator",[cK,uve]=E_(IL,{checked:!1}),dK=B.forwardRef((e,t)=>{const{__scopeMenu:n,forceMount:r,...a}=e,u=uve(IL,n);return k.jsx(T_,{present:r||QA(u.checked)||u.checked===!0,children:k.jsx(Vl.span,{...a,ref:t,"data-state":ML(u.checked)})})});dK.displayName=IL;var cve="MenuSeparator",hK=B.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return k.jsx(Vl.div,{role:"separator","aria-orientation":"horizontal",...r,ref:t})});hK.displayName=cve;var dve="MenuArrow",fK=B.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,a=kT(n);return k.jsx(xY,{...a,...r,ref:t})});fK.displayName=dve;var RL="MenuSub",[hve,pK]=E_(RL),mK=e=>{const{__scopeMenu:t,children:n,open:r=!1,onOpenChange:a}=e,u=w0(RL,t),f=kT(t),[s,v]=B.useState(null),[x,A]=B.useState(null),C=lf(a);return B.useEffect(()=>(u.open===!1&&C(!1),()=>C(!1)),[u.open,C]),k.jsx(xL,{...f,children:k.jsx(QY,{scope:t,open:r,onOpenChange:C,content:x,onContentChange:A,children:k.jsx(hve,{scope:t,contentId:Nv(),triggerId:Nv(),trigger:s,onTriggerChange:v,children:n})})})};mK.displayName=RL;var Hw="MenuSubTrigger",gK=B.forwardRef((e,t)=>{const n=w0(Hw,e.__scopeMenu),r=IT(Hw,e.__scopeMenu),a=pK(Hw,e.__scopeMenu),u=AL(Hw,e.__scopeMenu),f=B.useRef(null),{pointerGraceTimerRef:s,onPointerGraceIntentChange:v}=u,x={__scopeMenu:e.__scopeMenu},A=B.useCallback(()=>{f.current&&window.clearTimeout(f.current),f.current=null},[]);return B.useEffect(()=>A,[A]),B.useEffect(()=>{const C=s.current;return()=>{window.clearTimeout(C),v(null)}},[s,v]),k.jsx(EL,{asChild:!0,...x,children:k.jsx(iK,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":a.contentId,"data-state":vK(n.open),...e,ref:w_(t,a.onTriggerChange),onClick:C=>{var P;(P=e.onClick)==null||P.call(e,C),!(e.disabled||C.defaultPrevented)&&(C.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:js(e.onPointerMove,X2(C=>{u.onItemEnter(C),!C.defaultPrevented&&!e.disabled&&!n.open&&!f.current&&(u.onPointerGraceIntentChange(null),f.current=window.setTimeout(()=>{n.onOpenChange(!0),A()},100))})),onPointerLeave:js(e.onPointerLeave,X2(C=>{var L,F;A();const P=(L=n.content)==null?void 0:L.getBoundingClientRect();if(P){const U=(F=n.content)==null?void 0:F.dataset.side,q=U==="right",G=q?-5:5,$=P[q?"left":"right"],X=P[q?"right":"left"];u.onPointerGraceIntentChange({area:[{x:C.clientX+G,y:C.clientY},{x:$,y:P.top},{x:X,y:P.top},{x:X,y:P.bottom},{x:$,y:P.bottom}],side:U}),window.clearTimeout(s.current),s.current=window.setTimeout(()=>u.onPointerGraceIntentChange(null),300)}else{if(u.onTriggerLeave(C),C.defaultPrevented)return;u.onPointerGraceIntentChange(null)}})),onKeyDown:js(e.onKeyDown,C=>{var L;const P=u.searchRef.current!=="";e.disabled||P&&C.key===" "||W1e[r.dir].includes(C.key)&&(n.onOpenChange(!0),(L=n.content)==null||L.focus(),C.preventDefault())})})})});gK.displayName=Hw;var _K="MenuSubContent",yK=B.forwardRef((e,t)=>{const n=eK(cd,e.__scopeMenu),{forceMount:r=n.forceMount,...a}=e,u=w0(cd,e.__scopeMenu),f=IT(cd,e.__scopeMenu),s=pK(_K,e.__scopeMenu),v=B.useRef(null),x=ru(t,v);return k.jsx(Z2.Provider,{scope:e.__scopeMenu,children:k.jsx(T_,{present:r||u.open,children:k.jsx(Z2.Slot,{scope:e.__scopeMenu,children:k.jsx(CL,{id:s.contentId,"aria-labelledby":s.triggerId,...a,ref:x,align:"start",side:f.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:A=>{var C;f.isUsingKeyboardRef.current&&((C=v.current)==null||C.focus()),A.preventDefault()},onCloseAutoFocus:A=>A.preventDefault(),onFocusOutside:js(e.onFocusOutside,A=>{A.target!==s.trigger&&u.onOpenChange(!1)}),onEscapeKeyDown:js(e.onEscapeKeyDown,A=>{f.onClose(),A.preventDefault()}),onKeyDown:js(e.onKeyDown,A=>{var L;const C=A.currentTarget.contains(A.target),P=Z1e[f.dir].includes(A.key);C&&P&&(u.onOpenChange(!1),(L=s.trigger)==null||L.focus(),A.preventDefault())})})})})})});yK.displayName=_K;function vK(e){return e?"open":"closed"}function QA(e){return e==="indeterminate"}function ML(e){return QA(e)?"indeterminate":e?"checked":"unchecked"}function fve(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function pve(e,t){return e.map((n,r)=>e[(t+r)%e.length])}function mve(e,t,n){const a=t.length>1&&Array.from(t).every(x=>x===t[0])?t[0]:t,u=n?e.indexOf(n):-1;let f=pve(e,Math.max(u,0));a.length===1&&(f=f.filter(x=>x!==n));const v=f.find(x=>x.toLowerCase().startsWith(a.toLowerCase()));return v!==n?v:void 0}function gve(e,t){const{x:n,y:r}=e;let a=!1;for(let u=0,f=t.length-1;u<t.length;f=u++){const s=t[u],v=t[f],x=s.x,A=s.y,C=v.x,P=v.y;A>r!=P>r&&n<(C-x)*(r-A)/(P-A)+x&&(a=!a)}return a}function _ve(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return gve(n,t)}function X2(e){return t=>t.pointerType==="mouse"?e(t):void 0}var yve=JY,vve=EL,xve=tK,bve=nK,wve=kL,Tve=rK,Eve=rk,Sve=sK,Ave=oK,Cve=uK,kve=dK,Ive=hK,Rve=fK,Mve=mK,Pve=gK,Ove=yK,ik="DropdownMenu",[Lve]=ix(ik,[YY]),iu=YY(),[Dve,xK]=Lve(ik),bK=e=>{const{__scopeDropdownMenu:t,children:n,dir:r,open:a,defaultOpen:u,onOpenChange:f,modal:s=!0}=e,v=iu(t),x=B.useRef(null),[A,C]=JC({prop:a,defaultProp:u??!1,onChange:f,caller:ik});return k.jsx(Dve,{scope:t,triggerId:Nv(),triggerRef:x,contentId:Nv(),open:A,onOpenChange:C,onOpenToggle:B.useCallback(()=>C(P=>!P),[C]),modal:s,children:k.jsx(yve,{...v,open:A,onOpenChange:C,dir:r,modal:s,children:n})})};bK.displayName=ik;var wK="DropdownMenuTrigger",TK=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...a}=e,u=xK(wK,n),f=iu(n);return k.jsx(vve,{asChild:!0,...f,children:k.jsx(Vl.button,{type:"button",id:u.triggerId,"aria-haspopup":"menu","aria-expanded":u.open,"aria-controls":u.open?u.contentId:void 0,"data-state":u.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...a,ref:w_(t,u.triggerRef),onPointerDown:js(e.onPointerDown,s=>{!r&&s.button===0&&s.ctrlKey===!1&&(u.onOpenToggle(),u.open||s.preventDefault())}),onKeyDown:js(e.onKeyDown,s=>{r||(["Enter"," "].includes(s.key)&&u.onOpenToggle(),s.key==="ArrowDown"&&u.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(s.key)&&s.preventDefault())})})})});TK.displayName=wK;var Nve="DropdownMenuPortal",EK=e=>{const{__scopeDropdownMenu:t,...n}=e,r=iu(t);return k.jsx(xve,{...r,...n})};EK.displayName=Nve;var SK="DropdownMenuContent",AK=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=xK(SK,n),u=iu(n),f=B.useRef(!1);return k.jsx(bve,{id:a.contentId,"aria-labelledby":a.triggerId,...u,...r,ref:t,onCloseAutoFocus:js(e.onCloseAutoFocus,s=>{var v;f.current||(v=a.triggerRef.current)==null||v.focus(),f.current=!1,s.preventDefault()}),onInteractOutside:js(e.onInteractOutside,s=>{const v=s.detail.originalEvent,x=v.button===0&&v.ctrlKey===!0,A=v.button===2||x;(!a.modal||A)&&(f.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});AK.displayName=SK;var zve="DropdownMenuGroup",Fve=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=iu(n);return k.jsx(wve,{...a,...r,ref:t})});Fve.displayName=zve;var Bve="DropdownMenuLabel",jve=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=iu(n);return k.jsx(Tve,{...a,...r,ref:t})});jve.displayName=Bve;var Uve="DropdownMenuItem",CK=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=iu(n);return k.jsx(Eve,{...a,...r,ref:t})});CK.displayName=Uve;var Vve="DropdownMenuCheckboxItem",$ve=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=iu(n);return k.jsx(Sve,{...a,...r,ref:t})});$ve.displayName=Vve;var Hve="DropdownMenuRadioGroup",Gve=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=iu(n);return k.jsx(Ave,{...a,...r,ref:t})});Gve.displayName=Hve;var qve="DropdownMenuRadioItem",Wve=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=iu(n);return k.jsx(Cve,{...a,...r,ref:t})});Wve.displayName=qve;var Zve="DropdownMenuItemIndicator",Xve=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=iu(n);return k.jsx(kve,{...a,...r,ref:t})});Xve.displayName=Zve;var Yve="DropdownMenuSeparator",kK=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=iu(n);return k.jsx(Ive,{...a,...r,ref:t})});kK.displayName=Yve;var Kve="DropdownMenuArrow",Qve=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=iu(n);return k.jsx(Rve,{...a,...r,ref:t})});Qve.displayName=Kve;var Jve=e=>{const{__scopeDropdownMenu:t,children:n,open:r,onOpenChange:a,defaultOpen:u}=e,f=iu(t),[s,v]=JC({prop:r,defaultProp:u??!1,onChange:a,caller:"DropdownMenuSub"});return k.jsx(Mve,{...f,open:s,onOpenChange:v,children:n})},exe="DropdownMenuSubTrigger",IK=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=iu(n);return k.jsx(Pve,{...a,...r,ref:t})});IK.displayName=exe;var txe="DropdownMenuSubContent",RK=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,a=iu(n);return k.jsx(Ove,{...a,...r,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});RK.displayName=txe;var nxe=bK,rxe=TK,ixe=EK,sxe=AK,axe=CK,oxe=kK,lxe=Jve,uxe=IK,cxe=RK;const dxe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),RT=function(e){if(e==null)return mxe;if(typeof e=="function")return sk(e);if(typeof e=="object")return Array.isArray(e)?hxe(e):fxe(e);if(typeof e=="string")return pxe(e);throw new Error("Expected function, string, or object as test")};function hxe(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=RT(e[n]);return sk(r);function r(...a){let u=-1;for(;++u<t.length;)if(t[u].apply(this,a))return!0;return!1}}function fxe(e){const t=e;return sk(n);function n(r){const a=r;let u;for(u in e)if(a[u]!==t[u])return!1;return!0}}function pxe(e){return sk(t);function t(n){return n&&n.type===e}}function sk(e){return t;function t(n,r,a){return!!(gxe(n)&&e.call(this,n,typeof r=="number"?r:void 0,a||void 0))}}function mxe(){return!0}function gxe(e){return e!==null&&typeof e=="object"&&"type"in e}const MK=[],Gw=!0,jP=!1,JA="skip";function ox(e,t,n,r){let a;typeof t=="function"&&typeof n!="function"?(r=n,n=t):a=t;const u=RT(a),f=r?-1:1;s(e,void 0,[])();function s(v,x,A){const C=v&&typeof v=="object"?v:{};if(typeof C.type=="string"){const L=typeof C.tagName=="string"?C.tagName:typeof C.name=="string"?C.name:void 0;Object.defineProperty(P,"name",{value:"node ("+(v.type+(L?"<"+L+">":""))+")"})}return P;function P(){let L=MK,F,U,q;if((!t||u(v,x,A[A.length-1]||void 0))&&(L=_xe(n(v,A)),L[0]===jP))return L;if("children"in v&&v.children){const G=v;if(G.children&&L[0]!==JA)for(U=(r?G.children.length:-1)+f,q=A.concat(G);U>-1&&U<G.children.length;){const $=G.children[U];if(F=s($,U,q)(),F[0]===jP)return F;U=typeof F[1]=="number"?F[1]:U+f}}return L}}}function _xe(e){return Array.isArray(e)?e:typeof e=="number"?[Gw,e]:e==null?MK:[e]}function UP(e,t,n,r){let a,u,f;typeof t=="function"&&typeof n!="function"?(u=void 0,f=t,a=n):(u=t,f=n,a=r),ox(e,u,s,a);function s(v,x){const A=x[x.length-1],C=A?A.children.indexOf(v):void 0;return f(v,C,A)}}function yxe({defaultOrigin:e="",allowedLinkPrefixes:t=[],allowedImagePrefixes:n=[],allowDataImages:r=!1,allowedProtocols:a=[],blockedImageClass:u="inline-block bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-3 py-1 rounded text-sm",blockedLinkClass:f="text-gray-500"}){const s=t.length&&!t.every(x=>x==="*"),v=n.length&&!n.every(x=>x==="*");if(!e&&(s||v))throw new Error("defaultOrigin is required when allowedLinkPrefixes or allowedImagePrefixes are provided");return x=>{const A=wxe(e,t,n,r,a,u,f);UP(x,A)}}function LU(e,t){if(typeof e!="string")return null;try{return new URL(e)}catch{if(t)try{return new URL(e,t)}catch{return null}if(e.startsWith("/")||e.startsWith("./")||e.startsWith("../"))try{return new URL(e,"http://example.com")}catch{return null}return null}}function vxe(e){return typeof e!="string"?!1:e.startsWith("/")||e.startsWith("./")||e.startsWith("../")}const xxe=new Set(["https:","http:","irc:","ircs:","mailto:","xmpp:","blob:"]),bxe=new Set(["javascript:","data:","file:","vbscript:"]);function DU(e,t,n,r=!1,a=!1,u=[]){if(!e)return null;if(typeof e=="string"&&e.startsWith("#")&&!a)try{if(new URL(e,"http://example.com").hash===e)return e}catch{}if(typeof e=="string"&&e.startsWith("data:"))return a&&r&&e.startsWith("data:image/")?e:null;if(typeof e=="string"&&e.startsWith("blob:")){try{if(new URL(e).protocol==="blob:"&&e.length>5){const A=e.substring(5);if(A&&A.length>0&&A!=="invalid")return e}}catch{return null}return null}const f=LU(e,n);if(!f||bxe.has(f.protocol)||!(xxe.has(f.protocol)||u.includes(f.protocol)||u.includes("*")))return null;if(f.protocol==="mailto:"||!f.protocol.match(/^https?:$/))return f.href;const v=vxe(e);return f&&t.some(x=>{const A=LU(x,n);return!A||A.origin!==f.origin?!1:f.href.startsWith(A.href)})?v?f.pathname+f.search+f.hash:f.href:t.includes("*")?f.protocol!=="https:"&&f.protocol!=="http:"?null:v?f.pathname+f.search+f.hash:f.href:null}const P5=Symbol("node-seen"),wxe=(e,t,n,r,a,u,f)=>{const s=(v,x,A)=>{if(v.type!=="element"||v[P5])return Gw;if(v.tagName==="a"){const C=DU(v.properties.href,t,e,!1,!1,a);return C===null?(v[P5]=!0,UP(v,s),A&&typeof x=="number"&&(A.children[x]={type:"element",tagName:"span",properties:{title:"Blocked URL: "+String(v.properties.href),class:f},children:[...v.children,{type:"text",value:" [blocked]"}]}),JA):(v.properties.href=C,v.properties.target="_blank",v.properties.rel="noopener noreferrer",Gw)}if(v.tagName==="img"){const C=DU(v.properties.src,n,e,r,!0,a);return C===null?(v[P5]=!0,UP(v,s),A&&typeof x=="number"&&(A.children[x]={type:"element",tagName:"span",properties:{class:u},children:[{type:"text",value:"[Image blocked: "+String(v.properties.alt||"No description")+"]"}]}),JA):(v.properties.src=C,Gw)}return Gw};return s};let MT=class{constructor(t,n,r){this.normal=n,this.property=t,r&&(this.space=r)}};MT.prototype.normal={};MT.prototype.property={};MT.prototype.space=void 0;function PK(e,t){const n={},r={};for(const a of e)Object.assign(n,a.property),Object.assign(r,a.normal);return new MT(n,r,t)}function Y2(e){return e.toLowerCase()}let nc=class{constructor(t,n){this.attribute=n,this.property=t}};nc.prototype.attribute="";nc.prototype.booleanish=!1;nc.prototype.boolean=!1;nc.prototype.commaOrSpaceSeparated=!1;nc.prototype.commaSeparated=!1;nc.prototype.defined=!1;nc.prototype.mustUseProperty=!1;nc.prototype.number=!1;nc.prototype.overloadedBoolean=!1;nc.prototype.property="";nc.prototype.spaceSeparated=!1;nc.prototype.space=void 0;let Txe=0;const Ps=S_(),el=S_(),VP=S_(),ur=S_(),Ja=S_(),rv=S_(),yc=S_();function S_(){return 2**++Txe}const $P=Object.freeze(Object.defineProperty({__proto__:null,boolean:Ps,booleanish:el,commaOrSpaceSeparated:yc,commaSeparated:rv,number:ur,overloadedBoolean:VP,spaceSeparated:Ja},Symbol.toStringTag,{value:"Module"})),O5=Object.keys($P);let PL=class extends nc{constructor(t,n,r,a){let u=-1;if(super(t,n),NU(this,"space",a),typeof r=="number")for(;++u<O5.length;){const f=O5[u];NU(this,O5[u],(r&$P[f])===$P[f])}}};PL.prototype.defined=!0;function NU(e,t,n){n&&(e[t]=n)}function lx(e){const t={},n={};for(const[r,a]of Object.entries(e.properties)){const u=new PL(r,e.transform(e.attributes||{},r),a,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(u.mustUseProperty=!0),t[r]=u,n[Y2(r)]=r,n[Y2(u.attribute)]=r}return new MT(t,n,e.space)}const OK=lx({properties:{ariaActiveDescendant:null,ariaAtomic:el,ariaAutoComplete:null,ariaBusy:el,ariaChecked:el,ariaColCount:ur,ariaColIndex:ur,ariaColSpan:ur,ariaControls:Ja,ariaCurrent:null,ariaDescribedBy:Ja,ariaDetails:null,ariaDisabled:el,ariaDropEffect:Ja,ariaErrorMessage:null,ariaExpanded:el,ariaFlowTo:Ja,ariaGrabbed:el,ariaHasPopup:null,ariaHidden:el,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Ja,ariaLevel:ur,ariaLive:null,ariaModal:el,ariaMultiLine:el,ariaMultiSelectable:el,ariaOrientation:null,ariaOwns:Ja,ariaPlaceholder:null,ariaPosInSet:ur,ariaPressed:el,ariaReadOnly:el,ariaRelevant:null,ariaRequired:el,ariaRoleDescription:Ja,ariaRowCount:ur,ariaRowIndex:ur,ariaRowSpan:ur,ariaSelected:el,ariaSetSize:ur,ariaSort:null,ariaValueMax:ur,ariaValueMin:ur,ariaValueNow:ur,ariaValueText:null,role:null},transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function LK(e,t){return t in e?e[t]:t}function DK(e,t){return LK(e,t.toLowerCase())}const Exe=lx({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:rv,acceptCharset:Ja,accessKey:Ja,action:null,allow:null,allowFullScreen:Ps,allowPaymentRequest:Ps,allowUserMedia:Ps,alt:null,as:null,async:Ps,autoCapitalize:null,autoComplete:Ja,autoFocus:Ps,autoPlay:Ps,blocking:Ja,capture:null,charSet:null,checked:Ps,cite:null,className:Ja,cols:ur,colSpan:null,content:null,contentEditable:el,controls:Ps,controlsList:Ja,coords:ur|rv,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Ps,defer:Ps,dir:null,dirName:null,disabled:Ps,download:VP,draggable:el,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Ps,formTarget:null,headers:Ja,height:ur,hidden:VP,high:ur,href:null,hrefLang:null,htmlFor:Ja,httpEquiv:Ja,id:null,imageSizes:null,imageSrcSet:null,inert:Ps,inputMode:null,integrity:null,is:null,isMap:Ps,itemId:null,itemProp:Ja,itemRef:Ja,itemScope:Ps,itemType:Ja,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Ps,low:ur,manifest:null,max:null,maxLength:ur,media:null,method:null,min:null,minLength:ur,multiple:Ps,muted:Ps,name:null,nonce:null,noModule:Ps,noValidate:Ps,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Ps,optimum:ur,pattern:null,ping:Ja,placeholder:null,playsInline:Ps,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Ps,referrerPolicy:null,rel:Ja,required:Ps,reversed:Ps,rows:ur,rowSpan:ur,sandbox:Ja,scope:null,scoped:Ps,seamless:Ps,selected:Ps,shadowRootClonable:Ps,shadowRootDelegatesFocus:Ps,shadowRootMode:null,shape:null,size:ur,sizes:null,slot:null,span:ur,spellCheck:el,src:null,srcDoc:null,srcLang:null,srcSet:null,start:ur,step:null,style:null,tabIndex:ur,target:null,title:null,translate:null,type:null,typeMustMatch:Ps,useMap:null,value:el,width:ur,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Ja,axis:null,background:null,bgColor:null,border:ur,borderColor:null,bottomMargin:ur,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Ps,declare:Ps,event:null,face:null,frame:null,frameBorder:null,hSpace:ur,leftMargin:ur,link:null,longDesc:null,lowSrc:null,marginHeight:ur,marginWidth:ur,noResize:Ps,noHref:Ps,noShade:Ps,noWrap:Ps,object:null,profile:null,prompt:null,rev:null,rightMargin:ur,rules:null,scheme:null,scrolling:el,standby:null,summary:null,text:null,topMargin:ur,valueType:null,version:null,vAlign:null,vLink:null,vSpace:ur,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Ps,disableRemotePlayback:Ps,prefix:null,property:null,results:ur,security:null,unselectable:null},space:"html",transform:DK}),Sxe=lx({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:yc,accentHeight:ur,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:ur,amplitude:ur,arabicForm:null,ascent:ur,attributeName:null,attributeType:null,azimuth:ur,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:ur,by:null,calcMode:null,capHeight:ur,className:Ja,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:ur,diffuseConstant:ur,direction:null,display:null,dur:null,divisor:ur,dominantBaseline:null,download:Ps,dx:null,dy:null,edgeMode:null,editable:null,elevation:ur,enableBackground:null,end:null,event:null,exponent:ur,externalResourcesRequired:null,fill:null,fillOpacity:ur,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:rv,g2:rv,glyphName:rv,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:ur,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:ur,horizOriginX:ur,horizOriginY:ur,id:null,ideographic:ur,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:ur,k:ur,k1:ur,k2:ur,k3:ur,k4:ur,kernelMatrix:yc,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:ur,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:ur,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:ur,overlineThickness:ur,paintOrder:null,panose1:null,path:null,pathLength:ur,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Ja,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:ur,pointsAtY:ur,pointsAtZ:ur,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:yc,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:yc,rev:yc,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:yc,requiredFeatures:yc,requiredFonts:yc,requiredFormats:yc,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:ur,specularExponent:ur,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:ur,strikethroughThickness:ur,string:null,stroke:null,strokeDashArray:yc,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:ur,strokeOpacity:ur,strokeWidth:null,style:null,surfaceScale:ur,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:yc,tabIndex:ur,tableValues:null,target:null,targetX:ur,targetY:ur,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:yc,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:ur,underlineThickness:ur,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:ur,values:null,vAlphabetic:ur,vMathematical:ur,vectorEffect:null,vHanging:ur,vIdeographic:ur,version:null,vertAdvY:ur,vertOriginX:ur,vertOriginY:ur,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:ur,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:LK}),NK=lx({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()}}),zK=lx({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:DK}),FK=lx({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()}}),Axe=/[A-Z]/g,zU=/-[a-z]/g,Cxe=/^data[-\w.:]+$/i;function kxe(e,t){const n=Y2(t);let r=t,a=nc;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&Cxe.test(t)){if(t.charAt(4)==="-"){const u=t.slice(5).replace(zU,Rxe);r="data"+u.charAt(0).toUpperCase()+u.slice(1)}else{const u=t.slice(4);if(!zU.test(u)){let f=u.replace(Axe,Ixe);f.charAt(0)!=="-"&&(f="-"+f),t="data"+f}}a=PL}return new a(r,t)}function Ixe(e){return"-"+e.toLowerCase()}function Rxe(e){return e.charAt(1).toUpperCase()}const Mxe=PK([OK,Exe,NK,zK,FK],"html"),Pxe=PK([OK,Sxe,NK,zK,FK],"svg"),FU=/[#.]/g;function Oxe(e,t){const n=e||"",r={};let a=0,u,f;for(;a<n.length;){FU.lastIndex=a;const s=FU.exec(n),v=n.slice(a,s?s.index:n.length);v&&(u?u==="#"?r.id=v:Array.isArray(r.className)?r.className.push(v):r.className=[v]:f=v,a+=v.length),s&&(u=s[0],a++)}return{type:"element",tagName:f||t||"div",properties:r,children:[]}}function BK(e,t,n){const r=n?zxe(n):void 0;function a(u,f,...s){let v;if(u==null){v={type:"root",children:[]};const x=f;s.unshift(x)}else{v=Oxe(u,t);const x=v.tagName.toLowerCase(),A=r?r.get(x):void 0;if(v.tagName=A||x,Lxe(f))s.unshift(f);else for(const[C,P]of Object.entries(f))Dxe(e,v.properties,C,P)}for(const x of s)HP(v.children,x);return v.type==="element"&&v.tagName==="template"&&(v.content={type:"root",children:v.children},v.children=[]),v}return a}function Lxe(e){if(e===null||typeof e!="object"||Array.isArray(e))return!0;if(typeof e.type!="string")return!1;const t=e,n=Object.keys(e);for(const r of n){const a=t[r];if(a&&typeof a=="object"){if(!Array.isArray(a))return!0;const u=a;for(const f of u)if(typeof f!="number"&&typeof f!="string")return!0}}return!!("children"in e&&Array.isArray(e.children))}function Dxe(e,t,n,r){const a=kxe(e,n);let u;if(r!=null){if(typeof r=="number"){if(Number.isNaN(r))return;u=r}else typeof r=="boolean"?u=r:typeof r=="string"?a.spaceSeparated?u=vA(r):a.commaSeparated?u=xA(r):a.commaOrSpaceSeparated?u=vA(xA(r).join(" ")):u=BU(a,a.property,r):Array.isArray(r)?u=[...r]:u=a.property==="style"?Nxe(r):String(r);if(Array.isArray(u)){const f=[];for(const s of u)f.push(BU(a,a.property,s));u=f}a.property==="className"&&Array.isArray(t.className)&&(u=t.className.concat(u)),t[a.property]=u}}function HP(e,t){if(t!=null)if(typeof t=="number"||typeof t=="string")e.push({type:"text",value:String(t)});else if(Array.isArray(t))for(const n of t)HP(e,n);else if(typeof t=="object"&&"type"in t)t.type==="root"?HP(e,t.children):e.push(t);else throw new Error("Expected node, nodes, or string, got `"+t+"`")}function BU(e,t,n){if(typeof n=="string"){if(e.number&&n&&!Number.isNaN(Number(n)))return Number(n);if((e.boolean||e.overloadedBoolean)&&(n===""||Y2(n)===Y2(t)))return!0}return n}function Nxe(e){const t=[];for(const[n,r]of Object.entries(e))t.push([n,r].join(": "));return t.join("; ")}function zxe(e){const t=new Map;for(const n of e)t.set(n.toLowerCase(),n);return t}const Fxe=["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","solidColor","textArea","textPath"],Bxe=BK(Mxe,"div"),jxe=BK(Pxe,"g",Fxe),Kh={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Uxe(e,t){return jK(e,{})||{type:"root",children:[]}}function jK(e,t){const n=Vxe(e,t);return n&&t.afterTransform&&t.afterTransform(e,n),n}function Vxe(e,t){switch(e.nodeType){case 1:return qxe(e,t);case 3:return Hxe(e);case 8:return Gxe(e);case 9:return jU(e,t);case 10:return $xe();case 11:return jU(e,t);default:return}}function jU(e,t){return{type:"root",children:UK(e,t)}}function $xe(){return{type:"doctype"}}function Hxe(e){return{type:"text",value:e.nodeValue||""}}function Gxe(e){return{type:"comment",value:e.nodeValue||""}}function qxe(e,t){const n=e.namespaceURI,r=n===Kh.svg?jxe:Bxe,a=n===Kh.html?e.tagName.toLowerCase():e.tagName,u=n===Kh.html&&a==="template"?e.content:e,f=e.getAttributeNames(),s={};let v=-1;for(;++v<f.length;)s[f[v]]=e.getAttribute(f[v])||"";return r(a,s,UK(u,t))}function UK(e,t){const n=e.childNodes,r=[];let a=-1;for(;++a<n.length;){const u=jK(n[a],t);u!==void 0&&r.push(u)}return r}new DOMParser;function Wxe(e,t){const n=Zxe(e);return Uxe(n)}function Zxe(e){const t=document.createElement("template");return t.innerHTML=e,t.content}const UU=function(e,t,n){const r=RT(n);if(!e||!e.type||!e.children)throw new Error("Expected parent node");if(typeof t=="number"){if(t<0||t===Number.POSITIVE_INFINITY)throw new Error("Expected positive finite number as index")}else if(t=e.children.indexOf(t),t<0)throw new Error("Expected child node or index");for(;++t<e.children.length;)if(r(e.children[t],t,e))return e.children[t]},A_=function(e){if(e==null)return Kxe;if(typeof e=="string")return Yxe(e);if(typeof e=="object")return Xxe(e);if(typeof e=="function")return OL(e);throw new Error("Expected function, string, or array as `test`")};function Xxe(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=A_(e[n]);return OL(r);function r(...a){let u=-1;for(;++u<t.length;)if(t[u].apply(this,a))return!0;return!1}}function Yxe(e){return OL(t);function t(n){return n.tagName===e}}function OL(e){return t;function t(n,r,a){return!!(Qxe(n)&&e.call(this,n,typeof r=="number"?r:void 0,a||void 0))}}function Kxe(e){return!!(e&&typeof e=="object"&&"type"in e&&e.type==="element"&&"tagName"in e&&typeof e.tagName=="string")}function Qxe(e){return e!==null&&typeof e=="object"&&"type"in e&&"tagName"in e}const VU=/\n/g,$U=/[\t ]+/g,GP=A_("br"),HU=A_(abe),Jxe=A_("p"),GU=A_("tr"),ebe=A_(["datalist","head","noembed","noframes","noscript","rp","script","style","template","title",sbe,obe]),VK=A_(["address","article","aside","blockquote","body","caption","center","dd","dialog","dir","dl","dt","div","figure","figcaption","footer","form,","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","legend","li","listing","main","menu","nav","ol","p","plaintext","pre","section","ul","xmp"]);function tbe(e,t){const n=t||{},r="children"in e?e.children:[],a=VK(e),u=GK(e,{whitespace:n.whitespace||"normal"}),f=[];(e.type==="text"||e.type==="comment")&&f.push(...HK(e,{breakBefore:!0,breakAfter:!0}));let s=-1;for(;++s<r.length;)f.push(...$K(r[s],e,{whitespace:u,breakBefore:s?void 0:a,breakAfter:s<r.length-1?GP(r[s+1]):a}));const v=[];let x;for(s=-1;++s<f.length;){const A=f[s];typeof A=="number"?x!==void 0&&A>x&&(x=A):A&&(x!==void 0&&x>-1&&v.push(`
`.repeat(x)||" "),x=-1,v.push(A))}return v.join("")}function $K(e,t,n){return e.type==="element"?nbe(e,t,n):e.type==="text"?n.whitespace==="normal"?HK(e,n):rbe(e):[]}function nbe(e,t,n){const r=GK(e,n),a=e.children||[];let u=-1,f=[];if(ebe(e))return f;let s,v;for(GP(e)||GU(e)&&UU(t,e,GU)?v=`
`:Jxe(e)?(s=2,v=2):VK(e)&&(s=1,v=1);++u<a.length;)f=f.concat($K(a[u],e,{whitespace:r,breakBefore:u?void 0:s,breakAfter:u<a.length-1?GP(a[u+1]):v}));return HU(e)&&UU(t,e,HU)&&f.push("	"),s&&f.unshift(s),v&&f.push(v),f}function HK(e,t){const n=String(e.value),r=[],a=[];let u=0;for(;u<=n.length;){VU.lastIndex=u;const v=VU.exec(n),x=v&&"index"in v?v.index:n.length;r.push(ibe(n.slice(u,x).replace(/[\u061C\u200E\u200F\u202A-\u202E\u2066-\u2069]/g,""),u===0?t.breakBefore:!0,x===n.length?t.breakAfter:!0)),u=x+1}let f=-1,s;for(;++f<r.length;)r[f].charCodeAt(r[f].length-1)===8203||f<r.length-1&&r[f+1].charCodeAt(0)===8203?(a.push(r[f]),s=void 0):r[f]?(typeof s=="number"&&a.push(s),a.push(r[f]),s=0):(f===0||f===r.length-1)&&a.push(0);return a}function rbe(e){return[String(e.value)]}function ibe(e,t,n){const r=[];let a=0,u;for(;a<e.length;){$U.lastIndex=a;const f=$U.exec(e);u=f?f.index:e.length,!a&&!u&&f&&!t&&r.push(""),a!==u&&r.push(e.slice(a,u)),a=f?u+f[0].length:u}return a!==u&&!n&&r.push(""),r.join(" ")}function GK(e,t){if(e.type==="element"){const n=e.properties||{};switch(e.tagName){case"listing":case"plaintext":case"xmp":return"pre";case"nobr":return"nowrap";case"pre":return n.wrap?"pre-wrap":"pre";case"td":case"th":return n.noWrap?"nowrap":t.whitespace;case"textarea":return"pre-wrap"}}return t.whitespace}function sbe(e){return!!(e.properties||{}).hidden}function abe(e){return e.tagName==="td"||e.tagName==="th"}function obe(e){return e.tagName==="dialog"&&!(e.properties||{}).open}class Wu{constructor(t,n,r){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=t,this.start=n,this.end=r}static range(t,n){return n?!t||!t.loc||!n.loc||t.loc.lexer!==n.loc.lexer?null:new Wu(t.loc.lexer,t.loc.start,n.loc.end):t&&t.loc}}class Ic{constructor(t,n){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=t,this.loc=n}range(t,n){return new Ic(n,Wu.range(this,t))}}class ir{constructor(t,n){this.name=void 0,this.position=void 0,this.length=void 0,this.rawMessage=void 0;var r="KaTeX parse error: "+t,a,u,f=n&&n.loc;if(f&&f.start<=f.end){var s=f.lexer.input;a=f.start,u=f.end,a===s.length?r+=" at end of input: ":r+=" at position "+(a+1)+": ";var v=s.slice(a,u).replace(/[^]/g,"$&"),x;a>15?x=""+s.slice(a-15,a):x=s.slice(0,a);var A;u+15<s.length?A=s.slice(u,u+15)+"":A=s.slice(u),r+=x+v+A}var C=new Error(r);return C.name="ParseError",C.__proto__=ir.prototype,C.position=a,a!=null&&u!=null&&(C.length=u-a),C.rawMessage=t,C}}ir.prototype.__proto__=Error.prototype;var lbe=function(t,n){return t===void 0?n:t},ube=/([A-Z])/g,cbe=function(t){return t.replace(ube,"-$1").toLowerCase()},dbe={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},hbe=/[&><"']/g;function fbe(e){return String(e).replace(hbe,t=>dbe[t])}var qK=function e(t){return t.type==="ordgroup"||t.type==="color"?t.body.length===1?e(t.body[0]):t:t.type==="font"?e(t.body):t},pbe=function(t){var n=qK(t);return n.type==="mathord"||n.type==="textord"||n.type==="atom"},mbe=function(t){if(!t)throw new Error("Expected non-null, but got "+String(t));return t},gbe=function(t){var n=/^[\x00-\x20]*([^\\/#?]*?)(:|&#0*58|&#x0*3a|&colon)/i.exec(t);return n?n[2]!==":"||!/^[a-zA-Z][a-zA-Z0-9+\-.]*$/.test(n[1])?null:n[1].toLowerCase():"_relative"},Ca={deflt:lbe,escape:fbe,hyphenate:cbe,getBaseElem:qK,isCharacterBox:pbe,protocolFromUrl:gbe},s2={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:e=>"#"+e},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(e,t)=>(t.push(e),t)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:e=>Math.max(0,e),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:e=>Math.max(0,e),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:e=>Math.max(0,e),cli:"-e, --max-expand <n>",cliProcessor:e=>e==="Infinity"?1/0:parseInt(e)},globalGroup:{type:"boolean",cli:!1}};function _be(e){if(e.default)return e.default;var t=e.type,n=Array.isArray(t)?t[0]:t;if(typeof n!="string")return n.enum[0];switch(n){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class LL{constructor(t){this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,t=t||{};for(var n in s2)if(s2.hasOwnProperty(n)){var r=s2[n];this[n]=t[n]!==void 0?r.processor?r.processor(t[n]):t[n]:_be(r)}}reportNonstrict(t,n,r){var a=this.strict;if(typeof a=="function"&&(a=a(t,n,r)),!(!a||a==="ignore")){if(a===!0||a==="error")throw new ir("LaTeX-incompatible input and strict mode is set to 'error': "+(n+" ["+t+"]"),r);a==="warn"?typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(n+" ["+t+"]")):typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+a+"': "+n+" ["+t+"]"))}}useStrictBehavior(t,n,r){var a=this.strict;if(typeof a=="function")try{a=a(t,n,r)}catch{a="error"}return!a||a==="ignore"?!1:a===!0||a==="error"?!0:a==="warn"?(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(n+" ["+t+"]")),!1):(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+a+"': "+n+" ["+t+"]")),!1)}isTrusted(t){if(t.url&&!t.protocol){var n=Ca.protocolFromUrl(t.url);if(n==null)return!1;t.protocol=n}var r=typeof this.trust=="function"?this.trust(t):this.trust;return!!r}}class lm{constructor(t,n,r){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=t,this.size=n,this.cramped=r}sup(){return Gh[ybe[this.id]]}sub(){return Gh[vbe[this.id]]}fracNum(){return Gh[xbe[this.id]]}fracDen(){return Gh[bbe[this.id]]}cramp(){return Gh[wbe[this.id]]}text(){return Gh[Tbe[this.id]]}isTight(){return this.size>=2}}var DL=0,eC=1,iv=2,op=3,K2=4,ld=5,Bv=6,Eu=7,Gh=[new lm(DL,0,!1),new lm(eC,0,!0),new lm(iv,1,!1),new lm(op,1,!0),new lm(K2,2,!1),new lm(ld,2,!0),new lm(Bv,3,!1),new lm(Eu,3,!0)],ybe=[K2,ld,K2,ld,Bv,Eu,Bv,Eu],vbe=[ld,ld,ld,ld,Eu,Eu,Eu,Eu],xbe=[iv,op,K2,ld,Bv,Eu,Bv,Eu],bbe=[op,op,ld,ld,Eu,Eu,Eu,Eu],wbe=[eC,eC,op,op,ld,ld,Eu,Eu],Tbe=[DL,eC,iv,op,iv,op,iv,op],Bi={DISPLAY:Gh[DL],TEXT:Gh[iv],SCRIPT:Gh[K2],SCRIPTSCRIPT:Gh[Bv]},qP=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}];function Ebe(e){for(var t=0;t<qP.length;t++)for(var n=qP[t],r=0;r<n.blocks.length;r++){var a=n.blocks[r];if(e>=a[0]&&e<=a[1])return n.name}return null}var N4=[];qP.forEach(e=>e.blocks.forEach(t=>N4.push(...t)));function WK(e){for(var t=0;t<N4.length;t+=2)if(e>=N4[t]&&e<=N4[t+1])return!0;return!1}var S1=80,Sbe=function(t,n){return"M95,"+(622+t+n)+`
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l`+t/2.075+" -"+t+`
c5.3,-9.3,12,-14,20,-14
H400000v`+(40+t)+`H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M`+(834+t)+" "+n+"h400000v"+(40+t)+"h-400000z"},Abe=function(t,n){return"M263,"+(601+t+n)+`c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l`+t/2.084+" -"+t+`
c4.7,-7.3,11,-11,19,-11
H40000v`+(40+t)+`H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M`+(1001+t)+" "+n+"h400000v"+(40+t)+"h-400000z"},Cbe=function(t,n){return"M983 "+(10+t+n)+`
l`+t/3.13+" -"+t+`
c4,-6.7,10,-10,18,-10 H400000v`+(40+t)+`
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M`+(1001+t)+" "+n+"h400000v"+(40+t)+"h-400000z"},kbe=function(t,n){return"M424,"+(2398+t+n)+`
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l`+t/4.223+" -"+t+`c4,-6.7,10,-10,18,-10 H400000
v`+(40+t)+`H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M`+(1001+t)+" "+n+`
h400000v`+(40+t)+"h-400000z"},Ibe=function(t,n){return"M473,"+(2713+t+n)+`
c339.3,-1799.3,509.3,-2700,510,-2702 l`+t/5.298+" -"+t+`
c3.3,-7.3,9.3,-11,18,-11 H400000v`+(40+t)+`H1017.7
s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200
c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26
s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,
606zM`+(1001+t)+" "+n+"h400000v"+(40+t)+"H1017.7z"},Rbe=function(t){var n=t/2;return"M400000 "+t+" H0 L"+n+" 0 l65 45 L145 "+(t-80)+" H400000z"},Mbe=function(t,n,r){var a=r-54-n-t;return"M702 "+(t+n)+"H400000"+(40+t)+`
H742v`+a+`l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1
h-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170
c-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667
219 661 l218 661zM702 `+n+"H400000v"+(40+t)+"H742z"},Pbe=function(t,n,r){n=1e3*n;var a="";switch(t){case"sqrtMain":a=Sbe(n,S1);break;case"sqrtSize1":a=Abe(n,S1);break;case"sqrtSize2":a=Cbe(n,S1);break;case"sqrtSize3":a=kbe(n,S1);break;case"sqrtSize4":a=Ibe(n,S1);break;case"sqrtTall":a=Mbe(n,S1,r)}return a},Obe=function(t,n){switch(t){case"":return"M291 0 H417 V"+n+" H291z M291 0 H417 V"+n+" H291z";case"":return"M145 0 H188 V"+n+" H145z M145 0 H188 V"+n+" H145z";case"":return"M145 0 H188 V"+n+" H145z M145 0 H188 V"+n+" H145z"+("M367 0 H410 V"+n+" H367z M367 0 H410 V"+n+" H367z");case"":return"M457 0 H583 V"+n+" H457z M457 0 H583 V"+n+" H457z";case"":return"M319 0 H403 V"+n+" H319z M319 0 H403 V"+n+" H319z";case"":return"M263 0 H347 V"+n+" H263z M263 0 H347 V"+n+" H263z";case"":return"M384 0 H504 V"+n+" H384z M384 0 H504 V"+n+" H384z";case"":return"M312 0 H355 V"+n+" H312z M312 0 H355 V"+n+" H312z";case"":return"M257 0 H300 V"+n+" H257z M257 0 H300 V"+n+" H257z"+("M478 0 H521 V"+n+" H478z M478 0 H521 V"+n+" H478z");default:return""}},qU={doubleleftarrow:`M262 157
l10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3
 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28
 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5
c2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5
 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87
-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7
-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z
m8 0v40h399730v-40zm0 194v40h399730v-40z`,doublerightarrow:`M399738 392l
-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5
 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88
-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68
-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18
-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782
c-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3
-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z`,leftarrow:`M400000 241H110l3-3c68.7-52.7 113.7-120
 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8
-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247
c-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208
 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3
 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202
 l-3-3h399890zM100 241v40h399900v-40z`,leftbrace:`M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117
-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7
 5-6 9-10 13-.7 1-7.3 1-20 1H6z`,leftbraceunder:`M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z`,leftgroup:`M400000 80
H435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0
 435 0h399565z`,leftgroupunder:`M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z`,leftharpoon:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3
-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5
-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7
-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z`,leftharpoonplus:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5
 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3
-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7
-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z
m0 0v40h400000v-40z`,leftharpoondown:`M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333
 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5
 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667
-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z`,leftharpoondownplus:`M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12
 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7
-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0
v40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z`,lefthook:`M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5
-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3
-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21
 71.5 23h399859zM103 281v-40h399897v40z`,leftlinesegment:`M40 281 V428 H0 V94 H40 V241 H400000 v40z
M40 281 V428 H0 V94 H40 V241 H400000 v40z`,leftmapsto:`M40 281 V448H0V74H40V241H400000v40z
M40 281 V448H0V74H40V241H400000v40z`,leftToFrom:`M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23
-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8
c28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3
 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z`,longequal:`M0 50 h400000 v40H0z m0 194h40000v40H0z
M0 50 h400000 v40H0z m0 194h40000v40H0z`,midbrace:`M200428 334
c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14
-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7
 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11
 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z`,midbraceunder:`M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z`,oiintSize1:`M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6
-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z
m368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8
60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z`,oiintSize2:`M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8
-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z
m502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2
c0 110 84 276 504 276s502.4-166 502.4-276z`,oiiintSize1:`M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6
-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z
m525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0
85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z`,oiiintSize2:`M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8
-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z
m770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1
c0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z`,rightarrow:`M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z`,rightbrace:`M400000 542l
-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5
s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1
c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z`,rightbraceunder:`M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z`,rightgroup:`M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0
 3-1 3-3v-38c-76-158-257-219-435-219H0z`,rightgroupunder:`M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z`,rightharpoon:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3
-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2
-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58
 69.2 92 94.5zm0 0v40h399900v-40z`,rightharpoonplus:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11
-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7
 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z
m0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z`,rightharpoondown:`M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8
 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5
-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95
-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z`,rightharpoondownplus:`M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8
 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3
 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3
-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z
m0-194v40h400000v-40zm0 0v40h400000v-40z`,righthook:`M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3
 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0
-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21
 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z`,rightlinesegment:`M399960 241 V94 h40 V428 h-40 V281 H0 v-40z
M399960 241 V94 h40 V428 h-40 V281 H0 v-40z`,rightToFrom:`M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23
 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32
-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142
-167z M100 147v40h399900v-40zM0 341v40h399900v-40z`,twoheadleftarrow:`M0 167c68 40
 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69
-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3
-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19
-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101
 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z`,twoheadrightarrow:`M400000 167
c-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3
 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42
 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333
-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70
 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z`,tilde1:`M200 55.538c-77 0-168 73.953-177 73.953-3 0-7
-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0
 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0
 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128
-68.267.847-113-73.952-191-73.952z`,tilde2:`M344 55.266c-142 0-300.638 81.316-311.5 86.418
-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9
 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114
c1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751
 181.476 676 181.476c-149 0-189-126.21-332-126.21z`,tilde3:`M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457
-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0
 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697
 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696
 -338 0-409-156.573-744-156.573z`,tilde4:`M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345
-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409
 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9
 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409
 -175.236-744-175.236z`,vec:`M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z`,widehat1:`M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z`,widehat2:`M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat3:`M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat4:`M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widecheck1:`M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,
-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z`,widecheck2:`M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck3:`M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck4:`M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,baraboveleftarrow:`M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202
c4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5
c-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130
s-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47
121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6
s2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11
c0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z
M100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z`,rightarrowabovebar:`M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32
-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0
13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39
-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5
-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z`,baraboveshortleftharpoon:`M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17
c2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21
c-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40
c-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z
M0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z`,rightharpoonaboveshortbar:`M0,241 l0,40c399126,0,399993,0,399993,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z`,shortbaraboveleftharpoon:`M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,
1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,
-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z
M93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z`,shortrightharpoonabovebar:`M53,241l0,40c398570,0,399437,0,399437,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z`},Lbe=function(t,n){switch(t){case"lbrack":return"M403 1759 V84 H666 V0 H319 V1759 v"+n+` v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v`+n+" v1759 h84z";case"rbrack":return"M347 1759 V0 H0 V84 H263 V1759 v"+n+` v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v`+n+" v1759 h84z";case"vert":return"M145 15 v585 v"+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+n+" v585 h43z";case"doublevert":return"M145 15 v585 v"+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+n+` v585 h43z
M367 15 v585 v`+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M410 15 H367 v585 v`+n+" v585 h43z";case"lfloor":return"M319 602 V0 H403 V602 v"+n+` v1715 h263 v84 H319z
MM319 602 V0 H403 V602 v`+n+" v1715 H319z";case"rfloor":return"M319 602 V0 H403 V602 v"+n+` v1799 H0 v-84 H319z
MM319 602 V0 H403 V602 v`+n+" v1715 H319z";case"lceil":return"M403 1759 V84 H666 V0 H319 V1759 v"+n+` v602 h84z
M403 1759 V0 H319 V1759 v`+n+" v602 h84z";case"rceil":return"M347 1759 V0 H0 V84 H263 V1759 v"+n+` v602 h84z
M347 1759 V0 h-84 V1759 v`+n+" v602 h84z";case"lparen":return`M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,`+(n+84)+`c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-`+(n+92)+`c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z`;case"rparen":return`M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,`+(n+9)+`
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-`+(n+144)+`c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z`;default:throw new Error("Unknown stretchy delimiter.")}};class PT{constructor(t){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=t,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(t){return this.classes.includes(t)}toNode(){for(var t=document.createDocumentFragment(),n=0;n<this.children.length;n++)t.appendChild(this.children[n].toNode());return t}toMarkup(){for(var t="",n=0;n<this.children.length;n++)t+=this.children[n].toMarkup();return t}toText(){var t=n=>n.toText();return this.children.map(t).join("")}}var Qh={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},T3={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},WU={:"A",:"D",:"o",:"a",:"d",:"o",:"A",:"B",:"B",:"F",:"A",:"E",:"K",:"3",:"N",:"N",:"K",:"N",:"M",:"H",:"O",:"N",:"P",:"C",:"T",:"y",:"O",:"X",:"U",:"h",:"W",:"W",:"B",:"X",:"B",:"3",:"X",:"R",:"a",:"b",:"a",:"r",:"y",:"e",:"m",:"e",:"n",:"n",:"n",:"n",:"m",:"n",:"o",:"n",:"p",:"c",:"o",:"y",:"b",:"x",:"n",:"n",:"w",:"w",:"a",:"m",:"a",:"e",:"m",:"r"};function ZK(e,t){Qh[e]=t}function NL(e,t,n){if(!Qh[t])throw new Error("Font metrics not found for font: "+t+".");var r=e.charCodeAt(0),a=Qh[t][r];if(!a&&e[0]in WU&&(r=WU[e[0]].charCodeAt(0),a=Qh[t][r]),!a&&n==="text"&&WK(r)&&(a=Qh[t][77]),a)return{depth:a[0],height:a[1],italic:a[2],skew:a[3],width:a[4]}}var L5={};function Dbe(e){var t;if(e>=5?t=0:e>=3?t=1:t=2,!L5[t]){var n=L5[t]={cssEmPerMu:T3.quad[t]/18};for(var r in T3)T3.hasOwnProperty(r)&&(n[r]=T3[r][t])}return L5[t]}var Nbe=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],ZU=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],XU=function(t,n){return n.size<2?t:Nbe[t-1][n.size-1]};class Xf{constructor(t){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=t.style,this.color=t.color,this.size=t.size||Xf.BASESIZE,this.textSize=t.textSize||this.size,this.phantom=!!t.phantom,this.font=t.font||"",this.fontFamily=t.fontFamily||"",this.fontWeight=t.fontWeight||"",this.fontShape=t.fontShape||"",this.sizeMultiplier=ZU[this.size-1],this.maxSize=t.maxSize,this.minRuleThickness=t.minRuleThickness,this._fontMetrics=void 0}extend(t){var n={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);return new Xf(n)}havingStyle(t){return this.style===t?this:this.extend({style:t,size:XU(this.textSize,t)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(t){return this.size===t&&this.textSize===t?this:this.extend({style:this.style.text(),size:t,textSize:t,sizeMultiplier:ZU[t-1]})}havingBaseStyle(t){t=t||this.style.text();var n=XU(Xf.BASESIZE,t);return this.size===n&&this.textSize===Xf.BASESIZE&&this.style===t?this:this.extend({style:t,size:n})}havingBaseSizing(){var t;switch(this.style.id){case 4:case 5:t=3;break;case 6:case 7:t=1;break;default:t=6}return this.extend({style:this.style.text(),size:t})}withColor(t){return this.extend({color:t})}withPhantom(){return this.extend({phantom:!0})}withFont(t){return this.extend({font:t})}withTextFontFamily(t){return this.extend({fontFamily:t,font:""})}withTextFontWeight(t){return this.extend({fontWeight:t,font:""})}withTextFontShape(t){return this.extend({fontShape:t,font:""})}sizingClasses(t){return t.size!==this.size?["sizing","reset-size"+t.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==Xf.BASESIZE?["sizing","reset-size"+this.size,"size"+Xf.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=Dbe(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}Xf.BASESIZE=6;var WP={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:803/800,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:803/800},zbe={ex:!0,em:!0,mu:!0},XK=function(t){return typeof t!="string"&&(t=t.unit),t in WP||t in zbe||t==="ex"},ko=function(t,n){var r;if(t.unit in WP)r=WP[t.unit]/n.fontMetrics().ptPerEm/n.sizeMultiplier;else if(t.unit==="mu")r=n.fontMetrics().cssEmPerMu;else{var a;if(n.style.isTight()?a=n.havingStyle(n.style.text()):a=n,t.unit==="ex")r=a.fontMetrics().xHeight;else if(t.unit==="em")r=a.fontMetrics().quad;else throw new ir("Invalid unit: '"+t.unit+"'");a!==n&&(r*=a.sizeMultiplier/n.sizeMultiplier)}return Math.min(t.number*r,n.maxSize)},Er=function(t){return+t.toFixed(4)+"em"},d0=function(t){return t.filter(n=>n).join(" ")},YK=function(t,n,r){if(this.classes=t||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=r||{},n){n.style.isTight()&&this.classes.push("mtight");var a=n.getColor();a&&(this.style.color=a)}},KK=function(t){var n=document.createElement(t);n.className=d0(this.classes);for(var r in this.style)this.style.hasOwnProperty(r)&&(n.style[r]=this.style[r]);for(var a in this.attributes)this.attributes.hasOwnProperty(a)&&n.setAttribute(a,this.attributes[a]);for(var u=0;u<this.children.length;u++)n.appendChild(this.children[u].toNode());return n},Fbe=/[\s"'>/=\x00-\x1f]/,QK=function(t){var n="<"+t;this.classes.length&&(n+=' class="'+Ca.escape(d0(this.classes))+'"');var r="";for(var a in this.style)this.style.hasOwnProperty(a)&&(r+=Ca.hyphenate(a)+":"+this.style[a]+";");r&&(n+=' style="'+Ca.escape(r)+'"');for(var u in this.attributes)if(this.attributes.hasOwnProperty(u)){if(Fbe.test(u))throw new ir("Invalid attribute name '"+u+"'");n+=" "+u+'="'+Ca.escape(this.attributes[u])+'"'}n+=">";for(var f=0;f<this.children.length;f++)n+=this.children[f].toMarkup();return n+="</"+t+">",n};class OT{constructor(t,n,r,a){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,YK.call(this,t,r,a),this.children=n||[]}setAttribute(t,n){this.attributes[t]=n}hasClass(t){return this.classes.includes(t)}toNode(){return KK.call(this,"span")}toMarkup(){return QK.call(this,"span")}}class zL{constructor(t,n,r,a){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,YK.call(this,n,a),this.children=r||[],this.setAttribute("href",t)}setAttribute(t,n){this.attributes[t]=n}hasClass(t){return this.classes.includes(t)}toNode(){return KK.call(this,"a")}toMarkup(){return QK.call(this,"a")}}class Bbe{constructor(t,n,r){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=n,this.src=t,this.classes=["mord"],this.style=r}hasClass(t){return this.classes.includes(t)}toNode(){var t=document.createElement("img");t.src=this.src,t.alt=this.alt,t.className="mord";for(var n in this.style)this.style.hasOwnProperty(n)&&(t.style[n]=this.style[n]);return t}toMarkup(){var t='<img src="'+Ca.escape(this.src)+'"'+(' alt="'+Ca.escape(this.alt)+'"'),n="";for(var r in this.style)this.style.hasOwnProperty(r)&&(n+=Ca.hyphenate(r)+":"+this.style[r]+";");return n&&(t+=' style="'+Ca.escape(n)+'"'),t+="'/>",t}}var jbe={:"",:"",:"",:""};class pd{constructor(t,n,r,a,u,f,s,v){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=t,this.height=n||0,this.depth=r||0,this.italic=a||0,this.skew=u||0,this.width=f||0,this.classes=s||[],this.style=v||{},this.maxFontSize=0;var x=Ebe(this.text.charCodeAt(0));x&&this.classes.push(x+"_fallback"),/[]/.test(this.text)&&(this.text=jbe[this.text])}hasClass(t){return this.classes.includes(t)}toNode(){var t=document.createTextNode(this.text),n=null;this.italic>0&&(n=document.createElement("span"),n.style.marginRight=Er(this.italic)),this.classes.length>0&&(n=n||document.createElement("span"),n.className=d0(this.classes));for(var r in this.style)this.style.hasOwnProperty(r)&&(n=n||document.createElement("span"),n.style[r]=this.style[r]);return n?(n.appendChild(t),n):t}toMarkup(){var t=!1,n="<span";this.classes.length&&(t=!0,n+=' class="',n+=Ca.escape(d0(this.classes)),n+='"');var r="";this.italic>0&&(r+="margin-right:"+this.italic+"em;");for(var a in this.style)this.style.hasOwnProperty(a)&&(r+=Ca.hyphenate(a)+":"+this.style[a]+";");r&&(t=!0,n+=' style="'+Ca.escape(r)+'"');var u=Ca.escape(this.text);return t?(n+=">",n+=u,n+="</span>",n):u}}class _p{constructor(t,n){this.children=void 0,this.attributes=void 0,this.children=t||[],this.attributes=n||{}}toNode(){var t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"svg");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&n.setAttribute(r,this.attributes[r]);for(var a=0;a<this.children.length;a++)n.appendChild(this.children[a].toNode());return n}toMarkup(){var t='<svg xmlns="http://www.w3.org/2000/svg"';for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(t+=" "+n+'="'+Ca.escape(this.attributes[n])+'"');t+=">";for(var r=0;r<this.children.length;r++)t+=this.children[r].toMarkup();return t+="</svg>",t}}class h0{constructor(t,n){this.pathName=void 0,this.alternate=void 0,this.pathName=t,this.alternate=n}toNode(){var t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"path");return this.alternate?n.setAttribute("d",this.alternate):n.setAttribute("d",qU[this.pathName]),n}toMarkup(){return this.alternate?'<path d="'+Ca.escape(this.alternate)+'"/>':'<path d="'+Ca.escape(qU[this.pathName])+'"/>'}}class ZP{constructor(t){this.attributes=void 0,this.attributes=t||{}}toNode(){var t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"line");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&n.setAttribute(r,this.attributes[r]);return n}toMarkup(){var t="<line";for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(t+=" "+n+'="'+Ca.escape(this.attributes[n])+'"');return t+="/>",t}}function YU(e){if(e instanceof pd)return e;throw new Error("Expected symbolNode but got "+String(e)+".")}function Ube(e){if(e instanceof OT)return e;throw new Error("Expected span<HtmlDomNode> but got "+String(e)+".")}var Vbe={bin:1,close:1,inner:1,open:1,punct:1,rel:1},$be={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},io={math:{},text:{}};function se(e,t,n,r,a,u){io[e][a]={font:t,group:n,replace:r},u&&r&&(io[e][r]=io[e][a])}var ce="math",$n="text",xe="main",it="ams",vo="accent-token",Zr="bin",Ru="close",ux="inner",Fi="mathord",al="op-token",zc="open",ak="punct",at="rel",Tp="spacing",Ct="textord";se(ce,xe,at,"","\\equiv",!0);se(ce,xe,at,"","\\prec",!0);se(ce,xe,at,"","\\succ",!0);se(ce,xe,at,"","\\sim",!0);se(ce,xe,at,"","\\perp");se(ce,xe,at,"","\\preceq",!0);se(ce,xe,at,"","\\succeq",!0);se(ce,xe,at,"","\\simeq",!0);se(ce,xe,at,"","\\mid",!0);se(ce,xe,at,"","\\ll",!0);se(ce,xe,at,"","\\gg",!0);se(ce,xe,at,"","\\asymp",!0);se(ce,xe,at,"","\\parallel");se(ce,xe,at,"","\\bowtie",!0);se(ce,xe,at,"","\\smile",!0);se(ce,xe,at,"","\\sqsubseteq",!0);se(ce,xe,at,"","\\sqsupseteq",!0);se(ce,xe,at,"","\\doteq",!0);se(ce,xe,at,"","\\frown",!0);se(ce,xe,at,"","\\ni",!0);se(ce,xe,at,"","\\propto",!0);se(ce,xe,at,"","\\vdash",!0);se(ce,xe,at,"","\\dashv",!0);se(ce,xe,at,"","\\owns");se(ce,xe,ak,".","\\ldotp");se(ce,xe,ak,"","\\cdotp");se(ce,xe,Ct,"#","\\#");se($n,xe,Ct,"#","\\#");se(ce,xe,Ct,"&","\\&");se($n,xe,Ct,"&","\\&");se(ce,xe,Ct,"","\\aleph",!0);se(ce,xe,Ct,"","\\forall",!0);se(ce,xe,Ct,"","\\hbar",!0);se(ce,xe,Ct,"","\\exists",!0);se(ce,xe,Ct,"","\\nabla",!0);se(ce,xe,Ct,"","\\flat",!0);se(ce,xe,Ct,"","\\ell",!0);se(ce,xe,Ct,"","\\natural",!0);se(ce,xe,Ct,"","\\clubsuit",!0);se(ce,xe,Ct,"","\\wp",!0);se(ce,xe,Ct,"","\\sharp",!0);se(ce,xe,Ct,"","\\diamondsuit",!0);se(ce,xe,Ct,"","\\Re",!0);se(ce,xe,Ct,"","\\heartsuit",!0);se(ce,xe,Ct,"","\\Im",!0);se(ce,xe,Ct,"","\\spadesuit",!0);se(ce,xe,Ct,"","\\S",!0);se($n,xe,Ct,"","\\S");se(ce,xe,Ct,"","\\P",!0);se($n,xe,Ct,"","\\P");se(ce,xe,Ct,"","\\dag");se($n,xe,Ct,"","\\dag");se($n,xe,Ct,"","\\textdagger");se(ce,xe,Ct,"","\\ddag");se($n,xe,Ct,"","\\ddag");se($n,xe,Ct,"","\\textdaggerdbl");se(ce,xe,Ru,"","\\rmoustache",!0);se(ce,xe,zc,"","\\lmoustache",!0);se(ce,xe,Ru,"","\\rgroup",!0);se(ce,xe,zc,"","\\lgroup",!0);se(ce,xe,Zr,"","\\mp",!0);se(ce,xe,Zr,"","\\ominus",!0);se(ce,xe,Zr,"","\\uplus",!0);se(ce,xe,Zr,"","\\sqcap",!0);se(ce,xe,Zr,"","\\ast");se(ce,xe,Zr,"","\\sqcup",!0);se(ce,xe,Zr,"","\\bigcirc",!0);se(ce,xe,Zr,"","\\bullet",!0);se(ce,xe,Zr,"","\\ddagger");se(ce,xe,Zr,"","\\wr",!0);se(ce,xe,Zr,"","\\amalg");se(ce,xe,Zr,"&","\\And");se(ce,xe,at,"","\\longleftarrow",!0);se(ce,xe,at,"","\\Leftarrow",!0);se(ce,xe,at,"","\\Longleftarrow",!0);se(ce,xe,at,"","\\longrightarrow",!0);se(ce,xe,at,"","\\Rightarrow",!0);se(ce,xe,at,"","\\Longrightarrow",!0);se(ce,xe,at,"","\\leftrightarrow",!0);se(ce,xe,at,"","\\longleftrightarrow",!0);se(ce,xe,at,"","\\Leftrightarrow",!0);se(ce,xe,at,"","\\Longleftrightarrow",!0);se(ce,xe,at,"","\\mapsto",!0);se(ce,xe,at,"","\\longmapsto",!0);se(ce,xe,at,"","\\nearrow",!0);se(ce,xe,at,"","\\hookleftarrow",!0);se(ce,xe,at,"","\\hookrightarrow",!0);se(ce,xe,at,"","\\searrow",!0);se(ce,xe,at,"","\\leftharpoonup",!0);se(ce,xe,at,"","\\rightharpoonup",!0);se(ce,xe,at,"","\\swarrow",!0);se(ce,xe,at,"","\\leftharpoondown",!0);se(ce,xe,at,"","\\rightharpoondown",!0);se(ce,xe,at,"","\\nwarrow",!0);se(ce,xe,at,"","\\rightleftharpoons",!0);se(ce,it,at,"","\\nless",!0);se(ce,it,at,"","\\@nleqslant");se(ce,it,at,"","\\@nleqq");se(ce,it,at,"","\\lneq",!0);se(ce,it,at,"","\\lneqq",!0);se(ce,it,at,"","\\@lvertneqq");se(ce,it,at,"","\\lnsim",!0);se(ce,it,at,"","\\lnapprox",!0);se(ce,it,at,"","\\nprec",!0);se(ce,it,at,"","\\npreceq",!0);se(ce,it,at,"","\\precnsim",!0);se(ce,it,at,"","\\precnapprox",!0);se(ce,it,at,"","\\nsim",!0);se(ce,it,at,"","\\@nshortmid");se(ce,it,at,"","\\nmid",!0);se(ce,it,at,"","\\nvdash",!0);se(ce,it,at,"","\\nvDash",!0);se(ce,it,at,"","\\ntriangleleft");se(ce,it,at,"","\\ntrianglelefteq",!0);se(ce,it,at,"","\\subsetneq",!0);se(ce,it,at,"","\\@varsubsetneq");se(ce,it,at,"","\\subsetneqq",!0);se(ce,it,at,"","\\@varsubsetneqq");se(ce,it,at,"","\\ngtr",!0);se(ce,it,at,"","\\@ngeqslant");se(ce,it,at,"","\\@ngeqq");se(ce,it,at,"","\\gneq",!0);se(ce,it,at,"","\\gneqq",!0);se(ce,it,at,"","\\@gvertneqq");se(ce,it,at,"","\\gnsim",!0);se(ce,it,at,"","\\gnapprox",!0);se(ce,it,at,"","\\nsucc",!0);se(ce,it,at,"","\\nsucceq",!0);se(ce,it,at,"","\\succnsim",!0);se(ce,it,at,"","\\succnapprox",!0);se(ce,it,at,"","\\ncong",!0);se(ce,it,at,"","\\@nshortparallel");se(ce,it,at,"","\\nparallel",!0);se(ce,it,at,"","\\nVDash",!0);se(ce,it,at,"","\\ntriangleright");se(ce,it,at,"","\\ntrianglerighteq",!0);se(ce,it,at,"","\\@nsupseteqq");se(ce,it,at,"","\\supsetneq",!0);se(ce,it,at,"","\\@varsupsetneq");se(ce,it,at,"","\\supsetneqq",!0);se(ce,it,at,"","\\@varsupsetneqq");se(ce,it,at,"","\\nVdash",!0);se(ce,it,at,"","\\precneqq",!0);se(ce,it,at,"","\\succneqq",!0);se(ce,it,at,"","\\@nsubseteqq");se(ce,it,Zr,"","\\unlhd");se(ce,it,Zr,"","\\unrhd");se(ce,it,at,"","\\nleftarrow",!0);se(ce,it,at,"","\\nrightarrow",!0);se(ce,it,at,"","\\nLeftarrow",!0);se(ce,it,at,"","\\nRightarrow",!0);se(ce,it,at,"","\\nleftrightarrow",!0);se(ce,it,at,"","\\nLeftrightarrow",!0);se(ce,it,at,"","\\vartriangle");se(ce,it,Ct,"","\\hslash");se(ce,it,Ct,"","\\triangledown");se(ce,it,Ct,"","\\lozenge");se(ce,it,Ct,"","\\circledS");se(ce,it,Ct,"","\\circledR");se($n,it,Ct,"","\\circledR");se(ce,it,Ct,"","\\measuredangle",!0);se(ce,it,Ct,"","\\nexists");se(ce,it,Ct,"","\\mho");se(ce,it,Ct,"","\\Finv",!0);se(ce,it,Ct,"","\\Game",!0);se(ce,it,Ct,"","\\backprime");se(ce,it,Ct,"","\\blacktriangle");se(ce,it,Ct,"","\\blacktriangledown");se(ce,it,Ct,"","\\blacksquare");se(ce,it,Ct,"","\\blacklozenge");se(ce,it,Ct,"","\\bigstar");se(ce,it,Ct,"","\\sphericalangle",!0);se(ce,it,Ct,"","\\complement",!0);se(ce,it,Ct,"","\\eth",!0);se($n,xe,Ct,"","");se(ce,it,Ct,"","\\diagup");se(ce,it,Ct,"","\\diagdown");se(ce,it,Ct,"","\\square");se(ce,it,Ct,"","\\Box");se(ce,it,Ct,"","\\Diamond");se(ce,it,Ct,"","\\yen",!0);se($n,it,Ct,"","\\yen",!0);se(ce,it,Ct,"","\\checkmark",!0);se($n,it,Ct,"","\\checkmark");se(ce,it,Ct,"","\\beth",!0);se(ce,it,Ct,"","\\daleth",!0);se(ce,it,Ct,"","\\gimel",!0);se(ce,it,Ct,"","\\digamma",!0);se(ce,it,Ct,"","\\varkappa");se(ce,it,zc,"","\\@ulcorner",!0);se(ce,it,Ru,"","\\@urcorner",!0);se(ce,it,zc,"","\\@llcorner",!0);se(ce,it,Ru,"","\\@lrcorner",!0);se(ce,it,at,"","\\leqq",!0);se(ce,it,at,"","\\leqslant",!0);se(ce,it,at,"","\\eqslantless",!0);se(ce,it,at,"","\\lesssim",!0);se(ce,it,at,"","\\lessapprox",!0);se(ce,it,at,"","\\approxeq",!0);se(ce,it,Zr,"","\\lessdot");se(ce,it,at,"","\\lll",!0);se(ce,it,at,"","\\lessgtr",!0);se(ce,it,at,"","\\lesseqgtr",!0);se(ce,it,at,"","\\lesseqqgtr",!0);se(ce,it,at,"","\\doteqdot");se(ce,it,at,"","\\risingdotseq",!0);se(ce,it,at,"","\\fallingdotseq",!0);se(ce,it,at,"","\\backsim",!0);se(ce,it,at,"","\\backsimeq",!0);se(ce,it,at,"","\\subseteqq",!0);se(ce,it,at,"","\\Subset",!0);se(ce,it,at,"","\\sqsubset",!0);se(ce,it,at,"","\\preccurlyeq",!0);se(ce,it,at,"","\\curlyeqprec",!0);se(ce,it,at,"","\\precsim",!0);se(ce,it,at,"","\\precapprox",!0);se(ce,it,at,"","\\vartriangleleft");se(ce,it,at,"","\\trianglelefteq");se(ce,it,at,"","\\vDash",!0);se(ce,it,at,"","\\Vvdash",!0);se(ce,it,at,"","\\smallsmile");se(ce,it,at,"","\\smallfrown");se(ce,it,at,"","\\bumpeq",!0);se(ce,it,at,"","\\Bumpeq",!0);se(ce,it,at,"","\\geqq",!0);se(ce,it,at,"","\\geqslant",!0);se(ce,it,at,"","\\eqslantgtr",!0);se(ce,it,at,"","\\gtrsim",!0);se(ce,it,at,"","\\gtrapprox",!0);se(ce,it,Zr,"","\\gtrdot");se(ce,it,at,"","\\ggg",!0);se(ce,it,at,"","\\gtrless",!0);se(ce,it,at,"","\\gtreqless",!0);se(ce,it,at,"","\\gtreqqless",!0);se(ce,it,at,"","\\eqcirc",!0);se(ce,it,at,"","\\circeq",!0);se(ce,it,at,"","\\triangleq",!0);se(ce,it,at,"","\\thicksim");se(ce,it,at,"","\\thickapprox");se(ce,it,at,"","\\supseteqq",!0);se(ce,it,at,"","\\Supset",!0);se(ce,it,at,"","\\sqsupset",!0);se(ce,it,at,"","\\succcurlyeq",!0);se(ce,it,at,"","\\curlyeqsucc",!0);se(ce,it,at,"","\\succsim",!0);se(ce,it,at,"","\\succapprox",!0);se(ce,it,at,"","\\vartriangleright");se(ce,it,at,"","\\trianglerighteq");se(ce,it,at,"","\\Vdash",!0);se(ce,it,at,"","\\shortmid");se(ce,it,at,"","\\shortparallel");se(ce,it,at,"","\\between",!0);se(ce,it,at,"","\\pitchfork",!0);se(ce,it,at,"","\\varpropto");se(ce,it,at,"","\\blacktriangleleft");se(ce,it,at,"","\\therefore",!0);se(ce,it,at,"","\\backepsilon");se(ce,it,at,"","\\blacktriangleright");se(ce,it,at,"","\\because",!0);se(ce,it,at,"","\\llless");se(ce,it,at,"","\\gggtr");se(ce,it,Zr,"","\\lhd");se(ce,it,Zr,"","\\rhd");se(ce,it,at,"","\\eqsim",!0);se(ce,xe,at,"","\\Join");se(ce,it,at,"","\\Doteq",!0);se(ce,it,Zr,"","\\dotplus",!0);se(ce,it,Zr,"","\\smallsetminus");se(ce,it,Zr,"","\\Cap",!0);se(ce,it,Zr,"","\\Cup",!0);se(ce,it,Zr,"","\\doublebarwedge",!0);se(ce,it,Zr,"","\\boxminus",!0);se(ce,it,Zr,"","\\boxplus",!0);se(ce,it,Zr,"","\\divideontimes",!0);se(ce,it,Zr,"","\\ltimes",!0);se(ce,it,Zr,"","\\rtimes",!0);se(ce,it,Zr,"","\\leftthreetimes",!0);se(ce,it,Zr,"","\\rightthreetimes",!0);se(ce,it,Zr,"","\\curlywedge",!0);se(ce,it,Zr,"","\\curlyvee",!0);se(ce,it,Zr,"","\\circleddash",!0);se(ce,it,Zr,"","\\circledast",!0);se(ce,it,Zr,"","\\centerdot");se(ce,it,Zr,"","\\intercal",!0);se(ce,it,Zr,"","\\doublecap");se(ce,it,Zr,"","\\doublecup");se(ce,it,Zr,"","\\boxtimes",!0);se(ce,it,at,"","\\dashrightarrow",!0);se(ce,it,at,"","\\dashleftarrow",!0);se(ce,it,at,"","\\leftleftarrows",!0);se(ce,it,at,"","\\leftrightarrows",!0);se(ce,it,at,"","\\Lleftarrow",!0);se(ce,it,at,"","\\twoheadleftarrow",!0);se(ce,it,at,"","\\leftarrowtail",!0);se(ce,it,at,"","\\looparrowleft",!0);se(ce,it,at,"","\\leftrightharpoons",!0);se(ce,it,at,"","\\curvearrowleft",!0);se(ce,it,at,"","\\circlearrowleft",!0);se(ce,it,at,"","\\Lsh",!0);se(ce,it,at,"","\\upuparrows",!0);se(ce,it,at,"","\\upharpoonleft",!0);se(ce,it,at,"","\\downharpoonleft",!0);se(ce,xe,at,"","\\origof",!0);se(ce,xe,at,"","\\imageof",!0);se(ce,it,at,"","\\multimap",!0);se(ce,it,at,"","\\leftrightsquigarrow",!0);se(ce,it,at,"","\\rightrightarrows",!0);se(ce,it,at,"","\\rightleftarrows",!0);se(ce,it,at,"","\\twoheadrightarrow",!0);se(ce,it,at,"","\\rightarrowtail",!0);se(ce,it,at,"","\\looparrowright",!0);se(ce,it,at,"","\\curvearrowright",!0);se(ce,it,at,"","\\circlearrowright",!0);se(ce,it,at,"","\\Rsh",!0);se(ce,it,at,"","\\downdownarrows",!0);se(ce,it,at,"","\\upharpoonright",!0);se(ce,it,at,"","\\downharpoonright",!0);se(ce,it,at,"","\\rightsquigarrow",!0);se(ce,it,at,"","\\leadsto");se(ce,it,at,"","\\Rrightarrow",!0);se(ce,it,at,"","\\restriction");se(ce,xe,Ct,"","`");se(ce,xe,Ct,"$","\\$");se($n,xe,Ct,"$","\\$");se($n,xe,Ct,"$","\\textdollar");se(ce,xe,Ct,"%","\\%");se($n,xe,Ct,"%","\\%");se(ce,xe,Ct,"_","\\_");se($n,xe,Ct,"_","\\_");se($n,xe,Ct,"_","\\textunderscore");se(ce,xe,Ct,"","\\angle",!0);se(ce,xe,Ct,"","\\infty",!0);se(ce,xe,Ct,"","\\prime");se(ce,xe,Ct,"","\\triangle");se(ce,xe,Ct,"","\\Gamma",!0);se(ce,xe,Ct,"","\\Delta",!0);se(ce,xe,Ct,"","\\Theta",!0);se(ce,xe,Ct,"","\\Lambda",!0);se(ce,xe,Ct,"","\\Xi",!0);se(ce,xe,Ct,"","\\Pi",!0);se(ce,xe,Ct,"","\\Sigma",!0);se(ce,xe,Ct,"","\\Upsilon",!0);se(ce,xe,Ct,"","\\Phi",!0);se(ce,xe,Ct,"","\\Psi",!0);se(ce,xe,Ct,"","\\Omega",!0);se(ce,xe,Ct,"A","");se(ce,xe,Ct,"B","");se(ce,xe,Ct,"E","");se(ce,xe,Ct,"Z","");se(ce,xe,Ct,"H","");se(ce,xe,Ct,"I","");se(ce,xe,Ct,"K","");se(ce,xe,Ct,"M","");se(ce,xe,Ct,"N","");se(ce,xe,Ct,"O","");se(ce,xe,Ct,"P","");se(ce,xe,Ct,"T","");se(ce,xe,Ct,"X","");se(ce,xe,Ct,"","\\neg",!0);se(ce,xe,Ct,"","\\lnot");se(ce,xe,Ct,"","\\top");se(ce,xe,Ct,"","\\bot");se(ce,xe,Ct,"","\\emptyset");se(ce,it,Ct,"","\\varnothing");se(ce,xe,Fi,"","\\alpha",!0);se(ce,xe,Fi,"","\\beta",!0);se(ce,xe,Fi,"","\\gamma",!0);se(ce,xe,Fi,"","\\delta",!0);se(ce,xe,Fi,"","\\epsilon",!0);se(ce,xe,Fi,"","\\zeta",!0);se(ce,xe,Fi,"","\\eta",!0);se(ce,xe,Fi,"","\\theta",!0);se(ce,xe,Fi,"","\\iota",!0);se(ce,xe,Fi,"","\\kappa",!0);se(ce,xe,Fi,"","\\lambda",!0);se(ce,xe,Fi,"","\\mu",!0);se(ce,xe,Fi,"","\\nu",!0);se(ce,xe,Fi,"","\\xi",!0);se(ce,xe,Fi,"","\\omicron",!0);se(ce,xe,Fi,"","\\pi",!0);se(ce,xe,Fi,"","\\rho",!0);se(ce,xe,Fi,"","\\sigma",!0);se(ce,xe,Fi,"","\\tau",!0);se(ce,xe,Fi,"","\\upsilon",!0);se(ce,xe,Fi,"","\\phi",!0);se(ce,xe,Fi,"","\\chi",!0);se(ce,xe,Fi,"","\\psi",!0);se(ce,xe,Fi,"","\\omega",!0);se(ce,xe,Fi,"","\\varepsilon",!0);se(ce,xe,Fi,"","\\vartheta",!0);se(ce,xe,Fi,"","\\varpi",!0);se(ce,xe,Fi,"","\\varrho",!0);se(ce,xe,Fi,"","\\varsigma",!0);se(ce,xe,Fi,"","\\varphi",!0);se(ce,xe,Zr,"","*",!0);se(ce,xe,Zr,"+","+");se(ce,xe,Zr,"","-",!0);se(ce,xe,Zr,"","\\cdot",!0);se(ce,xe,Zr,"","\\circ",!0);se(ce,xe,Zr,"","\\div",!0);se(ce,xe,Zr,"","\\pm",!0);se(ce,xe,Zr,"","\\times",!0);se(ce,xe,Zr,"","\\cap",!0);se(ce,xe,Zr,"","\\cup",!0);se(ce,xe,Zr,"","\\setminus",!0);se(ce,xe,Zr,"","\\land");se(ce,xe,Zr,"","\\lor");se(ce,xe,Zr,"","\\wedge",!0);se(ce,xe,Zr,"","\\vee",!0);se(ce,xe,Ct,"","\\surd");se(ce,xe,zc,"","\\langle",!0);se(ce,xe,zc,"","\\lvert");se(ce,xe,zc,"","\\lVert");se(ce,xe,Ru,"?","?");se(ce,xe,Ru,"!","!");se(ce,xe,Ru,"","\\rangle",!0);se(ce,xe,Ru,"","\\rvert");se(ce,xe,Ru,"","\\rVert");se(ce,xe,at,"=","=");se(ce,xe,at,":",":");se(ce,xe,at,"","\\approx",!0);se(ce,xe,at,"","\\cong",!0);se(ce,xe,at,"","\\ge");se(ce,xe,at,"","\\geq",!0);se(ce,xe,at,"","\\gets");se(ce,xe,at,">","\\gt",!0);se(ce,xe,at,"","\\in",!0);se(ce,xe,at,"","\\@not");se(ce,xe,at,"","\\subset",!0);se(ce,xe,at,"","\\supset",!0);se(ce,xe,at,"","\\subseteq",!0);se(ce,xe,at,"","\\supseteq",!0);se(ce,it,at,"","\\nsubseteq",!0);se(ce,it,at,"","\\nsupseteq",!0);se(ce,xe,at,"","\\models");se(ce,xe,at,"","\\leftarrow",!0);se(ce,xe,at,"","\\le");se(ce,xe,at,"","\\leq",!0);se(ce,xe,at,"<","\\lt",!0);se(ce,xe,at,"","\\rightarrow",!0);se(ce,xe,at,"","\\to");se(ce,it,at,"","\\ngeq",!0);se(ce,it,at,"","\\nleq",!0);se(ce,xe,Tp,"","\\ ");se(ce,xe,Tp,"","\\space");se(ce,xe,Tp,"","\\nobreakspace");se($n,xe,Tp,"","\\ ");se($n,xe,Tp,""," ");se($n,xe,Tp,"","\\space");se($n,xe,Tp,"","\\nobreakspace");se(ce,xe,Tp,null,"\\nobreak");se(ce,xe,Tp,null,"\\allowbreak");se(ce,xe,ak,",",",");se(ce,xe,ak,";",";");se(ce,it,Zr,"","\\barwedge",!0);se(ce,it,Zr,"","\\veebar",!0);se(ce,xe,Zr,"","\\odot",!0);se(ce,xe,Zr,"","\\oplus",!0);se(ce,xe,Zr,"","\\otimes",!0);se(ce,xe,Ct,"","\\partial",!0);se(ce,xe,Zr,"","\\oslash",!0);se(ce,it,Zr,"","\\circledcirc",!0);se(ce,it,Zr,"","\\boxdot",!0);se(ce,xe,Zr,"","\\bigtriangleup");se(ce,xe,Zr,"","\\bigtriangledown");se(ce,xe,Zr,"","\\dagger");se(ce,xe,Zr,"","\\diamond");se(ce,xe,Zr,"","\\star");se(ce,xe,Zr,"","\\triangleleft");se(ce,xe,Zr,"","\\triangleright");se(ce,xe,zc,"{","\\{");se($n,xe,Ct,"{","\\{");se($n,xe,Ct,"{","\\textbraceleft");se(ce,xe,Ru,"}","\\}");se($n,xe,Ct,"}","\\}");se($n,xe,Ct,"}","\\textbraceright");se(ce,xe,zc,"{","\\lbrace");se(ce,xe,Ru,"}","\\rbrace");se(ce,xe,zc,"[","\\lbrack",!0);se($n,xe,Ct,"[","\\lbrack",!0);se(ce,xe,Ru,"]","\\rbrack",!0);se($n,xe,Ct,"]","\\rbrack",!0);se(ce,xe,zc,"(","\\lparen",!0);se(ce,xe,Ru,")","\\rparen",!0);se($n,xe,Ct,"<","\\textless",!0);se($n,xe,Ct,">","\\textgreater",!0);se(ce,xe,zc,"","\\lfloor",!0);se(ce,xe,Ru,"","\\rfloor",!0);se(ce,xe,zc,"","\\lceil",!0);se(ce,xe,Ru,"","\\rceil",!0);se(ce,xe,Ct,"\\","\\backslash");se(ce,xe,Ct,"","|");se(ce,xe,Ct,"","\\vert");se($n,xe,Ct,"|","\\textbar",!0);se(ce,xe,Ct,"","\\|");se(ce,xe,Ct,"","\\Vert");se($n,xe,Ct,"","\\textbardbl");se($n,xe,Ct,"~","\\textasciitilde");se($n,xe,Ct,"\\","\\textbackslash");se($n,xe,Ct,"^","\\textasciicircum");se(ce,xe,at,"","\\uparrow",!0);se(ce,xe,at,"","\\Uparrow",!0);se(ce,xe,at,"","\\downarrow",!0);se(ce,xe,at,"","\\Downarrow",!0);se(ce,xe,at,"","\\updownarrow",!0);se(ce,xe,at,"","\\Updownarrow",!0);se(ce,xe,al,"","\\coprod");se(ce,xe,al,"","\\bigvee");se(ce,xe,al,"","\\bigwedge");se(ce,xe,al,"","\\biguplus");se(ce,xe,al,"","\\bigcap");se(ce,xe,al,"","\\bigcup");se(ce,xe,al,"","\\int");se(ce,xe,al,"","\\intop");se(ce,xe,al,"","\\iint");se(ce,xe,al,"","\\iiint");se(ce,xe,al,"","\\prod");se(ce,xe,al,"","\\sum");se(ce,xe,al,"","\\bigotimes");se(ce,xe,al,"","\\bigoplus");se(ce,xe,al,"","\\bigodot");se(ce,xe,al,"","\\oint");se(ce,xe,al,"","\\oiint");se(ce,xe,al,"","\\oiiint");se(ce,xe,al,"","\\bigsqcup");se(ce,xe,al,"","\\smallint");se($n,xe,ux,"","\\textellipsis");se(ce,xe,ux,"","\\mathellipsis");se($n,xe,ux,"","\\ldots",!0);se(ce,xe,ux,"","\\ldots",!0);se(ce,xe,ux,"","\\@cdots",!0);se(ce,xe,ux,"","\\ddots",!0);se(ce,xe,Ct,"","\\varvdots");se($n,xe,Ct,"","\\varvdots");se(ce,xe,vo,"","\\acute");se(ce,xe,vo,"","\\grave");se(ce,xe,vo,"","\\ddot");se(ce,xe,vo,"~","\\tilde");se(ce,xe,vo,"","\\bar");se(ce,xe,vo,"","\\breve");se(ce,xe,vo,"","\\check");se(ce,xe,vo,"^","\\hat");se(ce,xe,vo,"","\\vec");se(ce,xe,vo,"","\\dot");se(ce,xe,vo,"","\\mathring");se(ce,xe,Fi,"","\\@imath");se(ce,xe,Fi,"","\\@jmath");se(ce,xe,Ct,"","");se(ce,xe,Ct,"","");se($n,xe,Ct,"","\\i",!0);se($n,xe,Ct,"","\\j",!0);se($n,xe,Ct,"","\\ss",!0);se($n,xe,Ct,"","\\ae",!0);se($n,xe,Ct,"","\\oe",!0);se($n,xe,Ct,"","\\o",!0);se($n,xe,Ct,"","\\AE",!0);se($n,xe,Ct,"","\\OE",!0);se($n,xe,Ct,"","\\O",!0);se($n,xe,vo,"","\\'");se($n,xe,vo,"","\\`");se($n,xe,vo,"","\\^");se($n,xe,vo,"","\\~");se($n,xe,vo,"","\\=");se($n,xe,vo,"","\\u");se($n,xe,vo,"","\\.");se($n,xe,vo,"","\\c");se($n,xe,vo,"","\\r");se($n,xe,vo,"","\\v");se($n,xe,vo,"",'\\"');se($n,xe,vo,"","\\H");se($n,xe,vo,"","\\textcircled");var JK={"--":!0,"---":!0,"``":!0,"''":!0};se($n,xe,Ct,"","--",!0);se($n,xe,Ct,"","\\textendash");se($n,xe,Ct,"","---",!0);se($n,xe,Ct,"","\\textemdash");se($n,xe,Ct,"","`",!0);se($n,xe,Ct,"","\\textquoteleft");se($n,xe,Ct,"","'",!0);se($n,xe,Ct,"","\\textquoteright");se($n,xe,Ct,"","``",!0);se($n,xe,Ct,"","\\textquotedblleft");se($n,xe,Ct,"","''",!0);se($n,xe,Ct,"","\\textquotedblright");se(ce,xe,Ct,"","\\degree",!0);se($n,xe,Ct,"","\\degree");se($n,xe,Ct,"","\\textdegree",!0);se(ce,xe,Ct,"","\\pounds");se(ce,xe,Ct,"","\\mathsterling",!0);se($n,xe,Ct,"","\\pounds");se($n,xe,Ct,"","\\textsterling",!0);se(ce,it,Ct,"","\\maltese");se($n,it,Ct,"","\\maltese");var KU='0123456789/@."';for(var D5=0;D5<KU.length;D5++){var QU=KU.charAt(D5);se(ce,xe,Ct,QU,QU)}var JU='0123456789!@*()-=+";:?/.,';for(var N5=0;N5<JU.length;N5++){var eV=JU.charAt(N5);se($n,xe,Ct,eV,eV)}var tC="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var z5=0;z5<tC.length;z5++){var E3=tC.charAt(z5);se(ce,xe,Fi,E3,E3),se($n,xe,Ct,E3,E3)}se(ce,it,Ct,"C","");se($n,it,Ct,"C","");se(ce,it,Ct,"H","");se($n,it,Ct,"H","");se(ce,it,Ct,"N","");se($n,it,Ct,"N","");se(ce,it,Ct,"P","");se($n,it,Ct,"P","");se(ce,it,Ct,"Q","");se($n,it,Ct,"Q","");se(ce,it,Ct,"R","");se($n,it,Ct,"R","");se(ce,it,Ct,"Z","");se($n,it,Ct,"Z","");se(ce,xe,Fi,"h","");se($n,xe,Fi,"h","");var es="";for(var gu=0;gu<tC.length;gu++){var Oo=tC.charAt(gu);es=String.fromCharCode(55349,56320+gu),se(ce,xe,Fi,Oo,es),se($n,xe,Ct,Oo,es),es=String.fromCharCode(55349,56372+gu),se(ce,xe,Fi,Oo,es),se($n,xe,Ct,Oo,es),es=String.fromCharCode(55349,56424+gu),se(ce,xe,Fi,Oo,es),se($n,xe,Ct,Oo,es),es=String.fromCharCode(55349,56580+gu),se(ce,xe,Fi,Oo,es),se($n,xe,Ct,Oo,es),es=String.fromCharCode(55349,56684+gu),se(ce,xe,Fi,Oo,es),se($n,xe,Ct,Oo,es),es=String.fromCharCode(55349,56736+gu),se(ce,xe,Fi,Oo,es),se($n,xe,Ct,Oo,es),es=String.fromCharCode(55349,56788+gu),se(ce,xe,Fi,Oo,es),se($n,xe,Ct,Oo,es),es=String.fromCharCode(55349,56840+gu),se(ce,xe,Fi,Oo,es),se($n,xe,Ct,Oo,es),es=String.fromCharCode(55349,56944+gu),se(ce,xe,Fi,Oo,es),se($n,xe,Ct,Oo,es),gu<26&&(es=String.fromCharCode(55349,56632+gu),se(ce,xe,Fi,Oo,es),se($n,xe,Ct,Oo,es),es=String.fromCharCode(55349,56476+gu),se(ce,xe,Fi,Oo,es),se($n,xe,Ct,Oo,es))}es="";se(ce,xe,Fi,"k",es);se($n,xe,Ct,"k",es);for(var wg=0;wg<10;wg++){var um=wg.toString();es=String.fromCharCode(55349,57294+wg),se(ce,xe,Fi,um,es),se($n,xe,Ct,um,es),es=String.fromCharCode(55349,57314+wg),se(ce,xe,Fi,um,es),se($n,xe,Ct,um,es),es=String.fromCharCode(55349,57324+wg),se(ce,xe,Fi,um,es),se($n,xe,Ct,um,es),es=String.fromCharCode(55349,57334+wg),se(ce,xe,Fi,um,es),se($n,xe,Ct,um,es)}var XP="";for(var F5=0;F5<XP.length;F5++){var S3=XP.charAt(F5);se(ce,xe,Fi,S3,S3),se($n,xe,Ct,S3,S3)}var A3=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],tV=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],Hbe=function(t,n){var r=t.charCodeAt(0),a=t.charCodeAt(1),u=(r-55296)*1024+(a-56320)+65536,f=n==="math"?0:1;if(119808<=u&&u<120484){var s=Math.floor((u-119808)/26);return[A3[s][2],A3[s][f]]}else if(120782<=u&&u<=120831){var v=Math.floor((u-120782)/10);return[tV[v][2],tV[v][f]]}else{if(u===120485||u===120486)return[A3[0][2],A3[0][f]];if(120486<u&&u<120782)return["",""];throw new ir("Unsupported character: "+t)}},ok=function(t,n,r){return io[r][t]&&io[r][t].replace&&(t=io[r][t].replace),{value:t,metrics:NL(t,n,r)}},Jd=function(t,n,r,a,u){var f=ok(t,n,r),s=f.metrics;t=f.value;var v;if(s){var x=s.italic;(r==="text"||a&&a.font==="mathit")&&(x=0),v=new pd(t,s.height,s.depth,x,s.skew,s.width,u)}else typeof console<"u"&&console.warn("No character metrics "+("for '"+t+"' in style '"+n+"' and mode '"+r+"'")),v=new pd(t,0,0,0,0,0,u);if(a){v.maxFontSize=a.sizeMultiplier,a.style.isTight()&&v.classes.push("mtight");var A=a.getColor();A&&(v.style.color=A)}return v},Gbe=function(t,n,r,a){return a===void 0&&(a=[]),r.font==="boldsymbol"&&ok(t,"Main-Bold",n).metrics?Jd(t,"Main-Bold",n,r,a.concat(["mathbf"])):t==="\\"||io[n][t].font==="main"?Jd(t,"Main-Regular",n,r,a):Jd(t,"AMS-Regular",n,r,a.concat(["amsrm"]))},qbe=function(t,n,r,a,u){return u!=="textord"&&ok(t,"Math-BoldItalic",n).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}},Wbe=function(t,n,r){var a=t.mode,u=t.text,f=["mord"],s=a==="math"||a==="text"&&n.font,v=s?n.font:n.fontFamily,x="",A="";if(u.charCodeAt(0)===55349&&([x,A]=Hbe(u,a)),x.length>0)return Jd(u,x,a,n,f.concat(A));if(v){var C,P;if(v==="boldsymbol"){var L=qbe(u,a,n,f,r);C=L.fontName,P=[L.fontClass]}else s?(C=nQ[v].fontName,P=[v]):(C=C3(v,n.fontWeight,n.fontShape),P=[v,n.fontWeight,n.fontShape]);if(ok(u,C,a).metrics)return Jd(u,C,a,n,f.concat(P));if(JK.hasOwnProperty(u)&&C.slice(0,10)==="Typewriter"){for(var F=[],U=0;U<u.length;U++)F.push(Jd(u[U],C,a,n,f.concat(P)));return tQ(F)}}if(r==="mathord")return Jd(u,"Math-Italic",a,n,f.concat(["mathnormal"]));if(r==="textord"){var q=io[a][u]&&io[a][u].font;if(q==="ams"){var G=C3("amsrm",n.fontWeight,n.fontShape);return Jd(u,G,a,n,f.concat("amsrm",n.fontWeight,n.fontShape))}else if(q==="main"||!q){var $=C3("textrm",n.fontWeight,n.fontShape);return Jd(u,$,a,n,f.concat(n.fontWeight,n.fontShape))}else{var X=C3(q,n.fontWeight,n.fontShape);return Jd(u,X,a,n,f.concat(X,n.fontWeight,n.fontShape))}}else throw new Error("unexpected type: "+r+" in makeOrd")},Zbe=(e,t)=>{if(d0(e.classes)!==d0(t.classes)||e.skew!==t.skew||e.maxFontSize!==t.maxFontSize)return!1;if(e.classes.length===1){var n=e.classes[0];if(n==="mbin"||n==="mord")return!1}for(var r in e.style)if(e.style.hasOwnProperty(r)&&e.style[r]!==t.style[r])return!1;for(var a in t.style)if(t.style.hasOwnProperty(a)&&e.style[a]!==t.style[a])return!1;return!0},Xbe=e=>{for(var t=0;t<e.length-1;t++){var n=e[t],r=e[t+1];n instanceof pd&&r instanceof pd&&Zbe(n,r)&&(n.text+=r.text,n.height=Math.max(n.height,r.height),n.depth=Math.max(n.depth,r.depth),n.italic=r.italic,e.splice(t+1,1),t--)}return e},FL=function(t){for(var n=0,r=0,a=0,u=0;u<t.children.length;u++){var f=t.children[u];f.height>n&&(n=f.height),f.depth>r&&(r=f.depth),f.maxFontSize>a&&(a=f.maxFontSize)}t.height=n,t.depth=r,t.maxFontSize=a},Gu=function(t,n,r,a){var u=new OT(t,n,r,a);return FL(u),u},eQ=(e,t,n,r)=>new OT(e,t,n,r),Ybe=function(t,n,r){var a=Gu([t],[],n);return a.height=Math.max(r||n.fontMetrics().defaultRuleThickness,n.minRuleThickness),a.style.borderBottomWidth=Er(a.height),a.maxFontSize=1,a},Kbe=function(t,n,r,a){var u=new zL(t,n,r,a);return FL(u),u},tQ=function(t){var n=new PT(t);return FL(n),n},Qbe=function(t,n){return t instanceof PT?Gu([],[t],n):t},Jbe=function(t){if(t.positionType==="individualShift"){for(var n=t.children,r=[n[0]],a=-n[0].shift-n[0].elem.depth,u=a,f=1;f<n.length;f++){var s=-n[f].shift-u-n[f].elem.depth,v=s-(n[f-1].elem.height+n[f-1].elem.depth);u=u+s,r.push({type:"kern",size:v}),r.push(n[f])}return{children:r,depth:a}}var x;if(t.positionType==="top"){for(var A=t.positionData,C=0;C<t.children.length;C++){var P=t.children[C];A-=P.type==="kern"?P.size:P.elem.height+P.elem.depth}x=A}else if(t.positionType==="bottom")x=-t.positionData;else{var L=t.children[0];if(L.type!=="elem")throw new Error('First child must have type "elem".');if(t.positionType==="shift")x=-L.elem.depth-t.positionData;else if(t.positionType==="firstBaseline")x=-L.elem.depth;else throw new Error("Invalid positionType "+t.positionType+".")}return{children:t.children,depth:x}},ewe=function(t,n){for(var{children:r,depth:a}=Jbe(t),u=0,f=0;f<r.length;f++){var s=r[f];if(s.type==="elem"){var v=s.elem;u=Math.max(u,v.maxFontSize,v.height)}}u+=2;var x=Gu(["pstrut"],[]);x.style.height=Er(u);for(var A=[],C=a,P=a,L=a,F=0;F<r.length;F++){var U=r[F];if(U.type==="kern")L+=U.size;else{var q=U.elem,G=U.wrapperClasses||[],$=U.wrapperStyle||{},X=Gu(G,[x,q],void 0,$);X.style.top=Er(-u-L-q.depth),U.marginLeft&&(X.style.marginLeft=U.marginLeft),U.marginRight&&(X.style.marginRight=U.marginRight),A.push(X),L+=q.height+q.depth}C=Math.min(C,L),P=Math.max(P,L)}var ie=Gu(["vlist"],A);ie.style.height=Er(P);var de;if(C<0){var fe=Gu([],[]),be=Gu(["vlist"],[fe]);be.style.height=Er(-C);var ve=Gu(["vlist-s"],[new pd("")]);de=[Gu(["vlist-r"],[ie,ve]),Gu(["vlist-r"],[be])]}else de=[Gu(["vlist-r"],[ie])];var Qe=Gu(["vlist-t"],de);return de.length===2&&Qe.classes.push("vlist-t2"),Qe.height=P,Qe.depth=-C,Qe},twe=(e,t)=>{var n=Gu(["mspace"],[],t),r=ko(e,t);return n.style.marginRight=Er(r),n},C3=function(t,n,r){var a="";switch(t){case"amsrm":a="AMS";break;case"textrm":a="Main";break;case"textsf":a="SansSerif";break;case"texttt":a="Typewriter";break;default:a=t}var u;return n==="textbf"&&r==="textit"?u="BoldItalic":n==="textbf"?u="Bold":n==="textit"?u="Italic":u="Regular",a+"-"+u},nQ={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathsfit:{variant:"sans-serif-italic",fontName:"SansSerif-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},rQ={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},nwe=function(t,n){var[r,a,u]=rQ[t],f=new h0(r),s=new _p([f],{width:Er(a),height:Er(u),style:"width:"+Er(a),viewBox:"0 0 "+1e3*a+" "+1e3*u,preserveAspectRatio:"xMinYMin"}),v=eQ(["overlay"],[s],n);return v.height=u,v.style.height=Er(u),v.style.width=Er(a),v},Xt={fontMap:nQ,makeSymbol:Jd,mathsym:Gbe,makeSpan:Gu,makeSvgSpan:eQ,makeLineSpan:Ybe,makeAnchor:Kbe,makeFragment:tQ,wrapFragment:Qbe,makeVList:ewe,makeOrd:Wbe,makeGlue:twe,staticSvg:nwe,svgData:rQ,tryCombineChars:Xbe},Ao={number:3,unit:"mu"},Tg={number:4,unit:"mu"},$f={number:5,unit:"mu"},rwe={mord:{mop:Ao,mbin:Tg,mrel:$f,minner:Ao},mop:{mord:Ao,mop:Ao,mrel:$f,minner:Ao},mbin:{mord:Tg,mop:Tg,mopen:Tg,minner:Tg},mrel:{mord:$f,mop:$f,mopen:$f,minner:$f},mopen:{},mclose:{mop:Ao,mbin:Tg,mrel:$f,minner:Ao},mpunct:{mord:Ao,mop:Ao,mrel:$f,mopen:Ao,mclose:Ao,mpunct:Ao,minner:Ao},minner:{mord:Ao,mop:Ao,mbin:Tg,mrel:$f,mopen:Ao,mpunct:Ao,minner:Ao}},iwe={mord:{mop:Ao},mop:{mord:Ao,mop:Ao},mbin:{},mrel:{},mopen:{},mclose:{mop:Ao},mpunct:{},minner:{mop:Ao}},iQ={},nC={},rC={};function Nr(e){for(var{type:t,names:n,props:r,handler:a,htmlBuilder:u,mathmlBuilder:f}=e,s={type:t,numArgs:r.numArgs,argTypes:r.argTypes,allowedInArgument:!!r.allowedInArgument,allowedInText:!!r.allowedInText,allowedInMath:r.allowedInMath===void 0?!0:r.allowedInMath,numOptionalArgs:r.numOptionalArgs||0,infix:!!r.infix,primitive:!!r.primitive,handler:a},v=0;v<n.length;++v)iQ[n[v]]=s;t&&(u&&(nC[t]=u),f&&(rC[t]=f))}function C_(e){var{type:t,htmlBuilder:n,mathmlBuilder:r}=e;Nr({type:t,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:n,mathmlBuilder:r})}var iC=function(t){return t.type==="ordgroup"&&t.body.length===1?t.body[0]:t},qo=function(t){return t.type==="ordgroup"?t.body:[t]},yp=Xt.makeSpan,swe=["leftmost","mbin","mopen","mrel","mop","mpunct"],awe=["rightmost","mrel","mclose","mpunct"],owe={display:Bi.DISPLAY,text:Bi.TEXT,script:Bi.SCRIPT,scriptscript:Bi.SCRIPTSCRIPT},lwe={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},fl=function(t,n,r,a){a===void 0&&(a=[null,null]);for(var u=[],f=0;f<t.length;f++){var s=wa(t[f],n);if(s instanceof PT){var v=s.children;u.push(...v)}else u.push(s)}if(Xt.tryCombineChars(u),!r)return u;var x=n;if(t.length===1){var A=t[0];A.type==="sizing"?x=n.havingSize(A.size):A.type==="styling"&&(x=n.havingStyle(owe[A.style]))}var C=yp([a[0]||"leftmost"],[],n),P=yp([a[1]||"rightmost"],[],n),L=r==="root";return nV(u,(F,U)=>{var q=U.classes[0],G=F.classes[0];q==="mbin"&&awe.includes(G)?U.classes[0]="mord":G==="mbin"&&swe.includes(q)&&(F.classes[0]="mord")},{node:C},P,L),nV(u,(F,U)=>{var q=YP(U),G=YP(F),$=q&&G?F.hasClass("mtight")?iwe[q][G]:rwe[q][G]:null;if($)return Xt.makeGlue($,x)},{node:C},P,L),u},nV=function e(t,n,r,a,u){a&&t.push(a);for(var f=0;f<t.length;f++){var s=t[f],v=sQ(s);if(v){e(v.children,n,r,null,u);continue}var x=!s.hasClass("mspace");if(x){var A=n(s,r.node);A&&(r.insertAfter?r.insertAfter(A):(t.unshift(A),f++))}x?r.node=s:u&&s.hasClass("newline")&&(r.node=yp(["leftmost"])),r.insertAfter=(C=>P=>{t.splice(C+1,0,P),f++})(f)}a&&t.pop()},sQ=function(t){return t instanceof PT||t instanceof zL||t instanceof OT&&t.hasClass("enclosing")?t:null},uwe=function e(t,n){var r=sQ(t);if(r){var a=r.children;if(a.length){if(n==="right")return e(a[a.length-1],"right");if(n==="left")return e(a[0],"left")}}return t},YP=function(t,n){return t?(n&&(t=uwe(t,n)),lwe[t.classes[0]]||null):null},Q2=function(t,n){var r=["nulldelimiter"].concat(t.baseSizingClasses());return yp(n.concat(r))},wa=function(t,n,r){if(!t)return yp();if(nC[t.type]){var a=nC[t.type](t,n);if(r&&n.size!==r.size){a=yp(n.sizingClasses(r),[a],n);var u=n.sizeMultiplier/r.sizeMultiplier;a.height*=u,a.depth*=u}return a}else throw new ir("Got group of unknown type: '"+t.type+"'")};function k3(e,t){var n=yp(["base"],e,t),r=yp(["strut"]);return r.style.height=Er(n.height+n.depth),n.depth&&(r.style.verticalAlign=Er(-n.depth)),n.children.unshift(r),n}function KP(e,t){var n=null;e.length===1&&e[0].type==="tag"&&(n=e[0].tag,e=e[0].body);var r=fl(e,t,"root"),a;r.length===2&&r[1].hasClass("tag")&&(a=r.pop());for(var u=[],f=[],s=0;s<r.length;s++)if(f.push(r[s]),r[s].hasClass("mbin")||r[s].hasClass("mrel")||r[s].hasClass("allowbreak")){for(var v=!1;s<r.length-1&&r[s+1].hasClass("mspace")&&!r[s+1].hasClass("newline");)s++,f.push(r[s]),r[s].hasClass("nobreak")&&(v=!0);v||(u.push(k3(f,t)),f=[])}else r[s].hasClass("newline")&&(f.pop(),f.length>0&&(u.push(k3(f,t)),f=[]),u.push(r[s]));f.length>0&&u.push(k3(f,t));var x;n?(x=k3(fl(n,t,!0)),x.classes=["tag"],u.push(x)):a&&u.push(a);var A=yp(["katex-html"],u);if(A.setAttribute("aria-hidden","true"),x){var C=x.children[0];C.style.height=Er(A.height+A.depth),A.depth&&(C.style.verticalAlign=Er(-A.depth))}return A}function aQ(e){return new PT(e)}class Ec{constructor(t,n,r){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=t,this.attributes={},this.children=n||[],this.classes=r||[]}setAttribute(t,n){this.attributes[t]=n}getAttribute(t){return this.attributes[t]}toNode(){var t=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&t.setAttribute(n,this.attributes[n]);this.classes.length>0&&(t.className=d0(this.classes));for(var r=0;r<this.children.length;r++)if(this.children[r]instanceof Jh&&this.children[r+1]instanceof Jh){for(var a=this.children[r].toText()+this.children[++r].toText();this.children[r+1]instanceof Jh;)a+=this.children[++r].toText();t.appendChild(new Jh(a).toNode())}else t.appendChild(this.children[r].toNode());return t}toMarkup(){var t="<"+this.type;for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(t+=" "+n+'="',t+=Ca.escape(this.attributes[n]),t+='"');this.classes.length>0&&(t+=' class ="'+Ca.escape(d0(this.classes))+'"'),t+=">";for(var r=0;r<this.children.length;r++)t+=this.children[r].toMarkup();return t+="</"+this.type+">",t}toText(){return this.children.map(t=>t.toText()).join("")}}class Jh{constructor(t){this.text=void 0,this.text=t}toNode(){return document.createTextNode(this.text)}toMarkup(){return Ca.escape(this.toText())}toText(){return this.text}}class cwe{constructor(t){this.width=void 0,this.character=void 0,this.width=t,t>=.05555&&t<=.05556?this.character="":t>=.1666&&t<=.1667?this.character="":t>=.2222&&t<=.2223?this.character="":t>=.2777&&t<=.2778?this.character="":t>=-.05556&&t<=-.05555?this.character="":t>=-.1667&&t<=-.1666?this.character="":t>=-.2223&&t<=-.2222?this.character="":t>=-.2778&&t<=-.2777?this.character="":this.character=null}toNode(){if(this.character)return document.createTextNode(this.character);var t=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return t.setAttribute("width",Er(this.width)),t}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+Er(this.width)+'"/>'}toText(){return this.character?this.character:" "}}var Qn={MathNode:Ec,TextNode:Jh,SpaceNode:cwe,newDocumentFragment:aQ},md=function(t,n,r){return io[n][t]&&io[n][t].replace&&t.charCodeAt(0)!==55349&&!(JK.hasOwnProperty(t)&&r&&(r.fontFamily&&r.fontFamily.slice(4,6)==="tt"||r.font&&r.font.slice(4,6)==="tt"))&&(t=io[n][t].replace),new Qn.TextNode(t)},BL=function(t){return t.length===1?t[0]:new Qn.MathNode("mrow",t)},jL=function(t,n){if(n.fontFamily==="texttt")return"monospace";if(n.fontFamily==="textsf")return n.fontShape==="textit"&&n.fontWeight==="textbf"?"sans-serif-bold-italic":n.fontShape==="textit"?"sans-serif-italic":n.fontWeight==="textbf"?"bold-sans-serif":"sans-serif";if(n.fontShape==="textit"&&n.fontWeight==="textbf")return"bold-italic";if(n.fontShape==="textit")return"italic";if(n.fontWeight==="textbf")return"bold";var r=n.font;if(!r||r==="mathnormal")return null;var a=t.mode;if(r==="mathit")return"italic";if(r==="boldsymbol")return t.type==="textord"?"bold":"bold-italic";if(r==="mathbf")return"bold";if(r==="mathbb")return"double-struck";if(r==="mathsfit")return"sans-serif-italic";if(r==="mathfrak")return"fraktur";if(r==="mathscr"||r==="mathcal")return"script";if(r==="mathsf")return"sans-serif";if(r==="mathtt")return"monospace";var u=t.text;if(["\\imath","\\jmath"].includes(u))return null;io[a][u]&&io[a][u].replace&&(u=io[a][u].replace);var f=Xt.fontMap[r].fontName;return NL(u,f,a)?Xt.fontMap[r].variant:null};function B5(e){if(!e)return!1;if(e.type==="mi"&&e.children.length===1){var t=e.children[0];return t instanceof Jh&&t.text==="."}else if(e.type==="mo"&&e.children.length===1&&e.getAttribute("separator")==="true"&&e.getAttribute("lspace")==="0em"&&e.getAttribute("rspace")==="0em"){var n=e.children[0];return n instanceof Jh&&n.text===","}else return!1}var rc=function(t,n,r){if(t.length===1){var a=qa(t[0],n);return r&&a instanceof Ec&&a.type==="mo"&&(a.setAttribute("lspace","0em"),a.setAttribute("rspace","0em")),[a]}for(var u=[],f,s=0;s<t.length;s++){var v=qa(t[s],n);if(v instanceof Ec&&f instanceof Ec){if(v.type==="mtext"&&f.type==="mtext"&&v.getAttribute("mathvariant")===f.getAttribute("mathvariant")){f.children.push(...v.children);continue}else if(v.type==="mn"&&f.type==="mn"){f.children.push(...v.children);continue}else if(B5(v)&&f.type==="mn"){f.children.push(...v.children);continue}else if(v.type==="mn"&&B5(f))v.children=[...f.children,...v.children],u.pop();else if((v.type==="msup"||v.type==="msub")&&v.children.length>=1&&(f.type==="mn"||B5(f))){var x=v.children[0];x instanceof Ec&&x.type==="mn"&&(x.children=[...f.children,...x.children],u.pop())}else if(f.type==="mi"&&f.children.length===1){var A=f.children[0];if(A instanceof Jh&&A.text===""&&(v.type==="mo"||v.type==="mi"||v.type==="mn")){var C=v.children[0];C instanceof Jh&&C.text.length>0&&(C.text=C.text.slice(0,1)+""+C.text.slice(1),u.pop())}}}u.push(v),f=v}return u},f0=function(t,n,r){return BL(rc(t,n,r))},qa=function(t,n){if(!t)return new Qn.MathNode("mrow");if(rC[t.type]){var r=rC[t.type](t,n);return r}else throw new ir("Got group of unknown type: '"+t.type+"'")};function rV(e,t,n,r,a){var u=rc(e,n),f;u.length===1&&u[0]instanceof Ec&&["mrow","mtable"].includes(u[0].type)?f=u[0]:f=new Qn.MathNode("mrow",u);var s=new Qn.MathNode("annotation",[new Qn.TextNode(t)]);s.setAttribute("encoding","application/x-tex");var v=new Qn.MathNode("semantics",[f,s]),x=new Qn.MathNode("math",[v]);x.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),r&&x.setAttribute("display","block");var A=a?"katex":"katex-mathml";return Xt.makeSpan([A],[x])}var oQ=function(t){return new Xf({style:t.displayMode?Bi.DISPLAY:Bi.TEXT,maxSize:t.maxSize,minRuleThickness:t.minRuleThickness})},lQ=function(t,n){if(n.displayMode){var r=["katex-display"];n.leqno&&r.push("leqno"),n.fleqn&&r.push("fleqn"),t=Xt.makeSpan(r,[t])}return t},dwe=function(t,n,r){var a=oQ(r),u;if(r.output==="mathml")return rV(t,n,a,r.displayMode,!0);if(r.output==="html"){var f=KP(t,a);u=Xt.makeSpan(["katex"],[f])}else{var s=rV(t,n,a,r.displayMode,!1),v=KP(t,a);u=Xt.makeSpan(["katex"],[s,v])}return lQ(u,r)},hwe=function(t,n,r){var a=oQ(r),u=KP(t,a),f=Xt.makeSpan(["katex"],[u]);return lQ(f,r)},fwe={widehat:"^",widecheck:"",widetilde:"~",utilde:"~",overleftarrow:"",underleftarrow:"",xleftarrow:"",overrightarrow:"",underrightarrow:"",xrightarrow:"",underbrace:"",overbrace:"",overgroup:"",undergroup:"",overleftrightarrow:"",underleftrightarrow:"",xleftrightarrow:"",Overrightarrow:"",xRightarrow:"",overleftharpoon:"",xleftharpoonup:"",overrightharpoon:"",xrightharpoonup:"",xLeftarrow:"",xLeftrightarrow:"",xhookleftarrow:"",xhookrightarrow:"",xmapsto:"",xrightharpoondown:"",xleftharpoondown:"",xrightleftharpoons:"",xleftrightharpoons:"",xtwoheadleftarrow:"",xtwoheadrightarrow:"",xlongequal:"=",xtofrom:"",xrightleftarrows:"",xrightequilibrium:"",xleftequilibrium:"","\\cdrightarrow":"","\\cdleftarrow":"","\\cdlongequal":"="},pwe=function(t){var n=new Qn.MathNode("mo",[new Qn.TextNode(fwe[t.replace(/^\\/,"")])]);return n.setAttribute("stretchy","true"),n},mwe={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},gwe=function(t){return t.type==="ordgroup"?t.body.length:1},_we=function(t,n){function r(){var s=4e5,v=t.label.slice(1);if(["widehat","widecheck","widetilde","utilde"].includes(v)){var x=t,A=gwe(x.base),C,P,L;if(A>5)v==="widehat"||v==="widecheck"?(C=420,s=2364,L=.42,P=v+"4"):(C=312,s=2340,L=.34,P="tilde4");else{var F=[1,1,2,2,3,3][A];v==="widehat"||v==="widecheck"?(s=[0,1062,2364,2364,2364][F],C=[0,239,300,360,420][F],L=[0,.24,.3,.3,.36,.42][F],P=v+F):(s=[0,600,1033,2339,2340][F],C=[0,260,286,306,312][F],L=[0,.26,.286,.3,.306,.34][F],P="tilde"+F)}var U=new h0(P),q=new _p([U],{width:"100%",height:Er(L),viewBox:"0 0 "+s+" "+C,preserveAspectRatio:"none"});return{span:Xt.makeSvgSpan([],[q],n),minWidth:0,height:L}}else{var G=[],$=mwe[v],[X,ie,de]=$,fe=de/1e3,be=X.length,ve,Qe;if(be===1){var we=$[3];ve=["hide-tail"],Qe=[we]}else if(be===2)ve=["halfarrow-left","halfarrow-right"],Qe=["xMinYMin","xMaxYMin"];else if(be===3)ve=["brace-left","brace-center","brace-right"],Qe=["xMinYMin","xMidYMin","xMaxYMin"];else throw new Error(`Correct katexImagesData or update code here to support
                    `+be+" children.");for(var qe=0;qe<be;qe++){var Je=new h0(X[qe]),ft=new _p([Je],{width:"400em",height:Er(fe),viewBox:"0 0 "+s+" "+de,preserveAspectRatio:Qe[qe]+" slice"}),Mt=Xt.makeSvgSpan([ve[qe]],[ft],n);if(be===1)return{span:Mt,minWidth:ie,height:fe};Mt.style.height=Er(fe),G.push(Mt)}return{span:Xt.makeSpan(["stretchy"],G,n),minWidth:ie,height:fe}}}var{span:a,minWidth:u,height:f}=r();return a.height=f,a.style.height=Er(f),u>0&&(a.style.minWidth=Er(u)),a},ywe=function(t,n,r,a,u){var f,s=t.height+t.depth+r+a;if(/fbox|color|angl/.test(n)){if(f=Xt.makeSpan(["stretchy",n],[],u),n==="fbox"){var v=u.color&&u.getColor();v&&(f.style.borderColor=v)}}else{var x=[];/^[bx]cancel$/.test(n)&&x.push(new ZP({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(n)&&x.push(new ZP({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var A=new _p(x,{width:"100%",height:Er(s)});f=Xt.makeSvgSpan([],[A],u)}return f.height=s,f.style.height=Er(s),f},vp={encloseSpan:ywe,mathMLnode:pwe,svgSpan:_we};function Fs(e,t){if(!e||e.type!==t)throw new Error("Expected node of type "+t+", but got "+(e?"node of type "+e.type:String(e)));return e}function UL(e){var t=lk(e);if(!t)throw new Error("Expected node of symbol group type, but got "+(e?"node of type "+e.type:String(e)));return t}function lk(e){return e&&(e.type==="atom"||$be.hasOwnProperty(e.type))?e:null}var VL=(e,t)=>{var n,r,a;e&&e.type==="supsub"?(r=Fs(e.base,"accent"),n=r.base,e.base=n,a=Ube(wa(e,t)),e.base=r):(r=Fs(e,"accent"),n=r.base);var u=wa(n,t.havingCrampedStyle()),f=r.isShifty&&Ca.isCharacterBox(n),s=0;if(f){var v=Ca.getBaseElem(n),x=wa(v,t.havingCrampedStyle());s=YU(x).skew}var A=r.label==="\\c",C=A?u.height+u.depth:Math.min(u.height,t.fontMetrics().xHeight),P;if(r.isStretchy)P=vp.svgSpan(r,t),P=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:u},{type:"elem",elem:P,wrapperClasses:["svg-align"],wrapperStyle:s>0?{width:"calc(100% - "+Er(2*s)+")",marginLeft:Er(2*s)}:void 0}]},t);else{var L,F;r.label==="\\vec"?(L=Xt.staticSvg("vec",t),F=Xt.svgData.vec[1]):(L=Xt.makeOrd({mode:r.mode,text:r.label},t,"textord"),L=YU(L),L.italic=0,F=L.width,A&&(C+=L.depth)),P=Xt.makeSpan(["accent-body"],[L]);var U=r.label==="\\textcircled";U&&(P.classes.push("accent-full"),C=u.height);var q=s;U||(q-=F/2),P.style.left=Er(q),r.label==="\\textcircled"&&(P.style.top=".2em"),P=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:u},{type:"kern",size:-C},{type:"elem",elem:P}]},t)}var G=Xt.makeSpan(["mord","accent"],[P],t);return a?(a.children[0]=G,a.height=Math.max(G.height,a.height),a.classes[0]="mord",a):G},uQ=(e,t)=>{var n=e.isStretchy?vp.mathMLnode(e.label):new Qn.MathNode("mo",[md(e.label,e.mode)]),r=new Qn.MathNode("mover",[qa(e.base,t),n]);return r.setAttribute("accent","true"),r},vwe=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map(e=>"\\"+e).join("|"));Nr({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(e,t)=>{var n=iC(t[0]),r=!vwe.test(e.funcName),a=!r||e.funcName==="\\widehat"||e.funcName==="\\widetilde"||e.funcName==="\\widecheck";return{type:"accent",mode:e.parser.mode,label:e.funcName,isStretchy:r,isShifty:a,base:n}},htmlBuilder:VL,mathmlBuilder:uQ});Nr({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(e,t)=>{var n=t[0],r=e.parser.mode;return r==="math"&&(e.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+e.funcName+" works only in text mode"),r="text"),{type:"accent",mode:r,label:e.funcName,isStretchy:!1,isShifty:!0,base:n}},htmlBuilder:VL,mathmlBuilder:uQ});Nr({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0];return{type:"accentUnder",mode:n.mode,label:r,base:a}},htmlBuilder:(e,t)=>{var n=wa(e.base,t),r=vp.svgSpan(e,t),a=e.label==="\\utilde"?.12:0,u=Xt.makeVList({positionType:"top",positionData:n.height,children:[{type:"elem",elem:r,wrapperClasses:["svg-align"]},{type:"kern",size:a},{type:"elem",elem:n}]},t);return Xt.makeSpan(["mord","accentunder"],[u],t)},mathmlBuilder:(e,t)=>{var n=vp.mathMLnode(e.label),r=new Qn.MathNode("munder",[qa(e.base,t),n]);return r.setAttribute("accentunder","true"),r}});var I3=e=>{var t=new Qn.MathNode("mpadded",e?[e]:[]);return t.setAttribute("width","+0.6em"),t.setAttribute("lspace","0.3em"),t};Nr({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(e,t,n){var{parser:r,funcName:a}=e;return{type:"xArrow",mode:r.mode,label:a,body:t[0],below:n[0]}},htmlBuilder(e,t){var n=t.style,r=t.havingStyle(n.sup()),a=Xt.wrapFragment(wa(e.body,r,t),t),u=e.label.slice(0,2)==="\\x"?"x":"cd";a.classes.push(u+"-arrow-pad");var f;e.below&&(r=t.havingStyle(n.sub()),f=Xt.wrapFragment(wa(e.below,r,t),t),f.classes.push(u+"-arrow-pad"));var s=vp.svgSpan(e,t),v=-t.fontMetrics().axisHeight+.5*s.height,x=-t.fontMetrics().axisHeight-.5*s.height-.111;(a.depth>.25||e.label==="\\xleftequilibrium")&&(x-=a.depth);var A;if(f){var C=-t.fontMetrics().axisHeight+f.height+.5*s.height+.111;A=Xt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:a,shift:x},{type:"elem",elem:s,shift:v},{type:"elem",elem:f,shift:C}]},t)}else A=Xt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:a,shift:x},{type:"elem",elem:s,shift:v}]},t);return A.children[0].children[0].children[1].classes.push("svg-align"),Xt.makeSpan(["mrel","x-arrow"],[A],t)},mathmlBuilder(e,t){var n=vp.mathMLnode(e.label);n.setAttribute("minsize",e.label.charAt(0)==="x"?"1.75em":"3.0em");var r;if(e.body){var a=I3(qa(e.body,t));if(e.below){var u=I3(qa(e.below,t));r=new Qn.MathNode("munderover",[n,u,a])}else r=new Qn.MathNode("mover",[n,a])}else if(e.below){var f=I3(qa(e.below,t));r=new Qn.MathNode("munder",[n,f])}else r=I3(),r=new Qn.MathNode("mover",[n,r]);return r}});var xwe=Xt.makeSpan;function cQ(e,t){var n=fl(e.body,t,!0);return xwe([e.mclass],n,t)}function dQ(e,t){var n,r=rc(e.body,t);return e.mclass==="minner"?n=new Qn.MathNode("mpadded",r):e.mclass==="mord"?e.isCharacterBox?(n=r[0],n.type="mi"):n=new Qn.MathNode("mi",r):(e.isCharacterBox?(n=r[0],n.type="mo"):n=new Qn.MathNode("mo",r),e.mclass==="mbin"?(n.attributes.lspace="0.22em",n.attributes.rspace="0.22em"):e.mclass==="mpunct"?(n.attributes.lspace="0em",n.attributes.rspace="0.17em"):e.mclass==="mopen"||e.mclass==="mclose"?(n.attributes.lspace="0em",n.attributes.rspace="0em"):e.mclass==="minner"&&(n.attributes.lspace="0.0556em",n.attributes.width="+0.1111em")),n}Nr({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(e,t){var{parser:n,funcName:r}=e,a=t[0];return{type:"mclass",mode:n.mode,mclass:"m"+r.slice(5),body:qo(a),isCharacterBox:Ca.isCharacterBox(a)}},htmlBuilder:cQ,mathmlBuilder:dQ});var uk=e=>{var t=e.type==="ordgroup"&&e.body.length?e.body[0]:e;return t.type==="atom"&&(t.family==="bin"||t.family==="rel")?"m"+t.family:"mord"};Nr({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(e,t){var{parser:n}=e;return{type:"mclass",mode:n.mode,mclass:uk(t[0]),body:qo(t[1]),isCharacterBox:Ca.isCharacterBox(t[1])}}});Nr({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(e,t){var{parser:n,funcName:r}=e,a=t[1],u=t[0],f;r!=="\\stackrel"?f=uk(a):f="mrel";var s={type:"op",mode:a.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:r!=="\\stackrel",body:qo(a)},v={type:"supsub",mode:u.mode,base:s,sup:r==="\\underset"?null:u,sub:r==="\\underset"?u:null};return{type:"mclass",mode:n.mode,mclass:f,body:[v],isCharacterBox:Ca.isCharacterBox(v)}},htmlBuilder:cQ,mathmlBuilder:dQ});Nr({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"pmb",mode:n.mode,mclass:uk(t[0]),body:qo(t[0])}},htmlBuilder(e,t){var n=fl(e.body,t,!0),r=Xt.makeSpan([e.mclass],n,t);return r.style.textShadow="0.02em 0.01em 0.04px",r},mathmlBuilder(e,t){var n=rc(e.body,t),r=new Qn.MathNode("mstyle",n);return r.setAttribute("style","text-shadow: 0.02em 0.01em 0.04px"),r}});var bwe={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},iV=()=>({type:"styling",body:[],mode:"math",style:"display"}),sV=e=>e.type==="textord"&&e.text==="@",wwe=(e,t)=>(e.type==="mathord"||e.type==="atom")&&e.text===t;function Twe(e,t,n){var r=bwe[e];switch(r){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return n.callFunction(r,[t[0]],[t[1]]);case"\\uparrow":case"\\downarrow":{var a=n.callFunction("\\\\cdleft",[t[0]],[]),u={type:"atom",text:r,mode:"math",family:"rel"},f=n.callFunction("\\Big",[u],[]),s=n.callFunction("\\\\cdright",[t[1]],[]),v={type:"ordgroup",mode:"math",body:[a,f,s]};return n.callFunction("\\\\cdparent",[v],[])}case"\\\\cdlongequal":return n.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":{var x={type:"textord",text:"\\Vert",mode:"math"};return n.callFunction("\\Big",[x],[])}default:return{type:"textord",text:" ",mode:"math"}}}function Ewe(e){var t=[];for(e.gullet.beginGroup(),e.gullet.macros.set("\\cr","\\\\\\relax"),e.gullet.beginGroup();;){t.push(e.parseExpression(!1,"\\\\")),e.gullet.endGroup(),e.gullet.beginGroup();var n=e.fetch().text;if(n==="&"||n==="\\\\")e.consume();else if(n==="\\end"){t[t.length-1].length===0&&t.pop();break}else throw new ir("Expected \\\\ or \\cr or \\end",e.nextToken)}for(var r=[],a=[r],u=0;u<t.length;u++){for(var f=t[u],s=iV(),v=0;v<f.length;v++)if(!sV(f[v]))s.body.push(f[v]);else{r.push(s),v+=1;var x=UL(f[v]).text,A=new Array(2);if(A[0]={type:"ordgroup",mode:"math",body:[]},A[1]={type:"ordgroup",mode:"math",body:[]},!("=|.".indexOf(x)>-1))if("<>AV".indexOf(x)>-1)for(var C=0;C<2;C++){for(var P=!0,L=v+1;L<f.length;L++){if(wwe(f[L],x)){P=!1,v=L;break}if(sV(f[L]))throw new ir("Missing a "+x+" character to complete a CD arrow.",f[L]);A[C].body.push(f[L])}if(P)throw new ir("Missing a "+x+" character to complete a CD arrow.",f[v])}else throw new ir('Expected one of "<>AV=|." after @',f[v]);var F=Twe(x,A,e),U={type:"styling",body:[F],mode:"math",style:"display"};r.push(U),s=iV()}u%2===0?r.push(s):r.shift(),r=[],a.push(r)}e.gullet.endGroup(),e.gullet.endGroup();var q=new Array(a[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25});return{type:"array",mode:"math",body:a,arraystretch:1,addJot:!0,rowGaps:[null],cols:q,colSeparationType:"CD",hLinesBeforeRow:new Array(a.length+1).fill([])}}Nr({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:r}=e;return{type:"cdlabel",mode:n.mode,side:r.slice(4),label:t[0]}},htmlBuilder(e,t){var n=t.havingStyle(t.style.sup()),r=Xt.wrapFragment(wa(e.label,n,t),t);return r.classes.push("cd-label-"+e.side),r.style.bottom=Er(.8-r.depth),r.height=0,r.depth=0,r},mathmlBuilder(e,t){var n=new Qn.MathNode("mrow",[qa(e.label,t)]);return n=new Qn.MathNode("mpadded",[n]),n.setAttribute("width","0"),e.side==="left"&&n.setAttribute("lspace","-1width"),n.setAttribute("voffset","0.7em"),n=new Qn.MathNode("mstyle",[n]),n.setAttribute("displaystyle","false"),n.setAttribute("scriptlevel","1"),n}});Nr({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(e,t){var{parser:n}=e;return{type:"cdlabelparent",mode:n.mode,fragment:t[0]}},htmlBuilder(e,t){var n=Xt.wrapFragment(wa(e.fragment,t),t);return n.classes.push("cd-vert-arrow"),n},mathmlBuilder(e,t){return new Qn.MathNode("mrow",[qa(e.fragment,t)])}});Nr({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(e,t){for(var{parser:n}=e,r=Fs(t[0],"ordgroup"),a=r.body,u="",f=0;f<a.length;f++){var s=Fs(a[f],"textord");u+=s.text}var v=parseInt(u),x;if(isNaN(v))throw new ir("\\@char has non-numeric argument "+u);if(v<0||v>=1114111)throw new ir("\\@char with invalid code point "+u);return v<=65535?x=String.fromCharCode(v):(v-=65536,x=String.fromCharCode((v>>10)+55296,(v&1023)+56320)),{type:"textord",mode:n.mode,text:x}}});var hQ=(e,t)=>{var n=fl(e.body,t.withColor(e.color),!1);return Xt.makeFragment(n)},fQ=(e,t)=>{var n=rc(e.body,t.withColor(e.color)),r=new Qn.MathNode("mstyle",n);return r.setAttribute("mathcolor",e.color),r};Nr({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(e,t){var{parser:n}=e,r=Fs(t[0],"color-token").color,a=t[1];return{type:"color",mode:n.mode,color:r,body:qo(a)}},htmlBuilder:hQ,mathmlBuilder:fQ});Nr({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(e,t){var{parser:n,breakOnTokenText:r}=e,a=Fs(t[0],"color-token").color;n.gullet.macros.set("\\current@color",a);var u=n.parseExpression(!0,r);return{type:"color",mode:n.mode,color:a,body:u}},htmlBuilder:hQ,mathmlBuilder:fQ});Nr({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler(e,t,n){var{parser:r}=e,a=r.gullet.future().text==="["?r.parseSizeGroup(!0):null,u=!r.settings.displayMode||!r.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:r.mode,newLine:u,size:a&&Fs(a,"size").value}},htmlBuilder(e,t){var n=Xt.makeSpan(["mspace"],[],t);return e.newLine&&(n.classes.push("newline"),e.size&&(n.style.marginTop=Er(ko(e.size,t)))),n},mathmlBuilder(e,t){var n=new Qn.MathNode("mspace");return e.newLine&&(n.setAttribute("linebreak","newline"),e.size&&n.setAttribute("height",Er(ko(e.size,t)))),n}});var QP={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},pQ=e=>{var t=e.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(t))throw new ir("Expected a control sequence",e);return t},Swe=e=>{var t=e.gullet.popToken();return t.text==="="&&(t=e.gullet.popToken(),t.text===" "&&(t=e.gullet.popToken())),t},mQ=(e,t,n,r)=>{var a=e.gullet.macros.get(n.text);a==null&&(n.noexpand=!0,a={tokens:[n],numArgs:0,unexpandable:!e.gullet.isExpandable(n.text)}),e.gullet.macros.set(t,a,r)};Nr({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(e){var{parser:t,funcName:n}=e;t.consumeSpaces();var r=t.fetch();if(QP[r.text])return(n==="\\global"||n==="\\\\globallong")&&(r.text=QP[r.text]),Fs(t.parseFunction(),"internal");throw new ir("Invalid token after macro prefix",r)}});Nr({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,r=t.gullet.popToken(),a=r.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(a))throw new ir("Expected a control sequence",r);for(var u=0,f,s=[[]];t.gullet.future().text!=="{";)if(r=t.gullet.popToken(),r.text==="#"){if(t.gullet.future().text==="{"){f=t.gullet.future(),s[u].push("{");break}if(r=t.gullet.popToken(),!/^[1-9]$/.test(r.text))throw new ir('Invalid argument number "'+r.text+'"');if(parseInt(r.text)!==u+1)throw new ir('Argument number "'+r.text+'" out of order');u++,s.push([])}else{if(r.text==="EOF")throw new ir("Expected a macro definition");s[u].push(r.text)}var{tokens:v}=t.gullet.consumeArg();return f&&v.unshift(f),(n==="\\edef"||n==="\\xdef")&&(v=t.gullet.expandTokens(v),v.reverse()),t.gullet.macros.set(a,{tokens:v,numArgs:u,delimiters:s},n===QP[n]),{type:"internal",mode:t.mode}}});Nr({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,r=pQ(t.gullet.popToken());t.gullet.consumeSpaces();var a=Swe(t);return mQ(t,r,a,n==="\\\\globallet"),{type:"internal",mode:t.mode}}});Nr({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,r=pQ(t.gullet.popToken()),a=t.gullet.popToken(),u=t.gullet.popToken();return mQ(t,r,u,n==="\\\\globalfuture"),t.gullet.pushToken(u),t.gullet.pushToken(a),{type:"internal",mode:t.mode}}});var qw=function(t,n,r){var a=io.math[t]&&io.math[t].replace,u=NL(a||t,n,r);if(!u)throw new Error("Unsupported symbol "+t+" and font size "+n+".");return u},$L=function(t,n,r,a){var u=r.havingBaseStyle(n),f=Xt.makeSpan(a.concat(u.sizingClasses(r)),[t],r),s=u.sizeMultiplier/r.sizeMultiplier;return f.height*=s,f.depth*=s,f.maxFontSize=u.sizeMultiplier,f},gQ=function(t,n,r){var a=n.havingBaseStyle(r),u=(1-n.sizeMultiplier/a.sizeMultiplier)*n.fontMetrics().axisHeight;t.classes.push("delimcenter"),t.style.top=Er(u),t.height-=u,t.depth+=u},Awe=function(t,n,r,a,u,f){var s=Xt.makeSymbol(t,"Main-Regular",u,a),v=$L(s,n,a,f);return r&&gQ(v,a,n),v},Cwe=function(t,n,r,a){return Xt.makeSymbol(t,"Size"+n+"-Regular",r,a)},_Q=function(t,n,r,a,u,f){var s=Cwe(t,n,u,a),v=$L(Xt.makeSpan(["delimsizing","size"+n],[s],a),Bi.TEXT,a,f);return r&&gQ(v,a,Bi.TEXT),v},j5=function(t,n,r){var a;n==="Size1-Regular"?a="delim-size1":a="delim-size4";var u=Xt.makeSpan(["delimsizinginner",a],[Xt.makeSpan([],[Xt.makeSymbol(t,n,r)])]);return{type:"elem",elem:u}},U5=function(t,n,r){var a=Qh["Size4-Regular"][t.charCodeAt(0)]?Qh["Size4-Regular"][t.charCodeAt(0)][4]:Qh["Size1-Regular"][t.charCodeAt(0)][4],u=new h0("inner",Obe(t,Math.round(1e3*n))),f=new _p([u],{width:Er(a),height:Er(n),style:"width:"+Er(a),viewBox:"0 0 "+1e3*a+" "+Math.round(1e3*n),preserveAspectRatio:"xMinYMin"}),s=Xt.makeSvgSpan([],[f],r);return s.height=n,s.style.height=Er(n),s.style.width=Er(a),{type:"elem",elem:s}},JP=.008,R3={type:"kern",size:-1*JP},kwe=["|","\\lvert","\\rvert","\\vert"],Iwe=["\\|","\\lVert","\\rVert","\\Vert"],yQ=function(t,n,r,a,u,f){var s,v,x,A,C="",P=0;s=x=A=t,v=null;var L="Size1-Regular";t==="\\uparrow"?x=A="":t==="\\Uparrow"?x=A="":t==="\\downarrow"?s=x="":t==="\\Downarrow"?s=x="":t==="\\updownarrow"?(s="\\uparrow",x="",A="\\downarrow"):t==="\\Updownarrow"?(s="\\Uparrow",x="",A="\\Downarrow"):kwe.includes(t)?(x="",C="vert",P=333):Iwe.includes(t)?(x="",C="doublevert",P=556):t==="["||t==="\\lbrack"?(s="",x="",A="",L="Size4-Regular",C="lbrack",P=667):t==="]"||t==="\\rbrack"?(s="",x="",A="",L="Size4-Regular",C="rbrack",P=667):t==="\\lfloor"||t===""?(x=s="",A="",L="Size4-Regular",C="lfloor",P=667):t==="\\lceil"||t===""?(s="",x=A="",L="Size4-Regular",C="lceil",P=667):t==="\\rfloor"||t===""?(x=s="",A="",L="Size4-Regular",C="rfloor",P=667):t==="\\rceil"||t===""?(s="",x=A="",L="Size4-Regular",C="rceil",P=667):t==="("||t==="\\lparen"?(s="",x="",A="",L="Size4-Regular",C="lparen",P=875):t===")"||t==="\\rparen"?(s="",x="",A="",L="Size4-Regular",C="rparen",P=875):t==="\\{"||t==="\\lbrace"?(s="",v="",A="",x="",L="Size4-Regular"):t==="\\}"||t==="\\rbrace"?(s="",v="",A="",x="",L="Size4-Regular"):t==="\\lgroup"||t===""?(s="",A="",x="",L="Size4-Regular"):t==="\\rgroup"||t===""?(s="",A="",x="",L="Size4-Regular"):t==="\\lmoustache"||t===""?(s="",A="",x="",L="Size4-Regular"):(t==="\\rmoustache"||t==="")&&(s="",A="",x="",L="Size4-Regular");var F=qw(s,L,u),U=F.height+F.depth,q=qw(x,L,u),G=q.height+q.depth,$=qw(A,L,u),X=$.height+$.depth,ie=0,de=1;if(v!==null){var fe=qw(v,L,u);ie=fe.height+fe.depth,de=2}var be=U+X+ie,ve=Math.max(0,Math.ceil((n-be)/(de*G))),Qe=be+ve*de*G,we=a.fontMetrics().axisHeight;r&&(we*=a.sizeMultiplier);var qe=Qe/2-we,Je=[];if(C.length>0){var ft=Qe-U-X,Mt=Math.round(Qe*1e3),Pt=Lbe(C,Math.round(ft*1e3)),Nt=new h0(C,Pt),Kt=(P/1e3).toFixed(3)+"em",tt=(Mt/1e3).toFixed(3)+"em",mt=new _p([Nt],{width:Kt,height:tt,viewBox:"0 0 "+P+" "+Mt}),Pe=Xt.makeSvgSpan([],[mt],a);Pe.height=Mt/1e3,Pe.style.width=Kt,Pe.style.height=tt,Je.push({type:"elem",elem:Pe})}else{if(Je.push(j5(A,L,u)),Je.push(R3),v===null){var gn=Qe-U-X+2*JP;Je.push(U5(x,gn,a))}else{var Et=(Qe-U-X-ie)/2+2*JP;Je.push(U5(x,Et,a)),Je.push(R3),Je.push(j5(v,L,u)),Je.push(R3),Je.push(U5(x,Et,a))}Je.push(R3),Je.push(j5(s,L,u))}var ze=a.havingBaseStyle(Bi.TEXT),$t=Xt.makeVList({positionType:"bottom",positionData:qe,children:Je},ze);return $L(Xt.makeSpan(["delimsizing","mult"],[$t],ze),Bi.TEXT,a,f)},V5=80,$5=.08,H5=function(t,n,r,a,u){var f=Pbe(t,a,r),s=new h0(t,f),v=new _p([s],{width:"400em",height:Er(n),viewBox:"0 0 400000 "+r,preserveAspectRatio:"xMinYMin slice"});return Xt.makeSvgSpan(["hide-tail"],[v],u)},Rwe=function(t,n){var r=n.havingBaseSizing(),a=wQ("\\surd",t*r.sizeMultiplier,bQ,r),u=r.sizeMultiplier,f=Math.max(0,n.minRuleThickness-n.fontMetrics().sqrtRuleThickness),s,v=0,x=0,A=0,C;return a.type==="small"?(A=1e3+1e3*f+V5,t<1?u=1:t<1.4&&(u=.7),v=(1+f+$5)/u,x=(1+f)/u,s=H5("sqrtMain",v,A,f,n),s.style.minWidth="0.853em",C=.833/u):a.type==="large"?(A=(1e3+V5)*a2[a.size],x=(a2[a.size]+f)/u,v=(a2[a.size]+f+$5)/u,s=H5("sqrtSize"+a.size,v,A,f,n),s.style.minWidth="1.02em",C=1/u):(v=t+f+$5,x=t+f,A=Math.floor(1e3*t+f)+V5,s=H5("sqrtTall",v,A,f,n),s.style.minWidth="0.742em",C=1.056),s.height=x,s.style.height=Er(v),{span:s,advanceWidth:C,ruleWidth:(n.fontMetrics().sqrtRuleThickness+f)*u}},vQ=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","\\surd"],Mwe=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","",""],xQ=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],a2=[0,1.2,1.8,2.4,3],Pwe=function(t,n,r,a,u){if(t==="<"||t==="\\lt"||t===""?t="\\langle":(t===">"||t==="\\gt"||t==="")&&(t="\\rangle"),vQ.includes(t)||xQ.includes(t))return _Q(t,n,!1,r,a,u);if(Mwe.includes(t))return yQ(t,a2[n],!1,r,a,u);throw new ir("Illegal delimiter: '"+t+"'")},Owe=[{type:"small",style:Bi.SCRIPTSCRIPT},{type:"small",style:Bi.SCRIPT},{type:"small",style:Bi.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],Lwe=[{type:"small",style:Bi.SCRIPTSCRIPT},{type:"small",style:Bi.SCRIPT},{type:"small",style:Bi.TEXT},{type:"stack"}],bQ=[{type:"small",style:Bi.SCRIPTSCRIPT},{type:"small",style:Bi.SCRIPT},{type:"small",style:Bi.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],Dwe=function(t){if(t.type==="small")return"Main-Regular";if(t.type==="large")return"Size"+t.size+"-Regular";if(t.type==="stack")return"Size4-Regular";throw new Error("Add support for delim type '"+t.type+"' here.")},wQ=function(t,n,r,a){for(var u=Math.min(2,3-a.style.size),f=u;f<r.length&&r[f].type!=="stack";f++){var s=qw(t,Dwe(r[f]),"math"),v=s.height+s.depth;if(r[f].type==="small"){var x=a.havingBaseStyle(r[f].style);v*=x.sizeMultiplier}if(v>n)return r[f]}return r[r.length-1]},TQ=function(t,n,r,a,u,f){t==="<"||t==="\\lt"||t===""?t="\\langle":(t===">"||t==="\\gt"||t==="")&&(t="\\rangle");var s;xQ.includes(t)?s=Owe:vQ.includes(t)?s=bQ:s=Lwe;var v=wQ(t,n,s,a);return v.type==="small"?Awe(t,v.style,r,a,u,f):v.type==="large"?_Q(t,v.size,r,a,u,f):yQ(t,n,r,a,u,f)},Nwe=function(t,n,r,a,u,f){var s=a.fontMetrics().axisHeight*a.sizeMultiplier,v=901,x=5/a.fontMetrics().ptPerEm,A=Math.max(n-s,r+s),C=Math.max(A/500*v,2*A-x);return TQ(t,C,!0,a,u,f)},lp={sqrtImage:Rwe,sizedDelim:Pwe,sizeToMaxHeight:a2,customSizedDelim:TQ,leftRightDelim:Nwe},aV={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},zwe=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","<",">","\\langle","","\\rangle","","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","","","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function ck(e,t){var n=lk(e);if(n&&zwe.includes(n.text))return n;throw n?new ir("Invalid delimiter '"+n.text+"' after '"+t.funcName+"'",e):new ir("Invalid delimiter type '"+e.type+"'",e)}Nr({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(e,t)=>{var n=ck(t[0],e);return{type:"delimsizing",mode:e.parser.mode,size:aV[e.funcName].size,mclass:aV[e.funcName].mclass,delim:n.text}},htmlBuilder:(e,t)=>e.delim==="."?Xt.makeSpan([e.mclass]):lp.sizedDelim(e.delim,e.size,t,e.mode,[e.mclass]),mathmlBuilder:e=>{var t=[];e.delim!=="."&&t.push(md(e.delim,e.mode));var n=new Qn.MathNode("mo",t);e.mclass==="mopen"||e.mclass==="mclose"?n.setAttribute("fence","true"):n.setAttribute("fence","false"),n.setAttribute("stretchy","true");var r=Er(lp.sizeToMaxHeight[e.size]);return n.setAttribute("minsize",r),n.setAttribute("maxsize",r),n}});function oV(e){if(!e.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}Nr({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=e.parser.gullet.macros.get("\\current@color");if(n&&typeof n!="string")throw new ir("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:e.parser.mode,delim:ck(t[0],e).text,color:n}}});Nr({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=ck(t[0],e),r=e.parser;++r.leftrightDepth;var a=r.parseExpression(!1);--r.leftrightDepth,r.expect("\\right",!1);var u=Fs(r.parseFunction(),"leftright-right");return{type:"leftright",mode:r.mode,body:a,left:n.text,right:u.delim,rightColor:u.color}},htmlBuilder:(e,t)=>{oV(e);for(var n=fl(e.body,t,!0,["mopen","mclose"]),r=0,a=0,u=!1,f=0;f<n.length;f++)n[f].isMiddle?u=!0:(r=Math.max(n[f].height,r),a=Math.max(n[f].depth,a));r*=t.sizeMultiplier,a*=t.sizeMultiplier;var s;if(e.left==="."?s=Q2(t,["mopen"]):s=lp.leftRightDelim(e.left,r,a,t,e.mode,["mopen"]),n.unshift(s),u)for(var v=1;v<n.length;v++){var x=n[v],A=x.isMiddle;A&&(n[v]=lp.leftRightDelim(A.delim,r,a,A.options,e.mode,[]))}var C;if(e.right===".")C=Q2(t,["mclose"]);else{var P=e.rightColor?t.withColor(e.rightColor):t;C=lp.leftRightDelim(e.right,r,a,P,e.mode,["mclose"])}return n.push(C),Xt.makeSpan(["minner"],n,t)},mathmlBuilder:(e,t)=>{oV(e);var n=rc(e.body,t);if(e.left!=="."){var r=new Qn.MathNode("mo",[md(e.left,e.mode)]);r.setAttribute("fence","true"),n.unshift(r)}if(e.right!=="."){var a=new Qn.MathNode("mo",[md(e.right,e.mode)]);a.setAttribute("fence","true"),e.rightColor&&a.setAttribute("mathcolor",e.rightColor),n.push(a)}return BL(n)}});Nr({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=ck(t[0],e);if(!e.parser.leftrightDepth)throw new ir("\\middle without preceding \\left",n);return{type:"middle",mode:e.parser.mode,delim:n.text}},htmlBuilder:(e,t)=>{var n;if(e.delim===".")n=Q2(t,[]);else{n=lp.sizedDelim(e.delim,1,t,e.mode,[]);var r={delim:e.delim,options:t};n.isMiddle=r}return n},mathmlBuilder:(e,t)=>{var n=e.delim==="\\vert"||e.delim==="|"?md("|","text"):md(e.delim,e.mode),r=new Qn.MathNode("mo",[n]);return r.setAttribute("fence","true"),r.setAttribute("lspace","0.05em"),r.setAttribute("rspace","0.05em"),r}});var HL=(e,t)=>{var n=Xt.wrapFragment(wa(e.body,t),t),r=e.label.slice(1),a=t.sizeMultiplier,u,f=0,s=Ca.isCharacterBox(e.body);if(r==="sout")u=Xt.makeSpan(["stretchy","sout"]),u.height=t.fontMetrics().defaultRuleThickness/a,f=-.5*t.fontMetrics().xHeight;else if(r==="phase"){var v=ko({number:.6,unit:"pt"},t),x=ko({number:.35,unit:"ex"},t),A=t.havingBaseSizing();a=a/A.sizeMultiplier;var C=n.height+n.depth+v+x;n.style.paddingLeft=Er(C/2+v);var P=Math.floor(1e3*C*a),L=Rbe(P),F=new _p([new h0("phase",L)],{width:"400em",height:Er(P/1e3),viewBox:"0 0 400000 "+P,preserveAspectRatio:"xMinYMin slice"});u=Xt.makeSvgSpan(["hide-tail"],[F],t),u.style.height=Er(C),f=n.depth+v+x}else{/cancel/.test(r)?s||n.classes.push("cancel-pad"):r==="angl"?n.classes.push("anglpad"):n.classes.push("boxpad");var U=0,q=0,G=0;/box/.test(r)?(G=Math.max(t.fontMetrics().fboxrule,t.minRuleThickness),U=t.fontMetrics().fboxsep+(r==="colorbox"?0:G),q=U):r==="angl"?(G=Math.max(t.fontMetrics().defaultRuleThickness,t.minRuleThickness),U=4*G,q=Math.max(0,.25-n.depth)):(U=s?.2:0,q=U),u=vp.encloseSpan(n,r,U,q,t),/fbox|boxed|fcolorbox/.test(r)?(u.style.borderStyle="solid",u.style.borderWidth=Er(G)):r==="angl"&&G!==.049&&(u.style.borderTopWidth=Er(G),u.style.borderRightWidth=Er(G)),f=n.depth+q,e.backgroundColor&&(u.style.backgroundColor=e.backgroundColor,e.borderColor&&(u.style.borderColor=e.borderColor))}var $;if(e.backgroundColor)$=Xt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:u,shift:f},{type:"elem",elem:n,shift:0}]},t);else{var X=/cancel|phase/.test(r)?["svg-align"]:[];$=Xt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:n,shift:0},{type:"elem",elem:u,shift:f,wrapperClasses:X}]},t)}return/cancel/.test(r)&&($.height=n.height,$.depth=n.depth),/cancel/.test(r)&&!s?Xt.makeSpan(["mord","cancel-lap"],[$],t):Xt.makeSpan(["mord"],[$],t)},GL=(e,t)=>{var n=0,r=new Qn.MathNode(e.label.indexOf("colorbox")>-1?"mpadded":"menclose",[qa(e.body,t)]);switch(e.label){case"\\cancel":r.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":r.setAttribute("notation","downdiagonalstrike");break;case"\\phase":r.setAttribute("notation","phasorangle");break;case"\\sout":r.setAttribute("notation","horizontalstrike");break;case"\\fbox":r.setAttribute("notation","box");break;case"\\angl":r.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(n=t.fontMetrics().fboxsep*t.fontMetrics().ptPerEm,r.setAttribute("width","+"+2*n+"pt"),r.setAttribute("height","+"+2*n+"pt"),r.setAttribute("lspace",n+"pt"),r.setAttribute("voffset",n+"pt"),e.label==="\\fcolorbox"){var a=Math.max(t.fontMetrics().fboxrule,t.minRuleThickness);r.setAttribute("style","border: "+a+"em solid "+String(e.borderColor))}break;case"\\xcancel":r.setAttribute("notation","updiagonalstrike downdiagonalstrike");break}return e.backgroundColor&&r.setAttribute("mathbackground",e.backgroundColor),r};Nr({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(e,t,n){var{parser:r,funcName:a}=e,u=Fs(t[0],"color-token").color,f=t[1];return{type:"enclose",mode:r.mode,label:a,backgroundColor:u,body:f}},htmlBuilder:HL,mathmlBuilder:GL});Nr({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(e,t,n){var{parser:r,funcName:a}=e,u=Fs(t[0],"color-token").color,f=Fs(t[1],"color-token").color,s=t[2];return{type:"enclose",mode:r.mode,label:a,backgroundColor:f,borderColor:u,body:s}},htmlBuilder:HL,mathmlBuilder:GL});Nr({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"enclose",mode:n.mode,label:"\\fbox",body:t[0]}}});Nr({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:r}=e,a=t[0];return{type:"enclose",mode:n.mode,label:r,body:a}},htmlBuilder:HL,mathmlBuilder:GL});Nr({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(e,t){var{parser:n}=e;return{type:"enclose",mode:n.mode,label:"\\angl",body:t[0]}}});var EQ={};function ff(e){for(var{type:t,names:n,props:r,handler:a,htmlBuilder:u,mathmlBuilder:f}=e,s={type:t,numArgs:r.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:a},v=0;v<n.length;++v)EQ[n[v]]=s;u&&(nC[t]=u),f&&(rC[t]=f)}var SQ={};function Ne(e,t){SQ[e]=t}function lV(e){var t=[];e.consumeSpaces();var n=e.fetch().text;for(n==="\\relax"&&(e.consume(),e.consumeSpaces(),n=e.fetch().text);n==="\\hline"||n==="\\hdashline";)e.consume(),t.push(n==="\\hdashline"),e.consumeSpaces(),n=e.fetch().text;return t}var dk=e=>{var t=e.parser.settings;if(!t.displayMode)throw new ir("{"+e.envName+"} can be used only in display mode.")};function qL(e){if(e.indexOf("ed")===-1)return e.indexOf("*")===-1}function T0(e,t,n){var{hskipBeforeAndAfter:r,addJot:a,cols:u,arraystretch:f,colSeparationType:s,autoTag:v,singleRow:x,emptySingleRow:A,maxNumCols:C,leqno:P}=t;if(e.gullet.beginGroup(),x||e.gullet.macros.set("\\cr","\\\\\\relax"),!f){var L=e.gullet.expandMacroAsText("\\arraystretch");if(L==null)f=1;else if(f=parseFloat(L),!f||f<0)throw new ir("Invalid \\arraystretch: "+L)}e.gullet.beginGroup();var F=[],U=[F],q=[],G=[],$=v!=null?[]:void 0;function X(){v&&e.gullet.macros.set("\\@eqnsw","1",!0)}function ie(){$&&(e.gullet.macros.get("\\df@tag")?($.push(e.subparse([new Ic("\\df@tag")])),e.gullet.macros.set("\\df@tag",void 0,!0)):$.push(!!v&&e.gullet.macros.get("\\@eqnsw")==="1"))}for(X(),G.push(lV(e));;){var de=e.parseExpression(!1,x?"\\end":"\\\\");e.gullet.endGroup(),e.gullet.beginGroup(),de={type:"ordgroup",mode:e.mode,body:de},n&&(de={type:"styling",mode:e.mode,style:n,body:[de]}),F.push(de);var fe=e.fetch().text;if(fe==="&"){if(C&&F.length===C){if(x||s)throw new ir("Too many tab characters: &",e.nextToken);e.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}e.consume()}else if(fe==="\\end"){ie(),F.length===1&&de.type==="styling"&&de.body[0].body.length===0&&(U.length>1||!A)&&U.pop(),G.length<U.length+1&&G.push([]);break}else if(fe==="\\\\"){e.consume();var be=void 0;e.gullet.future().text!==" "&&(be=e.parseSizeGroup(!0)),q.push(be?be.value:null),ie(),G.push(lV(e)),F=[],U.push(F),X()}else throw new ir("Expected & or \\\\ or \\cr or \\end",e.nextToken)}return e.gullet.endGroup(),e.gullet.endGroup(),{type:"array",mode:e.mode,addJot:a,arraystretch:f,body:U,cols:u,rowGaps:q,hskipBeforeAndAfter:r,hLinesBeforeRow:G,colSeparationType:s,tags:$,leqno:P}}function WL(e){return e.slice(0,1)==="d"?"display":"text"}var pf=function(t,n){var r,a,u=t.body.length,f=t.hLinesBeforeRow,s=0,v=new Array(u),x=[],A=Math.max(n.fontMetrics().arrayRuleWidth,n.minRuleThickness),C=1/n.fontMetrics().ptPerEm,P=5*C;if(t.colSeparationType&&t.colSeparationType==="small"){var L=n.havingStyle(Bi.SCRIPT).sizeMultiplier;P=.2778*(L/n.sizeMultiplier)}var F=t.colSeparationType==="CD"?ko({number:3,unit:"ex"},n):12*C,U=3*C,q=t.arraystretch*F,G=.7*q,$=.3*q,X=0;function ie(Vn){for(var xr=0;xr<Vn.length;++xr)xr>0&&(X+=.25),x.push({pos:X,isDashed:Vn[xr]})}for(ie(f[0]),r=0;r<t.body.length;++r){var de=t.body[r],fe=G,be=$;s<de.length&&(s=de.length);var ve=new Array(de.length);for(a=0;a<de.length;++a){var Qe=wa(de[a],n);be<Qe.depth&&(be=Qe.depth),fe<Qe.height&&(fe=Qe.height),ve[a]=Qe}var we=t.rowGaps[r],qe=0;we&&(qe=ko(we,n),qe>0&&(qe+=$,be<qe&&(be=qe),qe=0)),t.addJot&&(be+=U),ve.height=fe,ve.depth=be,X+=fe,ve.pos=X,X+=be+qe,v[r]=ve,ie(f[r+1])}var Je=X/2+n.fontMetrics().axisHeight,ft=t.cols||[],Mt=[],Pt,Nt,Kt=[];if(t.tags&&t.tags.some(Vn=>Vn))for(r=0;r<u;++r){var tt=v[r],mt=tt.pos-Je,Pe=t.tags[r],gn=void 0;Pe===!0?gn=Xt.makeSpan(["eqn-num"],[],n):Pe===!1?gn=Xt.makeSpan([],[],n):gn=Xt.makeSpan([],fl(Pe,n,!0),n),gn.depth=tt.depth,gn.height=tt.height,Kt.push({type:"elem",elem:gn,shift:mt})}for(a=0,Nt=0;a<s||Nt<ft.length;++a,++Nt){for(var Et=ft[Nt]||{},ze=!0;Et.type==="separator";){if(ze||(Pt=Xt.makeSpan(["arraycolsep"],[]),Pt.style.width=Er(n.fontMetrics().doubleRuleSep),Mt.push(Pt)),Et.separator==="|"||Et.separator===":"){var $t=Et.separator==="|"?"solid":"dashed",Cn=Xt.makeSpan(["vertical-separator"],[],n);Cn.style.height=Er(X),Cn.style.borderRightWidth=Er(A),Cn.style.borderRightStyle=$t,Cn.style.margin="0 "+Er(-A/2);var fn=X-Je;fn&&(Cn.style.verticalAlign=Er(-fn)),Mt.push(Cn)}else throw new ir("Invalid separator type: "+Et.separator);Nt++,Et=ft[Nt]||{},ze=!1}if(!(a>=s)){var Nn=void 0;(a>0||t.hskipBeforeAndAfter)&&(Nn=Ca.deflt(Et.pregap,P),Nn!==0&&(Pt=Xt.makeSpan(["arraycolsep"],[]),Pt.style.width=Er(Nn),Mt.push(Pt)));var bn=[];for(r=0;r<u;++r){var Vt=v[r],En=Vt[a];if(En){var Sn=Vt.pos-Je;En.depth=Vt.depth,En.height=Vt.height,bn.push({type:"elem",elem:En,shift:Sn})}}bn=Xt.makeVList({positionType:"individualShift",children:bn},n),bn=Xt.makeSpan(["col-align-"+(Et.align||"c")],[bn]),Mt.push(bn),(a<s-1||t.hskipBeforeAndAfter)&&(Nn=Ca.deflt(Et.postgap,P),Nn!==0&&(Pt=Xt.makeSpan(["arraycolsep"],[]),Pt.style.width=Er(Nn),Mt.push(Pt)))}}if(v=Xt.makeSpan(["mtable"],Mt),x.length>0){for(var Un=Xt.makeLineSpan("hline",n,A),nn=Xt.makeLineSpan("hdashline",n,A),wr=[{type:"elem",elem:v,shift:0}];x.length>0;){var Xr=x.pop(),ar=Xr.pos-Je;Xr.isDashed?wr.push({type:"elem",elem:nn,shift:ar}):wr.push({type:"elem",elem:Un,shift:ar})}v=Xt.makeVList({positionType:"individualShift",children:wr},n)}if(Kt.length===0)return Xt.makeSpan(["mord"],[v],n);var tr=Xt.makeVList({positionType:"individualShift",children:Kt},n);return tr=Xt.makeSpan(["tag"],[tr],n),Xt.makeFragment([v,tr])},Fwe={c:"center ",l:"left ",r:"right "},mf=function(t,n){for(var r=[],a=new Qn.MathNode("mtd",[],["mtr-glue"]),u=new Qn.MathNode("mtd",[],["mml-eqn-num"]),f=0;f<t.body.length;f++){for(var s=t.body[f],v=[],x=0;x<s.length;x++)v.push(new Qn.MathNode("mtd",[qa(s[x],n)]));t.tags&&t.tags[f]&&(v.unshift(a),v.push(a),t.leqno?v.unshift(u):v.push(u)),r.push(new Qn.MathNode("mtr",v))}var A=new Qn.MathNode("mtable",r),C=t.arraystretch===.5?.1:.16+t.arraystretch-1+(t.addJot?.09:0);A.setAttribute("rowspacing",Er(C));var P="",L="";if(t.cols&&t.cols.length>0){var F=t.cols,U="",q=!1,G=0,$=F.length;F[0].type==="separator"&&(P+="top ",G=1),F[F.length-1].type==="separator"&&(P+="bottom ",$-=1);for(var X=G;X<$;X++)F[X].type==="align"?(L+=Fwe[F[X].align],q&&(U+="none "),q=!0):F[X].type==="separator"&&q&&(U+=F[X].separator==="|"?"solid ":"dashed ",q=!1);A.setAttribute("columnalign",L.trim()),/[sd]/.test(U)&&A.setAttribute("columnlines",U.trim())}if(t.colSeparationType==="align"){for(var ie=t.cols||[],de="",fe=1;fe<ie.length;fe++)de+=fe%2?"0em ":"1em ";A.setAttribute("columnspacing",de.trim())}else t.colSeparationType==="alignat"||t.colSeparationType==="gather"?A.setAttribute("columnspacing","0em"):t.colSeparationType==="small"?A.setAttribute("columnspacing","0.2778em"):t.colSeparationType==="CD"?A.setAttribute("columnspacing","0.5em"):A.setAttribute("columnspacing","1em");var be="",ve=t.hLinesBeforeRow;P+=ve[0].length>0?"left ":"",P+=ve[ve.length-1].length>0?"right ":"";for(var Qe=1;Qe<ve.length-1;Qe++)be+=ve[Qe].length===0?"none ":ve[Qe][0]?"dashed ":"solid ";return/[sd]/.test(be)&&A.setAttribute("rowlines",be.trim()),P!==""&&(A=new Qn.MathNode("menclose",[A]),A.setAttribute("notation",P.trim())),t.arraystretch&&t.arraystretch<1&&(A=new Qn.MathNode("mstyle",[A]),A.setAttribute("scriptlevel","1")),A},AQ=function(t,n){t.envName.indexOf("ed")===-1&&dk(t);var r=[],a=t.envName.indexOf("at")>-1?"alignat":"align",u=t.envName==="split",f=T0(t.parser,{cols:r,addJot:!0,autoTag:u?void 0:qL(t.envName),emptySingleRow:!0,colSeparationType:a,maxNumCols:u?2:void 0,leqno:t.parser.settings.leqno},"display"),s,v=0,x={type:"ordgroup",mode:t.mode,body:[]};if(n[0]&&n[0].type==="ordgroup"){for(var A="",C=0;C<n[0].body.length;C++){var P=Fs(n[0].body[C],"textord");A+=P.text}s=Number(A),v=s*2}var L=!v;f.body.forEach(function(G){for(var $=1;$<G.length;$+=2){var X=Fs(G[$],"styling"),ie=Fs(X.body[0],"ordgroup");ie.body.unshift(x)}if(L)v<G.length&&(v=G.length);else{var de=G.length/2;if(s<de)throw new ir("Too many math in a row: "+("expected "+s+", but got "+de),G[0])}});for(var F=0;F<v;++F){var U="r",q=0;F%2===1?U="l":F>0&&L&&(q=1),r[F]={type:"align",align:U,pregap:q,postgap:0}}return f.colSeparationType=L?"align":"alignat",f};ff({type:"array",names:["array","darray"],props:{numArgs:1},handler(e,t){var n=lk(t[0]),r=n?[t[0]]:Fs(t[0],"ordgroup").body,a=r.map(function(f){var s=UL(f),v=s.text;if("lcr".indexOf(v)!==-1)return{type:"align",align:v};if(v==="|")return{type:"separator",separator:"|"};if(v===":")return{type:"separator",separator:":"};throw new ir("Unknown column alignment: "+v,f)}),u={cols:a,hskipBeforeAndAfter:!0,maxNumCols:a.length};return T0(e.parser,u,WL(e.envName))},htmlBuilder:pf,mathmlBuilder:mf});ff({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(e){var t={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[e.envName.replace("*","")],n="c",r={hskipBeforeAndAfter:!1,cols:[{type:"align",align:n}]};if(e.envName.charAt(e.envName.length-1)==="*"){var a=e.parser;if(a.consumeSpaces(),a.fetch().text==="["){if(a.consume(),a.consumeSpaces(),n=a.fetch().text,"lcr".indexOf(n)===-1)throw new ir("Expected l or c or r",a.nextToken);a.consume(),a.consumeSpaces(),a.expect("]"),a.consume(),r.cols=[{type:"align",align:n}]}}var u=T0(e.parser,r,WL(e.envName)),f=Math.max(0,...u.body.map(s=>s.length));return u.cols=new Array(f).fill({type:"align",align:n}),t?{type:"leftright",mode:e.mode,body:[u],left:t[0],right:t[1],rightColor:void 0}:u},htmlBuilder:pf,mathmlBuilder:mf});ff({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(e){var t={arraystretch:.5},n=T0(e.parser,t,"script");return n.colSeparationType="small",n},htmlBuilder:pf,mathmlBuilder:mf});ff({type:"array",names:["subarray"],props:{numArgs:1},handler(e,t){var n=lk(t[0]),r=n?[t[0]]:Fs(t[0],"ordgroup").body,a=r.map(function(f){var s=UL(f),v=s.text;if("lc".indexOf(v)!==-1)return{type:"align",align:v};throw new ir("Unknown column alignment: "+v,f)});if(a.length>1)throw new ir("{subarray} can contain only one column");var u={cols:a,hskipBeforeAndAfter:!1,arraystretch:.5};if(u=T0(e.parser,u,"script"),u.body.length>0&&u.body[0].length>1)throw new ir("{subarray} can contain only one column");return u},htmlBuilder:pf,mathmlBuilder:mf});ff({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(e){var t={arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},n=T0(e.parser,t,WL(e.envName));return{type:"leftright",mode:e.mode,body:[n],left:e.envName.indexOf("r")>-1?".":"\\{",right:e.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:pf,mathmlBuilder:mf});ff({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:AQ,htmlBuilder:pf,mathmlBuilder:mf});ff({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(e){["gather","gather*"].includes(e.envName)&&dk(e);var t={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:qL(e.envName),emptySingleRow:!0,leqno:e.parser.settings.leqno};return T0(e.parser,t,"display")},htmlBuilder:pf,mathmlBuilder:mf});ff({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:AQ,htmlBuilder:pf,mathmlBuilder:mf});ff({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(e){dk(e);var t={autoTag:qL(e.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:e.parser.settings.leqno};return T0(e.parser,t,"display")},htmlBuilder:pf,mathmlBuilder:mf});ff({type:"array",names:["CD"],props:{numArgs:0},handler(e){return dk(e),Ewe(e.parser)},htmlBuilder:pf,mathmlBuilder:mf});Ne("\\nonumber","\\gdef\\@eqnsw{0}");Ne("\\notag","\\nonumber");Nr({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(e,t){throw new ir(e.funcName+" valid only within array environment")}});var uV=EQ;Nr({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(e,t){var{parser:n,funcName:r}=e,a=t[0];if(a.type!=="ordgroup")throw new ir("Invalid environment name",a);for(var u="",f=0;f<a.body.length;++f)u+=Fs(a.body[f],"textord").text;if(r==="\\begin"){if(!uV.hasOwnProperty(u))throw new ir("No such environment: "+u,a);var s=uV[u],{args:v,optArgs:x}=n.parseArguments("\\begin{"+u+"}",s),A={mode:n.mode,envName:u,parser:n},C=s.handler(A,v,x);n.expect("\\end",!1);var P=n.nextToken,L=Fs(n.parseFunction(),"environment");if(L.name!==u)throw new ir("Mismatch: \\begin{"+u+"} matched by \\end{"+L.name+"}",P);return C}return{type:"environment",mode:n.mode,name:u,nameGroup:a}}});var CQ=(e,t)=>{var n=e.font,r=t.withFont(n);return wa(e.body,r)},kQ=(e,t)=>{var n=e.font,r=t.withFont(n);return qa(e.body,r)},cV={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};Nr({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathsfit","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=iC(t[0]),u=r;return u in cV&&(u=cV[u]),{type:"font",mode:n.mode,font:u.slice(1),body:a}},htmlBuilder:CQ,mathmlBuilder:kQ});Nr({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(e,t)=>{var{parser:n}=e,r=t[0],a=Ca.isCharacterBox(r);return{type:"mclass",mode:n.mode,mclass:uk(r),body:[{type:"font",mode:n.mode,font:"boldsymbol",body:r}],isCharacterBox:a}}});Nr({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(e,t)=>{var{parser:n,funcName:r,breakOnTokenText:a}=e,{mode:u}=n,f=n.parseExpression(!0,a),s="math"+r.slice(1);return{type:"font",mode:u,font:s,body:{type:"ordgroup",mode:n.mode,body:f}}},htmlBuilder:CQ,mathmlBuilder:kQ});var IQ=(e,t)=>{var n=t;return e==="display"?n=n.id>=Bi.SCRIPT.id?n.text():Bi.DISPLAY:e==="text"&&n.size===Bi.DISPLAY.size?n=Bi.TEXT:e==="script"?n=Bi.SCRIPT:e==="scriptscript"&&(n=Bi.SCRIPTSCRIPT),n},ZL=(e,t)=>{var n=IQ(e.size,t.style),r=n.fracNum(),a=n.fracDen(),u;u=t.havingStyle(r);var f=wa(e.numer,u,t);if(e.continued){var s=8.5/t.fontMetrics().ptPerEm,v=3.5/t.fontMetrics().ptPerEm;f.height=f.height<s?s:f.height,f.depth=f.depth<v?v:f.depth}u=t.havingStyle(a);var x=wa(e.denom,u,t),A,C,P;e.hasBarLine?(e.barSize?(C=ko(e.barSize,t),A=Xt.makeLineSpan("frac-line",t,C)):A=Xt.makeLineSpan("frac-line",t),C=A.height,P=A.height):(A=null,C=0,P=t.fontMetrics().defaultRuleThickness);var L,F,U;n.size===Bi.DISPLAY.size||e.size==="display"?(L=t.fontMetrics().num1,C>0?F=3*P:F=7*P,U=t.fontMetrics().denom1):(C>0?(L=t.fontMetrics().num2,F=P):(L=t.fontMetrics().num3,F=3*P),U=t.fontMetrics().denom2);var q;if(A){var $=t.fontMetrics().axisHeight;L-f.depth-($+.5*C)<F&&(L+=F-(L-f.depth-($+.5*C))),$-.5*C-(x.height-U)<F&&(U+=F-($-.5*C-(x.height-U)));var X=-($-.5*C);q=Xt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:x,shift:U},{type:"elem",elem:A,shift:X},{type:"elem",elem:f,shift:-L}]},t)}else{var G=L-f.depth-(x.height-U);G<F&&(L+=.5*(F-G),U+=.5*(F-G)),q=Xt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:x,shift:U},{type:"elem",elem:f,shift:-L}]},t)}u=t.havingStyle(n),q.height*=u.sizeMultiplier/t.sizeMultiplier,q.depth*=u.sizeMultiplier/t.sizeMultiplier;var ie;n.size===Bi.DISPLAY.size?ie=t.fontMetrics().delim1:n.size===Bi.SCRIPTSCRIPT.size?ie=t.havingStyle(Bi.SCRIPT).fontMetrics().delim2:ie=t.fontMetrics().delim2;var de,fe;return e.leftDelim==null?de=Q2(t,["mopen"]):de=lp.customSizedDelim(e.leftDelim,ie,!0,t.havingStyle(n),e.mode,["mopen"]),e.continued?fe=Xt.makeSpan([]):e.rightDelim==null?fe=Q2(t,["mclose"]):fe=lp.customSizedDelim(e.rightDelim,ie,!0,t.havingStyle(n),e.mode,["mclose"]),Xt.makeSpan(["mord"].concat(u.sizingClasses(t)),[de,Xt.makeSpan(["mfrac"],[q]),fe],t)},XL=(e,t)=>{var n=new Qn.MathNode("mfrac",[qa(e.numer,t),qa(e.denom,t)]);if(!e.hasBarLine)n.setAttribute("linethickness","0px");else if(e.barSize){var r=ko(e.barSize,t);n.setAttribute("linethickness",Er(r))}var a=IQ(e.size,t.style);if(a.size!==t.style.size){n=new Qn.MathNode("mstyle",[n]);var u=a.size===Bi.DISPLAY.size?"true":"false";n.setAttribute("displaystyle",u),n.setAttribute("scriptlevel","0")}if(e.leftDelim!=null||e.rightDelim!=null){var f=[];if(e.leftDelim!=null){var s=new Qn.MathNode("mo",[new Qn.TextNode(e.leftDelim.replace("\\",""))]);s.setAttribute("fence","true"),f.push(s)}if(f.push(n),e.rightDelim!=null){var v=new Qn.MathNode("mo",[new Qn.TextNode(e.rightDelim.replace("\\",""))]);v.setAttribute("fence","true"),f.push(v)}return BL(f)}return n};Nr({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0],u=t[1],f,s=null,v=null,x="auto";switch(r){case"\\dfrac":case"\\frac":case"\\tfrac":f=!0;break;case"\\\\atopfrac":f=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":f=!1,s="(",v=")";break;case"\\\\bracefrac":f=!1,s="\\{",v="\\}";break;case"\\\\brackfrac":f=!1,s="[",v="]";break;default:throw new Error("Unrecognized genfrac command")}switch(r){case"\\dfrac":case"\\dbinom":x="display";break;case"\\tfrac":case"\\tbinom":x="text";break}return{type:"genfrac",mode:n.mode,continued:!1,numer:a,denom:u,hasBarLine:f,leftDelim:s,rightDelim:v,size:x,barSize:null}},htmlBuilder:ZL,mathmlBuilder:XL});Nr({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0],u=t[1];return{type:"genfrac",mode:n.mode,continued:!0,numer:a,denom:u,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}});Nr({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(e){var{parser:t,funcName:n,token:r}=e,a;switch(n){case"\\over":a="\\frac";break;case"\\choose":a="\\binom";break;case"\\atop":a="\\\\atopfrac";break;case"\\brace":a="\\\\bracefrac";break;case"\\brack":a="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:t.mode,replaceWith:a,token:r}}});var dV=["display","text","script","scriptscript"],hV=function(t){var n=null;return t.length>0&&(n=t,n=n==="."?null:n),n};Nr({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(e,t){var{parser:n}=e,r=t[4],a=t[5],u=iC(t[0]),f=u.type==="atom"&&u.family==="open"?hV(u.text):null,s=iC(t[1]),v=s.type==="atom"&&s.family==="close"?hV(s.text):null,x=Fs(t[2],"size"),A,C=null;x.isBlank?A=!0:(C=x.value,A=C.number>0);var P="auto",L=t[3];if(L.type==="ordgroup"){if(L.body.length>0){var F=Fs(L.body[0],"textord");P=dV[Number(F.text)]}}else L=Fs(L,"textord"),P=dV[Number(L.text)];return{type:"genfrac",mode:n.mode,numer:r,denom:a,continued:!1,hasBarLine:A,barSize:C,leftDelim:f,rightDelim:v,size:P}},htmlBuilder:ZL,mathmlBuilder:XL});Nr({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(e,t){var{parser:n,funcName:r,token:a}=e;return{type:"infix",mode:n.mode,replaceWith:"\\\\abovefrac",size:Fs(t[0],"size").value,token:a}}});Nr({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0],u=mbe(Fs(t[1],"infix").size),f=t[2],s=u.number>0;return{type:"genfrac",mode:n.mode,numer:a,denom:f,continued:!1,hasBarLine:s,barSize:u,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:ZL,mathmlBuilder:XL});var RQ=(e,t)=>{var n=t.style,r,a;e.type==="supsub"?(r=e.sup?wa(e.sup,t.havingStyle(n.sup()),t):wa(e.sub,t.havingStyle(n.sub()),t),a=Fs(e.base,"horizBrace")):a=Fs(e,"horizBrace");var u=wa(a.base,t.havingBaseStyle(Bi.DISPLAY)),f=vp.svgSpan(a,t),s;if(a.isOver?(s=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:u},{type:"kern",size:.1},{type:"elem",elem:f}]},t),s.children[0].children[0].children[1].classes.push("svg-align")):(s=Xt.makeVList({positionType:"bottom",positionData:u.depth+.1+f.height,children:[{type:"elem",elem:f},{type:"kern",size:.1},{type:"elem",elem:u}]},t),s.children[0].children[0].children[0].classes.push("svg-align")),r){var v=Xt.makeSpan(["mord",a.isOver?"mover":"munder"],[s],t);a.isOver?s=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:v},{type:"kern",size:.2},{type:"elem",elem:r}]},t):s=Xt.makeVList({positionType:"bottom",positionData:v.depth+.2+r.height+r.depth,children:[{type:"elem",elem:r},{type:"kern",size:.2},{type:"elem",elem:v}]},t)}return Xt.makeSpan(["mord",a.isOver?"mover":"munder"],[s],t)},Bwe=(e,t)=>{var n=vp.mathMLnode(e.label);return new Qn.MathNode(e.isOver?"mover":"munder",[qa(e.base,t),n])};Nr({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:r}=e;return{type:"horizBrace",mode:n.mode,label:r,isOver:/^\\over/.test(r),base:t[0]}},htmlBuilder:RQ,mathmlBuilder:Bwe});Nr({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[1],a=Fs(t[0],"url").url;return n.settings.isTrusted({command:"\\href",url:a})?{type:"href",mode:n.mode,href:a,body:qo(r)}:n.formatUnsupportedCmd("\\href")},htmlBuilder:(e,t)=>{var n=fl(e.body,t,!1);return Xt.makeAnchor(e.href,[],n,t)},mathmlBuilder:(e,t)=>{var n=f0(e.body,t);return n instanceof Ec||(n=new Ec("mrow",[n])),n.setAttribute("href",e.href),n}});Nr({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=Fs(t[0],"url").url;if(!n.settings.isTrusted({command:"\\url",url:r}))return n.formatUnsupportedCmd("\\url");for(var a=[],u=0;u<r.length;u++){var f=r[u];f==="~"&&(f="\\textasciitilde"),a.push({type:"textord",mode:"text",text:f})}var s={type:"text",mode:n.mode,font:"\\texttt",body:a};return{type:"href",mode:n.mode,href:r,body:qo(s)}}});Nr({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(e,t){var{parser:n}=e;return{type:"hbox",mode:n.mode,body:qo(t[0])}},htmlBuilder(e,t){var n=fl(e.body,t,!1);return Xt.makeFragment(n)},mathmlBuilder(e,t){return new Qn.MathNode("mrow",rc(e.body,t))}});Nr({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(e,t)=>{var{parser:n,funcName:r,token:a}=e,u=Fs(t[0],"raw").string,f=t[1];n.settings.strict&&n.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var s,v={};switch(r){case"\\htmlClass":v.class=u,s={command:"\\htmlClass",class:u};break;case"\\htmlId":v.id=u,s={command:"\\htmlId",id:u};break;case"\\htmlStyle":v.style=u,s={command:"\\htmlStyle",style:u};break;case"\\htmlData":{for(var x=u.split(","),A=0;A<x.length;A++){var C=x[A],P=C.indexOf("=");if(P<0)throw new ir("\\htmlData key/value '"+C+"' missing equals sign");var L=C.slice(0,P),F=C.slice(P+1);v["data-"+L.trim()]=F}s={command:"\\htmlData",attributes:v};break}default:throw new Error("Unrecognized html command")}return n.settings.isTrusted(s)?{type:"html",mode:n.mode,attributes:v,body:qo(f)}:n.formatUnsupportedCmd(r)},htmlBuilder:(e,t)=>{var n=fl(e.body,t,!1),r=["enclosing"];e.attributes.class&&r.push(...e.attributes.class.trim().split(/\s+/));var a=Xt.makeSpan(r,n,t);for(var u in e.attributes)u!=="class"&&e.attributes.hasOwnProperty(u)&&a.setAttribute(u,e.attributes[u]);return a},mathmlBuilder:(e,t)=>f0(e.body,t)});Nr({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e;return{type:"htmlmathml",mode:n.mode,html:qo(t[0]),mathml:qo(t[1])}},htmlBuilder:(e,t)=>{var n=fl(e.html,t,!1);return Xt.makeFragment(n)},mathmlBuilder:(e,t)=>f0(e.mathml,t)});var G5=function(t){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(t))return{number:+t,unit:"bp"};var n=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(t);if(!n)throw new ir("Invalid size: '"+t+"' in \\includegraphics");var r={number:+(n[1]+n[2]),unit:n[3]};if(!XK(r))throw new ir("Invalid unit: '"+r.unit+"' in \\includegraphics.");return r};Nr({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(e,t,n)=>{var{parser:r}=e,a={number:0,unit:"em"},u={number:.9,unit:"em"},f={number:0,unit:"em"},s="";if(n[0])for(var v=Fs(n[0],"raw").string,x=v.split(","),A=0;A<x.length;A++){var C=x[A].split("=");if(C.length===2){var P=C[1].trim();switch(C[0].trim()){case"alt":s=P;break;case"width":a=G5(P);break;case"height":u=G5(P);break;case"totalheight":f=G5(P);break;default:throw new ir("Invalid key: '"+C[0]+"' in \\includegraphics.")}}}var L=Fs(t[0],"url").url;return s===""&&(s=L,s=s.replace(/^.*[\\/]/,""),s=s.substring(0,s.lastIndexOf("."))),r.settings.isTrusted({command:"\\includegraphics",url:L})?{type:"includegraphics",mode:r.mode,alt:s,width:a,height:u,totalheight:f,src:L}:r.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(e,t)=>{var n=ko(e.height,t),r=0;e.totalheight.number>0&&(r=ko(e.totalheight,t)-n);var a=0;e.width.number>0&&(a=ko(e.width,t));var u={height:Er(n+r)};a>0&&(u.width=Er(a)),r>0&&(u.verticalAlign=Er(-r));var f=new Bbe(e.src,e.alt,u);return f.height=n,f.depth=r,f},mathmlBuilder:(e,t)=>{var n=new Qn.MathNode("mglyph",[]);n.setAttribute("alt",e.alt);var r=ko(e.height,t),a=0;if(e.totalheight.number>0&&(a=ko(e.totalheight,t)-r,n.setAttribute("valign",Er(-a))),n.setAttribute("height",Er(r+a)),e.width.number>0){var u=ko(e.width,t);n.setAttribute("width",Er(u))}return n.setAttribute("src",e.src),n}});Nr({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(e,t){var{parser:n,funcName:r}=e,a=Fs(t[0],"size");if(n.settings.strict){var u=r[1]==="m",f=a.value.unit==="mu";u?(f||n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" supports only mu units, "+("not "+a.value.unit+" units")),n.mode!=="math"&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" works only in math mode")):f&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" doesn't support mu units")}return{type:"kern",mode:n.mode,dimension:a.value}},htmlBuilder(e,t){return Xt.makeGlue(e.dimension,t)},mathmlBuilder(e,t){var n=ko(e.dimension,t);return new Qn.SpaceNode(n)}});Nr({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0];return{type:"lap",mode:n.mode,alignment:r.slice(5),body:a}},htmlBuilder:(e,t)=>{var n;e.alignment==="clap"?(n=Xt.makeSpan([],[wa(e.body,t)]),n=Xt.makeSpan(["inner"],[n],t)):n=Xt.makeSpan(["inner"],[wa(e.body,t)]);var r=Xt.makeSpan(["fix"],[]),a=Xt.makeSpan([e.alignment],[n,r],t),u=Xt.makeSpan(["strut"]);return u.style.height=Er(a.height+a.depth),a.depth&&(u.style.verticalAlign=Er(-a.depth)),a.children.unshift(u),a=Xt.makeSpan(["thinbox"],[a],t),Xt.makeSpan(["mord","vbox"],[a],t)},mathmlBuilder:(e,t)=>{var n=new Qn.MathNode("mpadded",[qa(e.body,t)]);if(e.alignment!=="rlap"){var r=e.alignment==="llap"?"-1":"-0.5";n.setAttribute("lspace",r+"width")}return n.setAttribute("width","0px"),n}});Nr({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(e,t){var{funcName:n,parser:r}=e,a=r.mode;r.switchMode("math");var u=n==="\\("?"\\)":"$",f=r.parseExpression(!1,u);return r.expect(u),r.switchMode(a),{type:"styling",mode:r.mode,style:"text",body:f}}});Nr({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(e,t){throw new ir("Mismatched "+e.funcName)}});var fV=(e,t)=>{switch(t.style.size){case Bi.DISPLAY.size:return e.display;case Bi.TEXT.size:return e.text;case Bi.SCRIPT.size:return e.script;case Bi.SCRIPTSCRIPT.size:return e.scriptscript;default:return e.text}};Nr({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(e,t)=>{var{parser:n}=e;return{type:"mathchoice",mode:n.mode,display:qo(t[0]),text:qo(t[1]),script:qo(t[2]),scriptscript:qo(t[3])}},htmlBuilder:(e,t)=>{var n=fV(e,t),r=fl(n,t,!1);return Xt.makeFragment(r)},mathmlBuilder:(e,t)=>{var n=fV(e,t);return f0(n,t)}});var MQ=(e,t,n,r,a,u,f)=>{e=Xt.makeSpan([],[e]);var s=n&&Ca.isCharacterBox(n),v,x;if(t){var A=wa(t,r.havingStyle(a.sup()),r);x={elem:A,kern:Math.max(r.fontMetrics().bigOpSpacing1,r.fontMetrics().bigOpSpacing3-A.depth)}}if(n){var C=wa(n,r.havingStyle(a.sub()),r);v={elem:C,kern:Math.max(r.fontMetrics().bigOpSpacing2,r.fontMetrics().bigOpSpacing4-C.height)}}var P;if(x&&v){var L=r.fontMetrics().bigOpSpacing5+v.elem.height+v.elem.depth+v.kern+e.depth+f;P=Xt.makeVList({positionType:"bottom",positionData:L,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:v.elem,marginLeft:Er(-u)},{type:"kern",size:v.kern},{type:"elem",elem:e},{type:"kern",size:x.kern},{type:"elem",elem:x.elem,marginLeft:Er(u)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else if(v){var F=e.height-f;P=Xt.makeVList({positionType:"top",positionData:F,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:v.elem,marginLeft:Er(-u)},{type:"kern",size:v.kern},{type:"elem",elem:e}]},r)}else if(x){var U=e.depth+f;P=Xt.makeVList({positionType:"bottom",positionData:U,children:[{type:"elem",elem:e},{type:"kern",size:x.kern},{type:"elem",elem:x.elem,marginLeft:Er(u)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else return e;var q=[P];if(v&&u!==0&&!s){var G=Xt.makeSpan(["mspace"],[],r);G.style.marginRight=Er(u),q.unshift(G)}return Xt.makeSpan(["mop","op-limits"],q,r)},PQ=["\\smallint"],cx=(e,t)=>{var n,r,a=!1,u;e.type==="supsub"?(n=e.sup,r=e.sub,u=Fs(e.base,"op"),a=!0):u=Fs(e,"op");var f=t.style,s=!1;f.size===Bi.DISPLAY.size&&u.symbol&&!PQ.includes(u.name)&&(s=!0);var v;if(u.symbol){var x=s?"Size2-Regular":"Size1-Regular",A="";if((u.name==="\\oiint"||u.name==="\\oiiint")&&(A=u.name.slice(1),u.name=A==="oiint"?"\\iint":"\\iiint"),v=Xt.makeSymbol(u.name,x,"math",t,["mop","op-symbol",s?"large-op":"small-op"]),A.length>0){var C=v.italic,P=Xt.staticSvg(A+"Size"+(s?"2":"1"),t);v=Xt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:v,shift:0},{type:"elem",elem:P,shift:s?.08:0}]},t),u.name="\\"+A,v.classes.unshift("mop"),v.italic=C}}else if(u.body){var L=fl(u.body,t,!0);L.length===1&&L[0]instanceof pd?(v=L[0],v.classes[0]="mop"):v=Xt.makeSpan(["mop"],L,t)}else{for(var F=[],U=1;U<u.name.length;U++)F.push(Xt.mathsym(u.name[U],u.mode,t));v=Xt.makeSpan(["mop"],F,t)}var q=0,G=0;return(v instanceof pd||u.name==="\\oiint"||u.name==="\\oiiint")&&!u.suppressBaseShift&&(q=(v.height-v.depth)/2-t.fontMetrics().axisHeight,G=v.italic),a?MQ(v,n,r,t,f,G,q):(q&&(v.style.position="relative",v.style.top=Er(q)),v)},LT=(e,t)=>{var n;if(e.symbol)n=new Ec("mo",[md(e.name,e.mode)]),PQ.includes(e.name)&&n.setAttribute("largeop","false");else if(e.body)n=new Ec("mo",rc(e.body,t));else{n=new Ec("mi",[new Jh(e.name.slice(1))]);var r=new Ec("mo",[md("","text")]);e.parentIsSupSub?n=new Ec("mrow",[n,r]):n=aQ([n,r])}return n},jwe={"":"\\prod","":"\\coprod","":"\\sum","":"\\bigwedge","":"\\bigvee","":"\\bigcap","":"\\bigcup","":"\\bigodot","":"\\bigoplus","":"\\bigotimes","":"\\biguplus","":"\\bigsqcup"};Nr({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","","","","","","","","","","","",""],props:{numArgs:0},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=r;return a.length===1&&(a=jwe[a]),{type:"op",mode:n.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:a}},htmlBuilder:cx,mathmlBuilder:LT});Nr({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"op",mode:n.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:qo(r)}},htmlBuilder:cx,mathmlBuilder:LT});var Uwe={"":"\\int","":"\\iint","":"\\iiint","":"\\oint","":"\\oiint","":"\\oiiint"};Nr({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e;return{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:cx,mathmlBuilder:LT});Nr({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e;return{type:"op",mode:t.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:cx,mathmlBuilder:LT});Nr({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","","","","","",""],props:{numArgs:0,allowedInArgument:!0},handler(e){var{parser:t,funcName:n}=e,r=n;return r.length===1&&(r=Uwe[r]),{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:r}},htmlBuilder:cx,mathmlBuilder:LT});var OQ=(e,t)=>{var n,r,a=!1,u;e.type==="supsub"?(n=e.sup,r=e.sub,u=Fs(e.base,"operatorname"),a=!0):u=Fs(e,"operatorname");var f;if(u.body.length>0){for(var s=u.body.map(C=>{var P=C.text;return typeof P=="string"?{type:"textord",mode:C.mode,text:P}:C}),v=fl(s,t.withFont("mathrm"),!0),x=0;x<v.length;x++){var A=v[x];A instanceof pd&&(A.text=A.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}f=Xt.makeSpan(["mop"],v,t)}else f=Xt.makeSpan(["mop"],[],t);return a?MQ(f,n,r,t,t.style,0,0):f},Vwe=(e,t)=>{for(var n=rc(e.body,t.withFont("mathrm")),r=!0,a=0;a<n.length;a++){var u=n[a];if(!(u instanceof Qn.SpaceNode))if(u instanceof Qn.MathNode)switch(u.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":{var f=u.children[0];u.children.length===1&&f instanceof Qn.TextNode?f.text=f.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):r=!1;break}default:r=!1}else r=!1}if(r){var s=n.map(A=>A.toText()).join("");n=[new Qn.TextNode(s)]}var v=new Qn.MathNode("mi",n);v.setAttribute("mathvariant","normal");var x=new Qn.MathNode("mo",[md("","text")]);return e.parentIsSupSub?new Qn.MathNode("mrow",[v,x]):Qn.newDocumentFragment([v,x])};Nr({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(e,t)=>{var{parser:n,funcName:r}=e,a=t[0];return{type:"operatorname",mode:n.mode,body:qo(a),alwaysHandleSupSub:r==="\\operatornamewithlimits",limits:!1,parentIsSupSub:!1}},htmlBuilder:OQ,mathmlBuilder:Vwe});Ne("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@");C_({type:"ordgroup",htmlBuilder(e,t){return e.semisimple?Xt.makeFragment(fl(e.body,t,!1)):Xt.makeSpan(["mord"],fl(e.body,t,!0),t)},mathmlBuilder(e,t){return f0(e.body,t,!0)}});Nr({type:"overline",names:["\\overline"],props:{numArgs:1},handler(e,t){var{parser:n}=e,r=t[0];return{type:"overline",mode:n.mode,body:r}},htmlBuilder(e,t){var n=wa(e.body,t.havingCrampedStyle()),r=Xt.makeLineSpan("overline-line",t),a=t.fontMetrics().defaultRuleThickness,u=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n},{type:"kern",size:3*a},{type:"elem",elem:r},{type:"kern",size:a}]},t);return Xt.makeSpan(["mord","overline"],[u],t)},mathmlBuilder(e,t){var n=new Qn.MathNode("mo",[new Qn.TextNode("")]);n.setAttribute("stretchy","true");var r=new Qn.MathNode("mover",[qa(e.body,t),n]);return r.setAttribute("accent","true"),r}});Nr({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"phantom",mode:n.mode,body:qo(r)}},htmlBuilder:(e,t)=>{var n=fl(e.body,t.withPhantom(),!1);return Xt.makeFragment(n)},mathmlBuilder:(e,t)=>{var n=rc(e.body,t);return new Qn.MathNode("mphantom",n)}});Nr({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"hphantom",mode:n.mode,body:r}},htmlBuilder:(e,t)=>{var n=Xt.makeSpan([],[wa(e.body,t.withPhantom())]);if(n.height=0,n.depth=0,n.children)for(var r=0;r<n.children.length;r++)n.children[r].height=0,n.children[r].depth=0;return n=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},t),Xt.makeSpan(["mord"],[n],t)},mathmlBuilder:(e,t)=>{var n=rc(qo(e.body),t),r=new Qn.MathNode("mphantom",n),a=new Qn.MathNode("mpadded",[r]);return a.setAttribute("height","0px"),a.setAttribute("depth","0px"),a}});Nr({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"vphantom",mode:n.mode,body:r}},htmlBuilder:(e,t)=>{var n=Xt.makeSpan(["inner"],[wa(e.body,t.withPhantom())]),r=Xt.makeSpan(["fix"],[]);return Xt.makeSpan(["mord","rlap"],[n,r],t)},mathmlBuilder:(e,t)=>{var n=rc(qo(e.body),t),r=new Qn.MathNode("mphantom",n),a=new Qn.MathNode("mpadded",[r]);return a.setAttribute("width","0px"),a}});Nr({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(e,t){var{parser:n}=e,r=Fs(t[0],"size").value,a=t[1];return{type:"raisebox",mode:n.mode,dy:r,body:a}},htmlBuilder(e,t){var n=wa(e.body,t),r=ko(e.dy,t);return Xt.makeVList({positionType:"shift",positionData:-r,children:[{type:"elem",elem:n}]},t)},mathmlBuilder(e,t){var n=new Qn.MathNode("mpadded",[qa(e.body,t)]),r=e.dy.number+e.dy.unit;return n.setAttribute("voffset",r),n}});Nr({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0,allowedInArgument:!0},handler(e){var{parser:t}=e;return{type:"internal",mode:t.mode}}});Nr({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["size","size","size"]},handler(e,t,n){var{parser:r}=e,a=n[0],u=Fs(t[0],"size"),f=Fs(t[1],"size");return{type:"rule",mode:r.mode,shift:a&&Fs(a,"size").value,width:u.value,height:f.value}},htmlBuilder(e,t){var n=Xt.makeSpan(["mord","rule"],[],t),r=ko(e.width,t),a=ko(e.height,t),u=e.shift?ko(e.shift,t):0;return n.style.borderRightWidth=Er(r),n.style.borderTopWidth=Er(a),n.style.bottom=Er(u),n.width=r,n.height=a+u,n.depth=-u,n.maxFontSize=a*1.125*t.sizeMultiplier,n},mathmlBuilder(e,t){var n=ko(e.width,t),r=ko(e.height,t),a=e.shift?ko(e.shift,t):0,u=t.color&&t.getColor()||"black",f=new Qn.MathNode("mspace");f.setAttribute("mathbackground",u),f.setAttribute("width",Er(n)),f.setAttribute("height",Er(r));var s=new Qn.MathNode("mpadded",[f]);return a>=0?s.setAttribute("height",Er(a)):(s.setAttribute("height",Er(a)),s.setAttribute("depth",Er(-a))),s.setAttribute("voffset",Er(a)),s}});function LQ(e,t,n){for(var r=fl(e,t,!1),a=t.sizeMultiplier/n.sizeMultiplier,u=0;u<r.length;u++){var f=r[u].classes.indexOf("sizing");f<0?Array.prototype.push.apply(r[u].classes,t.sizingClasses(n)):r[u].classes[f+1]==="reset-size"+t.size&&(r[u].classes[f+1]="reset-size"+n.size),r[u].height*=a,r[u].depth*=a}return Xt.makeFragment(r)}var pV=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],$we=(e,t)=>{var n=t.havingSize(e.size);return LQ(e.body,n,t)};Nr({type:"sizing",names:pV,props:{numArgs:0,allowedInText:!0},handler:(e,t)=>{var{breakOnTokenText:n,funcName:r,parser:a}=e,u=a.parseExpression(!1,n);return{type:"sizing",mode:a.mode,size:pV.indexOf(r)+1,body:u}},htmlBuilder:$we,mathmlBuilder:(e,t)=>{var n=t.havingSize(e.size),r=rc(e.body,n),a=new Qn.MathNode("mstyle",r);return a.setAttribute("mathsize",Er(n.sizeMultiplier)),a}});Nr({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(e,t,n)=>{var{parser:r}=e,a=!1,u=!1,f=n[0]&&Fs(n[0],"ordgroup");if(f)for(var s="",v=0;v<f.body.length;++v){var x=f.body[v];if(s=x.text,s==="t")a=!0;else if(s==="b")u=!0;else{a=!1,u=!1;break}}else a=!0,u=!0;var A=t[0];return{type:"smash",mode:r.mode,body:A,smashHeight:a,smashDepth:u}},htmlBuilder:(e,t)=>{var n=Xt.makeSpan([],[wa(e.body,t)]);if(!e.smashHeight&&!e.smashDepth)return n;if(e.smashHeight&&(n.height=0,n.children))for(var r=0;r<n.children.length;r++)n.children[r].height=0;if(e.smashDepth&&(n.depth=0,n.children))for(var a=0;a<n.children.length;a++)n.children[a].depth=0;var u=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},t);return Xt.makeSpan(["mord"],[u],t)},mathmlBuilder:(e,t)=>{var n=new Qn.MathNode("mpadded",[qa(e.body,t)]);return e.smashHeight&&n.setAttribute("height","0px"),e.smashDepth&&n.setAttribute("depth","0px"),n}});Nr({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(e,t,n){var{parser:r}=e,a=n[0],u=t[0];return{type:"sqrt",mode:r.mode,body:u,index:a}},htmlBuilder(e,t){var n=wa(e.body,t.havingCrampedStyle());n.height===0&&(n.height=t.fontMetrics().xHeight),n=Xt.wrapFragment(n,t);var r=t.fontMetrics(),a=r.defaultRuleThickness,u=a;t.style.id<Bi.TEXT.id&&(u=t.fontMetrics().xHeight);var f=a+u/4,s=n.height+n.depth+f+a,{span:v,ruleWidth:x,advanceWidth:A}=lp.sqrtImage(s,t),C=v.height-x;C>n.height+n.depth+f&&(f=(f+C-n.height-n.depth)/2);var P=v.height-n.height-f-x;n.style.paddingLeft=Er(A);var L=Xt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n,wrapperClasses:["svg-align"]},{type:"kern",size:-(n.height+P)},{type:"elem",elem:v},{type:"kern",size:x}]},t);if(e.index){var F=t.havingStyle(Bi.SCRIPTSCRIPT),U=wa(e.index,F,t),q=.6*(L.height-L.depth),G=Xt.makeVList({positionType:"shift",positionData:-q,children:[{type:"elem",elem:U}]},t),$=Xt.makeSpan(["root"],[G]);return Xt.makeSpan(["mord","sqrt"],[$,L],t)}else return Xt.makeSpan(["mord","sqrt"],[L],t)},mathmlBuilder(e,t){var{body:n,index:r}=e;return r?new Qn.MathNode("mroot",[qa(n,t),qa(r,t)]):new Qn.MathNode("msqrt",[qa(n,t)])}});var mV={display:Bi.DISPLAY,text:Bi.TEXT,script:Bi.SCRIPT,scriptscript:Bi.SCRIPTSCRIPT};Nr({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e,t){var{breakOnTokenText:n,funcName:r,parser:a}=e,u=a.parseExpression(!0,n),f=r.slice(1,r.length-5);return{type:"styling",mode:a.mode,style:f,body:u}},htmlBuilder(e,t){var n=mV[e.style],r=t.havingStyle(n).withFont("");return LQ(e.body,r,t)},mathmlBuilder(e,t){var n=mV[e.style],r=t.havingStyle(n),a=rc(e.body,r),u=new Qn.MathNode("mstyle",a),f={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]},s=f[e.style];return u.setAttribute("scriptlevel",s[0]),u.setAttribute("displaystyle",s[1]),u}});var Hwe=function(t,n){var r=t.base;if(r)if(r.type==="op"){var a=r.limits&&(n.style.size===Bi.DISPLAY.size||r.alwaysHandleSupSub);return a?cx:null}else if(r.type==="operatorname"){var u=r.alwaysHandleSupSub&&(n.style.size===Bi.DISPLAY.size||r.limits);return u?OQ:null}else{if(r.type==="accent")return Ca.isCharacterBox(r.base)?VL:null;if(r.type==="horizBrace"){var f=!t.sub;return f===r.isOver?RQ:null}else return null}else return null};C_({type:"supsub",htmlBuilder(e,t){var n=Hwe(e,t);if(n)return n(e,t);var{base:r,sup:a,sub:u}=e,f=wa(r,t),s,v,x=t.fontMetrics(),A=0,C=0,P=r&&Ca.isCharacterBox(r);if(a){var L=t.havingStyle(t.style.sup());s=wa(a,L,t),P||(A=f.height-L.fontMetrics().supDrop*L.sizeMultiplier/t.sizeMultiplier)}if(u){var F=t.havingStyle(t.style.sub());v=wa(u,F,t),P||(C=f.depth+F.fontMetrics().subDrop*F.sizeMultiplier/t.sizeMultiplier)}var U;t.style===Bi.DISPLAY?U=x.sup1:t.style.cramped?U=x.sup3:U=x.sup2;var q=t.sizeMultiplier,G=Er(.5/x.ptPerEm/q),$=null;if(v){var X=e.base&&e.base.type==="op"&&e.base.name&&(e.base.name==="\\oiint"||e.base.name==="\\oiiint");(f instanceof pd||X)&&($=Er(-f.italic))}var ie;if(s&&v){A=Math.max(A,U,s.depth+.25*x.xHeight),C=Math.max(C,x.sub2);var de=x.defaultRuleThickness,fe=4*de;if(A-s.depth-(v.height-C)<fe){C=fe-(A-s.depth)+v.height;var be=.8*x.xHeight-(A-s.depth);be>0&&(A+=be,C-=be)}var ve=[{type:"elem",elem:v,shift:C,marginRight:G,marginLeft:$},{type:"elem",elem:s,shift:-A,marginRight:G}];ie=Xt.makeVList({positionType:"individualShift",children:ve},t)}else if(v){C=Math.max(C,x.sub1,v.height-.8*x.xHeight);var Qe=[{type:"elem",elem:v,marginLeft:$,marginRight:G}];ie=Xt.makeVList({positionType:"shift",positionData:C,children:Qe},t)}else if(s)A=Math.max(A,U,s.depth+.25*x.xHeight),ie=Xt.makeVList({positionType:"shift",positionData:-A,children:[{type:"elem",elem:s,marginRight:G}]},t);else throw new Error("supsub must have either sup or sub.");var we=YP(f,"right")||"mord";return Xt.makeSpan([we],[f,Xt.makeSpan(["msupsub"],[ie])],t)},mathmlBuilder(e,t){var n=!1,r,a;e.base&&e.base.type==="horizBrace"&&(a=!!e.sup,a===e.base.isOver&&(n=!0,r=e.base.isOver)),e.base&&(e.base.type==="op"||e.base.type==="operatorname")&&(e.base.parentIsSupSub=!0);var u=[qa(e.base,t)];e.sub&&u.push(qa(e.sub,t)),e.sup&&u.push(qa(e.sup,t));var f;if(n)f=r?"mover":"munder";else if(e.sub)if(e.sup){var x=e.base;x&&x.type==="op"&&x.limits&&t.style===Bi.DISPLAY||x&&x.type==="operatorname"&&x.alwaysHandleSupSub&&(t.style===Bi.DISPLAY||x.limits)?f="munderover":f="msubsup"}else{var v=e.base;v&&v.type==="op"&&v.limits&&(t.style===Bi.DISPLAY||v.alwaysHandleSupSub)||v&&v.type==="operatorname"&&v.alwaysHandleSupSub&&(v.limits||t.style===Bi.DISPLAY)?f="munder":f="msub"}else{var s=e.base;s&&s.type==="op"&&s.limits&&(t.style===Bi.DISPLAY||s.alwaysHandleSupSub)||s&&s.type==="operatorname"&&s.alwaysHandleSupSub&&(s.limits||t.style===Bi.DISPLAY)?f="mover":f="msup"}return new Qn.MathNode(f,u)}});C_({type:"atom",htmlBuilder(e,t){return Xt.mathsym(e.text,e.mode,t,["m"+e.family])},mathmlBuilder(e,t){var n=new Qn.MathNode("mo",[md(e.text,e.mode)]);if(e.family==="bin"){var r=jL(e,t);r==="bold-italic"&&n.setAttribute("mathvariant",r)}else e.family==="punct"?n.setAttribute("separator","true"):(e.family==="open"||e.family==="close")&&n.setAttribute("stretchy","false");return n}});var DQ={mi:"italic",mn:"normal",mtext:"normal"};C_({type:"mathord",htmlBuilder(e,t){return Xt.makeOrd(e,t,"mathord")},mathmlBuilder(e,t){var n=new Qn.MathNode("mi",[md(e.text,e.mode,t)]),r=jL(e,t)||"italic";return r!==DQ[n.type]&&n.setAttribute("mathvariant",r),n}});C_({type:"textord",htmlBuilder(e,t){return Xt.makeOrd(e,t,"textord")},mathmlBuilder(e,t){var n=md(e.text,e.mode,t),r=jL(e,t)||"normal",a;return e.mode==="text"?a=new Qn.MathNode("mtext",[n]):/[0-9]/.test(e.text)?a=new Qn.MathNode("mn",[n]):e.text==="\\prime"?a=new Qn.MathNode("mo",[n]):a=new Qn.MathNode("mi",[n]),r!==DQ[a.type]&&a.setAttribute("mathvariant",r),a}});var q5={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},W5={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};C_({type:"spacing",htmlBuilder(e,t){if(W5.hasOwnProperty(e.text)){var n=W5[e.text].className||"";if(e.mode==="text"){var r=Xt.makeOrd(e,t,"textord");return r.classes.push(n),r}else return Xt.makeSpan(["mspace",n],[Xt.mathsym(e.text,e.mode,t)],t)}else{if(q5.hasOwnProperty(e.text))return Xt.makeSpan(["mspace",q5[e.text]],[],t);throw new ir('Unknown type of space "'+e.text+'"')}},mathmlBuilder(e,t){var n;if(W5.hasOwnProperty(e.text))n=new Qn.MathNode("mtext",[new Qn.TextNode("")]);else{if(q5.hasOwnProperty(e.text))return new Qn.MathNode("mspace");throw new ir('Unknown type of space "'+e.text+'"')}return n}});var gV=()=>{var e=new Qn.MathNode("mtd",[]);return e.setAttribute("width","50%"),e};C_({type:"tag",mathmlBuilder(e,t){var n=new Qn.MathNode("mtable",[new Qn.MathNode("mtr",[gV(),new Qn.MathNode("mtd",[f0(e.body,t)]),gV(),new Qn.MathNode("mtd",[f0(e.tag,t)])])]);return n.setAttribute("width","100%"),n}});var _V={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},yV={"\\textbf":"textbf","\\textmd":"textmd"},Gwe={"\\textit":"textit","\\textup":"textup"},vV=(e,t)=>{var n=e.font;if(n){if(_V[n])return t.withTextFontFamily(_V[n]);if(yV[n])return t.withTextFontWeight(yV[n]);if(n==="\\emph")return t.fontShape==="textit"?t.withTextFontShape("textup"):t.withTextFontShape("textit")}else return t;return t.withTextFontShape(Gwe[n])};Nr({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup","\\emph"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(e,t){var{parser:n,funcName:r}=e,a=t[0];return{type:"text",mode:n.mode,body:qo(a),font:r}},htmlBuilder(e,t){var n=vV(e,t),r=fl(e.body,n,!0);return Xt.makeSpan(["mord","text"],r,n)},mathmlBuilder(e,t){var n=vV(e,t);return f0(e.body,n)}});Nr({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"underline",mode:n.mode,body:t[0]}},htmlBuilder(e,t){var n=wa(e.body,t),r=Xt.makeLineSpan("underline-line",t),a=t.fontMetrics().defaultRuleThickness,u=Xt.makeVList({positionType:"top",positionData:n.height,children:[{type:"kern",size:a},{type:"elem",elem:r},{type:"kern",size:3*a},{type:"elem",elem:n}]},t);return Xt.makeSpan(["mord","underline"],[u],t)},mathmlBuilder(e,t){var n=new Qn.MathNode("mo",[new Qn.TextNode("")]);n.setAttribute("stretchy","true");var r=new Qn.MathNode("munder",[qa(e.body,t),n]);return r.setAttribute("accentunder","true"),r}});Nr({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(e,t){var{parser:n}=e;return{type:"vcenter",mode:n.mode,body:t[0]}},htmlBuilder(e,t){var n=wa(e.body,t),r=t.fontMetrics().axisHeight,a=.5*(n.height-r-(n.depth+r));return Xt.makeVList({positionType:"shift",positionData:a,children:[{type:"elem",elem:n}]},t)},mathmlBuilder(e,t){return new Qn.MathNode("mpadded",[qa(e.body,t)],["vcenter"])}});Nr({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(e,t,n){throw new ir("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(e,t){for(var n=xV(e),r=[],a=t.havingStyle(t.style.text()),u=0;u<n.length;u++){var f=n[u];f==="~"&&(f="\\textasciitilde"),r.push(Xt.makeSymbol(f,"Typewriter-Regular",e.mode,a,["mord","texttt"]))}return Xt.makeSpan(["mord","text"].concat(a.sizingClasses(t)),Xt.tryCombineChars(r),a)},mathmlBuilder(e,t){var n=new Qn.TextNode(xV(e)),r=new Qn.MathNode("mtext",[n]);return r.setAttribute("mathvariant","monospace"),r}});var xV=e=>e.body.replace(/ /g,e.star?"":""),Bm=iQ,NQ=`[ \r
	]`,qwe="\\\\[a-zA-Z@]+",Wwe="\\\\[^\uD800-\uDFFF]",Zwe="("+qwe+")"+NQ+"*",Xwe=`\\\\(
|[ \r	]+
?)[ \r	]*`,e8="[-]",Ywe=new RegExp(e8+"+$"),Kwe="("+NQ+"+)|"+(Xwe+"|")+"([!-\\[\\]---]"+(e8+"*")+"|[\uD800-\uDBFF][\uDC00-\uDFFF]"+(e8+"*")+"|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5"+("|"+Zwe)+("|"+Wwe+")");class bV{constructor(t,n){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=t,this.settings=n,this.tokenRegex=new RegExp(Kwe,"g"),this.catcodes={"%":14,"~":13}}setCatcode(t,n){this.catcodes[t]=n}lex(){var t=this.input,n=this.tokenRegex.lastIndex;if(n===t.length)return new Ic("EOF",new Wu(this,n,n));var r=this.tokenRegex.exec(t);if(r===null||r.index!==n)throw new ir("Unexpected character: '"+t[n]+"'",new Ic(t[n],new Wu(this,n,n+1)));var a=r[6]||r[3]||(r[2]?"\\ ":" ");if(this.catcodes[a]===14){var u=t.indexOf(`
`,this.tokenRegex.lastIndex);return u===-1?(this.tokenRegex.lastIndex=t.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=u+1,this.lex()}return new Ic(a,new Wu(this,n,this.tokenRegex.lastIndex))}}class Qwe{constructor(t,n){t===void 0&&(t={}),n===void 0&&(n={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=n,this.builtins=t,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(this.undefStack.length===0)throw new ir("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var t=this.undefStack.pop();for(var n in t)t.hasOwnProperty(n)&&(t[n]==null?delete this.current[n]:this.current[n]=t[n])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(t){return this.current.hasOwnProperty(t)||this.builtins.hasOwnProperty(t)}get(t){return this.current.hasOwnProperty(t)?this.current[t]:this.builtins[t]}set(t,n,r){if(r===void 0&&(r=!1),r){for(var a=0;a<this.undefStack.length;a++)delete this.undefStack[a][t];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][t]=n)}else{var u=this.undefStack[this.undefStack.length-1];u&&!u.hasOwnProperty(t)&&(u[t]=this.current[t])}n==null?delete this.current[t]:this.current[t]=n}}var Jwe=SQ;Ne("\\noexpand",function(e){var t=e.popToken();return e.isExpandable(t.text)&&(t.noexpand=!0,t.treatAsRelax=!0),{tokens:[t],numArgs:0}});Ne("\\expandafter",function(e){var t=e.popToken();return e.expandOnce(!0),{tokens:[t],numArgs:0}});Ne("\\@firstoftwo",function(e){var t=e.consumeArgs(2);return{tokens:t[0],numArgs:0}});Ne("\\@secondoftwo",function(e){var t=e.consumeArgs(2);return{tokens:t[1],numArgs:0}});Ne("\\@ifnextchar",function(e){var t=e.consumeArgs(3);e.consumeSpaces();var n=e.future();return t[0].length===1&&t[0][0].text===n.text?{tokens:t[1],numArgs:0}:{tokens:t[2],numArgs:0}});Ne("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}");Ne("\\TextOrMath",function(e){var t=e.consumeArgs(2);return e.mode==="text"?{tokens:t[0],numArgs:0}:{tokens:t[1],numArgs:0}});var wV={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};Ne("\\char",function(e){var t=e.popToken(),n,r="";if(t.text==="'")n=8,t=e.popToken();else if(t.text==='"')n=16,t=e.popToken();else if(t.text==="`")if(t=e.popToken(),t.text[0]==="\\")r=t.text.charCodeAt(1);else{if(t.text==="EOF")throw new ir("\\char` missing argument");r=t.text.charCodeAt(0)}else n=10;if(n){if(r=wV[t.text],r==null||r>=n)throw new ir("Invalid base-"+n+" digit "+t.text);for(var a;(a=wV[e.future().text])!=null&&a<n;)r*=n,r+=a,e.popToken()}return"\\@char{"+r+"}"});var YL=(e,t,n,r)=>{var a=e.consumeArg().tokens;if(a.length!==1)throw new ir("\\newcommand's first argument must be a macro name");var u=a[0].text,f=e.isDefined(u);if(f&&!t)throw new ir("\\newcommand{"+u+"} attempting to redefine "+(u+"; use \\renewcommand"));if(!f&&!n)throw new ir("\\renewcommand{"+u+"} when command "+u+" does not yet exist; use \\newcommand");var s=0;if(a=e.consumeArg().tokens,a.length===1&&a[0].text==="["){for(var v="",x=e.expandNextToken();x.text!=="]"&&x.text!=="EOF";)v+=x.text,x=e.expandNextToken();if(!v.match(/^\s*[0-9]+\s*$/))throw new ir("Invalid number of arguments: "+v);s=parseInt(v),a=e.consumeArg().tokens}return f&&r||e.macros.set(u,{tokens:a,numArgs:s}),""};Ne("\\newcommand",e=>YL(e,!1,!0,!1));Ne("\\renewcommand",e=>YL(e,!0,!1,!1));Ne("\\providecommand",e=>YL(e,!0,!0,!0));Ne("\\message",e=>{var t=e.consumeArgs(1)[0];return console.log(t.reverse().map(n=>n.text).join("")),""});Ne("\\errmessage",e=>{var t=e.consumeArgs(1)[0];return console.error(t.reverse().map(n=>n.text).join("")),""});Ne("\\show",e=>{var t=e.popToken(),n=t.text;return console.log(t,e.macros.get(n),Bm[n],io.math[n],io.text[n]),""});Ne("\\bgroup","{");Ne("\\egroup","}");Ne("~","\\nobreakspace");Ne("\\lq","`");Ne("\\rq","'");Ne("\\aa","\\r a");Ne("\\AA","\\r A");Ne("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`}");Ne("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}");Ne("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`}");Ne("","\\mathscr{B}");Ne("","\\mathscr{E}");Ne("","\\mathscr{F}");Ne("","\\mathscr{H}");Ne("","\\mathscr{I}");Ne("","\\mathscr{L}");Ne("","\\mathscr{M}");Ne("","\\mathscr{R}");Ne("","\\mathfrak{C}");Ne("","\\mathfrak{H}");Ne("","\\mathfrak{Z}");Ne("\\Bbbk","\\Bbb{k}");Ne("","\\cdotp");Ne("\\llap","\\mathllap{\\textrm{#1}}");Ne("\\rlap","\\mathrlap{\\textrm{#1}}");Ne("\\clap","\\mathclap{\\textrm{#1}}");Ne("\\mathstrut","\\vphantom{(}");Ne("\\underbar","\\underline{\\text{#1}}");Ne("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}');Ne("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`}}");Ne("\\ne","\\neq");Ne("","\\neq");Ne("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`}}");Ne("","\\notin");Ne("","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`}}");Ne("","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`}}");Ne("","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`}}");Ne("","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`}}");Ne("","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`}}");Ne("","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`}}");Ne("","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`}}");Ne("","\\perp");Ne("","\\mathclose{!\\mkern-0.8mu!}");Ne("","\\notni");Ne("","\\ulcorner");Ne("","\\urcorner");Ne("","\\llcorner");Ne("","\\lrcorner");Ne("","\\copyright");Ne("","\\textregistered");Ne("","\\textregistered");Ne("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}');Ne("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}');Ne("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}');Ne("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}');Ne("\\vdots","{\\varvdots\\rule{0pt}{15pt}}");Ne("","\\vdots");Ne("\\varGamma","\\mathit{\\Gamma}");Ne("\\varDelta","\\mathit{\\Delta}");Ne("\\varTheta","\\mathit{\\Theta}");Ne("\\varLambda","\\mathit{\\Lambda}");Ne("\\varXi","\\mathit{\\Xi}");Ne("\\varPi","\\mathit{\\Pi}");Ne("\\varSigma","\\mathit{\\Sigma}");Ne("\\varUpsilon","\\mathit{\\Upsilon}");Ne("\\varPhi","\\mathit{\\Phi}");Ne("\\varPsi","\\mathit{\\Psi}");Ne("\\varOmega","\\mathit{\\Omega}");Ne("\\substack","\\begin{subarray}{c}#1\\end{subarray}");Ne("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax");Ne("\\boxed","\\fbox{$\\displaystyle{#1}$}");Ne("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;");Ne("\\implies","\\DOTSB\\;\\Longrightarrow\\;");Ne("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");Ne("\\dddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ...}}{#1}}");Ne("\\ddddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ....}}{#1}}");var TV={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};Ne("\\dots",function(e){var t="\\dotso",n=e.expandAfterFuture().text;return n in TV?t=TV[n]:(n.slice(0,4)==="\\not"||n in io.math&&["bin","rel"].includes(io.math[n].group))&&(t="\\dotsb"),t});var KL={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};Ne("\\dotso",function(e){var t=e.future().text;return t in KL?"\\ldots\\,":"\\ldots"});Ne("\\dotsc",function(e){var t=e.future().text;return t in KL&&t!==","?"\\ldots\\,":"\\ldots"});Ne("\\cdots",function(e){var t=e.future().text;return t in KL?"\\@cdots\\,":"\\@cdots"});Ne("\\dotsb","\\cdots");Ne("\\dotsm","\\cdots");Ne("\\dotsi","\\!\\cdots");Ne("\\dotsx","\\ldots\\,");Ne("\\DOTSI","\\relax");Ne("\\DOTSB","\\relax");Ne("\\DOTSX","\\relax");Ne("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax");Ne("\\,","\\tmspace+{3mu}{.1667em}");Ne("\\thinspace","\\,");Ne("\\>","\\mskip{4mu}");Ne("\\:","\\tmspace+{4mu}{.2222em}");Ne("\\medspace","\\:");Ne("\\;","\\tmspace+{5mu}{.2777em}");Ne("\\thickspace","\\;");Ne("\\!","\\tmspace-{3mu}{.1667em}");Ne("\\negthinspace","\\!");Ne("\\negmedspace","\\tmspace-{4mu}{.2222em}");Ne("\\negthickspace","\\tmspace-{5mu}{.277em}");Ne("\\enspace","\\kern.5em ");Ne("\\enskip","\\hskip.5em\\relax");Ne("\\quad","\\hskip1em\\relax");Ne("\\qquad","\\hskip2em\\relax");Ne("\\tag","\\@ifstar\\tag@literal\\tag@paren");Ne("\\tag@paren","\\tag@literal{({#1})}");Ne("\\tag@literal",e=>{if(e.macros.get("\\df@tag"))throw new ir("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"});Ne("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}");Ne("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)");Ne("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}");Ne("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1");Ne("\\newline","\\\\\\relax");Ne("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var zQ=Er(Qh["Main-Regular"][84][1]-.7*Qh["Main-Regular"][65][1]);Ne("\\LaTeX","\\textrm{\\html@mathml{"+("L\\kern-.36em\\raisebox{"+zQ+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{LaTeX}}");Ne("\\KaTeX","\\textrm{\\html@mathml{"+("K\\kern-.17em\\raisebox{"+zQ+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{KaTeX}}");Ne("\\hspace","\\@ifstar\\@hspacer\\@hspace");Ne("\\@hspace","\\hskip #1\\relax");Ne("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax");Ne("\\ordinarycolon",":");Ne("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}");Ne("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}');Ne("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}');Ne("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}');Ne("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}');Ne("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}');Ne("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}');Ne("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}');Ne("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}');Ne("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}');Ne("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}');Ne("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}');Ne("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}');Ne("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}');Ne("","\\dblcolon");Ne("","\\eqcolon");Ne("","\\coloneqq");Ne("","\\eqqcolon");Ne("","\\Coloneqq");Ne("\\ratio","\\vcentcolon");Ne("\\coloncolon","\\dblcolon");Ne("\\colonequals","\\coloneqq");Ne("\\coloncolonequals","\\Coloneqq");Ne("\\equalscolon","\\eqqcolon");Ne("\\equalscoloncolon","\\Eqqcolon");Ne("\\colonminus","\\coloneq");Ne("\\coloncolonminus","\\Coloneq");Ne("\\minuscolon","\\eqcolon");Ne("\\minuscoloncolon","\\Eqcolon");Ne("\\coloncolonapprox","\\Colonapprox");Ne("\\coloncolonsim","\\Colonsim");Ne("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}");Ne("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}");Ne("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}");Ne("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}");Ne("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`}}");Ne("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}");Ne("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}");Ne("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}");Ne("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}");Ne("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}");Ne("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}");Ne("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}");Ne("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}");Ne("\\gvertneqq","\\html@mathml{\\@gvertneqq}{}");Ne("\\lvertneqq","\\html@mathml{\\@lvertneqq}{}");Ne("\\ngeqq","\\html@mathml{\\@ngeqq}{}");Ne("\\ngeqslant","\\html@mathml{\\@ngeqslant}{}");Ne("\\nleqq","\\html@mathml{\\@nleqq}{}");Ne("\\nleqslant","\\html@mathml{\\@nleqslant}{}");Ne("\\nshortmid","\\html@mathml{\\@nshortmid}{}");Ne("\\nshortparallel","\\html@mathml{\\@nshortparallel}{}");Ne("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{}");Ne("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{}");Ne("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{}");Ne("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{}");Ne("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{}");Ne("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{}");Ne("\\imath","\\html@mathml{\\@imath}{}");Ne("\\jmath","\\html@mathml{\\@jmath}{}");Ne("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`}}");Ne("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`}}");Ne("","\\llbracket");Ne("","\\rrbracket");Ne("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`}}");Ne("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`}}");Ne("","\\lBrace");Ne("","\\rBrace");Ne("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`}}");Ne("","\\minuso");Ne("\\darr","\\downarrow");Ne("\\dArr","\\Downarrow");Ne("\\Darr","\\Downarrow");Ne("\\lang","\\langle");Ne("\\rang","\\rangle");Ne("\\uarr","\\uparrow");Ne("\\uArr","\\Uparrow");Ne("\\Uarr","\\Uparrow");Ne("\\N","\\mathbb{N}");Ne("\\R","\\mathbb{R}");Ne("\\Z","\\mathbb{Z}");Ne("\\alef","\\aleph");Ne("\\alefsym","\\aleph");Ne("\\Alpha","\\mathrm{A}");Ne("\\Beta","\\mathrm{B}");Ne("\\bull","\\bullet");Ne("\\Chi","\\mathrm{X}");Ne("\\clubs","\\clubsuit");Ne("\\cnums","\\mathbb{C}");Ne("\\Complex","\\mathbb{C}");Ne("\\Dagger","\\ddagger");Ne("\\diamonds","\\diamondsuit");Ne("\\empty","\\emptyset");Ne("\\Epsilon","\\mathrm{E}");Ne("\\Eta","\\mathrm{H}");Ne("\\exist","\\exists");Ne("\\harr","\\leftrightarrow");Ne("\\hArr","\\Leftrightarrow");Ne("\\Harr","\\Leftrightarrow");Ne("\\hearts","\\heartsuit");Ne("\\image","\\Im");Ne("\\infin","\\infty");Ne("\\Iota","\\mathrm{I}");Ne("\\isin","\\in");Ne("\\Kappa","\\mathrm{K}");Ne("\\larr","\\leftarrow");Ne("\\lArr","\\Leftarrow");Ne("\\Larr","\\Leftarrow");Ne("\\lrarr","\\leftrightarrow");Ne("\\lrArr","\\Leftrightarrow");Ne("\\Lrarr","\\Leftrightarrow");Ne("\\Mu","\\mathrm{M}");Ne("\\natnums","\\mathbb{N}");Ne("\\Nu","\\mathrm{N}");Ne("\\Omicron","\\mathrm{O}");Ne("\\plusmn","\\pm");Ne("\\rarr","\\rightarrow");Ne("\\rArr","\\Rightarrow");Ne("\\Rarr","\\Rightarrow");Ne("\\real","\\Re");Ne("\\reals","\\mathbb{R}");Ne("\\Reals","\\mathbb{R}");Ne("\\Rho","\\mathrm{P}");Ne("\\sdot","\\cdot");Ne("\\sect","\\S");Ne("\\spades","\\spadesuit");Ne("\\sub","\\subset");Ne("\\sube","\\subseteq");Ne("\\supe","\\supseteq");Ne("\\Tau","\\mathrm{T}");Ne("\\thetasym","\\vartheta");Ne("\\weierp","\\wp");Ne("\\Zeta","\\mathrm{Z}");Ne("\\argmin","\\DOTSB\\operatorname*{arg\\,min}");Ne("\\argmax","\\DOTSB\\operatorname*{arg\\,max}");Ne("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits");Ne("\\bra","\\mathinner{\\langle{#1}|}");Ne("\\ket","\\mathinner{|{#1}\\rangle}");Ne("\\braket","\\mathinner{\\langle{#1}\\rangle}");Ne("\\Bra","\\left\\langle#1\\right|");Ne("\\Ket","\\left|#1\\right\\rangle");var FQ=e=>t=>{var n=t.consumeArg().tokens,r=t.consumeArg().tokens,a=t.consumeArg().tokens,u=t.consumeArg().tokens,f=t.macros.get("|"),s=t.macros.get("\\|");t.macros.beginGroup();var v=C=>P=>{e&&(P.macros.set("|",f),a.length&&P.macros.set("\\|",s));var L=C;if(!C&&a.length){var F=P.future();F.text==="|"&&(P.popToken(),L=!0)}return{tokens:L?a:r,numArgs:0}};t.macros.set("|",v(!1)),a.length&&t.macros.set("\\|",v(!0));var x=t.consumeArg().tokens,A=t.expandTokens([...u,...x,...n]);return t.macros.endGroup(),{tokens:A.reverse(),numArgs:0}};Ne("\\bra@ket",FQ(!1));Ne("\\bra@set",FQ(!0));Ne("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}");Ne("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}");Ne("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}");Ne("\\angln","{\\angl n}");Ne("\\blue","\\textcolor{##6495ed}{#1}");Ne("\\orange","\\textcolor{##ffa500}{#1}");Ne("\\pink","\\textcolor{##ff00af}{#1}");Ne("\\red","\\textcolor{##df0030}{#1}");Ne("\\green","\\textcolor{##28ae7b}{#1}");Ne("\\gray","\\textcolor{gray}{#1}");Ne("\\purple","\\textcolor{##9d38bd}{#1}");Ne("\\blueA","\\textcolor{##ccfaff}{#1}");Ne("\\blueB","\\textcolor{##80f6ff}{#1}");Ne("\\blueC","\\textcolor{##63d9ea}{#1}");Ne("\\blueD","\\textcolor{##11accd}{#1}");Ne("\\blueE","\\textcolor{##0c7f99}{#1}");Ne("\\tealA","\\textcolor{##94fff5}{#1}");Ne("\\tealB","\\textcolor{##26edd5}{#1}");Ne("\\tealC","\\textcolor{##01d1c1}{#1}");Ne("\\tealD","\\textcolor{##01a995}{#1}");Ne("\\tealE","\\textcolor{##208170}{#1}");Ne("\\greenA","\\textcolor{##b6ffb0}{#1}");Ne("\\greenB","\\textcolor{##8af281}{#1}");Ne("\\greenC","\\textcolor{##74cf70}{#1}");Ne("\\greenD","\\textcolor{##1fab54}{#1}");Ne("\\greenE","\\textcolor{##0d923f}{#1}");Ne("\\goldA","\\textcolor{##ffd0a9}{#1}");Ne("\\goldB","\\textcolor{##ffbb71}{#1}");Ne("\\goldC","\\textcolor{##ff9c39}{#1}");Ne("\\goldD","\\textcolor{##e07d10}{#1}");Ne("\\goldE","\\textcolor{##a75a05}{#1}");Ne("\\redA","\\textcolor{##fca9a9}{#1}");Ne("\\redB","\\textcolor{##ff8482}{#1}");Ne("\\redC","\\textcolor{##f9685d}{#1}");Ne("\\redD","\\textcolor{##e84d39}{#1}");Ne("\\redE","\\textcolor{##bc2612}{#1}");Ne("\\maroonA","\\textcolor{##ffbde0}{#1}");Ne("\\maroonB","\\textcolor{##ff92c6}{#1}");Ne("\\maroonC","\\textcolor{##ed5fa6}{#1}");Ne("\\maroonD","\\textcolor{##ca337c}{#1}");Ne("\\maroonE","\\textcolor{##9e034e}{#1}");Ne("\\purpleA","\\textcolor{##ddd7ff}{#1}");Ne("\\purpleB","\\textcolor{##c6b9fc}{#1}");Ne("\\purpleC","\\textcolor{##aa87ff}{#1}");Ne("\\purpleD","\\textcolor{##7854ab}{#1}");Ne("\\purpleE","\\textcolor{##543b78}{#1}");Ne("\\mintA","\\textcolor{##f5f9e8}{#1}");Ne("\\mintB","\\textcolor{##edf2df}{#1}");Ne("\\mintC","\\textcolor{##e0e5cc}{#1}");Ne("\\grayA","\\textcolor{##f6f7f7}{#1}");Ne("\\grayB","\\textcolor{##f0f1f2}{#1}");Ne("\\grayC","\\textcolor{##e3e5e6}{#1}");Ne("\\grayD","\\textcolor{##d6d8da}{#1}");Ne("\\grayE","\\textcolor{##babec2}{#1}");Ne("\\grayF","\\textcolor{##888d93}{#1}");Ne("\\grayG","\\textcolor{##626569}{#1}");Ne("\\grayH","\\textcolor{##3b3e40}{#1}");Ne("\\grayI","\\textcolor{##21242c}{#1}");Ne("\\kaBlue","\\textcolor{##314453}{#1}");Ne("\\kaGreen","\\textcolor{##71B307}{#1}");var BQ={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class e2e{constructor(t,n,r){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=n,this.expansionCount=0,this.feed(t),this.macros=new Qwe(Jwe,n.macros),this.mode=r,this.stack=[]}feed(t){this.lexer=new bV(t,this.settings)}switchMode(t){this.mode=t}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return this.stack.length===0&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(t){this.stack.push(t)}pushTokens(t){this.stack.push(...t)}scanArgument(t){var n,r,a;if(t){if(this.consumeSpaces(),this.future().text!=="[")return null;n=this.popToken(),{tokens:a,end:r}=this.consumeArg(["]"])}else({tokens:a,start:n,end:r}=this.consumeArg());return this.pushToken(new Ic("EOF",r.loc)),this.pushTokens(a),new Ic("",Wu.range(n,r))}consumeSpaces(){for(;;){var t=this.future();if(t.text===" ")this.stack.pop();else break}}consumeArg(t){var n=[],r=t&&t.length>0;r||this.consumeSpaces();var a=this.future(),u,f=0,s=0;do{if(u=this.popToken(),n.push(u),u.text==="{")++f;else if(u.text==="}"){if(--f,f===-1)throw new ir("Extra }",u)}else if(u.text==="EOF")throw new ir("Unexpected end of input in a macro argument, expected '"+(t&&r?t[s]:"}")+"'",u);if(t&&r)if((f===0||f===1&&t[s]==="{")&&u.text===t[s]){if(++s,s===t.length){n.splice(-s,s);break}}else s=0}while(f!==0||r);return a.text==="{"&&n[n.length-1].text==="}"&&(n.pop(),n.shift()),n.reverse(),{tokens:n,start:a,end:u}}consumeArgs(t,n){if(n){if(n.length!==t+1)throw new ir("The length of delimiters doesn't match the number of args!");for(var r=n[0],a=0;a<r.length;a++){var u=this.popToken();if(r[a]!==u.text)throw new ir("Use of the macro doesn't match its definition",u)}}for(var f=[],s=0;s<t;s++)f.push(this.consumeArg(n&&n[s+1]).tokens);return f}countExpansion(t){if(this.expansionCount+=t,this.expansionCount>this.settings.maxExpand)throw new ir("Too many expansions: infinite loop or need to increase maxExpand setting")}expandOnce(t){var n=this.popToken(),r=n.text,a=n.noexpand?null:this._getExpansion(r);if(a==null||t&&a.unexpandable){if(t&&a==null&&r[0]==="\\"&&!this.isDefined(r))throw new ir("Undefined control sequence: "+r);return this.pushToken(n),!1}this.countExpansion(1);var u=a.tokens,f=this.consumeArgs(a.numArgs,a.delimiters);if(a.numArgs){u=u.slice();for(var s=u.length-1;s>=0;--s){var v=u[s];if(v.text==="#"){if(s===0)throw new ir("Incomplete placeholder at end of macro body",v);if(v=u[--s],v.text==="#")u.splice(s+1,1);else if(/^[1-9]$/.test(v.text))u.splice(s,2,...f[+v.text-1]);else throw new ir("Not a valid argument number",v)}}}return this.pushTokens(u),u.length}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;)if(this.expandOnce()===!1){var t=this.stack.pop();return t.treatAsRelax&&(t.text="\\relax"),t}throw new Error}expandMacro(t){return this.macros.has(t)?this.expandTokens([new Ic(t)]):void 0}expandTokens(t){var n=[],r=this.stack.length;for(this.pushTokens(t);this.stack.length>r;)if(this.expandOnce(!0)===!1){var a=this.stack.pop();a.treatAsRelax&&(a.noexpand=!1,a.treatAsRelax=!1),n.push(a)}return this.countExpansion(n.length),n}expandMacroAsText(t){var n=this.expandMacro(t);return n&&n.map(r=>r.text).join("")}_getExpansion(t){var n=this.macros.get(t);if(n==null)return n;if(t.length===1){var r=this.lexer.catcodes[t];if(r!=null&&r!==13)return}var a=typeof n=="function"?n(this):n;if(typeof a=="string"){var u=0;if(a.indexOf("#")!==-1)for(var f=a.replace(/##/g,"");f.indexOf("#"+(u+1))!==-1;)++u;for(var s=new bV(a,this.settings),v=[],x=s.lex();x.text!=="EOF";)v.push(x),x=s.lex();v.reverse();var A={tokens:v,numArgs:u};return A}return a}isDefined(t){return this.macros.has(t)||Bm.hasOwnProperty(t)||io.math.hasOwnProperty(t)||io.text.hasOwnProperty(t)||BQ.hasOwnProperty(t)}isExpandable(t){var n=this.macros.get(t);return n!=null?typeof n=="string"||typeof n=="function"||!n.unexpandable:Bm.hasOwnProperty(t)&&!Bm[t].primitive}}var EV=/^[]/,M3=Object.freeze({"":"+","":"-","":"=","":"(","":")","":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"a","":"e","":"h","":"i","":"j","":"k","":"l","":"m","":"n","":"o","":"p","":"r","":"s","":"t","":"u","":"v","":"x","":"","":"","":"","":"","":"","":"+","":"-","":"=","":"(","":")","":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"A","":"B","":"D","":"E","":"G","":"H","":"I","":"J","":"K","":"L","":"M","":"N","":"O","":"P","":"R","":"T","":"U","":"V","":"W","":"a","":"b","":"c","":"d","":"e","":"f","":"g",:"h","":"i",:"j","":"k",:"l","":"m",:"n","":"o","":"p",:"r",:"s","":"t","":"u","":"v",:"w",:"x",:"y","":"z","":"","":"","":"","":"","":"","":""}),Z5={"":{text:"\\'",math:"\\acute"},"":{text:"\\`",math:"\\grave"},"":{text:'\\"',math:"\\ddot"},"":{text:"\\~",math:"\\tilde"},"":{text:"\\=",math:"\\bar"},"":{text:"\\u",math:"\\breve"},"":{text:"\\v",math:"\\check"},"":{text:"\\^",math:"\\hat"},"":{text:"\\.",math:"\\dot"},"":{text:"\\r",math:"\\mathring"},"":{text:"\\H"},"":{text:"\\c"}},SV={:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"b",:"c",:"c",:"c",:"c",:"c",:"c",:"d",:"d",:"d",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"f",:"g",:"g",:"g",:"g",:"g",:"g",:"g",:"h",:"h",:"h",:"h",:"h",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"j",:"j",:"k",:"k",:"k",:"l",:"l",:"l",:"m",:"m",:"n",:"n",:"n",:"n",:"n",:"n",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"p",:"p",:"r",:"r",:"r",:"r",:"s",:"s",:"s",:"s",:"s",:"s",:"s",:"t",:"t",:"t",:"t",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"v",:"w",:"w",:"w",:"w",:"w",:"w",:"x",:"x",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"z",:"z",:"z",:"z",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"B",:"C",:"C",:"C",:"C",:"C",:"C",:"D",:"D",:"D",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"F",:"G",:"G",:"G",:"G",:"G",:"G",:"G",:"H",:"H",:"H",:"H",:"H",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"J",:"K",:"K",:"K",:"L",:"L",:"L",:"M",:"M",:"N",:"N",:"N",:"N",:"N",:"N",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"P",:"P",:"R",:"R",:"R",:"R",:"S",:"S",:"S",:"S",:"S",:"S",:"S",:"T",:"T",:"T",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"V",:"W",:"W",:"W",:"W",:"W",:"X",:"X",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Z",:"Z",:"Z",:"Z",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""};let jQ=class UQ{constructor(t,n){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new e2e(t,n,this.mode),this.settings=n,this.leftrightDepth=0}expect(t,n){if(n===void 0&&(n=!0),this.fetch().text!==t)throw new ir("Expected '"+t+"', got '"+this.fetch().text+"'",this.fetch());n&&this.consume()}consume(){this.nextToken=null}fetch(){return this.nextToken==null&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(t){this.mode=t,this.gullet.switchMode(t)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{var t=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),t}finally{this.gullet.endGroups()}}subparse(t){var n=this.nextToken;this.consume(),this.gullet.pushToken(new Ic("}")),this.gullet.pushTokens(t);var r=this.parseExpression(!1);return this.expect("}"),this.nextToken=n,r}parseExpression(t,n){for(var r=[];;){this.mode==="math"&&this.consumeSpaces();var a=this.fetch();if(UQ.endOfExpression.indexOf(a.text)!==-1||n&&a.text===n||t&&Bm[a.text]&&Bm[a.text].infix)break;var u=this.parseAtom(n);if(u){if(u.type==="internal")continue}else break;r.push(u)}return this.mode==="text"&&this.formLigatures(r),this.handleInfixNodes(r)}handleInfixNodes(t){for(var n=-1,r,a=0;a<t.length;a++)if(t[a].type==="infix"){if(n!==-1)throw new ir("only one infix operator per group",t[a].token);n=a,r=t[a].replaceWith}if(n!==-1&&r){var u,f,s=t.slice(0,n),v=t.slice(n+1);s.length===1&&s[0].type==="ordgroup"?u=s[0]:u={type:"ordgroup",mode:this.mode,body:s},v.length===1&&v[0].type==="ordgroup"?f=v[0]:f={type:"ordgroup",mode:this.mode,body:v};var x;return r==="\\\\abovefrac"?x=this.callFunction(r,[u,t[n],f],[]):x=this.callFunction(r,[u,f],[]),[x]}else return t}handleSupSubscript(t){var n=this.fetch(),r=n.text;this.consume(),this.consumeSpaces();var a;do{var u;a=this.parseGroup(t)}while(((u=a)==null?void 0:u.type)==="internal");if(!a)throw new ir("Expected group after '"+r+"'",n);return a}formatUnsupportedCmd(t){for(var n=[],r=0;r<t.length;r++)n.push({type:"textord",mode:"text",text:t[r]});var a={type:"text",mode:this.mode,body:n},u={type:"color",mode:this.mode,color:this.settings.errorColor,body:[a]};return u}parseAtom(t){var n=this.parseGroup("atom",t);if((n==null?void 0:n.type)==="internal"||this.mode==="text")return n;for(var r,a;;){this.consumeSpaces();var u=this.fetch();if(u.text==="\\limits"||u.text==="\\nolimits"){if(n&&n.type==="op"){var f=u.text==="\\limits";n.limits=f,n.alwaysHandleSupSub=!0}else if(n&&n.type==="operatorname")n.alwaysHandleSupSub&&(n.limits=u.text==="\\limits");else throw new ir("Limit controls must follow a math operator",u);this.consume()}else if(u.text==="^"){if(r)throw new ir("Double superscript",u);r=this.handleSupSubscript("superscript")}else if(u.text==="_"){if(a)throw new ir("Double subscript",u);a=this.handleSupSubscript("subscript")}else if(u.text==="'"){if(r)throw new ir("Double superscript",u);var s={type:"textord",mode:this.mode,text:"\\prime"},v=[s];for(this.consume();this.fetch().text==="'";)v.push(s),this.consume();this.fetch().text==="^"&&v.push(this.handleSupSubscript("superscript")),r={type:"ordgroup",mode:this.mode,body:v}}else if(M3[u.text]){var x=EV.test(u.text),A=[];for(A.push(new Ic(M3[u.text])),this.consume();;){var C=this.fetch().text;if(!M3[C]||EV.test(C)!==x)break;A.unshift(new Ic(M3[C])),this.consume()}var P=this.subparse(A);x?a={type:"ordgroup",mode:"math",body:P}:r={type:"ordgroup",mode:"math",body:P}}else break}return r||a?{type:"supsub",mode:this.mode,base:n,sup:r,sub:a}:n}parseFunction(t,n){var r=this.fetch(),a=r.text,u=Bm[a];if(!u)return null;if(this.consume(),n&&n!=="atom"&&!u.allowedInArgument)throw new ir("Got function '"+a+"' with no arguments"+(n?" as "+n:""),r);if(this.mode==="text"&&!u.allowedInText)throw new ir("Can't use function '"+a+"' in text mode",r);if(this.mode==="math"&&u.allowedInMath===!1)throw new ir("Can't use function '"+a+"' in math mode",r);var{args:f,optArgs:s}=this.parseArguments(a,u);return this.callFunction(a,f,s,r,t)}callFunction(t,n,r,a,u){var f={funcName:t,parser:this,token:a,breakOnTokenText:u},s=Bm[t];if(s&&s.handler)return s.handler(f,n,r);throw new ir("No function handler for "+t)}parseArguments(t,n){var r=n.numArgs+n.numOptionalArgs;if(r===0)return{args:[],optArgs:[]};for(var a=[],u=[],f=0;f<r;f++){var s=n.argTypes&&n.argTypes[f],v=f<n.numOptionalArgs;(n.primitive&&s==null||n.type==="sqrt"&&f===1&&u[0]==null)&&(s="primitive");var x=this.parseGroupOfType("argument to '"+t+"'",s,v);if(v)u.push(x);else if(x!=null)a.push(x);else throw new ir("Null argument, please report this as a bug")}return{args:a,optArgs:u}}parseGroupOfType(t,n,r){switch(n){case"color":return this.parseColorGroup(r);case"size":return this.parseSizeGroup(r);case"url":return this.parseUrlGroup(r);case"math":case"text":return this.parseArgumentGroup(r,n);case"hbox":{var a=this.parseArgumentGroup(r,"text");return a!=null?{type:"styling",mode:a.mode,body:[a],style:"text"}:null}case"raw":{var u=this.parseStringGroup("raw",r);return u!=null?{type:"raw",mode:"text",string:u.text}:null}case"primitive":{if(r)throw new ir("A primitive argument cannot be optional");var f=this.parseGroup(t);if(f==null)throw new ir("Expected group as "+t,this.fetch());return f}case"original":case null:case void 0:return this.parseArgumentGroup(r);default:throw new ir("Unknown group type as "+t,this.fetch())}}consumeSpaces(){for(;this.fetch().text===" ";)this.consume()}parseStringGroup(t,n){var r=this.gullet.scanArgument(n);if(r==null)return null;for(var a="",u;(u=this.fetch()).text!=="EOF";)a+=u.text,this.consume();return this.consume(),r.text=a,r}parseRegexGroup(t,n){for(var r=this.fetch(),a=r,u="",f;(f=this.fetch()).text!=="EOF"&&t.test(u+f.text);)a=f,u+=a.text,this.consume();if(u==="")throw new ir("Invalid "+n+": '"+r.text+"'",r);return r.range(a,u)}parseColorGroup(t){var n=this.parseStringGroup("color",t);if(n==null)return null;var r=/^(#[a-f0-9]{3,4}|#[a-f0-9]{6}|#[a-f0-9]{8}|[a-f0-9]{6}|[a-z]+)$/i.exec(n.text);if(!r)throw new ir("Invalid color: '"+n.text+"'",n);var a=r[0];return/^[0-9a-f]{6}$/i.test(a)&&(a="#"+a),{type:"color-token",mode:this.mode,color:a}}parseSizeGroup(t){var n,r=!1;if(this.gullet.consumeSpaces(),!t&&this.gullet.future().text!=="{"?n=this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size"):n=this.parseStringGroup("size",t),!n)return null;!t&&n.text.length===0&&(n.text="0pt",r=!0);var a=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(n.text);if(!a)throw new ir("Invalid size: '"+n.text+"'",n);var u={number:+(a[1]+a[2]),unit:a[3]};if(!XK(u))throw new ir("Invalid unit: '"+u.unit+"'",n);return{type:"size",mode:this.mode,value:u,isBlank:r}}parseUrlGroup(t){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);var n=this.parseStringGroup("url",t);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),n==null)return null;var r=n.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:r}}parseArgumentGroup(t,n){var r=this.gullet.scanArgument(t);if(r==null)return null;var a=this.mode;n&&this.switchMode(n),this.gullet.beginGroup();var u=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var f={type:"ordgroup",mode:this.mode,loc:r.loc,body:u};return n&&this.switchMode(a),f}parseGroup(t,n){var r=this.fetch(),a=r.text,u;if(a==="{"||a==="\\begingroup"){this.consume();var f=a==="{"?"}":"\\endgroup";this.gullet.beginGroup();var s=this.parseExpression(!1,f),v=this.fetch();this.expect(f),this.gullet.endGroup(),u={type:"ordgroup",mode:this.mode,loc:Wu.range(r,v),body:s,semisimple:a==="\\begingroup"||void 0}}else if(u=this.parseFunction(n,t)||this.parseSymbol(),u==null&&a[0]==="\\"&&!BQ.hasOwnProperty(a)){if(this.settings.throwOnError)throw new ir("Undefined control sequence: "+a,r);u=this.formatUnsupportedCmd(a),this.consume()}return u}formLigatures(t){for(var n=t.length-1,r=0;r<n;++r){var a=t[r],u=a.text;u==="-"&&t[r+1].text==="-"&&(r+1<n&&t[r+2].text==="-"?(t.splice(r,3,{type:"textord",mode:"text",loc:Wu.range(a,t[r+2]),text:"---"}),n-=2):(t.splice(r,2,{type:"textord",mode:"text",loc:Wu.range(a,t[r+1]),text:"--"}),n-=1)),(u==="'"||u==="`")&&t[r+1].text===u&&(t.splice(r,2,{type:"textord",mode:"text",loc:Wu.range(a,t[r+1]),text:u+u}),n-=1)}}parseSymbol(){var t=this.fetch(),n=t.text;if(/^\\verb[^a-zA-Z]/.test(n)){this.consume();var r=n.slice(5),a=r.charAt(0)==="*";if(a&&(r=r.slice(1)),r.length<2||r.charAt(0)!==r.slice(-1))throw new ir(`\\verb assertion failed --
                    please report what input caused this bug`);return r=r.slice(1,-1),{type:"verb",mode:"text",body:r,star:a}}SV.hasOwnProperty(n[0])&&!io[this.mode][n[0]]&&(this.settings.strict&&this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+n[0]+'" used in math mode',t),n=SV[n[0]]+n.slice(1));var u=Ywe.exec(n);u&&(n=n.substring(0,u.index),n==="i"?n="":n==="j"&&(n=""));var f;if(io[this.mode][n]){this.settings.strict&&this.mode==="math"&&XP.indexOf(n)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+n[0]+'" used in math mode',t);var s=io[this.mode][n].group,v=Wu.range(t),x;if(Vbe.hasOwnProperty(s)){var A=s;x={type:"atom",mode:this.mode,family:A,loc:v,text:n}}else x={type:s,mode:this.mode,loc:v,text:n};f=x}else if(n.charCodeAt(0)>=128)this.settings.strict&&(WK(n.charCodeAt(0))?this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+n[0]+'" used in math mode',t):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+n[0]+'"'+(" ("+n.charCodeAt(0)+")"),t)),f={type:"textord",mode:"text",loc:Wu.range(t),text:n};else return null;if(this.consume(),u)for(var C=0;C<u[0].length;C++){var P=u[0][C];if(!Z5[P])throw new ir("Unknown accent ' "+P+"'",t);var L=Z5[P][this.mode]||Z5[P].text;if(!L)throw new ir("Accent "+P+" unsupported in "+this.mode+" mode",t);f={type:"accent",mode:this.mode,loc:Wu.range(t),label:L,isStretchy:!1,isShifty:!0,base:f}}return f}};jQ.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var QL=function(t,n){if(!(typeof t=="string"||t instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var r=new jQ(t,n);delete r.gullet.macros.current["\\df@tag"];var a=r.parse();if(delete r.gullet.macros.current["\\current@color"],delete r.gullet.macros.current["\\color"],r.gullet.macros.get("\\df@tag")){if(!n.displayMode)throw new ir("\\tag works only in display equations");a=[{type:"tag",mode:"text",body:a,tag:r.subparse([new Ic("\\df@tag")])}]}return a},JL=function(t,n,r){n.textContent="";var a=hk(t,r).toNode();n.appendChild(a)};typeof document<"u"&&document.compatMode!=="CSS1Compat"&&(typeof console<"u"&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),JL=function(){throw new ir("KaTeX doesn't work in quirks mode.")});var VQ=function(t,n){var r=hk(t,n).toMarkup();return r},$Q=function(t,n){var r=new LL(n);return QL(t,r)},HQ=function(t,n,r){if(r.throwOnError||!(t instanceof ir))throw t;var a=Xt.makeSpan(["katex-error"],[new pd(n)]);return a.setAttribute("title",t.toString()),a.setAttribute("style","color:"+r.errorColor),a},hk=function(t,n){var r=new LL(n);try{var a=QL(t,r);return dwe(a,t,r)}catch(u){return HQ(u,t,r)}},GQ=function(t,n){var r=new LL(n);try{var a=QL(t,r);return hwe(a,t,r)}catch(u){return HQ(u,t,r)}},qQ="0.16.27",WQ={Span:OT,Anchor:zL,SymbolNode:pd,SvgNode:_p,PathNode:h0,LineNode:ZP},t8={version:qQ,render:JL,renderToString:VQ,ParseError:ir,SETTINGS_SCHEMA:s2,__parse:$Q,__renderToDomTree:hk,__renderToHTMLTree:GQ,__setFontMetrics:ZK,__defineSymbol:se,__defineFunction:Nr,__defineMacro:Ne,__domTree:WQ};const UNe=Object.freeze(Object.defineProperty({__proto__:null,ParseError:ir,SETTINGS_SCHEMA:s2,__defineFunction:Nr,__defineMacro:Ne,__defineSymbol:se,__domTree:WQ,__parse:$Q,__renderToDomTree:hk,__renderToHTMLTree:GQ,__setFontMetrics:ZK,default:t8,get render(){return JL},renderToString:VQ,version:qQ},Symbol.toStringTag,{value:"Module"})),t2e={},n2e=[];function n8(e){const t=e||t2e;return function(n,r){ox(n,"element",function(a,u){const f=Array.isArray(a.properties.className)?a.properties.className:n2e,s=f.includes("language-math"),v=f.includes("math-display"),x=f.includes("math-inline");let A=v;if(!s&&!v&&!x)return;let C=u[u.length-1],P=a;if(a.tagName==="code"&&s&&C&&C.type==="element"&&C.tagName==="pre"&&(P=C,C=u[u.length-2],A=!0),!C)return;const L=tbe(P,{whitespace:"pre"});let F;try{F=t8.renderToString(L,{...t,displayMode:A,throwOnError:!0})}catch(q){const G=q,$=G.name.toLowerCase();r.message("Could not render math with KaTeX",{ancestors:[...u,a],cause:G,place:a.position,ruleId:$,source:"rehype-katex"});try{F=t8.renderToString(L,{...t,displayMode:A,strict:"ignore",throwOnError:!1})}catch{F=[{type:"element",tagName:"span",properties:{className:["katex-error"],style:"color:"+(t.errorColor||"#cc0000"),title:String(q)},children:[{type:"text",value:L}]}]}}typeof F=="string"&&(F=Wxe(F).children);const U=C.children.indexOf(P);return C.children.splice(U,1,...F),JA})}}const ZQ=-1,fk=0,o2=1,sC=2,eD=3,tD=4,nD=5,rD=6,XQ=7,YQ=8,AV=typeof self=="object"?self:globalThis,r2e=(e,t)=>{const n=(a,u)=>(e.set(u,a),a),r=a=>{if(e.has(a))return e.get(a);const[u,f]=t[a];switch(u){case fk:case ZQ:return n(f,a);case o2:{const s=n([],a);for(const v of f)s.push(r(v));return s}case sC:{const s=n({},a);for(const[v,x]of f)s[r(v)]=r(x);return s}case eD:return n(new Date(f),a);case tD:{const{source:s,flags:v}=f;return n(new RegExp(s,v),a)}case nD:{const s=n(new Map,a);for(const[v,x]of f)s.set(r(v),r(x));return s}case rD:{const s=n(new Set,a);for(const v of f)s.add(r(v));return s}case XQ:{const{name:s,message:v}=f;return n(new AV[s](v),a)}case YQ:return n(BigInt(f),a);case"BigInt":return n(Object(BigInt(f)),a);case"ArrayBuffer":return n(new Uint8Array(f).buffer,f);case"DataView":{const{buffer:s}=new Uint8Array(f);return n(new DataView(s),f)}}return n(new AV[u](f),a)};return r},CV=e=>r2e(new Map,e)(0),A1="",{toString:i2e}={},{keys:s2e}=Object,Ew=e=>{const t=typeof e;if(t!=="object"||!e)return[fk,t];const n=i2e.call(e).slice(8,-1);switch(n){case"Array":return[o2,A1];case"Object":return[sC,A1];case"Date":return[eD,A1];case"RegExp":return[tD,A1];case"Map":return[nD,A1];case"Set":return[rD,A1];case"DataView":return[o2,n]}return n.includes("Array")?[o2,n]:n.includes("Error")?[XQ,n]:[sC,n]},P3=([e,t])=>e===fk&&(t==="function"||t==="symbol"),a2e=(e,t,n,r)=>{const a=(f,s)=>{const v=r.push(f)-1;return n.set(s,v),v},u=f=>{if(n.has(f))return n.get(f);let[s,v]=Ew(f);switch(s){case fk:{let A=f;switch(v){case"bigint":s=YQ,A=f.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+v);A=null;break;case"undefined":return a([ZQ],f)}return a([s,A],f)}case o2:{if(v){let P=f;return v==="DataView"?P=new Uint8Array(f.buffer):v==="ArrayBuffer"&&(P=new Uint8Array(f)),a([v,[...P]],f)}const A=[],C=a([s,A],f);for(const P of f)A.push(u(P));return C}case sC:{if(v)switch(v){case"BigInt":return a([v,f.toString()],f);case"Boolean":case"Number":case"String":return a([v,f.valueOf()],f)}if(t&&"toJSON"in f)return u(f.toJSON());const A=[],C=a([s,A],f);for(const P of s2e(f))(e||!P3(Ew(f[P])))&&A.push([u(P),u(f[P])]);return C}case eD:return a([s,f.toISOString()],f);case tD:{const{source:A,flags:C}=f;return a([s,{source:A,flags:C}],f)}case nD:{const A=[],C=a([s,A],f);for(const[P,L]of f)(e||!(P3(Ew(P))||P3(Ew(L))))&&A.push([u(P),u(L)]);return C}case rD:{const A=[],C=a([s,A],f);for(const P of f)(e||!P3(Ew(P)))&&A.push(u(P));return C}}const{message:x}=f;return a([s,{name:v,message:x}],f)};return u},kV=(e,{json:t,lossy:n}={})=>{const r=[];return a2e(!(t||n),!!t,new Map,r)(e),r},h_=typeof structuredClone=="function"?(e,t)=>t&&("json"in t||"lossy"in t)?CV(kV(e,t)):structuredClone(e):(e,t)=>CV(kV(e,t));let DT=class{constructor(t,n,r){this.normal=n,this.property=t,r&&(this.space=r)}};DT.prototype.normal={};DT.prototype.property={};DT.prototype.space=void 0;function KQ(e,t){const n={},r={};for(const a of e)Object.assign(n,a.property),Object.assign(r,a.normal);return new DT(n,r,t)}function J2(e){return e.toLowerCase()}let ic=class{constructor(t,n){this.attribute=n,this.property=t}};ic.prototype.attribute="";ic.prototype.booleanish=!1;ic.prototype.boolean=!1;ic.prototype.commaOrSpaceSeparated=!1;ic.prototype.commaSeparated=!1;ic.prototype.defined=!1;ic.prototype.mustUseProperty=!1;ic.prototype.number=!1;ic.prototype.overloadedBoolean=!1;ic.prototype.property="";ic.prototype.spaceSeparated=!1;ic.prototype.space=void 0;let o2e=0;const Os=k_(),tl=k_(),r8=k_(),cr=k_(),eo=k_(),sv=k_(),vc=k_();function k_(){return 2**++o2e}const i8=Object.freeze(Object.defineProperty({__proto__:null,boolean:Os,booleanish:tl,commaOrSpaceSeparated:vc,commaSeparated:sv,number:cr,overloadedBoolean:r8,spaceSeparated:eo},Symbol.toStringTag,{value:"Module"})),X5=Object.keys(i8);let iD=class extends ic{constructor(t,n,r,a){let u=-1;if(super(t,n),IV(this,"space",a),typeof r=="number")for(;++u<X5.length;){const f=X5[u];IV(this,X5[u],(r&i8[f])===i8[f])}}};iD.prototype.defined=!0;function IV(e,t,n){n&&(e[t]=n)}function dx(e){const t={},n={};for(const[r,a]of Object.entries(e.properties)){const u=new iD(r,e.transform(e.attributes||{},r),a,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(u.mustUseProperty=!0),t[r]=u,n[J2(r)]=r,n[J2(u.attribute)]=r}return new DT(t,n,e.space)}const QQ=dx({properties:{ariaActiveDescendant:null,ariaAtomic:tl,ariaAutoComplete:null,ariaBusy:tl,ariaChecked:tl,ariaColCount:cr,ariaColIndex:cr,ariaColSpan:cr,ariaControls:eo,ariaCurrent:null,ariaDescribedBy:eo,ariaDetails:null,ariaDisabled:tl,ariaDropEffect:eo,ariaErrorMessage:null,ariaExpanded:tl,ariaFlowTo:eo,ariaGrabbed:tl,ariaHasPopup:null,ariaHidden:tl,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:eo,ariaLevel:cr,ariaLive:null,ariaModal:tl,ariaMultiLine:tl,ariaMultiSelectable:tl,ariaOrientation:null,ariaOwns:eo,ariaPlaceholder:null,ariaPosInSet:cr,ariaPressed:tl,ariaReadOnly:tl,ariaRelevant:null,ariaRequired:tl,ariaRoleDescription:eo,ariaRowCount:cr,ariaRowIndex:cr,ariaRowSpan:cr,ariaSelected:tl,ariaSetSize:cr,ariaSort:null,ariaValueMax:cr,ariaValueMin:cr,ariaValueNow:cr,ariaValueText:null,role:null},transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function JQ(e,t){return t in e?e[t]:t}function eJ(e,t){return JQ(e,t.toLowerCase())}const l2e=dx({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:sv,acceptCharset:eo,accessKey:eo,action:null,allow:null,allowFullScreen:Os,allowPaymentRequest:Os,allowUserMedia:Os,alt:null,as:null,async:Os,autoCapitalize:null,autoComplete:eo,autoFocus:Os,autoPlay:Os,blocking:eo,capture:null,charSet:null,checked:Os,cite:null,className:eo,cols:cr,colSpan:null,content:null,contentEditable:tl,controls:Os,controlsList:eo,coords:cr|sv,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Os,defer:Os,dir:null,dirName:null,disabled:Os,download:r8,draggable:tl,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Os,formTarget:null,headers:eo,height:cr,hidden:r8,high:cr,href:null,hrefLang:null,htmlFor:eo,httpEquiv:eo,id:null,imageSizes:null,imageSrcSet:null,inert:Os,inputMode:null,integrity:null,is:null,isMap:Os,itemId:null,itemProp:eo,itemRef:eo,itemScope:Os,itemType:eo,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Os,low:cr,manifest:null,max:null,maxLength:cr,media:null,method:null,min:null,minLength:cr,multiple:Os,muted:Os,name:null,nonce:null,noModule:Os,noValidate:Os,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Os,optimum:cr,pattern:null,ping:eo,placeholder:null,playsInline:Os,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Os,referrerPolicy:null,rel:eo,required:Os,reversed:Os,rows:cr,rowSpan:cr,sandbox:eo,scope:null,scoped:Os,seamless:Os,selected:Os,shadowRootClonable:Os,shadowRootDelegatesFocus:Os,shadowRootMode:null,shape:null,size:cr,sizes:null,slot:null,span:cr,spellCheck:tl,src:null,srcDoc:null,srcLang:null,srcSet:null,start:cr,step:null,style:null,tabIndex:cr,target:null,title:null,translate:null,type:null,typeMustMatch:Os,useMap:null,value:tl,width:cr,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:eo,axis:null,background:null,bgColor:null,border:cr,borderColor:null,bottomMargin:cr,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Os,declare:Os,event:null,face:null,frame:null,frameBorder:null,hSpace:cr,leftMargin:cr,link:null,longDesc:null,lowSrc:null,marginHeight:cr,marginWidth:cr,noResize:Os,noHref:Os,noShade:Os,noWrap:Os,object:null,profile:null,prompt:null,rev:null,rightMargin:cr,rules:null,scheme:null,scrolling:tl,standby:null,summary:null,text:null,topMargin:cr,valueType:null,version:null,vAlign:null,vLink:null,vSpace:cr,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Os,disableRemotePlayback:Os,prefix:null,property:null,results:cr,security:null,unselectable:null},space:"html",transform:eJ}),u2e=dx({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:vc,accentHeight:cr,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:cr,amplitude:cr,arabicForm:null,ascent:cr,attributeName:null,attributeType:null,azimuth:cr,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:cr,by:null,calcMode:null,capHeight:cr,className:eo,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:cr,diffuseConstant:cr,direction:null,display:null,dur:null,divisor:cr,dominantBaseline:null,download:Os,dx:null,dy:null,edgeMode:null,editable:null,elevation:cr,enableBackground:null,end:null,event:null,exponent:cr,externalResourcesRequired:null,fill:null,fillOpacity:cr,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:sv,g2:sv,glyphName:sv,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:cr,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:cr,horizOriginX:cr,horizOriginY:cr,id:null,ideographic:cr,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:cr,k:cr,k1:cr,k2:cr,k3:cr,k4:cr,kernelMatrix:vc,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:cr,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:cr,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:cr,overlineThickness:cr,paintOrder:null,panose1:null,path:null,pathLength:cr,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:eo,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:cr,pointsAtY:cr,pointsAtZ:cr,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:vc,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:vc,rev:vc,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:vc,requiredFeatures:vc,requiredFonts:vc,requiredFormats:vc,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:cr,specularExponent:cr,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:cr,strikethroughThickness:cr,string:null,stroke:null,strokeDashArray:vc,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:cr,strokeOpacity:cr,strokeWidth:null,style:null,surfaceScale:cr,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:vc,tabIndex:cr,tableValues:null,target:null,targetX:cr,targetY:cr,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:vc,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:cr,underlineThickness:cr,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:cr,values:null,vAlphabetic:cr,vMathematical:cr,vectorEffect:null,vHanging:cr,vIdeographic:cr,version:null,vertAdvY:cr,vertOriginX:cr,vertOriginY:cr,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:cr,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:JQ}),tJ=dx({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()}}),nJ=dx({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:eJ}),rJ=dx({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()}}),c2e=/[A-Z]/g,RV=/-[a-z]/g,d2e=/^data[-\w.:]+$/i;function iJ(e,t){const n=J2(t);let r=t,a=ic;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&d2e.test(t)){if(t.charAt(4)==="-"){const u=t.slice(5).replace(RV,f2e);r="data"+u.charAt(0).toUpperCase()+u.slice(1)}else{const u=t.slice(4);if(!RV.test(u)){let f=u.replace(c2e,h2e);f.charAt(0)!=="-"&&(f="-"+f),t="data"+f}}a=iD}return new a(r,t)}function h2e(e){return"-"+e.toLowerCase()}function f2e(e){return e.charAt(1).toUpperCase()}const sD=KQ([QQ,l2e,tJ,nJ,rJ],"html"),aD=KQ([QQ,u2e,tJ,nJ,rJ],"svg"),MV=/[#.]/g;function p2e(e,t){const n=e||"",r={};let a=0,u,f;for(;a<n.length;){MV.lastIndex=a;const s=MV.exec(n),v=n.slice(a,s?s.index:n.length);v&&(u?u==="#"?r.id=v:Array.isArray(r.className)?r.className.push(v):r.className=[v]:f=v,a+=v.length),s&&(u=s[0],a++)}return{type:"element",tagName:f||t||"div",properties:r,children:[]}}function sJ(e,t,n){const r=n?y2e(n):void 0;function a(u,f,...s){let v;if(u==null){v={type:"root",children:[]};const x=f;s.unshift(x)}else{v=p2e(u,t);const x=v.tagName.toLowerCase(),A=r?r.get(x):void 0;if(v.tagName=A||x,m2e(f))s.unshift(f);else for(const[C,P]of Object.entries(f))g2e(e,v.properties,C,P)}for(const x of s)s8(v.children,x);return v.type==="element"&&v.tagName==="template"&&(v.content={type:"root",children:v.children},v.children=[]),v}return a}function m2e(e){if(e===null||typeof e!="object"||Array.isArray(e))return!0;if(typeof e.type!="string")return!1;const t=e,n=Object.keys(e);for(const r of n){const a=t[r];if(a&&typeof a=="object"){if(!Array.isArray(a))return!0;const u=a;for(const f of u)if(typeof f!="number"&&typeof f!="string")return!0}}return!!("children"in e&&Array.isArray(e.children))}function g2e(e,t,n,r){const a=iJ(e,n);let u;if(r!=null){if(typeof r=="number"){if(Number.isNaN(r))return;u=r}else typeof r=="boolean"?u=r:typeof r=="string"?a.spaceSeparated?u=vA(r):a.commaSeparated?u=xA(r):a.commaOrSpaceSeparated?u=vA(xA(r).join(" ")):u=PV(a,a.property,r):Array.isArray(r)?u=[...r]:u=a.property==="style"?_2e(r):String(r);if(Array.isArray(u)){const f=[];for(const s of u)f.push(PV(a,a.property,s));u=f}a.property==="className"&&Array.isArray(t.className)&&(u=t.className.concat(u)),t[a.property]=u}}function s8(e,t){if(t!=null)if(typeof t=="number"||typeof t=="string")e.push({type:"text",value:String(t)});else if(Array.isArray(t))for(const n of t)s8(e,n);else if(typeof t=="object"&&"type"in t)t.type==="root"?s8(e,t.children):e.push(t);else throw new Error("Expected node, nodes, or string, got `"+t+"`")}function PV(e,t,n){if(typeof n=="string"){if(e.number&&n&&!Number.isNaN(Number(n)))return Number(n);if((e.boolean||e.overloadedBoolean)&&(n===""||J2(n)===J2(t)))return!0}return n}function _2e(e){const t=[];for(const[n,r]of Object.entries(e))t.push([n,r].join(": "));return t.join("; ")}function y2e(e){const t=new Map;for(const n of e)t.set(n.toLowerCase(),n);return t}const v2e=["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","solidColor","textArea","textPath"],x2e=sJ(sD,"div"),b2e=sJ(aD,"g",v2e);function w2e(e){const t=String(e),n=[];return{toOffset:a,toPoint:r};function r(u){if(typeof u=="number"&&u>-1&&u<=t.length){let f=0;for(;;){let s=n[f];if(s===void 0){const v=OV(t,n[f-1]);s=v===-1?t.length+1:v+1,n[f]=s}if(s>u)return{line:f+1,column:u-(f>0?n[f-1]:0)+1,offset:u};f++}}}function a(u){if(u&&typeof u.line=="number"&&typeof u.column=="number"&&!Number.isNaN(u.line)&&!Number.isNaN(u.column)){for(;n.length<u.line;){const s=n[n.length-1],v=OV(t,s),x=v===-1?t.length+1:v+1;if(s===x)break;n.push(x)}const f=(u.line>1?n[u.line-2]:0)+u.column-1;if(f<n[u.line-1])return f}}}function OV(e,t){const n=e.indexOf("\r",t),r=e.indexOf(`
`,t);return r===-1?n:n===-1||n+1===r?r:n<r?n:r}const aJ={}.hasOwnProperty,T2e=Object.prototype;function E2e(e,t){const n=t||{};return oD({file:n.file||void 0,location:!1,schema:n.space==="svg"?aD:sD,verbose:n.verbose||!1},e)}function oD(e,t){let n;switch(t.nodeName){case"#comment":{const r=t;return n={type:"comment",value:r.data},z4(e,r,n),n}case"#document":case"#document-fragment":{const r=t,a="mode"in r?r.mode==="quirks"||r.mode==="limited-quirks":!1;if(n={type:"root",children:oJ(e,t.childNodes),data:{quirksMode:a}},e.file&&e.location){const u=String(e.file),f=w2e(u),s=f.toPoint(0),v=f.toPoint(u.length);n.position={start:s,end:v}}return n}case"#documentType":{const r=t;return n={type:"doctype"},z4(e,r,n),n}case"#text":{const r=t;return n={type:"text",value:r.value},z4(e,r,n),n}default:return n=S2e(e,t),n}}function oJ(e,t){let n=-1;const r=[];for(;++n<t.length;){const a=oD(e,t[n]);r.push(a)}return r}function S2e(e,t){const n=e.schema;e.schema=t.namespaceURI===Kh.svg?aD:sD;let r=-1;const a={};for(;++r<t.attrs.length;){const s=t.attrs[r],v=(s.prefix?s.prefix+":":"")+s.name;aJ.call(T2e,v)||(a[v]=s.value)}const f=(e.schema.space==="svg"?b2e:x2e)(t.tagName,a,oJ(e,t.childNodes));if(z4(e,t,f),f.tagName==="template"){const s=t,v=s.sourceCodeLocation,x=v&&v.startTag&&W1(v.startTag),A=v&&v.endTag&&W1(v.endTag),C=oD(e,s.content);x&&A&&e.file&&(C.position={start:x.end,end:A.start}),f.content=C}return e.schema=n,f}function z4(e,t,n){if("sourceCodeLocation"in t&&t.sourceCodeLocation&&e.file){const r=A2e(e,n,t.sourceCodeLocation);r&&(e.location=!0,n.position=r)}}function A2e(e,t,n){const r=W1(n);if(t.type==="element"){const a=t.children[t.children.length-1];if(r&&!n.endTag&&a&&a.position&&a.position.end&&(r.end=Object.assign({},a.position.end)),e.verbose){const u={};let f;if(n.attrs)for(f in n.attrs)aJ.call(n.attrs,f)&&(u[iJ(e.schema,f).property]=W1(n.attrs[f]));n.startTag;const s=W1(n.startTag),v=n.endTag?W1(n.endTag):void 0,x={opening:s};v&&(x.closing=v),x.properties=u,t.data={position:x}}}return r}function W1(e){const t=LV({line:e.startLine,column:e.startCol,offset:e.startOffset}),n=LV({line:e.endLine,column:e.endCol,offset:e.endOffset});return t||n?{start:t,end:n}:void 0}function LV(e){return e.line&&e.column?e:void 0}let NT=class{constructor(t,n,r){this.normal=n,this.property=t,r&&(this.space=r)}};NT.prototype.normal={};NT.prototype.property={};NT.prototype.space=void 0;function lJ(e,t){const n={},r={};for(const a of e)Object.assign(n,a.property),Object.assign(r,a.normal);return new NT(n,r,t)}function a8(e){return e.toLowerCase()}let sc=class{constructor(t,n){this.attribute=n,this.property=t}};sc.prototype.attribute="";sc.prototype.booleanish=!1;sc.prototype.boolean=!1;sc.prototype.commaOrSpaceSeparated=!1;sc.prototype.commaSeparated=!1;sc.prototype.defined=!1;sc.prototype.mustUseProperty=!1;sc.prototype.number=!1;sc.prototype.overloadedBoolean=!1;sc.prototype.property="";sc.prototype.spaceSeparated=!1;sc.prototype.space=void 0;let C2e=0;const Ls=I_(),nl=I_(),o8=I_(),dr=I_(),to=I_(),av=I_(),xc=I_();function I_(){return 2**++C2e}const l8=Object.freeze(Object.defineProperty({__proto__:null,boolean:Ls,booleanish:nl,commaOrSpaceSeparated:xc,commaSeparated:av,number:dr,overloadedBoolean:o8,spaceSeparated:to},Symbol.toStringTag,{value:"Module"})),Y5=Object.keys(l8);let lD=class extends sc{constructor(t,n,r,a){let u=-1;if(super(t,n),DV(this,"space",a),typeof r=="number")for(;++u<Y5.length;){const f=Y5[u];DV(this,Y5[u],(r&l8[f])===l8[f])}}};lD.prototype.defined=!0;function DV(e,t,n){n&&(e[t]=n)}function hx(e){const t={},n={};for(const[r,a]of Object.entries(e.properties)){const u=new lD(r,e.transform(e.attributes||{},r),a,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(u.mustUseProperty=!0),t[r]=u,n[a8(r)]=r,n[a8(u.attribute)]=r}return new NT(t,n,e.space)}const uJ=hx({properties:{ariaActiveDescendant:null,ariaAtomic:nl,ariaAutoComplete:null,ariaBusy:nl,ariaChecked:nl,ariaColCount:dr,ariaColIndex:dr,ariaColSpan:dr,ariaControls:to,ariaCurrent:null,ariaDescribedBy:to,ariaDetails:null,ariaDisabled:nl,ariaDropEffect:to,ariaErrorMessage:null,ariaExpanded:nl,ariaFlowTo:to,ariaGrabbed:nl,ariaHasPopup:null,ariaHidden:nl,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:to,ariaLevel:dr,ariaLive:null,ariaModal:nl,ariaMultiLine:nl,ariaMultiSelectable:nl,ariaOrientation:null,ariaOwns:to,ariaPlaceholder:null,ariaPosInSet:dr,ariaPressed:nl,ariaReadOnly:nl,ariaRelevant:null,ariaRequired:nl,ariaRoleDescription:to,ariaRowCount:dr,ariaRowIndex:dr,ariaRowSpan:dr,ariaSelected:nl,ariaSetSize:dr,ariaSort:null,ariaValueMax:dr,ariaValueMin:dr,ariaValueNow:dr,ariaValueText:null,role:null},transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function cJ(e,t){return t in e?e[t]:t}function dJ(e,t){return cJ(e,t.toLowerCase())}const k2e=hx({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:av,acceptCharset:to,accessKey:to,action:null,allow:null,allowFullScreen:Ls,allowPaymentRequest:Ls,allowUserMedia:Ls,alt:null,as:null,async:Ls,autoCapitalize:null,autoComplete:to,autoFocus:Ls,autoPlay:Ls,blocking:to,capture:null,charSet:null,checked:Ls,cite:null,className:to,cols:dr,colSpan:null,content:null,contentEditable:nl,controls:Ls,controlsList:to,coords:dr|av,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Ls,defer:Ls,dir:null,dirName:null,disabled:Ls,download:o8,draggable:nl,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Ls,formTarget:null,headers:to,height:dr,hidden:o8,high:dr,href:null,hrefLang:null,htmlFor:to,httpEquiv:to,id:null,imageSizes:null,imageSrcSet:null,inert:Ls,inputMode:null,integrity:null,is:null,isMap:Ls,itemId:null,itemProp:to,itemRef:to,itemScope:Ls,itemType:to,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Ls,low:dr,manifest:null,max:null,maxLength:dr,media:null,method:null,min:null,minLength:dr,multiple:Ls,muted:Ls,name:null,nonce:null,noModule:Ls,noValidate:Ls,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Ls,optimum:dr,pattern:null,ping:to,placeholder:null,playsInline:Ls,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Ls,referrerPolicy:null,rel:to,required:Ls,reversed:Ls,rows:dr,rowSpan:dr,sandbox:to,scope:null,scoped:Ls,seamless:Ls,selected:Ls,shadowRootClonable:Ls,shadowRootDelegatesFocus:Ls,shadowRootMode:null,shape:null,size:dr,sizes:null,slot:null,span:dr,spellCheck:nl,src:null,srcDoc:null,srcLang:null,srcSet:null,start:dr,step:null,style:null,tabIndex:dr,target:null,title:null,translate:null,type:null,typeMustMatch:Ls,useMap:null,value:nl,width:dr,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:to,axis:null,background:null,bgColor:null,border:dr,borderColor:null,bottomMargin:dr,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Ls,declare:Ls,event:null,face:null,frame:null,frameBorder:null,hSpace:dr,leftMargin:dr,link:null,longDesc:null,lowSrc:null,marginHeight:dr,marginWidth:dr,noResize:Ls,noHref:Ls,noShade:Ls,noWrap:Ls,object:null,profile:null,prompt:null,rev:null,rightMargin:dr,rules:null,scheme:null,scrolling:nl,standby:null,summary:null,text:null,topMargin:dr,valueType:null,version:null,vAlign:null,vLink:null,vSpace:dr,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Ls,disableRemotePlayback:Ls,prefix:null,property:null,results:dr,security:null,unselectable:null},space:"html",transform:dJ}),I2e=hx({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:xc,accentHeight:dr,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:dr,amplitude:dr,arabicForm:null,ascent:dr,attributeName:null,attributeType:null,azimuth:dr,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:dr,by:null,calcMode:null,capHeight:dr,className:to,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:dr,diffuseConstant:dr,direction:null,display:null,dur:null,divisor:dr,dominantBaseline:null,download:Ls,dx:null,dy:null,edgeMode:null,editable:null,elevation:dr,enableBackground:null,end:null,event:null,exponent:dr,externalResourcesRequired:null,fill:null,fillOpacity:dr,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:av,g2:av,glyphName:av,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:dr,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:dr,horizOriginX:dr,horizOriginY:dr,id:null,ideographic:dr,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:dr,k:dr,k1:dr,k2:dr,k3:dr,k4:dr,kernelMatrix:xc,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:dr,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:dr,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:dr,overlineThickness:dr,paintOrder:null,panose1:null,path:null,pathLength:dr,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:to,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:dr,pointsAtY:dr,pointsAtZ:dr,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:xc,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:xc,rev:xc,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:xc,requiredFeatures:xc,requiredFonts:xc,requiredFormats:xc,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:dr,specularExponent:dr,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:dr,strikethroughThickness:dr,string:null,stroke:null,strokeDashArray:xc,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:dr,strokeOpacity:dr,strokeWidth:null,style:null,surfaceScale:dr,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:xc,tabIndex:dr,tableValues:null,target:null,targetX:dr,targetY:dr,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:xc,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:dr,underlineThickness:dr,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:dr,values:null,vAlphabetic:dr,vMathematical:dr,vectorEffect:null,vHanging:dr,vIdeographic:dr,version:null,vertAdvY:dr,vertOriginX:dr,vertOriginY:dr,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:dr,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:cJ}),hJ=hx({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()}}),fJ=hx({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:dJ}),pJ=hx({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()}}),R2e=/[A-Z]/g,NV=/-[a-z]/g,M2e=/^data[-\w.:]+$/i;function P2e(e,t){const n=a8(t);let r=t,a=sc;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&M2e.test(t)){if(t.charAt(4)==="-"){const u=t.slice(5).replace(NV,L2e);r="data"+u.charAt(0).toUpperCase()+u.slice(1)}else{const u=t.slice(4);if(!NV.test(u)){let f=u.replace(R2e,O2e);f.charAt(0)!=="-"&&(f="-"+f),t="data"+f}}a=lD}return new a(r,t)}function O2e(e){return"-"+e.toLowerCase()}function L2e(e){return e.charAt(1).toUpperCase()}const D2e=lJ([uJ,k2e,hJ,fJ,pJ],"html"),mJ=lJ([uJ,I2e,hJ,fJ,pJ],"svg"),zV={}.hasOwnProperty;function gJ(e,t){const n=t||{};function r(a,...u){let f=r.invalid;const s=r.handlers;if(a&&zV.call(a,e)){const v=String(a[e]);f=zV.call(s,v)?s[v]:r.unknown}if(f)return f.call(this,a,...u)}return r.handlers=n.handlers||{},r.invalid=n.invalid,r.unknown=n.unknown,r}const N2e={},z2e={}.hasOwnProperty,_J=gJ("type",{handlers:{root:B2e,element:H2e,text:V2e,comment:$2e,doctype:U2e}});function F2e(e,t){const r=(t||N2e).space;return _J(e,r==="svg"?mJ:D2e)}function B2e(e,t){const n={nodeName:"#document",mode:(e.data||{}).quirksMode?"quirks":"no-quirks",childNodes:[]};return n.childNodes=uD(e.children,n,t),fx(e,n),n}function j2e(e,t){const n={nodeName:"#document-fragment",childNodes:[]};return n.childNodes=uD(e.children,n,t),fx(e,n),n}function U2e(e){const t={nodeName:"#documentType",name:"html",publicId:"",systemId:"",parentNode:null};return fx(e,t),t}function V2e(e){const t={nodeName:"#text",value:e.value,parentNode:null};return fx(e,t),t}function $2e(e){const t={nodeName:"#comment",data:e.value,parentNode:null};return fx(e,t),t}function H2e(e,t){const n=t;let r=n;e.type==="element"&&e.tagName.toLowerCase()==="svg"&&n.space==="html"&&(r=mJ);const a=[];let u;if(e.properties){for(u in e.properties)if(u!=="children"&&z2e.call(e.properties,u)){const v=G2e(r,u,e.properties[u]);v&&a.push(v)}}const f=r.space,s={nodeName:e.tagName,tagName:e.tagName,attrs:a,namespaceURI:Kh[f],childNodes:[],parentNode:null};return s.childNodes=uD(e.children,s,r),fx(e,s),e.tagName==="template"&&e.content&&(s.content=j2e(e.content,r)),s}function G2e(e,t,n){const r=P2e(e,t);if(n===!1||n===null||n===void 0||typeof n=="number"&&Number.isNaN(n)||!n&&r.boolean)return;Array.isArray(n)&&(n=r.commaSeparated?cZ(n):uZ(n));const a={name:r.attribute,value:n===!0?"":String(n)};if(r.space&&r.space!=="html"&&r.space!=="svg"){const u=a.name.indexOf(":");u<0?a.prefix="":(a.name=a.name.slice(u+1),a.prefix=r.attribute.slice(0,u)),a.namespace=Kh[r.space]}return a}function uD(e,t,n){let r=-1;const a=[];if(e)for(;++r<e.length;){const u=_J(e[r],n);u.parentNode=t,a.push(u)}return a}function fx(e,t){const n=e.position;n&&n.start&&n.end&&(n.start.offset,n.end.offset,t.sourceCodeLocation={startLine:n.start.line,startCol:n.start.column,startOffset:n.start.offset,endLine:n.end.line,endCol:n.end.column,endOffset:n.end.offset})}const q2e=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","keygen","link","meta","param","source","track","wbr"],W2e=new Set([65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111]),_o="";var Ge;(function(e){e[e.EOF=-1]="EOF",e[e.NULL=0]="NULL",e[e.TABULATION=9]="TABULATION",e[e.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",e[e.LINE_FEED=10]="LINE_FEED",e[e.FORM_FEED=12]="FORM_FEED",e[e.SPACE=32]="SPACE",e[e.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",e[e.QUOTATION_MARK=34]="QUOTATION_MARK",e[e.AMPERSAND=38]="AMPERSAND",e[e.APOSTROPHE=39]="APOSTROPHE",e[e.HYPHEN_MINUS=45]="HYPHEN_MINUS",e[e.SOLIDUS=47]="SOLIDUS",e[e.DIGIT_0=48]="DIGIT_0",e[e.DIGIT_9=57]="DIGIT_9",e[e.SEMICOLON=59]="SEMICOLON",e[e.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",e[e.EQUALS_SIGN=61]="EQUALS_SIGN",e[e.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",e[e.QUESTION_MARK=63]="QUESTION_MARK",e[e.LATIN_CAPITAL_A=65]="LATIN_CAPITAL_A",e[e.LATIN_CAPITAL_Z=90]="LATIN_CAPITAL_Z",e[e.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",e[e.GRAVE_ACCENT=96]="GRAVE_ACCENT",e[e.LATIN_SMALL_A=97]="LATIN_SMALL_A",e[e.LATIN_SMALL_Z=122]="LATIN_SMALL_Z"})(Ge||(Ge={}));const Vu={DASH_DASH:"--",CDATA_START:"[CDATA[",DOCTYPE:"doctype",SCRIPT:"script",PUBLIC:"public",SYSTEM:"system"};function yJ(e){return e>=55296&&e<=57343}function Z2e(e){return e>=56320&&e<=57343}function X2e(e,t){return(e-55296)*1024+9216+t}function vJ(e){return e!==32&&e!==10&&e!==13&&e!==9&&e!==12&&e>=1&&e<=31||e>=127&&e<=159}function xJ(e){return e>=64976&&e<=65007||W2e.has(e)}var hn;(function(e){e.controlCharacterInInputStream="control-character-in-input-stream",e.noncharacterInInputStream="noncharacter-in-input-stream",e.surrogateInInputStream="surrogate-in-input-stream",e.nonVoidHtmlElementStartTagWithTrailingSolidus="non-void-html-element-start-tag-with-trailing-solidus",e.endTagWithAttributes="end-tag-with-attributes",e.endTagWithTrailingSolidus="end-tag-with-trailing-solidus",e.unexpectedSolidusInTag="unexpected-solidus-in-tag",e.unexpectedNullCharacter="unexpected-null-character",e.unexpectedQuestionMarkInsteadOfTagName="unexpected-question-mark-instead-of-tag-name",e.invalidFirstCharacterOfTagName="invalid-first-character-of-tag-name",e.unexpectedEqualsSignBeforeAttributeName="unexpected-equals-sign-before-attribute-name",e.missingEndTagName="missing-end-tag-name",e.unexpectedCharacterInAttributeName="unexpected-character-in-attribute-name",e.unknownNamedCharacterReference="unknown-named-character-reference",e.missingSemicolonAfterCharacterReference="missing-semicolon-after-character-reference",e.unexpectedCharacterAfterDoctypeSystemIdentifier="unexpected-character-after-doctype-system-identifier",e.unexpectedCharacterInUnquotedAttributeValue="unexpected-character-in-unquoted-attribute-value",e.eofBeforeTagName="eof-before-tag-name",e.eofInTag="eof-in-tag",e.missingAttributeValue="missing-attribute-value",e.missingWhitespaceBetweenAttributes="missing-whitespace-between-attributes",e.missingWhitespaceAfterDoctypePublicKeyword="missing-whitespace-after-doctype-public-keyword",e.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers="missing-whitespace-between-doctype-public-and-system-identifiers",e.missingWhitespaceAfterDoctypeSystemKeyword="missing-whitespace-after-doctype-system-keyword",e.missingQuoteBeforeDoctypePublicIdentifier="missing-quote-before-doctype-public-identifier",e.missingQuoteBeforeDoctypeSystemIdentifier="missing-quote-before-doctype-system-identifier",e.missingDoctypePublicIdentifier="missing-doctype-public-identifier",e.missingDoctypeSystemIdentifier="missing-doctype-system-identifier",e.abruptDoctypePublicIdentifier="abrupt-doctype-public-identifier",e.abruptDoctypeSystemIdentifier="abrupt-doctype-system-identifier",e.cdataInHtmlContent="cdata-in-html-content",e.incorrectlyOpenedComment="incorrectly-opened-comment",e.eofInScriptHtmlCommentLikeText="eof-in-script-html-comment-like-text",e.eofInDoctype="eof-in-doctype",e.nestedComment="nested-comment",e.abruptClosingOfEmptyComment="abrupt-closing-of-empty-comment",e.eofInComment="eof-in-comment",e.incorrectlyClosedComment="incorrectly-closed-comment",e.eofInCdata="eof-in-cdata",e.absenceOfDigitsInNumericCharacterReference="absence-of-digits-in-numeric-character-reference",e.nullCharacterReference="null-character-reference",e.surrogateCharacterReference="surrogate-character-reference",e.characterReferenceOutsideUnicodeRange="character-reference-outside-unicode-range",e.controlCharacterReference="control-character-reference",e.noncharacterCharacterReference="noncharacter-character-reference",e.missingWhitespaceBeforeDoctypeName="missing-whitespace-before-doctype-name",e.missingDoctypeName="missing-doctype-name",e.invalidCharacterSequenceAfterDoctypeName="invalid-character-sequence-after-doctype-name",e.duplicateAttribute="duplicate-attribute",e.nonConformingDoctype="non-conforming-doctype",e.missingDoctype="missing-doctype",e.misplacedDoctype="misplaced-doctype",e.endTagWithoutMatchingOpenElement="end-tag-without-matching-open-element",e.closingOfElementWithOpenChildElements="closing-of-element-with-open-child-elements",e.disallowedContentInNoscriptInHead="disallowed-content-in-noscript-in-head",e.openElementsLeftAfterEof="open-elements-left-after-eof",e.abandonedHeadElementChild="abandoned-head-element-child",e.misplacedStartTagForHeadElement="misplaced-start-tag-for-head-element",e.nestedNoscriptInHead="nested-noscript-in-head",e.eofInElementThatCanContainOnlyText="eof-in-element-that-can-contain-only-text"})(hn||(hn={}));const Y2e=65536;class K2e{constructor(t){this.handler=t,this.html="",this.pos=-1,this.lastGapPos=-2,this.gapStack=[],this.skipNextNewLine=!1,this.lastChunkWritten=!1,this.endOfChunkHit=!1,this.bufferWaterline=Y2e,this.isEol=!1,this.lineStartPos=0,this.droppedBufferSize=0,this.line=1,this.lastErrOffset=-1}get col(){return this.pos-this.lineStartPos+ +(this.lastGapPos!==this.pos)}get offset(){return this.droppedBufferSize+this.pos}getError(t,n){const{line:r,col:a,offset:u}=this,f=a+n,s=u+n;return{code:t,startLine:r,endLine:r,startCol:f,endCol:f,startOffset:s,endOffset:s}}_err(t){this.handler.onParseError&&this.lastErrOffset!==this.offset&&(this.lastErrOffset=this.offset,this.handler.onParseError(this.getError(t,0)))}_addGap(){this.gapStack.push(this.lastGapPos),this.lastGapPos=this.pos}_processSurrogate(t){if(this.pos!==this.html.length-1){const n=this.html.charCodeAt(this.pos+1);if(Z2e(n))return this.pos++,this._addGap(),X2e(t,n)}else if(!this.lastChunkWritten)return this.endOfChunkHit=!0,Ge.EOF;return this._err(hn.surrogateInInputStream),t}willDropParsedChunk(){return this.pos>this.bufferWaterline}dropParsedChunk(){this.willDropParsedChunk()&&(this.html=this.html.substring(this.pos),this.lineStartPos-=this.pos,this.droppedBufferSize+=this.pos,this.pos=0,this.lastGapPos=-2,this.gapStack.length=0)}write(t,n){this.html.length>0?this.html+=t:this.html=t,this.endOfChunkHit=!1,this.lastChunkWritten=n}insertHtmlAtCurrentPos(t){this.html=this.html.substring(0,this.pos+1)+t+this.html.substring(this.pos+1),this.endOfChunkHit=!1}startsWith(t,n){if(this.pos+t.length>this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,!1;if(n)return this.html.startsWith(t,this.pos);for(let r=0;r<t.length;r++)if((this.html.charCodeAt(this.pos+r)|32)!==t.charCodeAt(r))return!1;return!0}peek(t){const n=this.pos+t;if(n>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,Ge.EOF;const r=this.html.charCodeAt(n);return r===Ge.CARRIAGE_RETURN?Ge.LINE_FEED:r}advance(){if(this.pos++,this.isEol&&(this.isEol=!1,this.line++,this.lineStartPos=this.pos),this.pos>=this.html.length)return this.endOfChunkHit=!this.lastChunkWritten,Ge.EOF;let t=this.html.charCodeAt(this.pos);return t===Ge.CARRIAGE_RETURN?(this.isEol=!0,this.skipNextNewLine=!0,Ge.LINE_FEED):t===Ge.LINE_FEED&&(this.isEol=!0,this.skipNextNewLine)?(this.line--,this.skipNextNewLine=!1,this._addGap(),this.advance()):(this.skipNextNewLine=!1,yJ(t)&&(t=this._processSurrogate(t)),this.handler.onParseError===null||t>31&&t<127||t===Ge.LINE_FEED||t===Ge.CARRIAGE_RETURN||t>159&&t<64976||this._checkForProblematicCharacters(t),t)}_checkForProblematicCharacters(t){vJ(t)?this._err(hn.controlCharacterInInputStream):xJ(t)&&this._err(hn.noncharacterInInputStream)}retreat(t){for(this.pos-=t;this.pos<this.lastGapPos;)this.lastGapPos=this.gapStack.pop(),this.pos--;this.isEol=!1}}var Ws;(function(e){e[e.CHARACTER=0]="CHARACTER",e[e.NULL_CHARACTER=1]="NULL_CHARACTER",e[e.WHITESPACE_CHARACTER=2]="WHITESPACE_CHARACTER",e[e.START_TAG=3]="START_TAG",e[e.END_TAG=4]="END_TAG",e[e.COMMENT=5]="COMMENT",e[e.DOCTYPE=6]="DOCTYPE",e[e.EOF=7]="EOF",e[e.HIBERNATION=8]="HIBERNATION"})(Ws||(Ws={}));function bJ(e,t){for(let n=e.attrs.length-1;n>=0;n--)if(e.attrs[n].name===t)return e.attrs[n].value;return null}const Q2e=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(e=>e.charCodeAt(0))),J2e=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);function eTe(e){var t;return e>=55296&&e<=57343||e>1114111?65533:(t=J2e.get(e))!==null&&t!==void 0?t:e}var El;(function(e){e[e.NUM=35]="NUM",e[e.SEMI=59]="SEMI",e[e.EQUALS=61]="EQUALS",e[e.ZERO=48]="ZERO",e[e.NINE=57]="NINE",e[e.LOWER_A=97]="LOWER_A",e[e.LOWER_F=102]="LOWER_F",e[e.LOWER_X=120]="LOWER_X",e[e.LOWER_Z=122]="LOWER_Z",e[e.UPPER_A=65]="UPPER_A",e[e.UPPER_F=70]="UPPER_F",e[e.UPPER_Z=90]="UPPER_Z"})(El||(El={}));const tTe=32;var jm;(function(e){e[e.VALUE_LENGTH=49152]="VALUE_LENGTH",e[e.BRANCH_LENGTH=16256]="BRANCH_LENGTH",e[e.JUMP_TABLE=127]="JUMP_TABLE"})(jm||(jm={}));function u8(e){return e>=El.ZERO&&e<=El.NINE}function nTe(e){return e>=El.UPPER_A&&e<=El.UPPER_F||e>=El.LOWER_A&&e<=El.LOWER_F}function rTe(e){return e>=El.UPPER_A&&e<=El.UPPER_Z||e>=El.LOWER_A&&e<=El.LOWER_Z||u8(e)}function iTe(e){return e===El.EQUALS||rTe(e)}var bl;(function(e){e[e.EntityStart=0]="EntityStart",e[e.NumericStart=1]="NumericStart",e[e.NumericDecimal=2]="NumericDecimal",e[e.NumericHex=3]="NumericHex",e[e.NamedEntity=4]="NamedEntity"})(bl||(bl={}));var Qf;(function(e){e[e.Legacy=0]="Legacy",e[e.Strict=1]="Strict",e[e.Attribute=2]="Attribute"})(Qf||(Qf={}));class sTe{constructor(t,n,r){this.decodeTree=t,this.emitCodePoint=n,this.errors=r,this.state=bl.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=Qf.Strict}startEntity(t){this.decodeMode=t,this.state=bl.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(t,n){switch(this.state){case bl.EntityStart:return t.charCodeAt(n)===El.NUM?(this.state=bl.NumericStart,this.consumed+=1,this.stateNumericStart(t,n+1)):(this.state=bl.NamedEntity,this.stateNamedEntity(t,n));case bl.NumericStart:return this.stateNumericStart(t,n);case bl.NumericDecimal:return this.stateNumericDecimal(t,n);case bl.NumericHex:return this.stateNumericHex(t,n);case bl.NamedEntity:return this.stateNamedEntity(t,n)}}stateNumericStart(t,n){return n>=t.length?-1:(t.charCodeAt(n)|tTe)===El.LOWER_X?(this.state=bl.NumericHex,this.consumed+=1,this.stateNumericHex(t,n+1)):(this.state=bl.NumericDecimal,this.stateNumericDecimal(t,n))}addToNumericResult(t,n,r,a){if(n!==r){const u=r-n;this.result=this.result*Math.pow(a,u)+Number.parseInt(t.substr(n,u),a),this.consumed+=u}}stateNumericHex(t,n){const r=n;for(;n<t.length;){const a=t.charCodeAt(n);if(u8(a)||nTe(a))n+=1;else return this.addToNumericResult(t,r,n,16),this.emitNumericEntity(a,3)}return this.addToNumericResult(t,r,n,16),-1}stateNumericDecimal(t,n){const r=n;for(;n<t.length;){const a=t.charCodeAt(n);if(u8(a))n+=1;else return this.addToNumericResult(t,r,n,10),this.emitNumericEntity(a,2)}return this.addToNumericResult(t,r,n,10),-1}emitNumericEntity(t,n){var r;if(this.consumed<=n)return(r=this.errors)===null||r===void 0||r.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(t===El.SEMI)this.consumed+=1;else if(this.decodeMode===Qf.Strict)return 0;return this.emitCodePoint(eTe(this.result),this.consumed),this.errors&&(t!==El.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(t,n){const{decodeTree:r}=this;let a=r[this.treeIndex],u=(a&jm.VALUE_LENGTH)>>14;for(;n<t.length;n++,this.excess++){const f=t.charCodeAt(n);if(this.treeIndex=aTe(r,a,this.treeIndex+Math.max(1,u),f),this.treeIndex<0)return this.result===0||this.decodeMode===Qf.Attribute&&(u===0||iTe(f))?0:this.emitNotTerminatedNamedEntity();if(a=r[this.treeIndex],u=(a&jm.VALUE_LENGTH)>>14,u!==0){if(f===El.SEMI)return this.emitNamedEntityData(this.treeIndex,u,this.consumed+this.excess);this.decodeMode!==Qf.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var t;const{result:n,decodeTree:r}=this,a=(r[n]&jm.VALUE_LENGTH)>>14;return this.emitNamedEntityData(n,a,this.consumed),(t=this.errors)===null||t===void 0||t.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(t,n,r){const{decodeTree:a}=this;return this.emitCodePoint(n===1?a[t]&~jm.VALUE_LENGTH:a[t+1],r),n===3&&this.emitCodePoint(a[t+2],r),r}end(){var t;switch(this.state){case bl.NamedEntity:return this.result!==0&&(this.decodeMode!==Qf.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case bl.NumericDecimal:return this.emitNumericEntity(0,2);case bl.NumericHex:return this.emitNumericEntity(0,3);case bl.NumericStart:return(t=this.errors)===null||t===void 0||t.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case bl.EntityStart:return 0}}}function aTe(e,t,n,r){const a=(t&jm.BRANCH_LENGTH)>>7,u=t&jm.JUMP_TABLE;if(a===0)return u!==0&&r===u?n:-1;if(u){const v=r-u;return v<0||v>=a?-1:e[n+v]-1}let f=n,s=f+a-1;for(;f<=s;){const v=f+s>>>1,x=e[v];if(x<r)f=v+1;else if(x>r)s=v-1;else return e[v+a]}return-1}var Gn;(function(e){e.HTML="http://www.w3.org/1999/xhtml",e.MATHML="http://www.w3.org/1998/Math/MathML",e.SVG="http://www.w3.org/2000/svg",e.XLINK="http://www.w3.org/1999/xlink",e.XML="http://www.w3.org/XML/1998/namespace",e.XMLNS="http://www.w3.org/2000/xmlns/"})(Gn||(Gn={}));var Xg;(function(e){e.TYPE="type",e.ACTION="action",e.ENCODING="encoding",e.PROMPT="prompt",e.NAME="name",e.COLOR="color",e.FACE="face",e.SIZE="size"})(Xg||(Xg={}));var id;(function(e){e.NO_QUIRKS="no-quirks",e.QUIRKS="quirks",e.LIMITED_QUIRKS="limited-quirks"})(id||(id={}));var qt;(function(e){e.A="a",e.ADDRESS="address",e.ANNOTATION_XML="annotation-xml",e.APPLET="applet",e.AREA="area",e.ARTICLE="article",e.ASIDE="aside",e.B="b",e.BASE="base",e.BASEFONT="basefont",e.BGSOUND="bgsound",e.BIG="big",e.BLOCKQUOTE="blockquote",e.BODY="body",e.BR="br",e.BUTTON="button",e.CAPTION="caption",e.CENTER="center",e.CODE="code",e.COL="col",e.COLGROUP="colgroup",e.DD="dd",e.DESC="desc",e.DETAILS="details",e.DIALOG="dialog",e.DIR="dir",e.DIV="div",e.DL="dl",e.DT="dt",e.EM="em",e.EMBED="embed",e.FIELDSET="fieldset",e.FIGCAPTION="figcaption",e.FIGURE="figure",e.FONT="font",e.FOOTER="footer",e.FOREIGN_OBJECT="foreignObject",e.FORM="form",e.FRAME="frame",e.FRAMESET="frameset",e.H1="h1",e.H2="h2",e.H3="h3",e.H4="h4",e.H5="h5",e.H6="h6",e.HEAD="head",e.HEADER="header",e.HGROUP="hgroup",e.HR="hr",e.HTML="html",e.I="i",e.IMG="img",e.IMAGE="image",e.INPUT="input",e.IFRAME="iframe",e.KEYGEN="keygen",e.LABEL="label",e.LI="li",e.LINK="link",e.LISTING="listing",e.MAIN="main",e.MALIGNMARK="malignmark",e.MARQUEE="marquee",e.MATH="math",e.MENU="menu",e.META="meta",e.MGLYPH="mglyph",e.MI="mi",e.MO="mo",e.MN="mn",e.MS="ms",e.MTEXT="mtext",e.NAV="nav",e.NOBR="nobr",e.NOFRAMES="noframes",e.NOEMBED="noembed",e.NOSCRIPT="noscript",e.OBJECT="object",e.OL="ol",e.OPTGROUP="optgroup",e.OPTION="option",e.P="p",e.PARAM="param",e.PLAINTEXT="plaintext",e.PRE="pre",e.RB="rb",e.RP="rp",e.RT="rt",e.RTC="rtc",e.RUBY="ruby",e.S="s",e.SCRIPT="script",e.SEARCH="search",e.SECTION="section",e.SELECT="select",e.SOURCE="source",e.SMALL="small",e.SPAN="span",e.STRIKE="strike",e.STRONG="strong",e.STYLE="style",e.SUB="sub",e.SUMMARY="summary",e.SUP="sup",e.TABLE="table",e.TBODY="tbody",e.TEMPLATE="template",e.TEXTAREA="textarea",e.TFOOT="tfoot",e.TD="td",e.TH="th",e.THEAD="thead",e.TITLE="title",e.TR="tr",e.TRACK="track",e.TT="tt",e.U="u",e.UL="ul",e.SVG="svg",e.VAR="var",e.WBR="wbr",e.XMP="xmp"})(qt||(qt={}));var Q;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.A=1]="A",e[e.ADDRESS=2]="ADDRESS",e[e.ANNOTATION_XML=3]="ANNOTATION_XML",e[e.APPLET=4]="APPLET",e[e.AREA=5]="AREA",e[e.ARTICLE=6]="ARTICLE",e[e.ASIDE=7]="ASIDE",e[e.B=8]="B",e[e.BASE=9]="BASE",e[e.BASEFONT=10]="BASEFONT",e[e.BGSOUND=11]="BGSOUND",e[e.BIG=12]="BIG",e[e.BLOCKQUOTE=13]="BLOCKQUOTE",e[e.BODY=14]="BODY",e[e.BR=15]="BR",e[e.BUTTON=16]="BUTTON",e[e.CAPTION=17]="CAPTION",e[e.CENTER=18]="CENTER",e[e.CODE=19]="CODE",e[e.COL=20]="COL",e[e.COLGROUP=21]="COLGROUP",e[e.DD=22]="DD",e[e.DESC=23]="DESC",e[e.DETAILS=24]="DETAILS",e[e.DIALOG=25]="DIALOG",e[e.DIR=26]="DIR",e[e.DIV=27]="DIV",e[e.DL=28]="DL",e[e.DT=29]="DT",e[e.EM=30]="EM",e[e.EMBED=31]="EMBED",e[e.FIELDSET=32]="FIELDSET",e[e.FIGCAPTION=33]="FIGCAPTION",e[e.FIGURE=34]="FIGURE",e[e.FONT=35]="FONT",e[e.FOOTER=36]="FOOTER",e[e.FOREIGN_OBJECT=37]="FOREIGN_OBJECT",e[e.FORM=38]="FORM",e[e.FRAME=39]="FRAME",e[e.FRAMESET=40]="FRAMESET",e[e.H1=41]="H1",e[e.H2=42]="H2",e[e.H3=43]="H3",e[e.H4=44]="H4",e[e.H5=45]="H5",e[e.H6=46]="H6",e[e.HEAD=47]="HEAD",e[e.HEADER=48]="HEADER",e[e.HGROUP=49]="HGROUP",e[e.HR=50]="HR",e[e.HTML=51]="HTML",e[e.I=52]="I",e[e.IMG=53]="IMG",e[e.IMAGE=54]="IMAGE",e[e.INPUT=55]="INPUT",e[e.IFRAME=56]="IFRAME",e[e.KEYGEN=57]="KEYGEN",e[e.LABEL=58]="LABEL",e[e.LI=59]="LI",e[e.LINK=60]="LINK",e[e.LISTING=61]="LISTING",e[e.MAIN=62]="MAIN",e[e.MALIGNMARK=63]="MALIGNMARK",e[e.MARQUEE=64]="MARQUEE",e[e.MATH=65]="MATH",e[e.MENU=66]="MENU",e[e.META=67]="META",e[e.MGLYPH=68]="MGLYPH",e[e.MI=69]="MI",e[e.MO=70]="MO",e[e.MN=71]="MN",e[e.MS=72]="MS",e[e.MTEXT=73]="MTEXT",e[e.NAV=74]="NAV",e[e.NOBR=75]="NOBR",e[e.NOFRAMES=76]="NOFRAMES",e[e.NOEMBED=77]="NOEMBED",e[e.NOSCRIPT=78]="NOSCRIPT",e[e.OBJECT=79]="OBJECT",e[e.OL=80]="OL",e[e.OPTGROUP=81]="OPTGROUP",e[e.OPTION=82]="OPTION",e[e.P=83]="P",e[e.PARAM=84]="PARAM",e[e.PLAINTEXT=85]="PLAINTEXT",e[e.PRE=86]="PRE",e[e.RB=87]="RB",e[e.RP=88]="RP",e[e.RT=89]="RT",e[e.RTC=90]="RTC",e[e.RUBY=91]="RUBY",e[e.S=92]="S",e[e.SCRIPT=93]="SCRIPT",e[e.SEARCH=94]="SEARCH",e[e.SECTION=95]="SECTION",e[e.SELECT=96]="SELECT",e[e.SOURCE=97]="SOURCE",e[e.SMALL=98]="SMALL",e[e.SPAN=99]="SPAN",e[e.STRIKE=100]="STRIKE",e[e.STRONG=101]="STRONG",e[e.STYLE=102]="STYLE",e[e.SUB=103]="SUB",e[e.SUMMARY=104]="SUMMARY",e[e.SUP=105]="SUP",e[e.TABLE=106]="TABLE",e[e.TBODY=107]="TBODY",e[e.TEMPLATE=108]="TEMPLATE",e[e.TEXTAREA=109]="TEXTAREA",e[e.TFOOT=110]="TFOOT",e[e.TD=111]="TD",e[e.TH=112]="TH",e[e.THEAD=113]="THEAD",e[e.TITLE=114]="TITLE",e[e.TR=115]="TR",e[e.TRACK=116]="TRACK",e[e.TT=117]="TT",e[e.U=118]="U",e[e.UL=119]="UL",e[e.SVG=120]="SVG",e[e.VAR=121]="VAR",e[e.WBR=122]="WBR",e[e.XMP=123]="XMP"})(Q||(Q={}));const oTe=new Map([[qt.A,Q.A],[qt.ADDRESS,Q.ADDRESS],[qt.ANNOTATION_XML,Q.ANNOTATION_XML],[qt.APPLET,Q.APPLET],[qt.AREA,Q.AREA],[qt.ARTICLE,Q.ARTICLE],[qt.ASIDE,Q.ASIDE],[qt.B,Q.B],[qt.BASE,Q.BASE],[qt.BASEFONT,Q.BASEFONT],[qt.BGSOUND,Q.BGSOUND],[qt.BIG,Q.BIG],[qt.BLOCKQUOTE,Q.BLOCKQUOTE],[qt.BODY,Q.BODY],[qt.BR,Q.BR],[qt.BUTTON,Q.BUTTON],[qt.CAPTION,Q.CAPTION],[qt.CENTER,Q.CENTER],[qt.CODE,Q.CODE],[qt.COL,Q.COL],[qt.COLGROUP,Q.COLGROUP],[qt.DD,Q.DD],[qt.DESC,Q.DESC],[qt.DETAILS,Q.DETAILS],[qt.DIALOG,Q.DIALOG],[qt.DIR,Q.DIR],[qt.DIV,Q.DIV],[qt.DL,Q.DL],[qt.DT,Q.DT],[qt.EM,Q.EM],[qt.EMBED,Q.EMBED],[qt.FIELDSET,Q.FIELDSET],[qt.FIGCAPTION,Q.FIGCAPTION],[qt.FIGURE,Q.FIGURE],[qt.FONT,Q.FONT],[qt.FOOTER,Q.FOOTER],[qt.FOREIGN_OBJECT,Q.FOREIGN_OBJECT],[qt.FORM,Q.FORM],[qt.FRAME,Q.FRAME],[qt.FRAMESET,Q.FRAMESET],[qt.H1,Q.H1],[qt.H2,Q.H2],[qt.H3,Q.H3],[qt.H4,Q.H4],[qt.H5,Q.H5],[qt.H6,Q.H6],[qt.HEAD,Q.HEAD],[qt.HEADER,Q.HEADER],[qt.HGROUP,Q.HGROUP],[qt.HR,Q.HR],[qt.HTML,Q.HTML],[qt.I,Q.I],[qt.IMG,Q.IMG],[qt.IMAGE,Q.IMAGE],[qt.INPUT,Q.INPUT],[qt.IFRAME,Q.IFRAME],[qt.KEYGEN,Q.KEYGEN],[qt.LABEL,Q.LABEL],[qt.LI,Q.LI],[qt.LINK,Q.LINK],[qt.LISTING,Q.LISTING],[qt.MAIN,Q.MAIN],[qt.MALIGNMARK,Q.MALIGNMARK],[qt.MARQUEE,Q.MARQUEE],[qt.MATH,Q.MATH],[qt.MENU,Q.MENU],[qt.META,Q.META],[qt.MGLYPH,Q.MGLYPH],[qt.MI,Q.MI],[qt.MO,Q.MO],[qt.MN,Q.MN],[qt.MS,Q.MS],[qt.MTEXT,Q.MTEXT],[qt.NAV,Q.NAV],[qt.NOBR,Q.NOBR],[qt.NOFRAMES,Q.NOFRAMES],[qt.NOEMBED,Q.NOEMBED],[qt.NOSCRIPT,Q.NOSCRIPT],[qt.OBJECT,Q.OBJECT],[qt.OL,Q.OL],[qt.OPTGROUP,Q.OPTGROUP],[qt.OPTION,Q.OPTION],[qt.P,Q.P],[qt.PARAM,Q.PARAM],[qt.PLAINTEXT,Q.PLAINTEXT],[qt.PRE,Q.PRE],[qt.RB,Q.RB],[qt.RP,Q.RP],[qt.RT,Q.RT],[qt.RTC,Q.RTC],[qt.RUBY,Q.RUBY],[qt.S,Q.S],[qt.SCRIPT,Q.SCRIPT],[qt.SEARCH,Q.SEARCH],[qt.SECTION,Q.SECTION],[qt.SELECT,Q.SELECT],[qt.SOURCE,Q.SOURCE],[qt.SMALL,Q.SMALL],[qt.SPAN,Q.SPAN],[qt.STRIKE,Q.STRIKE],[qt.STRONG,Q.STRONG],[qt.STYLE,Q.STYLE],[qt.SUB,Q.SUB],[qt.SUMMARY,Q.SUMMARY],[qt.SUP,Q.SUP],[qt.TABLE,Q.TABLE],[qt.TBODY,Q.TBODY],[qt.TEMPLATE,Q.TEMPLATE],[qt.TEXTAREA,Q.TEXTAREA],[qt.TFOOT,Q.TFOOT],[qt.TD,Q.TD],[qt.TH,Q.TH],[qt.THEAD,Q.THEAD],[qt.TITLE,Q.TITLE],[qt.TR,Q.TR],[qt.TRACK,Q.TRACK],[qt.TT,Q.TT],[qt.U,Q.U],[qt.UL,Q.UL],[qt.SVG,Q.SVG],[qt.VAR,Q.VAR],[qt.WBR,Q.WBR],[qt.XMP,Q.XMP]]);function px(e){var t;return(t=oTe.get(e))!==null&&t!==void 0?t:Q.UNKNOWN}const Kn=Q,lTe={[Gn.HTML]:new Set([Kn.ADDRESS,Kn.APPLET,Kn.AREA,Kn.ARTICLE,Kn.ASIDE,Kn.BASE,Kn.BASEFONT,Kn.BGSOUND,Kn.BLOCKQUOTE,Kn.BODY,Kn.BR,Kn.BUTTON,Kn.CAPTION,Kn.CENTER,Kn.COL,Kn.COLGROUP,Kn.DD,Kn.DETAILS,Kn.DIR,Kn.DIV,Kn.DL,Kn.DT,Kn.EMBED,Kn.FIELDSET,Kn.FIGCAPTION,Kn.FIGURE,Kn.FOOTER,Kn.FORM,Kn.FRAME,Kn.FRAMESET,Kn.H1,Kn.H2,Kn.H3,Kn.H4,Kn.H5,Kn.H6,Kn.HEAD,Kn.HEADER,Kn.HGROUP,Kn.HR,Kn.HTML,Kn.IFRAME,Kn.IMG,Kn.INPUT,Kn.LI,Kn.LINK,Kn.LISTING,Kn.MAIN,Kn.MARQUEE,Kn.MENU,Kn.META,Kn.NAV,Kn.NOEMBED,Kn.NOFRAMES,Kn.NOSCRIPT,Kn.OBJECT,Kn.OL,Kn.P,Kn.PARAM,Kn.PLAINTEXT,Kn.PRE,Kn.SCRIPT,Kn.SECTION,Kn.SELECT,Kn.SOURCE,Kn.STYLE,Kn.SUMMARY,Kn.TABLE,Kn.TBODY,Kn.TD,Kn.TEMPLATE,Kn.TEXTAREA,Kn.TFOOT,Kn.TH,Kn.THEAD,Kn.TITLE,Kn.TR,Kn.TRACK,Kn.UL,Kn.WBR,Kn.XMP]),[Gn.MATHML]:new Set([Kn.MI,Kn.MO,Kn.MN,Kn.MS,Kn.MTEXT,Kn.ANNOTATION_XML]),[Gn.SVG]:new Set([Kn.TITLE,Kn.FOREIGN_OBJECT,Kn.DESC]),[Gn.XLINK]:new Set,[Gn.XML]:new Set,[Gn.XMLNS]:new Set},c8=new Set([Kn.H1,Kn.H2,Kn.H3,Kn.H4,Kn.H5,Kn.H6]);qt.STYLE,qt.SCRIPT,qt.XMP,qt.IFRAME,qt.NOEMBED,qt.NOFRAMES,qt.PLAINTEXT;var et;(function(e){e[e.DATA=0]="DATA",e[e.RCDATA=1]="RCDATA",e[e.RAWTEXT=2]="RAWTEXT",e[e.SCRIPT_DATA=3]="SCRIPT_DATA",e[e.PLAINTEXT=4]="PLAINTEXT",e[e.TAG_OPEN=5]="TAG_OPEN",e[e.END_TAG_OPEN=6]="END_TAG_OPEN",e[e.TAG_NAME=7]="TAG_NAME",e[e.RCDATA_LESS_THAN_SIGN=8]="RCDATA_LESS_THAN_SIGN",e[e.RCDATA_END_TAG_OPEN=9]="RCDATA_END_TAG_OPEN",e[e.RCDATA_END_TAG_NAME=10]="RCDATA_END_TAG_NAME",e[e.RAWTEXT_LESS_THAN_SIGN=11]="RAWTEXT_LESS_THAN_SIGN",e[e.RAWTEXT_END_TAG_OPEN=12]="RAWTEXT_END_TAG_OPEN",e[e.RAWTEXT_END_TAG_NAME=13]="RAWTEXT_END_TAG_NAME",e[e.SCRIPT_DATA_LESS_THAN_SIGN=14]="SCRIPT_DATA_LESS_THAN_SIGN",e[e.SCRIPT_DATA_END_TAG_OPEN=15]="SCRIPT_DATA_END_TAG_OPEN",e[e.SCRIPT_DATA_END_TAG_NAME=16]="SCRIPT_DATA_END_TAG_NAME",e[e.SCRIPT_DATA_ESCAPE_START=17]="SCRIPT_DATA_ESCAPE_START",e[e.SCRIPT_DATA_ESCAPE_START_DASH=18]="SCRIPT_DATA_ESCAPE_START_DASH",e[e.SCRIPT_DATA_ESCAPED=19]="SCRIPT_DATA_ESCAPED",e[e.SCRIPT_DATA_ESCAPED_DASH=20]="SCRIPT_DATA_ESCAPED_DASH",e[e.SCRIPT_DATA_ESCAPED_DASH_DASH=21]="SCRIPT_DATA_ESCAPED_DASH_DASH",e[e.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN=22]="SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN",e[e.SCRIPT_DATA_ESCAPED_END_TAG_OPEN=23]="SCRIPT_DATA_ESCAPED_END_TAG_OPEN",e[e.SCRIPT_DATA_ESCAPED_END_TAG_NAME=24]="SCRIPT_DATA_ESCAPED_END_TAG_NAME",e[e.SCRIPT_DATA_DOUBLE_ESCAPE_START=25]="SCRIPT_DATA_DOUBLE_ESCAPE_START",e[e.SCRIPT_DATA_DOUBLE_ESCAPED=26]="SCRIPT_DATA_DOUBLE_ESCAPED",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_DASH=27]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH=28]="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH",e[e.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN=29]="SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN",e[e.SCRIPT_DATA_DOUBLE_ESCAPE_END=30]="SCRIPT_DATA_DOUBLE_ESCAPE_END",e[e.BEFORE_ATTRIBUTE_NAME=31]="BEFORE_ATTRIBUTE_NAME",e[e.ATTRIBUTE_NAME=32]="ATTRIBUTE_NAME",e[e.AFTER_ATTRIBUTE_NAME=33]="AFTER_ATTRIBUTE_NAME",e[e.BEFORE_ATTRIBUTE_VALUE=34]="BEFORE_ATTRIBUTE_VALUE",e[e.ATTRIBUTE_VALUE_DOUBLE_QUOTED=35]="ATTRIBUTE_VALUE_DOUBLE_QUOTED",e[e.ATTRIBUTE_VALUE_SINGLE_QUOTED=36]="ATTRIBUTE_VALUE_SINGLE_QUOTED",e[e.ATTRIBUTE_VALUE_UNQUOTED=37]="ATTRIBUTE_VALUE_UNQUOTED",e[e.AFTER_ATTRIBUTE_VALUE_QUOTED=38]="AFTER_ATTRIBUTE_VALUE_QUOTED",e[e.SELF_CLOSING_START_TAG=39]="SELF_CLOSING_START_TAG",e[e.BOGUS_COMMENT=40]="BOGUS_COMMENT",e[e.MARKUP_DECLARATION_OPEN=41]="MARKUP_DECLARATION_OPEN",e[e.COMMENT_START=42]="COMMENT_START",e[e.COMMENT_START_DASH=43]="COMMENT_START_DASH",e[e.COMMENT=44]="COMMENT",e[e.COMMENT_LESS_THAN_SIGN=45]="COMMENT_LESS_THAN_SIGN",e[e.COMMENT_LESS_THAN_SIGN_BANG=46]="COMMENT_LESS_THAN_SIGN_BANG",e[e.COMMENT_LESS_THAN_SIGN_BANG_DASH=47]="COMMENT_LESS_THAN_SIGN_BANG_DASH",e[e.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH=48]="COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH",e[e.COMMENT_END_DASH=49]="COMMENT_END_DASH",e[e.COMMENT_END=50]="COMMENT_END",e[e.COMMENT_END_BANG=51]="COMMENT_END_BANG",e[e.DOCTYPE=52]="DOCTYPE",e[e.BEFORE_DOCTYPE_NAME=53]="BEFORE_DOCTYPE_NAME",e[e.DOCTYPE_NAME=54]="DOCTYPE_NAME",e[e.AFTER_DOCTYPE_NAME=55]="AFTER_DOCTYPE_NAME",e[e.AFTER_DOCTYPE_PUBLIC_KEYWORD=56]="AFTER_DOCTYPE_PUBLIC_KEYWORD",e[e.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER=57]="BEFORE_DOCTYPE_PUBLIC_IDENTIFIER",e[e.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED=58]="DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED",e[e.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED=59]="DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED",e[e.AFTER_DOCTYPE_PUBLIC_IDENTIFIER=60]="AFTER_DOCTYPE_PUBLIC_IDENTIFIER",e[e.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS=61]="BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS",e[e.AFTER_DOCTYPE_SYSTEM_KEYWORD=62]="AFTER_DOCTYPE_SYSTEM_KEYWORD",e[e.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER=63]="BEFORE_DOCTYPE_SYSTEM_IDENTIFIER",e[e.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED=64]="DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED",e[e.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED=65]="DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED",e[e.AFTER_DOCTYPE_SYSTEM_IDENTIFIER=66]="AFTER_DOCTYPE_SYSTEM_IDENTIFIER",e[e.BOGUS_DOCTYPE=67]="BOGUS_DOCTYPE",e[e.CDATA_SECTION=68]="CDATA_SECTION",e[e.CDATA_SECTION_BRACKET=69]="CDATA_SECTION_BRACKET",e[e.CDATA_SECTION_END=70]="CDATA_SECTION_END",e[e.CHARACTER_REFERENCE=71]="CHARACTER_REFERENCE",e[e.AMBIGUOUS_AMPERSAND=72]="AMBIGUOUS_AMPERSAND"})(et||(et={}));const Ho={DATA:et.DATA,RCDATA:et.RCDATA,RAWTEXT:et.RAWTEXT,SCRIPT_DATA:et.SCRIPT_DATA,PLAINTEXT:et.PLAINTEXT,CDATA_SECTION:et.CDATA_SECTION};function uTe(e){return e>=Ge.DIGIT_0&&e<=Ge.DIGIT_9}function Ww(e){return e>=Ge.LATIN_CAPITAL_A&&e<=Ge.LATIN_CAPITAL_Z}function cTe(e){return e>=Ge.LATIN_SMALL_A&&e<=Ge.LATIN_SMALL_Z}function pm(e){return cTe(e)||Ww(e)}function FV(e){return pm(e)||uTe(e)}function O3(e){return e+32}function wJ(e){return e===Ge.SPACE||e===Ge.LINE_FEED||e===Ge.TABULATION||e===Ge.FORM_FEED}function BV(e){return wJ(e)||e===Ge.SOLIDUS||e===Ge.GREATER_THAN_SIGN}function dTe(e){return e===Ge.NULL?hn.nullCharacterReference:e>1114111?hn.characterReferenceOutsideUnicodeRange:yJ(e)?hn.surrogateCharacterReference:xJ(e)?hn.noncharacterCharacterReference:vJ(e)||e===Ge.CARRIAGE_RETURN?hn.controlCharacterReference:null}class hTe{constructor(t,n){this.options=t,this.handler=n,this.paused=!1,this.inLoop=!1,this.inForeignNode=!1,this.lastStartTagName="",this.active=!1,this.state=et.DATA,this.returnState=et.DATA,this.entityStartPos=0,this.consumedAfterSnapshot=-1,this.currentCharacterToken=null,this.currentToken=null,this.currentAttr={name:"",value:""},this.preprocessor=new K2e(n),this.currentLocation=this.getCurrentLocation(-1),this.entityDecoder=new sTe(Q2e,(r,a)=>{this.preprocessor.pos=this.entityStartPos+a-1,this._flushCodePointConsumedAsCharacterReference(r)},n.onParseError?{missingSemicolonAfterCharacterReference:()=>{this._err(hn.missingSemicolonAfterCharacterReference,1)},absenceOfDigitsInNumericCharacterReference:r=>{this._err(hn.absenceOfDigitsInNumericCharacterReference,this.entityStartPos-this.preprocessor.pos+r)},validateNumericCharacterReference:r=>{const a=dTe(r);a&&this._err(a,1)}}:void 0)}_err(t,n=0){var r,a;(a=(r=this.handler).onParseError)===null||a===void 0||a.call(r,this.preprocessor.getError(t,n))}getCurrentLocation(t){return this.options.sourceCodeLocationInfo?{startLine:this.preprocessor.line,startCol:this.preprocessor.col-t,startOffset:this.preprocessor.offset-t,endLine:-1,endCol:-1,endOffset:-1}:null}_runParsingLoop(){if(!this.inLoop){for(this.inLoop=!0;this.active&&!this.paused;){this.consumedAfterSnapshot=0;const t=this._consume();this._ensureHibernation()||this._callState(t)}this.inLoop=!1}}pause(){this.paused=!0}resume(t){if(!this.paused)throw new Error("Parser was already resumed");this.paused=!1,!this.inLoop&&(this._runParsingLoop(),this.paused||t==null||t())}write(t,n,r){this.active=!0,this.preprocessor.write(t,n),this._runParsingLoop(),this.paused||r==null||r()}insertHtmlAtCurrentPos(t){this.active=!0,this.preprocessor.insertHtmlAtCurrentPos(t),this._runParsingLoop()}_ensureHibernation(){return this.preprocessor.endOfChunkHit?(this.preprocessor.retreat(this.consumedAfterSnapshot),this.consumedAfterSnapshot=0,this.active=!1,!0):!1}_consume(){return this.consumedAfterSnapshot++,this.preprocessor.advance()}_advanceBy(t){this.consumedAfterSnapshot+=t;for(let n=0;n<t;n++)this.preprocessor.advance()}_consumeSequenceIfMatch(t,n){return this.preprocessor.startsWith(t,n)?(this._advanceBy(t.length-1),!0):!1}_createStartTagToken(){this.currentToken={type:Ws.START_TAG,tagName:"",tagID:Q.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(1)}}_createEndTagToken(){this.currentToken={type:Ws.END_TAG,tagName:"",tagID:Q.UNKNOWN,selfClosing:!1,ackSelfClosing:!1,attrs:[],location:this.getCurrentLocation(2)}}_createCommentToken(t){this.currentToken={type:Ws.COMMENT,data:"",location:this.getCurrentLocation(t)}}_createDoctypeToken(t){this.currentToken={type:Ws.DOCTYPE,name:t,forceQuirks:!1,publicId:null,systemId:null,location:this.currentLocation}}_createCharacterToken(t,n){this.currentCharacterToken={type:t,chars:n,location:this.currentLocation}}_createAttr(t){this.currentAttr={name:t,value:""},this.currentLocation=this.getCurrentLocation(0)}_leaveAttrName(){var t,n;const r=this.currentToken;if(bJ(r,this.currentAttr.name)===null){if(r.attrs.push(this.currentAttr),r.location&&this.currentLocation){const a=(t=(n=r.location).attrs)!==null&&t!==void 0?t:n.attrs=Object.create(null);a[this.currentAttr.name]=this.currentLocation,this._leaveAttrValue()}}else this._err(hn.duplicateAttribute)}_leaveAttrValue(){this.currentLocation&&(this.currentLocation.endLine=this.preprocessor.line,this.currentLocation.endCol=this.preprocessor.col,this.currentLocation.endOffset=this.preprocessor.offset)}prepareToken(t){this._emitCurrentCharacterToken(t.location),this.currentToken=null,t.location&&(t.location.endLine=this.preprocessor.line,t.location.endCol=this.preprocessor.col+1,t.location.endOffset=this.preprocessor.offset+1),this.currentLocation=this.getCurrentLocation(-1)}emitCurrentTagToken(){const t=this.currentToken;this.prepareToken(t),t.tagID=px(t.tagName),t.type===Ws.START_TAG?(this.lastStartTagName=t.tagName,this.handler.onStartTag(t)):(t.attrs.length>0&&this._err(hn.endTagWithAttributes),t.selfClosing&&this._err(hn.endTagWithTrailingSolidus),this.handler.onEndTag(t)),this.preprocessor.dropParsedChunk()}emitCurrentComment(t){this.prepareToken(t),this.handler.onComment(t),this.preprocessor.dropParsedChunk()}emitCurrentDoctype(t){this.prepareToken(t),this.handler.onDoctype(t),this.preprocessor.dropParsedChunk()}_emitCurrentCharacterToken(t){if(this.currentCharacterToken){switch(t&&this.currentCharacterToken.location&&(this.currentCharacterToken.location.endLine=t.startLine,this.currentCharacterToken.location.endCol=t.startCol,this.currentCharacterToken.location.endOffset=t.startOffset),this.currentCharacterToken.type){case Ws.CHARACTER:{this.handler.onCharacter(this.currentCharacterToken);break}case Ws.NULL_CHARACTER:{this.handler.onNullCharacter(this.currentCharacterToken);break}case Ws.WHITESPACE_CHARACTER:{this.handler.onWhitespaceCharacter(this.currentCharacterToken);break}}this.currentCharacterToken=null}}_emitEOFToken(){const t=this.getCurrentLocation(0);t&&(t.endLine=t.startLine,t.endCol=t.startCol,t.endOffset=t.startOffset),this._emitCurrentCharacterToken(t),this.handler.onEof({type:Ws.EOF,location:t}),this.active=!1}_appendCharToCurrentCharacterToken(t,n){if(this.currentCharacterToken)if(this.currentCharacterToken.type===t){this.currentCharacterToken.chars+=n;return}else this.currentLocation=this.getCurrentLocation(0),this._emitCurrentCharacterToken(this.currentLocation),this.preprocessor.dropParsedChunk();this._createCharacterToken(t,n)}_emitCodePoint(t){const n=wJ(t)?Ws.WHITESPACE_CHARACTER:t===Ge.NULL?Ws.NULL_CHARACTER:Ws.CHARACTER;this._appendCharToCurrentCharacterToken(n,String.fromCodePoint(t))}_emitChars(t){this._appendCharToCurrentCharacterToken(Ws.CHARACTER,t)}_startCharacterReference(){this.returnState=this.state,this.state=et.CHARACTER_REFERENCE,this.entityStartPos=this.preprocessor.pos,this.entityDecoder.startEntity(this._isCharacterReferenceInAttribute()?Qf.Attribute:Qf.Legacy)}_isCharacterReferenceInAttribute(){return this.returnState===et.ATTRIBUTE_VALUE_DOUBLE_QUOTED||this.returnState===et.ATTRIBUTE_VALUE_SINGLE_QUOTED||this.returnState===et.ATTRIBUTE_VALUE_UNQUOTED}_flushCodePointConsumedAsCharacterReference(t){this._isCharacterReferenceInAttribute()?this.currentAttr.value+=String.fromCodePoint(t):this._emitCodePoint(t)}_callState(t){switch(this.state){case et.DATA:{this._stateData(t);break}case et.RCDATA:{this._stateRcdata(t);break}case et.RAWTEXT:{this._stateRawtext(t);break}case et.SCRIPT_DATA:{this._stateScriptData(t);break}case et.PLAINTEXT:{this._statePlaintext(t);break}case et.TAG_OPEN:{this._stateTagOpen(t);break}case et.END_TAG_OPEN:{this._stateEndTagOpen(t);break}case et.TAG_NAME:{this._stateTagName(t);break}case et.RCDATA_LESS_THAN_SIGN:{this._stateRcdataLessThanSign(t);break}case et.RCDATA_END_TAG_OPEN:{this._stateRcdataEndTagOpen(t);break}case et.RCDATA_END_TAG_NAME:{this._stateRcdataEndTagName(t);break}case et.RAWTEXT_LESS_THAN_SIGN:{this._stateRawtextLessThanSign(t);break}case et.RAWTEXT_END_TAG_OPEN:{this._stateRawtextEndTagOpen(t);break}case et.RAWTEXT_END_TAG_NAME:{this._stateRawtextEndTagName(t);break}case et.SCRIPT_DATA_LESS_THAN_SIGN:{this._stateScriptDataLessThanSign(t);break}case et.SCRIPT_DATA_END_TAG_OPEN:{this._stateScriptDataEndTagOpen(t);break}case et.SCRIPT_DATA_END_TAG_NAME:{this._stateScriptDataEndTagName(t);break}case et.SCRIPT_DATA_ESCAPE_START:{this._stateScriptDataEscapeStart(t);break}case et.SCRIPT_DATA_ESCAPE_START_DASH:{this._stateScriptDataEscapeStartDash(t);break}case et.SCRIPT_DATA_ESCAPED:{this._stateScriptDataEscaped(t);break}case et.SCRIPT_DATA_ESCAPED_DASH:{this._stateScriptDataEscapedDash(t);break}case et.SCRIPT_DATA_ESCAPED_DASH_DASH:{this._stateScriptDataEscapedDashDash(t);break}case et.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataEscapedLessThanSign(t);break}case et.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:{this._stateScriptDataEscapedEndTagOpen(t);break}case et.SCRIPT_DATA_ESCAPED_END_TAG_NAME:{this._stateScriptDataEscapedEndTagName(t);break}case et.SCRIPT_DATA_DOUBLE_ESCAPE_START:{this._stateScriptDataDoubleEscapeStart(t);break}case et.SCRIPT_DATA_DOUBLE_ESCAPED:{this._stateScriptDataDoubleEscaped(t);break}case et.SCRIPT_DATA_DOUBLE_ESCAPED_DASH:{this._stateScriptDataDoubleEscapedDash(t);break}case et.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH:{this._stateScriptDataDoubleEscapedDashDash(t);break}case et.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN:{this._stateScriptDataDoubleEscapedLessThanSign(t);break}case et.SCRIPT_DATA_DOUBLE_ESCAPE_END:{this._stateScriptDataDoubleEscapeEnd(t);break}case et.BEFORE_ATTRIBUTE_NAME:{this._stateBeforeAttributeName(t);break}case et.ATTRIBUTE_NAME:{this._stateAttributeName(t);break}case et.AFTER_ATTRIBUTE_NAME:{this._stateAfterAttributeName(t);break}case et.BEFORE_ATTRIBUTE_VALUE:{this._stateBeforeAttributeValue(t);break}case et.ATTRIBUTE_VALUE_DOUBLE_QUOTED:{this._stateAttributeValueDoubleQuoted(t);break}case et.ATTRIBUTE_VALUE_SINGLE_QUOTED:{this._stateAttributeValueSingleQuoted(t);break}case et.ATTRIBUTE_VALUE_UNQUOTED:{this._stateAttributeValueUnquoted(t);break}case et.AFTER_ATTRIBUTE_VALUE_QUOTED:{this._stateAfterAttributeValueQuoted(t);break}case et.SELF_CLOSING_START_TAG:{this._stateSelfClosingStartTag(t);break}case et.BOGUS_COMMENT:{this._stateBogusComment(t);break}case et.MARKUP_DECLARATION_OPEN:{this._stateMarkupDeclarationOpen(t);break}case et.COMMENT_START:{this._stateCommentStart(t);break}case et.COMMENT_START_DASH:{this._stateCommentStartDash(t);break}case et.COMMENT:{this._stateComment(t);break}case et.COMMENT_LESS_THAN_SIGN:{this._stateCommentLessThanSign(t);break}case et.COMMENT_LESS_THAN_SIGN_BANG:{this._stateCommentLessThanSignBang(t);break}case et.COMMENT_LESS_THAN_SIGN_BANG_DASH:{this._stateCommentLessThanSignBangDash(t);break}case et.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:{this._stateCommentLessThanSignBangDashDash(t);break}case et.COMMENT_END_DASH:{this._stateCommentEndDash(t);break}case et.COMMENT_END:{this._stateCommentEnd(t);break}case et.COMMENT_END_BANG:{this._stateCommentEndBang(t);break}case et.DOCTYPE:{this._stateDoctype(t);break}case et.BEFORE_DOCTYPE_NAME:{this._stateBeforeDoctypeName(t);break}case et.DOCTYPE_NAME:{this._stateDoctypeName(t);break}case et.AFTER_DOCTYPE_NAME:{this._stateAfterDoctypeName(t);break}case et.AFTER_DOCTYPE_PUBLIC_KEYWORD:{this._stateAfterDoctypePublicKeyword(t);break}case et.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateBeforeDoctypePublicIdentifier(t);break}case et.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypePublicIdentifierDoubleQuoted(t);break}case et.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypePublicIdentifierSingleQuoted(t);break}case et.AFTER_DOCTYPE_PUBLIC_IDENTIFIER:{this._stateAfterDoctypePublicIdentifier(t);break}case et.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS:{this._stateBetweenDoctypePublicAndSystemIdentifiers(t);break}case et.AFTER_DOCTYPE_SYSTEM_KEYWORD:{this._stateAfterDoctypeSystemKeyword(t);break}case et.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateBeforeDoctypeSystemIdentifier(t);break}case et.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED:{this._stateDoctypeSystemIdentifierDoubleQuoted(t);break}case et.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED:{this._stateDoctypeSystemIdentifierSingleQuoted(t);break}case et.AFTER_DOCTYPE_SYSTEM_IDENTIFIER:{this._stateAfterDoctypeSystemIdentifier(t);break}case et.BOGUS_DOCTYPE:{this._stateBogusDoctype(t);break}case et.CDATA_SECTION:{this._stateCdataSection(t);break}case et.CDATA_SECTION_BRACKET:{this._stateCdataSectionBracket(t);break}case et.CDATA_SECTION_END:{this._stateCdataSectionEnd(t);break}case et.CHARACTER_REFERENCE:{this._stateCharacterReference();break}case et.AMBIGUOUS_AMPERSAND:{this._stateAmbiguousAmpersand(t);break}default:throw new Error("Unknown state")}}_stateData(t){switch(t){case Ge.LESS_THAN_SIGN:{this.state=et.TAG_OPEN;break}case Ge.AMPERSAND:{this._startCharacterReference();break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this._emitCodePoint(t);break}case Ge.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateRcdata(t){switch(t){case Ge.AMPERSAND:{this._startCharacterReference();break}case Ge.LESS_THAN_SIGN:{this.state=et.RCDATA_LESS_THAN_SIGN;break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this._emitChars(_o);break}case Ge.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateRawtext(t){switch(t){case Ge.LESS_THAN_SIGN:{this.state=et.RAWTEXT_LESS_THAN_SIGN;break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this._emitChars(_o);break}case Ge.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptData(t){switch(t){case Ge.LESS_THAN_SIGN:{this.state=et.SCRIPT_DATA_LESS_THAN_SIGN;break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this._emitChars(_o);break}case Ge.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_statePlaintext(t){switch(t){case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this._emitChars(_o);break}case Ge.EOF:{this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateTagOpen(t){if(pm(t))this._createStartTagToken(),this.state=et.TAG_NAME,this._stateTagName(t);else switch(t){case Ge.EXCLAMATION_MARK:{this.state=et.MARKUP_DECLARATION_OPEN;break}case Ge.SOLIDUS:{this.state=et.END_TAG_OPEN;break}case Ge.QUESTION_MARK:{this._err(hn.unexpectedQuestionMarkInsteadOfTagName),this._createCommentToken(1),this.state=et.BOGUS_COMMENT,this._stateBogusComment(t);break}case Ge.EOF:{this._err(hn.eofBeforeTagName),this._emitChars("<"),this._emitEOFToken();break}default:this._err(hn.invalidFirstCharacterOfTagName),this._emitChars("<"),this.state=et.DATA,this._stateData(t)}}_stateEndTagOpen(t){if(pm(t))this._createEndTagToken(),this.state=et.TAG_NAME,this._stateTagName(t);else switch(t){case Ge.GREATER_THAN_SIGN:{this._err(hn.missingEndTagName),this.state=et.DATA;break}case Ge.EOF:{this._err(hn.eofBeforeTagName),this._emitChars("</"),this._emitEOFToken();break}default:this._err(hn.invalidFirstCharacterOfTagName),this._createCommentToken(2),this.state=et.BOGUS_COMMENT,this._stateBogusComment(t)}}_stateTagName(t){const n=this.currentToken;switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:{this.state=et.BEFORE_ATTRIBUTE_NAME;break}case Ge.SOLIDUS:{this.state=et.SELF_CLOSING_START_TAG;break}case Ge.GREATER_THAN_SIGN:{this.state=et.DATA,this.emitCurrentTagToken();break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),n.tagName+=_o;break}case Ge.EOF:{this._err(hn.eofInTag),this._emitEOFToken();break}default:n.tagName+=String.fromCodePoint(Ww(t)?O3(t):t)}}_stateRcdataLessThanSign(t){t===Ge.SOLIDUS?this.state=et.RCDATA_END_TAG_OPEN:(this._emitChars("<"),this.state=et.RCDATA,this._stateRcdata(t))}_stateRcdataEndTagOpen(t){pm(t)?(this.state=et.RCDATA_END_TAG_NAME,this._stateRcdataEndTagName(t)):(this._emitChars("</"),this.state=et.RCDATA,this._stateRcdata(t))}handleSpecialEndTag(t){if(!this.preprocessor.startsWith(this.lastStartTagName,!1))return!this._ensureHibernation();this._createEndTagToken();const n=this.currentToken;switch(n.tagName=this.lastStartTagName,this.preprocessor.peek(this.lastStartTagName.length)){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:return this._advanceBy(this.lastStartTagName.length),this.state=et.BEFORE_ATTRIBUTE_NAME,!1;case Ge.SOLIDUS:return this._advanceBy(this.lastStartTagName.length),this.state=et.SELF_CLOSING_START_TAG,!1;case Ge.GREATER_THAN_SIGN:return this._advanceBy(this.lastStartTagName.length),this.emitCurrentTagToken(),this.state=et.DATA,!1;default:return!this._ensureHibernation()}}_stateRcdataEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=et.RCDATA,this._stateRcdata(t))}_stateRawtextLessThanSign(t){t===Ge.SOLIDUS?this.state=et.RAWTEXT_END_TAG_OPEN:(this._emitChars("<"),this.state=et.RAWTEXT,this._stateRawtext(t))}_stateRawtextEndTagOpen(t){pm(t)?(this.state=et.RAWTEXT_END_TAG_NAME,this._stateRawtextEndTagName(t)):(this._emitChars("</"),this.state=et.RAWTEXT,this._stateRawtext(t))}_stateRawtextEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=et.RAWTEXT,this._stateRawtext(t))}_stateScriptDataLessThanSign(t){switch(t){case Ge.SOLIDUS:{this.state=et.SCRIPT_DATA_END_TAG_OPEN;break}case Ge.EXCLAMATION_MARK:{this.state=et.SCRIPT_DATA_ESCAPE_START,this._emitChars("<!");break}default:this._emitChars("<"),this.state=et.SCRIPT_DATA,this._stateScriptData(t)}}_stateScriptDataEndTagOpen(t){pm(t)?(this.state=et.SCRIPT_DATA_END_TAG_NAME,this._stateScriptDataEndTagName(t)):(this._emitChars("</"),this.state=et.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=et.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscapeStart(t){t===Ge.HYPHEN_MINUS?(this.state=et.SCRIPT_DATA_ESCAPE_START_DASH,this._emitChars("-")):(this.state=et.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscapeStartDash(t){t===Ge.HYPHEN_MINUS?(this.state=et.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-")):(this.state=et.SCRIPT_DATA,this._stateScriptData(t))}_stateScriptDataEscaped(t){switch(t){case Ge.HYPHEN_MINUS:{this.state=et.SCRIPT_DATA_ESCAPED_DASH,this._emitChars("-");break}case Ge.LESS_THAN_SIGN:{this.state=et.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this._emitChars(_o);break}case Ge.EOF:{this._err(hn.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptDataEscapedDash(t){switch(t){case Ge.HYPHEN_MINUS:{this.state=et.SCRIPT_DATA_ESCAPED_DASH_DASH,this._emitChars("-");break}case Ge.LESS_THAN_SIGN:{this.state=et.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this.state=et.SCRIPT_DATA_ESCAPED,this._emitChars(_o);break}case Ge.EOF:{this._err(hn.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=et.SCRIPT_DATA_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataEscapedDashDash(t){switch(t){case Ge.HYPHEN_MINUS:{this._emitChars("-");break}case Ge.LESS_THAN_SIGN:{this.state=et.SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN;break}case Ge.GREATER_THAN_SIGN:{this.state=et.SCRIPT_DATA,this._emitChars(">");break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this.state=et.SCRIPT_DATA_ESCAPED,this._emitChars(_o);break}case Ge.EOF:{this._err(hn.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=et.SCRIPT_DATA_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataEscapedLessThanSign(t){t===Ge.SOLIDUS?this.state=et.SCRIPT_DATA_ESCAPED_END_TAG_OPEN:pm(t)?(this._emitChars("<"),this.state=et.SCRIPT_DATA_DOUBLE_ESCAPE_START,this._stateScriptDataDoubleEscapeStart(t)):(this._emitChars("<"),this.state=et.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataEscapedEndTagOpen(t){pm(t)?(this.state=et.SCRIPT_DATA_ESCAPED_END_TAG_NAME,this._stateScriptDataEscapedEndTagName(t)):(this._emitChars("</"),this.state=et.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataEscapedEndTagName(t){this.handleSpecialEndTag(t)&&(this._emitChars("</"),this.state=et.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataDoubleEscapeStart(t){if(this.preprocessor.startsWith(Vu.SCRIPT,!1)&&BV(this.preprocessor.peek(Vu.SCRIPT.length))){this._emitCodePoint(t);for(let n=0;n<Vu.SCRIPT.length;n++)this._emitCodePoint(this._consume());this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED}else this._ensureHibernation()||(this.state=et.SCRIPT_DATA_ESCAPED,this._stateScriptDataEscaped(t))}_stateScriptDataDoubleEscaped(t){switch(t){case Ge.HYPHEN_MINUS:{this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED_DASH,this._emitChars("-");break}case Ge.LESS_THAN_SIGN:{this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this._emitChars(_o);break}case Ge.EOF:{this._err(hn.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedDash(t){switch(t){case Ge.HYPHEN_MINUS:{this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH,this._emitChars("-");break}case Ge.LESS_THAN_SIGN:{this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(_o);break}case Ge.EOF:{this._err(hn.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedDashDash(t){switch(t){case Ge.HYPHEN_MINUS:{this._emitChars("-");break}case Ge.LESS_THAN_SIGN:{this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN,this._emitChars("<");break}case Ge.GREATER_THAN_SIGN:{this.state=et.SCRIPT_DATA,this._emitChars(">");break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitChars(_o);break}case Ge.EOF:{this._err(hn.eofInScriptHtmlCommentLikeText),this._emitEOFToken();break}default:this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED,this._emitCodePoint(t)}}_stateScriptDataDoubleEscapedLessThanSign(t){t===Ge.SOLIDUS?(this.state=et.SCRIPT_DATA_DOUBLE_ESCAPE_END,this._emitChars("/")):(this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(t))}_stateScriptDataDoubleEscapeEnd(t){if(this.preprocessor.startsWith(Vu.SCRIPT,!1)&&BV(this.preprocessor.peek(Vu.SCRIPT.length))){this._emitCodePoint(t);for(let n=0;n<Vu.SCRIPT.length;n++)this._emitCodePoint(this._consume());this.state=et.SCRIPT_DATA_ESCAPED}else this._ensureHibernation()||(this.state=et.SCRIPT_DATA_DOUBLE_ESCAPED,this._stateScriptDataDoubleEscaped(t))}_stateBeforeAttributeName(t){switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:break;case Ge.SOLIDUS:case Ge.GREATER_THAN_SIGN:case Ge.EOF:{this.state=et.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(t);break}case Ge.EQUALS_SIGN:{this._err(hn.unexpectedEqualsSignBeforeAttributeName),this._createAttr("="),this.state=et.ATTRIBUTE_NAME;break}default:this._createAttr(""),this.state=et.ATTRIBUTE_NAME,this._stateAttributeName(t)}}_stateAttributeName(t){switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:case Ge.SOLIDUS:case Ge.GREATER_THAN_SIGN:case Ge.EOF:{this._leaveAttrName(),this.state=et.AFTER_ATTRIBUTE_NAME,this._stateAfterAttributeName(t);break}case Ge.EQUALS_SIGN:{this._leaveAttrName(),this.state=et.BEFORE_ATTRIBUTE_VALUE;break}case Ge.QUOTATION_MARK:case Ge.APOSTROPHE:case Ge.LESS_THAN_SIGN:{this._err(hn.unexpectedCharacterInAttributeName),this.currentAttr.name+=String.fromCodePoint(t);break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this.currentAttr.name+=_o;break}default:this.currentAttr.name+=String.fromCodePoint(Ww(t)?O3(t):t)}}_stateAfterAttributeName(t){switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:break;case Ge.SOLIDUS:{this.state=et.SELF_CLOSING_START_TAG;break}case Ge.EQUALS_SIGN:{this.state=et.BEFORE_ATTRIBUTE_VALUE;break}case Ge.GREATER_THAN_SIGN:{this.state=et.DATA,this.emitCurrentTagToken();break}case Ge.EOF:{this._err(hn.eofInTag),this._emitEOFToken();break}default:this._createAttr(""),this.state=et.ATTRIBUTE_NAME,this._stateAttributeName(t)}}_stateBeforeAttributeValue(t){switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:break;case Ge.QUOTATION_MARK:{this.state=et.ATTRIBUTE_VALUE_DOUBLE_QUOTED;break}case Ge.APOSTROPHE:{this.state=et.ATTRIBUTE_VALUE_SINGLE_QUOTED;break}case Ge.GREATER_THAN_SIGN:{this._err(hn.missingAttributeValue),this.state=et.DATA,this.emitCurrentTagToken();break}default:this.state=et.ATTRIBUTE_VALUE_UNQUOTED,this._stateAttributeValueUnquoted(t)}}_stateAttributeValueDoubleQuoted(t){switch(t){case Ge.QUOTATION_MARK:{this.state=et.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case Ge.AMPERSAND:{this._startCharacterReference();break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this.currentAttr.value+=_o;break}case Ge.EOF:{this._err(hn.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAttributeValueSingleQuoted(t){switch(t){case Ge.APOSTROPHE:{this.state=et.AFTER_ATTRIBUTE_VALUE_QUOTED;break}case Ge.AMPERSAND:{this._startCharacterReference();break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this.currentAttr.value+=_o;break}case Ge.EOF:{this._err(hn.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAttributeValueUnquoted(t){switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:{this._leaveAttrValue(),this.state=et.BEFORE_ATTRIBUTE_NAME;break}case Ge.AMPERSAND:{this._startCharacterReference();break}case Ge.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=et.DATA,this.emitCurrentTagToken();break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this.currentAttr.value+=_o;break}case Ge.QUOTATION_MARK:case Ge.APOSTROPHE:case Ge.LESS_THAN_SIGN:case Ge.EQUALS_SIGN:case Ge.GRAVE_ACCENT:{this._err(hn.unexpectedCharacterInUnquotedAttributeValue),this.currentAttr.value+=String.fromCodePoint(t);break}case Ge.EOF:{this._err(hn.eofInTag),this._emitEOFToken();break}default:this.currentAttr.value+=String.fromCodePoint(t)}}_stateAfterAttributeValueQuoted(t){switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:{this._leaveAttrValue(),this.state=et.BEFORE_ATTRIBUTE_NAME;break}case Ge.SOLIDUS:{this._leaveAttrValue(),this.state=et.SELF_CLOSING_START_TAG;break}case Ge.GREATER_THAN_SIGN:{this._leaveAttrValue(),this.state=et.DATA,this.emitCurrentTagToken();break}case Ge.EOF:{this._err(hn.eofInTag),this._emitEOFToken();break}default:this._err(hn.missingWhitespaceBetweenAttributes),this.state=et.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(t)}}_stateSelfClosingStartTag(t){switch(t){case Ge.GREATER_THAN_SIGN:{const n=this.currentToken;n.selfClosing=!0,this.state=et.DATA,this.emitCurrentTagToken();break}case Ge.EOF:{this._err(hn.eofInTag),this._emitEOFToken();break}default:this._err(hn.unexpectedSolidusInTag),this.state=et.BEFORE_ATTRIBUTE_NAME,this._stateBeforeAttributeName(t)}}_stateBogusComment(t){const n=this.currentToken;switch(t){case Ge.GREATER_THAN_SIGN:{this.state=et.DATA,this.emitCurrentComment(n);break}case Ge.EOF:{this.emitCurrentComment(n),this._emitEOFToken();break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),n.data+=_o;break}default:n.data+=String.fromCodePoint(t)}}_stateMarkupDeclarationOpen(t){this._consumeSequenceIfMatch(Vu.DASH_DASH,!0)?(this._createCommentToken(Vu.DASH_DASH.length+1),this.state=et.COMMENT_START):this._consumeSequenceIfMatch(Vu.DOCTYPE,!1)?(this.currentLocation=this.getCurrentLocation(Vu.DOCTYPE.length+1),this.state=et.DOCTYPE):this._consumeSequenceIfMatch(Vu.CDATA_START,!0)?this.inForeignNode?this.state=et.CDATA_SECTION:(this._err(hn.cdataInHtmlContent),this._createCommentToken(Vu.CDATA_START.length+1),this.currentToken.data="[CDATA[",this.state=et.BOGUS_COMMENT):this._ensureHibernation()||(this._err(hn.incorrectlyOpenedComment),this._createCommentToken(2),this.state=et.BOGUS_COMMENT,this._stateBogusComment(t))}_stateCommentStart(t){switch(t){case Ge.HYPHEN_MINUS:{this.state=et.COMMENT_START_DASH;break}case Ge.GREATER_THAN_SIGN:{this._err(hn.abruptClosingOfEmptyComment),this.state=et.DATA;const n=this.currentToken;this.emitCurrentComment(n);break}default:this.state=et.COMMENT,this._stateComment(t)}}_stateCommentStartDash(t){const n=this.currentToken;switch(t){case Ge.HYPHEN_MINUS:{this.state=et.COMMENT_END;break}case Ge.GREATER_THAN_SIGN:{this._err(hn.abruptClosingOfEmptyComment),this.state=et.DATA,this.emitCurrentComment(n);break}case Ge.EOF:{this._err(hn.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="-",this.state=et.COMMENT,this._stateComment(t)}}_stateComment(t){const n=this.currentToken;switch(t){case Ge.HYPHEN_MINUS:{this.state=et.COMMENT_END_DASH;break}case Ge.LESS_THAN_SIGN:{n.data+="<",this.state=et.COMMENT_LESS_THAN_SIGN;break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),n.data+=_o;break}case Ge.EOF:{this._err(hn.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+=String.fromCodePoint(t)}}_stateCommentLessThanSign(t){const n=this.currentToken;switch(t){case Ge.EXCLAMATION_MARK:{n.data+="!",this.state=et.COMMENT_LESS_THAN_SIGN_BANG;break}case Ge.LESS_THAN_SIGN:{n.data+="<";break}default:this.state=et.COMMENT,this._stateComment(t)}}_stateCommentLessThanSignBang(t){t===Ge.HYPHEN_MINUS?this.state=et.COMMENT_LESS_THAN_SIGN_BANG_DASH:(this.state=et.COMMENT,this._stateComment(t))}_stateCommentLessThanSignBangDash(t){t===Ge.HYPHEN_MINUS?this.state=et.COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH:(this.state=et.COMMENT_END_DASH,this._stateCommentEndDash(t))}_stateCommentLessThanSignBangDashDash(t){t!==Ge.GREATER_THAN_SIGN&&t!==Ge.EOF&&this._err(hn.nestedComment),this.state=et.COMMENT_END,this._stateCommentEnd(t)}_stateCommentEndDash(t){const n=this.currentToken;switch(t){case Ge.HYPHEN_MINUS:{this.state=et.COMMENT_END;break}case Ge.EOF:{this._err(hn.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="-",this.state=et.COMMENT,this._stateComment(t)}}_stateCommentEnd(t){const n=this.currentToken;switch(t){case Ge.GREATER_THAN_SIGN:{this.state=et.DATA,this.emitCurrentComment(n);break}case Ge.EXCLAMATION_MARK:{this.state=et.COMMENT_END_BANG;break}case Ge.HYPHEN_MINUS:{n.data+="-";break}case Ge.EOF:{this._err(hn.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="--",this.state=et.COMMENT,this._stateComment(t)}}_stateCommentEndBang(t){const n=this.currentToken;switch(t){case Ge.HYPHEN_MINUS:{n.data+="--!",this.state=et.COMMENT_END_DASH;break}case Ge.GREATER_THAN_SIGN:{this._err(hn.incorrectlyClosedComment),this.state=et.DATA,this.emitCurrentComment(n);break}case Ge.EOF:{this._err(hn.eofInComment),this.emitCurrentComment(n),this._emitEOFToken();break}default:n.data+="--!",this.state=et.COMMENT,this._stateComment(t)}}_stateDoctype(t){switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:{this.state=et.BEFORE_DOCTYPE_NAME;break}case Ge.GREATER_THAN_SIGN:{this.state=et.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(t);break}case Ge.EOF:{this._err(hn.eofInDoctype),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.missingWhitespaceBeforeDoctypeName),this.state=et.BEFORE_DOCTYPE_NAME,this._stateBeforeDoctypeName(t)}}_stateBeforeDoctypeName(t){if(Ww(t))this._createDoctypeToken(String.fromCharCode(O3(t))),this.state=et.DOCTYPE_NAME;else switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:break;case Ge.NULL:{this._err(hn.unexpectedNullCharacter),this._createDoctypeToken(_o),this.state=et.DOCTYPE_NAME;break}case Ge.GREATER_THAN_SIGN:{this._err(hn.missingDoctypeName),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=et.DATA;break}case Ge.EOF:{this._err(hn.eofInDoctype),this._createDoctypeToken(null);const n=this.currentToken;n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._createDoctypeToken(String.fromCodePoint(t)),this.state=et.DOCTYPE_NAME}}_stateDoctypeName(t){const n=this.currentToken;switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:{this.state=et.AFTER_DOCTYPE_NAME;break}case Ge.GREATER_THAN_SIGN:{this.state=et.DATA,this.emitCurrentDoctype(n);break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),n.name+=_o;break}case Ge.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.name+=String.fromCodePoint(Ww(t)?O3(t):t)}}_stateAfterDoctypeName(t){const n=this.currentToken;switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:break;case Ge.GREATER_THAN_SIGN:{this.state=et.DATA,this.emitCurrentDoctype(n);break}case Ge.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._consumeSequenceIfMatch(Vu.PUBLIC,!1)?this.state=et.AFTER_DOCTYPE_PUBLIC_KEYWORD:this._consumeSequenceIfMatch(Vu.SYSTEM,!1)?this.state=et.AFTER_DOCTYPE_SYSTEM_KEYWORD:this._ensureHibernation()||(this._err(hn.invalidCharacterSequenceAfterDoctypeName),n.forceQuirks=!0,this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t))}}_stateAfterDoctypePublicKeyword(t){const n=this.currentToken;switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:{this.state=et.BEFORE_DOCTYPE_PUBLIC_IDENTIFIER;break}case Ge.QUOTATION_MARK:{this._err(hn.missingWhitespaceAfterDoctypePublicKeyword),n.publicId="",this.state=et.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case Ge.APOSTROPHE:{this._err(hn.missingWhitespaceAfterDoctypePublicKeyword),n.publicId="",this.state=et.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case Ge.GREATER_THAN_SIGN:{this._err(hn.missingDoctypePublicIdentifier),n.forceQuirks=!0,this.state=et.DATA,this.emitCurrentDoctype(n);break}case Ge.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.missingQuoteBeforeDoctypePublicIdentifier),n.forceQuirks=!0,this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBeforeDoctypePublicIdentifier(t){const n=this.currentToken;switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:break;case Ge.QUOTATION_MARK:{n.publicId="",this.state=et.DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED;break}case Ge.APOSTROPHE:{n.publicId="",this.state=et.DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED;break}case Ge.GREATER_THAN_SIGN:{this._err(hn.missingDoctypePublicIdentifier),n.forceQuirks=!0,this.state=et.DATA,this.emitCurrentDoctype(n);break}case Ge.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.missingQuoteBeforeDoctypePublicIdentifier),n.forceQuirks=!0,this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateDoctypePublicIdentifierDoubleQuoted(t){const n=this.currentToken;switch(t){case Ge.QUOTATION_MARK:{this.state=et.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),n.publicId+=_o;break}case Ge.GREATER_THAN_SIGN:{this._err(hn.abruptDoctypePublicIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=et.DATA;break}case Ge.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.publicId+=String.fromCodePoint(t)}}_stateDoctypePublicIdentifierSingleQuoted(t){const n=this.currentToken;switch(t){case Ge.APOSTROPHE:{this.state=et.AFTER_DOCTYPE_PUBLIC_IDENTIFIER;break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),n.publicId+=_o;break}case Ge.GREATER_THAN_SIGN:{this._err(hn.abruptDoctypePublicIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=et.DATA;break}case Ge.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.publicId+=String.fromCodePoint(t)}}_stateAfterDoctypePublicIdentifier(t){const n=this.currentToken;switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:{this.state=et.BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS;break}case Ge.GREATER_THAN_SIGN:{this.state=et.DATA,this.emitCurrentDoctype(n);break}case Ge.QUOTATION_MARK:{this._err(hn.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case Ge.APOSTROPHE:{this._err(hn.missingWhitespaceBetweenDoctypePublicAndSystemIdentifiers),n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case Ge.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBetweenDoctypePublicAndSystemIdentifiers(t){const n=this.currentToken;switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:break;case Ge.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=et.DATA;break}case Ge.QUOTATION_MARK:{n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case Ge.APOSTROPHE:{n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case Ge.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateAfterDoctypeSystemKeyword(t){const n=this.currentToken;switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:{this.state=et.BEFORE_DOCTYPE_SYSTEM_IDENTIFIER;break}case Ge.QUOTATION_MARK:{this._err(hn.missingWhitespaceAfterDoctypeSystemKeyword),n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case Ge.APOSTROPHE:{this._err(hn.missingWhitespaceAfterDoctypeSystemKeyword),n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case Ge.GREATER_THAN_SIGN:{this._err(hn.missingDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=et.DATA,this.emitCurrentDoctype(n);break}case Ge.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBeforeDoctypeSystemIdentifier(t){const n=this.currentToken;switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:break;case Ge.QUOTATION_MARK:{n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED;break}case Ge.APOSTROPHE:{n.systemId="",this.state=et.DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED;break}case Ge.GREATER_THAN_SIGN:{this._err(hn.missingDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=et.DATA,this.emitCurrentDoctype(n);break}case Ge.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.missingQuoteBeforeDoctypeSystemIdentifier),n.forceQuirks=!0,this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateDoctypeSystemIdentifierDoubleQuoted(t){const n=this.currentToken;switch(t){case Ge.QUOTATION_MARK:{this.state=et.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),n.systemId+=_o;break}case Ge.GREATER_THAN_SIGN:{this._err(hn.abruptDoctypeSystemIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=et.DATA;break}case Ge.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.systemId+=String.fromCodePoint(t)}}_stateDoctypeSystemIdentifierSingleQuoted(t){const n=this.currentToken;switch(t){case Ge.APOSTROPHE:{this.state=et.AFTER_DOCTYPE_SYSTEM_IDENTIFIER;break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter),n.systemId+=_o;break}case Ge.GREATER_THAN_SIGN:{this._err(hn.abruptDoctypeSystemIdentifier),n.forceQuirks=!0,this.emitCurrentDoctype(n),this.state=et.DATA;break}case Ge.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:n.systemId+=String.fromCodePoint(t)}}_stateAfterDoctypeSystemIdentifier(t){const n=this.currentToken;switch(t){case Ge.SPACE:case Ge.LINE_FEED:case Ge.TABULATION:case Ge.FORM_FEED:break;case Ge.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=et.DATA;break}case Ge.EOF:{this._err(hn.eofInDoctype),n.forceQuirks=!0,this.emitCurrentDoctype(n),this._emitEOFToken();break}default:this._err(hn.unexpectedCharacterAfterDoctypeSystemIdentifier),this.state=et.BOGUS_DOCTYPE,this._stateBogusDoctype(t)}}_stateBogusDoctype(t){const n=this.currentToken;switch(t){case Ge.GREATER_THAN_SIGN:{this.emitCurrentDoctype(n),this.state=et.DATA;break}case Ge.NULL:{this._err(hn.unexpectedNullCharacter);break}case Ge.EOF:{this.emitCurrentDoctype(n),this._emitEOFToken();break}}}_stateCdataSection(t){switch(t){case Ge.RIGHT_SQUARE_BRACKET:{this.state=et.CDATA_SECTION_BRACKET;break}case Ge.EOF:{this._err(hn.eofInCdata),this._emitEOFToken();break}default:this._emitCodePoint(t)}}_stateCdataSectionBracket(t){t===Ge.RIGHT_SQUARE_BRACKET?this.state=et.CDATA_SECTION_END:(this._emitChars("]"),this.state=et.CDATA_SECTION,this._stateCdataSection(t))}_stateCdataSectionEnd(t){switch(t){case Ge.GREATER_THAN_SIGN:{this.state=et.DATA;break}case Ge.RIGHT_SQUARE_BRACKET:{this._emitChars("]");break}default:this._emitChars("]]"),this.state=et.CDATA_SECTION,this._stateCdataSection(t)}}_stateCharacterReference(){let t=this.entityDecoder.write(this.preprocessor.html,this.preprocessor.pos);if(t<0)if(this.preprocessor.lastChunkWritten)t=this.entityDecoder.end();else{this.active=!1,this.preprocessor.pos=this.preprocessor.html.length-1,this.consumedAfterSnapshot=0,this.preprocessor.endOfChunkHit=!0;return}t===0?(this.preprocessor.pos=this.entityStartPos,this._flushCodePointConsumedAsCharacterReference(Ge.AMPERSAND),this.state=!this._isCharacterReferenceInAttribute()&&FV(this.preprocessor.peek(1))?et.AMBIGUOUS_AMPERSAND:this.returnState):this.state=this.returnState}_stateAmbiguousAmpersand(t){FV(t)?this._flushCodePointConsumedAsCharacterReference(t):(t===Ge.SEMICOLON&&this._err(hn.unknownNamedCharacterReference),this.state=this.returnState,this._callState(t))}}const TJ=new Set([Q.DD,Q.DT,Q.LI,Q.OPTGROUP,Q.OPTION,Q.P,Q.RB,Q.RP,Q.RT,Q.RTC]),jV=new Set([...TJ,Q.CAPTION,Q.COLGROUP,Q.TBODY,Q.TD,Q.TFOOT,Q.TH,Q.THEAD,Q.TR]),aC=new Set([Q.APPLET,Q.CAPTION,Q.HTML,Q.MARQUEE,Q.OBJECT,Q.TABLE,Q.TD,Q.TEMPLATE,Q.TH]),fTe=new Set([...aC,Q.OL,Q.UL]),pTe=new Set([...aC,Q.BUTTON]),UV=new Set([Q.ANNOTATION_XML,Q.MI,Q.MN,Q.MO,Q.MS,Q.MTEXT]),VV=new Set([Q.DESC,Q.FOREIGN_OBJECT,Q.TITLE]),mTe=new Set([Q.TR,Q.TEMPLATE,Q.HTML]),gTe=new Set([Q.TBODY,Q.TFOOT,Q.THEAD,Q.TEMPLATE,Q.HTML]),_Te=new Set([Q.TABLE,Q.TEMPLATE,Q.HTML]),yTe=new Set([Q.TD,Q.TH]);class vTe{get currentTmplContentOrNode(){return this._isInTemplate()?this.treeAdapter.getTemplateContent(this.current):this.current}constructor(t,n,r){this.treeAdapter=n,this.handler=r,this.items=[],this.tagIDs=[],this.stackTop=-1,this.tmplCount=0,this.currentTagId=Q.UNKNOWN,this.current=t}_indexOf(t){return this.items.lastIndexOf(t,this.stackTop)}_isInTemplate(){return this.currentTagId===Q.TEMPLATE&&this.treeAdapter.getNamespaceURI(this.current)===Gn.HTML}_updateCurrentElement(){this.current=this.items[this.stackTop],this.currentTagId=this.tagIDs[this.stackTop]}push(t,n){this.stackTop++,this.items[this.stackTop]=t,this.current=t,this.tagIDs[this.stackTop]=n,this.currentTagId=n,this._isInTemplate()&&this.tmplCount++,this.handler.onItemPush(t,n,!0)}pop(){const t=this.current;this.tmplCount>0&&this._isInTemplate()&&this.tmplCount--,this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(t,!0)}replace(t,n){const r=this._indexOf(t);this.items[r]=n,r===this.stackTop&&(this.current=n)}insertAfter(t,n,r){const a=this._indexOf(t)+1;this.items.splice(a,0,n),this.tagIDs.splice(a,0,r),this.stackTop++,a===this.stackTop&&this._updateCurrentElement(),this.current&&this.currentTagId!==void 0&&this.handler.onItemPush(this.current,this.currentTagId,a===this.stackTop)}popUntilTagNamePopped(t){let n=this.stackTop+1;do n=this.tagIDs.lastIndexOf(t,n-1);while(n>0&&this.treeAdapter.getNamespaceURI(this.items[n])!==Gn.HTML);this.shortenToLength(Math.max(n,0))}shortenToLength(t){for(;this.stackTop>=t;){const n=this.current;this.tmplCount>0&&this._isInTemplate()&&(this.tmplCount-=1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(n,this.stackTop<t)}}popUntilElementPopped(t){const n=this._indexOf(t);this.shortenToLength(Math.max(n,0))}popUntilPopped(t,n){const r=this._indexOfTagNames(t,n);this.shortenToLength(Math.max(r,0))}popUntilNumberedHeaderPopped(){this.popUntilPopped(c8,Gn.HTML)}popUntilTableCellPopped(){this.popUntilPopped(yTe,Gn.HTML)}popAllUpToHtmlElement(){this.tmplCount=0,this.shortenToLength(1)}_indexOfTagNames(t,n){for(let r=this.stackTop;r>=0;r--)if(t.has(this.tagIDs[r])&&this.treeAdapter.getNamespaceURI(this.items[r])===n)return r;return-1}clearBackTo(t,n){const r=this._indexOfTagNames(t,n);this.shortenToLength(r+1)}clearBackToTableContext(){this.clearBackTo(_Te,Gn.HTML)}clearBackToTableBodyContext(){this.clearBackTo(gTe,Gn.HTML)}clearBackToTableRowContext(){this.clearBackTo(mTe,Gn.HTML)}remove(t){const n=this._indexOf(t);n>=0&&(n===this.stackTop?this.pop():(this.items.splice(n,1),this.tagIDs.splice(n,1),this.stackTop--,this._updateCurrentElement(),this.handler.onItemPop(t,!1)))}tryPeekProperlyNestedBodyElement(){return this.stackTop>=1&&this.tagIDs[1]===Q.BODY?this.items[1]:null}contains(t){return this._indexOf(t)>-1}getCommonAncestor(t){const n=this._indexOf(t)-1;return n>=0?this.items[n]:null}isRootHtmlElementCurrent(){return this.stackTop===0&&this.tagIDs[0]===Q.HTML}hasInDynamicScope(t,n){for(let r=this.stackTop;r>=0;r--){const a=this.tagIDs[r];switch(this.treeAdapter.getNamespaceURI(this.items[r])){case Gn.HTML:{if(a===t)return!0;if(n.has(a))return!1;break}case Gn.SVG:{if(VV.has(a))return!1;break}case Gn.MATHML:{if(UV.has(a))return!1;break}}}return!0}hasInScope(t){return this.hasInDynamicScope(t,aC)}hasInListItemScope(t){return this.hasInDynamicScope(t,fTe)}hasInButtonScope(t){return this.hasInDynamicScope(t,pTe)}hasNumberedHeaderInScope(){for(let t=this.stackTop;t>=0;t--){const n=this.tagIDs[t];switch(this.treeAdapter.getNamespaceURI(this.items[t])){case Gn.HTML:{if(c8.has(n))return!0;if(aC.has(n))return!1;break}case Gn.SVG:{if(VV.has(n))return!1;break}case Gn.MATHML:{if(UV.has(n))return!1;break}}}return!0}hasInTableScope(t){for(let n=this.stackTop;n>=0;n--)if(this.treeAdapter.getNamespaceURI(this.items[n])===Gn.HTML)switch(this.tagIDs[n]){case t:return!0;case Q.TABLE:case Q.HTML:return!1}return!0}hasTableBodyContextInTableScope(){for(let t=this.stackTop;t>=0;t--)if(this.treeAdapter.getNamespaceURI(this.items[t])===Gn.HTML)switch(this.tagIDs[t]){case Q.TBODY:case Q.THEAD:case Q.TFOOT:return!0;case Q.TABLE:case Q.HTML:return!1}return!0}hasInSelectScope(t){for(let n=this.stackTop;n>=0;n--)if(this.treeAdapter.getNamespaceURI(this.items[n])===Gn.HTML)switch(this.tagIDs[n]){case t:return!0;case Q.OPTION:case Q.OPTGROUP:break;default:return!1}return!0}generateImpliedEndTags(){for(;this.currentTagId!==void 0&&TJ.has(this.currentTagId);)this.pop()}generateImpliedEndTagsThoroughly(){for(;this.currentTagId!==void 0&&jV.has(this.currentTagId);)this.pop()}generateImpliedEndTagsWithExclusion(t){for(;this.currentTagId!==void 0&&this.currentTagId!==t&&jV.has(this.currentTagId);)this.pop()}}const K5=3;var qh;(function(e){e[e.Marker=0]="Marker",e[e.Element=1]="Element"})(qh||(qh={}));const $V={type:qh.Marker};class xTe{constructor(t){this.treeAdapter=t,this.entries=[],this.bookmark=null}_getNoahArkConditionCandidates(t,n){const r=[],a=n.length,u=this.treeAdapter.getTagName(t),f=this.treeAdapter.getNamespaceURI(t);for(let s=0;s<this.entries.length;s++){const v=this.entries[s];if(v.type===qh.Marker)break;const{element:x}=v;if(this.treeAdapter.getTagName(x)===u&&this.treeAdapter.getNamespaceURI(x)===f){const A=this.treeAdapter.getAttrList(x);A.length===a&&r.push({idx:s,attrs:A})}}return r}_ensureNoahArkCondition(t){if(this.entries.length<K5)return;const n=this.treeAdapter.getAttrList(t),r=this._getNoahArkConditionCandidates(t,n);if(r.length<K5)return;const a=new Map(n.map(f=>[f.name,f.value]));let u=0;for(let f=0;f<r.length;f++){const s=r[f];s.attrs.every(v=>a.get(v.name)===v.value)&&(u+=1,u>=K5&&this.entries.splice(s.idx,1))}}insertMarker(){this.entries.unshift($V)}pushElement(t,n){this._ensureNoahArkCondition(t),this.entries.unshift({type:qh.Element,element:t,token:n})}insertElementAfterBookmark(t,n){const r=this.entries.indexOf(this.bookmark);this.entries.splice(r,0,{type:qh.Element,element:t,token:n})}removeEntry(t){const n=this.entries.indexOf(t);n!==-1&&this.entries.splice(n,1)}clearToLastMarker(){const t=this.entries.indexOf($V);t===-1?this.entries.length=0:this.entries.splice(0,t+1)}getElementEntryInScopeWithTagName(t){const n=this.entries.find(r=>r.type===qh.Marker||this.treeAdapter.getTagName(r.element)===t);return n&&n.type===qh.Element?n:null}getElementEntry(t){return this.entries.find(n=>n.type===qh.Element&&n.element===t)}}const mm={createDocument(){return{nodeName:"#document",mode:id.NO_QUIRKS,childNodes:[]}},createDocumentFragment(){return{nodeName:"#document-fragment",childNodes:[]}},createElement(e,t,n){return{nodeName:e,tagName:e,attrs:n,namespaceURI:t,childNodes:[],parentNode:null}},createCommentNode(e){return{nodeName:"#comment",data:e,parentNode:null}},createTextNode(e){return{nodeName:"#text",value:e,parentNode:null}},appendChild(e,t){e.childNodes.push(t),t.parentNode=e},insertBefore(e,t,n){const r=e.childNodes.indexOf(n);e.childNodes.splice(r,0,t),t.parentNode=e},setTemplateContent(e,t){e.content=t},getTemplateContent(e){return e.content},setDocumentType(e,t,n,r){const a=e.childNodes.find(u=>u.nodeName==="#documentType");if(a)a.name=t,a.publicId=n,a.systemId=r;else{const u={nodeName:"#documentType",name:t,publicId:n,systemId:r,parentNode:null};mm.appendChild(e,u)}},setDocumentMode(e,t){e.mode=t},getDocumentMode(e){return e.mode},detachNode(e){if(e.parentNode){const t=e.parentNode.childNodes.indexOf(e);e.parentNode.childNodes.splice(t,1),e.parentNode=null}},insertText(e,t){if(e.childNodes.length>0){const n=e.childNodes[e.childNodes.length-1];if(mm.isTextNode(n)){n.value+=t;return}}mm.appendChild(e,mm.createTextNode(t))},insertTextBefore(e,t,n){const r=e.childNodes[e.childNodes.indexOf(n)-1];r&&mm.isTextNode(r)?r.value+=t:mm.insertBefore(e,mm.createTextNode(t),n)},adoptAttributes(e,t){const n=new Set(e.attrs.map(r=>r.name));for(let r=0;r<t.length;r++)n.has(t[r].name)||e.attrs.push(t[r])},getFirstChild(e){return e.childNodes[0]},getChildNodes(e){return e.childNodes},getParentNode(e){return e.parentNode},getAttrList(e){return e.attrs},getTagName(e){return e.tagName},getNamespaceURI(e){return e.namespaceURI},getTextNodeContent(e){return e.value},getCommentNodeContent(e){return e.data},getDocumentTypeNodeName(e){return e.name},getDocumentTypeNodePublicId(e){return e.publicId},getDocumentTypeNodeSystemId(e){return e.systemId},isTextNode(e){return e.nodeName==="#text"},isCommentNode(e){return e.nodeName==="#comment"},isDocumentTypeNode(e){return e.nodeName==="#documentType"},isElementNode(e){return Object.prototype.hasOwnProperty.call(e,"tagName")},setNodeSourceCodeLocation(e,t){e.sourceCodeLocation=t},getNodeSourceCodeLocation(e){return e.sourceCodeLocation},updateNodeSourceCodeLocation(e,t){e.sourceCodeLocation={...e.sourceCodeLocation,...t}}},EJ="html",bTe="about:legacy-compat",wTe="http://www.ibm.com/data/dtd/v11/ibmxhtml1-transitional.dtd",SJ=["+//silmaril//dtd html pro v0r11 19970101//","-//as//dtd html 3.0 aswedit + extensions//","-//advasoft ltd//dtd html 3.0 aswedit + extensions//","-//ietf//dtd html 2.0 level 1//","-//ietf//dtd html 2.0 level 2//","-//ietf//dtd html 2.0 strict level 1//","-//ietf//dtd html 2.0 strict level 2//","-//ietf//dtd html 2.0 strict//","-//ietf//dtd html 2.0//","-//ietf//dtd html 2.1e//","-//ietf//dtd html 3.0//","-//ietf//dtd html 3.2 final//","-//ietf//dtd html 3.2//","-//ietf//dtd html 3//","-//ietf//dtd html level 0//","-//ietf//dtd html level 1//","-//ietf//dtd html level 2//","-//ietf//dtd html level 3//","-//ietf//dtd html strict level 0//","-//ietf//dtd html strict level 1//","-//ietf//dtd html strict level 2//","-//ietf//dtd html strict level 3//","-//ietf//dtd html strict//","-//ietf//dtd html//","-//metrius//dtd metrius presentational//","-//microsoft//dtd internet explorer 2.0 html strict//","-//microsoft//dtd internet explorer 2.0 html//","-//microsoft//dtd internet explorer 2.0 tables//","-//microsoft//dtd internet explorer 3.0 html strict//","-//microsoft//dtd internet explorer 3.0 html//","-//microsoft//dtd internet explorer 3.0 tables//","-//netscape comm. corp.//dtd html//","-//netscape comm. corp.//dtd strict html//","-//o'reilly and associates//dtd html 2.0//","-//o'reilly and associates//dtd html extended 1.0//","-//o'reilly and associates//dtd html extended relaxed 1.0//","-//sq//dtd html 2.0 hotmetal + extensions//","-//softquad software//dtd hotmetal pro 6.0::19990601::extensions to html 4.0//","-//softquad//dtd hotmetal pro 4.0::19971010::extensions to html 4.0//","-//spyglass//dtd html 2.0 extended//","-//sun microsystems corp.//dtd hotjava html//","-//sun microsystems corp.//dtd hotjava strict html//","-//w3c//dtd html 3 1995-03-24//","-//w3c//dtd html 3.2 draft//","-//w3c//dtd html 3.2 final//","-//w3c//dtd html 3.2//","-//w3c//dtd html 3.2s draft//","-//w3c//dtd html 4.0 frameset//","-//w3c//dtd html 4.0 transitional//","-//w3c//dtd html experimental 19960712//","-//w3c//dtd html experimental 970421//","-//w3c//dtd w3 html//","-//w3o//dtd w3 html 3.0//","-//webtechs//dtd mozilla html 2.0//","-//webtechs//dtd mozilla html//"],TTe=[...SJ,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"],ETe=new Set(["-//w3o//dtd w3 html strict 3.0//en//","-/w3c/dtd html 4.0 transitional/en","html"]),AJ=["-//w3c//dtd xhtml 1.0 frameset//","-//w3c//dtd xhtml 1.0 transitional//"],STe=[...AJ,"-//w3c//dtd html 4.01 frameset//","-//w3c//dtd html 4.01 transitional//"];function HV(e,t){return t.some(n=>e.startsWith(n))}function ATe(e){return e.name===EJ&&e.publicId===null&&(e.systemId===null||e.systemId===bTe)}function CTe(e){if(e.name!==EJ)return id.QUIRKS;const{systemId:t}=e;if(t&&t.toLowerCase()===wTe)return id.QUIRKS;let{publicId:n}=e;if(n!==null){if(n=n.toLowerCase(),ETe.has(n))return id.QUIRKS;let r=t===null?TTe:SJ;if(HV(n,r))return id.QUIRKS;if(r=t===null?AJ:STe,HV(n,r))return id.LIMITED_QUIRKS}return id.NO_QUIRKS}const GV={TEXT_HTML:"text/html",APPLICATION_XML:"application/xhtml+xml"},kTe="definitionurl",ITe="definitionURL",RTe=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(e=>[e.toLowerCase(),e])),MTe=new Map([["xlink:actuate",{prefix:"xlink",name:"actuate",namespace:Gn.XLINK}],["xlink:arcrole",{prefix:"xlink",name:"arcrole",namespace:Gn.XLINK}],["xlink:href",{prefix:"xlink",name:"href",namespace:Gn.XLINK}],["xlink:role",{prefix:"xlink",name:"role",namespace:Gn.XLINK}],["xlink:show",{prefix:"xlink",name:"show",namespace:Gn.XLINK}],["xlink:title",{prefix:"xlink",name:"title",namespace:Gn.XLINK}],["xlink:type",{prefix:"xlink",name:"type",namespace:Gn.XLINK}],["xml:lang",{prefix:"xml",name:"lang",namespace:Gn.XML}],["xml:space",{prefix:"xml",name:"space",namespace:Gn.XML}],["xmlns",{prefix:"",name:"xmlns",namespace:Gn.XMLNS}],["xmlns:xlink",{prefix:"xmlns",name:"xlink",namespace:Gn.XMLNS}]]),PTe=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(e=>[e.toLowerCase(),e])),OTe=new Set([Q.B,Q.BIG,Q.BLOCKQUOTE,Q.BODY,Q.BR,Q.CENTER,Q.CODE,Q.DD,Q.DIV,Q.DL,Q.DT,Q.EM,Q.EMBED,Q.H1,Q.H2,Q.H3,Q.H4,Q.H5,Q.H6,Q.HEAD,Q.HR,Q.I,Q.IMG,Q.LI,Q.LISTING,Q.MENU,Q.META,Q.NOBR,Q.OL,Q.P,Q.PRE,Q.RUBY,Q.S,Q.SMALL,Q.SPAN,Q.STRONG,Q.STRIKE,Q.SUB,Q.SUP,Q.TABLE,Q.TT,Q.U,Q.UL,Q.VAR]);function LTe(e){const t=e.tagID;return t===Q.FONT&&e.attrs.some(({name:r})=>r===Xg.COLOR||r===Xg.SIZE||r===Xg.FACE)||OTe.has(t)}function CJ(e){for(let t=0;t<e.attrs.length;t++)if(e.attrs[t].name===kTe){e.attrs[t].name=ITe;break}}function kJ(e){for(let t=0;t<e.attrs.length;t++){const n=RTe.get(e.attrs[t].name);n!=null&&(e.attrs[t].name=n)}}function cD(e){for(let t=0;t<e.attrs.length;t++){const n=MTe.get(e.attrs[t].name);n&&(e.attrs[t].prefix=n.prefix,e.attrs[t].name=n.name,e.attrs[t].namespace=n.namespace)}}function DTe(e){const t=PTe.get(e.tagName);t!=null&&(e.tagName=t,e.tagID=px(e.tagName))}function NTe(e,t){return t===Gn.MATHML&&(e===Q.MI||e===Q.MO||e===Q.MN||e===Q.MS||e===Q.MTEXT)}function zTe(e,t,n){if(t===Gn.MATHML&&e===Q.ANNOTATION_XML){for(let r=0;r<n.length;r++)if(n[r].name===Xg.ENCODING){const a=n[r].value.toLowerCase();return a===GV.TEXT_HTML||a===GV.APPLICATION_XML}}return t===Gn.SVG&&(e===Q.FOREIGN_OBJECT||e===Q.DESC||e===Q.TITLE)}function FTe(e,t,n,r){return(!r||r===Gn.HTML)&&zTe(e,t,n)||(!r||r===Gn.MATHML)&&NTe(e,t)}const BTe="hidden",jTe=8,UTe=3;var ot;(function(e){e[e.INITIAL=0]="INITIAL",e[e.BEFORE_HTML=1]="BEFORE_HTML",e[e.BEFORE_HEAD=2]="BEFORE_HEAD",e[e.IN_HEAD=3]="IN_HEAD",e[e.IN_HEAD_NO_SCRIPT=4]="IN_HEAD_NO_SCRIPT",e[e.AFTER_HEAD=5]="AFTER_HEAD",e[e.IN_BODY=6]="IN_BODY",e[e.TEXT=7]="TEXT",e[e.IN_TABLE=8]="IN_TABLE",e[e.IN_TABLE_TEXT=9]="IN_TABLE_TEXT",e[e.IN_CAPTION=10]="IN_CAPTION",e[e.IN_COLUMN_GROUP=11]="IN_COLUMN_GROUP",e[e.IN_TABLE_BODY=12]="IN_TABLE_BODY",e[e.IN_ROW=13]="IN_ROW",e[e.IN_CELL=14]="IN_CELL",e[e.IN_SELECT=15]="IN_SELECT",e[e.IN_SELECT_IN_TABLE=16]="IN_SELECT_IN_TABLE",e[e.IN_TEMPLATE=17]="IN_TEMPLATE",e[e.AFTER_BODY=18]="AFTER_BODY",e[e.IN_FRAMESET=19]="IN_FRAMESET",e[e.AFTER_FRAMESET=20]="AFTER_FRAMESET",e[e.AFTER_AFTER_BODY=21]="AFTER_AFTER_BODY",e[e.AFTER_AFTER_FRAMESET=22]="AFTER_AFTER_FRAMESET"})(ot||(ot={}));const VTe={startLine:-1,startCol:-1,startOffset:-1,endLine:-1,endCol:-1,endOffset:-1},IJ=new Set([Q.TABLE,Q.TBODY,Q.TFOOT,Q.THEAD,Q.TR]),qV={scriptingEnabled:!0,sourceCodeLocationInfo:!1,treeAdapter:mm,onParseError:null};class WV{constructor(t,n,r=null,a=null){this.fragmentContext=r,this.scriptHandler=a,this.currentToken=null,this.stopped=!1,this.insertionMode=ot.INITIAL,this.originalInsertionMode=ot.INITIAL,this.headElement=null,this.formElement=null,this.currentNotInHTML=!1,this.tmplInsertionModeStack=[],this.pendingCharacterTokens=[],this.hasNonWhitespacePendingCharacterToken=!1,this.framesetOk=!0,this.skipNextNewLine=!1,this.fosterParentingEnabled=!1,this.options={...qV,...t},this.treeAdapter=this.options.treeAdapter,this.onParseError=this.options.onParseError,this.onParseError&&(this.options.sourceCodeLocationInfo=!0),this.document=n??this.treeAdapter.createDocument(),this.tokenizer=new hTe(this.options,this),this.activeFormattingElements=new xTe(this.treeAdapter),this.fragmentContextID=r?px(this.treeAdapter.getTagName(r)):Q.UNKNOWN,this._setContextModes(r??this.document,this.fragmentContextID),this.openElements=new vTe(this.document,this.treeAdapter,this)}static parse(t,n){const r=new this(n);return r.tokenizer.write(t,!0),r.document}static getFragmentParser(t,n){const r={...qV,...n};t??(t=r.treeAdapter.createElement(qt.TEMPLATE,Gn.HTML,[]));const a=r.treeAdapter.createElement("documentmock",Gn.HTML,[]),u=new this(r,a,t);return u.fragmentContextID===Q.TEMPLATE&&u.tmplInsertionModeStack.unshift(ot.IN_TEMPLATE),u._initTokenizerForFragmentParsing(),u._insertFakeRootElement(),u._resetInsertionMode(),u._findFormInFragmentContext(),u}getFragment(){const t=this.treeAdapter.getFirstChild(this.document),n=this.treeAdapter.createDocumentFragment();return this._adoptNodes(t,n),n}_err(t,n,r){var a;if(!this.onParseError)return;const u=(a=t.location)!==null&&a!==void 0?a:VTe,f={code:n,startLine:u.startLine,startCol:u.startCol,startOffset:u.startOffset,endLine:r?u.startLine:u.endLine,endCol:r?u.startCol:u.endCol,endOffset:r?u.startOffset:u.endOffset};this.onParseError(f)}onItemPush(t,n,r){var a,u;(u=(a=this.treeAdapter).onItemPush)===null||u===void 0||u.call(a,t),r&&this.openElements.stackTop>0&&this._setContextModes(t,n)}onItemPop(t,n){var r,a;if(this.options.sourceCodeLocationInfo&&this._setEndLocation(t,this.currentToken),(a=(r=this.treeAdapter).onItemPop)===null||a===void 0||a.call(r,t,this.openElements.current),n){let u,f;this.openElements.stackTop===0&&this.fragmentContext?(u=this.fragmentContext,f=this.fragmentContextID):{current:u,currentTagId:f}=this.openElements,this._setContextModes(u,f)}}_setContextModes(t,n){const r=t===this.document||t&&this.treeAdapter.getNamespaceURI(t)===Gn.HTML;this.currentNotInHTML=!r,this.tokenizer.inForeignNode=!r&&t!==void 0&&n!==void 0&&!this._isIntegrationPoint(n,t)}_switchToTextParsing(t,n){this._insertElement(t,Gn.HTML),this.tokenizer.state=n,this.originalInsertionMode=this.insertionMode,this.insertionMode=ot.TEXT}switchToPlaintextParsing(){this.insertionMode=ot.TEXT,this.originalInsertionMode=ot.IN_BODY,this.tokenizer.state=Ho.PLAINTEXT}_getAdjustedCurrentElement(){return this.openElements.stackTop===0&&this.fragmentContext?this.fragmentContext:this.openElements.current}_findFormInFragmentContext(){let t=this.fragmentContext;for(;t;){if(this.treeAdapter.getTagName(t)===qt.FORM){this.formElement=t;break}t=this.treeAdapter.getParentNode(t)}}_initTokenizerForFragmentParsing(){if(!(!this.fragmentContext||this.treeAdapter.getNamespaceURI(this.fragmentContext)!==Gn.HTML))switch(this.fragmentContextID){case Q.TITLE:case Q.TEXTAREA:{this.tokenizer.state=Ho.RCDATA;break}case Q.STYLE:case Q.XMP:case Q.IFRAME:case Q.NOEMBED:case Q.NOFRAMES:case Q.NOSCRIPT:{this.tokenizer.state=Ho.RAWTEXT;break}case Q.SCRIPT:{this.tokenizer.state=Ho.SCRIPT_DATA;break}case Q.PLAINTEXT:{this.tokenizer.state=Ho.PLAINTEXT;break}}}_setDocumentType(t){const n=t.name||"",r=t.publicId||"",a=t.systemId||"";if(this.treeAdapter.setDocumentType(this.document,n,r,a),t.location){const f=this.treeAdapter.getChildNodes(this.document).find(s=>this.treeAdapter.isDocumentTypeNode(s));f&&this.treeAdapter.setNodeSourceCodeLocation(f,t.location)}}_attachElementToTree(t,n){if(this.options.sourceCodeLocationInfo){const r=n&&{...n,startTag:n};this.treeAdapter.setNodeSourceCodeLocation(t,r)}if(this._shouldFosterParentOnInsertion())this._fosterParentElement(t);else{const r=this.openElements.currentTmplContentOrNode;this.treeAdapter.appendChild(r??this.document,t)}}_appendElement(t,n){const r=this.treeAdapter.createElement(t.tagName,n,t.attrs);this._attachElementToTree(r,t.location)}_insertElement(t,n){const r=this.treeAdapter.createElement(t.tagName,n,t.attrs);this._attachElementToTree(r,t.location),this.openElements.push(r,t.tagID)}_insertFakeElement(t,n){const r=this.treeAdapter.createElement(t,Gn.HTML,[]);this._attachElementToTree(r,null),this.openElements.push(r,n)}_insertTemplate(t){const n=this.treeAdapter.createElement(t.tagName,Gn.HTML,t.attrs),r=this.treeAdapter.createDocumentFragment();this.treeAdapter.setTemplateContent(n,r),this._attachElementToTree(n,t.location),this.openElements.push(n,t.tagID),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(r,null)}_insertFakeRootElement(){const t=this.treeAdapter.createElement(qt.HTML,Gn.HTML,[]);this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(t,null),this.treeAdapter.appendChild(this.openElements.current,t),this.openElements.push(t,Q.HTML)}_appendCommentNode(t,n){const r=this.treeAdapter.createCommentNode(t.data);this.treeAdapter.appendChild(n,r),this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(r,t.location)}_insertCharacters(t){let n,r;if(this._shouldFosterParentOnInsertion()?({parent:n,beforeElement:r}=this._findFosterParentingLocation(),r?this.treeAdapter.insertTextBefore(n,t.chars,r):this.treeAdapter.insertText(n,t.chars)):(n=this.openElements.currentTmplContentOrNode,this.treeAdapter.insertText(n,t.chars)),!t.location)return;const a=this.treeAdapter.getChildNodes(n),u=r?a.lastIndexOf(r):a.length,f=a[u-1];if(this.treeAdapter.getNodeSourceCodeLocation(f)){const{endLine:v,endCol:x,endOffset:A}=t.location;this.treeAdapter.updateNodeSourceCodeLocation(f,{endLine:v,endCol:x,endOffset:A})}else this.options.sourceCodeLocationInfo&&this.treeAdapter.setNodeSourceCodeLocation(f,t.location)}_adoptNodes(t,n){for(let r=this.treeAdapter.getFirstChild(t);r;r=this.treeAdapter.getFirstChild(t))this.treeAdapter.detachNode(r),this.treeAdapter.appendChild(n,r)}_setEndLocation(t,n){if(this.treeAdapter.getNodeSourceCodeLocation(t)&&n.location){const r=n.location,a=this.treeAdapter.getTagName(t),u=n.type===Ws.END_TAG&&a===n.tagName?{endTag:{...r},endLine:r.endLine,endCol:r.endCol,endOffset:r.endOffset}:{endLine:r.startLine,endCol:r.startCol,endOffset:r.startOffset};this.treeAdapter.updateNodeSourceCodeLocation(t,u)}}shouldProcessStartTagTokenInForeignContent(t){if(!this.currentNotInHTML)return!1;let n,r;return this.openElements.stackTop===0&&this.fragmentContext?(n=this.fragmentContext,r=this.fragmentContextID):{current:n,currentTagId:r}=this.openElements,t.tagID===Q.SVG&&this.treeAdapter.getTagName(n)===qt.ANNOTATION_XML&&this.treeAdapter.getNamespaceURI(n)===Gn.MATHML?!1:this.tokenizer.inForeignNode||(t.tagID===Q.MGLYPH||t.tagID===Q.MALIGNMARK)&&r!==void 0&&!this._isIntegrationPoint(r,n,Gn.HTML)}_processToken(t){switch(t.type){case Ws.CHARACTER:{this.onCharacter(t);break}case Ws.NULL_CHARACTER:{this.onNullCharacter(t);break}case Ws.COMMENT:{this.onComment(t);break}case Ws.DOCTYPE:{this.onDoctype(t);break}case Ws.START_TAG:{this._processStartTag(t);break}case Ws.END_TAG:{this.onEndTag(t);break}case Ws.EOF:{this.onEof(t);break}case Ws.WHITESPACE_CHARACTER:{this.onWhitespaceCharacter(t);break}}}_isIntegrationPoint(t,n,r){const a=this.treeAdapter.getNamespaceURI(n),u=this.treeAdapter.getAttrList(n);return FTe(t,a,u,r)}_reconstructActiveFormattingElements(){const t=this.activeFormattingElements.entries.length;if(t){const n=this.activeFormattingElements.entries.findIndex(a=>a.type===qh.Marker||this.openElements.contains(a.element)),r=n===-1?t-1:n-1;for(let a=r;a>=0;a--){const u=this.activeFormattingElements.entries[a];this._insertElement(u.token,this.treeAdapter.getNamespaceURI(u.element)),u.element=this.openElements.current}}}_closeTableCell(){this.openElements.generateImpliedEndTags(),this.openElements.popUntilTableCellPopped(),this.activeFormattingElements.clearToLastMarker(),this.insertionMode=ot.IN_ROW}_closePElement(){this.openElements.generateImpliedEndTagsWithExclusion(Q.P),this.openElements.popUntilTagNamePopped(Q.P)}_resetInsertionMode(){for(let t=this.openElements.stackTop;t>=0;t--)switch(t===0&&this.fragmentContext?this.fragmentContextID:this.openElements.tagIDs[t]){case Q.TR:{this.insertionMode=ot.IN_ROW;return}case Q.TBODY:case Q.THEAD:case Q.TFOOT:{this.insertionMode=ot.IN_TABLE_BODY;return}case Q.CAPTION:{this.insertionMode=ot.IN_CAPTION;return}case Q.COLGROUP:{this.insertionMode=ot.IN_COLUMN_GROUP;return}case Q.TABLE:{this.insertionMode=ot.IN_TABLE;return}case Q.BODY:{this.insertionMode=ot.IN_BODY;return}case Q.FRAMESET:{this.insertionMode=ot.IN_FRAMESET;return}case Q.SELECT:{this._resetInsertionModeForSelect(t);return}case Q.TEMPLATE:{this.insertionMode=this.tmplInsertionModeStack[0];return}case Q.HTML:{this.insertionMode=this.headElement?ot.AFTER_HEAD:ot.BEFORE_HEAD;return}case Q.TD:case Q.TH:{if(t>0){this.insertionMode=ot.IN_CELL;return}break}case Q.HEAD:{if(t>0){this.insertionMode=ot.IN_HEAD;return}break}}this.insertionMode=ot.IN_BODY}_resetInsertionModeForSelect(t){if(t>0)for(let n=t-1;n>0;n--){const r=this.openElements.tagIDs[n];if(r===Q.TEMPLATE)break;if(r===Q.TABLE){this.insertionMode=ot.IN_SELECT_IN_TABLE;return}}this.insertionMode=ot.IN_SELECT}_isElementCausesFosterParenting(t){return IJ.has(t)}_shouldFosterParentOnInsertion(){return this.fosterParentingEnabled&&this.openElements.currentTagId!==void 0&&this._isElementCausesFosterParenting(this.openElements.currentTagId)}_findFosterParentingLocation(){for(let t=this.openElements.stackTop;t>=0;t--){const n=this.openElements.items[t];switch(this.openElements.tagIDs[t]){case Q.TEMPLATE:{if(this.treeAdapter.getNamespaceURI(n)===Gn.HTML)return{parent:this.treeAdapter.getTemplateContent(n),beforeElement:null};break}case Q.TABLE:{const r=this.treeAdapter.getParentNode(n);return r?{parent:r,beforeElement:n}:{parent:this.openElements.items[t-1],beforeElement:null}}}}return{parent:this.openElements.items[0],beforeElement:null}}_fosterParentElement(t){const n=this._findFosterParentingLocation();n.beforeElement?this.treeAdapter.insertBefore(n.parent,t,n.beforeElement):this.treeAdapter.appendChild(n.parent,t)}_isSpecialElement(t,n){const r=this.treeAdapter.getNamespaceURI(t);return lTe[r].has(n)}onCharacter(t){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){ySe(this,t);return}switch(this.insertionMode){case ot.INITIAL:{Sw(this,t);break}case ot.BEFORE_HTML:{l2(this,t);break}case ot.BEFORE_HEAD:{u2(this,t);break}case ot.IN_HEAD:{c2(this,t);break}case ot.IN_HEAD_NO_SCRIPT:{d2(this,t);break}case ot.AFTER_HEAD:{h2(this,t);break}case ot.IN_BODY:case ot.IN_CAPTION:case ot.IN_CELL:case ot.IN_TEMPLATE:{MJ(this,t);break}case ot.TEXT:case ot.IN_SELECT:case ot.IN_SELECT_IN_TABLE:{this._insertCharacters(t);break}case ot.IN_TABLE:case ot.IN_TABLE_BODY:case ot.IN_ROW:{Q5(this,t);break}case ot.IN_TABLE_TEXT:{zJ(this,t);break}case ot.IN_COLUMN_GROUP:{oC(this,t);break}case ot.AFTER_BODY:{lC(this,t);break}case ot.AFTER_AFTER_BODY:{F4(this,t);break}}}onNullCharacter(t){if(this.skipNextNewLine=!1,this.tokenizer.inForeignNode){_Se(this,t);return}switch(this.insertionMode){case ot.INITIAL:{Sw(this,t);break}case ot.BEFORE_HTML:{l2(this,t);break}case ot.BEFORE_HEAD:{u2(this,t);break}case ot.IN_HEAD:{c2(this,t);break}case ot.IN_HEAD_NO_SCRIPT:{d2(this,t);break}case ot.AFTER_HEAD:{h2(this,t);break}case ot.TEXT:{this._insertCharacters(t);break}case ot.IN_TABLE:case ot.IN_TABLE_BODY:case ot.IN_ROW:{Q5(this,t);break}case ot.IN_COLUMN_GROUP:{oC(this,t);break}case ot.AFTER_BODY:{lC(this,t);break}case ot.AFTER_AFTER_BODY:{F4(this,t);break}}}onComment(t){if(this.skipNextNewLine=!1,this.currentNotInHTML){d8(this,t);return}switch(this.insertionMode){case ot.INITIAL:case ot.BEFORE_HTML:case ot.BEFORE_HEAD:case ot.IN_HEAD:case ot.IN_HEAD_NO_SCRIPT:case ot.AFTER_HEAD:case ot.IN_BODY:case ot.IN_TABLE:case ot.IN_CAPTION:case ot.IN_COLUMN_GROUP:case ot.IN_TABLE_BODY:case ot.IN_ROW:case ot.IN_CELL:case ot.IN_SELECT:case ot.IN_SELECT_IN_TABLE:case ot.IN_TEMPLATE:case ot.IN_FRAMESET:case ot.AFTER_FRAMESET:{d8(this,t);break}case ot.IN_TABLE_TEXT:{Aw(this,t);break}case ot.AFTER_BODY:{XTe(this,t);break}case ot.AFTER_AFTER_BODY:case ot.AFTER_AFTER_FRAMESET:{YTe(this,t);break}}}onDoctype(t){switch(this.skipNextNewLine=!1,this.insertionMode){case ot.INITIAL:{KTe(this,t);break}case ot.BEFORE_HEAD:case ot.IN_HEAD:case ot.IN_HEAD_NO_SCRIPT:case ot.AFTER_HEAD:{this._err(t,hn.misplacedDoctype);break}case ot.IN_TABLE_TEXT:{Aw(this,t);break}}}onStartTag(t){this.skipNextNewLine=!1,this.currentToken=t,this._processStartTag(t),t.selfClosing&&!t.ackSelfClosing&&this._err(t,hn.nonVoidHtmlElementStartTagWithTrailingSolidus)}_processStartTag(t){this.shouldProcessStartTagTokenInForeignContent(t)?vSe(this,t):this._startTagOutsideForeignContent(t)}_startTagOutsideForeignContent(t){switch(this.insertionMode){case ot.INITIAL:{Sw(this,t);break}case ot.BEFORE_HTML:{QTe(this,t);break}case ot.BEFORE_HEAD:{eEe(this,t);break}case ot.IN_HEAD:{hh(this,t);break}case ot.IN_HEAD_NO_SCRIPT:{rEe(this,t);break}case ot.AFTER_HEAD:{sEe(this,t);break}case ot.IN_BODY:{su(this,t);break}case ot.IN_TABLE:{jv(this,t);break}case ot.IN_TABLE_TEXT:{Aw(this,t);break}case ot.IN_CAPTION:{tSe(this,t);break}case ot.IN_COLUMN_GROUP:{fD(this,t);break}case ot.IN_TABLE_BODY:{gk(this,t);break}case ot.IN_ROW:{_k(this,t);break}case ot.IN_CELL:{iSe(this,t);break}case ot.IN_SELECT:{jJ(this,t);break}case ot.IN_SELECT_IN_TABLE:{aSe(this,t);break}case ot.IN_TEMPLATE:{lSe(this,t);break}case ot.AFTER_BODY:{cSe(this,t);break}case ot.IN_FRAMESET:{dSe(this,t);break}case ot.AFTER_FRAMESET:{fSe(this,t);break}case ot.AFTER_AFTER_BODY:{mSe(this,t);break}case ot.AFTER_AFTER_FRAMESET:{gSe(this,t);break}}}onEndTag(t){this.skipNextNewLine=!1,this.currentToken=t,this.currentNotInHTML?xSe(this,t):this._endTagOutsideForeignContent(t)}_endTagOutsideForeignContent(t){switch(this.insertionMode){case ot.INITIAL:{Sw(this,t);break}case ot.BEFORE_HTML:{JTe(this,t);break}case ot.BEFORE_HEAD:{tEe(this,t);break}case ot.IN_HEAD:{nEe(this,t);break}case ot.IN_HEAD_NO_SCRIPT:{iEe(this,t);break}case ot.AFTER_HEAD:{aEe(this,t);break}case ot.IN_BODY:{mk(this,t);break}case ot.TEXT:{GEe(this,t);break}case ot.IN_TABLE:{eT(this,t);break}case ot.IN_TABLE_TEXT:{Aw(this,t);break}case ot.IN_CAPTION:{nSe(this,t);break}case ot.IN_COLUMN_GROUP:{rSe(this,t);break}case ot.IN_TABLE_BODY:{h8(this,t);break}case ot.IN_ROW:{BJ(this,t);break}case ot.IN_CELL:{sSe(this,t);break}case ot.IN_SELECT:{UJ(this,t);break}case ot.IN_SELECT_IN_TABLE:{oSe(this,t);break}case ot.IN_TEMPLATE:{uSe(this,t);break}case ot.AFTER_BODY:{$J(this,t);break}case ot.IN_FRAMESET:{hSe(this,t);break}case ot.AFTER_FRAMESET:{pSe(this,t);break}case ot.AFTER_AFTER_BODY:{F4(this,t);break}}}onEof(t){switch(this.insertionMode){case ot.INITIAL:{Sw(this,t);break}case ot.BEFORE_HTML:{l2(this,t);break}case ot.BEFORE_HEAD:{u2(this,t);break}case ot.IN_HEAD:{c2(this,t);break}case ot.IN_HEAD_NO_SCRIPT:{d2(this,t);break}case ot.AFTER_HEAD:{h2(this,t);break}case ot.IN_BODY:case ot.IN_TABLE:case ot.IN_CAPTION:case ot.IN_COLUMN_GROUP:case ot.IN_TABLE_BODY:case ot.IN_ROW:case ot.IN_CELL:case ot.IN_SELECT:case ot.IN_SELECT_IN_TABLE:{DJ(this,t);break}case ot.TEXT:{qEe(this,t);break}case ot.IN_TABLE_TEXT:{Aw(this,t);break}case ot.IN_TEMPLATE:{VJ(this,t);break}case ot.AFTER_BODY:case ot.IN_FRAMESET:case ot.AFTER_FRAMESET:case ot.AFTER_AFTER_BODY:case ot.AFTER_AFTER_FRAMESET:{hD(this,t);break}}}onWhitespaceCharacter(t){if(this.skipNextNewLine&&(this.skipNextNewLine=!1,t.chars.charCodeAt(0)===Ge.LINE_FEED)){if(t.chars.length===1)return;t.chars=t.chars.substr(1)}if(this.tokenizer.inForeignNode){this._insertCharacters(t);return}switch(this.insertionMode){case ot.IN_HEAD:case ot.IN_HEAD_NO_SCRIPT:case ot.AFTER_HEAD:case ot.TEXT:case ot.IN_COLUMN_GROUP:case ot.IN_SELECT:case ot.IN_SELECT_IN_TABLE:case ot.IN_FRAMESET:case ot.AFTER_FRAMESET:{this._insertCharacters(t);break}case ot.IN_BODY:case ot.IN_CAPTION:case ot.IN_CELL:case ot.IN_TEMPLATE:case ot.AFTER_BODY:case ot.AFTER_AFTER_BODY:case ot.AFTER_AFTER_FRAMESET:{RJ(this,t);break}case ot.IN_TABLE:case ot.IN_TABLE_BODY:case ot.IN_ROW:{Q5(this,t);break}case ot.IN_TABLE_TEXT:{NJ(this,t);break}}}}function $Te(e,t){let n=e.activeFormattingElements.getElementEntryInScopeWithTagName(t.tagName);return n?e.openElements.contains(n.element)?e.openElements.hasInScope(t.tagID)||(n=null):(e.activeFormattingElements.removeEntry(n),n=null):LJ(e,t),n}function HTe(e,t){let n=null,r=e.openElements.stackTop;for(;r>=0;r--){const a=e.openElements.items[r];if(a===t.element)break;e._isSpecialElement(a,e.openElements.tagIDs[r])&&(n=a)}return n||(e.openElements.shortenToLength(Math.max(r,0)),e.activeFormattingElements.removeEntry(t)),n}function GTe(e,t,n){let r=t,a=e.openElements.getCommonAncestor(t);for(let u=0,f=a;f!==n;u++,f=a){a=e.openElements.getCommonAncestor(f);const s=e.activeFormattingElements.getElementEntry(f),v=s&&u>=UTe;!s||v?(v&&e.activeFormattingElements.removeEntry(s),e.openElements.remove(f)):(f=qTe(e,s),r===t&&(e.activeFormattingElements.bookmark=s),e.treeAdapter.detachNode(r),e.treeAdapter.appendChild(f,r),r=f)}return r}function qTe(e,t){const n=e.treeAdapter.getNamespaceURI(t.element),r=e.treeAdapter.createElement(t.token.tagName,n,t.token.attrs);return e.openElements.replace(t.element,r),t.element=r,r}function WTe(e,t,n){const r=e.treeAdapter.getTagName(t),a=px(r);if(e._isElementCausesFosterParenting(a))e._fosterParentElement(n);else{const u=e.treeAdapter.getNamespaceURI(t);a===Q.TEMPLATE&&u===Gn.HTML&&(t=e.treeAdapter.getTemplateContent(t)),e.treeAdapter.appendChild(t,n)}}function ZTe(e,t,n){const r=e.treeAdapter.getNamespaceURI(n.element),{token:a}=n,u=e.treeAdapter.createElement(a.tagName,r,a.attrs);e._adoptNodes(t,u),e.treeAdapter.appendChild(t,u),e.activeFormattingElements.insertElementAfterBookmark(u,a),e.activeFormattingElements.removeEntry(n),e.openElements.remove(n.element),e.openElements.insertAfter(t,u,a.tagID)}function dD(e,t){for(let n=0;n<jTe;n++){const r=$Te(e,t);if(!r)break;const a=HTe(e,r);if(!a)break;e.activeFormattingElements.bookmark=r;const u=GTe(e,a,r.element),f=e.openElements.getCommonAncestor(r.element);e.treeAdapter.detachNode(u),f&&WTe(e,f,u),ZTe(e,a,r)}}function d8(e,t){e._appendCommentNode(t,e.openElements.currentTmplContentOrNode)}function XTe(e,t){e._appendCommentNode(t,e.openElements.items[0])}function YTe(e,t){e._appendCommentNode(t,e.document)}function hD(e,t){if(e.stopped=!0,t.location){const n=e.fragmentContext?0:2;for(let r=e.openElements.stackTop;r>=n;r--)e._setEndLocation(e.openElements.items[r],t);if(!e.fragmentContext&&e.openElements.stackTop>=0){const r=e.openElements.items[0],a=e.treeAdapter.getNodeSourceCodeLocation(r);if(a&&!a.endTag&&(e._setEndLocation(r,t),e.openElements.stackTop>=1)){const u=e.openElements.items[1],f=e.treeAdapter.getNodeSourceCodeLocation(u);f&&!f.endTag&&e._setEndLocation(u,t)}}}}function KTe(e,t){e._setDocumentType(t);const n=t.forceQuirks?id.QUIRKS:CTe(t);ATe(t)||e._err(t,hn.nonConformingDoctype),e.treeAdapter.setDocumentMode(e.document,n),e.insertionMode=ot.BEFORE_HTML}function Sw(e,t){e._err(t,hn.missingDoctype,!0),e.treeAdapter.setDocumentMode(e.document,id.QUIRKS),e.insertionMode=ot.BEFORE_HTML,e._processToken(t)}function QTe(e,t){t.tagID===Q.HTML?(e._insertElement(t,Gn.HTML),e.insertionMode=ot.BEFORE_HEAD):l2(e,t)}function JTe(e,t){const n=t.tagID;(n===Q.HTML||n===Q.HEAD||n===Q.BODY||n===Q.BR)&&l2(e,t)}function l2(e,t){e._insertFakeRootElement(),e.insertionMode=ot.BEFORE_HEAD,e._processToken(t)}function eEe(e,t){switch(t.tagID){case Q.HTML:{su(e,t);break}case Q.HEAD:{e._insertElement(t,Gn.HTML),e.headElement=e.openElements.current,e.insertionMode=ot.IN_HEAD;break}default:u2(e,t)}}function tEe(e,t){const n=t.tagID;n===Q.HEAD||n===Q.BODY||n===Q.HTML||n===Q.BR?u2(e,t):e._err(t,hn.endTagWithoutMatchingOpenElement)}function u2(e,t){e._insertFakeElement(qt.HEAD,Q.HEAD),e.headElement=e.openElements.current,e.insertionMode=ot.IN_HEAD,e._processToken(t)}function hh(e,t){switch(t.tagID){case Q.HTML:{su(e,t);break}case Q.BASE:case Q.BASEFONT:case Q.BGSOUND:case Q.LINK:case Q.META:{e._appendElement(t,Gn.HTML),t.ackSelfClosing=!0;break}case Q.TITLE:{e._switchToTextParsing(t,Ho.RCDATA);break}case Q.NOSCRIPT:{e.options.scriptingEnabled?e._switchToTextParsing(t,Ho.RAWTEXT):(e._insertElement(t,Gn.HTML),e.insertionMode=ot.IN_HEAD_NO_SCRIPT);break}case Q.NOFRAMES:case Q.STYLE:{e._switchToTextParsing(t,Ho.RAWTEXT);break}case Q.SCRIPT:{e._switchToTextParsing(t,Ho.SCRIPT_DATA);break}case Q.TEMPLATE:{e._insertTemplate(t),e.activeFormattingElements.insertMarker(),e.framesetOk=!1,e.insertionMode=ot.IN_TEMPLATE,e.tmplInsertionModeStack.unshift(ot.IN_TEMPLATE);break}case Q.HEAD:{e._err(t,hn.misplacedStartTagForHeadElement);break}default:c2(e,t)}}function nEe(e,t){switch(t.tagID){case Q.HEAD:{e.openElements.pop(),e.insertionMode=ot.AFTER_HEAD;break}case Q.BODY:case Q.BR:case Q.HTML:{c2(e,t);break}case Q.TEMPLATE:{R_(e,t);break}default:e._err(t,hn.endTagWithoutMatchingOpenElement)}}function R_(e,t){e.openElements.tmplCount>0?(e.openElements.generateImpliedEndTagsThoroughly(),e.openElements.currentTagId!==Q.TEMPLATE&&e._err(t,hn.closingOfElementWithOpenChildElements),e.openElements.popUntilTagNamePopped(Q.TEMPLATE),e.activeFormattingElements.clearToLastMarker(),e.tmplInsertionModeStack.shift(),e._resetInsertionMode()):e._err(t,hn.endTagWithoutMatchingOpenElement)}function c2(e,t){e.openElements.pop(),e.insertionMode=ot.AFTER_HEAD,e._processToken(t)}function rEe(e,t){switch(t.tagID){case Q.HTML:{su(e,t);break}case Q.BASEFONT:case Q.BGSOUND:case Q.HEAD:case Q.LINK:case Q.META:case Q.NOFRAMES:case Q.STYLE:{hh(e,t);break}case Q.NOSCRIPT:{e._err(t,hn.nestedNoscriptInHead);break}default:d2(e,t)}}function iEe(e,t){switch(t.tagID){case Q.NOSCRIPT:{e.openElements.pop(),e.insertionMode=ot.IN_HEAD;break}case Q.BR:{d2(e,t);break}default:e._err(t,hn.endTagWithoutMatchingOpenElement)}}function d2(e,t){const n=t.type===Ws.EOF?hn.openElementsLeftAfterEof:hn.disallowedContentInNoscriptInHead;e._err(t,n),e.openElements.pop(),e.insertionMode=ot.IN_HEAD,e._processToken(t)}function sEe(e,t){switch(t.tagID){case Q.HTML:{su(e,t);break}case Q.BODY:{e._insertElement(t,Gn.HTML),e.framesetOk=!1,e.insertionMode=ot.IN_BODY;break}case Q.FRAMESET:{e._insertElement(t,Gn.HTML),e.insertionMode=ot.IN_FRAMESET;break}case Q.BASE:case Q.BASEFONT:case Q.BGSOUND:case Q.LINK:case Q.META:case Q.NOFRAMES:case Q.SCRIPT:case Q.STYLE:case Q.TEMPLATE:case Q.TITLE:{e._err(t,hn.abandonedHeadElementChild),e.openElements.push(e.headElement,Q.HEAD),hh(e,t),e.openElements.remove(e.headElement);break}case Q.HEAD:{e._err(t,hn.misplacedStartTagForHeadElement);break}default:h2(e,t)}}function aEe(e,t){switch(t.tagID){case Q.BODY:case Q.HTML:case Q.BR:{h2(e,t);break}case Q.TEMPLATE:{R_(e,t);break}default:e._err(t,hn.endTagWithoutMatchingOpenElement)}}function h2(e,t){e._insertFakeElement(qt.BODY,Q.BODY),e.insertionMode=ot.IN_BODY,pk(e,t)}function pk(e,t){switch(t.type){case Ws.CHARACTER:{MJ(e,t);break}case Ws.WHITESPACE_CHARACTER:{RJ(e,t);break}case Ws.COMMENT:{d8(e,t);break}case Ws.START_TAG:{su(e,t);break}case Ws.END_TAG:{mk(e,t);break}case Ws.EOF:{DJ(e,t);break}}}function RJ(e,t){e._reconstructActiveFormattingElements(),e._insertCharacters(t)}function MJ(e,t){e._reconstructActiveFormattingElements(),e._insertCharacters(t),e.framesetOk=!1}function oEe(e,t){e.openElements.tmplCount===0&&e.treeAdapter.adoptAttributes(e.openElements.items[0],t.attrs)}function lEe(e,t){const n=e.openElements.tryPeekProperlyNestedBodyElement();n&&e.openElements.tmplCount===0&&(e.framesetOk=!1,e.treeAdapter.adoptAttributes(n,t.attrs))}function uEe(e,t){const n=e.openElements.tryPeekProperlyNestedBodyElement();e.framesetOk&&n&&(e.treeAdapter.detachNode(n),e.openElements.popAllUpToHtmlElement(),e._insertElement(t,Gn.HTML),e.insertionMode=ot.IN_FRAMESET)}function cEe(e,t){e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._insertElement(t,Gn.HTML)}function dEe(e,t){e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e.openElements.currentTagId!==void 0&&c8.has(e.openElements.currentTagId)&&e.openElements.pop(),e._insertElement(t,Gn.HTML)}function hEe(e,t){e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._insertElement(t,Gn.HTML),e.skipNextNewLine=!0,e.framesetOk=!1}function fEe(e,t){const n=e.openElements.tmplCount>0;(!e.formElement||n)&&(e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._insertElement(t,Gn.HTML),n||(e.formElement=e.openElements.current))}function pEe(e,t){e.framesetOk=!1;const n=t.tagID;for(let r=e.openElements.stackTop;r>=0;r--){const a=e.openElements.tagIDs[r];if(n===Q.LI&&a===Q.LI||(n===Q.DD||n===Q.DT)&&(a===Q.DD||a===Q.DT)){e.openElements.generateImpliedEndTagsWithExclusion(a),e.openElements.popUntilTagNamePopped(a);break}if(a!==Q.ADDRESS&&a!==Q.DIV&&a!==Q.P&&e._isSpecialElement(e.openElements.items[r],a))break}e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._insertElement(t,Gn.HTML)}function mEe(e,t){e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._insertElement(t,Gn.HTML),e.tokenizer.state=Ho.PLAINTEXT}function gEe(e,t){e.openElements.hasInScope(Q.BUTTON)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(Q.BUTTON)),e._reconstructActiveFormattingElements(),e._insertElement(t,Gn.HTML),e.framesetOk=!1}function _Ee(e,t){const n=e.activeFormattingElements.getElementEntryInScopeWithTagName(qt.A);n&&(dD(e,t),e.openElements.remove(n.element),e.activeFormattingElements.removeEntry(n)),e._reconstructActiveFormattingElements(),e._insertElement(t,Gn.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function yEe(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,Gn.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function vEe(e,t){e._reconstructActiveFormattingElements(),e.openElements.hasInScope(Q.NOBR)&&(dD(e,t),e._reconstructActiveFormattingElements()),e._insertElement(t,Gn.HTML),e.activeFormattingElements.pushElement(e.openElements.current,t)}function xEe(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,Gn.HTML),e.activeFormattingElements.insertMarker(),e.framesetOk=!1}function bEe(e,t){e.treeAdapter.getDocumentMode(e.document)!==id.QUIRKS&&e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._insertElement(t,Gn.HTML),e.framesetOk=!1,e.insertionMode=ot.IN_TABLE}function PJ(e,t){e._reconstructActiveFormattingElements(),e._appendElement(t,Gn.HTML),e.framesetOk=!1,t.ackSelfClosing=!0}function OJ(e){const t=bJ(e,Xg.TYPE);return t!=null&&t.toLowerCase()===BTe}function wEe(e,t){e._reconstructActiveFormattingElements(),e._appendElement(t,Gn.HTML),OJ(t)||(e.framesetOk=!1),t.ackSelfClosing=!0}function TEe(e,t){e._appendElement(t,Gn.HTML),t.ackSelfClosing=!0}function EEe(e,t){e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._appendElement(t,Gn.HTML),e.framesetOk=!1,t.ackSelfClosing=!0}function SEe(e,t){t.tagName=qt.IMG,t.tagID=Q.IMG,PJ(e,t)}function AEe(e,t){e._insertElement(t,Gn.HTML),e.skipNextNewLine=!0,e.tokenizer.state=Ho.RCDATA,e.originalInsertionMode=e.insertionMode,e.framesetOk=!1,e.insertionMode=ot.TEXT}function CEe(e,t){e.openElements.hasInButtonScope(Q.P)&&e._closePElement(),e._reconstructActiveFormattingElements(),e.framesetOk=!1,e._switchToTextParsing(t,Ho.RAWTEXT)}function kEe(e,t){e.framesetOk=!1,e._switchToTextParsing(t,Ho.RAWTEXT)}function ZV(e,t){e._switchToTextParsing(t,Ho.RAWTEXT)}function IEe(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,Gn.HTML),e.framesetOk=!1,e.insertionMode=e.insertionMode===ot.IN_TABLE||e.insertionMode===ot.IN_CAPTION||e.insertionMode===ot.IN_TABLE_BODY||e.insertionMode===ot.IN_ROW||e.insertionMode===ot.IN_CELL?ot.IN_SELECT_IN_TABLE:ot.IN_SELECT}function REe(e,t){e.openElements.currentTagId===Q.OPTION&&e.openElements.pop(),e._reconstructActiveFormattingElements(),e._insertElement(t,Gn.HTML)}function MEe(e,t){e.openElements.hasInScope(Q.RUBY)&&e.openElements.generateImpliedEndTags(),e._insertElement(t,Gn.HTML)}function PEe(e,t){e.openElements.hasInScope(Q.RUBY)&&e.openElements.generateImpliedEndTagsWithExclusion(Q.RTC),e._insertElement(t,Gn.HTML)}function OEe(e,t){e._reconstructActiveFormattingElements(),CJ(t),cD(t),t.selfClosing?e._appendElement(t,Gn.MATHML):e._insertElement(t,Gn.MATHML),t.ackSelfClosing=!0}function LEe(e,t){e._reconstructActiveFormattingElements(),kJ(t),cD(t),t.selfClosing?e._appendElement(t,Gn.SVG):e._insertElement(t,Gn.SVG),t.ackSelfClosing=!0}function XV(e,t){e._reconstructActiveFormattingElements(),e._insertElement(t,Gn.HTML)}function su(e,t){switch(t.tagID){case Q.I:case Q.S:case Q.B:case Q.U:case Q.EM:case Q.TT:case Q.BIG:case Q.CODE:case Q.FONT:case Q.SMALL:case Q.STRIKE:case Q.STRONG:{yEe(e,t);break}case Q.A:{_Ee(e,t);break}case Q.H1:case Q.H2:case Q.H3:case Q.H4:case Q.H5:case Q.H6:{dEe(e,t);break}case Q.P:case Q.DL:case Q.OL:case Q.UL:case Q.DIV:case Q.DIR:case Q.NAV:case Q.MAIN:case Q.MENU:case Q.ASIDE:case Q.CENTER:case Q.FIGURE:case Q.FOOTER:case Q.HEADER:case Q.HGROUP:case Q.DIALOG:case Q.DETAILS:case Q.ADDRESS:case Q.ARTICLE:case Q.SEARCH:case Q.SECTION:case Q.SUMMARY:case Q.FIELDSET:case Q.BLOCKQUOTE:case Q.FIGCAPTION:{cEe(e,t);break}case Q.LI:case Q.DD:case Q.DT:{pEe(e,t);break}case Q.BR:case Q.IMG:case Q.WBR:case Q.AREA:case Q.EMBED:case Q.KEYGEN:{PJ(e,t);break}case Q.HR:{EEe(e,t);break}case Q.RB:case Q.RTC:{MEe(e,t);break}case Q.RT:case Q.RP:{PEe(e,t);break}case Q.PRE:case Q.LISTING:{hEe(e,t);break}case Q.XMP:{CEe(e,t);break}case Q.SVG:{LEe(e,t);break}case Q.HTML:{oEe(e,t);break}case Q.BASE:case Q.LINK:case Q.META:case Q.STYLE:case Q.TITLE:case Q.SCRIPT:case Q.BGSOUND:case Q.BASEFONT:case Q.TEMPLATE:{hh(e,t);break}case Q.BODY:{lEe(e,t);break}case Q.FORM:{fEe(e,t);break}case Q.NOBR:{vEe(e,t);break}case Q.MATH:{OEe(e,t);break}case Q.TABLE:{bEe(e,t);break}case Q.INPUT:{wEe(e,t);break}case Q.PARAM:case Q.TRACK:case Q.SOURCE:{TEe(e,t);break}case Q.IMAGE:{SEe(e,t);break}case Q.BUTTON:{gEe(e,t);break}case Q.APPLET:case Q.OBJECT:case Q.MARQUEE:{xEe(e,t);break}case Q.IFRAME:{kEe(e,t);break}case Q.SELECT:{IEe(e,t);break}case Q.OPTION:case Q.OPTGROUP:{REe(e,t);break}case Q.NOEMBED:case Q.NOFRAMES:{ZV(e,t);break}case Q.FRAMESET:{uEe(e,t);break}case Q.TEXTAREA:{AEe(e,t);break}case Q.NOSCRIPT:{e.options.scriptingEnabled?ZV(e,t):XV(e,t);break}case Q.PLAINTEXT:{mEe(e,t);break}case Q.COL:case Q.TH:case Q.TD:case Q.TR:case Q.HEAD:case Q.FRAME:case Q.TBODY:case Q.TFOOT:case Q.THEAD:case Q.CAPTION:case Q.COLGROUP:break;default:XV(e,t)}}function DEe(e,t){if(e.openElements.hasInScope(Q.BODY)&&(e.insertionMode=ot.AFTER_BODY,e.options.sourceCodeLocationInfo)){const n=e.openElements.tryPeekProperlyNestedBodyElement();n&&e._setEndLocation(n,t)}}function NEe(e,t){e.openElements.hasInScope(Q.BODY)&&(e.insertionMode=ot.AFTER_BODY,$J(e,t))}function zEe(e,t){const n=t.tagID;e.openElements.hasInScope(n)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(n))}function FEe(e){const t=e.openElements.tmplCount>0,{formElement:n}=e;t||(e.formElement=null),(n||t)&&e.openElements.hasInScope(Q.FORM)&&(e.openElements.generateImpliedEndTags(),t?e.openElements.popUntilTagNamePopped(Q.FORM):n&&e.openElements.remove(n))}function BEe(e){e.openElements.hasInButtonScope(Q.P)||e._insertFakeElement(qt.P,Q.P),e._closePElement()}function jEe(e){e.openElements.hasInListItemScope(Q.LI)&&(e.openElements.generateImpliedEndTagsWithExclusion(Q.LI),e.openElements.popUntilTagNamePopped(Q.LI))}function UEe(e,t){const n=t.tagID;e.openElements.hasInScope(n)&&(e.openElements.generateImpliedEndTagsWithExclusion(n),e.openElements.popUntilTagNamePopped(n))}function VEe(e){e.openElements.hasNumberedHeaderInScope()&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilNumberedHeaderPopped())}function $Ee(e,t){const n=t.tagID;e.openElements.hasInScope(n)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(n),e.activeFormattingElements.clearToLastMarker())}function HEe(e){e._reconstructActiveFormattingElements(),e._insertFakeElement(qt.BR,Q.BR),e.openElements.pop(),e.framesetOk=!1}function LJ(e,t){const n=t.tagName,r=t.tagID;for(let a=e.openElements.stackTop;a>0;a--){const u=e.openElements.items[a],f=e.openElements.tagIDs[a];if(r===f&&(r!==Q.UNKNOWN||e.treeAdapter.getTagName(u)===n)){e.openElements.generateImpliedEndTagsWithExclusion(r),e.openElements.stackTop>=a&&e.openElements.shortenToLength(a);break}if(e._isSpecialElement(u,f))break}}function mk(e,t){switch(t.tagID){case Q.A:case Q.B:case Q.I:case Q.S:case Q.U:case Q.EM:case Q.TT:case Q.BIG:case Q.CODE:case Q.FONT:case Q.NOBR:case Q.SMALL:case Q.STRIKE:case Q.STRONG:{dD(e,t);break}case Q.P:{BEe(e);break}case Q.DL:case Q.UL:case Q.OL:case Q.DIR:case Q.DIV:case Q.NAV:case Q.PRE:case Q.MAIN:case Q.MENU:case Q.ASIDE:case Q.BUTTON:case Q.CENTER:case Q.FIGURE:case Q.FOOTER:case Q.HEADER:case Q.HGROUP:case Q.DIALOG:case Q.ADDRESS:case Q.ARTICLE:case Q.DETAILS:case Q.SEARCH:case Q.SECTION:case Q.SUMMARY:case Q.LISTING:case Q.FIELDSET:case Q.BLOCKQUOTE:case Q.FIGCAPTION:{zEe(e,t);break}case Q.LI:{jEe(e);break}case Q.DD:case Q.DT:{UEe(e,t);break}case Q.H1:case Q.H2:case Q.H3:case Q.H4:case Q.H5:case Q.H6:{VEe(e);break}case Q.BR:{HEe(e);break}case Q.BODY:{DEe(e,t);break}case Q.HTML:{NEe(e,t);break}case Q.FORM:{FEe(e);break}case Q.APPLET:case Q.OBJECT:case Q.MARQUEE:{$Ee(e,t);break}case Q.TEMPLATE:{R_(e,t);break}default:LJ(e,t)}}function DJ(e,t){e.tmplInsertionModeStack.length>0?VJ(e,t):hD(e,t)}function GEe(e,t){var n;t.tagID===Q.SCRIPT&&((n=e.scriptHandler)===null||n===void 0||n.call(e,e.openElements.current)),e.openElements.pop(),e.insertionMode=e.originalInsertionMode}function qEe(e,t){e._err(t,hn.eofInElementThatCanContainOnlyText),e.openElements.pop(),e.insertionMode=e.originalInsertionMode,e.onEof(t)}function Q5(e,t){if(e.openElements.currentTagId!==void 0&&IJ.has(e.openElements.currentTagId))switch(e.pendingCharacterTokens.length=0,e.hasNonWhitespacePendingCharacterToken=!1,e.originalInsertionMode=e.insertionMode,e.insertionMode=ot.IN_TABLE_TEXT,t.type){case Ws.CHARACTER:{zJ(e,t);break}case Ws.WHITESPACE_CHARACTER:{NJ(e,t);break}}else zT(e,t)}function WEe(e,t){e.openElements.clearBackToTableContext(),e.activeFormattingElements.insertMarker(),e._insertElement(t,Gn.HTML),e.insertionMode=ot.IN_CAPTION}function ZEe(e,t){e.openElements.clearBackToTableContext(),e._insertElement(t,Gn.HTML),e.insertionMode=ot.IN_COLUMN_GROUP}function XEe(e,t){e.openElements.clearBackToTableContext(),e._insertFakeElement(qt.COLGROUP,Q.COLGROUP),e.insertionMode=ot.IN_COLUMN_GROUP,fD(e,t)}function YEe(e,t){e.openElements.clearBackToTableContext(),e._insertElement(t,Gn.HTML),e.insertionMode=ot.IN_TABLE_BODY}function KEe(e,t){e.openElements.clearBackToTableContext(),e._insertFakeElement(qt.TBODY,Q.TBODY),e.insertionMode=ot.IN_TABLE_BODY,gk(e,t)}function QEe(e,t){e.openElements.hasInTableScope(Q.TABLE)&&(e.openElements.popUntilTagNamePopped(Q.TABLE),e._resetInsertionMode(),e._processStartTag(t))}function JEe(e,t){OJ(t)?e._appendElement(t,Gn.HTML):zT(e,t),t.ackSelfClosing=!0}function eSe(e,t){!e.formElement&&e.openElements.tmplCount===0&&(e._insertElement(t,Gn.HTML),e.formElement=e.openElements.current,e.openElements.pop())}function jv(e,t){switch(t.tagID){case Q.TD:case Q.TH:case Q.TR:{KEe(e,t);break}case Q.STYLE:case Q.SCRIPT:case Q.TEMPLATE:{hh(e,t);break}case Q.COL:{XEe(e,t);break}case Q.FORM:{eSe(e,t);break}case Q.TABLE:{QEe(e,t);break}case Q.TBODY:case Q.TFOOT:case Q.THEAD:{YEe(e,t);break}case Q.INPUT:{JEe(e,t);break}case Q.CAPTION:{WEe(e,t);break}case Q.COLGROUP:{ZEe(e,t);break}default:zT(e,t)}}function eT(e,t){switch(t.tagID){case Q.TABLE:{e.openElements.hasInTableScope(Q.TABLE)&&(e.openElements.popUntilTagNamePopped(Q.TABLE),e._resetInsertionMode());break}case Q.TEMPLATE:{R_(e,t);break}case Q.BODY:case Q.CAPTION:case Q.COL:case Q.COLGROUP:case Q.HTML:case Q.TBODY:case Q.TD:case Q.TFOOT:case Q.TH:case Q.THEAD:case Q.TR:break;default:zT(e,t)}}function zT(e,t){const n=e.fosterParentingEnabled;e.fosterParentingEnabled=!0,pk(e,t),e.fosterParentingEnabled=n}function NJ(e,t){e.pendingCharacterTokens.push(t)}function zJ(e,t){e.pendingCharacterTokens.push(t),e.hasNonWhitespacePendingCharacterToken=!0}function Aw(e,t){let n=0;if(e.hasNonWhitespacePendingCharacterToken)for(;n<e.pendingCharacterTokens.length;n++)zT(e,e.pendingCharacterTokens[n]);else for(;n<e.pendingCharacterTokens.length;n++)e._insertCharacters(e.pendingCharacterTokens[n]);e.insertionMode=e.originalInsertionMode,e._processToken(t)}const FJ=new Set([Q.CAPTION,Q.COL,Q.COLGROUP,Q.TBODY,Q.TD,Q.TFOOT,Q.TH,Q.THEAD,Q.TR]);function tSe(e,t){const n=t.tagID;FJ.has(n)?e.openElements.hasInTableScope(Q.CAPTION)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(Q.CAPTION),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=ot.IN_TABLE,jv(e,t)):su(e,t)}function nSe(e,t){const n=t.tagID;switch(n){case Q.CAPTION:case Q.TABLE:{e.openElements.hasInTableScope(Q.CAPTION)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(Q.CAPTION),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=ot.IN_TABLE,n===Q.TABLE&&eT(e,t));break}case Q.BODY:case Q.COL:case Q.COLGROUP:case Q.HTML:case Q.TBODY:case Q.TD:case Q.TFOOT:case Q.TH:case Q.THEAD:case Q.TR:break;default:mk(e,t)}}function fD(e,t){switch(t.tagID){case Q.HTML:{su(e,t);break}case Q.COL:{e._appendElement(t,Gn.HTML),t.ackSelfClosing=!0;break}case Q.TEMPLATE:{hh(e,t);break}default:oC(e,t)}}function rSe(e,t){switch(t.tagID){case Q.COLGROUP:{e.openElements.currentTagId===Q.COLGROUP&&(e.openElements.pop(),e.insertionMode=ot.IN_TABLE);break}case Q.TEMPLATE:{R_(e,t);break}case Q.COL:break;default:oC(e,t)}}function oC(e,t){e.openElements.currentTagId===Q.COLGROUP&&(e.openElements.pop(),e.insertionMode=ot.IN_TABLE,e._processToken(t))}function gk(e,t){switch(t.tagID){case Q.TR:{e.openElements.clearBackToTableBodyContext(),e._insertElement(t,Gn.HTML),e.insertionMode=ot.IN_ROW;break}case Q.TH:case Q.TD:{e.openElements.clearBackToTableBodyContext(),e._insertFakeElement(qt.TR,Q.TR),e.insertionMode=ot.IN_ROW,_k(e,t);break}case Q.CAPTION:case Q.COL:case Q.COLGROUP:case Q.TBODY:case Q.TFOOT:case Q.THEAD:{e.openElements.hasTableBodyContextInTableScope()&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=ot.IN_TABLE,jv(e,t));break}default:jv(e,t)}}function h8(e,t){const n=t.tagID;switch(t.tagID){case Q.TBODY:case Q.TFOOT:case Q.THEAD:{e.openElements.hasInTableScope(n)&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=ot.IN_TABLE);break}case Q.TABLE:{e.openElements.hasTableBodyContextInTableScope()&&(e.openElements.clearBackToTableBodyContext(),e.openElements.pop(),e.insertionMode=ot.IN_TABLE,eT(e,t));break}case Q.BODY:case Q.CAPTION:case Q.COL:case Q.COLGROUP:case Q.HTML:case Q.TD:case Q.TH:case Q.TR:break;default:eT(e,t)}}function _k(e,t){switch(t.tagID){case Q.TH:case Q.TD:{e.openElements.clearBackToTableRowContext(),e._insertElement(t,Gn.HTML),e.insertionMode=ot.IN_CELL,e.activeFormattingElements.insertMarker();break}case Q.CAPTION:case Q.COL:case Q.COLGROUP:case Q.TBODY:case Q.TFOOT:case Q.THEAD:case Q.TR:{e.openElements.hasInTableScope(Q.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=ot.IN_TABLE_BODY,gk(e,t));break}default:jv(e,t)}}function BJ(e,t){switch(t.tagID){case Q.TR:{e.openElements.hasInTableScope(Q.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=ot.IN_TABLE_BODY);break}case Q.TABLE:{e.openElements.hasInTableScope(Q.TR)&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=ot.IN_TABLE_BODY,h8(e,t));break}case Q.TBODY:case Q.TFOOT:case Q.THEAD:{(e.openElements.hasInTableScope(t.tagID)||e.openElements.hasInTableScope(Q.TR))&&(e.openElements.clearBackToTableRowContext(),e.openElements.pop(),e.insertionMode=ot.IN_TABLE_BODY,h8(e,t));break}case Q.BODY:case Q.CAPTION:case Q.COL:case Q.COLGROUP:case Q.HTML:case Q.TD:case Q.TH:break;default:eT(e,t)}}function iSe(e,t){const n=t.tagID;FJ.has(n)?(e.openElements.hasInTableScope(Q.TD)||e.openElements.hasInTableScope(Q.TH))&&(e._closeTableCell(),_k(e,t)):su(e,t)}function sSe(e,t){const n=t.tagID;switch(n){case Q.TD:case Q.TH:{e.openElements.hasInTableScope(n)&&(e.openElements.generateImpliedEndTags(),e.openElements.popUntilTagNamePopped(n),e.activeFormattingElements.clearToLastMarker(),e.insertionMode=ot.IN_ROW);break}case Q.TABLE:case Q.TBODY:case Q.TFOOT:case Q.THEAD:case Q.TR:{e.openElements.hasInTableScope(n)&&(e._closeTableCell(),BJ(e,t));break}case Q.BODY:case Q.CAPTION:case Q.COL:case Q.COLGROUP:case Q.HTML:break;default:mk(e,t)}}function jJ(e,t){switch(t.tagID){case Q.HTML:{su(e,t);break}case Q.OPTION:{e.openElements.currentTagId===Q.OPTION&&e.openElements.pop(),e._insertElement(t,Gn.HTML);break}case Q.OPTGROUP:{e.openElements.currentTagId===Q.OPTION&&e.openElements.pop(),e.openElements.currentTagId===Q.OPTGROUP&&e.openElements.pop(),e._insertElement(t,Gn.HTML);break}case Q.HR:{e.openElements.currentTagId===Q.OPTION&&e.openElements.pop(),e.openElements.currentTagId===Q.OPTGROUP&&e.openElements.pop(),e._appendElement(t,Gn.HTML),t.ackSelfClosing=!0;break}case Q.INPUT:case Q.KEYGEN:case Q.TEXTAREA:case Q.SELECT:{e.openElements.hasInSelectScope(Q.SELECT)&&(e.openElements.popUntilTagNamePopped(Q.SELECT),e._resetInsertionMode(),t.tagID!==Q.SELECT&&e._processStartTag(t));break}case Q.SCRIPT:case Q.TEMPLATE:{hh(e,t);break}}}function UJ(e,t){switch(t.tagID){case Q.OPTGROUP:{e.openElements.stackTop>0&&e.openElements.currentTagId===Q.OPTION&&e.openElements.tagIDs[e.openElements.stackTop-1]===Q.OPTGROUP&&e.openElements.pop(),e.openElements.currentTagId===Q.OPTGROUP&&e.openElements.pop();break}case Q.OPTION:{e.openElements.currentTagId===Q.OPTION&&e.openElements.pop();break}case Q.SELECT:{e.openElements.hasInSelectScope(Q.SELECT)&&(e.openElements.popUntilTagNamePopped(Q.SELECT),e._resetInsertionMode());break}case Q.TEMPLATE:{R_(e,t);break}}}function aSe(e,t){const n=t.tagID;n===Q.CAPTION||n===Q.TABLE||n===Q.TBODY||n===Q.TFOOT||n===Q.THEAD||n===Q.TR||n===Q.TD||n===Q.TH?(e.openElements.popUntilTagNamePopped(Q.SELECT),e._resetInsertionMode(),e._processStartTag(t)):jJ(e,t)}function oSe(e,t){const n=t.tagID;n===Q.CAPTION||n===Q.TABLE||n===Q.TBODY||n===Q.TFOOT||n===Q.THEAD||n===Q.TR||n===Q.TD||n===Q.TH?e.openElements.hasInTableScope(n)&&(e.openElements.popUntilTagNamePopped(Q.SELECT),e._resetInsertionMode(),e.onEndTag(t)):UJ(e,t)}function lSe(e,t){switch(t.tagID){case Q.BASE:case Q.BASEFONT:case Q.BGSOUND:case Q.LINK:case Q.META:case Q.NOFRAMES:case Q.SCRIPT:case Q.STYLE:case Q.TEMPLATE:case Q.TITLE:{hh(e,t);break}case Q.CAPTION:case Q.COLGROUP:case Q.TBODY:case Q.TFOOT:case Q.THEAD:{e.tmplInsertionModeStack[0]=ot.IN_TABLE,e.insertionMode=ot.IN_TABLE,jv(e,t);break}case Q.COL:{e.tmplInsertionModeStack[0]=ot.IN_COLUMN_GROUP,e.insertionMode=ot.IN_COLUMN_GROUP,fD(e,t);break}case Q.TR:{e.tmplInsertionModeStack[0]=ot.IN_TABLE_BODY,e.insertionMode=ot.IN_TABLE_BODY,gk(e,t);break}case Q.TD:case Q.TH:{e.tmplInsertionModeStack[0]=ot.IN_ROW,e.insertionMode=ot.IN_ROW,_k(e,t);break}default:e.tmplInsertionModeStack[0]=ot.IN_BODY,e.insertionMode=ot.IN_BODY,su(e,t)}}function uSe(e,t){t.tagID===Q.TEMPLATE&&R_(e,t)}function VJ(e,t){e.openElements.tmplCount>0?(e.openElements.popUntilTagNamePopped(Q.TEMPLATE),e.activeFormattingElements.clearToLastMarker(),e.tmplInsertionModeStack.shift(),e._resetInsertionMode(),e.onEof(t)):hD(e,t)}function cSe(e,t){t.tagID===Q.HTML?su(e,t):lC(e,t)}function $J(e,t){var n;if(t.tagID===Q.HTML){if(e.fragmentContext||(e.insertionMode=ot.AFTER_AFTER_BODY),e.options.sourceCodeLocationInfo&&e.openElements.tagIDs[0]===Q.HTML){e._setEndLocation(e.openElements.items[0],t);const r=e.openElements.items[1];r&&!(!((n=e.treeAdapter.getNodeSourceCodeLocation(r))===null||n===void 0)&&n.endTag)&&e._setEndLocation(r,t)}}else lC(e,t)}function lC(e,t){e.insertionMode=ot.IN_BODY,pk(e,t)}function dSe(e,t){switch(t.tagID){case Q.HTML:{su(e,t);break}case Q.FRAMESET:{e._insertElement(t,Gn.HTML);break}case Q.FRAME:{e._appendElement(t,Gn.HTML),t.ackSelfClosing=!0;break}case Q.NOFRAMES:{hh(e,t);break}}}function hSe(e,t){t.tagID===Q.FRAMESET&&!e.openElements.isRootHtmlElementCurrent()&&(e.openElements.pop(),!e.fragmentContext&&e.openElements.currentTagId!==Q.FRAMESET&&(e.insertionMode=ot.AFTER_FRAMESET))}function fSe(e,t){switch(t.tagID){case Q.HTML:{su(e,t);break}case Q.NOFRAMES:{hh(e,t);break}}}function pSe(e,t){t.tagID===Q.HTML&&(e.insertionMode=ot.AFTER_AFTER_FRAMESET)}function mSe(e,t){t.tagID===Q.HTML?su(e,t):F4(e,t)}function F4(e,t){e.insertionMode=ot.IN_BODY,pk(e,t)}function gSe(e,t){switch(t.tagID){case Q.HTML:{su(e,t);break}case Q.NOFRAMES:{hh(e,t);break}}}function _Se(e,t){t.chars=_o,e._insertCharacters(t)}function ySe(e,t){e._insertCharacters(t),e.framesetOk=!1}function HJ(e){for(;e.treeAdapter.getNamespaceURI(e.openElements.current)!==Gn.HTML&&e.openElements.currentTagId!==void 0&&!e._isIntegrationPoint(e.openElements.currentTagId,e.openElements.current);)e.openElements.pop()}function vSe(e,t){if(LTe(t))HJ(e),e._startTagOutsideForeignContent(t);else{const n=e._getAdjustedCurrentElement(),r=e.treeAdapter.getNamespaceURI(n);r===Gn.MATHML?CJ(t):r===Gn.SVG&&(DTe(t),kJ(t)),cD(t),t.selfClosing?e._appendElement(t,r):e._insertElement(t,r),t.ackSelfClosing=!0}}function xSe(e,t){if(t.tagID===Q.P||t.tagID===Q.BR){HJ(e),e._endTagOutsideForeignContent(t);return}for(let n=e.openElements.stackTop;n>0;n--){const r=e.openElements.items[n];if(e.treeAdapter.getNamespaceURI(r)===Gn.HTML){e._endTagOutsideForeignContent(t);break}const a=e.treeAdapter.getTagName(r);if(a.toLowerCase()===t.tagName){t.tagName=a,e.openElements.shortenToLength(n);break}}}qt.AREA,qt.BASE,qt.BASEFONT,qt.BGSOUND,qt.BR,qt.COL,qt.EMBED,qt.FRAME,qt.HR,qt.IMG,qt.INPUT,qt.KEYGEN,qt.LINK,qt.META,qt.PARAM,qt.SOURCE,qt.TRACK,qt.WBR;const yk=GJ("end"),gf=GJ("start");function GJ(e){return t;function t(n){const r=n&&n.position&&n.position[e]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function qJ(e){const t=gf(e),n=yk(e);if(t&&n)return{start:t,end:n}}function bSe(e,t,n,r){let a,u,f;u=t,f=n,a=r,ox(e,u,s,a);function s(v,x){const A=x[x.length-1],C=A?A.children.indexOf(v):void 0;return f(v,C,A)}}const wSe=/<(\/?)(iframe|noembed|noframes|plaintext|script|style|textarea|title|xmp)(?=[\t\n\f\r />])/gi,TSe=new Set(["mdxFlowExpression","mdxJsxFlowElement","mdxJsxTextElement","mdxTextExpression","mdxjsEsm"]),YV={sourceCodeLocationInfo:!0,scriptingEnabled:!1};function WJ(e,t){const n=OSe(e),r=gJ("type",{handlers:{root:ESe,element:SSe,text:ASe,comment:XJ,doctype:CSe,raw:ISe},unknown:RSe}),a={parser:n?new WV(YV):WV.getFragmentParser(void 0,YV),handle(s){r(s,a)},stitches:!1,options:t||{}};r(e,a),mx(a,gf());const u=n?a.parser.document:a.parser.getFragment(),f=E2e(u,{file:a.options.file});return a.stitches&&bSe(f,"comment",function(s,v,x){const A=s;if(A.value.stitch&&x&&v!==void 0){const C=x.children;return C[v]=A.value.stitch,v}}),f.type==="root"&&f.children.length===1&&f.children[0].type===e.type?f.children[0]:f}function ZJ(e,t){let n=-1;if(e)for(;++n<e.length;)t.handle(e[n])}function ESe(e,t){ZJ(e.children,t)}function SSe(e,t){MSe(e,t),ZJ(e.children,t),PSe(e,t)}function ASe(e,t){t.parser.tokenizer.state>4&&(t.parser.tokenizer.state=0);const n={type:Ws.CHARACTER,chars:e.value,location:FT(e)};mx(t,gf(e)),t.parser.currentToken=n,t.parser._processToken(t.parser.currentToken)}function CSe(e,t){const n={type:Ws.DOCTYPE,name:"html",forceQuirks:!1,publicId:"",systemId:"",location:FT(e)};mx(t,gf(e)),t.parser.currentToken=n,t.parser._processToken(t.parser.currentToken)}function kSe(e,t){t.stitches=!0;const n=LSe(e);if("children"in e&&"children"in n){const r=WJ({type:"root",children:e.children},t.options);n.children=r.children}XJ({type:"comment",value:{stitch:n}},t)}function XJ(e,t){const n=e.value,r={type:Ws.COMMENT,data:n,location:FT(e)};mx(t,gf(e)),t.parser.currentToken=r,t.parser._processToken(t.parser.currentToken)}function ISe(e,t){if(t.parser.tokenizer.preprocessor.html="",t.parser.tokenizer.preprocessor.pos=-1,t.parser.tokenizer.preprocessor.lastGapPos=-2,t.parser.tokenizer.preprocessor.gapStack=[],t.parser.tokenizer.preprocessor.skipNextNewLine=!1,t.parser.tokenizer.preprocessor.lastChunkWritten=!1,t.parser.tokenizer.preprocessor.endOfChunkHit=!1,t.parser.tokenizer.preprocessor.isEol=!1,YJ(t,gf(e)),t.parser.tokenizer.write(t.options.tagfilter?e.value.replace(wSe,"&lt;$1$2"):e.value,!1),t.parser.tokenizer._runParsingLoop(),t.parser.tokenizer.state===72||t.parser.tokenizer.state===78){t.parser.tokenizer.preprocessor.lastChunkWritten=!0;const n=t.parser.tokenizer._consume();t.parser.tokenizer._callState(n)}}function RSe(e,t){const n=e;if(t.options.passThrough&&t.options.passThrough.includes(n.type))kSe(n,t);else{let r="";throw TSe.has(n.type)&&(r=". It looks like you are using MDX nodes with `hast-util-raw` (or `rehype-raw`). If you use this because you are using remark or rehype plugins that inject `'html'` nodes, then please raise an issue with that plugin, as its a bad and slow idea. If you use this because you are using markdown syntax, then you have to configure this utility (or plugin) to pass through these nodes (see `passThrough` in docs), but you can also migrate to use the MDX syntax"),new Error("Cannot compile `"+n.type+"` node"+r)}}function mx(e,t){YJ(e,t);const n=e.parser.tokenizer.currentCharacterToken;n&&n.location&&(n.location.endLine=e.parser.tokenizer.preprocessor.line,n.location.endCol=e.parser.tokenizer.preprocessor.col+1,n.location.endOffset=e.parser.tokenizer.preprocessor.offset+1,e.parser.currentToken=n,e.parser._processToken(e.parser.currentToken)),e.parser.tokenizer.paused=!1,e.parser.tokenizer.inLoop=!1,e.parser.tokenizer.active=!1,e.parser.tokenizer.returnState=Ho.DATA,e.parser.tokenizer.charRefCode=-1,e.parser.tokenizer.consumedAfterSnapshot=-1,e.parser.tokenizer.currentLocation=null,e.parser.tokenizer.currentCharacterToken=null,e.parser.tokenizer.currentToken=null,e.parser.tokenizer.currentAttr={name:"",value:""}}function YJ(e,t){if(t&&t.offset!==void 0){const n={startLine:t.line,startCol:t.column,startOffset:t.offset,endLine:-1,endCol:-1,endOffset:-1};e.parser.tokenizer.preprocessor.lineStartPos=-t.column+1,e.parser.tokenizer.preprocessor.droppedBufferSize=t.offset,e.parser.tokenizer.preprocessor.line=t.line,e.parser.tokenizer.currentLocation=n}}function MSe(e,t){const n=e.tagName.toLowerCase();if(t.parser.tokenizer.state===Ho.PLAINTEXT)return;mx(t,gf(e));const r=t.parser.openElements.current;let a="namespaceURI"in r?r.namespaceURI:Kh.html;a===Kh.html&&n==="svg"&&(a=Kh.svg);const u=F2e({...e,children:[]},{space:a===Kh.svg?"svg":"html"}),f={type:Ws.START_TAG,tagName:n,tagID:px(n),selfClosing:!1,ackSelfClosing:!1,attrs:"attrs"in u?u.attrs:[],location:FT(e)};t.parser.currentToken=f,t.parser._processToken(t.parser.currentToken),t.parser.tokenizer.lastStartTagName=n}function PSe(e,t){const n=e.tagName.toLowerCase();if(!t.parser.tokenizer.inForeignNode&&q2e.includes(n)||t.parser.tokenizer.state===Ho.PLAINTEXT)return;mx(t,yk(e));const r={type:Ws.END_TAG,tagName:n,tagID:px(n),selfClosing:!1,ackSelfClosing:!1,attrs:[],location:FT(e)};t.parser.currentToken=r,t.parser._processToken(t.parser.currentToken),n===t.parser.tokenizer.lastStartTagName&&(t.parser.tokenizer.state===Ho.RCDATA||t.parser.tokenizer.state===Ho.RAWTEXT||t.parser.tokenizer.state===Ho.SCRIPT_DATA)&&(t.parser.tokenizer.state=Ho.DATA)}function OSe(e){const t=e.type==="root"?e.children[0]:e;return!!(t&&(t.type==="doctype"||t.type==="element"&&t.tagName.toLowerCase()==="html"))}function FT(e){const t=gf(e)||{line:void 0,column:void 0,offset:void 0},n=yk(e)||{line:void 0,column:void 0,offset:void 0};return{startLine:t.line,startCol:t.column,startOffset:t.offset,endLine:n.line,endCol:n.column,endOffset:n.offset}}function LSe(e){return"children"in e?h_({...e,children:[]}):h_(e)}function DSe(e){return function(t,n){return WJ(t,{...e,file:n})}}const Eg=["ariaDescribedBy","ariaLabel","ariaLabelledBy"],KV={ancestors:{tbody:["table"],td:["table"],th:["table"],thead:["table"],tfoot:["table"],tr:["table"]},attributes:{a:[...Eg,"dataFootnoteBackref","dataFootnoteRef",["className","data-footnote-backref"],"href"],blockquote:["cite"],code:[["className",/^language-./]],del:["cite"],div:["itemScope","itemType"],dl:[...Eg],h2:[["className","sr-only"]],img:[...Eg,"longDesc","src"],input:[["disabled",!0],["type","checkbox"]],ins:["cite"],li:[["className","task-list-item"]],ol:[...Eg,["className","contains-task-list"]],q:["cite"],section:["dataFootnotes",["className","footnotes"]],source:["srcSet"],summary:[...Eg],table:[...Eg],ul:[...Eg,["className","contains-task-list"]],"*":["abbr","accept","acceptCharset","accessKey","action","align","alt","axis","border","cellPadding","cellSpacing","char","charOff","charSet","checked","clear","colSpan","color","cols","compact","coords","dateTime","dir","encType","frame","hSpace","headers","height","hrefLang","htmlFor","id","isMap","itemProp","label","lang","maxLength","media","method","multiple","name","noHref","noShade","noWrap","open","prompt","readOnly","rev","rowSpan","rows","rules","scope","selected","shape","size","span","start","summary","tabIndex","title","useMap","vAlign","value","width"]},clobber:["ariaDescribedBy","ariaLabelledBy","id","name"],clobberPrefix:"user-content-",protocols:{cite:["http","https"],href:["http","https","irc","ircs","mailto","xmpp"],longDesc:["http","https"],src:["http","https"]},required:{input:{disabled:!0,type:"checkbox"}},strip:["script"],tagNames:["a","b","blockquote","br","code","dd","del","details","div","dl","dt","em","h1","h2","h3","h4","h5","h6","hr","i","img","input","ins","kbd","li","ol","p","picture","pre","q","rp","rt","ruby","s","samp","section","source","span","strike","strong","sub","summary","sup","table","tbody","td","tfoot","th","thead","tr","tt","ul","var"]},wm={}.hasOwnProperty;function NSe(e,t){let n={type:"root",children:[]};const r={schema:t?{...KV,...t}:KV,stack:[]},a=KJ(r,e);return a&&(Array.isArray(a)?a.length===1?n=a[0]:n.children=a:n=a),n}function KJ(e,t){if(t&&typeof t=="object"){const n=t;switch(typeof n.type=="string"?n.type:""){case"comment":return zSe(e,n);case"doctype":return FSe(e,n);case"element":return BSe(e,n);case"root":return jSe(e,n);case"text":return USe(e,n)}}}function zSe(e,t){if(e.schema.allowComments){const n=typeof t.value=="string"?t.value:"",r=n.indexOf("-->"),u={type:"comment",value:r<0?n:n.slice(0,r)};return BT(u,t),u}}function FSe(e,t){if(e.schema.allowDoctypes){const n={type:"doctype"};return BT(n,t),n}}function BSe(e,t){const n=typeof t.tagName=="string"?t.tagName:"";e.stack.push(n);const r=QJ(e,t.children),a=VSe(e,t.properties);e.stack.pop();let u=!1;if(n&&n!=="*"&&(!e.schema.tagNames||e.schema.tagNames.includes(n))&&(u=!0,e.schema.ancestors&&wm.call(e.schema.ancestors,n))){const s=e.schema.ancestors[n];let v=-1;for(u=!1;++v<s.length;)e.stack.includes(s[v])&&(u=!0)}if(!u)return e.schema.strip&&!e.schema.strip.includes(n)?r:void 0;const f={type:"element",tagName:n,properties:a,children:r};return BT(f,t),f}function jSe(e,t){const r={type:"root",children:QJ(e,t.children)};return BT(r,t),r}function USe(e,t){const r={type:"text",value:typeof t.value=="string"?t.value:""};return BT(r,t),r}function QJ(e,t){const n=[];if(Array.isArray(t)){const r=t;let a=-1;for(;++a<r.length;){const u=KJ(e,r[a]);u&&(Array.isArray(u)?n.push(...u):n.push(u))}}return n}function VSe(e,t){const n=e.stack[e.stack.length-1],r=e.schema.attributes,a=e.schema.required,u=r&&wm.call(r,n)?r[n]:void 0,f=r&&wm.call(r,"*")?r["*"]:void 0,s=t&&typeof t=="object"?t:{},v={};let x;for(x in s)if(wm.call(s,x)){const A=s[x];let C=QV(e,JV(u,x),x,A);C==null&&(C=QV(e,JV(f,x),x,A)),C!=null&&(v[x]=C)}if(a&&wm.call(a,n)){const A=a[n];for(x in A)wm.call(A,x)&&!wm.call(v,x)&&(v[x]=A[x])}return v}function QV(e,t,n,r){return t?Array.isArray(r)?$Se(e,t,n,r):JJ(e,t,n,r):void 0}function $Se(e,t,n,r){let a=-1;const u=[];for(;++a<r.length;){const f=JJ(e,t,n,r[a]);(typeof f=="number"||typeof f=="string")&&u.push(f)}return u}function JJ(e,t,n,r){if(!(typeof r!="boolean"&&typeof r!="number"&&typeof r!="string")&&HSe(e,n,r)){if(typeof t=="object"&&t.length>1){let a=!1,u=0;for(;++u<t.length;){const f=t[u];if(f&&typeof f=="object"&&"flags"in f){if(f.test(String(r))){a=!0;break}}else if(f===r){a=!0;break}}if(!a)return}return e.schema.clobber&&e.schema.clobberPrefix&&e.schema.clobber.includes(n)?e.schema.clobberPrefix+r:r}}function HSe(e,t,n){const r=e.schema.protocols&&wm.call(e.schema.protocols,t)?e.schema.protocols[t]:void 0;if(!r||r.length===0)return!0;const a=String(n),u=a.indexOf(":"),f=a.indexOf("?"),s=a.indexOf("#"),v=a.indexOf("/");if(u<0||v>-1&&u>v||f>-1&&u>f||s>-1&&u>s)return!0;let x=-1;for(;++x<r.length;){const A=r[x];if(u===A.length&&a.slice(0,A.length)===A)return!0}return!1}function BT(e,t){const n=qJ(t);t.data&&(e.data=h_(t.data)),n&&(e.position=n)}function JV(e,t){let n,r=-1;if(e)for(;++r<e.length;){const a=e[r],u=typeof a=="string"?a:a[0];if(u===t)return a;u==="data*"&&(n=a)}if(t.length>4&&t.slice(0,4).toLowerCase()==="data")return n}function GSe(e){return function(t){return NSe(t,e)}}const rp={eof:null,asterisk:42,underscore:95,tilde:126},Uv={attentionSideAfter:2,characterGroupPunctuation:2,characterGroupWhitespace:1},jh={data:"data",characterEscape:"characterEscape",emphasis:"emphasis",emphasisSequence:"emphasisSequence",emphasisText:"emphasisText",strong:"strong",strongSequence:"strongSequence",strongText:"strongText"},bu=E0(/[A-Za-z]/),tu=E0(/[\dA-Za-z]/),qSe=E0(/[#-'*+\--9=?A-Z^-~]/);function uC(e){return e!==null&&(e<32||e===127)}const f8=E0(/\d/),WSe=E0(/[\dA-Fa-f]/),ZSe=E0(/[!-/:-@[-`{-~]/);function vi(e){return e!==null&&e<-2}function Va(e){return e!==null&&(e<0||e===32)}function Js(e){return e===-2||e===-1||e===32}const vk=E0(new RegExp("\\p{P}|\\p{S}","u")),f_=E0(/\s/);function E0(e){return t;function t(n){return n!==null&&n>-1&&e.test(String.fromCharCode(n))}}function XSe(e){return e===161||e===164||e===167||e===168||e===170||e===173||e===174||e>=176&&e<=180||e>=182&&e<=186||e>=188&&e<=191||e===198||e===208||e===215||e===216||e>=222&&e<=225||e===230||e>=232&&e<=234||e===236||e===237||e===240||e===242||e===243||e>=247&&e<=250||e===252||e===254||e===257||e===273||e===275||e===283||e===294||e===295||e===299||e>=305&&e<=307||e===312||e>=319&&e<=322||e===324||e>=328&&e<=331||e===333||e===338||e===339||e===358||e===359||e===363||e===462||e===464||e===466||e===468||e===470||e===472||e===474||e===476||e===593||e===609||e===708||e===711||e>=713&&e<=715||e===717||e===720||e>=728&&e<=731||e===733||e===735||e>=768&&e<=879||e>=913&&e<=929||e>=931&&e<=937||e>=945&&e<=961||e>=963&&e<=969||e===1025||e>=1040&&e<=1103||e===1105||e===8208||e>=8211&&e<=8214||e===8216||e===8217||e===8220||e===8221||e>=8224&&e<=8226||e>=8228&&e<=8231||e===8240||e===8242||e===8243||e===8245||e===8251||e===8254||e===8308||e===8319||e>=8321&&e<=8324||e===8364||e===8451||e===8453||e===8457||e===8467||e===8470||e===8481||e===8482||e===8486||e===8491||e===8531||e===8532||e>=8539&&e<=8542||e>=8544&&e<=8555||e>=8560&&e<=8569||e===8585||e>=8592&&e<=8601||e===8632||e===8633||e===8658||e===8660||e===8679||e===8704||e===8706||e===8707||e===8711||e===8712||e===8715||e===8719||e===8721||e===8725||e===8730||e>=8733&&e<=8736||e===8739||e===8741||e>=8743&&e<=8748||e===8750||e>=8756&&e<=8759||e===8764||e===8765||e===8776||e===8780||e===8786||e===8800||e===8801||e>=8804&&e<=8807||e===8810||e===8811||e===8814||e===8815||e===8834||e===8835||e===8838||e===8839||e===8853||e===8857||e===8869||e===8895||e===8978||e>=9312&&e<=9449||e>=9451&&e<=9547||e>=9552&&e<=9587||e>=9600&&e<=9615||e>=9618&&e<=9621||e===9632||e===9633||e>=9635&&e<=9641||e===9650||e===9651||e===9654||e===9655||e===9660||e===9661||e===9664||e===9665||e>=9670&&e<=9672||e===9675||e>=9678&&e<=9681||e>=9698&&e<=9701||e===9711||e===9733||e===9734||e===9737||e===9742||e===9743||e===9756||e===9758||e===9792||e===9794||e===9824||e===9825||e>=9827&&e<=9829||e>=9831&&e<=9834||e===9836||e===9837||e===9839||e===9886||e===9887||e===9919||e>=9926&&e<=9933||e>=9935&&e<=9939||e>=9941&&e<=9953||e===9955||e===9960||e===9961||e>=9963&&e<=9969||e===9972||e>=9974&&e<=9977||e===9979||e===9980||e===9982||e===9983||e===10045||e>=10102&&e<=10111||e>=11094&&e<=11097||e>=12872&&e<=12879||e>=57344&&e<=63743||e>=65024&&e<=65039||e===65533||e>=127232&&e<=127242||e>=127248&&e<=127277||e>=127280&&e<=127337||e>=127344&&e<=127373||e===127375||e===127376||e>=127387&&e<=127404||e>=917760&&e<=917999||e>=983040&&e<=1048573||e>=1048576&&e<=1114109}function YSe(e){return e===12288||e>=65281&&e<=65376||e>=65504&&e<=65510}function KSe(e){return e>=4352&&e<=4447||e===8986||e===8987||e===9001||e===9002||e>=9193&&e<=9196||e===9200||e===9203||e===9725||e===9726||e===9748||e===9749||e>=9776&&e<=9783||e>=9800&&e<=9811||e===9855||e>=9866&&e<=9871||e===9875||e===9889||e===9898||e===9899||e===9917||e===9918||e===9924||e===9925||e===9934||e===9940||e===9962||e===9970||e===9971||e===9973||e===9978||e===9981||e===9989||e===9994||e===9995||e===10024||e===10060||e===10062||e>=10067&&e<=10069||e===10071||e>=10133&&e<=10135||e===10160||e===10175||e===11035||e===11036||e===11088||e===11093||e>=11904&&e<=11929||e>=11931&&e<=12019||e>=12032&&e<=12245||e>=12272&&e<=12287||e>=12289&&e<=12350||e>=12353&&e<=12438||e>=12441&&e<=12543||e>=12549&&e<=12591||e>=12593&&e<=12686||e>=12688&&e<=12773||e>=12783&&e<=12830||e>=12832&&e<=12871||e>=12880&&e<=42124||e>=42128&&e<=42182||e>=43360&&e<=43388||e>=44032&&e<=55203||e>=63744&&e<=64255||e>=65040&&e<=65049||e>=65072&&e<=65106||e>=65108&&e<=65126||e>=65128&&e<=65131||e>=94176&&e<=94180||e>=94192&&e<=94198||e>=94208&&e<=101589||e>=101631&&e<=101662||e>=101760&&e<=101874||e>=110576&&e<=110579||e>=110581&&e<=110587||e===110589||e===110590||e>=110592&&e<=110882||e===110898||e>=110928&&e<=110930||e===110933||e>=110948&&e<=110951||e>=110960&&e<=111355||e>=119552&&e<=119638||e>=119648&&e<=119670||e===126980||e===127183||e===127374||e>=127377&&e<=127386||e>=127488&&e<=127490||e>=127504&&e<=127547||e>=127552&&e<=127560||e===127568||e===127569||e>=127584&&e<=127589||e>=127744&&e<=127776||e>=127789&&e<=127797||e>=127799&&e<=127868||e>=127870&&e<=127891||e>=127904&&e<=127946||e>=127951&&e<=127955||e>=127968&&e<=127984||e===127988||e>=127992&&e<=128062||e===128064||e>=128066&&e<=128252||e>=128255&&e<=128317||e>=128331&&e<=128334||e>=128336&&e<=128359||e===128378||e===128405||e===128406||e===128420||e>=128507&&e<=128591||e>=128640&&e<=128709||e===128716||e>=128720&&e<=128722||e>=128725&&e<=128728||e>=128732&&e<=128735||e===128747||e===128748||e>=128756&&e<=128764||e>=128992&&e<=129003||e===129008||e>=129292&&e<=129338||e>=129340&&e<=129349||e>=129351&&e<=129535||e>=129648&&e<=129660||e>=129664&&e<=129674||e>=129678&&e<=129734||e===129736||e>=129741&&e<=129756||e>=129759&&e<=129770||e>=129775&&e<=129784||e>=131072&&e<=196605||e>=196608&&e<=262141}function QSe(e){return XSe(e)?"ambiguous":YSe(e)?"fullwidth":e===8361||e>=65377&&e<=65470||e>=65474&&e<=65479||e>=65482&&e<=65487||e>=65490&&e<=65495||e>=65498&&e<=65500||e>=65512&&e<=65518?"halfwidth":e>=32&&e<=126||e===162||e===163||e===165||e===166||e===172||e===175||e>=10214&&e<=10221||e===10629||e===10630?"narrow":KSe(e)?"wide":"neutral"}function JSe(e){if(!Number.isSafeInteger(e))throw new TypeError(`Expected a code point, got \`${typeof e}\`.`)}function e3e(e){return JSe(e),QSe(e)}var t3e=Object.defineProperty,n3e=(e,t,n)=>t in e?t3e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,r3e=(e,t,n)=>n3e(e,t+"",n);function i3e(e){return new RegExp("^\\p{Emoji_Presentation}","u").test(String.fromCodePoint(e))}function s3e(e){if(!e||e<4352)return!1;switch(e3e(e)){case"fullwidth":case"halfwidth":return!0;case"wide":return!i3e(e);case"narrow":return!1;case"ambiguous":return 917760<=e&&e<=917999?null:!1;case"neutral":return new RegExp("^\\p{sc=Hangul}","u").test(String.fromCodePoint(e))}}function a3e(e,t){return t!==65025||!e||e<8216?!1:e===8216||e===8217||e===8220||e===8221}function o3e(e){return e!==null&&e>=65024&&e<=65038}var l3e=eee(new RegExp("\\p{P}|\\p{S}","u")),u3e=eee(/\s/);function eee(e){return t;function t(n){return n!==null&&n>-1&&e.test(String.fromCodePoint(n))}}var Rc;(e=>{e.spaceOrPunctuation=3,e.cjk=4096,e.cjkPunctuation=4098,e.ivs=8192,e.cjkOrIvs=12288,e.nonEmojiGeneralUseVS=16384,e.variationSelector=24576,e.ivsToCjkRightShift=1})(Rc||(Rc={}));function ov(e){if(e===rp.eof||Va(e)||u3e(e))return Uv.characterGroupWhitespace;let t=0;if(e>=4352){if(o3e(e))return Rc.nonEmojiGeneralUseVS;switch(s3e(e)){case null:return Rc.ivs;case!0:t|=Rc.cjk;break}}return l3e(e)&&(t|=Uv.characterGroupPunctuation),t}function tee(e,t,n){if(!f3e(e))return e;const r=t(),a=ov(r);return!r||tT(a)?e:a3e(r,n)?Rc.cjkPunctuation:c3e(a)}function c3e(e){return e&~Rc.ivs}function tT(e){return!!(e&Uv.characterGroupWhitespace)}function cC(e){return(e&Rc.cjkPunctuation)===Uv.characterGroupPunctuation}function p8(e){return!!(e&Rc.cjk)}function d3e(e){return e===Rc.ivs}function h3e(e){return!!(e&Rc.cjkOrIvs)}function f3e(e){return e===Rc.nonEmojiGeneralUseVS}function e$(e){return!!(e&Rc.spaceOrPunctuation)}function nee(e){return!!(e&&e>=55296&&e<=56319)}function ree(e){return!!(e&&e>=56320&&e<=57343)}function iee(e,t,n){if(t._bufferIndex<2)return e;const a=n({start:{...t,_bufferIndex:t._bufferIndex-2},end:t}).codePointAt(0);return a&&a>=65536?a:e}function p3e(e,t,n){const r=e>=65536?2:1;if(t._bufferIndex<1+r)return null;const a=t._bufferIndex-r-2,u=n({start:{...t,_bufferIndex:a>=0?a:0},end:{...t,_bufferIndex:t._bufferIndex-r}}),f=u.charCodeAt(u.length-1);if(Number.isNaN(f))return null;if(u.length<2||f<56320||57343<f)return f;const s=u.codePointAt(0);return s&&s>=65536?s:f}var see=class{constructor(e,t,n){this.previousCode=e,this.nowPoint=t,this.sliceSerialize=n,r3e(this,"cachedValue")}value(){return this.cachedValue===void 0&&(this.cachedValue=p3e(this.previousCode,this.nowPoint,this.sliceSerialize)),this.cachedValue}};function aee(e,t,n){const r=n({start:t,end:{...t,_bufferIndex:t._bufferIndex+2}}).codePointAt(0);return r&&r>=65536?r:e}function Bl(e,t,n,r){const a=e.length;let u=0,f;if(t<0?t=-t>a?0:a+t:t=t>a?a:t,n=n>0?n:0,r.length<1e4)f=Array.from(r),f.unshift(t,n),e.splice(...f);else for(n&&e.splice(t,n);u<r.length;)f=r.slice(u,u+1e4),f.unshift(t,0),e.splice(...f),u+=1e4,t+=1e4}function zl(e,t){return e.length>0?(Bl(e,e.length,0,t),e):t}function gx(e,t,n){const r=[];let a=-1;for(;++a<e.length;){const u=e[a].resolveAll;u&&!r.includes(u)&&(t=u(t,n),r.push(u))}return t}var J5={name:"attention",resolveAll:m3e,tokenize:g3e};function m3e(e,t){let n=-1,r,a,u,f,s,v,x,A;for(;++n<e.length;)if(e[n][0]==="enter"&&e[n][1].type==="attentionSequence"&&e[n][1]._close){for(r=n;r--;)if(e[r][0]==="exit"&&e[r][1].type==="attentionSequence"&&e[r][1]._open&&t.sliceSerialize(e[r][1]).charCodeAt(0)===t.sliceSerialize(e[n][1]).charCodeAt(0)){if((e[r][1]._close||e[n][1]._open)&&(e[n][1].end.offset-e[n][1].start.offset)%3&&!((e[r][1].end.offset-e[r][1].start.offset+e[n][1].end.offset-e[n][1].start.offset)%3))continue;v=e[r][1].end.offset-e[r][1].start.offset>1&&e[n][1].end.offset-e[n][1].start.offset>1?2:1;const C={...e[r][1].end},P={...e[n][1].start};t$(C,-v),t$(P,v),f={type:v>1?jh.strongSequence:jh.emphasisSequence,start:C,end:{...e[r][1].end}},s={type:v>1?jh.strongSequence:jh.emphasisSequence,start:{...e[n][1].start},end:P},u={type:v>1?jh.strongText:jh.emphasisText,start:{...e[r][1].end},end:{...e[n][1].start}},a={type:v>1?jh.strong:jh.emphasis,start:{...f.start},end:{...s.end}},e[r][1].end={...f.start},e[n][1].start={...s.end},x=[],e[r][1].end.offset-e[r][1].start.offset&&(x=zl(x,[["enter",e[r][1],t],["exit",e[r][1],t]])),x=zl(x,[["enter",a,t],["enter",f,t],["exit",f,t],["enter",u,t]]),t.parser.constructs.insideSpan.null,x=zl(x,gx(t.parser.constructs.insideSpan.null,e.slice(r+1,n),t)),x=zl(x,[["exit",u,t],["enter",s,t],["exit",s,t],["exit",a,t]]),e[n][1].end.offset-e[n][1].start.offset?(A=2,x=zl(x,[["enter",e[n][1],t],["exit",e[n][1],t]])):A=0,Bl(e,r-1,n-r+3,x),n=r+x.length-A-2;break}}for(n=-1;++n<e.length;)e[n][1].type==="attentionSequence"&&(e[n][1].type="data");return e}function g3e(e,t){const n=this.parser.constructs.attentionMarkers.null,{now:r,sliceSerialize:a,previous:u}=this,f=ree(u)?iee(u,r(),a):u,s=ov(f),v=new see(f,r(),a),x=tee(s,v.value.bind(v),f);let A;return C;function C(L){return A=L,e.enter("attentionSequence"),P(L)}function P(L){if(L===A)return e.consume(L),P;const F=e.exit("attentionSequence"),U=nee(L)?aee(L,r(),a):L,q=ov(U),G=cC(x),$=G||tT(x),X=cC(q),ie=X||tT(q),de=h3e(x),fe=!ie||X&&($||de)||n.includes(L),be=!$||G&&(ie||p8(q))||n.includes(f);return F._open=!!(A===rp.asterisk?fe:fe&&(e$(x)||!be)),F._close=!!(A===rp.asterisk?be:be&&(e$(q)||!fe)),t(L)}}function t$(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}function _3e(){return{text:{[rp.asterisk]:J5,[rp.underscore]:J5},insideSpan:{null:[J5]}}}function y3e(){const e=this.data();(e.micromarkExtensions||(e.micromarkExtensions=[])).push(_3e())}function v3e(e){let n=(e||{}).singleTilde;const r={name:"strikethrough",tokenize:u,resolveAll:a};return n==null&&(n=!0),{text:{[rp.tilde]:r},insideSpan:{null:[r]},attentionMarkers:{null:[rp.tilde]}};function a(f,s){let v=-1;for(;++v<f.length;)if(f[v][0]==="enter"&&f[v][1].type==="strikethroughSequenceTemporary"&&f[v][1]._close){let x=v;for(;x--;)if(f[x][0]==="exit"&&f[x][1].type==="strikethroughSequenceTemporary"&&f[x][1]._open&&f[v][1].end.offset-f[v][1].start.offset===f[x][1].end.offset-f[x][1].start.offset){f[v][1].type="strikethroughSequence",f[x][1].type="strikethroughSequence";const A={type:"strikethrough",start:Object.assign({},f[x][1].start),end:Object.assign({},f[v][1].end)},C={type:"strikethroughText",start:Object.assign({},f[x][1].end),end:Object.assign({},f[v][1].start)},P=[["enter",A,s],["enter",f[x][1],s],["exit",f[x][1],s],["enter",C,s]],L=s.parser.constructs.insideSpan.null;L&&Bl(P,P.length,0,gx(L,f.slice(x+1,v),s)),Bl(P,P.length,0,[["exit",C,s],["enter",f[v][1],s],["exit",f[v][1],s],["exit",A,s]]),Bl(f,x-1,v-x+3,P),v=x+P.length-2;break}}for(v=-1;++v<f.length;)f[v][1].type==="strikethroughSequenceTemporary"&&(f[v][1].type=jh.data);return f}function u(f,s,v){const{now:x,sliceSerialize:A,previous:C}=this,P=ree(C)?iee(C,x(),A):C,L=ov(P),F=new see(P,x(),A),U=tee(L,F.value.bind(F),P),q=this.events;let G=0;return $;function $(ie){return P===rp.tilde&&q[q.length-1][1].type!==jh.characterEscape?v(ie):(f.enter("strikethroughSequenceTemporary"),X(ie))}function X(ie){const de=ov(P);if(ie===rp.tilde)return G>1?v(ie):(f.consume(ie),G++,X);if(G<2&&!n)return v(ie);const fe=f.exit("strikethroughSequenceTemporary"),be=nee(ie)?aee(ie,x(),A):ie,ve=ov(be),we=cC(U)||tT(U),Je=cC(ve)||tT(ve),ft=p8(U)||d3e(de);return fe._open=!Je||ve===Uv.attentionSideAfter&&(we||ft),fe._close=!we||de===Uv.attentionSideAfter&&(Je||p8(ve)),s(ie)}}}function x3e(e){const t=this.data();(t.micromarkExtensions||(t.micromarkExtensions=[])).push(v3e(e))}function n$(e,t){const n=String(e);if(typeof t!="string")throw new TypeError("Expected character");let r=0,a=n.indexOf(t);for(;a!==-1;)r++,a=n.indexOf(t,a+t.length);return r}function b3e(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function w3e(e,t,n){const a=RT((n||{}).ignore||[]),u=T3e(t);let f=-1;for(;++f<u.length;)ox(e,"text",s);function s(x,A){let C=-1,P;for(;++C<A.length;){const L=A[C],F=P?P.children:void 0;if(a(L,F?F.indexOf(L):void 0,P))return;P=L}if(P)return v(x,A)}function v(x,A){const C=A[A.length-1],P=u[f][0],L=u[f][1];let F=0;const q=C.children.indexOf(x);let G=!1,$=[];P.lastIndex=0;let X=P.exec(x.value);for(;X;){const ie=X.index,de={index:X.index,input:X.input,stack:[...A,x]};let fe=L(...X,de);if(typeof fe=="string"&&(fe=fe.length>0?{type:"text",value:fe}:void 0),fe===!1?P.lastIndex=ie+1:(F!==ie&&$.push({type:"text",value:x.value.slice(F,ie)}),Array.isArray(fe)?$.push(...fe):fe&&$.push(fe),F=ie+X[0].length,G=!0),!P.global)break;X=P.exec(x.value)}return G?(F<x.value.length&&$.push({type:"text",value:x.value.slice(F)}),C.children.splice(q,1,...$)):$=[x],q+$.length}}function T3e(e){const t=[];if(!Array.isArray(e))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!e[0]||Array.isArray(e[0])?e:[e];let r=-1;for(;++r<n.length;){const a=n[r];t.push([E3e(a[0]),S3e(a[1])])}return t}function E3e(e){return typeof e=="string"?new RegExp(b3e(e),"g"):e}function S3e(e){return typeof e=="function"?e:function(){return e}}const eR="phrasing",tR=["autolink","link","image","label"];function A3e(){return{transforms:[O3e],enter:{literalAutolink:k3e,literalAutolinkEmail:nR,literalAutolinkHttp:nR,literalAutolinkWww:nR},exit:{literalAutolink:P3e,literalAutolinkEmail:M3e,literalAutolinkHttp:I3e,literalAutolinkWww:R3e}}}function C3e(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:eR,notInConstruct:tR},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:eR,notInConstruct:tR},{character:":",before:"[ps]",after:"\\/",inConstruct:eR,notInConstruct:tR}]}}function k3e(e){this.enter({type:"link",title:null,url:"",children:[]},e)}function nR(e){this.config.enter.autolinkProtocol.call(this,e)}function I3e(e){this.config.exit.autolinkProtocol.call(this,e)}function R3e(e){this.config.exit.data.call(this,e);const t=this.stack[this.stack.length-1];t.type,t.url="http://"+this.sliceSerialize(e)}function M3e(e){this.config.exit.autolinkEmail.call(this,e)}function P3e(e){this.exit(e)}function O3e(e){w3e(e,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,L3e],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),D3e]],{ignore:["link","linkReference"]})}function L3e(e,t,n,r,a){let u="";if(!oee(a)||(/^w/i.test(t)&&(n=t+n,t="",u="http://"),!N3e(n)))return!1;const f=z3e(n+r);if(!f[0])return!1;const s={type:"link",title:null,url:u+t+f[0],children:[{type:"text",value:t+f[0]}]};return f[1]?[s,{type:"text",value:f[1]}]:s}function D3e(e,t,n,r){return!oee(r,!0)||/[-\d_]$/.test(n)?!1:{type:"link",title:null,url:"mailto:"+t+"@"+n,children:[{type:"text",value:t+"@"+n}]}}function N3e(e){const t=e.split(".");return!(t.length<2||t[t.length-1]&&(/_/.test(t[t.length-1])||!/[a-zA-Z\d]/.test(t[t.length-1]))||t[t.length-2]&&(/_/.test(t[t.length-2])||!/[a-zA-Z\d]/.test(t[t.length-2])))}function z3e(e){const t=/[!"&'),.:;<>?\]}]+$/.exec(e);if(!t)return[e,void 0];e=e.slice(0,t.index);let n=t[0],r=n.indexOf(")");const a=n$(e,"(");let u=n$(e,")");for(;r!==-1&&a>u;)e+=n.slice(0,r+1),n=n.slice(r+1),r=n.indexOf(")"),u++;return[e,n]}function oee(e,t){const n=e.input.charCodeAt(e.index-1);return(e.index===0||f_(n)||vk(n))&&(!t||n!==47)}function ih(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}lee.peek=q3e;function F3e(){this.buffer()}function B3e(e){this.enter({type:"footnoteReference",identifier:"",label:""},e)}function j3e(){this.buffer()}function U3e(e){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},e)}function V3e(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=ih(this.sliceSerialize(e)).toLowerCase(),n.label=t}function $3e(e){this.exit(e)}function H3e(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=ih(this.sliceSerialize(e)).toLowerCase(),n.label=t}function G3e(e){this.exit(e)}function q3e(){return"["}function lee(e,t,n,r){const a=n.createTracker(r);let u=a.move("[^");const f=n.enter("footnoteReference"),s=n.enter("reference");return u+=a.move(n.safe(n.associationId(e),{after:"]",before:u})),s(),f(),u+=a.move("]"),u}function W3e(){return{enter:{gfmFootnoteCallString:F3e,gfmFootnoteCall:B3e,gfmFootnoteDefinitionLabelString:j3e,gfmFootnoteDefinition:U3e},exit:{gfmFootnoteCallString:V3e,gfmFootnoteCall:$3e,gfmFootnoteDefinitionLabelString:H3e,gfmFootnoteDefinition:G3e}}}function Z3e(e){let t=!1;return e&&e.firstLineBlank&&(t=!0),{handlers:{footnoteDefinition:n,footnoteReference:lee},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function n(r,a,u,f){const s=u.createTracker(f);let v=s.move("[^");const x=u.enter("footnoteDefinition"),A=u.enter("label");return v+=s.move(u.safe(u.associationId(r),{before:v,after:"]"})),A(),v+=s.move("]:"),r.children&&r.children.length>0&&(s.shift(4),v+=s.move((t?`
`:" ")+u.indentLines(u.containerFlow(r,s.current()),t?uee:X3e))),x(),v}}function X3e(e,t,n){return t===0?e:uee(e,t,n)}function uee(e,t,n){return(n?"":"    ")+e}const Y3e=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];cee.peek=t4e;function K3e(){return{canContainEols:["delete"],enter:{strikethrough:J3e},exit:{strikethrough:e4e}}}function Q3e(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:Y3e}],handlers:{delete:cee}}}function J3e(e){this.enter({type:"delete",children:[]},e)}function e4e(e){this.exit(e)}function cee(e,t,n,r){const a=n.createTracker(r),u=n.enter("strikethrough");let f=a.move("~~");return f+=n.containerPhrasing(e,{...a.current(),before:f,after:"~"}),f+=a.move("~~"),u(),f}function t4e(){return"~"}function n4e(e){return e.length}function r4e(e,t){const n=t||{},r=(n.align||[]).concat(),a=n.stringLength||n4e,u=[],f=[],s=[],v=[];let x=0,A=-1;for(;++A<e.length;){const U=[],q=[];let G=-1;for(e[A].length>x&&(x=e[A].length);++G<e[A].length;){const $=i4e(e[A][G]);if(n.alignDelimiters!==!1){const X=a($);q[G]=X,(v[G]===void 0||X>v[G])&&(v[G]=X)}U.push($)}f[A]=U,s[A]=q}let C=-1;if(typeof r=="object"&&"length"in r)for(;++C<x;)u[C]=r$(r[C]);else{const U=r$(r);for(;++C<x;)u[C]=U}C=-1;const P=[],L=[];for(;++C<x;){const U=u[C];let q="",G="";U===99?(q=":",G=":"):U===108?q=":":U===114&&(G=":");let $=n.alignDelimiters===!1?1:Math.max(1,v[C]-q.length-G.length);const X=q+"-".repeat($)+G;n.alignDelimiters!==!1&&($=q.length+$+G.length,$>v[C]&&(v[C]=$),L[C]=$),P[C]=X}f.splice(1,0,P),s.splice(1,0,L),A=-1;const F=[];for(;++A<f.length;){const U=f[A],q=s[A];C=-1;const G=[];for(;++C<x;){const $=U[C]||"";let X="",ie="";if(n.alignDelimiters!==!1){const de=v[C]-(q[C]||0),fe=u[C];fe===114?X=" ".repeat(de):fe===99?de%2?(X=" ".repeat(de/2+.5),ie=" ".repeat(de/2-.5)):(X=" ".repeat(de/2),ie=X):ie=" ".repeat(de)}n.delimiterStart!==!1&&!C&&G.push("|"),n.padding!==!1&&!(n.alignDelimiters===!1&&$==="")&&(n.delimiterStart!==!1||C)&&G.push(" "),n.alignDelimiters!==!1&&G.push(X),G.push($),n.alignDelimiters!==!1&&G.push(ie),n.padding!==!1&&G.push(" "),(n.delimiterEnd!==!1||C!==x-1)&&G.push("|")}F.push(n.delimiterEnd===!1?G.join("").replace(/ +$/,""):G.join(""))}return F.join(`
`)}function i4e(e){return e==null?"":String(e)}function r$(e){const t=typeof e=="string"?e.codePointAt(0):0;return t===67||t===99?99:t===76||t===108?108:t===82||t===114?114:0}function s4e(e,t,n,r){const a=n.enter("blockquote"),u=n.createTracker(r);u.move("> "),u.shift(2);const f=n.indentLines(n.containerFlow(e,u.current()),a4e);return a(),f}function a4e(e,t,n){return">"+(n?"":" ")+e}function o4e(e,t){return i$(e,t.inConstruct,!0)&&!i$(e,t.notInConstruct,!1)}function i$(e,t,n){if(typeof t=="string"&&(t=[t]),!t||t.length===0)return n;let r=-1;for(;++r<t.length;)if(e.includes(t[r]))return!0;return!1}function s$(e,t,n,r){let a=-1;for(;++a<n.unsafe.length;)if(n.unsafe[a].character===`
`&&o4e(n.stack,n.unsafe[a]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}function dee(e,t){const n=String(e);let r=n.indexOf(t),a=r,u=0,f=0;if(typeof t!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===a?++u>f&&(f=u):u=1,a=r+t.length,r=n.indexOf(t,a);return f}function l4e(e,t){return!!(t.options.fences===!1&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}function u4e(e){const t=e.options.fence||"`";if(t!=="`"&&t!=="~")throw new Error("Cannot serialize code with `"+t+"` for `options.fence`, expected `` ` `` or `~`");return t}function c4e(e,t,n,r){const a=u4e(n),u=e.value||"",f=a==="`"?"GraveAccent":"Tilde";if(l4e(e,n)){const C=n.enter("codeIndented"),P=n.indentLines(u,d4e);return C(),P}const s=n.createTracker(r),v=a.repeat(Math.max(dee(u,a)+1,3)),x=n.enter("codeFenced");let A=s.move(v);if(e.lang){const C=n.enter(`codeFencedLang${f}`);A+=s.move(n.safe(e.lang,{before:A,after:" ",encode:["`"],...s.current()})),C()}if(e.lang&&e.meta){const C=n.enter(`codeFencedMeta${f}`);A+=s.move(" "),A+=s.move(n.safe(e.meta,{before:A,after:`
`,encode:["`"],...s.current()})),C()}return A+=s.move(`
`),u&&(A+=s.move(u+`
`)),A+=s.move(v),x(),A}function d4e(e,t,n){return(n?"":"    ")+e}function pD(e){const t=e.options.quote||'"';if(t!=='"'&&t!=="'")throw new Error("Cannot serialize title with `"+t+"` for `options.quote`, expected `\"`, or `'`");return t}function h4e(e,t,n,r){const a=pD(n),u=a==='"'?"Quote":"Apostrophe",f=n.enter("definition");let s=n.enter("label");const v=n.createTracker(r);let x=v.move("[");return x+=v.move(n.safe(n.associationId(e),{before:x,after:"]",...v.current()})),x+=v.move("]: "),s(),!e.url||/[\0- \u007F]/.test(e.url)?(s=n.enter("destinationLiteral"),x+=v.move("<"),x+=v.move(n.safe(e.url,{before:x,after:">",...v.current()})),x+=v.move(">")):(s=n.enter("destinationRaw"),x+=v.move(n.safe(e.url,{before:x,after:e.title?" ":`
`,...v.current()}))),s(),e.title&&(s=n.enter(`title${u}`),x+=v.move(" "+a),x+=v.move(n.safe(e.title,{before:x,after:a,...v.current()})),x+=v.move(a),s()),f(),x}function f4e(e){const t=e.options.emphasis||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize emphasis with `"+t+"` for `options.emphasis`, expected `*`, or `_`");return t}function nT(e){return"&#x"+e.toString(16).toUpperCase()+";"}function Vv(e){if(e===null||Va(e)||f_(e))return 1;if(vk(e))return 2}function dC(e,t,n){const r=Vv(e),a=Vv(t);return r===void 0?a===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:a===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?a===void 0?{inside:!1,outside:!1}:a===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:a===void 0?{inside:!1,outside:!1}:a===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}hee.peek=p4e;function hee(e,t,n,r){const a=f4e(n),u=n.enter("emphasis"),f=n.createTracker(r),s=f.move(a);let v=f.move(n.containerPhrasing(e,{after:a,before:s,...f.current()}));const x=v.charCodeAt(0),A=dC(r.before.charCodeAt(r.before.length-1),x,a);A.inside&&(v=nT(x)+v.slice(1));const C=v.charCodeAt(v.length-1),P=dC(r.after.charCodeAt(0),C,a);P.inside&&(v=v.slice(0,-1)+nT(C));const L=f.move(a);return u(),n.attentionEncodeSurroundingInfo={after:P.outside,before:A.outside},s+v+L}function p4e(e,t,n){return n.options.emphasis||"*"}function m4e(e,t,n,r){let a,u,f;typeof t=="function"&&typeof n!="function"?(u=void 0,f=t,a=n):(u=t,f=n,a=r),ox(e,u,s,a);function s(v,x){const A=x[x.length-1],C=A?A.children.indexOf(v):void 0;return f(v,C,A)}}const g4e={};function mD(e,t){const n=g4e,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,a=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return fee(e,r,a)}function fee(e,t,n){if(_4e(e)){if("value"in e)return e.type==="html"&&!n?"":e.value;if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return a$(e.children,t,n)}return Array.isArray(e)?a$(e,t,n):""}function a$(e,t,n){const r=[];let a=-1;for(;++a<e.length;)r[a]=fee(e[a],t,n);return r.join("")}function _4e(e){return!!(e&&typeof e=="object")}function y4e(e,t){let n=!1;return m4e(e,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return n=!0,jP}),!!((!e.depth||e.depth<3)&&mD(e)&&(t.options.setext||n))}function v4e(e,t,n,r){const a=Math.max(Math.min(6,e.depth||1),1),u=n.createTracker(r);if(y4e(e,n)){const A=n.enter("headingSetext"),C=n.enter("phrasing"),P=n.containerPhrasing(e,{...u.current(),before:`
`,after:`
`});return C(),A(),P+`
`+(a===1?"=":"-").repeat(P.length-(Math.max(P.lastIndexOf("\r"),P.lastIndexOf(`
`))+1))}const f="#".repeat(a),s=n.enter("headingAtx"),v=n.enter("phrasing");u.move(f+" ");let x=n.containerPhrasing(e,{before:"# ",after:`
`,...u.current()});return/^[\t ]/.test(x)&&(x=nT(x.charCodeAt(0))+x.slice(1)),x=x?f+" "+x:f,n.options.closeAtx&&(x+=" "+f),v(),s(),x}pee.peek=x4e;function pee(e){return e.value||""}function x4e(){return"<"}mee.peek=b4e;function mee(e,t,n,r){const a=pD(n),u=a==='"'?"Quote":"Apostrophe",f=n.enter("image");let s=n.enter("label");const v=n.createTracker(r);let x=v.move("![");return x+=v.move(n.safe(e.alt,{before:x,after:"]",...v.current()})),x+=v.move("]("),s(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(s=n.enter("destinationLiteral"),x+=v.move("<"),x+=v.move(n.safe(e.url,{before:x,after:">",...v.current()})),x+=v.move(">")):(s=n.enter("destinationRaw"),x+=v.move(n.safe(e.url,{before:x,after:e.title?" ":")",...v.current()}))),s(),e.title&&(s=n.enter(`title${u}`),x+=v.move(" "+a),x+=v.move(n.safe(e.title,{before:x,after:a,...v.current()})),x+=v.move(a),s()),x+=v.move(")"),f(),x}function b4e(){return"!"}gee.peek=w4e;function gee(e,t,n,r){const a=e.referenceType,u=n.enter("imageReference");let f=n.enter("label");const s=n.createTracker(r);let v=s.move("![");const x=n.safe(e.alt,{before:v,after:"]",...s.current()});v+=s.move(x+"]["),f();const A=n.stack;n.stack=[],f=n.enter("reference");const C=n.safe(n.associationId(e),{before:v,after:"]",...s.current()});return f(),n.stack=A,u(),a==="full"||!x||x!==C?v+=s.move(C+"]"):a==="shortcut"?v=v.slice(0,-1):v+=s.move("]"),v}function w4e(){return"!"}_ee.peek=T4e;function _ee(e,t,n){let r=e.value||"",a="`",u=-1;for(;new RegExp("(^|[^`])"+a+"([^`]|$)").test(r);)a+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++u<n.unsafe.length;){const f=n.unsafe[u],s=n.compilePattern(f);let v;if(f.atBreak)for(;v=s.exec(r);){let x=v.index;r.charCodeAt(x)===10&&r.charCodeAt(x-1)===13&&x--,r=r.slice(0,x)+" "+r.slice(v.index+1)}}return a+r+a}function T4e(){return"`"}function yee(e,t){const n=mD(e);return!!(!t.options.resourceLink&&e.url&&!e.title&&e.children&&e.children.length===1&&e.children[0].type==="text"&&(n===e.url||"mailto:"+n===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}vee.peek=E4e;function vee(e,t,n,r){const a=pD(n),u=a==='"'?"Quote":"Apostrophe",f=n.createTracker(r);let s,v;if(yee(e,n)){const A=n.stack;n.stack=[],s=n.enter("autolink");let C=f.move("<");return C+=f.move(n.containerPhrasing(e,{before:C,after:">",...f.current()})),C+=f.move(">"),s(),n.stack=A,C}s=n.enter("link"),v=n.enter("label");let x=f.move("[");return x+=f.move(n.containerPhrasing(e,{before:x,after:"](",...f.current()})),x+=f.move("]("),v(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(v=n.enter("destinationLiteral"),x+=f.move("<"),x+=f.move(n.safe(e.url,{before:x,after:">",...f.current()})),x+=f.move(">")):(v=n.enter("destinationRaw"),x+=f.move(n.safe(e.url,{before:x,after:e.title?" ":")",...f.current()}))),v(),e.title&&(v=n.enter(`title${u}`),x+=f.move(" "+a),x+=f.move(n.safe(e.title,{before:x,after:a,...f.current()})),x+=f.move(a),v()),x+=f.move(")"),s(),x}function E4e(e,t,n){return yee(e,n)?"<":"["}xee.peek=S4e;function xee(e,t,n,r){const a=e.referenceType,u=n.enter("linkReference");let f=n.enter("label");const s=n.createTracker(r);let v=s.move("[");const x=n.containerPhrasing(e,{before:v,after:"]",...s.current()});v+=s.move(x+"]["),f();const A=n.stack;n.stack=[],f=n.enter("reference");const C=n.safe(n.associationId(e),{before:v,after:"]",...s.current()});return f(),n.stack=A,u(),a==="full"||!x||x!==C?v+=s.move(C+"]"):a==="shortcut"?v=v.slice(0,-1):v+=s.move("]"),v}function S4e(){return"["}function gD(e){const t=e.options.bullet||"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bullet`, expected `*`, `+`, or `-`");return t}function A4e(e){const t=gD(e),n=e.options.bulletOther;if(!n)return t==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===t)throw new Error("Expected `bullet` (`"+t+"`) and `bulletOther` (`"+n+"`) to be different");return n}function C4e(e){const t=e.options.bulletOrdered||".";if(t!=="."&&t!==")")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOrdered`, expected `.` or `)`");return t}function bee(e){const t=e.options.rule||"*";if(t!=="*"&&t!=="-"&&t!=="_")throw new Error("Cannot serialize rules with `"+t+"` for `options.rule`, expected `*`, `-`, or `_`");return t}function k4e(e,t,n,r){const a=n.enter("list"),u=n.bulletCurrent;let f=e.ordered?C4e(n):gD(n);const s=e.ordered?f==="."?")":".":A4e(n);let v=t&&n.bulletLastUsed?f===n.bulletLastUsed:!1;if(!e.ordered){const A=e.children?e.children[0]:void 0;if((f==="*"||f==="-")&&A&&(!A.children||!A.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(v=!0),bee(n)===f&&A){let C=-1;for(;++C<e.children.length;){const P=e.children[C];if(P&&P.type==="listItem"&&P.children&&P.children[0]&&P.children[0].type==="thematicBreak"){v=!0;break}}}}v&&(f=s),n.bulletCurrent=f;const x=n.containerFlow(e,r);return n.bulletLastUsed=f,n.bulletCurrent=u,a(),x}function I4e(e){const t=e.options.listItemIndent||"one";if(t!=="tab"&&t!=="one"&&t!=="mixed")throw new Error("Cannot serialize items with `"+t+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return t}function R4e(e,t,n,r){const a=I4e(n);let u=n.bulletCurrent||gD(n);t&&t.type==="list"&&t.ordered&&(u=(typeof t.start=="number"&&t.start>-1?t.start:1)+(n.options.incrementListMarker===!1?0:t.children.indexOf(e))+u);let f=u.length+1;(a==="tab"||a==="mixed"&&(t&&t.type==="list"&&t.spread||e.spread))&&(f=Math.ceil(f/4)*4);const s=n.createTracker(r);s.move(u+" ".repeat(f-u.length)),s.shift(f);const v=n.enter("listItem"),x=n.indentLines(n.containerFlow(e,s.current()),A);return v(),x;function A(C,P,L){return P?(L?"":" ".repeat(f))+C:(L?u:u+" ".repeat(f-u.length))+C}}function M4e(e,t,n,r){const a=n.enter("paragraph"),u=n.enter("phrasing"),f=n.containerPhrasing(e,r);return u(),a(),f}const P4e=RT(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function O4e(e,t,n,r){return(e.children.some(function(f){return P4e(f)})?n.containerPhrasing:n.containerFlow).call(n,e,r)}function L4e(e){const t=e.options.strong||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize strong with `"+t+"` for `options.strong`, expected `*`, or `_`");return t}wee.peek=D4e;function wee(e,t,n,r){const a=L4e(n),u=n.enter("strong"),f=n.createTracker(r),s=f.move(a+a);let v=f.move(n.containerPhrasing(e,{after:a,before:s,...f.current()}));const x=v.charCodeAt(0),A=dC(r.before.charCodeAt(r.before.length-1),x,a);A.inside&&(v=nT(x)+v.slice(1));const C=v.charCodeAt(v.length-1),P=dC(r.after.charCodeAt(0),C,a);P.inside&&(v=v.slice(0,-1)+nT(C));const L=f.move(a+a);return u(),n.attentionEncodeSurroundingInfo={after:P.outside,before:A.outside},s+v+L}function D4e(e,t,n){return n.options.strong||"*"}function N4e(e,t,n,r){return n.safe(e.value,r)}function z4e(e){const t=e.options.ruleRepetition||3;if(t<3)throw new Error("Cannot serialize rules with repetition `"+t+"` for `options.ruleRepetition`, expected `3` or more");return t}function F4e(e,t,n){const r=(bee(n)+(n.options.ruleSpaces?" ":"")).repeat(z4e(n));return n.options.ruleSpaces?r.slice(0,-1):r}const Tee={blockquote:s4e,break:s$,code:c4e,definition:h4e,emphasis:hee,hardBreak:s$,heading:v4e,html:pee,image:mee,imageReference:gee,inlineCode:_ee,link:vee,linkReference:xee,list:k4e,listItem:R4e,paragraph:M4e,root:O4e,strong:wee,text:N4e,thematicBreak:F4e};function Eee(e,t){const n=Number.parseInt(e,t);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}const B4e=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function j4e(e){return e.replace(B4e,U4e)}function U4e(e,t,n){if(t)return t;if(n.charCodeAt(0)===35){const a=n.charCodeAt(1),u=a===120||a===88;return Eee(n.slice(u?2:1),u?16:10)}return XO(n)||e}function V4e(){return{enter:{table:$4e,tableData:o$,tableHeader:o$,tableRow:G4e},exit:{codeText:q4e,table:H4e,tableData:rR,tableHeader:rR,tableRow:rR}}}function $4e(e){const t=e._align;this.enter({type:"table",align:t.map(function(n){return n==="none"?null:n}),children:[]},e),this.data.inTable=!0}function H4e(e){this.exit(e),this.data.inTable=void 0}function G4e(e){this.enter({type:"tableRow",children:[]},e)}function rR(e){this.exit(e)}function o$(e){this.enter({type:"tableCell",children:[]},e)}function q4e(e){let t=this.resume();this.data.inTable&&(t=t.replace(/\\([\\|])/g,W4e));const n=this.stack[this.stack.length-1];n.type,n.value=t,this.exit(e)}function W4e(e,t){return t==="|"?t:e}function Z4e(e){const t=e||{},n=t.tableCellPadding,r=t.tablePipeAlign,a=t.stringLength,u=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:P,table:f,tableCell:v,tableRow:s}};function f(L,F,U,q){return x(A(L,U,q),L.align)}function s(L,F,U,q){const G=C(L,U,q),$=x([G]);return $.slice(0,$.indexOf(`
`))}function v(L,F,U,q){const G=U.enter("tableCell"),$=U.enter("phrasing"),X=U.containerPhrasing(L,{...q,before:u,after:u});return $(),G(),X}function x(L,F){return r4e(L,{align:F,alignDelimiters:r,padding:n,stringLength:a})}function A(L,F,U){const q=L.children;let G=-1;const $=[],X=F.enter("table");for(;++G<q.length;)$[G]=C(q[G],F,U);return X(),$}function C(L,F,U){const q=L.children;let G=-1;const $=[],X=F.enter("tableRow");for(;++G<q.length;)$[G]=v(q[G],L,F,U);return X(),$}function P(L,F,U){let q=Tee.inlineCode(L,F,U);return U.stack.includes("tableCell")&&(q=q.replace(/\|/g,"\\$&")),q}}function X4e(){return{exit:{taskListCheckValueChecked:l$,taskListCheckValueUnchecked:l$,paragraph:K4e}}}function Y4e(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:Q4e}}}function l$(e){const t=this.stack[this.stack.length-2];t.type,t.checked=e.type==="taskListCheckValueChecked"}function K4e(e){const t=this.stack[this.stack.length-2];if(t&&t.type==="listItem"&&typeof t.checked=="boolean"){const n=this.stack[this.stack.length-1];n.type;const r=n.children[0];if(r&&r.type==="text"){const a=t.children;let u=-1,f;for(;++u<a.length;){const s=a[u];if(s.type==="paragraph"){f=s;break}}f===n&&(r.value=r.value.slice(1),r.value.length===0?n.children.shift():n.position&&r.position&&typeof r.position.start.offset=="number"&&(r.position.start.column++,r.position.start.offset++,n.position.start=Object.assign({},r.position.start)))}}this.exit(e)}function Q4e(e,t,n,r){const a=e.children[0],u=typeof e.checked=="boolean"&&a&&a.type==="paragraph",f="["+(e.checked?"x":" ")+"] ",s=n.createTracker(r);u&&s.move(f);let v=Tee.listItem(e,t,n,{...r,...s.current()});return u&&(v=v.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,x)),v;function x(A){return A+f}}function J4e(){return[A3e(),W3e(),K3e(),V4e(),X4e()]}function eAe(e){return{extensions:[C3e(),Z3e(e),Q3e(),Z4e(e),Y4e()]}}const u$={}.hasOwnProperty;function See(e){const t={};let n=-1;for(;++n<e.length;)tAe(t,e[n]);return t}function tAe(e,t){let n;for(n in t){const a=(u$.call(e,n)?e[n]:void 0)||(e[n]={}),u=t[n];let f;if(u)for(f in u){u$.call(a,f)||(a[f]=[]);const s=u[f];nAe(a[f],Array.isArray(s)?s:s?[s]:[])}}}function nAe(e,t){let n=-1;const r=[];for(;++n<t.length;)(t[n].add==="after"?e:r).push(t[n]);Bl(e,0,0,r)}const rAe={tokenize:uAe,partial:!0},Aee={tokenize:cAe,partial:!0},Cee={tokenize:dAe,partial:!0},kee={tokenize:hAe,partial:!0},iAe={tokenize:fAe,partial:!0},Iee={name:"wwwAutolink",tokenize:oAe,previous:Mee},Ree={name:"protocolAutolink",tokenize:lAe,previous:Pee},Ep={name:"emailAutolink",tokenize:aAe,previous:Oee},_f={};function sAe(){return{text:_f}}let Sg=48;for(;Sg<123;)_f[Sg]=Ep,Sg++,Sg===58?Sg=65:Sg===91&&(Sg=97);_f[43]=Ep;_f[45]=Ep;_f[46]=Ep;_f[95]=Ep;_f[72]=[Ep,Ree];_f[104]=[Ep,Ree];_f[87]=[Ep,Iee];_f[119]=[Ep,Iee];function aAe(e,t,n){const r=this;let a,u;return f;function f(C){return!m8(C)||!Oee.call(r,r.previous)||_D(r.events)?n(C):(e.enter("literalAutolink"),e.enter("literalAutolinkEmail"),s(C))}function s(C){return m8(C)?(e.consume(C),s):C===64?(e.consume(C),v):n(C)}function v(C){return C===46?e.check(iAe,A,x)(C):C===45||C===95||tu(C)?(u=!0,e.consume(C),v):A(C)}function x(C){return e.consume(C),a=!0,v}function A(C){return u&&a&&bu(r.previous)?(e.exit("literalAutolinkEmail"),e.exit("literalAutolink"),t(C)):n(C)}}function oAe(e,t,n){const r=this;return a;function a(f){return f!==87&&f!==119||!Mee.call(r,r.previous)||_D(r.events)?n(f):(e.enter("literalAutolink"),e.enter("literalAutolinkWww"),e.check(rAe,e.attempt(Aee,e.attempt(Cee,u),n),n)(f))}function u(f){return e.exit("literalAutolinkWww"),e.exit("literalAutolink"),t(f)}}function lAe(e,t,n){const r=this;let a="",u=!1;return f;function f(C){return(C===72||C===104)&&Pee.call(r,r.previous)&&!_D(r.events)?(e.enter("literalAutolink"),e.enter("literalAutolinkHttp"),a+=String.fromCodePoint(C),e.consume(C),s):n(C)}function s(C){if(bu(C)&&a.length<5)return a+=String.fromCodePoint(C),e.consume(C),s;if(C===58){const P=a.toLowerCase();if(P==="http"||P==="https")return e.consume(C),v}return n(C)}function v(C){return C===47?(e.consume(C),u?x:(u=!0,v)):n(C)}function x(C){return C===null||uC(C)||Va(C)||f_(C)||vk(C)?n(C):e.attempt(Aee,e.attempt(Cee,A),n)(C)}function A(C){return e.exit("literalAutolinkHttp"),e.exit("literalAutolink"),t(C)}}function uAe(e,t,n){let r=0;return a;function a(f){return(f===87||f===119)&&r<3?(r++,e.consume(f),a):f===46&&r===3?(e.consume(f),u):n(f)}function u(f){return f===null?n(f):t(f)}}function cAe(e,t,n){let r,a,u;return f;function f(x){return x===46||x===95?e.check(kee,v,s)(x):x===null||Va(x)||f_(x)||x!==45&&vk(x)?v(x):(u=!0,e.consume(x),f)}function s(x){return x===95?r=!0:(a=r,r=void 0),e.consume(x),f}function v(x){return a||r||!u?n(x):t(x)}}function dAe(e,t){let n=0,r=0;return a;function a(f){return f===40?(n++,e.consume(f),a):f===41&&r<n?u(f):f===33||f===34||f===38||f===39||f===41||f===42||f===44||f===46||f===58||f===59||f===60||f===63||f===93||f===95||f===126?e.check(kee,t,u)(f):f===null||Va(f)||f_(f)?t(f):(e.consume(f),a)}function u(f){return f===41&&r++,e.consume(f),a}}function hAe(e,t,n){return r;function r(s){return s===33||s===34||s===39||s===41||s===42||s===44||s===46||s===58||s===59||s===63||s===95||s===126?(e.consume(s),r):s===38?(e.consume(s),u):s===93?(e.consume(s),a):s===60||s===null||Va(s)||f_(s)?t(s):n(s)}function a(s){return s===null||s===40||s===91||Va(s)||f_(s)?t(s):r(s)}function u(s){return bu(s)?f(s):n(s)}function f(s){return s===59?(e.consume(s),r):bu(s)?(e.consume(s),f):n(s)}}function fAe(e,t,n){return r;function r(u){return e.consume(u),a}function a(u){return tu(u)?n(u):t(u)}}function Mee(e){return e===null||e===40||e===42||e===95||e===91||e===93||e===126||Va(e)}function Pee(e){return!bu(e)}function Oee(e){return!(e===47||m8(e))}function m8(e){return e===43||e===45||e===46||e===95||tu(e)}function _D(e){let t=e.length,n=!1;for(;t--;){const r=e[t][1];if((r.type==="labelLink"||r.type==="labelImage")&&!r._balanced){n=!0;break}if(r._gfmAutolinkLiteralWalkedInto){n=!1;break}}return e.length>0&&!n&&(e[e.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}function _x(e){const t=[];let n=-1,r=0,a=0;for(;++n<e.length;){const u=e.charCodeAt(n);let f="";if(u===37&&tu(e.charCodeAt(n+1))&&tu(e.charCodeAt(n+2)))a=2;else if(u<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(u))||(f=String.fromCharCode(u));else if(u>55295&&u<57344){const s=e.charCodeAt(n+1);u<56320&&s>56319&&s<57344?(f=String.fromCharCode(u,s),a=1):f=""}else f=String.fromCharCode(u);f&&(t.push(e.slice(r,n),encodeURIComponent(f)),r=n+a+1,f=""),a&&(n+=a,a=0)}return t.join("")+e.slice(r)}const g8={name:"attention",resolveAll:pAe,tokenize:mAe};function pAe(e,t){let n=-1,r,a,u,f,s,v,x,A;for(;++n<e.length;)if(e[n][0]==="enter"&&e[n][1].type==="attentionSequence"&&e[n][1]._close){for(r=n;r--;)if(e[r][0]==="exit"&&e[r][1].type==="attentionSequence"&&e[r][1]._open&&t.sliceSerialize(e[r][1]).charCodeAt(0)===t.sliceSerialize(e[n][1]).charCodeAt(0)){if((e[r][1]._close||e[n][1]._open)&&(e[n][1].end.offset-e[n][1].start.offset)%3&&!((e[r][1].end.offset-e[r][1].start.offset+e[n][1].end.offset-e[n][1].start.offset)%3))continue;v=e[r][1].end.offset-e[r][1].start.offset>1&&e[n][1].end.offset-e[n][1].start.offset>1?2:1;const C={...e[r][1].end},P={...e[n][1].start};c$(C,-v),c$(P,v),f={type:v>1?"strongSequence":"emphasisSequence",start:C,end:{...e[r][1].end}},s={type:v>1?"strongSequence":"emphasisSequence",start:{...e[n][1].start},end:P},u={type:v>1?"strongText":"emphasisText",start:{...e[r][1].end},end:{...e[n][1].start}},a={type:v>1?"strong":"emphasis",start:{...f.start},end:{...s.end}},e[r][1].end={...f.start},e[n][1].start={...s.end},x=[],e[r][1].end.offset-e[r][1].start.offset&&(x=zl(x,[["enter",e[r][1],t],["exit",e[r][1],t]])),x=zl(x,[["enter",a,t],["enter",f,t],["exit",f,t],["enter",u,t]]),x=zl(x,gx(t.parser.constructs.insideSpan.null,e.slice(r+1,n),t)),x=zl(x,[["exit",u,t],["enter",s,t],["exit",s,t],["exit",a,t]]),e[n][1].end.offset-e[n][1].start.offset?(A=2,x=zl(x,[["enter",e[n][1],t],["exit",e[n][1],t]])):A=0,Bl(e,r-1,n-r+3,x),n=r+x.length-A-2;break}}for(n=-1;++n<e.length;)e[n][1].type==="attentionSequence"&&(e[n][1].type="data");return e}function mAe(e,t){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,a=Vv(r);let u;return f;function f(v){return u=v,e.enter("attentionSequence"),s(v)}function s(v){if(v===u)return e.consume(v),s;const x=e.exit("attentionSequence"),A=Vv(v),C=!A||A===2&&a||n.includes(v),P=!a||a===2&&A||n.includes(r);return x._open=!!(u===42?C:C&&(a||!P)),x._close=!!(u===42?P:P&&(A||!C)),t(v)}}function c$(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}const gAe={name:"autolink",tokenize:_Ae};function _Ae(e,t,n){let r=0;return a;function a(L){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(L),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),u}function u(L){return bu(L)?(e.consume(L),f):L===64?n(L):x(L)}function f(L){return L===43||L===45||L===46||tu(L)?(r=1,s(L)):x(L)}function s(L){return L===58?(e.consume(L),r=0,v):(L===43||L===45||L===46||tu(L))&&r++<32?(e.consume(L),s):(r=0,x(L))}function v(L){return L===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(L),e.exit("autolinkMarker"),e.exit("autolink"),t):L===null||L===32||L===60||uC(L)?n(L):(e.consume(L),v)}function x(L){return L===64?(e.consume(L),A):qSe(L)?(e.consume(L),x):n(L)}function A(L){return tu(L)?C(L):n(L)}function C(L){return L===46?(e.consume(L),r=0,A):L===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(L),e.exit("autolinkMarker"),e.exit("autolink"),t):P(L)}function P(L){if((L===45||tu(L))&&r++<63){const F=L===45?P:C;return e.consume(L),F}return n(L)}}function Zs(e,t,n,r){const a=r?r-1:Number.POSITIVE_INFINITY;let u=0;return f;function f(v){return Js(v)?(e.enter(n),s(v)):t(v)}function s(v){return Js(v)&&u++<a?(e.consume(v),s):(e.exit(n),t(v))}}const jT={partial:!0,tokenize:yAe};function yAe(e,t,n){return r;function r(u){return Js(u)?Zs(e,a,"linePrefix")(u):a(u)}function a(u){return u===null||vi(u)?t(u):n(u)}}const Lee={continuation:{tokenize:xAe},exit:bAe,name:"blockQuote",tokenize:vAe};function vAe(e,t,n){const r=this;return a;function a(f){if(f===62){const s=r.containerState;return s.open||(e.enter("blockQuote",{_container:!0}),s.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(f),e.exit("blockQuoteMarker"),u}return n(f)}function u(f){return Js(f)?(e.enter("blockQuotePrefixWhitespace"),e.consume(f),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(f))}}function xAe(e,t,n){const r=this;return a;function a(f){return Js(f)?Zs(e,u,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(f):u(f)}function u(f){return e.attempt(Lee,t,n)(f)}}function bAe(e){e.exit("blockQuote")}const Dee={name:"characterEscape",tokenize:wAe};function wAe(e,t,n){return r;function r(u){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(u),e.exit("escapeMarker"),a}function a(u){return ZSe(u)?(e.enter("characterEscapeValue"),e.consume(u),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):n(u)}}const Nee={name:"characterReference",tokenize:TAe};function TAe(e,t,n){const r=this;let a=0,u,f;return s;function s(C){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(C),e.exit("characterReferenceMarker"),v}function v(C){return C===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(C),e.exit("characterReferenceMarkerNumeric"),x):(e.enter("characterReferenceValue"),u=31,f=tu,A(C))}function x(C){return C===88||C===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(C),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),u=6,f=WSe,A):(e.enter("characterReferenceValue"),u=7,f=f8,A(C))}function A(C){if(C===59&&a){const P=e.exit("characterReferenceValue");return f===tu&&!XO(r.sliceSerialize(P))?n(C):(e.enter("characterReferenceMarker"),e.consume(C),e.exit("characterReferenceMarker"),e.exit("characterReference"),t)}return f(C)&&a++<u?(e.consume(C),A):n(C)}}const d$={partial:!0,tokenize:SAe},h$={concrete:!0,name:"codeFenced",tokenize:EAe};function EAe(e,t,n){const r=this,a={partial:!0,tokenize:de};let u=0,f=0,s;return v;function v(fe){return x(fe)}function x(fe){const be=r.events[r.events.length-1];return u=be&&be[1].type==="linePrefix"?be[2].sliceSerialize(be[1],!0).length:0,s=fe,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),A(fe)}function A(fe){return fe===s?(f++,e.consume(fe),A):f<3?n(fe):(e.exit("codeFencedFenceSequence"),Js(fe)?Zs(e,C,"whitespace")(fe):C(fe))}function C(fe){return fe===null||vi(fe)?(e.exit("codeFencedFence"),r.interrupt?t(fe):e.check(d$,U,ie)(fe)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),P(fe))}function P(fe){return fe===null||vi(fe)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),C(fe)):Js(fe)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),Zs(e,L,"whitespace")(fe)):fe===96&&fe===s?n(fe):(e.consume(fe),P)}function L(fe){return fe===null||vi(fe)?C(fe):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),F(fe))}function F(fe){return fe===null||vi(fe)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),C(fe)):fe===96&&fe===s?n(fe):(e.consume(fe),F)}function U(fe){return e.attempt(a,ie,q)(fe)}function q(fe){return e.enter("lineEnding"),e.consume(fe),e.exit("lineEnding"),G}function G(fe){return u>0&&Js(fe)?Zs(e,$,"linePrefix",u+1)(fe):$(fe)}function $(fe){return fe===null||vi(fe)?e.check(d$,U,ie)(fe):(e.enter("codeFlowValue"),X(fe))}function X(fe){return fe===null||vi(fe)?(e.exit("codeFlowValue"),$(fe)):(e.consume(fe),X)}function ie(fe){return e.exit("codeFenced"),t(fe)}function de(fe,be,ve){let Qe=0;return we;function we(Pt){return fe.enter("lineEnding"),fe.consume(Pt),fe.exit("lineEnding"),qe}function qe(Pt){return fe.enter("codeFencedFence"),Js(Pt)?Zs(fe,Je,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(Pt):Je(Pt)}function Je(Pt){return Pt===s?(fe.enter("codeFencedFenceSequence"),ft(Pt)):ve(Pt)}function ft(Pt){return Pt===s?(Qe++,fe.consume(Pt),ft):Qe>=f?(fe.exit("codeFencedFenceSequence"),Js(Pt)?Zs(fe,Mt,"whitespace")(Pt):Mt(Pt)):ve(Pt)}function Mt(Pt){return Pt===null||vi(Pt)?(fe.exit("codeFencedFence"),be(Pt)):ve(Pt)}}}function SAe(e,t,n){const r=this;return a;function a(f){return f===null?n(f):(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),u)}function u(f){return r.parser.lazy[r.now().line]?n(f):t(f)}}const iR={name:"codeIndented",tokenize:CAe},AAe={partial:!0,tokenize:kAe};function CAe(e,t,n){const r=this;return a;function a(x){return e.enter("codeIndented"),Zs(e,u,"linePrefix",5)(x)}function u(x){const A=r.events[r.events.length-1];return A&&A[1].type==="linePrefix"&&A[2].sliceSerialize(A[1],!0).length>=4?f(x):n(x)}function f(x){return x===null?v(x):vi(x)?e.attempt(AAe,f,v)(x):(e.enter("codeFlowValue"),s(x))}function s(x){return x===null||vi(x)?(e.exit("codeFlowValue"),f(x)):(e.consume(x),s)}function v(x){return e.exit("codeIndented"),t(x)}}function kAe(e,t,n){const r=this;return a;function a(f){return r.parser.lazy[r.now().line]?n(f):vi(f)?(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),a):Zs(e,u,"linePrefix",5)(f)}function u(f){const s=r.events[r.events.length-1];return s&&s[1].type==="linePrefix"&&s[2].sliceSerialize(s[1],!0).length>=4?t(f):vi(f)?a(f):n(f)}}const IAe={name:"codeText",previous:MAe,resolve:RAe,tokenize:PAe};function RAe(e){let t=e.length-4,n=3,r,a;if((e[n][1].type==="lineEnding"||e[n][1].type==="space")&&(e[t][1].type==="lineEnding"||e[t][1].type==="space")){for(r=n;++r<t;)if(e[r][1].type==="codeTextData"){e[n][1].type="codeTextPadding",e[t][1].type="codeTextPadding",n+=2,t-=2;break}}for(r=n-1,t++;++r<=t;)a===void 0?r!==t&&e[r][1].type!=="lineEnding"&&(a=r):(r===t||e[r][1].type==="lineEnding")&&(e[a][1].type="codeTextData",r!==a+2&&(e[a][1].end=e[r-1][1].end,e.splice(a+2,r-a-2),t-=r-a-2,r=a+2),a=void 0);return e}function MAe(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function PAe(e,t,n){let r=0,a,u;return f;function f(C){return e.enter("codeText"),e.enter("codeTextSequence"),s(C)}function s(C){return C===96?(e.consume(C),r++,s):(e.exit("codeTextSequence"),v(C))}function v(C){return C===null?n(C):C===32?(e.enter("space"),e.consume(C),e.exit("space"),v):C===96?(u=e.enter("codeTextSequence"),a=0,A(C)):vi(C)?(e.enter("lineEnding"),e.consume(C),e.exit("lineEnding"),v):(e.enter("codeTextData"),x(C))}function x(C){return C===null||C===32||C===96||vi(C)?(e.exit("codeTextData"),v(C)):(e.consume(C),x)}function A(C){return C===96?(e.consume(C),a++,A):a===r?(e.exit("codeTextSequence"),e.exit("codeText"),t(C)):(u.type="codeTextData",x(C))}}class OAe{constructor(t){this.left=t?[...t]:[],this.right=[]}get(t){if(t<0||t>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+t+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return t<this.left.length?this.left[t]:this.right[this.right.length-t+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(t,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(t,r):t>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-t+this.left.length).reverse():this.left.slice(t).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(t,n,r){const a=n||0;this.setCursor(Math.trunc(t));const u=this.right.splice(this.right.length-a,Number.POSITIVE_INFINITY);return r&&Cw(this.left,r),u.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(t){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(t)}pushMany(t){this.setCursor(Number.POSITIVE_INFINITY),Cw(this.left,t)}unshift(t){this.setCursor(0),this.right.push(t)}unshiftMany(t){this.setCursor(0),Cw(this.right,t.reverse())}setCursor(t){if(!(t===this.left.length||t>this.left.length&&this.right.length===0||t<0&&this.left.length===0))if(t<this.left.length){const n=this.left.splice(t,Number.POSITIVE_INFINITY);Cw(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-t,Number.POSITIVE_INFINITY);Cw(this.left,n.reverse())}}}function Cw(e,t){let n=0;if(t.length<1e4)e.push(...t);else for(;n<t.length;)e.push(...t.slice(n,n+1e4)),n+=1e4}function zee(e){const t={};let n=-1,r,a,u,f,s,v,x;const A=new OAe(e);for(;++n<A.length;){for(;n in t;)n=t[n];if(r=A.get(n),n&&r[1].type==="chunkFlow"&&A.get(n-1)[1].type==="listItemPrefix"&&(v=r[1]._tokenizer.events,u=0,u<v.length&&v[u][1].type==="lineEndingBlank"&&(u+=2),u<v.length&&v[u][1].type==="content"))for(;++u<v.length&&v[u][1].type!=="content";)v[u][1].type==="chunkText"&&(v[u][1]._isInFirstContentOfListItem=!0,u++);if(r[0]==="enter")r[1].contentType&&(Object.assign(t,LAe(A,n)),n=t[n],x=!0);else if(r[1]._container){for(u=n,a=void 0;u--;)if(f=A.get(u),f[1].type==="lineEnding"||f[1].type==="lineEndingBlank")f[0]==="enter"&&(a&&(A.get(a)[1].type="lineEndingBlank"),f[1].type="lineEnding",a=u);else if(!(f[1].type==="linePrefix"||f[1].type==="listItemIndent"))break;a&&(r[1].end={...A.get(a)[1].start},s=A.slice(a,n),s.unshift(r),A.splice(a,n-a+1,s))}}return Bl(e,0,Number.POSITIVE_INFINITY,A.slice(0)),!x}function LAe(e,t){const n=e.get(t)[1],r=e.get(t)[2];let a=t-1;const u=[];let f=n._tokenizer;f||(f=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(f._contentTypeTextTrailing=!0));const s=f.events,v=[],x={};let A,C,P=-1,L=n,F=0,U=0;const q=[U];for(;L;){for(;e.get(++a)[1]!==L;);u.push(a),L._tokenizer||(A=r.sliceStream(L),L.next||A.push(null),C&&f.defineSkip(L.start),L._isInFirstContentOfListItem&&(f._gfmTasklistFirstContentOfListItem=!0),f.write(A),L._isInFirstContentOfListItem&&(f._gfmTasklistFirstContentOfListItem=void 0)),C=L,L=L.next}for(L=n;++P<s.length;)s[P][0]==="exit"&&s[P-1][0]==="enter"&&s[P][1].type===s[P-1][1].type&&s[P][1].start.line!==s[P][1].end.line&&(U=P+1,q.push(U),L._tokenizer=void 0,L.previous=void 0,L=L.next);for(f.events=[],L?(L._tokenizer=void 0,L.previous=void 0):q.pop(),P=q.length;P--;){const G=s.slice(q[P],q[P+1]),$=u.pop();v.push([$,$+G.length-1]),e.splice($,2,G)}for(v.reverse(),P=-1;++P<v.length;)x[F+v[P][0]]=F+v[P][1],F+=v[P][1]-v[P][0]-1;return x}const DAe={resolve:zAe,tokenize:FAe},NAe={partial:!0,tokenize:BAe};function zAe(e){return zee(e),e}function FAe(e,t){let n;return r;function r(s){return e.enter("content"),n=e.enter("chunkContent",{contentType:"content"}),a(s)}function a(s){return s===null?u(s):vi(s)?e.check(NAe,f,u)(s):(e.consume(s),a)}function u(s){return e.exit("chunkContent"),e.exit("content"),t(s)}function f(s){return e.consume(s),e.exit("chunkContent"),n.next=e.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,a}}function BAe(e,t,n){const r=this;return a;function a(f){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),Zs(e,u,"linePrefix")}function u(f){if(f===null||vi(f))return n(f);const s=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&s&&s[1].type==="linePrefix"&&s[2].sliceSerialize(s[1],!0).length>=4?t(f):e.interrupt(r.parser.constructs.flow,n,t)(f)}}function Fee(e,t,n,r,a,u,f,s,v){const x=v||Number.POSITIVE_INFINITY;let A=0;return C;function C(G){return G===60?(e.enter(r),e.enter(a),e.enter(u),e.consume(G),e.exit(u),P):G===null||G===32||G===41||uC(G)?n(G):(e.enter(r),e.enter(f),e.enter(s),e.enter("chunkString",{contentType:"string"}),U(G))}function P(G){return G===62?(e.enter(u),e.consume(G),e.exit(u),e.exit(a),e.exit(r),t):(e.enter(s),e.enter("chunkString",{contentType:"string"}),L(G))}function L(G){return G===62?(e.exit("chunkString"),e.exit(s),P(G)):G===null||G===60||vi(G)?n(G):(e.consume(G),G===92?F:L)}function F(G){return G===60||G===62||G===92?(e.consume(G),L):L(G)}function U(G){return!A&&(G===null||G===41||Va(G))?(e.exit("chunkString"),e.exit(s),e.exit(f),e.exit(r),t(G)):A<x&&G===40?(e.consume(G),A++,U):G===41?(e.consume(G),A--,U):G===null||G===32||G===40||uC(G)?n(G):(e.consume(G),G===92?q:U)}function q(G){return G===40||G===41||G===92?(e.consume(G),U):U(G)}}function Bee(e,t,n,r,a,u){const f=this;let s=0,v;return x;function x(L){return e.enter(r),e.enter(a),e.consume(L),e.exit(a),e.enter(u),A}function A(L){return s>999||L===null||L===91||L===93&&!v||L===94&&!s&&"_hiddenFootnoteSupport"in f.parser.constructs?n(L):L===93?(e.exit(u),e.enter(a),e.consume(L),e.exit(a),e.exit(r),t):vi(L)?(e.enter("lineEnding"),e.consume(L),e.exit("lineEnding"),A):(e.enter("chunkString",{contentType:"string"}),C(L))}function C(L){return L===null||L===91||L===93||vi(L)||s++>999?(e.exit("chunkString"),A(L)):(e.consume(L),v||(v=!Js(L)),L===92?P:C)}function P(L){return L===91||L===92||L===93?(e.consume(L),s++,C):C(L)}}function jee(e,t,n,r,a,u){let f;return s;function s(P){return P===34||P===39||P===40?(e.enter(r),e.enter(a),e.consume(P),e.exit(a),f=P===40?41:P,v):n(P)}function v(P){return P===f?(e.enter(a),e.consume(P),e.exit(a),e.exit(r),t):(e.enter(u),x(P))}function x(P){return P===f?(e.exit(u),v(f)):P===null?n(P):vi(P)?(e.enter("lineEnding"),e.consume(P),e.exit("lineEnding"),Zs(e,x,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),A(P))}function A(P){return P===f||P===null||vi(P)?(e.exit("chunkString"),x(P)):(e.consume(P),P===92?C:A)}function C(P){return P===f||P===92?(e.consume(P),A):A(P)}}function f2(e,t){let n;return r;function r(a){return vi(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),n=!0,r):Js(a)?Zs(e,r,n?"linePrefix":"lineSuffix")(a):t(a)}}const jAe={name:"definition",tokenize:VAe},UAe={partial:!0,tokenize:$Ae};function VAe(e,t,n){const r=this;let a;return u;function u(L){return e.enter("definition"),f(L)}function f(L){return Bee.call(r,e,s,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(L)}function s(L){return a=ih(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),L===58?(e.enter("definitionMarker"),e.consume(L),e.exit("definitionMarker"),v):n(L)}function v(L){return Va(L)?f2(e,x)(L):x(L)}function x(L){return Fee(e,A,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(L)}function A(L){return e.attempt(UAe,C,C)(L)}function C(L){return Js(L)?Zs(e,P,"whitespace")(L):P(L)}function P(L){return L===null||vi(L)?(e.exit("definition"),r.parser.defined.push(a),t(L)):n(L)}}function $Ae(e,t,n){return r;function r(s){return Va(s)?f2(e,a)(s):n(s)}function a(s){return jee(e,u,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(s)}function u(s){return Js(s)?Zs(e,f,"whitespace")(s):f(s)}function f(s){return s===null||vi(s)?t(s):n(s)}}const HAe={name:"hardBreakEscape",tokenize:GAe};function GAe(e,t,n){return r;function r(u){return e.enter("hardBreakEscape"),e.consume(u),a}function a(u){return vi(u)?(e.exit("hardBreakEscape"),t(u)):n(u)}}const qAe={name:"headingAtx",resolve:WAe,tokenize:ZAe};function WAe(e,t){let n=e.length-2,r=3,a,u;return e[r][1].type==="whitespace"&&(r+=2),n-2>r&&e[n][1].type==="whitespace"&&(n-=2),e[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&e[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(a={type:"atxHeadingText",start:e[r][1].start,end:e[n][1].end},u={type:"chunkText",start:e[r][1].start,end:e[n][1].end,contentType:"text"},Bl(e,r,n-r+1,[["enter",a,t],["enter",u,t],["exit",u,t],["exit",a,t]])),e}function ZAe(e,t,n){let r=0;return a;function a(A){return e.enter("atxHeading"),u(A)}function u(A){return e.enter("atxHeadingSequence"),f(A)}function f(A){return A===35&&r++<6?(e.consume(A),f):A===null||Va(A)?(e.exit("atxHeadingSequence"),s(A)):n(A)}function s(A){return A===35?(e.enter("atxHeadingSequence"),v(A)):A===null||vi(A)?(e.exit("atxHeading"),t(A)):Js(A)?Zs(e,s,"whitespace")(A):(e.enter("atxHeadingText"),x(A))}function v(A){return A===35?(e.consume(A),v):(e.exit("atxHeadingSequence"),s(A))}function x(A){return A===null||A===35||Va(A)?(e.exit("atxHeadingText"),s(A)):(e.consume(A),x)}}const XAe=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],f$=["pre","script","style","textarea"],YAe={concrete:!0,name:"htmlFlow",resolveTo:JAe,tokenize:eCe},KAe={partial:!0,tokenize:nCe},QAe={partial:!0,tokenize:tCe};function JAe(e){let t=e.length;for(;t--&&!(e[t][0]==="enter"&&e[t][1].type==="htmlFlow"););return t>1&&e[t-2][1].type==="linePrefix"&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2)),e}function eCe(e,t,n){const r=this;let a,u,f,s,v;return x;function x(ze){return A(ze)}function A(ze){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(ze),C}function C(ze){return ze===33?(e.consume(ze),P):ze===47?(e.consume(ze),u=!0,U):ze===63?(e.consume(ze),a=3,r.interrupt?t:Pe):bu(ze)?(e.consume(ze),f=String.fromCharCode(ze),q):n(ze)}function P(ze){return ze===45?(e.consume(ze),a=2,L):ze===91?(e.consume(ze),a=5,s=0,F):bu(ze)?(e.consume(ze),a=4,r.interrupt?t:Pe):n(ze)}function L(ze){return ze===45?(e.consume(ze),r.interrupt?t:Pe):n(ze)}function F(ze){const $t="CDATA[";return ze===$t.charCodeAt(s++)?(e.consume(ze),s===$t.length?r.interrupt?t:Je:F):n(ze)}function U(ze){return bu(ze)?(e.consume(ze),f=String.fromCharCode(ze),q):n(ze)}function q(ze){if(ze===null||ze===47||ze===62||Va(ze)){const $t=ze===47,Cn=f.toLowerCase();return!$t&&!u&&f$.includes(Cn)?(a=1,r.interrupt?t(ze):Je(ze)):XAe.includes(f.toLowerCase())?(a=6,$t?(e.consume(ze),G):r.interrupt?t(ze):Je(ze)):(a=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(ze):u?$(ze):X(ze))}return ze===45||tu(ze)?(e.consume(ze),f+=String.fromCharCode(ze),q):n(ze)}function G(ze){return ze===62?(e.consume(ze),r.interrupt?t:Je):n(ze)}function $(ze){return Js(ze)?(e.consume(ze),$):we(ze)}function X(ze){return ze===47?(e.consume(ze),we):ze===58||ze===95||bu(ze)?(e.consume(ze),ie):Js(ze)?(e.consume(ze),X):we(ze)}function ie(ze){return ze===45||ze===46||ze===58||ze===95||tu(ze)?(e.consume(ze),ie):de(ze)}function de(ze){return ze===61?(e.consume(ze),fe):Js(ze)?(e.consume(ze),de):X(ze)}function fe(ze){return ze===null||ze===60||ze===61||ze===62||ze===96?n(ze):ze===34||ze===39?(e.consume(ze),v=ze,be):Js(ze)?(e.consume(ze),fe):ve(ze)}function be(ze){return ze===v?(e.consume(ze),v=null,Qe):ze===null||vi(ze)?n(ze):(e.consume(ze),be)}function ve(ze){return ze===null||ze===34||ze===39||ze===47||ze===60||ze===61||ze===62||ze===96||Va(ze)?de(ze):(e.consume(ze),ve)}function Qe(ze){return ze===47||ze===62||Js(ze)?X(ze):n(ze)}function we(ze){return ze===62?(e.consume(ze),qe):n(ze)}function qe(ze){return ze===null||vi(ze)?Je(ze):Js(ze)?(e.consume(ze),qe):n(ze)}function Je(ze){return ze===45&&a===2?(e.consume(ze),Nt):ze===60&&a===1?(e.consume(ze),Kt):ze===62&&a===4?(e.consume(ze),gn):ze===63&&a===3?(e.consume(ze),Pe):ze===93&&a===5?(e.consume(ze),mt):vi(ze)&&(a===6||a===7)?(e.exit("htmlFlowData"),e.check(KAe,Et,ft)(ze)):ze===null||vi(ze)?(e.exit("htmlFlowData"),ft(ze)):(e.consume(ze),Je)}function ft(ze){return e.check(QAe,Mt,Et)(ze)}function Mt(ze){return e.enter("lineEnding"),e.consume(ze),e.exit("lineEnding"),Pt}function Pt(ze){return ze===null||vi(ze)?ft(ze):(e.enter("htmlFlowData"),Je(ze))}function Nt(ze){return ze===45?(e.consume(ze),Pe):Je(ze)}function Kt(ze){return ze===47?(e.consume(ze),f="",tt):Je(ze)}function tt(ze){if(ze===62){const $t=f.toLowerCase();return f$.includes($t)?(e.consume(ze),gn):Je(ze)}return bu(ze)&&f.length<8?(e.consume(ze),f+=String.fromCharCode(ze),tt):Je(ze)}function mt(ze){return ze===93?(e.consume(ze),Pe):Je(ze)}function Pe(ze){return ze===62?(e.consume(ze),gn):ze===45&&a===2?(e.consume(ze),Pe):Je(ze)}function gn(ze){return ze===null||vi(ze)?(e.exit("htmlFlowData"),Et(ze)):(e.consume(ze),gn)}function Et(ze){return e.exit("htmlFlow"),t(ze)}}function tCe(e,t,n){const r=this;return a;function a(f){return vi(f)?(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),u):n(f)}function u(f){return r.parser.lazy[r.now().line]?n(f):t(f)}}function nCe(e,t,n){return r;function r(a){return e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),e.attempt(jT,t,n)}}const rCe={name:"htmlText",tokenize:iCe};function iCe(e,t,n){const r=this;let a,u,f;return s;function s(Pe){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(Pe),v}function v(Pe){return Pe===33?(e.consume(Pe),x):Pe===47?(e.consume(Pe),de):Pe===63?(e.consume(Pe),X):bu(Pe)?(e.consume(Pe),ve):n(Pe)}function x(Pe){return Pe===45?(e.consume(Pe),A):Pe===91?(e.consume(Pe),u=0,F):bu(Pe)?(e.consume(Pe),$):n(Pe)}function A(Pe){return Pe===45?(e.consume(Pe),L):n(Pe)}function C(Pe){return Pe===null?n(Pe):Pe===45?(e.consume(Pe),P):vi(Pe)?(f=C,Kt(Pe)):(e.consume(Pe),C)}function P(Pe){return Pe===45?(e.consume(Pe),L):C(Pe)}function L(Pe){return Pe===62?Nt(Pe):Pe===45?P(Pe):C(Pe)}function F(Pe){const gn="CDATA[";return Pe===gn.charCodeAt(u++)?(e.consume(Pe),u===gn.length?U:F):n(Pe)}function U(Pe){return Pe===null?n(Pe):Pe===93?(e.consume(Pe),q):vi(Pe)?(f=U,Kt(Pe)):(e.consume(Pe),U)}function q(Pe){return Pe===93?(e.consume(Pe),G):U(Pe)}function G(Pe){return Pe===62?Nt(Pe):Pe===93?(e.consume(Pe),G):U(Pe)}function $(Pe){return Pe===null||Pe===62?Nt(Pe):vi(Pe)?(f=$,Kt(Pe)):(e.consume(Pe),$)}function X(Pe){return Pe===null?n(Pe):Pe===63?(e.consume(Pe),ie):vi(Pe)?(f=X,Kt(Pe)):(e.consume(Pe),X)}function ie(Pe){return Pe===62?Nt(Pe):X(Pe)}function de(Pe){return bu(Pe)?(e.consume(Pe),fe):n(Pe)}function fe(Pe){return Pe===45||tu(Pe)?(e.consume(Pe),fe):be(Pe)}function be(Pe){return vi(Pe)?(f=be,Kt(Pe)):Js(Pe)?(e.consume(Pe),be):Nt(Pe)}function ve(Pe){return Pe===45||tu(Pe)?(e.consume(Pe),ve):Pe===47||Pe===62||Va(Pe)?Qe(Pe):n(Pe)}function Qe(Pe){return Pe===47?(e.consume(Pe),Nt):Pe===58||Pe===95||bu(Pe)?(e.consume(Pe),we):vi(Pe)?(f=Qe,Kt(Pe)):Js(Pe)?(e.consume(Pe),Qe):Nt(Pe)}function we(Pe){return Pe===45||Pe===46||Pe===58||Pe===95||tu(Pe)?(e.consume(Pe),we):qe(Pe)}function qe(Pe){return Pe===61?(e.consume(Pe),Je):vi(Pe)?(f=qe,Kt(Pe)):Js(Pe)?(e.consume(Pe),qe):Qe(Pe)}function Je(Pe){return Pe===null||Pe===60||Pe===61||Pe===62||Pe===96?n(Pe):Pe===34||Pe===39?(e.consume(Pe),a=Pe,ft):vi(Pe)?(f=Je,Kt(Pe)):Js(Pe)?(e.consume(Pe),Je):(e.consume(Pe),Mt)}function ft(Pe){return Pe===a?(e.consume(Pe),a=void 0,Pt):Pe===null?n(Pe):vi(Pe)?(f=ft,Kt(Pe)):(e.consume(Pe),ft)}function Mt(Pe){return Pe===null||Pe===34||Pe===39||Pe===60||Pe===61||Pe===96?n(Pe):Pe===47||Pe===62||Va(Pe)?Qe(Pe):(e.consume(Pe),Mt)}function Pt(Pe){return Pe===47||Pe===62||Va(Pe)?Qe(Pe):n(Pe)}function Nt(Pe){return Pe===62?(e.consume(Pe),e.exit("htmlTextData"),e.exit("htmlText"),t):n(Pe)}function Kt(Pe){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(Pe),e.exit("lineEnding"),tt}function tt(Pe){return Js(Pe)?Zs(e,mt,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(Pe):mt(Pe)}function mt(Pe){return e.enter("htmlTextData"),f(Pe)}}const yD={name:"labelEnd",resolveAll:lCe,resolveTo:uCe,tokenize:cCe},sCe={tokenize:dCe},aCe={tokenize:hCe},oCe={tokenize:fCe};function lCe(e){let t=-1;const n=[];for(;++t<e.length;){const r=e[t][1];if(n.push(e[t]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const a=r.type==="labelImage"?4:2;r.type="data",t+=a}}return e.length!==n.length&&Bl(e,0,e.length,n),e}function uCe(e,t){let n=e.length,r=0,a,u,f,s;for(;n--;)if(a=e[n][1],u){if(a.type==="link"||a.type==="labelLink"&&a._inactive)break;e[n][0]==="enter"&&a.type==="labelLink"&&(a._inactive=!0)}else if(f){if(e[n][0]==="enter"&&(a.type==="labelImage"||a.type==="labelLink")&&!a._balanced&&(u=n,a.type!=="labelLink")){r=2;break}}else a.type==="labelEnd"&&(f=n);const v={type:e[u][1].type==="labelLink"?"link":"image",start:{...e[u][1].start},end:{...e[e.length-1][1].end}},x={type:"label",start:{...e[u][1].start},end:{...e[f][1].end}},A={type:"labelText",start:{...e[u+r+2][1].end},end:{...e[f-2][1].start}};return s=[["enter",v,t],["enter",x,t]],s=zl(s,e.slice(u+1,u+r+3)),s=zl(s,[["enter",A,t]]),s=zl(s,gx(t.parser.constructs.insideSpan.null,e.slice(u+r+4,f-3),t)),s=zl(s,[["exit",A,t],e[f-2],e[f-1],["exit",x,t]]),s=zl(s,e.slice(f+1)),s=zl(s,[["exit",v,t]]),Bl(e,u,e.length,s),e}function cCe(e,t,n){const r=this;let a=r.events.length,u,f;for(;a--;)if((r.events[a][1].type==="labelImage"||r.events[a][1].type==="labelLink")&&!r.events[a][1]._balanced){u=r.events[a][1];break}return s;function s(P){return u?u._inactive?C(P):(f=r.parser.defined.includes(ih(r.sliceSerialize({start:u.end,end:r.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(P),e.exit("labelMarker"),e.exit("labelEnd"),v):n(P)}function v(P){return P===40?e.attempt(sCe,A,f?A:C)(P):P===91?e.attempt(aCe,A,f?x:C)(P):f?A(P):C(P)}function x(P){return e.attempt(oCe,A,C)(P)}function A(P){return t(P)}function C(P){return u._balanced=!0,n(P)}}function dCe(e,t,n){return r;function r(C){return e.enter("resource"),e.enter("resourceMarker"),e.consume(C),e.exit("resourceMarker"),a}function a(C){return Va(C)?f2(e,u)(C):u(C)}function u(C){return C===41?A(C):Fee(e,f,s,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(C)}function f(C){return Va(C)?f2(e,v)(C):A(C)}function s(C){return n(C)}function v(C){return C===34||C===39||C===40?jee(e,x,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(C):A(C)}function x(C){return Va(C)?f2(e,A)(C):A(C)}function A(C){return C===41?(e.enter("resourceMarker"),e.consume(C),e.exit("resourceMarker"),e.exit("resource"),t):n(C)}}function hCe(e,t,n){const r=this;return a;function a(s){return Bee.call(r,e,u,f,"reference","referenceMarker","referenceString")(s)}function u(s){return r.parser.defined.includes(ih(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?t(s):n(s)}function f(s){return n(s)}}function fCe(e,t,n){return r;function r(u){return e.enter("reference"),e.enter("referenceMarker"),e.consume(u),e.exit("referenceMarker"),a}function a(u){return u===93?(e.enter("referenceMarker"),e.consume(u),e.exit("referenceMarker"),e.exit("reference"),t):n(u)}}const pCe={name:"labelStartImage",resolveAll:yD.resolveAll,tokenize:mCe};function mCe(e,t,n){const r=this;return a;function a(s){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(s),e.exit("labelImageMarker"),u}function u(s){return s===91?(e.enter("labelMarker"),e.consume(s),e.exit("labelMarker"),e.exit("labelImage"),f):n(s)}function f(s){return s===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(s):t(s)}}const gCe={name:"labelStartLink",resolveAll:yD.resolveAll,tokenize:_Ce};function _Ce(e,t,n){const r=this;return a;function a(f){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(f),e.exit("labelMarker"),e.exit("labelLink"),u}function u(f){return f===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(f):t(f)}}const sR={name:"lineEnding",tokenize:yCe};function yCe(e,t){return n;function n(r){return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),Zs(e,t,"linePrefix")}}const B4={name:"thematicBreak",tokenize:vCe};function vCe(e,t,n){let r=0,a;return u;function u(x){return e.enter("thematicBreak"),f(x)}function f(x){return a=x,s(x)}function s(x){return x===a?(e.enter("thematicBreakSequence"),v(x)):r>=3&&(x===null||vi(x))?(e.exit("thematicBreak"),t(x)):n(x)}function v(x){return x===a?(e.consume(x),r++,v):(e.exit("thematicBreakSequence"),Js(x)?Zs(e,s,"whitespace")(x):s(x))}}const $u={continuation:{tokenize:TCe},exit:SCe,name:"list",tokenize:wCe},xCe={partial:!0,tokenize:ACe},bCe={partial:!0,tokenize:ECe};function wCe(e,t,n){const r=this,a=r.events[r.events.length-1];let u=a&&a[1].type==="linePrefix"?a[2].sliceSerialize(a[1],!0).length:0,f=0;return s;function s(L){const F=r.containerState.type||(L===42||L===43||L===45?"listUnordered":"listOrdered");if(F==="listUnordered"?!r.containerState.marker||L===r.containerState.marker:f8(L)){if(r.containerState.type||(r.containerState.type=F,e.enter(F,{_container:!0})),F==="listUnordered")return e.enter("listItemPrefix"),L===42||L===45?e.check(B4,n,x)(L):x(L);if(!r.interrupt||L===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),v(L)}return n(L)}function v(L){return f8(L)&&++f<10?(e.consume(L),v):(!r.interrupt||f<2)&&(r.containerState.marker?L===r.containerState.marker:L===41||L===46)?(e.exit("listItemValue"),x(L)):n(L)}function x(L){return e.enter("listItemMarker"),e.consume(L),e.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||L,e.check(jT,r.interrupt?n:A,e.attempt(xCe,P,C))}function A(L){return r.containerState.initialBlankLine=!0,u++,P(L)}function C(L){return Js(L)?(e.enter("listItemPrefixWhitespace"),e.consume(L),e.exit("listItemPrefixWhitespace"),P):n(L)}function P(L){return r.containerState.size=u+r.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(L)}}function TCe(e,t,n){const r=this;return r.containerState._closeFlow=void 0,e.check(jT,a,u);function a(s){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,Zs(e,t,"listItemIndent",r.containerState.size+1)(s)}function u(s){return r.containerState.furtherBlankLines||!Js(s)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,f(s)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,e.attempt(bCe,t,f)(s))}function f(s){return r.containerState._closeFlow=!0,r.interrupt=void 0,Zs(e,e.attempt($u,t,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(s)}}function ECe(e,t,n){const r=this;return Zs(e,a,"listItemIndent",r.containerState.size+1);function a(u){const f=r.events[r.events.length-1];return f&&f[1].type==="listItemIndent"&&f[2].sliceSerialize(f[1],!0).length===r.containerState.size?t(u):n(u)}}function SCe(e){e.exit(this.containerState.type)}function ACe(e,t,n){const r=this;return Zs(e,a,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function a(u){const f=r.events[r.events.length-1];return!Js(u)&&f&&f[1].type==="listItemPrefixWhitespace"?t(u):n(u)}}const p$={name:"setextUnderline",resolveTo:CCe,tokenize:kCe};function CCe(e,t){let n=e.length,r,a,u;for(;n--;)if(e[n][0]==="enter"){if(e[n][1].type==="content"){r=n;break}e[n][1].type==="paragraph"&&(a=n)}else e[n][1].type==="content"&&e.splice(n,1),!u&&e[n][1].type==="definition"&&(u=n);const f={type:"setextHeading",start:{...e[r][1].start},end:{...e[e.length-1][1].end}};return e[a][1].type="setextHeadingText",u?(e.splice(a,0,["enter",f,t]),e.splice(u+1,0,["exit",e[r][1],t]),e[r][1].end={...e[u][1].end}):e[r][1]=f,e.push(["exit",f,t]),e}function kCe(e,t,n){const r=this;let a;return u;function u(x){let A=r.events.length,C;for(;A--;)if(r.events[A][1].type!=="lineEnding"&&r.events[A][1].type!=="linePrefix"&&r.events[A][1].type!=="content"){C=r.events[A][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||C)?(e.enter("setextHeadingLine"),a=x,f(x)):n(x)}function f(x){return e.enter("setextHeadingLineSequence"),s(x)}function s(x){return x===a?(e.consume(x),s):(e.exit("setextHeadingLineSequence"),Js(x)?Zs(e,v,"lineSuffix")(x):v(x))}function v(x){return x===null||vi(x)?(e.exit("setextHeadingLine"),t(x)):n(x)}}const ICe={tokenize:zCe,partial:!0};function RCe(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:LCe,continuation:{tokenize:DCe},exit:NCe}},text:{91:{name:"gfmFootnoteCall",tokenize:OCe},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:MCe,resolveTo:PCe}}}}function MCe(e,t,n){const r=this;let a=r.events.length;const u=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let f;for(;a--;){const v=r.events[a][1];if(v.type==="labelImage"){f=v;break}if(v.type==="gfmFootnoteCall"||v.type==="labelLink"||v.type==="label"||v.type==="image"||v.type==="link")break}return s;function s(v){if(!f||!f._balanced)return n(v);const x=ih(r.sliceSerialize({start:f.end,end:r.now()}));return x.codePointAt(0)!==94||!u.includes(x.slice(1))?n(v):(e.enter("gfmFootnoteCallLabelMarker"),e.consume(v),e.exit("gfmFootnoteCallLabelMarker"),t(v))}}function PCe(e,t){let n=e.length;for(;n--;)if(e[n][1].type==="labelImage"&&e[n][0]==="enter"){e[n][1];break}e[n+1][1].type="data",e[n+3][1].type="gfmFootnoteCallLabelMarker";const r={type:"gfmFootnoteCall",start:Object.assign({},e[n+3][1].start),end:Object.assign({},e[e.length-1][1].end)},a={type:"gfmFootnoteCallMarker",start:Object.assign({},e[n+3][1].end),end:Object.assign({},e[n+3][1].end)};a.end.column++,a.end.offset++,a.end._bufferIndex++;const u={type:"gfmFootnoteCallString",start:Object.assign({},a.end),end:Object.assign({},e[e.length-1][1].start)},f={type:"chunkString",contentType:"string",start:Object.assign({},u.start),end:Object.assign({},u.end)},s=[e[n+1],e[n+2],["enter",r,t],e[n+3],e[n+4],["enter",a,t],["exit",a,t],["enter",u,t],["enter",f,t],["exit",f,t],["exit",u,t],e[e.length-2],e[e.length-1],["exit",r,t]];return e.splice(n,e.length-n+1,...s),e}function OCe(e,t,n){const r=this,a=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let u=0,f;return s;function s(C){return e.enter("gfmFootnoteCall"),e.enter("gfmFootnoteCallLabelMarker"),e.consume(C),e.exit("gfmFootnoteCallLabelMarker"),v}function v(C){return C!==94?n(C):(e.enter("gfmFootnoteCallMarker"),e.consume(C),e.exit("gfmFootnoteCallMarker"),e.enter("gfmFootnoteCallString"),e.enter("chunkString").contentType="string",x)}function x(C){if(u>999||C===93&&!f||C===null||C===91||Va(C))return n(C);if(C===93){e.exit("chunkString");const P=e.exit("gfmFootnoteCallString");return a.includes(ih(r.sliceSerialize(P)))?(e.enter("gfmFootnoteCallLabelMarker"),e.consume(C),e.exit("gfmFootnoteCallLabelMarker"),e.exit("gfmFootnoteCall"),t):n(C)}return Va(C)||(f=!0),u++,e.consume(C),C===92?A:x}function A(C){return C===91||C===92||C===93?(e.consume(C),u++,x):x(C)}}function LCe(e,t,n){const r=this,a=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let u,f=0,s;return v;function v(F){return e.enter("gfmFootnoteDefinition")._container=!0,e.enter("gfmFootnoteDefinitionLabel"),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(F),e.exit("gfmFootnoteDefinitionLabelMarker"),x}function x(F){return F===94?(e.enter("gfmFootnoteDefinitionMarker"),e.consume(F),e.exit("gfmFootnoteDefinitionMarker"),e.enter("gfmFootnoteDefinitionLabelString"),e.enter("chunkString").contentType="string",A):n(F)}function A(F){if(f>999||F===93&&!s||F===null||F===91||Va(F))return n(F);if(F===93){e.exit("chunkString");const U=e.exit("gfmFootnoteDefinitionLabelString");return u=ih(r.sliceSerialize(U)),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(F),e.exit("gfmFootnoteDefinitionLabelMarker"),e.exit("gfmFootnoteDefinitionLabel"),P}return Va(F)||(s=!0),f++,e.consume(F),F===92?C:A}function C(F){return F===91||F===92||F===93?(e.consume(F),f++,A):A(F)}function P(F){return F===58?(e.enter("definitionMarker"),e.consume(F),e.exit("definitionMarker"),a.includes(u)||a.push(u),Zs(e,L,"gfmFootnoteDefinitionWhitespace")):n(F)}function L(F){return t(F)}}function DCe(e,t,n){return e.check(jT,t,e.attempt(ICe,t,n))}function NCe(e){e.exit("gfmFootnoteDefinition")}function zCe(e,t,n){const r=this;return Zs(e,a,"gfmFootnoteDefinitionIndent",5);function a(u){const f=r.events[r.events.length-1];return f&&f[1].type==="gfmFootnoteDefinitionIndent"&&f[2].sliceSerialize(f[1],!0).length===4?t(u):n(u)}}function FCe(e){let n=(e||{}).singleTilde;const r={name:"strikethrough",tokenize:u,resolveAll:a};return n==null&&(n=!0),{text:{126:r},insideSpan:{null:[r]},attentionMarkers:{null:[126]}};function a(f,s){let v=-1;for(;++v<f.length;)if(f[v][0]==="enter"&&f[v][1].type==="strikethroughSequenceTemporary"&&f[v][1]._close){let x=v;for(;x--;)if(f[x][0]==="exit"&&f[x][1].type==="strikethroughSequenceTemporary"&&f[x][1]._open&&f[v][1].end.offset-f[v][1].start.offset===f[x][1].end.offset-f[x][1].start.offset){f[v][1].type="strikethroughSequence",f[x][1].type="strikethroughSequence";const A={type:"strikethrough",start:Object.assign({},f[x][1].start),end:Object.assign({},f[v][1].end)},C={type:"strikethroughText",start:Object.assign({},f[x][1].end),end:Object.assign({},f[v][1].start)},P=[["enter",A,s],["enter",f[x][1],s],["exit",f[x][1],s],["enter",C,s]],L=s.parser.constructs.insideSpan.null;L&&Bl(P,P.length,0,gx(L,f.slice(x+1,v),s)),Bl(P,P.length,0,[["exit",C,s],["enter",f[v][1],s],["exit",f[v][1],s],["exit",A,s]]),Bl(f,x-1,v-x+3,P),v=x+P.length-2;break}}for(v=-1;++v<f.length;)f[v][1].type==="strikethroughSequenceTemporary"&&(f[v][1].type="data");return f}function u(f,s,v){const x=this.previous,A=this.events;let C=0;return P;function P(F){return x===126&&A[A.length-1][1].type!=="characterEscape"?v(F):(f.enter("strikethroughSequenceTemporary"),L(F))}function L(F){const U=Vv(x);if(F===126)return C>1?v(F):(f.consume(F),C++,L);if(C<2&&!n)return v(F);const q=f.exit("strikethroughSequenceTemporary"),G=Vv(F);return q._open=!G||G===2&&!!U,q._close=!U||U===2&&!!G,s(F)}}}class BCe{constructor(){this.map=[]}add(t,n,r){jCe(this,t,n,r)}consume(t){if(this.map.sort(function(u,f){return u[0]-f[0]}),this.map.length===0)return;let n=this.map.length;const r=[];for(;n>0;)n-=1,r.push(t.slice(this.map[n][0]+this.map[n][1]),this.map[n][2]),t.length=this.map[n][0];r.push(t.slice()),t.length=0;let a=r.pop();for(;a;){for(const u of a)t.push(u);a=r.pop()}this.map.length=0}}function jCe(e,t,n,r){let a=0;if(!(n===0&&r.length===0)){for(;a<e.map.length;){if(e.map[a][0]===t){e.map[a][1]+=n,e.map[a][2].push(...r);return}a+=1}e.map.push([t,n,r])}}function UCe(e,t){let n=!1;const r=[];for(;t<e.length;){const a=e[t];if(n){if(a[0]==="enter")a[1].type==="tableContent"&&r.push(e[t+1][1].type==="tableDelimiterMarker"?"left":"none");else if(a[1].type==="tableContent"){if(e[t-1][1].type==="tableDelimiterMarker"){const u=r.length-1;r[u]=r[u]==="left"?"center":"right"}}else if(a[1].type==="tableDelimiterRow")break}else a[0]==="enter"&&a[1].type==="tableDelimiterRow"&&(n=!0);t+=1}return r}function VCe(){return{flow:{null:{name:"table",tokenize:$Ce,resolveAll:HCe}}}}function $Ce(e,t,n){const r=this;let a=0,u=0,f;return s;function s(we){let qe=r.events.length-1;for(;qe>-1;){const Mt=r.events[qe][1].type;if(Mt==="lineEnding"||Mt==="linePrefix")qe--;else break}const Je=qe>-1?r.events[qe][1].type:null,ft=Je==="tableHead"||Je==="tableRow"?fe:v;return ft===fe&&r.parser.lazy[r.now().line]?n(we):ft(we)}function v(we){return e.enter("tableHead"),e.enter("tableRow"),x(we)}function x(we){return we===124||(f=!0,u+=1),A(we)}function A(we){return we===null?n(we):vi(we)?u>1?(u=0,r.interrupt=!0,e.exit("tableRow"),e.enter("lineEnding"),e.consume(we),e.exit("lineEnding"),L):n(we):Js(we)?Zs(e,A,"whitespace")(we):(u+=1,f&&(f=!1,a+=1),we===124?(e.enter("tableCellDivider"),e.consume(we),e.exit("tableCellDivider"),f=!0,A):(e.enter("data"),C(we)))}function C(we){return we===null||we===124||Va(we)?(e.exit("data"),A(we)):(e.consume(we),we===92?P:C)}function P(we){return we===92||we===124?(e.consume(we),C):C(we)}function L(we){return r.interrupt=!1,r.parser.lazy[r.now().line]?n(we):(e.enter("tableDelimiterRow"),f=!1,Js(we)?Zs(e,F,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(we):F(we))}function F(we){return we===45||we===58?q(we):we===124?(f=!0,e.enter("tableCellDivider"),e.consume(we),e.exit("tableCellDivider"),U):de(we)}function U(we){return Js(we)?Zs(e,q,"whitespace")(we):q(we)}function q(we){return we===58?(u+=1,f=!0,e.enter("tableDelimiterMarker"),e.consume(we),e.exit("tableDelimiterMarker"),G):we===45?(u+=1,G(we)):we===null||vi(we)?ie(we):de(we)}function G(we){return we===45?(e.enter("tableDelimiterFiller"),$(we)):de(we)}function $(we){return we===45?(e.consume(we),$):we===58?(f=!0,e.exit("tableDelimiterFiller"),e.enter("tableDelimiterMarker"),e.consume(we),e.exit("tableDelimiterMarker"),X):(e.exit("tableDelimiterFiller"),X(we))}function X(we){return Js(we)?Zs(e,ie,"whitespace")(we):ie(we)}function ie(we){return we===124?F(we):we===null||vi(we)?!f||a!==u?de(we):(e.exit("tableDelimiterRow"),e.exit("tableHead"),t(we)):de(we)}function de(we){return n(we)}function fe(we){return e.enter("tableRow"),be(we)}function be(we){return we===124?(e.enter("tableCellDivider"),e.consume(we),e.exit("tableCellDivider"),be):we===null||vi(we)?(e.exit("tableRow"),t(we)):Js(we)?Zs(e,be,"whitespace")(we):(e.enter("data"),ve(we))}function ve(we){return we===null||we===124||Va(we)?(e.exit("data"),be(we)):(e.consume(we),we===92?Qe:ve)}function Qe(we){return we===92||we===124?(e.consume(we),ve):ve(we)}}function HCe(e,t){let n=-1,r=!0,a=0,u=[0,0,0,0],f=[0,0,0,0],s=!1,v=0,x,A,C;const P=new BCe;for(;++n<e.length;){const L=e[n],F=L[1];L[0]==="enter"?F.type==="tableHead"?(s=!1,v!==0&&(m$(P,t,v,x,A),A=void 0,v=0),x={type:"table",start:Object.assign({},F.start),end:Object.assign({},F.end)},P.add(n,0,[["enter",x,t]])):F.type==="tableRow"||F.type==="tableDelimiterRow"?(r=!0,C=void 0,u=[0,0,0,0],f=[0,n+1,0,0],s&&(s=!1,A={type:"tableBody",start:Object.assign({},F.start),end:Object.assign({},F.end)},P.add(n,0,[["enter",A,t]])),a=F.type==="tableDelimiterRow"?2:A?3:1):a&&(F.type==="data"||F.type==="tableDelimiterMarker"||F.type==="tableDelimiterFiller")?(r=!1,f[2]===0&&(u[1]!==0&&(f[0]=f[1],C=L3(P,t,u,a,void 0,C),u=[0,0,0,0]),f[2]=n)):F.type==="tableCellDivider"&&(r?r=!1:(u[1]!==0&&(f[0]=f[1],C=L3(P,t,u,a,void 0,C)),u=f,f=[u[1],n,0,0])):F.type==="tableHead"?(s=!0,v=n):F.type==="tableRow"||F.type==="tableDelimiterRow"?(v=n,u[1]!==0?(f[0]=f[1],C=L3(P,t,u,a,n,C)):f[1]!==0&&(C=L3(P,t,f,a,n,C)),a=0):a&&(F.type==="data"||F.type==="tableDelimiterMarker"||F.type==="tableDelimiterFiller")&&(f[3]=n)}for(v!==0&&m$(P,t,v,x,A),P.consume(t.events),n=-1;++n<t.events.length;){const L=t.events[n];L[0]==="enter"&&L[1].type==="table"&&(L[1]._align=UCe(t.events,n))}return e}function L3(e,t,n,r,a,u){const f=r===1?"tableHeader":r===2?"tableDelimiter":"tableData",s="tableContent";n[0]!==0&&(u.end=Object.assign({},M1(t.events,n[0])),e.add(n[0],0,[["exit",u,t]]));const v=M1(t.events,n[1]);if(u={type:f,start:Object.assign({},v),end:Object.assign({},v)},e.add(n[1],0,[["enter",u,t]]),n[2]!==0){const x=M1(t.events,n[2]),A=M1(t.events,n[3]),C={type:s,start:Object.assign({},x),end:Object.assign({},A)};if(e.add(n[2],0,[["enter",C,t]]),r!==2){const P=t.events[n[2]],L=t.events[n[3]];if(P[1].end=Object.assign({},L[1].end),P[1].type="chunkText",P[1].contentType="text",n[3]>n[2]+1){const F=n[2]+1,U=n[3]-n[2]-1;e.add(F,U,[])}}e.add(n[3]+1,0,[["exit",C,t]])}return a!==void 0&&(u.end=Object.assign({},M1(t.events,a)),e.add(a,0,[["exit",u,t]]),u=void 0),u}function m$(e,t,n,r,a){const u=[],f=M1(t.events,n);a&&(a.end=Object.assign({},f),u.push(["exit",a,t])),r.end=Object.assign({},f),u.push(["exit",r,t]),e.add(n+1,0,u)}function M1(e,t){const n=e[t],r=n[0]==="enter"?"start":"end";return n[1][r]}const GCe={name:"tasklistCheck",tokenize:WCe};function qCe(){return{text:{91:GCe}}}function WCe(e,t,n){const r=this;return a;function a(v){return r.previous!==null||!r._gfmTasklistFirstContentOfListItem?n(v):(e.enter("taskListCheck"),e.enter("taskListCheckMarker"),e.consume(v),e.exit("taskListCheckMarker"),u)}function u(v){return Va(v)?(e.enter("taskListCheckValueUnchecked"),e.consume(v),e.exit("taskListCheckValueUnchecked"),f):v===88||v===120?(e.enter("taskListCheckValueChecked"),e.consume(v),e.exit("taskListCheckValueChecked"),f):n(v)}function f(v){return v===93?(e.enter("taskListCheckMarker"),e.consume(v),e.exit("taskListCheckMarker"),e.exit("taskListCheck"),s):n(v)}function s(v){return vi(v)?t(v):Js(v)?e.check({tokenize:ZCe},t,n)(v):n(v)}}function ZCe(e,t,n){return Zs(e,r,"whitespace");function r(a){return a===null?n(a):t(a)}}function XCe(e){return See([sAe(),RCe(),FCe(e),VCe(),qCe()])}const YCe={};function KCe(e){const t=this,n=e||YCe,r=t.data(),a=r.micromarkExtensions||(r.micromarkExtensions=[]),u=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),f=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);a.push(XCe(n)),u.push(J4e()),f.push(eAe(n))}function QCe(){return{enter:{mathFlow:e,mathFlowFenceMeta:t,mathText:u},exit:{mathFlow:a,mathFlowFence:r,mathFlowFenceMeta:n,mathFlowValue:s,mathText:f,mathTextData:s}};function e(v){const x={type:"element",tagName:"code",properties:{className:["language-math","math-display"]},children:[]};this.enter({type:"math",meta:null,value:"",data:{hName:"pre",hChildren:[x]}},v)}function t(){this.buffer()}function n(){const v=this.resume(),x=this.stack[this.stack.length-1];x.type,x.meta=v}function r(){this.data.mathFlowInside||(this.buffer(),this.data.mathFlowInside=!0)}function a(v){const x=this.resume().replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),A=this.stack[this.stack.length-1];A.type,this.exit(v),A.value=x;const C=A.data.hChildren[0];C.type,C.tagName,C.children.push({type:"text",value:x}),this.data.mathFlowInside=void 0}function u(v){this.enter({type:"inlineMath",value:"",data:{hName:"code",hProperties:{className:["language-math","math-inline"]},hChildren:[]}},v),this.buffer()}function f(v){const x=this.resume(),A=this.stack[this.stack.length-1];A.type,this.exit(v),A.value=x,A.data.hChildren.push({type:"text",value:x})}function s(v){this.config.enter.data.call(this,v),this.config.exit.data.call(this,v)}}function JCe(e){let t=(e||{}).singleDollarTextMath;return t==null&&(t=!0),r.peek=a,{unsafe:[{character:"\r",inConstruct:"mathFlowMeta"},{character:`
`,inConstruct:"mathFlowMeta"},{character:"$",after:t?void 0:"\\$",inConstruct:"phrasing"},{character:"$",inConstruct:"mathFlowMeta"},{atBreak:!0,character:"$",after:"\\$"}],handlers:{math:n,inlineMath:r}};function n(u,f,s,v){const x=u.value||"",A=s.createTracker(v),C="$".repeat(Math.max(dee(x,"$")+1,2)),P=s.enter("mathFlow");let L=A.move(C);if(u.meta){const F=s.enter("mathFlowMeta");L+=A.move(s.safe(u.meta,{after:`
`,before:L,encode:["$"],...A.current()})),F()}return L+=A.move(`
`),x&&(L+=A.move(x+`
`)),L+=A.move(C),P(),L}function r(u,f,s){let v=u.value||"",x=1;for(t||x++;new RegExp("(^|[^$])"+"\\$".repeat(x)+"([^$]|$)").test(v);)x++;const A="$".repeat(x);/[^ \r\n]/.test(v)&&(/^[ \r\n]/.test(v)&&/[ \r\n]$/.test(v)||/^\$|\$$/.test(v))&&(v=" "+v+" ");let C=-1;for(;++C<s.unsafe.length;){const P=s.unsafe[C];if(!P.atBreak)continue;const L=s.compilePattern(P);let F;for(;F=L.exec(v);){let U=F.index;v.codePointAt(U)===10&&v.codePointAt(U-1)===13&&U--,v=v.slice(0,U)+" "+v.slice(F.index+1)}}return A+v+A}function a(){return"$"}}const eke={tokenize:tke,concrete:!0,name:"mathFlow"},g$={tokenize:nke,partial:!0};function tke(e,t,n){const r=this,a=r.events[r.events.length-1],u=a&&a[1].type==="linePrefix"?a[2].sliceSerialize(a[1],!0).length:0;let f=0;return s;function s($){return e.enter("mathFlow"),e.enter("mathFlowFence"),e.enter("mathFlowFenceSequence"),v($)}function v($){return $===36?(e.consume($),f++,v):f<2?n($):(e.exit("mathFlowFenceSequence"),Zs(e,x,"whitespace")($))}function x($){return $===null||vi($)?C($):(e.enter("mathFlowFenceMeta"),e.enter("chunkString",{contentType:"string"}),A($))}function A($){return $===null||vi($)?(e.exit("chunkString"),e.exit("mathFlowFenceMeta"),C($)):$===36?n($):(e.consume($),A)}function C($){return e.exit("mathFlowFence"),r.interrupt?t($):e.attempt(g$,P,q)($)}function P($){return e.attempt({tokenize:G,partial:!0},q,L)($)}function L($){return(u?Zs(e,F,"linePrefix",u+1):F)($)}function F($){return $===null?q($):vi($)?e.attempt(g$,P,q)($):(e.enter("mathFlowValue"),U($))}function U($){return $===null||vi($)?(e.exit("mathFlowValue"),F($)):(e.consume($),U)}function q($){return e.exit("mathFlow"),t($)}function G($,X,ie){let de=0;return Zs($,fe,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4);function fe(Qe){return $.enter("mathFlowFence"),$.enter("mathFlowFenceSequence"),be(Qe)}function be(Qe){return Qe===36?(de++,$.consume(Qe),be):de<f?ie(Qe):($.exit("mathFlowFenceSequence"),Zs($,ve,"whitespace")(Qe))}function ve(Qe){return Qe===null||vi(Qe)?($.exit("mathFlowFence"),X(Qe)):ie(Qe)}}}function nke(e,t,n){const r=this;return a;function a(f){return f===null?t(f):(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),u)}function u(f){return r.parser.lazy[r.now().line]?n(f):t(f)}}function rke(e){let n=(e||{}).singleDollarTextMath;return n==null&&(n=!0),{tokenize:r,resolve:ike,previous:ske,name:"mathText"};function r(a,u,f){let s=0,v,x;return A;function A(U){return a.enter("mathText"),a.enter("mathTextSequence"),C(U)}function C(U){return U===36?(a.consume(U),s++,C):s<2&&!n?f(U):(a.exit("mathTextSequence"),P(U))}function P(U){return U===null?f(U):U===36?(x=a.enter("mathTextSequence"),v=0,F(U)):U===32?(a.enter("space"),a.consume(U),a.exit("space"),P):vi(U)?(a.enter("lineEnding"),a.consume(U),a.exit("lineEnding"),P):(a.enter("mathTextData"),L(U))}function L(U){return U===null||U===32||U===36||vi(U)?(a.exit("mathTextData"),P(U)):(a.consume(U),L)}function F(U){return U===36?(a.consume(U),v++,F):v===s?(a.exit("mathTextSequence"),a.exit("mathText"),u(U)):(x.type="mathTextData",L(U))}}}function ike(e){let t=e.length-4,n=3,r,a;if((e[n][1].type==="lineEnding"||e[n][1].type==="space")&&(e[t][1].type==="lineEnding"||e[t][1].type==="space")){for(r=n;++r<t;)if(e[r][1].type==="mathTextData"){e[t][1].type="mathTextPadding",e[n][1].type="mathTextPadding",n+=2,t-=2;break}}for(r=n-1,t++;++r<=t;)a===void 0?r!==t&&e[r][1].type!=="lineEnding"&&(a=r):(r===t||e[r][1].type==="lineEnding")&&(e[a][1].type="mathTextData",r!==a+2&&(e[a][1].end=e[r-1][1].end,e.splice(a+2,r-a-2),t-=r-a-2,r=a+2),a=void 0);return e}function ske(e){return e!==36||this.events[this.events.length-1][1].type==="characterEscape"}function ake(e){return{flow:{36:eke},text:{36:rke(e)}}}const oke={};function _8(e){const t=this,n=e||oke,r=t.data(),a=r.micromarkExtensions||(r.micromarkExtensions=[]),u=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),f=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);a.push(ake(n)),u.push(QCe()),f.push(JCe(n))}var lke=/(\*\*)([^*]*?)$/,uke=/(__)([^_]*?)$/,cke=/(\*\*\*)([^*]*?)$/,dke=/(\*)([^*]*?)$/,hke=/(_)([^_]*?)$/,fke=/(`)([^`]*?)$/,pke=/(~~)([^~]*?)$/,M_=/^[\s_~*`]*$/,Uee=/^[\s]*[-*+][\s]+$/,mke=/[\p{L}\p{N}_]/u,gke=/^```[^`\n]*```?$/,_ke=/^\*{4,}$/,p0=e=>{if(!e)return!1;let t=e.charCodeAt(0);return t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||t===95?!0:mke.test(e)},xk=e=>{let t=(e.match(/```/g)||[]).length;return t>0&&t%2===0&&e.includes(`
`)},yke=(e,t)=>{let n=1;for(let r=t-1;r>=0;r-=1)if(e[r]==="]")n+=1;else if(e[r]==="["&&(n-=1,n===0))return r;return-1},vke=(e,t)=>{let n=1;for(let r=t+1;r<e.length;r+=1)if(e[r]==="[")n+=1;else if(e[r]==="]"&&(n-=1,n===0))return r;return-1},Vee=(e,t)=>{let n=!1,r=!1;for(let a=0;a<e.length&&a<t;a+=1){if(e[a]==="\\"&&e[a+1]==="$"){a+=1;continue}e[a]==="$"&&(e[a+1]==="$"?(r=!r,a+=1,n=!1):r||(n=!n))}return n||r},xke=(e,t,n)=>{if(n!==" "&&n!=="	")return!1;let r=0;for(let a=t-1;a>=0;a-=1)if(e[a]===`
`){r=a+1;break}for(let a=r;a<t;a+=1)if(e[a]!==" "&&e[a]!=="	")return!1;return!0},bke=(e,t,n,r)=>!!(n==="\\"||n==="*"||r==="*"||n&&r&&p0(n)&&p0(r)||xke(e,t,r)),wke=e=>{let t=0,n=e.length;for(let r=0;r<n;r+=1){if(e[r]!=="*")continue;let a=r>0?e[r-1]:"",u=r<n-1?e[r+1]:"";bke(e,r,a,u)||(t+=1)}return t},Tke=(e,t,n,r)=>!!(n==="\\"||e.includes("$")&&Vee(e,t)||n==="_"||r==="_"||n&&r&&p0(n)&&p0(r)),Eke=e=>{let t=0,n=e.length;for(let r=0;r<n;r+=1){if(e[r]!=="_")continue;let a=r>0?e[r-1]:"",u=r<n-1?e[r+1]:"";Tke(e,r,a,u)||(t+=1)}return t},Ske=e=>{let t=0,n=0;for(let r=0;r<e.length;r+=1)e[r]==="*"?n+=1:(n>=3&&(t+=Math.floor(n/3)),n=0);return n>=3&&(t+=Math.floor(n/3)),t},Ake=e=>{if(xk(e))return e;let t=e.match(lke);if(t){let n=t[2];if(!n||M_.test(n))return e;let r=e.lastIndexOf(t[1]),a=e.substring(0,r).lastIndexOf(`
`),u=a===-1?0:a+1,f=e.substring(u,r);if(Uee.test(f)&&n.includes(`
`))return e;if((e.match(/\*\*/g)||[]).length%2===1)return`${e}**`}return e},Cke=e=>{let t=e.match(uke);if(t){let n=t[2];if(!n||M_.test(n))return e;let r=e.lastIndexOf(t[1]),a=e.substring(0,r).lastIndexOf(`
`),u=a===-1?0:a+1,f=e.substring(u,r);if(Uee.test(f)&&n.includes(`
`))return e;if((e.match(/__/g)||[]).length%2===1)return`${e}__`}return e},kke=e=>{for(let t=0;t<e.length;t+=1)if(e[t]==="*"&&e[t-1]!=="*"&&e[t+1]!=="*"&&e[t-1]!=="\\"){let n=t>0?e[t-1]:"",r=t<e.length-1?e[t+1]:"";if(n&&r&&p0(n)&&p0(r))continue;return t}return-1},Ike=e=>{if(xk(e)||!e.match(dke))return e;let t=kke(e);if(t===-1)return e;let n=e.substring(t+1);return!n||M_.test(n)?e:wke(e)%2===1?`${e}*`:e},Rke=e=>{for(let t=0;t<e.length;t+=1)if(e[t]==="_"&&e[t-1]!=="_"&&e[t+1]!=="_"&&e[t-1]!=="\\"&&!Vee(e,t)){let n=t>0?e[t-1]:"",r=t<e.length-1?e[t+1]:"";if(n&&r&&p0(n)&&p0(r))continue;return t}return-1},Mke=e=>{let t=e.length;for(;t>0&&e[t-1]===`
`;)t-=1;if(t<e.length){let n=e.slice(0,t),r=e.slice(t);return`${n}_${r}`}return`${e}_`},Pke=e=>{if(xk(e)||!e.match(hke))return e;let t=Rke(e);if(t===-1)return e;let n=e.substring(t+1);return!n||M_.test(n)?e:Eke(e)%2===1?Mke(e):e},Oke=e=>{if(xk(e)||_ke.test(e))return e;let t=e.match(cke);if(t){let n=t[2];if(!n||M_.test(n))return e;if(Ske(e)%2===1)return`${e}***`}return e},y8=(e,t)=>{let n=!1,r=!1;for(let a=0;a<t;a+=1){if(e.substring(a,a+3)==="```"){r=!r,a+=2;continue}!r&&e[a]==="`"&&(n=!n)}return n||r},Lke=(e,t)=>{let n=e.substring(t,t+3)==="```",r=t>0&&e.substring(t-1,t+2)==="```",a=t>1&&e.substring(t-2,t+1)==="```";return n||r||a},Dke=e=>{let t=0;for(let n=0;n<e.length;n+=1)e[n]==="`"&&!Lke(e,n)&&(t+=1);return t},Nke=e=>!e.match(gke)||e.includes(`
`)?null:e.endsWith("``")&&!e.endsWith("```")?`${e}\``:e,zke=e=>{let t=(e.match(/```/g)||[]).length;return!!(t>0&&t%2===0&&e.includes(`
`)||(e.endsWith("```\n")||e.endsWith("```"))&&t%2===0)},Fke=e=>(e.match(/```/g)||[]).length%2===1,Bke=e=>{let t=Nke(e);if(t!==null)return t;if(zke(e))return e;let n=e.match(fke);if(n&&!Fke(e)){let r=n[2];if(!r||M_.test(r))return e;if(Dke(e)%2===1)return`${e}\``}return e},jke=e=>{if((e.match(/\$\$/g)||[]).length%2===0)return e;let t=e.indexOf("$$");return t!==-1&&e.indexOf(`
`,t)!==-1&&!e.endsWith(`
`)?`${e}
$$`:`${e}$$`},Uke=(e,t)=>{if(e.substring(t+2).includes(")"))return null;let n=yke(e,t);if(n===-1||y8(e,n))return null;let r=n>0&&e[n-1]==="!",a=r?n-1:n,u=e.substring(0,a);if(r)return u;let f=e.substring(n+1,t);return`${u}[${f}](streamdown:incomplete-link)`},Vke=(e,t)=>{let n=t>0&&e[t-1]==="!",r=n?t-1:t;if(!e.substring(t+1).includes("]")){let a=e.substring(0,r);return n?a:`${e}](streamdown:incomplete-link)`}if(vke(e,t)===-1){let a=e.substring(0,r);return n?a:`${e}](streamdown:incomplete-link)`}return null},$ke=e=>{let t=e.lastIndexOf("](");if(t!==-1&&!y8(e,t)){let n=Uke(e,t);if(n!==null)return n}for(let n=e.length-1;n>=0;n-=1)if(e[n]==="["&&!y8(e,n)){let r=Vke(e,n);if(r!==null)return r}return e},Hke=e=>{let t=e.match(pke);if(t){let n=t[2];if(!n||M_.test(n))return e;if((e.match(/~~/g)||[]).length%2===1)return`${e}~~`}return e},Gke=e=>{if(!e||typeof e!="string")return e;let t=e,n=$ke(t);return n.endsWith("](streamdown:incomplete-link)")?n:(t=n,t=Oke(t),t=Ake(t),t=Cke(t),t=Ike(t),t=Pke(t),t=Bke(t),t=Hke(t),t=jke(t),t)},qke=Gke;/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wke=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Zke=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,r)=>r?r.toUpperCase():n.toLowerCase()),_$=e=>{const t=Zke(e);return t.charAt(0).toUpperCase()+t.slice(1)},$ee=(...e)=>e.filter((t,n,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===n).join(" ").trim(),Xke=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Yke={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kke=B.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:a="",children:u,iconNode:f,...s},v)=>B.createElement("svg",{ref:v,...Yke,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:$ee("lucide",a),...!u&&!Xke(s)&&{"aria-hidden":"true"},...s},[...f.map(([x,A])=>B.createElement(x,A)),...Array.isArray(u)?u:[u]]));/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sp=(e,t)=>{const n=B.forwardRef(({className:r,...a},u)=>B.createElement(Kke,{ref:u,iconNode:t,className:$ee(`lucide-${Wke(_$(e))}`,`lucide-${e}`,r),...a}));return n.displayName=_$(e),n};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qke=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Hee=Sp("check",Qke);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jke=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Gee=Sp("copy",Jke);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eIe=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],bk=Sp("download",eIe);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tIe=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],nIe=Sp("loader-circle",tIe);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rIe=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],iIe=Sp("maximize-2",rIe);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sIe=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],aIe=Sp("rotate-ccw",sIe);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oIe=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],lIe=Sp("x",oIe);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uIe=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],cIe=Sp("zoom-in",uIe);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dIe=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],hIe=Sp("zoom-out",dIe),fIe=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,pIe=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,mIe={};function y$(e,t){return(mIe.jsx?pIe:fIe).test(e)}const gIe=/[ \t\n\f\r]/g;function _Ie(e){return typeof e=="object"?e.type==="text"?v$(e.value):!1:v$(e)}function v$(e){return e.replace(gIe,"")===""}class UT{constructor(t,n,r){this.normal=n,this.property=t,r&&(this.space=r)}}UT.prototype.normal={};UT.prototype.property={};UT.prototype.space=void 0;function qee(e,t){const n={},r={};for(const a of e)Object.assign(n,a.property),Object.assign(r,a.normal);return new UT(n,r,t)}function v8(e){return e.toLowerCase()}class ac{constructor(t,n){this.attribute=n,this.property=t}}ac.prototype.attribute="";ac.prototype.booleanish=!1;ac.prototype.boolean=!1;ac.prototype.commaOrSpaceSeparated=!1;ac.prototype.commaSeparated=!1;ac.prototype.defined=!1;ac.prototype.mustUseProperty=!1;ac.prototype.number=!1;ac.prototype.overloadedBoolean=!1;ac.prototype.property="";ac.prototype.spaceSeparated=!1;ac.prototype.space=void 0;let yIe=0;const Ds=P_(),rl=P_(),x8=P_(),hr=P_(),no=P_(),lv=P_(),bc=P_();function P_(){return 2**++yIe}const b8=Object.freeze(Object.defineProperty({__proto__:null,boolean:Ds,booleanish:rl,commaOrSpaceSeparated:bc,commaSeparated:lv,number:hr,overloadedBoolean:x8,spaceSeparated:no},Symbol.toStringTag,{value:"Module"})),aR=Object.keys(b8);class vD extends ac{constructor(t,n,r,a){let u=-1;if(super(t,n),x$(this,"space",a),typeof r=="number")for(;++u<aR.length;){const f=aR[u];x$(this,aR[u],(r&b8[f])===b8[f])}}}vD.prototype.defined=!0;function x$(e,t,n){n&&(e[t]=n)}function yx(e){const t={},n={};for(const[r,a]of Object.entries(e.properties)){const u=new vD(r,e.transform(e.attributes||{},r),a,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(u.mustUseProperty=!0),t[r]=u,n[v8(r)]=r,n[v8(u.attribute)]=r}return new UT(t,n,e.space)}const Wee=yx({properties:{ariaActiveDescendant:null,ariaAtomic:rl,ariaAutoComplete:null,ariaBusy:rl,ariaChecked:rl,ariaColCount:hr,ariaColIndex:hr,ariaColSpan:hr,ariaControls:no,ariaCurrent:null,ariaDescribedBy:no,ariaDetails:null,ariaDisabled:rl,ariaDropEffect:no,ariaErrorMessage:null,ariaExpanded:rl,ariaFlowTo:no,ariaGrabbed:rl,ariaHasPopup:null,ariaHidden:rl,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:no,ariaLevel:hr,ariaLive:null,ariaModal:rl,ariaMultiLine:rl,ariaMultiSelectable:rl,ariaOrientation:null,ariaOwns:no,ariaPlaceholder:null,ariaPosInSet:hr,ariaPressed:rl,ariaReadOnly:rl,ariaRelevant:null,ariaRequired:rl,ariaRoleDescription:no,ariaRowCount:hr,ariaRowIndex:hr,ariaRowSpan:hr,ariaSelected:rl,ariaSetSize:hr,ariaSort:null,ariaValueMax:hr,ariaValueMin:hr,ariaValueNow:hr,ariaValueText:null,role:null},transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function Zee(e,t){return t in e?e[t]:t}function Xee(e,t){return Zee(e,t.toLowerCase())}const vIe=yx({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:lv,acceptCharset:no,accessKey:no,action:null,allow:null,allowFullScreen:Ds,allowPaymentRequest:Ds,allowUserMedia:Ds,alt:null,as:null,async:Ds,autoCapitalize:null,autoComplete:no,autoFocus:Ds,autoPlay:Ds,blocking:no,capture:null,charSet:null,checked:Ds,cite:null,className:no,cols:hr,colSpan:null,content:null,contentEditable:rl,controls:Ds,controlsList:no,coords:hr|lv,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Ds,defer:Ds,dir:null,dirName:null,disabled:Ds,download:x8,draggable:rl,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Ds,formTarget:null,headers:no,height:hr,hidden:x8,high:hr,href:null,hrefLang:null,htmlFor:no,httpEquiv:no,id:null,imageSizes:null,imageSrcSet:null,inert:Ds,inputMode:null,integrity:null,is:null,isMap:Ds,itemId:null,itemProp:no,itemRef:no,itemScope:Ds,itemType:no,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Ds,low:hr,manifest:null,max:null,maxLength:hr,media:null,method:null,min:null,minLength:hr,multiple:Ds,muted:Ds,name:null,nonce:null,noModule:Ds,noValidate:Ds,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Ds,optimum:hr,pattern:null,ping:no,placeholder:null,playsInline:Ds,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Ds,referrerPolicy:null,rel:no,required:Ds,reversed:Ds,rows:hr,rowSpan:hr,sandbox:no,scope:null,scoped:Ds,seamless:Ds,selected:Ds,shadowRootClonable:Ds,shadowRootDelegatesFocus:Ds,shadowRootMode:null,shape:null,size:hr,sizes:null,slot:null,span:hr,spellCheck:rl,src:null,srcDoc:null,srcLang:null,srcSet:null,start:hr,step:null,style:null,tabIndex:hr,target:null,title:null,translate:null,type:null,typeMustMatch:Ds,useMap:null,value:rl,width:hr,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:no,axis:null,background:null,bgColor:null,border:hr,borderColor:null,bottomMargin:hr,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Ds,declare:Ds,event:null,face:null,frame:null,frameBorder:null,hSpace:hr,leftMargin:hr,link:null,longDesc:null,lowSrc:null,marginHeight:hr,marginWidth:hr,noResize:Ds,noHref:Ds,noShade:Ds,noWrap:Ds,object:null,profile:null,prompt:null,rev:null,rightMargin:hr,rules:null,scheme:null,scrolling:rl,standby:null,summary:null,text:null,topMargin:hr,valueType:null,version:null,vAlign:null,vLink:null,vSpace:hr,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Ds,disableRemotePlayback:Ds,prefix:null,property:null,results:hr,security:null,unselectable:null},space:"html",transform:Xee}),xIe=yx({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:bc,accentHeight:hr,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:hr,amplitude:hr,arabicForm:null,ascent:hr,attributeName:null,attributeType:null,azimuth:hr,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:hr,by:null,calcMode:null,capHeight:hr,className:no,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:hr,diffuseConstant:hr,direction:null,display:null,dur:null,divisor:hr,dominantBaseline:null,download:Ds,dx:null,dy:null,edgeMode:null,editable:null,elevation:hr,enableBackground:null,end:null,event:null,exponent:hr,externalResourcesRequired:null,fill:null,fillOpacity:hr,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:lv,g2:lv,glyphName:lv,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:hr,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:hr,horizOriginX:hr,horizOriginY:hr,id:null,ideographic:hr,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:hr,k:hr,k1:hr,k2:hr,k3:hr,k4:hr,kernelMatrix:bc,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:hr,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:hr,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:hr,overlineThickness:hr,paintOrder:null,panose1:null,path:null,pathLength:hr,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:no,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:hr,pointsAtY:hr,pointsAtZ:hr,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:bc,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:bc,rev:bc,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:bc,requiredFeatures:bc,requiredFonts:bc,requiredFormats:bc,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:hr,specularExponent:hr,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:hr,strikethroughThickness:hr,string:null,stroke:null,strokeDashArray:bc,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:hr,strokeOpacity:hr,strokeWidth:null,style:null,surfaceScale:hr,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:bc,tabIndex:hr,tableValues:null,target:null,targetX:hr,targetY:hr,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:bc,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:hr,underlineThickness:hr,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:hr,values:null,vAlphabetic:hr,vMathematical:hr,vectorEffect:null,vHanging:hr,vIdeographic:hr,version:null,vertAdvY:hr,vertOriginX:hr,vertOriginY:hr,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:hr,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:Zee}),Yee=yx({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()}}),Kee=yx({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:Xee}),Qee=yx({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()}}),bIe={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},wIe=/[A-Z]/g,b$=/-[a-z]/g,TIe=/^data[-\w.:]+$/i;function EIe(e,t){const n=v8(t);let r=t,a=ac;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&TIe.test(t)){if(t.charAt(4)==="-"){const u=t.slice(5).replace(b$,AIe);r="data"+u.charAt(0).toUpperCase()+u.slice(1)}else{const u=t.slice(4);if(!b$.test(u)){let f=u.replace(wIe,SIe);f.charAt(0)!=="-"&&(f="-"+f),t="data"+f}}a=vD}return new a(r,t)}function SIe(e){return"-"+e.toLowerCase()}function AIe(e){return e.charAt(1).toUpperCase()}const CIe=qee([Wee,vIe,Yee,Kee,Qee],"html"),xD=qee([Wee,xIe,Yee,Kee,Qee],"svg");var bD={},w$=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,kIe=/\n/g,IIe=/^\s*/,RIe=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,MIe=/^:\s*/,PIe=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,OIe=/^[;\s]*/,LIe=/^\s+|\s+$/g,DIe=`
`,T$="/",E$="*",Ig="",NIe="comment",zIe="declaration";function FIe(e,t){if(typeof e!="string")throw new TypeError("First argument must be a string");if(!e)return[];t=t||{};var n=1,r=1;function a(F){var U=F.match(kIe);U&&(n+=U.length);var q=F.lastIndexOf(DIe);r=~q?F.length-q:r+F.length}function u(){var F={line:n,column:r};return function(U){return U.position=new f(F),x(),U}}function f(F){this.start=F,this.end={line:n,column:r},this.source=t.source}f.prototype.content=e;function s(F){var U=new Error(t.source+":"+n+":"+r+": "+F);if(U.reason=F,U.filename=t.source,U.line=n,U.column=r,U.source=e,!t.silent)throw U}function v(F){var U=F.exec(e);if(U){var q=U[0];return a(q),e=e.slice(q.length),U}}function x(){v(IIe)}function A(F){var U;for(F=F||[];U=C();)U!==!1&&F.push(U);return F}function C(){var F=u();if(!(T$!=e.charAt(0)||E$!=e.charAt(1))){for(var U=2;Ig!=e.charAt(U)&&(E$!=e.charAt(U)||T$!=e.charAt(U+1));)++U;if(U+=2,Ig===e.charAt(U-1))return s("End of comment missing");var q=e.slice(2,U-2);return r+=2,a(q),e=e.slice(U),r+=2,F({type:NIe,comment:q})}}function P(){var F=u(),U=v(RIe);if(U){if(C(),!v(MIe))return s("property missing ':'");var q=v(PIe),G=F({type:zIe,property:S$(U[0].replace(w$,Ig)),value:q?S$(q[0].replace(w$,Ig)):Ig});return v(OIe),G}}function L(){var F=[];A(F);for(var U;U=P();)U!==!1&&(F.push(U),A(F));return F}return x(),L()}function S$(e){return e?e.replace(LIe,Ig):Ig}var BIe=FIe,jIe=ep&&ep.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(bD,"__esModule",{value:!0});bD.default=VIe;const UIe=jIe(BIe);function VIe(e,t){let n=null;if(!e||typeof e!="string")return n;const r=(0,UIe.default)(e),a=typeof t=="function";return r.forEach(u=>{if(u.type!=="declaration")return;const{property:f,value:s}=u;a?t(f,s,u):s&&(n=n||{},n[f]=s)}),n}var wk={};Object.defineProperty(wk,"__esModule",{value:!0});wk.camelCase=void 0;var $Ie=/^--[a-zA-Z0-9_-]+$/,HIe=/-([a-z])/g,GIe=/^[^-]+$/,qIe=/^-(webkit|moz|ms|o|khtml)-/,WIe=/^-(ms)-/,ZIe=function(e){return!e||GIe.test(e)||$Ie.test(e)},XIe=function(e,t){return t.toUpperCase()},A$=function(e,t){return"".concat(t,"-")},YIe=function(e,t){return t===void 0&&(t={}),ZIe(e)?e:(e=e.toLowerCase(),t.reactCompat?e=e.replace(WIe,A$):e=e.replace(qIe,A$),e.replace(HIe,XIe))};wk.camelCase=YIe;var KIe=ep&&ep.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},QIe=KIe(bD),JIe=wk;function w8(e,t){var n={};return!e||typeof e!="string"||(0,QIe.default)(e,function(r,a){r&&a&&(n[(0,JIe.camelCase)(r,t)]=a)}),n}w8.default=w8;var e6e=w8;const t6e=fT(e6e);function p2(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?C$(e.position):"start"in e||"end"in e?C$(e):"line"in e||"column"in e?T8(e):""}function T8(e){return k$(e&&e.line)+":"+k$(e&&e.column)}function C$(e){return T8(e&&e.start)+"-"+T8(e&&e.end)}function k$(e){return e&&typeof e=="number"?e:1}class au extends Error{constructor(t,n,r){super(),typeof n=="string"&&(r=n,n=void 0);let a="",u={},f=!1;if(n&&("line"in n&&"column"in n?u={place:n}:"start"in n&&"end"in n?u={place:n}:"type"in n?u={ancestors:[n],place:n.position}:u={...n}),typeof t=="string"?a=t:!u.cause&&t&&(f=!0,a=t.message,u.cause=t),!u.ruleId&&!u.source&&typeof r=="string"){const v=r.indexOf(":");v===-1?u.ruleId=r:(u.source=r.slice(0,v),u.ruleId=r.slice(v+1))}if(!u.place&&u.ancestors&&u.ancestors){const v=u.ancestors[u.ancestors.length-1];v&&(u.place=v.position)}const s=u.place&&"start"in u.place?u.place.start:u.place;this.ancestors=u.ancestors||void 0,this.cause=u.cause||void 0,this.column=s?s.column:void 0,this.fatal=void 0,this.file="",this.message=a,this.line=s?s.line:void 0,this.name=p2(u.place)||"1:1",this.place=u.place||void 0,this.reason=this.message,this.ruleId=u.ruleId||void 0,this.source=u.source||void 0,this.stack=f&&u.cause&&typeof u.cause.stack=="string"?u.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}au.prototype.file="";au.prototype.name="";au.prototype.reason="";au.prototype.message="";au.prototype.stack="";au.prototype.column=void 0;au.prototype.line=void 0;au.prototype.ancestors=void 0;au.prototype.cause=void 0;au.prototype.fatal=void 0;au.prototype.place=void 0;au.prototype.ruleId=void 0;au.prototype.source=void 0;const wD={}.hasOwnProperty,n6e=new Map,r6e=/[A-Z]/g,i6e=new Set(["table","tbody","thead","tfoot","tr"]),s6e=new Set(["td","th"]),Jee="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function a6e(e,t){if(!t||t.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=t.filePath||void 0;let r;if(t.development){if(typeof t.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=p6e(n,t.jsxDEV)}else{if(typeof t.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof t.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=f6e(n,t.jsx,t.jsxs)}const a={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:r,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:t.passKeys!==!1,passNode:t.passNode||!1,schema:t.space==="svg"?xD:CIe,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:t.tableCellAlignToStyle!==!1},u=ete(a,e,void 0);return u&&typeof u!="string"?u:a.create(e,a.Fragment,{children:u||void 0},void 0)}function ete(e,t,n){if(t.type==="element")return o6e(e,t,n);if(t.type==="mdxFlowExpression"||t.type==="mdxTextExpression")return l6e(e,t);if(t.type==="mdxJsxFlowElement"||t.type==="mdxJsxTextElement")return c6e(e,t,n);if(t.type==="mdxjsEsm")return u6e(e,t);if(t.type==="root")return d6e(e,t,n);if(t.type==="text")return h6e(e,t)}function o6e(e,t,n){const r=e.schema;let a=r;t.tagName.toLowerCase()==="svg"&&r.space==="html"&&(a=xD,e.schema=a),e.ancestors.push(t);const u=nte(e,t.tagName,!1),f=m6e(e,t);let s=ED(e,t);return i6e.has(t.tagName)&&(s=s.filter(function(v){return typeof v=="string"?!_Ie(v):!0})),tte(e,f,u,t),TD(f,s),e.ancestors.pop(),e.schema=r,e.create(t,u,f,n)}function l6e(e,t){if(t.data&&t.data.estree&&e.evaluater){const r=t.data.estree.body[0];return r.type,e.evaluater.evaluateExpression(r.expression)}rT(e,t.position)}function u6e(e,t){if(t.data&&t.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(t.data.estree);rT(e,t.position)}function c6e(e,t,n){const r=e.schema;let a=r;t.name==="svg"&&r.space==="html"&&(a=xD,e.schema=a),e.ancestors.push(t);const u=t.name===null?e.Fragment:nte(e,t.name,!0),f=g6e(e,t),s=ED(e,t);return tte(e,f,u,t),TD(f,s),e.ancestors.pop(),e.schema=r,e.create(t,u,f,n)}function d6e(e,t,n){const r={};return TD(r,ED(e,t)),e.create(t,e.Fragment,r,n)}function h6e(e,t){return t.value}function tte(e,t,n,r){typeof n!="string"&&n!==e.Fragment&&e.passNode&&(t.node=r)}function TD(e,t){if(t.length>0){const n=t.length>1?t:t[0];n&&(e.children=n)}}function f6e(e,t,n){return r;function r(a,u,f,s){const x=Array.isArray(f.children)?n:t;return s?x(u,f,s):x(u,f)}}function p6e(e,t){return n;function n(r,a,u,f){const s=Array.isArray(u.children),v=gf(r);return t(a,u,f,s,{columnNumber:v?v.column-1:void 0,fileName:e,lineNumber:v?v.line:void 0},void 0)}}function m6e(e,t){const n={};let r,a;for(a in t.properties)if(a!=="children"&&wD.call(t.properties,a)){const u=_6e(e,a,t.properties[a]);if(u){const[f,s]=u;e.tableCellAlignToStyle&&f==="align"&&typeof s=="string"&&s6e.has(t.tagName)?r=s:n[f]=s}}if(r){const u=n.style||(n.style={});u[e.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return n}function g6e(e,t){const n={};for(const r of t.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&e.evaluater){const u=r.data.estree.body[0];u.type;const f=u.expression;f.type;const s=f.properties[0];s.type,Object.assign(n,e.evaluater.evaluateExpression(s.argument))}else rT(e,t.position);else{const a=r.name;let u;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&e.evaluater){const s=r.value.data.estree.body[0];s.type,u=e.evaluater.evaluateExpression(s.expression)}else rT(e,t.position);else u=r.value===null?!0:r.value;n[a]=u}return n}function ED(e,t){const n=[];let r=-1;const a=e.passKeys?new Map:n6e;for(;++r<t.children.length;){const u=t.children[r];let f;if(e.passKeys){const v=u.type==="element"?u.tagName:u.type==="mdxJsxFlowElement"||u.type==="mdxJsxTextElement"?u.name:void 0;if(v){const x=a.get(v)||0;f=v+"-"+x,a.set(v,x+1)}}const s=ete(e,u,f);s!==void 0&&n.push(s)}return n}function _6e(e,t,n){const r=EIe(e.schema,t);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?cZ(n):uZ(n)),r.property==="style"){let a=typeof n=="object"?n:y6e(e,String(n));return e.stylePropertyNameCase==="css"&&(a=v6e(a)),["style",a]}return[e.elementAttributeNameCase==="react"&&r.space?bIe[r.property]||r.property:r.attribute,n]}}function y6e(e,t){try{return t6e(t,{reactCompat:!0})}catch(n){if(e.ignoreInvalidStyle)return{};const r=n,a=new au("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw a.file=e.filePath||void 0,a.url=Jee+"#cannot-parse-style-attribute",a}}function nte(e,t,n){let r;if(!n)r={type:"Literal",value:t};else if(t.includes(".")){const a=t.split(".");let u=-1,f;for(;++u<a.length;){const s=y$(a[u])?{type:"Identifier",name:a[u]}:{type:"Literal",value:a[u]};f=f?{type:"MemberExpression",object:f,property:s,computed:!!(u&&s.type==="Literal"),optional:!1}:s}r=f}else r=y$(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t};if(r.type==="Literal"){const a=r.value;return wD.call(e.components,a)?e.components[a]:a}if(e.evaluater)return e.evaluater.evaluateExpression(r);rT(e)}function rT(e,t){const n=new au("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=e.filePath||void 0,n.url=Jee+"#cannot-handle-mdx-estrees-without-createevaluater",n}function v6e(e){const t={};let n;for(n in e)wD.call(e,n)&&(t[x6e(n)]=e[n]);return t}function x6e(e){let t=e.replace(r6e,b6e);return t.slice(0,3)==="ms-"&&(t="-"+t),t}function b6e(e){return"-"+e.toLowerCase()}const w6e={tokenize:T6e};function T6e(e){const t=e.attempt(this.parser.constructs.contentInitial,r,a);let n;return t;function r(s){if(s===null){e.consume(s);return}return e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),Zs(e,t,"linePrefix")}function a(s){return e.enter("paragraph"),u(s)}function u(s){const v=e.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=v),n=v,f(s)}function f(s){if(s===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(s);return}return vi(s)?(e.consume(s),e.exit("chunkText"),u):(e.consume(s),f)}}const E6e={tokenize:S6e},I$={tokenize:A6e};function S6e(e){const t=this,n=[];let r=0,a,u,f;return s;function s(X){if(r<n.length){const ie=n[r];return t.containerState=ie[1],e.attempt(ie[0].continuation,v,x)(X)}return x(X)}function v(X){if(r++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,a&&$();const ie=t.events.length;let de=ie,fe;for(;de--;)if(t.events[de][0]==="exit"&&t.events[de][1].type==="chunkFlow"){fe=t.events[de][1].end;break}G(r);let be=ie;for(;be<t.events.length;)t.events[be][1].end={...fe},be++;return Bl(t.events,de+1,0,t.events.slice(ie)),t.events.length=be,x(X)}return s(X)}function x(X){if(r===n.length){if(!a)return P(X);if(a.currentConstruct&&a.currentConstruct.concrete)return F(X);t.interrupt=!!(a.currentConstruct&&!a._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(I$,A,C)(X)}function A(X){return a&&$(),G(r),P(X)}function C(X){return t.parser.lazy[t.now().line]=r!==n.length,f=t.now().offset,F(X)}function P(X){return t.containerState={},e.attempt(I$,L,F)(X)}function L(X){return r++,n.push([t.currentConstruct,t.containerState]),P(X)}function F(X){if(X===null){a&&$(),G(0),e.consume(X);return}return a=a||t.parser.flow(t.now()),e.enter("chunkFlow",{_tokenizer:a,contentType:"flow",previous:u}),U(X)}function U(X){if(X===null){q(e.exit("chunkFlow"),!0),G(0),e.consume(X);return}return vi(X)?(e.consume(X),q(e.exit("chunkFlow")),r=0,t.interrupt=void 0,s):(e.consume(X),U)}function q(X,ie){const de=t.sliceStream(X);if(ie&&de.push(null),X.previous=u,u&&(u.next=X),u=X,a.defineSkip(X.start),a.write(de),t.parser.lazy[X.start.line]){let fe=a.events.length;for(;fe--;)if(a.events[fe][1].start.offset<f&&(!a.events[fe][1].end||a.events[fe][1].end.offset>f))return;const be=t.events.length;let ve=be,Qe,we;for(;ve--;)if(t.events[ve][0]==="exit"&&t.events[ve][1].type==="chunkFlow"){if(Qe){we=t.events[ve][1].end;break}Qe=!0}for(G(r),fe=be;fe<t.events.length;)t.events[fe][1].end={...we},fe++;Bl(t.events,ve+1,0,t.events.slice(be)),t.events.length=fe}}function G(X){let ie=n.length;for(;ie-- >X;){const de=n[ie];t.containerState=de[1],de[0].exit.call(t,e)}n.length=X}function $(){a.write([null]),u=void 0,a=void 0,t.containerState._closeFlow=void 0}}function A6e(e,t,n){return Zs(e,e.attempt(this.parser.constructs.document,t,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}const C6e={tokenize:k6e};function k6e(e){const t=this,n=e.attempt(jT,r,e.attempt(this.parser.constructs.flowInitial,a,Zs(e,e.attempt(this.parser.constructs.flow,a,e.attempt(DAe,a)),"linePrefix")));return n;function r(u){if(u===null){e.consume(u);return}return e.enter("lineEndingBlank"),e.consume(u),e.exit("lineEndingBlank"),t.currentConstruct=void 0,n}function a(u){if(u===null){e.consume(u);return}return e.enter("lineEnding"),e.consume(u),e.exit("lineEnding"),t.currentConstruct=void 0,n}}const I6e={resolveAll:ite()},R6e=rte("string"),M6e=rte("text");function rte(e){return{resolveAll:ite(e==="text"?P6e:void 0),tokenize:t};function t(n){const r=this,a=this.parser.constructs[e],u=n.attempt(a,f,s);return f;function f(A){return x(A)?u(A):s(A)}function s(A){if(A===null){n.consume(A);return}return n.enter("data"),n.consume(A),v}function v(A){return x(A)?(n.exit("data"),u(A)):(n.consume(A),v)}function x(A){if(A===null)return!0;const C=a[A];let P=-1;if(C)for(;++P<C.length;){const L=C[P];if(!L.previous||L.previous.call(r,r.previous))return!0}return!1}}}function ite(e){return t;function t(n,r){let a=-1,u;for(;++a<=n.length;)u===void 0?n[a]&&n[a][1].type==="data"&&(u=a,a++):(!n[a]||n[a][1].type!=="data")&&(a!==u+2&&(n[u][1].end=n[a-1][1].end,n.splice(u+2,a-u-2),a=u+2),u=void 0);return e?e(n,r):n}}function P6e(e,t){let n=0;for(;++n<=e.length;)if((n===e.length||e[n][1].type==="lineEnding")&&e[n-1][1].type==="data"){const r=e[n-1][1],a=t.sliceStream(r);let u=a.length,f=-1,s=0,v;for(;u--;){const x=a[u];if(typeof x=="string"){for(f=x.length;x.charCodeAt(f-1)===32;)s++,f--;if(f)break;f=-1}else if(x===-2)v=!0,s++;else if(x!==-1){u++;break}}if(t._contentTypeTextTrailing&&n===e.length&&(s=0),s){const x={type:n===e.length||v||s<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:u?f:r.start._bufferIndex+f,_index:r.start._index+u,line:r.end.line,column:r.end.column-s,offset:r.end.offset-s},end:{...r.end}};r.end={...x.start},r.start.offset===r.end.offset?Object.assign(r,x):(e.splice(n,0,["enter",x,t],["exit",x,t]),n+=2)}n++}return e}const O6e={42:$u,43:$u,45:$u,48:$u,49:$u,50:$u,51:$u,52:$u,53:$u,54:$u,55:$u,56:$u,57:$u,62:Lee},L6e={91:jAe},D6e={[-2]:iR,[-1]:iR,32:iR},N6e={35:qAe,42:B4,45:[p$,B4],60:YAe,61:p$,95:B4,96:h$,126:h$},z6e={38:Nee,92:Dee},F6e={[-5]:sR,[-4]:sR,[-3]:sR,33:pCe,38:Nee,42:g8,60:[gAe,rCe],91:gCe,92:[HAe,Dee],93:yD,95:g8,96:IAe},B6e={null:[g8,I6e]},j6e={null:[42,95]},U6e={null:[]},V6e=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:j6e,contentInitial:L6e,disable:U6e,document:O6e,flow:N6e,flowInitial:D6e,insideSpan:B6e,string:z6e,text:F6e},Symbol.toStringTag,{value:"Module"}));function $6e(e,t,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const a={},u=[];let f=[],s=[];const v={attempt:be(de),check:be(fe),consume:$,enter:X,exit:ie,interrupt:be(fe,{interrupt:!0})},x={code:null,containerState:{},defineSkip:U,events:[],now:F,parser:e,previous:null,sliceSerialize:P,sliceStream:L,write:C};let A=t.tokenize.call(x,v);return t.resolveAll&&u.push(t),x;function C(qe){return f=zl(f,qe),q(),f[f.length-1]!==null?[]:(ve(t,0),x.events=gx(u,x.events,x),x.events)}function P(qe,Je){return G6e(L(qe),Je)}function L(qe){return H6e(f,qe)}function F(){const{_bufferIndex:qe,_index:Je,line:ft,column:Mt,offset:Pt}=r;return{_bufferIndex:qe,_index:Je,line:ft,column:Mt,offset:Pt}}function U(qe){a[qe.line]=qe.column,we()}function q(){let qe;for(;r._index<f.length;){const Je=f[r._index];if(typeof Je=="string")for(qe=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===qe&&r._bufferIndex<Je.length;)G(Je.charCodeAt(r._bufferIndex));else G(Je)}}function G(qe){A=A(qe)}function $(qe){vi(qe)?(r.line++,r.column=1,r.offset+=qe===-3?2:1,we()):qe!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===f[r._index].length&&(r._bufferIndex=-1,r._index++)),x.previous=qe}function X(qe,Je){const ft=Je||{};return ft.type=qe,ft.start=F(),x.events.push(["enter",ft,x]),s.push(ft),ft}function ie(qe){const Je=s.pop();return Je.end=F(),x.events.push(["exit",Je,x]),Je}function de(qe,Je){ve(qe,Je.from)}function fe(qe,Je){Je.restore()}function be(qe,Je){return ft;function ft(Mt,Pt,Nt){let Kt,tt,mt,Pe;return Array.isArray(Mt)?Et(Mt):"tokenize"in Mt?Et([Mt]):gn(Mt);function gn(fn){return Nn;function Nn(bn){const Vt=bn!==null&&fn[bn],En=bn!==null&&fn.null,Sn=[...Array.isArray(Vt)?Vt:Vt?[Vt]:[],...Array.isArray(En)?En:En?[En]:[]];return Et(Sn)(bn)}}function Et(fn){return Kt=fn,tt=0,fn.length===0?Nt:ze(fn[tt])}function ze(fn){return Nn;function Nn(bn){return Pe=Qe(),mt=fn,fn.partial||(x.currentConstruct=fn),fn.name&&x.parser.constructs.disable.null.includes(fn.name)?Cn():fn.tokenize.call(Je?Object.assign(Object.create(x),Je):x,v,$t,Cn)(bn)}}function $t(fn){return qe(mt,Pe),Pt}function Cn(fn){return Pe.restore(),++tt<Kt.length?ze(Kt[tt]):Nt}}}function ve(qe,Je){qe.resolveAll&&!u.includes(qe)&&u.push(qe),qe.resolve&&Bl(x.events,Je,x.events.length-Je,qe.resolve(x.events.slice(Je),x)),qe.resolveTo&&(x.events=qe.resolveTo(x.events,x))}function Qe(){const qe=F(),Je=x.previous,ft=x.currentConstruct,Mt=x.events.length,Pt=Array.from(s);return{from:Mt,restore:Nt};function Nt(){r=qe,x.previous=Je,x.currentConstruct=ft,x.events.length=Mt,s=Pt,we()}}function we(){r.line in a&&r.column<2&&(r.column=a[r.line],r.offset+=a[r.line]-1)}}function H6e(e,t){const n=t.start._index,r=t.start._bufferIndex,a=t.end._index,u=t.end._bufferIndex;let f;if(n===a)f=[e[n].slice(r,u)];else{if(f=e.slice(n,a),r>-1){const s=f[0];typeof s=="string"?f[0]=s.slice(r):f.shift()}u>0&&f.push(e[a].slice(0,u))}return f}function G6e(e,t){let n=-1;const r=[];let a;for(;++n<e.length;){const u=e[n];let f;if(typeof u=="string")f=u;else switch(u){case-5:{f="\r";break}case-4:{f=`
`;break}case-3:{f=`\r
`;break}case-2:{f=t?" ":"	";break}case-1:{if(!t&&a)continue;f=" ";break}default:f=String.fromCharCode(u)}a=u===-2,r.push(f)}return r.join("")}function q6e(e){const r={constructs:See([V6e,...(e||{}).extensions||[]]),content:a(w6e),defined:[],document:a(E6e),flow:a(C6e),lazy:{},string:a(R6e),text:a(M6e)};return r;function a(u){return f;function f(s){return $6e(r,u,s)}}}function W6e(e){for(;!zee(e););return e}const R$=/[\0\t\n\r]/g;function Z6e(){let e=1,t="",n=!0,r;return a;function a(u,f,s){const v=[];let x,A,C,P,L;for(u=t+(typeof u=="string"?u.toString():new TextDecoder(f||void 0).decode(u)),C=0,t="",n&&(u.charCodeAt(0)===65279&&C++,n=void 0);C<u.length;){if(R$.lastIndex=C,x=R$.exec(u),P=x&&x.index!==void 0?x.index:u.length,L=u.charCodeAt(P),!x){t=u.slice(C);break}if(L===10&&C===P&&r)v.push(-3),r=void 0;else switch(r&&(v.push(-5),r=void 0),C<P&&(v.push(u.slice(C,P)),e+=P-C),L){case 0:{v.push(65533),e++;break}case 9:{for(A=Math.ceil(e/4)*4,v.push(-2);e++<A;)v.push(-1);break}case 10:{v.push(-4),e=1;break}default:r=!0,e=1}C=P+1}return s&&(r&&v.push(-5),t&&v.push(t),v.push(null)),v}}const ste={}.hasOwnProperty;function X6e(e,t,n){return typeof t!="string"&&(n=t,t=void 0),Y6e(n)(W6e(q6e(n).document().write(Z6e()(e,t,!0))))}function Y6e(e){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:u(xr),autolinkProtocol:Qe,autolinkEmail:Qe,atxHeading:u(Xr),blockQuote:u(En),characterEscape:Qe,characterReference:Qe,codeFenced:u(Sn),codeFencedFenceInfo:f,codeFencedFenceMeta:f,codeIndented:u(Sn,f),codeText:u(Un,f),codeTextData:Qe,data:Qe,codeFlowValue:Qe,definition:u(nn),definitionDestinationString:f,definitionLabelString:f,definitionTitleString:f,emphasis:u(wr),hardBreakEscape:u(ar),hardBreakTrailing:u(ar),htmlFlow:u(tr,f),htmlFlowData:Qe,htmlText:u(tr,f),htmlTextData:Qe,image:u(Vn),label:f,link:u(xr),listItem:u(bi),listItemValue:P,listOrdered:u(ws,C),listUnordered:u(ws),paragraph:u(Ai),reference:ze,referenceString:f,resourceDestinationString:f,resourceTitleString:f,setextHeading:u(Xr),strong:u(ps),thematicBreak:u(Ts)},exit:{atxHeading:v(),atxHeadingSequence:de,autolink:v(),autolinkEmail:Vt,autolinkProtocol:bn,blockQuote:v(),characterEscapeValue:we,characterReferenceMarkerHexadecimal:Cn,characterReferenceMarkerNumeric:Cn,characterReferenceValue:fn,characterReference:Nn,codeFenced:v(q),codeFencedFence:U,codeFencedFenceInfo:L,codeFencedFenceMeta:F,codeFlowValue:we,codeIndented:v(G),codeText:v(Pt),codeTextData:we,data:we,definition:v(),definitionDestinationString:ie,definitionLabelString:$,definitionTitleString:X,emphasis:v(),hardBreakEscape:v(Je),hardBreakTrailing:v(Je),htmlFlow:v(ft),htmlFlowData:we,htmlText:v(Mt),htmlTextData:we,image:v(Kt),label:mt,labelText:tt,lineEnding:qe,link:v(Nt),listItem:v(),listOrdered:v(),listUnordered:v(),paragraph:v(),referenceString:$t,resourceDestinationString:Pe,resourceTitleString:gn,resource:Et,setextHeading:v(ve),setextHeadingLineSequence:be,setextHeadingText:fe,strong:v(),thematicBreak:v()}};ate(t,(e||{}).mdastExtensions||[]);const n={};return r;function r(tn){let kn={type:"root",children:[]};const Mr={stack:[kn],tokenStack:[],config:t,enter:s,exit:x,buffer:f,resume:A,data:n},wt=[];let Rn=-1;for(;++Rn<tn.length;)if(tn[Rn][1].type==="listOrdered"||tn[Rn][1].type==="listUnordered")if(tn[Rn][0]==="enter")wt.push(Rn);else{const nr=wt.pop();Rn=a(tn,nr,Rn)}for(Rn=-1;++Rn<tn.length;){const nr=t[tn[Rn][0]];ste.call(nr,tn[Rn][1].type)&&nr[tn[Rn][1].type].call(Object.assign({sliceSerialize:tn[Rn][2].sliceSerialize},Mr),tn[Rn][1])}if(Mr.tokenStack.length>0){const nr=Mr.tokenStack[Mr.tokenStack.length-1];(nr[1]||M$).call(Mr,void 0,nr[0])}for(kn.position={start:cm(tn.length>0?tn[0][1].start:{line:1,column:1,offset:0}),end:cm(tn.length>0?tn[tn.length-2][1].end:{line:1,column:1,offset:0})},Rn=-1;++Rn<t.transforms.length;)kn=t.transforms[Rn](kn)||kn;return kn}function a(tn,kn,Mr){let wt=kn-1,Rn=-1,nr=!1,dt,Jn,qr,ts;for(;++wt<=Mr;){const ms=tn[wt];switch(ms[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{ms[0]==="enter"?Rn++:Rn--,ts=void 0;break}case"lineEndingBlank":{ms[0]==="enter"&&(dt&&!ts&&!Rn&&!qr&&(qr=wt),ts=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:ts=void 0}if(!Rn&&ms[0]==="enter"&&ms[1].type==="listItemPrefix"||Rn===-1&&ms[0]==="exit"&&(ms[1].type==="listUnordered"||ms[1].type==="listOrdered")){if(dt){let Mn=wt;for(Jn=void 0;Mn--;){const Tt=tn[Mn];if(Tt[1].type==="lineEnding"||Tt[1].type==="lineEndingBlank"){if(Tt[0]==="exit")continue;Jn&&(tn[Jn][1].type="lineEndingBlank",nr=!0),Tt[1].type="lineEnding",Jn=Mn}else if(!(Tt[1].type==="linePrefix"||Tt[1].type==="blockQuotePrefix"||Tt[1].type==="blockQuotePrefixWhitespace"||Tt[1].type==="blockQuoteMarker"||Tt[1].type==="listItemIndent"))break}qr&&(!Jn||qr<Jn)&&(dt._spread=!0),dt.end=Object.assign({},Jn?tn[Jn][1].start:ms[1].end),tn.splice(Jn||wt,0,["exit",dt,ms[2]]),wt++,Mr++}if(ms[1].type==="listItemPrefix"){const Mn={type:"listItem",_spread:!1,start:Object.assign({},ms[1].start),end:void 0};dt=Mn,tn.splice(wt,0,["enter",Mn,ms[2]]),wt++,Mr++,qr=void 0,ts=!0}}}return tn[kn][1]._spread=nr,Mr}function u(tn,kn){return Mr;function Mr(wt){s.call(this,tn(wt),wt),kn&&kn.call(this,wt)}}function f(){this.stack.push({type:"fragment",children:[]})}function s(tn,kn,Mr){this.stack[this.stack.length-1].children.push(tn),this.stack.push(tn),this.tokenStack.push([kn,Mr||void 0]),tn.position={start:cm(kn.start),end:void 0}}function v(tn){return kn;function kn(Mr){tn&&tn.call(this,Mr),x.call(this,Mr)}}function x(tn,kn){const Mr=this.stack.pop(),wt=this.tokenStack.pop();if(wt)wt[0].type!==tn.type&&(kn?kn.call(this,tn,wt[0]):(wt[1]||M$).call(this,tn,wt[0]));else throw new Error("Cannot close `"+tn.type+"` ("+p2({start:tn.start,end:tn.end})+"): its not open");Mr.position.end=cm(tn.end)}function A(){return mD(this.stack.pop())}function C(){this.data.expectingFirstListItemValue=!0}function P(tn){if(this.data.expectingFirstListItemValue){const kn=this.stack[this.stack.length-2];kn.start=Number.parseInt(this.sliceSerialize(tn),10),this.data.expectingFirstListItemValue=void 0}}function L(){const tn=this.resume(),kn=this.stack[this.stack.length-1];kn.lang=tn}function F(){const tn=this.resume(),kn=this.stack[this.stack.length-1];kn.meta=tn}function U(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function q(){const tn=this.resume(),kn=this.stack[this.stack.length-1];kn.value=tn.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function G(){const tn=this.resume(),kn=this.stack[this.stack.length-1];kn.value=tn.replace(/(\r?\n|\r)$/g,"")}function $(tn){const kn=this.resume(),Mr=this.stack[this.stack.length-1];Mr.label=kn,Mr.identifier=ih(this.sliceSerialize(tn)).toLowerCase()}function X(){const tn=this.resume(),kn=this.stack[this.stack.length-1];kn.title=tn}function ie(){const tn=this.resume(),kn=this.stack[this.stack.length-1];kn.url=tn}function de(tn){const kn=this.stack[this.stack.length-1];if(!kn.depth){const Mr=this.sliceSerialize(tn).length;kn.depth=Mr}}function fe(){this.data.setextHeadingSlurpLineEnding=!0}function be(tn){const kn=this.stack[this.stack.length-1];kn.depth=this.sliceSerialize(tn).codePointAt(0)===61?1:2}function ve(){this.data.setextHeadingSlurpLineEnding=void 0}function Qe(tn){const Mr=this.stack[this.stack.length-1].children;let wt=Mr[Mr.length-1];(!wt||wt.type!=="text")&&(wt=$i(),wt.position={start:cm(tn.start),end:void 0},Mr.push(wt)),this.stack.push(wt)}function we(tn){const kn=this.stack.pop();kn.value+=this.sliceSerialize(tn),kn.position.end=cm(tn.end)}function qe(tn){const kn=this.stack[this.stack.length-1];if(this.data.atHardBreak){const Mr=kn.children[kn.children.length-1];Mr.position.end=cm(tn.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(kn.type)&&(Qe.call(this,tn),we.call(this,tn))}function Je(){this.data.atHardBreak=!0}function ft(){const tn=this.resume(),kn=this.stack[this.stack.length-1];kn.value=tn}function Mt(){const tn=this.resume(),kn=this.stack[this.stack.length-1];kn.value=tn}function Pt(){const tn=this.resume(),kn=this.stack[this.stack.length-1];kn.value=tn}function Nt(){const tn=this.stack[this.stack.length-1];if(this.data.inReference){const kn=this.data.referenceType||"shortcut";tn.type+="Reference",tn.referenceType=kn,delete tn.url,delete tn.title}else delete tn.identifier,delete tn.label;this.data.referenceType=void 0}function Kt(){const tn=this.stack[this.stack.length-1];if(this.data.inReference){const kn=this.data.referenceType||"shortcut";tn.type+="Reference",tn.referenceType=kn,delete tn.url,delete tn.title}else delete tn.identifier,delete tn.label;this.data.referenceType=void 0}function tt(tn){const kn=this.sliceSerialize(tn),Mr=this.stack[this.stack.length-2];Mr.label=j4e(kn),Mr.identifier=ih(kn).toLowerCase()}function mt(){const tn=this.stack[this.stack.length-1],kn=this.resume(),Mr=this.stack[this.stack.length-1];if(this.data.inReference=!0,Mr.type==="link"){const wt=tn.children;Mr.children=wt}else Mr.alt=kn}function Pe(){const tn=this.resume(),kn=this.stack[this.stack.length-1];kn.url=tn}function gn(){const tn=this.resume(),kn=this.stack[this.stack.length-1];kn.title=tn}function Et(){this.data.inReference=void 0}function ze(){this.data.referenceType="collapsed"}function $t(tn){const kn=this.resume(),Mr=this.stack[this.stack.length-1];Mr.label=kn,Mr.identifier=ih(this.sliceSerialize(tn)).toLowerCase(),this.data.referenceType="full"}function Cn(tn){this.data.characterReferenceType=tn.type}function fn(tn){const kn=this.sliceSerialize(tn),Mr=this.data.characterReferenceType;let wt;Mr?(wt=Eee(kn,Mr==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):wt=XO(kn);const Rn=this.stack[this.stack.length-1];Rn.value+=wt}function Nn(tn){const kn=this.stack.pop();kn.position.end=cm(tn.end)}function bn(tn){we.call(this,tn);const kn=this.stack[this.stack.length-1];kn.url=this.sliceSerialize(tn)}function Vt(tn){we.call(this,tn);const kn=this.stack[this.stack.length-1];kn.url="mailto:"+this.sliceSerialize(tn)}function En(){return{type:"blockquote",children:[]}}function Sn(){return{type:"code",lang:null,meta:null,value:""}}function Un(){return{type:"inlineCode",value:""}}function nn(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function wr(){return{type:"emphasis",children:[]}}function Xr(){return{type:"heading",depth:0,children:[]}}function ar(){return{type:"break"}}function tr(){return{type:"html",value:""}}function Vn(){return{type:"image",title:null,url:"",alt:null}}function xr(){return{type:"link",title:null,url:"",children:[]}}function ws(tn){return{type:"list",ordered:tn.type==="listOrdered",start:null,spread:tn._spread,children:[]}}function bi(tn){return{type:"listItem",spread:tn._spread,checked:null,children:[]}}function Ai(){return{type:"paragraph",children:[]}}function ps(){return{type:"strong",children:[]}}function $i(){return{type:"text",value:""}}function Ts(){return{type:"thematicBreak"}}}function cm(e){return{line:e.line,column:e.column,offset:e.offset}}function ate(e,t){let n=-1;for(;++n<t.length;){const r=t[n];Array.isArray(r)?ate(e,r):K6e(e,r)}}function K6e(e,t){let n;for(n in t)if(ste.call(t,n))switch(n){case"canContainEols":{const r=t[n];r&&e[n].push(...r);break}case"transforms":{const r=t[n];r&&e[n].push(...r);break}case"enter":case"exit":{const r=t[n];r&&Object.assign(e[n],r);break}}}function M$(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+p2({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+p2({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+p2({start:t.start,end:t.end})+") is still open")}function Q6e(e){const t=this;t.parser=n;function n(r){return X6e(r,{...t.data("settings"),...e,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}function J6e(e,t){const n={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(t),!0)};return e.patch(t,n),e.applyData(t,n)}function e5e(e,t){const n={type:"element",tagName:"br",properties:{},children:[]};return e.patch(t,n),[e.applyData(t,n),{type:"text",value:`
`}]}function t5e(e,t){const n=t.value?t.value+`
`:"",r={},a=t.lang?t.lang.split(/\s+/):[];a.length>0&&(r.className=["language-"+a[0]]);let u={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return t.meta&&(u.data={meta:t.meta}),e.patch(t,u),u=e.applyData(t,u),u={type:"element",tagName:"pre",properties:{},children:[u]},e.patch(t,u),u}function n5e(e,t){const n={type:"element",tagName:"del",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function r5e(e,t){const n={type:"element",tagName:"em",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function i5e(e,t){const n=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",r=String(t.identifier).toUpperCase(),a=_x(r.toLowerCase()),u=e.footnoteOrder.indexOf(r);let f,s=e.footnoteCounts.get(r);s===void 0?(s=0,e.footnoteOrder.push(r),f=e.footnoteOrder.length):f=u+1,s+=1,e.footnoteCounts.set(r,s);const v={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+a,id:n+"fnref-"+a+(s>1?"-"+s:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(f)}]};e.patch(t,v);const x={type:"element",tagName:"sup",properties:{},children:[v]};return e.patch(t,x),e.applyData(t,x)}function s5e(e,t){const n={type:"element",tagName:"h"+t.depth,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function a5e(e,t){if(e.options.allowDangerousHtml){const n={type:"raw",value:t.value};return e.patch(t,n),e.applyData(t,n)}}function ote(e,t){const n=t.referenceType;let r="]";if(n==="collapsed"?r+="[]":n==="full"&&(r+="["+(t.label||t.identifier)+"]"),t.type==="imageReference")return[{type:"text",value:"!["+t.alt+r}];const a=e.all(t),u=a[0];u&&u.type==="text"?u.value="["+u.value:a.unshift({type:"text",value:"["});const f=a[a.length-1];return f&&f.type==="text"?f.value+=r:a.push({type:"text",value:r}),a}function o5e(e,t){const n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n);if(!r)return ote(e,t);const a={src:_x(r.url||""),alt:t.alt};r.title!==null&&r.title!==void 0&&(a.title=r.title);const u={type:"element",tagName:"img",properties:a,children:[]};return e.patch(t,u),e.applyData(t,u)}function l5e(e,t){const n={src:_x(t.url)};t.alt!==null&&t.alt!==void 0&&(n.alt=t.alt),t.title!==null&&t.title!==void 0&&(n.title=t.title);const r={type:"element",tagName:"img",properties:n,children:[]};return e.patch(t,r),e.applyData(t,r)}function u5e(e,t){const n={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};e.patch(t,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return e.patch(t,r),e.applyData(t,r)}function c5e(e,t){const n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n);if(!r)return ote(e,t);const a={href:_x(r.url||"")};r.title!==null&&r.title!==void 0&&(a.title=r.title);const u={type:"element",tagName:"a",properties:a,children:e.all(t)};return e.patch(t,u),e.applyData(t,u)}function d5e(e,t){const n={href:_x(t.url)};t.title!==null&&t.title!==void 0&&(n.title=t.title);const r={type:"element",tagName:"a",properties:n,children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function h5e(e,t,n){const r=e.all(t),a=n?f5e(n):lte(t),u={},f=[];if(typeof t.checked=="boolean"){const A=r[0];let C;A&&A.type==="element"&&A.tagName==="p"?C=A:(C={type:"element",tagName:"p",properties:{},children:[]},r.unshift(C)),C.children.length>0&&C.children.unshift({type:"text",value:" "}),C.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),u.className=["task-list-item"]}let s=-1;for(;++s<r.length;){const A=r[s];(a||s!==0||A.type!=="element"||A.tagName!=="p")&&f.push({type:"text",value:`
`}),A.type==="element"&&A.tagName==="p"&&!a?f.push(...A.children):f.push(A)}const v=r[r.length-1];v&&(a||v.type!=="element"||v.tagName!=="p")&&f.push({type:"text",value:`
`});const x={type:"element",tagName:"li",properties:u,children:f};return e.patch(t,x),e.applyData(t,x)}function f5e(e){let t=!1;if(e.type==="list"){t=e.spread||!1;const n=e.children;let r=-1;for(;!t&&++r<n.length;)t=lte(n[r])}return t}function lte(e){const t=e.spread;return t??e.children.length>1}function p5e(e,t){const n={},r=e.all(t);let a=-1;for(typeof t.start=="number"&&t.start!==1&&(n.start=t.start);++a<r.length;){const f=r[a];if(f.type==="element"&&f.tagName==="li"&&f.properties&&Array.isArray(f.properties.className)&&f.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const u={type:"element",tagName:t.ordered?"ol":"ul",properties:n,children:e.wrap(r,!0)};return e.patch(t,u),e.applyData(t,u)}function m5e(e,t){const n={type:"element",tagName:"p",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function g5e(e,t){const n={type:"root",children:e.wrap(e.all(t))};return e.patch(t,n),e.applyData(t,n)}function _5e(e,t){const n={type:"element",tagName:"strong",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function y5e(e,t){const n=e.all(t),r=n.shift(),a=[];if(r){const f={type:"element",tagName:"thead",properties:{},children:e.wrap([r],!0)};e.patch(t.children[0],f),a.push(f)}if(n.length>0){const f={type:"element",tagName:"tbody",properties:{},children:e.wrap(n,!0)},s=gf(t.children[1]),v=yk(t.children[t.children.length-1]);s&&v&&(f.position={start:s,end:v}),a.push(f)}const u={type:"element",tagName:"table",properties:{},children:e.wrap(a,!0)};return e.patch(t,u),e.applyData(t,u)}function v5e(e,t,n){const r=n?n.children:void 0,u=(r?r.indexOf(t):1)===0?"th":"td",f=n&&n.type==="table"?n.align:void 0,s=f?f.length:t.children.length;let v=-1;const x=[];for(;++v<s;){const C=t.children[v],P={},L=f?f[v]:void 0;L&&(P.align=L);let F={type:"element",tagName:u,properties:P,children:[]};C&&(F.children=e.all(C),e.patch(C,F),F=e.applyData(C,F)),x.push(F)}const A={type:"element",tagName:"tr",properties:{},children:e.wrap(x,!0)};return e.patch(t,A),e.applyData(t,A)}function x5e(e,t){const n={type:"element",tagName:"td",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function b5e(e,t){const n={type:"text",value:Fde(String(t.value))};return e.patch(t,n),e.applyData(t,n)}function w5e(e,t){const n={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(t,n),e.applyData(t,n)}const T5e={blockquote:J6e,break:e5e,code:t5e,delete:n5e,emphasis:r5e,footnoteReference:i5e,heading:s5e,html:a5e,imageReference:o5e,image:l5e,inlineCode:u5e,linkReference:c5e,link:d5e,listItem:h5e,list:p5e,paragraph:m5e,root:g5e,strong:_5e,table:y5e,tableCell:x5e,tableRow:v5e,text:b5e,thematicBreak:w5e,toml:D3,yaml:D3,definition:D3,footnoteDefinition:D3};function D3(){}function E5e(e,t){const n=[{type:"text",value:""}];return t>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),n}function S5e(e,t){return"Back to reference "+(e+1)+(t>1?"-"+t:"")}function A5e(e){const t=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",n=e.options.footnoteBackContent||E5e,r=e.options.footnoteBackLabel||S5e,a=e.options.footnoteLabel||"Footnotes",u=e.options.footnoteLabelTagName||"h2",f=e.options.footnoteLabelProperties||{className:["sr-only"]},s=[];let v=-1;for(;++v<e.footnoteOrder.length;){const x=e.footnoteById.get(e.footnoteOrder[v]);if(!x)continue;const A=e.all(x),C=String(x.identifier).toUpperCase(),P=_x(C.toLowerCase());let L=0;const F=[],U=e.footnoteCounts.get(C);for(;U!==void 0&&++L<=U;){F.length>0&&F.push({type:"text",value:" "});let $=typeof n=="string"?n:n(v,L);typeof $=="string"&&($={type:"text",value:$}),F.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+P+(L>1?"-"+L:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(v,L),className:["data-footnote-backref"]},children:Array.isArray($)?$:[$]})}const q=A[A.length-1];if(q&&q.type==="element"&&q.tagName==="p"){const $=q.children[q.children.length-1];$&&$.type==="text"?$.value+=" ":q.children.push({type:"text",value:" "}),q.children.push(...F)}else A.push(...F);const G={type:"element",tagName:"li",properties:{id:t+"fn-"+P},children:e.wrap(A,!0)};e.patch(x,G),s.push(G)}if(s.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:u,properties:{...h_(f),id:"footnote-label"},children:[{type:"text",value:a}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:e.wrap(s,!0)},{type:"text",value:`
`}]}}function C5e(e,t,n,r){let a,u,f;typeof t=="function"&&typeof n!="function"?(u=void 0,f=t,a=n):(u=t,f=n,a=r),ox(e,u,s,a);function s(v,x){const A=x[x.length-1],C=A?A.children.indexOf(v):void 0;return f(v,C,A)}}const E8={}.hasOwnProperty,k5e={};function I5e(e,t){const n=t||k5e,r=new Map,a=new Map,u=new Map,f={...T5e,...n.handlers},s={all:x,applyData:M5e,definitionById:r,footnoteById:a,footnoteCounts:u,footnoteOrder:[],handlers:f,one:v,options:n,patch:R5e,wrap:O5e};return C5e(e,function(A){if(A.type==="definition"||A.type==="footnoteDefinition"){const C=A.type==="definition"?r:a,P=String(A.identifier).toUpperCase();C.has(P)||C.set(P,A)}}),s;function v(A,C){const P=A.type,L=s.handlers[P];if(E8.call(s.handlers,P)&&L)return L(s,A,C);if(s.options.passThrough&&s.options.passThrough.includes(P)){if("children"in A){const{children:U,...q}=A,G=h_(q);return G.children=s.all(A),G}return h_(A)}return(s.options.unknownHandler||P5e)(s,A,C)}function x(A){const C=[];if("children"in A){const P=A.children;let L=-1;for(;++L<P.length;){const F=s.one(P[L],A);if(F){if(L&&P[L-1].type==="break"&&(!Array.isArray(F)&&F.type==="text"&&(F.value=P$(F.value)),!Array.isArray(F)&&F.type==="element")){const U=F.children[0];U&&U.type==="text"&&(U.value=P$(U.value))}Array.isArray(F)?C.push(...F):C.push(F)}}}return C}}function R5e(e,t){e.position&&(t.position=qJ(e))}function M5e(e,t){let n=t;if(e&&e.data){const r=e.data.hName,a=e.data.hChildren,u=e.data.hProperties;if(typeof r=="string")if(n.type==="element")n.tagName=r;else{const f="children"in n?n.children:[n];n={type:"element",tagName:r,properties:{},children:f}}n.type==="element"&&u&&Object.assign(n.properties,h_(u)),"children"in n&&n.children&&a!==null&&a!==void 0&&(n.children=a)}return n}function P5e(e,t){const n=t.data||{},r="value"in t&&!(E8.call(n,"hProperties")||E8.call(n,"hChildren"))?{type:"text",value:t.value}:{type:"element",tagName:"div",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function O5e(e,t){const n=[];let r=-1;for(t&&n.push({type:"text",value:`
`});++r<e.length;)r&&n.push({type:"text",value:`
`}),n.push(e[r]);return t&&e.length>0&&n.push({type:"text",value:`
`}),n}function P$(e){let t=0,n=e.charCodeAt(t);for(;n===9||n===32;)t++,n=e.charCodeAt(t);return e.slice(t)}function O$(e,t){const n=I5e(e,t),r=n.one(e,void 0),a=A5e(n),u=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return a&&u.children.push({type:"text",value:`
`},a),u}function L5e(e,t){return e&&"run"in e?async function(n,r){const a=O$(n,{file:r,...t});await e.run(a,r)}:function(n,r){return O$(n,{file:r,...e||t})}}const Uh={basename:D5e,dirname:N5e,extname:z5e,join:F5e,sep:"/"};function D5e(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');VT(e);let n=0,r=-1,a=e.length,u;if(t===void 0||t.length===0||t.length>e.length){for(;a--;)if(e.codePointAt(a)===47){if(u){n=a+1;break}}else r<0&&(u=!0,r=a+1);return r<0?"":e.slice(n,r)}if(t===e)return"";let f=-1,s=t.length-1;for(;a--;)if(e.codePointAt(a)===47){if(u){n=a+1;break}}else f<0&&(u=!0,f=a+1),s>-1&&(e.codePointAt(a)===t.codePointAt(s--)?s<0&&(r=a):(s=-1,r=f));return n===r?r=f:r<0&&(r=e.length),e.slice(n,r)}function N5e(e){if(VT(e),e.length===0)return".";let t=-1,n=e.length,r;for(;--n;)if(e.codePointAt(n)===47){if(r){t=n;break}}else r||(r=!0);return t<0?e.codePointAt(0)===47?"/":".":t===1&&e.codePointAt(0)===47?"//":e.slice(0,t)}function z5e(e){VT(e);let t=e.length,n=-1,r=0,a=-1,u=0,f;for(;t--;){const s=e.codePointAt(t);if(s===47){if(f){r=t+1;break}continue}n<0&&(f=!0,n=t+1),s===46?a<0?a=t:u!==1&&(u=1):a>-1&&(u=-1)}return a<0||n<0||u===0||u===1&&a===n-1&&a===r+1?"":e.slice(a,n)}function F5e(...e){let t=-1,n;for(;++t<e.length;)VT(e[t]),e[t]&&(n=n===void 0?e[t]:n+"/"+e[t]);return n===void 0?".":B5e(n)}function B5e(e){VT(e);const t=e.codePointAt(0)===47;let n=j5e(e,!t);return n.length===0&&!t&&(n="."),n.length>0&&e.codePointAt(e.length-1)===47&&(n+="/"),t?"/"+n:n}function j5e(e,t){let n="",r=0,a=-1,u=0,f=-1,s,v;for(;++f<=e.length;){if(f<e.length)s=e.codePointAt(f);else{if(s===47)break;s=47}if(s===47){if(!(a===f-1||u===1))if(a!==f-1&&u===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(v=n.lastIndexOf("/"),v!==n.length-1){v<0?(n="",r=0):(n=n.slice(0,v),r=n.length-1-n.lastIndexOf("/")),a=f,u=0;continue}}else if(n.length>0){n="",r=0,a=f,u=0;continue}}t&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+e.slice(a+1,f):n=e.slice(a+1,f),r=f-a-1;a=f,u=0}else s===46&&u>-1?u++:u=-1}return n}function VT(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const U5e={cwd:V5e};function V5e(){return"/"}function S8(e){return!!(e!==null&&typeof e=="object"&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&e.auth===void 0)}function $5e(e){if(typeof e=="string")e=new URL(e);else if(!S8(e)){const t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if(e.protocol!=="file:"){const t=new TypeError("The URL must be of scheme file");throw t.code="ERR_INVALID_URL_SCHEME",t}return H5e(e)}function H5e(e){if(e.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const t=e.pathname;let n=-1;for(;++n<t.length;)if(t.codePointAt(n)===37&&t.codePointAt(n+1)===50){const r=t.codePointAt(n+2);if(r===70||r===102){const a=new TypeError("File URL path must not include encoded / characters");throw a.code="ERR_INVALID_FILE_URL_PATH",a}}return decodeURIComponent(t)}const oR=["history","path","basename","stem","extname","dirname"];class G5e{constructor(t){let n;t?S8(t)?n={path:t}:typeof t=="string"||q5e(t)?n={value:t}:n=t:n={},this.cwd="cwd"in n?"":U5e.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<oR.length;){const u=oR[r];u in n&&n[u]!==void 0&&n[u]!==null&&(this[u]=u==="history"?[...n[u]]:n[u])}let a;for(a in n)oR.includes(a)||(this[a]=n[a])}get basename(){return typeof this.path=="string"?Uh.basename(this.path):void 0}set basename(t){uR(t,"basename"),lR(t,"basename"),this.path=Uh.join(this.dirname||"",t)}get dirname(){return typeof this.path=="string"?Uh.dirname(this.path):void 0}set dirname(t){L$(this.basename,"dirname"),this.path=Uh.join(t||"",this.basename)}get extname(){return typeof this.path=="string"?Uh.extname(this.path):void 0}set extname(t){if(lR(t,"extname"),L$(this.dirname,"extname"),t){if(t.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(t.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Uh.join(this.dirname,this.stem+(t||""))}get path(){return this.history[this.history.length-1]}set path(t){S8(t)&&(t=$5e(t)),uR(t,"path"),this.path!==t&&this.history.push(t)}get stem(){return typeof this.path=="string"?Uh.basename(this.path,this.extname):void 0}set stem(t){uR(t,"stem"),lR(t,"stem"),this.path=Uh.join(this.dirname||"",t+(this.extname||""))}fail(t,n,r){const a=this.message(t,n,r);throw a.fatal=!0,a}info(t,n,r){const a=this.message(t,n,r);return a.fatal=void 0,a}message(t,n,r){const a=new au(t,n,r);return this.path&&(a.name=this.path+":"+a.name,a.file=this.path),a.fatal=!1,this.messages.push(a),a}toString(t){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(t||void 0).decode(this.value)}}function lR(e,t){if(e&&e.includes(Uh.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+Uh.sep+"`")}function uR(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function L$(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}function q5e(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const W5e=function(e){const r=this.constructor.prototype,a=r[e],u=function(){return a.apply(u,arguments)};return Object.setPrototypeOf(u,r),u},Z5e={}.hasOwnProperty;class SD extends W5e{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=Nde()}copy(){const t=new SD;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];t.use(...r)}return t.data(l5(!0,{},this.namespace)),t}data(t,n){return typeof t=="string"?arguments.length===2?(hR("data",this.frozen),this.namespace[t]=n,this):Z5e.call(this.namespace,t)&&this.namespace[t]||void 0:t?(hR("data",this.frozen),this.namespace=t,this):this.namespace}freeze(){if(this.frozen)return this;const t=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const a=n.call(t,...r);typeof a=="function"&&this.transformers.use(a)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(t){this.freeze();const n=N3(t),r=this.parser||this.Parser;return cR("parse",r),r(String(n),n)}process(t,n){const r=this;return this.freeze(),cR("process",this.parser||this.Parser),dR("process",this.compiler||this.Compiler),n?a(void 0,n):new Promise(a);function a(u,f){const s=N3(t),v=r.parse(s);r.run(v,s,function(A,C,P){if(A||!C||!P)return x(A);const L=C,F=r.stringify(L,P);K5e(F)?P.value=F:P.result=F,x(A,P)});function x(A,C){A||!C?f(A):u?u(C):n(void 0,C)}}}processSync(t){let n=!1,r;return this.freeze(),cR("processSync",this.parser||this.Parser),dR("processSync",this.compiler||this.Compiler),this.process(t,a),N$("processSync","process",n),r;function a(u,f){n=!0,SB(u),r=f}}run(t,n,r){D$(t),this.freeze();const a=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?u(void 0,r):new Promise(u);function u(f,s){const v=N3(n);a.run(t,v,x);function x(A,C,P){const L=C||t;A?s(A):f?f(L):r(void 0,L,P)}}}runSync(t,n){let r=!1,a;return this.run(t,n,u),N$("runSync","run",r),a;function u(f,s){SB(f),a=s,r=!0}}stringify(t,n){this.freeze();const r=N3(n),a=this.compiler||this.Compiler;return dR("stringify",a),D$(t),a(t,r)}use(t,...n){const r=this.attachers,a=this.namespace;if(hR("use",this.frozen),t!=null)if(typeof t=="function")v(t,n);else if(typeof t=="object")Array.isArray(t)?s(t):f(t);else throw new TypeError("Expected usable value, not `"+t+"`");return this;function u(x){if(typeof x=="function")v(x,[]);else if(typeof x=="object")if(Array.isArray(x)){const[A,...C]=x;v(A,C)}else f(x);else throw new TypeError("Expected usable value, not `"+x+"`")}function f(x){if(!("plugins"in x)&&!("settings"in x))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");s(x.plugins),x.settings&&(a.settings=l5(!0,a.settings,x.settings))}function s(x){let A=-1;if(x!=null)if(Array.isArray(x))for(;++A<x.length;){const C=x[A];u(C)}else throw new TypeError("Expected a list of plugins, not `"+x+"`")}function v(x,A){let C=-1,P=-1;for(;++C<r.length;)if(r[C][0]===x){P=C;break}if(P===-1)r.push([x,...A]);else if(A.length>0){let[L,...F]=A;const U=r[P][1];HM(U)&&HM(L)&&(L=l5(!0,U,L)),r[P]=[x,L,...F]}}}}const X5e=new SD().freeze();function cR(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `parser`")}function dR(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `compiler`")}function hR(e,t){if(t)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function D$(e){if(!HM(e)||typeof e.type!="string")throw new TypeError("Expected node, got `"+e+"`")}function N$(e,t,n){if(!n)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}function N3(e){return Y5e(e)?e:new G5e(e)}function Y5e(e){return!!(e&&typeof e=="object"&&"message"in e&&"messages"in e)}function K5e(e){return typeof e=="string"||Q5e(e)}function Q5e(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}function AD(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var O_=AD();function ute(e){O_=e}var m2={exec:()=>null};function ka(e,t=""){let n=typeof e=="string"?e:e.source,r={replace:(a,u)=>{let f=typeof u=="string"?u:u.source;return f=f.replace(Su.caret,"$1"),n=n.replace(a,f),r},getRegex:()=>new RegExp(n,t)};return r}var J5e=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),Su={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>new RegExp(`^( {0,3}${e})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}#`),htmlBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}<(?:[a-z].*>|!--)`,"i")},eRe=/^(?:[ \t]*(?:\n|$))+/,tRe=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,nRe=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,$T=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,rRe=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,CD=/(?:[*+-]|\d{1,9}[.)])/,cte=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,dte=ka(cte).replace(/bull/g,CD).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),iRe=ka(cte).replace(/bull/g,CD).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),kD=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,sRe=/^[^\n]+/,ID=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,aRe=ka(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",ID).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),oRe=ka(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,CD).getRegex(),Tk="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",RD=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,lRe=ka("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",RD).replace("tag",Tk).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),hte=ka(kD).replace("hr",$T).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Tk).getRegex(),uRe=ka(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",hte).getRegex(),MD={blockquote:uRe,code:tRe,def:aRe,fences:nRe,heading:rRe,hr:$T,html:lRe,lheading:dte,list:oRe,newline:eRe,paragraph:hte,table:m2,text:sRe},z$=ka("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",$T).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Tk).getRegex(),cRe={...MD,lheading:iRe,table:z$,paragraph:ka(kD).replace("hr",$T).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",z$).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Tk).getRegex()},dRe={...MD,html:ka(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",RD).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:m2,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:ka(kD).replace("hr",$T).replace("heading",` *#{1,6} *[^
]`).replace("lheading",dte).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},hRe=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,fRe=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,fte=/^( {2,}|\\)\n(?!\s*$)/,pRe=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ek=/[\p{P}\p{S}]/u,PD=/[\s\p{P}\p{S}]/u,pte=/[^\s\p{P}\p{S}]/u,mRe=ka(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,PD).getRegex(),mte=/(?!~)[\p{P}\p{S}]/u,gRe=/(?!~)[\s\p{P}\p{S}]/u,_Re=/(?:[^\s\p{P}\p{S}]|~)/u,yRe=ka(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",J5e?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),gte=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,vRe=ka(gte,"u").replace(/punct/g,Ek).getRegex(),xRe=ka(gte,"u").replace(/punct/g,mte).getRegex(),_te="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",bRe=ka(_te,"gu").replace(/notPunctSpace/g,pte).replace(/punctSpace/g,PD).replace(/punct/g,Ek).getRegex(),wRe=ka(_te,"gu").replace(/notPunctSpace/g,_Re).replace(/punctSpace/g,gRe).replace(/punct/g,mte).getRegex(),TRe=ka("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,pte).replace(/punctSpace/g,PD).replace(/punct/g,Ek).getRegex(),ERe=ka(/\\(punct)/,"gu").replace(/punct/g,Ek).getRegex(),SRe=ka(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),ARe=ka(RD).replace("(?:-->|$)","-->").getRegex(),CRe=ka("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",ARe).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),hC=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,kRe=ka(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",hC).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),yte=ka(/^!?\[(label)\]\[(ref)\]/).replace("label",hC).replace("ref",ID).getRegex(),vte=ka(/^!?\[(ref)\](?:\[\])?/).replace("ref",ID).getRegex(),IRe=ka("reflink|nolink(?!\\()","g").replace("reflink",yte).replace("nolink",vte).getRegex(),F$=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,OD={_backpedal:m2,anyPunctuation:ERe,autolink:SRe,blockSkip:yRe,br:fte,code:fRe,del:m2,emStrongLDelim:vRe,emStrongRDelimAst:bRe,emStrongRDelimUnd:TRe,escape:hRe,link:kRe,nolink:vte,punctuation:mRe,reflink:yte,reflinkSearch:IRe,tag:CRe,text:pRe,url:m2},RRe={...OD,link:ka(/^!?\[(label)\]\((.*?)\)/).replace("label",hC).getRegex(),reflink:ka(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",hC).getRegex()},A8={...OD,emStrongRDelimAst:wRe,emStrongLDelim:xRe,url:ka(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",F$).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:ka(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",F$).getRegex()},MRe={...A8,br:ka(fte).replace("{2,}","*").getRegex(),text:ka(A8.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},z3={normal:MD,gfm:cRe,pedantic:dRe},kw={normal:OD,gfm:A8,breaks:MRe,pedantic:RRe},PRe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},B$=e=>PRe[e];function Fh(e,t){if(t){if(Su.escapeTest.test(e))return e.replace(Su.escapeReplace,B$)}else if(Su.escapeTestNoEncode.test(e))return e.replace(Su.escapeReplaceNoEncode,B$);return e}function j$(e){try{e=encodeURI(e).replace(Su.percentDecode,"%")}catch{return null}return e}function U$(e,t){var u;let n=e.replace(Su.findPipe,(f,s,v)=>{let x=!1,A=s;for(;--A>=0&&v[A]==="\\";)x=!x;return x?"|":" |"}),r=n.split(Su.splitPipe),a=0;if(r[0].trim()||r.shift(),r.length>0&&!((u=r.at(-1))!=null&&u.trim())&&r.pop(),t)if(r.length>t)r.splice(t);else for(;r.length<t;)r.push("");for(;a<r.length;a++)r[a]=r[a].trim().replace(Su.slashPipe,"|");return r}function Iw(e,t,n){let r=e.length;if(r===0)return"";let a=0;for(;a<r&&e.charAt(r-a-1)===t;)a++;return e.slice(0,r-a)}function ORe(e,t){if(e.indexOf(t[1])===-1)return-1;let n=0;for(let r=0;r<e.length;r++)if(e[r]==="\\")r++;else if(e[r]===t[0])n++;else if(e[r]===t[1]&&(n--,n<0))return r;return n>0?-2:-1}function V$(e,t,n,r,a){let u=t.href,f=t.title||null,s=e[1].replace(a.other.outputLinkReplace,"$1");r.state.inLink=!0;let v={type:e[0].charAt(0)==="!"?"image":"link",raw:n,href:u,title:f,text:s,tokens:r.inlineTokens(s)};return r.state.inLink=!1,v}function LRe(e,t,n){let r=e.match(n.other.indentCodeCompensation);if(r===null)return t;let a=r[1];return t.split(`
`).map(u=>{let f=u.match(n.other.beginningSpace);if(f===null)return u;let[s]=f;return s.length>=a.length?u.slice(a.length):u}).join(`
`)}var fC=class{constructor(e){yi(this,"options");yi(this,"rules");yi(this,"lexer");this.options=e||O_}space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let n=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Iw(n,`
`)}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let n=t[0],r=LRe(n,t[3]||"",this.rules);return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:r}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(this.rules.other.endingHash.test(n)){let r=Iw(n,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(n=r.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:Iw(t[0],`
`)}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let n=Iw(t[0],`
`).split(`
`),r="",a="",u=[];for(;n.length>0;){let f=!1,s=[],v;for(v=0;v<n.length;v++)if(this.rules.other.blockquoteStart.test(n[v]))s.push(n[v]),f=!0;else if(!f)s.push(n[v]);else break;n=n.slice(v);let x=s.join(`
`),A=x.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${x}`:x,a=a?`${a}
${A}`:A;let C=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(A,u,!0),this.lexer.state.top=C,n.length===0)break;let P=u.at(-1);if((P==null?void 0:P.type)==="code")break;if((P==null?void 0:P.type)==="blockquote"){let L=P,F=L.raw+`
`+n.join(`
`),U=this.blockquote(F);u[u.length-1]=U,r=r.substring(0,r.length-L.raw.length)+U.raw,a=a.substring(0,a.length-L.text.length)+U.text;break}else if((P==null?void 0:P.type)==="list"){let L=P,F=L.raw+`
`+n.join(`
`),U=this.list(F);u[u.length-1]=U,r=r.substring(0,r.length-P.raw.length)+U.raw,a=a.substring(0,a.length-L.raw.length)+U.raw,n=F.substring(u.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:u,text:a}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim(),r=n.length>1,a={type:"list",raw:"",ordered:r,start:r?+n.slice(0,-1):"",loose:!1,items:[]};n=r?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=r?n:"[*+-]");let u=this.rules.other.listItemRegex(n),f=!1;for(;e;){let v=!1,x="",A="";if(!(t=u.exec(e))||this.rules.block.hr.test(e))break;x=t[0],e=e.substring(x.length);let C=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,G=>" ".repeat(3*G.length)),P=e.split(`
`,1)[0],L=!C.trim(),F=0;if(this.options.pedantic?(F=2,A=C.trimStart()):L?F=t[1].length+1:(F=t[2].search(this.rules.other.nonSpaceChar),F=F>4?1:F,A=C.slice(F),F+=t[1].length),L&&this.rules.other.blankLine.test(P)&&(x+=P+`
`,e=e.substring(P.length+1),v=!0),!v){let G=this.rules.other.nextBulletRegex(F),$=this.rules.other.hrRegex(F),X=this.rules.other.fencesBeginRegex(F),ie=this.rules.other.headingBeginRegex(F),de=this.rules.other.htmlBeginRegex(F);for(;e;){let fe=e.split(`
`,1)[0],be;if(P=fe,this.options.pedantic?(P=P.replace(this.rules.other.listReplaceNesting,"  "),be=P):be=P.replace(this.rules.other.tabCharGlobal,"    "),X.test(P)||ie.test(P)||de.test(P)||G.test(P)||$.test(P))break;if(be.search(this.rules.other.nonSpaceChar)>=F||!P.trim())A+=`
`+be.slice(F);else{if(L||C.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||X.test(C)||ie.test(C)||$.test(C))break;A+=`
`+P}!L&&!P.trim()&&(L=!0),x+=fe+`
`,e=e.substring(fe.length+1),C=be.slice(F)}}a.loose||(f?a.loose=!0:this.rules.other.doubleBlankLine.test(x)&&(f=!0));let U=null,q;this.options.gfm&&(U=this.rules.other.listIsTask.exec(A),U&&(q=U[0]!=="[ ] ",A=A.replace(this.rules.other.listReplaceTask,""))),a.items.push({type:"list_item",raw:x,task:!!U,checked:q,loose:!1,text:A,tokens:[]}),a.raw+=x}let s=a.items.at(-1);if(s)s.raw=s.raw.trimEnd(),s.text=s.text.trimEnd();else return;a.raw=a.raw.trimEnd();for(let v=0;v<a.items.length;v++)if(this.lexer.state.top=!1,a.items[v].tokens=this.lexer.blockTokens(a.items[v].text,[]),!a.loose){let x=a.items[v].tokens.filter(C=>C.type==="space"),A=x.length>0&&x.some(C=>this.rules.other.anyLine.test(C.raw));a.loose=A}if(a.loose)for(let v=0;v<a.items.length;v++)a.items[v].loose=!0;return a}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let n=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:r,title:a}}}table(e){var f;let t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let n=U$(t[1]),r=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),a=(f=t[3])!=null&&f.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],u={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===r.length){for(let s of r)this.rules.other.tableAlignRight.test(s)?u.align.push("right"):this.rules.other.tableAlignCenter.test(s)?u.align.push("center"):this.rules.other.tableAlignLeft.test(s)?u.align.push("left"):u.align.push(null);for(let s=0;s<n.length;s++)u.header.push({text:n[s],tokens:this.lexer.inline(n[s]),header:!0,align:u.align[s]});for(let s of a)u.rows.push(U$(s,u.header.length).map((v,x)=>({text:v,tokens:this.lexer.inline(v),header:!1,align:u.align[x]})));return u}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let n=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let u=Iw(n.slice(0,-1),"\\");if((n.length-u.length)%2===0)return}else{let u=ORe(t[2],"()");if(u===-2)return;if(u>-1){let f=(t[0].indexOf("!")===0?5:4)+t[1].length+u;t[2]=t[2].substring(0,u),t[0]=t[0].substring(0,f).trim(),t[3]=""}}let r=t[2],a="";if(this.options.pedantic){let u=this.rules.other.pedanticHrefTitle.exec(r);u&&(r=u[1],a=u[3])}else a=t[3]?t[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?r=r.slice(1):r=r.slice(1,-1)),V$(t,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){let r=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=t[r.toLowerCase()];if(!a){let u=n[0].charAt(0);return{type:"text",raw:u,text:u}}return V$(n,a,n[0],this.lexer,this.rules)}}emStrong(e,t,n=""){let r=this.rules.inline.emStrongLDelim.exec(e);if(!(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!n||this.rules.inline.punctuation.exec(n))){let a=[...r[0]].length-1,u,f,s=a,v=0,x=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(x.lastIndex=0,t=t.slice(-1*e.length+a);(r=x.exec(t))!=null;){if(u=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!u)continue;if(f=[...u].length,r[3]||r[4]){s+=f;continue}else if((r[5]||r[6])&&a%3&&!((a+f)%3)){v+=f;continue}if(s-=f,s>0)continue;f=Math.min(f,f+s+v);let A=[...r[0]][0].length,C=e.slice(0,a+r.index+A+f);if(Math.min(a,f)%2){let L=C.slice(1,-1);return{type:"em",raw:C,text:L,tokens:this.lexer.inlineTokens(L)}}let P=C.slice(2,-2);return{type:"strong",raw:C,text:P,tokens:this.lexer.inlineTokens(P)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(n),a=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return r&&a&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:t[0],text:n}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){let t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let n,r;return t[2]==="@"?(n=t[1],r="mailto:"+n):(n=t[1],r=n),{type:"link",raw:t[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}url(e){var n;let t;if(t=this.rules.inline.url.exec(e)){let r,a;if(t[2]==="@")r=t[0],a="mailto:"+r;else{let u;do u=t[0],t[0]=((n=this.rules.inline._backpedal.exec(t[0]))==null?void 0:n[0])??"";while(u!==t[0]);r=t[0],t[1]==="www."?a="http://"+t[0]:a=t[0]}return{type:"link",raw:t[0],text:r,href:a,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let n=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:n}}}},sd=class C8{constructor(t){yi(this,"tokens");yi(this,"options");yi(this,"state");yi(this,"tokenizer");yi(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=t||O_,this.options.tokenizer=this.options.tokenizer||new fC,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:Su,block:z3.normal,inline:kw.normal};this.options.pedantic?(n.block=z3.pedantic,n.inline=kw.pedantic):this.options.gfm&&(n.block=z3.gfm,this.options.breaks?n.inline=kw.breaks:n.inline=kw.gfm),this.tokenizer.rules=n}static get rules(){return{block:z3,inline:kw}}static lex(t,n){return new C8(n).lex(t)}static lexInline(t,n){return new C8(n).inlineTokens(t)}lex(t){t=t.replace(Su.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let r=this.inlineQueue[n];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,n=[],r=!1){var a,u,f;for(this.options.pedantic&&(t=t.replace(Su.tabCharGlobal,"    ").replace(Su.spaceLine,""));t;){let s;if((u=(a=this.options.extensions)==null?void 0:a.block)!=null&&u.some(x=>(s=x.call({lexer:this},t,n))?(t=t.substring(s.raw.length),n.push(s),!0):!1))continue;if(s=this.tokenizer.space(t)){t=t.substring(s.raw.length);let x=n.at(-1);s.raw.length===1&&x!==void 0?x.raw+=`
`:n.push(s);continue}if(s=this.tokenizer.code(t)){t=t.substring(s.raw.length);let x=n.at(-1);(x==null?void 0:x.type)==="paragraph"||(x==null?void 0:x.type)==="text"?(x.raw+=(x.raw.endsWith(`
`)?"":`
`)+s.raw,x.text+=`
`+s.text,this.inlineQueue.at(-1).src=x.text):n.push(s);continue}if(s=this.tokenizer.fences(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.heading(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.hr(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.blockquote(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.list(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.html(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.def(t)){t=t.substring(s.raw.length);let x=n.at(-1);(x==null?void 0:x.type)==="paragraph"||(x==null?void 0:x.type)==="text"?(x.raw+=(x.raw.endsWith(`
`)?"":`
`)+s.raw,x.text+=`
`+s.raw,this.inlineQueue.at(-1).src=x.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title},n.push(s));continue}if(s=this.tokenizer.table(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.lheading(t)){t=t.substring(s.raw.length),n.push(s);continue}let v=t;if((f=this.options.extensions)!=null&&f.startBlock){let x=1/0,A=t.slice(1),C;this.options.extensions.startBlock.forEach(P=>{C=P.call({lexer:this},A),typeof C=="number"&&C>=0&&(x=Math.min(x,C))}),x<1/0&&x>=0&&(v=t.substring(0,x+1))}if(this.state.top&&(s=this.tokenizer.paragraph(v))){let x=n.at(-1);r&&(x==null?void 0:x.type)==="paragraph"?(x.raw+=(x.raw.endsWith(`
`)?"":`
`)+s.raw,x.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=x.text):n.push(s),r=v.length!==t.length,t=t.substring(s.raw.length);continue}if(s=this.tokenizer.text(t)){t=t.substring(s.raw.length);let x=n.at(-1);(x==null?void 0:x.type)==="text"?(x.raw+=(x.raw.endsWith(`
`)?"":`
`)+s.raw,x.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=x.text):n.push(s);continue}if(t){let x="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(x);break}else throw new Error(x)}}return this.state.top=!0,n}inline(t,n=[]){return this.inlineQueue.push({src:t,tokens:n}),n}inlineTokens(t,n=[]){var v,x,A,C,P;let r=t,a=null;if(this.tokens.links){let L=Object.keys(this.tokens.links);if(L.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)L.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,a.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let u;for(;(a=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)u=a[2]?a[2].length:0,r=r.slice(0,a.index+u)+"["+"a".repeat(a[0].length-u-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);r=((x=(v=this.options.hooks)==null?void 0:v.emStrongMask)==null?void 0:x.call({lexer:this},r))??r;let f=!1,s="";for(;t;){f||(s=""),f=!1;let L;if((C=(A=this.options.extensions)==null?void 0:A.inline)!=null&&C.some(U=>(L=U.call({lexer:this},t,n))?(t=t.substring(L.raw.length),n.push(L),!0):!1))continue;if(L=this.tokenizer.escape(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.tag(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.link(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(L.raw.length);let U=n.at(-1);L.type==="text"&&(U==null?void 0:U.type)==="text"?(U.raw+=L.raw,U.text+=L.text):n.push(L);continue}if(L=this.tokenizer.emStrong(t,r,s)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.codespan(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.br(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.del(t)){t=t.substring(L.raw.length),n.push(L);continue}if(L=this.tokenizer.autolink(t)){t=t.substring(L.raw.length),n.push(L);continue}if(!this.state.inLink&&(L=this.tokenizer.url(t))){t=t.substring(L.raw.length),n.push(L);continue}let F=t;if((P=this.options.extensions)!=null&&P.startInline){let U=1/0,q=t.slice(1),G;this.options.extensions.startInline.forEach($=>{G=$.call({lexer:this},q),typeof G=="number"&&G>=0&&(U=Math.min(U,G))}),U<1/0&&U>=0&&(F=t.substring(0,U+1))}if(L=this.tokenizer.inlineText(F)){t=t.substring(L.raw.length),L.raw.slice(-1)!=="_"&&(s=L.raw.slice(-1)),f=!0;let U=n.at(-1);(U==null?void 0:U.type)==="text"?(U.raw+=L.raw,U.text+=L.text):n.push(L);continue}if(t){let U="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(U);break}else throw new Error(U)}}return n}},pC=class{constructor(e){yi(this,"options");yi(this,"parser");this.options=e||O_}space(e){return""}code({text:e,lang:t,escaped:n}){var u;let r=(u=(t||"").match(Su.notSpaceStart))==null?void 0:u[0],a=e.replace(Su.endingNewline,"")+`
`;return r?'<pre><code class="language-'+Fh(r)+'">'+(n?a:Fh(a,!0))+`</code></pre>
`:"<pre><code>"+(n?a:Fh(a,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}def(e){return""}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){let t=e.ordered,n=e.start,r="";for(let f=0;f<e.items.length;f++){let s=e.items[f];r+=this.listitem(s)}let a=t?"ol":"ul",u=t&&n!==1?' start="'+n+'"':"";return"<"+a+u+`>
`+r+"</"+a+`>
`}listitem(e){var n;let t="";if(e.task){let r=this.checkbox({checked:!!e.checked});e.loose?((n=e.tokens[0])==null?void 0:n.type)==="paragraph"?(e.tokens[0].text=r+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=r+" "+Fh(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",n="";for(let a=0;a<e.header.length;a++)n+=this.tablecell(e.header[a]);t+=this.tablerow({text:n});let r="";for(let a=0;a<e.rows.length;a++){let u=e.rows[a];n="";for(let f=0;f<u.length;f++)n+=this.tablecell(u[f]);r+=this.tablerow({text:n})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+r+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${Fh(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){let r=this.parser.parseInline(n),a=j$(e);if(a===null)return r;e=a;let u='<a href="'+e+'"';return t&&(u+=' title="'+Fh(t)+'"'),u+=">"+r+"</a>",u}image({href:e,title:t,text:n,tokens:r}){r&&(n=this.parser.parseInline(r,this.parser.textRenderer));let a=j$(e);if(a===null)return Fh(n);e=a;let u=`<img src="${e}" alt="${n}"`;return t&&(u+=` title="${Fh(t)}"`),u+=">",u}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:Fh(e.text)}},LD=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}},th=class k8{constructor(t){yi(this,"options");yi(this,"renderer");yi(this,"textRenderer");this.options=t||O_,this.options.renderer=this.options.renderer||new pC,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new LD}static parse(t,n){return new k8(n).parse(t)}static parseInline(t,n){return new k8(n).parseInline(t)}parse(t,n=!0){var a,u;let r="";for(let f=0;f<t.length;f++){let s=t[f];if((u=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&u[s.type]){let x=s,A=this.options.extensions.renderers[x.type].call({parser:this},x);if(A!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(x.type)){r+=A||"";continue}}let v=s;switch(v.type){case"space":{r+=this.renderer.space(v);continue}case"hr":{r+=this.renderer.hr(v);continue}case"heading":{r+=this.renderer.heading(v);continue}case"code":{r+=this.renderer.code(v);continue}case"table":{r+=this.renderer.table(v);continue}case"blockquote":{r+=this.renderer.blockquote(v);continue}case"list":{r+=this.renderer.list(v);continue}case"html":{r+=this.renderer.html(v);continue}case"def":{r+=this.renderer.def(v);continue}case"paragraph":{r+=this.renderer.paragraph(v);continue}case"text":{let x=v,A=this.renderer.text(x);for(;f+1<t.length&&t[f+1].type==="text";)x=t[++f],A+=`
`+this.renderer.text(x);n?r+=this.renderer.paragraph({type:"paragraph",raw:A,text:A,tokens:[{type:"text",raw:A,text:A,escaped:!0}]}):r+=A;continue}default:{let x='Token with "'+v.type+'" type was not found.';if(this.options.silent)return console.error(x),"";throw new Error(x)}}}return r}parseInline(t,n=this.renderer){var a,u;let r="";for(let f=0;f<t.length;f++){let s=t[f];if((u=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&u[s.type]){let x=this.options.extensions.renderers[s.type].call({parser:this},s);if(x!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){r+=x||"";continue}}let v=s;switch(v.type){case"escape":{r+=n.text(v);break}case"html":{r+=n.html(v);break}case"link":{r+=n.link(v);break}case"image":{r+=n.image(v);break}case"strong":{r+=n.strong(v);break}case"em":{r+=n.em(v);break}case"codespan":{r+=n.codespan(v);break}case"br":{r+=n.br(v);break}case"del":{r+=n.del(v);break}case"text":{r+=n.text(v);break}default:{let x='Token with "'+v.type+'" type was not found.';if(this.options.silent)return console.error(x),"";throw new Error(x)}}}return r}},$3,Zw=($3=class{constructor(e){yi(this,"options");yi(this,"block");this.options=e||O_}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}emStrongMask(e){return e}provideLexer(){return this.block?sd.lex:sd.lexInline}provideParser(){return this.block?th.parse:th.parseInline}},yi($3,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),yi($3,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),$3),DRe=class{constructor(...e){yi(this,"defaults",AD());yi(this,"options",this.setOptions);yi(this,"parse",this.parseMarkdown(!0));yi(this,"parseInline",this.parseMarkdown(!1));yi(this,"Parser",th);yi(this,"Renderer",pC);yi(this,"TextRenderer",LD);yi(this,"Lexer",sd);yi(this,"Tokenizer",fC);yi(this,"Hooks",Zw);this.use(...e)}walkTokens(e,t){var r,a;let n=[];for(let u of e)switch(n=n.concat(t.call(this,u)),u.type){case"table":{let f=u;for(let s of f.header)n=n.concat(this.walkTokens(s.tokens,t));for(let s of f.rows)for(let v of s)n=n.concat(this.walkTokens(v.tokens,t));break}case"list":{let f=u;n=n.concat(this.walkTokens(f.items,t));break}default:{let f=u;(a=(r=this.defaults.extensions)==null?void 0:r.childTokens)!=null&&a[f.type]?this.defaults.extensions.childTokens[f.type].forEach(s=>{let v=f[s].flat(1/0);n=n.concat(this.walkTokens(v,t))}):f.tokens&&(n=n.concat(this.walkTokens(f.tokens,t)))}}return n}use(...e){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(n=>{let r={...n};if(r.async=this.defaults.async||r.async||!1,n.extensions&&(n.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){let u=t.renderers[a.name];u?t.renderers[a.name]=function(...f){let s=a.renderer.apply(this,f);return s===!1&&(s=u.apply(this,f)),s}:t.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let u=t[a.level];u?u.unshift(a.tokenizer):t[a.level]=[a.tokenizer],a.start&&(a.level==="block"?t.startBlock?t.startBlock.push(a.start):t.startBlock=[a.start]:a.level==="inline"&&(t.startInline?t.startInline.push(a.start):t.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(t.childTokens[a.name]=a.childTokens)}),r.extensions=t),n.renderer){let a=this.defaults.renderer||new pC(this.defaults);for(let u in n.renderer){if(!(u in a))throw new Error(`renderer '${u}' does not exist`);if(["options","parser"].includes(u))continue;let f=u,s=n.renderer[f],v=a[f];a[f]=(...x)=>{let A=s.apply(a,x);return A===!1&&(A=v.apply(a,x)),A||""}}r.renderer=a}if(n.tokenizer){let a=this.defaults.tokenizer||new fC(this.defaults);for(let u in n.tokenizer){if(!(u in a))throw new Error(`tokenizer '${u}' does not exist`);if(["options","rules","lexer"].includes(u))continue;let f=u,s=n.tokenizer[f],v=a[f];a[f]=(...x)=>{let A=s.apply(a,x);return A===!1&&(A=v.apply(a,x)),A}}r.tokenizer=a}if(n.hooks){let a=this.defaults.hooks||new Zw;for(let u in n.hooks){if(!(u in a))throw new Error(`hook '${u}' does not exist`);if(["options","block"].includes(u))continue;let f=u,s=n.hooks[f],v=a[f];Zw.passThroughHooks.has(u)?a[f]=x=>{if(this.defaults.async&&Zw.passThroughHooksRespectAsync.has(u))return(async()=>{let C=await s.call(a,x);return v.call(a,C)})();let A=s.call(a,x);return v.call(a,A)}:a[f]=(...x)=>{if(this.defaults.async)return(async()=>{let C=await s.apply(a,x);return C===!1&&(C=await v.apply(a,x)),C})();let A=s.apply(a,x);return A===!1&&(A=v.apply(a,x)),A}}r.hooks=a}if(n.walkTokens){let a=this.defaults.walkTokens,u=n.walkTokens;r.walkTokens=function(f){let s=[];return s.push(u.call(this,f)),a&&(s=s.concat(a.call(this,f))),s}}this.defaults={...this.defaults,...r}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return sd.lex(e,t??this.defaults)}parser(e,t){return th.parse(e,t??this.defaults)}parseMarkdown(e){return(t,n)=>{let r={...n},a={...this.defaults,...r},u=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&r.async===!1)return u(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return u(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return u(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(a.hooks&&(a.hooks.options=a,a.hooks.block=e),a.async)return(async()=>{let f=a.hooks?await a.hooks.preprocess(t):t,s=await(a.hooks?await a.hooks.provideLexer():e?sd.lex:sd.lexInline)(f,a),v=a.hooks?await a.hooks.processAllTokens(s):s;a.walkTokens&&await Promise.all(this.walkTokens(v,a.walkTokens));let x=await(a.hooks?await a.hooks.provideParser():e?th.parse:th.parseInline)(v,a);return a.hooks?await a.hooks.postprocess(x):x})().catch(u);try{a.hooks&&(t=a.hooks.preprocess(t));let f=(a.hooks?a.hooks.provideLexer():e?sd.lex:sd.lexInline)(t,a);a.hooks&&(f=a.hooks.processAllTokens(f)),a.walkTokens&&this.walkTokens(f,a.walkTokens);let s=(a.hooks?a.hooks.provideParser():e?th.parse:th.parseInline)(f,a);return a.hooks&&(s=a.hooks.postprocess(s)),s}catch(f){return u(f)}}}onError(e,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let r="<p>An error occurred:</p><pre>"+Fh(n.message+"",!0)+"</pre>";return t?Promise.resolve(r):r}if(t)return Promise.reject(n);throw n}}},p_=new DRe;function Ua(e,t){return p_.parse(e,t)}Ua.options=Ua.setOptions=function(e){return p_.setOptions(e),Ua.defaults=p_.defaults,ute(Ua.defaults),Ua};Ua.getDefaults=AD;Ua.defaults=O_;Ua.use=function(...e){return p_.use(...e),Ua.defaults=p_.defaults,ute(Ua.defaults),Ua};Ua.walkTokens=function(e,t){return p_.walkTokens(e,t)};Ua.parseInline=p_.parseInline;Ua.Parser=th;Ua.parser=th.parse;Ua.Renderer=pC;Ua.TextRenderer=LD;Ua.Lexer=sd;Ua.lexer=sd.lex;Ua.Tokenizer=fC;Ua.Hooks=Zw;Ua.parse=Ua;Ua.options;Ua.setOptions;Ua.use;Ua.walkTokens;Ua.parseInline;th.parse;sd.lex;var zs=(...e)=>uo(cL(e)),uv=(e,t,n)=>{let r=typeof t=="string"?new Blob([t],{type:n}):t,a=URL.createObjectURL(r),u=document.createElement("a");u.href=a,u.download=e,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(a)},NRe=B.createContext({code:""}),xte=()=>B.useContext(NRe),$$=({onCopy:e,onError:t,timeout:n=2e3,children:r,className:a,code:u,...f})=>{let[s,v]=B.useState(!1),x=B.useRef(0),{code:A}=xte(),{isAnimating:C}=B.useContext(uh),P=u??A,L=async()=>{var U;if(typeof window>"u"||!((U=navigator==null?void 0:navigator.clipboard)!=null&&U.writeText)){t==null||t(new Error("Clipboard API not available"));return}try{s||(await navigator.clipboard.writeText(P),v(!0),e==null||e(),x.current=window.setTimeout(()=>v(!1),n))}catch(q){t==null||t(q)}};B.useEffect(()=>()=>{window.clearTimeout(x.current)},[]);let F=s?Hee:Gee;return k.jsx("button",{className:zs("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",a),"data-streamdown":"code-block-copy-button",disabled:C,onClick:L,title:"Copy Code",type:"button",...f,children:r??k.jsx(F,{size:14})})},H$={"1c":"1c","1c-query":"1cq",abap:"abap","actionscript-3":"as",ada:"ada",adoc:"adoc","angular-html":"html","angular-ts":"ts",apache:"conf",apex:"cls",apl:"apl",applescript:"applescript",ara:"ara",asciidoc:"adoc",asm:"asm",astro:"astro",awk:"awk",ballerina:"bal",bash:"sh",bat:"bat",batch:"bat",be:"be",beancount:"beancount",berry:"berry",bibtex:"bib",bicep:"bicep",blade:"blade.php",bsl:"bsl",c:"c","c#":"cs","c++":"cpp",cadence:"cdc",cairo:"cairo",cdc:"cdc",clarity:"clar",clj:"clj",clojure:"clj","closure-templates":"soy",cmake:"cmake",cmd:"cmd",cobol:"cob",codeowners:"CODEOWNERS",codeql:"ql",coffee:"coffee",coffeescript:"coffee","common-lisp":"lisp",console:"sh",coq:"v",cpp:"cpp",cql:"cql",crystal:"cr",cs:"cs",csharp:"cs",css:"css",csv:"csv",cue:"cue",cypher:"cql",d:"d",dart:"dart",dax:"dax",desktop:"desktop",diff:"diff",docker:"dockerfile",dockerfile:"dockerfile",dotenv:"env","dream-maker":"dm",edge:"edge",elisp:"el",elixir:"ex",elm:"elm","emacs-lisp":"el",erb:"erb",erl:"erl",erlang:"erl",f:"f","f#":"fs",f03:"f03",f08:"f08",f18:"f18",f77:"f77",f90:"f90",f95:"f95",fennel:"fnl",fish:"fish",fluent:"ftl",for:"for","fortran-fixed-form":"f","fortran-free-form":"f90",fs:"fs",fsharp:"fs",fsl:"fsl",ftl:"ftl",gdresource:"tres",gdscript:"gd",gdshader:"gdshader",genie:"gs",gherkin:"feature","git-commit":"gitcommit","git-rebase":"gitrebase",gjs:"js",gleam:"gleam","glimmer-js":"js","glimmer-ts":"ts",glsl:"glsl",gnuplot:"plt",go:"go",gql:"gql",graphql:"graphql",groovy:"groovy",gts:"gts",hack:"hack",haml:"haml",handlebars:"hbs",haskell:"hs",haxe:"hx",hbs:"hbs",hcl:"hcl",hjson:"hjson",hlsl:"hlsl",hs:"hs",html:"html","html-derivative":"html",http:"http",hxml:"hxml",hy:"hy",imba:"imba",ini:"ini",jade:"jade",java:"java",javascript:"js",jinja:"jinja",jison:"jison",jl:"jl",js:"js",json:"json",json5:"json5",jsonc:"jsonc",jsonl:"jsonl",jsonnet:"jsonnet",jssm:"jssm",jsx:"jsx",julia:"jl",kotlin:"kt",kql:"kql",kt:"kt",kts:"kts",kusto:"kql",latex:"tex",lean:"lean",lean4:"lean",less:"less",liquid:"liquid",lisp:"lisp",lit:"lit",llvm:"ll",log:"log",logo:"logo",lua:"lua",luau:"luau",make:"mak",makefile:"mak",markdown:"md",marko:"marko",matlab:"m",md:"md",mdc:"mdc",mdx:"mdx",mediawiki:"wiki",mermaid:"mmd",mips:"s",mipsasm:"s",mmd:"mmd",mojo:"mojo",move:"move",nar:"nar",narrat:"narrat",nextflow:"nf",nf:"nf",nginx:"conf",nim:"nim",nix:"nix",nu:"nu",nushell:"nu",objc:"m","objective-c":"m","objective-cpp":"mm",ocaml:"ml",pascal:"pas",perl:"pl",perl6:"p6",php:"php",plsql:"pls",po:"po",polar:"polar",postcss:"pcss",pot:"pot",potx:"potx",powerquery:"pq",powershell:"ps1",prisma:"prisma",prolog:"pl",properties:"properties",proto:"proto",protobuf:"proto",ps:"ps",ps1:"ps1",pug:"pug",puppet:"pp",purescript:"purs",py:"py",python:"py",ql:"ql",qml:"qml",qmldir:"qmldir",qss:"qss",r:"r",racket:"rkt",raku:"raku",razor:"cshtml",rb:"rb",reg:"reg",regex:"regex",regexp:"regexp",rel:"rel",riscv:"s",rs:"rs",rst:"rst",ruby:"rb",rust:"rs",sas:"sas",sass:"sass",scala:"scala",scheme:"scm",scss:"scss",sdbl:"sdbl",sh:"sh",shader:"shader",shaderlab:"shader",shell:"sh",shellscript:"sh",shellsession:"sh",smalltalk:"st",solidity:"sol",soy:"soy",sparql:"rq",spl:"spl",splunk:"spl",sql:"sql","ssh-config":"config",stata:"do",styl:"styl",stylus:"styl",svelte:"svelte",swift:"swift","system-verilog":"sv",systemd:"service",talon:"talon",talonscript:"talon",tasl:"tasl",tcl:"tcl",templ:"templ",terraform:"tf",tex:"tex",tf:"tf",tfvars:"tfvars",toml:"toml",ts:"ts","ts-tags":"ts",tsp:"tsp",tsv:"tsv",tsx:"tsx",turtle:"ttl",twig:"twig",typ:"typ",typescript:"ts",typespec:"tsp",typst:"typ",v:"v",vala:"vala",vb:"vb",verilog:"v",vhdl:"vhdl",vim:"vim",viml:"vim",vimscript:"vim",vue:"vue","vue-html":"html","vue-vine":"vine",vy:"vy",vyper:"vy",wasm:"wasm",wenyan:"wy",wgsl:"wgsl",wiki:"wiki",wikitext:"wiki",wit:"wit",wl:"wl",wolfram:"wl",xml:"xml",xsl:"xsl",yaml:"yaml",yml:"yml",zenscript:"zs",zig:"zig",zsh:"zsh",:"wy"},zRe=({onDownload:e,onError:t,language:n,children:r,className:a,code:u,...f})=>{let{code:s}=xte(),{isAnimating:v}=B.useContext(uh),x=u??s,A=`file.${n&&n in H$?H$[n]:"txt"}`,C="text/plain",P=()=>{try{uv(A,x,C),e==null||e()}catch(L){t==null||t(L)}};return k.jsx("button",{className:zs("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",a),"data-streamdown":"code-block-download-button",disabled:v,onClick:P,title:"Download file",type:"button",...f,children:r??k.jsx(bk,{size:14})})},G$=()=>k.jsxs("div",{className:"w-full divide-y divide-border overflow-hidden rounded-xl border border-border",children:[k.jsx("div",{className:"h-[46px] w-full bg-muted/80"}),k.jsx("div",{className:"flex w-full items-center justify-center p-4",children:k.jsx(nIe,{className:"size-4 animate-spin"})})]}),FRe=/\.[^/.]+$/,BRe=({node:e,className:t,src:n,alt:r,...a})=>{let u=async()=>{if(n)try{let f=await(await fetch(n)).blob(),s=new URL(n,window.location.origin).pathname.split("/").pop()||"",v=s.split(".").pop(),x=s.includes(".")&&v!==void 0&&v.length<=4,A="";if(x)A=s;else{let C=f.type,P="png";C.includes("jpeg")||C.includes("jpg")?P="jpg":C.includes("png")?P="png":C.includes("svg")?P="svg":C.includes("gif")?P="gif":C.includes("webp")&&(P="webp"),A=`${(r||s||"image").replace(FRe,"")}.${P}`}uv(A,f,f.type)}catch(f){console.error("Failed to download image:",f)}};return n?k.jsxs("div",{className:"group relative my-4 inline-block","data-streamdown":"image-wrapper",children:[k.jsx("img",{alt:r,className:zs("max-w-full rounded-lg",t),"data-streamdown":"image",src:n,...a}),k.jsx("div",{className:"pointer-events-none absolute inset-0 hidden rounded-lg bg-black/10 group-hover:block"}),k.jsx("button",{className:zs("absolute right-2 bottom-2 flex h-8 w-8 cursor-pointer items-center justify-center rounded-md border border-border bg-background/90 shadow-sm backdrop-blur-sm transition-all duration-200 hover:bg-background","opacity-0 group-hover:opacity-100"),onClick:u,title:"Download image",type:"button",children:k.jsx(bk,{size:14})})]}):null},bte=async e=>{let t={startOnLoad:!1,theme:"default",securityLevel:"strict",fontFamily:"monospace",suppressErrorRendering:!0,...e},n=(await TT(async()=>{const{default:r}=await import("./mermaid.core-e-1cpZVP.js").then(a=>a.bA);return{default:r}},[])).default;return n.initialize(t),n},jRe=(e,t)=>{var n;let r=(n=void 0)!=null?n:5;return new Promise((a,u)=>{let f="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e))),s=new Image;s.crossOrigin="anonymous",s.onload=()=>{let v=document.createElement("canvas"),x=s.width*r,A=s.height*r;v.width=x,v.height=A;let C=v.getContext("2d");if(!C){u(new Error("Failed to create 2D canvas context for PNG export"));return}C.drawImage(s,0,0,x,A),v.toBlob(P=>{if(!P){u(new Error("Failed to create PNG blob"));return}a(P)},"image/png")},s.onerror=()=>u(new Error("Failed to load SVG image")),s.src=f})},URe=({chart:e,children:t,className:n,onDownload:r,config:a,onError:u})=>{let[f,s]=B.useState(!1),v=B.useRef(null),{isAnimating:x}=B.useContext(uh),A=async C=>{try{if(C==="mmd"){uv("diagram.mmd",e,"text/plain"),s(!1),r==null||r(C);return}let P=await bte(a),L=e.split("").reduce((q,G)=>(q<<5)-q+G.charCodeAt(0)|0,0),F=`mermaid-${Math.abs(L)}-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,{svg:U}=await P.render(F,e);if(!U){u==null||u(new Error("SVG not found. Please wait for the diagram to render."));return}if(C==="svg"){uv("diagram.svg",U,"image/svg+xml"),s(!1),r==null||r(C);return}if(C==="png"){let q=await jRe(U);uv("diagram.png",q,"image/png"),r==null||r(C),s(!1);return}}catch(P){u==null||u(P)}};return B.useEffect(()=>{let C=P=>{v.current&&!v.current.contains(P.target)&&s(!1)};return document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}},[]),k.jsxs("div",{className:"relative",ref:v,children:[k.jsx("button",{className:zs("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",n),disabled:x,onClick:()=>s(!f),title:"Download diagram",type:"button",children:t??k.jsx(bk,{size:14})}),f&&k.jsxs("div",{className:"absolute top-full right-0 z-10 mt-1 min-w-[120px] overflow-hidden rounded-md border border-border bg-background shadow-lg",children:[k.jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>A("svg"),title:"Download diagram as SVG",type:"button",children:"SVG"}),k.jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>A("png"),title:"Download diagram as PNG",type:"button",children:"PNG"}),k.jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>A("mmd"),title:"Download diagram as MMD",type:"button",children:"MMD"})]})]})},g2=0,VRe=()=>{g2+=1,g2===1&&(document.body.style.overflow="hidden")},$Re=()=>{g2=Math.max(0,g2-1),g2===0&&(document.body.style.overflow="")},HRe=({chart:e,config:t,onFullscreen:n,onExit:r,className:a,...u})=>{let[f,s]=B.useState(!1),{isAnimating:v,controls:x}=B.useContext(uh),A=(()=>{if(typeof x=="boolean")return x;let P=x.mermaid;return P===!1?!1:P===!0||P===void 0?!0:P.panZoom!==!1})(),C=()=>{s(!f)};return B.useEffect(()=>{if(f){VRe();let P=L=>{L.key==="Escape"&&s(!1)};return document.addEventListener("keydown",P),()=>{document.removeEventListener("keydown",P),$Re()}}},[f]),B.useEffect(()=>{f?n==null||n():r&&r()},[f,n,r]),k.jsxs(k.Fragment,{children:[k.jsx("button",{className:zs("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",a),disabled:v,onClick:C,title:"View fullscreen",type:"button",...u,children:k.jsx(iIe,{size:14})}),f&&k.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/95 backdrop-blur-sm",onClick:C,onKeyDown:P=>{P.key==="Escape"&&C()},role:"button",tabIndex:0,children:[k.jsx("button",{className:"absolute top-4 right-4 z-10 rounded-md p-2 text-muted-foreground transition-all hover:bg-muted hover:text-foreground",onClick:C,title:"Exit fullscreen",type:"button",children:k.jsx(lIe,{size:20})}),k.jsx("div",{className:"flex h-full w-full items-center justify-center p-4",onClick:P=>P.stopPropagation(),onKeyDown:P=>P.stopPropagation(),role:"presentation",children:k.jsx(Kte,{chart:e,className:"h-full w-full [&>div]:h-full [&>div]:overflow-hidden [&_svg]:h-auto [&_svg]:w-auto",config:t,fullscreen:!0,showControls:A})})]})]})},wte=e=>{var t,n;let r=[],a=[],u=e.querySelectorAll("thead th");for(let s of u)r.push(((t=s.textContent)==null?void 0:t.trim())||"");let f=e.querySelectorAll("tbody tr");for(let s of f){let v=[],x=s.querySelectorAll("td");for(let A of x)v.push(((n=A.textContent)==null?void 0:n.trim())||"");a.push(v)}return{headers:r,rows:a}},Tte=e=>{let{headers:t,rows:n}=e,r=s=>{let v=!1,x=!1;for(let A=0;A<s.length;A+=1){let C=s[A];if(C==='"'){v=!0,x=!0;break}(C===","||C===`
`)&&(v=!0)}return v?x?`"${s.replace(/"/g,'""')}"`:`"${s}"`:s},a=t.length>0?n.length+1:n.length,u=new Array(a),f=0;t.length>0&&(u[f]=t.map(r).join(","),f+=1);for(let s of n)u[f]=s.map(r).join(","),f+=1;return u.join(`
`)},GRe=e=>{let{headers:t,rows:n}=e,r=s=>{let v=!1;for(let A=0;A<s.length;A+=1){let C=s[A];if(C==="	"||C===`
`||C==="\r"){v=!0;break}}if(!v)return s;let x=[];for(let A=0;A<s.length;A+=1){let C=s[A];C==="	"?x.push("\\t"):C===`
`?x.push("\\n"):C==="\r"?x.push("\\r"):x.push(C)}return x.join("")},a=t.length>0?n.length+1:n.length,u=new Array(a),f=0;t.length>0&&(u[f]=t.map(r).join("	"),f+=1);for(let s of n)u[f]=s.map(r).join("	"),f+=1;return u.join(`
`)},fR=e=>{let t=!1;for(let r=0;r<e.length;r+=1){let a=e[r];if(a==="\\"||a==="|"){t=!0;break}}if(!t)return e;let n=[];for(let r=0;r<e.length;r+=1){let a=e[r];a==="\\"?n.push("\\\\"):a==="|"?n.push("\\|"):n.push(a)}return n.join("")},qRe=e=>{let{headers:t,rows:n}=e;if(t.length===0)return"";let r=new Array(n.length+2),a=0,u=t.map(s=>fR(s));r[a]=`| ${u.join(" | ")} |`,a+=1;let f=new Array(t.length);for(let s=0;s<t.length;s+=1)f[s]="---";r[a]=`| ${f.join(" | ")} |`,a+=1;for(let s of n)if(s.length<t.length){let v=new Array(t.length);for(let x=0;x<t.length;x+=1)v[x]=x<s.length?fR(s[x]):"";r[a]=`| ${v.join(" | ")} |`,a+=1}else{let v=s.map(x=>fR(x));r[a]=`| ${v.join(" | ")} |`,a+=1}return r.join(`
`)},WRe=({children:e,className:t,onCopy:n,onError:r,timeout:a=2e3})=>{let[u,f]=B.useState(!1),[s,v]=B.useState(!1),x=B.useRef(null),A=B.useRef(0),{isAnimating:C}=B.useContext(uh),P=async F=>{var U,q;if(typeof window>"u"||!((U=navigator==null?void 0:navigator.clipboard)!=null&&U.write)){r==null||r(new Error("Clipboard API not available"));return}try{let G=(q=x.current)==null?void 0:q.closest('[data-streamdown="table-wrapper"]'),$=G==null?void 0:G.querySelector("table");if(!$){r==null||r(new Error("Table not found"));return}let X=wte($),ie=F==="csv"?Tte(X):GRe(X),de=new ClipboardItem({"text/plain":new Blob([ie],{type:"text/plain"}),"text/html":new Blob([$.outerHTML],{type:"text/html"})});await navigator.clipboard.write([de]),v(!0),f(!1),n==null||n(F),A.current=window.setTimeout(()=>v(!1),a)}catch(G){r==null||r(G)}};B.useEffect(()=>{let F=U=>{x.current&&!x.current.contains(U.target)&&f(!1)};return document.addEventListener("mousedown",F),()=>{document.removeEventListener("mousedown",F),window.clearTimeout(A.current)}},[]);let L=s?Hee:Gee;return k.jsxs("div",{className:"relative",ref:x,children:[k.jsx("button",{className:zs("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",t),disabled:C,onClick:()=>f(!u),title:"Copy table",type:"button",children:e??k.jsx(L,{size:14})}),u&&k.jsxs("div",{className:"absolute top-full right-0 z-10 mt-1 min-w-[120px] overflow-hidden rounded-md border border-border bg-background shadow-lg",children:[k.jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>P("csv"),title:"Copy table as CSV",type:"button",children:"CSV"}),k.jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>P("tsv"),title:"Copy table as TSV",type:"button",children:"TSV"})]})]})},ZRe=({children:e,className:t,onDownload:n,onError:r})=>{let[a,u]=B.useState(!1),f=B.useRef(null),{isAnimating:s}=B.useContext(uh),v=x=>{var A;try{let C=(A=f.current)==null?void 0:A.closest('[data-streamdown="table-wrapper"]'),P=C==null?void 0:C.querySelector("table");if(!P){r==null||r(new Error("Table not found"));return}let L=wte(P),F=x==="csv"?Tte(L):qRe(L);uv(`table.${x==="csv"?"csv":"md"}`,F,x==="csv"?"text/csv":"text/markdown"),u(!1),n==null||n(x)}catch(C){r==null||r(C)}};return B.useEffect(()=>{let x=A=>{f.current&&!f.current.contains(A.target)&&u(!1)};return document.addEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}},[]),k.jsxs("div",{className:"relative",ref:f,children:[k.jsx("button",{className:zs("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",t),disabled:s,onClick:()=>u(!a),title:"Download table",type:"button",children:e??k.jsx(bk,{size:14})}),a&&k.jsxs("div",{className:"absolute top-full right-0 z-10 mt-1 min-w-[120px] overflow-hidden rounded-md border border-border bg-background shadow-lg",children:[k.jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>v("csv"),title:"Download table as CSV",type:"button",children:"CSV"}),k.jsx("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>v("markdown"),title:"Download table as Markdown",type:"button",children:"Markdown"})]})]})},XRe=({children:e,className:t,showControls:n,...r})=>k.jsxs("div",{className:"my-4 flex flex-col space-y-2","data-streamdown":"table-wrapper",children:[n&&k.jsxs("div",{className:"flex items-center justify-end gap-1",children:[k.jsx(WRe,{}),k.jsx(ZRe,{})]}),k.jsx("div",{className:"overflow-x-auto",children:k.jsx("table",{className:zs("w-full border-collapse border border-border",t),"data-streamdown":"table",...r,children:e})})]}),YRe=B.lazy(()=>TT(()=>import("./code-block-IT6T5CEO-Cg1lH77T.js"),[]).then(e=>({default:e.CodeBlock}))),KRe=B.lazy(()=>TT(()=>Promise.resolve().then(()=>DDe),void 0).then(e=>({default:e.Mermaid}))),QRe=/language-([^\s]+)/;function Sk(e,t){if(!(e!=null&&e.position||t!=null&&t.position))return!0;if(!(e!=null&&e.position&&t!=null&&t.position))return!1;let n=e.position.start,r=t.position.start,a=e.position.end,u=t.position.end;return(n==null?void 0:n.line)===(r==null?void 0:r.line)&&(n==null?void 0:n.column)===(r==null?void 0:r.column)&&(a==null?void 0:a.line)===(u==null?void 0:u.line)&&(a==null?void 0:a.column)===(u==null?void 0:u.column)}function Bo(e,t){return e.className===t.className&&Sk(e.node,t.node)}var I8=(e,t)=>typeof e=="boolean"?e:e[t]!==!1,F3=(e,t)=>{if(typeof e=="boolean")return e;let n=e.mermaid;return n===!1?!1:n===!0||n===void 0?!0:n[t]!==!1},DD=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("ol",{className:zs("list-inside list-decimal whitespace-normal",t),"data-streamdown":"ordered-list",...r,children:e}),(e,t)=>Bo(e,t));DD.displayName="MarkdownOl";var Ete=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("li",{className:zs("py-1 [&>p]:inline",t),"data-streamdown":"list-item",...r,children:e}),(e,t)=>e.className===t.className&&Sk(e.node,t.node));Ete.displayName="MarkdownLi";var Ste=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("ul",{className:zs("list-inside list-disc whitespace-normal",t),"data-streamdown":"unordered-list",...r,children:e}),(e,t)=>Bo(e,t));Ste.displayName="MarkdownUl";var Ate=B.memo(({className:e,node:t,...n})=>k.jsx("hr",{className:zs("my-6 border-border",e),"data-streamdown":"horizontal-rule",...n}),(e,t)=>Bo(e,t));Ate.displayName="MarkdownHr";var Cte=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("span",{className:zs("font-semibold",t),"data-streamdown":"strong",...r,children:e}),(e,t)=>Bo(e,t));Cte.displayName="MarkdownStrong";var kte=B.memo(({children:e,className:t,href:n,node:r,...a})=>{let u=n==="streamdown:incomplete-link";return k.jsx("a",{className:zs("wrap-anywhere font-medium text-primary underline",t),"data-incomplete":u,"data-streamdown":"link",href:n,rel:"noreferrer",target:"_blank",...a,children:e})},(e,t)=>Bo(e,t)&&e.href===t.href);kte.displayName="MarkdownA";var Ite=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("h1",{className:zs("mt-6 mb-2 font-semibold text-3xl",t),"data-streamdown":"heading-1",...r,children:e}),(e,t)=>Bo(e,t));Ite.displayName="MarkdownH1";var Rte=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("h2",{className:zs("mt-6 mb-2 font-semibold text-2xl",t),"data-streamdown":"heading-2",...r,children:e}),(e,t)=>Bo(e,t));Rte.displayName="MarkdownH2";var Mte=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("h3",{className:zs("mt-6 mb-2 font-semibold text-xl",t),"data-streamdown":"heading-3",...r,children:e}),(e,t)=>Bo(e,t));Mte.displayName="MarkdownH3";var Pte=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("h4",{className:zs("mt-6 mb-2 font-semibold text-lg",t),"data-streamdown":"heading-4",...r,children:e}),(e,t)=>Bo(e,t));Pte.displayName="MarkdownH4";var Ote=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("h5",{className:zs("mt-6 mb-2 font-semibold text-base",t),"data-streamdown":"heading-5",...r,children:e}),(e,t)=>Bo(e,t));Ote.displayName="MarkdownH5";var Lte=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("h6",{className:zs("mt-6 mb-2 font-semibold text-sm",t),"data-streamdown":"heading-6",...r,children:e}),(e,t)=>Bo(e,t));Lte.displayName="MarkdownH6";var Dte=B.memo(({children:e,className:t,node:n,...r})=>{let{controls:a}=B.useContext(uh),u=I8(a,"table");return k.jsx(XRe,{className:t,"data-streamdown":"table-wrapper",showControls:u,...r,children:e})},(e,t)=>Bo(e,t));Dte.displayName="MarkdownTable";var Nte=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("thead",{className:zs("bg-muted/80",t),"data-streamdown":"table-header",...r,children:e}),(e,t)=>Bo(e,t));Nte.displayName="MarkdownThead";var zte=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("tbody",{className:zs("divide-y divide-border bg-muted/40",t),"data-streamdown":"table-body",...r,children:e}),(e,t)=>Bo(e,t));zte.displayName="MarkdownTbody";var Fte=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("tr",{className:zs("border-border border-b",t),"data-streamdown":"table-row",...r,children:e}),(e,t)=>Bo(e,t));Fte.displayName="MarkdownTr";var Bte=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("th",{className:zs("whitespace-nowrap px-4 py-2 text-left font-semibold text-sm",t),"data-streamdown":"table-header-cell",...r,children:e}),(e,t)=>Bo(e,t));Bte.displayName="MarkdownTh";var jte=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("td",{className:zs("px-4 py-2 text-sm",t),"data-streamdown":"table-cell",...r,children:e}),(e,t)=>Bo(e,t));jte.displayName="MarkdownTd";var Ute=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("blockquote",{className:zs("my-4 border-muted-foreground/30 border-l-4 pl-4 text-muted-foreground italic",t),"data-streamdown":"blockquote",...r,children:e}),(e,t)=>Bo(e,t));Ute.displayName="MarkdownBlockquote";var Vte=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("sup",{className:zs("text-sm",t),"data-streamdown":"superscript",...r,children:e}),(e,t)=>Bo(e,t));Vte.displayName="MarkdownSup";var $te=B.memo(({children:e,className:t,node:n,...r})=>k.jsx("sub",{className:zs("text-sm",t),"data-streamdown":"subscript",...r,children:e}),(e,t)=>Bo(e,t));$te.displayName="MarkdownSub";var Hte=B.memo(({children:e,className:t,node:n,...r})=>{if("data-footnotes"in r){let a=f=>{var s,v;if(!B.isValidElement(f))return!1;let x=Array.isArray(f.props.children)?f.props.children:[f.props.children],A=!1,C=!1;for(let P of x)if(P){if(typeof P=="string")P.trim()!==""&&(A=!0);else if(B.isValidElement(P))if(((s=P.props)==null?void 0:s["data-footnote-backref"])!==void 0)C=!0;else{let L=Array.isArray(P.props.children)?P.props.children:[P.props.children];for(let F of L){if(typeof F=="string"&&F.trim()!==""){A=!0;break}if(B.isValidElement(F)&&((v=F.props)==null?void 0:v["data-footnote-backref"])===void 0){A=!0;break}}}}return C&&!A},u=Array.isArray(e)?e.map(f=>{if(!B.isValidElement(f))return f;if(f.type===DD){let s=(Array.isArray(f.props.children)?f.props.children:[f.props.children]).filter(v=>!a(v));return s.length===0?null:{...f,props:{...f.props,children:s}}}return f}):e;return(Array.isArray(u)?u.some(f=>f!==null):u!==null)?k.jsx("section",{className:t,...r,children:u}):null}return k.jsx("section",{className:t,...r,children:e})},(e,t)=>Bo(e,t));Hte.displayName="MarkdownSection";var JRe=({node:e,className:t,children:n,...r})=>{var a,u,f;let s=((a=e==null?void 0:e.position)==null?void 0:a.start.line)===((u=e==null?void 0:e.position)==null?void 0:u.end.line),{mermaid:v,controls:x}=B.useContext(uh);if(s)return k.jsx("code",{className:zs("rounded bg-muted px-1.5 py-0.5 font-mono text-sm",t),"data-streamdown":"inline-code",...r,children:n});let A=t==null?void 0:t.match(QRe),C=(f=A==null?void 0:A.at(1))!=null?f:"",P="";if(B.isValidElement(n)&&n.props&&typeof n.props=="object"&&"children"in n.props&&typeof n.props.children=="string"?P=n.props.children:typeof n=="string"&&(P=n),C==="mermaid"){let F=I8(x,"mermaid"),U=F3(x,"download"),q=F3(x,"copy"),G=F3(x,"fullscreen"),$=F3(x,"panZoom");return k.jsx(B.Suspense,{fallback:k.jsx(G$,{}),children:k.jsxs("div",{className:zs("group relative my-4 h-auto rounded-xl border p-4",t),"data-streamdown":"mermaid-block",children:[F&&(U||q||G)&&k.jsxs("div",{className:"flex items-center justify-end gap-2",children:[U&&k.jsx(URe,{chart:P,config:v==null?void 0:v.config}),q&&k.jsx($$,{code:P}),G&&k.jsx(HRe,{chart:P,config:v==null?void 0:v.config})]}),k.jsx(KRe,{chart:P,config:v==null?void 0:v.config,showControls:$})]})})}let L=I8(x,"code");return k.jsx(B.Suspense,{fallback:k.jsx(G$,{}),children:k.jsx(YRe,{className:zs("overflow-x-auto border-border border-t",t),code:P,language:C,children:L&&k.jsxs(k.Fragment,{children:[k.jsx(zRe,{code:P,language:C}),k.jsx($$,{})]})})})},Gte=B.memo(JRe,(e,t)=>e.className===t.className&&Sk(e.node,t.node));Gte.displayName="MarkdownCode";var qte=B.memo(BRe,(e,t)=>e.className===t.className&&Sk(e.node,t.node));qte.displayName="MarkdownImg";var Wte=B.memo(({children:e,className:t,node:n,...r})=>{var a;let u=(Array.isArray(e)?e:[e]).filter(f=>f!=null&&f!=="");return u.length===1&&B.isValidElement(u[0])&&((a=u[0].props.node)==null?void 0:a.tagName)==="img"?k.jsx(k.Fragment,{children:e}):k.jsx("p",{className:t,...r,children:e})},(e,t)=>Bo(e,t));Wte.displayName="MarkdownParagraph";var eMe={ol:DD,li:Ete,ul:Ste,hr:Ate,strong:Cte,a:kte,h1:Ite,h2:Rte,h3:Mte,h4:Pte,h5:Ote,h6:Lte,table:Dte,thead:Nte,tbody:zte,tr:Fte,th:Bte,td:jte,blockquote:Ute,code:Gte,img:qte,pre:({children:e})=>e,sup:Vte,sub:$te,p:Wte,section:Hte},q$=[],W$={allowDangerousHtml:!0},B3=new WeakMap,tMe=class{constructor(){this.cache=new Map,this.keyCache=new WeakMap,this.maxSize=100}generateCacheKey(e){let t=this.keyCache.get(e);if(t)return t;let n=e.rehypePlugins,r=e.remarkPlugins,a=e.remarkRehypeOptions;if(!(n||r||a)){let A="default";return this.keyCache.set(e,A),A}let u=A=>{if(!A||A.length===0)return"";let C="";for(let P=0;P<A.length;P+=1){let L=A[P];if(P>0&&(C+=","),Array.isArray(L)){let[F,U]=L;if(typeof F=="function"){let q=B3.get(F);q||(q=F.name,B3.set(F,q)),C+=q}else C+=String(F);C+=":",C+=JSON.stringify(U)}else if(typeof L=="function"){let F=B3.get(L);F||(F=L.name,B3.set(L,F)),C+=F}else C+=String(L)}return C},f=u(n),s=u(r),v=a?JSON.stringify(a):"",x=`${s}::${f}::${v}`;return this.keyCache.set(e,x),x}get(e){let t=this.generateCacheKey(e),n=this.cache.get(t);return n&&(this.cache.delete(t),this.cache.set(t,n)),n}set(e,t){let n=this.generateCacheKey(e);if(this.cache.size>=this.maxSize){let r=this.cache.keys().next().value;r&&this.cache.delete(r)}this.cache.set(n,t)}clear(){this.cache.clear()}},Z$=new tMe,Zte=e=>{let t=nMe(e),n=e.children||"";return iMe(t.runSync(t.parse(n),n),e)},nMe=e=>{let t=Z$.get(e);if(t)return t;let n=rMe(e);return Z$.set(e,n),n},rMe=e=>{let t=e.rehypePlugins||q$,n=e.remarkPlugins||q$,r=e.remarkRehypeOptions?{...W$,...e.remarkRehypeOptions}:W$;return X5e().use(Q6e).use(n).use(L5e,r).use(t)},iMe=(e,t)=>a6e(e,{Fragment:k.Fragment,components:t.components,ignoreInvalidStyle:!0,jsx:k.jsx,jsxs:k.jsxs,passKeys:!0,passNode:!0}),sMe=/\[\^[^\]\s]{1,200}\](?!:)/,aMe=/\[\^[^\]\s]{1,200}\]:/,oMe=/<\/(\w+)>/,lMe=/<(\w+)[\s>]/,pR=e=>{let t=0;for(;t<e.length&&(e[t]===" "||e[t]==="	"||e[t]===`
`||e[t]==="\r");)t+=1;return t+1<e.length&&e[t]==="$"&&e[t+1]==="$"},uMe=e=>{let t=e.length-1;for(;t>=0&&(e[t]===" "||e[t]==="	"||e[t]===`
`||e[t]==="\r");)t-=1;return t>=1&&e[t]==="$"&&e[t-1]==="$"},mR=e=>{let t=0;for(let n=0;n<e.length-1;n+=1)e[n]==="$"&&e[n+1]==="$"&&(t+=1,n+=1);return t},cMe=e=>{let t=sMe.test(e),n=aMe.test(e);if(t||n)return[e];let r=sd.lex(e,{gfm:!0}),a=[],u=[];for(let f of r){let s=f.raw,v=a.length;if(u.length>0){if(a[v-1]+=s,f.type==="html"){let x=s.match(oMe);if(x){let A=x[1];u.at(-1)===A&&u.pop()}}continue}if(f.type==="html"&&f.block){let x=s.match(lMe);if(x){let A=x[1];s.includes(`</${A}>`)||u.push(A)}}if(s.trim()==="$$"&&v>0){let x=a[v-1],A=pR(x),C=mR(x);if(A&&C%2===1){a[v-1]=x+s;continue}}if(v>0&&uMe(s)){let x=a[v-1],A=pR(x),C=mR(x),P=mR(s);if(A&&C%2===1&&!pR(s)&&P===1){a[v-1]=x+s;continue}}a.push(s)}return a},dMe={raw:DSe,katex:[n8,{errorColor:"var(--color-muted-foreground)"}],sanitize:[GSe,{}],harden:[yxe,{allowedImagePrefixes:["*"],allowedLinkPrefixes:["*"],allowedProtocols:["*"],defaultOrigin:void 0,allowDataImages:!0}]},hMe={gfm:[KCe,{}],math:[_8,{singleDollarTextMath:!1}],cjkFriendly:[y3e,{}],cjkFriendlyGfmStrikethrough:[x3e,{}]},fMe=Object.values(dMe),pMe=Object.values(hMe),mMe={shikiTheme:["github-light","github-dark"],controls:!0,isAnimating:!1,mode:"streaming",mermaid:void 0},uh=B.createContext(mMe),Xte=B.memo(({content:e,shouldParseIncompleteMarkdown:t,...n})=>{let r=B.useMemo(()=>typeof e=="string"&&t?qke(e.trim()):e,[e,t]);return k.jsx(Zte,{...n,children:r})},(e,t)=>{if(e.content!==t.content||e.shouldParseIncompleteMarkdown!==t.shouldParseIncompleteMarkdown||e.index!==t.index)return!1;if(e.components!==t.components){let n=Object.keys(e.components||{}),r=Object.keys(t.components||{});if(n.length!==r.length||n.some(a=>{var u,f;return((u=e.components)==null?void 0:u[a])!==((f=t.components)==null?void 0:f[a])}))return!1}return!(e.rehypePlugins!==t.rehypePlugins||e.remarkPlugins!==t.remarkPlugins)});Xte.displayName="Block";var gMe=["github-light","github-dark"],Yte=B.memo(({children:e,mode:t="streaming",parseIncompleteMarkdown:n=!0,components:r,rehypePlugins:a=fMe,remarkPlugins:u=pMe,className:f,shikiTheme:s=gMe,mermaid:v,controls:x=!0,isAnimating:A=!1,BlockComponent:C=Xte,parseMarkdownIntoBlocksFn:P=cMe,...L})=>{let F=B.useId(),[U,q]=B.useTransition(),[G,$]=B.useState([]),X=B.useMemo(()=>P(typeof e=="string"?e:""),[e,P]);B.useEffect(()=>{t==="streaming"?q(()=>{$(X)}):$(X)},[X,t]);let ie=t==="streaming"?G:X,de=B.useMemo(()=>ie.map((ve,Qe)=>`${F}-${Qe}`),[ie.length,F]),fe=B.useMemo(()=>({shikiTheme:s,controls:x,isAnimating:A,mode:t,mermaid:v}),[s,x,A,t,v]),be=B.useMemo(()=>({...eMe,...r}),[r]);return B.useEffect(()=>{if(!(Array.isArray(a)&&a.some(Je=>Array.isArray(Je)?Je[0]===n8:Je===n8)))return;let ve=!1;if(Array.isArray(u)){let Je=u.find(ft=>Array.isArray(ft)?ft[0]===_8:ft===_8);Je&&Array.isArray(Je)&&Je[1]&&(ve=Je[1].singleDollarTextMath===!0)}let Qe=typeof e=="string"?e:"",we=Qe.includes("$$"),qe=ve&&(/[^$]\$[^$]/.test(Qe)||/^\$[^$]/.test(Qe)||/[^$]\$$/.test(Qe));(we||qe)&&TT(()=>Promise.resolve().then(()=>dxe),void 0)},[a,u,e]),t==="static"?k.jsx(uh.Provider,{value:fe,children:k.jsx("div",{className:zs("space-y-4 whitespace-normal",f),children:k.jsx(Zte,{components:be,rehypePlugins:a,remarkPlugins:u,...L,children:e})})}):k.jsx(uh.Provider,{value:fe,children:k.jsx("div",{className:zs("space-y-4 whitespace-normal",f),children:ie.map((ve,Qe)=>k.jsx(C,{components:be,content:ve,index:Qe,rehypePlugins:a,remarkPlugins:u,shouldParseIncompleteMarkdown:n,...L},de[Qe]))})})},(e,t)=>e.children===t.children&&e.shikiTheme===t.shikiTheme&&e.isAnimating===t.isAnimating&&e.mode===t.mode);Yte.displayName="Streamdown";var _Me=({children:e,className:t,minZoom:n=.5,maxZoom:r=3,zoomStep:a=.1,showControls:u=!0,initialZoom:f=1,fullscreen:s=!1})=>{let v=B.useRef(null),x=B.useRef(null),[A,C]=B.useState(f),[P,L]=B.useState({x:0,y:0}),[F,U]=B.useState(!1),[q,G]=B.useState({x:0,y:0}),[$,X]=B.useState({x:0,y:0}),ie=B.useCallback(Je=>{C(ft=>Math.max(n,Math.min(r,ft+Je)))},[n,r]),de=B.useCallback(()=>{ie(a)},[ie,a]),fe=B.useCallback(()=>{ie(-a)},[ie,a]),be=B.useCallback(()=>{C(f),L({x:0,y:0})},[f]),ve=B.useCallback(Je=>{Je.preventDefault();let ft=Je.deltaY>0?-a:a;ie(ft)},[ie,a]),Qe=B.useCallback(Je=>{if(Je.button!==0||Je.isPrimary===!1)return;U(!0),G({x:Je.clientX,y:Je.clientY}),X(P);let ft=Je.currentTarget;ft instanceof HTMLElement&&ft.setPointerCapture(Je.pointerId)},[P]),we=B.useCallback(Je=>{if(!F)return;Je.preventDefault();let ft=Je.clientX-q.x,Mt=Je.clientY-q.y;L({x:$.x+ft,y:$.y+Mt})},[F,q,$]),qe=B.useCallback(Je=>{U(!1);let ft=Je.currentTarget;ft instanceof HTMLElement&&ft.releasePointerCapture(Je.pointerId)},[]);return B.useEffect(()=>{let Je=v.current;if(Je)return Je.addEventListener("wheel",ve,{passive:!1}),()=>{Je.removeEventListener("wheel",ve)}},[ve]),B.useEffect(()=>{let Je=x.current;if(Je&&F)return document.body.style.userSelect="none",Je.addEventListener("pointermove",we,{passive:!1}),Je.addEventListener("pointerup",qe),Je.addEventListener("pointercancel",qe),()=>{document.body.style.userSelect="",Je.removeEventListener("pointermove",we),Je.removeEventListener("pointerup",qe),Je.removeEventListener("pointercancel",qe)}},[F,we,qe]),k.jsxs("div",{className:zs("relative",s?"h-full w-full":"w-full",t),ref:v,style:{cursor:F?"grabbing":"grab"},children:[u&&k.jsxs("div",{className:zs("absolute z-10 flex flex-col gap-1 rounded-md border border-border bg-background/90 p-1 shadow-sm backdrop-blur-sm",s?"bottom-4 left-4":"bottom-2 left-2"),children:[k.jsx("button",{className:"flex items-center justify-center rounded p-1.5 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",disabled:A>=r,onClick:de,title:"Zoom in",type:"button",children:k.jsx(cIe,{size:16})}),k.jsx("button",{className:"flex items-center justify-center rounded p-1.5 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",disabled:A<=n,onClick:fe,title:"Zoom out",type:"button",children:k.jsx(hIe,{size:16})}),k.jsx("button",{className:"flex items-center justify-center rounded p-1.5 text-muted-foreground transition-colors hover:bg-muted hover:text-foreground",onClick:be,title:"Reset zoom and pan",type:"button",children:k.jsx(aIe,{size:16})})]}),k.jsx("div",{className:zs("origin-center transition-transform duration-150 ease-out",s&&"flex w-full items-center justify-center"),onPointerDown:Qe,ref:x,role:"application",style:{transform:`translate(${P.x}px, ${P.y}px) scale(${A})`,transformOrigin:"center center",touchAction:"none",willChange:"transform"},children:e})]})},Kte=({chart:e,className:t,config:n,fullscreen:r=!1,showControls:a=!0})=>{let[u,f]=B.useState(null),[s,v]=B.useState(!0),[x,A]=B.useState(""),[C,P]=B.useState(""),[L,F]=B.useState(0),{mermaid:U}=B.useContext(uh),q=U==null?void 0:U.errorComponent;if(B.useEffect(()=>{(async()=>{try{f(null),v(!0);let $=await bte(n),X=e.split("").reduce((fe,be)=>(fe<<5)-fe+be.charCodeAt(0)|0,0),ie=`mermaid-${Math.abs(X)}-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,{svg:de}=await $.render(ie,e);A(de),P(de)}catch($){if(!(C||x)){let X=$ instanceof Error?$.message:"Failed to render Mermaid chart";f(X)}}finally{v(!1)}})()},[e,n,L]),s&&!x&&!C)return k.jsx("div",{className:zs("my-4 flex justify-center p-4",t),children:k.jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground",children:[k.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-current border-b-2"}),k.jsx("span",{className:"text-sm",children:"Loading diagram..."})]})});if(u&&!x&&!C){let $=()=>F(X=>X+1);return q?k.jsx(q,{chart:e,error:u,retry:$}):k.jsxs("div",{className:zs("rounded-lg border border-red-200 bg-red-50 p-4",t),children:[k.jsxs("p",{className:"font-mono text-red-700 text-sm",children:["Mermaid Error: ",u]}),k.jsxs("details",{className:"mt-2",children:[k.jsx("summary",{className:"cursor-pointer text-red-600 text-xs",children:"Show Code"}),k.jsx("pre",{className:"mt-2 overflow-x-auto rounded bg-red-100 p-2 text-red-800 text-xs",children:e})]})]})}let G=x||C;return k.jsx(_Me,{className:zs(r?"h-full w-full overflow-hidden":"my-4 overflow-hidden",t),fullscreen:r,maxZoom:3,minZoom:.5,showControls:a,zoomStep:.1,children:k.jsx("div",{"aria-label":"Mermaid chart",className:zs("flex justify-center",r&&"h-full w-full items-center"),dangerouslySetInnerHTML:{__html:G},role:"img"})})};const yMe=Symbol("Let zodToJsonSchema decide on which parser to use"),X$={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},vMe=e=>typeof e=="string"?{...X$,name:e}:{...X$,...e},xMe=e=>{const t=vMe(e),n=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,r],jsonSchema:void 0}]))}};function Qte(e,t,n,r){r!=null&&r.errorMessages&&n&&(e.errorMessage={...e.errorMessage,[t]:n})}function Da(e,t,n,r,a){e[t]=n,Qte(e,t,r,a)}const Jte=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")};var iT;(function(e){e.assertEqual=a=>{};function t(a){}e.assertIs=t;function n(a){throw new Error}e.assertNever=n,e.arrayToEnum=a=>{const u={};for(const f of a)u[f]=f;return u},e.getValidEnumValues=a=>{const u=e.objectKeys(a).filter(s=>typeof a[a[s]]!="number"),f={};for(const s of u)f[s]=a[s];return e.objectValues(f)},e.objectValues=a=>e.objectKeys(a).map(function(u){return a[u]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const u=[];for(const f in a)Object.prototype.hasOwnProperty.call(a,f)&&u.push(f);return u},e.find=(a,u)=>{for(const f of a)if(u(f))return f},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,u=" | "){return a.map(f=>typeof f=="string"?`'${f}'`:f).join(u)}e.joinValues=r,e.jsonStringifyReplacer=(a,u)=>typeof u=="bigint"?u.toString():u})(iT||(iT={}));var Y$;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(Y$||(Y$={}));iT.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]);iT.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);let K$=class ene extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(u){return u.message},r={_errors:[]},a=u=>{for(const f of u.issues)if(f.code==="invalid_union")f.unionErrors.map(a);else if(f.code==="invalid_return_type")a(f.returnTypeError);else if(f.code==="invalid_arguments")a(f.argumentsError);else if(f.path.length===0)r._errors.push(n(f));else{let s=r,v=0;for(;v<f.path.length;){const x=f.path[v];v===f.path.length-1?(s[x]=s[x]||{_errors:[]},s[x]._errors.push(n(f))):s[x]=s[x]||{_errors:[]},s=s[x],v++}}};return a(this),r}static assert(t){if(!(t instanceof ene))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,iT.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n=Object.create(null),r=[];for(const a of this.issues)if(a.path.length>0){const u=a.path[0];n[u]=n[u]||[],n[u].push(t(a))}else r.push(t(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}};K$.create=e=>new K$(e);var Q$;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(Q$||(Q$={}));var vs;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(vs||(vs={}));function tc(e){if(e.target!=="openAi")return{};const t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:e.$refStrategy==="relative"?Jte(t,e.currentPath):t.join("/")}}function bMe(e,t){var r,a,u;const n={type:"array"};return(r=e.type)!=null&&r._def&&((u=(a=e.type)==null?void 0:a._def)==null?void 0:u.typeName)!==vs.ZodAny&&(n.items=Pa(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&Da(n,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&Da(n,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(Da(n,"minItems",e.exactLength.value,e.exactLength.message,t),Da(n,"maxItems",e.exactLength.value,e.exactLength.message,t)),n}function wMe(e,t){const n={type:"integer",format:"int64"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"min":t.target==="jsonSchema7"?r.inclusive?Da(n,"minimum",r.value,r.message,t):Da(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Da(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Da(n,"maximum",r.value,r.message,t):Da(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Da(n,"maximum",r.value,r.message,t));break;case"multipleOf":Da(n,"multipleOf",r.value,r.message,t);break}return n}function TMe(){return{type:"boolean"}}function tne(e,t){return Pa(e.type._def,t)}const EMe=(e,t)=>Pa(e.innerType._def,t);function nne(e,t,n){const r=n??t.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,u)=>nne(e,t,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return SMe(e,t)}}const SMe=(e,t)=>{const n={type:"integer",format:"unix-time"};if(t.target==="openApi3")return n;for(const r of e.checks)switch(r.kind){case"min":Da(n,"minimum",r.value,r.message,t);break;case"max":Da(n,"maximum",r.value,r.message,t);break}return n};function AMe(e,t){return{...Pa(e.innerType._def,t),default:e.defaultValue()}}function CMe(e,t){return t.effectStrategy==="input"?Pa(e.schema._def,t):tc(t)}function kMe(e){return{type:"string",enum:Array.from(e.values)}}const IMe=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function RMe(e,t){const n=[Pa(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),Pa(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(u=>!!u);let r=t.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return n.forEach(u=>{if(IMe(u))a.push(...u.allOf),u.unevaluatedProperties===void 0&&(r=void 0);else{let f=u;if("additionalProperties"in u&&u.additionalProperties===!1){const{additionalProperties:s,...v}=u;f=v}else r=void 0;a.push(f)}}),a.length?{allOf:a,...r}:void 0}function MMe(e,t){const n=typeof e.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(e.value)?"array":"object"}:t.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[e.value]}:{type:n==="bigint"?"integer":n,const:e.value}}let gR;const Gd={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(gR===void 0&&(gR=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),gR),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function rne(e,t){const n={type:"string"};if(e.checks)for(const r of e.checks)switch(r.kind){case"min":Da(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t);break;case"max":Da(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"email":switch(t.emailStrategy){case"format:email":qd(n,"email",r.message,t);break;case"format:idn-email":qd(n,"idn-email",r.message,t);break;case"pattern:zod":_u(n,Gd.email,r.message,t);break}break;case"url":qd(n,"uri",r.message,t);break;case"uuid":qd(n,"uuid",r.message,t);break;case"regex":_u(n,r.regex,r.message,t);break;case"cuid":_u(n,Gd.cuid,r.message,t);break;case"cuid2":_u(n,Gd.cuid2,r.message,t);break;case"startsWith":_u(n,RegExp(`^${_R(r.value,t)}`),r.message,t);break;case"endsWith":_u(n,RegExp(`${_R(r.value,t)}$`),r.message,t);break;case"datetime":qd(n,"date-time",r.message,t);break;case"date":qd(n,"date",r.message,t);break;case"time":qd(n,"time",r.message,t);break;case"duration":qd(n,"duration",r.message,t);break;case"length":Da(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,t),Da(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,t);break;case"includes":{_u(n,RegExp(_R(r.value,t)),r.message,t);break}case"ip":{r.version!=="v6"&&qd(n,"ipv4",r.message,t),r.version!=="v4"&&qd(n,"ipv6",r.message,t);break}case"base64url":_u(n,Gd.base64url,r.message,t);break;case"jwt":_u(n,Gd.jwt,r.message,t);break;case"cidr":{r.version!=="v6"&&_u(n,Gd.ipv4Cidr,r.message,t),r.version!=="v4"&&_u(n,Gd.ipv6Cidr,r.message,t);break}case"emoji":_u(n,Gd.emoji(),r.message,t);break;case"ulid":{_u(n,Gd.ulid,r.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{qd(n,"binary",r.message,t);break}case"contentEncoding:base64":{Da(n,"contentEncoding","base64",r.message,t);break}case"pattern:zod":{_u(n,Gd.base64,r.message,t);break}}break}case"nanoid":_u(n,Gd.nanoid,r.message,t)}return n}function _R(e,t){return t.patternStrategy==="escape"?OMe(e):e}const PMe=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function OMe(e){let t="";for(let n=0;n<e.length;n++)PMe.has(e[n])||(t+="\\"),t+=e[n];return t}function qd(e,t,n,r){var a;e.format||(a=e.anyOf)!=null&&a.some(u=>u.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&r.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Da(e,"format",t,n,r)}function _u(e,t,n,r){var a;e.pattern||(a=e.allOf)!=null&&a.some(u=>u.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&r.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,Object.keys(e.errorMessage).length===0&&delete e.errorMessage)),e.allOf.push({pattern:J$(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Da(e,"pattern",J$(t,r),n,r)}function J$(e,t){var v;if(!t.applyRegexFlags||!e.flags)return e.source;const n={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},r=n.i?e.source.toLowerCase():e.source;let a="",u=!1,f=!1,s=!1;for(let x=0;x<r.length;x++){if(u){a+=r[x],u=!1;continue}if(n.i){if(f){if(r[x].match(/[a-z]/)){s?(a+=r[x],a+=`${r[x-2]}-${r[x]}`.toUpperCase(),s=!1):r[x+1]==="-"&&((v=r[x+2])!=null&&v.match(/[a-z]/))?(a+=r[x],s=!0):a+=`${r[x]}${r[x].toUpperCase()}`;continue}}else if(r[x].match(/[a-z]/)){a+=`[${r[x]}${r[x].toUpperCase()}]`;continue}}if(n.m){if(r[x]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(r[x]==="$"){a+=`($|(?=[\r
]))`;continue}}if(n.s&&r[x]==="."){a+=f?`${r[x]}\r
`:`[${r[x]}\r
]`;continue}a+=r[x],r[x]==="\\"?u=!0:f&&r[x]==="]"?f=!1:!f&&r[x]==="["&&(f=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return a}function ine(e,t){var r,a,u,f,s,v;if(t.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),t.target==="openApi3"&&((r=e.keyType)==null?void 0:r._def.typeName)===vs.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((x,A)=>({...x,[A]:Pa(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",A]})??tc(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};const n={type:"object",additionalProperties:Pa(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if(t.target==="openApi3")return n;if(((a=e.keyType)==null?void 0:a._def.typeName)===vs.ZodString&&((u=e.keyType._def.checks)!=null&&u.length)){const{type:x,...A}=rne(e.keyType._def,t);return{...n,propertyNames:A}}else{if(((f=e.keyType)==null?void 0:f._def.typeName)===vs.ZodEnum)return{...n,propertyNames:{enum:e.keyType._def.values}};if(((s=e.keyType)==null?void 0:s._def.typeName)===vs.ZodBranded&&e.keyType._def.type._def.typeName===vs.ZodString&&((v=e.keyType._def.type._def.checks)!=null&&v.length)){const{type:x,...A}=tne(e.keyType._def,t);return{...n,propertyNames:A}}}return n}function LMe(e,t){if(t.mapStrategy==="record")return ine(e,t);const n=Pa(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||tc(t),r=Pa(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||tc(t);return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function DMe(e){const t=e.values,r=Object.keys(e.values).filter(u=>typeof t[t[u]]!="number").map(u=>t[u]),a=Array.from(new Set(r.map(u=>typeof u)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:r}}function NMe(e){return e.target==="openAi"?void 0:{not:tc({...e,currentPath:[...e.currentPath,"not"]})}}function zMe(e){return e.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const mC={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function FMe(e,t){if(t.target==="openApi3")return eH(e,t);const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(r=>r._def.typeName in mC&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((a,u)=>{const f=mC[u._def.typeName];return f&&!a.includes(f)?[...a,f]:a},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((a,u)=>{const f=typeof u._def.value;switch(f){case"string":case"number":case"boolean":return[...a,f];case"bigint":return[...a,"integer"];case"object":if(u._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===n.length){const a=r.filter((u,f,s)=>s.indexOf(u)===f);return{type:a.length>1?a:a[0],enum:n.reduce((u,f)=>u.includes(f._def.value)?u:[...u,f._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,a)=>[...r,...a._def.values.filter(u=>!r.includes(u))],[])};return eH(e,t)}const eH=(e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((r,a)=>Pa(r._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!t.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function BMe(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return t.target==="openApi3"?{type:mC[e.innerType._def.typeName],nullable:!0}:{type:[mC[e.innerType._def.typeName],"null"]};if(t.target==="openApi3"){const r=Pa(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=Pa(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function jMe(e,t){const n={type:"number"};if(!e.checks)return n;for(const r of e.checks)switch(r.kind){case"int":n.type="integer",Qte(n,"type",r.message,t);break;case"min":t.target==="jsonSchema7"?r.inclusive?Da(n,"minimum",r.value,r.message,t):Da(n,"exclusiveMinimum",r.value,r.message,t):(r.inclusive||(n.exclusiveMinimum=!0),Da(n,"minimum",r.value,r.message,t));break;case"max":t.target==="jsonSchema7"?r.inclusive?Da(n,"maximum",r.value,r.message,t):Da(n,"exclusiveMaximum",r.value,r.message,t):(r.inclusive||(n.exclusiveMaximum=!0),Da(n,"maximum",r.value,r.message,t));break;case"multipleOf":Da(n,"multipleOf",r.value,r.message,t);break}return n}function UMe(e,t){const n=t.target==="openAi",r={type:"object",properties:{}},a=[],u=e.shape();for(const s in u){let v=u[s];if(v===void 0||v._def===void 0)continue;let x=$Me(v);x&&n&&(v._def.typeName==="ZodOptional"&&(v=v._def.innerType),v.isNullable()||(v=v.nullable()),x=!1);const A=Pa(v._def,{...t,currentPath:[...t.currentPath,"properties",s],propertyPath:[...t.currentPath,"properties",s]});A!==void 0&&(r.properties[s]=A,x||a.push(s))}a.length&&(r.required=a);const f=VMe(e,t);return f!==void 0&&(r.additionalProperties=f),r}function VMe(e,t){if(e.catchall._def.typeName!=="ZodNever")return Pa(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function $Me(e){try{return e.isOptional()}catch{return!0}}const HMe=(e,t)=>{var r;if(t.currentPath.toString()===((r=t.propertyPath)==null?void 0:r.toString()))return Pa(e.innerType._def,t);const n=Pa(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:tc(t)},n]}:tc(t)},GMe=(e,t)=>{if(t.pipeStrategy==="input")return Pa(e.in._def,t);if(t.pipeStrategy==="output")return Pa(e.out._def,t);const n=Pa(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r=Pa(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(a=>a!==void 0)}};function qMe(e,t){return Pa(e.type._def,t)}function WMe(e,t){const r={type:"array",uniqueItems:!0,items:Pa(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&Da(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&Da(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}function ZMe(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((n,r)=>Pa(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:Pa(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((n,r)=>Pa(n._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function XMe(e){return{not:tc(e)}}function YMe(e){return tc(e)}const KMe=(e,t)=>Pa(e.innerType._def,t),QMe=(e,t,n)=>{switch(t){case vs.ZodString:return rne(e,n);case vs.ZodNumber:return jMe(e,n);case vs.ZodObject:return UMe(e,n);case vs.ZodBigInt:return wMe(e,n);case vs.ZodBoolean:return TMe();case vs.ZodDate:return nne(e,n);case vs.ZodUndefined:return XMe(n);case vs.ZodNull:return zMe(n);case vs.ZodArray:return bMe(e,n);case vs.ZodUnion:case vs.ZodDiscriminatedUnion:return FMe(e,n);case vs.ZodIntersection:return RMe(e,n);case vs.ZodTuple:return ZMe(e,n);case vs.ZodRecord:return ine(e,n);case vs.ZodLiteral:return MMe(e,n);case vs.ZodEnum:return kMe(e);case vs.ZodNativeEnum:return DMe(e);case vs.ZodNullable:return BMe(e,n);case vs.ZodOptional:return HMe(e,n);case vs.ZodMap:return LMe(e,n);case vs.ZodSet:return WMe(e,n);case vs.ZodLazy:return()=>e.getter()._def;case vs.ZodPromise:return qMe(e,n);case vs.ZodNaN:case vs.ZodNever:return NMe(n);case vs.ZodEffects:return CMe(e,n);case vs.ZodAny:return tc(n);case vs.ZodUnknown:return YMe(n);case vs.ZodDefault:return AMe(e,n);case vs.ZodBranded:return tne(e,n);case vs.ZodReadonly:return KMe(e,n);case vs.ZodCatch:return EMe(e,n);case vs.ZodPipeline:return GMe(e,n);case vs.ZodFunction:case vs.ZodVoid:case vs.ZodSymbol:return;default:return(r=>{})()}};function Pa(e,t,n=!1){var s;const r=t.seen.get(e);if(t.override){const v=(s=t.override)==null?void 0:s.call(t,e,t,r,n);if(v!==yMe)return v}if(r&&!n){const v=JMe(r,t);if(v!==void 0)return v}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const u=QMe(e,e.typeName,t),f=typeof u=="function"?Pa(u(),t):u;if(f&&ePe(e,t,f),t.postProcess){const v=t.postProcess(f,e,t);return a.jsonSchema=f,v}return a.jsonSchema=f,f}const JMe=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Jte(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((n,r)=>t.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),tc(t)):t.$refStrategy==="seen"?tc(t):void 0}},ePe=(e,t,n)=>(e.description&&(n.description=e.description,t.markdownDescription&&(n.markdownDescription=e.description)),n),tPe=(e,t)=>{const n=xMe(t);let r=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((v,[x,A])=>({...v,[x]:Pa(A._def,{...n,currentPath:[...n.basePath,n.definitionPath,x]},!0)??tc(n)}),{}):void 0;const a=typeof t=="string"?t:(t==null?void 0:t.nameStrategy)==="title"||t==null?void 0:t.name,u=Pa(e._def,a===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,a]},!1)??tc(n),f=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;f!==void 0&&(u.title=f),n.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[n.openAiAnyTypeName]||(r[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:n.$refStrategy==="relative"?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));const s=a===void 0?r?{...u,[n.definitionPath]:r}:u:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,a].join("/"),[n.definitionPath]:{...r,[a]:u}};return n.target==="jsonSchema7"?s.$schema="http://json-schema.org/draft-07/schema#":(n.target==="jsonSchema2019-09"||n.target==="openAi")&&(s.$schema="https://json-schema.org/draft/2019-09/schema#"),n.target==="openAi"&&("anyOf"in s||"oneOf"in s||"allOf"in s||"type"in s&&Array.isArray(s.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),s};var sne=class extends HA{constructor(t){const n=t.runtimeUrl?t.runtimeUrl.replace(/\/$/,""):void 0,r=t.transport??"rest",a=r==="single"?n??t.runtimeUrl??"":`${n??t.runtimeUrl}/agent/${encodeURIComponent(t.agentId??"")}/run`;if(!a)throw new Error("ProxiedCopilotRuntimeAgent requires a runtimeUrl when transport is set to 'single'.");super({...t,url:a});yi(this,"runtimeUrl");yi(this,"transport");yi(this,"singleEndpointUrl");this.runtimeUrl=n??t.runtimeUrl,this.transport=r,this.transport==="single"&&(this.singleEndpointUrl=this.runtimeUrl)}abortRun(){if(!this.agentId||!this.threadId||typeof fetch>"u")return;if(this.transport==="single"){if(!this.singleEndpointUrl)return;const u=new Headers({...this.headers,"Content-Type":"application/json"});fetch(this.singleEndpointUrl,{method:"POST",headers:u,body:JSON.stringify({method:"agent/stop",params:{agentId:this.agentId,threadId:this.threadId}})}).catch(f=>{console.error("ProxiedCopilotRuntimeAgent: stop request failed",f)});return}if(!this.runtimeUrl)return;const t=`${this.runtimeUrl}/agent/${encodeURIComponent(this.agentId)}/stop/${encodeURIComponent(this.threadId)}`,n=typeof window<"u"&&window.location?window.location.origin:"http://localhost",r=new URL(this.runtimeUrl,n),a=new URL(t,r);fetch(a.toString(),{method:"POST",headers:{"Content-Type":"application/json",...this.headers}}).catch(u=>{console.error("ProxiedCopilotRuntimeAgent: stop request failed",u)})}connect(t){if(this.transport==="single"){if(!this.singleEndpointUrl)throw new Error("Single endpoint transport requires a runtimeUrl");const r=this.createSingleRouteRequestInit(t,"agent/connect",{agentId:this.agentId}),a=R4(this.singleEndpointUrl,r);return M4(a)}const n=R4(`${this.runtimeUrl}/agent/${this.agentId}/connect`,this.requestInit(t));return M4(n)}run(t){if(this.transport==="single"){if(!this.singleEndpointUrl)throw new Error("Single endpoint transport requires a runtimeUrl");const n=this.createSingleRouteRequestInit(t,"agent/run",{agentId:this.agentId}),r=R4(this.singleEndpointUrl,n);return M4(r)}return super.run(t)}clone(){const t=super.clone();return t.runtimeUrl=this.runtimeUrl,t.transport=this.transport,t.singleEndpointUrl=this.singleEndpointUrl,t}createSingleRouteRequestInit(t,n,r){if(!this.agentId)throw new Error("ProxiedCopilotRuntimeAgent requires agentId to make runtime requests");const a=super.requestInit(t),u=new Headers(a.headers??{});u.set("Content-Type","application/json"),u.set("Accept",u.get("Accept")??"text/event-stream");let f;if(typeof a.body=="string")try{f=JSON.parse(a.body)}catch(v){console.warn("ProxiedCopilotRuntimeAgent: failed to parse request body for single route transport",v),f=void 0}const s={method:n};return r&&Object.keys(r).length>0&&(s.params=r),f!==void 0&&(s.body=f),{...a,headers:u,body:JSON.stringify(s)}}},nPe=class{constructor(e){yi(this,"_agents",{});yi(this,"localAgents",{});yi(this,"remoteAgents",{});yi(this,"_runtimeUrl");yi(this,"_runtimeVersion");yi(this,"_runtimeConnectionStatus","disconnected");yi(this,"_runtimeTransport","rest");this.core=e}get agents(){return this._agents}get runtimeUrl(){return this._runtimeUrl}get runtimeVersion(){return this._runtimeVersion}get runtimeConnectionStatus(){return this._runtimeConnectionStatus}get runtimeTransport(){return this._runtimeTransport}initialize(e){this.localAgents=this.assignAgentIds(e),this.applyHeadersToAgents(this.localAgents),this._agents=this.localAgents}setRuntimeUrl(e){const t=e?e.replace(/\/$/,""):void 0;this._runtimeUrl!==t&&(this._runtimeUrl=t,this.updateRuntimeConnection())}setRuntimeTransport(e){this._runtimeTransport!==e&&(this._runtimeTransport=e,this.updateRuntimeConnection())}setAgents__unsafe_dev_only(e){Object.entries(e).forEach(([t,n])=>{n&&this.validateAndAssignAgentId(t,n)}),this.localAgents=e,this._agents={...this.localAgents,...this.remoteAgents},this.applyHeadersToAgents(this._agents),this.notifyAgentsChanged()}addAgent__unsafe_dev_only({id:e,agent:t}){this.validateAndAssignAgentId(e,t),this.localAgents[e]=t,this.applyHeadersToAgent(t),this._agents={...this.localAgents,...this.remoteAgents},this.notifyAgentsChanged()}removeAgent__unsafe_dev_only(e){delete this.localAgents[e],this._agents={...this.localAgents,...this.remoteAgents},this.notifyAgentsChanged()}getAgent(e){if(e in this._agents)return this._agents[e];this.runtimeUrl!==void 0&&(this.runtimeConnectionStatus==="disconnected"||this.runtimeConnectionStatus==="connecting")||console.warn(`Agent ${e} not found`)}applyHeadersToAgent(e){e instanceof HA&&(e.headers={...this.core.headers})}applyHeadersToAgents(e){Object.values(e).forEach(t=>{this.applyHeadersToAgent(t)})}async updateRuntimeConnection(){if(!(typeof window>"u")){if(!this.runtimeUrl){this._runtimeConnectionStatus="disconnected",this._runtimeVersion=void 0,this.remoteAgents={},this._agents=this.localAgents,await this.notifyRuntimeStatusChanged("disconnected"),await this.notifyAgentsChanged();return}this._runtimeConnectionStatus="connecting",await this.notifyRuntimeStatusChanged("connecting");try{const e=await this.fetchRuntimeInfo(),{version:t,...n}=e,r=Object.fromEntries(Object.entries(n.agents).map(([a,{description:u}])=>{const f=new sne({runtimeUrl:this.runtimeUrl,agentId:a,description:u,transport:this._runtimeTransport});return this.applyHeadersToAgent(f),[a,f]}));this.remoteAgents=r,this._agents={...this.localAgents,...this.remoteAgents},this._runtimeConnectionStatus="connected",this._runtimeVersion=t,await this.notifyRuntimeStatusChanged("connected"),await this.notifyAgentsChanged()}catch(e){this._runtimeConnectionStatus="error",this._runtimeVersion=void 0,this.remoteAgents={},this._agents=this.localAgents,await this.notifyRuntimeStatusChanged("error"),await this.notifyAgentsChanged();const t=e instanceof Error?e.message:JSON.stringify(e);GX.warn(`Failed to load runtime info (${this.runtimeUrl}/info): ${t}`);const n=e instanceof Error?e:new Error(String(e));await this.core.emitError({error:n,code:"runtime_info_fetch_failed",context:{runtimeUrl:this.runtimeUrl}})}}}async fetchRuntimeInfo(){if(!this.runtimeUrl)throw new Error("Runtime URL is not set");const t={...this.core.headers};if(this._runtimeTransport==="single"){t["Content-Type"]||(t["Content-Type"]="application/json");const r=await fetch(this.runtimeUrl,{method:"POST",headers:t,body:JSON.stringify({method:"info"})});if("ok"in r&&!r.ok)throw new Error(`Runtime info request failed with status ${r.status}`);return await r.json()}const n=await fetch(`${this.runtimeUrl}/info`,{headers:t});if("ok"in n&&!n.ok)throw new Error(`Runtime info request failed with status ${n.status}`);return await n.json()}assignAgentIds(e){return Object.entries(e).forEach(([t,n])=>{n&&this.validateAndAssignAgentId(t,n)}),e}validateAndAssignAgentId(e,t){if(t.agentId&&t.agentId!==e)throw new Error(`Agent registration mismatch: Agent with ID "${t.agentId}" cannot be registered under key "${e}". The agent ID must match the registration key or be undefined.`);t.agentId||(t.agentId=e)}async notifyRuntimeStatusChanged(e){await this.core.notifySubscribers(t=>{var n;return(n=t.onRuntimeConnectionStatusChanged)==null?void 0:n.call(t,{copilotkit:this.core,status:e})},"Error in CopilotKitCore subscriber (onRuntimeConnectionStatusChanged):")}async notifyAgentsChanged(){await this.core.notifySubscribers(e=>{var t;return(t=e.onAgentsChanged)==null?void 0:t.call(e,{copilotkit:this.core,agents:this._agents})},"Subscriber onAgentsChanged error:")}},rPe=class{constructor(e){yi(this,"_context",{});this.core=e}get context(){return this._context}addContext({description:e,value:t}){const n=nf();return this._context[n]={description:e,value:t},this.notifySubscribers(),n}removeContext(e){delete this._context[e],this.notifySubscribers()}async notifySubscribers(){await this.core.notifySubscribers(e=>{var t;return(t=e.onContextChanged)==null?void 0:t.call(e,{copilotkit:this.core,context:this._context})},"Subscriber onContextChanged error:")}},iPe=class{constructor(e){yi(this,"_suggestionsConfig",{});yi(this,"_suggestions",{});yi(this,"_runningSuggestions",{});this.core=e}initialize(e){for(const t of e)this._suggestionsConfig[nf()]=t}addSuggestionsConfig(e){const t=nf();return this._suggestionsConfig[t]=e,this.notifySuggestionsConfigChanged(),t}removeSuggestionsConfig(e){delete this._suggestionsConfig[e],this.notifySuggestionsConfigChanged()}reloadSuggestions(e){var a;this.clearSuggestions(e);const t=this.core.getAgent(e);if(!t)return;const n=((a=t.messages)==null?void 0:a.length)??0;let r=!1;for(const u of Object.values(this._suggestionsConfig)){if(u.consumerAgentId!==void 0&&u.consumerAgentId!=="*"&&u.consumerAgentId!==e||!this.shouldShowSuggestions(u,n))continue;const f=nf();tH(u)?(r||(r=!0,this.notifySuggestionsStartedLoading(e)),this.generateSuggestions(f,u,e)):sPe(u)&&this.addStaticSuggestions(f,u,e)}}clearSuggestions(e){const t=this._runningSuggestions[e];if(t){for(const n of t)n.abortRun();delete this._runningSuggestions[e]}this._suggestions[e]={},this.notifySuggestionsChanged(e,[])}getSuggestions(e){var r;const t=Object.values(this._suggestions[e]??{}).flat(),n=(((r=this._runningSuggestions[e])==null?void 0:r.length)??0)>0;return{suggestions:t,isLoading:n}}async generateSuggestions(e,t,n){let r;try{const a=this.core.getAgent(t.providerAgentId??"default");if(!a)throw new Error(`Suggestions provider agent not found: ${t.providerAgentId}`);const u=this.core.getAgent(n);if(!u)throw new Error(`Suggestions consumer agent not found: ${n}`);r=a.clone(),r.threadId=e,r.messages=JSON.parse(JSON.stringify(u.messages)),r.state=JSON.parse(JSON.stringify(u.state)),this._suggestions[n]={...this._suggestions[n]??{},[e]:[]},this._runningSuggestions[n]=[...this._runningSuggestions[n]??[],r],r.addMessage({id:e,role:"user",content:["Suggest what the user could say next. Provide clear, highly relevant suggestions by calling the `copilotkitSuggest` tool.",`Provide at least ${t.minSuggestions??1} and at most ${t.maxSuggestions??3} suggestions.`,`The user has the following tools available: ${JSON.stringify(this.core.buildFrontendTools(n))}.`,` ${t.instructions}`].join(`
`)}),await r.runAgent({context:Object.values(this.core.context),forwardedProps:{...this.core.properties,toolChoice:{type:"function",function:{name:"copilotkitSuggest"}}},tools:[aPe]},{onMessagesChanged:({messages:s})=>{this.extractSuggestions(s,e,n,!0)}})}catch(a){console.warn("Error generating suggestions:",a)}finally{this.finalizeSuggestions(e,n);const a=this._runningSuggestions[n];if(r&&a){const u=a.filter(f=>f!==r);this._runningSuggestions[n]=u,u.length===0&&(delete this._runningSuggestions[n],await this.notifySuggestionsFinishedLoading(n))}}}finalizeSuggestions(e,t){const n=this._suggestions[t],r=n==null?void 0:n[e];if(n&&r&&r.length>0){const a=r.filter(f=>f.title!==""||f.message!=="").map(f=>({...f,isLoading:!1}));a.length>0?n[e]=a:delete n[e];const u=Object.values(this._suggestions[t]??{}).flat();this.notifySuggestionsChanged(t,u,"finalized")}}extractSuggestions(e,t,n,r){const a=e.findIndex(v=>v.id===t);if(a==-1)return;const u=[],f=e.slice(a+1);for(const v of f)if(v.role==="assistant"&&v.toolCalls){for(const x of v.toolCalls)if(x.function.name==="copilotkitSuggest"){const A=Array.isArray(x.function.arguments)?x.function.arguments.join(""):x.function.arguments,C=HX(A);if(C&&typeof C=="object"&&"suggestions"in C){const P=C.suggestions;if(Array.isArray(P))for(const L of P)L&&typeof L=="object"&&"title"in L&&u.push({title:L.title??"",message:L.message??"",isLoading:!1})}}}r&&u.length>0&&(u[u.length-1].isLoading=!0);const s=this._suggestions[n];if(s){s[t]=u;const v=Object.values(this._suggestions[n]??{}).flat();this.notifySuggestionsChanged(n,v,"suggestions changed")}}async notifySuggestionsConfigChanged(){await this.core.notifySubscribers(e=>{var t;return(t=e.onSuggestionsConfigChanged)==null?void 0:t.call(e,{copilotkit:this.core,suggestionsConfig:this._suggestionsConfig})},"Subscriber onSuggestionsConfigChanged error:")}async notifySuggestionsChanged(e,t,n=""){await this.core.notifySubscribers(r=>{var a;return(a=r.onSuggestionsChanged)==null?void 0:a.call(r,{copilotkit:this.core,agentId:e,suggestions:t})},`Subscriber onSuggestionsChanged error: ${n}`)}async notifySuggestionsStartedLoading(e){await this.core.notifySubscribers(t=>{var n;return(n=t.onSuggestionsStartedLoading)==null?void 0:n.call(t,{copilotkit:this.core,agentId:e})},"Subscriber onSuggestionsStartedLoading error:")}async notifySuggestionsFinishedLoading(e){await this.core.notifySubscribers(t=>{var n;return(n=t.onSuggestionsFinishedLoading)==null?void 0:n.call(t,{copilotkit:this.core,agentId:e})},"Subscriber onSuggestionsFinishedLoading error:")}shouldShowSuggestions(e,t){const n=e.available;if(!n)return tH(e)?t>0:t===0;switch(n){case"disabled":return!1;case"before-first-message":return t===0;case"after-first-message":return t>0;case"always":return!0;default:return!1}}addStaticSuggestions(e,t,n){const r=t.suggestions.map(u=>({...u,isLoading:!1}));this._suggestions[n]={...this._suggestions[n]??{},[e]:r};const a=Object.values(this._suggestions[n]??{}).flat();this.notifySuggestionsChanged(n,a,"static suggestions added")}};function tH(e){return"instructions"in e}function sPe(e){return"suggestions"in e}var aPe={name:"copilotkitSuggest",description:"Suggest what the user could say next",parameters:{type:"object",properties:{suggestions:{type:"array",description:"List of suggestions shown to the user as buttons.",items:{type:"object",properties:{title:{type:"string",description:"The title of the suggestion. This is shown as a button and should be short."},message:{type:"string",description:"The message to send when the suggestion is clicked. This should be a clear, complete sentence and will be sent as an instruction to the AI."}},required:["title","message"]}}},required:["suggestions"]}},oPe=class{constructor(e){yi(this,"_tools",[]);this.core=e}get tools(){return this._tools}initialize(e){this._tools=e}addTool(e){if(this._tools.findIndex(n=>n.name===e.name&&n.agentId===e.agentId)!==-1){GX.warn(`Tool already exists: '${e.name}' for agent '${e.agentId||"global"}', skipping.`);return}this._tools.push(e)}removeTool(e,t){this._tools=this._tools.filter(n=>t!==void 0?!(n.name===e&&n.agentId===t):!(n.name===e&&!n.agentId))}getTool(e){const{toolName:t,agentId:n}=e;if(n){const r=this._tools.find(a=>a.name===t&&a.agentId===n);if(r)return r}return this._tools.find(r=>r.name===t&&!r.agentId)}setTools(e){this._tools=[...e]}async connectAgent({agent:e}){try{await e.detachActiveRun(),e.setMessages([]),e.setState({}),e instanceof HA&&(e.headers={...this.core.headers});const t=await e.connectAgent({forwardedProps:this.core.properties,tools:this.buildFrontendTools(e.agentId)},this.createAgentErrorSubscriber(e));return this.processAgentResult({runAgentResult:t,agent:e})}catch(t){const n=t instanceof Error?t:new Error(String(t)),r={};throw e.agentId&&(r.agentId=e.agentId),await this.core.emitError({error:n,code:"agent_connect_failed",context:r}),t}}async runAgent({agent:e,withMessages:t}){e.agentId&&this.core.suggestionEngine.clearSuggestions(e.agentId),e instanceof HA&&(e.headers={...this.core.headers}),t&&e.addMessages(t);try{const n=await e.runAgent({forwardedProps:this.core.properties,tools:this.buildFrontendTools(e.agentId),context:Object.values(this.core.context)},this.createAgentErrorSubscriber(e));return this.processAgentResult({runAgentResult:n,agent:e})}catch(n){const r=n instanceof Error?n:new Error(String(n)),a={};throw e.agentId&&(a.agentId=e.agentId),t&&(a.messageCount=t.length),await this.core.emitError({error:r,code:"agent_run_failed",context:a}),n}}async processAgentResult({runAgentResult:e,agent:t}){const{newMessages:n}=e,r=t.agentId;let a=!1;for(const u of n)if(u.role==="assistant"){for(const f of u.toolCalls||[])if(n.findIndex(s=>s.role==="tool"&&s.toolCallId===f.id)===-1){const s=this.getTool({toolName:f.function.name,agentId:t.agentId});if(s)await this.executeSpecificTool(s,f,u,t,r)&&(a=!0);else{const v=this.getTool({toolName:"*",agentId:t.agentId});v&&await this.executeWildcardTool(v,f,u,t,r)&&(a=!0)}}}return a?await this.runAgent({agent:t}):(this.core.suggestionEngine.reloadSuggestions(r),e)}async executeSpecificTool(e,t,n,r,a){if(e!=null&&e.agentId&&e.agentId!==r.agentId)return!1;let u="",f,s=!1;if(e!=null&&e.handler){let v;try{v=JSON.parse(t.function.arguments)}catch(x){const A=x instanceof Error?x:new Error(String(x));f=A.message,s=!0,await this.core.emitError({error:A,code:"tool_argument_parse_failed",context:{agentId:a,toolCallId:t.id,toolName:t.function.name,rawArguments:t.function.arguments,toolType:"specific",messageId:n.id}})}if(await this.core.notifySubscribers(x=>{var A;return(A=x.onToolExecutionStart)==null?void 0:A.call(x,{copilotkit:this.core,toolCallId:t.id,agentId:a,toolName:t.function.name,args:v})},"Subscriber onToolExecutionStart error:"),!f)try{const x=await e.handler(v,t);x==null?u="":typeof x=="string"?u=x:u=JSON.stringify(x)}catch(x){const A=x instanceof Error?x:new Error(String(x));f=A.message,await this.core.emitError({error:A,code:"tool_handler_failed",context:{agentId:a,toolCallId:t.id,toolName:t.function.name,parsedArgs:v,toolType:"specific",messageId:n.id}})}if(f&&(u=`Error: ${f}`),await this.core.notifySubscribers(x=>{var A;return(A=x.onToolExecutionEnd)==null?void 0:A.call(x,{copilotkit:this.core,toolCallId:t.id,agentId:a,toolName:t.function.name,result:f?"":u,error:f})},"Subscriber onToolExecutionEnd error:"),s)throw new Error(f??"Tool execution failed")}if(!f||!s){const v=r.messages.findIndex(A=>A.id===n.id),x={id:nf(),role:"tool",toolCallId:t.id,content:u};if(r.messages.splice(v+1,0,x),!f&&(e==null?void 0:e.followUp)!==!1)return!0}return!1}async executeWildcardTool(e,t,n,r,a){if(e!=null&&e.agentId&&e.agentId!==r.agentId)return!1;let u="",f,s=!1;if(e!=null&&e.handler){let v;try{v=JSON.parse(t.function.arguments)}catch(A){const C=A instanceof Error?A:new Error(String(A));f=C.message,s=!0,await this.core.emitError({error:C,code:"tool_argument_parse_failed",context:{agentId:a,toolCallId:t.id,toolName:t.function.name,rawArguments:t.function.arguments,toolType:"wildcard",messageId:n.id}})}const x={toolName:t.function.name,args:v};if(await this.core.notifySubscribers(A=>{var C;return(C=A.onToolExecutionStart)==null?void 0:C.call(A,{copilotkit:this.core,toolCallId:t.id,agentId:a,toolName:t.function.name,args:x})},"Subscriber onToolExecutionStart error:"),!f)try{const A=await e.handler(x,t);A==null?u="":typeof A=="string"?u=A:u=JSON.stringify(A)}catch(A){const C=A instanceof Error?A:new Error(String(A));f=C.message,await this.core.emitError({error:C,code:"tool_handler_failed",context:{agentId:a,toolCallId:t.id,toolName:t.function.name,parsedArgs:x,toolType:"wildcard",messageId:n.id}})}if(f&&(u=`Error: ${f}`),await this.core.notifySubscribers(A=>{var C;return(C=A.onToolExecutionEnd)==null?void 0:C.call(A,{copilotkit:this.core,toolCallId:t.id,agentId:a,toolName:t.function.name,result:f?"":u,error:f})},"Subscriber onToolExecutionEnd error:"),s)throw new Error(f??"Tool execution failed")}if(!f||!s){const v=r.messages.findIndex(A=>A.id===n.id),x={id:nf(),role:"tool",toolCallId:t.id,content:u};if(r.messages.splice(v+1,0,x),!f&&(e==null?void 0:e.followUp)!==!1)return!0}return!1}buildFrontendTools(e){return this._tools.filter(t=>!t.agentId||t.agentId===e).map(t=>({name:t.name,description:t.description??"",parameters:lPe(t)}))}createAgentErrorSubscriber(e){const t=async(n,r,a={})=>{const u={...a};e.agentId&&(u.agentId=e.agentId),await this.core.emitError({error:n,code:r,context:u})};return{onRunFailed:async({error:n})=>{await t(n,"agent_run_failed_event",{source:"onRunFailed"})},onRunErrorEvent:async({event:n})=>{var f,s;const r=(n==null?void 0:n.rawEvent)instanceof Error?n.rawEvent:((f=n==null?void 0:n.rawEvent)==null?void 0:f.error)instanceof Error?n.rawEvent.error:void 0,a=typeof((s=n==null?void 0:n.rawEvent)==null?void 0:s.error)=="string"?n.rawEvent.error:(n==null?void 0:n.message)??"Agent run error",u=r??new Error(a);n!=null&&n.code&&!u.code&&(u.code=n.code),await t(u,"agent_run_error_event",{source:"onRunErrorEvent",event:n,runtimeErrorCode:n==null?void 0:n.code})}}}},nH={type:"object",properties:{}};function lPe(e){if(!e.parameters)return{...nH};const t=tPe(e.parameters,{$refStrategy:"none"});if(!t||typeof t!="object")return{...nH};const{$schema:n,...r}=t;return typeof r.type!="string"&&(r.type="object"),(typeof r.properties!="object"||r.properties===null)&&(r.properties={}),R8(r),r}function R8(e){if(!e||typeof e!="object")return;if(Array.isArray(e)){e.forEach(R8);return}const t=e;t.additionalProperties!==void 0&&delete t.additionalProperties;for(const n of Object.values(t))R8(n)}var uPe=class{constructor(e){yi(this,"stateByRun",new Map);yi(this,"messageToRun",new Map);yi(this,"agentSubscriptions",new Map);this.core=e}initialize(){}subscribeToAgent(e){if(!e.agentId)return;const t=e.agentId;this.unsubscribeFromAgent(t);const{unsubscribe:n}=e.subscribe({onRunStartedEvent:({event:r,state:a})=>{this.handleRunStarted(e,r,a)},onRunFinishedEvent:({event:r,state:a})=>{this.handleRunFinished(e,r,a)},onStateSnapshotEvent:({event:r,input:a,state:u})=>{this.handleStateSnapshot(e,r,a,u)},onStateDeltaEvent:({event:r,input:a,state:u})=>{this.handleStateDelta(e,r,a,u)},onMessagesSnapshotEvent:({event:r,input:a,messages:u})=>{this.handleMessagesSnapshot(e,r,a,u)},onNewMessage:({message:r,input:a})=>{this.handleNewMessage(e,r,a)}});this.agentSubscriptions.set(t,n)}unsubscribeFromAgent(e){const t=this.agentSubscriptions.get(e);t&&(t(),this.agentSubscriptions.delete(e))}getStateByRun(e,t,n){var a,u;const r=(u=(a=this.stateByRun.get(e))==null?void 0:a.get(t))==null?void 0:u.get(n);if(r)return JSON.parse(JSON.stringify(r))}getRunIdForMessage(e,t,n){var r,a;return(a=(r=this.messageToRun.get(e))==null?void 0:r.get(t))==null?void 0:a.get(n)}getStatesForThread(e,t){var n;return((n=this.stateByRun.get(e))==null?void 0:n.get(t))??new Map}getRunIdsForThread(e,t){var r;const n=(r=this.stateByRun.get(e))==null?void 0:r.get(t);return n?Array.from(n.keys()):[]}handleRunStarted(e,t,n){if(!e.agentId)return;const{threadId:r,runId:a}=t;this.saveState(e.agentId,r,a,n)}handleRunFinished(e,t,n){if(!e.agentId)return;const{threadId:r,runId:a}=t;this.saveState(e.agentId,r,a,n)}handleStateSnapshot(e,t,n,r){if(!e.agentId)return;const{threadId:a,runId:u}=n,f={...r,...t.snapshot};this.saveState(e.agentId,a,u,f)}handleStateDelta(e,t,n,r){if(!e.agentId)return;const{threadId:a,runId:u}=n;this.saveState(e.agentId,a,u,r)}handleMessagesSnapshot(e,t,n,r){if(!e.agentId)return;const{threadId:a,runId:u}=n;for(const f of t.messages)this.associateMessageWithRun(e.agentId,a,f.id,u)}handleNewMessage(e,t,n){if(!e.agentId||!n)return;const{threadId:r,runId:a}=n;this.associateMessageWithRun(e.agentId,r,t.id,a)}saveState(e,t,n,r){this.stateByRun.has(e)||this.stateByRun.set(e,new Map);const a=this.stateByRun.get(e);a.has(t)||a.set(t,new Map),a.get(t).set(n,JSON.parse(JSON.stringify(r)))}associateMessageWithRun(e,t,n,r){this.messageToRun.has(e)||this.messageToRun.set(e,new Map);const a=this.messageToRun.get(e);a.has(t)||a.set(t,new Map),a.get(t).set(n,r)}clearAgentState(e){this.stateByRun.delete(e),this.messageToRun.delete(e)}clearThreadState(e,t){var n,r;(n=this.stateByRun.get(e))==null||n.delete(t),(r=this.messageToRun.get(e))==null||r.delete(t)}},M8=(e=>(e.Disconnected="disconnected",e.Connected="connected",e.Connecting="connecting",e.Error="error",e))(M8||{}),cPe=class{constructor({runtimeUrl:e,runtimeTransport:t="rest",headers:n={},properties:r={},agents__unsafe_dev_only:a={},tools:u=[],suggestionsConfig:f=[]}){yi(this,"_headers");yi(this,"_properties");yi(this,"subscribers",new Set);yi(this,"agentRegistry");yi(this,"contextStore");yi(this,"suggestionEngine");yi(this,"runHandler");yi(this,"stateManager");this._headers=n,this._properties=r,this.agentRegistry=new nPe(this),this.contextStore=new rPe(this),this.suggestionEngine=new iPe(this),this.runHandler=new oPe(this),this.stateManager=new uPe(this),this.agentRegistry.initialize(a),this.runHandler.initialize(u),this.suggestionEngine.initialize(f),this.stateManager.initialize(),this.agentRegistry.setRuntimeTransport(t),this.agentRegistry.setRuntimeUrl(e),this.subscribe({onAgentsChanged:({agents:s})=>{Object.values(s).forEach(v=>{v.agentId&&this.stateManager.subscribeToAgent(v)})}})}async notifySubscribers(e,t){await Promise.all(Array.from(this.subscribers).map(async n=>{try{await e(n)}catch(r){console.error(t,r)}}))}async emitError({error:e,code:t,context:n={}}){await this.notifySubscribers(r=>{var a;return(a=r.onError)==null?void 0:a.call(r,{copilotkit:this,error:e,code:t,context:n})},"Subscriber onError error:")}get context(){return this.contextStore.context}get agents(){return this.agentRegistry.agents}get tools(){return this.runHandler.tools}get runtimeUrl(){return this.agentRegistry.runtimeUrl}setRuntimeUrl(e){this.agentRegistry.setRuntimeUrl(e)}get runtimeTransport(){return this.agentRegistry.runtimeTransport}setRuntimeTransport(e){this.agentRegistry.setRuntimeTransport(e)}get runtimeVersion(){return this.agentRegistry.runtimeVersion}get headers(){return this._headers}get properties(){return this._properties}get runtimeConnectionStatus(){return this.agentRegistry.runtimeConnectionStatus}setHeaders(e){this._headers=e,this.agentRegistry.applyHeadersToAgents(this.agentRegistry.agents),this.notifySubscribers(t=>{var n;return(n=t.onHeadersChanged)==null?void 0:n.call(t,{copilotkit:this,headers:this.headers})},"Subscriber onHeadersChanged error:")}setProperties(e){this._properties=e,this.notifySubscribers(t=>{var n;return(n=t.onPropertiesChanged)==null?void 0:n.call(t,{copilotkit:this,properties:this.properties})},"Subscriber onPropertiesChanged error:")}setAgents__unsafe_dev_only(e){this.agentRegistry.setAgents__unsafe_dev_only(e)}addAgent__unsafe_dev_only(e){this.agentRegistry.addAgent__unsafe_dev_only(e)}removeAgent__unsafe_dev_only(e){this.agentRegistry.removeAgent__unsafe_dev_only(e)}getAgent(e){return this.agentRegistry.getAgent(e)}addContext(e){return this.contextStore.addContext(e)}removeContext(e){this.contextStore.removeContext(e)}addSuggestionsConfig(e){return this.suggestionEngine.addSuggestionsConfig(e)}removeSuggestionsConfig(e){this.suggestionEngine.removeSuggestionsConfig(e)}reloadSuggestions(e){this.suggestionEngine.reloadSuggestions(e)}clearSuggestions(e){this.suggestionEngine.clearSuggestions(e)}getSuggestions(e){return this.suggestionEngine.getSuggestions(e)}addTool(e){this.runHandler.addTool(e)}removeTool(e,t){this.runHandler.removeTool(e,t)}getTool(e){return this.runHandler.getTool(e)}setTools(e){this.runHandler.setTools(e)}subscribe(e){return this.subscribers.add(e),{unsubscribe:()=>{this.subscribers.delete(e)}}}async connectAgent(e){return this.runHandler.connectAgent(e)}stopAgent(e){e.agent.abortRun()}async runAgent(e){return this.runHandler.runAgent(e)}getStateByRun(e,t,n){return this.stateManager.getStateByRun(e,t,n)}getRunIdForMessage(e,t,n){return this.stateManager.getRunIdForMessage(e,t,n)}getRunIdsForThread(e,t){return this.stateManager.getRunIdsForThread(e,t)}buildFrontendTools(e){return this.runHandler.buildFrontendTools(e)}},j4=(e=>(e.InProgress="inProgress",e.Executing="executing",e.Complete="complete",e))(j4||{}),Aa;(function(e){e.assertEqual=a=>{};function t(a){}e.assertIs=t;function n(a){throw new Error}e.assertNever=n,e.arrayToEnum=a=>{const u={};for(const f of a)u[f]=f;return u},e.getValidEnumValues=a=>{const u=e.objectKeys(a).filter(s=>typeof a[a[s]]!="number"),f={};for(const s of u)f[s]=a[s];return e.objectValues(f)},e.objectValues=a=>e.objectKeys(a).map(function(u){return a[u]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const u=[];for(const f in a)Object.prototype.hasOwnProperty.call(a,f)&&u.push(f);return u},e.find=(a,u)=>{for(const f of a)if(u(f))return f},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,u=" | "){return a.map(f=>typeof f=="string"?`'${f}'`:f).join(u)}e.joinValues=r,e.jsonStringifyReplacer=(a,u)=>typeof u=="bigint"?u.toString():u})(Aa||(Aa={}));var rH;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(rH||(rH={}));const oi=Aa.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Tm=e=>{switch(typeof e){case"undefined":return oi.undefined;case"string":return oi.string;case"number":return Number.isNaN(e)?oi.nan:oi.number;case"boolean":return oi.boolean;case"function":return oi.function;case"bigint":return oi.bigint;case"symbol":return oi.symbol;case"object":return Array.isArray(e)?oi.array:e===null?oi.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?oi.promise:typeof Map<"u"&&e instanceof Map?oi.map:typeof Set<"u"&&e instanceof Set?oi.set:typeof Date<"u"&&e instanceof Date?oi.date:oi.object;default:return oi.unknown}},vr=Aa.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class xp extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(u){return u.message},r={_errors:[]},a=u=>{for(const f of u.issues)if(f.code==="invalid_union")f.unionErrors.map(a);else if(f.code==="invalid_return_type")a(f.returnTypeError);else if(f.code==="invalid_arguments")a(f.argumentsError);else if(f.path.length===0)r._errors.push(n(f));else{let s=r,v=0;for(;v<f.path.length;){const x=f.path[v];v===f.path.length-1?(s[x]=s[x]||{_errors:[]},s[x]._errors.push(n(f))):s[x]=s[x]||{_errors:[]},s=s[x],v++}}};return a(this),r}static assert(t){if(!(t instanceof xp))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Aa.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const a of this.issues)if(a.path.length>0){const u=a.path[0];n[u]=n[u]||[],n[u].push(t(a))}else r.push(t(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}xp.create=e=>new xp(e);const P8=(e,t)=>{let n;switch(e.code){case vr.invalid_type:e.received===oi.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case vr.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,Aa.jsonStringifyReplacer)}`;break;case vr.unrecognized_keys:n=`Unrecognized key(s) in object: ${Aa.joinValues(e.keys,", ")}`;break;case vr.invalid_union:n="Invalid input";break;case vr.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Aa.joinValues(e.options)}`;break;case vr.invalid_enum_value:n=`Invalid enum value. Expected ${Aa.joinValues(e.options)}, received '${e.received}'`;break;case vr.invalid_arguments:n="Invalid function arguments";break;case vr.invalid_return_type:n="Invalid function return type";break;case vr.invalid_date:n="Invalid date";break;case vr.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:Aa.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case vr.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case vr.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case vr.custom:n="Invalid input";break;case vr.invalid_intersection_types:n="Intersection results could not be merged";break;case vr.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case vr.not_finite:n="Number must be finite";break;default:n=t.defaultError,Aa.assertNever(e)}return{message:n}};let dPe=P8;function hPe(){return dPe}const fPe=e=>{const{data:t,path:n,errorMaps:r,issueData:a}=e,u=[...n,...a.path||[]],f={...a,path:u};if(a.message!==void 0)return{...a,path:u,message:a.message};let s="";const v=r.filter(x=>!!x).slice().reverse();for(const x of v)s=x(f,{data:t,defaultError:s}).message;return{...a,path:u,message:s}};function Gr(e,t){const n=hPe(),r=fPe({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===P8?void 0:P8].filter(a=>!!a)});e.common.issues.push(r)}class Oc{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const a of n){if(a.status==="aborted")return xs;a.status==="dirty"&&t.dirty(),r.push(a.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const a of n){const u=await a.key,f=await a.value;r.push({key:u,value:f})}return Oc.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const a of n){const{key:u,value:f}=a;if(u.status==="aborted"||f.status==="aborted")return xs;u.status==="dirty"&&t.dirty(),f.status==="dirty"&&t.dirty(),u.value!=="__proto__"&&(typeof f.value<"u"||a.alwaysSet)&&(r[u.value]=f.value)}return{status:t.value,value:r}}}const xs=Object.freeze({status:"aborted"}),Xw=e=>({status:"dirty",value:e}),yd=e=>({status:"valid",value:e}),iH=e=>e.status==="aborted",sH=e=>e.status==="dirty",$v=e=>e.status==="valid",gC=e=>typeof Promise<"u"&&e instanceof Promise;var gi;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(gi||(gi={}));class m0{constructor(t,n,r,a){this._cachedPath=[],this.parent=t,this.data=n,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const aH=(e,t)=>{if($v(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new xp(e.common.issues);return this._error=n,this._error}}};function Xs(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:a}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(f,s)=>{const{message:v}=e;return f.code==="invalid_enum_value"?{message:v??s.defaultError}:typeof s.data>"u"?{message:v??r??s.defaultError}:f.code!=="invalid_type"?{message:s.defaultError}:{message:v??n??s.defaultError}},description:a}}class Ta{get description(){return this._def.description}_getType(t){return Tm(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:Tm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Oc,ctx:{common:t.parent.common,data:t.data,parsedType:Tm(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(gC(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){const r={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Tm(t)},a=this._parseSync({data:t,path:r.path,parent:r});return aH(r,a)}"~validate"(t){var r,a;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Tm(t)};if(!this["~standard"].async)try{const u=this._parseSync({data:t,path:[],parent:n});return $v(u)?{value:u.value}:{issues:n.common.issues}}catch(u){(a=(r=u==null?void 0:u.message)==null?void 0:r.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:n}).then(u=>$v(u)?{value:u.value}:{issues:n.common.issues})}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Tm(t)},a=this._parse({data:t,path:r.path,parent:r}),u=await(gC(a)?a:Promise.resolve(a));return aH(r,u)}refine(t,n){const r=a=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,u)=>{const f=t(a),s=()=>u.addIssue({code:vr.custom,...r(a)});return typeof Promise<"u"&&f instanceof Promise?f.then(v=>v?!0:(s(),!1)):f?!0:(s(),!1)})}refinement(t,n){return this._refinement((r,a)=>t(r)?!0:(a.addIssue(typeof n=="function"?n(r,a):n),!1))}_refinement(t){return new Gv({schema:this,typeName:bs.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Jm.create(this,this._def)}nullable(){return qv.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return sf.create(this)}promise(){return xC.create(this,this._def)}or(t){return yC.create([this,t],this._def)}and(t){return vC.create(this,t,this._def)}transform(t){return new Gv({...Xs(this._def),schema:this,typeName:bs.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new D8({...Xs(this._def),innerType:this,defaultValue:n,typeName:bs.ZodDefault})}brand(){return new NPe({typeName:bs.ZodBranded,type:this,...Xs(this._def)})}catch(t){const n=typeof t=="function"?t:()=>t;return new N8({...Xs(this._def),innerType:this,catchValue:n,typeName:bs.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return ND.create(this,t)}readonly(){return z8.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const pPe=/^c[^\s-]{8,}$/i,mPe=/^[0-9a-z]+$/,gPe=/^[0-9A-HJKMNP-TV-Z]{26}$/i,_Pe=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,yPe=/^[a-z0-9_-]{21}$/i,vPe=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,xPe=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,bPe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,wPe="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let yR;const TPe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,EPe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,SPe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,APe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,CPe=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,kPe=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ane="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",IPe=new RegExp(`^${ane}$`);function one(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function RPe(e){return new RegExp(`^${one(e)}$`)}function MPe(e){let t=`${ane}T${one(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function PPe(e,t){return!!((t==="v4"||!t)&&TPe.test(e)||(t==="v6"||!t)&&SPe.test(e))}function OPe(e,t){if(!vPe.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||t&&a.alg!==t)}catch{return!1}}function LPe(e,t){return!!((t==="v4"||!t)&&EPe.test(e)||(t==="v6"||!t)&&APe.test(e))}class Lg extends Ta{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==oi.string){const u=this._getOrReturnCtx(t);return Gr(u,{code:vr.invalid_type,expected:oi.string,received:u.parsedType}),xs}const r=new Oc;let a;for(const u of this._def.checks)if(u.kind==="min")t.data.length<u.value&&(a=this._getOrReturnCtx(t,a),Gr(a,{code:vr.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),r.dirty());else if(u.kind==="max")t.data.length>u.value&&(a=this._getOrReturnCtx(t,a),Gr(a,{code:vr.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),r.dirty());else if(u.kind==="length"){const f=t.data.length>u.value,s=t.data.length<u.value;(f||s)&&(a=this._getOrReturnCtx(t,a),f?Gr(a,{code:vr.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}):s&&Gr(a,{code:vr.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}),r.dirty())}else if(u.kind==="email")bPe.test(t.data)||(a=this._getOrReturnCtx(t,a),Gr(a,{validation:"email",code:vr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="emoji")yR||(yR=new RegExp(wPe,"u")),yR.test(t.data)||(a=this._getOrReturnCtx(t,a),Gr(a,{validation:"emoji",code:vr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="uuid")_Pe.test(t.data)||(a=this._getOrReturnCtx(t,a),Gr(a,{validation:"uuid",code:vr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="nanoid")yPe.test(t.data)||(a=this._getOrReturnCtx(t,a),Gr(a,{validation:"nanoid",code:vr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="cuid")pPe.test(t.data)||(a=this._getOrReturnCtx(t,a),Gr(a,{validation:"cuid",code:vr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="cuid2")mPe.test(t.data)||(a=this._getOrReturnCtx(t,a),Gr(a,{validation:"cuid2",code:vr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="ulid")gPe.test(t.data)||(a=this._getOrReturnCtx(t,a),Gr(a,{validation:"ulid",code:vr.invalid_string,message:u.message}),r.dirty());else if(u.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),Gr(a,{validation:"url",code:vr.invalid_string,message:u.message}),r.dirty()}else u.kind==="regex"?(u.regex.lastIndex=0,u.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),Gr(a,{validation:"regex",code:vr.invalid_string,message:u.message}),r.dirty())):u.kind==="trim"?t.data=t.data.trim():u.kind==="includes"?t.data.includes(u.value,u.position)||(a=this._getOrReturnCtx(t,a),Gr(a,{code:vr.invalid_string,validation:{includes:u.value,position:u.position},message:u.message}),r.dirty()):u.kind==="toLowerCase"?t.data=t.data.toLowerCase():u.kind==="toUpperCase"?t.data=t.data.toUpperCase():u.kind==="startsWith"?t.data.startsWith(u.value)||(a=this._getOrReturnCtx(t,a),Gr(a,{code:vr.invalid_string,validation:{startsWith:u.value},message:u.message}),r.dirty()):u.kind==="endsWith"?t.data.endsWith(u.value)||(a=this._getOrReturnCtx(t,a),Gr(a,{code:vr.invalid_string,validation:{endsWith:u.value},message:u.message}),r.dirty()):u.kind==="datetime"?MPe(u).test(t.data)||(a=this._getOrReturnCtx(t,a),Gr(a,{code:vr.invalid_string,validation:"datetime",message:u.message}),r.dirty()):u.kind==="date"?IPe.test(t.data)||(a=this._getOrReturnCtx(t,a),Gr(a,{code:vr.invalid_string,validation:"date",message:u.message}),r.dirty()):u.kind==="time"?RPe(u).test(t.data)||(a=this._getOrReturnCtx(t,a),Gr(a,{code:vr.invalid_string,validation:"time",message:u.message}),r.dirty()):u.kind==="duration"?xPe.test(t.data)||(a=this._getOrReturnCtx(t,a),Gr(a,{validation:"duration",code:vr.invalid_string,message:u.message}),r.dirty()):u.kind==="ip"?PPe(t.data,u.version)||(a=this._getOrReturnCtx(t,a),Gr(a,{validation:"ip",code:vr.invalid_string,message:u.message}),r.dirty()):u.kind==="jwt"?OPe(t.data,u.alg)||(a=this._getOrReturnCtx(t,a),Gr(a,{validation:"jwt",code:vr.invalid_string,message:u.message}),r.dirty()):u.kind==="cidr"?LPe(t.data,u.version)||(a=this._getOrReturnCtx(t,a),Gr(a,{validation:"cidr",code:vr.invalid_string,message:u.message}),r.dirty()):u.kind==="base64"?CPe.test(t.data)||(a=this._getOrReturnCtx(t,a),Gr(a,{validation:"base64",code:vr.invalid_string,message:u.message}),r.dirty()):u.kind==="base64url"?kPe.test(t.data)||(a=this._getOrReturnCtx(t,a),Gr(a,{validation:"base64url",code:vr.invalid_string,message:u.message}),r.dirty()):Aa.assertNever(u);return{status:r.value,value:t.data}}_regex(t,n,r){return this.refinement(a=>t.test(a),{validation:n,code:vr.invalid_string,...gi.errToObj(r)})}_addCheck(t){return new Lg({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...gi.errToObj(t)})}url(t){return this._addCheck({kind:"url",...gi.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...gi.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...gi.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...gi.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...gi.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...gi.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...gi.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...gi.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...gi.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...gi.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...gi.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...gi.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...gi.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...gi.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...gi.errToObj(t)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...gi.errToObj(n)})}includes(t,n){return this._addCheck({kind:"includes",value:t,position:n==null?void 0:n.position,...gi.errToObj(n==null?void 0:n.message)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...gi.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...gi.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...gi.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...gi.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...gi.errToObj(n)})}nonempty(t){return this.min(1,gi.errToObj(t))}trim(){return new Lg({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Lg({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Lg({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}Lg.create=e=>new Lg({checks:[],typeName:bs.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...Xs(e)});function DPe(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,a=n>r?n:r,u=Number.parseInt(e.toFixed(a).replace(".","")),f=Number.parseInt(t.toFixed(a).replace(".",""));return u%f/10**a}class sT extends Ta{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==oi.number){const u=this._getOrReturnCtx(t);return Gr(u,{code:vr.invalid_type,expected:oi.number,received:u.parsedType}),xs}let r;const a=new Oc;for(const u of this._def.checks)u.kind==="int"?Aa.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),Gr(r,{code:vr.invalid_type,expected:"integer",received:"float",message:u.message}),a.dirty()):u.kind==="min"?(u.inclusive?t.data<u.value:t.data<=u.value)&&(r=this._getOrReturnCtx(t,r),Gr(r,{code:vr.too_small,minimum:u.value,type:"number",inclusive:u.inclusive,exact:!1,message:u.message}),a.dirty()):u.kind==="max"?(u.inclusive?t.data>u.value:t.data>=u.value)&&(r=this._getOrReturnCtx(t,r),Gr(r,{code:vr.too_big,maximum:u.value,type:"number",inclusive:u.inclusive,exact:!1,message:u.message}),a.dirty()):u.kind==="multipleOf"?DPe(t.data,u.value)!==0&&(r=this._getOrReturnCtx(t,r),Gr(r,{code:vr.not_multiple_of,multipleOf:u.value,message:u.message}),a.dirty()):u.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),Gr(r,{code:vr.not_finite,message:u.message}),a.dirty()):Aa.assertNever(u);return{status:a.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,gi.toString(n))}gt(t,n){return this.setLimit("min",t,!1,gi.toString(n))}lte(t,n){return this.setLimit("max",t,!0,gi.toString(n))}lt(t,n){return this.setLimit("max",t,!1,gi.toString(n))}setLimit(t,n,r,a){return new sT({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:gi.toString(a)}]})}_addCheck(t){return new sT({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:gi.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:gi.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:gi.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:gi.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:gi.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:gi.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:gi.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:gi.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:gi.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Aa.isInteger(t.value))}get isFinite(){let t=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(n)&&Number.isFinite(t)}}sT.create=e=>new sT({checks:[],typeName:bs.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...Xs(e)});class aT extends Ta{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==oi.bigint)return this._getInvalidInput(t);let r;const a=new Oc;for(const u of this._def.checks)u.kind==="min"?(u.inclusive?t.data<u.value:t.data<=u.value)&&(r=this._getOrReturnCtx(t,r),Gr(r,{code:vr.too_small,type:"bigint",minimum:u.value,inclusive:u.inclusive,message:u.message}),a.dirty()):u.kind==="max"?(u.inclusive?t.data>u.value:t.data>=u.value)&&(r=this._getOrReturnCtx(t,r),Gr(r,{code:vr.too_big,type:"bigint",maximum:u.value,inclusive:u.inclusive,message:u.message}),a.dirty()):u.kind==="multipleOf"?t.data%u.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),Gr(r,{code:vr.not_multiple_of,multipleOf:u.value,message:u.message}),a.dirty()):Aa.assertNever(u);return{status:a.value,value:t.data}}_getInvalidInput(t){const n=this._getOrReturnCtx(t);return Gr(n,{code:vr.invalid_type,expected:oi.bigint,received:n.parsedType}),xs}gte(t,n){return this.setLimit("min",t,!0,gi.toString(n))}gt(t,n){return this.setLimit("min",t,!1,gi.toString(n))}lte(t,n){return this.setLimit("max",t,!0,gi.toString(n))}lt(t,n){return this.setLimit("max",t,!1,gi.toString(n))}setLimit(t,n,r,a){return new aT({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:gi.toString(a)}]})}_addCheck(t){return new aT({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:gi.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:gi.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:gi.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:gi.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:gi.toString(n)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}aT.create=e=>new aT({checks:[],typeName:bs.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...Xs(e)});class oH extends Ta{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==oi.boolean){const r=this._getOrReturnCtx(t);return Gr(r,{code:vr.invalid_type,expected:oi.boolean,received:r.parsedType}),xs}return yd(t.data)}}oH.create=e=>new oH({typeName:bs.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...Xs(e)});class _C extends Ta{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==oi.date){const u=this._getOrReturnCtx(t);return Gr(u,{code:vr.invalid_type,expected:oi.date,received:u.parsedType}),xs}if(Number.isNaN(t.data.getTime())){const u=this._getOrReturnCtx(t);return Gr(u,{code:vr.invalid_date}),xs}const r=new Oc;let a;for(const u of this._def.checks)u.kind==="min"?t.data.getTime()<u.value&&(a=this._getOrReturnCtx(t,a),Gr(a,{code:vr.too_small,message:u.message,inclusive:!0,exact:!1,minimum:u.value,type:"date"}),r.dirty()):u.kind==="max"?t.data.getTime()>u.value&&(a=this._getOrReturnCtx(t,a),Gr(a,{code:vr.too_big,message:u.message,inclusive:!0,exact:!1,maximum:u.value,type:"date"}),r.dirty()):Aa.assertNever(u);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new _C({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:gi.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:gi.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}}_C.create=e=>new _C({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:bs.ZodDate,...Xs(e)});class lH extends Ta{_parse(t){if(this._getType(t)!==oi.symbol){const r=this._getOrReturnCtx(t);return Gr(r,{code:vr.invalid_type,expected:oi.symbol,received:r.parsedType}),xs}return yd(t.data)}}lH.create=e=>new lH({typeName:bs.ZodSymbol,...Xs(e)});class uH extends Ta{_parse(t){if(this._getType(t)!==oi.undefined){const r=this._getOrReturnCtx(t);return Gr(r,{code:vr.invalid_type,expected:oi.undefined,received:r.parsedType}),xs}return yd(t.data)}}uH.create=e=>new uH({typeName:bs.ZodUndefined,...Xs(e)});class cH extends Ta{_parse(t){if(this._getType(t)!==oi.null){const r=this._getOrReturnCtx(t);return Gr(r,{code:vr.invalid_type,expected:oi.null,received:r.parsedType}),xs}return yd(t.data)}}cH.create=e=>new cH({typeName:bs.ZodNull,...Xs(e)});class O8 extends Ta{constructor(){super(...arguments),this._any=!0}_parse(t){return yd(t.data)}}O8.create=e=>new O8({typeName:bs.ZodAny,...Xs(e)});class dH extends Ta{constructor(){super(...arguments),this._unknown=!0}_parse(t){return yd(t.data)}}dH.create=e=>new dH({typeName:bs.ZodUnknown,...Xs(e)});class g0 extends Ta{_parse(t){const n=this._getOrReturnCtx(t);return Gr(n,{code:vr.invalid_type,expected:oi.never,received:n.parsedType}),xs}}g0.create=e=>new g0({typeName:bs.ZodNever,...Xs(e)});class hH extends Ta{_parse(t){if(this._getType(t)!==oi.undefined){const r=this._getOrReturnCtx(t);return Gr(r,{code:vr.invalid_type,expected:oi.void,received:r.parsedType}),xs}return yd(t.data)}}hH.create=e=>new hH({typeName:bs.ZodVoid,...Xs(e)});class sf extends Ta{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),a=this._def;if(n.parsedType!==oi.array)return Gr(n,{code:vr.invalid_type,expected:oi.array,received:n.parsedType}),xs;if(a.exactLength!==null){const f=n.data.length>a.exactLength.value,s=n.data.length<a.exactLength.value;(f||s)&&(Gr(n,{code:f?vr.too_big:vr.too_small,minimum:s?a.exactLength.value:void 0,maximum:f?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(Gr(n,{code:vr.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(Gr(n,{code:vr.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((f,s)=>a.type._parseAsync(new m0(n,f,n.path,s)))).then(f=>Oc.mergeArray(r,f));const u=[...n.data].map((f,s)=>a.type._parseSync(new m0(n,f,n.path,s)));return Oc.mergeArray(r,u)}get element(){return this._def.type}min(t,n){return new sf({...this._def,minLength:{value:t,message:gi.toString(n)}})}max(t,n){return new sf({...this._def,maxLength:{value:t,message:gi.toString(n)}})}length(t,n){return new sf({...this._def,exactLength:{value:t,message:gi.toString(n)}})}nonempty(t){return this.min(1,t)}}sf.create=(e,t)=>new sf({type:e,minLength:null,maxLength:null,exactLength:null,typeName:bs.ZodArray,...Xs(t)});function P1(e){if(e instanceof cl){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=Jm.create(P1(r))}return new cl({...e._def,shape:()=>t})}else return e instanceof sf?new sf({...e._def,type:P1(e.element)}):e instanceof Jm?Jm.create(P1(e.unwrap())):e instanceof qv?qv.create(P1(e.unwrap())):e instanceof m_?m_.create(e.items.map(t=>P1(t))):e}class cl extends Ta{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=Aa.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==oi.object){const x=this._getOrReturnCtx(t);return Gr(x,{code:vr.invalid_type,expected:oi.object,received:x.parsedType}),xs}const{status:r,ctx:a}=this._processInputParams(t),{shape:u,keys:f}=this._getCached(),s=[];if(!(this._def.catchall instanceof g0&&this._def.unknownKeys==="strip"))for(const x in a.data)f.includes(x)||s.push(x);const v=[];for(const x of f){const A=u[x],C=a.data[x];v.push({key:{status:"valid",value:x},value:A._parse(new m0(a,C,a.path,x)),alwaysSet:x in a.data})}if(this._def.catchall instanceof g0){const x=this._def.unknownKeys;if(x==="passthrough")for(const A of s)v.push({key:{status:"valid",value:A},value:{status:"valid",value:a.data[A]}});else if(x==="strict")s.length>0&&(Gr(a,{code:vr.unrecognized_keys,keys:s}),r.dirty());else if(x!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const x=this._def.catchall;for(const A of s){const C=a.data[A];v.push({key:{status:"valid",value:A},value:x._parse(new m0(a,C,a.path,A)),alwaysSet:A in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const x=[];for(const A of v){const C=await A.key,P=await A.value;x.push({key:C,value:P,alwaysSet:A.alwaysSet})}return x}).then(x=>Oc.mergeObjectSync(r,x)):Oc.mergeObjectSync(r,v)}get shape(){return this._def.shape()}strict(t){return gi.errToObj,new cl({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,r)=>{var u,f;const a=((f=(u=this._def).errorMap)==null?void 0:f.call(u,n,r).message)??r.defaultError;return n.code==="unrecognized_keys"?{message:gi.errToObj(t).message??a}:{message:a}}}:{}})}strip(){return new cl({...this._def,unknownKeys:"strip"})}passthrough(){return new cl({...this._def,unknownKeys:"passthrough"})}extend(t){return new cl({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new cl({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:bs.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new cl({...this._def,catchall:t})}pick(t){const n={};for(const r of Aa.objectKeys(t))t[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new cl({...this._def,shape:()=>n})}omit(t){const n={};for(const r of Aa.objectKeys(this.shape))t[r]||(n[r]=this.shape[r]);return new cl({...this._def,shape:()=>n})}deepPartial(){return P1(this)}partial(t){const n={};for(const r of Aa.objectKeys(this.shape)){const a=this.shape[r];t&&!t[r]?n[r]=a:n[r]=a.optional()}return new cl({...this._def,shape:()=>n})}required(t){const n={};for(const r of Aa.objectKeys(this.shape))if(t&&!t[r])n[r]=this.shape[r];else{let u=this.shape[r];for(;u instanceof Jm;)u=u._def.innerType;n[r]=u}return new cl({...this._def,shape:()=>n})}keyof(){return lne(Aa.objectKeys(this.shape))}}cl.create=(e,t)=>new cl({shape:()=>e,unknownKeys:"strip",catchall:g0.create(),typeName:bs.ZodObject,...Xs(t)});cl.strictCreate=(e,t)=>new cl({shape:()=>e,unknownKeys:"strict",catchall:g0.create(),typeName:bs.ZodObject,...Xs(t)});cl.lazycreate=(e,t)=>new cl({shape:e,unknownKeys:"strip",catchall:g0.create(),typeName:bs.ZodObject,...Xs(t)});class yC extends Ta{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function a(u){for(const s of u)if(s.result.status==="valid")return s.result;for(const s of u)if(s.result.status==="dirty")return n.common.issues.push(...s.ctx.common.issues),s.result;const f=u.map(s=>new xp(s.ctx.common.issues));return Gr(n,{code:vr.invalid_union,unionErrors:f}),xs}if(n.common.async)return Promise.all(r.map(async u=>{const f={...n,common:{...n.common,issues:[]},parent:null};return{result:await u._parseAsync({data:n.data,path:n.path,parent:f}),ctx:f}})).then(a);{let u;const f=[];for(const v of r){const x={...n,common:{...n.common,issues:[]},parent:null},A=v._parseSync({data:n.data,path:n.path,parent:x});if(A.status==="valid")return A;A.status==="dirty"&&!u&&(u={result:A,ctx:x}),x.common.issues.length&&f.push(x.common.issues)}if(u)return n.common.issues.push(...u.ctx.common.issues),u.result;const s=f.map(v=>new xp(v));return Gr(n,{code:vr.invalid_union,unionErrors:s}),xs}}get options(){return this._def.options}}yC.create=(e,t)=>new yC({options:e,typeName:bs.ZodUnion,...Xs(t)});function L8(e,t){const n=Tm(e),r=Tm(t);if(e===t)return{valid:!0,data:e};if(n===oi.object&&r===oi.object){const a=Aa.objectKeys(t),u=Aa.objectKeys(e).filter(s=>a.indexOf(s)!==-1),f={...e,...t};for(const s of u){const v=L8(e[s],t[s]);if(!v.valid)return{valid:!1};f[s]=v.data}return{valid:!0,data:f}}else if(n===oi.array&&r===oi.array){if(e.length!==t.length)return{valid:!1};const a=[];for(let u=0;u<e.length;u++){const f=e[u],s=t[u],v=L8(f,s);if(!v.valid)return{valid:!1};a.push(v.data)}return{valid:!0,data:a}}else return n===oi.date&&r===oi.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class vC extends Ta{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=(u,f)=>{if(iH(u)||iH(f))return xs;const s=L8(u.value,f.value);return s.valid?((sH(u)||sH(f))&&n.dirty(),{status:n.value,value:s.data}):(Gr(r,{code:vr.invalid_intersection_types}),xs)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([u,f])=>a(u,f)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}vC.create=(e,t,n)=>new vC({left:e,right:t,typeName:bs.ZodIntersection,...Xs(n)});class m_ extends Ta{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==oi.array)return Gr(r,{code:vr.invalid_type,expected:oi.array,received:r.parsedType}),xs;if(r.data.length<this._def.items.length)return Gr(r,{code:vr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),xs;!this._def.rest&&r.data.length>this._def.items.length&&(Gr(r,{code:vr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const u=[...r.data].map((f,s)=>{const v=this._def.items[s]||this._def.rest;return v?v._parse(new m0(r,f,r.path,s)):null}).filter(f=>!!f);return r.common.async?Promise.all(u).then(f=>Oc.mergeArray(n,f)):Oc.mergeArray(n,u)}get items(){return this._def.items}rest(t){return new m_({...this._def,rest:t})}}m_.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new m_({items:e,typeName:bs.ZodTuple,rest:null,...Xs(t)})};class fH extends Ta{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==oi.map)return Gr(r,{code:vr.invalid_type,expected:oi.map,received:r.parsedType}),xs;const a=this._def.keyType,u=this._def.valueType,f=[...r.data.entries()].map(([s,v],x)=>({key:a._parse(new m0(r,s,r.path,[x,"key"])),value:u._parse(new m0(r,v,r.path,[x,"value"]))}));if(r.common.async){const s=new Map;return Promise.resolve().then(async()=>{for(const v of f){const x=await v.key,A=await v.value;if(x.status==="aborted"||A.status==="aborted")return xs;(x.status==="dirty"||A.status==="dirty")&&n.dirty(),s.set(x.value,A.value)}return{status:n.value,value:s}})}else{const s=new Map;for(const v of f){const x=v.key,A=v.value;if(x.status==="aborted"||A.status==="aborted")return xs;(x.status==="dirty"||A.status==="dirty")&&n.dirty(),s.set(x.value,A.value)}return{status:n.value,value:s}}}}fH.create=(e,t,n)=>new fH({valueType:t,keyType:e,typeName:bs.ZodMap,...Xs(n)});class oT extends Ta{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==oi.set)return Gr(r,{code:vr.invalid_type,expected:oi.set,received:r.parsedType}),xs;const a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(Gr(r,{code:vr.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(Gr(r,{code:vr.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());const u=this._def.valueType;function f(v){const x=new Set;for(const A of v){if(A.status==="aborted")return xs;A.status==="dirty"&&n.dirty(),x.add(A.value)}return{status:n.value,value:x}}const s=[...r.data.values()].map((v,x)=>u._parse(new m0(r,v,r.path,x)));return r.common.async?Promise.all(s).then(v=>f(v)):f(s)}min(t,n){return new oT({...this._def,minSize:{value:t,message:gi.toString(n)}})}max(t,n){return new oT({...this._def,maxSize:{value:t,message:gi.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}}oT.create=(e,t)=>new oT({valueType:e,minSize:null,maxSize:null,typeName:bs.ZodSet,...Xs(t)});class pH extends Ta{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}pH.create=(e,t)=>new pH({getter:e,typeName:bs.ZodLazy,...Xs(t)});class mH extends Ta{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return Gr(n,{received:n.data,code:vr.invalid_literal,expected:this._def.value}),xs}return{status:"valid",value:t.data}}get value(){return this._def.value}}mH.create=(e,t)=>new mH({value:e,typeName:bs.ZodLiteral,...Xs(t)});function lne(e,t){return new Hv({values:e,typeName:bs.ZodEnum,...Xs(t)})}class Hv extends Ta{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return Gr(n,{expected:Aa.joinValues(r),received:n.parsedType,code:vr.invalid_type}),xs}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const n=this._getOrReturnCtx(t),r=this._def.values;return Gr(n,{received:n.data,code:vr.invalid_enum_value,options:r}),xs}return yd(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return Hv.create(t,{...this._def,...n})}exclude(t,n=this._def){return Hv.create(this.options.filter(r=>!t.includes(r)),{...this._def,...n})}}Hv.create=lne;class gH extends Ta{_parse(t){const n=Aa.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==oi.string&&r.parsedType!==oi.number){const a=Aa.objectValues(n);return Gr(r,{expected:Aa.joinValues(a),received:r.parsedType,code:vr.invalid_type}),xs}if(this._cache||(this._cache=new Set(Aa.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const a=Aa.objectValues(n);return Gr(r,{received:r.data,code:vr.invalid_enum_value,options:a}),xs}return yd(t.data)}get enum(){return this._def.values}}gH.create=(e,t)=>new gH({values:e,typeName:bs.ZodNativeEnum,...Xs(t)});class xC extends Ta{unwrap(){return this._def.type}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==oi.promise&&n.common.async===!1)return Gr(n,{code:vr.invalid_type,expected:oi.promise,received:n.parsedType}),xs;const r=n.parsedType===oi.promise?n.data:Promise.resolve(n.data);return yd(r.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}}xC.create=(e,t)=>new xC({type:e,typeName:bs.ZodPromise,...Xs(t)});class Gv extends Ta{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===bs.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=this._def.effect||null,u={addIssue:f=>{Gr(r,f),f.fatal?n.abort():n.dirty()},get path(){return r.path}};if(u.addIssue=u.addIssue.bind(u),a.type==="preprocess"){const f=a.transform(r.data,u);if(r.common.async)return Promise.resolve(f).then(async s=>{if(n.value==="aborted")return xs;const v=await this._def.schema._parseAsync({data:s,path:r.path,parent:r});return v.status==="aborted"?xs:v.status==="dirty"||n.value==="dirty"?Xw(v.value):v});{if(n.value==="aborted")return xs;const s=this._def.schema._parseSync({data:f,path:r.path,parent:r});return s.status==="aborted"?xs:s.status==="dirty"||n.value==="dirty"?Xw(s.value):s}}if(a.type==="refinement"){const f=s=>{const v=a.refinement(s,u);if(r.common.async)return Promise.resolve(v);if(v instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(r.common.async===!1){const s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?xs:(s.status==="dirty"&&n.dirty(),f(s.value),{status:n.value,value:s.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(s=>s.status==="aborted"?xs:(s.status==="dirty"&&n.dirty(),f(s.value).then(()=>({status:n.value,value:s.value}))))}if(a.type==="transform")if(r.common.async===!1){const f=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!$v(f))return xs;const s=a.transform(f.value,u);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:s}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(f=>$v(f)?Promise.resolve(a.transform(f.value,u)).then(s=>({status:n.value,value:s})):xs);Aa.assertNever(a)}}Gv.create=(e,t,n)=>new Gv({schema:e,typeName:bs.ZodEffects,effect:t,...Xs(n)});Gv.createWithPreprocess=(e,t,n)=>new Gv({schema:t,effect:{type:"preprocess",transform:e},typeName:bs.ZodEffects,...Xs(n)});class Jm extends Ta{_parse(t){return this._getType(t)===oi.undefined?yd(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Jm.create=(e,t)=>new Jm({innerType:e,typeName:bs.ZodOptional,...Xs(t)});class qv extends Ta{_parse(t){return this._getType(t)===oi.null?yd(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}qv.create=(e,t)=>new qv({innerType:e,typeName:bs.ZodNullable,...Xs(t)});class D8 extends Ta{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===oi.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}D8.create=(e,t)=>new D8({innerType:e,typeName:bs.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...Xs(t)});class N8 extends Ta{_parse(t){const{ctx:n}=this._processInputParams(t),r={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return gC(a)?a.then(u=>({status:"valid",value:u.status==="valid"?u.value:this._def.catchValue({get error(){return new xp(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new xp(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}N8.create=(e,t)=>new N8({innerType:e,typeName:bs.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...Xs(t)});class _H extends Ta{_parse(t){if(this._getType(t)!==oi.nan){const r=this._getOrReturnCtx(t);return Gr(r,{code:vr.invalid_type,expected:oi.nan,received:r.parsedType}),xs}return{status:"valid",value:t.data}}}_H.create=e=>new _H({typeName:bs.ZodNaN,...Xs(e)});class NPe extends Ta{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class ND extends Ta{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const u=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return u.status==="aborted"?xs:u.status==="dirty"?(n.dirty(),Xw(u.value)):this._def.out._parseAsync({data:u.value,path:r.path,parent:r})})();{const a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?xs:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(t,n){return new ND({in:t,out:n,typeName:bs.ZodPipeline})}}class z8 extends Ta{_parse(t){const n=this._def.innerType._parse(t),r=a=>($v(a)&&(a.value=Object.freeze(a.value)),a);return gC(n)?n.then(a=>r(a)):r(n)}unwrap(){return this._def.innerType}}z8.create=(e,t)=>new z8({innerType:e,typeName:bs.ZodReadonly,...Xs(t)});var bs;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(bs||(bs={}));const une=O8.create;g0.create;sf.create;yC.create;vC.create;m_.create;Hv.create;xC.create;Jm.create;qv.create;/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const zPe=new Set(["children","localName","ref","style","className"]),yH=new WeakMap,vH=(e,t,n,r,a)=>{const u=a==null?void 0:a[t];u===void 0?(e[t]=n,n==null&&t in HTMLElement.prototype&&e.removeAttribute(t)):n!==r&&((f,s,v)=>{let x=yH.get(f);x===void 0&&yH.set(f,x=new Map);let A=x.get(s);v!==void 0?A===void 0?(x.set(s,A={handleEvent:v}),f.addEventListener(s,A)):A.handleEvent=v:A!==void 0&&(x.delete(s),f.removeEventListener(s,A))})(e,u,n)},FPe=({react:e,tagName:t,elementClass:n,events:r,displayName:a})=>{const u=new Set(Object.keys(r??{})),f=e.forwardRef((s,v)=>{const x=e.useRef(new Map),A=e.useRef(null),C={},P={};for(const[L,F]of Object.entries(s))zPe.has(L)?C[L==="className"?"class":L]=F:u.has(L)||L in n.prototype?P[L]=F:C[L]=F;return e.useLayoutEffect(()=>{if(A.current===null)return;const L=new Map;for(const F in P)vH(A.current,F,s[F],x.current.get(F),r),x.current.delete(F),L.set(F,s[F]);for(const[F,U]of x.current)vH(A.current,F,void 0,U,r);x.current=L}),e.useLayoutEffect(()=>{var L;(L=A.current)==null||L.removeAttribute("defer-hydration")},[]),C.suppressHydrationWarning=!0,e.createElement(t,{...C,ref:e.useCallback(L=>{A.current=L,typeof v=="function"?v(L):v!==null&&(v.current=L)},[v])})});return f.displayName=a??n.name,f};/*!---------------------------------------------------------------------------------------------
 *  Copyright (c) StackBlitz. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/const BPe={damping:.7,stiffness:.05,mass:1.25},jPe=70,UPe=1e3/60,VPe=350;let Ak=!1;var lG;(lG=globalThis.document)==null||lG.addEventListener("mousedown",()=>{Ak=!0});var uG;(uG=globalThis.document)==null||uG.addEventListener("mouseup",()=>{Ak=!1});var cG;(cG=globalThis.document)==null||cG.addEventListener("click",()=>{Ak=!1});const cne=(e={})=>{const[t,n]=B.useState(!1),[r,a]=B.useState(e.initial!==!1),[u,f]=B.useState(!1),s=B.useRef(null);s.current=e;const v=B.useCallback(()=>{var ie;if(!Ak)return!1;const $=window.getSelection();if(!$||!$.rangeCount)return!1;const X=$.getRangeAt(0);return X.commonAncestorContainer.contains(q.current)||((ie=q.current)==null?void 0:ie.contains(X.commonAncestorContainer))},[]),x=B.useCallback($=>{C.isAtBottom=$,a($)},[]),A=B.useCallback($=>{C.escapedFromLock=$,n($)},[]),C=B.useMemo(()=>{let $;return{escapedFromLock:t,isAtBottom:r,resizeDifference:0,accumulated:0,velocity:0,listeners:new Set,get scrollTop(){var X;return((X=q.current)==null?void 0:X.scrollTop)??0},set scrollTop(X){q.current&&(q.current.scrollTop=X,C.ignoreScrollToTop=q.current.scrollTop)},get targetScrollTop(){return!q.current||!G.current?0:q.current.scrollHeight-1-q.current.clientHeight},get calculatedTargetScrollTop(){if(!q.current||!G.current)return 0;const{targetScrollTop:X}=this;if(!e.targetScrollTop)return X;if(($==null?void 0:$.targetScrollTop)===X)return $.calculatedScrollTop;const ie=Math.max(Math.min(e.targetScrollTop(X,{scrollElement:q.current,contentElement:G.current}),X),0);return $={targetScrollTop:X,calculatedScrollTop:ie},requestAnimationFrame(()=>{$=void 0}),ie},get scrollDifference(){return this.calculatedTargetScrollTop-this.scrollTop},get isNearBottom(){return this.scrollDifference<=jPe}}},[]),P=B.useCallback(($={})=>{var Qe;typeof $=="string"&&($={animation:$}),$.preserveScrollPosition||x(!0);const X=Date.now()+(Number($.wait)||0),ie=xR(s.current,$.animation),{ignoreEscapes:de=!1}=$;let fe,be=C.calculatedTargetScrollTop;$.duration instanceof Promise?$.duration.finally(()=>{fe=Date.now()}):fe=X+($.duration??0);const ve=async()=>{const we=new Promise(requestAnimationFrame).then(()=>{var Mt;if(!C.isAtBottom)return C.animation=void 0,!1;const{scrollTop:qe}=C,Je=performance.now(),ft=(Je-(C.lastTick??Je))/UPe;if(C.animation||(C.animation={behavior:ie,promise:we,ignoreEscapes:de}),C.animation.behavior===ie&&(C.lastTick=Je),v()||X>Date.now())return ve();if(qe<Math.min(be,C.calculatedTargetScrollTop)){if(((Mt=C.animation)==null?void 0:Mt.behavior)===ie){if(ie==="instant")return C.scrollTop=C.calculatedTargetScrollTop,ve();C.velocity=(ie.damping*C.velocity+ie.stiffness*C.scrollDifference)/ie.mass,C.accumulated+=C.velocity*ft,C.scrollTop+=C.accumulated,C.scrollTop!==qe&&(C.accumulated=0)}return ve()}return fe>Date.now()?(be=C.calculatedTargetScrollTop,ve()):(C.animation=void 0,C.scrollTop<C.calculatedTargetScrollTop?P({animation:xR(s.current,s.current.resize),ignoreEscapes:de,duration:Math.max(0,fe-Date.now())||void 0}):C.isAtBottom)});return we.then(qe=>(requestAnimationFrame(()=>{C.animation||(C.lastTick=void 0,C.velocity=0)}),qe))};return $.wait!==!0&&(C.animation=void 0),((Qe=C.animation)==null?void 0:Qe.behavior)===ie?C.animation.promise:ve()},[x,v,C]),L=B.useCallback(()=>{A(!0),x(!1)},[A,x]),F=B.useCallback(({target:$})=>{if($!==q.current)return;const{scrollTop:X,ignoreScrollToTop:ie}=C;let{lastScrollTop:de=X}=C;C.lastScrollTop=X,C.ignoreScrollToTop=void 0,ie&&ie>X&&(de=ie),f(C.isNearBottom),setTimeout(()=>{var ve;if(C.resizeDifference||X===ie)return;if(v()){A(!0),x(!1);return}const fe=X>de,be=X<de;if((ve=C.animation)!=null&&ve.ignoreEscapes){C.scrollTop=de;return}be&&(A(!0),x(!1)),fe&&A(!1),!C.escapedFromLock&&C.isNearBottom&&x(!0)},1)},[A,x,v,C]),U=B.useCallback(({target:$,deltaY:X})=>{var de;let ie=$;for(;!["scroll","auto"].includes(getComputedStyle(ie).overflow);){if(!ie.parentElement)return;ie=ie.parentElement}ie===q.current&&X<0&&q.current.scrollHeight>q.current.clientHeight&&!((de=C.animation)!=null&&de.ignoreEscapes)&&(A(!0),x(!1))},[A,x,C]),q=xH($=>{var X,ie;(X=q.current)==null||X.removeEventListener("scroll",F),(ie=q.current)==null||ie.removeEventListener("wheel",U),$==null||$.addEventListener("scroll",F,{passive:!0}),$==null||$.addEventListener("wheel",U,{passive:!0})},[]),G=xH($=>{var ie,de;if((ie=C.resizeObserver)==null||ie.disconnect(),!$)return;let X;C.resizeObserver=new ResizeObserver(([fe])=>{const{height:be}=fe.contentRect,ve=be-(X??be);if(C.resizeDifference=ve,C.scrollTop>C.targetScrollTop&&(C.scrollTop=C.targetScrollTop),f(C.isNearBottom),ve>=0){const Qe=xR(s.current,X?s.current.resize:s.current.initial);P({animation:Qe,wait:!0,preserveScrollPosition:!0,duration:Qe==="instant"?void 0:VPe})}else C.isNearBottom&&(A(!1),x(!0));X=be,requestAnimationFrame(()=>{setTimeout(()=>{C.resizeDifference===ve&&(C.resizeDifference=0)},1)})}),(de=C.resizeObserver)==null||de.observe($)},[]);return{contentRef:G,scrollRef:q,scrollToBottom:P,stopScroll:L,isAtBottom:r||u,isNearBottom:u,escapedFromLock:t,state:C}};function xH(e,t){const n=B.useCallback(r=>(n.current=r,e(r)),t);return n}const vR=new Map;function xR(...e){const t={...BPe};let n=!1;for(const a of e){if(a==="instant"){n=!0;continue}typeof a=="object"&&(n=!1,t.damping=a.damping??t.damping,t.stiffness=a.stiffness??t.stiffness,t.mass=a.mass??t.mass)}const r=JSON.stringify(t);return vR.has(r)||vR.set(r,Object.freeze(t)),n?"instant":vR.get(r)}const dne=B.createContext(null),$Pe=typeof window<"u"?B.useLayoutEffect:B.useEffect;function bC({instance:e,children:t,resize:n,initial:r,mass:a,damping:u,stiffness:f,targetScrollTop:s,contextRef:v,...x}){const A=B.useRef(null),C=B.useCallback((de,fe)=>{const be=(ie==null?void 0:ie.targetScrollTop)??s;return(be==null?void 0:be(de,fe))??de},[s]),P=cne({mass:a,damping:u,stiffness:f,resize:n,initial:r,targetScrollTop:C}),{scrollRef:L,contentRef:F,scrollToBottom:U,stopScroll:q,isAtBottom:G,escapedFromLock:$,state:X}=e??P,ie=B.useMemo(()=>({scrollToBottom:U,stopScroll:q,scrollRef:L,isAtBottom:G,escapedFromLock:$,contentRef:F,state:X,get targetScrollTop(){return A.current},set targetScrollTop(de){A.current=de}}),[U,G,F,L,q,$,X]);return B.useImperativeHandle(v,()=>ie,[ie]),$Pe(()=>{L.current&&getComputedStyle(L.current).overflow==="visible"&&(L.current.style.overflow="auto")},[]),k.jsx(dne.Provider,{value:ie,children:k.jsx("div",{...x,children:typeof t=="function"?t(ie):t})})}(function(e){function t({children:n,...r}){const a=hne();return k.jsx("div",{ref:a.scrollRef,style:{height:"100%",width:"100%"},children:k.jsx("div",{...r,ref:a.contentRef,children:typeof n=="function"?n(a):n})})}e.Content=t})(bC||(bC={}));function hne(){const e=B.useContext(dne);if(!e)throw new Error("use-stick-to-bottom component context must be used within a StickToBottom component");return e}const j3=e=>{if(typeof e=="object"&&e!==null){if(typeof Object.getPrototypeOf=="function"){const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}return Object.prototype.toString.call(e)==="[object Object]"}return!1},ad=(...e)=>e.reduce((t,n)=>{if(n===void 0)return t;if(Array.isArray(n))throw new TypeError("Arguments provided to ts-deepmerge must be objects, not arrays.");return Object.keys(n).forEach(r=>{["__proto__","constructor","prototype"].includes(r)||(Array.isArray(t[r])&&Array.isArray(n[r])?t[r]=ad.options.mergeArrays?ad.options.uniqueArrayItems?Array.from(new Set(t[r].concat(n[r]))):[...t[r],...n[r]]:n[r]:j3(t[r])&&j3(n[r])?t[r]=ad(t[r],n[r]):!j3(t[r])&&j3(n[r])?t[r]=ad(n[r],void 0):t[r]=n[r]===void 0?ad.options.allowUndefinedOverrides?n[r]:t[r]:n[r])}),t},{}),F8={allowUndefinedOverrides:!0,mergeArrays:!0,uniqueArrayItems:!0};ad.options=F8;ad.withOptions=(e,...t)=>{ad.options=Object.assign(Object.assign({},F8),e);const n=ad(...t);return ad.options=F8,n};var wu={chatInputPlaceholder:"Type a message...",chatInputToolbarStartTranscribeButtonLabel:"Transcribe",chatInputToolbarCancelTranscribeButtonLabel:"Cancel",chatInputToolbarFinishTranscribeButtonLabel:"Finish",chatInputToolbarAddButtonLabel:"Add photos or files",chatInputToolbarToolsButtonLabel:"Tools",assistantMessageToolbarCopyCodeLabel:"Copy",assistantMessageToolbarCopyCodeCopiedLabel:"Copied",assistantMessageToolbarCopyMessageLabel:"Copy",assistantMessageToolbarThumbsUpLabel:"Good response",assistantMessageToolbarThumbsDownLabel:"Bad response",assistantMessageToolbarReadAloudLabel:"Read aloud",assistantMessageToolbarRegenerateLabel:"Regenerate",userMessageToolbarCopyMessageLabel:"Copy",userMessageToolbarEditMessageLabel:"Edit",chatDisclaimerText:"AI can make mistakes. Please verify important information.",chatToggleOpenLabel:"Open chat",chatToggleCloseLabel:"Close chat",modalHeaderTitle:"CopilotKit Chat"},B8=B.createContext(null),fne=({children:e,labels:t,agentId:n,threadId:r,isModalDefaultOpen:a})=>{const u=B.useContext(B8),f=B.useMemo(()=>({...wu,...(u==null?void 0:u.labels)??{},...t??{}}),[t,u==null?void 0:u.labels]),s=n??(u==null?void 0:u.agentId)??rx,v=B.useMemo(()=>r||(u!=null&&u.threadId?u.threadId:nf()),[r,u==null?void 0:u.threadId]),x=a??(u==null?void 0:u.isModalDefaultOpen)??!0,[A,C]=B.useState((u==null?void 0:u.isModalOpen)??x),P=(u==null?void 0:u.isModalOpen)??A,L=(u==null?void 0:u.setModalOpen)??C,F=B.useMemo(()=>({labels:f,agentId:s,threadId:v,isModalOpen:P,setModalOpen:L,isModalDefaultOpen:x}),[f,s,v,P,L,x]);return k.jsx(B8.Provider,{value:F,children:e})},sl=()=>B.useContext(B8);function Go(...e){return uo(cL(e))}var HPe=dge("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 cursor-pointer",link:"text-primary underline-offset-4 hover:underline",assistantMessageToolbarButton:["cursor-pointer","p-0 text-[rgb(93,93,93)] hover:bg-[#E8E8E8]","dark:text-[rgb(243,243,243)] dark:hover:bg-[#303030]","h-8 w-8","transition-colors","hover:text-[rgb(93,93,93)]","dark:hover:text-[rgb(243,243,243)]"],chatInputToolbarPrimary:["cursor-pointer","bg-black text-white","dark:bg-white dark:text-black dark:focus-visible:outline-white","rounded-full","transition-colors","focus:outline-none","hover:opacity-70 disabled:hover:opacity-100","disabled:cursor-not-allowed disabled:bg-[#00000014] disabled:text-[rgb(13,13,13)]","dark:disabled:bg-[#454545] dark:disabled:text-white "],chatInputToolbarSecondary:["cursor-pointer","bg-transparent text-[#444444]","dark:text-white dark:border-[#404040]","rounded-full","transition-colors","focus:outline-none","hover:bg-[#f8f8f8] hover:text-[#333333]","dark:hover:bg-[#404040] dark:hover:text-[#FFFFFF]","disabled:cursor-not-allowed disabled:opacity-50","disabled:hover:bg-transparent disabled:hover:text-[#444444]","dark:disabled:hover:bg-transparent dark:disabled:hover:text-[#CCCCCC]"]},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9",chatInputToolbarIcon:["h-9 w-9 rounded-full"],chatInputToolbarIconLabel:["h-9 px-3 rounded-full","gap-2","font-normal"]}},defaultVariants:{variant:"default",size:"default"}});function e0({className:e,variant:t,size:n,asChild:r=!1,...a}){const u=r?sge:"button";return k.jsx(u,{"data-slot":"button",className:Go(HPe({variant:t,size:n,className:e})),...a})}function GPe({delayDuration:e=0,...t}){return k.jsx(wye,{"data-slot":"tooltip-provider",delayDuration:e,...t})}function wC({...e}){return k.jsx(GPe,{children:k.jsx(Tye,{"data-slot":"tooltip",...e})})}function TC({...e}){return k.jsx(Eye,{"data-slot":"tooltip-trigger",...e})}function EC({className:e,sideOffset:t=0,children:n,...r}){return k.jsx(Sye,{children:k.jsxs(Aye,{"data-slot":"tooltip-content",sideOffset:t,className:Go("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",e),...r,children:[n,k.jsx(Cye,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}function qPe({...e}){return k.jsx(nxe,{"data-slot":"dropdown-menu",...e})}function WPe({...e}){return k.jsx(rxe,{"data-slot":"dropdown-menu-trigger",...e})}function ZPe({className:e,sideOffset:t=4,...n}){return k.jsx(ixe,{children:k.jsx(sxe,{"data-slot":"dropdown-menu-content",sideOffset:t,className:Go("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",e),...n})})}function XPe({className:e,inset:t,variant:n="default",...r}){return k.jsx(axe,{"data-slot":"dropdown-menu-item","data-inset":t,"data-variant":n,className:Go("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...r})}function YPe({className:e,...t}){return k.jsx(oxe,{"data-slot":"dropdown-menu-separator",className:Go("bg-border -mx-1 my-1 h-px",e),...t})}function KPe({...e}){return k.jsx(lxe,{"data-slot":"dropdown-menu-sub",...e})}function QPe({className:e,inset:t,children:n,...r}){return k.jsxs(uxe,{"data-slot":"dropdown-menu-sub-trigger","data-inset":t,className:Go("focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8",e),...r,children:[n,k.jsx(UX,{className:"ml-auto size-4"})]})}function JPe({className:e,...t}){return k.jsx(cxe,{"data-slot":"dropdown-menu-sub-content",className:Go("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",e),...t})}var zD=B.forwardRef((e,t)=>{const{className:n,...r}=e,a=B.useRef(null),u=f=>{const s=Date.now()/1e3,v=[];for(let x=0;x<f;x++){const A=x/f*10+s*.5,C=Math.sin(A*2)*.3,P=Math.sin(A*5+s)*.2,L=Math.sin(A*.5+s*.3)*.4,F=(Math.random()-.5)*.1,U=Math.sin(s*.7)*.5+.5;let q=(C+P+L+F)*U;q=Math.max(0,Math.min(1,q*.5+.3)),v.push(q)}return v};return B.useEffect(()=>{const f=a.current;if(!f)return;const s=f.getContext("2d");if(!s)return;let v;const x=()=>{const A=f.getBoundingClientRect(),C=window.devicePixelRatio||1;(f.width!==A.width*C||f.height!==A.height*C)&&(f.width=A.width*C,f.height=A.height*C,s.scale(C,C),s.imageSmoothingEnabled=!1);const P=2,L=2,F=20,U=2,q=Math.ceil(A.width/(P+U)),G=u(q);s.clearRect(0,0,A.width,A.height);const X=getComputedStyle(f).color;s.fillStyle=X;const ie=A.height/2;for(let de=0;de<G.length;de++){const fe=G[de]??0,be=Math.round(fe*(F-L)+L),ve=Math.round(de*(P+U)),Qe=Math.round(ie-be/2);s.fillRect(ve,Qe,P,be)}v=requestAnimationFrame(x)};return x(),()=>{v&&cancelAnimationFrame(v)}},[]),B.useImperativeHandle(t,()=>({get state(){return"idle"},start:async()=>{},stop:()=>new Promise(f=>{const s=new Blob([],{type:"audio/webm"});f(s)}),dispose:()=>{}}),[]),k.jsx("div",{className:uo("h-[44px] w-full px-5",n),...r,children:k.jsx("canvas",{ref:a,className:"w-full h-full",style:{imageRendering:"pixelated"}})})});zD.displayName="WebAudioRecorder";function e8e(e,t){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const a of n)if(e[a]!==t[a])return!1;return!0}function t8e(e,t,n){return typeof e=="string"?ca.createElement(t,{...n,className:e}):typeof e=="function"?ca.createElement(e,n):e&&typeof e=="object"&&!ca.isValidElement(e)?ca.createElement(t,{...n,...e}):ca.createElement(t,n)}var n8e=ca.memo(ca.forwardRef(function(t,n){const{$slot:r,$component:a,...u}=t,f=n!==null?{...u,ref:n}:u;return t8e(r,a,f)}),(e,t)=>{if(e.$slot!==t.$slot||e.$component!==t.$component)return!1;const{$slot:n,$component:r,...a}=e,{$slot:u,$component:f,...s}=t;return e8e(a,s)});function Vs(e,t,n){return ca.createElement(n8e,{...n,$slot:e,$component:t})}var r8e=5,i8e=40;function Ql({mode:e="input",onSubmitMessage:t,onStop:n,isRunning:r=!1,onStartTranscribe:a,onCancelTranscribe:u,onFinishTranscribe:f,onAddFile:s,onChange:v,value:x,toolsMenu:A,autoFocus:C=!0,textArea:P,sendButton:L,startTranscribeButton:F,cancelTranscribeButton:U,finishTranscribeButton:q,addMenuButton:G,audioRecorder:$,children:X,className:ie,...de}){const fe=x!==void 0,[be,ve]=B.useState(()=>x??"");B.useEffect(()=>{!fe&&x!==void 0&&ve(x)},[fe,x]);const Qe=fe?x??"":be,[we,qe]=B.useState("compact"),Je=B.useRef(!1),ft=B.useRef(null),Mt=e==="input"&&we==="expanded",[Pt,Nt]=B.useState(null),[Kt,tt]=B.useState(0),mt=B.useRef(null),Pe=B.useRef(null),gn=B.useRef(null),Et=B.useRef(null),ze=B.useRef(null),$t=B.useRef(null),Cn=sl(),fn=(Cn==null?void 0:Cn.labels)??wu,Nn=B.useRef(void 0),bn=B.useRef(null),Vt=B.useRef({singleLineHeight:0,maxHeight:0,paddingLeft:0,paddingRight:0}),En=B.useMemo(()=>{const Mn=[],Tt=new Set,ut=on=>{if(on!=="-"){if(on.items&&on.items.length>0){for(const qn of on.items)ut(qn);return}Tt.has(on.label)||(Tt.add(on.label),Mn.push(on))}};if(s&&ut({label:fn.chatInputToolbarAddButtonLabel,action:s}),A&&A.length>0)for(const on of A)ut(on);return Mn},[fn.chatInputToolbarAddButtonLabel,s,A]),Sn=B.useMemo(()=>{if(Pt===null)return[];if(En.length===0)return[];const Mn=Pt.trim().toLowerCase();if(Mn.length===0)return En;const Tt=[],ut=[];for(const on of En){const qn=on.label.toLowerCase();qn.startsWith(Mn)?Tt.push(on):qn.includes(Mn)&&ut.push(on)}return[...Tt,...ut]},[En,Pt]);B.useEffect(()=>{var Mn;if(!C){Nn.current=Cn==null?void 0:Cn.isModalOpen;return}Cn!=null&&Cn.isModalOpen&&!Nn.current&&((Mn=mt.current)==null||Mn.focus()),Nn.current=Cn==null?void 0:Cn.isModalOpen},[Cn==null?void 0:Cn.isModalOpen,C]),B.useEffect(()=>{En.length===0&&Pt!==null&&Nt(null)},[En.length,Pt]);const Un=B.useRef(null);B.useEffect(()=>{Pt!==null&&Pt!==Un.current&&Sn.length>0&&tt(0),Un.current=Pt},[Pt,Sn.length]),B.useEffect(()=>{if(Pt===null){tt(0);return}Sn.length===0?tt(-1):(Kt<0||Kt>=Sn.length)&&tt(0)},[Pt,Sn,Kt]),B.useEffect(()=>{const Mn=ze.current;Mn&&(e==="transcribe"?Mn.start().catch(console.error):Mn.state==="recording"&&Mn.stop().catch(console.error))},[e]),B.useEffect(()=>{e!=="input"&&(qe("compact"),Nt(null))},[e]);const nn=B.useCallback(Mn=>{if(En.length===0){Nt(Tt=>Tt===null?Tt:null);return}if(Mn.startsWith("/")){const ut=(Mn.split(/\r?\n/,1)[0]??"").slice(1);Nt(on=>on===ut?on:ut)}else Nt(Tt=>Tt===null?Tt:null)},[En.length]);B.useEffect(()=>{nn(Qe)},[Qe,nn]);const wr=Mn=>{const Tt=Mn.target.value;fe||ve(Tt),v==null||v(Tt),nn(Tt)},Xr=B.useCallback(()=>{fe||ve(""),v&&v("")},[fe,v]),ar=B.useCallback(Mn=>{var Tt;Xr(),(Tt=Mn.action)==null||Tt.call(Mn),Nt(null),tt(0),requestAnimationFrame(()=>{var ut;(ut=mt.current)==null||ut.focus()})},[Xr]),tr=Mn=>{if(Pt!==null&&e==="input"){if(Mn.key==="ArrowDown"){Sn.length>0&&(Mn.preventDefault(),tt(Tt=>Sn.length===0?Tt:Tt===-1?0:(Tt+1)%Sn.length));return}if(Mn.key==="ArrowUp"){Sn.length>0&&(Mn.preventDefault(),tt(Tt=>Sn.length===0?Tt:Tt===-1||Tt<=0?Sn.length-1:Tt-1));return}if(Mn.key==="Enter"){const Tt=Kt>=0?Sn[Kt]:void 0;if(Tt){Mn.preventDefault(),ar(Tt);return}}if(Mn.key==="Escape"){Mn.preventDefault(),Nt(null);return}}Mn.key==="Enter"&&!Mn.shiftKey&&(Mn.preventDefault(),ws?n==null||n():Vn())},Vn=()=>{if(!t)return;const Mn=Qe.trim();Mn&&(t(Mn),fe||(ve(""),v==null||v("")),mt.current&&mt.current.focus())},xr=Vs(P,Ql.TextArea,{ref:mt,value:Qe,onChange:wr,onKeyDown:tr,autoFocus:C,className:uo("w-full py-3",Mt?"px-5":"pr-5")}),ws=e!=="transcribe"&&r,bi=Qe.trim().length>0&&!!t,Ai=!!n,ps=()=>{if(ws){n==null||n();return}Vn()},$i=Vs($,zD,{ref:ze}),Ts=Vs(L,Ql.SendButton,{onClick:ps,disabled:ws?!Ai:!bi,children:ws&&Ai?k.jsx(Z0e,{className:"size-[18px] fill-current"}):void 0}),tn=Vs(F,Ql.StartTranscribeButton,{onClick:a}),kn=Vs(U,Ql.CancelTranscribeButton,{onClick:u}),Mr=Vs(q,Ql.FinishTranscribeButton,{onClick:f}),wt=Vs(G,Ql.AddMenuButton,{disabled:e==="transcribe",onAddFile:s,toolsMenu:A});if(X){const Mn={textArea:xr,audioRecorder:$i,sendButton:Ts,startTranscribeButton:tn,cancelTranscribeButton:kn,finishTranscribeButton:Mr,addMenuButton:wt,onSubmitMessage:t,onStop:n,isRunning:r,onStartTranscribe:a,onCancelTranscribe:u,onFinishTranscribe:f,onAddFile:s,mode:e,toolsMenu:A,autoFocus:C};return k.jsx(k.Fragment,{children:X(Mn)})}const Rn=Mn=>{const Tt=Mn.target;Tt.tagName!=="BUTTON"&&!Tt.closest("button")&&mt.current&&e==="input"&&mt.current.focus()},nr=B.useCallback(()=>{const Mn=mt.current;if(!Mn)return;const Tt=Mn.value,ut=Mn.style.height;Mn.style.height="auto";const on=window.getComputedStyle(Mn),qn=parseFloat(on.paddingLeft)||0,Or=parseFloat(on.paddingRight)||0,Zn=parseFloat(on.paddingTop)||0,ns=parseFloat(on.paddingBottom)||0;Mn.value="";const ga=Mn.scrollHeight;Mn.value=Tt;const rn=(ga-Zn-ns)*5+Zn+ns;Vt.current={singleLineHeight:ga,maxHeight:rn,paddingLeft:qn,paddingRight:Or},Mn.style.height=ut,Mn.style.maxHeight=`${rn}px`},[]),dt=B.useCallback(()=>{const Mn=mt.current;if(!Mn)return 0;Vt.current.singleLineHeight===0&&nr();const{maxHeight:Tt}=Vt.current;Tt&&(Mn.style.maxHeight=`${Tt}px`),Mn.style.height="auto";const ut=Mn.scrollHeight;return Tt?Mn.style.height=`${Math.min(ut,Tt)}px`:Mn.style.height=`${ut}px`,ut},[nr]),Jn=B.useCallback(Mn=>{qe(Tt=>Tt===Mn?Tt:(Je.current=!0,Mn))},[]),qr=B.useCallback(()=>{if(e!=="input"){Jn("compact");return}if(typeof window<"u"&&typeof window.matchMedia=="function"&&window.matchMedia("(max-width: 767px)").matches){nr(),dt(),Jn("expanded");return}const Mn=mt.current,Tt=Pe.current,ut=gn.current,on=Et.current;if(!Mn||!Tt||!ut||!on)return;Vt.current.singleLineHeight===0&&nr();const qn=dt(),Or=Vt.current.singleLineHeight,Zn=Qe.includes(`
`),ns=Or>0?qn>Or+1:!1;let ga=Zn||ns;if(!ga){const rn=window.getComputedStyle(Tt),rr=parseFloat(rn.paddingLeft)||0,Ve=parseFloat(rn.paddingRight)||0,or=parseFloat(rn.columnGap)||0,_n=Tt.clientWidth-rr-Ve;if(_n>0){const Yn=ut.getBoundingClientRect().width,Tn=on.getBoundingClientRect().width,ti=Math.max(_n-Yn-Tn-or*2,0),Sr=bn.current??document.createElement("canvas");bn.current||(bn.current=Sr);const Mi=Sr.getContext("2d");if(Mi){const da=window.getComputedStyle(Mn),Ze=da.font||`${da.fontStyle} ${da.fontVariant} ${da.fontWeight} ${da.fontSize}/${da.lineHeight} ${da.fontFamily}`;Mi.font=Ze;const ee=Math.max(ti-(Vt.current.paddingLeft||0)-(Vt.current.paddingRight||0),0);if(ee>0){const le=Qe.length>0?Qe.split(`
`):[""];let ye=0;for(const De of le){const Oe=Mi.measureText(De||" ");Oe.width>ye&&(ye=Oe.width)}ye>ee&&(ga=!0)}}}}Jn(ga?"expanded":"compact")},[dt,nr,e,Qe,Jn]);B.useLayoutEffect(()=>{qr()},[qr]),B.useEffect(()=>{if(typeof ResizeObserver>"u")return;const Mn=mt.current,Tt=Pe.current,ut=gn.current,on=Et.current;if(!Mn||!Tt||!ut||!on)return;const qn=()=>{if(Je.current){Je.current=!1;return}if(typeof window>"u"){qr();return}ft.current!==null&&cancelAnimationFrame(ft.current),ft.current=window.requestAnimationFrame(()=>{ft.current=null,qr()})},Or=new ResizeObserver(()=>{qn()});return Or.observe(Tt),Or.observe(ut),Or.observe(on),Or.observe(Mn),()=>{Or.disconnect(),typeof window<"u"&&ft.current!==null&&(cancelAnimationFrame(ft.current),ft.current=null)}},[qr]);const ts=Pt!==null&&En.length>0;B.useEffect(()=>{var Tt;if(!ts||Kt<0)return;const Mn=(Tt=$t.current)==null?void 0:Tt.querySelector(`[data-slash-index="${Kt}"]`);Mn==null||Mn.scrollIntoView({block:"nearest"})},[ts,Kt]);const ms=ts?k.jsx("div",{"data-testid":"copilot-slash-menu",role:"listbox","aria-label":"Slash commands",ref:$t,className:"absolute bottom-full left-0 right-0 z-30 mb-2 max-h-64 overflow-y-auto rounded-lg border border-border bg-white shadow-lg dark:border-[#3a3a3a] dark:bg-[#1f1f1f]",style:{maxHeight:`${r8e*i8e}px`},children:Sn.length===0?k.jsx("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:"No commands found"}):Sn.map((Mn,Tt)=>{const ut=Tt===Kt;return k.jsx("button",{type:"button",role:"option","aria-selected":ut,"data-active":ut?"true":void 0,"data-slash-index":Tt,className:uo("w-full px-3 py-2 text-left text-sm transition-colors","hover:bg-muted dark:hover:bg-[#2f2f2f]",ut?"bg-muted dark:bg-[#2f2f2f]":"bg-transparent"),onMouseEnter:()=>tt(Tt),onMouseDown:on=>{on.preventDefault(),ar(Mn)},children:Mn.label},`${Mn.label}-${Tt}`)})}):null;return k.jsx("div",{className:uo("flex w-full flex-col items-center justify-center","cursor-text","overflow-visible bg-clip-padding contain-inline-size","bg-white dark:bg-[#303030]","shadow-[0_4px_4px_0_#0000000a,0_0_1px_0_#0000009e] rounded-[28px]",ie),onClick:Rn,...de,"data-layout":Mt?"expanded":"compact",children:k.jsxs("div",{ref:Pe,className:uo("grid w-full gap-x-3 gap-y-3 px-3 py-2",Mt?"grid-cols-[auto_minmax(0,1fr)_auto] grid-rows-[auto_auto]":"grid-cols-[auto_minmax(0,1fr)_auto] items-center"),"data-layout":Mt?"expanded":"compact",children:[k.jsx("div",{ref:gn,className:uo("flex items-center",Mt?"row-start-2":"row-start-1","col-start-1"),children:wt}),k.jsx("div",{className:uo("relative flex min-w-0 flex-col",Mt?"col-span-3 row-start-1":"col-start-2 row-start-1"),children:e==="transcribe"?$i:k.jsxs(k.Fragment,{children:[xr,ms]})}),k.jsx("div",{ref:Et,className:uo("flex items-center justify-end gap-2",Mt?"col-start-3 row-start-2":"col-start-3 row-start-1"),children:e==="transcribe"?k.jsxs(k.Fragment,{children:[u&&kn,f&&Mr]}):k.jsxs(k.Fragment,{children:[a&&tn,Ts]})})]})})}(e=>{e.SendButton=({className:t,children:n,...r})=>k.jsx("div",{className:"mr-[10px]",children:k.jsx(e0,{type:"button",variant:"chatInputToolbarPrimary",size:"chatInputToolbarIcon",className:t,...r,children:n??k.jsx(C0e,{className:"size-[18px]"})})}),e.ToolbarButton=({icon:t,labelKey:n,defaultClassName:r,className:a,...u})=>{const f=sl(),s=(f==null?void 0:f.labels)??wu;return k.jsxs(wC,{children:[k.jsx(TC,{asChild:!0,children:k.jsx(e0,{type:"button",variant:"chatInputToolbarSecondary",size:"chatInputToolbarIcon",className:uo(r,a),...u,children:t})}),k.jsx(EC,{side:"bottom",children:k.jsx("p",{children:s[n]})})]})},e.StartTranscribeButton=t=>k.jsx(e.ToolbarButton,{icon:k.jsx(j0e,{className:"size-[18px]"}),labelKey:"chatInputToolbarStartTranscribeButtonLabel",defaultClassName:"mr-2",...t}),e.CancelTranscribeButton=t=>k.jsx(e.ToolbarButton,{icon:k.jsx(uL,{className:"size-[18px]"}),labelKey:"chatInputToolbarCancelTranscribeButtonLabel",defaultClassName:"mr-2",...t}),e.FinishTranscribeButton=t=>k.jsx(e.ToolbarButton,{icon:k.jsx(lL,{className:"size-[18px]"}),labelKey:"chatInputToolbarFinishTranscribeButtonLabel",defaultClassName:"mr-[10px]",...t}),e.AddMenuButton=({className:t,toolsMenu:n,onAddFile:r,disabled:a,...u})=>{const f=sl(),s=(f==null?void 0:f.labels)??wu,v=B.useMemo(()=>{const P=[];if(r&&P.push({label:s.chatInputToolbarAddButtonLabel,action:r}),n&&n.length>0){P.length>0&&P.push("-");for(const L of n)if(L==="-"){if(P.length===0||P[P.length-1]==="-")continue;P.push(L)}else P.push(L);for(;P.length>0&&P[P.length-1]==="-";)P.pop()}return P},[r,n,s.chatInputToolbarAddButtonLabel]),x=B.useCallback(P=>P.map((L,F)=>L==="-"?k.jsx(YPe,{},`separator-${F}`):L.items&&L.items.length>0?k.jsxs(KPe,{children:[k.jsx(QPe,{children:L.label}),k.jsx(JPe,{children:x(L.items)})]},`group-${F}`):k.jsx(XPe,{onClick:L.action,children:L.label},`item-${F}`)),[]),A=v.length>0,C=a||!A;return k.jsxs(qPe,{children:[k.jsxs(wC,{children:[k.jsx(TC,{asChild:!0,children:k.jsx(WPe,{asChild:!0,children:k.jsx(e0,{type:"button",variant:"chatInputToolbarSecondary",size:"chatInputToolbarIcon",className:uo("ml-1",t),disabled:C,...u,children:k.jsx(V0e,{className:"size-[20px]"})})})}),k.jsx(EC,{side:"bottom",children:k.jsxs("p",{className:"flex items-center gap-1 text-xs font-medium",children:[k.jsx("span",{children:"Add files and more"}),k.jsx("code",{className:"rounded bg-[#4a4a4a] px-1 py-[1px] font-mono text-[11px] text-white dark:bg-[#e0e0e0] dark:text-black",children:"/"})]})})]}),A&&k.jsx(ZPe,{side:"top",align:"start",children:x(v)})]})},e.TextArea=B.forwardRef(function({style:n,className:r,autoFocus:a,...u},f){const s=B.useRef(null),v=sl(),x=(v==null?void 0:v.labels)??wu;return B.useImperativeHandle(f,()=>s.current),B.useEffect(()=>{const A=s.current;if(!A)return;const C=()=>{setTimeout(()=>{A.scrollIntoView({behavior:"smooth",block:"nearest"})},300)};return A.addEventListener("focus",C),()=>A.removeEventListener("focus",C)},[]),B.useEffect(()=>{var A;a&&((A=s.current)==null||A.focus())},[a]),k.jsx("textarea",{ref:s,...u,style:{overflow:"auto",resize:"none",...n},placeholder:x.chatInputPlaceholder,className:uo("bg-transparent outline-none antialiased font-regular leading-relaxed text-[16px] placeholder:text-[#00000077] dark:placeholder:text-[#fffc]",r),rows:1})}),e.AudioRecorder=zD})(Ql||(Ql={}));Ql.TextArea.displayName="CopilotChatInput.TextArea";Ql.SendButton.displayName="CopilotChatInput.SendButton";Ql.ToolbarButton.displayName="CopilotChatInput.ToolbarButton";Ql.StartTranscribeButton.displayName="CopilotChatInput.StartTranscribeButton";Ql.CancelTranscribeButton.displayName="CopilotChatInput.CancelTranscribeButton";Ql.FinishTranscribeButton.displayName="CopilotChatInput.FinishTranscribeButton";Ql.AddMenuButton.displayName="CopilotChatInput.AddMenuButton";var s8e=Ql,a8e=class extends cPe{constructor(t){super(t);yi(this,"_renderToolCalls",[]);yi(this,"_renderCustomMessages",[]);yi(this,"_renderActivityMessages",[]);this._renderToolCalls=t.renderToolCalls??[],this._renderCustomMessages=t.renderCustomMessages??[],this._renderActivityMessages=t.renderActivityMessages??[]}get renderCustomMessages(){return this._renderCustomMessages}get renderActivityMessages(){return this._renderActivityMessages}get renderToolCalls(){return this._renderToolCalls}setRenderToolCalls(t){this._renderToolCalls=t,this.notifySubscribers(n=>{const r=n;r.onRenderToolCallsChanged&&r.onRenderToolCallsChanged({copilotkit:this,renderToolCalls:this.renderToolCalls})},"Subscriber onRenderToolCallsChanged error:")}subscribe(t){return super.subscribe(t)}},pne=({core:e,...t})=>{const[n,r]=B.useState(null);return B.useEffect(()=>{let a=!0;return TT(()=>import("./index-uTRwvnyi.js"),[]).then(u=>{var s;(s=u.defineWebInspector)==null||s.call(u);const f=FPe({tagName:u.WEB_INSPECTOR_TAG,elementClass:u.WebInspectorElement,react:mT});a&&r(()=>f)}),()=>{a=!1}},[]),n?k.jsx(n,{...t,core:e??null}):null};pne.displayName="CopilotKitInspector";var bH="X-CopilotCloud-Public-Api-Key",o8e="https://api.cloud.copilotkit.ai/copilotkit/v1",mne=B.createContext({copilotkit:null});function Rw(e,t,n){const r=B.useMemo(()=>[],[]),a=e??r,u=B.useRef(a);return B.useEffect(()=>{t&&a!==u.current&&(!n||n(u.current,a))&&console.error(t)},[a,t]),a}var l8e=({children:e,runtimeUrl:t,headers:n={},publicApiKey:r,publicLicenseKey:a,properties:u={},agents__unsafe_dev_only:f={},renderToolCalls:s,renderActivityMessages:v,renderCustomMessages:x,frontendTools:A,humanInTheLoop:C,showDevConsole:P=!1,useSingleEndpoint:L=!1})=>{const[F,U]=B.useState(!1);B.useEffect(()=>{typeof window>"u"||(P===!0||P==="auto"&&new Set(["localhost","127.0.0.1"]).has(window.location.hostname)?U(!0):U(!1))},[P]);const q=Rw(s,"renderToolCalls must be a stable array. If you want to dynamically add or remove tools, use `useFrontendTool` instead.",(Mt,Pt)=>{const Nt=Pe=>`${(Pe==null?void 0:Pe.agentId)??""}:${(Pe==null?void 0:Pe.name)??""}`,Kt=Pe=>new Set(Pe.map(Nt)),tt=Kt(Mt),mt=Kt(Pt);if(tt.size!==mt.size)return!0;for(const Pe of tt)if(!mt.has(Pe))return!0;return!1}),G=Rw(x,"renderCustomMessages must be a stable array."),$=Rw(v,"renderActivityMessages must be a stable array."),X=r??a,ie=f&&Object.keys(f).length>0,de=B.useMemo(()=>!X||n[bH]?n:{...n,[bH]:X},[n,X]);if(!t&&!X&&!ie){const Mt="Missing required prop: 'runtimeUrl' or 'publicApiKey' or 'publicLicenseKey'";throw new Error(Mt)}const fe=t??(X?o8e:void 0),be=Rw(A,"frontendTools must be a stable array. If you want to dynamically add or remove tools, use `useFrontendTool` instead."),ve=Rw(C,"humanInTheLoop must be a stable array. If you want to dynamically add or remove human-in-the-loop tools, use `useHumanInTheLoop` instead."),Qe=B.useMemo(()=>{const Mt=[],Pt=[];return ve.forEach(Nt=>{const Kt={name:Nt.name,description:Nt.description,parameters:Nt.parameters,followUp:Nt.followUp,...Nt.agentId&&{agentId:Nt.agentId},handler:async()=>new Promise(tt=>{console.warn(`Human-in-the-loop tool '${Nt.name}' called but no interactive handler is set up.`),tt(void 0)})};Mt.push(Kt),Nt.render&&Pt.push({name:Nt.name,args:Nt.parameters,render:Nt.render,...Nt.agentId&&{agentId:Nt.agentId}})}),{tools:Mt,renderToolCalls:Pt}},[ve]),we=B.useMemo(()=>{const Mt=[];return Mt.push(...be),Mt.push(...Qe.tools),Mt},[be,Qe]),qe=B.useMemo(()=>{const Mt=[...q];return be.forEach(Pt=>{if(Pt.render){const Nt=Pt.parameters||(Pt.name==="*"?une():void 0);Nt&&Mt.push({name:Pt.name,args:Nt,render:Pt.render})}}),Mt.push(...Qe.renderToolCalls),Mt},[q,be,Qe]),Je=B.useMemo(()=>new a8e({runtimeUrl:fe,runtimeTransport:L?"single":"rest",headers:de,properties:u,agents__unsafe_dev_only:f,tools:we,renderToolCalls:qe,renderActivityMessages:$,renderCustomMessages:G}),[we,qe,$,G,L]),[,ft]=B.useReducer(Mt=>Mt+1,0);return B.useEffect(()=>{const Mt=Je.subscribe({onRenderToolCallsChanged:()=>{ft()}});return()=>{Mt.unsubscribe()}},[Je]),B.useEffect(()=>{Je.setRuntimeUrl(fe),Je.setRuntimeTransport(L?"single":"rest"),Je.setHeaders(de),Je.setProperties(u),Je.setAgents__unsafe_dev_only(f)},[fe,de,u,f,L]),k.jsxs(mne.Provider,{value:{copilotkit:Je},children:[e,F?k.jsx(pne,{core:Je}):null]})},S0=()=>{const e=B.useContext(mne),[,t]=B.useReducer(n=>n+1,0);if(!e)throw new Error("useCopilotKit must be used within CopilotKitProvider");return B.useEffect(()=>{const n=e.copilotkit.subscribe({onRuntimeConnectionStatusChanged:()=>{t()}});return()=>{n.unsubscribe()}},[]),e},u8e=ca.memo(function({toolCall:t,toolMessage:n,RenderComponent:r,isExecuting:a}){const u=B.useMemo(()=>HX(t.function.arguments),[t.function.arguments]),f=t.function.name;return n?k.jsx(r,{name:f,args:u,status:j4.Complete,result:n.content}):a?k.jsx(r,{name:f,args:u,status:j4.Executing,result:void 0}):k.jsx(r,{name:f,args:u,status:j4.InProgress,result:void 0})},(e,t)=>{var a,u;if(e.toolCall.id!==t.toolCall.id||e.toolCall.function.name!==t.toolCall.function.name||e.toolCall.function.arguments!==t.toolCall.function.arguments)return!1;const n=(a=e.toolMessage)==null?void 0:a.content,r=(u=t.toolMessage)==null?void 0:u.content;return!(n!==r||e.isExecuting!==t.isExecuting||e.RenderComponent!==t.RenderComponent)});function c8e(){const{copilotkit:e}=S0(),t=sl(),n=(t==null?void 0:t.agentId)??rx,[r,a]=B.useState(()=>new Set),u=B.useSyncExternalStore(s=>e.subscribe({onRenderToolCallsChanged:s}).unsubscribe,()=>e.renderToolCalls,()=>e.renderToolCalls);return B.useEffect(()=>{const s=e.subscribe({onToolExecutionStart:({toolCallId:v})=>{a(x=>{if(x.has(v))return x;const A=new Set(x);return A.add(v),A})},onToolExecutionEnd:({toolCallId:v})=>{a(x=>{if(!x.has(v))return x;const A=new Set(x);return A.delete(v),A})}});return()=>s.unsubscribe()},[e]),B.useCallback(({toolCall:s,toolMessage:v})=>{const x=u.filter(L=>L.name===s.function.name),A=x.find(L=>L.agentId===n)||x.find(L=>!L.agentId)||x[0]||u.find(L=>L.name==="*");if(!A)return null;const C=A.render,P=r.has(s.id);return k.jsx(u8e,{toolCall:s,toolMessage:v,RenderComponent:C,isExecuting:P},s.id)},[u,r,n])}function d8e(){const{copilotkit:e}=S0(),t=sl();if(!t)return null;const{agentId:n,threadId:r}=t,a=e.renderCustomMessages.filter(u=>u.agentId===void 0||u.agentId===n).sort((u,f)=>{const s=u.agentId!==void 0,v=f.agentId!==void 0;return s===v?0:s?-1:1});return function(u){if(!a.length)return null;const{message:f,position:s}=u,v=e.getRunIdForMessage(n,r,f.id),x=e.getAgent(n);if(!x)throw new Error("Agent not found");const A=x.messages.filter(q=>e.getRunIdForMessage(n,r,q.id)===v).map(q=>q.id),C=x.messages.findIndex(q=>q.id===f.id)??0,P=Math.min(A.indexOf(f.id),0),L=A.length,F=e.getStateByRun(n,r,v);let U=null;for(const q of a){if(!q.render)continue;const G=q.render;if(U=k.jsx(G,{message:f,position:s,runId:v,messageIndex:C,messageIndexInRun:P,numberOfMessagesInRun:L,agentId:n,stateSnapshot:F},`${v}-${f.id}-${s}`),U)break}return U}}function h8e(){const{copilotkit:e}=S0(),t=sl(),n=(t==null?void 0:t.agentId)??rx,r=e.renderActivityMessages;return B.useCallback(a=>{if(!r.length)return null;const u=r.filter(A=>A.activityType===a.activityType),f=u.find(A=>A.agentId===n)??u.find(A=>A.agentId===void 0)??r.find(A=>A.activityType==="*");if(!f)return null;const s=f.content.safeParse(a.content);if(!s.success)return console.warn(`Failed to parse content for activity message '${a.activityType}':`,s.error),null;const v=f.render,x=e.getAgent(n);return k.jsx(v,{activityType:a.activityType,content:s.data,message:a,agent:x},a.id)},[n,e,r])}var f8e=["OnMessagesChanged","OnStateChanged","OnRunStatusChanged"];function FD({agentId:e,updates:t}={}){e??(e=rx);const{copilotkit:n}=S0(),[,r]=B.useReducer(f=>f+1,0),a=B.useMemo(()=>t??f8e,[JSON.stringify(t)]),u=B.useMemo(()=>{const f=n.getAgent(e);if(f)return f;const s=n.runtimeUrl!==void 0,v=n.runtimeConnectionStatus;if(s&&(v===M8.Disconnected||v===M8.Connecting)){const C=new sne({runtimeUrl:n.runtimeUrl,agentId:e,transport:n.runtimeTransport});return C.headers={...n.headers},C}const x=Object.keys(n.agents??{}),A=s?`runtimeUrl=${n.runtimeUrl}`:"no runtimeUrl";throw new Error(`useAgent: Agent '${e}' not found after runtime sync (${A}). `+(x.length?`Known agents: [${x.join(", ")}]`:"No agents registered.")+" Verify your runtime /info and/or agents__unsafe_dev_only.")},[e,n.agents,n.runtimeConnectionStatus,n.runtimeUrl,n.runtimeTransport,JSON.stringify(n.headers),n]);return B.useEffect(()=>{if(a.length===0)return;const f={};a.includes("OnMessagesChanged")&&(f.onMessagesChanged=()=>{r()}),a.includes("OnStateChanged")&&(f.onStateChanged=()=>{r()}),a.includes("OnRunStatusChanged")&&(f.onRunInitialized=()=>{r()},f.onRunFinalized=()=>{r()},f.onRunFailed=()=>{r()});const s=u.subscribe(f);return()=>s.unsubscribe()},[u,r,JSON.stringify(a)]),{agent:u}}function p8e({agentId:e}={}){const{copilotkit:t}=S0(),n=sl(),r=B.useMemo(()=>e??(n==null?void 0:n.agentId)??rx,[e,n==null?void 0:n.agentId]),[a,u]=B.useState(()=>t.getSuggestions(r).suggestions),[f,s]=B.useState(()=>t.getSuggestions(r).isLoading);B.useEffect(()=>{const A=t.getSuggestions(r);u(A.suggestions),s(A.isLoading)},[t,r]),B.useEffect(()=>{const A=t.subscribe({onSuggestionsChanged:({agentId:C,suggestions:P})=>{C===r&&u(P)},onSuggestionsStartedLoading:({agentId:C})=>{C===r&&s(!0)},onSuggestionsFinishedLoading:({agentId:C})=>{C===r&&s(!1)},onSuggestionsConfigChanged:()=>{const C=t.getSuggestions(r);u(C.suggestions),s(C.isLoading)}});return()=>{A.unsubscribe()}},[t,r]);const v=B.useCallback(()=>{t.reloadSuggestions(r)},[t,r]),x=B.useCallback(()=>{t.clearSuggestions(r)},[t,r]);return{suggestions:a,reloadSuggestions:v,clearSuggestions:x,isLoading:f}}function m8e({message:e,messages:t=[]}){const n=c8e();return!e.toolCalls||e.toolCalls.length===0?null:k.jsx(k.Fragment,{children:e.toolCalls.map(r=>{const a=t.find(u=>u.role==="tool"&&u.toolCallId===r.id);return k.jsx(ca.Fragment,{children:n({toolCall:r,toolMessage:a})},r.id)})})}var g8e=m8e;function Dl({message:e,messages:t,isRunning:n,onThumbsUp:r,onThumbsDown:a,onReadAloud:u,onRegenerate:f,additionalToolbarItems:s,toolbarVisible:v=!0,markdownRenderer:x,toolbar:A,copyButton:C,thumbsUpButton:P,thumbsDownButton:L,readAloudButton:F,regenerateButton:U,toolCallsView:q,children:G,className:$,...X}){var Pt;const ie=Vs(x,Dl.MarkdownRenderer,{content:e.content||""}),de=Vs(C,Dl.CopyButton,{onClick:async()=>{if(e.content)try{await navigator.clipboard.writeText(e.content)}catch(Nt){console.error("Failed to copy message:",Nt)}}}),fe=Vs(P,Dl.ThumbsUpButton,{onClick:r}),be=Vs(L,Dl.ThumbsDownButton,{onClick:a}),ve=Vs(F,Dl.ReadAloudButton,{onClick:u}),Qe=Vs(U,Dl.RegenerateButton,{onClick:f}),we=Vs(A,Dl.Toolbar,{children:k.jsxs("div",{className:"flex items-center gap-1",children:[de,(r||P)&&fe,(a||L)&&be,(u||F)&&ve,(f||U)&&Qe,s]})}),qe=Vs(q,g8e,{message:e,messages:t}),Je=!!(e.content&&e.content.trim().length>0),ft=e.role==="assistant"&&((Pt=t==null?void 0:t[t.length-1])==null?void 0:Pt.id)===e.id,Mt=v&&Je&&!(n&&ft);return G?k.jsx(k.Fragment,{children:G({markdownRenderer:ie,toolbar:we,toolCallsView:qe,copyButton:de,thumbsUpButton:fe,thumbsDownButton:be,readAloudButton:ve,regenerateButton:Qe,message:e,messages:t,isRunning:n,onThumbsUp:r,onThumbsDown:a,onReadAloud:u,onRegenerate:f,additionalToolbarItems:s,toolbarVisible:Mt})}):k.jsxs("div",{className:uo("prose max-w-full break-words dark:prose-invert",$),...X,"data-message-id":e.id,children:[ie,qe,Mt&&we]})}(e=>{e.MarkdownRenderer=({content:t,className:n,...r})=>k.jsx(Yte,{className:n,...r,children:t??""}),e.Toolbar=({className:t,...n})=>k.jsx("div",{className:uo("w-full bg-transparent flex items-center -ml-[5px] -mt-[0px]",t),...n}),e.ToolbarButton=({title:t,children:n,...r})=>k.jsxs(wC,{children:[k.jsx(TC,{asChild:!0,children:k.jsx(e0,{type:"button",variant:"assistantMessageToolbarButton","aria-label":t,...r,children:n})}),k.jsx(EC,{side:"bottom",children:k.jsx("p",{children:t})})]}),e.CopyButton=({className:t,title:n,onClick:r,...a})=>{const u=sl(),f=(u==null?void 0:u.labels)??wu,[s,v]=B.useState(!1),x=A=>{v(!0),setTimeout(()=>v(!1),2e3),r&&r(A)};return k.jsx(e.ToolbarButton,{title:n||f.assistantMessageToolbarCopyMessageLabel,onClick:x,className:t,...a,children:s?k.jsx(lL,{className:"size-[18px]"}):k.jsx(VX,{className:"size-[18px]"})})},e.ThumbsUpButton=({title:t,...n})=>{const r=sl(),a=(r==null?void 0:r.labels)??wu;return k.jsx(e.ToolbarButton,{title:t||a.assistantMessageToolbarThumbsUpLabel,...n,children:k.jsx(Q0e,{className:"size-[18px]"})})},e.ThumbsDownButton=({title:t,...n})=>{const r=sl(),a=(r==null?void 0:r.labels)??wu;return k.jsx(e.ToolbarButton,{title:t||a.assistantMessageToolbarThumbsDownLabel,...n,children:k.jsx(Y0e,{className:"size-[18px]"})})},e.ReadAloudButton=({title:t,...n})=>{const r=sl(),a=(r==null?void 0:r.labels)??wu;return k.jsx(e.ToolbarButton,{title:t||a.assistantMessageToolbarReadAloudLabel,...n,children:k.jsx(ege,{className:"size-[20px]"})})},e.RegenerateButton=({title:t,...n})=>{const r=sl(),a=(r==null?void 0:r.labels)??wu;return k.jsx(e.ToolbarButton,{title:t||a.assistantMessageToolbarRegenerateLabel,...n,children:k.jsx(H0e,{className:"size-[18px]"})})}})(Dl||(Dl={}));Dl.MarkdownRenderer.displayName="CopilotChatAssistantMessage.MarkdownRenderer";Dl.Toolbar.displayName="CopilotChatAssistantMessage.Toolbar";Dl.CopyButton.displayName="CopilotChatAssistantMessage.CopyButton";Dl.ThumbsUpButton.displayName="CopilotChatAssistantMessage.ThumbsUpButton";Dl.ThumbsDownButton.displayName="CopilotChatAssistantMessage.ThumbsDownButton";Dl.ReadAloudButton.displayName="CopilotChatAssistantMessage.ReadAloudButton";Dl.RegenerateButton.displayName="CopilotChatAssistantMessage.RegenerateButton";var _8e=Dl;function y8e(e){return e?typeof e=="string"?e:e.map(t=>t&&typeof t=="object"&&"type"in t&&t.type==="text"&&typeof t.text=="string"?t.text:"").filter(t=>t.length>0).join(`
`):""}function Tu({message:e,onEditMessage:t,branchIndex:n,numberOfBranches:r,onSwitchToBranch:a,additionalToolbarItems:u,messageRenderer:f,toolbar:s,copyButton:v,editButton:x,branchNavigation:A,children:C,className:P,...L}){const F=B.useMemo(()=>y8e(e.content),[e.content]),U=Vs(f,Tu.MessageRenderer,{content:F}),q=Vs(v,Tu.CopyButton,{onClick:async()=>{if(F)try{await navigator.clipboard.writeText(F)}catch(de){console.error("Failed to copy message:",de)}}}),G=Vs(x,Tu.EditButton,{onClick:()=>t==null?void 0:t({message:e})}),$=Vs(A,Tu.BranchNavigation,{currentBranch:n,numberOfBranches:r,onSwitchToBranch:a,message:e}),X=r&&r>1&&a,ie=Vs(s,Tu.Toolbar,{children:k.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[u,q,t&&G,X&&$]})});return C?k.jsx(k.Fragment,{children:C({messageRenderer:U,toolbar:ie,copyButton:q,editButton:G,branchNavigation:$,message:e,branchIndex:n,numberOfBranches:r,additionalToolbarItems:u})}):k.jsxs("div",{className:uo("flex flex-col items-end group pt-10",P),"data-message-id":e.id,...L,children:[U,ie]})}(e=>{e.Container=({children:t,className:n,...r})=>k.jsx("div",{className:uo("flex flex-col items-end group",n),...r,children:t}),e.MessageRenderer=({content:t,className:n})=>k.jsx("div",{className:uo("prose dark:prose-invert bg-muted relative max-w-[80%] rounded-[18px] px-4 py-1.5 data-[multiline]:py-3 inline-block whitespace-pre-wrap",n),children:t}),e.Toolbar=({className:t,...n})=>k.jsx("div",{className:uo("w-full bg-transparent flex items-center justify-end -mr-[5px] mt-[4px] invisible group-hover:visible",t),...n}),e.ToolbarButton=({title:t,children:n,className:r,...a})=>k.jsxs(wC,{children:[k.jsx(TC,{asChild:!0,children:k.jsx(e0,{type:"button",variant:"assistantMessageToolbarButton","aria-label":t,className:uo(r),...a,children:n})}),k.jsx(EC,{side:"bottom",children:k.jsx("p",{children:t})})]}),e.CopyButton=({className:t,title:n,onClick:r,...a})=>{const u=sl(),f=(u==null?void 0:u.labels)??wu,[s,v]=B.useState(!1),x=A=>{v(!0),setTimeout(()=>v(!1),2e3),r&&r(A)};return k.jsx(e.ToolbarButton,{title:n||f.userMessageToolbarCopyMessageLabel,onClick:x,className:t,...a,children:s?k.jsx(lL,{className:"size-[18px]"}):k.jsx(VX,{className:"size-[18px]"})})},e.EditButton=({className:t,title:n,...r})=>{const a=sl(),u=(a==null?void 0:a.labels)??wu;return k.jsx(e.ToolbarButton,{title:n||u.userMessageToolbarEditMessageLabel,className:t,...r,children:k.jsx(q0e,{className:"size-[18px]"})})},e.BranchNavigation=({className:t,currentBranch:n=0,numberOfBranches:r=1,onSwitchToBranch:a,message:u,...f})=>{if(!r||r<=1||!a)return null;const s=n>0,v=n<r-1;return k.jsxs("div",{className:uo("flex items-center gap-1",t),...f,children:[k.jsx(e0,{type:"button",variant:"assistantMessageToolbarButton",onClick:()=>a==null?void 0:a({branchIndex:n-1,numberOfBranches:r,message:u}),disabled:!s,className:"h-6 w-6 p-0",children:k.jsx(P0e,{className:"size-[20px]"})}),k.jsxs("span",{className:"text-sm text-muted-foreground px-0 font-medium",children:[n+1,"/",r]}),k.jsx(e0,{type:"button",variant:"assistantMessageToolbarButton",onClick:()=>a==null?void 0:a({branchIndex:n+1,numberOfBranches:r,message:u}),disabled:!v,className:"h-6 w-6 p-0",children:k.jsx(UX,{className:"size-[20px]"})})]})}})(Tu||(Tu={}));Tu.Container.displayName="CopilotChatUserMessage.Container";Tu.MessageRenderer.displayName="CopilotChatUserMessage.MessageRenderer";Tu.Toolbar.displayName="CopilotChatUserMessage.Toolbar";Tu.ToolbarButton.displayName="CopilotChatUserMessage.ToolbarButton";Tu.CopyButton.displayName="CopilotChatUserMessage.CopyButton";Tu.EditButton.displayName="CopilotChatUserMessage.EditButton";Tu.BranchNavigation.displayName="CopilotChatUserMessage.BranchNavigation";var v8e=Tu,x8e="group inline-flex h-7 sm:h-8 items-center gap-1 sm:gap-1.5 rounded-full border border-border/60 bg-background px-2.5 sm:px-3 text-[11px] sm:text-xs leading-none text-foreground transition-colors cursor-pointer hover:bg-accent/60 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:text-muted-foreground disabled:hover:bg-background disabled:hover:text-muted-foreground pointer-events-auto",b8e="whitespace-nowrap font-medium leading-none",gne=ca.forwardRef(function({className:t,children:n,icon:r,isLoading:a,type:u,...f},s){const v=!a&&r;return k.jsxs("button",{ref:s,"data-slot":"suggestion-pill",className:Go(x8e,t),type:u??"button","aria-busy":a||void 0,disabled:a||f.disabled,...f,children:[a?k.jsx("span",{className:"flex h-3.5 sm:h-4 w-3.5 sm:w-4 items-center justify-center text-muted-foreground",children:k.jsx(N0e,{className:"h-3.5 sm:h-4 w-3.5 sm:w-4 animate-spin","aria-hidden":"true"})}):v&&k.jsx("span",{className:"flex h-3.5 sm:h-4 w-3.5 sm:w-4 items-center justify-center text-muted-foreground",children:r}),k.jsx("span",{className:b8e,children:n})]})});gne.displayName="CopilotChatSuggestionPill";var wH=gne,w8e=ca.forwardRef(function({className:t,...n},r){return k.jsx("div",{ref:r,className:Go("flex flex-wrap items-center gap-1.5 sm:gap-2 pl-0 pr-4 sm:px-0 pointer-events-none",t),...n})}),_ne=ca.forwardRef(function({suggestions:t,onSelectSuggestion:n,loadingIndexes:r,container:a,suggestion:u,className:f,children:s,...v},x){var F,U;const A=ca.useMemo(()=>!r||r.length===0?new Set:new Set(r),[r]),C=Vs(a,w8e,{ref:x,className:f,...v}),P=t.map((q,G)=>{const $=A.has(G)||q.isLoading===!0,X=Vs(u,wH,{children:q.title,isLoading:$,type:"button",onClick:()=>n==null?void 0:n(q,G)});return ca.cloneElement(X,{key:`${q.title}-${G}`})}),L=ca.cloneElement(C,void 0,P);if(typeof s=="function"){const q=Vs(u,wH,{children:((F=t[0])==null?void 0:F.title)??"",isLoading:t.length>0?A.has(0)||((U=t[0])==null?void 0:U.isLoading)===!0:!1,type:"button"});return k.jsx(k.Fragment,{children:s({container:L,suggestion:q,suggestions:t,onSelectSuggestion:n,loadingIndexes:r,className:f,...v})})}return s?k.jsxs(k.Fragment,{children:[L,s]}):L});_ne.displayName="CopilotChatSuggestionView";var T8e=_ne,E8e=ca.memo(function({message:t,messages:n,isRunning:r,AssistantMessageComponent:a}){return k.jsx(a,{message:t,messages:n,isRunning:r})},(e,t)=>{var u;if(e.message.id!==t.message.id||e.message.content!==t.message.content)return!1;const n=e.message.toolCalls,r=t.message.toolCalls;if((n==null?void 0:n.length)!==(r==null?void 0:r.length))return!1;if(n&&r)for(let f=0;f<n.length;f++){const s=n[f],v=r[f];if(!s||!v||s.id!==v.id||s.function.arguments!==v.function.arguments)return!1}if(n&&n.length>0){const f=new Set(n.map(x=>x.id)),s=e.messages.filter(x=>x.role==="tool"&&f.has(x.toolCallId)),v=t.messages.filter(x=>x.role==="tool"&&f.has(x.toolCallId));if(s.length!==v.length)return!1;for(let x=0;x<s.length;x++)if(s[x].content!==v[x].content)return!1}return!(((u=t.messages[t.messages.length-1])==null?void 0:u.id)===t.message.id&&e.isRunning!==t.isRunning||e.AssistantMessageComponent!==t.AssistantMessageComponent)}),S8e=ca.memo(function({message:t,UserMessageComponent:n}){return k.jsx(n,{message:t})},(e,t)=>!(e.message.id!==t.message.id||e.message.content!==t.message.content||e.UserMessageComponent!==t.UserMessageComponent)),A8e=ca.memo(function({message:t,renderActivityMessage:n}){return n(t)},(e,t)=>!(e.message.id!==t.message.id||e.message.activityType!==t.message.activityType||JSON.stringify(e.message.content)!==JSON.stringify(t.message.content))),TH=ca.memo(function({message:t,position:n,renderCustomMessage:r}){return r({message:t,position:n})},(e,t)=>!(e.message.id!==t.message.id||e.position!==t.position||e.message.content!==t.message.content||e.message.role!==t.message.role));function BD({messages:e=[],assistantMessage:t,userMessage:n,cursor:r,isRunning:a=!1,children:u,className:f,...s}){const v=d8e(),x=h8e(),A=e.flatMap(C=>{const P=[];if(v&&P.push(k.jsx(TH,{message:C,position:"before",renderCustomMessage:v},`${C.id}-custom-before`)),C.role==="assistant"){const L=typeof t=="function"?t:_8e;P.push(k.jsx(E8e,{message:C,messages:e,isRunning:a,AssistantMessageComponent:L},C.id))}else if(C.role==="user"){const L=typeof n=="function"?n:v8e;P.push(k.jsx(S8e,{message:C,UserMessageComponent:L},C.id))}else C.role==="activity"&&P.push(k.jsx(A8e,{message:C,renderActivityMessage:x},C.id));return v&&P.push(k.jsx(TH,{message:C,position:"after",renderCustomMessage:v},`${C.id}-custom-after`)),P}).filter(Boolean);return u?u({messageElements:A,messages:e,isRunning:a}):k.jsxs("div",{className:uo("flex flex-col",f),...s,children:[A,a&&Vs(r,BD.Cursor,{})]})}BD.Cursor=function({className:t,...n}){return k.jsx("div",{className:uo("w-[11px] h-[11px] rounded-full bg-foreground animate-pulse-cursor ml-1",t),...n})};var C8e=BD;function k8e(){const[e,t]=B.useState({isKeyboardOpen:!1,keyboardHeight:0,availableHeight:typeof window<"u"?window.innerHeight:0,viewportHeight:typeof window<"u"?window.innerHeight:0});return B.useEffect(()=>{if(typeof window>"u")return;const n=window.visualViewport;if(!n)return;const r=()=>{const a=window.innerHeight,u=n.height,f=Math.max(0,a-u),s=f>150;t({isKeyboardOpen:s,keyboardHeight:f,availableHeight:u,viewportHeight:a})};return r(),n.addEventListener("resize",r),n.addEventListener("scroll",r),()=>{n.removeEventListener("resize",r),n.removeEventListener("scroll",r)}},[]),e}function Jf({messageView:e,input:t,scrollView:n,scrollToBottomButton:r,feather:a,inputContainer:u,disclaimer:f,suggestionView:s,messages:v=[],autoScroll:x=!0,inputProps:A,isRunning:C=!1,suggestions:P,suggestionLoadingIndexes:L,onSelectSuggestion:F,children:U,className:q,...G}){const $=B.useRef(null),[X,ie]=B.useState(0),[de,fe]=B.useState(!1),be=B.useRef(null),{isKeyboardOpen:ve,keyboardHeight:Qe,availableHeight:we}=k8e();B.useEffect(()=>{const Pe=$.current;if(!Pe)return;const gn=new ResizeObserver(Et=>{for(const ze of Et){const $t=ze.contentRect.height;ie(Cn=>$t!==Cn?(fe(!0),be.current&&clearTimeout(be.current),be.current=setTimeout(()=>{fe(!1)},250),$t):Cn)}});return gn.observe(Pe),ie(Pe.offsetHeight),()=>{gn.disconnect(),be.current&&clearTimeout(be.current)}},[]);const qe=Vs(e,C8e,{messages:v,isRunning:C}),Je=Vs(t,s8e,A??{}),ft=Array.isArray(P)&&P.length>0,Mt=ft?Vs(s,T8e,{suggestions:P,loadingIndexes:L,onSelectSuggestion:F,className:"mb-3 lg:ml-4 lg:mr-4 ml-0 mr-0"}):null,Pt=Vs(a,Jf.Feather,{}),Nt=Vs(n,Jf.ScrollView,{autoScroll:x,scrollToBottomButton:r,inputContainerHeight:X,isResizing:de,children:k.jsx("div",{style:{paddingBottom:`${X+(ft?4:32)}px`},children:k.jsxs("div",{className:"max-w-3xl mx-auto",children:[qe,ft?k.jsx("div",{className:"pl-0 pr-4 sm:px-0 mt-4",children:Mt}):null]})})}),Kt=Vs(r,Jf.ScrollToBottomButton,{}),tt=Vs(f,Jf.Disclaimer,{}),mt=Vs(u,Jf.InputContainer,{ref:$,keyboardHeight:ve?Qe:0,children:k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"max-w-3xl mx-auto py-0 px-4 sm:px-0 [div[data-sidebar-chat]_&]:px-8 [div[data-popup-chat]_&]:px-6 pointer-events-auto",children:Je}),tt]})});return U?U({messageView:qe,input:Je,scrollView:Nt,scrollToBottomButton:Kt,feather:Pt,inputContainer:mt,disclaimer:tt,suggestionView:Mt??k.jsx(k.Fragment,{})}):k.jsxs("div",{className:uo("relative h-full",q),...G,children:[Nt,Pt,mt]})}(e=>{const t=({children:n,scrollToBottomButton:r,inputContainerHeight:a,isResizing:u})=>{const{isAtBottom:f,scrollToBottom:s}=hne();return k.jsxs(k.Fragment,{children:[k.jsx(bC.Content,{className:"overflow-y-scroll overflow-x-hidden",children:k.jsx("div",{className:"px-4 sm:px-0 [div[data-sidebar-chat]_&]:px-8 [div[data-popup-chat]_&]:px-6",children:n})}),!f&&!u&&k.jsx("div",{className:"absolute inset-x-0 flex justify-center z-10 pointer-events-none",style:{bottom:`${a+16}px`},children:Vs(r,e.ScrollToBottomButton,{onClick:()=>s()})})]})};e.ScrollView=({children:n,autoScroll:r=!0,scrollToBottomButton:a,inputContainerHeight:u=0,isResizing:f=!1,className:s,...v})=>{const[x,A]=B.useState(!1),{scrollRef:C,contentRef:P,scrollToBottom:L}=cne(),[F,U]=B.useState(!1);return B.useEffect(()=>{A(!0)},[]),B.useEffect(()=>{if(r)return;const q=C.current;if(!q)return;const G=()=>{const X=q.scrollHeight-q.scrollTop-q.clientHeight<10;U(!X)};G(),q.addEventListener("scroll",G);const $=new ResizeObserver(G);return $.observe(q),()=>{q.removeEventListener("scroll",G),$.disconnect()}},[C,r]),x?r?k.jsx(bC,{className:Go("h-full max-h-full flex flex-col min-h-0 relative",s),resize:"smooth",initial:"smooth",...v,children:k.jsx(t,{scrollToBottomButton:a,inputContainerHeight:u,isResizing:f,children:n})}):k.jsxs("div",{ref:C,className:Go("h-full max-h-full flex flex-col min-h-0 overflow-y-scroll overflow-x-hidden relative",s),...v,children:[k.jsx("div",{ref:P,className:"px-4 sm:px-0 [div[data-sidebar-chat]_&]:px-8 [div[data-popup-chat]_&]:px-6",children:n}),F&&!f&&k.jsx("div",{className:"absolute inset-x-0 flex justify-center z-10 pointer-events-none",style:{bottom:`${u+16}px`},children:Vs(a,e.ScrollToBottomButton,{onClick:()=>L()})})]}):k.jsx("div",{className:"h-full max-h-full flex flex-col min-h-0 overflow-y-scroll overflow-x-hidden",children:k.jsx("div",{className:"px-4 sm:px-0 [div[data-sidebar-chat]_&]:px-8 [div[data-popup-chat]_&]:px-6",children:n})})},e.ScrollToBottomButton=({className:n,...r})=>k.jsx(e0,{variant:"outline",size:"sm",className:uo("rounded-full w-10 h-10 p-0 pointer-events-auto","bg-white dark:bg-gray-900","shadow-lg border border-gray-200 dark:border-gray-700","hover:bg-gray-50 dark:hover:bg-gray-800","flex items-center justify-center cursor-pointer",n),...r,children:k.jsx(R0e,{className:"w-4 h-4 text-gray-600 dark:text-white"})}),e.Feather=({className:n,style:r,...a})=>k.jsx("div",{className:Go("absolute bottom-0 left-0 right-4 h-24 pointer-events-none z-10 bg-gradient-to-t","from-white via-white to-transparent","dark:from-[rgb(33,33,33)] dark:via-[rgb(33,33,33)]",n),style:r,...a}),e.InputContainer=ca.forwardRef(({children:n,className:r,keyboardHeight:a=0,...u},f)=>k.jsx("div",{ref:f,className:Go("absolute bottom-0 left-0 right-0 z-20 pointer-events-none",r),style:{transform:a>0?`translateY(-${a}px)`:void 0,transition:"transform 0.2s ease-out"},...u,children:n})),e.InputContainer.displayName="CopilotChatView.InputContainer",e.Disclaimer=({className:n,...r})=>{const a=sl(),u=(a==null?void 0:a.labels)??wu;return k.jsx("div",{className:Go("text-center text-xs text-muted-foreground py-3 px-4 max-w-3xl mx-auto",n),...r,children:u.chatDisclaimerText})}})(Jf||(Jf={}));function EH({agentId:e,threadId:t,labels:n,chatView:r,isModalDefaultOpen:a,...u}){const f=sl(),s=e??(f==null?void 0:f.agentId)??rx,v=B.useMemo(()=>t??(f==null?void 0:f.threadId)??nf(),[t,f==null?void 0:f.threadId]),{agent:x}=FD({agentId:s}),{copilotkit:A}=S0(),{suggestions:C}=p8e({agentId:s}),{inputProps:P,messageView:L,suggestionView:F,...U}=u;B.useEffect(()=>{const qe=async Je=>{try{await A.connectAgent({agent:Je})}catch(ft){if(!(ft instanceof rP))throw ft}};return x.threadId=v,qe(x),()=>{}},[v,x,A,s]);const q=B.useCallback(async qe=>{x.addMessage({id:nf(),role:"user",content:qe});try{await A.runAgent({agent:x})}catch(Je){console.error("CopilotChat: runAgent failed",Je)}},[x,A]),G=B.useCallback(async qe=>{x.addMessage({id:nf(),role:"user",content:qe.message});try{await A.runAgent({agent:x})}catch(Je){console.error("CopilotChat: runAgent failed after selecting suggestion",Je)}},[x,A]),$=B.useCallback(()=>{try{A.stopAgent({agent:x})}catch(qe){console.error("CopilotChat: stopAgent failed",qe);try{x.abortRun()}catch(Je){console.error("CopilotChat: abortRun fallback failed",Je)}}},[x,A]),X=ad({isRunning:x.isRunning,suggestions:C,onSelectSuggestion:G,suggestionView:F},{...U,...typeof L=="string"?{messageView:{className:L}}:L!==void 0?{messageView:L}:{}}),ie=P==null?void 0:P.onStop,de=x.messages.length>0,be=x.isRunning&&de?ie??$:ie,ve={...P,onSubmitMessage:q,onStop:be,isRunning:x.isRunning};ve.mode=x.isRunning?"processing":ve.mode??"input";const Qe=ad(X,{messages:x.messages,inputProps:ve}),we=Vs(r,Jf,Qe);return k.jsx(fne,{agentId:s,threadId:v,labels:n,isModalDefaultOpen:a,children:we})}(e=>{e.View=Jf})(EH||(EH={}));var yne=({className:e,...t})=>k.jsx(F0e,{className:Go("h-6 w-6",e),strokeWidth:1.75,fill:"currentColor",...t}),vne=({className:e,...t})=>k.jsx(uL,{className:Go("h-6 w-6",e),strokeWidth:1.75,...t});yne.displayName="CopilotChatToggleButton.OpenIcon";vne.displayName="CopilotChatToggleButton.CloseIcon";var SH=Object.freeze({transition:"opacity 120ms ease-out, transform 260ms cubic-bezier(0.22, 1, 0.36, 1)"}),AH="pointer-events-none absolute inset-0 flex items-center justify-center will-change-transform",I8e=Go("fixed bottom-6 right-6 z-[1100] flex h-14 w-14 items-center justify-center","rounded-full border border-primary bg-primary text-primary-foreground","shadow-sm transition-all duration-200 ease-out","hover:scale-[1.04] hover:shadow-md","cursor-pointer","active:scale-[0.96]","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 focus-visible:ring-offset-2 focus-visible:ring-offset-background","disabled:pointer-events-none disabled:opacity-60"),R8e=ca.forwardRef(function({openIcon:t,closeIcon:n,className:r,...a},u){const{onClick:f,type:s,disabled:v,...x}=a,A=sl(),C=(A==null?void 0:A.labels)??wu,[P,L]=B.useState(!1),F=(A==null?void 0:A.isModalOpen)??P,U=(A==null?void 0:A.setModalOpen)??L,q=de=>{if(v||(f&&f(de),de.defaultPrevented))return;U(!F)},G=Vs(t,yne,{className:"h-6 w-6","aria-hidden":!0,focusable:!1}),$=Vs(n,vne,{className:"h-6 w-6","aria-hidden":!0,focusable:!1}),X=k.jsx("span",{"aria-hidden":"true","data-slot":"chat-toggle-button-open-icon",className:AH,style:{...SH,opacity:F?0:1,transform:`scale(${F?.75:1}) rotate(${F?90:0}deg)`},children:G}),ie=k.jsx("span",{"aria-hidden":"true","data-slot":"chat-toggle-button-close-icon",className:AH,style:{...SH,opacity:F?1:0,transform:`scale(${F?1:.75}) rotate(${F?0:-90}deg)`},children:$});return k.jsxs("button",{ref:u,type:s??"button","data-slot":"chat-toggle-button","data-state":F?"open":"closed",className:Go(I8e,r),"aria-label":F?C.chatToggleCloseLabel:C.chatToggleOpenLabel,"aria-pressed":F,disabled:v,onClick:q,...x,children:[X,ie]})});R8e.displayName="CopilotChatToggleButton";function g_({title:e,titleContent:t,closeButton:n,children:r,className:a,...u}){const f=sl(),s=(f==null?void 0:f.labels.modalHeaderTitle)??wu.modalHeaderTitle,v=e??s,x=B.useCallback(()=>{f==null||f.setModalOpen(!1)},[f]),A=Vs(t,g_.Title,{children:v}),C=Vs(n,g_.CloseButton,{onClick:x});return r?r({titleContent:A,closeButton:C,title:v,...u}):k.jsx("header",{"data-slot":"copilot-modal-header",className:Go("flex items-center justify-between border-b border-border px-4 py-4","bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/80",a),...u,children:k.jsxs("div",{className:"flex w-full items-center gap-2",children:[k.jsx("div",{className:"flex-1","aria-hidden":"true"}),k.jsx("div",{className:"flex flex-1 justify-center text-center",children:A}),k.jsx("div",{className:"flex flex-1 justify-end",children:C})]})})}g_.displayName="CopilotModalHeader";(e=>{e.Title=({children:t,className:n,...r})=>k.jsx("div",{className:Go("w-full text-base font-medium leading-none tracking-tight text-foreground",n),...r,children:t}),e.CloseButton=({className:t,...n})=>k.jsx("button",{type:"button",className:Go("inline-flex size-8 items-center justify-center rounded-full text-muted-foreground transition cursor-pointer","hover:bg-muted hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",t),"aria-label":"Close",...n,children:k.jsx(uL,{className:"h-4 w-4","aria-hidden":"true"})})})(g_||(g_={}));g_.Title.displayName="CopilotModalHeader.Title";g_.CloseButton.displayName="CopilotModalHeader.CloseButton";function M8e(e){const t=e.args?e.args:une();return{name:e.name,args:t,render:e.render,...e.agentId?{agentId:e.agentId}:{}}}M8e({name:"*",render:({args:e,result:t,name:n,status:r})=>{const[a,u]=B.useState(!1),f=String(r),x=f==="inProgress"||f==="executing"?"bg-amber-100 text-amber-800 dark:bg-amber-500/15 dark:text-amber-400":f==="complete"?"bg-emerald-100 text-emerald-800 dark:bg-emerald-500/15 dark:text-emerald-400":"bg-zinc-100 text-zinc-800 dark:bg-zinc-700/40 dark:text-zinc-300";return k.jsx("div",{className:"mt-2 pb-2",children:k.jsxs("div",{className:"rounded-xl border border-zinc-200/60 dark:border-zinc-800/60 bg-white/70 dark:bg-zinc-900/50 shadow-sm backdrop-blur p-4",children:[k.jsxs("div",{className:"flex items-center justify-between gap-3 cursor-pointer",onClick:()=>u(!a),children:[k.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[k.jsx("svg",{className:`h-4 w-4 text-zinc-500 dark:text-zinc-400 transition-transform ${a?"rotate-90":""}`,fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",children:k.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})}),k.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-blue-500"}),k.jsx("span",{className:"truncate text-sm font-medium text-zinc-900 dark:text-zinc-100",children:n})]}),k.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${x}`,children:String(r)})]}),a&&k.jsxs("div",{className:"mt-3 grid gap-4",children:[k.jsxs("div",{children:[k.jsx("div",{className:"text-xs uppercase tracking-wide text-zinc-500 dark:text-zinc-400",children:"Arguments"}),k.jsx("pre",{className:"mt-2 max-h-64 overflow-auto rounded-md bg-zinc-50 dark:bg-zinc-800/60 p-3 text-xs leading-relaxed text-zinc-800 dark:text-zinc-200 whitespace-pre-wrap break-words",children:JSON.stringify(e??{},null,2)})]}),t!==void 0&&k.jsxs("div",{children:[k.jsx("div",{className:"text-xs uppercase tracking-wide text-zinc-500 dark:text-zinc-400",children:"Result"}),k.jsx("pre",{className:"mt-2 max-h-64 overflow-auto rounded-md bg-zinc-50 dark:bg-zinc-800/60 p-3 text-xs leading-relaxed text-zinc-800 dark:text-zinc-200 whitespace-pre-wrap break-words",children:typeof t=="string"?t:JSON.stringify(t,null,2)})]})]})]})})}});function CH(e){if(!e)return{};const t=e,{messages:n,tools:r,copilotkit:a}=t;return Fm(t,["messages","tools","copilotkit"])}function P8e(e,t){if(e&&!t||!e&&t)return!1;const n=e,{messages:r,tools:a,copilotkit:u}=n,f=Fm(n,["messages","tools","copilotkit"]),s=t,{messages:v,tools:x,copilotkit:A}=s,C=Fm(s,["messages","tools","copilotkit"]);return JSON.stringify(f)===JSON.stringify(C)}function O8e(e,t){var n;const{stateSnapshot:r,messageIndexInRun:a,message:u}=t,{coAgentStateRenders:f,claimsRef:s}=nhe(),{agent:v}=FD({agentId:e}),[x,A]=B.useState(void 0),P=((n=t.runId)!=null?n:u.runId)||"pending";B.useEffect(()=>{if(!v)return;const U={onStepStartedEvent:({event:G})=>{G.stepName!==x&&A(G.stepName)},onStepFinishedEvent:({event:G})=>{G.stepName===x&&A(void 0)}},{unsubscribe:q}=v.subscribe(U);return()=>{q()}},[e,x]);const L=B.useCallback(U=>Object.entries(f).find(([q,G])=>{if(s.current[U])return q===s.current[U].stateRenderId;const $=G.name===e,X=G.nodeName?G.nodeName===x:!0;return $&&X}),[f,x,e]),F=({stateRenderId:U,messageId:q,runId:G,stateSnapshot:$})=>{if(s.current[q]){const ie=s.current[q].stateRenderId===U;return ie&&G&&(!s.current[q].runId||s.current[q].runId==="pending")&&(s.current[q].runId=G),ie}const X=Object.values(s.current).find(ie=>ie.stateRenderId===U&&bB(CH(ie.stateSnapshot))===bB(CH($)));return X?$&&X.stateSnapshot&&!P8e(X.stateSnapshot,$)?(s.current[q]={stateRenderId:U,runId:G},!0):!1:(s.current[q]={stateRenderId:U,runId:G},!0)};return B.useMemo(()=>{var U,q,G;if(a!==0)return null;const[$,X]=(U=L(u.id))!=null?U:[];if(!X||!$)return null;const ie=r?jM(r,r):v==null?void 0:v.state;if(!F({stateRenderId:$,messageId:u.id,runId:P,stateSnapshot:ie}))return null;if(ie&&!s.current[u.id].locked&&(r?(s.current[u.id].stateSnapshot=ie,s.current[u.id].locked=!0):s.current[u.id].stateSnapshot=ie),X.handler&&X.handler({state:r?jM(r,r):(q=v==null?void 0:v.state)!=null?q:{},nodeName:x??""}),X.render){const fe=v!=null&&v.isRunning?"inProgress":"complete";return typeof X.render=="string"?X.render:X.render({status:fe,state:(G=s.current[u.id].stateSnapshot)!=null?G:{},nodeName:x??""})}},[L,r,v==null?void 0:v.state,v==null?void 0:v.isRunning,x,P,u.id,a])}function L8e(e){return O8e(e.agentId,e)}var xne=B.createContext(void 0);function D8e({children:e,threadId:t}){const[n,r]=B.useState(t??QW()),a=n;return k.jsx(xne.Provider,{value:{threadId:a,setThreadId:r},children:e})}function N8e(){const e=B.useContext(xne);if(!e)throw new Error("useThreads must be used within ThreadsProvider");return e}var z8e=e=>{const t=B.useRef([]),n=B.useCallback(r=>({onCustomEvent:({event:a})=>{a.name==="PredictState"&&(t.current=a.value)},onToolCallArgsEvent:({partialToolCallArgs:a,toolCallName:u})=>{t.current.forEach(f=>{if((f==null?void 0:f.tool)!==u)return;const s=typeof a=="string"?jM(a,a):a;r.setState({[f.state_key]:s[f.state_key]})})}}),[]);B.useEffect(()=>{if(!e)return;const r=n(e),{unsubscribe:a}=e.subscribe(r);return()=>{a()}},[e,n])};function F8e(){const{copilotkit:e}=S0(),t=sl(),n=t==null?void 0:t.agentId,{setBannerError:r}=oZ(),{agent:a}=FD({agentId:n});return z8e(a),B.useEffect(()=>{const u={onError:({error:s})=>{r(new ide({error:s,message:s.message}))}},f=e.subscribe(u);return()=>{f.unsubscribe()}},[e==null?void 0:e.subscribe]),null}function B8e(e){var t=e,{children:n}=t,r=Fm(t,["children"]);const a=U2(r.showDevConsole),u=U2(r.enableInspector),f=r.publicApiKey||r.publicLicenseKey,s=B.useMemo(()=>[{render:L8e}],[]);return k.jsx(Lde,{enabled:a,children:k.jsx(Bde,{publicApiKey:f,showUsageBanner:a,children:k.jsx(D8e,{threadId:r.threadId,children:k.jsx(l8e,Xl(Ga({},r),{showDevConsole:u,renderCustomMessages:s,useSingleEndpoint:!0,children:k.jsx(j8e,Xl(Ga({},r),{children:n}))}))})})})}function j8e(e){var t;const n=e,{children:r}=n,a=Fm(n,["children"]);$8e(e);const u=a.publicLicenseKey||a.publicApiKey,f=a.runtimeUrl||bde,[s,v]=B.useState({}),[x,A]=B.useState(new Map),C=B.useRef({actions:{},coAgentStateRenders:{}}),{addElement:P,removeElement:L,printTree:F,getAllElements:U}=Xde(),[q,G]=B.useState(!1),[$,X]=B.useState(""),[ie,de]=B.useState({}),[fe,be]=B.useState({}),[ve,Qe]=B.useState([]),{addElement:we,removeElement:qe,allElements:Je}=Qde(),ft=B.useCallback((Ve,or)=>{v(_n=>Xl(Ga({},_n),{[Ve]:or}))},[]),Mt=B.useCallback(Ve=>{v(or=>{const _n=Ga({},or);return delete _n[Ve],_n})},[]),Pt=B.useCallback((Ve,or)=>{const _n=Ve.map(Tn=>`${Tn.name} (${Tn.sourceApplication}):
${Tn.getContents()}`).join(`

`),Yn=F(or);return`${_n}

${Yn}`},[F]),Nt=B.useCallback((Ve,or,_n=kH)=>P(Ve,_n,or),[P]),Kt=B.useCallback(Ve=>{L(Ve)},[L]),tt=B.useCallback(()=>U(),[U]),mt=B.useCallback(Ve=>U8e(Object.values(Ve||s)),[s]),Pe=B.useCallback(Ve=>Je(Ve),[Je]),gn=B.useCallback((Ve,or=kH)=>we(Ve,or),[we]),Et=B.useCallback(Ve=>{qe(Ve)},[qe]),ze=B.useMemo(()=>{var Ve,or;let _n;return u&&(_n={guardrails:{input:{restrictToTopic:{enabled:!!a.guardrails_c,validTopics:((Ve=a.guardrails_c)==null?void 0:Ve.validTopics)||[],invalidTopics:((or=a.guardrails_c)==null?void 0:or.invalidTopics)||[]}}}}),Xl(Ga({publicApiKey:u},_n?{cloud:_n}:{}),{chatApiEndpoint:f,headers:a.headers||{},properties:a.properties||{},transcribeAudioUrl:a.transcribeAudioUrl,textToSpeechUrl:a.textToSpeechUrl,credentials:a.credentials})},[u,a.headers,a.properties,a.transcribeAudioUrl,a.textToSpeechUrl,a.credentials,a.cloudRestrictToTopic,a.guardrails_c]);B.useMemo(()=>{const Ve=Object.values(ie||{}).reduce((or,_n)=>_n.status==="authenticated"&&_n.authHeaders?Ga(Ga({},or),Object.entries(_n.authHeaders).reduce((Yn,[Tn,ti])=>Xl(Ga({},Yn),{[Tn.startsWith("X-Custom-")?Tn:`X-Custom-${Tn}`]:ti}),{})):or,{});return Ga(Ga(Ga({},ze.headers||{}),ze.publicApiKey?{[eZ]:ze.publicApiKey}:{}),Ve)},[ze.headers,ze.publicApiKey,ie]);const[$t,Cn]=B.useState({}),fn=B.useCallback(Ve=>{Cn(or=>Ga(Ga({},or),Ve))},[]),Nn=B.useCallback(Ve=>{Cn(or=>{const _n=or,{[Ve]:Yn}=_n;return Fm(_n,[o5(Ve)])})},[]),bn=B.useRef(a.onError);B.useEffect(()=>{bn.current=a.onError},[a.onError]);const Vt=B.useRef({});B.useEffect(()=>{Vt.current=$t},[$t]);const En=B.useCallback(Ve=>Rv(this,null,function*(){if(ze.publicApiKey&&bn.current)try{yield bn.current(Ve)}catch(_n){console.error("Error in public onError handler:",_n)}const or=Object.values(Vt.current);yield Promise.all(or.map(_n=>Promise.resolve(_n(Ve)).catch(Yn=>console.error("Error in internal error handler:",Yn))))}),[ze.publicApiKey]),[Sn,Un]=B.useState({}),nn=B.useCallback((Ve,or)=>{Un(_n=>Xl(Ga({},_n),{[Ve]:or}))},[Un]),wr=B.useCallback(Ve=>{Un(or=>{const _n=or,{[Ve]:Yn}=_n;return Fm(_n,[o5(Ve)])})},[Un]),[Xr,ar]=B.useState([]),[tr,Vn]=B.useState({}),xr=B.useRef({}),ws=B.useCallback(Ve=>{const or=typeof Ve=="function"?Ve(xr.current):Ve;xr.current=or,Vn(_n=>or)},[]);let bi=null;a.agent&&(bi={agentName:a.agent});const[Ai,ps]=B.useState(bi);B.useEffect(()=>{a.agent?ps({agentName:a.agent}):ps(null)},[a.agent]);const{threadId:$i,setThreadId:Ts}=N8e(),tn=B.useCallback(Ve=>{if(a.threadId)throw new Error("Cannot call setThreadId() when threadId is provided via props.");Ts(Ve)},[a.threadId]),[kn,Mr]=B.useState(null),wt=B.useRef(null),Rn=U2(a.showDevConsole),[nr,dt]=B.useState({}),Jn=B.useCallback(Ve=>{dt(or=>{var _n;return Ve==null||!Ve.id?or:Xl(Ga({},or),{[Ve.id]:Ga(Ga({},(_n=or[Ve.id])!=null?_n:{}),Ve)})})},[]),qr=B.useCallback(Ve=>{dt(or=>{const _n=or,{[Ve]:Yn}=_n;return Fm(_n,[o5(Ve)])})},[]),[ts,ms]=B.useState({}),Mn=B.useCallback(Ve=>{ms(or=>{const _n=or[Ve.threadId]||[];return Xl(Ga({},or),{[Ve.threadId]:[..._n,Ve]})})},[]),Tt=B.useCallback((Ve,or,_n)=>{ms(Yn=>{const Tn=Yn[Ve]||[];return Xl(Ga({},Yn),{[Ve]:Tn.map(ti=>ti.eventId===or?Xl(Ga({},ti),{event:Xl(Ga({},ti.event),{response:_n})}):ti)})})},[]),ut=B.useMemo(()=>r,[r]),[on,qn]=B.useState(null),Or=B.useMemo(()=>{var Ve;return(Ve=a.agent)!=null?Ve:null},[a.agent]),Zn=B.useMemo(()=>{var Ve;return(Ve=a.forwardedParameters)!=null?Ve:{}},[a.forwardedParameters]),ns=B.useCallback(Ve=>{be(or=>{const _n=typeof Ve=="function"?Ve(or):Ve;return Object.keys(_n).length===Object.keys(or).length&&Object.entries(_n).every(([ti,Sr])=>or[ti]===Sr)?or:_n})},[be]),ga=B.useCallback(Ve=>{de(or=>{const _n=typeof Ve=="function"?Ve(or):Ve;return Object.keys(_n).length===Object.keys(or).length&&Object.entries(_n).every(([ti,Sr])=>or[ti]===Sr)?or:_n})},[de]),Ys=B.useCallback(Ve=>{const or=Ve.action.name||QW();return A(_n=>{const Yn=new Map(_n);return Yn.set(or,Ve),Yn}),or},[]),rn=B.useCallback(Ve=>{A(or=>{const _n=new Map(or);return _n.delete(Ve),_n})},[]),rr=B.useMemo(()=>()=>k.jsx(k.Fragment,{children:Array.from(x.entries()).map(([Ve,or])=>{const _n=or.component;return k.jsx(_n,{action:or.action},Ve)})}),[x]);return k.jsx(fne,{agentId:(t=a.agent)!=null?t:"default",threadId:$i,children:k.jsxs(pZ.Provider,{value:{actions:s,chatComponentsCache:C,getFunctionCallHandler:mt,setAction:ft,removeAction:Mt,setRegisteredActions:Ys,removeRegisteredAction:rn,getContextString:Pt,addContext:Nt,removeContext:Kt,getAllContext:tt,getDocumentsContext:Pe,addDocumentContext:gn,removeDocumentContext:Et,copilotApiConfig:ze,isLoading:q,setIsLoading:G,chatSuggestionConfiguration:Sn,addChatSuggestionConfiguration:nn,removeChatSuggestionConfiguration:wr,chatInstructions:$,setChatInstructions:X,additionalInstructions:ve,setAdditionalInstructions:Qe,showDevConsole:Rn,coagentStates:tr,setCoagentStates:Vn,coagentStatesRef:xr,setCoagentStatesWithRef:ws,agentSession:Ai,setAgentSession:ps,forwardedParameters:Zn,agentLock:Or,threadId:$i,setThreadId:tn,runId:kn,setRunId:Mr,chatAbortControllerRef:wt,availableAgents:Xr,authConfig_c:a.authConfig_c,authStates_c:ie,setAuthStates_c:ga,extensions:fe,setExtensions:ns,interruptActions:nr,setInterruptAction:Jn,removeInterruptAction:qr,interruptEventQueue:ts,addInterruptEvent:Mn,resolveInterruptEvent:Tt,bannerError:on,setBannerError:qn,onError:En,internalErrorHandlers:$t,setInternalErrorHandler:fn,removeInternalErrorHandler:Nn},children:[k.jsx(F8e,{}),k.jsxs(the,{children:[k.jsx(Gde,{children:k.jsxs(qde,{children:[ut,k.jsx(rr,{})]})}),on&&Rn&&k.jsx(dZ,{severity:on.severity,message:on.message,onClose:()=>qn(null),actions:hZ(on)})]})]})})}var kH=["global"];function U8e(e){return t=>Rv(this,[t],function*({name:n,args:r}){let a={};for(let s of e)a[s.name]=s;const u=a[n];let f;return u&&(yield new Promise((s,v)=>{xT.flushSync(()=>Rv(this,null,function*(){var x;try{f=yield(x=u.handler)==null?void 0:x.call(u,r),s()}catch(A){v(A)}}))}),yield new Promise(s=>setTimeout(s,20))),f})}function V8e(e){return e.replace(/_c$/,"").split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" ")}function $8e(e){const t=Object.keys(e).filter(r=>r.endsWith("_c")),n=e.publicApiKey||e.publicLicenseKey;if(!e.runtimeUrl&&!n)throw new ZW("Missing required prop: 'runtimeUrl' or 'publicApiKey' or 'publicLicenseKey'");if(t.length>0&&!n)throw new sde(`Missing required prop: 'publicApiKey' or 'publicLicenseKey' to use cloud features: ${t.map(V8e).join(", ")}`)}function H8e({description:e,value:t,convert:n,available:r},a){const{copilotkit:u}=S0(),f=B.useRef(void 0);return B.useEffect(()=>{if(!u)return;const s=Object.entries(u.context).find(([v,x])=>JSON.stringify({description:e,value:t})==JSON.stringify(x));if(s){f.current=s[0],r==="disabled"&&u.removeContext(f.current);return}if(!(!s&&r==="disabled"))return f.current=u.addContext({description:e,value:(n??JSON.stringify)(t)}),()=>{f.current&&u.removeContext(f.current)}},[e,t,n]),f.current}function bne(e,t){return function(){return e.apply(t,arguments)}}const{toString:G8e}=Object.prototype,{getPrototypeOf:jD}=Object,{iterator:Ck,toStringTag:wne}=Symbol,kk=(e=>t=>{const n=G8e.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),fh=e=>(e=e.toLowerCase(),t=>kk(t)===e),Ik=e=>t=>typeof t===e,{isArray:vx}=Array,Wv=Ik("undefined");function HT(e){return e!==null&&!Wv(e)&&e.constructor!==null&&!Wv(e.constructor)&&Ju(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Tne=fh("ArrayBuffer");function q8e(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&Tne(e.buffer),t}const W8e=Ik("string"),Ju=Ik("function"),Ene=Ik("number"),GT=e=>e!==null&&typeof e=="object",Z8e=e=>e===!0||e===!1,U4=e=>{if(kk(e)!=="object")return!1;const t=jD(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(wne in e)&&!(Ck in e)},X8e=e=>{if(!GT(e)||HT(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},Y8e=fh("Date"),K8e=fh("File"),Q8e=fh("Blob"),J8e=fh("FileList"),eOe=e=>GT(e)&&Ju(e.pipe),tOe=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Ju(e.append)&&((t=kk(e))==="formdata"||t==="object"&&Ju(e.toString)&&e.toString()==="[object FormData]"))},nOe=fh("URLSearchParams"),[rOe,iOe,sOe,aOe]=["ReadableStream","Request","Response","Headers"].map(fh),oOe=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function qT(e,t,{allOwnKeys:n=!1}={}){if(e===null||typeof e>"u")return;let r,a;if(typeof e!="object"&&(e=[e]),vx(e))for(r=0,a=e.length;r<a;r++)t.call(null,e[r],r,e);else{if(HT(e))return;const u=n?Object.getOwnPropertyNames(e):Object.keys(e),f=u.length;let s;for(r=0;r<f;r++)s=u[r],t.call(null,e[s],s,e)}}function Sne(e,t){if(HT(e))return null;t=t.toLowerCase();const n=Object.keys(e);let r=n.length,a;for(;r-- >0;)if(a=n[r],t===a.toLowerCase())return a;return null}const Dg=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Ane=e=>!Wv(e)&&e!==Dg;function j8(){const{caseless:e,skipUndefined:t}=Ane(this)&&this||{},n={},r=(a,u)=>{const f=e&&Sne(n,u)||u;U4(n[f])&&U4(a)?n[f]=j8(n[f],a):U4(a)?n[f]=j8({},a):vx(a)?n[f]=a.slice():(!t||!Wv(a))&&(n[f]=a)};for(let a=0,u=arguments.length;a<u;a++)arguments[a]&&qT(arguments[a],r);return n}const lOe=(e,t,n,{allOwnKeys:r}={})=>(qT(t,(a,u)=>{n&&Ju(a)?e[u]=bne(a,n):e[u]=a},{allOwnKeys:r}),e),uOe=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),cOe=(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},dOe=(e,t,n,r)=>{let a,u,f;const s={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),u=a.length;u-- >0;)f=a[u],(!r||r(f,e,t))&&!s[f]&&(t[f]=e[f],s[f]=!0);e=n!==!1&&jD(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},hOe=(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},fOe=e=>{if(!e)return null;if(vx(e))return e;let t=e.length;if(!Ene(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},pOe=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&jD(Uint8Array)),mOe=(e,t)=>{const r=(e&&e[Ck]).call(e);let a;for(;(a=r.next())&&!a.done;){const u=a.value;t.call(e,u[0],u[1])}},gOe=(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},_Oe=fh("HTMLFormElement"),yOe=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,a){return r.toUpperCase()+a}),IH=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),vOe=fh("RegExp"),Cne=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};qT(n,(a,u)=>{let f;(f=t(a,u,e))!==!1&&(r[u]=f||a)}),Object.defineProperties(e,r)},xOe=e=>{Cne(e,(t,n)=>{if(Ju(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];if(Ju(r)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},bOe=(e,t)=>{const n={},r=a=>{a.forEach(u=>{n[u]=!0})};return vx(e)?r(e):r(String(e).split(t)),n},wOe=()=>{},TOe=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function EOe(e){return!!(e&&Ju(e.append)&&e[wne]==="FormData"&&e[Ck])}const SOe=e=>{const t=new Array(10),n=(r,a)=>{if(GT(r)){if(t.indexOf(r)>=0)return;if(HT(r))return r;if(!("toJSON"in r)){t[a]=r;const u=vx(r)?[]:{};return qT(r,(f,s)=>{const v=n(f,a+1);!Wv(v)&&(u[s]=v)}),t[a]=void 0,u}}return r};return n(e,0)},AOe=fh("AsyncFunction"),COe=e=>e&&(GT(e)||Ju(e))&&Ju(e.then)&&Ju(e.catch),kne=((e,t)=>e?setImmediate:t?((n,r)=>(Dg.addEventListener("message",({source:a,data:u})=>{a===Dg&&u===n&&r.length&&r.shift()()},!1),a=>{r.push(a),Dg.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Ju(Dg.postMessage)),kOe=typeof queueMicrotask<"u"?queueMicrotask.bind(Dg):typeof process<"u"&&process.nextTick||kne,IOe=e=>e!=null&&Ju(e[Ck]),an={isArray:vx,isArrayBuffer:Tne,isBuffer:HT,isFormData:tOe,isArrayBufferView:q8e,isString:W8e,isNumber:Ene,isBoolean:Z8e,isObject:GT,isPlainObject:U4,isEmptyObject:X8e,isReadableStream:rOe,isRequest:iOe,isResponse:sOe,isHeaders:aOe,isUndefined:Wv,isDate:Y8e,isFile:K8e,isBlob:Q8e,isRegExp:vOe,isFunction:Ju,isStream:eOe,isURLSearchParams:nOe,isTypedArray:pOe,isFileList:J8e,forEach:qT,merge:j8,extend:lOe,trim:oOe,stripBOM:uOe,inherits:cOe,toFlatObject:dOe,kindOf:kk,kindOfTest:fh,endsWith:hOe,toArray:fOe,forEachEntry:mOe,matchAll:gOe,isHTMLForm:_Oe,hasOwnProperty:IH,hasOwnProp:IH,reduceDescriptors:Cne,freezeMethods:xOe,toObjectSet:bOe,toCamelCase:yOe,noop:wOe,toFiniteNumber:TOe,findKey:Sne,global:Dg,isContextDefined:Ane,isSpecCompliantForm:EOe,toJSONObject:SOe,isAsyncFn:AOe,isThenable:COe,setImmediate:kne,asap:kOe,isIterable:IOe};function ks(e,t,n,r,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),a&&(this.response=a,this.status=a.status?a.status:null)}an.inherits(ks,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:an.toJSONObject(this.config),code:this.code,status:this.status}}});const Ine=ks.prototype,Rne={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Rne[e]={value:e}});Object.defineProperties(ks,Rne);Object.defineProperty(Ine,"isAxiosError",{value:!0});ks.from=(e,t,n,r,a,u)=>{const f=Object.create(Ine);an.toFlatObject(e,f,function(A){return A!==Error.prototype},x=>x!=="isAxiosError");const s=e&&e.message?e.message:"Error",v=t==null&&e?e.code:t;return ks.call(f,s,v,n,r,a),e&&f.cause==null&&Object.defineProperty(f,"cause",{value:e,configurable:!0}),f.name=e&&e.name||"Error",u&&Object.assign(f,u),f};const ROe=null;function U8(e){return an.isPlainObject(e)||an.isArray(e)}function Mne(e){return an.endsWith(e,"[]")?e.slice(0,-2):e}function RH(e,t,n){return e?e.concat(t).map(function(a,u){return a=Mne(a),!n&&u?"["+a+"]":a}).join(n?".":""):t}function MOe(e){return an.isArray(e)&&!e.some(U8)}const POe=an.toFlatObject(an,{},null,function(t){return/^is[A-Z]/.test(t)});function Rk(e,t,n){if(!an.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=an.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(U,q){return!an.isUndefined(q[U])});const r=n.metaTokens,a=n.visitor||A,u=n.dots,f=n.indexes,v=(n.Blob||typeof Blob<"u"&&Blob)&&an.isSpecCompliantForm(t);if(!an.isFunction(a))throw new TypeError("visitor must be a function");function x(F){if(F===null)return"";if(an.isDate(F))return F.toISOString();if(an.isBoolean(F))return F.toString();if(!v&&an.isBlob(F))throw new ks("Blob is not supported. Use a Buffer instead.");return an.isArrayBuffer(F)||an.isTypedArray(F)?v&&typeof Blob=="function"?new Blob([F]):Buffer.from(F):F}function A(F,U,q){let G=F;if(F&&!q&&typeof F=="object"){if(an.endsWith(U,"{}"))U=r?U:U.slice(0,-2),F=JSON.stringify(F);else if(an.isArray(F)&&MOe(F)||(an.isFileList(F)||an.endsWith(U,"[]"))&&(G=an.toArray(F)))return U=Mne(U),G.forEach(function(X,ie){!(an.isUndefined(X)||X===null)&&t.append(f===!0?RH([U],ie,u):f===null?U:U+"[]",x(X))}),!1}return U8(F)?!0:(t.append(RH(q,U,u),x(F)),!1)}const C=[],P=Object.assign(POe,{defaultVisitor:A,convertValue:x,isVisitable:U8});function L(F,U){if(!an.isUndefined(F)){if(C.indexOf(F)!==-1)throw Error("Circular reference detected in "+U.join("."));C.push(F),an.forEach(F,function(G,$){(!(an.isUndefined(G)||G===null)&&a.call(t,G,an.isString($)?$.trim():$,U,P))===!0&&L(G,U?U.concat($):[$])}),C.pop()}}if(!an.isObject(e))throw new TypeError("data must be an object");return L(e),t}function MH(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function UD(e,t){this._pairs=[],e&&Rk(e,this,t)}const Pne=UD.prototype;Pne.append=function(t,n){this._pairs.push([t,n])};Pne.toString=function(t){const n=t?function(r){return t.call(this,r,MH)}:MH;return this._pairs.map(function(a){return n(a[0])+"="+n(a[1])},"").join("&")};function OOe(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function One(e,t,n){if(!t)return e;const r=n&&n.encode||OOe;an.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let u;if(a?u=a(t,n):u=an.isURLSearchParams(t)?t.toString():new UD(t,n).toString(r),u){const f=e.indexOf("#");f!==-1&&(e=e.slice(0,f)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}class PH{constructor(){this.handlers=[]}use(t,n,r){return this.handlers.push({fulfilled:t,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){an.forEach(this.handlers,function(r){r!==null&&t(r)})}}const Lne={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},LOe=typeof URLSearchParams<"u"?URLSearchParams:UD,DOe=typeof FormData<"u"?FormData:null,NOe=typeof Blob<"u"?Blob:null,zOe={isBrowser:!0,classes:{URLSearchParams:LOe,FormData:DOe,Blob:NOe},protocols:["http","https","file","blob","url","data"]},VD=typeof window<"u"&&typeof document<"u",V8=typeof navigator=="object"&&navigator||void 0,FOe=VD&&(!V8||["ReactNative","NativeScript","NS"].indexOf(V8.product)<0),BOe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",jOe=VD&&window.location.href||"http://localhost",UOe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:VD,hasStandardBrowserEnv:FOe,hasStandardBrowserWebWorkerEnv:BOe,navigator:V8,origin:jOe},Symbol.toStringTag,{value:"Module"})),Jl={...UOe,...zOe};function VOe(e,t){return Rk(e,new Jl.classes.URLSearchParams,{visitor:function(n,r,a,u){return Jl.isNode&&an.isBuffer(n)?(this.append(r,n.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)},...t})}function $Oe(e){return an.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function HOe(e){const t={},n=Object.keys(e);let r;const a=n.length;let u;for(r=0;r<a;r++)u=n[r],t[u]=e[u];return t}function Dne(e){function t(n,r,a,u){let f=n[u++];if(f==="__proto__")return!0;const s=Number.isFinite(+f),v=u>=n.length;return f=!f&&an.isArray(a)?a.length:f,v?(an.hasOwnProp(a,f)?a[f]=[a[f],r]:a[f]=r,!s):((!a[f]||!an.isObject(a[f]))&&(a[f]=[]),t(n,r,a[f],u)&&an.isArray(a[f])&&(a[f]=HOe(a[f])),!s)}if(an.isFormData(e)&&an.isFunction(e.entries)){const n={};return an.forEachEntry(e,(r,a)=>{t($Oe(r),a,n,0)}),n}return null}function GOe(e,t,n){if(an.isString(e))try{return(t||JSON.parse)(e),an.trim(e)}catch(r){if(r.name!=="SyntaxError")throw r}return(n||JSON.stringify)(e)}const WT={transitional:Lne,adapter:["xhr","http","fetch"],transformRequest:[function(t,n){const r=n.getContentType()||"",a=r.indexOf("application/json")>-1,u=an.isObject(t);if(u&&an.isHTMLForm(t)&&(t=new FormData(t)),an.isFormData(t))return a?JSON.stringify(Dne(t)):t;if(an.isArrayBuffer(t)||an.isBuffer(t)||an.isStream(t)||an.isFile(t)||an.isBlob(t)||an.isReadableStream(t))return t;if(an.isArrayBufferView(t))return t.buffer;if(an.isURLSearchParams(t))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let s;if(u){if(r.indexOf("application/x-www-form-urlencoded")>-1)return VOe(t,this.formSerializer).toString();if((s=an.isFileList(t))||r.indexOf("multipart/form-data")>-1){const v=this.env&&this.env.FormData;return Rk(s?{"files[]":t}:t,v&&new v,this.formSerializer)}}return u||a?(n.setContentType("application/json",!1),GOe(t)):t}],transformResponse:[function(t){const n=this.transitional||WT.transitional,r=n&&n.forcedJSONParsing,a=this.responseType==="json";if(an.isResponse(t)||an.isReadableStream(t))return t;if(t&&an.isString(t)&&(r&&!this.responseType||a)){const f=!(n&&n.silentJSONParsing)&&a;try{return JSON.parse(t,this.parseReviver)}catch(s){if(f)throw s.name==="SyntaxError"?ks.from(s,ks.ERR_BAD_RESPONSE,this,null,this.response):s}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Jl.classes.FormData,Blob:Jl.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};an.forEach(["delete","get","head","post","put","patch"],e=>{WT.headers[e]={}});const qOe=an.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),WOe=e=>{const t={};let n,r,a;return e&&e.split(`
`).forEach(function(f){a=f.indexOf(":"),n=f.substring(0,a).trim().toLowerCase(),r=f.substring(a+1).trim(),!(!n||t[n]&&qOe[n])&&(n==="set-cookie"?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)}),t},OH=Symbol("internals");function Mw(e){return e&&String(e).trim().toLowerCase()}function V4(e){return e===!1||e==null?e:an.isArray(e)?e.map(V4):String(e)}function ZOe(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}const XOe=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function bR(e,t,n,r,a){if(an.isFunction(r))return r.call(this,t,n);if(a&&(t=n),!!an.isString(t)){if(an.isString(r))return t.indexOf(r)!==-1;if(an.isRegExp(r))return r.test(t)}}function YOe(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,n,r)=>n.toUpperCase()+r)}function KOe(e,t){const n=an.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+n,{value:function(a,u,f){return this[r].call(this,t,a,u,f)},configurable:!0})})}let ec=class{constructor(t){t&&this.set(t)}set(t,n,r){const a=this;function u(s,v,x){const A=Mw(v);if(!A)throw new Error("header name must be a non-empty string");const C=an.findKey(a,A);(!C||a[C]===void 0||x===!0||x===void 0&&a[C]!==!1)&&(a[C||v]=V4(s))}const f=(s,v)=>an.forEach(s,(x,A)=>u(x,A,v));if(an.isPlainObject(t)||t instanceof this.constructor)f(t,n);else if(an.isString(t)&&(t=t.trim())&&!XOe(t))f(WOe(t),n);else if(an.isObject(t)&&an.isIterable(t)){let s={},v,x;for(const A of t){if(!an.isArray(A))throw TypeError("Object iterator must return a key-value pair");s[x=A[0]]=(v=s[x])?an.isArray(v)?[...v,A[1]]:[v,A[1]]:A[1]}f(s,n)}else t!=null&&u(n,t,r);return this}get(t,n){if(t=Mw(t),t){const r=an.findKey(this,t);if(r){const a=this[r];if(!n)return a;if(n===!0)return ZOe(a);if(an.isFunction(n))return n.call(this,a,r);if(an.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=Mw(t),t){const r=an.findKey(this,t);return!!(r&&this[r]!==void 0&&(!n||bR(this,this[r],r,n)))}return!1}delete(t,n){const r=this;let a=!1;function u(f){if(f=Mw(f),f){const s=an.findKey(r,f);s&&(!n||bR(r,r[s],s,n))&&(delete r[s],a=!0)}}return an.isArray(t)?t.forEach(u):u(t),a}clear(t){const n=Object.keys(this);let r=n.length,a=!1;for(;r--;){const u=n[r];(!t||bR(this,this[u],u,t,!0))&&(delete this[u],a=!0)}return a}normalize(t){const n=this,r={};return an.forEach(this,(a,u)=>{const f=an.findKey(r,u);if(f){n[f]=V4(a),delete n[u];return}const s=t?YOe(u):String(u).trim();s!==u&&delete n[u],n[s]=V4(a),r[s]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const n=Object.create(null);return an.forEach(this,(r,a)=>{r!=null&&r!==!1&&(n[a]=t&&an.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,n])=>t+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...n){const r=new this(t);return n.forEach(a=>r.set(a)),r}static accessor(t){const r=(this[OH]=this[OH]={accessors:{}}).accessors,a=this.prototype;function u(f){const s=Mw(f);r[s]||(KOe(a,f),r[s]=!0)}return an.isArray(t)?t.forEach(u):u(t),this}};ec.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);an.reduceDescriptors(ec.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(r){this[n]=r}}});an.freezeMethods(ec);function wR(e,t){const n=this||WT,r=t||n,a=ec.from(r.headers);let u=r.data;return an.forEach(e,function(s){u=s.call(n,u,a.normalize(),t?t.status:void 0)}),a.normalize(),u}function Nne(e){return!!(e&&e.__CANCEL__)}function xx(e,t,n){ks.call(this,e??"canceled",ks.ERR_CANCELED,t,n),this.name="CanceledError"}an.inherits(xx,ks,{__CANCEL__:!0});function zne(e,t,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?e(n):t(new ks("Request failed with status code "+n.status,[ks.ERR_BAD_REQUEST,ks.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function QOe(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function JOe(e,t){e=e||10;const n=new Array(e),r=new Array(e);let a=0,u=0,f;return t=t!==void 0?t:1e3,function(v){const x=Date.now(),A=r[u];f||(f=x),n[a]=v,r[a]=x;let C=u,P=0;for(;C!==a;)P+=n[C++],C=C%e;if(a=(a+1)%e,a===u&&(u=(u+1)%e),x-f<t)return;const L=A&&x-A;return L?Math.round(P*1e3/L):void 0}}function eLe(e,t){let n=0,r=1e3/t,a,u;const f=(x,A=Date.now())=>{n=A,a=null,u&&(clearTimeout(u),u=null),e(...x)};return[(...x)=>{const A=Date.now(),C=A-n;C>=r?f(x,A):(a=x,u||(u=setTimeout(()=>{u=null,f(a)},r-C)))},()=>a&&f(a)]}const SC=(e,t,n=3)=>{let r=0;const a=JOe(50,250);return eLe(u=>{const f=u.loaded,s=u.lengthComputable?u.total:void 0,v=f-r,x=a(v),A=f<=s;r=f;const C={loaded:f,total:s,progress:s?f/s:void 0,bytes:v,rate:x||void 0,estimated:x&&s&&A?(s-f)/x:void 0,event:u,lengthComputable:s!=null,[t?"download":"upload"]:!0};e(C)},n)},LH=(e,t)=>{const n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},DH=e=>(...t)=>an.asap(()=>e(...t)),tLe=Jl.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,Jl.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(Jl.origin),Jl.navigator&&/(msie|trident)/i.test(Jl.navigator.userAgent)):()=>!0,nLe=Jl.hasStandardBrowserEnv?{write(e,t,n,r,a,u,f){if(typeof document>"u")return;const s=[`${e}=${encodeURIComponent(t)}`];an.isNumber(n)&&s.push(`expires=${new Date(n).toUTCString()}`),an.isString(r)&&s.push(`path=${r}`),an.isString(a)&&s.push(`domain=${a}`),u===!0&&s.push("secure"),an.isString(f)&&s.push(`SameSite=${f}`),document.cookie=s.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function rLe(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function iLe(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function Fne(e,t,n){let r=!rLe(t);return e&&(r||n==!1)?iLe(e,t):t}const NH=e=>e instanceof ec?{...e}:e;function __(e,t){t=t||{};const n={};function r(x,A,C,P){return an.isPlainObject(x)&&an.isPlainObject(A)?an.merge.call({caseless:P},x,A):an.isPlainObject(A)?an.merge({},A):an.isArray(A)?A.slice():A}function a(x,A,C,P){if(an.isUndefined(A)){if(!an.isUndefined(x))return r(void 0,x,C,P)}else return r(x,A,C,P)}function u(x,A){if(!an.isUndefined(A))return r(void 0,A)}function f(x,A){if(an.isUndefined(A)){if(!an.isUndefined(x))return r(void 0,x)}else return r(void 0,A)}function s(x,A,C){if(C in t)return r(x,A);if(C in e)return r(void 0,x)}const v={url:u,method:u,data:u,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,withXSRFToken:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:s,headers:(x,A,C)=>a(NH(x),NH(A),C,!0)};return an.forEach(Object.keys({...e,...t}),function(A){const C=v[A]||a,P=C(e[A],t[A],A);an.isUndefined(P)&&C!==s||(n[A]=P)}),n}const Bne=e=>{const t=__({},e);let{data:n,withXSRFToken:r,xsrfHeaderName:a,xsrfCookieName:u,headers:f,auth:s}=t;if(t.headers=f=ec.from(f),t.url=One(Fne(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),s&&f.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):""))),an.isFormData(n)){if(Jl.hasStandardBrowserEnv||Jl.hasStandardBrowserWebWorkerEnv)f.setContentType(void 0);else if(an.isFunction(n.getHeaders)){const v=n.getHeaders(),x=["content-type","content-length"];Object.entries(v).forEach(([A,C])=>{x.includes(A.toLowerCase())&&f.set(A,C)})}}if(Jl.hasStandardBrowserEnv&&(r&&an.isFunction(r)&&(r=r(t)),r||r!==!1&&tLe(t.url))){const v=a&&u&&nLe.read(u);v&&f.set(a,v)}return t},sLe=typeof XMLHttpRequest<"u",aLe=sLe&&function(e){return new Promise(function(n,r){const a=Bne(e);let u=a.data;const f=ec.from(a.headers).normalize();let{responseType:s,onUploadProgress:v,onDownloadProgress:x}=a,A,C,P,L,F;function U(){L&&L(),F&&F(),a.cancelToken&&a.cancelToken.unsubscribe(A),a.signal&&a.signal.removeEventListener("abort",A)}let q=new XMLHttpRequest;q.open(a.method.toUpperCase(),a.url,!0),q.timeout=a.timeout;function G(){if(!q)return;const X=ec.from("getAllResponseHeaders"in q&&q.getAllResponseHeaders()),de={data:!s||s==="text"||s==="json"?q.responseText:q.response,status:q.status,statusText:q.statusText,headers:X,config:e,request:q};zne(function(be){n(be),U()},function(be){r(be),U()},de),q=null}"onloadend"in q?q.onloadend=G:q.onreadystatechange=function(){!q||q.readyState!==4||q.status===0&&!(q.responseURL&&q.responseURL.indexOf("file:")===0)||setTimeout(G)},q.onabort=function(){q&&(r(new ks("Request aborted",ks.ECONNABORTED,e,q)),q=null)},q.onerror=function(ie){const de=ie&&ie.message?ie.message:"Network Error",fe=new ks(de,ks.ERR_NETWORK,e,q);fe.event=ie||null,r(fe),q=null},q.ontimeout=function(){let ie=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const de=a.transitional||Lne;a.timeoutErrorMessage&&(ie=a.timeoutErrorMessage),r(new ks(ie,de.clarifyTimeoutError?ks.ETIMEDOUT:ks.ECONNABORTED,e,q)),q=null},u===void 0&&f.setContentType(null),"setRequestHeader"in q&&an.forEach(f.toJSON(),function(ie,de){q.setRequestHeader(de,ie)}),an.isUndefined(a.withCredentials)||(q.withCredentials=!!a.withCredentials),s&&s!=="json"&&(q.responseType=a.responseType),x&&([P,F]=SC(x,!0),q.addEventListener("progress",P)),v&&q.upload&&([C,L]=SC(v),q.upload.addEventListener("progress",C),q.upload.addEventListener("loadend",L)),(a.cancelToken||a.signal)&&(A=X=>{q&&(r(!X||X.type?new xx(null,e,q):X),q.abort(),q=null)},a.cancelToken&&a.cancelToken.subscribe(A),a.signal&&(a.signal.aborted?A():a.signal.addEventListener("abort",A)));const $=QOe(a.url);if($&&Jl.protocols.indexOf($)===-1){r(new ks("Unsupported protocol "+$+":",ks.ERR_BAD_REQUEST,e));return}q.send(u||null)})},oLe=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r=new AbortController,a;const u=function(x){if(!a){a=!0,s();const A=x instanceof Error?x:this.reason;r.abort(A instanceof ks?A:new xx(A instanceof Error?A.message:A))}};let f=t&&setTimeout(()=>{f=null,u(new ks(`timeout ${t} of ms exceeded`,ks.ETIMEDOUT))},t);const s=()=>{e&&(f&&clearTimeout(f),f=null,e.forEach(x=>{x.unsubscribe?x.unsubscribe(u):x.removeEventListener("abort",u)}),e=null)};e.forEach(x=>x.addEventListener("abort",u));const{signal:v}=r;return v.unsubscribe=()=>an.asap(s),v}},lLe=function*(e,t){let n=e.byteLength;if(n<t){yield e;return}let r=0,a;for(;r<n;)a=r+t,yield e.slice(r,a),r=a},uLe=async function*(e,t){for await(const n of cLe(e))yield*lLe(n,t)},cLe=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:n,value:r}=await t.read();if(n)break;yield r}}finally{await t.cancel()}},zH=(e,t,n,r)=>{const a=uLe(e,t);let u=0,f,s=v=>{f||(f=!0,r&&r(v))};return new ReadableStream({async pull(v){try{const{done:x,value:A}=await a.next();if(x){s(),v.close();return}let C=A.byteLength;if(n){let P=u+=C;n(P)}v.enqueue(new Uint8Array(A))}catch(x){throw s(x),x}},cancel(v){return s(v),a.return()}},{highWaterMark:2})},FH=64*1024,{isFunction:U3}=an,dLe=(({Request:e,Response:t})=>({Request:e,Response:t}))(an.global),{ReadableStream:BH,TextEncoder:jH}=an.global,UH=(e,...t)=>{try{return!!e(...t)}catch{return!1}},hLe=e=>{e=an.merge.call({skipUndefined:!0},dLe,e);const{fetch:t,Request:n,Response:r}=e,a=t?U3(t):typeof fetch=="function",u=U3(n),f=U3(r);if(!a)return!1;const s=a&&U3(BH),v=a&&(typeof jH=="function"?(F=>U=>F.encode(U))(new jH):async F=>new Uint8Array(await new n(F).arrayBuffer())),x=u&&s&&UH(()=>{let F=!1;const U=new n(Jl.origin,{body:new BH,method:"POST",get duplex(){return F=!0,"half"}}).headers.has("Content-Type");return F&&!U}),A=f&&s&&UH(()=>an.isReadableStream(new r("").body)),C={stream:A&&(F=>F.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(F=>{!C[F]&&(C[F]=(U,q)=>{let G=U&&U[F];if(G)return G.call(U);throw new ks(`Response type '${F}' is not supported`,ks.ERR_NOT_SUPPORT,q)})});const P=async F=>{if(F==null)return 0;if(an.isBlob(F))return F.size;if(an.isSpecCompliantForm(F))return(await new n(Jl.origin,{method:"POST",body:F}).arrayBuffer()).byteLength;if(an.isArrayBufferView(F)||an.isArrayBuffer(F))return F.byteLength;if(an.isURLSearchParams(F)&&(F=F+""),an.isString(F))return(await v(F)).byteLength},L=async(F,U)=>{const q=an.toFiniteNumber(F.getContentLength());return q??P(U)};return async F=>{let{url:U,method:q,data:G,signal:$,cancelToken:X,timeout:ie,onDownloadProgress:de,onUploadProgress:fe,responseType:be,headers:ve,withCredentials:Qe="same-origin",fetchOptions:we}=Bne(F),qe=t||fetch;be=be?(be+"").toLowerCase():"text";let Je=oLe([$,X&&X.toAbortSignal()],ie),ft=null;const Mt=Je&&Je.unsubscribe&&(()=>{Je.unsubscribe()});let Pt;try{if(fe&&x&&q!=="get"&&q!=="head"&&(Pt=await L(ve,G))!==0){let gn=new n(U,{method:"POST",body:G,duplex:"half"}),Et;if(an.isFormData(G)&&(Et=gn.headers.get("content-type"))&&ve.setContentType(Et),gn.body){const[ze,$t]=LH(Pt,SC(DH(fe)));G=zH(gn.body,FH,ze,$t)}}an.isString(Qe)||(Qe=Qe?"include":"omit");const Nt=u&&"credentials"in n.prototype,Kt={...we,signal:Je,method:q.toUpperCase(),headers:ve.normalize().toJSON(),body:G,duplex:"half",credentials:Nt?Qe:void 0};ft=u&&new n(U,Kt);let tt=await(u?qe(ft,we):qe(U,Kt));const mt=A&&(be==="stream"||be==="response");if(A&&(de||mt&&Mt)){const gn={};["status","statusText","headers"].forEach(Cn=>{gn[Cn]=tt[Cn]});const Et=an.toFiniteNumber(tt.headers.get("content-length")),[ze,$t]=de&&LH(Et,SC(DH(de),!0))||[];tt=new r(zH(tt.body,FH,ze,()=>{$t&&$t(),Mt&&Mt()}),gn)}be=be||"text";let Pe=await C[an.findKey(C,be)||"text"](tt,F);return!mt&&Mt&&Mt(),await new Promise((gn,Et)=>{zne(gn,Et,{data:Pe,headers:ec.from(tt.headers),status:tt.status,statusText:tt.statusText,config:F,request:ft})})}catch(Nt){throw Mt&&Mt(),Nt&&Nt.name==="TypeError"&&/Load failed|fetch/i.test(Nt.message)?Object.assign(new ks("Network Error",ks.ERR_NETWORK,F,ft),{cause:Nt.cause||Nt}):ks.from(Nt,Nt&&Nt.code,F,ft)}}},fLe=new Map,jne=e=>{let t=e&&e.env||{};const{fetch:n,Request:r,Response:a}=t,u=[r,a,n];let f=u.length,s=f,v,x,A=fLe;for(;s--;)v=u[s],x=A.get(v),x===void 0&&A.set(v,x=s?new Map:hLe(t)),A=x;return x};jne();const $D={http:ROe,xhr:aLe,fetch:{get:jne}};an.forEach($D,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const VH=e=>`- ${e}`,pLe=e=>an.isFunction(e)||e===null||e===!1;function mLe(e,t){e=an.isArray(e)?e:[e];const{length:n}=e;let r,a;const u={};for(let f=0;f<n;f++){r=e[f];let s;if(a=r,!pLe(r)&&(a=$D[(s=String(r)).toLowerCase()],a===void 0))throw new ks(`Unknown adapter '${s}'`);if(a&&(an.isFunction(a)||(a=a.get(t))))break;u[s||"#"+f]=a}if(!a){const f=Object.entries(u).map(([v,x])=>`adapter ${v} `+(x===!1?"is not supported by the environment":"is not available in the build"));let s=n?f.length>1?`since :
`+f.map(VH).join(`
`):" "+VH(f[0]):"as no adapter specified";throw new ks("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return a}const Une={getAdapter:mLe,adapters:$D};function TR(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new xx(null,e)}function $H(e){return TR(e),e.headers=ec.from(e.headers),e.data=wR.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Une.getAdapter(e.adapter||WT.adapter,e)(e).then(function(r){return TR(e),r.data=wR.call(e,e.transformResponse,r),r.headers=ec.from(r.headers),r},function(r){return Nne(r)||(TR(e),r&&r.response&&(r.response.data=wR.call(e,e.transformResponse,r.response),r.response.headers=ec.from(r.response.headers))),Promise.reject(r)})}const Vne="1.13.2",Mk={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Mk[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const HH={};Mk.transitional=function(t,n,r){function a(u,f){return"[Axios v"+Vne+"] Transitional option '"+u+"'"+f+(r?". "+r:"")}return(u,f,s)=>{if(t===!1)throw new ks(a(f," has been removed"+(n?" in "+n:"")),ks.ERR_DEPRECATED);return n&&!HH[f]&&(HH[f]=!0,console.warn(a(f," has been deprecated since v"+n+" and will be removed in the near future"))),t?t(u,f,s):!0}};Mk.spelling=function(t){return(n,r)=>(console.warn(`${r} is likely a misspelling of ${t}`),!0)};function gLe(e,t,n){if(typeof e!="object")throw new ks("options must be an object",ks.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let a=r.length;for(;a-- >0;){const u=r[a],f=t[u];if(f){const s=e[u],v=s===void 0||f(s,u,e);if(v!==!0)throw new ks("option "+u+" must be "+v,ks.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new ks("Unknown option "+u,ks.ERR_BAD_OPTION)}}const $4={assertOptions:gLe,validators:Mk},zh=$4.validators;let Yg=class{constructor(t){this.defaults=t||{},this.interceptors={request:new PH,response:new PH}}async request(t,n){try{return await this._request(t,n)}catch(r){if(r instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const u=a.stack?a.stack.replace(/^.+\n/,""):"";try{r.stack?u&&!String(r.stack).endsWith(u.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+u):r.stack=u}catch{}}throw r}}_request(t,n){typeof t=="string"?(n=n||{},n.url=t):n=t||{},n=__(this.defaults,n);const{transitional:r,paramsSerializer:a,headers:u}=n;r!==void 0&&$4.assertOptions(r,{silentJSONParsing:zh.transitional(zh.boolean),forcedJSONParsing:zh.transitional(zh.boolean),clarifyTimeoutError:zh.transitional(zh.boolean)},!1),a!=null&&(an.isFunction(a)?n.paramsSerializer={serialize:a}:$4.assertOptions(a,{encode:zh.function,serialize:zh.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),$4.assertOptions(n,{baseUrl:zh.spelling("baseURL"),withXsrfToken:zh.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let f=u&&an.merge(u.common,u[n.method]);u&&an.forEach(["delete","get","head","post","put","patch","common"],F=>{delete u[F]}),n.headers=ec.concat(f,u);const s=[];let v=!0;this.interceptors.request.forEach(function(U){typeof U.runWhen=="function"&&U.runWhen(n)===!1||(v=v&&U.synchronous,s.unshift(U.fulfilled,U.rejected))});const x=[];this.interceptors.response.forEach(function(U){x.push(U.fulfilled,U.rejected)});let A,C=0,P;if(!v){const F=[$H.bind(this),void 0];for(F.unshift(...s),F.push(...x),P=F.length,A=Promise.resolve(n);C<P;)A=A.then(F[C++],F[C++]);return A}P=s.length;let L=n;for(;C<P;){const F=s[C++],U=s[C++];try{L=F(L)}catch(q){U.call(this,q);break}}try{A=$H.call(this,L)}catch(F){return Promise.reject(F)}for(C=0,P=x.length;C<P;)A=A.then(x[C++],x[C++]);return A}getUri(t){t=__(this.defaults,t);const n=Fne(t.baseURL,t.url,t.allowAbsoluteUrls);return One(n,t.params,t.paramsSerializer)}};an.forEach(["delete","get","head","options"],function(t){Yg.prototype[t]=function(n,r){return this.request(__(r||{},{method:t,url:n,data:(r||{}).data}))}});an.forEach(["post","put","patch"],function(t){function n(r){return function(u,f,s){return this.request(__(s||{},{method:t,headers:r?{"Content-Type":"multipart/form-data"}:{},url:u,data:f}))}}Yg.prototype[t]=n(),Yg.prototype[t+"Form"]=n(!0)});let _Le=class $ne{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(u){n=u});const r=this;this.promise.then(a=>{if(!r._listeners)return;let u=r._listeners.length;for(;u-- >0;)r._listeners[u](a);r._listeners=null}),this.promise.then=a=>{let u;const f=new Promise(s=>{r.subscribe(s),u=s}).then(a);return f.cancel=function(){r.unsubscribe(u)},f},t(function(u,f,s){r.reason||(r.reason=new xx(u,f,s),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new $ne(function(a){t=a}),cancel:t}}};function yLe(e){return function(n){return e.apply(null,n)}}function vLe(e){return an.isObject(e)&&e.isAxiosError===!0}const $8={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries($8).forEach(([e,t])=>{$8[t]=e});function Hne(e){const t=new Yg(e),n=bne(Yg.prototype.request,t);return an.extend(n,Yg.prototype,t,{allOwnKeys:!0}),an.extend(n,t,null,{allOwnKeys:!0}),n.create=function(a){return Hne(__(e,a))},n}const Zo=Hne(WT);Zo.Axios=Yg;Zo.CanceledError=xx;Zo.CancelToken=_Le;Zo.isCancel=Nne;Zo.VERSION=Vne;Zo.toFormData=Rk;Zo.AxiosError=ks;Zo.Cancel=Zo.CanceledError;Zo.all=function(t){return Promise.all(t)};Zo.spread=yLe;Zo.isAxiosError=vLe;Zo.mergeConfig=__;Zo.AxiosHeaders=ec;Zo.formToJSON=e=>Dne(an.isHTMLForm(e)?new FormData(e):e);Zo.getAdapter=Une.getAdapter;Zo.HttpStatusCode=$8;Zo.default=Zo;const{Axios:YNe,AxiosError:KNe,CanceledError:QNe,isCancel:JNe,CancelToken:eze,VERSION:tze,all:nze,Cancel:rze,isAxiosError:ize,spread:sze,toFormData:aze,AxiosHeaders:oze,HttpStatusCode:lze,formToJSON:uze,getAdapter:cze,mergeConfig:dze}=Zo,xLe="/api";class bLe{constructor(){yi(this,"client");yi(this,"token",null);this.client=Zo.create({baseURL:xLe,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(n=>(this.token&&(n.headers.Authorization=`Bearer ${this.token}`),n)),this.client.interceptors.response.use(n=>n,n=>{var r;if(((r=n.response)==null?void 0:r.status)===401){const a=n.response.data;if((a==null?void 0:a.code)==="SESSION_REPLACED")return this.token=null,sessionStorage.removeItem("token"),alert(a.message||"Sei stato disconnesso perch  stato effettuato un accesso da un altro dispositivo"),window.location.href="/login",Promise.reject(n);this.token=null,sessionStorage.removeItem("token"),window.location.href="/login"}return Promise.reject(n)});const t=sessionStorage.getItem("token");t&&(this.token=t)}setToken(t){this.token=t,t?sessionStorage.setItem("token",t):sessionStorage.removeItem("token")}async login(t,n){const{data:r}=await this.client.post("/auth/login",{email:t,password:n});return this.setToken(r.token),r}async getMe(){const{data:t}=await this.client.get("/auth/me");return t}async verifyPin(t){const{data:n}=await this.client.post("/auth/verify-pin",{pin:t});return this.setToken(n.token),n}async setPin(t,n){const{data:r}=await this.client.post("/auth/set-pin",{pin:t,current_pin:n});return r}async register(t){const{data:n}=await this.client.post("/auth/register",t);return this.setToken(n.token),n}logout(){this.setToken(null)}async getNeuroni(t){const{data:n}=await this.client.get("/neuroni",{params:t});return n}async getNeurone(t){const{data:n}=await this.client.get(`/neuroni/${t}`);return n}async createNeurone(t){const{data:n}=await this.client.post("/neuroni",t);return n}async updateNeurone(t,n){await this.client.put(`/neuroni/${t}`,n)}async deleteNeurone(t){await this.client.delete(`/neuroni/${t}`)}async getNeuroneSinapsi(t,n){const{data:r}=await this.client.get(`/neuroni/${t}/sinapsi`,{params:n});return r}async getSinapsi(t){const{data:n}=await this.client.get("/sinapsi",{params:t});return n}async getSinapsiById(t){const{data:n}=await this.client.get(`/sinapsi/${t}`);return n}async createSinapsi(t){const{data:n}=await this.client.post("/sinapsi",t);return n}async updateSinapsi(t,n){await this.client.put(`/sinapsi/${t}`,n)}async deleteSinapsi(t){await this.client.delete(`/sinapsi/${t}`)}async getNote(t){const{data:n}=await this.client.get("/note",{params:t?{neurone_id:t}:void 0});return n}async createNota(t,n){const{data:r}=await this.client.post("/note",{neurone_id:t,testo:n});return r}async updateNota(t,n){await this.client.put(`/note/${t}`,{testo:n})}async deleteNota(t){await this.client.delete(`/note/${t}`)}async getStats(){const{data:t}=await this.client.get("/stats");return t}async updateProfile(t){const{data:n}=await this.client.put("/users/profile",t);return n}async uploadFoto(t){const n=new FormData;n.append("foto",t);const{data:r}=await this.client.post("/users/upload-foto",n,{headers:{"Content-Type":"multipart/form-data"}});return r}async changePassword(t){const{data:n}=await this.client.put("/users/password",t);return n}async getAziendaMembri(){const{data:t}=await this.client.get("/azienda/membri");return t}async removeAziendaMembro(t){const{data:n}=await this.client.delete(`/azienda/membri/${t}`);return n}async invitaCollega(t){const{data:n}=await this.client.post("/azienda/inviti",{email:t});return n}async getInvitiPendenti(){const{data:t}=await this.client.get("/auth/inviti-pendenti");return t}async accettaInvito(t){const{data:n}=await this.client.post("/azienda/inviti/accetta",{invito_id:t});return this.setToken(n.token),n}async rifiutaInvito(t){const{data:n}=await this.client.post("/azienda/inviti/rifiuta",{invito_id:t});return n}async getTipiNeurone(){const{data:t}=await this.client.get("/tipi-neurone");return t}async createTipoNeurone(t){const{data:n}=await this.client.post("/tipi-neurone",t);return n}async updateTipoNeurone(t,n){const{data:r}=await this.client.put(`/tipi-neurone/${t}`,n);return r}async deleteTipoNeurone(t){const{data:n}=await this.client.delete(`/tipi-neurone/${t}`);return n}async getCategorie(t){const{data:n}=await this.client.get("/categorie",{params:t?{tipo_id:t}:void 0});return n}async createCategoria(t){const{data:n}=await this.client.post("/categorie",t);return n}async updateCategoria(t,n){const{data:r}=await this.client.put(`/categorie/${t}`,n);return r}async deleteCategoria(t){const{data:n}=await this.client.delete(`/categorie/${t}`);return n}async getCampi(t){const{data:n}=await this.client.get("/campi",{params:{tipo:t}});return n}async getTipiSinapsi(){const{data:t}=await this.client.get("/tipi-sinapsi");return t}async createTipoSinapsi(t){const{data:n}=await this.client.post("/tipi-sinapsi",t);return n}async updateTipoSinapsi(t,n){const{data:r}=await this.client.put(`/tipi-sinapsi/${t}`,n);return r}async deleteTipoSinapsi(t){const{data:n}=await this.client.delete(`/tipi-sinapsi/${t}`);return n}async getFamiglieProdotto(t){const{data:n}=await this.client.get("/famiglie-prodotto",{params:t});return n}async getFamigliaProdotto(t){const{data:n}=await this.client.get(`/famiglie-prodotto/${t}`);return n}async createFamigliaProdotto(t){const{data:n}=await this.client.post("/famiglie-prodotto",t);return n}async updateFamigliaProdotto(t,n){const{data:r}=await this.client.put(`/famiglie-prodotto/${t}`,n);return r}async deleteFamigliaProdotto(t){const{data:n}=await this.client.delete(`/famiglie-prodotto/${t}`);return n}async getVendite(t){const{data:n}=await this.client.get("/vendite",{params:{neurone_id:t}});return n}async createVendita(t){const{data:n}=await this.client.post("/vendite",t);return n}async deleteVendita(t){const{data:n}=await this.client.delete(`/vendite/${t}`);return n}async get(t,n){return this.client.get(t,{params:n})}async post(t,n){return this.client.post(t,n)}async put(t,n){return this.client.put(t,n)}async delete(t){return this.client.delete(t)}async getPreferenze(){try{const{data:t}=await this.client.get("/preferenze");return t.data}catch{return null}}async savePreferenze(t){await this.client.post("/preferenze",t)}async aiChat(t,n=[],r){const{data:a}=await this.client.post("/ai/chat",{message:t,history:n,context:r});return a}async aiDualBrain(t,n){const{data:r}=await this.client.post("/ai/dual-brain-v2",{message:t,context:n});return r}async aiChatContinue(t,n){const{data:r}=await this.client.post("/ai/chat",{resume_context:t,action_result:n});return r}async getAgeaMemory(){const{data:t}=await this.client.get("/agea/memory");return t}async updateAgeaMemory(t){const{data:n}=await this.client.put("/agea/memory",t);return n}async resetAgeaMemory(){const{data:t}=await this.client.delete("/agea/memory");return t}async geocodeSearch(t,n=5){const{data:r}=await this.client.get("/geocode/search",{params:{q:t,limit:n}});return r}}const Xn=new bLe;function HD(){const[e,t]=B.useState({user:null,token:sessionStorage.getItem("token"),personalAccess:!1,isLoading:!0});B.useEffect(()=>{(async()=>{const v=sessionStorage.getItem("token");if(!v){t(x=>({...x,isLoading:!1}));return}try{const x=await Xn.getMe();t({user:x,token:v,personalAccess:!1,isLoading:!1})}catch{sessionStorage.removeItem("token"),t({user:null,token:null,personalAccess:!1,isLoading:!1})}})()},[]);const n=B.useCallback(async(s,v)=>{const{token:x,user:A}=await Xn.login(s,v);return t({user:A,token:x,personalAccess:!1,isLoading:!1}),A},[]),r=B.useCallback(()=>{Xn.logout(),t({user:null,token:null,personalAccess:!1,isLoading:!1}),window.location.href="/genagenta/login"},[]),a=B.useCallback(async s=>{const{personal_access:v}=await Xn.verifyPin(s);return t(x=>({...x,personalAccess:v})),v},[]),u=B.useCallback(()=>{t(s=>({...s,personalAccess:!1}))},[]),f=B.useCallback(s=>{t(v=>({...v,user:v.user?{...v.user,...s}:null}))},[]);return{user:e.user,isAuthenticated:!!e.user,personalAccess:e.personalAccess,isLoading:e.isLoading,login:n,logout:r,verifyPin:a,exitPersonalMode:u,updateUser:f}}const Gne=B.createContext(null);function wLe(e,t=4){const n=[],r=["[role]","button","a[href]","input","select","textarea",'[tabindex]:not([tabindex="-1"])',"[aria-label]","[aria-labelledby]","h1","h2","h3","h4","[data-ai-readable]"].join(",");function a(v,x){var de,fe;if(x>t)return null;const A=v.getAttribute("role")||v.tagName.toLowerCase(),C=v.getAttribute("aria-label"),P=v.getAttribute("aria-labelledby"),L=v.getAttribute("title"),F=v.getAttribute("placeholder");let q=v.getAttribute("data-ai-name")||C||"";if(!q&&P){const be=document.getElementById(P);q=((de=be==null?void 0:be.textContent)==null?void 0:de.trim())||""}q||(q=L||F||((fe=v.textContent)==null?void 0:fe.trim().substring(0,50))||"");const G=["main","nav","section","article","aside","dialog","tabpanel"].includes(A);if(!q&&!G)return null;const $={role:u(A),name:q.substring(0,100)};v instanceof HTMLInputElement&&(v.type==="checkbox"||v.type==="radio"?$.checked=v.checked:$.value=v.value,$.disabled=v.disabled),v instanceof HTMLSelectElement&&($.value=v.value,$.disabled=v.disabled),v.getAttribute("aria-selected")==="true"&&($.selected=!0),v.getAttribute("aria-expanded")&&($.expanded=v.getAttribute("aria-expanded")==="true"),v.getAttribute("aria-disabled")==="true"&&($.disabled=!0);const ie=Array.from(v.children).filter(be=>be.matches('[role], button, a[href], input, select, textarea, [tabindex]:not([tabindex="-1"]), [aria-label], [aria-labelledby], h1, h2, h3, h4, [data-ai-readable]'));if(ie.length>0&&x<t){const be=[];ie.forEach(ve=>{const Qe=a(ve,x+1);Qe&&be.push(Qe)}),be.length>0&&($.children=be)}return $}function u(v){return{button:"bottone",link:"link",textbox:"campo_testo",checkbox:"checkbox",radio:"radio",tab:"tab",tablist:"lista_tab",tabpanel:"pannello_tab",dialog:"dialogo",menu:"menu",menuitem:"voce_menu",listbox:"lista_selezione",option:"opzione",combobox:"dropdown",slider:"slider",spinbutton:"numero",switch:"interruttore",heading:"titolo",h1:"titolo_h1",h2:"titolo_h2",h3:"titolo_h3",h4:"titolo_h4",input:"input",select:"selezione",textarea:"area_testo",a:"link",nav:"navigazione",main:"contenuto_principale",section:"sezione",article:"articolo",aside:"sidebar",form:"form",img:"immagine",div:"contenitore",span:"testo"}[v]||v}const f=e.querySelectorAll(r),s=new Set;return f.forEach(v=>{let x=v.parentElement;for(;x&&x!==e;){if(s.has(x))return;x=x.parentElement}const A=a(v,0);A&&(n.push(A),s.add(v))}),n}function TLe({children:e}){const[t,n]=B.useState(new Map),[r,a]=B.useState(new Map),[u,f]=B.useState([]),[s,v]=B.useState(Date.now()),x=B.useRef(r);x.current=r;const A=B.useCallback(X=>{n(ie=>{const de=new Map(ie);return de.set(X.id,X),de}),v(Date.now())},[]),C=B.useCallback(X=>{n(ie=>{const de=new Map(ie);return de.delete(X),de}),v(Date.now())},[]),P=B.useCallback(X=>{a(ie=>{const de=new Map(ie);return de.set(X.id,X),de}),v(Date.now())},[]),L=B.useCallback(X=>{a(ie=>{const de=new Map(ie);return de.delete(X),de}),v(Date.now())},[]),F=B.useCallback(async(X,ie)=>{const de=x.current.get(X);if(!de)return{success:!1,message:`Azione "${X}" non trovata`};try{const fe=await de.handler(ie);return v(Date.now()),fe}catch(fe){return{success:!1,message:`Errore esecuzione: ${fe}`}}},[]),U=B.useCallback(()=>{const X=document.querySelector('[data-ai-container="main"]')||document.body,ie=wLe(X);f(ie),v(Date.now())},[]);B.useEffect(()=>{const X=setInterval(()=>{U()},2e3);return()=>clearInterval(X)},[]);const q=B.useCallback(()=>{const X=["=== INTERFACCIA UTENTE ATTUALE ===",""],ie=new Map;if(t.forEach(de=>{const fe=de.category;ie.has(fe)||ie.set(fe,[]),ie.get(fe).push(de)}),ie.size>0&&(X.push("STATO COMPONENTI:"),ie.forEach((de,fe)=>{X.push(`  [${fe.toUpperCase()}]`),de.forEach(be=>{const ve=typeof be.value=="object"?JSON.stringify(be.value):String(be.value);X.push(`    ${be.name}: ${ve}`),be.description&&X.push(`      (${be.description})`)})}),X.push("")),r.size>0&&(X.push("AZIONI DISPONIBILI:"),r.forEach(de=>{const fe=de.parameters.map(be=>`${be.name}${be.required?"":"?"}: ${be.type}${be.options?` [${be.options.join("|")}]`:""}`).join(", ");X.push(`  - ${de.id}(${fe})`),X.push(`    ${de.description}`)}),X.push("")),u.length>0){X.push("ELEMENTI UI VISIBILI:");const de=(fe,be="  ")=>{let ve=`${be}[${fe.role}] "${fe.name}"`;fe.value!==void 0&&(ve+=` = "${fe.value}"`),fe.checked!==void 0&&(ve+=fe.checked?" ":" "),fe.selected&&(ve+=" (selezionato)"),fe.expanded!==void 0&&(ve+=fe.expanded?" (aperto)":" (chiuso)"),fe.disabled&&(ve+=" (disabilitato)"),X.push(ve),fe.children&&fe.children.forEach(Qe=>de(Qe,be+"  "))};u.forEach(fe=>de(fe)),X.push("")}return X.push("=== FINE UI ==="),X.join(`
`)},[t,r,u]),G=B.useCallback(()=>({readables:Array.from(t.values()),actions:Array.from(r.values()).map(({handler:X,...ie})=>ie),ui:u}),[t,r,u]),$={state:{readables:t,actions:r,accessibilitySnapshot:u,lastUpdate:s},registerReadable:A,unregisterReadable:C,registerAction:P,unregisterAction:L,executeAction:F,refreshAccessibilitySnapshot:U,exportForAi:q,exportForAiJson:G};return k.jsx(Gne.Provider,{value:$,children:e})}function GD(){const e=B.useContext(Gne);if(!e)throw new Error("useAiUi must be used within AiUiProvider");return e}function ELe(e,t,n,r,a){const{registerReadable:u,unregisterReadable:f}=GD();B.useEffect(()=>(u({id:e,category:t,name:n,value:r,description:a}),()=>f(e)),[e,t,n,r,a,u,f])}function ER(e){const{registerAction:t,unregisterAction:n}=GD(),r=B.useRef(e);r.current=e,B.useEffect(()=>{const a={...e,handler:u=>r.current.handler(u)};return t(a),()=>n(e.id)},[e.id,e.name,e.description,JSON.stringify(e.parameters),t,n])}function SLe(){const e=bT(),{login:t,isAuthenticated:n}=HD(),[r,a]=B.useState(""),[u,f]=B.useState(""),[s,v]=B.useState(""),[x,A]=B.useState(!1);if(n)return e("/",{replace:!0}),null;const C=async P=>{var L,F;P.preventDefault(),v(""),A(!0);try{await t(r,u),e("/",{replace:!0})}catch(U){v(((F=(L=U.response)==null?void 0:L.data)==null?void 0:F.error)||"Errore di connessione")}finally{A(!1)}};return k.jsx("div",{className:"login-container",children:k.jsxs("div",{className:"login-card",children:[k.jsx("h1",{className:"login-title",children:"GenAgenTa"}),k.jsx("p",{className:"login-subtitle",children:"Rete Neurale delle Relazioni Commerciali"}),k.jsxs("form",{onSubmit:C,children:[k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"email",children:"Email"}),k.jsx("input",{id:"email",type:"email",className:"form-input",value:r,onChange:P=>a(P.target.value),placeholder:"email@esempio.it",required:!0,autoFocus:!0})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"password",children:"Password"}),k.jsx("input",{id:"password",type:"password",className:"form-input",value:u,onChange:P=>f(P.target.value),placeholder:"",required:!0})]}),s&&k.jsx("div",{style:{padding:"12px",marginBottom:"16px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",borderRadius:"8px",fontSize:"14px"},children:s}),k.jsx("button",{type:"submit",className:"btn btn-primary",style:{width:"100%"},disabled:x,children:x?"Accesso in corso...":"Accedi"})]}),k.jsxs("p",{style:{marginTop:"24px",fontSize:"14px",color:"var(--text-secondary)",textAlign:"center"},children:["Non hai un account?"," ",k.jsx(PW,{to:"/register",style:{color:"var(--primary)"},children:"Registrati"})]}),k.jsx("p",{style:{marginTop:"16px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"Demo: admin@gruppogea.net / admin123"})]})})}function ALe(){const e=bT(),[t]=pce(),n=t.get("codice")||"",[r,a]=B.useState(n?"join":"new"),[u,f]=B.useState(""),[s,v]=B.useState(""),[x,A]=B.useState(""),[C,P]=B.useState(""),[L,F]=B.useState(""),[U,q]=B.useState(n),[G,$]=B.useState(""),[X,ie]=B.useState(!1);B.useEffect(()=>{n&&(q(n),a("join"))},[n]);const[de,fe]=B.useState(null),be=async ve=>{var Qe,we;if(ve.preventDefault(),$(""),x!==C){$("Le password non coincidono");return}if(x.length<6){$("La password deve essere di almeno 6 caratteri");return}if(r==="new"&&!L.trim()){$("Inserisci il nome della tua azienda");return}if(r==="join"&&!U.trim()){$("Inserisci il codice azienda");return}ie(!0);try{const qe=await Xn.register({email:s,password:x,nome:u,nome_azienda:r==="new"?L:void 0,codice_azienda:r==="join"?U.toUpperCase():void 0});r==="new"?fe({azienda:qe.azienda}):e("/",{replace:!0})}catch(qe){$(((we=(Qe=qe.response)==null?void 0:Qe.data)==null?void 0:we.error)||"Errore durante la registrazione")}finally{ie(!1)}};return de?k.jsx("div",{className:"login-container",children:k.jsxs("div",{className:"login-card",children:[k.jsx("h1",{className:"login-title",children:" Registrazione Completata!"}),k.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",borderRadius:"12px",padding:"20px",marginBottom:"24px",textAlign:"center"},children:[k.jsxs("p",{style:{marginBottom:"12px",color:"var(--text-secondary)"},children:["La tua azienda ",k.jsx("strong",{children:de.azienda.nome}),"  stata creata."]}),k.jsx("p",{style:{marginBottom:"8px",fontSize:"14px",color:"var(--text-secondary)"},children:"Codice per invitare i colleghi:"}),k.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",fontFamily:"monospace",color:"var(--primary)",letterSpacing:"2px",padding:"12px",background:"var(--bg-primary)",borderRadius:"8px"},children:de.azienda.codice_pairing})]}),k.jsxs("p",{style:{fontSize:"13px",color:"var(--text-secondary)",marginBottom:"24px",textAlign:"center"},children:["Condividi questo codice con i tuoi colleghi.",k.jsx("br",{}),"Lo useranno per unirsi alla tua azienda durante la registrazione."]}),k.jsx("button",{className:"btn btn-primary",style:{width:"100%"},onClick:()=>e("/",{replace:!0}),children:"Vai alla Dashboard"})]})}):k.jsx("div",{className:"login-container",children:k.jsxs("div",{className:"login-card",children:[k.jsx("h1",{className:"login-title",children:"GenAgenTa"}),k.jsx("p",{className:"login-subtitle",children:"Crea il tuo account"}),k.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"24px"},children:[k.jsx("button",{type:"button",className:`btn ${r==="new"?"btn-primary":"btn-secondary"}`,style:{flex:1,fontSize:"13px"},onClick:()=>a("new"),children:"Nuova Azienda"}),k.jsx("button",{type:"button",className:`btn ${r==="join"?"btn-primary":"btn-secondary"}`,style:{flex:1,fontSize:"13px"},onClick:()=>a("join"),children:"Unisciti"})]}),k.jsxs("form",{onSubmit:be,children:[k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"nome",children:"Il tuo nome"}),k.jsx("input",{id:"nome",type:"text",className:"form-input",value:u,onChange:ve=>f(ve.target.value),placeholder:"Mario Rossi",required:!0,autoFocus:!0})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"email",children:"Email"}),k.jsx("input",{id:"email",type:"email",className:"form-input",value:s,onChange:ve=>v(ve.target.value),placeholder:"email@esempio.it",required:!0})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"password",children:"Password"}),k.jsx("input",{id:"password",type:"password",className:"form-input",value:x,onChange:ve=>A(ve.target.value),placeholder:"Minimo 6 caratteri",required:!0})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"confirmPassword",children:"Conferma Password"}),k.jsx("input",{id:"confirmPassword",type:"password",className:"form-input",value:C,onChange:ve=>P(ve.target.value),placeholder:"Ripeti la password",required:!0})]}),r==="new"?k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"nomeAzienda",children:"Nome Azienda"}),k.jsx("input",{id:"nomeAzienda",type:"text",className:"form-input",value:L,onChange:ve=>F(ve.target.value),placeholder:"La tua azienda S.r.l.",required:!0}),k.jsx("p",{style:{fontSize:"12px",color:"var(--text-secondary)",marginTop:"4px"},children:"Riceverai un codice da condividere con i colleghi"})]}):k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",htmlFor:"codiceAzienda",children:"Codice Azienda"}),k.jsx("input",{id:"codiceAzienda",type:"text",className:"form-input",value:U,onChange:ve=>q(ve.target.value.toUpperCase()),placeholder:"GEA-XXXXXX",style:{fontFamily:"monospace",letterSpacing:"1px"},required:!0}),k.jsx("p",{style:{fontSize:"12px",color:"var(--text-secondary)",marginTop:"4px"},children:"Chiedi il codice all'amministratore della tua azienda"})]}),G&&k.jsx("div",{style:{padding:"12px",marginBottom:"16px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",borderRadius:"8px",fontSize:"14px"},children:G}),k.jsx("button",{type:"submit",className:"btn btn-primary",style:{width:"100%"},disabled:X,children:X?"Registrazione in corso...":"Registrati"})]}),k.jsxs("p",{style:{marginTop:"24px",fontSize:"14px",color:"var(--text-secondary)",textAlign:"center"},children:["Hai gi un account?"," ",k.jsx(PW,{to:"/login",style:{color:"var(--primary)"},children:"Accedi"})]})]})})}const eu={neuroni:e=>["neuroni",e],neurone:e=>["neurone",e],sinapsi:e=>["sinapsi",e],sinapsiNeurone:e=>["sinapsi","neurone",e],sinapsiById:e=>["sinapsi","detail",e],tipi:()=>["tipi"],tipologie:()=>["tipologie"],campiTipo:e=>["campi","tipo",e],famiglieProdotto:()=>["famiglieProdotto"],note:e=>["note",e],vendite:e=>["vendite",e]};function CLe(e={}){return ch({queryKey:eu.neuroni(e),queryFn:async()=>(await Xn.getNeuroni({tipo:e.tipoNeurone||void 0,categoria:e.categoria||void 0,data_inizio:e.dataInizio||void 0,data_fine:e.dataFine||void 0,limit:500})).data})}function kLe(e){return ch({queryKey:eu.neurone(e||""),queryFn:async()=>e?await Xn.getNeurone(e):null,enabled:!!e})}function ILe(e={}){return ch({queryKey:eu.sinapsi(e),queryFn:async()=>(await Xn.getSinapsi({data_inizio:e.dataInizio||void 0,data_fine:e.dataFine||void 0,certezza:e.certezza||void 0,valore_min:e.valoreMin||void 0,limit:1e3})).data})}function qne(e){return ch({queryKey:eu.sinapsiNeurone(e||""),queryFn:async()=>e?(await Xn.getNeuroneSinapsi(e)).data:[],enabled:!!e})}function RLe(e){return ch({queryKey:eu.sinapsiById(e||""),queryFn:async()=>e?await Xn.getSinapsiById(e):null,enabled:!!e})}function Wne(){return ch({queryKey:eu.tipi(),queryFn:async()=>(await Xn.get("/tipi")).data.data.map(t=>({id:t.id,nome:t.nome,forma:t.forma,ordine:t.ordine})),staleTime:1e3*60*30})}function MLe(){return ch({queryKey:eu.tipologie(),queryFn:async()=>(await Xn.get("/tipologie")).data.data.map(t=>({id:t.id,tipo_id:t.tipo_id,nome:t.nome,colore:t.colore,ordine:t.ordine})),staleTime:1e3*60*30})}function PLe(e){return ch({queryKey:eu.campiTipo(e||""),queryFn:async()=>e?(await Xn.getCampi(e)).data:[],enabled:!!e,staleTime:1e3*60*30})}function OLe(){return ch({queryKey:eu.famiglieProdotto(),queryFn:async()=>{const e=await Xn.getFamiglieProdotto({flat:!0}),t=[],n=(r,a=0)=>{r.forEach(u=>{t.push({id:u.id,nome:"  ".repeat(a)+u.nome,colore:u.colore,parent_id:u.parent_id}),u.children&&n(u.children,a+1)})};return n(e.data),t},staleTime:1e3*60*30})}function LLe(e){return ch({queryKey:eu.note(e||""),queryFn:async()=>e?(await Xn.getNote(e)).data:[],enabled:!!e})}function DLe(e){return ch({queryKey:eu.vendite(e||""),queryFn:async()=>e?await Xn.getVendite(e):{data:[],potenziale:0,totale_venduto:0,percentuale:0},enabled:!!e})}function ZT(){const e=$W();return{invalidateNeuroni:()=>{e.invalidateQueries({predicate:t=>{const n=t.queryKey[0];return n==="neuroni"||n==="neurone"}})},invalidateNeurone:t=>{e.invalidateQueries({queryKey:eu.neurone(t)})},invalidateSinapsi:()=>{e.invalidateQueries({predicate:t=>t.queryKey[0]==="sinapsi"})},invalidateSinapsiNeurone:t=>{e.invalidateQueries({queryKey:eu.sinapsiNeurone(t)})},invalidateSinapsiById:t=>{e.invalidateQueries({queryKey:eu.sinapsiById(t)})},invalidateNote:t=>{e.invalidateQueries({queryKey:eu.note(t)})},invalidateVendite:t=>{e.invalidateQueries({queryKey:eu.vendite(t)})},invalidateAll:()=>{e.invalidateQueries({predicate:t=>{const n=t.queryKey[0];return n==="neuroni"||n==="neurone"||n==="sinapsi"||n==="note"||n==="vendite"}})},invalidateNeuroniESinapsi:()=>{e.invalidateQueries({predicate:t=>{const n=t.queryKey[0];return n==="neuroni"||n==="neurone"||n==="sinapsi"}})}}}function NLe(e,t,n,r){const u=(n-e)*Math.PI/180,f=(r-t)*Math.PI/180,s=Math.sin(u/2)*Math.sin(u/2)+Math.cos(e*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(f/2)*Math.sin(f/2);return 6371*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))}function zLe(e){return 4e4/Math.pow(2,e)}function FLe({neuroni:e,sinapsi:t,filtri:n,selectedNeurone:r,selectedSinapsiId:a,aiMarkers:u,userActions:f,tipiNeurone:s,mapViewport:v,categorie:x}){const A=B.useMemo(()=>{if(!v)return{viewport:null,entitaNellaViewport:[],connessioniVisibili:t.length,filtriAttivi:{tipi:n.tipiSelezionati.length>0?n.tipiSelezionati:"tutti",categorie:n.categorieSelezionate.length>0?n.categorieSelezionate:"tutte",ricerca:n.ricerca||null,periodo:`${n.dataInizio} - ${n.dataFine}`},totaleEntitaCaricate:e.length,totaleConnessioni:t.length};const{center:F,zoom:U}=v,q=zLe(U),G=e.filter($=>$.lat!==null&&$.lng!==null).map($=>({id:$.id,nome:$.nome,tipo:$.tipo,distanzaDalCentroKm:NLe(F.lat,F.lng,$.lat,$.lng)})).filter($=>$.distanzaDalCentroKm<=q*1.5).sort(($,X)=>$.distanzaDalCentroKm-X.distanzaDalCentroKm).slice(0,15);return{viewport:{centro:F,zoom:U,raggioApprossimativoKm:Math.round(q*10)/10},entitaNellaViewport:G,connessioniVisibili:t.length,filtriAttivi:{tipi:n.tipiSelezionati.length>0?n.tipiSelezionati:"tutti",categorie:n.categorieSelezionate.length>0?n.categorieSelezionate:"tutte",ricerca:n.ricerca||null,periodo:`${n.dataInizio} - ${n.dataFine}`},totaleEntitaCaricate:e.length,totaleConnessioni:t.length}},[e,t,n,v]),C=B.useMemo(()=>{if(!r)return{entitaSelezionata:null,pannelloAperto:a?"dettaglio_connessione":null,markerAI:u.length};const F=r.potenziale||0,U=r.venduto_totale||0,q=F>0?Math.round(U/F*100):0;return{entitaSelezionata:{id:r.id,nome:r.nome,tipo:r.tipo,indirizzo:r.indirizzo,categorie:r.categorie,telefono:r.telefono,email:r.email,potenziale:r.potenziale,venduto_totale:r.venduto_totale,percentuale_raggiunta:q,is_acquirente:r.is_acquirente,is_venditore:r.is_venditore,is_intermediario:r.is_intermediario,is_influencer:r.is_influencer},pannelloAperto:"dettaglio_entita",markerAI:u.length}},[r,a,u]),P=B.useMemo(()=>({tipiDisponibili:s.map(F=>F.nome),categorieDisponibili:x.map(F=>({nome:F.nome,colore:F.colore}))}),[s,x]);return B.useMemo(()=>({mappa:A,selezione:C,azioniRecenti:f.slice(-5),configurazione:P,timestamp:new Date().toISOString()}),[A,C,f,P])}function BLe(e){const t=["=== CONTESTO LIVE APPLICAZIONE ===",""];if(e.mappa.viewport){const r=e.mappa.viewport;t.push("VIEWPORT MAPPA:"),t.push(`  Centro: ${r.centro.lat.toFixed(5)}, ${r.centro.lng.toFixed(5)}`),t.push(`  Zoom: ${r.zoom} (raggio visibile ~${r.raggioApprossimativoKm}km)`),t.push(`  Totale entit caricate: ${e.mappa.totaleEntitaCaricate}`)}else t.push(`MAPPA: ${e.mappa.totaleEntitaCaricate} entit caricate`);if(e.mappa.filtriAttivi.ricerca&&t.push(`  Ricerca attiva: "${e.mappa.filtriAttivi.ricerca}"`),e.mappa.filtriAttivi.tipi!=="tutti"&&t.push(`  Filtro tipi: ${e.mappa.filtriAttivi.tipi.join(", ")}`),e.selezione.entitaSelezionata){const r=e.selezione.entitaSelezionata;t.push(""),t.push(`ENTIT SELEZIONATA: "${r.nome}" (${r.tipo})`),t.push(`  ID: ${r.id}`),r.indirizzo&&t.push(`  Indirizzo: ${r.indirizzo}`),r.telefono&&t.push(`  Tel: ${r.telefono}`),r.email&&t.push(`  Email: ${r.email}`),t.push("  --- DATI COMMERCIALI (tab Transazioni) ---"),t.push(`  Potenziale di acquisto: ${(r.potenziale||0).toLocaleString("it-IT")}`),t.push(`  Venduto totale: ${(r.venduto_totale||0).toLocaleString("it-IT")}`),r.potenziale&&r.potenziale>0&&t.push(`  Percentuale raggiunta: ${r.percentuale_raggiunta}%`);const a=[];r.is_acquirente&&a.push("Acquirente "),r.is_venditore&&a.push("Venditore "),r.is_intermediario&&a.push("Intermediario "),r.is_influencer&&a.push("Influencer "),a.length>0?t.push(`  Natura commerciale: ${a.join(", ")}`):t.push("  Natura commerciale: nessuna spunta attiva"),t.push(`  (Quando l'utente dice "questo/questa" si riferisce a questa entit)`)}e.mappa.entitaNellaViewport.length>0?(t.push(""),t.push(`ENTIT VISIBILI NELLA VIEWPORT (${e.mappa.entitaNellaViewport.length}):`),e.mappa.entitaNellaViewport.forEach(r=>{t.push(`  - ${r.nome} (${r.tipo}) ~${r.distanzaDalCentroKm.toFixed(1)}km dal centro`)})):e.mappa.viewport&&(t.push(""),t.push("NESSUNA ENTIT VISIBILE nella viewport corrente"));const n=e.azioniRecenti.filter(r=>r.type!=="map_move");return n.length>0&&(t.push(""),t.push("AZIONI RECENTI UTENTE:"),n.forEach(r=>{const a=new Date(r.timestamp).toLocaleTimeString("it-IT");t.push(`  [${a}] ${r.type}: ${JSON.stringify(r.data)}`)})),e.selezione.markerAI>0&&(t.push(""),t.push(`MARKER AI SULLA MAPPA: ${e.selezione.markerAI}`)),t.push(""),t.push("=== FINE CONTESTO ==="),t.join(`
`)}function GH({label:e,options:t,selected:n,onToggle:r,placeholder:a,onSelectAll:u}){const[f,s]=B.useState(!1),v=B.useRef(null);B.useEffect(()=>{const C=P=>{v.current&&!v.current.contains(P.target)&&s(!1)};return f&&document.addEventListener("mousedown",C),()=>document.removeEventListener("mousedown",C)},[f]);const x=n.length,A=x===0?a||e:x===t.length?"Tutti":`${x} ${e.toLowerCase()}`;return k.jsxs("div",{ref:v,style:{position:"relative",flex:1},children:[k.jsxs("button",{onClick:()=>s(!f),style:{width:"100%",padding:"6px 10px",fontSize:"12px",border:"1px solid var(--border-color)",borderRadius:"6px",background:x>0?"var(--primary)":"var(--bg-secondary)",color:x>0?"white":"var(--text-primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"4px"},children:[k.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:A}),k.jsx("span",{style:{fontSize:"10px",transform:f?"rotate(180deg)":"none",transition:"transform 0.15s ease"},children:""})]}),f&&k.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"1px solid var(--border-color)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",zIndex:100,maxHeight:"200px",overflowY:"auto"},children:[u&&k.jsx("div",{onClick:()=>{u(),s(!1)},style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 10px",cursor:"pointer",borderBottom:"2px solid var(--border-color)",background:n.length===0?"var(--bg-tertiary)":"transparent",fontWeight:n.length===0?600:400},onMouseEnter:C=>{n.length>0&&(C.currentTarget.style.background="var(--bg-secondary)")},onMouseLeave:C=>{C.currentTarget.style.background=n.length===0?"var(--bg-tertiary)":"transparent"},children:k.jsx("span",{style:{fontSize:"12px",color:"var(--text-primary)"},children:"Tutti"})}),t.map(C=>{const P=n.includes(C.id);return k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 10px",cursor:"pointer",borderBottom:"1px solid var(--border-color)",background:P?"var(--bg-tertiary)":"transparent"},onMouseEnter:L=>{P||(L.currentTarget.style.background="var(--bg-secondary)")},onMouseLeave:L=>{L.currentTarget.style.background=P?"var(--bg-tertiary)":"transparent"},children:[k.jsx("input",{type:"checkbox",checked:P,onChange:()=>r(C.id),style:{accentColor:C.colore||"var(--primary)"}}),C.colore&&k.jsx("span",{style:{width:"10px",height:"10px",borderRadius:"50%",background:C.colore,flexShrink:0}}),k.jsx("span",{style:{flex:1,fontSize:"12px",color:"var(--text-primary)"},children:C.label}),k.jsx("span",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:C.count})]},C.id)}),t.length===0&&k.jsx("div",{style:{padding:"12px",fontSize:"12px",color:"var(--text-secondary)",textAlign:"center"},children:"Nessuna opzione"})]})]})}function jLe({neuroni:e,selectedId:t,onSelect:n,filtri:r,onFiltriChange:a,loading:u,onAddNeurone:f,onQuickMapMode:s,tipiNeurone:v,categorie:x}){const[A,C]=B.useState(!1),P=B.useRef(null);B.useEffect(()=>{const $=X=>{P.current&&!P.current.contains(X.target)&&C(!1)};return A&&document.addEventListener("mousedown",$),()=>document.removeEventListener("mousedown",$)},[A]);const L=B.useMemo(()=>{let $=e;if(r.tipiSelezionati.length>0&&($=$.filter(X=>r.tipiSelezionati.includes(X.tipo))),r.categorieSelezionate.length>0&&($=$.filter(X=>X.categorie.some(ie=>r.categorieSelezionate.some(de=>de.toLowerCase()===ie.toLowerCase())))),r.ricerca.trim()){const X=r.ricerca.toLowerCase().trim();$=$.filter(ie=>{var de;return ie.nome.toLowerCase().includes(X)||((de=ie.indirizzo)==null?void 0:de.toLowerCase().includes(X))||ie.categorie.some(fe=>fe.toLowerCase().includes(X))})}return $},[e,r.tipiSelezionati,r.categorieSelezionate,r.ricerca]),F=B.useMemo(()=>{const $={};return v.forEach(X=>{$[X.nome]=L.filter(ie=>ie.tipo===X.nome)}),$},[L,v]),U=$=>{const X=r.tipiSelezionati.includes($)?r.tipiSelezionati.filter(ie=>ie!==$):[...r.tipiSelezionati,$];a({...r,tipiSelezionati:X})},q=$=>{const X=r.categorieSelezionate.includes($)?r.categorieSelezionate.filter(ie=>ie!==$):[...r.categorieSelezionate,$];a({...r,categorieSelezionate:X})},G=B.useMemo(()=>{if(r.tipiSelezionati.length===0)return x;const $=v.filter(X=>r.tipiSelezionati.includes(X.nome)).map(X=>X.id);return x.filter(X=>$.includes(X.tipo_id))},[x,r.tipiSelezionati,v]);return k.jsxs("aside",{className:"sidebar",children:[k.jsx("div",{style:{padding:"16px",borderBottom:"1px solid var(--border-color)"},children:k.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[k.jsxs("div",{children:[k.jsx("h2",{style:{fontSize:"20px",fontWeight:700,color:"var(--color-primary)"},children:"GenAgenTa"}),k.jsx("p",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:"Rete Neurale Commerciale"})]}),(f||s)&&k.jsxs("div",{ref:P,style:{position:"relative"},children:[k.jsx("button",{onClick:()=>C(!A),className:"btn btn-primary",style:{width:"40px",height:"40px",borderRadius:"50%",padding:0,fontSize:"24px",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",transform:A?"rotate(45deg)":"none",transition:"transform 0.2s ease"},title:"Aggiungi",children:"+"}),A&&k.jsxs("div",{style:{position:"absolute",top:"48px",right:0,background:"white",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.2)",overflow:"hidden",minWidth:"180px",zIndex:1e3},children:[f&&k.jsxs("button",{onClick:()=>{C(!1),f()},style:{display:"flex",alignItems:"center",gap:"10px",width:"100%",padding:"12px 16px",border:"none",background:"none",cursor:"pointer",fontSize:"14px",textAlign:"left",borderBottom:"1px solid #e5e7eb"},onMouseEnter:$=>$.currentTarget.style.background="#f3f4f6",onMouseLeave:$=>$.currentTarget.style.background="none",children:[k.jsx("span",{style:{fontSize:"18px"},children:""}),"Nuova entit"]}),s&&k.jsxs("button",{onClick:()=>{C(!1),s()},style:{display:"flex",alignItems:"center",gap:"10px",width:"100%",padding:"12px 16px",border:"none",background:"none",cursor:"pointer",fontSize:"14px",textAlign:"left"},onMouseEnter:$=>$.currentTarget.style.background="#f3f4f6",onMouseLeave:$=>$.currentTarget.style.background="none",children:[k.jsx("span",{style:{fontSize:"18px"},children:""}),"Nuovo su mappa"]})]})]})]})}),k.jsxs("div",{style:{padding:"10px 12px",borderBottom:"1px solid var(--border-color)"},children:[k.jsx("input",{type:"search",className:"form-input",placeholder:"Cerca...",value:r.ricerca,onChange:$=>a({...r,ricerca:$.target.value}),style:{fontSize:"12px",padding:"6px 10px",marginBottom:"8px"}}),k.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px",marginBottom:"8px"},children:[k.jsx(GH,{label:"Tipi",placeholder:"Tutti i tipi",options:v.map($=>({id:$.nome,label:$.nome,count:e.filter(X=>X.tipo===$.nome).length})),selected:r.tipiSelezionati,onToggle:U,onSelectAll:()=>a({...r,tipiSelezionati:[]})}),k.jsx(GH,{label:"Categorie",placeholder:"Tutte le categorie",options:G.map($=>({id:$.nome,label:$.nome,count:e.filter(X=>X.categorie.some(ie=>ie.toLowerCase()===$.nome.toLowerCase())).length,colore:$.colore})),selected:r.categorieSelezionate,onToggle:q,onSelectAll:()=>a({...r,categorieSelezionate:[]})})]}),k.jsxs("div",{style:{display:"flex",gap:"12px",fontSize:"11px"},children:[k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},children:[k.jsx("input",{type:"checkbox",checked:r.mostraConnessioni,onChange:$=>a({...r,mostraConnessioni:$.target.checked}),style:{width:"14px",height:"14px"}}),"Connessioni"]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer",opacity:r.mostraConnessioni?1:.4},children:[k.jsx("input",{type:"checkbox",checked:r.soloConnessioniSelezionate,onChange:$=>a({...r,soloConnessioniSelezionate:$.target.checked}),disabled:!r.mostraConnessioni,style:{width:"14px",height:"14px"}}),"Solo selezionato"]})]})]}),k.jsx("div",{className:"neurone-list",children:u?k.jsx("p",{style:{padding:"16px",color:"var(--text-secondary)",textAlign:"center"},children:"Caricamento..."}):L.length===0?k.jsx("p",{style:{padding:"16px",color:"var(--text-secondary)",textAlign:"center"},children:"Nessun risultato"}):k.jsx(k.Fragment,{children:v.map($=>{const X=F[$.nome]||[];return X.length===0?null:k.jsx(ULe,{titolo:$.nome,neuroni:X,selectedId:t,onSelect:n,categorie:x},$.id)})})}),k.jsx("div",{style:{padding:"12px",borderTop:"1px solid var(--border-color)",fontSize:"12px",color:"var(--text-secondary)"},children:L.length===e.length?`${e.length} entit`:`${L.length} di ${e.length} entit`})]})}function ULe({titolo:e,neuroni:t,selectedId:n,onSelect:r,categorie:a}){const u=f=>{const s=a.find(v=>v.nome.toLowerCase()===f.toLowerCase());return(s==null?void 0:s.colore)||"#6b7280"};return k.jsxs("div",{style:{marginBottom:"8px"},children:[k.jsxs("h3",{style:{fontSize:"11px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",color:"var(--text-secondary)",padding:"8px 12px 4px"},children:[e," (",t.length,")"]}),t.slice(0,50).map(f=>k.jsxs("div",{className:`neurone-item ${n===f.id?"active":""}`,onClick:()=>r(f),children:[k.jsxs("div",{className:"neurone-item-name",children:[f.nome,f.has_note&&k.jsx("span",{className:"icon-lock",title:"Ha note personali",children:""})]}),k.jsxs("div",{className:"neurone-item-meta",style:{display:"flex",alignItems:"center",gap:"4px"},children:[f.categorie.slice(0,2).map((s,v)=>k.jsx("span",{style:{display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",background:u(s)},title:s},v)),k.jsx("span",{style:{marginLeft:"2px"},children:f.categorie.slice(0,2).join(", ")})]})]},f.id)),t.length>50&&k.jsxs("p",{style:{padding:"4px 12px",fontSize:"11px",color:"var(--text-secondary)"},children:["+",t.length-50," altri..."]})]})}var Zne={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(ep,function(){var n,r,a;function u(s,v){if(!n)n=v;else if(!r)r=v;else{var x="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",A={};n(A),a=v(A),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(a.workerUrl=window.URL.createObjectURL(new Blob([x],{type:"text/javascript"})))}}u(["exports"],function(s){var v=1e-6,x=typeof Float32Array<"u"?Float32Array:Array;function A(c,i){var l=i[0],h=i[1],p=i[2],_=i[3],y=l*_-p*h;return y?(c[0]=_*(y=1/y),c[1]=-h*y,c[2]=-p*y,c[3]=l*y,c):null}function C(){var c=new x(9);return x!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function P(c,i){var l=i[0],h=i[1],p=i[2],_=i[3],y=i[4],w=i[5],S=i[6],R=i[7],O=i[8];return c[0]=y*O-w*R,c[1]=p*R-h*O,c[2]=h*w-p*y,c[3]=w*S-_*O,c[4]=l*O-p*S,c[5]=p*_-l*w,c[6]=_*R-y*S,c[7]=h*S-l*R,c[8]=l*y-h*_,c}function L(c,i,l){var h=i[0],p=i[1],_=i[2],y=i[3],w=i[4],S=i[5],R=i[6],O=i[7],D=i[8],z=l[0],V=l[1],H=l[2],K=l[3],re=l[4],ne=l[5],ue=l[6],he=l[7],ge=l[8];return c[0]=z*h+V*y+H*R,c[1]=z*p+V*w+H*O,c[2]=z*_+V*S+H*D,c[3]=K*h+re*y+ne*R,c[4]=K*p+re*w+ne*O,c[5]=K*_+re*S+ne*D,c[6]=ue*h+he*y+ge*R,c[7]=ue*p+he*w+ge*O,c[8]=ue*_+he*S+ge*D,c}function F(){var c=new x(16);return x!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c}function U(c){var i=new x(16);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i[3]=c[3],i[4]=c[4],i[5]=c[5],i[6]=c[6],i[7]=c[7],i[8]=c[8],i[9]=c[9],i[10]=c[10],i[11]=c[11],i[12]=c[12],i[13]=c[13],i[14]=c[14],i[15]=c[15],i}function q(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function G(c,i){var l=i[0],h=i[1],p=i[2],_=i[3],y=i[4],w=i[5],S=i[6],R=i[7],O=i[8],D=i[9],z=i[10],V=i[11],H=i[12],K=i[13],re=i[14],ne=i[15],ue=l*w-h*y,he=l*S-p*y,ge=l*R-_*y,ke=h*S-p*w,Ee=h*R-_*w,Me=p*R-_*S,Be=O*K-D*H,$e=O*re-z*H,pt=O*ne-V*H,Ye=D*re-z*K,vt=D*ne-V*K,kt=z*ne-V*re,It=ue*kt-he*vt+ge*Ye+ke*pt-Ee*$e+Me*Be;return It?(c[0]=(w*kt-S*vt+R*Ye)*(It=1/It),c[1]=(p*vt-h*kt-_*Ye)*It,c[2]=(K*Me-re*Ee+ne*ke)*It,c[3]=(z*Ee-D*Me-V*ke)*It,c[4]=(S*pt-y*kt-R*$e)*It,c[5]=(l*kt-p*pt+_*$e)*It,c[6]=(re*ge-H*Me-ne*he)*It,c[7]=(O*Me-z*ge+V*he)*It,c[8]=(y*vt-w*pt+R*Be)*It,c[9]=(h*pt-l*vt-_*Be)*It,c[10]=(H*Ee-K*ge+ne*ue)*It,c[11]=(D*ge-O*Ee-V*ue)*It,c[12]=(w*$e-y*Ye-S*Be)*It,c[13]=(l*Ye-h*$e+p*Be)*It,c[14]=(K*he-H*ke-re*ue)*It,c[15]=(O*ke-D*he+z*ue)*It,c):null}function $(c,i,l){var h=i[0],p=i[1],_=i[2],y=i[3],w=i[4],S=i[5],R=i[6],O=i[7],D=i[8],z=i[9],V=i[10],H=i[11],K=i[12],re=i[13],ne=i[14],ue=i[15],he=l[0],ge=l[1],ke=l[2],Ee=l[3];return c[0]=he*h+ge*w+ke*D+Ee*K,c[1]=he*p+ge*S+ke*z+Ee*re,c[2]=he*_+ge*R+ke*V+Ee*ne,c[3]=he*y+ge*O+ke*H+Ee*ue,c[4]=(he=l[4])*h+(ge=l[5])*w+(ke=l[6])*D+(Ee=l[7])*K,c[5]=he*p+ge*S+ke*z+Ee*re,c[6]=he*_+ge*R+ke*V+Ee*ne,c[7]=he*y+ge*O+ke*H+Ee*ue,c[8]=(he=l[8])*h+(ge=l[9])*w+(ke=l[10])*D+(Ee=l[11])*K,c[9]=he*p+ge*S+ke*z+Ee*re,c[10]=he*_+ge*R+ke*V+Ee*ne,c[11]=he*y+ge*O+ke*H+Ee*ue,c[12]=(he=l[12])*h+(ge=l[13])*w+(ke=l[14])*D+(Ee=l[15])*K,c[13]=he*p+ge*S+ke*z+Ee*re,c[14]=he*_+ge*R+ke*V+Ee*ne,c[15]=he*y+ge*O+ke*H+Ee*ue,c}function X(c,i,l){var h,p,_,y,w,S,R,O,D,z,V,H,K=l[0],re=l[1],ne=l[2];return i===c?(c[12]=i[0]*K+i[4]*re+i[8]*ne+i[12],c[13]=i[1]*K+i[5]*re+i[9]*ne+i[13],c[14]=i[2]*K+i[6]*re+i[10]*ne+i[14],c[15]=i[3]*K+i[7]*re+i[11]*ne+i[15]):(p=i[1],_=i[2],y=i[3],w=i[4],S=i[5],R=i[6],O=i[7],D=i[8],z=i[9],V=i[10],H=i[11],c[0]=h=i[0],c[1]=p,c[2]=_,c[3]=y,c[4]=w,c[5]=S,c[6]=R,c[7]=O,c[8]=D,c[9]=z,c[10]=V,c[11]=H,c[12]=h*K+w*re+D*ne+i[12],c[13]=p*K+S*re+z*ne+i[13],c[14]=_*K+R*re+V*ne+i[14],c[15]=y*K+O*re+H*ne+i[15]),c}function ie(c,i,l){var h=l[0],p=l[1],_=l[2];return c[0]=i[0]*h,c[1]=i[1]*h,c[2]=i[2]*h,c[3]=i[3]*h,c[4]=i[4]*p,c[5]=i[5]*p,c[6]=i[6]*p,c[7]=i[7]*p,c[8]=i[8]*_,c[9]=i[9]*_,c[10]=i[10]*_,c[11]=i[11]*_,c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15],c}function de(c,i,l){var h=Math.sin(l),p=Math.cos(l),_=i[4],y=i[5],w=i[6],S=i[7],R=i[8],O=i[9],D=i[10],z=i[11];return i!==c&&(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[4]=_*p+R*h,c[5]=y*p+O*h,c[6]=w*p+D*h,c[7]=S*p+z*h,c[8]=R*p-_*h,c[9]=O*p-y*h,c[10]=D*p-w*h,c[11]=z*p-S*h,c}function fe(c,i,l){var h=Math.sin(l),p=Math.cos(l),_=i[0],y=i[1],w=i[2],S=i[3],R=i[8],O=i[9],D=i[10],z=i[11];return i!==c&&(c[4]=i[4],c[5]=i[5],c[6]=i[6],c[7]=i[7],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[0]=_*p-R*h,c[1]=y*p-O*h,c[2]=w*p-D*h,c[3]=S*p-z*h,c[8]=_*h+R*p,c[9]=y*h+O*p,c[10]=w*h+D*p,c[11]=S*h+z*p,c}function be(c,i,l){var h=Math.sin(l),p=Math.cos(l),_=i[0],y=i[1],w=i[2],S=i[3],R=i[4],O=i[5],D=i[6],z=i[7];return i!==c&&(c[8]=i[8],c[9]=i[9],c[10]=i[10],c[11]=i[11],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[0]=_*p+R*h,c[1]=y*p+O*h,c[2]=w*p+D*h,c[3]=S*p+z*h,c[4]=R*p-_*h,c[5]=O*p-y*h,c[6]=D*p-w*h,c[7]=z*p-S*h,c}function ve(c,i){return c[0]=i[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=i[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=i[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Qe(c,i,l){var h,p,_,y=l[0],w=l[1],S=l[2],R=Math.sqrt(y*y+w*w+S*S);return R<v?null:(y*=R=1/R,w*=R,S*=R,h=Math.sin(i),p=Math.cos(i),c[0]=y*y*(_=1-p)+p,c[1]=w*y*_+S*h,c[2]=S*y*_-w*h,c[3]=0,c[4]=y*w*_-S*h,c[5]=w*w*_+p,c[6]=S*w*_+y*h,c[7]=0,c[8]=y*S*_+w*h,c[9]=w*S*_-y*h,c[10]=S*S*_+p,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c)}function we(c,i){var l=i[0],h=i[1],p=i[2],_=i[4],y=i[5],w=i[6],S=i[8],R=i[9],O=i[10];return c[0]=Math.sqrt(l*l+h*h+p*p),c[1]=Math.sqrt(_*_+y*y+w*w),c[2]=Math.sqrt(S*S+R*R+O*O),c}function qe(c,i){var l=i[0],h=i[1],p=i[2],_=i[3],y=l+l,w=h+h,S=p+p,R=l*y,O=h*y,D=h*w,z=p*y,V=p*w,H=p*S,K=_*y,re=_*w,ne=_*S;return c[0]=1-D-H,c[1]=O+ne,c[2]=z-re,c[3]=0,c[4]=O-ne,c[5]=1-R-H,c[6]=V+K,c[7]=0,c[8]=z+re,c[9]=V-K,c[10]=1-R-D,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}var Je=$;function ft(){var c=new x(3);return x!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function Mt(c){var i=new x(3);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i}function Pt(c){var i=c[0],l=c[1],h=c[2];return Math.sqrt(i*i+l*l+h*h)}function Nt(c,i,l){var h=new x(3);return h[0]=c,h[1]=i,h[2]=l,h}function Kt(c,i,l,h){return c[0]=i,c[1]=l,c[2]=h,c}function tt(c,i,l){return c[0]=i[0]+l[0],c[1]=i[1]+l[1],c[2]=i[2]+l[2],c}function mt(c,i,l){return c[0]=i[0]-l[0],c[1]=i[1]-l[1],c[2]=i[2]-l[2],c}function Pe(c,i,l){return c[0]=i[0]*l[0],c[1]=i[1]*l[1],c[2]=i[2]*l[2],c}function gn(c,i,l){return c[0]=Math.min(i[0],l[0]),c[1]=Math.min(i[1],l[1]),c[2]=Math.min(i[2],l[2]),c}function Et(c,i,l){return c[0]=Math.max(i[0],l[0]),c[1]=Math.max(i[1],l[1]),c[2]=Math.max(i[2],l[2]),c}function ze(c,i,l){return c[0]=i[0]*l,c[1]=i[1]*l,c[2]=i[2]*l,c}function $t(c,i,l,h){return c[0]=i[0]+l[0]*h,c[1]=i[1]+l[1]*h,c[2]=i[2]+l[2]*h,c}function Cn(c,i){var l=i[0]-c[0],h=i[1]-c[1],p=i[2]-c[2];return Math.sqrt(l*l+h*h+p*p)}function fn(c,i){var l=i[0]-c[0],h=i[1]-c[1],p=i[2]-c[2];return l*l+h*h+p*p}function Nn(c){var i=c[0],l=c[1],h=c[2];return i*i+l*l+h*h}function bn(c,i){return c[0]=-i[0],c[1]=-i[1],c[2]=-i[2],c}function Vt(c,i){var l=i[0],h=i[1],p=i[2],_=l*l+h*h+p*p;return _>0&&(_=1/Math.sqrt(_)),c[0]=i[0]*_,c[1]=i[1]*_,c[2]=i[2]*_,c}function En(c,i){return c[0]*i[0]+c[1]*i[1]+c[2]*i[2]}function Sn(c,i,l){var h=i[0],p=i[1],_=i[2],y=l[0],w=l[1],S=l[2];return c[0]=p*S-_*w,c[1]=_*y-h*S,c[2]=h*w-p*y,c}function Un(c,i,l,h){var p=i[0],_=i[1],y=i[2];return c[0]=p+h*(l[0]-p),c[1]=_+h*(l[1]-_),c[2]=y+h*(l[2]-y),c}function nn(c,i,l){var h=i[0],p=i[1],_=i[2],y=l[3]*h+l[7]*p+l[11]*_+l[15];return c[0]=(l[0]*h+l[4]*p+l[8]*_+l[12])/(y=y||1),c[1]=(l[1]*h+l[5]*p+l[9]*_+l[13])/y,c[2]=(l[2]*h+l[6]*p+l[10]*_+l[14])/y,c}function wr(c,i,l){var h=i[0],p=i[1],_=i[2];return c[0]=h*l[0]+p*l[3]+_*l[6],c[1]=h*l[1]+p*l[4]+_*l[7],c[2]=h*l[2]+p*l[5]+_*l[8],c}function Xr(c,i,l){var h=l[0],p=l[1],_=l[2],y=l[3],w=i[0],S=i[1],R=i[2],O=p*R-_*S,D=_*w-h*R,z=h*S-p*w;return c[0]=w+y*(O+=O)+p*(z+=z)-_*(D+=D),c[1]=S+y*D+_*O-h*z,c[2]=R+y*z+h*D-p*O,c}function ar(c){return c[0]=0,c[1]=0,c[2]=0,c}function tr(c,i){return c[0]===i[0]&&c[1]===i[1]&&c[2]===i[2]}var Vn=mt,xr=Pe,ws=Pt;function bi(){var c=new x(4);return x!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0,c[3]=0),c}function Ai(c,i,l){return c[0]=i[0]*l,c[1]=i[1]*l,c[2]=i[2]*l,c[3]=i[3]*l,c}function ps(c,i){var l=i[0],h=i[1],p=i[2],_=i[3],y=l*l+h*h+p*p+_*_;return y>0&&(y=1/Math.sqrt(y)),c[0]=l*y,c[1]=h*y,c[2]=p*y,c[3]=_*y,c}function $i(c,i,l){var h=i[0],p=i[1],_=i[2],y=i[3];return c[0]=l[0]*h+l[4]*p+l[8]*_+l[12]*y,c[1]=l[1]*h+l[5]*p+l[9]*_+l[13]*y,c[2]=l[2]*h+l[6]*p+l[10]*_+l[14]*y,c[3]=l[3]*h+l[7]*p+l[11]*_+l[15]*y,c}function Ts(){var c=new x(4);return x!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function tn(c){return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c}function kn(c,i,l){l*=.5;var h=i[0],p=i[1],_=i[2],y=i[3],w=Math.sin(l),S=Math.cos(l);return c[0]=h*S+y*w,c[1]=p*S+_*w,c[2]=_*S-p*w,c[3]=y*S-h*w,c}function Mr(c,i,l){l*=.5;var h=i[0],p=i[1],_=i[2],y=i[3],w=Math.sin(l),S=Math.cos(l);return c[0]=h*S-_*w,c[1]=p*S+y*w,c[2]=_*S+h*w,c[3]=y*S-p*w,c}ft(),bi();var wt,Rn,nr,dt=ps,Jn=(wt=ft(),Rn=Nt(1,0,0),nr=Nt(0,1,0),function(c,i,l){var h=En(i,l);return h<-.999999?(Sn(wt,Rn,i),ws(wt)<1e-6&&Sn(wt,nr,i),Vt(wt,wt),function(p,_,y){y*=.5;var w=Math.sin(y);p[0]=w*_[0],p[1]=w*_[1],p[2]=w*_[2],p[3]=Math.cos(y)}(c,wt,Math.PI),c):h>.999999?(c[0]=0,c[1]=0,c[2]=0,c[3]=1,c):(Sn(wt,i,l),c[0]=wt[0],c[1]=wt[1],c[2]=wt[2],c[3]=1+h,dt(c,c))});function qr(){var c=new x(2);return x!=Float32Array&&(c[0]=0,c[1]=0),c}function ts(c,i){var l=new x(2);return l[0]=c,l[1]=i,l}function ms(c,i,l){return c[0]=i,c[1]=l,c}function Mn(c,i,l){return c[0]=i[0]+l[0],c[1]=i[1]+l[1],c}function Tt(c,i,l){return c[0]=i[0]-l[0],c[1]=i[1]-l[1],c}function ut(c,i,l){return c[0]=i[0]*l,c[1]=i[1]*l,c}function on(c){var i=c[0],l=c[1];return Math.sqrt(i*i+l*l)}function qn(c,i){var l=i[0],h=i[1],p=l*l+h*h;return p>0&&(p=1/Math.sqrt(p)),c[0]=i[0]*p,c[1]=i[1]*p,c}function Or(c,i){return c[0]*i[0]+c[1]*i[1]}Ts(),Ts(),C();var Zn,ns,ga=Tt;function Ys(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}qr();var rn=function(){if(ns)return Zn;function c(i,l,h,p){this.cx=3*i,this.bx=3*(h-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(p-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=l,this.p2x=h,this.p2y=p}return ns=1,Zn=c,c.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,l){if(l===void 0&&(l=1e-6),i<0)return 0;if(i>1)return 1;for(var h=i,p=0;p<8;p++){var _=this.sampleCurveX(h)-i;if(Math.abs(_)<l)return h;var y=this.sampleCurveDerivativeX(h);if(Math.abs(y)<1e-6)break;h-=_/y}var w=0,S=1;for(h=i,p=0;p<20&&(_=this.sampleCurveX(h),!(Math.abs(_-i)<l));p++)i>_?w=h:S=h,h=.5*(S-w)+w;return h},solve:function(i,l){return this.sampleCurveY(this.solveCurveX(i,l))}},Zn}(),rr=Ys(rn);function Ve(c,i){this.x=c,this.y=i}function or(c,i){if(Array.isArray(c)){if(!Array.isArray(i)||c.length!==i.length)return!1;for(let l=0;l<c.length;l++)if(!or(c[l],i[l]))return!1;return!0}if(typeof c=="object"&&c!==null&&i!==null){if(typeof i!="object"||Object.keys(c).length!==Object.keys(i).length)return!1;for(const l in c)if(!or(c[l],i[l]))return!1;return!0}return c===i}Ve.prototype={clone(){return new Ve(this.x,this.y)},add(c){return this.clone()._add(c)},sub(c){return this.clone()._sub(c)},multByPoint(c){return this.clone()._multByPoint(c)},divByPoint(c){return this.clone()._divByPoint(c)},mult(c){return this.clone()._mult(c)},div(c){return this.clone()._div(c)},rotate(c){return this.clone()._rotate(c)},rotateAround(c,i){return this.clone()._rotateAround(c,i)},matMult(c){return this.clone()._matMult(c)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(c){return this.x===c.x&&this.y===c.y},dist(c){return Math.sqrt(this.distSqr(c))},distSqr(c){const i=c.x-this.x,l=c.y-this.y;return i*i+l*l},angle(){return Math.atan2(this.y,this.x)},angleTo(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith(c){return this.angleWithSep(c.x,c.y)},angleWithSep(c,i){return Math.atan2(this.x*i-this.y*c,this.x*c+this.y*i)},_matMult(c){const i=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=i,this},_add(c){return this.x+=c.x,this.y+=c.y,this},_sub(c){return this.x-=c.x,this.y-=c.y,this},_mult(c){return this.x*=c,this.y*=c,this},_div(c){return this.x/=c,this.y/=c,this},_multByPoint(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint(c){return this.x/=c.x,this.y/=c.y,this},_unit(){return this._div(this.mag()),this},_perp(){const c=this.y;return this.y=this.x,this.x=-c,this},_rotate(c){const i=Math.cos(c),l=Math.sin(c),h=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=h,this},_rotateAround(c,i){const l=Math.cos(c),h=Math.sin(c),p=i.y+h*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-h*(this.y-i.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Ve},Ve.convert=function(c){if(c instanceof Ve)return c;if(Array.isArray(c))return new Ve(+c[0],+c[1]);if(c.x!==void 0&&c.y!==void 0)return new Ve(+c.x,+c.y);throw new Error("Expected [x, y] or {x, y} point format")};const _n=Math.PI/180,Yn=180/Math.PI;function Tn(c){return c*_n}function ti(c){return c*Yn}const Sr=[[0,0],[1,0],[1,1],[0,1]];function Mi(c){if(c<=0)return 0;if(c>=1)return 1;const i=c*c,l=i*c;return 4*(c<.5?l:3*(c-i)+l-.75)}function da(c,i,l,h){const p=new rr(c,i,l,h);return function(_){return p.solve(_)}}const Ze=da(.25,.1,.25,1);function ee(c,i,l){return Math.min(l,Math.max(i,c))}function le(c,i,l){return(l=ee((l-c)/(i-c),0,1))*l*(3-2*l)}function ye(c,i,l){const h=l-i,p=((c-i)%h+h)%h+i;return p===i?l:p}function De(c,i,l){if(!c.length)return l(null,[]);let h=c.length;const p=new Array(c.length);let _=null;c.forEach((y,w)=>{i(y,(S,R)=>{S&&(_=S),p[w]=R,--h==0&&l(_,p)})})}let Oe=1;function je(){return Oe++}function st(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log2(c)))}function We(c,i){c.forEach(l=>{i[l]&&(i[l]=i[l].bind(i))})}function nt(c,i,l){const h={};for(const p in c)h[p]=i.call(this,c[p],p,c);return h}function Rt(c,i,l){const h={};for(const p in c)i.call(this,c[p],p,c)&&(h[p]=c[p]);return h}function bt(c){return Array.isArray(c)?c.map(bt):typeof c=="object"&&c?nt(c,bt):c}function ln(c,i){for(let l=0;l<c.length;l++)if(i.indexOf(c[l])>=0)return!0;return!1}const wn={};function un(c){wn[c]||(typeof console<"u"&&console.warn(c),wn[c]=!0)}function fr(c,i,l){return(l.y-c.y)*(i.x-c.x)>(i.y-c.y)*(l.x-c.x)}function Tr(c){let i=0;for(let l,h,p=0,_=c.length,y=_-1;p<_;y=p++)l=c[p],h=c[y],i+=(h.x-l.x)*(l.y+h.y);return i}function Ar([c,i,l]){const h=Tn(i+90),p=Tn(l);return{x:c*Math.cos(h)*Math.sin(p),y:c*Math.sin(h)*Math.sin(p),z:c*Math.cos(p),azimuthal:i,polar:l}}function ni(c){return(typeof self<"u"||c!==void 0)&&typeof WorkerGlobalScope<"u"&&(c!==void 0?c:self)instanceof WorkerGlobalScope}function Pi(c){const i={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,p,_)=>{const y=p||_;return i[h]=!y||y.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i}let ds=null;function Wi(c,i){return[c[4*i],c[4*i+1],c[4*i+2],c[4*i+3]]}function Es(c,i,l,h){for(;i<l;){const p=i+l>>1;c[p]<h?i=p+1:l=p}return i}function ji(c,i,l,h){for(;i<l;){const p=i+l>>1;c[p]<=h?i=p+1:l=p}return i}function li(c){return c>0?1/(1.001-c):1+c}function Is(c){return c>0?1-1/(1.001-c):-c}function Zi(c,i,l){return(c-i.min)*(l.max-l.min)/(i.max-i.min)+l.min}const ri={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ri.API_URL)return null;try{const c=new URL(ri.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ha(c){return ri.API_URL_REGEX.test(c)}function xo(c){return ri.API_SPRITE_REGEX.test(c)}let Ha,Mo,vd,bo,ou,ol;function Fc(){return Ha==null&&(Ha=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ha}const fo={now:()=>bo!==void 0?bo:performance.now(),setNow(c){bo=c},restoreNow(){bo=void 0},frame(c){const i=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(c,i=0){const{width:l,height:h}=c;ou||(ou=document.createElement("canvas"));const p=ou.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(l>ou.width||h>ou.height)&&(ou.width=l,ou.height=h),p.clearRect(-i,-i,l+2*i,h+2*i),p.drawImage(c,0,0,l,h),p.getImageData(-i,-i,l+2*i,h+2*i)},resolveURL:c=>(Mo||(Mo=document.createElement("a")),Mo.href=c,Mo.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(vd==null&&(vd=window.matchMedia("(prefers-reduced-motion: reduce)")),vd.matches)},hasCanvasFingerprintNoise(){if(ol!==void 0)return ol;if(!Fc())return ol=!1,!1;const c=new OffscreenCanvas(85,1),i=c.getContext("2d",{willReadFrequently:!0});let l=0;for(let p=0;p<c.width;++p)i.fillStyle=`rgba(${l++},${l++},${l++}, 255)`,i.fillRect(p,0,1,1);const h=i.getImageData(0,0,c.width,c.height);l=0;for(let p=0;p<h.data.length;++p)if(p%4!=3&&l++!==h.data[p])return ol=!0,!0;return ol=!1,!1}};function yf(c,i){const l=c.indexOf("?");if(l<0)return`${c}?${new URLSearchParams(i).toString()}`;const h=new URLSearchParams(c.slice(l));for(const p in i)h.set(p,i[p]);return`${c.slice(0,l)}?${h.toString()}`}function Ap(c,i={persistentParams:[]}){const l=c.indexOf("?");if(l<0)return c;const h=new URLSearchParams,p=new URLSearchParams(c.slice(l));for(const y of i.persistentParams){const w=p.get(y);w&&h.set(y,w)}const _=h.toString();return`${c.slice(0,l)}${_.length>0?`?${_}`:""}`}const L_="mapbox-tiles";let D_=500,N_=50;const A0=["language","worldview","jobid"];let Bc,Al;function oc(){try{return caches}catch{}}function lc(){const c=oc();c&&Bc==null&&(Bc=c.open(L_))}let Mu=1/0;const jc={supported:!1,testSupport:function(c){!z_&&vf&&(xf?KT(c):ph=c)}};let ph,vf,z_=!1,xf=!1;const F_=typeof self<"u"?self:{};function KT(c){const i=c.createTexture();c.bindTexture(c.TEXTURE_2D,i);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,vf),c.isContextLost())return;jc.supported=!0}catch{}c.deleteTexture(i),z_=!0}F_.document&&(vf=F_.document.createElement("img"),vf.onload=function(){ph&&KT(ph),ph=null,xf=!0},vf.onerror=function(){z_=!0,ph=null},vf.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const C0={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(C0);class $l extends Error{constructor(i,l,h){l===401&&ha(h)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=l,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const B_=ni()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,bf=function(c,i){if(!(/^file:/.test(l=c.url)||/^file:/.test(B_())&&!/^\w+:/.test(l))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(h,p){const _=new AbortController,y=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:B_(),referrerPolicy:h.referrerPolicy,signal:_.signal});let w=!1,S=!1;const R=(O=y.url).indexOf("sku=")>0&&ha(O);var O;h.type==="json"&&y.headers.set("Accept","application/json");const D=(V,H,K)=>{if(S)return;if(V&&V.message!=="SecurityError"&&un(V.toString()),H&&K)return z(H);const re=Date.now();fetch(y).then(ne=>{if(ne.ok){const ue=R?ne.clone():null;return z(ne,ue,re)}return p(new $l(ne.statusText,ne.status,h.url))}).catch(ne=>{ne.name!=="AbortError"&&p(new Error(`${ne.message} ${h.url}`))})},z=(V,H,K)=>{(h.type==="arrayBuffer"?V.arrayBuffer():h.type==="json"?V.json():V.text()).then(re=>{S||(H&&K&&function(ne,ue,he){if(lc(),Bc==null)return;const ge=Pi(ue.headers.get("Cache-Control")||"");if(ge["no-store"])return;const ke={status:ue.status,statusText:ue.statusText,headers:new Headers};ue.headers.forEach((Be,$e)=>ke.headers.set($e,Be)),ge["max-age"]&&ke.headers.set("Expires",new Date(he+1e3*ge["max-age"]).toUTCString());const Ee=ke.headers.get("Expires");if(!Ee||new Date(Ee).getTime()-he<42e4)return;let Me=Ap(ne.url,{persistentParams:A0});if(ue.status===206){const Be=ne.headers.get("Range");if(!Be)return;ke.status=200,Me=yf(Me,{range:Be})}(function(Be,$e){if(Al===void 0)try{new Response(new ReadableStream),Al=!0}catch{Al=!1}Al?$e(Be.body):Be.blob().then($e).catch(pt=>un(pt.message))})(ue,Be=>{const $e=new Response((pt=ue.status)!==200&&pt!==404&&[101,103,204,205,304].includes(pt)?null:Be,ke);var pt;lc(),Bc!=null&&Bc.then(Ye=>Ye.put(Me,$e)).catch(Ye=>un(Ye.message))})}(y,H,K),w=!0,p(null,re,V.headers))}).catch(re=>{S||p(new Error(re.message))})};return R?function(V,H){if(lc(),Bc==null)return H(null);Bc.then(K=>{let re=Ap(V.url,{persistentParams:A0});const ne=V.headers.get("Range");ne&&(re=yf(re,{range:ne})),K.match(re).then(ue=>{const he=function(ge){if(!ge)return!1;const ke=new Date(ge.headers.get("Expires")||0),Ee=Pi(ge.headers.get("Cache-Control")||"");return Number(ke)>Date.now()&&!Ee["no-cache"]}(ue);K.delete(re).catch(H),he&&K.put(re,ue.clone()).catch(H),H(null,ue,he)}).catch(H)}).catch(H)}(y,D):D(null,null),{cancel:()=>{S=!0,w||_.abort()}}}(c,i);if(ni(self)&&self.worker.actor)return self.worker.actor.send("getResource",c,i,void 0,!0)}var l;return function(h,p){const _=new XMLHttpRequest;_.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const y in h.headers)_.setRequestHeader(y,h.headers[y]);return h.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=h.credentials==="include",_.onerror=()=>{p(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let y=_.response;if(h.type==="json")try{y=JSON.parse(_.response)}catch(S){return p(S)}const w=new Headers;_.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(S=>{const R=S.split(": "),O=R.shift(),D=R.join(": ");w.append(O,D)}),p(null,y,w)}else p(new $l(_.statusText,_.status,h.url))},_.send(h.body),{cancel:()=>_.abort()}}(c,i)},xd=function(c,i){return bf(Object.assign(c,{type:"arrayBuffer"}),i)};function Pk(c){const i=document.createElement("a");return i.href=c,i.protocol===location.protocol&&i.host===location.host}const QT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let k0,Ii;k0=[],Ii=0;const j_=function(c,i){if(jc.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Ii>=ri.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:c,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return k0.push(_),_}Ii++;let l=!1;const h=()=>{if(!l)for(l=!0,Ii--;k0.length&&Ii<ri.MAX_PARALLEL_IMAGE_REQUESTS;){const _=k0.shift(),{requestParameters:y,callback:w,cancelled:S}=_;S||(_.cancel=j_(y,w).cancel)}},p=xd(c,(_,y,w)=>{h(),_?i(_):y&&(self.createImageBitmap?function(S,R){const O=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(O).then(D=>{R(null,D)}).catch(D=>{R(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(S,R)=>i(S,R,w)):function(S,R){const O=new Image;O.onload=()=>{R(null,O),URL.revokeObjectURL(O.src),O.onload=null,requestAnimationFrame(()=>{O.src=QT})},O.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Blob([new Uint8Array(S)],{type:"image/png"});O.src=S.byteLength?URL.createObjectURL(D):QT}(y,(S,R)=>i(S,R,w)))});return{cancel:()=>{p.cancel(),h()}}};var bx,JT,eE,mh={exports:{}},I0={exports:{}},R0={exports:{}},wx=function(){if(eE)return mh.exports;eE=1;var c=(bx||(bx=1,I0.exports=function(l,h){var p,_,y,w,S,R,O,D;for(_=l.length-(p=3&l.length),y=h,S=3432918353,R=461845907,D=0;D<_;)O=255&l.charCodeAt(D)|(255&l.charCodeAt(++D))<<8|(255&l.charCodeAt(++D))<<16|(255&l.charCodeAt(++D))<<24,++D,y=27492+(65535&(w=5*(65535&(y=(y^=O=(65535&(O=(O=(65535&O)*S+(((O>>>16)*S&65535)<<16)&4294967295)<<15|O>>>17))*R+(((O>>>16)*R&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(O=0,p){case 3:O^=(255&l.charCodeAt(D+2))<<16;case 2:O^=(255&l.charCodeAt(D+1))<<8;case 1:y^=O=(65535&(O=(O=(65535&(O^=255&l.charCodeAt(D)))*S+(((O>>>16)*S&65535)<<16)&4294967295)<<15|O>>>17))*R+(((O>>>16)*R&65535)<<16)&4294967295}return y^=l.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),I0.exports),i=(JT||(JT=1,R0.exports=function(l,h){for(var p,_=l.length,y=h^_,w=0;_>=4;)p=1540483477*(65535&(p=255&l.charCodeAt(w)|(255&l.charCodeAt(++w))<<8|(255&l.charCodeAt(++w))<<16|(255&l.charCodeAt(++w))<<24))+((1540483477*(p>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),_-=4,++w;switch(_){case 3:y^=(255&l.charCodeAt(w+2))<<16;case 2:y^=(255&l.charCodeAt(w+1))<<8;case 1:y=1540483477*(65535&(y^=255&l.charCodeAt(w)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),R0.exports);return mh.exports=c,mh.exports.murmur3=c,mh.exports.murmur2=i,mh.exports}(),U_=Ys(wx);class Uc{constructor(i,...l){Object.assign(this,l[0]||{}),this.type=i}}class M0 extends Uc{constructor(i,l={}){super("error",Object.assign({error:i},l))}}function Tx(c,i,l){l[c]&&l[c].indexOf(i)!==-1||(l[c]=l[c]||[],l[c].push(i))}function gh(c,i,l){if(l&&l[c]){const h=l[c].indexOf(i);h!==-1&&l[c].splice(h,1)}}class wf{on(i,l){return this._listeners=this._listeners||{},Tx(i,l,this._listeners),this}off(i,l){return gh(i,l,this._listeners),gh(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Tx(i,l,this._oneTimeListeners),this):new Promise(h=>{this.once(i,h)})}fire(i,l){const h=typeof i=="string"?new Uc(i,l):i,p=h.type;if(this.listens(p)){h.target=this;const _=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const S of _)S.call(this,h);const y=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const S of y)gh(p,S,this._oneTimeListeners),S.call(this,h);const w=this._eventedParent;if(w){const S=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(h,S),w.fire(h)}}else h instanceof M0&&console.error(h.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}class ll{constructor(i){typeof i=="string"?this.name=i:(this.name=i.name,this.iconsetId=i.iconsetId)}static from(i){return new ll(i)}static toString(i){return i.iconsetId?`${i.name}${i.iconsetId}`:i.name}static parse(i){const[l,h]=i.split("");return new ll({name:l,iconsetId:h})}static isEqual(i,l){return i.name===l.name&&i.iconsetId===l.iconsetId}toString(){return ll.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var V_,P0={},Pu=function(){if(V_)return P0;V_=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(_){return(_=Math.round(_))<0?0:_>255?255:_}function l(_){return i(_[_.length-1]==="%"?parseFloat(_)/100*255:parseInt(_))}function h(_){return(y=_[_.length-1]==="%"?parseFloat(_)/100:parseFloat(_))<0?0:y>1?1:y;var y}function p(_,y,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?_+(y-_)*w*6:2*w<1?y:3*w<2?_+(y-_)*(2/3-w)*6:_}try{P0.parseCSSColor=function(_){var y,w=_.replace(/ /g,"").toLowerCase();if(w in c)return c[w].slice();if(w[0]==="#")return w.length===4?(y=parseInt(w.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:w.length===7&&(y=parseInt(w.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var S=w.indexOf("("),R=w.indexOf(")");if(S!==-1&&R+1===w.length){var O=w.substr(0,S),D=w.substr(S+1,R-(S+1)).split(","),z=1;switch(O){case"rgba":if(D.length!==4)return null;z=h(D.pop());case"rgb":return D.length!==3?null:[l(D[0]),l(D[1]),l(D[2]),z];case"hsla":if(D.length!==4)return null;z=h(D.pop());case"hsl":if(D.length!==3)return null;var V=(parseFloat(D[0])%360+360)%360/360,H=h(D[1]),K=h(D[2]),re=K<=.5?K*(H+1):K+H-K*H,ne=2*K-re;return[i(255*p(ne,re,V+1/3)),i(255*p(ne,re,V)),i(255*p(ne,re,V-1/3)),z];default:return null}}return null}}catch{}return P0}();class Yi{constructor(i,l,h,p=1){this.r=i,this.g=l,this.b=h,this.a=p}static parse(i){if(!i)return;if(i instanceof Yi)return i;if(typeof i!="string")return;const l=Pu.parseCSSColor(i);return l?new Yi(l[0]/255,l[1]/255,l[2]/255,l[3]):void 0}toString(){const[i,l,h,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*i)},${Math.round(255*l)},${Math.round(255*h)},${p})`}toNonPremultipliedRenderColor(i){const{r:l,g:h,b:p,a:_}=this;return new nE(i,l,h,p,_)}toPremultipliedRenderColor(i){const{r:l,g:h,b:p,a:_}=this;return new rE(i,l*_,h*_,p*_,_)}clone(){return new Yi(this.r,this.g,this.b,this.a)}}class tE{constructor(i,l,h,p,_,y=!1){if(this.premultiplied=!1,this.premultiplied=y,i){const w=i.image.height,S=w*w;this.premultiplied?(l=_===0?0:l/_*(w-1),h=_===0?0:h/_*(w-1),p=_===0?0:p/_*(w-1)):(l*=w-1,h*=w-1,p*=w-1);const R=Math.floor(l),O=Math.floor(h),D=Math.floor(p),z=Math.ceil(l),V=Math.ceil(h),H=Math.ceil(p),K=l-R,re=h-O,ne=p-D,ue=i.image.data,he=4*(R+O*S+D*w),ge=4*(R+O*S+H*w),ke=4*(R+V*S+D*w),Ee=4*(R+V*S+H*w),Me=4*(z+O*S+D*w),Be=4*(z+O*S+H*w),$e=4*(z+V*S+D*w),pt=4*(z+V*S+H*w);if(he<0||pt>=ue.length)throw new Error("out of range");this.r=br(br(br(ue[he],ue[ge],ne),br(ue[ke],ue[Ee],ne),re),br(br(ue[Me],ue[Be],ne),br(ue[$e],ue[pt],ne),re),K)/255*(this.premultiplied?_:1),this.g=br(br(br(ue[he+1],ue[ge+1],ne),br(ue[ke+1],ue[Ee+1],ne),re),br(br(ue[Me+1],ue[Be+1],ne),br(ue[$e+1],ue[pt+1],ne),re),K)/255*(this.premultiplied?_:1),this.b=br(br(br(ue[he+2],ue[ge+2],ne),br(ue[ke+2],ue[Ee+2],ne),re),br(br(ue[Me+2],ue[Be+2],ne),br(ue[$e+2],ue[pt+2],ne),re),K)/255*(this.premultiplied?_:1),this.a=_}else this.r=l,this.g=h,this.b=p,this.a=_}toArray(){const{r:i,g:l,b:h,a:p}=this;return[255*i,255*l,255*h,p]}toHslaArray(){let{r:i,g:l,b:h,a:p}=this;if(this.premultiplied){if(p===0)return[0,0,0,0];const H=1/p;i*=H,l*=H,h*=H}const _=Math.min(Math.max(i,0),1),y=Math.min(Math.max(l,0),1),w=Math.min(Math.max(h,0),1),S=Math.min(_,y,w),R=Math.max(_,y,w),O=R-S,D=.5*(S+R);if(O===0)return[0,0,100*D,p];const z=D>.5?O/(2-R-S):O/(R+S);let V;switch(R){case _:V=60*((y-w)/O+(y<w?6:0));break;case y:V=60*((w-_)/O+2);break;default:V=60*((_-y)/O+4)}return[V,100*z,100*D,p]}toArray01(){const{r:i,g:l,b:h,a:p}=this;return[i,l,h,p]}toArray01Scaled(i){const{r:l,g:h,b:p}=this;return[l*i,h*i,p*i]}toArray01Linear(){const{r:i,g:l,b:h,a:p}=this;return[Math.pow(i,2.2),Math.pow(l,2.2),Math.pow(h,2.2),p]}}class nE extends tE{constructor(i,l,h,p,_){super(i,l,h,p,_,!1)}}class rE extends tE{constructor(i,l,h,p,_){super(i,l,h,p,_,!0)}}function br(c,i,l){return c*(1-l)+i*l}function Ex(c,i,l){return c.map((h,p)=>br(h,i[p],l))}Yi.black=new Yi(0,0,0,1),Yi.white=new Yi(1,1,1,1),Yi.transparent=new Yi(0,0,0,0),Yi.red=new Yi(1,0,0,1),Yi.blue=new Yi(0,0,1,1);var O0=Object.freeze({__proto__:null,array:Ex,color:function(c,i,l){return new Yi(br(c.r,i.r,l),br(c.g,i.g,l),br(c.b,i.b,l),br(c.a,i.a,l))},number:br});class Ou extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class Cp{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[h,p]of l)this.bindings[h]=p}concat(i){return new Cp(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const uc={kind:"null"},jn={kind:"number"},wi={kind:"string"},rs={kind:"boolean"},Cl={kind:"color"},Vc={kind:"object"},Xi={kind:"value"},$_={kind:"collator"},L0={kind:"formatted"},D0={kind:"resolvedImage"};function Xo(c,i){return{kind:"array",itemType:c,N:i}}function za(c){if(c.kind==="array"){const i=za(c.itemType);return typeof c.N=="number"?`array<${i}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${i}>`}return c.kind}const Ok=[uc,jn,wi,rs,Cl,L0,Vc,Xo(Xi),D0];function _h(c,i){if(i.kind==="error")return null;if(c.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!_h(c.itemType,i.itemType))&&(typeof c.N!="number"||c.N===i.N))return null}else{if(c.kind===i.kind)return null;if(c.kind==="value"){for(const l of Ok)if(!_h(l,i))return null}}return`Expected ${za(c)} but found ${za(i)} instead.`}function Sx(c,i){return i.some(l=>l.kind===c.kind)}function N0(c,i){return i.some(l=>l==="null"?c===null:l==="array"?Array.isArray(c):l==="object"?c&&!Array.isArray(c)&&typeof c=="object":l===typeof c)}function H_(c,i){return c.kind==="array"&&i.kind==="array"?c.N===i.N&&H_(c.itemType,i.itemType):c.kind===i.kind}class Ax{constructor(i,l,h){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class G_{constructor(i,l,h,p,_){this.text=i.normalize?i.normalize():i,this.image=l,this.scale=h,this.fontStack=p,this.textColor=_}}class pl{constructor(i){this.sections=i}static fromString(i){return new pl([new G_(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||!!i.image&&i.image.hasPrimary())}static factory(i){return i instanceof pl?i:pl.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const l of this.sections){if(l.image){const p=l.image.getPrimary().id.toString();i.push(["image",p]);continue}i.push(l.text);const h={};l.fontStack&&(h["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(h["font-scale"]=l.scale),l.textColor&&(h["text-color"]=["rgba"].concat(l.textColor.toNonPremultipliedRenderColor(null).toArray())),i.push(h)}return i}}class bd{constructor(i,l={}){this.id=ll.from(i),this.params=l.params,this.sx=l.sx||1,this.sy=l.sy||1}toString(){return JSON.stringify(this)}static parse(i){let l,h,p,_;try{({id:l,params:h,sx:p,sy:_}=JSON.parse(i)||{})}catch{return null}return l?new bd(l,{params:h,sx:p,sy:_}):null}scaleSelf(i,l=i){return this.sx*=i,this.sy*=l,this}}class ml{constructor(i,l,h,p,_=!1){this.primaryId=ll.from(i),this.primaryOptions=l,h&&(this.secondaryId=ll.from(h)),this.secondaryOptions=p,this.available=_}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new bd(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new bd(this.secondaryId,this.secondaryOptions):null}static from(i){return typeof i=="string"?ml.build({name:i}):i}static build(i,l,h,p){return!i||typeof i=="object"&&!("name"in i)?null:new ml(i,h,l,p)}}function Tf(c,i,l,h){return typeof c=="number"&&c>=0&&c<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof l=="number"&&l>=0&&l<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[c,i,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[c,i,l,h]:[c,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function kp(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Yi||c instanceof Ax||c instanceof pl||c instanceof ml)return!0;if(Array.isArray(c)){for(const i of c)if(!kp(i))return!1;return!0}if(typeof c=="object"){for(const i in c)if(!kp(c[i]))return!1;return!0}return!1}function po(c){if(c===null)return uc;if(typeof c=="string")return wi;if(typeof c=="boolean")return rs;if(typeof c=="number")return jn;if(c instanceof Yi)return Cl;if(c instanceof Ax)return $_;if(c instanceof pl)return L0;if(c instanceof ml)return D0;if(Array.isArray(c)){const i=c.length;let l;for(const h of c){const p=po(h);if(l){if(l===p)continue;l=Xi;break}l=p}return Xo(l||Xi,i)}return Vc}function Lu(c){const i=typeof c;return c===null?"":i==="string"||i==="number"||i==="boolean"?String(c):c instanceof pl||c instanceof ml||c instanceof Yi?c.toString():JSON.stringify(c)}class wd{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(i.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!kp(i[1]))return l.error("invalid value");const h=i[1];let p=po(h);const _=l.expectedType;return p.kind!=="array"||p.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(p=_),new wd(p,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Yi?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof pl?this.value.serialize():this.value}}class so{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const Cx={string:wi,number:jn,boolean:rs,object:Vc};class cc{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let h,p=1;const _=i[0];if(_==="array"){let w,S;if(i.length>2){const R=i[1];if(typeof R!="string"||!(R in Cx)||R==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);w=Cx[R],p++}else w=Xi;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);S=i[2],p++}h=Xo(w,S)}else h=Cx[_];const y=[];for(;p<i.length;p++){const w=l.parse(i[p],p,Xi);if(!w)return null;y.push(w)}return new cc(h,y)}evaluate(i){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(i);if(!_h(this.type,po(h)))return h;if(l===this.args.length-1)throw new so(`The expression ${JSON.stringify(this.args[l].serialize())} evaluated to ${za(po(h))} but was expected to be of type ${za(this.type)}.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,l=[i.kind];if(i.kind==="array"){const h=i.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){l.push(h.kind);const p=i.N;(typeof p=="number"||this.args.length>1)&&l.push(p)}}return l.concat(this.args.map(h=>h.serialize()))}}class $c{constructor(i){this.type=L0,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const h=i[1];if(!Array.isArray(h)&&typeof h=="object")return l.error("First argument must be an image or text section.");const p=[];let _=!1;for(let y=1;y<=i.length-1;++y){const w=i[y];if(_&&typeof w=="object"&&!Array.isArray(w)){_=!1;let S=null;if(w["font-scale"]&&(S=l.parseObjectValue(w["font-scale"],y,"font-scale",jn),!S))return null;let R=null;if(w["text-font"]&&(R=l.parseObjectValue(w["text-font"],y,"text-font",Xo(wi)),!R))return null;let O=null;if(w["text-color"]&&(O=l.parseObjectValue(w["text-color"],y,"text-color",Cl),!O))return null;const D=p[p.length-1];D.scale=S,D.font=R,D.textColor=O}else{const S=l.parse(i[y],y,Xi);if(!S)return null;const R=S.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:S,scale:null,font:null,textColor:null})}}return new $c(p)}evaluate(i){return new pl(this.sections.map(l=>{const h=l.content.evaluate(i);return H_(po(h),D0)?new G_("",h,null,null,null):new G_(Lu(h),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const l of this.sections){i.push(l.content.serialize());const h={};l.scale&&(h["font-scale"]=l.scale.serialize()),l.font&&(h["text-font"]=l.font.serialize()),l.textColor&&(h["text-color"]=l.textColor.serialize()),i.push(h)}return i}}class jr{constructor(i,l,h,p){this._imageWarnHistory={},this.type=D0,this.namePrimary=i,this.nameSecondary=l,h&&(this.paramsPrimary=h.params,this.iconsetIdPrimary=h.iconset?h.iconset.id:void 0),p&&(this.paramsSecondary=p.params,this.iconsetIdSecondary=p.iconset?p.iconset.id:void 0)}static parse(i,l){if(i.length<2)return l.error("Expected two or more arguments.");let h=1;const p=[];function _(){if(h<i.length){const w=l.parse(i[h],h++,wi);return w?(p.push({image:w,options:{}}),!0):(l.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function y(){if(h<i.length){const S=i[h];if((w=S)===null||typeof w!="object"||Array.isArray(w))return!0;const R=S.params,O=S.iconset,D=l.concat(h);if(!R&&!O)return h++,!0;if(R){if(typeof R!="object"||R.constructor!==Object)return D.error('Image options "params" should be an object'),!1;const z={},V=D.concat(void 0,"params");for(const H in R){if(!H)return V.error("Image parameter name should be non-empty"),!1;const K=V.concat(void 0,H).parse(R[H],void 0,Cl,void 0,{typeAnnotation:"coerce"});if(!K)return!1;z[H]=K}p[p.length-1].options.params=z}if(O){if(typeof O!="object"||O.constructor!==Object)return D.error('Image options "iconset" should be an object'),!1;if(!O.id)return D.error('Image options "iconset" should have an "id" property'),!1;p[p.length-1].options.iconset=O}return h++,!0}var w;return!0}for(let w=0;w<2;w++)if(!_()||!y())return;return new jr(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(i,l){const h={};if(l){for(const p in l)if(l[p])try{h[p]=l[p].evaluate(i)}catch{continue}if(Object.keys(h).length!==0)return{params:h}}}evaluate(i){const l={name:this.namePrimary.evaluate(i),iconsetId:this.iconsetIdPrimary},h=this.nameSecondary?{name:this.nameSecondary.evaluate(i),iconsetId:this.iconsetIdSecondary}:void 0,p=ml.build(l,h,this.paramsPrimary?this.evaluateParams(i,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(i,this.paramsSecondary):void 0);if(p&&i.availableImages){const _=p.getPrimary().id;if(p.available=i.availableImages.some(y=>ll.isEqual(y,_)),p.available){const y=p.getSecondary()?p.getSecondary().id:null;y&&(p.available=i.availableImages.some(w=>ll.isEqual(w,y)))}}return p}eachChild(i){if(i(this.namePrimary),this.paramsPrimary)for(const l in this.paramsPrimary)this.paramsPrimary[l]&&i(this.paramsPrimary[l]);if(this.nameSecondary&&(i(this.nameSecondary),this.paramsSecondary))for(const l in this.paramsSecondary)this.paramsSecondary[l]&&i(this.paramsSecondary[l])}outputDefined(){return!1}serializeOptions(i,l){const h={};if(l&&(h.iconset={id:l}),i){h.params={};for(const p in i)i[p]&&(h.params[p]=i[p].serialize())}return Object.keys(h).length>0?h:void 0}serialize(){const i=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const l=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);l&&i.push(l)}if(this.nameSecondary&&(i.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const l=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);l&&i.push(l)}return i}}function zn(c){return kr(c)?"string":Ip(c)?"number":W_(c)?"boolean":Array.isArray(c)?"array":c===null?"null":q_(c)?"object":typeof c}function q_(c){return c!=null&&!Array.isArray(c)&&typeof c!="function"&&!(c instanceof String||c instanceof Number||c instanceof Boolean)&&typeof c=="object"}function kr(c){return typeof c=="string"||c instanceof String}function Ip(c){return typeof c=="number"||c instanceof Number}function W_(c){return typeof c=="boolean"||c instanceof Boolean}const Cr={"to-boolean":rs,"to-color":Cl,"to-number":jn,"to-string":wi};class Hc{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const h=i[0],p=[];let _=uc;if(h==="to-array"){if(!Array.isArray(i[1]))return null;const y=i[1].length;if(l.expectedType){if(l.expectedType.kind!=="array")return l.error(`Expected ${l.expectedType.kind} but found array.`);_=Xo(l.expectedType.itemType,y)}else{if(!(y>0&&kp(i[1][0])))return null;_=Xo(po(i[1][0]),y)}for(let w=0;w<y;w++){const S=i[1][w];let R;if(Array.isArray(S))R=l.parse(S,void 0,_.itemType);else{const O=zn(S);if(O!==_.itemType.kind)return l.error(`Expected ${_.itemType.kind} but found ${O}.`);R=l.registry.literal.parse(["literal",S===void 0?null:S],l)}if(!R)return null;p.push(R)}}else{if((h==="to-boolean"||h==="to-string")&&i.length!==2)return l.error("Expected one argument.");_=Cr[h];for(let y=1;y<i.length;y++){const w=l.parse(i[y],y,Xi);if(!w)return null;p.push(w)}}return new Hc(_,p)}evaluate(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){let l,h;for(const p of this.args){if(l=p.evaluate(i),h=null,l instanceof Yi)return l;if(typeof l=="string"){const _=i.parseColor(l);if(_)return _}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Tf(l[0],l[1],l[2],l[3]),!h))return new Yi(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new so(h||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(const h of this.args){if(l=h.evaluate(i),l===null)return 0;const p=Number(l);if(!isNaN(p))return p}throw new so(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?pl.fromString(Lu(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?ml.build(Lu(this.args[0].evaluate(i))):this.type.kind==="array"?this.args.map(l=>l.evaluate(i)):Lu(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new $c([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new jr(this.args[0]).serialize();const i=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(l=>{i.push(l.serialize())}),i}}const kx=["Unknown","Point","LineString","Polygon"];class Z_{constructor(i,l,h){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=i,this.options=l,this.iconImageUseTheme=h}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?kx[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(i){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,l=this.featureDistanceData.scale,{x:h,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*l-i[0])+this.featureDistanceData.bearing[1]*(p*l-i[1])}return 0}parseColor(i){let l=this._parseColorCache[i];return l||(l=this._parseColorCache[i]=Yi.parse(i)),l}getConfig(i){return this.options?this.options.get(i):null}}class gl{constructor(i,l,h,p,_){this.name=i,this.type=l,this._evaluate=h,this.args=p,this._overloadIndex=_}evaluate(i){if(!this._evaluate){const l=gl.definitions[this.name];this._evaluate=Array.isArray(l)?l[2]:l.overloads[this._overloadIndex][1]}return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,l){const h=i[0],p=gl.definitions[h];if(!p)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(p)?p[0]:p.type,y=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=[];let S=null,R=-1;for(const[O,D]of y){if(Array.isArray(O)&&O.length!==i.length-1)continue;w.push(O),R++,S=new ay(l.registry,l.path,null,l.scope,void 0,l._scope,l.options,l.iconImageUseTheme);const z=[];let V=!1;for(let H=1;H<i.length;H++){const K=i[H],re=Array.isArray(O)?O[H-1]:O.type,ne=S.parse(K,1+z.length,re);if(!ne){V=!0;break}z.push(ne)}if(!V)if(Array.isArray(O)&&O.length!==z.length)S.error(`Expected ${O.length} arguments, but found ${z.length} instead.`);else{for(let H=0;H<z.length;H++){const K=Array.isArray(O)?O[H]:O.type,re=z[H];S.concat(H+1).checkSubtype(K,re.type)}if(S.errors.length===0)return new gl(h,_,D,z,R)}}if(w.length===1)l.errors.push(...S.errors);else{const O=(w.length?w:y.map(([z])=>z)).map(X_).join(" | "),D=[];for(let z=1;z<i.length;z++){const V=l.parse(i[z],1+D.length);if(!V)return null;D.push(za(V.type))}l.error(`Expected arguments of type ${O}, but found (${D.join(", ")}) instead.`)}return null}static register(i,l){gl.definitions=l;for(const h in l)i[h]=gl}}function X_(c){return Array.isArray(c)?`(${c.map(za).join(", ")})`:`(${za(c.type)}...)`}class wo{constructor(i,l,h){this.type=$_,this.locale=h,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(i.length!==2)return l.error("Expected one argument.");const h=i[1];if(typeof h!="object"||Array.isArray(h))return l.error("Collator options argument must be an object.");const p=h["case-sensitive"]===void 0?l.parse(!1,1,rs):l.parseObjectValue(h["case-sensitive"],1,"case-sensitive",rs);if(!p)return null;const _=h["diacritic-sensitive"]===void 0?l.parse(!1,1,rs):l.parseObjectValue(h["diacritic-sensitive"],1,"diacritic-sensitive",rs);if(!_)return null;let y=null;return h.locale&&(y=l.parseObjectValue(h.locale,1,"locale",wi),!y)?null:new wo(p,_,y)}evaluate(i){return new Ax(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function Y_(c,i,l=0,h=c.length-1,p=Ix){for(;h>l;){if(h-l>600){const S=h-l+1,R=i-l+1,O=Math.log(S),D=.5*Math.exp(2*O/3),z=.5*Math.sqrt(O*D*(S-D)/S)*(R-S/2<0?-1:1);Y_(c,i,Math.max(l,Math.floor(i-R*D/S+z)),Math.min(h,Math.floor(i+(S-R)*D/S+z)),p)}const _=c[i];let y=l,w=h;for(dc(c,l,i),p(c[h],_)>0&&dc(c,l,h);y<w;){for(dc(c,y,w),y++,w--;p(c[y],_)<0;)y++;for(;p(c[w],_)>0;)w--}p(c[l],_)===0?dc(c,l,w):(w++,dc(c,w,h)),w<=i&&(l=w+1),i<=w&&(h=w-1)}}function dc(c,i,l){const h=c[i];c[i]=c[l],c[l]=h}function Ix(c,i){return c<i?-1:c>i?1:0}function yh(c){let i=0;for(let l,h,p=0,_=c.length,y=_-1;p<_;y=p++)l=c[p],h=c[y],i+=(h.x-l.x)*(l.y+h.y);return i}function Du(c,i){c[0]=Math.min(c[0],i[0]),c[1]=Math.min(c[1],i[1]),c[2]=Math.max(c[2],i[0]),c[3]=Math.max(c[3],i[1])}function z0(c,i){return!(c[0]<=i[0]||c[2]>=i[2]||c[1]<=i[1]||c[3]>=i[3])}function Lk(c,i,l){const h=c[0]-i[0],p=c[1]-i[1],_=c[0]-l[0],y=c[1]-l[1];return h*y-_*p==0&&h*_<=0&&p*y<=0}function Rp(c,i,l=!1){let h=!1;for(let w=0,S=i.length;w<S;w++){const R=i[w];for(let O=0,D=R.length,z=D-1;O<D;z=O++){const V=R[z],H=R[O];if(Lk(c,V,H))return l;(_=V)[1]>(p=c)[1]!=(y=H)[1]>p[1]&&p[0]<(y[0]-_[0])*(p[1]-_[1])/(y[1]-_[1])+_[0]&&(h=!h)}}var p,_,y;return h}function F0(c,i,l,h){const p=h[0]-l[0],_=h[1]-l[1],y=(c[0]-l[0])*_-p*(c[1]-l[1]),w=(i[0]-l[0])*_-p*(i[1]-l[1]);return y>0&&w<0||y<0&&w>0}function B0(c,i,l,h){return(p=[h[0]-l[0],h[1]-l[1]])[0]*(_=[i[0]-c[0],i[1]-c[1]])[1]-p[1]*_[0]!=0&&!(!F0(c,i,l,h)||!F0(l,h,c,i));var p,_}function Td(c){const i=new Ve(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),l=new Ve(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const h of c[0])i.x>h.x&&(i.x=h.x),i.y>h.y&&(i.y=h.y),l.x<h.x&&(l.x=h.x),l.y<h.y&&(l.y=h.y);return{min:i,max:l}}const vh=8192;function Dk(c,i){const l=(180+c[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,p=Math.pow(2,i.z);return[Math.round(l*p*vh),Math.round(h*p*vh)]}function Rx(c,i){for(let l=0;l<i.length;l++)if(Rp(c,i[l]))return!0;return!1}function Nk(c,i,l){for(const h of l)for(let p=0,_=h.length,y=_-1;p<_;y=p++)if(B0(c,i,h[y],h[p]))return!0;return!1}function iE(c,i){for(let l=0;l<c.length;++l)if(!Rp(c[l],i))return!1;for(let l=0;l<c.length-1;++l)if(Nk(c[l],c[l+1],i))return!1;return!0}function sE(c,i){for(let l=0;l<i.length;l++)if(iE(c,i[l]))return!0;return!1}function Mx(c,i,l){const h=[];for(let p=0;p<c.length;p++){const _=[];for(let y=0;y<c[p].length;y++){const w=Dk(c[p][y],l);Du(i,w),_.push(w)}h.push(_)}return h}function xh(c,i,l){const h=[];for(let p=0;p<c.length;p++){const _=Mx(c[p],i,l);h.push(_)}return h}function aE(c,i,l,h){if(c[0]<l[0]||c[0]>l[2]){const p=.5*h;let _=c[0]-l[0]>p?-h:l[0]-c[0]>p?h:0;_===0&&(_=c[0]-l[2]>p?-h:l[2]-c[0]>p?h:0),c[0]+=_}Du(i,c)}function oE(c,i,l,h){const p=Math.pow(2,h.z)*vh,_=[h.x*vh,h.y*vh],y=[];if(!c)return y;for(const w of c)for(const S of w){const R=[S.x+_[0],S.y+_[1]];aE(R,i,l,p),y.push(R)}return y}function K_(c,i,l,h){const p=Math.pow(2,h.z)*vh,_=[h.x*vh,h.y*vh],y=[];if(!c)return y;for(const S of c){const R=[];for(const O of S){const D=[O.x+_[0],O.y+_[1]];Du(i,D),R.push(D)}y.push(R)}if(i[2]-i[0]<=p/2){(w=i)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const S of y)for(const R of S)aE(R,i,l,p)}var w;return y}class bh{constructor(i,l){this.type=rs,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(kp(i[1])){const h=i[1];if(h.type==="FeatureCollection")for(let p=0;p<h.features.length;++p){const _=h.features[p].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new bh(h,h.features[p].geometry)}else if(h.type==="Feature"){const p=h.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new bh(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new bh(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(l,h){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if(h.type==="Polygon"){const w=Mx(h.coordinates,_,y),S=oE(l.geometry(),p,_,y);if(!z0(p,_))return!1;for(const R of S)if(!Rp(R,w))return!1}if(h.type==="MultiPolygon"){const w=xh(h.coordinates,_,y),S=oE(l.geometry(),p,_,y);if(!z0(p,_))return!1;for(const R of S)if(!Rx(R,w))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(l,h){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if(h.type==="Polygon"){const w=Mx(h.coordinates,_,y),S=K_(l.geometry(),p,_,y);if(!z0(p,_))return!1;for(const R of S)if(!iE(R,w))return!1}if(h.type==="MultiPolygon"){const w=xh(h.coordinates,_,y),S=K_(l.geometry(),p,_,y);if(!z0(p,_))return!1;for(const R of S)if(!sE(R,w))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const j0={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Nu=1/298.257223563,lE=Nu*(2-Nu),Mp=Math.PI/180;class Pp{static fromTile(i,l,h){const p=Math.PI*(1-2*(i+.5)/Math.pow(2,l)),_=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/Mp;return new Pp(_,h)}static get units(){return j0}constructor(i,l){if(i===void 0)throw new Error("No latitude given.");if(l&&!j0[l])throw new Error(`Unknown unit ${l}. Use one of: ${Object.keys(j0).join(", ")}`);const h=6378.137*Mp*(l?j0[l]:1),p=Math.cos(i*Mp),_=1/(1-lE*(1-p*p)),y=Math.sqrt(_);this.kx=h*y*p,this.ky=h*y*_*(1-lE)}distance(i,l){const h=lu(i[0]-l[0])*this.kx,p=(i[1]-l[1])*this.ky;return Math.sqrt(h*h+p*p)}bearing(i,l){const h=lu(l[0]-i[0])*this.kx;return Math.atan2(h,(l[1]-i[1])*this.ky)/Mp}destination(i,l,h){const p=h*Mp;return this.offset(i,Math.sin(p)*l,Math.cos(p)*l)}offset(i,l,h){return[i[0]+l/this.kx,i[1]+h/this.ky]}lineDistance(i){let l=0;for(let h=0;h<i.length-1;h++)l+=this.distance(i[h],i[h+1]);return l}area(i){let l=0;for(let h=0;h<i.length;h++){const p=i[h];for(let _=0,y=p.length,w=y-1;_<y;w=_++)l+=lu(p[_][0]-p[w][0])*(p[_][1]+p[w][1])*(h?-1:1)}return Math.abs(l)/2*this.kx*this.ky}along(i,l){let h=0;if(l<=0)return i[0];for(let p=0;p<i.length-1;p++){const _=i[p],y=i[p+1],w=this.distance(_,y);if(h+=w,h>l)return Q_(_,y,(l-(h-w))/w)}return i[i.length-1]}pointToSegmentDistance(i,l,h){let[p,_]=l,y=lu(h[0]-p)*this.kx,w=(h[1]-_)*this.ky;if(y!==0||w!==0){const S=(lu(i[0]-p)*this.kx*y+(i[1]-_)*this.ky*w)/(y*y+w*w);S>1?(p=h[0],_=h[1]):S>0&&(p+=y/this.kx*S,_+=w/this.ky*S)}return y=lu(i[0]-p)*this.kx,w=(i[1]-_)*this.ky,Math.sqrt(y*y+w*w)}pointOnLine(i,l){let h=1/0,p=i[0][0],_=i[0][1],y=0,w=0;for(let S=0;S<i.length-1;S++){let R=i[S][0],O=i[S][1],D=lu(i[S+1][0]-R)*this.kx,z=(i[S+1][1]-O)*this.ky,V=0;D===0&&z===0||(V=(lu(l[0]-R)*this.kx*D+(l[1]-O)*this.ky*z)/(D*D+z*z),V>1?(R=i[S+1][0],O=i[S+1][1]):V>0&&(R+=D/this.kx*V,O+=z/this.ky*V)),D=lu(l[0]-R)*this.kx,z=(l[1]-O)*this.ky;const H=D*D+z*z;H<h&&(h=H,p=R,_=O,y=S,w=V)}return{point:[p,_],index:y,t:Math.max(0,Math.min(1,w))}}lineSlice(i,l,h){let p=this.pointOnLine(h,i),_=this.pointOnLine(h,l);if(p.index>_.index||p.index===_.index&&p.t>_.t){const R=p;p=_,_=R}const y=[p.point],w=p.index+1,S=_.index;!Px(h[w],y[0])&&w<=S&&y.push(h[w]);for(let R=w+1;R<=S;R++)y.push(h[R]);return Px(h[S],_.point)||y.push(_.point),y}lineSliceAlong(i,l,h){let p=0;const _=[];for(let y=0;y<h.length-1;y++){const w=h[y],S=h[y+1],R=this.distance(w,S);if(p+=R,p>i&&_.length===0&&_.push(Q_(w,S,(i-(p-R))/R)),p>=l)return _.push(Q_(w,S,(l-(p-R))/R)),_;p>i&&_.push(S)}return _}bufferPoint(i,l){const h=l/this.ky,p=l/this.kx;return[i[0]-p,i[1]-h,i[0]+p,i[1]+h]}bufferBBox(i,l){const h=l/this.ky,p=l/this.kx;return[i[0]-p,i[1]-h,i[2]+p,i[3]+h]}insideBBox(i,l){return lu(i[0]-l[0])>=0&&lu(i[0]-l[2])<=0&&i[1]>=l[1]&&i[1]<=l[3]}}function Px(c,i){return c[0]===i[0]&&c[1]===i[1]}function Q_(c,i,l){const h=lu(i[0]-c[0]);return[c[0]+h*l,c[1]+(i[1]-c[1])*l]}function lu(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class J_{constructor(i=[],l=(h,p)=>h<p?-1:h>p?1:0){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:h}=this,p=l[i];for(;i>0;){const _=i-1>>1,y=l[_];if(h(p,y)>=0)break;l[i]=y,i=_}l[i]=p}_down(i){const{data:l,compare:h}=this,p=this.length>>1,_=l[i];for(;i<p;){let y=1+(i<<1);const w=y+1;if(w<this.length&&h(l[w],l[y])<0&&(y=w),h(l[y],_)>=0)break;l[i]=l[y],i=y}l[i]=_}}var Qt=8192;function Ox(c,i){return i.dist-c.dist}const ey=100,ty=50;function Lx(c){const i=[1/0,1/0,-1/0,-1/0];if(i.length!==c.length)return!1;for(let l=0;l<i.length;l++)if(i[l]!==c[l])return!1;return!0}function U0(c){return c[1]-c[0]+1}function Gc(c,i){const l=c[1]>=c[0]&&c[1]<i;return l||console.warn("Distance Expression: Index is out of range"),l}function Dx(c,i){if(c[0]>c[1])return[null,null];const l=U0(c);if(i){if(l===2)return[c,null];const h=Math.floor(l/2);return[[c[0],c[0]+h],[c[0]+h,c[1]]]}{if(l===1)return[c,null];const h=Math.floor(l/2)-1;return[[c[0],c[0]+h],[c[0]+h+1,c[1]]]}}function Ef(c,i){const l=[1/0,1/0,-1/0,-1/0];if(!Gc(i,c.length))return l;for(let h=i[0];h<=i[1];++h)Du(l,c[h]);return l}function Sf(c){const i=[1/0,1/0,-1/0,-1/0];for(let l=0;l<c.length;++l)for(let h=0;h<c[l].length;++h)Du(i,c[l][h]);return i}function wh(c,i,l){if(Lx(c)||Lx(i))return NaN;let h=0,p=0;return c[2]<i[0]&&(h=i[0]-c[2]),c[0]>i[2]&&(h=c[0]-i[2]),c[1]>i[3]&&(p=c[1]-i[3]),c[3]<i[1]&&(p=i[1]-c[3]),l.distance([0,0],[h,p])}function ny(c){return 360*c-180}function uE(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function ry(c,i){const l=Math.pow(2,i.z),h=(c.y/Qt+i.y)/l;return[ny((c.x/Qt+i.x)/l),uE(h)]}function zk(c,i){const l=[];for(let h=0;h<c.length;++h)l.push(ry(c[h],i));return l}function cE(c,i,l){const h=l.pointOnLine(i,c).point;return l.distance(c,h)}function Nx(c,i,l,h,p){const _=l.slice(h[0],h[1]+1);let y=1/0;for(let w=i[0];w<=i[1];++w)if((y=Math.min(y,cE(c[w],_,p)))===0)return 0;return y}function Th(c,i,l,h,p){const _=Math.min(p.pointToSegmentDistance(c,l,h),p.pointToSegmentDistance(i,l,h)),y=Math.min(p.pointToSegmentDistance(l,c,i),p.pointToSegmentDistance(h,c,i));return Math.min(_,y)}function Ti(c,i,l,h,p){if(!Gc(i,c.length)||!Gc(h,l.length))return NaN;let _=1/0;for(let y=i[0];y<i[1];++y)for(let w=h[0];w<h[1];++w){if(B0(c[y],c[y+1],l[w],l[w+1]))return 0;_=Math.min(_,Th(c[y],c[y+1],l[w],l[w+1],p))}return _}function Fk(c,i,l,h,p){if(!Gc(i,c.length)||!Gc(h,l.length))return NaN;let _=1/0;for(let y=i[0];y<=i[1];++y)for(let w=h[0];w<=h[1];++w)if((_=Math.min(_,p.distance(c[y],l[w])))===0)return _;return _}function Bk(c,i,l){if(Rp(c,i,!0))return 0;let h=1/0;for(const p of i){const _=p.length;if(_<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[_-1]&&(h=Math.min(h,l.pointToSegmentDistance(c,p[_-1],p[0])))===0||(h=Math.min(h,cE(c,p,l)))===0)return h}return h}function jk(c,i,l,h){if(!Gc(i,c.length))return NaN;for(let _=i[0];_<=i[1];++_)if(Rp(c[_],l,!0))return 0;let p=1/0;for(let _=i[0];_<i[1];++_)for(const y of l)for(let w=0,S=y.length,R=S-1;w<S;R=w++){if(B0(c[_],c[_+1],y[R],y[w]))return 0;p=Math.min(p,Th(c[_],c[_+1],y[R],y[w],h))}return p}function zx(c,i){for(const l of c)for(let h=0;h<=l.length-1;++h)if(Rp(l[h],i,!0))return!0;return!1}function Uk(c,i,l,h=1/0){const p=Sf(c),_=Sf(i);if(h!==1/0&&wh(p,_,l)>=h)return h;if(z0(p,_)){if(zx(c,i))return 0}else if(zx(i,c))return 0;let y=h;for(const w of c)for(let S=0,R=w.length,O=R-1;S<R;O=S++)for(const D of i)for(let z=0,V=D.length,H=V-1;z<V;H=z++){if(B0(w[O],w[S],D[H],D[z]))return 0;y=Math.min(y,Th(w[O],w[S],D[H],D[z],l))}return y}function Ks(c,i,l,h,p,_,y){if(_===null||y===null)return;const w=wh(Ef(h,_),Ef(p,y),l);w<i&&c.push({dist:w,range1:_,range2:y})}function Vk(c,i,l,h,p=1/0){let _=Math.min(h.distance(c[0],l[0][0]),p);if(_===0)return _;const y=new J_([{dist:0,range1:[0,c.length-1],range2:[0,0]}],Ox),w=i?ty:ey,S=Sf(l);for(;y.length;){const R=y.pop();if(R.dist>=_)continue;const O=R.range1;if(U0(O)<=w){if(!Gc(O,c.length))return NaN;if(i){const D=jk(c,O,l,h);if((_=Math.min(_,D))===0)return _}else for(let D=O[0];D<=O[1];++D){const z=Bk(c[D],l,h);if((_=Math.min(_,z))===0)return _}}else{const D=Dx(O,i);if(D[0]!==null){const z=wh(Ef(c,D[0]),S,h);z<_&&y.push({dist:z,range1:D[0],range2:[0,0]})}if(D[1]!==null){const z=wh(Ef(c,D[1]),S,h);z<_&&y.push({dist:z,range1:D[1],range2:[0,0]})}}}return _}function dE(c,i,l,h,p,_=1/0){let y=Math.min(_,p.distance(c[0],l[0]));if(y===0)return y;const w=new J_([{dist:0,range1:[0,c.length-1],range2:[0,l.length-1]}],Ox),S=i?ty:ey,R=h?ty:ey;for(;w.length;){const O=w.pop();if(O.dist>=y)continue;const D=O.range1,z=O.range2;if(U0(D)<=S&&U0(z)<=R){if(!Gc(D,c.length)||!Gc(z,l.length))return NaN;if(i&&h?y=Math.min(y,Ti(c,D,l,z,p)):i||h?i&&!h?y=Math.min(y,Nx(l,z,c,D,p)):!i&&h&&(y=Math.min(y,Nx(c,D,l,z,p))):y=Math.min(y,Fk(c,D,l,z,p)),y===0)return y}else{const V=Dx(D,i),H=Dx(z,h);Ks(w,y,p,c,l,V[0],H[0]),Ks(w,y,p,c,l,V[0],H[1]),Ks(w,y,p,c,l,V[1],H[0]),Ks(w,y,p,c,l,V[1],H[1])}}return y}function Fx(c,i,l,h,p=1/0){let _=p;const y=Ef(c,[0,c.length-1]);for(const w of l)if(!(_!==1/0&&wh(y,Ef(w,[0,w.length-1]),h)>=_)&&(_=Math.min(_,dE(c,i,w,!0,h,_)),_===0))return _;return _}function iy(c,i,l,h,p=1/0){let _=p;const y=Ef(c,[0,c.length-1]);for(const w of l){if(_!==1/0&&wh(y,Sf(w),h)>=_)continue;const S=Vk(c,i,w,h,_);if(isNaN(S))return S;if((_=Math.min(_,S))===0)return _}return _}function Bx(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class Af{constructor(i,l){this.type=jn,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'distance' expression requires either one argument, but found ' ${i.length-1} instead.`);if(kp(i[1])){const h=i[1];if(h.type==="FeatureCollection"){for(let p=0;p<h.features.length;++p)if(Bx(h.features[p].geometry.type))return new Af(h,h.features[p].geometry)}else if(h.type==="Feature"){if(Bx(h.geometry.type))return new Af(h,h.geometry)}else if(Bx(h.type))return new Af(h,h)}return l.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(i){const l=i.geometry(),h=i.canonicalID();if(l!=null&&h!=null){if(i.geometryType()==="Point")return function(p,_,y){const w=[];for(const R of p)for(const O of R)w.push(ry(O,_));const S=new Pp(w[0][1],"meters");return y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString"?dE(w,!1,y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",S):y.type==="MultiLineString"?Fx(w,!1,y.coordinates,S):y.type==="Polygon"||y.type==="MultiPolygon"?iy(w,!1,y.type==="Polygon"?[y.coordinates]:y.coordinates,S):null}(l,h,this.geometries);if(i.geometryType()==="LineString")return function(p,_,y){const w=[];for(const R of p){const O=[];for(const D of R)O.push(ry(D,_));w.push(O)}const S=new Pp(w[0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return Fx(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",w,S);if(y.type==="MultiLineString"){let R=1/0;for(let O=0;O<y.coordinates.length;O++){const D=Fx(y.coordinates[O],!0,w,S,R);if(isNaN(D))return D;if((R=Math.min(R,D))===0)return R}return R}if(y.type==="Polygon"||y.type==="MultiPolygon"){let R=1/0;for(let O=0;O<w.length;O++){const D=iy(w[O],!0,y.type==="Polygon"?[y.coordinates]:y.coordinates,S,R);if(isNaN(D))return D;if((R=Math.min(R,D))===0)return R}return R}return null}(l,h,this.geometries);if(i.geometryType()==="Polygon")return function(p,_,y){const w=[];for(const R of function(O,D){const z=O.length;if(z<=1)return[O];const V=[];let H,K;for(let re=0;re<z;re++){const ne=yh(O[re]);ne!==0&&(O[re].area=Math.abs(ne),K===void 0&&(K=ne<0),K===ne<0?(H&&V.push(H),H=[O[re]]):H.push(O[re]))}return H&&V.push(H),V}(p)){const O=[];for(let D=0;D<R.length;++D)O.push(zk(R[D],_));w.push(O)}const S=new Pp(w[0][0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return iy(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",w,S);if(y.type==="MultiLineString"){let R=1/0;for(let O=0;O<y.coordinates.length;O++){const D=iy(y.coordinates[O],!0,w,S,R);if(isNaN(D))return D;if((R=Math.min(R,D))===0)return R}return R}return y.type==="Polygon"||y.type==="MultiPolygon"?function(R,O,D){let z=1/0;for(const V of R)for(const H of O){const K=Uk(V,H,D,z);if(isNaN(K))return K;if((z=Math.min(z,K))===0)return z}return z}(y.type==="Polygon"?[y.coordinates]:y.coordinates,w,S):null}(l,h,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Op(c){if(c instanceof gl&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof bh||c instanceof Af)return!1;if(c instanceof Dp)return c.featureConstant;let i=!0;return c.eachChild(l=>{i&&!Op(l)&&(i=!1)}),i}function V0(c){if(c instanceof gl&&c.name==="feature-state")return!1;let i=!0;return c.eachChild(l=>{i&&!V0(l)&&(i=!1)}),i}function Lp(c,i){if(c instanceof gl&&i.indexOf(c.name)>=0)return!1;let l=!0;return c.eachChild(h=>{l&&!Lp(h,i)&&(l=!1)}),l}function hE(c,i,l){return[c,i,l].filter(Boolean).join("")}function jx(c,i){switch(c){case"string":return Lu(i);case"number":return+i;case"boolean":return!!i;case"color":return Yi.parse(i);case"formatted":return pl.fromString(Lu(i));case"resolvedImage":return ml.build(Lu(i))}return i}function fE(c,i,l,h){return h!==void 0&&(c=h*Math.round(c/h)),i!==void 0&&c<i&&(c=i),l!==void 0&&c>l&&(c=l),c}class Dp{constructor(i,l,h,p=!1){this.type=i,this.key=l,this.scope=h,this.featureConstant=p}static parse(i,l){let h=l.expectedType;if(h==null&&(h=Xi),i.length<2||i.length>3)return l.error("Invalid number of arguments for 'config' expression.");const p=l.parse(i[1],1);if(!(p instanceof wd))return l.error("Key name of 'config' expression must be a string literal.");let _,y=!0;const w=Lu(p.value);if(i.length>=3){const S=l.parse(i[2],2);if(!(S instanceof wd))return l.error("Scope of 'config' expression must be a string literal.");_=Lu(S.value)}if(l.options){const S=hE(w,_,l._scope),R=l.options.get(S);R&&(y=Op(R.value||R.default))}return new Dp(h,w,_,y)}evaluate(i){const l=hE(this.key,this.scope,i.scope),h=i.getConfig(l);if(!h)return null;const{type:p,value:_,values:y,minValue:w,maxValue:S,stepValue:R}=h,O=h.default.evaluate(i);let D=O;if(_){const z=i.scope;i.scope=(z||"").split("").slice(1).join(""),D=_.evaluate(i),i.scope=z}return p&&(D=jx(p,D)),D===void 0||w===void 0&&S===void 0&&R===void 0||(typeof D=="number"?D=fE(D,w,S,R):Array.isArray(D)&&(D=D.map(z=>typeof z=="number"?fE(z,w,S,R):z))),_!==void 0&&D!==void 0&&y&&!y.includes(D)&&(D=O,p&&(D=jx(p,D))),(p&&p!==this.type||D!==void 0&&!H_(po(D),this.type))&&(D=jx(this.type.kind,D)),D}eachChild(){}outputDefined(){return!1}serialize(){const i=["config",this.key];return this.scope&&i.concat(this.scope),i}}class sy{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(i.length!==2||typeof i[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const h=i[1];return l.scope.has(h)?new sy(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ay{constructor(i,l=[],h,p=new Cp,_=[],y,w,S){this.registry=i,this.path=l,this.key=l.map(R=>typeof R=="string"?`['${R}']`:`[${R}]`).join(""),this.scope=p,this.errors=_,this.expectedType=h,this._scope=y,this.options=w,this.iconImageUseTheme=S}parse(i,l,h,p,_={}){return l||h?this.concat(l,null,h,p)._parse(i,_):this._parse(i,_)}parseObjectValue(i,l,h,p,_,y={}){return this.concat(l,h,p,_)._parse(i,y)}_parse(i,l){function h(p,_,y){return y==="assert"?new cc(_,[p]):y==="coerce"?new Hc(_,[p]):p}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof i[0]=="string"?this.registry[i[0]]:void 0;if(p){let _=p.parse(i,this);if(!_)return null;if(this.expectedType){const y=this.expectedType,w=_.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||w.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(y,w))return null}else _=h(_,y,l.typeAnnotation||"coerce");else _=h(_,y,l.typeAnnotation||"assert")}if(!(_ instanceof wd)&&_.type.kind!=="resolvedImage"&&Ux(_)){const y=new Z_(this._scope,this.options,this.iconImageUseTheme);try{_=new wd(_.type,_.evaluate(y))}catch(w){return this.error(w.message),null}}return _}return Hc.parse(["to-array",i],this)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,h,p){let _=typeof i=="number"?this.path.concat(i):this.path;_=typeof l=="string"?_.concat(l):_;const y=p?this.scope.concat(p):this.scope;return new ay(this.registry,_,h||null,y,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(i,...l){const h=`${this.key}${l.map(p=>`[${p}]`).join("")}`;this.errors.push(new Ou(h,i))}checkSubtype(i,l){const h=_h(i,l);return h&&this.error(h),h}}function Ux(c){if(c instanceof sy)return Ux(c.boundExpression);if(c instanceof gl&&c.name==="error"||c instanceof wo||c instanceof bh||c instanceof Af||c instanceof Dp)return!1;const i=c instanceof Hc||c instanceof cc;let l=!0;return c.eachChild(h=>{l=i?l&&Ux(h):l&&h instanceof wd}),!!l&&Op(c)&&Lp(c,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function oy(c,i){const l=c.length-1;let h,p,_=0,y=l,w=0;for(;_<=y;)if(w=Math.floor((_+y)/2),h=c[w],p=c[w+1],h<=i){if(w===l||i<p)return w;_=w+1}else{if(!(h>i))throw new so("Input is not a number.");y=w-1}return 0}class $0{constructor(i,l,h){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[p,_]of h)this.labels.push(p),this.outputs.push(_)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(i[1],1,jn);if(!h)return null;const p=[];let _=null;l.expectedType&&l.expectedType.kind!=="value"&&(_=l.expectedType);for(let y=1;y<i.length;y+=2){const w=y===1?-1/0:i[y],S=i[y+1],R=y,O=y+1;if(typeof w!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(p.length&&p[p.length-1][0]>=w)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const D=l.parse(S,O,_);if(!D)return null;_=_||D.type,p.push([w,D])}return new $0(_,h,p)}evaluate(i){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(i);const p=this.input.evaluate(i);if(p<=l[0])return h[0].evaluate(i);const _=l.length;return p>=l[_-1]?h[_-1].evaluate(i):h[oy(l,p)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&i.push(this.labels[l]),i.push(this.outputs[l].serialize());return i}}const pE=.95047,mE=1.08883,gE=4/29,Np=6/29,_E=3*Np*Np,$k=Np*Np*Np,Hk=Math.PI/180,Gk=180/Math.PI;function Vx(c){return c>$k?Math.pow(c,1/3):c/_E+gE}function $x(c){return c>Np?c*c*c:_E*(c-gE)}function Hx(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function Gx(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function yE(c){const i=Gx(c.r),l=Gx(c.g),h=Gx(c.b),p=Vx((.4124564*i+.3575761*l+.1804375*h)/pE),_=Vx((.2126729*i+.7151522*l+.072175*h)/1);return{l:116*_-16,a:500*(p-_),b:200*(_-Vx((.0193339*i+.119192*l+.9503041*h)/mE)),alpha:c.a}}function ly(c){let i=(c.l+16)/116,l=isNaN(c.a)?i:i+c.a/500,h=isNaN(c.b)?i:i-c.b/200;return i=1*$x(i),l=pE*$x(l),h=mE*$x(h),new Yi(Hx(3.2404542*l-1.5371385*i-.4985314*h),Hx(-.969266*l+1.8760108*i+.041556*h),Hx(.0556434*l-.2040259*i+1.0572252*h),c.alpha)}function uy(c,i,l){const h=i-c;return c+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const zp={forward:yE,reverse:ly,interpolate:function(c,i,l){return{l:br(c.l,i.l,l),a:br(c.a,i.a,l),b:br(c.b,i.b,l),alpha:br(c.alpha,i.alpha,l)}}},H0={forward:function(c){const{l:i,a:l,b:h}=yE(c),p=Math.atan2(h,l)*Gk;return{h:p<0?p+360:p,c:Math.sqrt(l*l+h*h),l:i,alpha:c.a}},reverse:function(c){const i=c.h*Hk,l=c.c;return ly({l:c.l,a:Math.cos(i)*l,b:Math.sin(i)*l,alpha:c.alpha})},interpolate:function(c,i,l){return{h:uy(c.h,i.h,l),c:br(c.c,i.c,l),l:br(c.l,i.l,l),alpha:br(c.alpha,i.alpha,l)}}};var vE=Object.freeze({__proto__:null,hcl:H0,lab:zp});class uu{constructor(i,l,h,p,_){this.type=i,this.operator=l,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(const[y,w]of _)this.labels.push(y),this.outputs.push(w)}static interpolationFactor(i,l,h,p){let _=0;if(i.name==="exponential")_=cy(l,i.base,h,p);else if(i.name==="linear")_=cy(l,1,h,p);else if(i.name==="cubic-bezier"){const y=i.controlPoints;_=new rr(y[0],y[1],y[2],y[3]).solve(cy(l,1,h,p))}return _}static parse(i,l){let[h,p,_,...y]=i;if(!Array.isArray(p)||p.length===0)return l.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const R=p[1];if(typeof R!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:R}}else{if(p[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const R=p.slice(1);if(R.length!==4||R.some(O=>typeof O!="number"||O<0||O>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:R}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length-1>3&&(i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(_=l.parse(_,2,jn),!_)return null;const w=[];let S=null;h==="interpolate-hcl"||h==="interpolate-lab"?S=Cl:l.expectedType&&l.expectedType.kind!=="value"&&(S=l.expectedType);for(let R=0;R<y.length;R+=2){const O=y[R],D=y[R+1],z=R+3,V=R+4;if(typeof O!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(w.length&&w[w.length-1][0]>=O)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const H=l.parse(D,V,S);if(!H)return null;S=S||H.type,w.push([O,H])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new uu(S,h,p,_,w):l.error(`Type ${za(S)} is not interpolatable.`)}evaluate(i){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(i);const p=this.input.evaluate(i);if(p<=l[0])return h[0].evaluate(i);const _=l.length;if(p>=l[_-1])return h[_-1].evaluate(i);const y=oy(l,p),w=uu.interpolationFactor(this.interpolation,p,l[y],l[y+1]),S=h[y].evaluate(i),R=h[y+1].evaluate(i);return this.operator==="interpolate"?O0[this.type.kind.toLowerCase()](S,R,w):this.operator==="interpolate-hcl"?H0.reverse(H0.interpolate(H0.forward(S),H0.forward(R),w)):zp.reverse(zp.interpolate(zp.forward(S),zp.forward(R),w))}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const l=[this.operator,i,this.input.serialize()];for(let h=0;h<this.labels.length;h++)l.push(this.labels[h],this.outputs[h].serialize());return l}}function cy(c,i,l,h){const p=h-l,_=c-l;return p===0?0:i===1?_/p:(Math.pow(i,_)-1)/(Math.pow(i,p)-1)}class G0{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let h=null;const p=l.expectedType;p&&p.kind!=="value"&&(h=p);const _=[];for(const w of i.slice(1)){const S=l.parse(w,1+_.length,h,void 0,{typeAnnotation:"omit"});if(!S)return null;h=h||S.type,_.push(S)}const y=p&&_.some(w=>_h(p,w.type));return new G0(y?Xi:h,_)}evaluate(i){let l,h=null,p=0;for(const _ of this.args){if(p++,h=_.evaluate(i),h&&h instanceof ml&&!h.available&&(l||(l=h),h=null,p===this.args.length))return l;if(h!==null)break}return h}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(l=>{i.push(l.serialize())}),i}}class Ed{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const h=[];for(let _=1;_<i.length-1;_+=2){const y=i[_];if(typeof y!="string")return l.error(`Expected string, but found ${typeof y} instead.`,_);if(/[^a-zA-Z0-9_]/.test(y))return l.error("Variable names must contain only alphanumeric characters or '_'.",_);const w=l.parse(i[_+1],_+1);if(!w)return null;h.push([y,w])}const p=l.parse(i[i.length-1],i.length-1,l.expectedType,h);return p?new Ed(h,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[l,h]of this.bindings)i.push(l,h.serialize());return i.push(this.result.serialize()),i}}class dy{constructor(i,l,h){this.type=i,this.index=l,this.input=h}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,jn),p=l.parse(i[2],2,Xo(l.expectedType||Xi));return h&&p?new dy(p.type.itemType,h,p):null}evaluate(i){const l=this.index.evaluate(i),h=this.input.evaluate(i);if(l<0)throw new so("Array index out of bounds: negative index");if(l>=h.length)throw new so("Array index out of bounds: index exceeds array size");if(l!==Math.floor(l))throw new so("Array index must be an integer. Use at-interpolated for fractional indices");return h[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class hy{constructor(i,l,h){this.type=i,this.index=l,this.input=h}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,jn),p=l.parse(i[2],2,Xo(l.expectedType||Xi));return h&&p?new hy(p.type.itemType,h,p):null}evaluate(i){const l=this.index.evaluate(i),h=this.input.evaluate(i);if(l<0)throw new so(`Array index out of bounds: ${l} < 0.`);if(l>h.length-1)throw new so(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l===Math.floor(l))return h[l];const p=Math.floor(l),_=Math.ceil(l),y=h[p],w=h[_];if(typeof y!="number"||typeof w!="number")throw new so(`Cannot interpolate between non-number values at index ${l}.`);const S=l-p;return y*(1-S)+w*S}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class qx{constructor(i,l){this.type=rs,this.needle=i,this.haystack=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,Xi),p=l.parse(i[2],2,Xi);return h&&p?Sx(h.type,[rs,wi,jn,uc,Xi])?new qx(h,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${za(h.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(h==null)return!1;if(!N0(l,["boolean","string","number","null"]))throw new so(`Expected first argument to be of type boolean, string, number or null, but found ${za(po(l))} instead.`);if(!N0(h,["string","array"]))throw new so(`Expected second argument to be of type array or string, but found ${za(po(h))} instead.`);return h.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Fp{constructor(i,l,h){this.type=jn,this.needle=i,this.haystack=l,this.fromIndex=h}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,Xi),p=l.parse(i[2],2,Xi);if(!h||!p)return null;if(!Sx(h.type,[rs,wi,jn,uc,Xi]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${za(h.type)} instead`);if(i.length===4){const _=l.parse(i[3],3,jn);return _?new Fp(h,p,_):null}return new Fp(h,p)}evaluate(i){const l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!N0(l,["boolean","string","number","null"]))throw new so(`Expected first argument to be of type boolean, string, number or null, but found ${za(po(l))} instead.`);if(!N0(h,["string","array"]))throw new so(`Expected second argument to be of type array or string, but found ${za(po(h))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(i);return h.indexOf(l,p)}return h.indexOf(l)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class q0{constructor(i,l,h,p,_,y){this.inputType=i,this.type=l,this.input=h,this.cases=p,this.outputs=_,this.otherwise=y}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let h,p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);const _={},y=[];for(let R=2;R<i.length-1;R+=2){let O=i[R];const D=i[R+1];Array.isArray(O)||(O=[O]);const z=l.concat(R);if(O.length===0)return z.error("Expected at least one branch label.");for(const H of O){if(typeof H!="number"&&typeof H!="string")return z.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return z.error("Numeric branch labels must be integer values.");if(h){if(z.checkSubtype(h,po(H)))return null}else h=po(H);if(_[String(H)]!==void 0)return z.error("Branch labels must be unique.");_[String(H)]=y.length}const V=l.parse(D,R,p);if(!V)return null;p=p||V.type,y.push(V)}const w=l.parse(i[1],1,Xi);if(!w)return null;const S=l.parse(i[i.length-1],i.length-1,p);return S?w.type.kind!=="value"&&l.concat(1).checkSubtype(h,w.type)?null:new q0(h,p,w,_,y,S):null}evaluate(i){const l=this.input.evaluate(i);return(H_(po(l),this.inputType)&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),h=[],p={};for(const y of l){const w=p[this.cases[y]];w===void 0?(p[this.cases[y]]=h.length,h.push([this.cases[y],[y]])):h[w][1].push(y)}const _=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,w]of h)i.push(w.length===1?_(w[0]):w.map(_)),i.push(this.outputs[y].serialize());return i.push(this.otherwise.serialize()),i}}class W0{constructor(i,l,h){this.type=i,this.branches=l,this.otherwise=h}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&l.expectedType.kind!=="value"&&(h=l.expectedType);const p=[];for(let y=1;y<i.length-1;y+=2){const w=l.parse(i[y],y,rs);if(!w)return null;const S=l.parse(i[y+1],y+1,h);if(!S)return null;p.push([w,S]),h=h||S.type}const _=l.parse(i[i.length-1],i.length-1,h);return _?new W0(h,p,_):null}evaluate(i){for(const[l,h]of this.branches)if(l.evaluate(i))return h.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,h]of this.branches)i(l),i(h);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(l=>{i.push(l.serialize())}),i}}class fy{constructor(i,l,h,p){this.type=i,this.input=l,this.beginIndex=h,this.endIndex=p}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,Xi),p=l.parse(i[2],2,jn);if(!h||!p)return null;if(!Sx(h.type,[Xo(Xi),wi,Xi]))return l.error(`Expected first argument to be of type array or string, but found ${za(h.type)} instead`);if(i.length===4){const _=l.parse(i[3],3,jn);return _?new fy(h.type,h,p,_):null}return new fy(h.type,h,p)}evaluate(i){const l=this.input.evaluate(i),h=this.beginIndex.evaluate(i);if(!N0(l,["string","array"]))throw new so(`Expected first argument to be of type array or string, but found ${za(po(l))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(i);return l.slice(h,p)}return l.slice(h)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Wx{constructor(i,l){this.type=Xo(wi),this.str=i,this.delimiter=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,wi),p=l.parse(i[2],2,wi);return h&&p?new Wx(h,p):void 0}evaluate(i){const l=this.str.evaluate(i),h=this.delimiter.evaluate(i);return l.split(h)}eachChild(i){i(this.str),i(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Zx(c,i){return c==="=="||c==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function Xx(c,i,l,h){return h.compare(i,l)===0}function Bp(c,i,l){const h=c!=="=="&&c!=="!=";return class Xne{constructor(_,y,w){this.type=rs,this.lhs=_,this.rhs=y,this.collator=w,this.hasUntypedArgument=_.type.kind==="value"||y.type.kind==="value"}static parse(_,y){if(_.length!==3&&_.length!==4)return y.error("Expected two or three arguments.");const w=_[0];let S=y.parse(_[1],1,Xi);if(!S)return null;if(!Zx(w,S.type))return y.concat(1).error(`"${w}" comparisons are not supported for type '${za(S.type)}'.`);let R=y.parse(_[2],2,Xi);if(!R)return null;if(!Zx(w,R.type))return y.concat(2).error(`"${w}" comparisons are not supported for type '${za(R.type)}'.`);if(S.type.kind!==R.type.kind&&S.type.kind!=="value"&&R.type.kind!=="value")return y.error(`Cannot compare types '${za(S.type)}' and '${za(R.type)}'.`);h&&(S.type.kind==="value"&&R.type.kind!=="value"?S=new cc(R.type,[S]):S.type.kind!=="value"&&R.type.kind==="value"&&(R=new cc(S.type,[R])));let O=null;if(_.length===4){if(S.type.kind!=="string"&&R.type.kind!=="string"&&S.type.kind!=="value"&&R.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(O=y.parse(_[3],3,$_),!O)return null}return new Xne(S,R,O)}evaluate(_){const y=this.lhs.evaluate(_),w=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){const S=po(y),R=po(w);if(S.kind!==R.kind||S.kind!=="string"&&S.kind!=="number")throw new so(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${S.kind}, ${R.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const S=po(y),R=po(w);if(S.kind!=="string"||R.kind!=="string")return i(_,y,w)}return this.collator?l(_,y,w,this.collator.evaluate(_)):i(_,y,w)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[c];return this.eachChild(y=>{_.push(y.serialize())}),_}}}const qk=Bp("==",function(c,i,l){return i===l},Xx),Wk=Bp("!=",function(c,i,l){return i!==l},function(c,i,l,h){return!Xx(0,i,l,h)}),xE=Bp("<",function(c,i,l){return i<l},function(c,i,l,h){return h.compare(i,l)<0}),bE=Bp(">",function(c,i,l){return i>l},function(c,i,l,h){return h.compare(i,l)>0}),py=Bp("<=",function(c,i,l){return i<=l},function(c,i,l,h){return h.compare(i,l)<=0}),Zk=Bp(">=",function(c,i,l){return i>=l},function(c,i,l,h){return h.compare(i,l)>=0});class my{constructor(i,l,h,p,_,y){this.type=wi,this.number=i,this.locale=l,this.currency=h,this.unit=p,this.minFractionDigits=_,this.maxFractionDigits=y}static parse(i,l){if(i.length!==3)return l.error("Expected two arguments.");const h=l.parse(i[1],1,jn);if(!h)return null;const p=i[2];if(typeof p!="object"||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let _=null;if(p.locale&&(_=l.parseObjectValue(p.locale,2,"locale",wi),!_))return null;let y=null;if(p.currency&&(y=l.parseObjectValue(p.currency,2,"currency",wi),!y))return null;let w=null;if(p.unit&&(w=l.parseObjectValue(p.unit,2,"unit",wi),!w))return null;let S=null;if(p["min-fraction-digits"]&&(S=l.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",jn),!S))return null;let R=null;return p["max-fraction-digits"]&&(R=l.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",jn),!R)?null:new my(h,_,y,w,S,R)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Yx{constructor(i){this.type=jn,this.input=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const h=l.parse(i[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${za(h.type)} instead.`):new Yx(h):null}evaluate(i){const l=this.input.evaluate(i);if(typeof l=="string"||Array.isArray(l))return l.length;throw new so(`Expected value to be of type string or array, but found ${za(po(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(l=>{i.push(l.serialize())}),i}}function wE(c){return function(){c=1831565813+(c|=0)|0;let i=Math.imul(c^c>>>15,1|c);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}}const jp={"==":qk,"!=":Wk,">":bE,"<":xE,">=":Zk,"<=":py,array:cc,at:dy,"at-interpolated":hy,boolean:cc,case:W0,coalesce:G0,collator:wo,format:$c,image:jr,in:qx,"index-of":Fp,interpolate:uu,"interpolate-hcl":uu,"interpolate-lab":uu,length:Yx,let:Ed,literal:wd,match:q0,number:cc,"number-format":my,object:cc,slice:fy,step:$0,string:cc,"to-boolean":Hc,"to-color":Hc,"to-number":Hc,"to-string":Hc,var:sy,within:bh,distance:Af,config:Dp,split:Wx};function Kx(c,[i,l,h,p]){i=i.evaluate(c),l=l.evaluate(c),h=h.evaluate(c);const _=p?p.evaluate(c):1,y=Tf(i,l,h,_);if(y)throw new so(y);return new Yi(i/255,l/255,h/255,_)}function Qx(c,[i,l,h,p]){i=i.evaluate(c),l=l.evaluate(c),h=h.evaluate(c);const _=p?p.evaluate(c):1,y=function(R,O,D,z){return typeof R=="number"&&R>=0&&R<=360?typeof O=="number"&&O>=0&&O<=100&&typeof D=="number"&&D>=0&&D<=100?z===void 0||typeof z=="number"&&z>=0&&z<=1?null:`Invalid hsla value [${[R,O,D,z].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof z=="number"?[R,O,D,z]:[R,O,D]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof z=="number"?[R,O,D,z]:[R,O,D]).join(", ")}]: 'h' must be between 0 and 360.`}(i,l,h,_);if(y)throw new so(y);const w=`hsla(${i}, ${l}%, ${h}%, ${_})`,S=Yi.parse(w);if(!S)throw new so(`Failed to parse HSLA color: ${w}`);return S}function TE(c,i){return c in i}function Jx(c,i){const l=i[c];return l===void 0?null:l}function Eh(c){return{type:c}}function Cf(c){if(c instanceof Dp)return new Set([c.key]);let i=new Set;return c.eachChild(l=>{i=new Set([...i,...Cf(l)])}),i}function gy(c){if(c instanceof gl&&c.name==="is-active-floor")return!0;let i=!1;return c.eachChild(l=>{!i&&gy(l)&&(i=!0)}),i}function EE(c){return{result:"success",value:c}}function Sh(c){return{result:"error",value:c}}function eb(c,i){return!!c&&!!c.parameters&&c.parameters.indexOf(i)>-1}function Z0(c){return c["property-type"]==="data-driven"}function SE(c){return eb(c.expression,"measure-light")}function AE(c){return eb(c.expression,"zoom")}function _y(c){return!!c.expression&&c.expression.interpolated}function yy(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function CE(c){return c}function kE(c,i){const l=i.type==="color",h=c.stops&&typeof c.stops[0][0]=="object",p=h||!(h||c.property!==void 0),_=c.type||(_y(i)?"exponential":"interval");if(l&&((c=Object.assign({},c)).stops&&(c.stops=c.stops.map(R=>[R[0],Yi.parse(R[1])])),c.default=Yi.parse(c.default?c.default:i.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!vE[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let y,w,S;if(_==="exponential")y=IE;else if(_==="interval")y=Yk;else if(_==="categorical"){y=Xk,w=Object.create(null);for(const R of c.stops)w[R[0]]=R[1];S=typeof c.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);y=RE}if(h){const R={},O=[];for(let V=0;V<c.stops.length;V++){const H=c.stops[V],K=H[0].zoom;R[K]===void 0&&(R[K]={zoom:K,type:c.type,property:c.property,default:c.default,stops:[]},O.push(K)),R[K].stops.push([H[0].value,H[1]])}const D=[];for(const V of O)D.push([R[V].zoom,kE(R[V],i)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:uu.interpolationFactor.bind(void 0,z),zoomStops:D.map(V=>V[0]),evaluate:({zoom:V},H)=>IE({stops:D,base:c.base},i,V).evaluate(V,H)}}if(p){const R=_==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:uu.interpolationFactor.bind(void 0,R),zoomStops:c.stops.map(O=>O[0]),evaluate:({zoom:O})=>y(c,i,O,w,S)}}return{kind:"source",evaluate(R,O){const D=O&&O.properties?O.properties[c.property]:void 0;return D===void 0?qc(c.default,i.default):y(c,i,D,w,S)}}}function qc(c,i,l){return c!==void 0?c:i!==void 0?i:l!==void 0?l:void 0}function Xk(c,i,l,h,p){return qc(typeof l===p?h[l]:void 0,c.default,i.default)}function Yk(c,i,l){if(!Ip(l))return qc(c.default,i.default);const h=c.stops.length;if(h===1||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[h-1][0])return c.stops[h-1][1];const p=oy(c.stops.map(_=>_[0]),l);return c.stops[p][1]}function IE(c,i,l){const h=c.base!==void 0?c.base:1;if(!Ip(l))return qc(c.default,i.default);const p=c.stops.length;if(p===1||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[p-1][0])return c.stops[p-1][1];const _=oy(c.stops.map(O=>O[0]),l),y=function(O,D,z,V){const H=V-z,K=O-z;return H===0?0:D===1?K/H:(Math.pow(D,K)-1)/(Math.pow(D,H)-1)}(l,h,c.stops[_][0],c.stops[_+1][0]),w=c.stops[_][1],S=c.stops[_+1][1];let R=O0[i.type]||CE;if(c.colorSpace&&c.colorSpace!=="rgb"){const O=vE[c.colorSpace];R=(D,z)=>O.reverse(O.interpolate(O.forward(D),O.forward(z),y))}return typeof w.evaluate=="function"?{evaluate(...O){const D=w.evaluate.apply(void 0,O),z=S.evaluate.apply(void 0,O);if(D!==void 0&&z!==void 0)return R(D,z,y)}}:R(w,S,y)}function RE(c,i,l){return i.type==="color"?l=Yi.parse(l):i.type==="formatted"?l=pl.fromString(l.toString()):i.type==="resolvedImage"?l=ml.build(l.toString()):zn(l)===i.type||i.type==="enum"&&i.values[l]||(l=void 0),qc(l,c.default,i.default)}gl.register(jp,{error:[{kind:"error"},[wi],(c,[i])=>{throw new so(i.evaluate(c))}],typeof:[wi,[Xi],(c,[i])=>za(po(i.evaluate(c)))],"to-rgba":[Xo(jn,4),[Cl],(c,[i])=>i.evaluate(c).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Xo(jn,4),[Cl],(c,[i])=>i.evaluate(c).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Cl,[jn,jn,jn],Kx],rgba:[Cl,[jn,jn,jn,jn],Kx],hsl:[Cl,[jn,jn,jn],Qx],hsla:[Cl,[jn,jn,jn,jn],Qx],has:{type:rs,overloads:[[[wi],(c,[i])=>TE(i.evaluate(c),c.properties())],[[wi,Vc],(c,[i,l])=>TE(i.evaluate(c),l.evaluate(c))]]},get:{type:Xi,overloads:[[[wi],(c,[i])=>Jx(i.evaluate(c),c.properties())],[[wi,Vc],(c,[i,l])=>Jx(i.evaluate(c),l.evaluate(c))]]},"feature-state":[Xi,[wi],(c,[i])=>Jx(i.evaluate(c),c.featureState||{})],properties:[Vc,[],c=>c.properties()],"geometry-type":[wi,[],c=>c.geometryType()],worldview:[wi,[],c=>c.globals.worldview||""],"is-active-floor":[rs,Eh(wi),(c,i)=>{if(!(c.globals.activeFloors&&c.globals.activeFloors.size>0))return!1;const l=c.globals.activeFloors;return i.some(h=>{const p=h.evaluate(c);return l.has(p)})}],id:[Xi,[],c=>c.id()],zoom:[jn,[],c=>c.globals.zoom],pitch:[jn,[],c=>c.globals.pitch||0],"distance-from-center":[jn,[],c=>c.distanceFromCenter()],"measure-light":[jn,[wi],(c,[i])=>c.measureLight(i.evaluate(c))],"heatmap-density":[jn,[],c=>c.globals.heatmapDensity||0],"line-progress":[jn,[],c=>c.globals.lineProgress||0],"raster-value":[jn,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[jn,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[jn,[],c=>c.globals.skyRadialProgress||0],accumulated:[Xi,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[jn,Eh(jn),(c,i)=>{let l=0;for(const h of i)l+=h.evaluate(c);return l}],"*":[jn,Eh(jn),(c,i)=>{let l=1;for(const h of i)l*=h.evaluate(c);return l}],"-":{type:jn,overloads:[[[jn,jn],(c,[i,l])=>i.evaluate(c)-l.evaluate(c)],[[jn],(c,[i])=>-i.evaluate(c)]]},"/":[jn,[jn,jn],(c,[i,l])=>i.evaluate(c)/l.evaluate(c)],"%":[jn,[jn,jn],(c,[i,l])=>i.evaluate(c)%l.evaluate(c)],ln2:[jn,[],()=>Math.LN2],pi:[jn,[],()=>Math.PI],e:[jn,[],()=>Math.E],"^":[jn,[jn,jn],(c,[i,l])=>Math.pow(i.evaluate(c),l.evaluate(c))],sqrt:[jn,[jn],(c,[i])=>Math.sqrt(i.evaluate(c))],log10:[jn,[jn],(c,[i])=>Math.log(i.evaluate(c))/Math.LN10],ln:[jn,[jn],(c,[i])=>Math.log(i.evaluate(c))],log2:[jn,[jn],(c,[i])=>Math.log2(i.evaluate(c))],sin:[jn,[jn],(c,[i])=>Math.sin(i.evaluate(c))],cos:[jn,[jn],(c,[i])=>Math.cos(i.evaluate(c))],tan:[jn,[jn],(c,[i])=>Math.tan(i.evaluate(c))],asin:[jn,[jn],(c,[i])=>Math.asin(i.evaluate(c))],acos:[jn,[jn],(c,[i])=>Math.acos(i.evaluate(c))],atan:[jn,[jn],(c,[i])=>Math.atan(i.evaluate(c))],min:[jn,Eh(jn),(c,i)=>Math.min(...i.map(l=>l.evaluate(c)))],max:[jn,Eh(jn),(c,i)=>Math.max(...i.map(l=>l.evaluate(c)))],abs:[jn,[jn],(c,[i])=>Math.abs(i.evaluate(c))],round:[jn,[jn],(c,[i])=>{const l=i.evaluate(c);return l<0?-Math.round(-l):Math.round(l)}],floor:[jn,[jn],(c,[i])=>Math.floor(i.evaluate(c))],ceil:[jn,[jn],(c,[i])=>Math.ceil(i.evaluate(c))],"filter-==":[rs,[wi,Xi],(c,[i,l])=>c.properties()[i.value]===l.value],"filter-id-==":[rs,[Xi],(c,[i])=>c.id()===i.value],"filter-type-==":[rs,[wi],(c,[i])=>c.geometryType()===i.value],"filter-<":[rs,[wi,Xi],(c,[i,l])=>{const h=c.properties()[i.value],p=l.value;return typeof h==typeof p&&h<p}],"filter-id-<":[rs,[Xi],(c,[i])=>{const l=c.id(),h=i.value;return typeof l==typeof h&&l<h}],"filter->":[rs,[wi,Xi],(c,[i,l])=>{const h=c.properties()[i.value],p=l.value;return typeof h==typeof p&&h>p}],"filter-id->":[rs,[Xi],(c,[i])=>{const l=c.id(),h=i.value;return typeof l==typeof h&&l>h}],"filter-<=":[rs,[wi,Xi],(c,[i,l])=>{const h=c.properties()[i.value],p=l.value;return typeof h==typeof p&&h<=p}],"filter-id-<=":[rs,[Xi],(c,[i])=>{const l=c.id(),h=i.value;return typeof l==typeof h&&l<=h}],"filter->=":[rs,[wi,Xi],(c,[i,l])=>{const h=c.properties()[i.value],p=l.value;return typeof h==typeof p&&h>=p}],"filter-id->=":[rs,[Xi],(c,[i])=>{const l=c.id(),h=i.value;return typeof l==typeof h&&l>=h}],"filter-has":[rs,[Xi],(c,[i])=>i.value in c.properties()],"filter-has-id":[rs,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[rs,[Xo(wi)],(c,[i])=>i.value.indexOf(c.geometryType())>=0],"filter-id-in":[rs,[Xo(Xi)],(c,[i])=>i.value.indexOf(c.id())>=0],"filter-in-small":[rs,[wi,Xo(Xi)],(c,[i,l])=>l.value.indexOf(c.properties()[i.value])>=0],"filter-in-large":[rs,[wi,Xo(Xi)],(c,[i,l])=>function(h,p,_,y){for(;_<=y;){const w=_+y>>1;if(p[w]===h)return!0;p[w]>h?y=w-1:_=w+1}return!1}(c.properties()[i.value],l.value,0,l.value.length-1)],all:{type:rs,overloads:[[[rs,rs],(c,[i,l])=>i.evaluate(c)&&l.evaluate(c)],[Eh(rs),(c,i)=>{for(const l of i)if(!l.evaluate(c))return!1;return!0}]]},any:{type:rs,overloads:[[[rs,rs],(c,[i,l])=>i.evaluate(c)||l.evaluate(c)],[Eh(rs),(c,i)=>{for(const l of i)if(l.evaluate(c))return!0;return!1}]]},"!":[rs,[rs],(c,[i])=>!i.evaluate(c)],"is-supported-script":[rs,[wi],(c,[i])=>{const l=c.globals&&c.globals.isSupportedScript;return!l||l(i.evaluate(c))}],upcase:[wi,[wi],(c,[i])=>i.evaluate(c).toUpperCase()],downcase:[wi,[wi],(c,[i])=>i.evaluate(c).toLowerCase()],concat:[wi,Eh(Xi),(c,i)=>i.map(l=>Lu(l.evaluate(c))).join("")],"resolved-locale":[wi,[$_],(c,[i])=>i.evaluate(c).resolvedLocale()],random:[jn,[jn,jn,Xi],(c,i)=>{const[l,h,p]=i.map(y=>y.evaluate(c));if(l>h||l===h)return l;let _;if(typeof p=="string")_=function(y){let w=0;if(y.length===0)return w;for(let S=0;S<y.length;S++)w=(w<<5)-w+y.charCodeAt(S),w|=0;return w}(p);else{if(typeof p!="number")throw new so(`Invalid seed input: ${p}`);_=p}return l+wE(_)()*(h-l)}]});class vy{constructor(i,l,h,p,_){this.expression=i,this._warningHistory={},this._scope=h,this._options=p,this._iconImageUseTheme=_,this._evaluator=new Z_(h,p,_),this._defaultValue=l?function(y){return y.type==="color"&&(yy(y.default)||Array.isArray(y.default))?new Yi(0,0,0,0):y.type==="color"?Yi.parse(y.default)||null:y.default===void 0?null:y.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null,this.configDependencies=Cf(i),this.isIndoorDependent=gy(i)}evaluateWithoutErrorHandling(i,l,h,p,_,y,w,S){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=p||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(i,l,h,p,_,y,w,S,R){this._evaluator||(this._evaluator=new Z_(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=S||null,this._evaluator.iconImageUseTheme=R||null;try{const O=this.expression.evaluate(this._evaluator);if(O==null||typeof O=="number"&&O!=O)return this._defaultValue;if(this._enumValues&&!(O in this._enumValues))throw new so(`Expected value to be one of ${Object.keys(this._enumValues).map(D=>JSON.stringify(D)).join(", ")}, but found ${JSON.stringify(O)} instead.`);return O}catch(O){const D=O;return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${D.message}`)),this._defaultValue}}}function X0(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in jp}function Ah(c,i,l,h,p){const _=new ay(jp,[],i?function(w){const S={color:Cl,string:wi,number:jn,enum:wi,boolean:rs,formatted:L0,resolvedImage:D0};return w.type==="array"?Xo(S[w.value]||Xi,w.length):S[w.type]}(i):void 0,void 0,void 0,l,h,p),y=_.parse(c,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?EE(new vy(y,i,l,h,p)):Sh(_.errors)}class Up{constructor(i,l,h,p){this.kind=i,this._styleExpression=l,this.isLightConstant=h,this.isLineProgressConstant=p,this.isStateDependent=i!=="constant"&&!V0(l.expression),this.configDependencies=Cf(l.expression),this.isIndoorDependent=gy(l.expression)}evaluateWithoutErrorHandling(i,l,h,p,_,y){return this._styleExpression.evaluateWithoutErrorHandling(i,l,h,p,_,y)}evaluate(i,l,h,p,_,y,w){return this._styleExpression.evaluate(i,l,h,p,_,y,void 0,void 0,w)}}class kf{constructor(i,l,h,p,_,y){this.kind=i,this.zoomStops=h,this._styleExpression=l,this.isStateDependent=i!=="camera"&&!V0(l.expression),this.isIndoorDependent=gy(l.expression),this.isLightConstant=_,this.isLineProgressConstant=y,this.configDependencies=Cf(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(i,l,h,p,_,y){return this._styleExpression.evaluateWithoutErrorHandling(i,l,h,p,_,y)}evaluate(i,l,h,p,_,y){return this._styleExpression.evaluate(i,l,h,p,_,y)}interpolationFactor(i,l,h){return this.interpolationType?uu.interpolationFactor(this.interpolationType,i,l,h):0}}function tb(c,i,l,h,p){if((c=Ah(c,i,l,h,p)).result==="error")return c;const _=c.value.expression,y=Op(_);if(!y&&!Z0(i))return Sh([new Ou("","data expressions not supported")]);const w=Lp(_,["zoom","pitch","distance-from-center"]);if(!w&&!AE(i))return Sh([new Ou("","zoom expressions not supported")]);const S=Lp(_,["measure-light"]);if(!S&&!SE(i))return Sh([new Ou("","measure-light expression not supported")]);const R=Lp(_,["line-progress"]);if(!R&&!function(z){return eb(z.expression,"line-progress")}(i))return Sh([new Ou("","line-progress expression not supported")]);const O=i.expression&&i.expression.relaxZoomRestriction,D=hc(_);return D||w||O?D instanceof Ou?Sh([D]):D instanceof uu&&!_y(i)?Sh([new Ou("",'"interpolate" expressions cannot be used with this property')]):EE(D?new kf(y&&R?"camera":"composite",c.value,D.labels,D instanceof uu?D.interpolation:void 0,S,R):new Up(y&&R?"constant":"source",c.value,S,R)):Sh([new Ou("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class xy{constructor(i,l){this._parameters=i,this._specification=l,Object.assign(this,kE(this._parameters,this._specification))}static deserialize(i){return new xy(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function hc(c){let i=null;if(c instanceof Ed)i=hc(c.result);else if(c instanceof G0){for(const l of c.args)if(i=hc(l),i)break}else(c instanceof $0||c instanceof uu)&&c.input instanceof gl&&c.input.name==="zoom"&&(i=c);return i instanceof Ou||c.eachChild(l=>{const h=hc(l);h instanceof Ou?i=h:i&&h&&i!==h&&(i=new Ou("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}var nb,ME,PE=function(){if(ME)return nb;ME=1,nb=i;var c=3;function i(l,h,p){var _=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;var y=new Int32Array(this.arrayBuffer);l=y[0],this.d=(h=y[1])+2*(p=y[2]);for(var w=0;w<this.d*this.d;w++){var S=y[c+w],R=y[c+w+1];_.push(S===R?null:y.subarray(S,R))}var O=y[c+_.length+1];this.keys=y.subarray(y[c+_.length],O),this.bboxes=y.subarray(O),this.insert=this._insertReadonly}else{this.d=h+2*p;for(var D=0;D<this.d*this.d;D++)_.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=l,this.padding=p,this.scale=h/l,this.uid=0;var z=p/h*l;this.min=-z,this.max=l+z}return i.prototype.insert=function(l,h,p,_,y){this._forEachCell(h,p,_,y,this._insertCell,this.uid++),this.keys.push(l),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(y)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(l,h,p,_,y,w){this.cells[y].push(w)},i.prototype.query=function(l,h,p,_,y){var w=this.min,S=this.max;if(l<=w&&h<=w&&S<=p&&S<=_&&!y)return Array.prototype.slice.call(this.keys);var R=[];return this._forEachCell(l,h,p,_,this._queryCell,R,{},y),R},i.prototype._queryCell=function(l,h,p,_,y,w,S,R){var O=this.cells[y];if(O!==null)for(var D=this.keys,z=this.bboxes,V=0;V<O.length;V++){var H=O[V];if(S[H]===void 0){var K=4*H;(R?R(z[K+0],z[K+1],z[K+2],z[K+3]):l<=z[K+2]&&h<=z[K+3]&&p>=z[K+0]&&_>=z[K+1])?(S[H]=!0,w.push(D[H])):S[H]=!1}}},i.prototype._forEachCell=function(l,h,p,_,y,w,S,R){for(var O=this._convertToCellCoord(l),D=this._convertToCellCoord(h),z=this._convertToCellCoord(p),V=this._convertToCellCoord(_),H=O;H<=z;H++)for(var K=D;K<=V;K++){var re=this.d*K+H;if((!R||R(this._convertFromCellCoord(H),this._convertFromCellCoord(K),this._convertFromCellCoord(H+1),this._convertFromCellCoord(K+1)))&&y.call(this,l,h,p,_,re,w,S,R))return}},i.prototype._convertFromCellCoord=function(l){return(l-this.padding)/this.scale},i.prototype._convertToCellCoord=function(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var l=this.cells,h=c+this.cells.length+1+1,p=0,_=0;_<this.cells.length;_++)p+=this.cells[_].length;var y=new Int32Array(h+p+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var w=h,S=0;S<l.length;S++){var R=l[S];y[c+S]=w,y.set(R,w),w+=R.length}return y[c+l.length]=w,y.set(this.keys,w),y[c+l.length+1]=w+=this.keys.length,y.set(this.bboxes,w),w+=this.bboxes.length,y.buffer},nb}(),Vp=Ys(PE);const If={};function An(c,i,l={}){Object.defineProperty(c,"_classRegistryKey",{value:i,writable:!1}),If[i]={klass:c,omit:l.omit||[]}}An(Object,"Object"),Vp.serialize=function(c,i){const l=c.toArrayBuffer();return i&&i.add(l),{buffer:l}},Vp.deserialize=function(c){return new Vp(c.buffer)},Object.defineProperty(Vp,"name",{value:"Grid"}),An(Vp,"Grid"),delete Ve.prototype.constructor,An(Yi,"Color"),An(Error,"Error"),An(pl,"Formatted"),An(G_,"FormattedSection"),An($l,"AJAXError"),An(ml,"ResolvedImage"),An(xy,"StylePropertyFunction"),An(vy,"StyleExpression",{omit:["_evaluator"]}),An(ll,"ImageId"),An(bd,"ImageVariant"),An(kf,"ZoomDependentExpression"),An(Up,"ZoomConstantExpression"),An(gl,"CompoundExpression",{omit:["_evaluate"]});for(const c in jp)If[jp[c]._classRegistryKey]||An(jp[c],`Expression${c}`);function Y0(c){return c&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function Sd(c,i){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(Y0(c)||c instanceof ImageBitmap)return i&&i.add(c),c;if(ArrayBuffer.isView(c))return i&&i.add(c.buffer),c;if(c instanceof ImageData)return i&&i.add(c.data.buffer),c;if(Array.isArray(c)){const l=[];for(const h of c)l.push(Sd(h,i));return l}if(c instanceof Map){const l={$name:"Map",entries:[]};for(const[h,p]of c.entries())l.entries.push(Sd(h),Sd(p,i));return l}if(c instanceof Set){const l={$name:"Set"};let h=0;for(const p of c.values())l[++h]=Sd(p);return l}if(typeof c=="bigint")return{$name:"BigInt",value:c.toString()};if(typeof c=="object"){const l=c.constructor,h=l._classRegistryKey;if(!h)throw new Error(`Can't serialize object of unregistered class "${l.name}".`);const p=l.serialize?l.serialize(c,i):{};if(!l.serialize){for(const _ in c)c.hasOwnProperty(_)&&(If[h].omit.indexOf(_)>=0||(p[_]=Sd(c[_],i)));c instanceof Error&&(p.message=c.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(p.$name=h),p}throw new Error("can't serialize object of type "+typeof c)}function Ch(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||Y0(c)||c instanceof ImageBitmap||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Ch);if(typeof c=="object"){const i=c.$name||"Object";if(i==="Map"){const p=c.entries||[],_=new Map;for(let y=0;y<p.length;y+=2)_.set(Ch(p[y]),Ch(p[y+1]));return _}if(i==="Set"){const p=new Set;for(const _ of Object.keys(c))_!=="$name"&&p.add(Ch(c[_]));return p}if(i==="BigInt")return BigInt(c.value);const{klass:l}=If[i];if(!l)throw new Error(`Can't deserialize unregistered class "${i}".`);if(l.deserialize)return l.deserialize(c);const h=Object.create(l.prototype);for(const p of Object.keys(c))p!=="$name"&&(h[p]=Ch(c[p]));return h}throw new Error("can't deserialize object of type "+typeof c)}const pr={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,Osage:c=>c>=66736&&c<=66815,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function K0(c){for(const i of c)if(by(i.charCodeAt(0)))return!0;return!1}function rb(c){for(const i of c)if(!OE(i.charCodeAt(0)))return!1;return!0}function OE(c){return!(pr.Arabic(c)||pr["Arabic Supplement"](c)||pr["Arabic Extended-A"](c)||pr["Arabic Presentation Forms-A"](c)||pr["Arabic Presentation Forms-B"](c))}function by(c){return!(c!==746&&c!==747&&(c<4352||!(pr["Bopomofo Extended"](c)||pr.Bopomofo(c)||pr["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||pr["CJK Compatibility Ideographs"](c)||pr["CJK Compatibility"](c)||pr["CJK Radicals Supplement"](c)||pr["CJK Strokes"](c)||!(!pr["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||pr["CJK Unified Ideographs Extension A"](c)||pr["CJK Unified Ideographs"](c)||pr["Enclosed CJK Letters and Months"](c)||pr["Hangul Compatibility Jamo"](c)||pr["Hangul Jamo Extended-A"](c)||pr["Hangul Jamo Extended-B"](c)||pr["Hangul Jamo"](c)||pr["Hangul Syllables"](c)||pr.Hiragana(c)||pr["Ideographic Description Characters"](c)||pr.Kanbun(c)||pr["Kangxi Radicals"](c)||pr["Katakana Phonetic Extensions"](c)||pr.Katakana(c)&&c!==12540||!(!pr["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!pr["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||pr["Unified Canadian Aboriginal Syllabics"](c)||pr["Unified Canadian Aboriginal Syllabics Extended"](c)||pr["Vertical Forms"](c)||pr["Yijing Hexagram Symbols"](c)||pr["Yi Syllables"](c)||pr["Yi Radicals"](c))))}function wy(c){return!(by(c)||function(i){return!!(pr["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||pr["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||pr["Letterlike Symbols"](i)||pr["Number Forms"](i)||pr["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||pr["Control Pictures"](i)&&i!==9251||pr["Optical Character Recognition"](i)||pr["Enclosed Alphanumerics"](i)||pr["Geometric Shapes"](i)||pr["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||pr["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||pr["CJK Symbols and Punctuation"](i)||pr.Katakana(i)||pr["Private Use Area"](i)||pr["CJK Compatibility Forms"](i)||pr["Small Form Variants"](i)||pr["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(c))}function Ty(c){return pr.Arabic(c)||pr["Arabic Supplement"](c)||pr["Arabic Extended-A"](c)||pr["Arabic Presentation Forms-A"](c)||pr["Arabic Presentation Forms-B"](c)}function ib(c){return c>=1424&&c<=2303||pr["Arabic Presentation Forms-A"](c)||pr["Arabic Presentation Forms-B"](c)}function Ad(c,i){return!(!i&&ib(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||pr.Khmer(c))}function Kk(c){for(const i of c)if(ib(i.charCodeAt(0)))return!0;return!1}const Hl={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let sb=null,_l=Hl.unavailable,Cd=null;const Q0=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(_l=Hl.error),sb&&sb(c)};function Ey(){Sy.fire(new Uc("pluginStateChange",{pluginStatus:_l,pluginURL:Cd}))}const Sy=new wf,J0=function(){return _l},LE=function(){if(_l!==Hl.deferred||!Cd)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_l=Hl.loading,Ey(),Cd&&xd({url:Cd},c=>{c?Q0(c):(_l=Hl.loaded,Ey())})},kd={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_l===Hl.loaded||kd.applyArabicShaping!=null,isLoading:()=>_l===Hl.loading,setState(c){_l=c.pluginStatus,Cd=c.pluginURL},isParsing:()=>_l===Hl.parsing,isParsed:()=>_l===Hl.parsed,getPluginURL:()=>Cd};class Rs{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch,this.brightness=l.brightness,this.worldview=l.worldview,this.activeFloors=l.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(i){return function(l,h){for(const p of l)if(!Ad(p.charCodeAt(0),h))return!1;return!0}(i,kd.isLoaded())}}class Ay{constructor(i,l,h,p,_){this.property=i,this.value=l,this.expression=function(y,w,S,R,O){if(yy(y))return new xy(y,w);if(X0(y)||Array.isArray(y)&&y.length>0){const D=tb(y,w,S,R,O);if(D.result==="error")throw new Error(D.value.map(z=>`${z.key}: ${z.message}`).join(", "));return D.value}{let D=y;return typeof y=="string"&&w.type==="color"&&(D=Yi.parse(y)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>D}}}(l===void 0?i.specification.default:l,i.specification,h,p,_)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,l,h,p){return this.property.possiblyEvaluate(this,i,l,h,p)}}class ab{constructor(i,l,h,p){this.property=i,this.value=new Ay(i,void 0,l,h,p)}transitioned(i,l){return new NE(this.property,this.value,l,Object.assign({},i.transition,this.transition),i.now)}untransitioned(){return new NE(this.property,this.value,null,{},0)}}class DE{constructor(i,l,h,p){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._scope=l,this._options=h,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(i){return bt(this._values[i].value.value)}setValue(i,l){this._values.hasOwnProperty(i)||(this._values[i]=new ab(this._values[i].property,this._scope,this._options,this._iconImageUseTheme)),this._values[i].value=new Ay(this._values[i].property,l===null?void 0:bt(l),this._scope,this._options,this._iconImageUseTheme),this._values[i].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[i].value.isIndoorDependent())}setTransitionOrValue(i,l){l&&(this._options=l);const h=this._properties.properties;if(i)for(const p in i){const _=i[p];if(p.endsWith("-transition")){const y=p.slice(0,-11);h[y]&&this.setTransition(y,_)}else h.hasOwnProperty(p)&&this.setValue(p,_)}}getTransition(i){return bt(this._values[i].transition)}setTransition(i,l){this._values.hasOwnProperty(i)||(this._values[i]=new ab(this._values[i].property)),this._values[i].transition=bt(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(i[l]=h);const p=this.getTransition(l);p!==void 0&&(i[`${l}-transition`]=p)}return i}transitioned(i,l){const h=new zE(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].transitioned(i,l._values[p]);return h}untransitioned(){const i=new zE(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}isIndoorDependent(){return this._isIndoorDependent}}class NE{constructor(i,l,h,p,_){const y=p.delay||0,w=p.duration||0;_=_||0,this.property=i,this.value=l,this.begin=_+y,this.end=this.begin+w,i.specification.transition&&(p.delay||p.duration)&&(this.prior=h)}possiblyEvaluate(i,l,h){const p=i.now||0,_=this.value.possiblyEvaluate(i,l,h),y=this.prior;if(y){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return y.possiblyEvaluate(i,l,h);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(i,l,h),_,Mi(w))}}return _}}class zE{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,h){const p=new Mf(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(i,l,h);return p}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class FE{constructor(i,l,h,p){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._scope=l,this._options=h,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(i){return bt(this._values[i].value)}setValue(i,l){this._values[i]=new Ay(this._values[i].property,l===null?void 0:bt(l),this._scope,this._options,this._iconImageUseTheme),this._values[i].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[i].isIndoorDependent())}serialize(){const i={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(i[l]=h)}return i}possiblyEvaluate(i,l,h,p){const _=new Mf(this._properties);for(const y of Object.keys(this._values))_._values[y]=this._values[y].possiblyEvaluate(i,l,h,p);return _}isIndoorDependent(){return this._isIndoorDependent}}class Rf{constructor(i,l,h,p){this.property=i,this.value=l,this.parameters=h,this.iconImageUseTheme=p}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,l,h,p){return this.property.evaluate(this.value,this.parameters,i,l,h,p,this.iconImageUseTheme)}}class Mf{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Zt{constructor(i){this.specification=i}possiblyEvaluate(i,l){return i.expression.evaluate(l)}interpolate(i,l,h){const p=O0[this.specification.type];return p?p(i,l,h):i}}class sn{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,h,p,_){return i.expression.kind==="constant"||i.expression.kind==="camera"?new Rf(this,{kind:"constant",value:i.expression.evaluate(l,null,{},h,p,void 0,_)},l):new Rf(this,i.expression,l,_)}interpolate(i,l,h){if(i.value.kind!=="constant"||l.value.kind!=="constant")return i;if(i.value.value===void 0||l.value.value===void 0)return new Rf(this,{kind:"constant",value:void 0},i.parameters);const p=O0[this.specification.type];return p?new Rf(this,{kind:"constant",value:p(i.value.value,l.value.value,h)},i.parameters):i}evaluate(i,l,h,p,_,y,w){return i.kind==="constant"?i.value:i.evaluate(l,h,p,_,y,void 0,w)}}class Pf{constructor(i){this.specification=i}possiblyEvaluate(i,l,h,p){return!!i.expression.evaluate(l,null,{},h,p)}interpolate(){return!1}}class fa{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new Rs(0,{});for(const h in i){const p=i[h];p.specification.overridable&&this.overridableProperties.push(h);const _=this.defaultPropertyValues[h]=new Ay(p,void 0),y=this.defaultTransitionablePropertyValues[h]=new ab(p);this.defaultTransitioningPropertyValues[h]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=_.possiblyEvaluate(l)}}}An(sn,"DataDrivenProperty"),An(Zt,"DataConstantProperty"),An(Pf,"ColorRampProperty");var Ke=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function BE(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Cy(c){if(Array.isArray(c))return c.map(Cy);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const i={};for(const l in c)i[l]=Cy(c[l]);return i}return BE(c)}function Wc(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const i of c.slice(1))if(!Wc(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function ky(c,i="",l=null,h="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Wc(c)||(c=Iy(c));const p=c;let _=!0;try{_=function(O){if(!$p(O))return O;let D=Cy(O);return jE(D),D=Of(D),D}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let y=null,w=null;if(h!=="background"&&h!=="sky"&&h!=="slot"){w=Ke[`filter_${h}`];const O=Ah(_,w,i,l);if(O.result==="error")throw new Error(O.value.map(D=>`${D.key}: ${D.message}`).join(", "));y=(D,z,V)=>O.value.evaluate(D,z,{},V)}let S=null,R=null;if(_!==p){const O=Ah(p,w,i,l);if(O.result==="error")throw new Error(O.value.map(D=>`${D.key}: ${D.message}`).join(", "));S=(D,z,V,H,K)=>O.value.evaluate(D,z,{},V,void 0,void 0,H,K),R=!Op(O.value.expression)}return{filter:y,dynamicFilter:S||void 0,needGeometry:UE(_),needFeature:!!R}}function Of(c){if(!Array.isArray(c))return c;const i=function(l){if(Qk.has(l[0])){for(let h=1;h<l.length;h++)if($p(l[h]))return!0}return l}(c);return i===!0?i:i.map(l=>Of(l))}function jE(c){let i=!1;const l=[];if(c[0]==="case"){for(let h=1;h<c.length-1;h+=2)i=i||$p(c[h]),l.push(c[h+1]);l.push(c[c.length-1])}else if(c[0]==="match"){i=i||$p(c[1]);for(let h=2;h<c.length-1;h+=2)l.push(c[h+1]);l.push(c[c.length-1])}else if(c[0]==="step"){i=i||$p(c[1]);for(let h=1;h<c.length-1;h+=2)l.push(c[h+1])}i&&(c.length=0,c.push("any",...l));for(let h=1;h<c.length;h++)jE(c[h])}function $p(c){if(!Array.isArray(c))return!1;if((i=c[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let l=1;l<c.length;l++)if($p(c[l]))return!0;return!1}const Qk=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Jk(c,i){return c<i?-1:c>i?1:0}function UE(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let i=1;i<c.length;i++)if(UE(c[i]))return!0;return!1}function Iy(c){if(!c)return!0;const i=c[0];return c.length<=1?i!=="any":i==="=="?Ry(c[1],c[2],"=="):i==="!="?eg(Ry(c[1],c[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Ry(c[1],c[2],i):i==="any"?(l=c.slice(1),["any"].concat(l.map(Iy))):i==="all"?["all"].concat(c.slice(1).map(Iy)):i==="none"?["all"].concat(c.slice(1).map(Iy).map(eg)):i==="in"?My(c[1],c.slice(2)):i==="!in"?eg(My(c[1],c.slice(2))):i==="has"?Py(c[1]):i!=="!has"||eg(Py(c[1]));var l}function Ry(c,i,l){switch(c){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,c,i]}}function My(c,i){if(i.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",c,["literal",i.sort(Jk)]]:["filter-in-small",c,["literal",i]]}}function Py(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function eg(c){return["!",c]}const Lf="";function fc(c,i){return i?`${c}${Lf}${i}`:c}let VE;const $E=()=>VE||(VE=new fa({"icon-size":new sn(Ke.layout_symbol["icon-size"]),"icon-image":new sn(Ke.layout_symbol["icon-image"]),"icon-rotate":new sn(Ke.layout_symbol["icon-rotate"]),"icon-offset":new sn(Ke.layout_symbol["icon-offset"]),"text-size":new sn(Ke.layout_symbol["text-size"]),"text-rotate":new sn(Ke.layout_symbol["text-rotate"]),"text-offset":new sn(Ke.layout_symbol["text-offset"])}));class HE{constructor(i,l,h,p,_,y){const w=Ah(i,Ke.appearance.condition);if(w.result==="success"&&(this.condition=w.value),this.name=l,h){this.properties=new Mf($E()),this.unevaluatedLayout=new FE($E(),p,_,y);for(const S in h)this.unevaluatedLayout.setValue(S,h[S])}}isActive(i){return!(this.condition||!i.isHidden||this.name!=="hidden")||this.condition.evaluate(i.globals,i.feature,i.featureState,i.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(i){return this.properties.get(i)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(i){return this.unevaluatedLayout._values[i]}recalculate(i,l,h){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(i,void 0,l,h))}serialize(){const i={};return i.condition=this.condition.expression.serialize(),this.name&&(i.name=this.name),this.unevaluatedLayout&&(i.properties=this.unevaluatedLayout.serialize()),i}hasIconProperties(){const i=this.hasProperty("icon-image"),l=this.hasProperty("icon-size"),h=this.hasProperty("icon-offset"),p=this.hasProperty("icon-rotate");return i||l||h||p}hasTextProperties(){const i=this.hasProperty("text-size"),l=this.hasProperty("text-offset"),h=this.hasProperty("text-rotate");return i||l||h}hasProperty(i){return this.getUnevaluatedProperty(i).value!==void 0}}const GE="-transition",Zc=new Set(["fill","line","background","hillshade","raster"]);class yl extends wf{constructor(i,l,h,p,_,y){if(super(),this.id=i.id,this.fqid=fc(this.id,h),this.type=i.type,this.scope=h,this.lut=p,this.options=_,this.iconImageUseTheme=y,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},i.type!=="custom"){if(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type&&i.type!=="background"&&i.type!=="sky"&&i.type!=="slot"){this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter;const w=Ah(this.filter,Ke[`filter_${i.type}`]);w.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...w.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||w.value.isIndoorDependent)}if(i.slot&&(this.slot=i.slot),i.appearances&&this.setAppearances(i.appearances),l.layout&&(this._unevaluatedLayout=new FE(l.layout,this.scope,_,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),l.paint){this._transitionablePaint=new DE(l.paint,this.scope,_);for(const w in i.paint)this.setPaintProperty(w,i.paint[w]);for(const w in i.layout)this.setLayoutProperty(w,i.layout[w]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Mf(l.paint)}}}onAdd(i){}onRemove(i){}isDraped(i){return!this.is3D(!0)&&Zc.has(this.type)}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l){if(this.type==="custom"&&i==="visibility")return void(this.visibility=l);const h=this._unevaluatedLayout;h._properties.properties[i]&&(h.setValue(i,l),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...h.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||h.isIndoorDependent(),i==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(i){this.appearances=[],i.forEach(l=>{this.appearances.push(new HE(l.condition,l.name,l.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(i){return i.endsWith(GE)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}isPaintProperty(i){return!!this._transitionablePaint._properties.properties[i]}setPaintProperty(i,l){const h=this._transitionablePaint,p=h._properties.properties;if(i.endsWith(GE)){const D=i.slice(0,-11);return p[D]&&h.setTransition(D,l||void 0),!1}if(!p[i])return!1;const _=h._values[i],y=_.value.isDataDriven(),w=_.value;h.setValue(i,l),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...h.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||h.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(i);const S=h._values[i].value,R=S.isDataDriven(),O=i.endsWith("pattern")||i==="line-dasharray";return R||y||O||this._handleOverridablePaintPropertyUpdate(i,w,S)}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getDefaultProgramParams(i,l,h){return null}_handleOverridablePaintPropertyUpdate(i,l,h){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(i.appearances=this.appearances.map(l=>l.serialize())),Rt(i,(l,h)=>!(l===void 0||h==="layout"&&!Object.keys(l).length||h==="paint"&&!Object.keys(l).length))}is3D(i){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof Rf&&Z0(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}for(const i of this.appearances)if(!V0(i.condition.expression))return!0;return!1}compileFilter(i){this._filterCompiled||(this._featureFilter=ky(this.filter,this.scope,i),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(i){this._stats&&(i.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(i,l,h){return{}}queryRadius(i){}queryIntersectsFeature(i,l,h,p,_,y,w,S,R){}}const qE={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class tg{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const eI=new ArrayBuffer(0);class Hs{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(i,l){return i._trim(),l&&i.arrayBuffer&&l.add(i.arrayBuffer),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,i.arrayBuffer?l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement:(l.capacity=0,l.arrayBuffer=eI),l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this._reallocCount++,this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}reserveForAdditional(i){this.reserve(this.length+i)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...i){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...i){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ui(c,i=1){let l=0,h=0;return{members:c.map(p=>{const _=qE[p.type].BYTES_PER_ELEMENT,y=l=WE(l,Math.max(i,_)),w=p.components||1;return h=Math.max(h,_),l+=_*w,{name:p.name,type:p.type,components:w,offset:y}}),size:WE(l,Math.max(h,i)),alignment:i}}function WE(c,i){return Math.ceil(c/i)*i}class kh extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const p=2*i;return this.int16[p+0]=l,this.int16[p+1]=h,i}}kh.prototype.bytesPerElement=4,An(kh,"StructArrayLayout2i4");class Hp extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,i,l,h)}emplace(i,l,h,p){const _=3*i;return this.int16[_+0]=l,this.int16[_+1]=h,this.int16[_+2]=p,i}}Hp.prototype.bytesPerElement=6,An(Hp,"StructArrayLayout3i6");class Gp extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,i,l,h,p)}emplace(i,l,h,p,_){const y=4*i;return this.int16[y+0]=l,this.int16[y+1]=h,this.int16[y+2]=p,this.int16[y+3]=_,i}}Gp.prototype.bytesPerElement=8,An(Gp,"StructArrayLayout4i8");class Id extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}Id.prototype.bytesPerElement=4,An(Id,"StructArrayLayout1f4");class ob extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,i,l,h)}emplace(i,l,h,p){const _=4*i,y=2*i;return this.int16[_+0]=l,this.int16[_+1]=h,this.float32[y+1]=p,i}}ob.prototype.bytesPerElement=8,An(ob,"StructArrayLayout2i1f8");class lb extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,i,l,h)}emplace(i,l,h,p){const _=4*i;return this.int16[_+0]=l,this.int16[_+1]=h,this.int16[_+2]=p,i}}lb.prototype.bytesPerElement=8,An(lb,"StructArrayLayout3i8");class ub extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_){const y=this.length;return this.resize(y+1),this.emplace(y,i,l,h,p,_)}emplace(i,l,h,p,_,y){const w=5*i;return this.int16[w+0]=l,this.int16[w+1]=h,this.int16[w+2]=p,this.int16[w+3]=_,this.int16[w+4]=y,i}}ub.prototype.bytesPerElement=10,An(ub,"StructArrayLayout5i10");class Oy extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_,y,w){const S=this.length;return this.resize(S+1),this.emplace(S,i,l,h,p,_,y,w)}emplace(i,l,h,p,_,y,w,S){const R=6*i,O=12*i,D=3*i;return this.int16[R+0]=l,this.int16[R+1]=h,this.uint8[O+4]=p,this.uint8[O+5]=_,this.uint8[O+6]=y,this.uint8[O+7]=w,this.float32[D+2]=S,i}}Oy.prototype.bytesPerElement=12,An(Oy,"StructArrayLayout2i4ub1f12");class cu extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,i,l,h)}emplace(i,l,h,p){const _=3*i;return this.float32[_+0]=l,this.float32[_+1]=h,this.float32[_+2]=p,i}}cu.prototype.bytesPerElement=12,An(cu,"StructArrayLayout3f12");class kl extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_){const y=this.length;return this.resize(y+1),this.emplace(y,i,l,h,p,_)}emplace(i,l,h,p,_,y){const w=6*i,S=3*i;return this.uint16[w+0]=l,this.uint16[w+1]=h,this.uint16[w+2]=p,this.uint16[w+3]=_,this.float32[S+2]=y,i}}kl.prototype.bytesPerElement=12,An(kl,"StructArrayLayout4ui1f12");class Df extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,i,l,h,p)}emplace(i,l,h,p,_){const y=4*i;return this.uint16[y+0]=l,this.uint16[y+1]=h,this.uint16[y+2]=p,this.uint16[y+3]=_,i}}Df.prototype.bytesPerElement=8,An(Df,"StructArrayLayout4ui8");class Ly extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_,y){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,h,p,_,y)}emplace(i,l,h,p,_,y,w){const S=6*i;return this.int16[S+0]=l,this.int16[S+1]=h,this.int16[S+2]=p,this.int16[S+3]=_,this.int16[S+4]=y,this.int16[S+5]=w,i}}Ly.prototype.bytesPerElement=12,An(Ly,"StructArrayLayout6i12");class cb extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_,y,w,S,R,O,D,z){const V=this.length;return this.resize(V+1),this.emplace(V,i,l,h,p,_,y,w,S,R,O,D,z)}emplace(i,l,h,p,_,y,w,S,R,O,D,z,V){const H=12*i;return this.int16[H+0]=l,this.int16[H+1]=h,this.int16[H+2]=p,this.int16[H+3]=_,this.uint16[H+4]=y,this.uint16[H+5]=w,this.uint16[H+6]=S,this.uint16[H+7]=R,this.int16[H+8]=O,this.int16[H+9]=D,this.int16[H+10]=z,this.int16[H+11]=V,i}}cb.prototype.bytesPerElement=24,An(cb,"StructArrayLayout4i4ui4i24");class db extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_,y){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,h,p,_,y)}emplace(i,l,h,p,_,y,w){const S=10*i,R=5*i;return this.int16[S+0]=l,this.int16[S+1]=h,this.int16[S+2]=p,this.float32[R+2]=_,this.float32[R+3]=y,this.float32[R+4]=w,i}}db.prototype.bytesPerElement=20,An(db,"StructArrayLayout3i3f20");class Ih extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,i,l,h,p)}emplace(i,l,h,p,_){const y=4*i;return this.float32[y+0]=l,this.float32[y+1]=h,this.float32[y+2]=p,this.float32[y+3]=_,i}}Ih.prototype.bytesPerElement=16,An(Ih,"StructArrayLayout4f16");class Dy extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}Dy.prototype.bytesPerElement=4,An(Dy,"StructArrayLayout1ul4");class du extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const p=2*i;return this.uint16[p+0]=l,this.uint16[p+1]=h,i}}du.prototype.bytesPerElement=4,An(du,"StructArrayLayout2ui4");class Ny extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_,y,w,S,R,O,D,z,V){const H=this.length;return this.resize(H+1),this.emplace(H,i,l,h,p,_,y,w,S,R,O,D,z,V)}emplace(i,l,h,p,_,y,w,S,R,O,D,z,V,H){const K=20*i,re=10*i;return this.int16[K+0]=l,this.int16[K+1]=h,this.int16[K+2]=p,this.int16[K+3]=_,this.int16[K+4]=y,this.float32[re+3]=w,this.float32[re+4]=S,this.float32[re+5]=R,this.float32[re+6]=O,this.int16[K+14]=D,this.uint32[re+8]=z,this.uint16[K+18]=V,this.uint16[K+19]=H,i}}Ny.prototype.bytesPerElement=40,An(Ny,"StructArrayLayout5i4f1i1ul2ui40");class zy extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_,y,w){const S=this.length;return this.resize(S+1),this.emplace(S,i,l,h,p,_,y,w)}emplace(i,l,h,p,_,y,w,S){const R=8*i;return this.int16[R+0]=l,this.int16[R+1]=h,this.int16[R+2]=p,this.int16[R+4]=_,this.int16[R+5]=y,this.int16[R+6]=w,this.int16[R+7]=S,i}}zy.prototype.bytesPerElement=16,An(zy,"StructArrayLayout3i2i2i16");class Fy extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_){const y=this.length;return this.resize(y+1),this.emplace(y,i,l,h,p,_)}emplace(i,l,h,p,_,y){const w=4*i,S=8*i;return this.float32[w+0]=l,this.float32[w+1]=h,this.float32[w+2]=p,this.int16[S+6]=_,this.int16[S+7]=y,i}}Fy.prototype.bytesPerElement=16,An(Fy,"StructArrayLayout2f1f2i16");class hb extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_,y){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,h,p,_,y)}emplace(i,l,h,p,_,y,w){const S=20*i,R=5*i;return this.uint8[S+0]=l,this.uint8[S+1]=h,this.float32[R+1]=p,this.float32[R+2]=_,this.float32[R+3]=y,this.float32[R+4]=w,i}}hb.prototype.bytesPerElement=20,An(hb,"StructArrayLayout2ub4f20");class Wa extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,i,l,h)}emplace(i,l,h,p){const _=3*i;return this.uint16[_+0]=l,this.uint16[_+1]=h,this.uint16[_+2]=p,i}}Wa.prototype.bytesPerElement=6,An(Wa,"StructArrayLayout3ui6");class qp extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_,y,w,S,R,O,D,z,V,H,K,re,ne,ue,he,ge,ke){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,i,l,h,p,_,y,w,S,R,O,D,z,V,H,K,re,ne,ue,he,ge,ke)}emplace(i,l,h,p,_,y,w,S,R,O,D,z,V,H,K,re,ne,ue,he,ge,ke,Ee){const Me=30*i,Be=15*i,$e=60*i;return this.int16[Me+0]=l,this.int16[Me+1]=h,this.int16[Me+2]=p,this.float32[Be+2]=_,this.float32[Be+3]=y,this.uint16[Me+8]=w,this.uint16[Me+9]=S,this.uint32[Be+5]=R,this.uint32[Be+6]=O,this.uint32[Be+7]=D,this.uint16[Me+16]=z,this.uint16[Me+17]=V,this.uint16[Me+18]=H,this.float32[Be+10]=K,this.float32[Be+11]=re,this.uint8[$e+48]=ne,this.uint8[$e+49]=ue,this.uint8[$e+50]=he,this.uint32[Be+13]=ge,this.int16[Me+28]=ke,this.uint8[$e+58]=Ee,i}}qp.prototype.bytesPerElement=60,An(qp,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class fb extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_,y,w,S,R,O,D,z,V,H,K,re,ne,ue,he,ge,ke,Ee,Me,Be,$e,pt,Ye,vt,kt,It,Ft,jt,Lt){const Dt=this.length;return this.resize(Dt+1),this.emplace(Dt,i,l,h,p,_,y,w,S,R,O,D,z,V,H,K,re,ne,ue,he,ge,ke,Ee,Me,Be,$e,pt,Ye,vt,kt,It,Ft,jt,Lt)}emplace(i,l,h,p,_,y,w,S,R,O,D,z,V,H,K,re,ne,ue,he,ge,ke,Ee,Me,Be,$e,pt,Ye,vt,kt,It,Ft,jt,Lt,Dt){const yt=20*i,gt=40*i,zt=80*i;return this.float32[yt+0]=l,this.float32[yt+1]=h,this.int16[gt+4]=p,this.int16[gt+5]=_,this.int16[gt+6]=y,this.int16[gt+7]=w,this.int16[gt+8]=S,this.int16[gt+9]=R,this.int16[gt+10]=O,this.int16[gt+11]=D,this.int16[gt+12]=z,this.uint16[gt+13]=V,this.uint16[gt+14]=H,this.uint16[gt+15]=K,this.uint16[gt+16]=re,this.uint16[gt+17]=ne,this.uint16[gt+18]=ue,this.uint16[gt+19]=he,this.uint16[gt+20]=ge,this.uint16[gt+21]=ke,this.uint16[gt+22]=Ee,this.uint16[gt+23]=Me,this.uint16[gt+24]=Be,this.uint16[gt+25]=$e,this.uint16[gt+26]=pt,this.uint16[gt+27]=Ye,this.uint32[yt+14]=vt,this.float32[yt+15]=kt,this.float32[yt+16]=It,this.float32[yt+17]=Ft,this.float32[yt+18]=jt,this.uint8[zt+76]=Lt,this.uint16[gt+39]=Dt,i}}fb.prototype.bytesPerElement=80,An(fb,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class pb extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_,y){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,h,p,_,y)}emplace(i,l,h,p,_,y,w){const S=6*i;return this.float32[S+0]=l,this.float32[S+1]=h,this.float32[S+2]=p,this.float32[S+3]=_,this.float32[S+4]=y,this.float32[S+5]=w,i}}pb.prototype.bytesPerElement=24,An(pb,"StructArrayLayout6f24");class Nf extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_){const y=this.length;return this.resize(y+1),this.emplace(y,i,l,h,p,_)}emplace(i,l,h,p,_,y){const w=5*i;return this.float32[w+0]=l,this.float32[w+1]=h,this.float32[w+2]=p,this.float32[w+3]=_,this.float32[w+4]=y,i}}Nf.prototype.bytesPerElement=20,An(Nf,"StructArrayLayout5f20");class mb extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_,y,w){const S=this.length;return this.resize(S+1),this.emplace(S,i,l,h,p,_,y,w)}emplace(i,l,h,p,_,y,w,S){const R=7*i;return this.float32[R+0]=l,this.float32[R+1]=h,this.float32[R+2]=p,this.float32[R+3]=_,this.float32[R+4]=y,this.float32[R+5]=w,this.float32[R+6]=S,i}}mb.prototype.bytesPerElement=28,An(mb,"StructArrayLayout7f28");class gb extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_,y,w,S,R,O,D){const z=this.length;return this.resize(z+1),this.emplace(z,i,l,h,p,_,y,w,S,R,O,D)}emplace(i,l,h,p,_,y,w,S,R,O,D,z){const V=11*i;return this.float32[V+0]=l,this.float32[V+1]=h,this.float32[V+2]=p,this.float32[V+3]=_,this.float32[V+4]=y,this.float32[V+5]=w,this.float32[V+6]=S,this.float32[V+7]=R,this.float32[V+8]=O,this.float32[V+9]=D,this.float32[V+10]=z,i}}gb.prototype.bytesPerElement=44,An(gb,"StructArrayLayout11f44");class Wp extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_,y,w,S,R){const O=this.length;return this.resize(O+1),this.emplace(O,i,l,h,p,_,y,w,S,R)}emplace(i,l,h,p,_,y,w,S,R,O){const D=9*i;return this.float32[D+0]=l,this.float32[D+1]=h,this.float32[D+2]=p,this.float32[D+3]=_,this.float32[D+4]=y,this.float32[D+5]=w,this.float32[D+6]=S,this.float32[D+7]=R,this.float32[D+8]=O,i}}Wp.prototype.bytesPerElement=36,An(Wp,"StructArrayLayout9f36");class Xc extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const p=2*i;return this.float32[p+0]=l,this.float32[p+1]=h,i}}Xc.prototype.bytesPerElement=8,An(Xc,"StructArrayLayout2f8");class Il extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,i,l,h,p)}emplace(i,l,h,p,_){const y=6*i;return this.uint32[3*i+0]=l,this.uint16[y+2]=h,this.uint16[y+3]=p,this.uint16[y+4]=_,i}}Il.prototype.bytesPerElement=12,An(Il,"StructArrayLayout1ul3ui12");class Rh extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}Rh.prototype.bytesPerElement=2,An(Rh,"StructArrayLayout1ui2");class _b extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_,y,w,S,R,O,D,z,V,H,K,re){const ne=this.length;return this.resize(ne+1),this.emplace(ne,i,l,h,p,_,y,w,S,R,O,D,z,V,H,K,re)}emplace(i,l,h,p,_,y,w,S,R,O,D,z,V,H,K,re,ne){const ue=16*i;return this.float32[ue+0]=l,this.float32[ue+1]=h,this.float32[ue+2]=p,this.float32[ue+3]=_,this.float32[ue+4]=y,this.float32[ue+5]=w,this.float32[ue+6]=S,this.float32[ue+7]=R,this.float32[ue+8]=O,this.float32[ue+9]=D,this.float32[ue+10]=z,this.float32[ue+11]=V,this.float32[ue+12]=H,this.float32[ue+13]=K,this.float32[ue+14]=re,this.float32[ue+15]=ne,i}}_b.prototype.bytesPerElement=64,An(_b,"StructArrayLayout16f64");class By extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,p,_,y,w){const S=this.length;return this.resize(S+1),this.emplace(S,i,l,h,p,_,y,w)}emplace(i,l,h,p,_,y,w,S){const R=10*i,O=5*i;return this.uint16[R+0]=l,this.uint16[R+1]=h,this.uint16[R+2]=p,this.uint16[R+3]=_,this.float32[O+2]=y,this.float32[O+3]=w,this.float32[O+4]=S,i}}By.prototype.bytesPerElement=20,An(By,"StructArrayLayout4ui3f20");class yb extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.int16[1*i+0]=l,i}}yb.prototype.bytesPerElement=2,An(yb,"StructArrayLayout1i2");class jy extends Hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint8[1*i+0]=l,i}}jy.prototype.bytesPerElement=1,An(jy,"StructArrayLayout1ub1");class Uy extends tg{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Uy.prototype.size=40;class ZE extends Ny{get(i){return new Uy(this,i)}}An(ZE,"CollisionBoxArray");class Vy extends tg{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}Vy.prototype.size=60;class XE extends qp{get(i){return new Vy(this,i)}}An(XE,"PlacedSymbolArray");class YE extends tg{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(i){this._structArray.uint32[this._pos4+14]=i}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(i){this._structArray.float32[this._pos4+18]=i}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}YE.prototype.size=80;class vb extends fb{get(i){return new YE(this,i)}}An(vb,"SymbolInstanceArray");class $y extends Id{getoffsetX(i){return this.float32[1*i+0]}}An($y,"GlyphOffsetArray");class KE extends kh{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}An(KE,"SymbolLineVertexArray");class xb extends tg{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}xb.prototype.size=12;class bb extends Il{get(i){return new xb(this,i)}}An(bb,"FeatureIndexArray");class QE extends du{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}An(QE,"FillExtrusionCentroidArray");class Hy extends tg{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Hy.prototype.size=6;class ng extends Hp{get(i){return new Hy(this,i)}}An(ng,"FillExtrusionWallArray");const JE=ui([{name:"a_pos",components:2,type:"Int16"}],4),tI=ui([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),eS=ui([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ta{constructor(i=[]){this.segments=i}_prepareSegment(i,l,h,p){let _=this.segments[this.segments.length-1];return i>ta.MAX_VERTEX_ARRAY_LENGTH&&un(`Max vertices per segment is ${ta.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!_||_.vertexLength+i>ta.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p)&&(_={vertexOffset:l,primitiveOffset:h,vertexLength:0,primitiveLength:0},p!==void 0&&(_.sortKey=p),this.segments.push(_)),_}prepareSegment(i,l,h,p){return this._prepareSegment(i,l.length,h.length,p)}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,h,p){return new ta([{vertexOffset:i,primitiveOffset:l,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])}}function Gy(c,i){return 256*(c=ee(Math.floor(c),0,255))+ee(Math.floor(i),0,255)}ta.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,An(ta,"SegmentVector");const nI=ui([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),rI=ui([{name:"a_pattern_b",components:4,type:"Uint16"}]),iI=ui([{name:"a_dash",components:4,type:"Uint16"}]);class rg{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(i,l,h,p){this.ids.push(wb(i)),this.positions.push(l,h,p)}eachPosition(i,l){const h=wb(i);let p=0,_=this.ids.length-1;for(;p<_;){const y=p+_>>1;this.ids[y]>=h?_=y:p=y+1}for(;this.ids[p]===h;)l(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(i,l){const h=new Float64Array(i.ids),p=new Uint32Array(i.positions);return Tb(h,p,0,h.length-1),l&&(l.add(h.buffer),l.add(p.buffer)),{ids:h,positions:p}}static deserialize(i){const l=new rg;let h;l.ids=i.ids,l.positions=i.positions;for(const p of l.ids)p!==h&&l.uniqueIds.push(p),h=p;return l.indexed=!0,l}}function wb(c){const i=+c;return Number.isSafeInteger(i)?i:U_(String(c))}function Tb(c,i,l,h){for(;l<h;){const p=c[l+h>>1];let _=l-1,y=h+1;for(;;){do _++;while(c[_]<p);do y--;while(c[y]>p);if(_>=y)break;qy(c,_,y),qy(i,3*_,3*y),qy(i,3*_+1,3*y+1),qy(i,3*_+2,3*y+2)}y-l<h-y?(Tb(c,i,l,y),l=y+1):(Tb(c,i,y+1,h),h=y)}}function qy(c,i,l){const h=c[i];c[i]=c[l],c[l]=h}An(rg,"FeaturePositionMap");class Rd{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,l),this.initialized=!0),!!this.location}set(i,l,h){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Wy extends Rd{constructor(i){super(i),this.current=0}set(i,l,h){this.fetchUniformLocation(i,l)&&this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}}class Za extends Rd{constructor(i){super(i),this.current=0}set(i,l,h){this.fetchUniformLocation(i,l)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class Yc extends Rd{constructor(i){super(i),this.current=[0,0]}set(i,l,h){this.fetchUniformLocation(i,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1])))}}class ig extends Rd{constructor(i){super(i),this.current=[0,0,0]}set(i,l,h){this.fetchUniformLocation(i,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2])))}}class Zy extends Rd{constructor(i){super(i),this.current=[0,0,0,0]}set(i,l,h){this.fetchUniformLocation(i,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class sg extends Rd{constructor(i){super(i),this.current=Yi.transparent.toPremultipliedRenderColor(null)}set(i,l,h){this.fetchUniformLocation(i,l)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const sI=new Float32Array(16);class ag extends Rd{constructor(i){super(i),this.current=sI}set(i,l,h){if(this.fetchUniformLocation(i,l)){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let p=1;p<16;p++)if(h[p]!==this.current[p]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}}}const Xy=new Float32Array(9),aI=new Float32Array(4);class Yy extends Rd{constructor(i){super(i),this.current=aI}set(i,l,h){if(this.fetchUniformLocation(i,l)){for(let p=0;p<4;p++)if(h[p]!==this.current[p]){this.current=h,this.gl.uniformMatrix2fv(this.location,!1,h);break}}}}function Eb(c){return[Gy(255*c.r,255*c.g),Gy(255*c.b,255*c.a)]}function og(c,i,l,h,p,_,y,w){return!!c&&(c.kind==="composite"||c.kind==="source"?c.evaluate(new Rs(0,{brightness:_,worldview:w}),i,l,p,h,y)==="none":c.value==="none")}class lg{constructor(i,l,h,p){this.value=i,this.uniformNames=l.map(_=>`u_${_}`),this.type=h,this.context=p}setUniform(i,l,h,p,_){const y=p.constantOr(this.value);l.set(i,_,y instanceof Yi?y.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):y)}getBinding(i,l){return this.type==="color"?new sg(i):new Za(i)}}class Zp{constructor(i,l){this.uniformNames=l.map(h=>`u_${h}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(i,l){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br),this.patternTransition=l?l.tl.concat(l.br):this.pattern}setUniform(i,l,h,p,_){let y=null;_!=="u_pattern"&&_!=="u_dash"||(y=this.pattern),_==="u_pattern_b"&&(y=this.patternTransition),_==="u_pixel_ratio"&&(y=this.pixelRatio),y&&l.set(i,_,y)}getBinding(i,l){return l==="u_pattern"||l==="u_pattern_b"||l==="u_dash"?new Zy(i):new Za(i)}}class Md{constructor(i,l,h,p){this.expression=i,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(_=>({name:`a_${_}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(i,l,h,p,_,y,w,S){const R=this.paintVertexArray.length,O=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Rs(0,{brightness:y,worldview:S}),l,{},_,p,w):this.expression.kind==="constant"&&this.expression.value,D=og(this.lutExpression,l,{},p,_,y,w,S);this.paintVertexArray.resize(i),this._setPaintValue(R,i,O,D?null:this.context.lut)}updatePaintArray(i,l,h,p,_,y,w,S){const R=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:w,worldview:S},h,p,void 0,_):this.expression.kind==="constant"&&this.expression.value,O=og(this.lutExpression,h,p,_,void 0,w,void 0,S);this._setPaintValue(i,l,R,O?null:this.context.lut)}_setPaintValue(i,l,h,p){if(this.type==="color"){const _=Eb(h.toPremultipliedRenderColor(p));for(let y=i;y<l;y++)this.paintVertexArray.emplace(y,_[0],_[1])}else{for(let _=i;_<l;_++)this.paintVertexArray.emplace(_,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Pd{constructor(i,l,h,p,_,y){this.expression=i,this.uniformNames=l.map(w=>`u_${w}_t`),this.type=h,this.useIntegerZoom=p,this.context=_,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(i,l,h,p,_,y,w,S){const R=this.expression.evaluate(new Rs(this.context.zoom,{brightness:y,worldview:S}),l,{},_,p,w),O=this.expression.evaluate(new Rs(this.context.zoom+1,{brightness:y,worldview:S}),l,{},_,p,w),D=og(this.lutExpression,l,{},p,_,y,w,S),z=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(z,i,R,O,D?null:this.context.lut)}updatePaintArray(i,l,h,p,_,y,w,S){const R=this.expression.evaluate({zoom:this.context.zoom,brightness:w,worldview:S},h,p,void 0,_),O=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w,worldview:S},h,p,void 0,_),D=og(this.lutExpression,h,p,_,void 0,w,void 0,S);this._setPaintValue(i,l,R,O,D?null:this.context.lut)}_setPaintValue(i,l,h,p,_){if(this.type==="color"){const y=Eb(h.toPremultipliedRenderColor(_)),w=Eb(h.toPremultipliedRenderColor(_));for(let S=i;S<l;S++)this.paintVertexArray.emplace(S,y[0],y[1],w[0],w[1])}else{for(let y=i;y<l;y++)this.paintVertexArray.emplace(y,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l,h,p,_){const y=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,w=ee(this.expression.interpolationFactor(y,this.context.zoom,this.context.zoom+1),0,1);l.set(i,_,w)}getBinding(i,l){return new Za(i)}}class Od{constructor(i,l,h,p,_){this.expression=i,this.layerId=_,this.paintVertexAttributes=(h==="array"?iI:nI).members;for(let y=0;y<l.length;++y);this.paintVertexArray=new p,this.paintTransitionVertexArray=new Df}populatePaintArray(i,l,h,p){const _=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(_,i,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(i,l,h,p,_,y,w){this._setPaintValues(i,l,h.patterns&&h.patterns[this.layerId],y)}_setPaintValues(i,l,h,p){if(!p||!h)return;const _=p[h[0]],y=p[h[1]];if(_){if(_){const{tl:w,br:S,pixelRatio:R}=_;for(let O=i;O<l;O++)this.paintVertexArray.emplace(O,w[0],w[1],S[0],S[1],R)}if(y){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:w,br:S}=y;for(let R=i;R<l;R++)this.paintTransitionVertexArray.emplace(R,w[0],w[1],S[0],S[1])}}}upload(i){const l=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,l)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=i.createVertexBuffer(this.paintTransitionVertexArray,rI.members,l))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Mh{constructor(i,l,h=()=>!0){this.binders={},this._buffers=[],this.context=l;const p=[];for(const _ in i.paint._values){const y=i.paint.get(_);if(_.endsWith("-use-theme")||!h(_)||!(y instanceof Rf&&Z0(y.property.specification)))continue;const w=lI(_,i.type),S=y.value,R=y.property.specification.type,O=!!y.property.useIntegerZoom,D=_==="line-dasharray"||_.endsWith("pattern"),z=i.paint.get(`${_}-use-theme`),V=_==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant"||z&&z.value.kind!=="constant";if(S.kind!=="constant"||V)if(S.kind==="source"||V||D){const H=Sb(_,R,"source");this.binders[_]=D?new Od(S,w,R,H,i.id):new Md(S,w,R,H),p.push(`/a_${_}`)}else{const H=Sb(_,R,"composite");this.binders[_]=new Pd(S,w,R,O,l,H),p.push(`/z_${_}`)}else this.binders[_]=D?new Zp(S.value,w):new lg(S.value,w,R,l),p.push(`/u_${_}`);z&&(this.binders[_].lutExpression=z.value)}this.cacheKey=p.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof Md||l instanceof Pd?l.maxValue:0}populatePaintArrays(i,l,h,p,_,y,w,S){for(const R in this.binders){const O=this.binders[R];O.context=this.context,(O instanceof Md||O instanceof Pd||O instanceof Od)&&O.populatePaintArray(i,l,h,p,_,y,w,S)}}setConstantPatternPositions(i,l){for(const h in this.binders){const p=this.binders[h];p instanceof Zp&&p.setConstantPatternPositions(i,l)}}getPatternTransitionVertexBuffer(i){const l=this.binders[i];return l instanceof Od?l.paintTransitionVertexBuffer:null}updatePaintArrays(i,l,h,p,_,y,w,S,R,O){let D=!1;const z=Object.keys(i),V=z.length!==0&&!S,H=V?z:l.uniqueIds;this.context.lut=_.lut;for(const K in this.binders){const re=this.binders[K];if(re.context=this.context,(re instanceof Md||re instanceof Pd||re instanceof Od)&&re.expression&&re.expression.kind&&re.expression.kind!=="constant"&&(re.expression.isStateDependent===!0||re.expression.isLightConstant===!1)){const ne=_.paint.get(K);re.expression=ne.value;for(const ue of H){const he=i[ue.toString()];l.eachPosition(ue,(ge,ke,Ee)=>{const Me=p.feature(ge);re.updatePaintArray(ke,Ee,Me,he,y,w,R,O)})}if(!V)for(const ue of h.uniqueIds){const he=i[ue.toString()];h.eachPosition(ue,(ge,ke,Ee)=>{const Me=p.feature(ge);re.updatePaintArray(ke,Ee,Me,he,y,w,R,O)})}D=!0}}return D}defines(){const i=[];for(const l in this.binders){const h=this.binders[l];(h instanceof lg||h instanceof Zp)&&i.push(...h.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const l=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof lg||p instanceof Zp||p instanceof Pd)for(const _ of p.uniformNames)l.push({name:_,property:h,binding:p.getBinding(i,_)})}return l}setUniforms(i,l,h,p,_){for(const{name:y,property:w,binding:S}of h)this.binders[w].setUniform(i,S,_,p.get(w),y)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const l=this.binders[i];(l instanceof Md||l instanceof Pd||l instanceof Od)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer),l instanceof Od&&l.paintTransitionVertexBuffer&&this._buffers.push(l.paintTransitionVertexBuffer)}}upload(i){for(const l in this.binders){const h=this.binders[l];(h instanceof Md||h instanceof Pd||h instanceof Od)&&h.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof Md||l instanceof Pd||l instanceof Od)&&l.destroy()}}}class pc{constructor(i,l,h=()=>!0){this.programConfigurations={};for(const p of i)this.programConfigurations[p.id]=new Mh(p,l,h);this.needsUpload=!1,this._featureMap=new rg,this._featureMapWithoutIds=new rg,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(i,l,h,p,_,y,w,S,R){for(const O in this.programConfigurations)this.programConfigurations[O].populatePaintArrays(i,l,p,_,y,w,S,R);l.id!==void 0?this._featureMap.add(l.id,h,this._bufferOffset,i):(this._featureMapWithoutIds.add(this._idlessCounter,h,this._bufferOffset,i),this._idlessCounter+=1),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,h,p,_,y,w,S){for(const R of h)this.needsUpload=this.programConfigurations[R.id].updatePaintArrays(i,this._featureMap,this._featureMapWithoutIds,l,R,p,_,y,w||0,S)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const oI={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function lI(c,i){return oI[c]||[c.replace(`${i}-`,"").replace(/-/g,"_")]}const uI={"line-pattern":{source:kl,composite:kl},"fill-pattern":{source:kl,composite:kl},"fill-extrusion-pattern":{source:kl,composite:kl},"line-dasharray":{source:Df,composite:Df}},cI={color:{source:Xc,composite:Ih},number:{source:Id,composite:Xc}};function Sb(c,i,l){const h=uI[c];return h&&h[l]||cI[i][l]}An(lg,"ConstantBinder"),An(Zp,"PatternConstantBinder"),An(Md,"SourceExpressionBinder"),An(Od,"PatternCompositeBinder"),An(Pd,"CompositeExpressionBinder"),An(Mh,"ProgramConfiguration",{omit:["_buffers"]}),An(pc,"ProgramConfigurationSet");const Yo=Qt/Math.PI/2,zu=5,Ky=6,dI=16383,Xp=64,Ab=[Xp,32,16],Fu=-Yo,Bu=Yo;function zf(c,i,l,h=Yo){return l=Tn(l),[c*Math.sin(l)*h,-i*h,c*Math.cos(l)*h]}function Yp(c,i,l){return zf(Math.cos(Tn(c)),Math.sin(Tn(c)),i,l)}const m=63710088e-1,o=2*Math.PI*m;class d{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new d(ye(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,h=this.lat*l,p=i.lat*l,_=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((i.lng-this.lng)*l);return m*Math.acos(Math.min(_,1))}toBounds(i=0){const l=360*i/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new g({lng:this.lng-h,lat:this.lat-l},{lng:this.lng+h,lat:this.lat+l})}toEcef(i){return Yp(this.lat,this.lng,Yo+i*Yo/m)}static convert(i){if(i instanceof d)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new d(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new d(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class g{constructor(i,l){i&&(l?this.setSouthWest(i).setNorthEast(l):Array.isArray(i)&&i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof d?new d(i.lng,i.lat):d.convert(i),this}setSouthWest(i){return this._sw=i instanceof d?new d(i.lng,i.lat):d.convert(i),this}extend(i){const l=this._sw,h=this._ne;let p,_;if(i instanceof d)p=i,_=i;else{if(!(i instanceof g))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(g.convert(i)):this.extend(d.convert(i)):typeof i=="object"&&i!==null&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(d.convert(i)):this;if(p=i._sw,_=i._ne,!p||!_)return this}return l||h?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),h.lng=Math.max(_.lng,h.lng),h.lat=Math.max(_.lat,h.lat)):(this._sw=new d(p.lng,p.lat),this._ne=new d(_.lng,_.lat)),this}getCenter(){return new d((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d(this.getWest(),this.getNorth())}getSouthEast(){return new d(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:l,lat:h}=d.convert(i);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(i){if(i)return i instanceof g?i:new g(i)}}const b=0,T=25.5;function E(c){return o*Math.cos(c*Math.PI/180)}function I(c){return(180+c)/360}function M(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function N(c,i){return c/E(i)}function j(c){return 360*c-180}function Z(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function W(c,i){return c*E(Z(i))}const Y=85.051129;function te(c){return Math.cos(Tn(ee(c,-Y,Y)))}function J(c,i){const l=ee(i,b,T),h=Math.pow(2,l);return te(c)*o/(512*h)}function oe(c){return 1/Math.cos(c*Math.PI/180)}function ae(c,i=0){const l=Math.exp(Math.PI*(1-(c.y+i/Qt)/(1<<c.z)*2));return 80150034*l/(l*l+1)/Qt/(1<<c.z)}class pe{constructor(i,l,h=0){this.x=+i,this.y=+l,this.z=+h}static fromLngLat(i,l=0){const h=d.convert(i);return new pe(I(h.lng),M(h.lat),N(l,h.lat))}toLngLat(){return new d(j(this.x),Z(this.y))}toAltitude(){return W(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/o*oe(Z(this.y))}}function _e(c,i,l,h,p,_,y,w,S){const R=(i+h)/2,O=(l+p)/2,D=new Ve(R,O);w(D),function(z,V,H,K,re,ne){const ue=H-re,he=K-ne;return Math.abs((K-V)*ue-(H-z)*he)/Math.hypot(ue,he)}(D.x,D.y,_.x,_.y,y.x,y.y)>=S?(_e(c,i,l,R,O,_,D,w,S),_e(c,R,O,h,p,D,y,w,S)):c.push(y)}function me(c,i,l){let h=c[0],p=h.x,_=h.y;i(h);const y=[h];for(let w=1;w<c.length;w++){const S=c[w],{x:R,y:O}=S;i(S),_e(y,p,_,R,O,h,S,i,l),p=R,_=O,h=S}return y}function Le(c,i,l,h){if(h(i,l)){const p=i.add(l)._mult(.5);Le(c,i,p,h),Le(c,p,l,h)}else c.push(l)}function Ce(c,i){let l=c[0];const h=[l];for(let p=1;p<c.length;p++){const _=c[p];Le(h,l,_,i),l=_}return h}const Re=Math.pow(2,14)-1,Ae=-Re-1;function Te(c,i){const l=Math.round(c.x*i),h=Math.round(c.y*i);return c.x=ee(l,Ae,Re),c.y=ee(h,Ae,Re),(l<c.x||l>c.x+1||h<c.y||h>c.y+1)&&un("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function Fe(c,i,l){const h=c.loadGeometry(),p=c.extent,_=Qt/p;if(i&&l&&l.projection.isReprojectedInTileSpace){const y=1<<i.z,{scale:w,x:S,y:R,projection:O}=l,D=z=>{const V=j((i.x+z.x/p)/y),H=Z((i.y+z.y/p)/y),K=O.project(V,H);z.x=(K.x*w-S)*p,z.y=(K.y*w-R)*p};for(let z=0;z<h.length;z++)if(c.type!==1)h[z]=me(h[z],D,1);else{const V=[];for(const H of h[z])H.x<0||H.x>=p||H.y<0||H.y>=p||(D(H),V.push(H));h[z]=V}}for(const y of h)for(const w of y)Te(w,_);return h}function Xe(c,i){return{type:c.type,id:c.id,properties:c.properties,geometry:i?Fe(c):[]}}class He{constructor(i,l,h,p,_){this.properties={},this.extent=h,this.type=0,this.id=void 0,this._pbf=i,this._geometry=-1,this._keys=p,this._values=_,i.readFields(ct,this,l)}loadGeometry(){const i=this._pbf;i.pos=this._geometry;const l=i.readVarint()+i.pos,h=[];let p,_=1,y=0,w=0,S=0;for(;i.pos<l;){if(y<=0){const R=i.readVarint();_=7&R,y=R>>3}if(y--,_===1||_===2)w+=i.readSVarint(),S+=i.readSVarint(),_===1&&(p&&h.push(p),p=[]),p&&p.push(new Ve(w,S));else{if(_!==7)throw new Error(`unknown command ${_}`);p&&p.push(p[0].clone())}}return p&&h.push(p),h}bbox(){const i=this._pbf;i.pos=this._geometry;const l=i.readVarint()+i.pos;let h=1,p=0,_=0,y=0,w=1/0,S=-1/0,R=1/0,O=-1/0;for(;i.pos<l;){if(p<=0){const D=i.readVarint();h=7&D,p=D>>3}if(p--,h===1||h===2)_+=i.readSVarint(),y+=i.readSVarint(),_<w&&(w=_),_>S&&(S=_),y<R&&(R=y),y>O&&(O=y);else if(h!==7)throw new Error(`unknown command ${h}`)}return[w,R,S,O]}toGeoJSON(i,l,h){const p=this.extent*Math.pow(2,h),_=this.extent*i,y=this.extent*l,w=this.loadGeometry();function S(z){return[360*(z.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(z.y+y)/p)*Math.PI))-90]}function R(z){return z.map(S)}let O;if(this.type===1){const z=[];for(const H of w)z.push(H[0]);const V=R(z);O=z.length===1?{type:"Point",coordinates:V[0]}:{type:"MultiPoint",coordinates:V}}else if(this.type===2){const z=w.map(R);O=z.length===1?{type:"LineString",coordinates:z[0]}:{type:"MultiLineString",coordinates:z}}else{if(this.type!==3)throw new Error("unknown feature type");{const z=function(H){const K=H.length;if(K<=1)return[H];const re=[];let ne,ue;for(let he=0;he<K;he++){const ge=ht(H[he]);ge!==0&&(ue===void 0&&(ue=ge<0),ue===ge<0?(ne&&re.push(ne),ne=[H[he]]):ne&&ne.push(H[he]))}return ne&&re.push(ne),re}(w),V=[];for(const H of z)V.push(H.map(R));O=V.length===1?{type:"Polygon",coordinates:V[0]}:{type:"MultiPolygon",coordinates:V}}}const D={type:"Feature",geometry:O,properties:this.properties};return this.id!=null&&(D.id=this.id),D}}function ct(c,i,l){c===1?i.id=l.readVarint():c===2?function(h,p){const _=h.readVarint()+h.pos;for(;h.pos<_;){const y=p._keys[h.readVarint()],w=p._values[h.readVarint()];p.properties[y]=w}}(l,i):c===3?i.type=l.readVarint():c===4&&(i._geometry=l.pos)}function ht(c){let i=0;for(let l,h,p=0,_=c.length,y=_-1;p<_;y=p++)l=c[p],h=c[y],i+=(h.x-l.x)*(l.y+h.y);return i}He.types=["Unknown","Point","LineString","Polygon"];class St{constructor(i,l){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Ut,this,l),this.length=this._features.length}feature(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];const l=this._pbf.readVarint()+this._pbf.pos;return new He(this._pbf,l,this.extent,this._keys,this._values)}}function Ut(c,i,l){c===15?i.version=l.readVarint():c===1?i.name=l.readString():c===5?i.extent=l.readVarint():c===2?i._features.push(l.pos):c===3?i._keys.push(l.readString()):c===4&&i._values.push(function(h){let p=null;const _=h.readVarint()+h.pos;for(;h.pos<_;){const y=h.readVarint()>>3;p=y===1?h.readString():y===2?h.readFloat():y===3?h.readDouble():y===4?h.readVarint64():y===5?h.readVarint():y===6?h.readSVarint():y===7?h.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p}(l))}class rt{constructor(i,l){this.layers=i.readFields(Ue,{},l)}}function Ue(c,i,l){if(c===3){const h=new St(l,l.readVarint()+l.pos);h.length&&(i[h.name]=h)}}const _t="3d_elevation_id",lt="level";class Ot{constructor(){this._valid=!1}reset(i){return this.feature=i,this._valid=!0,this._geometry=i.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(i,l){return this._valid&&i(l(this._geometry)),this}require(i,l,h){return this.get(i,!0,l,h)}optional(i,l,h){return this.get(i,!1,l,h)}success(){return this._valid}get(i,l,h,p){const _=this.feature.properties.hasOwnProperty(i)?+this.feature.properties[i]:void 0;return this._valid&&_!==void 0&&!Number.isNaN(_)?h(p?p(_):_):l&&(this._valid=!1),this}}class en{constructor(i,l){this.featureFunc=i,this.vertexFunc=l}parseFeature(i,l,h){return this.featureFunc(i,l,h)}parseVertex(i,l,h){return this.vertexFunc(i,l,h)}}const yn=new en((c,i,l)=>c.reset(i).require(_t,h=>{l.id=h}).optional("fixed_height_relative",h=>{l.constantHeight=h},Ht.decodeRelativeHeight).geometry(h=>{l.bounds=h},Td).success(),(c,i,l)=>c.reset(i).require(_t,h=>{l.id=h}).require("elevation_idx",h=>{l.idx=h}).require("extent",h=>{l.extent=h}).require("height_relative",h=>{l.height=h},Ht.decodeRelativeHeight).geometry(h=>{l.position=h},Ht.getPoint).success()),Yt=new en((c,i,l)=>c.reset(i).require(_t,h=>{l.id=h}).optional("fixed_height",h=>{l.constantHeight=h},Ht.decodeMetricHeight).geometry(h=>{l.bounds=h},Td).success(),(c,i,l)=>c.reset(i).require(_t,h=>{l.id=h}).require("elevation_idx",h=>{l.idx=h}).require("extent",h=>{l.extent=h}).require("height",h=>{l.height=h},Ht.decodeMetricHeight).geometry(h=>{l.position=h},Ht.getPoint).success());class Ht{static getPoint(i){return ts(i[0][0].x,i[0][0].y)}static decodeRelativeHeight(i){return 1e-4*i*5}static decodeMetricHeight(i){return 1e-4*i}static getVersionSchema(i){return i?i==="1.0.1"?Yt:void 0:yn}static parse(i){const l=[],h=[],p=i.length,_=new Ot;for(let y=0;y<p;y++){const w=i.feature(y),S=w.properties.version,R=Ht.getVersionSchema(S);if(R===void 0){un(`Unknown elevation feature version number ${S||"(unknown)"}`);continue}const O=w.properties.type;if(!O)continue;const D=He.types[w.type];if(D==="Point"&&O==="curve_point"){const z={};R.parseVertex(_,w,z)&&l.push(z)}else if(D==="Polygon"&&O==="curve_meta"){const z={};R.parseFeature(_,w,z)&&h.push(z)}}return{vertices:l,features:h}}}class Ln{constructor(i,l){this.pos=i,this.dir=l}intersectsPlane(i,l,h){const p=Or(l,this.dir);if(Math.abs(p)<1e-6)return!1;const _=((i[0]-this.pos[0])*l[0]+(i[1]-this.pos[1])*l[1])/p;return h[0]=this.pos[0]+this.dir[0]*_,h[1]=this.pos[1]+this.dir[1]*_,!0}}class In{constructor(i,l){this.pos=i,this.dir=l}intersectsPlane(i,l,h){const p=En(l,this.dir);if(Math.abs(p)<1e-6)return!1;const _=((i[0]-this.pos[0])*l[0]+(i[1]-this.pos[1])*l[1]+(i[2]-this.pos[2])*l[2])/p;return h[0]=this.pos[0]+this.dir[0]*_,h[1]=this.pos[1]+this.dir[1]*_,h[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(i,l,h){if(function(V,H){var K=V[0],re=V[1],ne=V[2],ue=H[0],he=H[1],ge=H[2];return Math.abs(K-ue)<=v*Math.max(1,Math.abs(K),Math.abs(ue))&&Math.abs(re-he)<=v*Math.max(1,Math.abs(re),Math.abs(he))&&Math.abs(ne-ge)<=v*Math.max(1,Math.abs(ne),Math.abs(ge))}(this.pos,i)||l===0)return h[0]=h[1]=h[2]=0,!1;const[p,_,y]=this.dir,w=this.pos[0]-i[0],S=this.pos[1]-i[1],R=this.pos[2]-i[2],O=p*p+_*_+y*y,D=2*(w*p+S*_+R*y),z=D*D-4*O*(w*w+S*S+R*R-l*l);if(z<0){const V=Math.max(-D/2,0),H=w+p*V,K=S+_*V,re=R+y*V,ne=Math.hypot(H,K,re);return h[0]=H*l/ne,h[1]=K*l/ne,h[2]=re*l/ne,!1}{const V=(-D-Math.sqrt(z))/(2*O);if(V<0){const H=Math.hypot(w,S,R);return h[0]=w*l/H,h[1]=S*l/H,h[2]=R*l/H,!1}return h[0]=w+p*V,h[1]=S+_*V,h[2]=R+y*V,!0}}}class pn{constructor(i,l,h,p,_){this.TL=i,this.TR=l,this.BR=h,this.BL=p,this.horizon=_}static fromInvProjectionMatrix(i,l,h){const p=[-1,1,1],_=[1,1,1],y=[1,-1,1],w=[-1,-1,1],S=nn(p,p,i),R=nn(_,_,i),O=nn(y,y,i),D=nn(w,w,i);return new pn(S,R,O,D,l/h)}}function vn(c,i,l){let h=1/0,p=-1/0;const _=[];for(const y of c){Vn(_,y,i);const w=En(_,l);h=Math.min(h,w),p=Math.max(p,w)}return[h,p]}function er(c,i){let l=!0;for(let h=0;h<c.planes.length;h++){const p=c.planes[h];let _=0;for(let y=0;y<i.length;y++)_+=+(En(p,i[y])+p[3]>=0);if(_===0)return 0;_!==i.length&&(l=!1)}return l?2:1}function Lr(c,i){for(const l of c.projections){const h=vn(i,c.points[0],l.axis);if(l.projection[1]<h[0]||l.projection[0]>h[1])return 0}return 1}function hi(c,i){let l=0;const h=[0,0,0,0];for(let y=0;y<c.length;y++)h[0]=c[y][0],h[1]=c[y][1],h[2]=c[y][2],h[3]=1,(p=h)[0]*(_=i)[0]+p[1]*_[1]+p[2]*_[2]+p[3]*_[3]>=0&&l++;var p,_;return l}class Ni{constructor(i,l){this.points=i||new Array(8).fill([0,0,0]),this.planes=l||new Array(6).fill([0,0,0,0]),this.bounds=Dn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Vn([],this.points[2],this.points[3]),Vn([],this.points[0],this.points[3]),Vn([],this.points[4],this.points[0]),Vn([],this.points[5],this.points[1]),Vn([],this.points[6],this.points[2]),Vn([],this.points[7],this.points[3])];for(const h of this.frustumEdges){const p=[0,-h[2],h[1]],_=[h[2],0,-h[0]];this.projections.push({axis:p,projection:vn(this.points,this.points[0],p)}),this.projections.push({axis:_,projection:vn(this.points,this.points[0],_)})}}static fromInvProjectionMatrix(i,l,h,p){const _=Math.pow(2,h),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>{const O=$i([],R,i),D=1/O[3]/l*_;return(z=O)[0]=(V=O)[0]*(H=[D,D,p?1/O[3]:D,D])[0],z[1]=V[1]*H[1],z[2]=V[2]*H[2],z[3]=V[3]*H[3],z;var z,V,H}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(R=>{const O=Vt([],Sn([],Vn([],y[R[0]],y[R[1]]),Vn([],y[R[2]],y[R[1]]))),D=-En(O,y[R[1]]);return O.concat(D)}),S=[];for(let R=0;R<y.length;R++)S.push([y[R][0],y[R][1],y[R][2]]);return new Ni(S,w)}intersectsPrecise(i,l,h){for(let p=0;p<l.length;p++)if(!hi(i,l[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!hi(i,this.planes[p]))return 0;for(const p of h)for(const _ of this.frustumEdges){const y=Sn([],p,_),w=Pt(y);if(w===0)continue;ze(y,y,1/w);const S=vn(this.points,this.points[0],y),R=vn(i,this.points[0],y);if(S[0]>R[1]||R[0]>S[1])return 0}return 1}containsPoint(i){for(const l of this.planes){const h=l[3];if(En([l[0],l[1],l[2]],i)+h<0)return!1}return!0}}class Dn{static fromPoints(i){const l=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const p of i)gn(l,l,p),Et(h,h,p);return new Dn(l,h)}static fromTileIdAndHeight(i,l,h){const p=1<<i.canonical.z,_=i.canonical.x,y=i.canonical.y;return new Dn([_/p,y/p,l],[(_+1)/p,(y+1)/p,h])}static applyTransform(i,l){const h=i.getCorners();for(let p=0;p<h.length;++p)nn(h[p],h[p],l);return Dn.fromPoints(h)}static applyTransformFast(i,l){const h=[l[12],l[13],l[14]],p=[...h];for(let _=0;_<3;_++)for(let y=0;y<3;y++){const w=l[4*y+_],S=w*i.min[y],R=w*i.max[y];h[_]+=Math.min(S,R),p[_]+=Math.max(S,R)}return new Dn(h,p)}static projectAabbCorners(i,l){const h=i.getCorners();for(let p=0;p<h.length;++p)nn(h[p],h[p],l);return h}constructor(i,l){this.min=i,this.max=l,this.center=ze([],tt([],this.min,this.max),.5)}quadrant(i){const l=[i%2==0,i<2],h=Mt(this.min),p=Mt(this.max);for(let _=0;_<l.length;_++)h[_]=l[_]?this.min[_]:this.center[_],p[_]=l[_]?this.center[_]:this.max[_];return p[2]=this.max[2],new Dn(h,p)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,l=this.max;return[[i[0],i[1],i[2]],[l[0],i[1],i[2]],[l[0],l[1],i[2]],[i[0],l[1],i[2]],[i[0],i[1],l[2]],[l[0],i[1],l[2]],[l[0],l[1],l[2]],[i[0],l[1],l[2]]]}intersects(i){return this.intersectsAabb(i.bounds)?er(i,this.getCorners()):0}intersectsFlat(i){return this.intersectsAabb(i.bounds)?er(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(i,l){return l||this.intersects(i)?Lr(i,this.getCorners()):0}intersectsPreciseFlat(i,l){return l||this.intersectsFlat(i)?Lr(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(i){for(let l=0;l<3;++l)if(this.min[l]>i.max[l]||i.min[l]>this.max[l])return!1;return!0}intersectsAabbXY(i){return!(this.min[0]>i.max[0]||i.min[0]>this.max[0]||this.min[1]>i.max[1]||i.min[1]>this.max[1])}encapsulate(i){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],i.min[l]),this.max[l]=Math.max(this.max[l],i.max[l])}encapsulatePoint(i){for(let l=0;l<3;l++)this.min[l]=Math.min(this.min[l],i[l]),this.max[l]=Math.max(this.max[l],i[l])}closestPoint(i){return[Math.max(Math.min(this.max[0],i[0]),this.min[0]),Math.max(Math.min(this.max[1],i[1]),this.min[1]),Math.max(Math.min(this.max[2],i[2]),this.min[2])]}}An(Dn,"Aabb");class Oi{constructor(i,l){this.feature=i,this.metersToTile=l,this.index=0}get(){const i=this.feature.vertices[this.index],l=this.feature.vertexProps[this.index].dir,h=l[1],p=-l[0],_=(i.extent+1)*this.metersToTile;return[new Ve(Math.trunc(i.position[0]+h*_),Math.trunc(i.position[1]+p*_)),new Ve(Math.trunc(i.position[0]-h*_),Math.trunc(i.position[1]-p*_))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Pr{constructor(i,l,h,p,_,y){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[qr(),qr(),qr(),qr(),qr(),qr(),qr()],this.id=i,this.heightRange={min:h,max:h},this.safeArea=l,this.constantHeight=h,this.constantHeight==null&&(this.constantHeight!=null||p.length!==0)){this.vertices=p,this.edges=_,this.edges=this.edges.filter(w=>{return w.a<this.vertices.length&&w.b<this.vertices.length&&!((S=this.vertices[w.a].position)[0]===(R=this.vertices[w.b].position)[0]&&S[1]===R[1]);var S,R}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const w of this.vertices)this.vertexProps.push({dir:ts(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,w.height),this.heightRange.max=Math.max(this.heightRange.max,w.height);for(const w of this.edges){const S=this.vertices[w.a].position,R=this.vertices[w.b].position,O=Tt(qr(),R,S),D=on(O),z=ut(qr(),O,1/D);this.edgeProps.push({vec:O,dir:z,len:D});const V=this.vertexProps[w.a].dir,H=this.vertexProps[w.b].dir;Mn(V,V,z),Mn(H,H,z)}for(const w of this.vertexProps)w.dir[0]===0&&w.dir[1]===0||qn(w.dir,w.dir);this.tessellate(y)}}pointElevation(i){if(this.constantHeight!=null)return this.constantHeight;const l=this.getClosestEdge(i);if(l==null)return 0;const[h,p]=l;return br(this.vertices[this.edges[h].a].height,this.vertices[this.edges[h].b].height,p)}computeSlopeNormal(i,l){const h=this.getClosestEdge(i);if(!h)return Nt(0,0,1);const p=h[0],_=this.edges[p],y=this.edgeProps[p].vec,w=Nt(y[0],y[1],(this.vertices[_.b].height-this.vertices[_.a].height)*l),S=Nt(w[1],-w[0],0);Sn(S,S,w);const R=Pt(S);return R>0?ze(S,S,1/R):Kt(S,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(i){if(this.edges.length===0)return;let l=0,h=Number.POSITIVE_INFINITY,p=0;const[_,y,w,S,R,O,D]=this._tmpVec2;ms(D,i.x,i.y);const z=new Ln(D,null);for(let V=0;V<this.edges.length;V++){const H=this.edges[V],K=this.edgeProps[V].dir;z.dir=K;const re=this.vertices[H.a].position,ne=this.vertices[H.b].position,ue=z.intersectsPlane(re,this.vertexProps[H.a].dir,_),he=z.intersectsPlane(ne,this.vertexProps[H.b].dir,y);if(!ue||!he)continue;Tt(w,y,_),Tt(S,D,_);const ge=Or(w,w),ke=ge>0?Or(S,w)/ge:0,Ee=ee(ke,0,1),Me=Math.abs((ke-Ee)*this.edgeProps[V].len);Tt(R,D,re),ms(O,K[1],-K[0]);const Be=Me+Math.abs(Or(R,O));Be<h&&(l=V,h=Be,p=Ee)}return[l,p]}tessellate(i){const l=ft(),h=ft(),p=ft(),_=ft();for(let y=this.edges.length-1;y>=0;--y){const w=this.edges[y].a,S=this.edges[y].b,{position:R,height:O,extent:D}=this.vertices[w],{position:z,height:V,extent:H}=this.vertices[S],K=this.vertexProps[w].dir,re=this.vertexProps[S].dir;if(Kt(l,R[0]/i,R[1]/i,O),Kt(h,z[0]/i,z[1]/i,V),Kt(p,K[1],-K[0],0),ze(p,p,D),Kt(_,re[1],-re[0],0),ze(_,_,H),this.distSqLines(Nt(l[0]+.5*p[0],l[1]+.5*p[1],l[2]+.5*p[2]),Nt(h[0]-.5*_[0],h[1]-.5*_[1],h[2]-.5*_[2]),Nt(l[0]-.5*p[0],l[1]-.5*p[1],l[2]-.5*p[2]),Nt(h[0]+.5*_[0],h[1]+.5*_[1],h[2]+.5*_[2]))<=.0025000000000000005)continue;const ne=this.vertices.length,ue=Mn(qr(),R,z);this.vertices.push({position:ut(ue,ue,.5),height:.5*(O+V),extent:.5*(D+H)});const he=Mn(qr(),K,re);this.vertexProps.push({dir:qn(he,he)}),this.edges.splice(y,1),this.edgeProps.splice(y,1),this.edges.push({a:w,b:ne}),this.edges.push({a:ne,b:S});const ge=Tt(qr(),this.vertices[ne].position,R),ke=on(ge),Ee={vec:ge,dir:ut(qr(),ge,1/ke),len:ke};this.edgeProps.push(Ee),this.edgeProps.push(Ee)}}distSqLines(i,l,h,p){const _=mt(ft(),l,i),y=mt(ft(),p,h),w=mt(ft(),i,h),S=En(_,_),R=En(_,y),O=En(_,w),D=En(y,y),z=En(y,w),V=S*D-R*R;if(V===0)return fn(Un(_,h,p,En(w,y)/En(y,y)),i);const H=(S*z-R*O)/V;return fn(Un(_,i,l,(R*z-O*D)/V),Un(y,h,p,H))}}class Hi{static parseFrom(i,l){const h=Ht.parse(i);if(!h)return[];let{vertices:p,features:_}=h;const y=1/ae(l);_.sort((O,D)=>O.id-D.id),p.sort((O,D)=>O.id-D.id||O.idx-D.idx),p=p.filter((O,D,z)=>D===z.findIndex(V=>V.id===O.id&&V.idx===O.idx));const w=new Array;let S=0;const R=p.length;for(const O of _){if(O.constantHeight){w.push(new Pr(O.id,O.bounds,O.constantHeight));continue}for(;S!==R&&p[S].id<O.id;)S++;if(S===R||p[S].id!==O.id)continue;const D=new Array,z=new Array,V=S;for(;S!==R&&p[S].id===O.id;){const H=p[S];if(D.push({position:H.position,height:H.height,extent:H.extent}),S!==V&&p[S-1].idx===H.idx-1){const K=S-V;z.push({a:K-1,b:K})}S++}w.push(new Pr(O.id,O.bounds,void 0,D,z,y))}return w}static getElevationFeature(i,l){if(!l)return;const h=+i.properties[_t];return Number.isNaN(h)?void 0:l.find(p=>p.id===h)}}class is{constructor(i,l){this.zScale=1,this.xOffset=0,this.yOffset=0,i.equals(l)||(this.zScale=Math.pow(2,l.z-i.z),this.xOffset=(i.x*this.zScale-l.x)*Qt,this.yOffset=(i.y*this.zScale-l.y)*Qt)}constantElevation(i,l){if(i.constantHeight!=null)return this.computeBiasedHeight(i.constantHeight,l)}pointElevation(i,l,h){const p=this.constantElevation(l,h);return p??(i.x=i.x*this.zScale+this.xOffset,i.y=i.y*this.zScale+this.yOffset,this.computeBiasedHeight(l.pointElevation(i),h))}computeBiasedHeight(i,l){return l<=0?i:i+l*le(0,l,i>=0?i:Math.abs(.5*i))}}An(Pr,"ElevationFeature");class Ki{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new kh,this.indexArray=new Wa,this.segments=new ta,this.programConfigurations=new pc(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Id),this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,l){}updateAppearances(i,l,h,p){}populate(i,l,h,p){const _=this.layers[0],y=[];let w=null;_.type==="circle"&&(w=_.layout.get("circle-sort-key"));for(const{feature:R,id:O,index:D,sourceLayerIndex:z}of i){const V=this.layers[0]._featureFilter.needGeometry,H=Xe(R,V);if(!this.layers[0]._featureFilter.filter(new Rs(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),H,h))continue;const K=w?w.evaluate(H,{},h):void 0,re={id:O,properties:R.properties,type:R.type,sourceLayerIndex:z,index:D,geometry:V?H.geometry:Fe(R,h,p),patterns:{},sortKey:K};y.push(re)}w&&y.sort((R,O)=>R.sortKey-O.sortKey);let S=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new Ly,S=p.projection);for(const R of y){const{geometry:O,index:D,sourceLayerIndex:z}=R,V=i[D].feature;this.addFeature(R,O,D,l.availableImages,h,S,l.brightness,l.elevationFeatures),l.featureIndex.insert(V,O,D,z,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(i,l,h,p,_,y,w){this.programConfigurations.updatePaintArrays(i,l,_,h,p,y,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,JE.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,eS.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,tI.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(i,l,h,p,_,y,w,S){let R;this.elevationMode!=="none"&&(R=Hi.getElevationFeature(i,S));for(const O of l)for(const D of O){const z=D.x,V=D.y;if(z<0||z>=Qt||V<0||V>=Qt)continue;if(y){const re=y.projectTilePoint(z,V,_),ne=y.upVector(_,z,V);this.addGlobeExtVertex(re,ne),this.addGlobeExtVertex(re,ne),this.addGlobeExtVertex(re,ne),this.addGlobeExtVertex(re,ne)}const H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),K=H.vertexLength;if(this.addCircleVertex(z,V,-1,-1),this.addCircleVertex(z,V,1,-1),this.addCircleVertex(z,V,1,1),this.addCircleVertex(z,V,-1,1),this.elevationMode!=="none"){const re=R?R.pointElevation(new Ve(z,V)):0;this.hasElevation=this.hasElevation||re!==0;for(let ne=0;ne<4;ne++)this.elevatedLayoutVertexArray.emplaceBack(re)}this.indexArray.emplaceBack(K,K+1,K+2),this.indexArray.emplaceBack(K,K+2,K+3),H.vertexLength+=4,H.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{},p,_,w,void 0,this.worldview)}addCircleVertex(i,l,h,p){this.layoutVertexArray.emplaceBack(2*i+(h+1)/2,2*l+(p+1)/2)}addGlobeExtVertex(i,l){this.globeExtVertexArray.emplaceBack(i.x,i.y,i.z,l[0]*16384,l[1]*16384,l[2]*16384)}}function Ri(c,i){for(let l=0;l<c.length;l++)if(gs(i,c[l]))return!0;for(let l=0;l<i.length;l++)if(gs(c,i[l]))return!0;return!!Gs(c,i)}function Ur(c,i,l){return!!gs(c,i)||!!Bs(i,c,l)}function Ui(c,i){if(c.length===1)return na(i,c[0]);for(let l=0;l<i.length;l++){const h=i[l];for(let p=0;p<h.length;p++)if(gs(c,h[p]))return!0}for(let l=0;l<c.length;l++)if(na(i,c[l]))return!0;for(let l=0;l<i.length;l++)if(Gs(c,i[l]))return!0;return!1}function aa(c,i,l){if(c.length>1){if(Gs(c,i))return!0;for(let h=0;h<i.length;h++)if(Bs(i[h],c,l))return!0}for(let h=0;h<c.length;h++)if(Bs(c[h],i,l))return!0;return!1}function Gs(c,i){if(c.length===0||i.length===0)return!1;for(let l=0;l<c.length-1;l++){const h=c[l],p=c[l+1];for(let _=0;_<i.length-1;_++)if(Gi(h,p,i[_],i[_+1]))return!0}return!1}function Gi(c,i,l,h){return fr(c,l,h)!==fr(i,l,h)&&fr(c,i,l)!==fr(c,i,h)}function Ei(c,i,l){return(c.x-l.x)*(i.y-l.y)-(c.y-l.y)*(i.x-l.x)}function Vr(c,i,l,h){const p=Ei(c,i,h),_=Ei(c,i,l);if(Math.sign(p)===Math.sign(_))return;const y=Ei(l,h,c),w=y+_-p;return Math.sign(y)!==Math.sign(w)?[y/(y-w),_/(_-p)]:void 0}function Bs(c,i,l){const h=l*l;if(i.length===1)return c.distSqr(i[0])<h;for(let p=1;p<i.length;p++)if(Ea(c,i[p-1],i[p])<h)return!0;return!1}function Ea(c,i,l){const h=i.distSqr(l);if(h===0)return c.distSqr(i);const p=((c.x-i.x)*(l.x-i.x)+(c.y-i.y)*(l.y-i.y))/h;return c.distSqr(p<0?i:p>1?l:l.sub(i)._mult(p)._add(i))}function na(c,i){let l,h,p,_=!1;for(let y=0;y<c.length;y++){l=c[y];for(let w=0,S=l.length-1;w<l.length;S=w++)h=l[w],p=l[S],h.y>i.y!=p.y>i.y&&i.x<(p.x-h.x)*(i.y-h.y)/(p.y-h.y)+h.x&&(_=!_)}return _}function gs(c,i){let l=!1;for(let h=0,p=c.length-1;h<c.length;p=h++){const _=c[h],y=c[p];_.y>i.y!=y.y>i.y&&i.x<(y.x-_.x)*(i.y-_.y)/(y.y-_.y)+_.x&&(l=!l)}return l}function vl(c,i,l,h,p){for(const y of c)if(i<=y.x&&l<=y.y&&h>=y.x&&p>=y.y)return!0;const _=[new Ve(i,l),new Ve(i,p),new Ve(h,p),new Ve(h,l)];if(c.length>2){for(const y of _)if(gs(c,y))return!0}for(let y=0;y<c.length-1;y++)if(jo(c[y],c[y+1],_))return!0;return!1}function jo(c,i,l){const h=l[0],p=l[2];if(c.x<h.x&&i.x<h.x||c.x>p.x&&i.x>p.x||c.y<h.y&&i.y<h.y||c.y>p.y&&i.y>p.y)return!1;const _=fr(c,i,l[0]);return _!==fr(c,i,l[1])||_!==fr(c,i,l[2])||_!==fr(c,i,l[3])}function Xa(c,i,l,h,p,_){let y=i.y-c.y,w=c.x-i.x;if(_=_||0){const S=y*y+w*w;if(S===0)return!0;const R=Math.sqrt(S);y/=R,w/=R}return!((l.x-c.x)*y+(l.y-c.y)*w-_<0||(h.x-c.x)*y+(h.y-c.y)*w-_<0||(p.x-c.x)*y+(p.y-c.y)*w-_<0)}function Ko(c,i,l,h,p,_,y){return!(Xa(c,i,h,p,_,y)||Xa(i,l,h,p,_,y)||Xa(l,c,h,p,_,y)||Xa(h,p,c,i,l,y)||Xa(p,_,c,i,l,y)||Xa(_,h,c,i,l,y))}function Qo(c,i,l){const h=i.paint.get(c).value;return h.kind==="constant"?h.value:l.programConfigurations.get(i.id).getMaxValue(c)}function Po(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function hu(c,i,l,h,p){if(!i[0]&&!i[1])return c;const _=Ve.convert(i)._mult(p);l==="viewport"&&_._rotate(-h);const y=[];for(let w=0;w<c.length;w++)y.push(c[w].sub(_));return y}function ju(c,i,l,h){const p=Ve.convert(c)._mult(h);return i==="viewport"&&p._rotate(-l),p}let Rl,pa;function Ia(c,i,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[c*h-2*Math.PI*6378137/2,i*h-2*Math.PI*6378137/2]}An(Ki,"CircleBucket",{omit:["layers"]});class _s{constructor(i,l,h){this.z=i,this.x=l,this.y=h,this.key=ra(0,i,i,l,h)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}isChildOf(i){const l=this.z-i.z;return i.z===0||i.z<this.z&&i.x===this.x>>l&&i.y===this.y>>l}url(i,l){const h=function(_,y,w){var S=Ia(256*_,256*(y=Math.pow(2,w)-y-1),w),R=Ia(256*(_+1),256*(y+1),w);return S[0]+","+S[1]+","+R[0]+","+R[1]}(this.x,this.y,this.z),p=function(_,y,w){let S,R="";for(let O=_;O>0;O--)S=1<<O-1,R+=(y&S?1:0)+(w&S?2:0);return R}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class La{constructor(i,l){this.wrap=i,this.canonical=l,this.key=ra(i,l.z,l.z,l.x,l.y)}}class oa{constructor(i,l,h,p,_){this.overscaledZ=i,this.wrap=l,this.canonical=new _s(h,+p,+_),this.key=l===0&&i===h?this.canonical.key:ra(l,i,h,p,_)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const l=this.canonical.z-i;return i>this.canonical.z?new oa(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new oa(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l=!0){if(this.overscaledZ===i&&l)return this.key;if(i>this.canonical.z)return ra(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-i;return ra(this.wrap*+l,i,i,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.z<this.canonical.z&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new oa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,p=2*this.canonical.y;return[new oa(l,this.wrap,l,h,p),new oa(l,this.wrap,l,h+1,p),new oa(l,this.wrap,l,h,p+1),new oa(l,this.wrap,l,h+1,p+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new oa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new oa(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new La(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ra(c,i,l,h,p){const _=1<<Math.min(l,22);let y=_*(p%_)+h%_;return c&&l<22&&(y+=_*_*((c<0?-2*c-1:2*c)%(1<<2*(22-l)))),16*(32*y+l)+(i-l)}const Uu=[c=>{let i=c.canonical.x-1,l=c.wrap;return i<0&&(i=(1<<c.canonical.z)-1,l--),new oa(c.overscaledZ,l,c.canonical.z,i,c.canonical.y)},c=>{let i=c.canonical.x+1,l=c.wrap;return i===1<<c.canonical.z&&(i=0,l++),new oa(c.overscaledZ,l,c.canonical.z,i,c.canonical.y)},c=>new oa(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new oa(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];An(_s,"CanonicalTileID"),An(oa,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ug=ui([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:mc}=ug,cg=ui([{name:"a_pos_3",components:3,type:"Int16"}]);var Kp=ui([{name:"a_pos",type:"Int16",components:2}]);function Kc(c){return c*Yo/m}const Ld=[new Dn([Fu,Fu,Fu],[Bu,Bu,Bu]),new Dn([Fu,Fu,Fu],[0,0,Bu]),new Dn([0,Fu,Fu],[Bu,0,Bu]),new Dn([Fu,0,Fu],[0,Bu,Bu]),new Dn([0,0,Fu],[Bu,Bu,Bu])];function Qp(c,i,l,h=!0){const p=ze([],c._camera.position,c.worldSize),_=[i,l,1,1];$i(_,_,c.pixelMatrixInverse),Ai(_,_,1/_[3]);const y=Vt([],Vn([],_,p)),w=c.globeMatrix,S=[w[12],w[13],w[14]],R=Vn([],S,p),O=Pt(R),D=Vt([],R),z=c.worldSize/(2*Math.PI),V=En(D,y),H=Math.asin(z/O);if(H<Math.acos(V)){if(!h)return null;const pt=[],Ye=[];ze(pt,y,O/V),Vt(Ye,Vn(Ye,pt,R)),Vt(y,tt(y,R,ze(y,Ye,Math.tan(H)*O)))}const K=[];new In(p,y).closestPointOnSphere(S,z,K);const re=Vt([],Wi(w,0)),ne=Vt([],Wi(w,1)),ue=Vt([],Wi(w,2)),he=En(re,K),ge=En(ne,K),ke=En(ue,K),Ee=ti(Math.asin(-ge/z));let Me=ti(Math.atan2(he,ke));Me=c.center.lng+function(pt,Ye){const vt=(Ye-pt+180)%360-180;return vt<-180?vt+360:vt}(c.center.lng,Me);const Be=I(Me),$e=ee(M(Ee),0,1);return new pe(Be,$e)}class Ph{constructor(i,l,h){this.a=Vn([],i,h),this.b=Vn([],l,h),this.center=h;const p=Vt([],this.a),_=Vt([],this.b);this.angle=Math.acos(En(p,_))}}function Dd(c,i){if(c.angle===0)return null;let l;return l=c.a[i]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[i]/c.a[i]/Math.sin(c.angle)-1/Math.tan(c.angle)),l<0||l>1?null:function(h,p,_,y){const w=Math.sin(_);return h*(Math.sin((1-y)*_)/w)+p*(Math.sin(y*_)/w)}(c.a[i],c.b[i],c.angle,ee(l,0,1))+c.center[i]}function gc(c){if(c.z<=1)return Ld[c.z+2*c.y+c.x];const i=hI(tS(c));return Dn.fromPoints(i)}function Nd(c,i,l){return ze(c,c,1-l),$t(c,c,i,l)}function qD(c,i,l){for(const h of c)nn(h,h,i),ze(h,h,l)}function WD(c,i,l,h){const p=i/c.worldSize,_=c.globeMatrix;if(l.z<=1){const $e=gc(l).getCorners();return qD($e,_,p),Dn.fromPoints($e)}const y=tS(l,h),w=hI(y,Yo+Kc(c._tileCoverLift));qD(w,_,p);const S=Number.MAX_VALUE,R=[-S,-S,-S],O=[S,S,S];if(y.contains(c.center)){for(const Ye of w)gn(O,O,Ye),Et(R,R,Ye);R[2]=0;const $e=c.point,pt=[$e.x*p,$e.y*p,0];return gn(O,O,pt),Et(R,R,pt),new Dn(O,R)}if(c._tileCoverLift>0){for(const $e of w)gn(O,O,$e),Et(R,R,$e);return new Dn(O,R)}const D=[_[12]*p,_[13]*p,_[14]*p],z=y.getCenter(),V=ee(c.center.lat,-Y,Y),H=ee(z.lat,-Y,Y),K=I(c.center.lng),re=M(V);let ne=K-I(z.lng);const ue=re-M(H);ne>.5?ne-=1:ne<-.5&&(ne+=1);let he=0;Math.abs(ne)>Math.abs(ue)?he=ne>=0?1:3:(he=ue>=0?0:2,$t(D,D,[_[4]*p,_[5]*p,_[6]*p],-Math.sin(Tn(ue>=0?y.getSouth():y.getNorth()))*Yo));const ge=w[he],ke=w[(he+1)%4],Ee=new Ph(ge,ke,D),Me=[Dd(Ee,0)||ge[0],Dd(Ee,1)||ge[1],Dd(Ee,2)||ge[2]],Be=Jp(c.zoom);if(Be>0){const $e=function({x:Ye,y:vt,z:kt},It,Ft,jt,Lt){const Dt=1/(1<<kt);let yt=Ye*Dt,gt=yt+Dt,zt=vt*Dt,Jt=zt+Dt,Gt=0;const Fn=(yt+gt)/2-jt;return Fn>.5?Gt=-1:Fn<-.5&&(Gt=1),yt=((yt+Gt)*It-(jt*=It))*Ft+jt,gt=((gt+Gt)*It-jt)*Ft+jt,zt=(zt*It-(Lt*=It))*Ft+Lt,Jt=(Jt*It-Lt)*Ft+Lt,[[yt,Jt,0],[gt,Jt,0],[gt,zt,0],[yt,zt,0]]}(l,i,c._pixelsPerMercatorPixel,K,re);for(let Ye=0;Ye<w.length;Ye++)Nd(w[Ye],$e[Ye],Be);const pt=tt([],$e[he],$e[(he+1)%4]);ze(pt,pt,.5),Nd(Me,pt,Be)}for(const $e of w)gn(O,O,$e),Et(R,R,$e);return O[2]=Math.min(ge[2],ke[2]),gn(O,O,Me),Et(R,R,Me),new Dn(O,R)}function tS({x:c,y:i,z:l},h=!1){const p=1/(1<<l),_=new d(j(c*p),i===(1<<l)-1&&h?-90:Z((i+1)*p)),y=new d(j((c+1)*p),i===0&&h?90:Z(i*p));return new g(_,y)}function hI(c,i=Yo){const l=Tn(c.getNorth()),h=Tn(c.getSouth()),p=Math.cos(l),_=Math.cos(h),y=Math.sin(l),w=Math.sin(h),S=c.getWest(),R=c.getEast();return[zf(_,w,S,i),zf(_,w,R,i),zf(p,y,R,i),zf(p,y,S,i)]}function Cb(c,i,l,h){const p=1<<l.z,_=(c/Qt+l.x)/p;return Yp(Z((i/Qt+l.y)/p),j(_),h)}function nS({min:c,max:i}){return dI/Math.max(i[0]-c[0],i[1]-c[1],i[2]-c[2])}const ZD=new Float64Array(16);function rS(c){const i=nS(c),l=ve(ZD,[i,i,i]);return X(l,l,bn([],c.min))}function fI(c){const i=(h=c.min,(l=ZD)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=h[0],l[13]=h[1],l[14]=h[2],l[15]=1,l);var l,h;const p=1/nS(c);return ie(i,i,[p,p,p])}function pI(c){const i=Qt/(2*Math.PI);return c/(2*Math.PI)/i}function XD(c,i){return Qt/(512*Math.pow(2,c))*nS(gc(i))}function YD(c,i,l,h,p){const _=pI(l),y=[c,i,-l/(2*Math.PI)],w=q(new Float64Array(16));return X(w,w,y),ie(w,w,[_,_,_]),de(w,w,Tn(-p)),fe(w,w,Tn(-h)),w}function Jp(c){return le(zu,Ky,c)}function KD(c,i){const l=Yp(i.lat,i.lng),h=function(H){const K=Yp(H._center.lat,H._center.lng);let re=Sn([],Nt(0,1,0),K);const ne=Qe([],-H.angle,K);re=nn(re,re,ne),Qe(ne,-H._pitch,re);const ue=Vt([],K);return ze(ue,ue,Kc(H.cameraToCenterDistance/H.pixelsPerMeter)),nn(ue,ue,ne),tt([],K,ue)}(c);return y=(p=mt([],h,l))[0],w=p[1],S=p[2],R=(_=l)[0],O=_[1],D=_[2],V=(z=Math.sqrt((y*y+w*w+S*S)*(R*R+O*O+D*D)))&&En(p,_)/z,Math.acos(Math.min(Math.max(V,-1),1));var p,_,y,w,S,R,O,D,z,V}function mI(c,i){return KD(c,i)>Math.PI/2*1.01}const QD=Tn(85),Kne=Math.cos(QD),Qne=Math.sin(QD),Jne=F(),JD=c=>{const i=[];return c.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i};function eN(c,i,l,h,p,_,y,w,S){if(_&&c.queryGeometry.isAboveHorizon)return!1;_&&(S*=c.pixelToTileUnitsFactor);const R=c.tileID.canonical,O=l.projection.upVectorScale(R,l.center.lat,l.worldSize).metersToTile;for(const D of i)for(const z of D){const V=z.add(w),H=p&&l.elevation?l.elevation.exaggeration()*p.getElevationAt(V.x,V.y,!0):0,K=l.projection.projectTilePoint(V.x,V.y,R);if(H>0){const he=l.projection.upVector(R,V.x,V.y);K.x+=he[0]*O*H,K.y+=he[1]*O*H,K.z+=he[2]*O*H}const re=_?V:ere(K.x,K.y,K.z,h),ne=_?c.tilespaceRays.map(he=>nre(he,H)):c.queryGeometry.screenGeometry,ue=$i([],[K.x,K.y,K.z,1],h);if(!y&&_?S*=ue[3]/l.cameraToCenterDistance:y&&!_&&(S*=l.cameraToCenterDistance/ue[3]),_){const he=Z((z.y/Qt+R.y)/(1<<R.z));S/=l.projection.pixelsPerMeter(he,1)/N(1,he)}if(Ur(ne,re,S))return!0}return!1}function ere(c,i,l,h){const p=$i([],[c,i,l,1],h);return new Ve(p[0]/p[3],p[1]/p[3])}const tN=Nt(0,0,0),tre=Nt(0,0,1);function nre(c,i){const l=ft();return tN[2]=i,c.intersectsPlane(tN,tre,l),new Ve(l[0],l[1])}class nN extends Ki{}let rN,iN,sN,aN;function oN(c,{width:i,height:l},h,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==i*l*h)throw new RangeError("mismatched image size")}else p=new Uint8Array(i*l*h);return c.width=i,c.height=l,c.data=p,c}function lN(c,i,l){const{width:h,height:p}=i;h===c.width&&p===c.height||(gI(c,i,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,h),height:Math.min(c.height,p)},l,null),c.width=h,c.height=p,c.data=i.data)}function gI(c,i,l,h,p,_,y,w){if(p.width===0||p.height===0)return i;if(p.width>c.width||p.height>c.height||l.x>c.width-p.width||l.y>c.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>i.width||p.height>i.height||h.x>i.width-p.width||h.y>i.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const S=c.data,R=i.data,O=_===4&&w;for(let D=0;D<p.height;D++){const z=((l.y+D)*c.width+l.x)*_,V=((h.y+D)*i.width+h.x)*_;if(O)for(let H=0;H<p.width;H++){const K=z+H*_+3,re=V+H*_;R[re+0]=255,R[re+1]=255,R[re+2]=255,R[re+3]=S[K]}else if(y)for(let H=0;H<p.width;H++){const K=z+H*_,re=V+H*_,ne=new Yi(S[K+0]/255,S[K+1]/255,S[K+2]/255,S[K+3]).toNonPremultipliedRenderColor(y).toArray();R[re+0]=ne[0],R[re+1]=ne[1],R[re+2]=ne[2],R[re+3]=ne[3]}else for(let H=0;H<p.width*_;H++)R[V+H]=S[z+H]}return i}An(nN,"HeatmapBucket",{omit:["layers"]});class em{constructor(i,l){oN(this,i,1,l)}resize(i){lN(this,new em(i),1)}clone(){return new em({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,p,_){gI(i,l,h,p,_,1,null)}}class Jo{constructor(i,l){oN(this,i,4,l)}resize(i){lN(this,new Jo(i),4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Jo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,p,_,y,w){gI(i,l,h,p,_,4,y,w)}}class uN{constructor(i,l){this.width=i.width,this.height=i.height,this.data=l instanceof Uint8Array?new Float32Array(l.buffer):l}}function kb(c){const i={},l=c.resolution||256,h=c.clips?c.clips.length:1,p=c.image||new Jo({width:l,height:h}),_=(y,w,S)=>{i[c.evaluationKey]=S;const R=c.expression.evaluate(i),O=R?R.toNonPremultipliedRenderColor(null):null;O&&(p.data[y+w+0]=Math.floor(255*O.r),p.data[y+w+1]=Math.floor(255*O.g),p.data[y+w+2]=Math.floor(255*O.b),p.data[y+w+3]=Math.floor(255*O.a))};if(c.clips)for(let y=0,w=0;y<h;++y,w+=4*l)for(let S=0,R=0;S<l;S++,R+=4){const O=S/(l-1),{start:D,end:z}=c.clips[y];_(w,R,D*(1-O)+z*O)}else for(let y=0,w=0;y<l;y++,w+=4)_(0,w,y/(l-1));return p}An(em,"AlphaImage"),An(Jo,"RGBAImage");const rre=ui([{name:"a_pos",components:2,type:"Int16"}],4),ire=ui([{name:"a_road_z_offset",components:1,type:"Float32"}],4),sre=ui([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),are=ui([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Qy(c,i,l=2){const h=i&&i.length,p=h?i[0]*l:c.length;let _=cN(c,0,p,l,!0);const y=[];if(!_||_.next===_.prev)return y;let w,S,R;if(h&&(_=function(O,D,z,V){const H=[];for(let K=0,re=D.length;K<re;K++){const ne=cN(O,D[K]*V,K<re-1?D[K+1]*V:O.length,V,!1);ne===ne.next&&(ne.steiner=!0),H.push(pre(ne))}H.sort(dre);for(let K=0;K<H.length;K++)z=hre(H[K],z);return z}(c,i,_,l)),c.length>80*l){w=c[0],S=c[1];let O=w,D=S;for(let z=l;z<p;z+=l){const V=c[z],H=c[z+1];V<w&&(w=V),H<S&&(S=H),V>O&&(O=V),H>D&&(D=H)}R=Math.max(O-w,D-S),R=R!==0?32767/R:0}return Ib(_,y,l,w,S,R,0),y}function cN(c,i,l,h,p){let _;if(p===function(y,w,S,R){let O=0;for(let D=w,z=S-R;D<S;D+=R)O+=(y[z]-y[D])*(y[D+1]+y[z+1]),z=D;return O}(c,i,l,h)>0)for(let y=i;y<l;y+=h)_=pN(y/h|0,c[y],c[y+1],_);else for(let y=l-h;y>=i;y-=h)_=pN(y/h|0,c[y],c[y+1],_);return _&&Jy(_,_.next)&&(Pb(_),_=_.next),_}function dg(c,i){if(!c)return c;i||(i=c);let l,h=c;do if(l=!1,h.steiner||!Jy(h,h.next)&&To(h.prev,h,h.next)!==0)h=h.next;else{if(Pb(h),h=i=h.prev,h===h.next)break;l=!0}while(l||h!==i);return i}function Ib(c,i,l,h,p,_,y){if(!c)return;!y&&_&&function(S,R,O,D){let z=S;do z.z===0&&(z.z=_I(z.x,z.y,R,O,D)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==S);z.prevZ.nextZ=null,z.prevZ=null,function(V){let H,K=1;do{let re,ne=V;V=null;let ue=null;for(H=0;ne;){H++;let he=ne,ge=0;for(let Ee=0;Ee<K&&(ge++,he=he.nextZ,he);Ee++);let ke=K;for(;ge>0||ke>0&&he;)ge!==0&&(ke===0||!he||ne.z<=he.z)?(re=ne,ne=ne.nextZ,ge--):(re=he,he=he.nextZ,ke--),ue?ue.nextZ=re:V=re,re.prevZ=ue,ue=re;ne=he}ue.nextZ=null,K*=2}while(H>1)}(z)}(c,h,p,_);let w=c;for(;c.prev!==c.next;){const S=c.prev,R=c.next;if(_?lre(c,h,p,_):ore(c))i.push(S.i,c.i,R.i),Pb(c),c=R.next,w=R.next;else if((c=R)===w){y?y===1?Ib(c=ure(dg(c),i),i,l,h,p,_,2):y===2&&cre(c,i,l,h,p,_):Ib(dg(c),i,l,h,p,_,1);break}}}function ore(c){const i=c.prev,l=c,h=c.next;if(To(i,l,h)>=0)return!1;const p=i.x,_=l.x,y=h.x,w=i.y,S=l.y,R=h.y,O=Math.min(p,_,y),D=Math.min(w,S,R),z=Math.max(p,_,y),V=Math.max(w,S,R);let H=h.next;for(;H!==i;){if(H.x>=O&&H.x<=z&&H.y>=D&&H.y<=V&&Rb(p,w,_,S,y,R,H.x,H.y)&&To(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function lre(c,i,l,h){const p=c.prev,_=c,y=c.next;if(To(p,_,y)>=0)return!1;const w=p.x,S=_.x,R=y.x,O=p.y,D=_.y,z=y.y,V=Math.min(w,S,R),H=Math.min(O,D,z),K=Math.max(w,S,R),re=Math.max(O,D,z),ne=_I(V,H,i,l,h),ue=_I(K,re,i,l,h);let he=c.prevZ,ge=c.nextZ;for(;he&&he.z>=ne&&ge&&ge.z<=ue;){if(he.x>=V&&he.x<=K&&he.y>=H&&he.y<=re&&he!==p&&he!==y&&Rb(w,O,S,D,R,z,he.x,he.y)&&To(he.prev,he,he.next)>=0||(he=he.prevZ,ge.x>=V&&ge.x<=K&&ge.y>=H&&ge.y<=re&&ge!==p&&ge!==y&&Rb(w,O,S,D,R,z,ge.x,ge.y)&&To(ge.prev,ge,ge.next)>=0))return!1;ge=ge.nextZ}for(;he&&he.z>=ne;){if(he.x>=V&&he.x<=K&&he.y>=H&&he.y<=re&&he!==p&&he!==y&&Rb(w,O,S,D,R,z,he.x,he.y)&&To(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;ge&&ge.z<=ue;){if(ge.x>=V&&ge.x<=K&&ge.y>=H&&ge.y<=re&&ge!==p&&ge!==y&&Rb(w,O,S,D,R,z,ge.x,ge.y)&&To(ge.prev,ge,ge.next)>=0)return!1;ge=ge.nextZ}return!0}function ure(c,i){let l=c;do{const h=l.prev,p=l.next.next;!Jy(h,p)&&hN(h,l,l.next,p)&&Mb(h,p)&&Mb(p,h)&&(i.push(h.i,l.i,p.i),Pb(l),Pb(l.next),l=c=p),l=l.next}while(l!==c);return dg(l)}function cre(c,i,l,h,p,_){let y=c;do{let w=y.next.next;for(;w!==y.prev;){if(y.i!==w.i&&mre(y,w)){let S=fN(y,w);return y=dg(y,y.next),S=dg(S,S.next),Ib(y,i,l,h,p,_,0),void Ib(S,i,l,h,p,_,0)}w=w.next}y=y.next}while(y!==c)}function dre(c,i){let l=c.x-i.x;return l===0&&(l=c.y-i.y,l===0)&&(l=(c.next.y-c.y)/(c.next.x-c.x)-(i.next.y-i.y)/(i.next.x-i.x)),l}function hre(c,i){const l=function(p,_){let y=_;const w=p.x,S=p.y;let R,O=-1/0;if(Jy(p,y))return y;do{if(Jy(p,y.next))return y.next;if(S<=y.y&&S>=y.next.y&&y.next.y!==y.y){const K=y.x+(S-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(K<=w&&K>O&&(O=K,R=y.x<y.next.x?y:y.next,K===w))return R}y=y.next}while(y!==_);if(!R)return null;const D=R,z=R.x,V=R.y;let H=1/0;y=R;do{if(w>=y.x&&y.x>=z&&w!==y.x&&dN(S<V?w:O,S,z,V,S<V?O:w,S,y.x,y.y)){const K=Math.abs(S-y.y)/(w-y.x);Mb(y,p)&&(K<H||K===H&&(y.x>R.x||y.x===R.x&&fre(R,y)))&&(R=y,H=K)}y=y.next}while(y!==D);return R}(c,i);if(!l)return i;const h=fN(l,c);return dg(h,h.next),dg(l,l.next)}function fre(c,i){return To(c.prev,c,i.prev)<0&&To(i.next,c,c.next)<0}function _I(c,i,l,h,p){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-l)*p|0)|c<<8))|c<<4))|c<<2))|c<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-h)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function pre(c){let i=c,l=c;do(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next;while(i!==c);return l}function dN(c,i,l,h,p,_,y,w){return(p-y)*(i-w)>=(c-y)*(_-w)&&(c-y)*(h-w)>=(l-y)*(i-w)&&(l-y)*(_-w)>=(p-y)*(h-w)}function Rb(c,i,l,h,p,_,y,w){return!(c===y&&i===w)&&dN(c,i,l,h,p,_,y,w)}function mre(c,i){return c.next.i!==i.i&&c.prev.i!==i.i&&!function(l,h){let p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==h.i&&p.next.i!==h.i&&hN(p,p.next,l,h))return!0;p=p.next}while(p!==l);return!1}(c,i)&&(Mb(c,i)&&Mb(i,c)&&function(l,h){let p=l,_=!1;const y=(l.x+h.x)/2,w=(l.y+h.y)/2;do p.y>w!=p.next.y>w&&p.next.y!==p.y&&y<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(_=!_),p=p.next;while(p!==l);return _}(c,i)&&(To(c.prev,c,i.prev)||To(c,i.prev,i))||Jy(c,i)&&To(c.prev,c,c.next)>0&&To(i.prev,i,i.next)>0)}function To(c,i,l){return(i.y-c.y)*(l.x-i.x)-(i.x-c.x)*(l.y-i.y)}function Jy(c,i){return c.x===i.x&&c.y===i.y}function hN(c,i,l,h){const p=sS(To(c,i,l)),_=sS(To(c,i,h)),y=sS(To(l,h,c)),w=sS(To(l,h,i));return p!==_&&y!==w||!(p!==0||!iS(c,l,i))||!(_!==0||!iS(c,h,i))||!(y!==0||!iS(l,c,h))||!(w!==0||!iS(l,i,h))}function iS(c,i,l){return i.x<=Math.max(c.x,l.x)&&i.x>=Math.min(c.x,l.x)&&i.y<=Math.max(c.y,l.y)&&i.y>=Math.min(c.y,l.y)}function sS(c){return c>0?1:c<0?-1:0}function Mb(c,i){return To(c.prev,c,c.next)<0?To(c,i,c.next)>=0&&To(c,c.prev,i)>=0:To(c,i,c.prev)<0||To(c,c.next,i)<0}function fN(c,i){const l=yI(c.i,c.x,c.y),h=yI(i.i,i.x,i.y),p=c.next,_=i.prev;return c.next=i,i.prev=c,l.next=p,p.prev=l,h.next=l,l.prev=h,_.next=h,h.prev=_,h}function pN(c,i,l,h){const p=yI(c,i,l);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function Pb(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function yI(c,i,l){return{i:c,x:i,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Ob(c,i){const l=c.length;if(l<=1)return[c];const h=[];let p,_;for(let y=0;y<l;y++){const w=Tr(c[y]);w!==0&&(c[y].area=Math.abs(w),_===void 0&&(_=w<0),_===w<0?(p&&h.push(p),p=[c[y]]):p.push(c[y]))}if(p&&h.push(p),i>1)for(let y=0;y<h.length;y++)h[y].length<=i||(Y_(h[y],i,1,h[y].length-1,gre),h[y]=h[y].slice(0,i));return h}function gre(c,i){return i.area-c.area}function mN(c,i,l=1){if(!c)return null;const h=typeof c=="string"?ml.from(c).getPrimary():c.getPrimary(),p=typeof c=="string"?null:c.getSecondary();for(const _ of[h,p]){if(!_)continue;const y=_.id.toString();i.has(y)||i.set(y,[]),_.scaleSelf(l),i.get(y).push(_)}return{primary:h.toString(),secondary:p?p.toString():null}}function vI(c,i,l,h){const p=h.patternDependencies;let _=!1;for(const y of i){const w=y.paint.get(`${c}-pattern`);w.isConstant()||(_=!0),mN(w.constantOr(null),p,l)&&(_=!0)}return _}function xI(c,i,l,h,p,_){const y=_.patternDependencies;for(const w of i){const S=w.paint.get(`${c}-pattern`).value;if(S.kind!=="constant"){let R=S.evaluate({zoom:h},l,{},_.availableImages);R=R&&R.name?R.name:R;const O=mN(R,y,p);if(!O)continue;const{primary:D,secondary:z}=O;D&&(l.patterns[w.id]=[D,z].filter(Boolean))}}return l}class gN{constructor(){this.polygons=new Map}add(i,...l){const h=this.polygons.get(i);h?h.push(...l):this.polygons.set(i,l)}merge(i){for(const[l,h]of i.polygons)this.add(l,...h)}}class Ff{constructor(){this.portals=[]}static isOnBorder(i,l){return i<=0&&l<=0||i>=Qt&&l>=Qt}static evaluate(i){if(i.length===0)return new Ff;let l=[];for(const S of i)l.push(...S.portals);if(l.length===0)return new Ff;for(const S of l){const R=S.va,O=S.vb;(Ff.isOnBorder(R.x,O.x)||Ff.isOnBorder(R.y,O.y))&&(S.type="border")}const h=l.filter(S=>S.type!=="unevaluated"),p=l.filter(S=>S.type==="unevaluated");if(p.length===0)return new Ff;p.sort((S,R)=>S.hash===R.hash?S.isTunnel===R.isTunnel?0:S.isTunnel?-1:1:S.hash<R.hash?1:-1),l=h.concat(p);let _=h.length,y=_,w=_;do if(y++,y===l.length||l[_].hash!==l[y].hash){if(y-_==2){w<_&&(l[w]=l[_],l[_]=null);const S=l[w],R=l[y-1];S.type=S.isTunnel!==R.isTunnel?"tunnel":"polygon",S.connection={a:S.connection.a,b:R.connection.a},w++}_=y}while(_!==l.length);return l.splice(w),l.sort((S,R)=>S.hash<R.hash?1:-1),{portals:l}}}An(Ff,"ElevationPortalGraph"),An(gN,"ElevationPolygons");class _re{constructor(i,l,h){this.outPositions=i,this.outNormals=l,this.outIndices=h,this.vertexLookup=new Map}addVertex(i,l,h){let p=i[2];h!=null&&(p*=h);const _=`${i[0]},${i[1]},${i[2]},${l[0]},${l[1]},${l[2]}`,y=this.vertexLookup.get(_);if(y!=null)return y;const w=this.outPositions.length;this.vertexLookup.set(_,w);const S=Math.trunc(16384*l[0]),R=Math.trunc(16384*l[1]),O=Math.trunc(16384*l[2]);return this.outPositions.emplaceBack(i[0],i[1],p),this.outNormals.emplaceBack(S,R,O),w}addTriangle(i,l,h){this.outIndices.emplaceBack(i,l,h)}addTriangles(i,l,h){if(i.length===0)return;const p=h.length===1,_=ft(),y=ft();for(let w=0;w<i.length;w+=3){const S=l[i[w+0]],R=l[i[w+1]],O=l[i[w+2]],D=p?h[0]:h[i[w+1]],z=p?h[0]:h[i[w+2]];Kt(_,S.x,S.y,p?h[0]:h[i[w+0]]);const V=this.addVertex(_,y);Kt(_,R.x,R.y,D);const H=this.addVertex(_,y);Kt(_,O.x,O.y,z);const K=this.addVertex(_,y);this.outIndices.emplaceBack(V,H,K)}}addQuad(i,l,h,p,_,y){const w=this.addVertex(i,_,y),S=this.addVertex(l,_,y),R=this.addVertex(h,_,y),O=this.addVertex(p,_,y);this.addTriangle(w,S,R),this.addTriangle(R,O,w)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class fu{constructor(i,l,h,p){this.unevaluatedPortals=new Ff,this.portalPolygons=new gN,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new ob,this.vertexNormals=new lb,this.indexArray=new Wa,this.tileToMeters=ae(i),this.bridgeProgramConfigurations=new pc(l,{zoom:h,lut:p},_=>_!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new pc(l,{zoom:h,lut:p},_=>_!=="fill-bridge-guard-rail-color")}addVertices(i,l){const h=this.unevalVertices.length;for(let p=0;p<i.length;p++)this.unevalVertices.push(i[p]),this.unevalHeights.push(l[p]);return h}addTriangles(i,l,h){const p=h?this.unevalTunnelTriangles:this.unevalTriangles;for(const _ of i)p.push(_+l)}addRenderableRing(i,l,h,p,_,y){const w=[new Ve(_.min.x,_.min.y),new Ve(_.max.x,_.min.y),new Ve(_.max.x,_.max.y),new Ve(_.min.x,_.max.y)];for(let S=0;S<h-1;S++){const R=l+S,O=R+1,D=this.unevalVertices[R],z=this.unevalVertices[O];if(!(D.x>=_.min.x&&D.x<=_.max.x&&D.y>=_.min.y&&D.y<=_.max.y||z.x>=_.min.x&&z.x<=_.max.x&&z.y>=_.min.y&&z.y<=_.max.y||jo(D,z,w))||this.isOnBorder(D.x,z.x)||this.isOnBorder(D.y,z.y))continue;const V=fu.computeEdgeHash(this.unevalVertices[R],this.unevalVertices[O]);let H,K=this.vertexHashLookup.get(fu.computePosHash(D));K!=null?H=K.next:(K=this.vertexHashLookup.get(fu.computePosHash(z)),H=K!=null?K.prev:V),this.unevalEdges.push({polygonIdx:i,a:R,b:O,hash:V,portalHash:H,isTunnel:p,type:"unevaluated",featureInfo:y})}}addPortalCandidates(i,l,h,p,_){if(l.length===0)return;this.portalPolygons.add(i,{geometry:l,zLevel:_});const y=l[0];this.vertexHashLookup.clear();let w=fu.computeEdgeHash(y[y.length-2],y[y.length-1]);for(let S=0;S<y.length-1;S++){const R=y[S+0],O=y[S+1],D=ts(O.x-R.x,O.y-R.y),z=on(D);if(z===0)continue;let V="unevaluated";const H=p.pointElevation(R),K=p.pointElevation(O);Math.abs(H)<.01&&Math.abs(K)<.01?V="entrance":(this.isOnBorder(R.x,O.x)||this.isOnBorder(R.y,O.y))&&(V="border");const re=fu.computeEdgeHash(R,O);this.unevaluatedPortals.portals.push({connection:{a:i,b:void 0},va:R,vb:O,vab:D,length:z,hash:re,isTunnel:h,type:V});const ne=fu.computePosHash(R);this.vertexHashLookup.set(ne,{prev:w,next:re}),w=re}}construct(i){if(this.unevalVertices.length===0)return;const l=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),h=z=>{z.primitiveLength=this.indexArray.length-z.primitiveOffset},p=new _re(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(i.portals,this.unevalEdges);const _=l(),y=l(),w=l(),S=(z,V)=>{z.sort((K,re)=>K.type===V&&re.type!==V?-1:K.type!==V&&re.type===V?1:0);const H=z.findIndex(K=>K.type!==V);return H>=0?H:z.length};let R=0;this.unevalEdges.length>0&&(R=S(this.unevalEdges,"none"),this.constructBridgeStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:R},this.tileToMeters)),h(w);const O=l(),D=l();if(this.unevalEdges.length>0){const z=this.unevalEdges.splice(R),V=S(z,"tunnel")+R;this.unevalEdges.push(...z),this.constructTunnelStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:R},{min:R,max:V})}h(O),p.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),h(D),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),h(y),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),h(_),this.maskSegments=ta.simpleSegment(0,D.primitiveOffset,0,D.primitiveLength),this.depthSegments=ta.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableBridgeSegments=ta.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.renderableTunnelSegments=ta.simpleSegment(0,O.primitiveOffset,0,O.primitiveLength),this.shadowCasterSegments=ta.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength)}update(i,l,h,p,_,y,w,S){this.bridgeProgramConfigurations.updatePaintArrays(i,l,_,h,p,y,w,S),this.tunnelProgramConfigurations.updatePaintArrays(i,l,_,h,p,y,w,S)}upload(i){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=i.createVertexBuffer(this.vertexPositions,sre.members),this.vertexBufferNormal=i.createVertexBuffer(this.vertexNormals,are.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(i),this.tunnelProgramConfigurations.upload(i))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(i,l,h,p,_){const y=(w,S)=>{for(let R=0;R<S.length-1;R++){const O=S[R].featureIndex,D=S[R+1].vertexStart,z=i.feature(O);w.populatePaintArrays(D,z,O,{},h,l,p,void 0,_)}};y(this.bridgeProgramConfigurations,this.bridgeFeatureSections),y(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(i,l,h,p,_){const y=new Map;for(let w=p;w<_;w++){const S=h[w],R=S.a,O=S.b,D=fu.computePosHash(i[R]),z=fu.computePosHash(i[O]);let V=y.get(D);V||(V={},y.set(D,V));let H=y.get(z);H||(H={},y.set(z,H)),l[R]<=0&&l[O]<=0||(V.to=O,H.from=R)}return y}isTerminalVertex(i,l){const h=fu.computePosHash(this.unevalVertices[i]),p=l.get(h);return!p||!p.from||!p.to}constructBridgeStructures(i,l,h,p,_,y){i.clearVertexLookup();const w=this.computeVertexConnections(l,h,p,_.min,_.max),S=1/y,R=.5*S,O=(Ft,jt)=>Kt(Ft,l[jt].x,l[jt].y,h[jt]*S),D=ft(),z=ft(),V=ft(),H=ft(),K=ft(),re=(Ft,jt)=>{const Lt=w.get(fu.computePosHash(l[jt])),Dt=Lt.from,yt=Lt.to;if(!Dt||!yt)return;O(D,Dt),O(z,jt),O(V,yt),ar(H),tr(D,z)||(Vn(K,z,D),Vt(H,K)),tr(V,z)||(Vn(K,V,z),tt(H,H,Vt(K,K)));const gt=ws(H);return gt>0?ze(Ft,H,1/gt):void 0};let ne=Number.POSITIVE_INFINITY;this.sortSubarray(p,_.min,_.max,(Ft,jt)=>Ft.featureInfo.featureIndex-jt.featureInfo.featureIndex);const ue=ft(),he=ft(),ge=ft(),ke=ft(),Ee=ft(),Me=ft(),Be=ft(),$e=ft(),pt=ft(),Ye=[ft(),ft(),ft(),ft()],vt=[ft(),ft(),ft(),ft()],kt=[{coord:new Ve(0,0),height:0},{coord:new Ve(0,0),height:0}],It=(Ft,jt)=>Ft>jt;for(let Ft=_.min;Ft<_.max;Ft++){const jt=p[Ft];if(!jt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(kt,l,h,jt,It))continue;const[Lt,Dt]=kt;if(Kt(ue,Lt.coord.x,Lt.coord.y,S*Lt.height),Kt(he,Dt.coord.x,Dt.coord.y,S*Dt.height),tr(ue,he))continue;Vn(ge,he,ue),Vt(ge,ge);const yt=re($e,jt.a)||ge,gt=re(pt,jt.b)||ge;Kt(ke,yt[1],-yt[0],0),Vt(ke,ke),Kt(Ee,gt[1],-gt[0],0),Vt(Ee,Ee),Sn($e,ke,yt),Vt(Me,$e),Sn($e,Ee,gt),Vt(Be,$e),tt(Ye[0],ue,ze($e,Vn($e,ke,Me),R)),tt(Ye[1],ue,ze($e,tt($e,ke,Me),R)),tt(Ye[2],ue,ze($e,Me,R)),Ye[3]=ue,tt(vt[0],he,ze($e,Vn($e,Ee,Be),R)),tt(vt[1],he,ze($e,tt($e,Ee,Be),R)),tt(vt[2],he,ze($e,Be,R)),vt[3]=he,ne=this.addFeatureSection(jt.featureInfo.featureIndex,ne,this.bridgeFeatureSections,i);const zt=i.addVertex(Ye[0],ke,y),Jt=i.addVertex(Ye[1],ke,y),Gt=i.addVertex(vt[0],Ee,y),Fn=i.addVertex(vt[1],Ee,y);i.addTriangle(zt,Jt,Gt),i.addTriangle(Jt,Fn,Gt);const mn=i.addVertex(Ye[1],Me,y),xn=i.addVertex(Ye[2],Me,y),Pn=i.addVertex(vt[1],Be,y),Yr=i.addVertex(vt[2],Be,y);i.addTriangle(mn,xn,Pn),i.addTriangle(xn,Yr,Pn),bn(ke,ke),bn(Ee,Ee);const Wt=i.addVertex(Ye[2],ke,y),On=i.addVertex(Ye[3],ke,y),Rr=i.addVertex(vt[2],Ee,y),fi=i.addVertex(vt[3],Ee,y);i.addTriangle(Wt,On,Rr),i.addTriangle(On,fi,Rr);const xi=this.isTerminalVertex(jt.a,w),Fr=this.isTerminalVertex(jt.b,w);Lt.height<.01&&xi&&i.addQuad(Ye[3],Ye[2],Ye[1],Ye[0],bn(yt,yt),y),Dt.height<.01&&Fr&&i.addQuad(vt[0],vt[1],vt[2],vt[3],gt,y)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}constructTunnelStructures(i,l,h,p,_,y){i.clearVertexLookup();let w=Number.POSITIVE_INFINITY;const S=(ne,ue)=>ne.featureInfo.featureIndex-ue.featureInfo.featureIndex;this.sortSubarray(p,_.min,_.max,S),this.sortSubarray(p,y.min,y.max,S);const R=ne=>Vt(ne,ne),O=[{coord:new Ve(0,0),height:0},{coord:new Ve(0,0),height:0}],D=(ne,ue)=>ne<ue,z=ft(),V=ft(),H=ft(),K=ft(),re=ft();for(let ne=_.min;ne<_.max;ne++){if(!this.prepareEdgePoints(O,l,h,p[ne],D))continue;const[ue,he]=O,ge=R(Kt(re,-(he.coord.y-ue.coord.y),he.coord.x-ue.coord.x,0));w=this.addFeatureSection(p[ne].featureInfo.featureIndex,w,this.tunnelFeatureSections,i),i.addQuad(Kt(z,ue.coord.x,ue.coord.y,ue.height),Kt(V,he.coord.x,he.coord.y,he.height),Kt(H,he.coord.x,he.coord.y,p[ne].isTunnel?-.1:0),Kt(K,ue.coord.x,ue.coord.y,p[ne].isTunnel?-.1:0),ge)}for(let ne=y.min;ne<y.max;ne++){const ue=p[ne];ue.isTunnel&&([ue.a,ue.b]=[ue.b,ue.a]);const he=l[ue.a],ge=l[ue.b],ke=R(Kt(re,-(ge.y-he.y),ge.x-he.x,0));w=this.addFeatureSection(ue.featureInfo.featureIndex,w,this.tunnelFeatureSections,i),i.addQuad(Kt(z,ge.x,ge.y,0),Kt(V,he.x,he.y,0),Kt(H,he.x,he.y,h[ue.a]+4),Kt(K,ge.x,ge.y,h[ue.b]+4),ke),i.addQuad(Kt(z,he.x,he.y,0),Kt(V,ge.x,ge.y,0),Kt(H,ge.x,ge.y,h[ue.b]+4),Kt(K,he.x,he.y,h[ue.a]+4),ke)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}setElevatedPoint(i,l,h,p){i.coord.x=l,i.coord.y=h,i.height=p}prepareEdgePoints(i,l,h,p,_){let y=l[p.a].x,w=l[p.a].y,S=l[p.b].x,R=l[p.b].y,O=h[p.a],D=h[p.b];const z=_(O,0),V=_(D,0);if(z&&V)return this.setElevatedPoint(i[0],y,w,O),this.setElevatedPoint(i[1],S,R,D),!0;if(!z&&!V)return!1;if(z){if(!V){const H=D/(D-O);S=br(S,y,H),R=br(R,w,H),D=br(D,O,H)}}else{const H=O/(O-D);y=br(y,S,H),w=br(w,R,H),O=br(O,D,H)}return this.setElevatedPoint(i[0],y,w,O),this.setElevatedPoint(i[1],S,R,D),!0}prepareEdges(i,l){if(l.length===0)return;l.sort((w,S)=>w.hash===S.hash?S.polygonIdx-w.polygonIdx:S.hash>w.hash?1:-1);let h=0,p=0,_=0,y=l[h].polygonIdx;do p++,(p===l.length||l[h].hash!==l[p].hash)&&((p-h==1||l[p-1].polygonIdx!==y)&&(_<h&&(l[_]=l[h],l[h]=null),l[_].type="none",_++),h=p,h!==l.length&&(y=l[h].polygonIdx));while(h!==l.length);if(l.splice(_),l.length!==0&&i.length!==0){l.sort((R,O)=>R.portalHash<O.portalHash?1:-1);let w=0,S=0;for(;w!==l.length&&S!==i.length;){const R=l[w],O=i[S];R.portalHash>O.hash?w++:O.hash>R.portalHash?S++:(R.type=O.type,w++)}}}isOnBorder(i,l){return i<=0&&l<=0||i>=Qt&&l>=Qt}addFeatureSection(i,l,h,p){return i!==l&&(l=i,h.push({featureIndex:i,vertexStart:p.getVertexCount()}),p.clearVertexLookup()),l}sortSubarray(i,l,h,p){const _=i.slice(l,h);_.sort(p),i.splice(l,_.length,..._)}static computeEdgeHash(i,l){return(i.y===l.y&&i.x>l.x||i.y>l.y)&&([i,l]=[l,i]),BigInt(fu.computePosHash(i))<<32n|BigInt(fu.computePosHash(l))}static computePosHash(i){return((65535&i.x)<<16|65535&i.y)>>>0}}var _N,yN={exports:{}},vN=(_N||(_N=1,function(c){function i(Se,Ie){return Se>Ie?1:Se<Ie?-1:0}var l=function(Se,Ie){Se===void 0&&(Se=i),Ie===void 0&&(Ie=!1),this._compare=Se,this._root=null,this._size=0,this._noDuplicates=!!Ie},h={size:{configurable:!0}};function p(Se,Ie,xt,Bt,cn){var dn=cn-Bt;if(dn>0){var Bn=Bt+Math.floor(dn/2),Wn={key:Ie[Bn],data:xt[Bn],parent:Se};return Wn.left=p(Wn,Ie,xt,Bt,Bn),Wn.right=p(Wn,Ie,xt,Bn+1,cn),Wn}return null}function _(Se,Ie,xt,Bt,cn){if(!(xt>=Bt)){for(var dn=Se[xt+Bt>>1],Bn=xt-1,Wn=Bt+1;;){do Bn++;while(cn(Se[Bn],dn)<0);do Wn--;while(cn(Se[Wn],dn)>0);if(Bn>=Wn)break;var Dr=Se[Bn];Se[Bn]=Se[Wn],Se[Wn]=Dr,Dr=Ie[Bn],Ie[Bn]=Ie[Wn],Ie[Wn]=Dr}_(Se,Ie,xt,Wn,cn),_(Se,Ie,Wn+1,Bt,cn)}}l.prototype.rotateLeft=function(Se){var Ie=Se.right;Ie&&(Se.right=Ie.left,Ie.left&&(Ie.left.parent=Se),Ie.parent=Se.parent),Se.parent?Se===Se.parent.left?Se.parent.left=Ie:Se.parent.right=Ie:this._root=Ie,Ie&&(Ie.left=Se),Se.parent=Ie},l.prototype.rotateRight=function(Se){var Ie=Se.left;Ie&&(Se.left=Ie.right,Ie.right&&(Ie.right.parent=Se),Ie.parent=Se.parent),Se.parent?Se===Se.parent.left?Se.parent.left=Ie:Se.parent.right=Ie:this._root=Ie,Ie&&(Ie.right=Se),Se.parent=Ie},l.prototype._splay=function(Se){for(;Se.parent;){var Ie=Se.parent;Ie.parent?Ie.left===Se&&Ie.parent.left===Ie?(this.rotateRight(Ie.parent),this.rotateRight(Ie)):Ie.right===Se&&Ie.parent.right===Ie?(this.rotateLeft(Ie.parent),this.rotateLeft(Ie)):Ie.left===Se&&Ie.parent.right===Ie?(this.rotateRight(Ie),this.rotateLeft(Ie)):(this.rotateLeft(Ie),this.rotateRight(Ie)):Ie.left===Se?this.rotateRight(Ie):this.rotateLeft(Ie)}},l.prototype.splay=function(Se){for(var Ie,xt,Bt,cn,dn;Se.parent;)(xt=(Ie=Se.parent).parent)&&xt.parent?((Bt=xt.parent).left===xt?Bt.left=Se:Bt.right=Se,Se.parent=Bt):(Se.parent=null,this._root=Se),cn=Se.left,dn=Se.right,Se===Ie.left?(xt&&(xt.left===Ie?(Ie.right?(xt.left=Ie.right,xt.left.parent=xt):xt.left=null,Ie.right=xt,xt.parent=Ie):(cn?(xt.right=cn,cn.parent=xt):xt.right=null,Se.left=xt,xt.parent=Se)),dn?(Ie.left=dn,dn.parent=Ie):Ie.left=null,Se.right=Ie,Ie.parent=Se):(xt&&(xt.right===Ie?(Ie.left?(xt.right=Ie.left,xt.right.parent=xt):xt.right=null,Ie.left=xt,xt.parent=Ie):(dn?(xt.left=dn,dn.parent=xt):xt.left=null,Se.right=xt,xt.parent=Se)),cn?(Ie.right=cn,cn.parent=Ie):Ie.right=null,Se.left=Ie,Ie.parent=Se)},l.prototype.replace=function(Se,Ie){Se.parent?Se===Se.parent.left?Se.parent.left=Ie:Se.parent.right=Ie:this._root=Ie,Ie&&(Ie.parent=Se.parent)},l.prototype.minNode=function(Se){if(Se===void 0&&(Se=this._root),Se)for(;Se.left;)Se=Se.left;return Se},l.prototype.maxNode=function(Se){if(Se===void 0&&(Se=this._root),Se)for(;Se.right;)Se=Se.right;return Se},l.prototype.insert=function(Se,Ie){var xt=this._root,Bt=null,cn=this._compare;if(this._noDuplicates)for(;xt;){if(Bt=xt,cn(xt.key,Se)===0)return;xt=cn(xt.key,Se)<0?xt.right:xt.left}else for(;xt;)Bt=xt,xt=cn(xt.key,Se)<0?xt.right:xt.left;return xt={key:Se,data:Ie,left:null,right:null,parent:Bt},Bt?cn(Bt.key,xt.key)<0?Bt.right=xt:Bt.left=xt:this._root=xt,this.splay(xt),this._size++,xt},l.prototype.find=function(Se){for(var Ie=this._root,xt=this._compare;Ie;){var Bt=xt(Ie.key,Se);if(Bt<0)Ie=Ie.right;else{if(!(Bt>0))return Ie;Ie=Ie.left}}return null},l.prototype.contains=function(Se){for(var Ie=this._root,xt=this._compare;Ie;){var Bt=xt(Se,Ie.key);if(Bt===0)return!0;Ie=Bt<0?Ie.left:Ie.right}return!1},l.prototype.remove=function(Se){var Ie=this.find(Se);if(!Ie)return!1;if(this.splay(Ie),Ie.left)if(Ie.right){var xt=this.minNode(Ie.right);xt.parent!==Ie&&(this.replace(xt,xt.right),xt.right=Ie.right,xt.right.parent=xt),this.replace(Ie,xt),xt.left=Ie.left,xt.left.parent=xt}else this.replace(Ie,Ie.left);else this.replace(Ie,Ie.right);return this._size--,!0},l.prototype.removeNode=function(Se){if(!Se)return!1;if(this.splay(Se),Se.left)if(Se.right){var Ie=this.minNode(Se.right);Ie.parent!==Se&&(this.replace(Ie,Ie.right),Ie.right=Se.right,Ie.right.parent=Ie),this.replace(Se,Ie),Ie.left=Se.left,Ie.left.parent=Ie}else this.replace(Se,Se.left);else this.replace(Se,Se.right);return this._size--,!0},l.prototype.erase=function(Se){var Ie=this.find(Se);if(Ie){this.splay(Ie);var xt=Ie.left,Bt=Ie.right,cn=null;xt&&(xt.parent=null,cn=this.maxNode(xt),this.splay(cn),this._root=cn),Bt&&(xt?cn.right=Bt:this._root=Bt,Bt.parent=cn),this._size--}},l.prototype.pop=function(){var Se=this._root,Ie=null;if(Se){for(;Se.left;)Se=Se.left;Ie={key:Se.key,data:Se.data},this.remove(Se.key)}return Ie},l.prototype.next=function(Se){var Ie=Se;if(Ie)if(Ie.right)for(Ie=Ie.right;Ie&&Ie.left;)Ie=Ie.left;else for(Ie=Se.parent;Ie&&Ie.right===Se;)Se=Ie,Ie=Ie.parent;return Ie},l.prototype.prev=function(Se){var Ie=Se;if(Ie)if(Ie.left)for(Ie=Ie.left;Ie&&Ie.right;)Ie=Ie.right;else for(Ie=Se.parent;Ie&&Ie.left===Se;)Se=Ie,Ie=Ie.parent;return Ie},l.prototype.forEach=function(Se){for(var Ie=this._root,xt=[],Bt=!1,cn=0;!Bt;)Ie?(xt.push(Ie),Ie=Ie.left):xt.length>0?(Se(Ie=xt.pop(),cn++),Ie=Ie.right):Bt=!0;return this},l.prototype.range=function(Se,Ie,xt,Bt){for(var cn=[],dn=this._compare,Bn=this._root;cn.length!==0||Bn;)if(Bn)cn.push(Bn),Bn=Bn.left;else{if(dn((Bn=cn.pop()).key,Ie)>0)break;if(dn(Bn.key,Se)>=0&&xt.call(Bt,Bn))return this;Bn=Bn.right}return this},l.prototype.keys=function(){for(var Se=this._root,Ie=[],xt=[],Bt=!1;!Bt;)Se?(Ie.push(Se),Se=Se.left):Ie.length>0?(Se=Ie.pop(),xt.push(Se.key),Se=Se.right):Bt=!0;return xt},l.prototype.values=function(){for(var Se=this._root,Ie=[],xt=[],Bt=!1;!Bt;)Se?(Ie.push(Se),Se=Se.left):Ie.length>0?(Se=Ie.pop(),xt.push(Se.data),Se=Se.right):Bt=!0;return xt},l.prototype.at=function(Se){for(var Ie=this._root,xt=[],Bt=!1,cn=0;!Bt;)if(Ie)xt.push(Ie),Ie=Ie.left;else if(xt.length>0){if(Ie=xt.pop(),cn===Se)return Ie;cn++,Ie=Ie.right}else Bt=!0;return null},l.prototype.load=function(Se,Ie,xt){if(Se===void 0&&(Se=[]),Ie===void 0&&(Ie=[]),xt===void 0&&(xt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Bt=Se.length;return xt&&_(Se,Ie,0,Bt-1,this._compare),this._root=p(null,Se,Ie,0,Bt),this._size=Bt,this},l.prototype.min=function(){var Se=this.minNode(this._root);return Se?Se.key:null},l.prototype.max=function(){var Se=this.maxNode(this._root);return Se?Se.key:null},l.prototype.isEmpty=function(){return this._root===null},h.size.get=function(){return this._size},l.createTree=function(Se,Ie,xt,Bt,cn){return new l(xt,cn).load(Se,Ie,Bt)},Object.defineProperties(l.prototype,h);var y=0,w=1,S=2,R=3,O=0,D=1,z=2,V=3;function H(Se,Ie,xt){Ie===null?(Se.inOut=!1,Se.otherInOut=!0):(Se.isSubject===Ie.isSubject?(Se.inOut=!Ie.inOut,Se.otherInOut=Ie.otherInOut):(Se.inOut=!Ie.otherInOut,Se.otherInOut=Ie.isVertical()?!Ie.inOut:Ie.inOut),Ie&&(Se.prevInResult=!K(Ie,xt)||Ie.isVertical()?Ie.prevInResult:Ie));var Bt=K(Se,xt);Se.resultTransition=Bt?function(cn,dn){var Bn,Wn=!cn.inOut,Dr=!cn.otherInOut;switch(dn){case O:Bn=Wn&&Dr;break;case D:Bn=Wn||Dr;break;case V:Bn=Wn^Dr;break;case z:Bn=cn.isSubject?Wn&&!Dr:Dr&&!Wn}return Bn?1:-1}(Se,xt):0}function K(Se,Ie){switch(Se.type){case y:switch(Ie){case O:return!Se.otherInOut;case D:return Se.otherInOut;case z:return Se.isSubject&&Se.otherInOut||!Se.isSubject&&!Se.otherInOut;case V:return!0}break;case S:return Ie===O||Ie===D;case R:return Ie===z;case w:return!1}return!1}var re=function(Se,Ie,xt,Bt,cn){this.left=Ie,this.point=Se,this.otherEvent=xt,this.isSubject=Bt,this.type=cn||y,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ne={inResult:{configurable:!0}};function ue(Se,Ie){return Se[0]===Ie[0]&&Se[1]===Ie[1]}re.prototype.isBelow=function(Se){var Ie=this.point,xt=this.otherEvent.point;return this.left?(Ie[0]-Se[0])*(xt[1]-Se[1])-(xt[0]-Se[0])*(Ie[1]-Se[1])>0:(xt[0]-Se[0])*(Ie[1]-Se[1])-(Ie[0]-Se[0])*(xt[1]-Se[1])>0},re.prototype.isAbove=function(Se){return!this.isBelow(Se)},re.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ne.inResult.get=function(){return this.resultTransition!==0},re.prototype.clone=function(){var Se=new re(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Se.contourId=this.contourId,Se.resultTransition=this.resultTransition,Se.prevInResult=this.prevInResult,Se.isExteriorRing=this.isExteriorRing,Se.inOut=this.inOut,Se.otherInOut=this.otherInOut,Se},Object.defineProperties(re.prototype,ne);var he=11102230246251565e-32,ge=134217729,ke=(3+8*he)*he;function Ee(Se,Ie,xt,Bt,cn){var dn,Bn,Wn,Dr,$r=Ie[0],Wr=Bt[0],ci=0,yr=0;Wr>$r==Wr>-$r?(dn=$r,$r=Ie[++ci]):(dn=Wr,Wr=Bt[++yr]);var Ir=0;if(ci<Se&&yr<xt)for(Wr>$r==Wr>-$r?(Wn=dn-((Bn=$r+dn)-$r),$r=Ie[++ci]):(Wn=dn-((Bn=Wr+dn)-Wr),Wr=Bt[++yr]),dn=Bn,Wn!==0&&(cn[Ir++]=Wn);ci<Se&&yr<xt;)Wr>$r==Wr>-$r?(Wn=dn-((Bn=dn+$r)-(Dr=Bn-dn))+($r-Dr),$r=Ie[++ci]):(Wn=dn-((Bn=dn+Wr)-(Dr=Bn-dn))+(Wr-Dr),Wr=Bt[++yr]),dn=Bn,Wn!==0&&(cn[Ir++]=Wn);for(;ci<Se;)Wn=dn-((Bn=dn+$r)-(Dr=Bn-dn))+($r-Dr),$r=Ie[++ci],dn=Bn,Wn!==0&&(cn[Ir++]=Wn);for(;yr<xt;)Wn=dn-((Bn=dn+Wr)-(Dr=Bn-dn))+(Wr-Dr),Wr=Bt[++yr],dn=Bn,Wn!==0&&(cn[Ir++]=Wn);return dn===0&&Ir!==0||(cn[Ir++]=dn),Ir}function Me(Se){return new Float64Array(Se)}var Be=33306690738754716e-32,$e=22204460492503146e-32,pt=11093356479670487e-47,Ye=Me(4),vt=Me(8),kt=Me(12),It=Me(16),Ft=Me(4);function jt(Se,Ie,xt){var Bt=function(cn,dn,Bn,Wn,Dr,$r){var Wr=(dn-$r)*(Bn-Dr),ci=(cn-Dr)*(Wn-$r),yr=Wr-ci;if(Wr===0||ci===0||Wr>0!=ci>0)return yr;var Ir=Math.abs(Wr+ci);return Math.abs(yr)>=Be*Ir?yr:-function(Ci,Li,Di,Qi,ys,ls,zi){var qi,Hr,_i,Qs,gr,di,hs,Ss,Ms,Ra,As,_r,ia,Ji,qs,Ya,go,Fa,Ba=Ci-ys,oo=Di-ys,Ml=Li-ls,Cs=Qi-ls;Ye[0]=(qs=(Ss=Ba-(hs=(di=ge*Ba)-(di-Ba)))*(Ra=Cs-(Ms=(di=ge*Cs)-(di-Cs)))-((Ji=Ba*Cs)-hs*Ms-Ss*Ms-hs*Ra))-((As=qs-(go=(Ss=Ml-(hs=(di=ge*Ml)-(di-Ml)))*(Ra=oo-(Ms=(di=ge*oo)-(di-oo)))-((Ya=Ml*oo)-hs*Ms-Ss*Ms-hs*Ra)))+(gr=qs-As))+(gr-go),Ye[1]=(ia=Ji-((_r=Ji+As)-(gr=_r-Ji))+(As-gr))-((As=ia-Ya)+(gr=ia-As))+(gr-Ya),Ye[2]=_r-((Fa=_r+As)-(gr=Fa-_r))+(As-gr),Ye[3]=Fa;var Sa=function(Dh,Uo){for(var xl=Uo[0],mu=1;mu<4;mu++)xl+=Uo[mu];return xl}(0,Ye),Ma=$e*zi;if(Sa>=Ma||-Sa>=Ma||(qi=Ci-(Ba+(gr=Ci-Ba))+(gr-ys),_i=Di-(oo+(gr=Di-oo))+(gr-ys),Hr=Li-(Ml+(gr=Li-Ml))+(gr-ls),Qs=Qi-(Cs+(gr=Qi-Cs))+(gr-ls),qi===0&&Hr===0&&_i===0&&Qs===0)||(Ma=pt*zi+ke*Math.abs(Sa),(Sa+=Ba*Qs+Cs*qi-(Ml*_i+oo*Hr))>=Ma||-Sa>=Ma))return Sa;Ft[0]=(qs=(Ss=qi-(hs=(di=ge*qi)-(di-qi)))*(Ra=Cs-(Ms=(di=ge*Cs)-(di-Cs)))-((Ji=qi*Cs)-hs*Ms-Ss*Ms-hs*Ra))-((As=qs-(go=(Ss=Hr-(hs=(di=ge*Hr)-(di-Hr)))*(Ra=oo-(Ms=(di=ge*oo)-(di-oo)))-((Ya=Hr*oo)-hs*Ms-Ss*Ms-hs*Ra)))+(gr=qs-As))+(gr-go),Ft[1]=(ia=Ji-((_r=Ji+As)-(gr=_r-Ji))+(As-gr))-((As=ia-Ya)+(gr=ia-As))+(gr-Ya),Ft[2]=_r-((Fa=_r+As)-(gr=Fa-_r))+(As-gr),Ft[3]=Fa;var Gl=Ee(4,Ye,4,Ft,vt);Ft[0]=(qs=(Ss=Ba-(hs=(di=ge*Ba)-(di-Ba)))*(Ra=Qs-(Ms=(di=ge*Qs)-(di-Qs)))-((Ji=Ba*Qs)-hs*Ms-Ss*Ms-hs*Ra))-((As=qs-(go=(Ss=Ml-(hs=(di=ge*Ml)-(di-Ml)))*(Ra=_i-(Ms=(di=ge*_i)-(di-_i)))-((Ya=Ml*_i)-hs*Ms-Ss*Ms-hs*Ra)))+(gr=qs-As))+(gr-go),Ft[1]=(ia=Ji-((_r=Ji+As)-(gr=_r-Ji))+(As-gr))-((As=ia-Ya)+(gr=ia-As))+(gr-Ya),Ft[2]=_r-((Fa=_r+As)-(gr=Fa-_r))+(As-gr),Ft[3]=Fa;var Ka=Ee(Gl,vt,4,Ft,kt);Ft[0]=(qs=(Ss=qi-(hs=(di=ge*qi)-(di-qi)))*(Ra=Qs-(Ms=(di=ge*Qs)-(di-Qs)))-((Ji=qi*Qs)-hs*Ms-Ss*Ms-hs*Ra))-((As=qs-(go=(Ss=Hr-(hs=(di=ge*Hr)-(di-Hr)))*(Ra=_i-(Ms=(di=ge*_i)-(di-_i)))-((Ya=Hr*_i)-hs*Ms-Ss*Ms-hs*Ra)))+(gr=qs-As))+(gr-go),Ft[1]=(ia=Ji-((_r=Ji+As)-(gr=_r-Ji))+(As-gr))-((As=ia-Ya)+(gr=ia-As))+(gr-Ya),Ft[2]=_r-((Fa=_r+As)-(gr=Fa-_r))+(As-gr),Ft[3]=Fa;var Jc=Ee(Ka,kt,4,Ft,It);return It[Jc-1]}(cn,dn,Bn,Wn,Dr,$r,Ir)}(Se[0],Se[1],Ie[0],Ie[1],xt[0],xt[1]);return Bt>0?-1:Bt<0?1:0}function Lt(Se,Ie){var xt=Se.point,Bt=Ie.point;return xt[0]>Bt[0]?1:xt[0]<Bt[0]?-1:xt[1]!==Bt[1]?xt[1]>Bt[1]?1:-1:function(cn,dn,Bn,Wn){return cn.left!==dn.left?cn.left?1:-1:jt(Bn,cn.otherEvent.point,dn.otherEvent.point)!==0?cn.isBelow(dn.otherEvent.point)?-1:1:!cn.isSubject&&dn.isSubject?1:-1}(Se,Ie,xt)}function Dt(Se,Ie,xt){var Bt=new re(Ie,!1,Se,Se.isSubject),cn=new re(Ie,!0,Se.otherEvent,Se.isSubject);return ue(Se.point,Se.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Se),Bt.contourId=cn.contourId=Se.contourId,Lt(cn,Se.otherEvent)>0&&(Se.otherEvent.left=!0,cn.left=!1),Se.otherEvent.otherEvent=cn,Se.otherEvent=Bt,xt.push(cn),xt.push(Bt),xt}function yt(Se,Ie){return Se[0]*Ie[1]-Se[1]*Ie[0]}function gt(Se,Ie){return Se[0]*Ie[0]+Se[1]*Ie[1]}function zt(Se,Ie,xt){var Bt=function(Dr,$r,Wr,ci,yr){var Ir=[$r[0]-Dr[0],$r[1]-Dr[1]],Ci=[ci[0]-Wr[0],ci[1]-Wr[1]];function Li(di,hs,Ss){return[di[0]+hs*Ss[0],di[1]+hs*Ss[1]]}var Di=[Wr[0]-Dr[0],Wr[1]-Dr[1]],Qi=yt(Ir,Ci),ys=Qi*Qi,ls=gt(Ir,Ir);if(ys>0){var zi=yt(Di,Ci)/Qi;if(zi<0||zi>1)return null;var qi=yt(Di,Ir)/Qi;return qi<0||qi>1?null:zi===0||zi===1?[Li(Dr,zi,Ir)]:qi===0||qi===1?[Li(Wr,qi,Ci)]:[Li(Dr,zi,Ir)]}if((ys=(Qi=yt(Di,Ir))*Qi)>0)return null;var Hr=gt(Ir,Di)/ls,_i=Hr+gt(Ir,Ci)/ls,Qs=Math.min(Hr,_i),gr=Math.max(Hr,_i);return Qs<=1&&gr>=0?Qs===1?[Li(Dr,Qs>0?Qs:0,Ir)]:gr===0?[Li(Dr,gr<1?gr:1,Ir)]:[Li(Dr,Qs>0?Qs:0,Ir),Li(Dr,gr<1?gr:1,Ir)]:null}(Se.point,Se.otherEvent.point,Ie.point,Ie.otherEvent.point),cn=Bt?Bt.length:0;if(cn===0||cn===1&&(ue(Se.point,Ie.point)||ue(Se.otherEvent.point,Ie.otherEvent.point))||cn===2&&Se.isSubject===Ie.isSubject)return 0;if(cn===1)return ue(Se.point,Bt[0])||ue(Se.otherEvent.point,Bt[0])||Dt(Se,Bt[0],xt),ue(Ie.point,Bt[0])||ue(Ie.otherEvent.point,Bt[0])||Dt(Ie,Bt[0],xt),1;var dn=[],Bn=!1,Wn=!1;return ue(Se.point,Ie.point)?Bn=!0:Lt(Se,Ie)===1?dn.push(Ie,Se):dn.push(Se,Ie),ue(Se.otherEvent.point,Ie.otherEvent.point)?Wn=!0:Lt(Se.otherEvent,Ie.otherEvent)===1?dn.push(Ie.otherEvent,Se.otherEvent):dn.push(Se.otherEvent,Ie.otherEvent),Bn&&Wn||Bn?(Ie.type=w,Se.type=Ie.inOut===Se.inOut?S:R,Bn&&!Wn&&Dt(dn[1].otherEvent,dn[0].point,xt),2):Wn?(Dt(dn[0],dn[1].point,xt),3):dn[0]!==dn[3].otherEvent?(Dt(dn[0],dn[1].point,xt),Dt(dn[1],dn[2].point,xt),3):(Dt(dn[0],dn[1].point,xt),Dt(dn[3].otherEvent,dn[2].point,xt),3)}function Jt(Se,Ie){if(Se===Ie)return 0;if(jt(Se.point,Se.otherEvent.point,Ie.point)!==0||jt(Se.point,Se.otherEvent.point,Ie.otherEvent.point)!==0)return ue(Se.point,Ie.point)?Se.isBelow(Ie.otherEvent.point)?-1:1:Se.point[0]===Ie.point[0]?Se.point[1]<Ie.point[1]?-1:1:Lt(Se,Ie)===1?Ie.isAbove(Se.point)?-1:1:Se.isBelow(Ie.point)?-1:1;if(Se.isSubject!==Ie.isSubject)return Se.isSubject?-1:1;var xt=Se.point,Bt=Ie.point;return xt[0]===Bt[0]&&xt[1]===Bt[1]?(xt=Se.otherEvent.point)[0]===(Bt=Ie.otherEvent.point)[0]&&xt[1]===Bt[1]?0:Se.contourId>Ie.contourId?1:-1:Lt(Se,Ie)===1?1:-1}var Gt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Fn(Se,Ie,xt,Bt){var cn,dn=Se+1,Bn=Ie[Se].point,Wn=Ie.length;for(dn<Wn&&(cn=Ie[dn].point);dn<Wn&&cn[0]===Bn[0]&&cn[1]===Bn[1];){if(!xt[dn])return dn;++dn<Wn&&(cn=Ie[dn].point)}for(dn=Se-1;xt[dn]&&dn>Bt;)dn--;return dn}Gt.prototype.isExterior=function(){return this.holeOf==null};var mn=Pn,xn=Pn;function Pn(Se,Ie){if(!(this instanceof Pn))return new Pn(Se,Ie);if(this.data=Se||[],this.length=this.data.length,this.compare=Ie||Yr,this.length>0)for(var xt=(this.length>>1)-1;xt>=0;xt--)this._down(xt)}function Yr(Se,Ie){return Se<Ie?-1:Se>Ie?1:0}Pn.prototype={push:function(Se){this.data.push(Se),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Se=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Se}},peek:function(){return this.data[0]},_up:function(Se){for(var Ie=this.data,xt=this.compare,Bt=Ie[Se];Se>0;){var cn=Se-1>>1,dn=Ie[cn];if(xt(Bt,dn)>=0)break;Ie[Se]=dn,Se=cn}Ie[Se]=Bt},_down:function(Se){for(var Ie=this.data,xt=this.compare,Bt=this.length>>1,cn=Ie[Se];Se<Bt;){var dn=1+(Se<<1),Bn=dn+1,Wn=Ie[dn];if(Bn<this.length&&xt(Ie[Bn],Wn)<0&&(dn=Bn,Wn=Ie[Bn]),xt(Wn,cn)>=0)break;Ie[Se]=Wn,Se=dn}Ie[Se]=cn}},mn.default=xn;var Wt=Math.max,On=Math.min,Rr=0;function fi(Se,Ie,xt,Bt,cn,dn){var Bn,Wn,Dr,$r,Wr,ci;for(Bn=0,Wn=Se.length-1;Bn<Wn;Bn++)if($r=Se[Bn+1],Wr=new re(Dr=Se[Bn],!1,void 0,Ie),ci=new re($r,!1,Wr,Ie),Wr.otherEvent=ci,Dr[0]!==$r[0]||Dr[1]!==$r[1]){Wr.contourId=ci.contourId=xt,dn||(Wr.isExteriorRing=!1,ci.isExteriorRing=!1),Lt(Wr,ci)>0?ci.left=!0:Wr.left=!0;var yr=Dr[0],Ir=Dr[1];cn[0]=On(cn[0],yr),cn[1]=On(cn[1],Ir),cn[2]=Wt(cn[2],yr),cn[3]=Wt(cn[3],Ir),Bt.push(Wr),Bt.push(ci)}}var xi=[];function Fr(Se,Ie,xt){typeof Se[0][0][0]=="number"&&(Se=[Se]),typeof Ie[0][0][0]=="number"&&(Ie=[Ie]);var Bt=function(Ir,Ci,Li){var Di=null;return Ir.length*Ci.length==0&&(Li===O?Di=xi:Li===z?Di=Ir:Li!==D&&Li!==V||(Di=Ir.length===0?Ci:Ir)),Di}(Se,Ie,xt);if(Bt)return Bt===xi?null:Bt;var cn=[1/0,1/0,-1/0,-1/0],dn=[1/0,1/0,-1/0,-1/0],Bn=function(Ir,Ci,Li,Di,Qi){var ys,ls,zi,qi,Hr,_i,Qs=new mn(null,Lt);for(zi=0,qi=Ir.length;zi<qi;zi++)for(Hr=0,_i=(ys=Ir[zi]).length;Hr<_i;Hr++)(ls=Hr===0)&&Rr++,fi(ys[Hr],!0,Rr,Qs,Li,ls);for(zi=0,qi=Ci.length;zi<qi;zi++)for(Hr=0,_i=(ys=Ci[zi]).length;Hr<_i;Hr++)ls=Hr===0,Qi===z&&(ls=!1),ls&&Rr++,fi(ys[Hr],!1,Rr,Qs,Di,ls);return Qs}(Se,Ie,cn,dn,xt);if(Bt=function(Ir,Ci,Li,Di,Qi){var ys=null;return(Li[0]>Di[2]||Di[0]>Li[2]||Li[1]>Di[3]||Di[1]>Li[3])&&(Qi===O?ys=xi:Qi===z?ys=Ir:Qi!==D&&Qi!==V||(ys=Ir.concat(Ci))),ys}(Se,Ie,cn,dn,xt))return Bt===xi?null:Bt;for(var Wn=function(Ir){var Ci,Li,Di=function(zi){var qi,Hr,_i,Qs,gr=[];for(Hr=0,_i=zi.length;Hr<_i;Hr++)((qi=zi[Hr]).left&&qi.inResult||!qi.left&&qi.otherEvent.inResult)&&gr.push(qi);for(var di=!1;!di;)for(di=!0,Hr=0,_i=gr.length;Hr<_i;Hr++)Hr+1<_i&&Lt(gr[Hr],gr[Hr+1])===1&&(Qs=gr[Hr],gr[Hr]=gr[Hr+1],gr[Hr+1]=Qs,di=!1);for(Hr=0,_i=gr.length;Hr<_i;Hr++)(qi=gr[Hr]).otherPos=Hr;for(Hr=0,_i=gr.length;Hr<_i;Hr++)(qi=gr[Hr]).left||(Qs=qi.otherPos,qi.otherPos=qi.otherEvent.otherPos,qi.otherEvent.otherPos=Qs);return gr}(Ir),Qi={},ys=[],ls=function(){if(!Qi[Ci]){var zi=ys.length,qi=function(gr,di,hs){var Ss=new Gt;if(gr.prevInResult!=null){var Ms=gr.prevInResult,Ra=Ms.outputContourId;if(Ms.resultTransition>0){var As=di[Ra];if(As.holeOf!=null){var _r=As.holeOf;di[_r].holeIds.push(hs),Ss.holeOf=_r,Ss.depth=di[Ra].depth}else di[Ra].holeIds.push(hs),Ss.holeOf=Ra,Ss.depth=di[Ra].depth+1}else Ss.holeOf=null,Ss.depth=di[Ra].depth}else Ss.holeOf=null,Ss.depth=0;return Ss}(Di[Ci],ys,zi),Hr=function(gr){Qi[gr]=!0,gr<Di.length&&Di[gr]&&(Di[gr].outputContourId=zi)},_i=Ci,Qs=Ci;for(qi.points.push(Di[Ci].point);Hr(_i),Hr(_i=Di[_i].otherPos),qi.points.push(Di[_i].point),!((_i=Fn(_i,Di,Qi,Qs))==Qs||_i>=Di.length)&&Di[_i];);ys.push(qi)}};for(Ci=0,Li=Di.length;Ci<Li;Ci++)ls();return ys}(function(Ir,Ci,Li,Di,Qi,ys){for(var ls,zi,qi,Hr=new l(Jt),_i=[],Qs=Math.min(Di[2],Qi[2]);Ir.length!==0;){var gr=Ir.pop();if(_i.push(gr),ys===O&&gr.point[0]>Qs||ys===z&&gr.point[0]>Di[2])break;if(gr.left){zi=ls=Hr.insert(gr),ls=ls!==(qi=Hr.minNode())?Hr.prev(ls):null,zi=Hr.next(zi);var di=ls?ls.key:null;if(H(gr,di,ys),zi&&zt(gr,zi.key,Ir)===2&&(H(gr,di,ys),H(zi.key,gr,ys)),ls&&zt(ls.key,gr,Ir)===2){var hs=ls;H(di,(hs=hs!==qi?Hr.prev(hs):null)?hs.key:null,ys),H(gr,di,ys)}}else zi=ls=Hr.find(gr=gr.otherEvent),ls&&zi&&(ls=ls!==qi?Hr.prev(ls):null,zi=Hr.next(zi),Hr.remove(gr),zi&&ls&&zt(ls.key,zi.key,Ir))}return _i}(Bn,0,0,cn,dn,xt)),Dr=[],$r=0;$r<Wn.length;$r++){var Wr=Wn[$r];if(Wr.isExterior()){for(var ci=[Wr.points],yr=0;yr<Wr.holeIds.length;yr++)ci.push(Wn[Wr.holeIds[yr]].points);Dr.push(ci)}}return Dr}var os={UNION:D,DIFFERENCE:z,INTERSECTION:O,XOR:V};c.diff=function(Se,Ie){return Fr(Se,Ie,z)},c.intersection=function(Se,Ie){return Fr(Se,Ie,O)},c.operations=os,c.union=function(Se,Ie){return Fr(Se,Ie,D)},c.xor=function(Se,Ie){return Fr(Se,Ie,V)},Object.defineProperty(c,"__esModule",{value:!0})}(yN.exports)),yN.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function aS(c,i,l,h){const p=[],_=h===0?(y,w,S,R,O,D)=>{y.push(new Ve(D,S+(D-w)/(R-w)*(O-S)))}:(y,w,S,R,O,D)=>{y.push(new Ve(w+(D-S)/(O-S)*(R-w),D))};for(const y of c){const w=[];for(const S of y){if(S.length<=2)continue;const R=[];for(let z=0;z<S.length-1;z++){const V=S[z].x,H=S[z].y,K=S[z+1].x,re=S[z+1].y,ne=h===0?V:H,ue=h===0?K:re;ne<i?ue>i&&_(R,V,H,K,re,i):ne>l?ue<l&&_(R,V,H,K,re,l):R.push(S[z]),ue<i&&ne>=i&&_(R,V,H,K,re,i),ue>l&&ne<=l&&_(R,V,H,K,re,l)}let O=S[S.length-1];const D=h===0?O.x:O.y;D>=i&&D<=l&&R.push(O),R.length&&(O=R[R.length-1],R[0].x===O.x&&R[0].y===O.y||R.push(R[0]),w.push(R))}w.length&&p.push(w)}return p}function yre(c,i){const l=bI(c),h=bI([i]),p=vN.intersection(l,h);return p==null?[]:xN(p)}function vre(c,i){let h=bI(c,65536);const p=[];for(;i.valid();i.next()){const[_,y]=i.get(),w=_.x*65536,S=_.y*65536,R=y.x*65536,O=y.y*65536,D=R-w,z=O-S,V=Math.hypot(D,z);if(V===0)continue;const H=Math.trunc(z/V*3),K=-Math.trunc(D/V*3);p.push([[[w,S],[R,O],[R+H,O+K],[w+H,S+K],[w,S]]])}return p.length>0&&(h=vN.diff(h,p)),xN(h,1/65536)}function bI(c,i=1){return[c.map(l=>l.map(h=>[h.x*i,h.y*i]))]}function xN(c,i=1){return c.map(l=>l.map((h,p)=>{const _=h.map(y=>new Ve(y[0]*i,y[1]*i).round());return p>0&&_.reverse(),_}))}class wI{constructor(i,l){this.layoutVertexArray=new kh,this.indexArray=new Wa,this.lineIndexArray=new du,this.triangleSegments=new ta,this.lineSegments=new ta,this.programConfigurations=new pc(i.layers,{zoom:i.zoom,lut:i.lut}),this.uploaded=!1,l&&(this.elevatedLayoutVertexArray=new Id)}update(i,l,h,p,_,y,w,S){this.programConfigurations.updatePaintArrays(i,l,_,h,p,y,w,S)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,rre.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.lineIndexBuffer=i.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,ire.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(i,l,h,p,_,y,w){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,h,p,_,y,void 0,w)}}class TI{constructor(i){this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=i.lut,this.bufferData=new wI(i,!1),this.elevationBufferData=new wI(i,!0),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=i.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=i.sourceLayerIndex,this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,l){}updateAppearances(i,l,h,p){}populate(i,l,h,p){this.hasPattern=vI("fill",this.layers,this.pixelRatio,l);const _=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:w,id:S,index:R,sourceLayerIndex:O}of i){const D=this.layers[0]._featureFilter.needGeometry,z=Xe(w,D);if(!this.layers[0]._featureFilter.filter(new Rs(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),z,h))continue;const V=_?_.evaluate(z,{},h,l.availableImages):void 0,H={id:S,properties:w.properties,type:w.type,sourceLayerIndex:O,index:R,geometry:D?z.geometry:Fe(w,h,p),patterns:{},sortKey:V};y.push(H)}_&&y.sort((w,S)=>w.sortKey-S.sortKey);for(const w of y){const{geometry:S,index:R,sourceLayerIndex:O}=w;if(this.hasPattern){const D=xI("fill",this.layers,w,this.zoom,this.pixelRatio,l);this.patternFeatures.push(D)}else this.addFeature(w,S,R,h,{},l.availableImages,l.brightness,l.elevationFeatures);l.featureIndex.insert(i[R].feature,S,R,O,this.index)}}update(i,l,h,p,_,y,w){this.bufferData.update(i,l,h,p,_,y,w,this.worldview),this.elevationBufferData.update(i,l,h,p,_,y,w,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(i,l,h,p,_,y,w,this.worldview)}addFeatures(i,l,h,p,_,y){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,l,h,p,y,i.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(i){this.bufferData.upload(i),this.elevationBufferData.upload(i),this.elevatedStructures&&this.elevatedStructures.upload(i)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(i,l,h,p,_,y=[],w,S){const R=Ob(l,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(i,R,p,h,S):this.addGeometry(R,this.bufferData),this.bufferData.populatePaintArrays(i,h,_,y,p,w,this.worldview),this.elevationBufferData.populatePaintArrays(i,h,_,y,p,w,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(i,l,h,p,_){this.elevatedStructures&&(this.elevatedStructures.construct(i),this.elevatedStructures.populatePaintArrays(l,h,p,_,this.worldview))}addElevatedRoadFeature(i,l,h,p,_){const y=new Array,w=Hi.getElevationFeature(i,_);if(!w)return void this.addGeometry(l,this.bufferData);{const R=this.clipPolygonsToTile(l,1);R.length>0&&y.push({polygons:R,elevationFeature:w,elevationTileID:h})}const S={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(i,{},h),featureIndex:p};for(const R of y)if(R.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new fu(R.elevationTileID,this.layers,this.zoom,this.lut));const D=R.elevationFeature.isTunnel();let z=0;i.properties.hasOwnProperty(lt)&&(z=+i.properties[lt]);for(const V of R.polygons)this.elevatedStructures.addPortalCandidates(R.elevationFeature.id,V,D,R.elevationFeature,z)}R.elevationFeature.constantHeight==null&&(R.polygons=this.prepareElevatedPolygons(R.polygons,R.elevationFeature,R.elevationTileID));const O=new is(h,R.elevationTileID);this.addElevatedGeometry(R.polygons,O,R.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,p,S)}}addElevatedGeometry(i,l,h,p,_,y){const w={elevation:h,elevationSampler:l,bias:p,index:_,featureInfo:y},[S,R]=this.addGeometry(i,this.elevationBufferData,w);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:S,max:R}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,S),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,R))}addGeometry(i,l,h){let p=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,y=null;h&&(y=h.elevationSampler.constantElevation(h.elevation,h.bias),y!=null&&(p=y,_=y));const w=(S,R,O)=>{if(h!=null)if(R.push(S),y!=null)l.elevatedLayoutVertexArray.emplaceBack(y),O.push(y);else{const D=h.elevationSampler.pointElevation(S,h.elevation,h.bias);l.elevatedLayoutVertexArray.emplaceBack(D),O.push(D),p=Math.min(p,D),_=Math.max(_,D)}};for(const S of i){let R=0;for(const he of S)R+=he.length;const O=l.triangleSegments.prepareSegment(R,l.layoutVertexArray,l.indexArray),D=O.vertexLength,z=[],V=[],H=[],K=[],re=[],ne=l.layoutVertexArray.length;for(const he of S){if(he.length===0)continue;he!==S[0]&&V.push(z.length/2);const ge=l.lineSegments.prepareSegment(he.length,l.layoutVertexArray,l.lineIndexArray),ke=ge.vertexLength;h&&re.push(l.layoutVertexArray.length-ne),w(he[0],H,K),l.layoutVertexArray.emplaceBack(he[0].x,he[0].y),l.lineIndexArray.emplaceBack(ke+he.length-1,ke),z.push(he[0].x),z.push(he[0].y);for(let Ee=1;Ee<he.length;Ee++)w(he[Ee],H,K),l.layoutVertexArray.emplaceBack(he[Ee].x,he[Ee].y),l.lineIndexArray.emplaceBack(ke+Ee-1,ke+Ee),z.push(he[Ee].x),z.push(he[Ee].y);ge.vertexLength+=he.length,ge.primitiveLength+=he.length}const ue=Qy(z,V);for(let he=0;he<ue.length;he+=3)l.indexArray.emplaceBack(D+ue[he],D+ue[he+1],D+ue[he+2]);if(ue.length>0&&h&&this.elevationMode==="hd-road-base"){const he=h.elevation.isTunnel(),ge=h.elevation.safeArea,ke=this.elevatedStructures.addVertices(H,K);this.elevatedStructures.addTriangles(ue,ke,he);const Ee=re.length;if(Ee>0){for(let Me=0;Me<Ee-1;Me++)this.elevatedStructures.addRenderableRing(h.index,re[Me]+ke,re[Me+1]-re[Me],he,ge,h.featureInfo);this.elevatedStructures.addRenderableRing(h.index,re[Ee-1]+ke,H.length-re[Ee-1],he,ge,h.featureInfo)}}O.vertexLength+=R,O.primitiveLength+=ue.length/3}return[p,_]}prepareElevatedPolygons(i,l,h){const p=1/ae(h),_=[];for(const y of i){const w=vre(y,new Oi(l,p));_.push(...w)}return _}clipPolygonsToTile(i,l){const h=-l,p=-l,_=Qt+l,y=Qt+l;let w=0;const S=[],R=[];for(;w<i.length;w++){const z=i[w],V=Td(z);(V.min.x>=h&&V.max.x<=_&&V.min.y>=p&&V.max.y<=y?S:R).push(z)}if(S.length===i.length)return i;const O=[new Ve(h,p),new Ve(_,p),new Ve(_,y),new Ve(h,y),new Ve(h,p)],D=S;for(const z of R)D.push(...yre(z,O));return D}}let bN,wN,TN,EN;An(TI,"FillBucket",{omit:["layers","patternFeatures"]}),An(wI,"FillBufferData"),An(fu,"ElevatedStructures");class oS{constructor(i,l,h,p){if(this.triangleCount=l.length/3,this.min=new Ve(0,0),this.max=new Ve(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||i.length===0)return;const[_,y]=[i[0].clone(),i[0].clone()];for(let D=1;D<i.length;++D){const z=i[D];_.x=Math.min(_.x,z.x),_.y=Math.min(_.y,z.y),y.x=Math.max(y.x,z.x),y.y=Math.max(y.y,z.y)}if(p){const D=Math.ceil(Math.max(y.x-_.x,y.y-_.y)/p);h=Math.max(h,D)}if(h===0)return;this.min=_,this.max=y;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const S=Math.max(w.x,w.y)/h;this.cellsX=Math.max(1,Math.ceil(w.x/S)),this.cellsY=Math.max(1,Math.ceil(w.y/S)),this.xScale=1/S,this.yScale=1/S;const R=[];for(let D=0;D<this.triangleCount;D++){const z=i[l[3*D+0]].sub(this.min),V=i[l[3*D+1]].sub(this.min),H=i[l[3*D+2]].sub(this.min),K=Oh(Math.floor(Math.min(z.x,V.x,H.x)),this.xScale,this.cellsX),re=Oh(Math.floor(Math.max(z.x,V.x,H.x)),this.xScale,this.cellsX),ne=Oh(Math.floor(Math.min(z.y,V.y,H.y)),this.yScale,this.cellsY),ue=Oh(Math.floor(Math.max(z.y,V.y,H.y)),this.yScale,this.cellsY),he=new Ve(0,0),ge=new Ve(0,0),ke=new Ve(0,0),Ee=new Ve(0,0);for(let Me=ne;Me<=ue;++Me){he.y=ge.y=Me*S,ke.y=Ee.y=(Me+1)*S;for(let Be=K;Be<=re;++Be)he.x=ke.x=Be*S,ge.x=Ee.x=(Be+1)*S,(Ko(z,V,H,he,ge,Ee)||Ko(z,V,H,he,Ee,ke))&&R.push({cellIdx:Me*this.cellsX+Be,triIdx:D})}}if(R.length===0)return;R.sort((D,z)=>D.cellIdx-z.cellIdx||D.triIdx-z.triIdx);let O=0;for(;O<R.length;){const D=R[O].cellIdx,z={start:this.payload.length,len:0};for(;O<R.length&&R[O].cellIdx===D;)++z.len,this.payload.push(R[O++].triIdx);this.cells[D]=z}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(i,l){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>i.x||i.y>this.max.y||this.min.y>i.y)return;const h=Oh(i.x-this.min.x,this.xScale,this.cellsX),p=Oh(i.y-this.min.y,this.yScale,this.cellsY),_=this.cells[p*this.cellsX+h];if(_){this._lazyInitLookup();for(let y=0;y<_.len;y++){const w=this.payload[_.start+y],S=Math.floor(w/8),R=1<<w%8;if(!(this.lookup[S]&R)&&(this.lookup[S]|=R,l.push(w),l.length===this.triangleCount))return}}}query(i,l,h){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>l.x||i.y>this.max.y||this.min.y>l.y)return;this._lazyInitLookup();const p=Oh(i.x-this.min.x,this.xScale,this.cellsX),_=Oh(l.x-this.min.x,this.xScale,this.cellsX),y=Oh(i.y-this.min.y,this.yScale,this.cellsY),w=Oh(l.y-this.min.y,this.yScale,this.cellsY);for(let S=y;S<=w;S++)for(let R=p;R<=_;R++){const O=this.cells[S*this.cellsX+R];if(O)for(let D=0;D<O.len;D++){const z=this.payload[O.start+D],V=Math.floor(z/8),H=1<<z%8;if(!(this.lookup[V]&H)&&(this.lookup[V]|=H,h.push(z),h.length===this.triangleCount))return}}}}function Oh(c,i,l){return Math.max(0,Math.min(l-1,Math.floor(c*i)))}An(oS,"TriangleGridIndex");class SN{constructor(i){this.zoom=i.zoom,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=i.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.footprints=[],this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,l){for(const h of this.footprints)l.push({footprint:h,id:i})}updateAppearances(i,l,h,p){}populate(i,l,h,p){const _=[];for(const{feature:y,id:w,index:S,sourceLayerIndex:R}of i){const O=this.layers[0]._featureFilter.needGeometry,D=Xe(y,O);if(!this.layers[0]._featureFilter.filter(new Rs(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),D,h))continue;const z={id:w,properties:y.properties,type:y.type,sourceLayerIndex:R,index:S,geometry:O?D.geometry:Fe(y,h,p),patterns:{}};_.push(z)}for(const y of _){const{geometry:w,index:S,sourceLayerIndex:R}=y;this.addFeature(y,w,S,h,{},l.availableImages,l.brightness),l.featureIndex.insert(i[S].feature,w,S,R,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(i){}update(i,l,h,p,_,y,w){}destroy(){}addFeature(i,l,h,p,_,y=[],w){for(const S of Ob(l,2)){const R=[],O=[],D=[],z=new Ve(1/0,1/0),V=new Ve(-1/0,-1/0);for(const re of S)if(re.length!==0){re!==S[0]&&D.push(O.length/2);for(let ne=0;ne<re.length;ne++)O.push(re[ne].x),O.push(re[ne].y),R.push(re[ne]),z.x=Math.min(z.x,re[ne].x),z.y=Math.min(z.y,re[ne].y),V.x=Math.max(V.x,re[ne].x),V.y=Math.max(V.y,re[ne].y)}const H=Qy(O,D),K=new oS(R,H,8,256);this.footprints.push({vertices:R,indices:H,grid:K,min:z,max:V})}}}An(SN,"ClipBucket",{omit:["layers"]});const xre=ui([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),bre=ui([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),wre=ui([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),Tre=ui([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Ere=ui([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Sre=ui([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Are=ui([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Cre}=xre,Lb=Number.MAX_SAFE_INTEGER,AN=Lb-1;function CN(c,i,l,h){return c.order<i||c.order===Lb||!(c.clipMask&l)||function(p,_){return _.length!==0&&_.find(y=>y===p)===void 0}(h,c.clipScope)}function lS(c,i){return c.x-i.x||c.y-i.y}function kN(c,i){return lS(c.min,i.min)===0&&lS(c.max,i.max)===0}function EI(c,i){return!(c.min.x>i.max.x||c.max.x<i.min.x||c.min.y>i.max.y||c.max.y<i.min.y)}function uS(c,i){if(c.length!==i.length)return!1;for(let l=0;l<c.length;l++)if(c[l].sourceId!==i[l].sourceId||!kN(c[l],i[l])||c[l].order!==i[l].order||c[l].clipMask!==i[l].clipMask||!or(c[l].clipScope,i[l].clipScope))return!1;return!0}function IN(c,i,l){const h=1/Qt,p=1/(1<<l.canonical.z),_=(i.x*h+l.canonical.x)*p+l.wrap,y=(i.y*h+l.canonical.y)*p;return{min:new Ve((c.x*h+l.canonical.x)*p+l.wrap,(c.y*h+l.canonical.y)*p),max:new Ve(_,y)}}function kre(c,i,l){const h=1<<l.canonical.z,p=((i.x-l.wrap)*h-l.canonical.x)*Qt,_=(i.y*h-l.canonical.y)*Qt;return{min:new Ve(((c.x-l.wrap)*h-l.canonical.x)*Qt,(c.y*h-l.canonical.y)*Qt),max:new Ve(p,_)}}function SI(c,i,l,h,p,_,y){const w=c.indices,S=c.vertices,R=[];for(let O=h;O<h+p;O+=3){const D=i[l[O+0]+_],z=i[l[O+1]+_],V=i[l[O+2]+_],H=Math.min(D.x,z.x,V.x),K=Math.max(D.x,z.x,V.x),re=Math.min(D.y,z.y,V.y),ne=Math.max(D.y,z.y,V.y);R.length=0,c.grid.query(new Ve(H,re),new Ve(K,ne),R);for(let ue=0;ue<R.length;ue++){const he=R[ue];if(Ko(S[w[3*he+0]],S[w[3*he+1]],S[w[3*he+2]],D,z,V,y))return!0}}return!1}function RN(c,i,l,h){if(!c||!l)return!1;let p=c.vertices;if(!i.canonical.equals(h.canonical)||i.wrap!==h.wrap){if(l.vertices.length<c.vertices.length)return RN(l,h,c,i);const _=i.canonical,y=h.canonical,w=Math.pow(2,y.z-_.z);p=c.vertices.map(S=>new Ve((S.x+_.x*Qt)*w-y.x*Qt,(S.y+_.y*Qt)*w-y.y*Qt))}return SI(l,p,c.indices,0,c.indices.length,0,0)}function MN(c,i,l,h){const p=Math.pow(2,h.z-l.z);return new Ve((c+l.x*Qt)*p-h.x*Qt,(i+l.y*Qt)*p-h.y*Qt)}function PN(c,i){const l=[];i.grid.queryPoint(c,l);const h=i.indices,p=i.vertices;for(let _=0;_<l.length;_++){const y=l[_];if(gs([p[h[3*y+0]],p[h[3*y+1]],p[h[3*y+2]]],c))return!0}return!1}const AI=[new Ve(0,0),new Ve(Qt,0),new Ve(Qt,Qt),new Ve(0,Qt)];function ON(c,i){const l=[];let h=[];if(!i||c.length<2)return[c];if(c.length===2)return jo(c[0],c[1],AI)?[c]:[];for(let p=0;p<c.length+2;p++){const _=c[p%c.length],y=c[(p+1)%c.length],w=jo(p===0?c[c.length-1]:c[(p-1)%c.length],_,AI),S=jo(_,y,AI),R=w||S;R&&h.push(_),R&&S||h.length>0&&(h.length>1&&l.push(h),h=[])}return h.length>1&&l.push(h),l}const CI=He.types,Ire=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Rre=["fill-extrusion-flood-light-ground-radius"],Mre=Math.pow(2,13),Pre=Math.pow(2,15)-1,LN=new Ve(0,1),Bf=2147483648,DN=7,NN=450;function Db(c,i,l,h,p,_,y,w){c.emplaceBack((i<<1)+y,(l<<1)+_,(Math.floor(h*Mre)<<1)+p,Math.round(w))}function Nb(c,i,l){c.emplaceBack(i.x*Qt,i.y*Qt,l?1:0)}function cS(c,i,l,h,p,_){c.emplaceBack(i.x,i.y,(l.x<<1)+h,(l.y<<1)+p,_)}function zb(c,i,l){c.emplaceBack(i.x,i.y,i.z,l[0]*16384,l[1]*16384,l[2]*16384)}class zN{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class FN{constructor(){this.centroidXY=new Ve(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ve(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ve(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Ve(this.max.x-this.min.x,this.max.y-this.min.y)}}class BN{constructor(){this.acc=new Ve(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(i,l){i.min.x===Number.MAX_VALUE&&(i.min.x=i.max.x=l.x,i.min.y=i.max.y=l.y)}appendEdge(i,l,h){this.accCount++,this.acc._add(l);let p=!!this.borders;l.x<i.min.x?(i.min.x=l.x,p=!0):l.x>i.max.x&&(i.max.x=l.x,p=!0),l.y<i.min.y?(i.min.y=l.y,p=!0):l.y>i.max.y&&(i.max.y=l.y,p=!0),((l.x===0||l.x===Qt)&&l.x===h.x)!=((l.y===0||l.y===Qt)&&l.y===h.y)&&this.processBorderOverlap(l,h),p&&this.checkBorderIntersection(l,h)}checkBorderIntersection(i,l){l.x<0!=i.x<0&&this.addBorderIntersection(0,br(l.y,i.y,(0-l.x)/(i.x-l.x))),l.x>Qt!=i.x>Qt&&this.addBorderIntersection(1,br(l.y,i.y,(Qt-l.x)/(i.x-l.x))),l.y<0!=i.y<0&&this.addBorderIntersection(2,br(l.x,i.x,(0-l.y)/(i.y-l.y))),l.y>Qt!=i.y>Qt&&this.addBorderIntersection(3,br(l.x,i.x,(Qt-l.y)/(i.y-l.y)))}addBorderIntersection(i,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[i];l<h[0]&&(h[0]=l),l>h[1]&&(h[1]=l)}processBorderOverlap(i,l){if(i.x===l.x){if(i.y===l.y)return;const h=i.x===0?0:1;this.addBorderIntersection(h,l.y),this.addBorderIntersection(h,i.y)}else{const h=i.y===0?2:3;this.addBorderIntersection(h,l.x),this.addBorderIntersection(h,i.x)}}centroid(){return this.accCount===0?new Ve(0,0):new Ve(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((i,l)=>i+ +(l[0]!==Number.MAX_VALUE),0):0}}function jN(c,i){const l=c.add(i)._unit(),h=ee(c.x*l.x+c.y*l.y,-1,1);var p,_,y;return p=Math.acos(h),Math.min(4,Math.max(-4,Math.tan(p)))/4*Pre*((_=c).x*(y=i).y-_.y*y.x<0?-1:1)}const Ore=[c=>c.x<0,c=>c.x>Qt,c=>c.y<0,c=>c.y>Qt];function Lre(c,i,l,h){const p=[4];if(h===0)return p;l._mult(h);const _=c.sub(l),y=i.sub(l),w=[c,i,_,y];for(let S=0;S<4;S++)for(const R of w)if(Ore[S](R)){p.push(S);break}return p}class kI{constructor(i){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new ub,this.indexArray=new Wa,this.programConfigurations=new pc(i.layers,{zoom:i.zoom,lut:i.lut},l=>Rre.includes(l)),this._segments=new ta,this.hiddenByLandmarkVertexArray=new jy,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ta}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(i,l,h,p=!1){const _=i.length;if(_>2){let y=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*_,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let S;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const R=i[0],O=i[1];S=jN(R.sub(i[_-1])._perp()._unit(),O.sub(R)._perp()._unit())}for(let R=0;R<_;R++){const O=R===_-1?0:R+1,D=i[R],z=i[O],V=i[O===_-1?0:O+1],H=z.sub(D)._perp()._unit(),K=jN(H,V.sub(z)._perp()._unit()),re=S,ne=K;if(II(D,z,l)||p&&$N(D,l)&&$N(z,l)){S=K;continue}const ue=w.vertexLength;cS(this.vertexArray,D,z,1,1,re),cS(this.vertexArray,D,z,1,0,re),cS(this.vertexArray,D,z,0,1,ne),cS(this.vertexArray,D,z,0,0,ne),w.vertexLength+=4;const he=Lre(D,z,H,h);for(const ge of he)this._segmentToGroundQuads[y].push({id:ue,region:ge}),this._segmentToRegionTriCounts[y][ge]+=2,w.primitiveLength+=2;S=K}}}prepareBorderSegments(){if(!this.hasData())return;const i=this._segments.get(),l=i.length;for(let h=0;h<l;h++)this._segmentToGroundQuads[h].sort((p,_)=>p.region-_.region);for(let h=0;h<l;h++){const p=this._segmentToGroundQuads[h],_=i[h],y=this._segmentToRegionTriCounts[h];y.reduce((S,R)=>S+R,0);let w=0;for(let S=0;S<=4;S++){const R=y[S];if(R!==0){let O=this.regionSegments[S];O||(O=this.regionSegments[S]=new ta);const D={vertexOffset:_.vertexOffset,primitiveOffset:_.primitiveOffset+w,vertexLength:_.vertexLength,primitiveLength:R};O.get().push(D)}w+=R}for(let S=0;S<p.length;S++){const R=p[S].id;this.indexArray.emplaceBack(R,R+1,R+3),this.indexArray.emplaceBack(R,R+3,R+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(i,l,h,p,_,y,w){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,i,l,h,p,_,y,void 0,w)}upload(i){this.hasData()&&(this.vertexBuffer=i.createVertexBuffer(this.vertexArray,bre.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=i.createVertexBuffer(this.groundRadiusArray,wre.members)))}uploadPaintProperties(i){this.hasData()&&this.programConfigurations.upload(i)}update(i,l,h,p,_,y,w,S){this.hasData()&&this.programConfigurations.updatePaintArrays(i,l,h,p,_,y,w,S)}updateHiddenByLandmark(i){this.updateHiddenByLandmarkRange(i.groundVertexArrayOffset,i.groundVertexCount,!!(i.flags&Bf))}updateHiddenByLandmarkRange(i,l,h){if(!this.hasData())return;const p=l+i;if(l!==0){for(let _=i;_<p;++_)this.hiddenByLandmarkVertexArray.emplace(_,h?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(i){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=i.createVertexBuffer(this.hiddenByLandmarkVertexArray,Sre.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let i=0;i<=4;i++){const l=this.regionSegments[i];l&&l.destroy()}}}}class dS{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.pixelRatio=i.pixelRatio,this.layerIds=this.layers.map(l=>l.fqid),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Wa,this.footprintVertices=new kh,this.footprintSegments=[],this.layoutVertexArray=new Gp,this.centroidVertexArray=new QE,this.wallVertexArray=new ng,this.indexArray=new Wa,this.programConfigurations=new pc(i.layers,{zoom:i.zoom,lut:i.lut},l=>Ire.includes(l)),this.segments=new ta,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.groundEffect=new kI(i),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,l){}updateAppearances(i,l,h,p){}populate(i,l,h,p){this.features=[],this.hasPattern=vI("fill-extrusion",this.layers,this.pixelRatio,l),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=ae(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:_,id:y,index:w,sourceLayerIndex:S}of i){const R=this.layers[0]._featureFilter.needGeometry,O=Xe(_,R);if(!this.layers[0]._featureFilter.filter(new Rs(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),O,h))continue;const D={id:y,sourceLayerIndex:S,index:w,geometry:R?O.geometry:Fe(_,h,p),properties:_.properties,type:_.type,patterns:{}},z=this.layoutVertexArray.length,V=CI[D.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:_.id,feature:xI("fill-extrusion",this.layers,D,this.zoom,this.pixelRatio,l)});else if(this.wallMode)for(const H of D.geometry)for(const K of ON(H,V))this.addFeature(_.id,D,[K],w,h,{},l.availableImages,p,l.brightness);else this.addFeature(_.id,D,D.geometry,w,h,{},l.availableImages,p,l.brightness);l.featureIndex.insert(_,D.geometry,w,S,this.index,z)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(i,l,h,p,_,y){for(const{featureId:w,feature:S}of this.features){const R=CI[S.type]==="Polygon",{geometry:O}=S;if(this.wallMode)for(const D of O)for(const z of ON(D,R))this.addFeature(w,S,[z],S.index,l,h,p,_,y);else this.addFeature(w,S,O,S.index,l,h,p,_,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(i,l,h,p,_,y,w){this.programConfigurations.updatePaintArrays(i,l,_,h,p,y,w,this.worldview),this.groundEffect.update(i,l,_,h,p,y,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Cre),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.wallVertexBuffer=i.createVertexBuffer(this.wallVertexArray,Ere.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,Are.members,!0)),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.groundEffect.uploadHiddenByLandmark(i),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,Tre.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,h,p,_,y,w,S,R){const O=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(l,{})/this.tileToMeter,D=[new Ve(0,0),new Ve(Qt,Qt)],z=S.projection,V=z.name==="globe",H=this.wallMode||CI[l.type]==="Polygon",K=new BN;K.centroidDataIndex=this.centroidData.length;const re=new FN;re.buildingId=i,l.properties&&l.properties.hasOwnProperty("building_id")&&(re.buildingId=l.properties.building_id);const ne=this.layers[0].paint.get("fill-extrusion-base").evaluate(l,{},_)<=0,ue=this.layers[0].paint.get("fill-extrusion-height").evaluate(l,{},_);let he;if(re.height=ue,re.vertexArrayOffset=this.layoutVertexArray.length,re.groundVertexArrayOffset=this.groundEffect.vertexArray.length,V&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ly),this.wallMode){if(V)return void un("Non zero fill-extrusion-line-width is not yet supported on globe.");if(h.length!==1)return;he=function(Ye){const vt=Ye[0].x===Ye[Ye.length-1].x&&Ye[0].y===Ye[Ye.length-1].y;(function(xn){let Pn=0;const Yr=xn.length;for(let Wt=0;Wt<Yr;Wt++)Pn+=(xn[(Wt+1)%Yr].x-xn[Wt].x)*(xn[(Wt+1)%Yr].y+xn[Wt].y);return Pn>=0})(Ye)||(Ye=Ye.reverse());const It={geometry:[],joinNormals:[],indices:[]},Ft=[],jt=[],Lt=[];let Dt=Ye.length;for(;Dt>=2&&Ye[Dt-1].equals(Ye[Dt-2]);)Dt--;if(Dt<(vt?3:2))return It;let yt,gt,zt,Jt,Gt,Fn=0;for(;Fn<Dt-1&&Ye[Fn].equals(Ye[Fn+1]);)Fn++;vt&&(yt=Ye[Dt-2],Gt=Ye[Fn].sub(yt)._unit()._perp());for(let xn=Fn;xn<Dt;xn++){if(zt=xn===Dt-1?vt?Ye[Fn+1]:void 0:Ye[xn+1],zt&&Ye[xn].equals(zt))continue;Gt&&(Jt=Gt),yt&&(gt=yt),yt=Ye[xn],Gt=zt?zt.sub(yt)._unit()._perp():Jt,Jt=Jt||Gt;let Pn=Jt.add(Gt);Pn.x===0&&Pn.y===0||Pn._unit();const Yr=Pn.x*Gt.x+Pn.y*Gt.y,Wt=Yr!==0?1/Yr:1/0,On=Jt.x*Gt.y-Jt.y*Gt.x>0;let Rr="miter";const fi=2;Rr==="miter"&&Wt>fi&&(Rr="bevel"),Rr==="bevel"&&(Wt>100&&(Rr="flipbevel"),Wt<fi&&(Rr="miter"));const xi=(Fr,os,Se,Ie)=>{const xt=new Ve(Fr.x,Fr.y),Bt=new Ve(Fr.x,Fr.y);xt.x+=os.x*Ie,xt.y+=os.y*Ie,Bt.x-=os.x*Math.max(Se,1),Bt.y-=os.y*Math.max(Se,1),Lt.push(os),Ft.push(xt),jt.push(Bt)};if(Rr==="miter")Pn._mult(Wt),xi(yt,Pn,0,0);else if(Rr==="flipbevel")Pn=Gt.mult(-1),xi(yt,Pn,0,0),xi(yt,Pn.mult(-1),0,0);else{const Fr=-Math.sqrt(Wt*Wt-1),os=On?Fr:0,Se=On?0:Fr;gt&&xi(yt,Jt,os,Se),zt&&xi(yt,Gt,os,Se)}}It.geometry=[...Ft,...jt.reverse(),Ft[0]],It.joinNormals=[...Lt,...Lt.reverse(),Lt[Lt.length-1]];const mn=It.geometry.length-1;for(let xn=0;xn<mn/2;xn++)if(xn+1<mn/2){let Pn=xn,Yr=xn+1,Wt=mn-1-xn,On=mn-2-xn;Pn=Pn===0?mn-1:Pn-1,Yr=Yr===0?mn-1:Yr-1,Wt=Wt===0?mn-1:Wt-1,On=On===0?mn-1:On-1,It.indices.push(Wt),It.indices.push(Yr),It.indices.push(Pn),It.indices.push(Wt),It.indices.push(On),It.indices.push(Yr)}return It}(h[0]),h=[he.geometry]}const ge=(Ye,vt)=>Ye<(vt.length-1)/2||Ye===vt.length-1,ke=this.wallMode?[h]:Ob(h,500);for(let Ye=ke.length-1;Ye>=0;Ye--){const vt=ke[Ye];(vt.length===0||(Ee=vt[0]).every(kt=>kt.x<=0)||Ee.every(kt=>kt.x>=Qt)||Ee.every(kt=>kt.y<=0)||Ee.every(kt=>kt.y>=Qt))&&ke.splice(Ye,1)}var Ee;let Me;if(V)Me=WN(ke,D,_);else{Me=[];for(const Ye of ke)Me.push({polygon:Ye,bounds:D})}const Be=H?this.edgeRadius:0,$e=Be>0&&this.zoom<17,pt=(Ye,vt)=>{if(Ye.length===0)return!1;const kt=Ye[Ye.length-1];return vt.x===kt.x&&vt.y===kt.y};for(const{polygon:Ye,bounds:vt}of Me){let kt=0,It=0;for(const Dt of Ye)H&&!Dt[0].equals(Dt[Dt.length-1])&&Dt.push(Dt[0]),It+=H?Dt.length-1:Dt.length;const Ft=this.segments.prepareSegment((H?5:4)*It,this.layoutVertexArray,this.indexArray);re.footprintSegIdx<0&&(re.footprintSegIdx=this.footprintSegments.length),re.polygonSegIdx<0&&(re.polygonSegIdx=this.polygonSegments.length);const jt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Lt=new zN;if(Lt.vertexOffset=this.footprintVertices.length,Lt.indexOffset=3*this.footprintIndices.length,Lt.ringIndices=[],H){const Dt=[],yt=[];kt=Ft.vertexLength;for(let zt=0;zt<Ye.length;zt++){const Jt=Ye[zt];Jt.length&&zt!==0&&yt.push(Dt.length/2);const Gt=[];let Fn,mn;Fn=Jt[1].sub(Jt[0])._perp()._unit(),Lt.ringIndices.push(Jt.length-1);for(let xn=1;xn<Jt.length;xn++){const Pn=Jt[xn],Yr=Jt[xn===Jt.length-1?1:xn+1],Wt=Pn.clone();if(Be){mn=Yr.sub(Pn)._perp()._unit();const On=Fn.add(mn)._unit(),Rr=Be*Math.min(4,1/(Fn.x*On.x+Fn.y*On.y));Wt.x+=Rr*On.x,Wt.y+=Rr*On.y,Wt.x=Math.round(Wt.x),Wt.y=Math.round(Wt.y),Fn=mn}if(!ne||Be!==0&&!$e||pt(Gt,Wt)||Gt.push(Wt),Db(this.layoutVertexArray,Wt.x,Wt.y,0,0,1,1,0),this.wallMode){const On=ge(xn,Jt);Nb(this.wallVertexArray,he.joinNormals[xn],!On)}Ft.vertexLength++,this.footprintVertices.emplaceBack(Pn.x,Pn.y),Dt.push(Pn.x,Pn.y),V&&zb(this.layoutVertexExtArray,z.projectTilePoint(Wt.x,Wt.y,_),z.upVector(_,Wt.x,Wt.y))}ne&&(Be===0||$e)&&(Gt.length!==0&&pt(Gt,Gt[0])&&Gt.pop(),this.groundEffect.addData(Gt,vt,O))}const gt=this.wallMode?he.indices:Qy(Dt,yt);for(let zt=0;zt<gt.length;zt+=3)this.footprintIndices.emplaceBack(Lt.vertexOffset+gt[zt+0],Lt.vertexOffset+gt[zt+1],Lt.vertexOffset+gt[zt+2]),this.indexArray.emplaceBack(kt+gt[zt],kt+gt[zt+2],kt+gt[zt+1]),Ft.primitiveLength++;Lt.indexCount+=gt.length,Lt.vertexCount+=this.footprintVertices.length-Lt.vertexOffset}for(let Dt=0;Dt<Ye.length;Dt++){const yt=Ye[Dt];K.startRing(re,yt[0]);let gt=yt.length>4&&HN(yt[yt.length-2],yt[0],yt[1]),zt=Be?Dre(yt[yt.length-2],yt[0],yt[1],Be):0;const Jt=[];let Gt,Fn,mn;Fn=yt[1].sub(yt[0])._perp()._unit();let xn=!0;for(let Pn=1,Yr=0;Pn<yt.length;Pn++){let Wt=yt[Pn-1],On=yt[Pn];const Rr=yt[Pn===yt.length-1?1:Pn+1];if(K.appendEdge(re,On,Wt),II(On,Wt,vt)){Be&&(Fn=Rr.sub(On)._perp()._unit(),xn=!xn);continue}const fi=On.sub(Wt)._perp(),xi=fi.x/(Math.abs(fi.x)+Math.abs(fi.y)),Fr=fi.y>0?1:0,os=Wt.dist(On);if(Yr+os>32768&&(Yr=0),Be){mn=Rr.sub(On)._perp()._unit();let Bt=VN(Wt,On,Rr,UN(Fn,mn),Be);isNaN(Bt)&&(Bt=0);const cn=On.sub(Wt)._unit();Wt=Wt.add(cn.mult(zt))._round(),On=On.add(cn.mult(-Bt))._round(),zt=Bt,Fn=mn,ne&&this.zoom>=17&&(pt(Jt,Wt)||Jt.push(Wt),pt(Jt,On)||Jt.push(On))}const Se=Ft.vertexLength,Ie=yt.length>4&&HN(Wt,On,Rr);let xt=GN(Yr,gt,xn);if(Db(this.layoutVertexArray,Wt.x,Wt.y,xi,Fr,0,0,xt),Db(this.layoutVertexArray,Wt.x,Wt.y,xi,Fr,0,1,xt),this.wallMode){const Bt=ge(Pn-1,yt),cn=he.joinNormals[Pn-1];Nb(this.wallVertexArray,cn,Bt),Nb(this.wallVertexArray,cn,Bt)}if(Yr+=os,xt=GN(Yr,Ie,!xn),gt=Ie,Db(this.layoutVertexArray,On.x,On.y,xi,Fr,0,0,xt),Db(this.layoutVertexArray,On.x,On.y,xi,Fr,0,1,xt),this.wallMode){const Bt=ge(Pn,yt),cn=he.joinNormals[Pn];Nb(this.wallVertexArray,cn,Bt),Nb(this.wallVertexArray,cn,Bt)}if(Ft.vertexLength+=4,this.indexArray.emplaceBack(Se+0,Se+1,Se+2),this.indexArray.emplaceBack(Se+1,Se+3,Se+2),Ft.primitiveLength+=2,Be){const Bt=kt+(Pn===1?yt.length-2:Pn-2),cn=Pn===1?kt:Bt+1;if(this.indexArray.emplaceBack(Se+1,Bt,Se+3),this.indexArray.emplaceBack(Bt,cn,Se+3),Ft.primitiveLength+=2,Gt===void 0&&(Gt=Se),!II(Rr,yt[Pn],vt)){const dn=Pn===yt.length-1?Gt:Ft.vertexLength;this.indexArray.emplaceBack(Se+2,Se+3,dn),this.indexArray.emplaceBack(Se+3,dn+1,dn),this.indexArray.emplaceBack(Se+3,cn,dn+1),Ft.primitiveLength+=3}xn=!xn}if(V){const Bt=this.layoutVertexExtArray,cn=z.projectTilePoint(Wt.x,Wt.y,_),dn=z.projectTilePoint(On.x,On.y,_),Bn=z.upVector(_,Wt.x,Wt.y),Wn=z.upVector(_,On.x,On.y);zb(Bt,cn,Bn),zb(Bt,cn,Bn),zb(Bt,dn,Wn),zb(Bt,dn,Wn)}}H&&(kt+=yt.length-1),ne&&Be&&this.zoom>=17&&(Jt.length!==0&&pt(Jt,Jt[0])&&Jt.pop(),this.groundEffect.addData(Jt,vt,O,Be>0))}this.footprintSegments.push(Lt),jt.triangleCount=this.indexArray.length-jt.triangleArrayOffset,this.polygonSegments.push(jt),++re.footprintSegLen,++re.polygonSegLen}if(re.vertexCount=this.layoutVertexArray.length-re.vertexArrayOffset,re.groundVertexCount=this.groundEffect.vertexArray.length-re.groundVertexArrayOffset,re.vertexCount!==0){if(re.centroidXY=K.borders?LN:this.encodeCentroid(K,re),this.centroidData.push(re),K.borders){this.featuresOnBorder.push(K);const Ye=this.featuresOnBorder.length-1;for(let vt=0;vt<K.borders.length;vt++)K.borders[vt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[vt].push(Ye)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,y,w,_,R,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(l,p,y,w,_,R,this.worldview),this.maxHeight=Math.max(this.maxHeight,ue)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort((l,h)=>this.featuresOnBorder[l].borders[i][0]-this.featuresOnBorder[h].borders[i][0])}splitToSubtiles(){const i=[];for(let w=0;w<this.centroidData.length;w++){const S=this.centroidData[w],R=+(S.min.y+S.max.y>Qt),O=2*R+(+(S.min.x+S.max.x>Qt)^R);for(let D=0;D<S.polygonSegLen;D++){const z=S.polygonSegIdx+D;i.push({centroidIdx:w,subtile:O,polygonSegmentIdx:z,triangleSegmentIdx:this.polygonSegments[z].triangleSegIdx})}}const l=new Wa;i.sort((w,S)=>w.triangleSegmentIdx===S.triangleSegmentIdx?w.subtile-S.subtile:w.triangleSegmentIdx-S.triangleSegmentIdx);let h=0,p=0,_=0;for(const w of i){if(w.triangleSegmentIdx!==h)break;_++}const y=i.length;for(;p!==i.length;){h=i[p].triangleSegmentIdx;let w=0,S=p,R=p;for(let O=S;O<_&&i[O].subtile===w;O++)R++;for(;S!==_;){const O=i[S];w=O.subtile;const D=this.centroidData[O.centroidIdx].min.clone(),z=this.centroidData[O.centroidIdx].max.clone(),V={vertexOffset:this.segments.segments[h].vertexOffset,primitiveOffset:l.length,vertexLength:this.segments.segments[h].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let H=S;H<R;H++){const K=i[H],re=this.polygonSegments[K.polygonSegmentIdx],ne=this.centroidData[K.centroidIdx].min,ue=this.centroidData[K.centroidIdx].max,he=this.indexArray.uint16;for(let ge=re.triangleArrayOffset;ge<re.triangleArrayOffset+re.triangleCount;ge++)l.emplaceBack(he[3*ge],he[3*ge+1],he[3*ge+2]);V.primitiveLength+=re.triangleCount,D.x=Math.min(D.x,ne.x),D.y=Math.min(D.y,ne.y),z.x=Math.max(z.x,ue.x),z.y=Math.max(z.y,ue.y)}V.primitiveLength>0&&this.triangleSubSegments.push({segment:V,min:D,max:z}),S=R;for(let H=S;H<_&&i[H].subtile===i[S].subtile;H++)R++}p=_;for(let O=p;O<y&&i[O].triangleSegmentIdx===i[p].triangleSegmentIdx;O++)_++}l._trim(),this.indexArray=l}getVisibleSegments(i,l,h){const p=new ta;if(this.wallMode){for(const K of this.triangleSubSegments)p.segments.push(K.segment);return p}let _=0,y=0;const w=1<<i.canonical.z;if(l){const K=l.getMinMaxForTile(i);K&&(_=K.min,y=K.max)}y+=this.maxHeight;const S=i.toUnwrapped();let R;const O=[S.canonical.x/w+S.wrap,S.canonical.y/w],D=[(S.canonical.x+1)/w+S.wrap,(S.canonical.y+1)/w],z=(K,re,ne)=>[K[0]*(1-ne[0])+re[0]*ne[0],K[1]*(1-ne[1])+re[1]*ne[1]],V=[],H=[];for(const K of this.triangleSubSegments){V[0]=K.min.x/Qt,V[1]=K.min.y/Qt,H[0]=K.max.x/Qt,H[1]=K.max.y/Qt;const re=z(O,D,V),ne=z(O,D,H);if(new Dn([re[0],re[1],_],[ne[0],ne[1],y]).intersectsPrecise(h)===0){R&&(p.segments.push(R),R=void 0);continue}const ue=K.segment;R&&R.vertexOffset!==ue.vertexOffset&&(p.segments.push(R),R=void 0),R?(R.vertexLength+=ue.vertexLength,R.primitiveLength+=ue.primitiveLength):R={vertexOffset:ue.vertexOffset,primitiveLength:ue.primitiveLength,vertexLength:ue.vertexLength,primitiveOffset:ue.primitiveOffset,sortKey:void 0,vaos:{}}}return R&&p.segments.push(R),p}encodeCentroid(i,l){const h=i.centroid(),p=l.span(),_=Math.min(7,Math.round(p.x*this.tileToMeter/10)),y=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new Ve(ee(h.x,1,Qt-1)<<3|_,ee(h.y,1,Qt-1)<<3|y)}encodeBorderCentroid(i){if(!i.borders)return new Ve(0,0);const l=i.borders,h=Number.MAX_VALUE;if(l[0][0]!==h||l[1][0]!==h){const p=l[0][0]!==h?0:1;return new Ve(6|(l[0][0]!==h?0:65528),(l[p][0]+l[p][1])/2<<3|6)}{const p=l[2][0]!==h?2:3;return new Ve((l[p][0]+l[p][1])/2<<3|6,6|(l[2][0]!==h?0:65528))}}showCentroid(i){const l=this.centroidData[i.centroidDataIndex];l.flags&=2147483647,l.centroidXY.x=0,l.centroidXY.y=0,this.writeCentroidToBuffer(l)}writeCentroidToBuffer(i){this.groundEffect.updateHiddenByLandmark(i);const l=i.vertexArrayOffset,h=i.vertexCount+i.vertexArrayOffset,p=i.flags&Bf?LN:i.centroidXY,_=this.centroidVertexArray.geta_centroid_pos0(l);if(this.centroidVertexArray.geta_centroid_pos1(l)!==p.y||_!==p.x){for(let y=l;y<h;++y)this.centroidVertexArray.emplace(y,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const i of this.centroidData)this.writeCentroidToBuffer(i)}updateReplacement(i,l,h){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const p=l.getReplacementRegionsForTile(i.toUnwrapped());if(uS(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const y of this.centroidData)y.flags&=2147483647;const _=[];for(const y of this.activeReplacements){if(y.order<h)continue;const w=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-i.canonical.z));if(y.footprint.buildingIds)for(const S of this.centroidData)S.flags&Bf||y.min.x>S.max.x||S.min.x>y.max.x||y.min.y>S.max.y||S.min.y>y.max.y||y.footprint.buildingIds.has(S.buildingId)&&(S.flags|=Bf);else for(const S of this.centroidData)if(!(S.flags&Bf||y.min.x>S.max.x||S.min.x>y.max.x||y.min.y>S.max.y||S.min.y>y.max.y))for(let R=0;R<S.footprintSegLen;R++){const O=this.footprintSegments[S.footprintSegIdx+R];if(_.length=0,Nre(this.footprintVertices,O.vertexOffset,O.vertexCount,y.footprintTileId.canonical,i.canonical,_),SI(y.footprint,_,this.footprintIndices.uint16,O.indexOffset,O.indexCount,-O.vertexOffset,-w)){S.flags|=Bf;break}}}for(const y of this.centroidData)this.writeCentroidToBuffer(y);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(i,l,h){let p=!1;for(let _=0;_<h.footprintSegLen;_++){const y=this.footprintSegments[h.footprintSegIdx+_];let w=0;for(const S of y.ringIndices){for(let R=w,O=S+w-1;R<S+w;O=R++){const D=this.footprintVertices.int16[2*(R+y.vertexOffset)+0],z=this.footprintVertices.int16[2*(R+y.vertexOffset)+1],V=this.footprintVertices.int16[2*(O+y.vertexOffset)+1];z>l!=V>l&&i<(this.footprintVertices.int16[2*(O+y.vertexOffset)+0]-D)*(l-z)/(V-z)+D&&(p=!p)}w=S}}return p}getHeightAtTileCoord(i,l){let h=Number.NEGATIVE_INFINITY,p=!0;const _=4*(i+Qt)*Qt+(l+Qt);if(this.partLookup.hasOwnProperty(_)){const y=this.partLookup[_];return y?{height:y.height,hidden:!!(y.flags&Bf)}:void 0}for(const y of this.centroidData)i>y.max.x||y.min.x>i||l>y.max.y||y.min.y>l||y.height<=h||this.footprintContainsPoint(i,l,y)&&(h=y.height,this.partLookup[_]=y,p=!!(y.flags&Bf));if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:p};this.partLookup[_]=void 0}}function UN(c,i){const l=c.add(i)._unit();return c.x*l.x+c.y*l.y}function Dre(c,i,l,h){const p=i.sub(c)._perp()._unit(),_=l.sub(i)._perp()._unit();return VN(c,i,l,UN(p,_),h)}function VN(c,i,l,h,p){const _=Math.sqrt(1-h*h);return Math.min(c.dist(i)/3,i.dist(l)/3,p*_/h)}function II(c,i,l){return c.x<l[0].x&&i.x<l[0].x||c.x>l[1].x&&i.x>l[1].x||c.y<l[0].y&&i.y<l[0].y||c.y>l[1].y&&i.y>l[1].y}function $N(c,i){return c.x<i[0].x||c.x>i[1].x||c.y<i[0].y||c.y>i[1].y}function HN(c,i,l){if(c.x<0||c.x>=Qt||i.x<0||i.x>=Qt||l.x<0||l.x>=Qt)return!1;const h=l.sub(i),p=h.perp(),_=c.sub(i);return(h.x*_.x+h.y*_.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(_.x*_.x+_.y*_.y))>-.866&&p.x*_.x+p.y*_.y<0}function GN(c,i,l){const h=i?2|c:-3&c;return l?1|h:-2&h}function qN(){const c=Math.PI/32,i=Math.tan(c),l=m;return l*Math.sqrt(1+2*i*i)-l}function WN(c,i,l){const h=1<<l.z,p=j(l.x/h),_=j((l.x+1)/h),y=Z(l.y/h),w=Z((l.y+1)/h);return function(S,R,O,D,z=0,V){const H=[];if(!S.length||!O||!D)return H;const K=(Ee,Me)=>{for(const Be of Ee)H.push({polygon:Be,bounds:Me})},re=Math.ceil(Math.log2(O)),ne=Math.ceil(Math.log2(D)),ue=re-ne,he=[];for(let Ee=0;Ee<Math.abs(ue);Ee++)he.push(ue>0?0:1);for(let Ee=0;Ee<Math.min(re,ne);Ee++)he.push(0),he.push(1);let ge=S;if(ge=aS(ge,R[0].y-z,R[1].y+z,1),ge=aS(ge,R[0].x-z,R[1].x+z,0),!ge.length)return H;const ke=[];for(he.length?ke.push({polygons:ge,bounds:R,depth:0}):K(ge,R);ke.length;){const Ee=ke.pop(),Me=Ee.depth,Be=he[Me],$e=Ee.bounds[0],pt=Ee.bounds[1],Ye=Be===0?$e.x:$e.y,vt=Be===0?pt.x:pt.y,kt=V?V(Be,Ye,vt):.5*(Ye+vt),It=aS(Ee.polygons,Ye-z,kt+z,Be),Ft=aS(Ee.polygons,kt-z,vt+z,Be);if(It.length){const jt=[$e,new Ve(Be===0?kt:pt.x,Be===1?kt:pt.y)];he.length>Me+1?ke.push({polygons:It,bounds:jt,depth:Me+1}):K(It,jt)}if(Ft.length){const jt=[new Ve(Be===0?kt:$e.x,Be===1?kt:$e.y),pt];he.length>Me+1?ke.push({polygons:Ft,bounds:jt,depth:Me+1}):K(Ft,jt)}}return H}(c,i,Math.ceil((_-p)/11.25),Math.ceil((y-w)/11.25),1,(S,R,O)=>{if(S===0)return .5*(R+O);{const D=Z((l.y+R/Qt)/h);return(M(.5*(Z((l.y+O/Qt)/h)+D))*h-l.y)*Qt}})}function Nre(c,i,l,h,p,_){const y=Math.pow(2,h.z-p.z);for(let w=0;w<l;w++){let S=c.int16[2*(w+i)+0],R=c.int16[2*(w+i)+1];S=(S+p.x*Qt)*y-h.x*Qt,R=(R+p.y*Qt)*y-h.y*Qt,_.push(new Ve(S,R))}}let ZN,XN;An(dS,"FillExtrusionBucket",{omit:["layers","features"]}),An(FN,"PartData"),An(zN,"FootprintSegment"),An(BN,"BorderCentroidData"),An(kI,"GroundEffect");class hg extends Ve{constructor(i,l,h){super(i,l),this.z=h}}class YN extends hg{constructor(i,l,h,p){super(i,l,h),this.w=p}}function KN(c,i,l,h){const p=l==="x"?"y":"x",_=(h-c[l])/(i[l]-c[l]);c[p]=Math.round(c[p]+(i[p]-c[p])*_),c[l]=h,c.hasOwnProperty("z")&&(c.z=br(c.z,i.z,_)),c.hasOwnProperty("w")&&(c.w=br(c.w,i.w,_))}function QN(c,i,l,h){const p=l,_=h;for(const y of["x","y"]){let w=c,S=i;w[y]>=S[y]&&(w=i,S=c),w[y]<p&&S[y]>p&&KN(w,S,y,p),w[y]<_&&S[y]>_&&KN(S,w,y,_)}}function hS(c,i,l,h,p,_){const y=[];for(let w=0;w<c.length;w++){const S=c[w];let R;const O=y.length;let D=0;for(let z=0;z<S.length-1;z++){let V=S[z],H=S[z+1],K=0;const re=D;let ne,ue;_&&(K=Math.hypot(H.x-V.x,H.y-V.y),D+=K,ne=V,ue=H),V.x<i&&H.x<i||(V.x<i?V=new Ve(i,V.y+(i-V.x)/(H.x-V.x)*(H.y-V.y))._round():H.x<i&&(H=new Ve(i,V.y+(i-V.x)/(H.x-V.x)*(H.y-V.y))._round()),V.y<l&&H.y<l||(V.y<l?V=new Ve(V.x+(l-V.y)/(H.y-V.y)*(H.x-V.x),l)._round():H.y<l&&(H=new Ve(V.x+(l-V.y)/(H.y-V.y)*(H.x-V.x),l)._round()),V.x>=h&&H.x>=h||(V.x>=h?V=new Ve(h,V.y+(h-V.x)/(H.x-V.x)*(H.y-V.y))._round():H.x>=h&&(H=new Ve(h,V.y+(h-V.x)/(H.x-V.x)*(H.y-V.y))._round()),V.y>=p&&H.y>=p||(V.y>=p?V=new Ve(V.x+(p-V.y)/(H.y-V.y)*(H.x-V.x),p)._round():H.y>=p&&(H=new Ve(V.x+(p-V.y)/(H.y-V.y)*(H.x-V.x),p)._round()),R&&V.equals(R[R.length-1])||(R=[V],y.push(R),_&&_.push({progress:{min:re+JN(ne,ue,V)*K,max:1},parentIndex:w,prevPoint:ne,nextPoint:ue})),R.push(H),_&&(_[_.length-1].progress.max=re+JN(ne,ue,H)*K,_[_.length-1].nextPoint=ue)))))}if(_&&D>0)for(let z=O;z<y.length;z++)_[z].progress.min/=D,_[z].progress.max/=D}return y}function zre(c,i,l,h,p){if(c.length<2)return void h.push(c);const _=[];for(;i.valid();){const[R,O]=i.get();for(let D=0;D<c.length-1;D++){const z=c[D],V=c[D+1],H=Vr(z,V,R,O);if(H){const[K]=H,re=new Ve(br(z.x,V.x,K),br(z.y,V.y,K));_.push({t:D+K,distance:0,point:re})}}i.next()}if(_.length===0)return void h.push(c);_.sort((R,O)=>R.t-O.t);let y=0,w=0,S=[];for(h.push(S);y!==c.length;){if(w===_.length){for(;y!==c.length;)S.length!==0&&S[S.length-1].equals(c[y])||S.push(c[y]),y++;break}_[w].t<=y?(S.length!==0&&S[S.length-1].equals(_[w].point)||S.push(_[w].point),Math.trunc(_[w].t),w++):(S.length!==0&&S[S.length-1].equals(c[y])||S.push(c[y]),y++)}}function JN(c,i,l){return c.x!==i.x?(l.x-c.x)/(i.x-c.x):c.y!==i.y?(l.y-c.y)/(i.y-c.y):0}function Fb(c,i){return c.x*i.x+c.y*i.y}function ez(c,i){if(c.length===1){let l=0;const h=i[l++];let p;for(;!p||h.equals(p);)if(p=i[l++],!p)return 1/0;for(;l<i.length;l++){const _=i[l],y=c[0],w=p.sub(h),S=_.sub(h),R=y.sub(h),O=Fb(w,w),D=Fb(w,S),z=Fb(S,S),V=Fb(R,w),H=Fb(R,S),K=O*z-D*D,re=(z*V-D*H)/K,ne=(O*H-D*V)/K,ue=h.z*(1-re-ne)+p.z*re+_.z*ne;if(isFinite(ue))return ue}return 1/0}{let l=1/0;for(const h of i)l=Math.min(l,h.z);return l}}function tz(c,i,l){let h=1/0;Ui(l,i)&&(h=ez(l,i[0]));for(let p=0;p<i.length;p++){const _=i[p],y=c[p];for(let w=0;w<_.length-1;w++){const S=_[w],R=[S,_[w+1],y[w+1],y[w],S];Ri(l,R)&&(h=Math.min(h,ez(l,R)))}}return h!==1/0&&h}function nz(c,i,l,h,p,_,y,w,S,R,O){return c.projection.name==="globe"?function(D,z,V,H,K,re,ne,ue,he,ge,ke){const Ee=[],Me=[],Be=D.projection.upVectorScale(ke,D.center.lat,D.worldSize).metersToTile,$e=[0,0,0,1],pt=[0,0,0,1],Ye=(kt,It,Ft,jt)=>{kt[0]=It,kt[1]=Ft,kt[2]=jt,kt[3]=1},vt=qN();V>0&&(V+=vt),H+=vt;for(const kt of z){const It=[],Ft=[];for(const jt of kt){const Lt=jt.x+K.x,Dt=jt.y+K.y,yt=D.projection.projectTilePoint(Lt,Dt,ke),gt=D.projection.upVector(ke,jt.x,jt.y);let zt=V,Jt=H;if(ne){const Gt=rz(Lt,Dt,V,H,ne,ue,he,ge);zt+=Gt.base,Jt+=Gt.top}V!==0?Ye($e,yt.x+gt[0]*Be*zt,yt.y+gt[1]*Be*zt,yt.z+gt[2]*Be*zt):Ye($e,yt.x,yt.y,yt.z),Ye(pt,yt.x+gt[0]*Be*Jt,yt.y+gt[1]*Be*Jt,yt.z+gt[2]*Be*Jt),nn($e,$e,re),nn(pt,pt,re),It.push(new hg($e[0],$e[1],$e[2])),Ft.push(new hg(pt[0],pt[1],pt[2]))}Ee.push(It),Me.push(Ft)}return[Ee,Me]}(c,i,l,h,p,_,y,w,S,R,O):y?function(D,z,V,H,K,re,ne,ue,he){const ge=[],ke=[],Ee=[0,0,0,1];for(const Me of D){const Be=[],$e=[];for(const pt of Me){const Ye=pt.x+H.x,vt=pt.y+H.y,kt=rz(Ye,vt,z,V,re,ne,ue,he);Ee[0]=Ye,Ee[1]=vt,Ee[2]=kt.base,Ee[3]=1,$i(Ee,Ee,K),Ee[3]=Math.max(Ee[3],1e-5);const It=new hg(Ee[0]/Ee[3],Ee[1]/Ee[3],Ee[2]/Ee[3]);Ee[0]=Ye,Ee[1]=vt,Ee[2]=kt.top,Ee[3]=1,$i(Ee,Ee,K),Ee[3]=Math.max(Ee[3],1e-5);const Ft=new hg(Ee[0]/Ee[3],Ee[1]/Ee[3],Ee[2]/Ee[3]);Be.push(It),$e.push(Ft)}ge.push(Be),ke.push($e)}return[ge,ke]}(i,l,h,p,_,y,w,S,R):function(D,z,V,H,K){const re=[],ne=[],ue=K[8]*z,he=K[9]*z,ge=K[10]*z,ke=K[11]*z,Ee=K[8]*V,Me=K[9]*V,Be=K[10]*V,$e=K[11]*V;for(const pt of D){const Ye=[],vt=[];for(const kt of pt){const It=kt.x+H.x,Ft=kt.y+H.y,jt=K[0]*It+K[4]*Ft+K[12],Lt=K[1]*It+K[5]*Ft+K[13],Dt=K[2]*It+K[6]*Ft+K[14],yt=K[3]*It+K[7]*Ft+K[15],gt=jt+ue,zt=Lt+he,Jt=Dt+ge,Gt=Math.max(yt+ke,1e-5),Fn=jt+Ee,mn=Lt+Me,xn=Dt+Be,Pn=Math.max(yt+$e,1e-5);Ye.push(new hg(gt/Gt,zt/Gt,Jt/Gt)),vt.push(new hg(Fn/Pn,mn/Pn,xn/Pn))}re.push(Ye),ne.push(vt)}return[re,ne]}(i,l,h,p,_)}function rz(c,i,l,h,p,_,y,w){const S=y*p.getElevationAt(c,i,!0,!0),R=_[0]!==0,O=R?_[1]===0?y*(_[0]/DN-NN):y*function(D,z,V){const H=Math.floor(z[0]/8),K=Math.floor(z[1]/8),re=10*(z[0]-8*H),ne=10*(z[1]-8*K),ue=D.getElevationAt(H,K,!0,!0),he=D.getMeterToDEM(V),ge=Math.floor(.5*(re*he-1)),ke=Math.floor(.5*(ne*he-1)),Ee=D.tileCoordToPixel(H,K),Me=2*ge+1,Be=2*ke+1,$e=function(Ft,jt,Lt,Dt,yt){return[Ft.getElevationAtPixel(jt,Lt,!0),Ft.getElevationAtPixel(jt+yt,Lt,!0),Ft.getElevationAtPixel(jt,Lt+yt,!0),Ft.getElevationAtPixel(jt+Dt,Lt+yt,!0)]}(D,Ee.x-ge,Ee.y-ke,Me,Be),pt=Math.abs($e[0]-$e[1]),Ye=Math.abs($e[2]-$e[3]),vt=Math.abs($e[0]-$e[2])+Math.abs($e[1]-$e[3]),kt=Math.min(.25,.5*he*(pt+Ye)/Me),It=Math.min(.25,.5*he*vt/Be);return ue+Math.max(kt*re,It*ne)}(p,_,w):S;return{base:S+(l===0?-1:l),top:R?Math.max(O+h,S+l+2):S+h}}class Fre{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Bre{constructor(){this.tasks={},this.taskQueue=[],We(["process"],this),this.invoker=new Fre(this.process),this.nextId=0}add(i,l){const h=this.nextId++,p=function({type:_,isSymbolTile:y,zoom:w}){return w=w||0,_==="message"?0:_!=="maybePrepare"||y?_!=="parseTile"||y?_==="parseTile"&&y?300-w:_==="maybePrepare"&&y?400-w:500:200-w:100-w}(l);if(p===0){try{i()}finally{}return null}return this.tasks[h]={fn:i,metadata:l,priority:p,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const i=this.pick();if(i===null)return;const l=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let i=null,l=1/0;for(let p=0;p<this.taskQueue.length;p++){const _=this.tasks[this.taskQueue[p]];_.priority<l&&(l=_.priority,i=p)}if(i===null)return null;const h=this.taskQueue[i];return this.taskQueue.splice(i,1),h}remove(){this.invoker.remove()}}class iz{constructor(i,l,h){this.target=i,this.parent=l,this.mapId=h,this.callbacks={},this.cancelCallbacks={},We(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Bre}send(i,l,h,p,_=!1,y){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(h.metadata=y,this.callbacks[w]=h);const S=new Set;return this.target.postMessage({id:w,type:i,hasCallback:!!h,targetMapId:p,mustQueue:_,sourceMapId:this.mapId,data:Sd(l,S)},S),{cancel:()=>{h&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(i){const l=i.data;if(!l)return;const h=l.id;if(h&&(!l.targetMapId||this.mapId===l.targetMapId))if(l.type==="<cancel>"){const p=this.cancelCallbacks[h];delete this.cancelCallbacks[h],p&&p.cancel()}else if(l.mustQueue||ni(self)){const p=this.callbacks[h],_=this.scheduler.add(()=>this.processTask(h,l),p&&p.metadata||{type:"message"});_&&(this.cancelCallbacks[h]=_)}else this.processTask(h,l)}processTask(i,l){if(delete this.cancelCallbacks[i],l.type==="<response>"){const h=this.callbacks[i];delete this.callbacks[i],h&&(l.error?h(Ch(l.error)):h(null,Ch(l.data)))}else{const h=new Set,p=l.hasCallback?(y,w)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:y?Sd(y):null,data:Sd(w,h)},h)}:()=>{},_=Ch(l.data);if(this.parent[l.type])this.parent[l.type](l.sourceMapId,_,p);else if(this.parent.getWorkerSource){const y=l.type.split("."),{source:w,scope:S}=_;this.parent.getWorkerSource(l.sourceMapId,y[0],w,S)[y[1]](_,p)}else p(new Error(`Could not find function ${l.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Bb={workerUrl:"",workerClass:null,workerParams:void 0};const RI="mapboxgl_preloaded_worker_pool";class fg{constructor(i){this.active={},this.name=i}acquire(i,l=fg.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<l;){const p=(h=`${this.name||""}WorkerPool: ${i}-${this.workers.length}`,Bb.workerClass!=null?new Bb.workerClass:new self.Worker(Bb.workerUrl,Object.assign({name:h},Bb.workerParams)));this.workers.push(p)}var h;return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.workers&&this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[RI]}numActive(){return Object.keys(this.active).length}}fg.workerCount=2;class e1{constructor(i,l,h="Worker",p=fg.workerCount){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=je();const _=this.workerPool.acquire(this.id,p);for(let y=0;y<_.length;y++){const w=new e1.Actor(_[y],l,this.id);w.name=`${h} ${y}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,l,h){De(this.actors,(p,_)=>{p.send(i,l,_)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}let jb,MI;function fS(){return jb||(jb=new fg),jb}e1.Actor=iz;const PI=4096;class jre{constructor(i){this.module=i,this.memoryStack=this.module.malloc(PI),this.memoryStackNextFree=this.memoryStack}createIntArray(i){const l=this.memoryStackNextFree;return this.memoryStackNextFree+=i.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>PI?-1:(new Int32Array(this.module.heap32.buffer,l,i.length).set(i),l)}createFloatArray(i){const l=this.memoryStackNextFree;return this.memoryStackNextFree+=i.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>PI?-1:(new Float32Array(this.module.heapF32.buffer,l,i.length).set(i),l)}readStringBuffer(i){let l="";for(;this.module.heapU8[i]!==0;)l+=String.fromCharCode(this.module.heapU8[i]),++i;return l}setStyle(i){const l=i.normalScale;this.module.setStyle(l[0],l[1],l[2],i.tileToMeters)}setAOOptions(i,l){this.module.setAOOptions(i?1:0,l)}setMetricOptions(i,l){this.module.setMetricOptions(i?1:0,l)}setStructuralOptions(i){this.module.setStructuralOptions(i?1:0)}setFacadeOptions(i,l){this.module.setFacadeOptions(i,l?1:0)}setFauxFacadeOptions(i,l,h){this.module.setFauxFacadeOptions(i?1:0,l?1:0,h)}setFacadeClassifierOptions(i){this.module.setFacadeClassifierOptions(i)}generateMesh(i,l){this.memoryStackNextFree=this.memoryStack;for(const w of i){const S=this.createIntArray(w.ringIndices),R=this.createFloatArray(w.coordinates);if(S===-1||R===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(w.id,w.sourceId,w.minHeight,w.height,w.roofType,R,S,w.ringIndices.length-1)}for(const w of l){let S;S=w.entrances?JSON.parse(w.entrances):[];const R=this.createFloatArray(S),O=this.createFloatArray(w.coordinates);if(R===-1||O===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(w.sourceId,w.crossPerc,w.distanceToRoad,R,S.length,O,w.coordinates.length)}if(!this.module.generateMesh()){const w=this.module.getLastError();return this.readStringBuffer(w)}const h=this.module.getMeshCount(),p=new Array(h);for(let w=0;w<h;w++){const S=this.module.getPositionsPtr(w),R=this.module.getPositionsLength(w),O=new Float32Array(this.module.heapF32.buffer,S,R),D=this.module.getNormalsPtr(w),z=this.module.getNormalsLength(w),V=new Float32Array(this.module.heapF32.buffer,D,z),H=this.module.getAOPtr(w),K=this.module.getAOLength(w),re=new Float32Array(this.module.heapF32.buffer,H,K),ne=this.module.getUVPtr(w),ue=this.module.getUVLength(w),he=new Float32Array(this.module.heapF32.buffer,ne,ue),ge=this.module.getFauxFacadePtr(w),ke=this.module.getFauxFacadeLength(w),Ee=new Uint8Array(this.module.heapU8.buffer,ge,ke),Me=this.module.getIndicesPtr(w),Be=this.module.getIndicesLength(w),$e=new Int16Array(this.module.heap16.buffer,Me,Be),pt=this.module.getBuildingPart(w);p[w]={positions:O,normals:V,ao:re,uv:he,isFauxFacade:Ee,indices:$e,buildingPart:pt}}const _=this.module.getRingCount(),y=[];for(let w=0;w<_;w++){const S=this.module.getRingPtr(w),R=this.module.getRingLength(w),O=new Float32Array(this.module.heapF32.buffer,S,R);y.push(O)}return{meshes:p,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:y}}}let Ub,OI,zd,t1,LI,n1=null,r1=null,sz=null,pS=null;function az(){return ni(self)&&self.worker.dracoUrl?self.worker.dracoUrl:OI||ri.DRACO_URL}function oz(){if(ni(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(t1)return t1;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return t1=WebAssembly.validate(c)?ri.MESHOPT_SIMD_URL:ri.MESHOPT_URL,t1}function Ure(){return pS}const mS={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Vre={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Vb={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function lz(c,i,l){const h=l.json.bufferViews.length,p=l.buffers.length;i.bufferView=h,l.json.bufferViews[h]={buffer:p,byteLength:c.byteLength},l.buffers[p]=c}const DI="KHR_draco_mesh_compression";function $re(c,i){const l=c.extensions&&c.extensions[DI];if(!l)return;const h=new zd.Decoder,p=hz(i,l.bufferView),_=new zd.Mesh;if(!h.DecodeArrayToMesh(p,p.byteLength,_))throw new Error("Failed to decode Draco mesh");const y=i.json.accessors[c.indices],w=mS[y.componentType],S=y.count*w.BYTES_PER_ELEMENT,R=zd._malloc(S);w===Uint16Array?h.GetTrianglesUInt16Array(_,S,R):h.GetTrianglesUInt32Array(_,S,R),lz(zd.memory.buffer.slice(R,R+S),y,i),zd._free(R);for(const O of Object.keys(l.attributes)){const D=h.GetAttributeByUniqueId(_,l.attributes[O]),z=i.json.accessors[c.attributes[O]],V=Vre[z.componentType],H=z.count*Vb[z.type]*mS[z.componentType].BYTES_PER_ELEMENT,K=zd._malloc(H);h.GetAttributeDataArrayForAllPoints(_,D,zd[V],H,K),lz(zd.memory.buffer.slice(K,K+H),z,i),zd._free(K)}h.destroy(),_.destroy(),delete c.extensions[DI]}const gS="EXT_meshopt_compression";function Hre(c,i){if(!c.extensions||!c.extensions[gS])return;const l=c.extensions[gS],h=new Uint8Array(i.buffers[l.buffer],l.byteOffset||0,l.byteLength||0),p=new Uint8Array(l.count*l.byteStride);LI.decodeGltfBuffer(p,l.count,l.byteStride,h,l.mode,l.filter),c.buffer=i.buffers.length,c.byteOffset=0,i.buffers[c.buffer]=p.buffer,delete c.extensions[gS]}const uz=1179937895,cz=new TextDecoder("utf8");function dz(c,i){return new URL(c,i).href}function Gre(c,i,l,h){return fetch(dz(c.uri,h)).then(p=>p.arrayBuffer()).then(p=>{i.buffers[l]=p})}function hz(c,i){const l=c.json.bufferViews[i];return new Uint8Array(c.buffers[l.buffer],l.byteOffset||0,l.byteLength)}function qre(c,i,l,h){if(c.uri){const p=dz(c.uri,h);return fetch(p).then(_=>_.blob()).then(_=>createImageBitmap(_)).then(_=>{i.images[l]=_})}if(c.bufferView!==void 0){const p=hz(i,c.bufferView),_=new Blob([p],{type:c.mimeType});return createImageBitmap(_).then(y=>{i.images[l]=y})}}function fz(c,i=0,l){const h={json:null,images:[],buffers:[]};if(new Uint32Array(c,i,1)[0]===uz){const O=new Uint32Array(c,i);let D=2;const z=(O[D++]>>2)-3,V=O[D++]>>2;if(D++,h.json=JSON.parse(cz.decode(O.subarray(D,D+V))),D+=V,D<z){const H=O[D++];D++;const K=i+(D<<2);h.buffers[0]=c.slice(K,K+H)}}else h.json=JSON.parse(cz.decode(new Uint8Array(c,i)));const{buffers:p,images:_,meshes:y,extensionsUsed:w,bufferViews:S}=h.json;let R=Promise.resolve();if(p){const O=[];for(let D=0;D<p.length;D++){const z=p[D];z.uri?O.push(Gre(z,h,D,l)):h.buffers[D]||(h.buffers[D]=null)}R=Promise.all(O)}return R.then(()=>{const O=[],D=w&&w.includes(DI),z=w&&w.includes(gS);if(D&&O.push(function(){if(!zd)return Ub??(Ub=function(V){let H,K=null;function re(){H=new Uint8Array(K.buffer)}function ne(){throw new Error("Unexpected Draco error.")}const ue={a:{a:ne,d:function(he,ge,ke){return H.copyWithin(he,ge,ge+ke)},c:function(he){const ge=H.length,ke=Math.max(he>>>0,Math.ceil(1.2*ge)),Ee=Math.ceil((ke-ge)/65536);try{return K.grow(Ee),re(),!0}catch{return!1}},b:ne}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(V,ue):V.then(he=>he.arrayBuffer()).then(he=>WebAssembly.instantiate(he,ue))).then(he=>{const{Rb:ge,Qb:ke,P:Ee,T:Me,X:Be,Ja:$e,La:pt,Qa:Ye,Va:vt,Wa:kt,eb:It,jb:Ft,f:jt,e:Lt,yb:Dt,zb:yt,Ab:gt,Bb:zt,Db:Jt,Gb:Gt}=he.instance.exports;K=Lt;const Fn=(()=>{let mn=0,xn=0,Pn=0,Yr=0;return Wt=>{Pn&&(ge(Yr),ge(mn),xn+=Pn,Pn=mn=0),mn||(xn+=128,mn=ke(xn));const On=Wt.length+7&-8;let Rr=mn;On>=xn&&(Pn=On,Rr=Yr=ke(On));for(let fi=0;fi<Wt.length;fi++)H[Rr+fi]=Wt[fi];return Rr}})();return re(),jt(),{memory:Lt,_free:ge,_malloc:ke,Mesh:class{constructor(){this.ptr=Ee()}destroy(){Me(this.ptr)}},Decoder:class{constructor(){this.ptr=$e()}destroy(){Ft(this.ptr)}DecodeArrayToMesh(mn,xn,Pn){const Yr=Fn(mn),Wt=pt(this.ptr,Yr,xn,Pn.ptr);return!!Be(Wt)}GetAttributeByUniqueId(mn,xn){return{ptr:Ye(this.ptr,mn.ptr,xn)}}GetTrianglesUInt16Array(mn,xn,Pn){vt(this.ptr,mn.ptr,xn,Pn)}GetTrianglesUInt32Array(mn,xn,Pn){kt(this.ptr,mn.ptr,xn,Pn)}GetAttributeDataArrayForAllPoints(mn,xn,Pn,Yr,Wt){It(this.ptr,mn.ptr,xn.ptr,Pn,Yr,Wt)}},DT_INT8:Dt(),DT_UINT8:yt(),DT_INT16:gt(),DT_UINT16:zt(),DT_UINT32:Jt(),DT_FLOAT32:Gt()}})}(fetch(az())),Ub.then(V=>{zd=V,Ub=void 0}))}()),z&&O.push(function(){if(LI)return;const V=function(H){let K;const re=WebAssembly.instantiateStreaming(H,{}).then(he=>{K=he.instance,K.exports.__wasm_call_ctors()}),ne={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ue={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:re,supported:!0,decodeGltfBuffer(he,ge,ke,Ee,Me,Be){(function($e,pt,Ye,vt,kt,It,Ft){const jt=$e.exports.sbrk,Lt=vt+3&-4,Dt=jt(Lt*kt),yt=jt(It.length),gt=new Uint8Array($e.exports.memory.buffer);gt.set(It,yt);const zt=pt(Dt,vt,kt,yt,It.length);if(zt===0&&Ft&&Ft(Dt,Lt,kt),Ye.set(gt.subarray(Dt,Dt+vt*kt)),jt(Dt-jt(0)),zt!==0)throw new Error(`Malformed buffer data: ${zt}`)})(K,K.exports[ue[Me]],he,ge,ke,Ee,K.exports[ne[Be]])}}}(fetch(oz()));return V.ready.then(()=>{LI=V})}()),_)for(let V=0;V<_.length;V++)O.push(qre(_[V],h,V,l));return(O.length?Promise.all(O):Promise.resolve()).then(()=>{if(D&&y)for(const{primitives:V}of y)for(const H of V)$re(H,h);if(z&&y&&S)for(const V of S)Hre(V,h);return h})})}function pz(c){return fetch(c).then(i=>i.arrayBuffer()).then(i=>fz(i,0,c))}function NI(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function zI(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class FI{constructor(i,l,h,p){this.context=i,this.format=h,this.useMipmap=p&&p.useMipmap,this.texture=i.gl.createTexture(),this.update(l,{premultiply:p&&p.premultiply})}update(i,l){const h=i&&i instanceof HTMLVideoElement&&i.width===0?i.videoWidth:i.width,p=i&&i instanceof HTMLVideoElement&&i.height===0?i.videoHeight:i.height,{context:_}=this,{gl:y}=_,{x:w,y:S}=l&&l.position?l.position:{x:0,y:0},R=w+h,O=S+p;!this.size||this.size[0]===R&&this.size[1]===O||(y.bindTexture(y.TEXTURE_2D,null),y.deleteTexture(this.texture),this.texture=y.createTexture(),this.size=null),y.bindTexture(y.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA8&&(!l||l.premultiply!==!1));const D=i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap;if(!this.size&&R>0&&O>0){const z=this.useMipmap?Math.floor(Math.log2(Math.max(R,O)))+1:1;y.texStorage2D(y.TEXTURE_2D,z,this.format,R,O),this.size=[R,O]}this.size&&(D?y.texSubImage2D(y.TEXTURE_2D,0,w,S,NI(this.format),zI(this.format),i):"data"in i&&i.data&&y.texSubImage2D(y.TEXTURE_2D,0,w,S,h,p,NI(this.format),zI(this.format),i.data)),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(i,l,h=!1){const{context:p}=this,{gl:_}=p;_.bindTexture(_.TEXTURE_2D,this.texture),i!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,i),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap&&!h?i===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),l!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,l),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,l),this.wrapS=l)}bindExtraParam(i,l,h,p,_){const{context:y}=this,{gl:w}=y;w.bindTexture(w.TEXTURE_2D,this.texture),l!==this.magFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,l),this.magFilter=l),i!==this.minFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,this.useMipmap?i===w.NEAREST?w.NEAREST_MIPMAP_NEAREST:w.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),h!==this.wrapS&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,h),this.wrapS=h),p!==this.wrapT&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,p),this.wrapT=p),_!==this.compareMode&&(_?(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.COMPARE_REF_TO_TEXTURE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_FUNC,_)):w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.NONE),this.compareMode=_)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class $b{constructor(i,l){this.context=i,this.texture=l}bind(i,l){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),i!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,i),this.minFilter=i),l!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,l),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,l),this.wrapS=l)}}const Wre=ui([{name:"a_pos_3f",components:3,type:"Float32"}]),Zre=ui([{name:"a_color_3f",components:3,type:"Float32"}]),Xre=ui([{name:"a_color_4f",components:4,type:"Float32"}]),Yre=ui([{name:"a_uv_2f",components:2,type:"Float32"}]),Kre=ui([{name:"a_normal_3f",components:3,type:"Float32"}]),Qre=ui([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Jre=ui([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function mz(c,i){const l=_S(c.projection,c.zoom,c.width,c.height),h=function(_,y,w,S,R){const O=new d(w.lng-180*tm,w.lat),D=new d(w.lng+180*tm,w.lat),z=_.project(O.lng,O.lat),V=_.project(D.lng,D.lat),H=-Math.atan2(V.y-z.y,V.x-z.x),K=pe.fromLngLat(w);K.y=ee(K.y,-1+tm,1-tm);const re=K.toLngLat(),ne=_.project(re.lng,re.lat),ue=pe.fromLngLat(re);ue.x+=tm;const he=ue.toLngLat(),ge=_.project(he.lng,he.lat),ke=_z(ge.x-ne.x,ge.y-ne.y,H),Ee=pe.fromLngLat(re);Ee.y+=tm;const Me=Ee.toLngLat(),Be=_.project(Me.lng,Me.lat),$e=_z(Be.x-ne.x,Be.y-ne.y,H),pt=Math.abs(ke.x)/Math.abs($e.y),Ye=q([]);be(Ye,Ye,-H*(1-(R?0:S)));const vt=q([]);return ie(vt,vt,[1,1-(1-pt)*S,1]),vt[4]=-$e.x/$e.y*S,be(vt,vt,H),$(vt,Ye,vt),vt}(c.projection,0,c.center,l,i),p=gz(c);return ie(h,h,[p,p,1]),h}function gz(c){const i=c.projection,l=_S(c.projection,c.zoom,c.width,c.height),h=BI(i,c.center),p=BI(i,d.convert(i.center));return Math.pow(2,h*l+(1-l)*p)}function _S(c,i,l,h,p=1/0){const _=c.range;if(!_)return 0;const y=Math.min(p,Math.max(l,h)),w=Math.log2(y/1024);return le(_[0]+w,_[1]+w,i)}const tm=1/4e4;function BI(c,i){const l=ee(i.lat,-Y,Y),h=new d(i.lng-180*tm,l),p=new d(i.lng+180*tm,l),_=c.project(h.lng,l),y=c.project(p.lng,l),w=pe.fromLngLat(h),S=pe.fromLngLat(p),R=y.x-_.x,O=y.y-_.y,D=S.x-w.x,z=S.y-w.y,V=Math.sqrt((D*D+z*z)/(R*R+O*O));return Math.log2(V)}function _z(c,i,l){const h=Math.cos(l),p=Math.sin(l);return{x:c*h-i*p,y:c*p+i*h}}function yz(c,i,l){q(c),be(c,c,Tn(i[2])),de(c,c,Tn(i[0])),fe(c,c,Tn(i[1])),ie(c,c,l),$(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function yS(c,i,l,h,p,_,y,w){const S=[l[0]-i[0],l[1]-i[1],0],R=[h[0]-i[0],h[1]-i[1],0];if(Pt(S)<1e-12||Pt(R)<1e-12)return tn(c);const O=Sn([],S,R);Vt(O,O),mt(R,h,i),S[2]=(_-p)*w,R[2]=(y-p)*w;const D=S;return Sn(D,S,R),Vt(D,D),Jn(c,O,D)}function vS(c,i,l=!1){const h=Jp(i.zoom),p=function(_,y,w){const S=y.worldSize,R=[_[12],_[13],_[14]],O=Z(R[1]/S),D=j(R[0]/S),z=q([]),V=N(1,O)*S,H=N(1,0)*S*J(O,y.zoom),K=1/pI(S);let re=H*K;if(w){const ge=_S(y.projection,y.zoom,y.width,y.height,1024);re=K*y.projection.pixelSpaceConversion(y.center.lat,S,ge)}const ne=Yp(O,D);tt(ne,ne,ze([],Vt([],ne),V*re*R[2]));const ue=function(ge){const ke=[ge[0],ge[1],ge[2]];let Ee=[0,1,0];const Me=Sn([],Ee,ke);return Sn(Ee,ke,Me),Nn(Ee)===0&&(Ee=[0,1,0],Sn(Me,ke,Ee)),Vt(Me,Me),Vt(Ee,Ee),Vt(ke,ke),[Me[0],Me[1],Me[2],0,Ee[0],Ee[1],Ee[2],0,ke[0],ke[1],ke[2],0,ge[0],ge[1],ge[2],1]}(ne);ie(z,z,[re,re,re*V]),X(z,z,[-R[0],-R[1],-R[2]]);const he=$([],y.globeMatrix,ue);return $(he,he,z),$(he,he,_),he}(c,i,l);if(h>0){const _=function(y,w){const S=w.worldSize,R=N(1,0)*S*J(w.center.lat,w.zoom)/pI(S),O=N(1,w.center.lat)*S,D=q([]);fe(D,D,Tn(w.center.lng)),de(D,D,Tn(w.center.lat)),X(D,D,[0,0,Yo]),ie(D,D,[R,R,R*O]);const z=w.point;return X(D,D,[-z.x,-z.y,0]),$(D,D,y),$(D,w.globeMatrix,D)}(c,i);return function(y,w,S){const R=(H,K,re)=>{const ne=Pt(H),ue=Pt(K),he=Nd(H,K,re);return ze(he,he,1/Pt(he)*br(ne,ue,re))},O=R([y[0],y[1],y[2]],[w[0],w[1],w[2]],S),D=R([y[4],y[5],y[6]],[w[4],w[5],w[6]],S),z=R([y[8],y[9],y[10]],[w[8],w[9],w[10]],S),V=Nd([y[12],y[13],y[14]],[w[12],w[13],w[14]],S);return[O[0],O[1],O[2],0,D[0],D[1],D[2],0,z[0],z[1],z[2],0,V[0],V[1],V[2],1]}(p,_,h)}return p}function jI(c,i,l,h){const p=Dn.projectAabbCorners(h,l);let _=Number.MAX_VALUE;for(let w=0;w<p.length;++w){const S=p[w];S[0]=(.5*S[0]+.5)*i.width,S[1]=(.5-.5*S[1])*i.height,S[2]<_&&(_=S[2])}const y=function(w){const S=[];let R=0;for(let V=1;V<w.length;V++)(w[V][0]<w[R][0]||w[V][0]===w[R][0]&&w[V][1]<w[R][1])&&(R=V);let O,D=R;const z=new Uint8Array(w.length);do{if(z[D])break;S.push(new Ve(w[D][0],w[D][1])),z[D]=1,O=(D+1)%w.length;for(let V=0;V<w.length;V++){if(w[V][0]===w[O][0]&&w[V][1]===w[O][1]||w[V][0]===w[D][0]&&w[V][1]===w[D][1])continue;const H=[w[V][0]-w[D][0],w[V][1]-w[D][1]],K=[w[O][0]-w[D][0],w[O][1]-w[D][1]],re=H[0]*K[1]-H[1]*K[0];(re>0||re===0&&H[0]*K[0]+H[1]*K[1]>=0&&H[0]*H[0]+H[1]*H[1]>K[0]*K[0]+K[1]*K[1])&&(O=V)}D=O}while(D!==R);return S.length>0&&S.push(S[0]),S}(p);if(Ri(c,y))return _}const pg=64,i1={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function xS(c,i,l,h,p,_,y,w,S,R=!1){const O=l.zoom,D=l.project(h),z=J(h.lat,O),V=1/z;q(c),X(c,c,[D.x+y[0]*V,D.y+y[1]*V,y[2]]);let H=1,K=1;const re=l.worldSize;if(R){if(l.projection.name==="mercator"){let ge=0;l.elevation&&(ge=l.elevation.getAtPointOrZero(new pe(D.x/re,D.y/re),0));const ke=$i([],[D.x,D.y,ge,1],l.projMatrix)[3]/l.cameraToCenterDistance;H=ke,K=ke*J(l.center.lat,O)}else if(l.projection.name==="globe"){const ge=vS(c,l),ke=[0,0,0,1];$i(ke,ke,$([],l.projMatrix,ge));const Ee=ke[3]/l.cameraToCenterDistance,Me=Jp(O),Be=l.projection.pixelsPerMeter(h.lat,re)*J(h.lat,O),$e=l.projection.pixelsPerMeter(l.center.lat,re)*J(l.center.lat,O);H=Ee/br(Be,te(l.center.lat),Me),K=Ee*z/Be,H*=$e,K*=$e}}else H=V;ie(c,c,[H,H,K]);const ne=[...c],ue=i.orientation,he=[];if(yz(he,[ue[0]+(p?p[0]:0),ue[1]+(p?p[1]:0),ue[2]+(p?p[2]:0)],_),$(c,ne,he),w&&l.elevation){let ge=0;const ke=[];if(S&&l.elevation){ge=function(Me,Be,$e,pt,Ye){const vt=Be.elevation;if(!vt)return 0;const kt=Dn.projectAabbCorners($e,pt),It=N(1,Ye.lat)*Be.worldSize,Ft=function(xn,Pn){const Yr=[0,0,1],Wt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const On of Wt){const Rr=xn[On.corners[0]],fi=xn[On.corners[1]],xi=xn[On.corners[2]],Fr=[fi[0]-Rr[0],fi[1]-Rr[1],Pn*(fi[2]-Rr[2])],os=Sn(Fr,Fr,[xi[0]-Rr[0],xi[1]-Rr[1],Pn*(xi[2]-Rr[2])]);Vt(os,os),On.dotProductWithUp=En(os,Yr)}return Wt.sort((On,Rr)=>On.dotProductWithUp-Rr.dotProductWithUp),Wt[0].corners}(kt,It),jt=kt[Ft[0]],Lt=kt[Ft[1]],Dt=kt[Ft[2]],yt=kt[Ft[3]],gt=vt.getAtPointOrZero(new pe(jt[0]/Be.worldSize,jt[1]/Be.worldSize),0),zt=vt.getAtPointOrZero(new pe(Lt[0]/Be.worldSize,Lt[1]/Be.worldSize),0),Jt=vt.getAtPointOrZero(new pe(Dt[0]/Be.worldSize,Dt[1]/Be.worldSize),0),Gt=vt.getAtPointOrZero(new pe(yt[0]/Be.worldSize,yt[1]/Be.worldSize),0),Fn=(gt+Gt)/2,mn=(zt+Jt)/2;return Fn>mn?zt<Jt?yS(Me,Lt,yt,jt,zt,Gt,gt,It):yS(Me,Dt,jt,yt,Jt,gt,Gt,It):gt<Gt?yS(Me,jt,Lt,Dt,gt,zt,Jt,It):yS(Me,yt,Dt,Lt,Gt,Jt,zt,It),Math.max(Fn,mn)}(ke,l,i.aabb,c,h);const Ee=$([],qe([],ke),he);$(c,ne,Ee)}else ge=l.elevation.getAtPointOrZero(new pe(D.x/re,D.y/re),0);ge!==0&&(c[14]+=ge)}}class vz{constructor(i,l,h,p,_){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=i,this.uri=l,this.position=h!=null?new d(h[0],h[1]):new d(0,0),this.orientation=p??[0,0,0],this.nodes=_,this.uploaded=!1,this.aabb=new Dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(i,l){$(i.globalMatrix,l,i.localMatrix);const h=this.nodeOverrides.get(i.name);if(h!==void 0){const y=[];_=h.orientation,q(p=y),fe(p,p,Tn(_[1])),be(p,p,Tn(_[2])),de(p,p,Tn(_[0])),$(i.globalMatrix,i.globalMatrix,y)}var p,_;if(i.meshes)for(const y of i.meshes){const w=Dn.applyTransformFast(y.aabb,i.globalMatrix);this.aabb.encapsulate(w)}if(i.children)for(const y of i.children)this._applyTransformations(y,i.globalMatrix)}computeBoundsAndApplyParent(){const i=q([]);this.aabb=new Dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.nodes)this._applyTransformations(l,i)}computeModelMatrix(i,l,h,p,_,y,w=!1){xS(this.matrix,this,i.transform,this.position,l,h,p,_,y,w)}upload(i){if(!this.uploaded){for(const l of this.nodes)UI(l,i);for(const l of this.nodes)bS(l);this.uploaded=!0}}destroy(){for(const i of this.nodes)VI(i)}}function Hb(c,i,l=!1){c.uploaded||(c.gfxTexture=new FI(i,c.image,l?i.gl.R8:i.gl.RGBA8,{useMipmap:c.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function eie(c,i,l){c.indexBuffer=i.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=i.createVertexBuffer(c.vertexArray,Wre.members,!1,!0),c.normalArray&&(c.normalBuffer=i.createVertexBuffer(c.normalArray,Kre.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=i.createVertexBuffer(c.texcoordArray,Yre.members,!1,!0)),c.colorArray&&(c.colorBuffer=i.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?Zre:Xre).members,!1,!0)),c.featureArray&&(c.pbrBuffer=i.createVertexBuffer(c.featureArray,Jre.members,!0)),c.segments=ta.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const h=c.material;h.pbrMetallicRoughness.baseColorTexture&&Hb(h.pbrMetallicRoughness.baseColorTexture,i),h.pbrMetallicRoughness.metallicRoughnessTexture&&Hb(h.pbrMetallicRoughness.metallicRoughnessTexture,i),h.normalTexture&&Hb(h.normalTexture,i),h.occlusionTexture&&Hb(h.occlusionTexture,i,l),h.emissionTexture&&Hb(h.emissionTexture,i)}function UI(c,i,l){if(c.meshes)for(const h of c.meshes)eie(h,i,l);if(c.children)for(const h of c.children)UI(h,i,l)}function bS(c){if(c.meshes)for(const i of c.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(c.children)for(const i of c.children)bS(i)}function VI(c){if(c.meshes)for(const l of c.meshes)l.vertexBuffer&&(l.vertexBuffer.destroy(),l.indexBuffer.destroy(),l.normalBuffer&&l.normalBuffer.destroy(),l.texcoordBuffer&&l.texcoordBuffer.destroy(),l.colorBuffer&&l.colorBuffer.destroy(),l.pbrBuffer&&l.pbrBuffer.destroy(),l.segments.destroy(),l.material&&((i=l.material).pbrMetallicRoughness.baseColorTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),i.pbrMetallicRoughness.metallicRoughnessTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),i.normalTexture&&i.normalTexture.gfxTexture&&i.normalTexture.gfxTexture.destroy(),i.emissionTexture&&i.emissionTexture.gfxTexture&&i.emissionTexture.gfxTexture.destroy(),i.occlusionTexture&&i.occlusionTexture.gfxTexture&&i.occlusionTexture.gfxTexture.destroy()));var i;if(c.children)for(const l of c.children)VI(l)}function mg(c,i){const l=c.json.bufferViews[i.bufferView],h=mS[i.componentType];return new h(c.buffers[l.buffer],(i.byteOffset||0)+(l.byteOffset||0),i.count*(l.byteStride&&l.byteStride!==Vb[i.type]*h.BYTES_PER_ELEMENT?l.byteStride/h.BYTES_PER_ELEMENT:Vb[i.type]))}function $I(c,i,l,h){const p=mS[i.componentType],_=function(O){switch(O){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),y=c.json.bufferViews[i.bufferView],w=y.byteStride?y.byteStride/p.BYTES_PER_ELEMENT:Vb[i.type],S=l.float32,R=S.length/l.capacity;for(let O=0,D=0;O<i.count*w;O+=w,D+=R)for(let z=0;z<R;z++)S[D+z]=h[O+z]*_;l._trim()}function tie(c,i,l){const h=c.indices,p=c.attributes,_={};_.indexArray=new Wa;const y=i.json.accessors[h],w=y.count/3;_.indexArray.reserve(w);const S=mg(i,y);for(let z=0;z<w;z++)_.indexArray.emplaceBack(S[3*z],S[3*z+1],S[3*z+2]);_.indexArray._trim(),_.vertexArray=new cu;const R=i.json.accessors[p.POSITION];_.vertexArray.reserve(R.count);const O=mg(i,R);for(let z=0;z<R.count;z++)_.vertexArray.emplaceBack(O[3*z],O[3*z+1],O[3*z+2]);if(_.vertexArray._trim(),_.aabb=new Dn(R.min,R.max),_.centroid=function(z,V){const H=[0,0,0],K=z.length;if(K>0){for(let re=0;re<K;re++){const ne=3*z[re];H[0]+=V[ne],H[1]+=V[ne+1],H[2]+=V[ne+2]}H[0]/=K,H[1]/=K,H[2]/=K}return H}(S,O),p.COLOR_0!==void 0){const z=i.json.accessors[p.COLOR_0],V=Vb[z.type],H=mg(i,z);_.colorArray=V===3?new cu:new Ih,_.colorArray.resize(z.count),$I(i,z,_.colorArray,H)}if(p.NORMAL!==void 0){_.normalArray=new cu;const z=i.json.accessors[p.NORMAL];_.normalArray.resize(z.count);const V=mg(i,z);$I(i,z,_.normalArray,V)}if(p.TEXCOORD_0!==void 0&&l.length>0){_.texcoordArray=new Xc;const z=i.json.accessors[p.TEXCOORD_0];_.texcoordArray.resize(z.count);const V=mg(i,z);$I(i,z,_.texcoordArray,V)}if(p._FEATURE_ID_RGBA4444!==void 0){const z=i.json.accessors[p._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(_.featureData=mg(i,z))}p._FEATURE_RGBA4444!==void 0&&(_.featureData=new Uint32Array(mg(i,i.json.accessors[p._FEATURE_RGBA4444]).buffer));const D=c.material;return _.material=function(z,V){const{emissiveFactor:H=[0,0,0],alphaMode:K="OPAQUE",alphaCutoff:re=.5,normalTexture:ne,occlusionTexture:ue,emissiveTexture:he,doubleSided:ge,name:ke}=z,{baseColorFactor:Ee=[1,1,1,1],metallicFactor:Me=1,roughnessFactor:Be=1,baseColorTexture:$e,metallicRoughnessTexture:pt}=z.pbrMetallicRoughness||{},Ye=ue?V[ue.index]:void 0;if(ue&&ue.extensions&&ue.extensions.KHR_texture_transform&&Ye){const vt=ue.extensions.KHR_texture_transform;Ye.offsetScale=[vt.offset[0],vt.offset[1],vt.scale[0],vt.scale[1]]}return{name:ke,pbrMetallicRoughness:{baseColorFactor:new Yi(...Ee),metallicFactor:Me,roughnessFactor:Be,baseColorTexture:$e?V[$e.index]:void 0,metallicRoughnessTexture:pt?V[pt.index]:void 0},doubleSided:ge,emissiveFactor:new Yi(...H),alphaMode:K,alphaCutoff:re,normalTexture:ne?V[ne.index]:void 0,occlusionTexture:Ye,emissionTexture:he?V[he.index]:void 0,defined:z.defined===void 0}}(D!==void 0?i.json.materials[D]:{defined:!1},l),_}function xz(c,i,l){const{matrix:h,rotation:p,translation:_,scale:y,mesh:w,extras:S,children:R,name:O}=c,D={};if(D.name=O,D.localMatrix=h||function(z,V,H,K){var re=V[0],ne=V[1],ue=V[2],he=V[3],ge=re+re,ke=ne+ne,Ee=ue+ue,Me=re*ge,Be=re*ke,$e=re*Ee,pt=ne*ke,Ye=ne*Ee,vt=ue*Ee,kt=he*ge,It=he*ke,Ft=he*Ee,jt=K[0],Lt=K[1],Dt=K[2];return z[0]=(1-(pt+vt))*jt,z[1]=(Be+Ft)*jt,z[2]=($e-It)*jt,z[3]=0,z[4]=(Be-Ft)*Lt,z[5]=(1-(Me+vt))*Lt,z[6]=(Ye+kt)*Lt,z[7]=0,z[8]=($e+It)*Dt,z[9]=(Ye-kt)*Dt,z[10]=(1-(Me+pt))*Dt,z[11]=0,z[12]=H[0],z[13]=H[1],z[14]=H[2],z[15]=1,z}([],p||[0,0,0,1],_||[0,0,0],y||[1,1,1]),D.globalMatrix=U(D.localMatrix),w!==void 0){D.meshes=l[w];const z=D.anchor=[0,0];for(const V of D.meshes){const{min:H,max:K}=V.aabb;z[0]+=H[0]+K[0],z[1]+=H[1]+K[1]}z[0]=Math.floor(z[0]/D.meshes.length/2),z[1]=Math.floor(z[1]/D.meshes.length/2)}if(S&&(S.id&&(D.id=S.id),S.lights&&(D.lights=function(z){if(!z.length)return[];const V=function(ue){const he=atob(ue),ge=new Uint8Array(he.length);for(let ke=0;ke<he.length;ke++)ge[ke]=he.codePointAt(ke);return ge}(z),H=[],K=V.length/24,re=new Uint16Array(V.buffer),ne=new Float32Array(V.buffer);for(let ue=0;ue<K;ue++){const he=re[2*ue*6]/30,ge=re[2*ue*6+1]/30,ke=re[2*ue*6+10]/100,Ee=ne[6*ue+1],Me=ne[6*ue+2],Be=ne[6*ue+3],$e=ne[6*ue+4],pt=Be-Ee,Ye=$e-Me,vt=Math.hypot(pt,Ye);H.push({pos:[Ee+.5*pt,Me+.5*Ye,ge],normal:[Ye/vt,-pt/vt,0],width:vt,height:he,depth:ke,points:[Ee,Me,Be,$e]})}return H}(S.lights)),S.MAPBOX_geometry_bloom&&(D.isGeometryBloom=S.MAPBOX_geometry_bloom)),R){const z=[];for(const V of R)z.push(xz(i.json.nodes[V],i,l));D.children=z}return D}function nie(c){if(c.vertices.length===0||c.indices.length===0)return null;const i=new oS(c.vertices,c.indices,8,256),[l,h]=[i.min.clone(),i.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:i,min:l,max:h}}function rie(c){if(!c.extras||!c.extras.ground)return null;const i=c.extras.ground;if(!i||!Array.isArray(i)||i.length===0)return null;const l=i[0];if(!l||!Array.isArray(l)||l.length===0)return null;const h=[];for(const y of l){if(!Array.isArray(y)||y.length!==2)continue;const w=y[0],S=y[1];typeof w=="number"&&typeof S=="number"&&h.push(new Ve(w,S))}if(h.length<3)return null;h.length>1&&h[h.length-1].equals(h[0])&&h.pop();let p=0;for(let y=0;y<h.length;y++){const w=h[y],S=h[(y+1)%h.length],R=h[(y+2)%h.length];p+=(w.x-S.x)*(R.y-S.y)-(R.x-S.x)*(w.y-S.y)}p>0&&h.reverse();const _=Qy(h.flatMap(y=>[y.x,y.y]),[]);return _.length===0?null:{vertices:h,indices:_}}function iie(c,i){const l=[],h=[];let p=0;const _=[];for(const y of c){p=l.length;const w=y.vertexArray.float32,S=y.indexArray.uint16;for(let R=0;R<y.vertexArray.length;R++)_[0]=w[3*R+0],_[1]=w[3*R+1],_[2]=w[3*R+2],nn(_,_,i),l.push(new Ve(_[0],_[1]));for(let R=0;R<3*y.indexArray.length;R++)h.push(S[R]+p)}if(h.length%3!=0)return null;for(let y=0;y<h.length;y+=3){const w=l[h[y+0]],S=l[h[y+1]],R=l[h[y+2]];(w.x-S.x)*(R.y-S.y)-(R.x-S.x)*(w.y-S.y)>0&&([h[y+1],h[y+2]]=[h[y+2],h[y+1]])}return{vertices:l,indices:h}}function HI(c){const i=function(S,R){const O=[],D=WebGL2RenderingContext;if(S.json.textures)for(const z of S.json.textures){const V={magFilter:D.LINEAR,minFilter:D.NEAREST,wrapS:D.REPEAT,wrapT:D.REPEAT};z.sampler!==void 0&&Object.assign(V,S.json.samplers[z.sampler]),O.push({image:R[z.source],sampler:V,uploaded:!1})}return O}(c,c.images),l=function(S,R){const O=[];for(const D of S.json.meshes){const z=[];for(const V of D.primitives)z.push(tie(V,S,R));O.push(z)}return O}(c,i),{scenes:h,scene:p,nodes:_}=c.json,y=h?h[p||0].nodes:[..._.keys()],w=[];for(const S of y)w.push(xz(_[S],c,l));return function(S,R,O){const D={},z=new Set;for(let V=0;V<S.length;V++){const H=O[R[V]];if(!H.extras)continue;const K=H.extras["mapbox:footprint:version"],re=H.extras["mapbox:footprint:id"];(K||re)&&z.add(V),K==="1.0.0"&&re&&(D[re]=V)}for(let V=0;V<S.length;V++){if(z.has(V))continue;const H=S[V],K=O[R[V]];if(!K.extras)continue;let re=null;H.id in D&&(re=iie(S[D[H.id]].meshes,H.localMatrix)),re||(re=rie(K)),re&&(H.footprint=nie(re))}if(z.size>0){const V=Array.from(z.values()).sort((H,K)=>H-K);for(let H=V.length-1;H>=0;H--)S.splice(V[H],1)}}(w,y,c.json.nodes),w}function sie(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const i=c.vertexArray.float32,l=c.aabb.min[0]-1,h=c.aabb.min[1]-1,p=pg/(c.aabb.max[0]-l+2),_=pg/(c.aabb.max[1]-h+2);for(let y=0;y<i.length;y+=3){const w=i[y+2],S=(i[y+0]-l)*p|0,R=(i[y+1]-h)*_|0;w>c.heightmap[R*pg+S]&&(c.heightmap[R*pg+S]=w)}}function bz(c,i,l,h,p){l.reserve(l.length+4*c.length),h.reserve(h.length+10*c.length),p.reserve(p.length+10*c.length);let _=h.length;for(const y of c){const w=Math.min(10,Math.max(4,1.3*y.height))*i,S=[-y.normal[1],y.normal[0],0],R=Math.min(.29,.1*y.width/y.depth),O=y.width-2*y.depth*i*(R+.01),D=$t([],y.pos,S,O/2),z=$t([],y.pos,S,-O/2),V=[D[0],D[1],D[2]+y.height],H=[z[0],z[1],z[2]+y.height],K=$t([],y.normal,S,R);ze(K,K,w);const re=$t([],y.normal,S,-R);ze(re,re,w),tt(K,D,K),tt(re,z,re),D[2]+=.1,z[2]+=.1,h.emplaceBack(K[0],K[1],K[2]),h.emplaceBack(re[0],re[1],re[2]),h.emplaceBack(D[0],D[1],D[2]),h.emplaceBack(z[0],z[1],z[2]),h.emplaceBack(V[0],V[1],V[2]),h.emplaceBack(H[0],H[1],H[2]),h.emplaceBack(D[0],D[1],D[2]),h.emplaceBack(z[0],z[1],z[2]),h.emplaceBack(K[0],K[1],K[2]),h.emplaceBack(re[0],re[1],re[2]);const ne=O/w/2;p.emplaceBack(-ne-R,-1,ne,.8),p.emplaceBack(ne+R,-1,ne,.8),p.emplaceBack(-ne,0,ne,1.3),p.emplaceBack(ne,0,ne,1.3),p.emplaceBack(ne+R,-.8,ne,.7),p.emplaceBack(ne+R,-.8,ne,.7),p.emplaceBack(0,0,ne,1.3),p.emplaceBack(0,0,ne,1.3),p.emplaceBack(ne+R,-1.2,ne,.8),p.emplaceBack(ne+R,-1.2,ne,.8),l.emplaceBack(6+_,4+_,8+_),l.emplaceBack(7+_,9+_,5+_),l.emplaceBack(0+_,1+_,2+_),l.emplaceBack(1+_,3+_,2+_),_+=10}}function aie(c,i){const l={};l.indexArray=new Wa,l.vertexArray=new cu,l.colorArray=new Ih,bz(c,i,l.indexArray,l.vertexArray,l.colorArray);const h={defined:!0};h.emissiveFactor=Yi.black;const p={};return p.baseColorFactor=Yi.white,h.pbrMetallicRoughness=p,l.material=h,l.aabb=new Dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),l}const wz=ui([{name:"a_pos_3f",components:3,type:"Float32"}]),oie=ui([{name:"a_normal_3",components:3,type:"Int16"}]),lie=ui([{name:"a_centroid_3",components:3,type:"Int16"}]),Tz=ui([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),uie=ui([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),cie=ui([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),die=ui([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),hie=ui([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),fie=ui([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),Ez=He.types,wS=32767;function pie(c,i){const l=Qt+i;for(const h of c)for(const p of h)if(p.x<-i||p.x>l||p.y<-i||p.y>l)return!1;return!0}function mie(c){switch(c){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${c}`)}}class GI{constructor(){this.layoutVertexArray=new cu,this.layoutAttenuationArray=new Ih,this.layoutColorArray=new du,this.indexArray=new Wa,this.indexArrayForConflation=new Wa,this.segmentsBucket=new ta}}class qI{constructor(i){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new ta,this.entranceBloom=new GI;const l=66560;this.layoutVertexArray=new cu,this.layoutVertexArray.reserve(l),this.layoutNormalArray=new Hp,this.layoutNormalArray.reserve(l),this.layoutCentroidArray=new Hp,this.layoutCentroidArray.reserve(l),this.layoutColorArray=new du,this.layoutColorArray.reserve(l),this.layoutFloodLightDataArray=new Rh,this.layoutFloodLightDataArray.reserve(l),this.layoutAOArray=new jy,this.layoutAOArray.reserve(l),this.indexArray=new Wa,this.indexArray.reserve(66560),this.indexArrayForConflation=new Wa,this.segmentsBucket=new ta,this.entranceBloom=new GI,i&&(this.layoutFacadePaintArray=new du,this.layoutFacadeDataArray=new Df,this.layoutFacadeVerticalRangeArray=new du)}reserve(i,l,h){this.layoutVertexArray.reserveForAdditional(i),this.layoutCentroidArray.reserveForAdditional(i),this.layoutFloodLightDataArray.reserveForAdditional(i),this.layoutNormalArray.reserveForAdditional(i),this.layoutAOArray.reserveForAdditional(i),this.layoutColorArray.reserveForAdditional(i),this.indexArray.reserveForAdditional(l),h&&(this.layoutFacadePaintArray.reserveForAdditional(i),this.layoutFacadeDataArray.reserveForAdditional(i),this.layoutFacadeVerticalRangeArray.reserveForAdditional(i))}}class Sz{constructor(i){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Xc,this.footprintsIndices=new Rh,this.footprintsMin=new Ve(1/0,1/0),this.footprintsMax=new Ve(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new qI(!1),this.buildingWithFacade=new qI(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=i.index,this.hasPattern=!1,this.worldview=i.worldview,this.lut=i.lut,this.programConfigurations=new pc(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=i.projection,this.groundEffect=new kI(i),this.groundEffect.groundRadiusArray=new Id,this.hasAppearances=null}updateFootprints(i,l){const h=new oS([],[],1),p={vertices:[],indices:new Uint32Array(0),grid:h,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};l.push({footprint:p,id:i})}updateAppearances(i,l,h,p){}prepare(){return function(){if(pS!=null||sz!=null)return null;if(r1!=null)return r1;const i=fetch(ri.BUILDING_GEN_URL);return r1=function(l){let h,p,_,y,w;function S(){h=new Uint8Array(w.buffer),p=new Int16Array(w.buffer),_=new Int32Array(w.buffer),y=new Float32Array(w.buffer)}function R(){throw new Error("Unexpected BuildingGen error.")}const O=()=>{},D={a:{a:R,f:function(z){const V=h.length,H=Math.max(z>>>0,Math.ceil(1.2*V)),K=Math.ceil((H-V)/65536);try{return w.grow(K),S(),!0}catch{return!1}},g:R,b:O,c:O,d:O,e:O}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(l,D):l.then(z=>z.arrayBuffer()).then(z=>WebAssembly.instantiate(z,D))).then(z=>{const V=z.instance.exports;return(0,V.g)(),w=V.f,S(),new jre({setStyle:V.h,setAOOptions:V.i,setMetricOptions:V.j,setStructuralOptions:V.k,setFacadeOptions:V.l,setFauxFacadeOptions:V.m,setFacadeClassifierOptions:V.n,addFeature:V.o,addFacade:V.p,generateMesh:V.q,getLastError:V.r,getOuterRingLength:V.s,getMeshCount:V.t,getPositionsPtr:V.u,getPositionsLength:V.v,getNormalsPtr:V.w,getNormalsLength:V.x,getAOPtr:V.y,getAOLength:V.z,getUVPtr:V.A,getUVLength:V.B,getFauxFacadePtr:V.C,getFauxFacadeLength:V.D,getIndicesPtr:V.E,getIndicesLength:V.F,getBuildingPart:V.G,getRingCount:V.H,getRingPtr:V.I,getRingLength:V.J,malloc:V.K,free:V.L,heapU8:h,heap16:p,heap32:_,heapF32:y})})}(i).then(l=>(r1=null,pS=l,pS)).catch(l=>{un("Could not load building-gen"),r1=null,sz=l}),r1}()}populate(i,l,h,p){const _=Ure();if(!_)return;const y=ae(h);this.tileToMeter=y,this.brightness=l.brightness,_.setStyle({normalScale:[1,-1,y],tileToMeters:y}),_.setAOOptions(!1,.3),_.setMetricOptions(!1,16),_.setStructuralOptions(!0),_.setFacadeClassifierOptions(3);const w=new Map,S=new Map;let R=0;for(const{feature:ne}of i){if(Ez[ne.type]!=="LineString"){w.set(ne.id,ne.properties.source_id);continue}const ue=this.layers[0]._featureFilter.needGeometry;if(ue&&!this.layers[0]._featureFilter.filter(new Rs(this.zoom),ne,h))continue;const he=Xe(ne,ue);if(!ue&&!this.layers[0]._featureFilter.filter(new Rs(this.zoom),he,h))continue;const ge=ue?he.geometry:Fe(ne,h,p),ke=[];for(const $e of ge)for(const pt of $e)ke.push(pt.x),ke.push(pt.y);const Ee={coordinates:ke,crossPerc:ne.properties.cross_perc,distanceToRoad:ne.properties.distance_to_road,entrances:ne.properties.entrances,sourceId:0},Me=ne.properties.source_id;let Be=S.get(Me);Be||(Be=[],S.set(Me,Be)),Be.push(Ee),++R}this.maxHeight=0;const O=new Array,D=new Set,z=ne=>{ne!=null&&D.add(ne)},V=(ne,ue)=>{ne!=null&&O.push({buildingId:ne,footprintIndex:ue})},H=64*(i.length-R),K=H/2;this.buildingWithFacade.reserve(H,K,!0),this.buildingWithoutFacade.reserve(2*H,2*K,!1),this.footprintsIndices.reserve(16*(i.length-R)),this.footprintsVertices.reserve(8*(i.length-R));for(const{feature:ne,id:ue,index:he,sourceLayerIndex:ge}of i){if(Ez[ne.type]==="LineString")continue;const ke=this.layers[0]._featureFilter.needGeometry;if(ke&&!this.layers[0]._featureFilter.filter(new Rs(this.zoom),ne,h))continue;let Ee=null;if(ne.properties&&ne.properties.hasOwnProperty("building_id")&&(Ee=ne.properties.building_id,D.has(Ee)))continue;const Me=Xe(ne,ke);if(!ke&&!this.layers[0]._featureFilter.filter(new Rs(this.zoom),Me,h))continue;const Be=ke?Me.geometry:Fe(ne,h,p),$e=Ob(Be,500);let pt=!1;for(const _r of $e)if(_r.length!==1){pt=!0;break}if(pt){z(Ee);continue}if(!pie(Be,163)){z(Ee);continue}const Ye=this.layers[0],vt=mie(Ye.layout.get("building-roof-shape").evaluate(ne,{},h)),kt=Ye.layout.get("building-base").evaluate(ne,{},h),It=Ye.layout.get("building-height").evaluate(ne,{},h),Ft=Ye.layout.get("building-flood-light-ground-radius").evaluate(ne,{},h),jt=Ye.paint.get("building-ambient-occlusion-intensity"),Lt=Ft/this.tileToMeter;ne.properties["building-part"]="roof";const Dt=Ye.paint.get("building-color").evaluate(ne,{},this.canonical).toPremultipliedRenderColor(this.lut),yt=Ye.paint.get("building-emissive-strength").evaluate(ne,{},this.canonical);ne.properties["building-part"]="wall";const gt=Ye.paint.get("building-color").evaluate(ne,{},this.canonical).toPremultipliedRenderColor(this.lut),zt=Ye.paint.get("building-emissive-strength").evaluate(ne,{},this.canonical);ne.properties["building-part"]="window";const Jt=Ye.paint.get("building-color").evaluate(ne,{},this.canonical).toPremultipliedRenderColor(this.lut),Gt=Ye.paint.get("building-emissive-strength").evaluate(ne,{},this.canonical);ne.properties["building-part"]="door";const Fn=Ye.paint.get("building-color").evaluate(ne,{},this.canonical).toPremultipliedRenderColor(this.lut),mn=Ye.paint.get("building-emissive-strength").evaluate(ne,{},this.canonical);let xn=Ye.layout.get("building-flood-light-wall-radius").evaluate(ne,{},h);xn=ee(xn,0,2048);const Pn=xn/2048*wS,Yr=w.get(ue),Wt=S.get(Yr)||[],On=Wt.length!==0&&Ye.layout.get("building-facade").evaluate(ne,{},h);_.setFacadeOptions(4,!0),_.setFauxFacadeOptions(On,!1,1);let Rr=0,fi=0,xi=0,Fr=0,os=0,Se=0,Ie=0,xt=0,Bt=0,cn=0,dn=0;if(On){let _r=Math.round(Ye.layout.get("building-facade-floors").evaluate(ne,{},h));if(kt===0){_r=Math.max(1,_r-(Wt.length>0?1:0));let Ji=4;if(It>100){const qs=[10,13,15];Ji=qs[ne.id?ne.id%qs.length:0]}else It<=10&&(Ji=3);_.setFacadeOptions(Ji,!0),os=(It<15?1.3:1.61803)*Ji/y}else os=kt/y;Se=It/y,os=Math.min(os,Se),xi=Ye.layout.get("building-facade-unit-width").evaluate(ne,{},h)/y,Fr=(Se-os)/_r,_.setFauxFacadeOptions(!0,!0,xi);const ia=Ye.layout.get("building-facade-window").evaluate(ne,{},h);Rr=ia[0],fi=ia[1],Ie=Math.floor(65535*Math.min(1,os/Qt)),xt=Math.floor(65535*Math.min(1,Se/Qt)),Bt=Math.floor(255*Rr)<<8|Math.floor(255*fi),cn=Math.floor(65535*Math.min(1,xi/Qt)),dn=Math.floor(65535*Math.min(1,Fr/Qt))}const Bn=Array($e.length),Wn={x:1/0,y:1/0},Dr={x:-1/0,y:-1/0},$r={x:0,y:0};let Wr=0;for(let _r=0;_r<$e.length;_r++){const ia=$e[_r];if(ia.length>0){const Ji=[],qs=Array(ia.length+1);qs[0]=0;for(let Ya=0;Ya<ia.length;Ya++){const go=ia[Ya];for(let Fa=0;Fa<go.length;Fa++){const Ba=go[go.length-Fa-1];Wn.x=Math.min(Wn.x,Ba.x),Wn.y=Math.min(Wn.y,Ba.y),Dr.x=Math.max(Dr.x,Ba.x),Dr.y=Math.max(Dr.y,Ba.y),$r.x+=Ba.x,$r.y+=Ba.y,Wr++,Ji.push(Ba.x),Ji.push(Ba.y)}qs[Ya+1]=Ji.length}Bn[_r]={id:ne.id?ne.id:0,height:It,minHeight:kt,sourceId:0,roofType:vt,coordinates:Ji,ringIndices:qs}}}$r.x/=Wr||1,$r.y/=Wr||1;const ci=_.generateMesh(Bn,Wt);if(typeof ci=="string"){un(`Unable to generate building ${ne.id}: ${ci}`),z(Ee);continue}if(ci.meshes.length===0||ci.modifiedPolygonRings.length===0){z(Ee);continue}const yr=On?this.buildingWithFacade:this.buildingWithoutFacade;let Ir=0;for(const _r of ci.meshes)Ir+=_r.positions.length/3;const Ci=yr.segmentsBucket.prepareSegment(Ir,yr.layoutVertexArray,yr.indexArray),Li=[];let Di=null,Qi=0,ys=-1;const ls=yr.layoutVertexArray.length,zi=ls+Ir;yr.layoutVertexArray.resize(zi),yr.layoutCentroidArray.resize(zi),yr.layoutNormalArray.resize(zi),yr.layoutAOArray.resize(zi),yr.layoutColorArray.resize(zi),yr.layoutFloodLightDataArray.resize(zi),On&&(yr.layoutFacadePaintArray.resize(zi),yr.layoutFacadeDataArray.resize(zi),yr.layoutFacadeVerticalRangeArray.resize(zi));const qi=yr.indexArray.length;let Hr=0,_i=ls;for(const _r of ci.meshes){let ia,Ji;if(_r.buildingPart===1)ia=Dt,Ji=yt;else if(_r.buildingPart===0)ia=gt,Ji=zt;else if(_r.buildingPart===2)ia=Jt,Ji=Gt;else{if(_r.buildingPart!==3)continue;ia=Fn,Ji=mn}if(Ji=ee(Ji,0,1),_r.buildingPart===3){const Cs=new Array;for(let Ka=0;Ka<_r.positions.length;Ka+=12){const Jc=_r.positions[Ka+0],Dh=_r.positions[Ka+1],Uo=_r.positions[Ka+3],xl=_r.positions[Ka+4],mu=_r.positions[Ka+2],sm=_r.positions[Ka+8]-mu,_1=1,Vd=Uo-Jc,$d=xl-Dh,pw=Math.hypot(Vd,$d);Cs.push({pos:[Jc+.5*Vd,Dh+.5*$d,mu],normal:[$d/pw,-Vd/pw,0],width:pw,height:sm,depth:_1,points:[Jc,Dh,Uo,xl]})}const Sa=yr.entranceBloom.segmentsBucket.prepareSegment(10*Cs.length,yr.entranceBloom.layoutVertexArray,yr.entranceBloom.indexArray),Ma=yr.entranceBloom.layoutVertexArray.length;Qi=yr.entranceBloom.indexArray.length,bz(Cs,.5/this.tileToMeter,yr.entranceBloom.indexArray,yr.entranceBloom.layoutVertexArray,yr.entranceBloom.layoutAttenuationArray);const Gl=yr.entranceBloom.layoutVertexArray.length-Ma;ys=yr.entranceBloom.indexArray.length-Qi;for(let Ka=0;Ka<Gl;Ka++)yr.entranceBloom.layoutColorArray.emplaceBack(255*Fn.r<<8|255*Fn.g,255*Fn.b<<8|51*mn);Sa.vertexLength+=Gl,Sa.primitiveLength+=ys,Di={part:_r.buildingPart,vertexOffset:Ma,vertexLength:Gl}}yr.layoutVertexArray.float32.set(_r.positions,3*_i);const qs=_r.positions.length/3;for(let Cs=0;Cs<qs;++Cs){const Sa=3*Cs;Hr=Math.max(Hr,_r.positions[Sa+2]);const Ma=_r.normals[Sa+1]*wS,Gl=_r.normals[Sa+2]*wS,Ka=3*(_i+Cs);yr.layoutNormalArray.int16[Ka]=_r.normals[Sa]*wS,yr.layoutNormalArray.int16[Ka+1]=Ma,yr.layoutNormalArray.int16[Ka+2]=Gl;const Jc=_r.ao[Cs];yr.layoutAOArray.uint8[_i+Cs]=255*Jc;const Dh=1+(Jc-1)*jt,Uo=255*ia.b*Dh<<8|255*Ji;yr.layoutColorArray.uint16[2*(_i+Cs)]=255*ia.r*Dh<<8|255*ia.g*Dh,yr.layoutColorArray.uint16[2*(_i+Cs)+1]=Uo}const Ya=Math.floor($r.x),go=Math.floor($r.y),Fa=Math.floor(It);for(let Cs=0;Cs<qs;++Cs){const Sa=3*(_i+Cs);yr.layoutCentroidArray.int16[Sa]=Ya,yr.layoutCentroidArray.int16[Sa+1]=go,yr.layoutCentroidArray.int16[Sa+2]=Fa}if(yr.layoutFloodLightDataArray.uint16.fill(_r.buildingPart===0?Pn:0,_i,_i+qs),On){const Cs=255*Jt.r<<8|255*Jt.g,Sa=255*Jt.b<<8|255*Gt;for(let Ma=0;Ma<qs;++Ma){const Gl=2*(_i+Ma);yr.layoutFacadePaintArray.uint16[Gl]=Cs,yr.layoutFacadePaintArray.uint16[Gl+1]=Sa}for(let Ma=0;Ma<qs;++Ma)if(_r.isFauxFacade[Ma]){const Gl=Math.min(65535,Math.floor(_r.uv[2*Ma]*ci.outerRingLength));yr.layoutFacadeDataArray.emplace(_i+Ma,1|Gl,Bt,cn,dn),yr.layoutFacadeVerticalRangeArray.emplace(_i+Ma,Ie,xt)}else yr.layoutFacadeDataArray.emplace(_i+Ma,0,0,0,0),yr.layoutFacadeVerticalRangeArray.emplace(_i+Ma,0,0)}const Ba=Ci.vertexLength,oo=_r.indices.length/3,Ml=yr.indexArray.length;yr.indexArray.resize(Ml+oo);for(let Cs=0;Cs<oo;++Cs){const Sa=3*Cs,Ma=3*Ml+Sa;yr.indexArray.uint16[Ma]=Ba+_r.indices[Sa],yr.indexArray.uint16[Ma+1]=Ba+_r.indices[Sa+1],yr.indexArray.uint16[Ma+2]=Ba+_r.indices[Sa+2]}_r.buildingPart!==1&&_r.buildingPart!==0&&_r.buildingPart!==2&&_r.buildingPart!==3||Li.push({part:_r.buildingPart,vertexOffset:_i,vertexLength:_r.positions.length/3}),_i+=qs,Ci.vertexLength+=qs,Ci.primitiveLength+=_r.indices.length/3}this.maxHeight=Math.max(this.maxHeight,Hr);const Qs=yr.indexArray.length-qi,gr=this.footprintsIndices.length,di=this.footprintsVertices.length,hs=[],Ss=new Ve(1/0,1/0),Ms=new Ve(-1/0,-1/0),Ra=this.groundEffect.vertexArray.length;for(const _r of ci.modifiedPolygonRings){const ia=[],Ji=new Ve(1/0,1/0),qs=new Ve(-1/0,-1/0);for(let Ya=0;Ya<_r.length;Ya+=2){const go=_r.length-Ya-2;Ji.x=Math.min(Ji.x,_r[go]),Ji.y=Math.min(Ji.y,_r[go+1]),qs.x=Math.max(qs.x,_r[go]),qs.y=Math.max(qs.y,_r[go+1]);const Fa=new Ve(_r[go],_r[go+1]);ia.push(Fa),hs.push(Fa.x,Fa.y),this.footprintsVertices.emplaceBack(Fa.x,Fa.y)}Ss.x=Math.min(Ss.x,Ji.x),Ss.y=Math.min(Ss.y,Ji.y),Ms.x=Math.max(Ms.x,qs.x),Ms.y=Math.max(Ms.y,qs.y),this.groundEffect.addData(ia,[Ji,qs],Lt)}const As=this.groundEffect.vertexArray.length-Ra;this.groundEffect.groundRadiusArray.reserveForAdditional(As);for(let _r=0;_r<As;_r++)this.groundEffect.groundRadiusArray.emplaceBack(Ft);(Wn.x<0||Dr.x>Qt||Wn.y<0||Dr.y>Qt)&&this.featuresOnBorder.push({featureId:ne.id,footprintIndex:this.footprints.length});{const _r=Qy(hs,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+_r.length),this.footprintsIndices.uint16.set(_r,gr),this.buildingIds.add(Ee??ne.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Ss.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Ss.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,Ms.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,Ms.y);const ia={footprintVertexOffset:di,footprintVertexLength:this.footprintsVertices.length-di,footprintIndexOffset:gr,footprintIndexLength:this.footprintsIndices.length-gr,min:Ss,max:Ms,hiddenFlags:0,indicesOffset:qi,indicesLength:Qs,bloomIndicesOffset:Qi,bloomIndicesLength:ys,groundEffectVertexOffset:Ra,groundEffectVertexLength:As,hasFauxFacade:On,height:Hr,promoteId:ue,feature:Me,parts:Li,buildingBloom:Di},Ji=this.footprints.length;ne.id!==void 0&&this.featureFootprintLookup.set(ne.id,Ji),V(Ee,Ji),this.footprints.push(ia)}this.programConfigurations.populatePaintArrays(yr.layoutVertexArray.length,ne,he,{},l.availableImages,h,l.brightness),this.groundEffect.addPaintPropertiesData(ne,he,{},l.availableImages,h,l.brightness),l.featureIndex.insert(ne,Be,he,ge,this.index,ls)}O.forEach(({buildingId:ne,footprintIndex:ue})=>{D.has(ne)&&(this.footprints[ue].hiddenFlags|=4)});const re=new Set;this.buildingIds.forEach((ne,ue,he)=>{D.has(ne)||re.add(ne)}),this.buildingIds=re,this.groundEffect.prepareBorderSegments()}update(i,l,h,p,_,y,w){this.programConfigurations.updatePaintArrays(i,l,_,h,p,y,w),this.groundEffect.update(i,l,_,h,p,y,w),this.evaluate(this.layers[0],i),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){const l=h=>{h.layoutVertexBuffer=i.createVertexBuffer(h.layoutVertexArray,wz.members),h.layoutNormalBuffer=i.createVertexBuffer(h.layoutNormalArray,oie.members),h.layoutCentroidBuffer=i.createVertexBuffer(h.layoutCentroidArray,lie.members),h.layoutFloodLightDataBuffer=i.createVertexBuffer(h.layoutFloodLightDataArray,fie.members),h.layoutFacadeDataArray&&h.layoutFacadeDataArray.length&&(h.layoutFacadeDataBuffer=i.createVertexBuffer(h.layoutFacadeDataArray,cie.members)),h.layoutFacadeVerticalRangeArray&&h.layoutFacadeVerticalRangeArray.length&&(h.layoutFacadeVerticalRangeBuffer=i.createVertexBuffer(h.layoutFacadeVerticalRangeArray,die.members)),h.entranceBloom.layoutVertexArray.length&&(h.entranceBloom.layoutVertexBuffer=i.createVertexBuffer(h.entranceBloom.layoutVertexArray,wz.members),h.entranceBloom.layoutAttenuationBuffer=i.createVertexBuffer(h.entranceBloom.layoutAttenuationArray,hie.members)),this.uploadUpdatedColorBuffer(i),this.uploadUpdatedIndexBuffer(i)};this.uploaded||(l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){const i=l=>{l.layoutVertexBuffer&&(l.layoutVertexBuffer.destroy(),l.layoutNormalBuffer.destroy(),l.layoutColorBuffer.destroy(),l.segmentsBucket.destroy(),l.indexBuffer&&l.indexBuffer.destroy(),l.entranceBloom.layoutVertexBuffer&&(l.entranceBloom.layoutVertexBuffer.destroy(),l.entranceBloom.layoutColorBuffer.destroy(),l.entranceBloom.layoutAttenuationBuffer.destroy(),l.entranceBloom.indexBuffer.destroy(),l.entranceBloom.segmentsBucket.destroy()))};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(i,l,h=!0){let p=!1;const _=h?l:0,y=0|(h?-1:~l);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const w of i){const S=this.footprints[w],R=S.hiddenFlags&y|_;S.hiddenFlags!==R&&(S.hiddenFlags=R,p=!0,this.groundEffect.updateHiddenByLandmarkRange(S.groundEffectVertexOffset,S.groundEffectVertexLength,S.hiddenFlags!==0))}return p&&(this.indexArrayForConflationUploaded=!1),p}uploadUpdatedIndexBuffer(i){if(this.groundEffect.uploadHiddenByLandmark(i),this.indexArrayForConflationUploaded)return;const l=p=>{p.indexArray.length!==0&&(p.indexArrayForConflation.resize(p.indexArray.length),p.indexArrayForConflation.uint16.set(p.indexArray.uint16),p.entranceBloom.indexArrayForConflation.resize(p.entranceBloom.indexArray.length),p.entranceBloom.indexArrayForConflation.uint16.set(p.entranceBloom.indexArray.uint16))};l(this.buildingWithoutFacade),l(this.buildingWithFacade);for(const p of this.footprints){const _=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,y=p.indicesOffset+p.indicesLength;if(p.hiddenFlags!==0){for(let S=p.indicesOffset;S<y;S++)_.indexArrayForConflation.uint16[3*S+0]=0,_.indexArrayForConflation.uint16[3*S+1]=0,_.indexArrayForConflation.uint16[3*S+2]=0;const w=p.bloomIndicesOffset+p.bloomIndicesLength;for(let S=p.bloomIndicesOffset;S<w;S++)_.entranceBloom.indexArrayForConflation.uint16[3*S+0]=0,_.entranceBloom.indexArrayForConflation.uint16[3*S+1]=0,_.entranceBloom.indexArrayForConflation.uint16[3*S+2]=0}}const h=p=>{p.indexArray.length!==0&&(p.indexBuffer?p.indexBuffer.updateData(p.indexArrayForConflation):p.indexBuffer=i.createIndexBuffer(p.indexArrayForConflation,!0),p.entranceBloom.indexBuffer?p.entranceBloom.indexBuffer.updateData(p.entranceBloom.indexArrayForConflation):p.entranceBloom.indexBuffer=i.createIndexBuffer(p.entranceBloom.indexArrayForConflation,!0))};h(this.buildingWithoutFacade),h(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(i){const l=h=>{h.layoutColorBuffer?h.layoutColorBuffer.updateData(h.layoutColorArray):h.layoutColorBuffer=i.createVertexBuffer(h.layoutColorArray,Tz.members,!0),h.layoutFacadePaintArray&&(h.layoutFacadePaintBuffer?h.layoutFacadePaintBuffer.updateData(h.layoutFacadePaintArray):h.layoutFacadePaintBuffer=i.createVertexBuffer(h.layoutFacadePaintArray,uie.members,!0)),h.entranceBloom.layoutColorBuffer?h.entranceBloom.layoutColorBuffer.updateData(h.entranceBloom.layoutColorArray):h.entranceBloom.layoutColorBuffer=i.createVertexBuffer(h.entranceBloom.layoutColorArray,Tz.members,!0)};l(this.buildingWithoutFacade),l(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(i,l){const h=i.paint.get("building-ambient-occlusion-intensity");for(const p of this.footprints){if(4&p.hiddenFlags)continue;const _=l[p.promoteId],y=p.feature;y.properties["building-part"]="roof";const w=i.paint.get("building-color").evaluate(y,_,this.canonical).toPremultipliedRenderColor(this.lut),S=i.paint.get("building-emissive-strength").evaluate(y,_,this.canonical);y.properties["building-part"]="wall";const R=i.paint.get("building-color").evaluate(y,_,this.canonical).toPremultipliedRenderColor(this.lut),O=i.paint.get("building-emissive-strength").evaluate(y,_,this.canonical);y.properties["building-part"]="window";const D=i.paint.get("building-color").evaluate(y,_,this.canonical).toPremultipliedRenderColor(this.lut),z=i.paint.get("building-emissive-strength").evaluate(y,_,this.canonical);y.properties["building-part"]="door";const V=i.paint.get("building-color").evaluate(y,_,this.canonical).toPremultipliedRenderColor(this.lut),H=i.paint.get("building-emissive-strength").evaluate(y,_,this.canonical),K=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const ne of p.parts){let ue,he=w;ne.part===1?(he=w,ue=S):ne.part===0?(he=R,ue=O):ne.part===2?(he=D,ue=z):ne.part===3&&(he=V,ue=H),ue=ee(ue,0,1);for(let ge=0;ge<ne.vertexLength;ge++){const ke=ne.vertexOffset+ge,Ee=1+(K.layoutAOArray.uint8[ke]/255-1)*h;K.layoutColorArray.emplace(ke,he.r*Ee*255<<8|he.g*Ee*255,he.b*Ee*255<<8|255*ue),p.hasFauxFacade&&K.layoutFacadePaintArray.emplace(ke,255*D.r<<8|255*D.g,255*D.b<<8|255*z)}}const re=p.buildingBloom;if(re)for(let ne=0;ne<re.vertexLength;ne++)K.entranceBloom.layoutColorArray.emplace(re.vertexOffset+ne,255*V.r<<8|255*V.g,255*V.b<<8|51*H)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(i,l,h){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const p=l.getReplacementRegionsForTile(i.toUnwrapped());if(uS(this.activeReplacements,p))return;this.activeReplacements=p;for(const y of this.footprints)y.hiddenFlags&=-2;const _=[];for(const y of this.activeReplacements){if(y.order<=AN)continue;const w=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-i.canonical.z));for(const S of this.footprints)S.min.x>y.max.x||S.max.x<y.min.x||S.min.y>y.max.y||S.max.y<y.min.y||(_.length=0,_ie(this.footprintsVertices,S.footprintVertexOffset,S.footprintVertexLength,y.footprintTileId.canonical,i.canonical,_),SI(y.footprint,_,this.footprintsIndices.uint16,S.footprintIndexOffset,S.footprintIndexLength,0,-w)&&(S.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const y of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(y.groundEffectVertexOffset,y.groundEffectVertexLength,y.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(i){if(i.id!==void 0){const l=this.featureFootprintLookup.get(i.id);return this.footprints[l]}return null}getHeightAtTileCoord(i,l){let h=Number.NEGATIVE_INFINITY,p=!0;const _=4*(i+Qt)*Qt+(l+Qt);if(this.footprintLookup.hasOwnProperty(_)){const w=this.footprintLookup[_];return w?{height:w.height,hidden:w.hiddenFlags!==0}:void 0}const y=new Ve(i,l);for(const w of this.footprints)i>w.max.x||w.min.x>i||l>w.max.y||w.min.y>l||w.height<=h||gie(y,this.footprintsVertices.float32.subarray(2*w.footprintVertexOffset,2*(w.footprintVertexOffset+w.footprintVertexLength)),this.footprintsIndices.uint16.subarray(w.footprintIndexOffset,w.footprintIndexOffset+w.footprintIndexLength))&&(h=w.height,this.footprintLookup[_]=w,p=w.hiddenFlags!==0);if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:p};this.footprintLookup[_]=void 0}}function gie(c,i,l){for(let h=0;h<l.length;h+=3){const p=l[h],_=l[h+1],y=l[h+2],w=i[2*p+0],S=i[2*p+1],R=i[2*_+0],O=i[2*_+1],D=i[2*y+0],z=i[2*y+1],V=(w-D)*(c.y-z)-(S-z)*(c.x-D),H=(R-w)*(c.y-S)-(O-S)*(c.x-w);if(V<0!=H<0&&V!==0&&H!==0)continue;const K=(D-R)*(c.y-O)-(z-O)*(c.x-R);if(K===0||K<0==V+H<=0)return!0}return!1}function _ie(c,i,l,h,p,_){const y=Math.pow(2,h.z-p.z);for(let w=0;w<l;w++){let S=c.float32[2*(w+i)+0],R=c.float32[2*(w+i)+1];S=(S+p.x*Qt)*y-h.x*Qt,R=(R+p.y*Qt)*y-h.y*Qt,_.push(new Ve(S,R))}}let Az,Cz;An(Sz,"BuildingBucket",{omit:["layers"]}),An(qI,"BuildingGeometry"),An(GI,"BuildingBloomGeometry");const yie=ui([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),vie=ui([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:xie}=yie,bie=ui([{name:"a_packed",components:3,type:"Float32"}]),{members:wie}=bie,Tie=ui([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Eie}=Tie;class kz{constructor(i,l){this.width=i,this.height=l,this.nextRow=0,this.image=new em({width:i,height:l}),this.positions={},this.uploaded=!1}getDash(i,l){const h=this.getKey(i,l);return this.positions[h]}trim(){const i=this.width,l=this.height=st(this.nextRow);this.image.resize({width:i,height:l})}getKey(i,l){return i.join(",")+l}getDashRanges(i,l,h){const p=[];let _=i.length%2==1?-i[i.length-1]*h:0,y=i[0]*h,w=!0;p.push({left:_,right:y,isDash:w,zeroLength:i[0]===0});let S=i[0];for(let R=1;R<i.length;R++){w=!w;const O=i[R];_=S*h,S+=O,y=S*h,p.push({left:_,right:y,isDash:w,zeroLength:O===0})}return p}addRoundDash(i,l,h){const p=l/2;for(let _=-h;_<=h;_++){const y=this.width*(this.nextRow+h+_);let w=0,S=i[w];for(let R=0;R<this.width;R++){R/S.right>1&&(S=i[++w]);const O=Math.abs(R-S.left),D=Math.abs(R-S.right),z=Math.min(O,D);let V;const H=_/h*(p+1);if(S.isDash){const K=p-Math.abs(H);V=Math.sqrt(z*z+K*K)}else V=p-Math.sqrt(z*z+H*H);this.image.data[y+R]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(i,l){for(let S=i.length-1;S>=0;--S){const R=i[S],O=i[S+1];R.zeroLength?i.splice(S,1):O&&O.isDash===R.isDash&&(O.left=R.left,i.splice(S,1))}const h=i[0],p=i[i.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const _=this.width*this.nextRow;let y=0,w=i[y];for(let S=0;S<this.width;S++){S/w.right>1&&(w=i[++y]);const R=Math.abs(S-w.left),O=Math.abs(S-w.right),D=Math.min(R,O);this.image.data[_+S]=Math.max(0,Math.min(255,(w.isDash?D:-D)+l+128))}}addDash(i,l){const h=this.getKey(i,l);if(this.positions[h])return this.positions[h];const p=l==="round",_=p?7:0,y=2*_+1;if(this.nextRow+y>this.height)return un("LineAtlas out of space"),null;i.length===0&&i.push(1);let w=0;for(let O=0;O<i.length;O++)i[O]<0&&(un("Negative value is found in line dasharray, replacing values with 0"),i[O]=0),w+=i[O];if(w!==0){const O=this.width/w,D=this.getDashRanges(i,this.width,O);p?this.addRoundDash(D,O,_):this.addRegularDash(D,l==="square"?.5*O:0)}const S=this.nextRow+_;this.nextRow+=y;const R={tl:[S,_],br:[w,0]};return this.positions[h]=R,R}}An(kz,"LineAtlas");const Sie=He.types,Aie=Math.cos(Math.PI/180*37.5),Cie=Math.cos(Math.PI/180*5);class WI{constructor(i){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=i.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=i.overscaling,this.pixelRatio=i.pixelRatio,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Oy,this.layoutVertexArray2=new cu,this.patternVertexArray=new cu,this.indexArray=new Wa,this.programConfigurations=new pc(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new ta,this.maxLineLength=0,this.zOffsetVertexArray=new cu,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.tessellationStep=i.tessellationStep?i.tessellationStep:Qt/64,this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,l){}updateAppearances(i,l,h,p){}populate(i,l,h,p){this.hasPattern=vI("line",this.layers,this.pixelRatio,l);const _=this.layers[0].layout.get("line-sort-key");this.tileToMeter=ae(h);const y=this.layers[0].layout.get("line-elevation-reference");if(y==="hd-road-markup")this.elevationType="road";else{const z=this.layers[0].layout.get("line-z-offset"),V=z.isConstant()&&!z.constantOr(0);this.elevationType=y!=="sea"&&y!=="ground"&&V?"none":"offset",this.elevationType==="offset"&&y==="none"&&un(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const w=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&w!==void 0;const S=[];for(const{feature:z,id:V,index:H,sourceLayerIndex:K}of i){const re=this.layers[0]._featureFilter.needGeometry,ne=Xe(z,re);if(!this.layers[0]._featureFilter.filter(new Rs(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),ne,h))continue;const ue=_?_.evaluate(ne,{},h):void 0,he={id:V,properties:z.properties,type:z.type,sourceLayerIndex:K,index:H,geometry:re?ne.geometry:Fe(z,h,p),patterns:{},sortKey:ue};S.push(he)}_&&S.sort((z,V)=>z.sortKey-V.sortKey);const{lineAtlas:R,featureIndex:O}=l,D=this.addConstantDashes(R);for(const z of S){const{geometry:V,index:H,sourceLayerIndex:K}=z;if(D&&this.addFeatureDashes(z,R),this.hasPattern){const re=xI("line",this.layers,z,this.zoom,this.pixelRatio,l);this.patternFeatures.push(re)}else this.addFeature(z,V,H,h,R.positions,l.availableImages,l.brightness,l.elevationFeatures);O.insert(i[H].feature,V,H,K,this.index)}}addConstantDashes(i){let l=!1;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if(p.kind!=="constant"||_.kind!=="constant")l=!0;else{const y=_.value,w=p.value;if(!w)continue;i.addDash(w,y)}}return l}addFeatureDashes(i,l){const h=this.zoom;for(const p of this.layers){const _=p.paint.get("line-dasharray").value,y=p.layout.get("line-cap").value;if(_.kind==="constant"&&y.kind==="constant")continue;let w,S;if(_.kind==="constant"){if(w=_.value,!w)continue}else w=_.evaluate({zoom:h},i);S=y.kind==="constant"?y.value:y.evaluate({zoom:h},i),l.addDash(w,S),i.patterns[p.id]=[l.getKey(w,S)]}}update(i,l,h,p,_,y,w,S){this.programConfigurations.updatePaintArrays(i,l,_,h,p,y,w,S)}addFeatures(i,l,h,p,_,y){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,l,h,p,y,i.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,wie)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=i.createVertexBuffer(this.patternVertexArray,Eie)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,vie.members,!0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,xie),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i,l){let h,p;if(l&&l>0?(h=`mapbox_clip_start_${l}`,p=`mapbox_clip_end_${l}`):(h="mapbox_clip_start",p="mapbox_clip_end"),i.properties&&i.properties.hasOwnProperty(h)&&i.properties.hasOwnProperty(p))return{start:+i.properties[h],end:+i.properties[p]}}addFeature(i,l,h,p,_,y,w,S){const R=this.layers[0].layout,O=R.get("line-join").evaluate(i,{}),D=R.get("line-cap").evaluate(i,{}),z=R.get("line-miter-limit"),V=R.get("line-round-limit");this.lineClips=this.lineFeatureClips(i),this.lineFeature=i;const H=!(!i.properties||!i.properties.hasOwnProperty("mapbox_line_metrics"))&&i.properties.mapbox_line_metrics;this.zOffsetValue=R.get("line-z-offset").value;const K=this.layers[0].paint.get("line-width").value;if(K.kind!=="constant"&&K.isLineProgressConstant===!1&&(this.variableWidthValue=K),this.elevationType==="road"){const re=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(i,l,p,S,O,D,z,V)){const[ne,ue]=this.clipRuntimeLinesToTile(l,1);for(let he=0;he<ne.length;he++){const ge=ne[he],ke=ue[he],Ee={progress:{min:ke.progress.min,max:ke.progress.max},nextDir:this.computeSegNextDir(ke,ge),prevDir:this.computeSegPrevDir(ke,ge)};this.addLine(ge,i,p,O,D,z,V,Ee,H&&ke.parentIndex>0?ke.parentIndex:null)}this.fillNonElevatedRoadSegment(re)}}else for(let re=0;re<l.length;re++)this.addLine(l[re],i,p,O,D,z,V,void 0,H&&re>0?re:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,_,y,p,w,void 0,this.worldview)}computeSegNextDir(i,l){return i.nextPoint.sub(l.at(-2)).unit()}computeSegPrevDir(i,l){return l[1].sub(i.prevPoint).unit()}clipLinesToTile(i,l){return hS(i,-l,-l,Qt+l,Qt+l)}clipRuntimeLinesToTile(i,l){const h=[];return[hS(i,-l,-l,Qt+l,Qt+l,h),h]}addElevatedRoadFeature(i,l,h,p,_,y,w,S){const R=[],O=Hi.getElevationFeature(i,p);if(O){const D=this.clipLinesToTile(l,1),z=this.prepareElevatedLines(D,O,h);for(const V of z)R.push({geometry:V,elevation:O,elevationTileID:h,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(R.length===0)return!1;for(const D of R){const z=this.layoutVertexArray.length;this.addLine(D.geometry,i,h,_,y,w,S);const V=new is(h,D.elevationTileID);if(D.elevation)for(let H=z;H<this.layoutVertexArray.length;H++){const K=new Ve(this.layoutVertexArray.int16[6*H]>>1,this.layoutVertexArray.int16[6*H+1]>>1),re=V.pointElevation(K,D.elevation,.05);this.updateHeightRange(re),this.zOffsetVertexArray.emplaceBack(re,0,0)}else this.fillNonElevatedRoadSegment(z)}return!0}prepareElevatedLines(i,l,h){if(l.constantHeight!=null)return i;const p=[],_=1/ae(h);for(const y of i)zre(y,new Oi(l,_),0,p);return p}fillNonElevatedRoadSegment(i){for(let l=i;l<this.layoutVertexArray.length;l++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(i){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,i),this.heightRange.max=Math.max(this.heightRange.max,i)):this.heightRange={min:i,max:i}}addLine(i,l,h,p,_,y,w,S,R){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=R?this.lineFeatureClips(l,R):this.lineClips;const O=p==="none";this.patternJoinNone=this.hasPattern&&O,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const D=S&&S.progress.min>0,z=S&&S.progress.max<1;if(this.lineClips){let $e={min:this.lineClips.start,max:this.lineClips.end},pt=1;if(S){const kt=this.lineClips.end-this.lineClips.start;$e=function(It,Ft,jt){return{min:Zi(It.min,Ft,jt),max:Zi(It.max,Ft,jt)}}(S.progress,{min:0,max:1},$e),kt>0&&(pt=($e.max-$e.min)/kt)}const Ye=+l.properties.mapbox_clip_feature_len,vt=+l.properties.mapbox_clip_seg_len;if(Number.isNaN(Ye)||Number.isNaN(vt)){for(let It=0;It<i.length-1;It++)this.totalDistance+=i[It].dist(i[It+1]);const kt=this.totalDistance/($e.max-$e.min);this.totalFeatureLength=Number.isFinite(kt)?kt:0,this.lineClips.start=$e.min,this.lineClips.end=$e.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ye,this.distance=vt*pt,this.lineClips.start=$e.min,this.lineClips.end=$e.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const V=Sie[l.type]==="Polygon";let H=i.length;for(;H>=2&&i[H-1].equals(i[H-2]);)H--;let K=0;for(;K<H-1&&i[K].equals(i[K+1]);)K++;if(H<(V?3:2))return;p==="bevel"&&(y=1.05);const re=this.segments.prepareSegment(10*H,this.layoutVertexArray,this.indexArray);let ne,ue,he,ge,ke,Ee,Me,Be;S&&S.prevDir&&(Ee=S.prevDir.perp()),S&&S.nextDir&&(Me=S.nextDir.perp()),this.e1=this.e2=-1,V&&(ne=i[H-2],ke=i[K].sub(ne)._unit()._perp());for(let $e=K;$e<H;$e++){if(he=$e===H-1?V?i[K+1]:void 0:i[$e+1],he&&i[$e].equals(he))continue;ke&&(ge=ke),ne&&(ue=ne),ne=i[$e],Be=this.evaluateLineProgressFeatures(ue?ue.dist(ne):0),ke=he?he.sub(ne)._unit()._perp():ge,ge=ge||ke;const pt=ue&&he;let Ye=pt?p:V||O?"butt":_;const vt=ge.x*ke.x+ge.y*ke.y;if(O){const gt=function(zt){if(zt.patternJoinNone){const Jt=zt.segmentPoints.length/2,Gt=zt.lineSoFar-zt.segmentStart;for(let Fn=0;Fn<Jt;++Fn){const mn=zt.segmentPoints[2*Fn+1],xn=Math.round(zt.segmentPoints[2*Fn])+.5+.25*mn;zt.patternVertexArray.emplaceBack(xn,Gt,zt.segmentStart),zt.patternVertexArray.emplaceBack(xn,Gt,zt.segmentStart)}zt.segmentPoints.length=0}zt.e1=zt.e2=-1};if(pt&&vt<Cie){this.updateDistance(ue,ne),this.addCurrentVertex(ne,ge,1,1,re,Be),gt(this),this.addCurrentVertex(ne,ke,-1,-1,re,Be);continue}if(ue){if(!he){this.updateDistance(ue,ne),this.addCurrentVertex(ne,ge,1,1,re,Be),gt(this);continue}Ye="miter"}}let kt=ge.add(ke);kt.x===0&&kt.y===0||kt._unit();const It=kt.x*ke.x+kt.y*ke.y,Ft=It!==0?1/It:1/0,jt=2*Math.sqrt(2-2*It),Lt=It<Aie&&ue&&he,Dt=ge.x*ke.y-ge.y*ke.x>0,yt=this.overscaling<=16?15*Qt/(512*this.overscaling):0;if(pt&&Ye==="round"){if(Ft<w)Ye="miter";else if(Ft<=2){const gt=ZI(ne,-10,Qt+10);Ye=this.elevationType==="offset"&&(gt||this.hasCrossSlope)?"miter":"fakeround"}}if(Ye==="miter"&&Ft>y&&(Ye="bevel"),Ye==="bevel"&&(Ft>2&&(Ye="flipbevel"),Ft<y&&(Ye="miter")),ue&&!(Ye==="miter"&&Lt)&&this.updateDistance(ue,ne),Ye==="miter")if(Lt){const gt=ne.dist(ue);if(gt>2*yt){const Jt=ne.sub(ne.sub(ue)._mult(yt/gt)._round());this.updateDistance(ue,Jt),this.addCurrentVertex(Jt,ge,0,0,re,Be),ue=Jt}this.updateDistance(ue,ne),kt._mult(Ft),this.addCurrentVertex(ne,kt,0,0,re,Be);const zt=ne.dist(he);if(zt>2*yt){const Jt=ne.add(he.sub(ne)._mult(yt/zt)._round());this.updateDistance(ne,Jt),this.addCurrentVertex(Jt,ke,0,0,re,Be),ne=Jt}}else kt._mult(Ft),this.addCurrentVertex(ne,kt,0,0,re,Be);else if(Ye==="flipbevel"){if(Ft>100)kt=ke.mult(-1);else{const gt=Ft*ge.add(ke).mag()/ge.sub(ke).mag();kt._perp()._mult(gt*(Dt?-1:1))}this.addCurrentVertex(ne,kt,0,0,re,Be),this.addCurrentVertex(ne,kt.mult(-1),0,0,re,Be)}else if(Ye==="bevel"||Ye==="fakeround"){Be!=null&&ue&&this.addCurrentVertex(ne,Me||ge,-1,-1,re,Be);const gt=ne.dist(ue)<=2*yt&&Ye!=="bevel",zt=kt.mult(Dt?1:-1);zt._mult(Ft);const Jt=ke.mult(Dt?-1:1),Gt=ge.mult(Dt?-1:1),Fn=this.evaluateLineProgressFeatures(this.distance);if(Be==null&&(this.addHalfVertex(ne,zt.x,zt.y,!1,!Dt,0,re,Fn),gt||this.addHalfVertex(ne,zt.x+2*Gt.x,zt.y+2*Gt.y,!1,Dt,0,re,Fn)),Ye==="fakeround"){const mn=Math.round(180*jt/Math.PI/20);this.addHalfVertex(ne,Gt.x,Gt.y,!1,Dt,0,re,Fn);for(let xn=0;xn<mn;xn++){let Pn=xn/mn;if(Pn!==.5){const Wt=Pn-.5;Pn+=Pn*Wt*(Pn-1)*((1.0904+vt*(vt*(3.55645-1.43519*vt)-3.2452))*Wt*Wt+(.848013+vt*(.215638*vt-1.06021)))}const Yr=Jt.sub(Gt)._mult(Pn)._add(Gt)._unit();this.addHalfVertex(ne,Yr.x,Yr.y,!1,Dt,0,re,Fn)}this.addHalfVertex(ne,Jt.x,Jt.y,!1,Dt,0,re,Fn)}gt||Be!=null||this.addHalfVertex(ne,zt.x+2*Jt.x,zt.y+2*Jt.y,!1,Dt,0,re,Fn),Be!=null&&he&&this.addCurrentVertex(ne,Ee||ke,1,1,re,Be)}else if(Ye==="butt")this.addCurrentVertex(ne,kt,0,0,re,Be);else if(Ye==="square"){if(!ue){const gt=D?0:-1;this.addCurrentVertex(ne,kt,gt,gt,re,Be)}if(this.addCurrentVertex(ne,kt,0,0,re,Be),ue){const gt=z?0:1;this.addCurrentVertex(ne,kt,gt,gt,re,Be)}}else if(Ye==="round"){if(ue){const gt=!pt&&Me?Me:ge;this.addCurrentVertex(ne,gt,0,0,re,Be),!pt&&z||this.addCurrentVertex(ne,gt,1,1,re,Be,!0)}if(he){const gt=!pt&&Ee?Ee:ke;!pt&&D||this.addCurrentVertex(ne,gt,-1,-1,re,Be,!0),this.addCurrentVertex(ne,gt,0,0,re,Be)}}}}addVerticesTo(i,l,h,p,_,y,w,S,R,O){const D=(l.w-i.w)/this.tessellationStep|0;let z=0;const V=this.scaledDistance;if(D>1){this.lineSoFar=i.w;const K=(l.x-i.x)/D,re=(l.y-i.y)/D,ne=(l.z-i.z)/D,ue=(l.w-i.w)/D;for(let he=1;he<D;++he){i.x+=K,i.y+=re,i.z+=ne,this.lineSoFar+=ue,z+=ue;const ge=this.evaluateLineProgressFeatures(this.prevDistance+z);this.scaledDistance=(this.prevDistance+z)/this.totalDistance,this.addHalfVertex(i,h,p,O,!1,w,R,ge),this.addHalfVertex(i,_,y,O,!0,-S,R,ge)}}this.lineSoFar=l.w,this.scaledDistance=V;const H=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(l,h,p,O,!1,w,R,H),this.addHalfVertex(l,_,y,O,!0,-S,R,H)}evaluateLineProgressFeatures(i){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+i)/this.totalFeatureLength):un(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let l=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(l=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:l}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:l}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:l}}addCurrentVertex(i,l,h,p,_,y,w=!1){const S=l.x+l.y*h,R=l.y-l.x*h,O=l.y*p-l.x,D=-l.y-l.x*p;if(y!=null){const z=this.elevationType==="offset",V=-10,H=Qt+10,K=y.zOffset,re=new YN(i.x,i.y,K,this.lineSoFar),ne=!!z&&ZI(i,V,H),ue=this.lineSoFar,he=this.distance;if(this.currentVertex)if(ne){const ge=this.currentVertexIsOutside,ke=this.currentVertex,Ee=new YN(i.x,i.y,K,this.lineSoFar);if(QN(ke,Ee,V,H),!ZI(Ee,V,H)){if(ge){this.e1=this.e2=-1,this.distance-=ke.dist(re),this.lineSoFar=ke.w;const Me=this.evaluateLineProgressFeatures(ke.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ke,S,R,w,!1,h,_,Me),this.addHalfVertex(ke,O,D,w,!0,-p,_,Me),this.prevDistance=this.distance}this.distance=this.prevDistance+ke.dist(Ee),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ke,Ee,S,R,O,D,h,p,_,w),this.distance=he,this.scaledDistance=this.distance/this.totalDistance}}else{const ge=this.currentVertex;if(this.currentVertexIsOutside){QN(ge,re,V,H),this.e1=this.e2=-1,this.distance-=ge.dist(re),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ge.w;const ke=this.evaluateLineProgressFeatures(ge.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ge,S,R,w,!1,h,_,ke),this.addHalfVertex(ge,O,D,w,!0,-p,_,ke),this.prevDistance=this.distance,this.distance=he,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ge,re,S,R,O,D,h,p,_,w)}else ne||(this.addHalfVertex(i,S,R,w,!1,h,_,y),this.addHalfVertex(i,O,D,w,!0,-p,_,y));this.currentVertex=re,this.currentVertexIsOutside=ne,this.lineSoFar=ue}else this.addHalfVertex(i,S,R,w,!1,h,_,y),this.addHalfVertex(i,O,D,w,!0,-p,_,y)}addHalfVertex({x:i,y:l},h,p,_,y,w,S,R){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),y||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((i<<1)+(_?1:0),(l<<1)+(y?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const D=br(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,D)}const O=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),S.primitiveLength++),y?this.e2=O:this.e1=O,R!=null&&this.zOffsetVertexArray.emplaceBack(R.zOffset,R.variableWidth,R.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(i,l){this.prevDistance=this.distance,this.distance+=i.dist(l),this.updateScaledDistance()}}function ZI(c,i,l){return c.x<i||c.x>l||c.y<i||c.y>l}let Iz,Rz;function Mz(c,i,l){return i*(Qt/(c.tileSize*Math.pow(2,l-c.tileID.overscaledZ)))}An(WI,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Pz=(c,i,l)=>(1-l)*c+l*i;function Oz(c,i){return 1/Mz(c,1,i.tileZoom)}function Lz(c,i,l,h){return c.translatePosMatrix(h||i.tileID.projMatrix,i,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const Dz=c=>{const i=[];Nz(c)&&i.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");const l=c.paint.get("line-trim-offset");l[0]===0&&l[1]===0||i.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&i.push("RENDER_LINE_BORDER");const h=c.layout.get("line-join").constantOr("miter")==="none",p=!!c.paint.get("line-pattern").constantOr(1);return h&&p&&i.push("LINE_JOIN_NONE"),i};function Nz(c){const i=c.paint.get("line-dasharray").value;return i.kind!=="constant"||i.value}let XI;const zz=()=>XI||(XI={layout:Iz||(Iz=new fa({"line-cap":new sn(Ke.layout_line["line-cap"]),"line-join":new sn(Ke.layout_line["line-join"]),"line-miter-limit":new Zt(Ke.layout_line["line-miter-limit"]),"line-round-limit":new Zt(Ke.layout_line["line-round-limit"]),"line-sort-key":new sn(Ke.layout_line["line-sort-key"]),"line-z-offset":new sn(Ke.layout_line["line-z-offset"]),"line-elevation-reference":new Zt(Ke.layout_line["line-elevation-reference"]),"line-cross-slope":new Zt(Ke.layout_line["line-cross-slope"]),visibility:new Zt(Ke.layout_line.visibility),"line-width-unit":new Zt(Ke.layout_line["line-width-unit"])})),paint:Rz||(Rz=new fa({"line-opacity":new sn(Ke.paint_line["line-opacity"]),"line-color":new sn(Ke.paint_line["line-color"]),"line-translate":new Zt(Ke.paint_line["line-translate"]),"line-translate-anchor":new Zt(Ke.paint_line["line-translate-anchor"]),"line-width":new sn(Ke.paint_line["line-width"]),"line-gap-width":new sn(Ke.paint_line["line-gap-width"]),"line-offset":new sn(Ke.paint_line["line-offset"]),"line-blur":new sn(Ke.paint_line["line-blur"]),"line-dasharray":new sn(Ke.paint_line["line-dasharray"]),"line-pattern":new sn(Ke.paint_line["line-pattern"]),"line-pattern-cross-fade":new Zt(Ke.paint_line["line-pattern-cross-fade"]),"line-gradient":new Pf(Ke.paint_line["line-gradient"]),"line-trim-offset":new Zt(Ke.paint_line["line-trim-offset"]),"line-trim-fade-range":new Zt(Ke.paint_line["line-trim-fade-range"]),"line-trim-color":new Zt(Ke.paint_line["line-trim-color"]),"line-emissive-strength":new sn(Ke.paint_line["line-emissive-strength"]),"line-border-width":new sn(Ke.paint_line["line-border-width"]),"line-border-color":new sn(Ke.paint_line["line-border-color"]),"line-occlusion-opacity":new Zt(Ke.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"})}))},XI);class kie extends sn{possiblyEvaluate(i,l){return l=new Rs(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,transition:l.transition,worldview:l.worldview}),super.possiblyEvaluate(i,l)}evaluate(i,l,h,p){return l=Object.assign({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(i,l,h,p)}}let Gb;function Fz(c,i){return i>0?i+2*c:c}const Iie=ui([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Rie=ui([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Mie=ui([{name:"a_projected_pos",components:4,type:"Float32"}],4);ui([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Pie=ui([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Oie=ui([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Lie=ui([{name:"a_texb",components:2,type:"Uint16"}]),Die=ui([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Nie=ui([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ui([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Bz=ui([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),zie=ui([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ui([{name:"triangle",components:3,type:"Uint16"}]),ui([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ui([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),ui([{type:"Float32",name:"offsetX"}]),ui([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var mo=24;function Fie(c,i,l){return c.sections.forEach(h=>{h.text=function(p,_,y){const w=_.layout.get("text-transform").evaluate(y,{});return w==="uppercase"?p=p.toLocaleUpperCase():w==="lowercase"&&(p=p.toLocaleLowerCase()),kd.applyArabicShaping&&(p=kd.applyArabicShaping(p)),p}(h.text,i,l)}),c}const qb={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Bie(c){return c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""}function jie(c){return c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""}const YI=4294967296,jz=1/YI,Uz=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let TS=class{constructor(c=new Uint8Array(16)){this.buf=ArrayBuffer.isView(c)?c:new Uint8Array(c),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(c,i,l=this.length){for(;this.pos<l;){const h=this.readVarint(),p=h>>3,_=this.pos;this.type=7&h,c(p,i,this),this.pos===_&&this.skip(h)}return i}readMessage(c,i){return this.readFields(c,i,this.readVarint()+this.pos)}readFixed32(){const c=this.dataView.getUint32(this.pos,!0);return this.pos+=4,c}readSFixed32(){const c=this.dataView.getInt32(this.pos,!0);return this.pos+=4,c}readFixed64(){const c=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*YI;return this.pos+=8,c}readSFixed64(){const c=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*YI;return this.pos+=8,c}readFloat(){const c=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,c}readDouble(){const c=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,c}readVarint(c){const i=this.buf;let l,h;return h=i[this.pos++],l=127&h,h<128?l:(h=i[this.pos++],l|=(127&h)<<7,h<128?l:(h=i[this.pos++],l|=(127&h)<<14,h<128?l:(h=i[this.pos++],l|=(127&h)<<21,h<128?l:(h=i[this.pos],l|=(15&h)<<28,function(p,_,y){const w=y.buf;let S,R;if(R=w[y.pos++],S=(112&R)>>4,R<128||(R=w[y.pos++],S|=(127&R)<<3,R<128)||(R=w[y.pos++],S|=(127&R)<<10,R<128)||(R=w[y.pos++],S|=(127&R)<<17,R<128)||(R=w[y.pos++],S|=(127&R)<<24,R<128)||(R=w[y.pos++],S|=(1&R)<<31,R<128))return s1(p,S,_);throw new Error("Expected varint not more than 10 bytes")}(l,c,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const c=this.readVarint();return c%2==1?(c+1)/-2:c/2}readBoolean(){return!!this.readVarint()}readString(){const c=this.readVarint()+this.pos,i=this.pos;return this.pos=c,c-i>=12&&Uz?Uz.decode(this.buf.subarray(i,c)):function(l,h,p){let _="",y=h;for(;y<p;){const w=l[y];let S,R,O,D=null,z=w>239?4:w>223?3:w>191?2:1;if(y+z>p)break;z===1?w<128&&(D=w):z===2?(S=l[y+1],(192&S)==128&&(D=(31&w)<<6|63&S,D<=127&&(D=null))):z===3?(S=l[y+1],R=l[y+2],(192&S)==128&&(192&R)==128&&(D=(15&w)<<12|(63&S)<<6|63&R,(D<=2047||D>=55296&&D<=57343)&&(D=null))):z===4&&(S=l[y+1],R=l[y+2],O=l[y+3],(192&S)==128&&(192&R)==128&&(192&O)==128&&(D=(15&w)<<18|(63&S)<<12|(63&R)<<6|63&O,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,z=1):D>65535&&(D-=65536,_+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),_+=String.fromCharCode(D),y+=z}return _}(this.buf,i,c)}readBytes(){const c=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,c);return this.pos=c,i}readPackedVarint(c=[],i){const l=this.readPackedEnd();for(;this.pos<l;)c.push(this.readVarint(i));return c}readPackedSVarint(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readSVarint());return c}readPackedBoolean(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readBoolean());return c}readPackedFloat(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readFloat());return c}readPackedDouble(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readDouble());return c}readPackedFixed32(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readFixed32());return c}readPackedSFixed32(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readSFixed32());return c}readPackedFixed64(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readFixed64());return c}readPackedSFixed64(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readSFixed64());return c}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(c){const i=7&c;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(c,i){this.writeVarint(c<<3|i)}realloc(c){let i=this.length||16;for(;i<this.pos+c;)i*=2;if(i!==this.length){const l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.dataView=new DataView(l.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(c){this.realloc(4),this.dataView.setInt32(this.pos,c,!0),this.pos+=4}writeSFixed32(c){this.realloc(4),this.dataView.setInt32(this.pos,c,!0),this.pos+=4}writeFixed64(c){this.realloc(8),this.dataView.setInt32(this.pos,-1&c,!0),this.dataView.setInt32(this.pos+4,Math.floor(c*jz),!0),this.pos+=8}writeSFixed64(c){this.realloc(8),this.dataView.setInt32(this.pos,-1&c,!0),this.dataView.setInt32(this.pos+4,Math.floor(c*jz),!0),this.pos+=8}writeVarint(c){(c=+c||0)>268435455||c<0?function(i,l){let h,p;if(i>=0?(h=i%4294967296|0,p=i/4294967296|0):(h=~(-i%4294967296),p=~(-i/4294967296),4294967295^h?h=h+1|0:(h=0,p=p+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(_,y,w){w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,w.buf[w.pos]=127&(_>>>=7)}(h,0,l),function(_,y){const w=(7&_)<<4;y.buf[y.pos++]|=w|((_>>>=3)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_)))))}(p,l)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))}writeSVarint(c){this.writeVarint(c<0?2*-c-1:2*c)}writeBoolean(c){this.writeVarint(+c)}writeString(c){c=String(c),this.realloc(4*c.length),this.pos++;const i=this.pos;this.pos=function(h,p,_){for(let y,w,S=0;S<p.length;S++){if(y=p.charCodeAt(S),y>55295&&y<57344){if(!w){y>56319||S+1===p.length?(h[_++]=239,h[_++]=191,h[_++]=189):w=y;continue}if(y<56320){h[_++]=239,h[_++]=191,h[_++]=189,w=y;continue}y=w-55296<<10|y-56320|65536,w=null}else w&&(h[_++]=239,h[_++]=191,h[_++]=189,w=null);y<128?h[_++]=y:(y<2048?h[_++]=y>>6|192:(y<65536?h[_++]=y>>12|224:(h[_++]=y>>18|240,h[_++]=y>>12&63|128),h[_++]=y>>6&63|128),h[_++]=63&y|128)}return _}(this.buf,c,this.pos);const l=this.pos-i;l>=128&&Vz(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l}writeFloat(c){this.realloc(4),this.dataView.setFloat32(this.pos,c,!0),this.pos+=4}writeDouble(c){this.realloc(8),this.dataView.setFloat64(this.pos,c,!0),this.pos+=8}writeBytes(c){const i=c.length;this.writeVarint(i),this.realloc(i);for(let l=0;l<i;l++)this.buf[this.pos++]=c[l]}writeRawMessage(c,i){this.pos++;const l=this.pos;c(i,this);const h=this.pos-l;h>=128&&Vz(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h}writeMessage(c,i,l){this.writeTag(c,2),this.writeRawMessage(i,l)}writePackedVarint(c,i){i.length&&this.writeMessage(c,Uie,i)}writePackedSVarint(c,i){i.length&&this.writeMessage(c,Vie,i)}writePackedBoolean(c,i){i.length&&this.writeMessage(c,Gie,i)}writePackedFloat(c,i){i.length&&this.writeMessage(c,$ie,i)}writePackedDouble(c,i){i.length&&this.writeMessage(c,Hie,i)}writePackedFixed32(c,i){i.length&&this.writeMessage(c,qie,i)}writePackedSFixed32(c,i){i.length&&this.writeMessage(c,Wie,i)}writePackedFixed64(c,i){i.length&&this.writeMessage(c,Zie,i)}writePackedSFixed64(c,i){i.length&&this.writeMessage(c,Xie,i)}writeBytesField(c,i){this.writeTag(c,2),this.writeBytes(i)}writeFixed32Field(c,i){this.writeTag(c,5),this.writeFixed32(i)}writeSFixed32Field(c,i){this.writeTag(c,5),this.writeSFixed32(i)}writeFixed64Field(c,i){this.writeTag(c,1),this.writeFixed64(i)}writeSFixed64Field(c,i){this.writeTag(c,1),this.writeSFixed64(i)}writeVarintField(c,i){this.writeTag(c,0),this.writeVarint(i)}writeSVarintField(c,i){this.writeTag(c,0),this.writeSVarint(i)}writeStringField(c,i){this.writeTag(c,2),this.writeString(i)}writeFloatField(c,i){this.writeTag(c,5),this.writeFloat(i)}writeDoubleField(c,i){this.writeTag(c,1),this.writeDouble(i)}writeBooleanField(c,i){this.writeVarintField(c,+i)}};function s1(c,i,l){return l?4294967296*i+(c>>>0):4294967296*(i>>>0)+(c>>>0)}function Vz(c,i,l){const h=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(h);for(let p=l.pos-1;p>=c;p--)l.buf[p+h]=l.buf[p]}function Uie(c,i){for(let l=0;l<c.length;l++)i.writeVarint(c[l])}function Vie(c,i){for(let l=0;l<c.length;l++)i.writeSVarint(c[l])}function $ie(c,i){for(let l=0;l<c.length;l++)i.writeFloat(c[l])}function Hie(c,i){for(let l=0;l<c.length;l++)i.writeDouble(c[l])}function Gie(c,i){for(let l=0;l<c.length;l++)i.writeBoolean(c[l])}function qie(c,i){for(let l=0;l<c.length;l++)i.writeFixed32(c[l])}function Wie(c,i){for(let l=0;l<c.length;l++)i.writeSFixed32(c[l])}function Zie(c,i){for(let l=0;l<c.length;l++)i.writeFixed64(c[l])}function Xie(c,i){for(let l=0;l<c.length;l++)i.writeSFixed64(c[l])}const KI=3;function Yie(c,i,l){i.glyphs=[],c===1&&l.readMessage(Kie,i)}function Kie(c,i,l){if(c===3){const{id:h,bitmap:p,width:_,height:y,left:w,top:S,advance:R}=l.readMessage(Qie,{});i.glyphs.push({id:h,bitmap:new em({width:_+2*KI,height:y+2*KI},p),metrics:{width:_,height:y,left:w,top:S,advance:R}})}else c===4?i.ascender=l.readSVarint():c===5&&(i.descender=l.readSVarint())}function Qie(c,i,l){c===1?i.id=l.readVarint():c===2?i.bitmap=l.readBytes():c===3?i.width=l.readVarint():c===4?i.height=l.readVarint():c===5?i.left=l.readSVarint():c===6?i.top=l.readSVarint():c===7&&(i.advance=l.readVarint())}const $z=KI,pu={horizontal:1,vertical:2,horizontalOnly:3};class Wb{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(i,l){const h=new Wb;return h.scale=i||1,h.fontStack=l,h}static forImage(i){const l=new Wb;return l.image=i,l}}class a1{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l,h){const p=new a1;for(let _=0;_<i.sections.length;_++){const y=i.sections[_];y.image?p.addImageSection(y,h):p.addTextSection(y,l)}return p}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCodePoint(i){return this.text.codePointAt(i)}verticalizePunctuation(i){this.text=function(l,h){let p="";for(let _=0;_<l.length;_++){const y=l.charCodeAt(_+1)||null,w=l.charCodeAt(_-1)||null;p+=!h&&(y&&wy(y)&&!qb[l[_+1]]||w&&wy(w)&&!qb[l[_-1]])||!qb[l[_]]?l[_]:qb[l[_]]}return p}(this.text,i)}trim(){let i=0;for(let h=0;h<this.text.length&&ES[this.text.charCodeAt(h)];h++)i++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=i&&ES[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const h=new a1;return h.text=this.text.substring(i,l),h.sectionIndex=this.sectionIndex.slice(i,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(Wb.forText(i.scale,i.fontStack||l));const h=this.sections.length-1;for(let p=0;p<i.text.length;++p)this.sectionIndex.push(h)}addImageSection(i,l){const h=i.image?i.image.getPrimary():null;if(!h)return void un("Can't add FormattedSection with an empty image.");h.scaleSelf(l);const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCodePoint(p),this.sections.push(Wb.forImage(h)),this.sectionIndex.push(this.sections.length-1)):un("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function QI(c,i,l,h,p,_,y,w,S,R,O,D,z,V,H,K=1){const re=a1.fromFeature(c,p,K);D===pu.vertical&&re.verticalizePunctuation(z);let ne=[];const ue=function(Me,Be,$e,pt,Ye,vt){if(!Me)return[];const kt=[],It=function(Dt,yt,gt,zt,Jt,Gt){let Fn=0;for(let mn=0;mn<Dt.length();mn++){const xn=Dt.getSection(mn);Fn+=Hz(Dt.getCodePoint(mn),xn,zt,Jt,yt,Gt)}return Fn/Math.max(1,Math.ceil(Fn/gt))}(Me,Be,$e,pt,Ye,vt),Ft=Me.text.indexOf("")>=0;let jt=0;for(let Dt=0;Dt<Me.length();Dt++){const yt=Me.getSection(Dt),gt=Me.getCodePoint(Dt);if(ES[gt]||(jt+=Hz(gt,yt,pt,Ye,Be,vt)),Dt<Me.length()-1){const zt=!((Lt=gt)<11904||!(pr["Bopomofo Extended"](Lt)||pr.Bopomofo(Lt)||pr["CJK Compatibility Forms"](Lt)||pr["CJK Compatibility Ideographs"](Lt)||pr["CJK Compatibility"](Lt)||pr["CJK Radicals Supplement"](Lt)||pr["CJK Strokes"](Lt)||pr["CJK Symbols and Punctuation"](Lt)||pr["CJK Unified Ideographs Extension A"](Lt)||pr["CJK Unified Ideographs"](Lt)||pr["Enclosed CJK Letters and Months"](Lt)||pr["Halfwidth and Fullwidth Forms"](Lt)||pr.Hiragana(Lt)||pr["Ideographic Description Characters"](Lt)||pr["Kangxi Radicals"](Lt)||pr["Katakana Phonetic Extensions"](Lt)||pr.Katakana(Lt)||pr["Vertical Forms"](Lt)||pr["Yi Radicals"](Lt)||pr["Yi Syllables"](Lt)));(Jie[gt]||zt||yt.image)&&kt.push(qz(Dt+1,jt,It,kt,ese(gt,Me.getCodePoint(Dt+1),zt&&Ft),!1))}}var Lt;return Wz(qz(Me.length(),jt,It,kt,0,!0))}(re,R,_,i,h,V),{processBidirectionalText:he,processStyledBidirectionalText:ge}=kd;if(he&&re.sections.length===1){const Me=he(re.toString(),ue);for(const Be of Me){const $e=new a1;$e.text=Be,$e.sections=re.sections;for(let pt=0;pt<Be.length;pt++)$e.sectionIndex.push(0);ne.push($e)}}else if(ge){const Me=ge(re.text,re.sectionIndex,ue);for(const Be of Me){const $e=new a1;$e.text=Be[0],$e.sectionIndex=Be[1],$e.sections=re.sections,ne.push($e)}}else ne=function(Me,Be){const $e=[],pt=Me.text;let Ye=0;for(const vt of Be)$e.push(Me.substring(Ye,vt)),Ye=vt;return Ye<pt.length&&$e.push(Me.substring(Ye,pt.length)),$e}(re,ue);const ke=[],Ee={positionedLines:ke,text:re.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Me,Be,$e,pt,Ye,vt,kt,It,Ft,jt,Lt,Dt){let yt=0,gt=0,zt=0;const Jt=It==="right"?1:It==="left"?0:.5;let Gt=!1;for(const Wt of Ye){const On=Wt.getSections();for(const Rr of On){if(Rr.image)continue;const fi=Be[Rr.fontStack];if(fi&&(Gt=fi.ascender!==void 0&&fi.descender!==void 0,!Gt))break}if(!Gt)break}let Fn=0;for(const Wt of Ye){Wt.trim();const On=Wt.getMaxScale(),Rr=(On-1)*mo,fi={positionedGlyphs:[],lineOffset:0};Me.positionedLines[Fn]=fi;const xi=fi.positionedGlyphs;let Fr=0;if(!Wt.length()){gt+=vt,++Fn;continue}let os=0,Se=0;for(let xt=0;xt<Wt.length();xt++){const Bt=Wt.getSection(xt),cn=Wt.getSectionIndex(xt),dn=Wt.getCodePoint(xt);let Bn=Bt.scale,Wn=null,Dr=null,$r=null,Wr=mo,ci=0,yr=Ft;yr===pu.vertical&&((mn=dn)===12312||mn===12313||mn===12316||mn===12540||mn===12448)&&(yr=pu.horizontal);const Ir=!(yr===pu.horizontal||!Lt&&!by(dn)||Lt&&(ES[dn]||Ty(dn)));if(Bt.image){const Ci=pt.get(Bt.image.toString());if(!Ci)continue;$r=Bt.image,Me.iconsInText=Me.iconsInText||!0,Dr=Ci.paddedRect;const Li=Ci.displaySize;Bn=Bn*mo/Dt,Wn={width:Li[0],height:Li[1],left:0,top:-$z,advance:Ir?Li[1]:Li[0],localGlyph:!1},ci=Gt?-Wn.height*Bn:On*mo-17-Li[1]*Bn,Wr=Wn.advance;const Di=(Ir?Li[0]:Li[1])*Bn-mo*On;Di>0&&Di>Fr&&(Fr=Di)}else{const Ci=$e[Bt.fontStack];if(!Ci)continue;Ci[dn]&&(Dr=Ci[dn]);const Li=Be[Bt.fontStack];if(!Li)continue;const Di=Li.glyphs[dn];if(!Di)continue;if(Wn=Di.metrics,Wr=dn!==8203?mo:0,Gt){const Qi=Li.ascender!==void 0?Math.abs(Li.ascender):0,ys=Li.descender!==void 0?Math.abs(Li.descender):0,ls=(Qi+ys)*Bn;os<ls&&(os=ls,Se=(Qi-ys)/2*Bn),ci=-Qi*Bn}else ci=(On-Bn)*mo-17}Ir?(Me.verticalizable=!0,xi.push({glyph:dn,image:$r,x:yt,y:gt+ci,vertical:Ir,scale:Bn,localGlyph:Wn.localGlyph,fontStack:Bt.fontStack,sectionIndex:cn,metrics:Wn,rect:Dr}),yt+=Wr*Bn+jt):(xi.push({glyph:dn,image:$r,x:yt,y:gt+ci,vertical:Ir,scale:Bn,localGlyph:Wn.localGlyph,fontStack:Bt.fontStack,sectionIndex:cn,metrics:Wn,rect:Dr}),yt+=Wn.advance*Bn+jt)}xi.length!==0&&(zt=Math.max(yt-jt,zt),Gt?Zz(xi,Jt,Fr,Se,vt*On/2):Zz(xi,Jt,Fr,0,vt/2)),yt=0;const Ie=vt*On+Fr;fi.lineOffset=Math.max(Fr,Rr),gt+=Ie,++Fn}var mn;const xn=gt,{horizontalAlign:Pn,verticalAlign:Yr}=JI(kt);(function(Wt,On,Rr,fi,xi,Fr){const os=(On-Rr)*xi,Se=-Fr*fi;for(const Ie of Wt)for(const xt of Ie.positionedGlyphs)xt.x+=os,xt.y+=Se})(Me.positionedLines,Jt,Pn,Yr,zt,xn),Me.top+=-Yr*xn,Me.bottom=Me.top+xn,Me.left+=-Pn*zt,Me.right=Me.left+zt,Me.hasBaseline=Gt}(Ee,i,l,h,ne,y,w,S,D,R,z,H),!function(Me){for(const Be of Me)if(Be.positionedGlyphs.length!==0)return!1;return!0}(ke))return Ee}const ES={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Jie={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Hz(c,i,l,h,p,_){if(i.image){const y=h.get(i.image.toString());return y?y.displaySize[0]*i.scale*mo/_+p:0}{const y=l[i.fontStack],w=y&&y.glyphs[c];return w?w.metrics.advance*i.scale+p:0}}function Gz(c,i,l,h){const p=Math.pow(c-i,2);return h?c<i?p/2:2*p:p+Math.abs(l)*l}function ese(c,i,l){let h=0;return c===10&&(h-=1e4),l&&(h+=150),c!==40&&c!==65288||(h+=50),i!==41&&i!==65289||(h+=50),h}function qz(c,i,l,h,p,_){let y=null,w=Gz(i,l,p,_);for(const S of h){const R=Gz(i-S.x,l,p,_)+S.badness;R<=w&&(y=S,w=R)}return{index:c,x:i,priorBreak:y,badness:w}}function Wz(c){return c?Wz(c.priorBreak).concat(c.index):[]}function JI(c){let i=.5,l=.5;switch(c){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function Zz(c,i,l,h,p){if(!(i||l||h||p))return;const _=c.length-1,y=c[_],w=(y.x+y.metrics.advance*y.scale)*i;for(let S=0;S<=_;S++)c[S].x-=w,c[S].y+=l+h+p}function e6(c){return c.imagePrimary!==void 0&&c.top!==void 0&&c.bottom!==void 0&&c.left!==void 0&&c.right!==void 0}function SS(c,i,l,h){const{horizontalAlign:p,verticalAlign:_}=JI(h),y=l[0]-c.displaySize[0]*p,w=l[1]-c.displaySize[1]*_;return{imagePrimary:c,imageSecondary:i,top:w,bottom:w+c.displaySize[1],left:y,right:y+c.displaySize[0]}}function t6(c,i,l,h,p,_){const y=c.imagePrimary;let w;if(y.content){const re=y.content,ne=y.pixelRatio||1;w=[re[0]/ne,re[1]/ne,y.displaySize[0]-re[2]/ne,y.displaySize[1]-re[3]/ne]}const S=i.left*_,R=i.right*_;let O,D,z,V;l==="width"||l==="both"?(V=p[0]+S-h[3],D=p[0]+R+h[1]):(V=p[0]+(S+R-y.displaySize[0])/2,D=V+y.displaySize[0]);const H=i.top*_,K=i.bottom*_;return l==="height"||l==="both"?(O=p[1]+H-h[0],z=p[1]+K+h[2]):(O=p[1]+(H+K-y.displaySize[1])/2,z=O+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:O,right:D,bottom:z,left:V,collisionPadding:w}}function Xz(c){return!c.imagePrimary.stretchX}function Yz(c){return!c.imagePrimary.stretchY}function Kz(c){return{width:c.right-c.left,height:c.bottom-c.top}}const Fd=128;function o1(c,i,l){const{expression:h}=i;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Rs(c+1,{worldview:l}))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:_}=h;let y=0;for(;y<p.length&&p[y]<=c;)y++;y=Math.max(0,y-1);let w=y;for(;w<p.length&&p[w]<c+1;)w++;w=Math.min(p.length-1,w);const S=p[y],R=p[w];return h.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:R,interpolationType:_}:{kind:"camera",minZoom:S,maxZoom:R,minSize:h.evaluate(new Rs(S,{worldview:l})),maxSize:h.evaluate(new Rs(R,{worldview:l})),interpolationType:_}}}function n6(c,{uSize:i,uSizeT:l},{lowerSize:h,upperSize:p}){return c.kind==="source"?h/Fd:c.kind==="composite"?br(h/Fd,p/Fd,l):i}function l1(c,i,l=1){let h=0,p=0;if(c.kind==="constant")p=c.layoutSize*l;else if(c.kind!=="source"){const{interpolationType:_,minZoom:y,maxZoom:w}=c,S=_?ee(uu.interpolationFactor(_,i,y,w),0,1):0;c.kind==="camera"?p=br(c.minSize,c.maxSize,S)*l:h=S*l}return{uSizeT:h,uSize:p}}class jf extends Ve{constructor(i,l,h,p,_){super(i,l),this.angle=p,this.z=h,_!==void 0&&(this.segment=_)}clone(){return new jf(this.x,this.y,this.z,this.angle,this.segment)}}function Qz(c,i,l,h,p){if(i.segment===void 0)return!0;let _=i,y=i.segment+1,w=0;for(;w>-l/2;){if(y--,y<0)return!1;w-=c[y].dist(_),_=c[y]}w+=c[y].dist(c[y+1]),y++;const S=[];let R=0;for(;w<l/2;){const O=c[y],D=c[y+1];if(!D)return!1;let z=c[y-1].angleTo(O)-O.angleTo(D);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:w,angleDelta:z}),R+=z;w-S[0].distance>h;)R-=S.shift().angleDelta;if(R>p)return!1;y++,w+=O.dist(D)}return!0}function Jz(c){let i=0;for(let l=0;l<c.length-1;l++)i+=c[l].dist(c[l+1]);return i}function e7(c,i,l){return c?.6*i*l:0}function t7(c,i){return Math.max(c?c.right-c.left:0,i?i.right-i.left:0)}function tse(c,i,l,h,p,_){const y=e7(l,p,_),w=t7(l,h)*_;let S=0;const R=Jz(c)/2;for(let O=0;O<c.length-1;O++){const D=c[O],z=c[O+1],V=D.dist(z);if(S+V>R){const H=(R-S)/V,K=br(D.x,z.x,H),re=br(D.y,z.y,H),ne=new jf(K,re,0,z.angleTo(D),O);return!y||Qz(c,ne,w,y,i)?ne:void 0}S+=V}}function nse(c,i,l,h,p,_,y,w,S){const R=e7(h,_,y),O=t7(h,p),D=O*y,z=c[0].x===0||c[0].x===S||c[0].y===0||c[0].y===S;return i-D<i/4&&(i=D+i/4),n7(c,z?i/2*w%i:(O/2+2*_)*y*w%i,i,R,l,D,z,!1,S)}function n7(c,i,l,h,p,_,y,w,S){const R=_/2,O=Jz(c);let D=0,z=i-l,V=[];for(let H=0;H<c.length-1;H++){const K=c[H],re=c[H+1],ne=K.dist(re),ue=re.angleTo(K);for(;z+l<D+ne;){z+=l;const he=(z-D)/ne,ge=br(K.x,re.x,he),ke=br(K.y,re.y,he);if(ge>=0&&ge<S&&ke>=0&&ke<S&&z-R>=0&&z+R<=O){const Ee=new jf(ge,ke,0,ue,H);h&&!Qz(c,Ee,_,h,p)||V.push(Ee)}}D+=ne}return w||V.length||y||(V=n7(c,D/2,l,h,p,_,y,!0,S)),V}function r7(c){let i=0,l=0;for(const y of c)i+=y.w*y.h,l=Math.max(l,y.w);c.sort((y,w)=>w.h-y.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let p=0,_=0;for(const y of c)for(let w=h.length-1;w>=0;w--){const S=h[w];if(!(y.w>S.w||y.h>S.h)){if(y.x=S.x,y.y=S.y,_=Math.max(_,y.y+y.h),p=Math.max(p,y.x+y.w),y.w===S.w&&y.h===S.h){const R=h.pop();R&&w<h.length&&(h[w]=R)}else y.h===S.h?(S.x+=y.w,S.w-=y.w):y.w===S.w?(S.y+=y.h,S.h-=y.h):(h.push({x:S.x+y.w,y:S.y,w:S.w-y.w,h:y.h}),S.y+=y.h,S.h-=y.h);break}}return{w:p,h:_,fill:i/(p*_)||0}}An(jf,"Anchor");const gg=1;class Zb{static getImagePositionScale(i,l,h){if(l&&i){const{sx:p,sy:_}=i;return{x:p,y:_}}return{x:h,y:h}}constructor(i,l,h,p){this.paddedRect=i;const{pixelRatio:_,version:y,stretchX:w,stretchY:S,content:R,sdf:O,usvg:D}=l;this.pixelRatio=_,this.stretchX=w,this.stretchY=S,this.content=R,this.version=y,this.padding=h,this.sdf=O,this.usvg=D,this.scale=Zb.getImagePositionScale(p,D,_)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function r6(c,i,l){const h=bd.parse(c),p=function(_,y,w=[1,1]){return{x:0,y:0,w:(_.data?_.data.width:_.width*w[0])+2*y,h:(_.data?_.data.height:_.height*w[1])+2*y}}(i,l,[h.sx,h.sy]);return{bin:p,imagePosition:new Zb(p,i,l,h),imageVariant:h}}class i7{constructor(i,l,h){const p=new Map,_=new Map;this.haveRenderCallbacks=[];const y=[];this.addImages(i,p,gg,y),this.addImages(l,_,2,y);const{w,h:S}=r7(y),R=new Jo({width:w||1,height:S||1});for(const[O,D]of i.entries()){const z=p.get(O).paddedRect;Jo.copy(D.data,R,{x:0,y:0},{x:z.x+gg,y:z.y+gg},D.data,null,D.sdf)}for(const[O,D]of l.entries()){const z=_.get(O),V=z.paddedRect;let H=z.padding;const K=V.x+H,re=V.y+H,ne=D.data.width,ue=D.data.height;H=H>1?H-1:H,Jo.copy(D.data,R,{x:0,y:0},{x:K,y:re},D.data,h),Jo.copy(D.data,R,{x:0,y:ue-H},{x:K,y:re-H},{width:ne,height:H},h),Jo.copy(D.data,R,{x:0,y:0},{x:K,y:re+ue},{width:ne,height:H},h),Jo.copy(D.data,R,{x:ne-H,y:0},{x:K-H,y:re},{width:H,height:ue},h),Jo.copy(D.data,R,{x:0,y:0},{x:K+ne,y:re},{width:H,height:ue},h),Jo.copy(D.data,R,{x:ne-H,y:ue-H},{x:K-H,y:re-H},{width:H,height:H},h),Jo.copy(D.data,R,{x:0,y:ue-H},{x:K+ne,y:re-H},{width:H,height:H},h),Jo.copy(D.data,R,{x:0,y:0},{x:K+ne,y:re+ue},{width:H,height:H},h),Jo.copy(D.data,R,{x:ne-H,y:0},{x:K-H,y:re+ue},{width:H,height:H},h)}this.lut=h,this.image=R,this.iconPositions=p,this.patternPositions=_}addImages(i,l,h,p){for(const[_,y]of i.entries()){const{bin:w,imagePosition:S,imageVariant:R}=r6(_,y,h);l.set(_,S),p.push(w),y.hasRenderCallback&&this.haveRenderCallbacks.push(R.id)}}patchUpdatedImages(i,l,h){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>i.hasImage(p,h)),i.dispatchRenderCallbacks(this.haveRenderCallbacks,h);for(const p of i.getUpdatedImages(h)){for(const _ of this.iconPositions.keys()){const y=bd.parse(_);if(ll.isEqual(y.id,p)){const w=i.getImage(p,h);this.patchUpdatedImage(this.iconPositions.get(_),w,l,null)}}for(const _ of this.patternPositions.keys()){const y=bd.parse(_);if(ll.isEqual(y.id,p)){const w=i.getImage(p,h);this.patchUpdatedImage(this.patternPositions.get(_),w,l,this.lut)}}}}patchUpdatedImage(i,l,h,p=null){if(!i||!l||i.version===l.version)return;i.version=l.version;const[_,y]=i.tl,w=i.sdf;if(this.lut||w){const S={width:l.data.width,height:l.data.height},R=new Jo(S);Jo.copy(l.data,R,{x:0,y:0},{x:0,y:0},S,p,w),h.update(R,{position:{x:_,y}})}else h.update(l.data,{position:{x:_,y}})}}An(Zb,"ImagePosition"),An(i7,"ImageAtlas");const Xb=1e20;function s7(c,i,l,h,p,_,y,w,S){for(let R=i;R<i+h;R++)a7(c,l*_+R,_,p,y,w,S);for(let R=l;R<l+p;R++)a7(c,R*_+i,1,h,y,w,S)}function a7(c,i,l,h,p,_,y){_[0]=0,y[0]=-Xb,y[1]=Xb,p[0]=c[i];for(let w=1,S=0,R=0;w<h;w++){p[w]=c[i+w*l];const O=w*w;do{const D=_[S];R=(p[w]-p[D]+O-D*D)/(w-D)/2}while(R<=y[S]&&--S>-1);S++,_[S]=w,y[S]=R,y[S+1]=Xb}for(let w=0,S=0;w<h;w++){for(;y[S+1]<w;)S++;const R=_[S],O=w-R;c[i+w*l]=p[R]+O*O}}const Bd=2,i6={none:0,ideographs:1,all:2};class u1{constructor(i,l,h){this.requestManager=i,this.localGlyphMode=l,this.localFontFamily=h,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,l){const h=[],p=this.url||ri.GLYPHS_URL;for(const _ in i)for(const y of i[_])h.push({stack:_,id:y});De(h,({stack:_,id:y},w)=>{let S=this.entries[_];S||(S=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let R=S.glyphs[y];if(R!==void 0)return void w(null,{stack:_,id:y,glyph:R});if(R=this._tinySDF(S,_,y),R)return S.glyphs[y]=R,void w(null,{stack:_,id:y,glyph:R});const O=Math.floor(y/256);if(256*O>65535)return un("glyphs > 65535 not supported"),void w(null,{stack:_,id:y,glyph:R});if(S.ranges[O])return void w(null,{stack:_,id:y,glyph:R});let D=S.requests[O];D||(D=S.requests[O]=[],u1.loadGlyphRange(_,O,p,this.requestManager,(z,V)=>{if(V){S.ascender=V.ascender,S.descender=V.descender;for(const H in V.glyphs)this._doesCharSupportLocalGlyph(+H)||(S.glyphs[+H]=V.glyphs[+H]);S.ranges[O]=!0}for(const H of D)H(z,V);delete S.requests[O]})),D.push((z,V)=>{z?w(z):V&&w(null,{stack:_,id:y,glyph:V.glyphs[y]||null})})},(_,y)=>{if(_)l(_);else if(y){const w={};for(const{stack:S,id:R,glyph:O}of y)w[S]===void 0&&(w[S]={}),w[S].glyphs===void 0&&(w[S].glyphs={}),w[S].glyphs[R]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics},w[S].ascender=this.entries[S].ascender,w[S].descender=this.entries[S].descender;l(null,w)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==i6.none&&(this.localGlyphMode===i6.all?!!this.localFontFamily:!!this.localFontFamily&&(pr["CJK Unified Ideographs"](i)||pr["Hangul Syllables"](i)||pr.Hiragana(i)||pr.Katakana(i)||pr["CJK Symbols and Punctuation"](i)||pr["CJK Unified Ideographs Extension A"](i)||pr["CJK Unified Ideographs Extension B"](i)||pr.Osage(i)))}_tinySDF(i,l,h){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(h))return;let _=i.tinySDF;if(!_){let K="400";/bold/i.test(l)?K="900":/medium/i.test(l)?K="500":/light/i.test(l)&&(K="200"),_=i.tinySDF=new u1.TinySDF({fontFamily:p,fontWeight:K,fontSize:24*Bd,buffer:3*Bd,radius:8*Bd}),_.fontWeight=K}if(this.localGlyphs[_.fontWeight][h])return this.localGlyphs[_.fontWeight][h];const y=String.fromCodePoint(h),{data:w,width:S,height:R,glyphWidth:O,glyphHeight:D,glyphLeft:z,glyphTop:V,glyphAdvance:H}=_.draw(y);return this.localGlyphs[_.fontWeight][h]={id:h,bitmap:new em({width:S,height:R},w),metrics:{width:O/Bd,height:D/Bd,left:z/Bd,top:V/Bd-27,advance:H/Bd,localGlyph:!0}}}}u1.loadGlyphRange=function(c,i,l,h,p){const _=256*i,y=_+255,w=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",c).replace("{range}",`${_}-${y}`),C0.Glyphs);xd(w,(S,R)=>{if(S)p(S);else if(R){const O={},D=function(z){return new TS(z).readFields(Yie,{})}(R);for(const z of D.glyphs)O[z.id]=z;p(null,{glyphs:O,ascender:D.ascender,descender:D.descender})}})},u1.TinySDF=class{constructor({fontSize:c=24,buffer:i=3,radius:l=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:_="normal",fontStyle:y="normal",lang:w=null}={}){this.buffer=i,this.cutoff=h,this.radius=l,this.lang=w;const S=this.size=c+4*i,R=this._createCanvas(S),O=this.ctx=R.getContext("2d",{willReadFrequently:!0});O.font=`${y} ${_} ${c}px ${p}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(c){const i=document.createElement("canvas");return i.width=i.height=c,i}draw(c){const{width:i,actualBoundingBoxAscent:l,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:_}=this.ctx.measureText(c),y=Math.ceil(l),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-p))),S=Math.min(this.size-this.buffer,y+Math.ceil(h)),R=w+2*this.buffer,O=S+2*this.buffer,D=Math.max(R*O,0),z=new Uint8ClampedArray(D),V={data:z,width:R,height:O,glyphWidth:w,glyphHeight:S,glyphTop:y,glyphLeft:0,glyphAdvance:i};if(w===0||S===0)return V;const{ctx:H,buffer:K,gridInner:re,gridOuter:ne}=this;this.lang&&(H.lang=this.lang),H.clearRect(K,K,w,S),H.fillText(c,K,K+y);const ue=H.getImageData(K,K,w,S);ne.fill(Xb,0,D),re.fill(0,0,D);for(let he=0;he<S;he++)for(let ge=0;ge<w;ge++){const ke=ue.data[4*(he*w+ge)+3]/255;if(ke===0)continue;const Ee=(he+K)*R+ge+K;if(ke===1)ne[Ee]=0,re[Ee]=Xb;else{const Me=.5-ke;ne[Ee]=Me>0?Me*Me:0,re[Ee]=Me<0?Me*Me:0}}s7(ne,0,0,R,O,R,this.f,this.v,this.z),s7(re,K,K,w,S,R,this.f,this.v,this.z);for(let he=0;he<D;he++){const ge=Math.sqrt(ne[he])-Math.sqrt(re[he]);z[he]=Math.round(255-255*(ge/this.radius+this.cutoff))}return V}};const Lh=gg;function o7(c,i){return c+i[1]-i[0]}function s6(c,i,l,h,p=1){const _=[],y=c.imagePrimary,w=y.pixelRatio,S=y.paddedRect.w-2*Lh,R=y.paddedRect.h-2*Lh,O=(c.right-c.left)*p,D=(c.bottom-c.top)*p,z=y.stretchX||[[0,S]],V=y.stretchY||[[0,R]],H=z.reduce(o7,0),K=V.reduce(o7,0),re=S-H,ne=R-K;let ue=0,he=H,ge=0,ke=K,Ee=0,Me=re,Be=0,$e=ne;if(y.content&&h){const Ye=y.content;ue=AS(z,0,Ye[0]),ge=AS(V,0,Ye[1]),he=AS(z,Ye[0],Ye[2]),ke=AS(V,Ye[1],Ye[3]),Ee=Ye[0]-ue,Be=Ye[1]-ge,Me=Ye[2]-Ye[0]-he,$e=Ye[3]-Ye[1]-ke}const pt=(Ye,vt,kt,It)=>{const Ft=CS(Ye.stretch-ue,he,O,c.left*p),jt=kS(Ye.fixed-Ee,Me,Ye.stretch,H),Lt=CS(vt.stretch-ge,ke,D,c.top*p),Dt=kS(vt.fixed-Be,$e,vt.stretch,K),yt=CS(kt.stretch-ue,he,O,c.left*p),gt=kS(kt.fixed-Ee,Me,kt.stretch,H),zt=CS(It.stretch-ge,ke,D,c.top*p),Jt=kS(It.fixed-Be,$e,It.stretch,K),Gt=new Ve(Ft,Lt),Fn=new Ve(yt,Lt),mn=new Ve(yt,zt),xn=new Ve(Ft,zt),Pn=new Ve(jt/w,Dt/w),Yr=new Ve(gt/w,Jt/w),Wt=i*Math.PI/180;if(Wt){const os=Math.sin(Wt),Se=Math.cos(Wt),Ie=[Se,-os,os,Se];Gt._matMult(Ie),Fn._matMult(Ie),xn._matMult(Ie),mn._matMult(Ie)}const On=Ye.stretch+Ye.fixed,Rr=kt.stretch+kt.fixed,fi=vt.stretch+vt.fixed,xi=It.stretch+It.fixed,Fr=c.imageSecondary;return{tl:Gt,tr:Fn,bl:xn,br:mn,texPrimary:{x:y.paddedRect.x+Lh+On,y:y.paddedRect.y+Lh+fi,w:Rr-On,h:xi-fi},texSecondary:Fr?{x:Fr.paddedRect.x+Lh+On,y:Fr.paddedRect.y+Lh+fi,w:Rr-On,h:xi-fi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Pn,pixelOffsetBR:Yr,minFontScaleX:Me/w/O,minFontScaleY:$e/w/D,isSDF:l}};if(h&&(y.stretchX||y.stretchY)){const Ye=l7(z,re,H),vt=l7(V,ne,K);for(let kt=0;kt<Ye.length-1;kt++){const It=Ye[kt],Ft=Ye[kt+1];for(let jt=0;jt<vt.length-1;jt++)_.push(pt(It,vt[jt],Ft,vt[jt+1]))}}else _.push(pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:R+1}));return _}function rse(c,i){const l=c.stretchY||[[0,c.paddedRect.h-2*Lh]];return i&&(c.stretchX||c.stretchY)?u7(c.stretchX||[[0,c.paddedRect.w-2*Lh]])*u7(l):1}function AS(c,i,l){let h=0;for(const p of c)h+=Math.max(i,Math.min(l,p[1]))-Math.max(i,Math.min(l,p[0]));return h}function l7(c,i,l){const h=[{fixed:-Lh,stretch:0}];for(const[p,_]of c){const y=h[h.length-1];h.push({fixed:p-y.stretch,stretch:y.stretch}),h.push({fixed:p-y.stretch,stretch:y.stretch+(_-p)})}return h.push({fixed:i+Lh,stretch:l}),h}function u7(c){return 2*c.length+1}function CS(c,i,l,h){return c/i*l+h}function kS(c,i,l,h){return c-i*l/h}function ise(c,i,l,h){const p=i+c.positionedLines[h].lineOffset;return h===0?l+p/2:l+(p+(i+c.positionedLines[h-1].lineOffset))/2}function sse(c,i=1,l=!1){let h=1/0,p=1/0,_=-1/0,y=-1/0;const w=c[0];for(let V=0;V<w.length;V++){const H=w[V];(!V||H.x<h)&&(h=H.x),(!V||H.y<p)&&(p=H.y),(!V||H.x>_)&&(_=H.x),(!V||H.y>y)&&(y=H.y)}const S=Math.min(_-h,y-p);let R=S/2;const O=new J_([],ase);if(S===0)return new Ve(h,p);for(let V=h;V<_;V+=S)for(let H=p;H<y;H+=S)O.push(new c1(V+R,H+R,R,c));let D=function(V){let H=0,K=0,re=0;const ne=V[0];for(let ue=0,he=ne.length,ge=he-1;ue<he;ge=ue++){const ke=ne[ue],Ee=ne[ge],Me=ke.x*Ee.y-Ee.x*ke.y;K+=(ke.x+Ee.x)*Me,re+=(ke.y+Ee.y)*Me,H+=3*Me}return new c1(K/H,re/H,0,V)}(c),z=O.length;for(;O.length;){const V=O.pop();(V.d>D.d||!D.d)&&(D=V,l&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,z)),V.max-D.d<=i||(R=V.h/2,O.push(new c1(V.p.x-R,V.p.y-R,R,c)),O.push(new c1(V.p.x+R,V.p.y-R,R,c)),O.push(new c1(V.p.x-R,V.p.y+R,R,c)),O.push(new c1(V.p.x+R,V.p.y+R,R,c)),z+=4)}return l&&(console.log(`num probes: ${z}`),console.log(`best distance: ${D.d}`)),D.p}function ase(c,i){return i.max-c.max}class c1{constructor(i,l,h,p){this.p=new Ve(i,l),this.h=h,this.d=function(_,y){let w=!1,S=1/0;for(let R=0;R<y.length;R++){const O=y[R];for(let D=0,z=O.length,V=z-1;D<z;V=D++){const H=O[D],K=O[V];H.y>_.y!=K.y>_.y&&_.x<(K.x-H.x)*(_.y-H.y)/(K.y-H.y)+H.x&&(w=!w),S=Math.min(S,Ea(_,H,K))}}return(w?1:-1)*Math.sqrt(S)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const ose=Object.keys,a6=Number.POSITIVE_INFINITY,lse=Math.sqrt(2);function nm(c,i,l,h,p){const _=e6(c)&&c.collisionPadding?c.collisionPadding:[0,0,0,0],y={top:c.top-_[1],bottom:c.bottom+_[3],left:c.left-_[0],right:c.right+_[2],scaled:!1};return h!==void 0&&function(w,S){w.top*=S,w.bottom*=S,w.left*=S,w.right*=S,w.scaled=!0}(y,h),l&&function(w,S){if(!S)return;const R=Tn(S),O=new Ve(w.left,w.top),D=new Ve(w.right,w.top),z=new Ve(w.left,w.bottom),V=new Ve(w.right,w.bottom),H=new Ve(0,0);O._rotateAround(R,H),D._rotateAround(R,H),z._rotateAround(R,H),V._rotateAround(R,H),w.left=Math.min(O.x,D.x,z.x,V.x),w.right=Math.max(O.x,D.x,z.x,V.x),w.top=Math.min(O.y,D.y,z.y,V.y),w.bottom=Math.max(O.y,D.y,z.y,V.y)}(y,l),p&&(y.left+=p[0],y.right+=p[0],y.top+=p[1],y.bottom+=p[1]),i?{top:Math.min(i.top,y.top),bottom:Math.max(i.bottom,y.bottom),left:Math.min(i.left,y.left),right:Math.max(i.right,y.right),scaled:i.scaled||y.scaled}:y}function c7(c,[i,l]){let h=0,p=0;if(l===a6){i<0&&(i=0);const _=i/lse;switch(c){case"top-right":case"top-left":p=_-7;break;case"bottom-right":case"bottom-left":p=7-_;break;case"bottom":p=7-i;break;case"top":p=i-7}switch(c){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=i;break;case"right":h=-i}}else{switch(i=Math.abs(i),l=Math.abs(l),c){case"top-right":case"top-left":case"top":p=l-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-l}switch(c){case"top-right":case"bottom-right":case"right":h=-i;break;case"top-left":case"bottom-left":case"left":h=i}}return[h,p]}function use(c,i,l,h,p,_,y,w,S,R,O,D,z,V){const H=c.layers[0],K=H.appearances;if(K.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const re={iconBBox:null,iconVerticalBBox:null},ne={textBBox:null,textVerticalBBox:null},{baseIconRotate:ue,baseTextRotate:he,iconScaleFactor:ge}=function(Ee,Me,Be){const $e=Ee.get("icon-rotate").evaluate(Me,{},Be),pt=Ee.get("text-rotate").evaluate(Me,{},Be),[Ye,vt]=Ee.get("icon-size-scale-range");return{baseIconRotate:$e,baseTextRotate:pt,iconScaleFactor:ee(1,Ye,vt)}}(h,p,_);i&&(re.iconBBox=nm(i,re.iconBBox,ue,y),l)&&(re.iconVerticalBBox=nm(l,re.iconVerticalBBox,ue+90,y));const ke=RS(D.horizontal);ke&&(ne.textBBox=nm(ke,ne.textBBox,he,1,V)),D.vertical&&(ne.textVerticalBBox=nm(D.vertical,ne.textVerticalBBox,he+90,1,V));for(const Ee of K)Ee.hasIconProperties()&&cse(re,c,H,Ee,p,_,w,ue,y,S,i,R,ge,O),Ee.hasTextProperties()&&dse(ne,H,Ee,p,_,V,he,z,ke,D.vertical);return{iconBBox:re.iconBBox,iconVerticalBBox:re.iconVerticalBBox,textBBox:ne.textBBox,textVerticalBBox:ne.textVerticalBBox}}function cse(c,i,l,h,p,_,y,w,S,R,O,D,z,V){const{appearanceIconOffset:H,appearanceIconRotate:K,appearanceIconSize:re}=function(ge,ke,Ee,Me,Be,$e,pt,Ye){const vt=ge.hasProperty("icon-offset")?ke.getAppearanceValueAndResolveTokens(ge,"icon-offset",Ee,Me,[]):null,kt=vt&&Array.isArray(vt)?vt:Be,It=ge.hasProperty("icon-rotate")?ke.getAppearanceValueAndResolveTokens(ge,"icon-rotate",Ee,Me,[]):null,Ft=typeof It=="number"?It:$e,jt=ge.hasProperty("icon-size")?ke.getAppearanceValueAndResolveTokens(ge,"icon-size",Ee,Me,[]):null;return{appearanceIconOffset:kt,appearanceIconRotate:Ft,appearanceIconSize:typeof jt=="number"?jt*Ye.iconScaleFactor:pt}}(h,l,p,_,y,w,S,R);let ne=null,ue=null,he=null;h.hasProperty("icon-image")?he=function(ge,ke,Ee,Me,Be,$e,pt){let Ye=null;const vt=ke.getAppearanceValueAndResolveTokens(Ee,"icon-image",Me,Be,[]);if(vt){const kt=ge.getResolvedImageFromTokens(vt),It=Ee.getUnevaluatedProperty("icon-size"),Ft=Yb(kt,o1(ge.zoom,It,ge.worldview),It,Be,ge.zoom,Me,ge.pixelRatio,pt,ge.worldview);Ye=$e.get(Ft.iconPrimary.toString())}return Ye}(i,l,h,p,_,D,z):O&&(he=O.imagePrimary),he&&(ne=SS(he,null,H,V),i.allowVerticalPlacement&&(ue=SS(he,null,H,V))),ne&&(c.iconBBox=nm(ne,c.iconBBox,K,re)),ue&&(c.iconVerticalBBox=nm(ue,c.iconVerticalBBox,K+90,re))}function dse(c,i,l,h,p,_,y,w,S,R){const{appearanceTextOffset:O,appearanceTextRotate:D,appearanceTextSize:z}=function(H,K,re,ne,ue,he,ge){const ke=H.hasProperty("text-offset")?K.getAppearanceValueAndResolveTokens(H,"text-offset",re,ne,[]):null,Ee=ke&&Array.isArray(ke)?[ke[0]*mo,ke[1]*mo]:ue,Me=H.hasProperty("text-rotate")?K.getAppearanceValueAndResolveTokens(H,"text-rotate",re,ne,[]):null,Be=typeof Me=="number"?Me:he,$e=H.hasProperty("text-size")?K.getAppearanceValueAndResolveTokens(H,"text-size",re,ne,[]):null;return{appearanceTextOffset:Ee,appearanceTextRotate:Be,appearanceTextSize:typeof $e=="number"?$e:ge}}(l,i,h,p,_,y,w),V=z/w;S&&(c.textBBox=nm(S,c.textBBox,D,V,O)),R&&(c.textVerticalBBox=nm(R,c.textVerticalBBox,D+90,V,O))}function IS(c,i,l,h,p,_,y,w,S){if(!i||!i.usvg)return;const R=Kz(h),O=Kz(p),D=_!=="both"&&_!=="width"||!Xz(h)?1:O.width/R.width,z=_!=="both"&&_!=="height"||!Yz(h)?1:O.height/R.height;l.scaleSelf(D,z);const V=l.toString();y.set(V,l),w.set(V,i);const{imagePosition:H}=r6(V,i,gg);S.set(V,H)}function d7(c,i,l,h,p,_,y,w,S){if(!c)return;const R=function(O,D,z,V,H,K){if(O.kind==="camera")return O.maxSize;if(O.kind==="composite"){const re=D.possiblyEvaluate(new Rs(O.maxZoom,{worldview:K}),z).evaluate(H,{},z),ne=D.possiblyEvaluate(new Rs(O.minZoom,{worldview:K}),z).evaluate(H,{},z);return Math.max(re,ne)}return D.possiblyEvaluate(new Rs(V,{worldview:K})).evaluate(H,{},z)}(i,l,h,p,_,S);return c.scaleSelf(R*w*y)}function Yb(c,i,l,h,p,_,y,w,S){return{iconPrimary:d7(c.getPrimary(),i,l,h,p,_,y,w,S),iconSecondary:d7(c.getSecondary(),i,l,h,p,_,y,w,S)}}function hse(c,i,l){if(!i)return;const h=l.get(c.toString()),p=l.get(i.toString());h&&p&&(h.paddedRect.w===p.paddedRect.w&&h.paddedRect.h===p.paddedRect.h||un(`Mismatch in icon variant sizes: ${c.toString()} and ${i.toString()}`),h.usvg!==p.usvg&&un(`Mismatch in icon variant image types: ${c.id} and ${i.id}`))}function h7(c,i,l,h){if(!c)return;const p=i.get(l.toString());if(c.imagePrimary=p,h){const _=i.get(h.toString());c.imageSecondary=_}}function fse(c,i){for(const l in c.horizontal)f7(c.horizontal[l],i);f7(c.vertical,i)}function f7(c,i){if(c){for(const l of c.positionedLines)for(const h of l.positionedGlyphs)if(h.image!==null){const p=h.image.toString();h.rect=i.get(p).paddedRect}}}function o6(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function pse(c,i,l,h,p,_,y,w,S){const R=RS(_.horizontal)||_.vertical,O=l.get("icon-text-fit-padding").evaluate(h,{},p);let D,z=i;return i&&S!=="none"&&(c.allowVerticalPlacement&&_.vertical&&(D=t6(i,_.vertical,S,O,w,y)),R&&(z=t6(i,R,S,O,w,y))),{defaultShapedIcon:z,verticallyShapedIcon:D}}function mse(c,i,l,h,p,_,y,w,S,R,O,D,z,V,H,K,re,ne,ue,he,ge,ke,Ee,Me){let Be=y.textMaxSize.evaluate(i,{},z);Be===void 0?Be=w*y.textScaleFactor:Be*=y.textScaleFactor;const $e=c.layers[0].layout,pt=mo,Ye=w*y.textScaleFactor/pt,vt=RS(l.horizontal)||l.vertical;if(re!=="none"&&c.appearanceFeatureData&&i.index<c.appearanceFeatureData.length){const mn=c.appearanceFeatureData[i.index];mn&&(mn.textShaping=vt,mn.iconTextFitPadding=$e.get("icon-text-fit-padding").evaluate(i,{},z),mn.fontScale=Ye)}const kt=V.name==="globe",It=c.tilePixelRatio*Be/pt,Ft=(zt=c.overscaling,c.zoom>18&&zt>2&&(zt>>=1),Math.max(Qt/(512*zt),1)*$e.get("symbol-spacing")),jt=$e.get("text-padding")*c.tilePixelRatio,Lt=$e.get("icon-padding")*c.tilePixelRatio,Dt=Tn($e.get("text-max-angle")),yt=$e.get("icon-rotation-alignment")==="map"&&he!=="point",gt=Ft/2;var zt;c.hasAnyIconTextFit===!1&&re!=="none"&&(c.hasAnyIconTextFit=!0);const Jt=i.properties?+i.properties[_t]:null,Gt=Jt&&c.elevationFeatureIdToIndex?c.elevationFeatureIdToIndex.get(Jt):65535,Fn=(mn,xn,Pn)=>{if(xn.x<0||xn.x>=Qt||xn.y<0||xn.y>=Qt)return;let Yr=null;if(kt){const{x:Wt,y:On,z:Rr}=V.projectTilePoint(xn.x,xn.y,Pn);Yr={anchor:new jf(Wt,On,Rr,0,void 0),up:V.upVector(Pn,xn.x,xn.y)}}(function(Wt,On,Rr,fi,xi,Fr,os,Se,Ie,xt,Bt,cn,dn,Bn,Wn,Dr,$r,Wr,ci,yr,Ir,Ci,Li,Di,Qi,ys,ls,zi,qi,Hr,_i,Qs,gr){const di=Wt.addToLineVertexArray(On,fi);let hs,Ss,Ms,Ra,As,_r,ia,Ji=0,qs=0,Ya=0,go=0,Fa=-1,Ba=-1;const oo={};let Ml=U_("");const Cs=Rr?Rr.anchor:On,Sa=zi!=="none";let Ma=0,Gl=0;if(Ie._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Uo=Ie.layout.get("text-offset").evaluate(Ir,{},Qi);Ma=Uo[0]*mo,Gl=Uo[1]*mo}else Ma=Ie.layout.get("text-radial-offset").evaluate(Ir,{},Qi)*mo,Gl=a6;if(Wt.allowVerticalPlacement&&xi.vertical){const Uo=xi.vertical;if(Wn)_r=l6(Uo),Se&&(ia=l6(Se));else{const xl=Ie.layout.get("text-rotate").evaluate(Ir,{},Qi)+90;Ms=MS(xt,Cs,On,Bt,cn,dn,Uo,Bn,xl,Dr,Qs),Se&&(Ra=MS(xt,Cs,On,Bt,cn,dn,Se,Wr,xl,null,_i))}}if(Fr){const Uo=Wt.iconSizeData,xl=Ie.layout.get("icon-rotate").evaluate(Ir,{},Qi),mu=s6(Fr,xl,Li,Sa,Ci.iconScaleFactor),sm=Se?s6(Se,xl,Li,Sa,Ci.iconScaleFactor):void 0;Ss=MS(xt,Cs,On,Bt,cn,dn,Fr,Wr,xl,null,Hr);const _1=function($d,pw,P9,Cae,O9,L9,kae,Iae){const D9=$d.layers[0],N9=D9.appearances;let y1=pw.length;if(P9&&(y1=Math.max(y1,P9.length)),N9.length===0)return y1;const[Rae,Mae]=Cae.get("icon-size-scale-range"),Pae=ee(1,Rae,Mae);for(const z9 of N9){const F9=z9.getUnevaluatedProperties();if(F9._values["icon-image"].value!==void 0){const B9=D9.getAppearanceValueAndResolveTokens(z9,"icon-image",O9,L9,[]);if(B9){const j9=$d.getResolvedImageFromTokens(B9);if(j9){const U9=F9._values["icon-size"],Oae=Yb(j9,o1($d.zoom,U9,$d.worldview),U9,L9,$d.zoom,O9,$d.pixelRatio,Pae,$d.worldview),Lae=kae.get(Oae.iconPrimary.toString());y1=Math.max(y1,rse(Lae,Iae))}}}}return y1}(Wt,mu,sm,Ie.layout,Ir,Qi,Wt.iconAtlasPositions,Sa);Ji=4*_1;let Vd=null;Uo.kind==="source"?(Vd=[Fd*Ie.layout.get("icon-size").evaluate(Ir,{},Qi)*Ci.iconScaleFactor],Vd[0]>Uf&&un(`${Wt.layerIds[0]}: Value for "icon-size" is >= ${Kb}. Reduce your "icon-size".`)):Uo.kind==="composite"&&(Vd=[Fd*Ci.compositeIconSizes[0].evaluate(Ir,{},Qi)*Ci.iconScaleFactor,Fd*Ci.compositeIconSizes[1].evaluate(Ir,{},Qi)*Ci.iconScaleFactor],(Vd[0]>Uf||Vd[1]>Uf)&&un(`${Wt.layerIds[0]}: Value for "icon-size" is >= ${Kb}. Reduce your "icon-size".`)),Wt.addSymbols(Wt.icon,mu,Vd,yr,ci,Ir,void 0,Rr,On,di.lineStartIndex,di.lineLength,-1,Di,Qi,ys,ls,Wt.symbolInstances.length,_1),Fa=Wt.icon.placedSymbolArray.length-1,sm&&(qs=4*_1,Wt.addSymbols(Wt.icon,sm,Vd,yr,ci,Ir,pu.vertical,Rr,On,di.lineStartIndex,di.lineLength,-1,Di,Qi,ys,ls,Wt.symbolInstances.length,_1),Ba=Wt.icon.placedSymbolArray.length-1)}for(const Uo in xi.horizontal){const xl=Uo,mu=xi.horizontal[xl];hs||(Ml=U_(mu.text),Wn?As=l6(mu):hs=MS(xt,Cs,On,Bt,cn,dn,mu,Bn,Ie.layout.get("text-rotate").evaluate(Ir,{},Qi),Dr,Qs));const sm=mu.positionedLines.length===1;if(Ya+=p7(Wt,Rr,On,mu,os,Ie,Wn,Ir,Dr,di,xi.vertical?pu.horizontal:pu.horizontalOnly,sm?ose(xi.horizontal):[xl],oo,Fa,Ci,Di,Qi,Wt.symbolInstances.length,ys),sm)break}xi.vertical&&(go+=p7(Wt,Rr,On,xi.vertical,os,Ie,Wn,Ir,Dr,di,pu.vertical,["vertical"],oo,Ba,Ci,Di,Qi,Wt.symbolInstances.length,ys));let Ka=-1;const Jc=(Uo,xl)=>Uo?Math.max(Uo,xl):xl;Ka=Jc(As,Ka),Ka=Jc(_r,Ka),Ka=Jc(ia,Ka);const Dh=Ka>-1?1:0;Wt.glyphOffsetArray.length>=65535&&un("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ir.sortKey!==void 0&&Wt.addToSortKeyRanges(Wt.symbolInstances.length,Ir.sortKey),Wt.symbolInstances.emplaceBack(On.x,On.y,Cs.x,Cs.y,Cs.z,oo.right>=0?oo.right:-1,oo.center>=0?oo.center:-1,oo.left>=0?oo.left:-1,oo.vertical>=0?oo.vertical:-1,Fa,Ba,Ml,hs!==void 0?hs:Wt.collisionBoxArray.length,hs!==void 0?hs+1:Wt.collisionBoxArray.length,Ms!==void 0?Ms:Wt.collisionBoxArray.length,Ms!==void 0?Ms+1:Wt.collisionBoxArray.length,Ss!==void 0?Ss:Wt.collisionBoxArray.length,Ss!==void 0?Ss+1:Wt.collisionBoxArray.length,Ra||Wt.collisionBoxArray.length,Ra?Ra+1:Wt.collisionBoxArray.length,Bt,Ya,go,Ji,qs,Dh,0,Ma,Gl,Ka,0,Sa?1:0,qi)})(c,xn,Yr,mn,l,h,_,p,c.layers[0],c.collisionBoxArray,i.index,i.sourceLayerIndex,c.index,jt,ue,R,0,Lt,yt,ne,i,y,O,D,z,H,K,re,Gt,ge,ke,Ee)};if(he==="line")for(const mn of hS(i.geometry,0,0,Qt,Qt)){const xn=nse(mn,Ft,Dt,l.vertical||vt,h,pt,It,c.overscaling,Qt);for(const Pn of xn)vt&&gse(c,vt.text,gt,Pn)||Fn(mn,Pn,z)}else if(he==="line-center"){for(const mn of i.geometry)if(mn.length>1){const xn=tse(mn,Dt,l.vertical||vt,h,pt,It);xn&&Fn(mn,xn,z)}}else if(i.type==="Polygon")for(const mn of Ob(i.geometry,0)){const xn=sse(mn,16);Fn(mn[0],new jf(xn.x,xn.y,0,0,void 0),z)}else if(i.type==="LineString")for(const mn of i.geometry)Fn(mn,new jf(mn[0].x,mn[0].y,0,0,void 0),z);else if(i.type==="Point")for(const mn of i.geometry)for(const xn of mn)Fn([xn],new jf(xn.x,xn.y,0,0,void 0),z)}const Kb=255,Uf=Kb*Fd;function p7(c,i,l,h,p,_,y,w,S,R,O,D,z,V,H,K,re,ne,ue){const he=function(Ee,Me,Be,$e,pt,Ye,vt,kt){const It=[];if(Me.positionedLines.length===0)return It;const Ft=$e.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,jt=function(zt){const Jt=zt[0],Gt=zt[1],Fn=Jt*Gt;return Fn>0?[Jt,-Gt]:Fn<0?[-Jt,Gt]:Jt===0?[Gt,Jt]:[Gt,-Jt]}(Be);let Lt=Math.abs(Me.top-Me.bottom);for(const zt of Me.positionedLines)Lt-=zt.lineOffset;const Dt=Me.positionedLines.length,yt=Lt/Dt;let gt=Me.top-Be[1];for(let zt=0;zt<Dt;++zt){const Jt=Me.positionedLines[zt];gt=ise(Me,yt,gt,zt);for(const Gt of Jt.positionedGlyphs){if(!Gt.rect)continue;const Fn=Gt.rect||{};let mn=$z+1,xn=!0,Pn=1,Yr=0;if(Gt.image){const $r=vt.get(Gt.image.toString());if(!$r)continue;if($r.sdf){un("SDF images are not supported in formatted text and will be ignored.");continue}xn=!1,Pn=$r.pixelRatio,mn=gg/Pn}const Wt=(pt||kt)&&Gt.vertical,On=Gt.metrics.advance*Gt.scale/2,Rr=Gt.metrics,fi=Gt.rect;if(fi===null)continue;kt&&Me.verticalizable&&(Yr=Gt.image?On-Gt.metrics.width*Gt.scale/2:0);const xi=pt?[Gt.x+On,Gt.y]:[0,0];let Fr=[0,0],os=[0,0],Se=!1;pt||(Wt?(os=[Gt.x+On+jt[0],Gt.y+jt[1]-Yr],Se=!0):Fr=[Gt.x+On+Be[0],Gt.y+Be[1]-Yr]);const Ie=fi.w*Gt.scale/(Pn*(Gt.localGlyph?Bd:1)),xt=fi.h*Gt.scale/(Pn*(Gt.localGlyph?Bd:1));let Bt,cn,dn,Bn;if(Wt){const $r=Gt.y-gt,Wr=new Ve(-On,On-$r),ci=-Math.PI/2,yr=new Ve(...os);Bt=new Ve(-On+Fr[0],Fr[1]),Bt._rotateAround(ci,Wr)._add(yr),Bt.x+=-$r+On,Bt.y-=(Rr.left-mn)*Gt.scale;const Ir=Gt.image?Rr.advance*Gt.scale:mo*Gt.scale,Ci=String.fromCodePoint(Gt.glyph);Bie(Ci)?Bt.x+=(1-mn)*Gt.scale:jie(Ci)?Bt.x+=Ir-Rr.height*Gt.scale+(-mn-1)*Gt.scale:Bt.x+=Gt.image||Rr.width+2*mn===fi.w&&Rr.height+2*mn===fi.h?(Ir-xt)/2:(Ir-(Rr.height+2*mn)*Gt.scale)/2,cn=new Ve(Bt.x,Bt.y-Ie),dn=new Ve(Bt.x+xt,Bt.y),Bn=new Ve(Bt.x+xt,Bt.y-Ie)}else{const $r=(Rr.left-mn)*Gt.scale-On+Fr[0],Wr=(-Rr.top-mn)*Gt.scale+Fr[1],ci=$r+Ie,yr=Wr+xt;Bt=new Ve($r,Wr),cn=new Ve(ci,Wr),dn=new Ve($r,yr),Bn=new Ve(ci,yr)}if(Ft){let $r;$r=pt?new Ve(0,0):Se?new Ve(jt[0],jt[1]):new Ve(Be[0],Be[1]),Bt._rotateAround(Ft,$r),cn._rotateAround(Ft,$r),dn._rotateAround(Ft,$r),Bn._rotateAround(Ft,$r)}const Wn=new Ve(0,0),Dr=new Ve(0,0);It.push({tl:Bt,tr:cn,bl:dn,br:Bn,texPrimary:Fn,texSecondary:void 0,writingMode:Me.writingMode,glyphOffset:xi,sectionIndex:Gt.sectionIndex,isSDF:xn,pixelOffsetTL:Wn,pixelOffsetBR:Dr,minFontScaleX:0,minFontScaleY:0})}}return It}(0,h,S,_,y,w,p,c.allowVerticalPlacement),ge=c.textSizeData;let ke=null;ge.kind==="source"?(ke=[Fd*_.layout.get("text-size").evaluate(w,{},re)*H.textScaleFactor],ke[0]>Uf&&un(`${c.layerIds[0]}: Value for "text-size" is >= ${Kb}. Reduce your "text-size".`)):ge.kind==="composite"&&(ke=[Fd*H.compositeTextSizes[0].evaluate(w,{},re)*H.textScaleFactor,Fd*H.compositeTextSizes[1].evaluate(w,{},re)*H.textScaleFactor],(ke[0]>Uf||ke[1]>Uf)&&un(`${c.layerIds[0]}: Value for "text-size" is >= ${Kb}. Reduce your "text-size".`)),c.addSymbols(c.text,he,ke,S,y,w,O,i,l,R.lineStartIndex,R.lineLength,V,K,re,ue,!1,ne,he.length);for(const Ee of D)z[Ee]=c.text.placedSymbolArray.length-1;return 4*he.length}function RS(c){for(const i in c)return c[i];return null}function MS(c,i,l,h,p,_,y,w,S,R,O){let D,z,V,H;if(D=O?O.top:y.top,z=O?O.bottom:y.bottom,V=O?O.left:y.left,H=O?O.right:y.right,e6(y)&&y.collisionPadding){const K=y.collisionPadding;V-=K[0],D-=K[1],H+=K[2],z+=K[3]}if(S){const K=new Ve(V,D),re=new Ve(H,D),ne=new Ve(V,z),ue=new Ve(H,z),he=Tn(S);let ge=new Ve(0,0);R&&(ge=new Ve(R[0],R[1])),K._rotateAround(he,ge),re._rotateAround(he,ge),ne._rotateAround(he,ge),ue._rotateAround(he,ge),V=Math.min(K.x,re.x,ne.x,ue.x),H=Math.max(K.x,re.x,ne.x,ue.x),D=Math.min(K.y,re.y,ne.y,ue.y),z=Math.max(K.y,re.y,ne.y,ue.y)}return c.emplaceBack(i.x,i.y,i.z,l.x,l.y,V,D,H,z,w,h,p,_),c.length-1}function l6(c){e6(c)&&c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const i=c.bottom-c.top;return i>0?Math.max(10,i):null}function gse(c,i,l,h){const p=c.compareText;if(i in p){const _=p[i];for(let y=_.length-1;y>=0;y--)if(h.dist(_[y])<l)return!0}else p[i]=[];return p[i].push(h),!1}function m7(c,i){const l=c.fovAboveCenter,h=c.elevation?c.elevation.getMinElevationBelowMSL()*i:0,p=(c._camera.position[2]*c.worldSize-h)/Math.cos(c._pitch),_=Math.sin(l)*p/Math.sin(Math.max(Math.PI/2-c._pitch-l,.01));let y=Math.sin(c._pitch)*_+p;const w=p*(1/c._horizonShift);if(!c.elevation||c.elevation.exaggeration()===0){let S=Math.max(c.zoom-17,0);c.isOrthographic&&(S/=10),y*=1+S}return Math.min(1.01*y,w)}function Qb(c,i){if(!i.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:i};const l=Math.pow(2,-c.z),h=c.x*l,p=(c.x+1)*l,_=c.y*l,y=(c.y+1)*l,w=j(h),S=j(p),R=Z(_),O=Z(y),D=i.project(w,R),z=i.project(S,R),V=i.project(S,O),H=i.project(w,O);let K=Math.min(D.x,z.x,V.x,H.x),re=Math.min(D.y,z.y,V.y,H.y),ne=Math.max(D.x,z.x,V.x,H.x),ue=Math.max(D.y,z.y,V.y,H.y);const he=l/16;function ge(Ee,Me,Be,$e,pt,Ye){const vt=(Be+pt)/2,kt=($e+Ye)/2,It=i.project(j(vt),Z(kt)),Ft=Math.max(0,K-It.x,re-It.y,It.x-ne,It.y-ue);K=Math.min(K,It.x),ne=Math.max(ne,It.x),re=Math.min(re,It.y),ue=Math.max(ue,It.y),Ft>he&&(ge(Ee,It,Be,$e,vt,kt),ge(It,Me,vt,kt,pt,Ye))}ge(D,z,h,_,p,_),ge(z,V,p,_,p,y),ge(V,H,p,y,h,y),ge(H,D,h,y,h,_),K-=he,re-=he,ne+=he,ue+=he;const ke=1/Math.max(ne-K,ue-re);return{scale:ke,x:K*ke,y:re*ke,x2:ne*ke,y2:ue*ke,projection:i}}function g7(c,{x:i,y:l},h=0){return new Ve(((i-h)*c.scale-c.x)*Qt,(l*c.scale-c.y)*Qt)}const _se=q(new Float32Array(16));class rm{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,l){return{x:0,y:0,z:0}}unproject(i,l){return new d(0,0)}projectTilePoint(i,l,h){return{x:i,y:l,z:0}}locationPoint(i,l,h,p=!0){return i._coordinatePoint(i.locationCoordinate(l,h),p)}pixelsPerMeter(i,l){return N(1,i)*l}pixelSpaceConversion(i,l,h){return 1}farthestPixelDistance(i){return m7(i,i.pixelsPerMeter)}pointCoordinate(i,l,h,p){const _=i.horizonLineFromTop(!1),y=new Ve(l,Math.max(_,h));return i.rayIntersectionCoordinate(i.pointRayIntersection(y,p))}pointCoordinate3D(i,l,h){const p=new Ve(l,h);if(i.elevation)return i.elevation.pointCoordinate(p);{const _=this.pointCoordinate(i,p.x,p.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(i,l){if(i.elevation&&i.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(i,l.x,l.y);const h=i.horizonLineFromTop();return l.y<h}createInversionMatrix(i,l){return _se}createTileMatrix(i,l,h){let p,_,y;const w=h.canonical,S=q(new Float64Array(16));if(this.isReprojectedInTileSpace){const R=Qb(w,this);p=1,_=R.x+h.wrap*R.scale,y=R.y,ie(S,S,[p/R.scale,p/R.scale,i.pixelsPerMeter/l])}else p=l/i.zoomScale(w.z),_=(w.x+Math.pow(2,w.z)*h.wrap)*p,y=w.y*p;return X(S,S,[_,y,0]),ie(S,S,[p/Qt,p/Qt,1]),S}upVector(i,l,h){return[0,0,1]}upVectorScale(i,l,h){return{metersToTile:1}}}class yse extends rm{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[l,h]=this.parallels=i.parallels||[29.5,45.5],p=Math.sin(Tn(l));this.n=(p+Math.sin(Tn(h)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(i,l){const{n:h,c:p,r0:_}=this,y=Tn(i-this.center[0]),w=Tn(l),S=Math.sqrt(p-2*h*Math.sin(w))/h;return{x:S*Math.sin(y*h),y:S*Math.cos(y*h)-_,z:0}}unproject(i,l){const{n:h,c:p,r0:_}=this,y=_+l;let w=Math.atan2(i,Math.abs(y))*Math.sign(y);y*h<0&&(w-=Math.PI*Math.sign(i)*Math.sign(y));const S=Tn(this.center[0])*h;w=ye(w,-Math.PI-S,Math.PI-S);const R=ee(ti(w/h)+this.center[0],-180,180),O=Math.asin(ee((p-(i*i+y*y)*h*h)/(2*h),-1,1)),D=ee(ti(O),-Y,Y);return new d(R,D)}}const Jb=1.340264,ew=-.081106,tw=893e-6,nw=.003796,PS=Math.sqrt(3)/2;class vse extends rm{project(i,l){l=l/180*Math.PI,i=i/180*Math.PI;const h=Math.asin(PS*Math.sin(l)),p=h*h,_=p*p*p;return{x:.5*(i*Math.cos(h)/(PS*(Jb+3*ew*p+_*(7*tw+9*nw*p)))/Math.PI+.5),y:1-.5*(h*(Jb+ew*p+_*(tw+nw*p))/Math.PI+1),z:0}}unproject(i,l){i=(2*i-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,p=h*h,_=p*p*p;for(let O,D,z,V=0;V<12&&(D=h*(Jb+ew*p+_*(tw+nw*p))-l,z=Jb+3*ew*p+_*(7*tw+9*nw*p),O=D/z,h=ee(h-O,-Math.PI/3,Math.PI/3),p=h*h,_=p*p*p,!(Math.abs(O)<1e-12));++V);const y=PS*i*(Jb+3*ew*p+_*(7*tw+9*nw*p))/Math.cos(h),w=Math.asin(Math.sin(h)/PS),S=ee(180*y/Math.PI,-180,180),R=ee(180*w/Math.PI,-Y,Y);return new d(S,R)}}class xse extends rm{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,l){return{x:.5+i/360,y:.5-l/360,z:0}}unproject(i,l){const h=360*(i-.5),p=ee(360*(.5-l),-Y,Y);return new d(h,p)}}const d1=Math.PI/2;function OS(c){return Math.tan((d1+c)/2)}class bse extends rm{constructor(i){super(i),this.center=i.center||[0,30];const[l,h]=this.parallels=i.parallels||[30,30];let p=Tn(l),_=Tn(h);this.southernCenter=p+_<0,this.southernCenter&&(p=-p,_=-_);const y=Math.cos(p),w=OS(p);this.n=p===_?Math.sin(p):Math.log(y/Math.cos(_))/Math.log(OS(_)/w),this.f=y*Math.pow(OS(p),this.n)/this.n}project(i,l){l=Tn(l),this.southernCenter&&(l=-l),i=Tn(i-this.center[0]);const h=1e-6,{n:p,f:_}=this;_>0?l<-d1+h&&(l=-d1+h):l>d1-h&&(l=d1-h);const y=_/Math.pow(OS(l),p);let w=y*Math.sin(p*i),S=_-y*Math.cos(p*i);return w=.5*(w/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:w,y:this.southernCenter?S:1-S,z:0}}unproject(i,l){i=(2*i-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:h,f:p}=this,_=p-l,y=Math.sign(_),w=Math.sign(h)*Math.sqrt(i*i+_*_);let S=Math.atan2(i,Math.abs(_))*y;_*h<0&&(S-=Math.PI*Math.sign(i)*y);const R=ee(ti(S/h)+this.center[0],-180,180),O=ee(ti(2*Math.atan(Math.pow(p/w,1/h))-d1),-Y,Y);return new d(R,this.southernCenter?-O:O)}}class _7 extends rm{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,l){return{x:I(i),y:M(l),z:0}}unproject(i,l){const h=j(i),p=Z(l);return new d(h,p)}}const y7=Tn(Y);class wse extends rm{project(i,l){const h=(l=Tn(l))*l,p=h*h;return{x:.5*((i=Tn(i))*(.8707-.131979*h+p*(p*(.003971*h-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+h*(.015085+p*(.028874*h-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(i,l){i=(2*i-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,p=25,_=0,y=h*h;do{y=h*h;const R=y*y;_=(h*(1.007226+y*(.015085+R*(.028874*y-.044475-.005916*R)))-l)/(1.007226+y*(.045255+R*(.259866*y-.311325-.005916*11*R))),h=ee(h-_,-y7,y7)}while(Math.abs(_)>1e-6&&--p>0);y=h*h;const w=ee(ti(i/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),S=ti(h);return new d(w,S)}}const v7=Tn(Y);class Tse extends rm{project(i,l){l=Tn(l),i=Tn(i);const h=Math.cos(l),p=2/Math.PI,_=Math.acos(h*Math.cos(i/2)),y=Math.sin(_)/_,w=.5*(i*p+2*h*Math.sin(i/2)/y)||0,S=.5*(l+Math.sin(l)/y)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(i,l){let h=i=(2*i-.5)*Math.PI,p=l=(2*(1-l)-1)*Math.PI,_=25;const y=1e-6;let w=0,S=0;do{const R=Math.cos(p),O=Math.sin(p),D=2*O*R,z=O*O,V=R*R,H=Math.cos(h/2),K=Math.sin(h/2),re=2*H*K,ne=K*K,ue=1-V*H*H,he=ue?1/ue:0,ge=ue?Math.acos(R*H)*Math.sqrt(1/ue):0,ke=.5*(2*ge*R*K+2*h/Math.PI)-i,Ee=.5*(ge*O+p)-l,Me=.5*he*(V*ne+ge*R*H*z)+1/Math.PI,Be=he*(re*D/4-ge*O*K),$e=.125*he*(D*K-ge*O*V*re),pt=.5*he*(z*H+ge*ne*R)+.5,Ye=Be*$e-pt*Me;w=(Ee*Be-ke*pt)/Ye,S=(ke*$e-Ee*Me)/Ye,h=ee(h-w,-Math.PI,Math.PI),p=ee(p-S,-v7,v7)}while((Math.abs(w)>y||Math.abs(S)>y)&&--_>0);return new d(ti(h),ti(p))}}class x7 extends rm{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Tn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,l){const{scale:h,cosPhi:p}=this;return{x:Tn(i)*p*h+.5,y:-Math.sin(Tn(l))/p*h+.5,z:0}}unproject(i,l){const{scale:h,cosPhi:p}=this,_=-(l-.5)/h,y=ee(ti((i-.5)/h)/p,-180,180),w=Math.asin(ee(_*p,-1,1)),S=ee(ti(w),-Y,Y);return new d(y,S)}}class Ese extends _7{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,l,h){const p=Cb(i,l,h);return nn(p,p,rS(gc(h))),{x:p[0],y:p[1],z:p[2]}}locationPoint(i,l,h){const p=Yp(l.lat,l.lng),_=Vt([],p),y=h?i._centerAltitude+h:i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(l),i._centerAltitude):i._centerAltitude;$t(p,p,_,N(1,0)*Qt*y);const w=q(new Float64Array(16));return $(w,i.pixelMatrix,i.globeMatrix),nn(p,p,w),new Ve(p[0],p[1])}pixelsPerMeter(i,l){return N(1,0)*l}pixelSpaceConversion(i,l,h){const p=N(1,i)*l,_=br(N(1,45)*l,p,h);return this.pixelsPerMeter(i,l)/_}createTileMatrix(i,l,h){const p=fI(gc(h.canonical));return $(new Float64Array(16),i.globeMatrix,p)}createInversionMatrix(i,l){const{center:h}=i,p=rS(gc(l));return fe(p,p,Tn(h.lng)),de(p,p,Tn(h.lat)),ie(p,p,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(i,l,h,p){return Qp(i,l,h,!0)||new pe(0,0)}pointCoordinate3D(i,l,h){const p=this.pointCoordinate(i,l,h,0);return[p.x,p.y,p.z]}isPointAboveHorizon(i,l){return!Qp(i,l.x,l.y,!1)}farthestPixelDistance(i){const l=function(p,_){const y=p.cameraToCenterDistance,w=p._centerAltitude*_,S=p._camera,R=p._camera.forward(),O=tt([],ze([],R,-y),[0,0,w]),D=p.worldSize/(2*Math.PI),z=[0,0,-D],V=p.width/p.height,H=Math.tan(p.fovAboveCenter),K=ze([],S.up(),H),re=ze([],S.right(),H*V),ne=Vt([],tt([],tt([],R,K),re)),ue=[];let he;if(new In(O,ne).closestPointOnSphere(z,D,ue)){const ge=tt([],ue,z),ke=Vn([],ge,O);he=Math.cos(p.fovAboveCenter)*Pt(ke)}else{const ge=Vn([],O,z),ke=Vn([],z,O);Vt(ke,ke);const Ee=Pt(ge)-D;he=Math.sqrt(Ee*(Ee+2*D));const Me=Math.acos(he/(D+Ee))-Math.acos(En(R,ke));he*=Math.cos(Me)}return 1.01*he}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),h=Jp(i.zoom);if(h>0){const p=m7(i,N(1,i.center.lat)*i.worldSize),_=i.worldSize/(2*Math.PI),y=Math.max(i.width,i.height)/i.worldSize*Math.PI;return br(l,p+_*(1-Math.cos(y)),Math.pow(h,10))}return l}upVector(i,l,h){return Cb(l,h,i,1)}upVectorScale(i){return{metersToTile:Kc(nS(gc(i)))}}}function b7(c){const i=c.parallels,l=!!i&&Math.abs(i[0]+i[1])<.01;switch(c.name){case"mercator":return new _7(c);case"equirectangular":return new xse(c);case"naturalEarth":return new wse(c);case"equalEarth":return new vse(c);case"winkelTripel":return new Tse(c);case"albers":return l?new x7(c):new yse(c);case"lambertConformalConic":return l?new x7(c):new bse(c);case"globe":return new Ese(c)}throw new Error(`Invalid projection name: ${c.name}`)}const Sse=He.types,Ase=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function rw(c,i,l,h,p,_,y,w,S,R,O,D,z){const V=w?Math.min(Uf,Math.round(w[0])):0,H=w?Math.min(Uf,Math.round(w[1])):0;c.emplaceBack(i,l,Math.round(32*h),Math.round(32*p),_,y,(V<<1)+(S?1:0),0+(H<<1),16*R,16*O,256*D,256*z)}function iw(c,i,l){c.emplaceBack(i,l)}function sw(c,i,l,h,p,_,y){c.emplaceBack(i,l,h,p,_,y)}const LS=(c,i,l,h)=>{for(let p=0;p<i;p++)c.emplaceBack(l[0],l[1],l[2],h[0],h[1],h[2])};function h1(c,i,l,h,p){c.emplaceBack(i,l,h,p),c.emplaceBack(i,l,h,p),c.emplaceBack(i,l,h,p),c.emplaceBack(i,l,h,p)}function Cse(c){for(const i of c.sections)if(Kk(i.text))return!0;return!1}class u6{constructor(i){this.layoutVertexArray=new cb,this.indexArray=new Wa,this.programConfigurations=i,this.segments=new ta,this.dynamicLayoutVertexArray=new Ih,this.opacityVertexArray=new Dy,this.placedSymbolArray=new XE,this.iconTransitioningVertexArray=new du,this.globeExtVertexArray=new db,this.zOffsetVertexArray=new Id,this.orientationVertexArray=new pb,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(i,l){const h=[],p=this.layoutVertexArray.uint16;for(let _=0;_<l;++_){const y=12*(i+_);h.push(...p.slice(y,y+12))}return h}updateIconVertexData(i,l,h,p,_,y,w,S,R,O,D,z,V){const H=this.layoutVertexArray.uint16,K=12*i;H[K]=l,H[K+1]=h,H[K+2]=p,H[K+3]=_,H[K+4]=y,H[K+5]=w,H[K+6]=S,H[K+7]=R,H[K+8]=O,H[K+9]=D,H[K+10]=z,H[K+11]=V}upload(i,l,h,p,_,y){this.isEmpty()||(h&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Iie.members,!!y),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,Mie.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Ase,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=i.createVertexBuffer(this.iconTransitioningVertexArray,Lie.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,Rie.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||_)&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,Pie.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=i.createVertexBuffer(this.orientationVertexArray,Oie.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}An(u6,"SymbolBuffers");class c6{constructor(i,l,h){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new h,this.segments=new ta,this.collisionVertexArray=new hb,this.collisionVertexArrayExt=new Ih}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Die.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,Nie.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}An(c6,"CollisionBuffers");class DS{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=q([]),this.placementViewportMatrix=q([]);const l=this.layers[0]._unevaluatedLayout._values;this.worldview=i.worldview,this.localizable=i.localizable,this.textSizeData=o1(this.zoom,l["text-size"],this.worldview),this.iconSizeData=o1(this.zoom,l["icon-size"],this.worldview);const h=this.layers[0].layout,p=h.get("symbol-sort-key"),_=h.get("symbol-z-order");this.lut=i.lut,this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(y=>pu[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=i.sourceID,this.projection=i.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(i){const l=this.layers[0].getAppearances();return!(!l||l.length===0)&&l.some(h=>h.getProperty(i)!=null)}createArrays(){this.text=new u6(new pc(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("text")||i.startsWith("symbol"))),this.icon=new u6(new pc(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("icon")||i.startsWith("symbol"))),this.glyphOffsetArray=new $y,this.lineVertexArray=new KE,this.symbolInstances=new vb}calculateGlyphDependencies(i,l,h,p,_){for(const y of i){const w=y.codePointAt(0);if(w===void 0)break;if(l[w]=!0,p&&_&&w<=65535){const S=qb[y];S&&(l[S.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(i,l,h,p,_,y){let w=1;const S=i.getUnevaluatedProperties()._values["icon-size"],R=o1(this.zoom,S,this.worldview),O=l1(R,l);if(R.kind!=="constant"&&R.kind!=="camera"||(w=O.uSize),R.kind==="composite"){const{minZoom:D,maxZoom:z}=R,V=S.possiblyEvaluate(new Rs(D,{worldview:this.worldview}),p),H=S.possiblyEvaluate(new Rs(z,{worldview:this.worldview}),p),K=V.evaluate(h,{},p,_);w=K+(H.evaluate(h,{},p,_)-K)*O.uSizeT}return R.kind==="source"&&(w=S.possiblyEvaluate(new Rs(this.zoom,{worldview:this.worldview}),p).evaluate(h,{},p,_)),w*y}updateFootprints(i,l){}updateReplacement(i,l){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const h=l.getReplacementRegionsForTile(i.toUnwrapped(),!0);return!uS(this.activeReplacements,h)&&(this.activeReplacements=h,!0)}getResolvedImageFromTokens(i){return typeof i=="string"?ml.build(i):i}populate(i,l,h,p){const _=this.layers[0],y=_.layout,w=this.projection.name==="globe",S=y.get("text-font"),R=y.get("text-field"),O=y.get("icon-image"),[D,z]=y.get("icon-size-scale-range"),V=ee(l.scaleFactor||1,D,z),H=(R.value.kind!=="constant"||R.value.value instanceof pl&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),K=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,re=this.hasAnyAppearanceProperty("icon-image"),ne=y.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!H&&!K&&!re)return;const ue=l.iconDependencies,he=l.glyphDependencies,ge=l.availableImages,ke=new Rs(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),Ee=Me=>{const Be=Me.id.toString();ue.has(Be)?ue.get(Be).push(Me):ue.set(Be,[Me])};for(const Me of i){const{feature:Be,id:$e,index:pt,sourceLayerIndex:Ye}=Me,vt=_._featureFilter.needGeometry,kt=Xe(Be,vt);if(!_._featureFilter.filter(ke,kt,h))continue;if(vt||(kt.geometry=Fe(Be,h,p)),w&&Be.type!==1&&h.z<=5){const zt=kt.geometry,Jt=.98078528056,Gt=(Fn,mn)=>En(Cb(Fn.x,Fn.y,h,1),Cb(mn.x,mn.y,h,1))<Jt;for(let Fn=0;Fn<zt.length;Fn++)zt[Fn]=Ce(zt[Fn],Gt)}let It,Ft;if(H){const zt=_.getValueAndResolveTokens("text-field",kt,h,ge),Jt=pl.factory(zt);Cse(Jt)&&(this.hasRTLText=!0),(!this.hasRTLText||J0()==="unavailable"||this.hasRTLText&&kd.isParsed())&&(It=Fie(Jt,_,kt))}if(K){const zt=_.getValueAndResolveTokens("icon-image",kt,h,ge);Ft=this.getResolvedImageFromTokens(zt)}const jt=this.layers[0];let Lt=!1;if(!Ft&&re){const zt=jt.getAppearances();for(const Jt of zt)if(Jt.getProperty("icon-image")){const Gt=jt.getAppearanceValueAndResolveTokens(Jt,"icon-image",kt,h,ge);if(Gt){Ft=this.getResolvedImageFromTokens(Gt),Lt=!0;break}}}if(!It&&!Ft)continue;const Dt=this.sortFeaturesByKey?ne.evaluate(kt,{},h):void 0,yt={id:$e,text:It,icon:Ft,index:pt,sourceLayerIndex:Ye,geometry:kt.geometry,properties:Be.properties,type:Sse[Be.type],sortKey:Dt};if(this.features.push(yt),this.featureToAppearanceIndex[pt]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:$e,properties:Be.properties,usesAppearanceIconAsPlaceholder:Lt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Ft){const zt=jt._unevaluatedLayout._values,{iconPrimary:Jt,iconSecondary:Gt}=Yb(Ft,this.iconSizeData,zt["icon-size"],h,this.zoom,yt,this.pixelRatio,V,this.worldview);Ee(Jt),Gt&&(this.hasAnySecondaryIcon=!0,Ee(Gt))}const gt=jt.getAppearances();if(gt.length!==0&&gt.forEach(zt=>{if(!zt.getProperty("icon-image"))return;const Jt=this.getCombinedIconPrimary(zt,jt,kt,h,ge,yt,V);Jt&&Ee(Jt)}),It){const zt=S.evaluate(kt,{},h).join(","),Jt=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(pu.vertical)>=0;for(const Gt of It.sections)if(Gt.image){const Fn=Gt.image.getPrimary().scaleSelf(this.pixelRatio),mn=Fn.id.toString(),xn=ue.get(mn)||[];xn.push(Fn),ue.set(mn,xn)}else{const Fn=K0(It.toString()),mn=Gt.fontStack||zt,xn=he[mn]=he[mn]||{};this.calculateGlyphDependencies(Gt.text,xn,Jt,this.allowVerticalPlacement,Fn)}}}if(y.get("symbol-placement")==="line"&&(this.features=function(Me){const Be={},$e={},pt=[];let Ye=0;function vt(jt){pt.push(Me[jt]),Ye++}function kt(jt,Lt,Dt){const yt=$e[jt];return delete $e[jt],$e[Lt]=yt,pt[yt].geometry[0].pop(),pt[yt].geometry[0]=pt[yt].geometry[0].concat(Dt[0]),yt}function It(jt,Lt,Dt){const yt=Be[Lt];return delete Be[Lt],Be[jt]=yt,pt[yt].geometry[0].shift(),pt[yt].geometry[0]=Dt[0].concat(pt[yt].geometry[0]),yt}function Ft(jt,Lt,Dt){const yt=Dt?Lt[0][Lt[0].length-1]:Lt[0][0];return`${jt}:${yt.x}:${yt.y}`}for(let jt=0;jt<Me.length;jt++){const Lt=Me[jt],Dt=Lt.geometry,yt=Lt.text?Lt.text.toString():null;if(!yt){vt(jt);continue}const gt=Ft(yt,Dt),zt=Ft(yt,Dt,!0);if(gt in $e&&zt in Be&&$e[gt]!==Be[zt]){const Jt=It(gt,zt,Dt),Gt=kt(gt,zt,pt[Jt].geometry);delete Be[gt],delete $e[zt],$e[Ft(yt,pt[Gt].geometry,!0)]=Gt,pt[Jt].geometry=null}else gt in $e?kt(gt,zt,Dt):zt in Be?It(gt,zt,Dt):(vt(jt),Be[gt]=Ye-1,$e[zt]=Ye-1)}return pt.filter(jt=>jt.geometry)}(this.features)),y.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",l.elevationFeatures){!this.elevationFeatures&&l.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Me of l.elevationFeatures)this.elevationFeatureIdToIndex.set(Me.id,this.elevationFeatures.length),this.elevationFeatures.push(Me)}}else y.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Me,Be)=>Me.sortKey-Be.sortKey)}getCombinedIconPrimary(i,l,h,p,_,y,w){let S,R;const O=i.getUnevaluatedProperties();if(O._values["icon-image"].value!==void 0){const D=l.getAppearanceValueAndResolveTokens(i,"icon-image",h,p,_);S=this.getResolvedImageFromTokens(D)}else{const D=l.getValueAndResolveTokens("icon-image",h,p,_);S=this.getResolvedImageFromTokens(D)}if(S){const D=O._values["icon-size"]||l._unevaluatedLayout._values["icon-size"];R=Yb(S,o1(this.zoom,D,this.worldview),D,p,this.zoom,y,this.pixelRatio,w,this.worldview).iconPrimary}return R}updateAppearanceBasedIconTextures(i,l,h,p){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const _=this.layers[0];let y=!1,w=0;const S=_.layout,[R,O]=S.get("icon-size-scale-range"),D=ee(1,R,O);for(let z=0;z<this.symbolInstances.length;z++){const V=this.symbolInstances.get(z),H=this.featureToAppearanceIndex[V.featureIndex],K=H!==void 0?this.appearanceFeatureData[H]:void 0;if(K&&V.placedIconSymbolIndex>=0){const re=K.id,ne=l&&re!==void 0?l[String(re)]:void 0,ue={type:"Point",id:K.id,properties:K.properties,geometry:[]},he=this.layers[0].appearances&&this.layers[0].appearances.find(ge=>ge.isActive({globals:p,feature:ue,canonical:i,featureState:ne}));if(K.activeAppearance===he){w+=V.numIconVertices;continue}if(he){K.activeAppearance=he;const ge=this.getCombinedIconPrimary(he,_,ue,i,h,{sortKey:void 0,text:void 0,icon:null,index:V.featureIndex,sourceLayerIndex:V.featureIndex,geometry:[],properties:K.properties,type:"Point",id:K.id},D);if(!ge)continue;const ke=ge.toString(),Ee=this.iconAtlasPositions&&this.iconAtlasPositions.get(ke);if(Ee){const Me=_.getAppearanceValueAndResolveTokens(he,"icon-offset",ue,i,h),Be=Me&&Array.isArray(Me)?Me:[0,0];let $e=SS(Ee,void 0,Be,_.layout.get("icon-anchor").evaluate(ue,{},i));const pt=_.getAppearanceValueAndResolveTokens(he,"icon-rotate",ue,i,h),Ye=typeof pt=="number"?pt:0,vt=Ee.sdf,kt=_.layout.get("icon-text-fit").constantOr("none");kt!=="none"&&K.textShaping&&K.iconTextFitPadding&&K.fontScale&&($e=t6($e,K.textShaping,kt,K.iconTextFitPadding,Be,K.fontScale));const It=this.calculateEffectiveAppearanceIconSize(he,p.zoom,ue,i,h,D),Ft=0,jt=1+(Math.min(Uf,Math.round(It*Fd))<<1),Lt=s6($e,Ye,vt,kt!=="none",D);K.isUsingAppearanceVertexData||(K.isUsingAppearanceVertexData=!0,K.layoutBasedVertexData=this.icon.getIconVertexData(w,V.numIconVertices));for(let yt=0;yt<Lt.length;++yt){const gt=Lt[yt],zt=K.layoutBasedVertexData[0]||V.tileAnchorX,Jt=K.layoutBasedVertexData[1]||V.tileAnchorY,Gt=16*gt.pixelOffsetTL.x,Fn=16*gt.pixelOffsetTL.y,mn=16*gt.pixelOffsetBR.x,xn=16*gt.pixelOffsetBR.y,Pn=16*gt.minFontScaleX,Yr=16*gt.minFontScaleY;this.icon.updateIconVertexData(w,zt,Jt,Math.round(32*gt.tl.x),Math.round(32*gt.tl.y),gt.texPrimary.x,gt.texPrimary.y,Ft,jt,Gt,Fn,Pn,Yr),this.icon.updateIconVertexData(w+1,zt,Jt,Math.round(32*gt.tr.x),Math.round(32*gt.tr.y),gt.texPrimary.x+gt.texPrimary.w,gt.texPrimary.y,Ft,jt,mn,Fn,Pn,Yr),this.icon.updateIconVertexData(w+2,zt,Jt,Math.round(32*gt.bl.x),Math.round(32*gt.bl.y),gt.texPrimary.x,gt.texPrimary.y+gt.texPrimary.h,Ft,jt,Gt,xn,Pn,Yr),this.icon.updateIconVertexData(w+3,zt,Jt,Math.round(32*gt.br.x),Math.round(32*gt.br.y),gt.texPrimary.x+gt.texPrimary.w,gt.texPrimary.y+gt.texPrimary.h,Ft,jt,mn,xn,Pn,Yr),w+=4}const Dt=V.numIconVertices-4*Lt.length;for(let yt=0;yt<Dt;++yt)this.icon.updateIconVertexData(w+yt,0,0,0,0,0,0,0,0,0,0,0,0);y=!0}else w+=V.numIconVertices}else if(K.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(w,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(w+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(w+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(w+3,0,0,0,0,0,0,0,0,0,0,0,0),y=!0),w+=V.numIconVertices,K.activeAppearance=null;else if(K.isUsingAppearanceVertexData){const ke=K.layoutBasedVertexData.length/12;for(let Ee=0;Ee<ke;++Ee){const Me=Ee*12;this.icon.updateIconVertexData(w+Ee,K.layoutBasedVertexData[Me+0],K.layoutBasedVertexData[Me+1],K.layoutBasedVertexData[Me+2],K.layoutBasedVertexData[Me+3],K.layoutBasedVertexData[Me+4],K.layoutBasedVertexData[Me+5],K.layoutBasedVertexData[Me+6],K.layoutBasedVertexData[Me+7],K.layoutBasedVertexData[Me+8],K.layoutBasedVertexData[Me+9],K.layoutBasedVertexData[Me+10],K.layoutBasedVertexData[Me+11])}w+=ke,K.isUsingAppearanceVertexData=!1,K.activeAppearance=null,y=!0}else w+=V.numIconVertices,K.activeAppearance=null}}return y}update(i,l,h,p,_,y,w){this.text.programConfigurations.updatePaintArrays(i,l,_,h,p,y,w,this.worldview),this.icon.programConfigurations.updatePaintArrays(i,l,_,h,p,y,w,this.worldview)}updateRoadElevation(i){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let l=!1;const h=ae(i),p=1/h;let _=!1,y=!1;for(let w=0;w<this.symbolInstances.length;w++){const S=this.symbolInstances.get(w),R=Nt(1,0,0),O=Nt(0,1,0),{numHorizontalGlyphVertices:D,numVerticalGlyphVertices:z,numIconVertices:V,numVerticalIconVertices:H}=S,K=D>0||z>0,re=V>0,ne=this.elevationFeatures[S.elevationFeatureIndex];if(ne){const ue=new Ve(S.tileAnchorX,S.tileAnchorY),he=.075+ne.pointElevation(ue);S.zOffset!==he&&(l=!0,S.zOffset=he),he!==0&&(this.hasAnyZOffset=!0);const ge=ne.computeSlopeNormal(ue,p),ke=Jn(Ts(),Nt(0,0,1),ge);Xr(R,R,ke),Xr(O,O,ke),R[2]*=h,O[2]*=h,R[0]===1&&R[1]===0&&R[2]===0&&O[0]===0&&O[1]===1&&O[2]===0||(_=_||K,y=y||re)}if(K&&(LS(this.text.orientationVertexArray,D,R,O),LS(this.text.orientationVertexArray,z,R,O)),re){const{placedIconSymbolIndex:ue,verticalPlacedIconSymbolIndex:he}=S;ue>=0&&LS(this.icon.orientationVertexArray,V,R,O),he>=0&&LS(this.icon.orientationVertexArray,H,R,O)}}_||(this.text.orientationVertexArray=void 0),y||(this.icon.orientationVertexArray=void 0),l&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const i=(_,y,w)=>{h+=y,h>_.length&&_.resize(h);for(let S=-y;S<0;S++)_.emplace(S+h,w)},l=(_,y,w)=>{p+=y,p>_.length&&_.resize(p);for(let S=-y;S<0;S++)_.emplace(S+p,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let h=0,p=0;for(let _=0;_<this.symbolInstances.length;_++){const y=this.symbolInstances.get(_),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:S,numIconVertices:R}=y,O=y.zOffset,D=R>0;if((w>0||S>0)&&(i(this.text.zOffsetVertexArray,w,O),i(this.text.zOffsetVertexArray,S,O)),D){const{placedIconSymbolIndex:z,verticalPlacedIconSymbolIndex:V}=y;z>=0&&l(this.icon.zOffsetVertexArray,R,O),V>=0&&l(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,O)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i,l,h,p,_){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(y=>y.appearances&&y.appearances.length>0)),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(i,l,h,p){return!!(i&&l&&h)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(i,l,h,p)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=b7(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const h=this.lineVertexArray.length;if(i.segment!==void 0)for(const{x:p,y:_}of l)this.lineVertexArray.emplaceBack(p,_);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(i,l,h,p,_,y,w,S,R,O,D,z,V,H,K,re,ne,ue){const he=i.indexArray,ge=i.layoutVertexArray,ke=i.globeExtVertexArray,Ee=i.segments.prepareSegment(4*ue,ge,he,this.canOverlap?y.sortKey:void 0),Me=this.glyphOffsetArray.length,Be=Ee.vertexLength,$e=this.allowVerticalPlacement&&w===pu.vertical?Math.PI/2:0,pt=y.text&&y.text.sections;for(let kt=0;kt<l.length;kt++){const{tl:It,tr:Ft,bl:jt,br:Lt,texPrimary:Dt,texSecondary:yt,pixelOffsetTL:gt,pixelOffsetBR:zt,minFontScaleX:Jt,minFontScaleY:Gt,glyphOffset:Fn,isSDF:mn,sectionIndex:xn}=l[kt],Pn=Ee.vertexLength,Yr=Fn[1];if(rw(ge,R.x,R.y,It.x,Yr+It.y,Dt.x,Dt.y,h,mn,gt.x,gt.y,Jt,Gt),rw(ge,R.x,R.y,Ft.x,Yr+Ft.y,Dt.x+Dt.w,Dt.y,h,mn,zt.x,gt.y,Jt,Gt),rw(ge,R.x,R.y,jt.x,Yr+jt.y,Dt.x,Dt.y+Dt.h,h,mn,gt.x,zt.y,Jt,Gt),rw(ge,R.x,R.y,Lt.x,Yr+Lt.y,Dt.x+Dt.w,Dt.y+Dt.h,h,mn,zt.x,zt.y,Jt,Gt),S){const{x:Wt,y:On,z:Rr}=S.anchor,[fi,xi,Fr]=S.up;sw(ke,Wt,On,Rr,fi,xi,Fr),sw(ke,Wt,On,Rr,fi,xi,Fr),sw(ke,Wt,On,Rr,fi,xi,Fr),sw(ke,Wt,On,Rr,fi,xi,Fr),h1(i.dynamicLayoutVertexArray,Wt,On,Rr,$e)}else h1(i.dynamicLayoutVertexArray,R.x,R.y,R.z,$e);if(re){const Wt=yt||Dt;iw(i.iconTransitioningVertexArray,Wt.x,Wt.y),iw(i.iconTransitioningVertexArray,Wt.x+Wt.w,Wt.y),iw(i.iconTransitioningVertexArray,Wt.x,Wt.y+Wt.h),iw(i.iconTransitioningVertexArray,Wt.x+Wt.w,Wt.y+Wt.h)}he.emplaceBack(Pn,Pn+1,Pn+2),he.emplaceBack(Pn+1,Pn+2,Pn+3),Ee.vertexLength+=4,Ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Fn[0]),kt!==l.length-1&&xn===l[kt+1].sectionIndex||i.programConfigurations.populatePaintArrays(ge.length,y,y.index,{},V,H,K,pt&&pt[xn],this.worldview)}const Ye=ue-l.length;Ye!==0&&this._addNullVertices(Ye,ge,h,S,ke,i,re,Ee,he);const vt=S?S.anchor:R;i.placedSymbolArray.emplaceBack(vt.x,vt.y,vt.z,R.x,R.y,Me,this.glyphOffsetArray.length-Me,Be,O,D,R.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],w,0,0,0,z,0),i.symbolInstanceIndices.push(ne)}_addNullVertices(i,l,h,p,_,y,w,S,R){for(let O=0;O<i;O++){for(let z=0;z<4;z++)rw(l,0,0,0,0,0,0,h,!1,0,0,0,0),p&&sw(_,0,0,0,0,0,0),h1(y.dynamicLayoutVertexArray,0,0,0,0),w&&iw(y.iconTransitioningVertexArray,0,0);const D=S.vertexLength;R.emplaceBack(D,D+1,D+2),R.emplaceBack(D+1,D+2,D+3),S.vertexLength+=4,S.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(i,l,h,p,_,y,w){i.emplaceBack(l,h,p,_,y,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(i,l,h,p,_,y,w){const S=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),R=S.vertexLength,O=w.tileAnchorX,D=w.tileAnchorY;for(let V=0;V<4;V++)h.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(h.collisionVertexArrayExt,l,i.padding,w.zOffset),this._commitLayoutVertex(h.layoutVertexArray,p,_,y,O,D,new Ve(i.x1,i.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,_,y,O,D,new Ve(i.x2,i.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,_,y,O,D,new Ve(i.x2,i.y2)),this._commitLayoutVertex(h.layoutVertexArray,p,_,y,O,D,new Ve(i.x1,i.y2)),S.vertexLength+=4;const z=h.indexArray;z.emplaceBack(R,R+1),z.emplaceBack(R+1,R+2),z.emplaceBack(R+2,R+3),z.emplaceBack(R+3,R),S.primitiveLength+=4}_addTextDebugCollisionBoxes(i,l,h,p,_,y){for(let w=p;w<_;w++){const S=h.get(w),R=this.getSymbolInstanceTextSize(i,y,l,w);this._addCollisionDebugVertices(S,R,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(i,l,h,p,_,y){for(let w=p;w<_;w++){const S=h.get(w),R=this.getSymbolInstanceIconSize(i,l,y.placedIconSymbolIndex);this._addCollisionDebugVertices(S,R,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,y)}}generateCollisionDebugBuffers(i,l,h){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new c6(zy,Bz.members,du),this.iconCollisionBox=new c6(zy,Bz.members,du);const p=l1(this.iconSizeData,i),_=l1(this.textSizeData,i,h);for(let y=0;y<this.symbolInstances.length;y++){const w=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(_,i,l,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(_,i,l,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(p,i,l,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(p,i,l,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(i,l,h,p){const _=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:p),y=n6(this.textSizeData,i,_)/mo;return this.tilePixelRatio*y}getSymbolInstanceIconSize(i,l,h){const p=this.icon.placedSymbolArray.get(h),_=n6(this.iconSizeData,i,p);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(i,l,h,p){i.emplaceBack(l,-h,-h,p),i.emplaceBack(l,h,-h,p),i.emplaceBack(l,h,h,p),i.emplaceBack(l,-h,h,p)}_updateTextDebugCollisionBoxes(i,l,h,p,_,y,w){for(let S=p;S<_;S++){const R=h.get(S),O=this.getSymbolInstanceTextSize(i,y,l,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,O,R.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(i,l,h,p,_,y,w){for(let S=p;S<_;S++){const R=h.get(S),O=this.getSymbolInstanceIconSize(i,l,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,O,R.padding,y.zOffset)}}updateCollisionDebugBuffers(i,l,h,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const _=l1(this.iconSizeData,i,p),y=l1(this.textSizeData,i,h);for(let w=0;w<this.symbolInstances.length;w++){const S=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(y,i,l,S.textBoxStartIndex,S.textBoxEndIndex,S,h),this._updateTextDebugCollisionBoxes(y,i,l,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,h),this._updateIconDebugCollisionBoxes(_,i,l,S.iconBoxStartIndex,S.iconBoxEndIndex,S,p),this._updateIconDebugCollisionBoxes(_,i,l,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,l,h,p,_,y,w,S,R){const O={};if(l<h){const{x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge,featureIndex:ke}=i.get(l);O.textBox={x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge},O.textFeatureIndex=ke}if(p<_){const{x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge,featureIndex:ke}=i.get(p);O.verticalTextBox={x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge},O.verticalTextFeatureIndex=ke}if(y<w){const{x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge,featureIndex:ke}=i.get(y);O.iconBox={x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge},O.iconFeatureIndex=ke}if(S<R){const{x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge,featureIndex:ke}=i.get(S);O.verticalIconBox={x1:D,y1:z,x2:V,y2:H,padding:K,projectedAnchorX:re,projectedAnchorY:ne,projectedAnchorZ:ue,tileAnchorX:he,tileAnchorY:ge},O.verticalIconFeatureIndex=ke}return O}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(i,l){const h=i.placedSymbolArray.get(l),p=h.vertexStartIndex+4*h.numGlyphs;for(let _=h.vertexStartIndex;_<p;_+=4)i.indexArray.emplaceBack(_,_+1,_+2),i.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(i),h=Math.cos(i),p=[],_=[],y=[];for(let w=0;w<this.symbolInstances.length;++w){y.push(w);const S=this.symbolInstances.get(w);p.push(0|Math.round(l*S.tileAnchorX+h*S.tileAnchorY)),_.push(S.featureIndex)}return y.sort((w,S)=>p[w]-p[S]||_[S]-_[w]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let i=0;i<this.symbolInstances.length;++i)this.symbolInstanceIndexesSortedZOffset.push(i)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((i,l)=>this.symbolInstances.get(l).zOffset-this.symbolInstances.get(i).zOffset)}addToSortKeyRanges(i,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:R}=h;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&_!==p&&this.addIndicesForPlacedSymbol(this.text,_),y>=0&&y!==_&&y!==p&&this.addIndicesForPlacedSymbol(this.text,y),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(i){const l=this.symbolInstances.get(this.text.symbolInstanceIndices[i]).elevationFeatureIndex;let h;return this.elevationFeatures&&l<this.elevationFeatures.length&&(h=this.elevationFeatures[l]),h}}function w7(c,i){return i.replace(/{([^{}]+)}/g,(l,h)=>h in c?String(c[h]):"")}let T7,E7,d6;An(DS,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),DS.addDynamicAttributes=h1;class S7{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:uc,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}An(S7,"FormatSectionOverride",{omit:["defaultValue"]});const h6=()=>d6||(d6={layout:T7||(T7=new fa({"symbol-placement":new Zt(Ke.layout_symbol["symbol-placement"]),"symbol-spacing":new Zt(Ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Zt(Ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new sn(Ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Zt(Ke.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Zt(Ke.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Zt(Ke.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Zt(Ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Zt(Ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new Zt(Ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Zt(Ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new sn(Ke.layout_symbol["icon-size"]),"icon-size-scale-range":new Zt(Ke.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new sn(Ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new sn(Ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new sn(Ke.layout_symbol["icon-image"]),"icon-image-use-theme":new Zt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new sn(Ke.layout_symbol["icon-rotate"]),"icon-padding":new Zt(Ke.layout_symbol["icon-padding"]),"icon-keep-upright":new Zt(Ke.layout_symbol["icon-keep-upright"]),"icon-offset":new sn(Ke.layout_symbol["icon-offset"]),"icon-anchor":new sn(Ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Zt(Ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Zt(Ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Zt(Ke.layout_symbol["text-rotation-alignment"]),"text-field":new sn(Ke.layout_symbol["text-field"]),"text-font":new sn(Ke.layout_symbol["text-font"]),"text-size":new sn(Ke.layout_symbol["text-size"]),"text-size-scale-range":new Zt(Ke.layout_symbol["text-size-scale-range"]),"text-max-width":new sn(Ke.layout_symbol["text-max-width"]),"text-line-height":new sn(Ke.layout_symbol["text-line-height"]),"text-letter-spacing":new sn(Ke.layout_symbol["text-letter-spacing"]),"text-justify":new sn(Ke.layout_symbol["text-justify"]),"text-radial-offset":new sn(Ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Zt(Ke.layout_symbol["text-variable-anchor"]),"text-anchor":new sn(Ke.layout_symbol["text-anchor"]),"text-max-angle":new Zt(Ke.layout_symbol["text-max-angle"]),"text-writing-mode":new Zt(Ke.layout_symbol["text-writing-mode"]),"text-rotate":new sn(Ke.layout_symbol["text-rotate"]),"text-padding":new Zt(Ke.layout_symbol["text-padding"]),"text-keep-upright":new Zt(Ke.layout_symbol["text-keep-upright"]),"text-transform":new sn(Ke.layout_symbol["text-transform"]),"text-offset":new sn(Ke.layout_symbol["text-offset"]),"text-allow-overlap":new Zt(Ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Zt(Ke.layout_symbol["text-ignore-placement"]),"text-optional":new Zt(Ke.layout_symbol["text-optional"]),visibility:new Zt(Ke.layout_symbol.visibility)})),paint:E7||(E7=new fa({"icon-opacity":new sn(Ke.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new sn(Ke.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new sn(Ke.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new sn(Ke.paint_symbol["text-emissive-strength"]),"icon-color":new sn(Ke.paint_symbol["icon-color"]),"icon-halo-color":new sn(Ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new sn(Ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new sn(Ke.paint_symbol["icon-halo-blur"]),"icon-translate":new Zt(Ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new Zt(Ke.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Zt(Ke.paint_symbol["icon-image-cross-fade"]),"text-opacity":new sn(Ke.paint_symbol["text-opacity"]),"text-occlusion-opacity":new sn(Ke.paint_symbol["text-occlusion-opacity"]),"text-color":new sn(Ke.paint_symbol["text-color"],{runtimeType:Cl,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new sn(Ke.paint_symbol["text-halo-color"]),"text-halo-width":new sn(Ke.paint_symbol["text-halo-width"]),"text-halo-blur":new sn(Ke.paint_symbol["text-halo-blur"]),"text-translate":new Zt(Ke.paint_symbol["text-translate"]),"text-translate-anchor":new Zt(Ke.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Zt(Ke.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Zt(Ke.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Zt(Ke.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Zt(Ke.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new sn(Ke.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"})}))},d6);class NS extends yl{constructor(i,l,h,p){super(i,h6(),l,h,p,i.layout?i.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=q([]),this.hasOcclusionOpacityProperties=i.paint!==void 0&&("icon-occlusion-opacity"in i.paint||"text-occlusion-opacity"in i.paint)}_handleSpecialPaintPropertyUpdate(i){i!=="icon-occlusion-opacity"&&i!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(i,l){super.recalculate(i,l),this.appearances&&this.appearances.forEach(p=>{p.recalculate(i,l,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const p=[];for(const _ of h)p.indexOf(_)<0&&p.push(_);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(i,l,h,p){return this._saturation===i&&this._contrast===l&&this._brightnessMin===h&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(_,y,w,S){_=Is(_),y=li(y);const R=F(),O=_/3,D=1-2*O,z=[D,O,O,0,O,D,O,0,O,O,D,0,0,0,0,1],V=.5-.5*y,H=S-w;return $(R,[H,0,0,0,0,H,0,0,0,0,H,0,w,w,w,1],[y,0,0,0,0,y,0,0,0,0,y,0,V,V,V,1]),$(R,R,z),R}(i,l,h,p),this._saturation=i,this._contrast=l,this._brightnessMin=h,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(i,l,h,p){const _=this.layout.get(i).evaluate(l,{},h,p),y=this._unevaluatedLayout._values[i];return y.isDataDriven()||X0(y.value)||!_?_:w7(l.properties,_)}getAppearanceValueAndResolveTokens(i,l,h,p,_){const y=i.getProperty(l);if(!y)return;const w=y.evaluate(h,{},p,_),S=i.getUnevaluatedProperties()._values[l];return S.isDataDriven()||X0(S.value)||!w||typeof w!="string"?w:w7(h.properties,w)}createBucket(i){return new DS(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of h6().paint.overridableProperties){if(!NS.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),h=new S7(l),p=new vy(h,l.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let _=null;_=l.value.kind==="constant"||l.value.kind==="source"?new Up("source",p):new kf("composite",p,l.value.zoomStops,l.value.interpolationType),this.paint._values[i]=new Rf(l.property,_,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&NS.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const h=i.get("text-field"),p=h6().paint.properties[l];let _=!1;const y=w=>{for(const S of w)if(p.overrides&&p.overrides.hasOverride(S))return void(_=!0)};if(h.value.kind==="constant"&&h.value.value instanceof pl)y(h.value.value.sections);else if(h.value.kind==="source"){const w=R=>{_||(R instanceof wd&&po(R.value)===L0?y(R.value.sections):R instanceof $c?y(R.sections):R.eachChild(w))},S=h.value;S._styleExpression&&w(S._styleExpression.expression)}return _}getProgramIds(){return["symbol"]}getDefaultProgramParams(i,l,h){return{config:new Mh(this,{zoom:l,lut:h}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let A7,C7,k7,I7;var f6=ui([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function zS(c,i,l,h,p,_,y,w){const S=[c,i,1,l,h,1,p,_,1],R=[y,w,1],O=P([],S),[D,z,V]=wr(R,R,O);return L(S,S,[D,0,0,0,z,0,0,0,V])}function R7(c,i,l,h,p,_,y,w){const S=function(R,O,D,z,V,H,K,re){const ne=zS(0,0,1,0,1,1,0,1),ue=zS(R,O,D,z,V,H,K,re);return L(ue,ue,P([],ne))}(c,i,l,h,p,_,y,w);return[S[2]/S[8]/Qt,S[5]/S[8]/Qt]}function FS(c){return[c[0],Math.min(Math.max(c[1],-Y),Y)]}class M7 extends wf{constructor(i,l,h,p){super(),this.id=i,this.dispatcher=h,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=l,this._dirty=!1}load(i,l){if(this._loaded=l||!1,this.fire(new Uc("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return i&&(this.coordinates=i),this._loaded=!0,void this._finishLoading();this._imageRequest=j_(this.map._requestManager.transformRequest(this.url,C0.Image),(h,p)=>{this._imageRequest=null,this._loaded=!0,h?this.fire(new M0(h)):p&&(this.image=p instanceof HTMLImageElement?fo.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}setTexture(i){if(!(i.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new $b(this.map.painter.context,i.handle),this.width=i.dimensions[0],this.height=i.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Uc("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(i){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof $b||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,!i.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let l=i[0][1],h=i[0][1];for(const _ of i)_[1]>h&&(h=_[1]),_[1]<l&&(l=_[1]);const p=(h+l)/2;if(p>Y?this.onNorthPole=!0:p<-Y&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const _=i.map(pe.fromLngLat);this.tileID=function(y){let w=1/0,S=1/0,R=-1/0,O=-1/0;for(const K of y)w=Math.min(w,K.x),S=Math.min(S,K.y),R=Math.max(R,K.x),O=Math.max(O,K.y);const D=Math.max(R-w,O-S),z=Math.max(0,Math.floor(-Math.log2(D))),V=Math.pow(2,z);let H=Math.floor((w+R)/2*V);return H>1&&(H-=1),new _s(z,H,Math.floor((S+O)/2*V))}(_),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Uc("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof $b||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(i){for(const ne in this.tiles){const ue=this.tiles[ne];ue.state!=="loaded"&&(ue.state="loaded",ue.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const l=Qb(new _s(0,0,0),this.map.transform.projection),h=[l.projection.project(this.coordinates[0][0],this.coordinates[0][1]),l.projection.project(this.coordinates[1][0],this.coordinates[1][1]),l.projection.project(this.coordinates[2][0],this.coordinates[2][1]),l.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ne){const ue=ne[1].x-ne[0].x,he=ne[1].y-ne[0].y,ge=ne[2].x-ne[1].x,ke=ne[2].y-ne[1].y,Ee=ne[3].x-ne[2].x,Me=ne[3].y-ne[2].y,Be=ne[0].x-ne[3].x,$e=ne[0].y-ne[3].y,pt=ue*ke-ge*he,Ye=ge*Me-Ee*ke,vt=Ee*$e-Be*Me,kt=Be*he-ue*$e;return pt>0&&Ye>0&&vt>0&&kt>0||pt<0&&Ye<0&&vt<0&&kt<0}(h))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=Qb(this.tileID,this.map.transform.projection),[_,y,w,S]=this.coordinates.map(ne=>{const ue=p.projection.project(ne[0],ne[1]);return g7(p,ue)._round()});this.perspectiveTransform=R7(_.x,_.y,y.x,y.y,w.x,w.y,S.x,S.y);const R=this._boundsArray=new Gp;R.emplaceBack(_.x,_.y,0,0),R.emplaceBack(y.x,y.y,Qt,0),R.emplaceBack(S.x,S.y,0,Qt),R.emplaceBack(w.x,w.y,Qt,Qt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=i.createVertexBuffer(R,f6.members),this.boundsSegments=ta.simpleSegment(0,0,4,2);const O=[],D=[FS((z=this.coordinates)[0]),FS(z[1]),FS(z[2]),FS(z[3])];var z;const[V,H,K,re]=function(ne){let ue=ne[0][0],he=ue,ge=ne[0][1],ke=ge;for(let Ee=1;Ee<ne.length;Ee++)ne[Ee][0]<ue?ue=ne[Ee][0]:ne[Ee][0]>he&&(he=ne[Ee][0]),ne[Ee][1]<ge?ge=ne[Ee][1]:ne[Ee][1]>ke&&(ke=ne[Ee][1]);return[ue,ge,he-ue,ke-ge]}(D);{const ne=new Gp,[ue,he,ge,ke]=function(Lt){let Dt=Lt[0].x,yt=Dt,gt=Lt[0].y,zt=gt;for(let Jt=1;Jt<Lt.length;Jt++)Lt[Jt].x<Dt?Dt=Lt[Jt].x:Lt[Jt].x>yt&&(yt=Lt[Jt].x),Lt[Jt].y<gt?gt=Lt[Jt].y:Lt[Jt].y>zt&&(zt=Lt[Jt].y);return[Dt,gt,yt-Dt,zt-gt]}(h),Ee=Lt=>[(Lt.x-ue)/ge,(Lt.y-he)/ke],[Me,Be,$e,pt]=h.map(Ee),Ye=function(Lt,Dt,yt,gt,zt,Jt,Gt,Fn){const mn=zS(0,0,1,0,1,1,0,1);return L(mn,mn,P([],zS(Lt,Dt,yt,gt,zt,Jt,Gt,Fn)))}(Me[0],Me[1],Be[0],Be[1],$e[0],$e[1],pt[0],pt[1]);this.elevatedGlobePerspectiveTransform=R7(Me[0],Me[1],Be[0],Be[1],$e[0],$e[1],pt[0],pt[1]);const vt=(Lt,Dt)=>{O.push(Lt.lng);const yt=Math.round((Lt.lng-V)/K*Qt),gt=Math.round((Lt.lat-H)/re*Qt),zt=Ee(Dt),Jt=wr([],[zt[0],zt[1],1],Ye),Gt=Math.round(Jt[0]/Jt[2]*Qt),Fn=Math.round(Jt[1]/Jt[2]*Qt);ne.emplaceBack(yt,gt,Gt,Fn)},kt=h[3].x-h[0].x,It=h[3].y-h[0].y,Ft=h[2].x-h[1].x,jt=h[2].y-h[1].y;for(let Lt=0;Lt<65;Lt++){const Dt=Lt/64,yt=[h[0].x+Dt*kt,h[0].y+Dt*It],gt=[h[1].x+Dt*Ft,h[1].y+Dt*jt],zt=gt[0]-yt[0],Jt=gt[1]-yt[1];for(let Gt=0;Gt<65;Gt++){const Fn=Gt/64,mn={x:yt[0]+zt*Fn,y:yt[1]+Jt*Fn};vt(l.projection.unproject(mn.x,mn.y),mn)}}this.elevatedGlobeVertexBuffer=i.createVertexBuffer(ne,f6.members)}{this.maxLongitudeTriangleSize=0;let ne=[],ue=new Wa;const he=(ge,ke,Ee)=>{ue.emplaceBack(ge,ke,Ee);const Me=O[ge],Be=O[ke],$e=O[Ee],pt=Math.min(Math.min(Me,Be),$e),Ye=Math.max(Math.max(Me,Be),$e)-pt;Ye>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ye),ne.push(pt+Ye/2)};for(let ge=0;ge<64;ge++)for(let ke=0;ke<64;ke++){const Ee=65*ge+ke,Me=Ee+1,Be=Ee+65,$e=Be+1;he(Ee,Be,Me),he(Me,Be,$e)}[ne,ue]=function(ge,ke){const Ee=Array.from({length:ge.length},($e,pt)=>pt);Ee.sort(($e,pt)=>ge[$e]-ge[pt]);const Me=[],Be=new Wa;for(let $e=0;$e<Ee.length;$e++){const pt=Ee[$e];Me.push(ge[pt]);const Ye=3*pt,vt=Ye+1;Be.emplaceBack(ke.uint16[Ye],ke.uint16[vt],ke.uint16[vt+1])}return[Me,Be]}(ne,ue),this.elevatedGlobeTrianglesCenterLongitudes=ne,this.elevatedGlobeIndexBuffer=i.createIndexBuffer(ue)}this.elevatedGlobeSegments=ta.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,K/Qt,0,re/Qt,0,0,H,V,0])}prepare(){const i=Object.keys(this.tiles).length!==0;if(this.tileID&&!i)return;const l=this.map.painter.context,h=l.gl;!this._dirty||this.texture instanceof $b||(this.texture?this.texture.update(this.image):(this.texture=new FI(l,this.image,h.RGBA8),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(l)}loadTile(i,l){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},l(null)):(i.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(i){const l=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!l)return null;const h=this.elevatedGlobeTrianglesCenterLongitudes;let p=(_=i+180)+360*Math.round((h[0]-_)/360);var _;const y=new ta,w=(D,z)=>{y.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:l.segments[0].vertexLength,primitiveLength:z,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(h[0]-p)<=S){const D=ji(h,0,h.length,p+S);return D===h.length||w(D,Es(h,D+1,h.length,p+360-S)-D),y}p<h[0]&&(p+=360);const R=Es(h,0,h.length,p-S);if(R===h.length)return w(0,h.length),y;w(0,R-0);const O=ji(h,R+1,h.length,p+S);return O!==h.length&&w(O,h.length-O),y}}const kse=(Math.pow(256,2)-1)/16907520;class P7 extends yl{constructor(i,l,h,p){super(i,{layout:k7||(k7=new fa({visibility:new Zt(Ke.layout_raster.visibility)})),paint:I7||(I7=new fa({"raster-opacity":new Zt(Ke.paint_raster["raster-opacity"]),"raster-color":new Pf(Ke.paint_raster["raster-color"]),"raster-color-mix":new Zt(Ke.paint_raster["raster-color-mix"]),"raster-color-range":new Zt(Ke.paint_raster["raster-color-range"]),"raster-hue-rotate":new Zt(Ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Zt(Ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Zt(Ke.paint_raster["raster-brightness-max"]),"raster-saturation":new Zt(Ke.paint_raster["raster-saturation"]),"raster-contrast":new Zt(Ke.paint_raster["raster-contrast"]),"raster-resampling":new Zt(Ke.paint_raster["raster-resampling"]),"raster-fade-duration":new Zt(Ke.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Zt(Ke.paint_raster["raster-emissive-strength"]),"raster-array-band":new Zt(Ke.paint_raster["raster-array-band"]),"raster-elevation":new Zt(Ke.paint_raster["raster-elevation"]),"raster-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"})}))},l,h,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(i){return!(i&&i._source instanceof M7&&(i._source.onNorthPole||i._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(i){i!=="raster-color"&&i!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(i){if(!this.hasColorMap()||!this._curRampRange)return;const l=this._transitionablePaint._values["raster-color"].value.expression,[h,p]=i||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(h)&&isNaN(p)||h===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=kb({expression:l,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:h,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[h,p])}}let O7,L7,D7,N7,z7;class F7 extends yl{constructor(i,l,h,p){super(i,{layout:O7||(O7=new fa({visibility:new Zt(Ke["layout_raster-particle"].visibility)})),paint:L7||(L7=new fa({"raster-particle-array-band":new Zt(Ke["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Zt(Ke["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Pf(Ke["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Zt(Ke["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Zt(Ke["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Zt(Ke["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Zt(Ke["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Zt(Ke["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"})}))},l,h,p),this._updateColorRamp(),this.lastInvalidatedAt=fo.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(i){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(i){return!1}_handleSpecialPaintPropertyUpdate(i){i!=="raster-particle-color"&&i!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),i==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const i=this._transitionablePaint._values["raster-particle-color"].value.expression,l=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=kb({expression:i,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:l}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=fo.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Ise extends yl{constructor(i,l){super(i,{},l,null),this.implementation=i,i.slot&&(this.slot=i.slot)}is3D(i){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(i){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}function p6(c,i,l){const h=[0,0,1],p=tn([]);return Mr(p,p,l?-Tn(c)+Math.PI:Tn(c)),kn(p,p,-Tn(i)),Xr(h,h,p),Vt(h,h)}const B7={None:0,Model:1,Symbol:2,FillExtrusion:4};class BS{constructor(i,l,h,p){this.message=(i?`${i}: `:"")+h,p&&(this.identifier=p),l!=null&&l.__line__&&(this.line=l.__line__)}}function m6(c,i){const l=c.indexOf("://")===-1;try{return new URL(c,l&&i?"http://example.com":void 0),!0}catch{return!1}}class j7{constructor(i,l){this.feature=i,this.instancedDataOffset=l,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class U7{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new _b,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(i){const l=16*i,h=this.instancedDataArray.float32;let p=Math.floor(h[l+2]);const _=1.05*(h[l+2]-p);return p/=100,[h[l]%1*1.05,h[l+1]%1*1.05,_,p]}tileCoordinatesForInstance(i){const l=16*i,h=this.instancedDataArray.float32;let p=h[l+0];return p=p>Qt?p-Qt:p,new Ve(Math.trunc(p),Math.trunc(h[l+1]))}translationForInstance(i){const l=16*i,h=this.instancedDataArray.float32;return[h[l+4],h[l+5],h[l+6]]}rotationScaleForInstance(i){const l=16*i,h=this.instancedDataArray.float32;return[h[l+7],h[l+8],h[l+9],h[l+10],h[l+11],h[l+12],h[l+13],h[l+14],h[l+15]]}transformForInstance(i){const l=16*i,h=this.instancedDataArray.float32;return[h[l+7],h[l+8],h[l+9],h[l+4],h[l+10],h[l+11],h[l+12],h[l+5],h[l+13],h[l+14],h[l+15],h[l+6],0,0,0,1]}}class g6{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaledZ=this.canonical.z+Math.log2(i.overscaling),this.layers=i.layers,this.layerIds=this.layers.map(l=>l.fqid),this.projection=i.projection,this.index=i.index,this.worldview=i.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=i.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(i,l){}updateAppearances(i,l,h,p){}populate(i,l,h,p){this.tileToMeter=ae(h);const _=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:w,index:S,sourceLayerIndex:R}of i){const O=w??(y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0),D=Xe(y,_);if(!this.layers[0]._featureFilter.filter(new Rs(this.zoom,{worldview:this.worldview,activeFloors:l.activeFloors}),D,h))continue;const z={id:O,sourceLayerIndex:R,index:S,geometry:_?D.geometry:Fe(y,h,p),properties:y.properties,type:y.type,patterns:{}},V=this.addFeature(z,z.geometry,D);V&&l.featureIndex.insert(y,z.geometry,S,R,this.index,this.instancesPerModel[V].instancedDataArray.length,Qt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const i=this.layers[0].modelManager,l=this.layers[0].scope;let h=0;for(const p of this.modelUris){const _=i.getModel(p,l);if(!_)continue;const y=this.instancesPerModel[p];if(y){const w=.5*Cn(_.aabb.max,_.aabb.min)*y.maxScale+y.maxXYTranslationDistance,S=Math.min(Qt,Math.max(w/this.tileToMeter,Qt/32));h=Math.max(S,h)}}return h}update(i,l,h,p){for(const _ in this.instancesPerModel){const y=this.instancesPerModel[_];for(const w in i)y.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(y.features[y.idToFeaturesIndex[w]],i[w],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let i=!1;for(const l in this.instancesPerModel){const h=this.instancesPerModel[l];for(const p of h.features){const _=this.layers[0],y=p.feature,w=this.canonical,S=_.paint.get("model-rotation").evaluate(y,{},w),R=_.paint.get("model-scale").evaluate(y,{},w),O=_.paint.get("model-translation").evaluate(y,{},w);tr(p.rotation,S)&&tr(p.scale,R)&&tr(p.translation,O)||(this.evaluate(p,p.featureStates,h,!0),i=!0)}}return i}updateReplacement(i,l,h,p){if(l.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=l.updateTime;const _=l.getReplacementRegionsForTile(i.toUnwrapped(),!0);if(uS(this.activeReplacements,_))return!1;this.activeReplacements=_;let y=!1;for(const w in this.instancesPerModel){const S=this.instancesPerModel[w],R=S.instancedDataArray;for(const O of S.features){const D=O.instancedDataOffset,z=O.instancedDataCount;for(let V=0;V<z;V++){const H=16*(V+D);let K=R.float32[H+0];const re=K>Qt;K=re?K-Qt:K;const ne=Math.floor(K),ue=Math.floor(R.float32[H+1]);let he=!1;for(const ge of this.activeReplacements)if(!CN(ge,h,B7.Model,p)&&!(ge.min.x>ne||ne>ge.max.x||ge.min.y>ue||ue>ge.max.y)&&(he=PN(MN(ne,ue,i.canonical,ge.footprintTileId.canonical),ge.footprint),he))break;R.float32[H]=he?K+Qt:K,y=y||he!==re}}}return y}isEmpty(){for(const i in this.instancesPerModel)if(this.instancesPerModel[i].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(i){if(!this.uploaded)for(const l in this.instancesPerModel){const h=this.instancesPerModel[l];h.instancedDataArray.length<0||h.instancedDataArray.length===0||(h.instancedDataBuffer?h.instancedDataBuffer.updateData(h.instancedDataArray):h.instancedDataBuffer=i.createVertexBuffer(h.instancedDataArray,Qre.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(i){for(const h in this.instancesPerModel){const p=this.instancesPerModel[h];p.instancedDataArray.length!==0&&p.instancedDataBuffer&&p.instancedDataBuffer.destroy()}const l=this.layers[0].modelManager;if(i&&l&&this.modelUris&&this.modelsRequested)for(const h of this.modelUris)l.removeModel(h,"",!0)}addFeature(i,l,h){const p=this.layers[0],_=p.layout.get("model-id").evaluate(h,{},this.canonical);if(!_)return un(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),_;(m6(_,!1)||this.styleDefinedModelURLs[_]!==void 0)&&(this.modelUris.includes(_)||this.modelUris.push(_)),this.instancesPerModel[_]||(this.instancesPerModel[_]=new U7);const y=this.instancesPerModel[_],w=y.instancedDataArray,S=new j7(h,w.length);for(const R of l)for(const O of R){if(O.x<0||O.x>=Qt||O.y<0||O.y>=Qt)continue;if(this.lookupDim!==0){const z=(this.lookupDim-1)/Qt,V=this.lookupDim*(O.y*z|0)+O.x*z|0;if(this.lookup){if(this.lookup[V]!==0)continue;this.lookup[V]=1}}this.instanceCount++;const D=w.length;w.resize(D+1),y.instancesEvaluatedElevation.push(0),w.float32[16*D]=O.x,w.float32[16*D+1]=O.y}return S.instancedDataCount=y.instancedDataArray.length-S.instancedDataOffset,S.instancedDataCount>0&&(i.id&&(y.idToFeaturesIndex[i.id]=y.features.length),y.features.push(S),this.evaluate(S,{},y,!1)),_}getModelUris(){return this.modelUris}evaluate(i,l,h,p){const _=this.layers[0],y=i.feature,w=this.canonical,S=i.rotation=_.paint.get("model-rotation").evaluate(y,l,w),R=i.scale=_.paint.get("model-scale").evaluate(y,l,w),O=i.translation=_.paint.get("model-translation").evaluate(y,l,w),D=Object.assign({},_.paint.get("model-color").evaluate(y,l,w));D.a=_.paint.get("model-color-mix-intensity").evaluate(y,l,w);const z=[];this.maxVerticalOffset<O[2]&&(this.maxVerticalOffset=O[2]);const V=O[0]*O[0]+O[1]*O[1],H=V>0?Math.sqrt(V):0;h.maxScale=Math.max(Math.max(h.maxScale,R[0]),Math.max(R[1],R[2])),h.maxXYTranslationDistance=Math.max(h.maxXYTranslationDistance,H),this.maxScale=Math.max(Math.max(this.maxScale,R[0]),Math.max(R[1],R[2])),yz(z,S,R);const K=Math.round(100*D.a)+D.b/1.05;for(let re=0;re<i.instancedDataCount;++re){const ne=i.instancedDataOffset+re,ue=16*ne,he=h.instancedDataArray.float32;let ge=0;p&&(ge=he[ue+6]-h.instancesEvaluatedElevation[ne]);const ke=0|he[ue+1];he[ue]=(0|he[ue])+D.r/1.05,he[ue+1]=ke+D.g/1.05,he[ue+2]=K,he[ue+3]=1/(w.z>10?this.tileToMeter:ae(w,ke)),he[ue+4]=O[0],he[ue+5]=O[1],he[ue+6]=O[2]+ge,he[ue+7]=z[0],he[ue+8]=z[1],he[ue+9]=z[2],he[ue+10]=z[4],he[ue+11]=z[5],he[ue+12]=z[6],he[ue+13]=z[8],he[ue+14]=z[9],he[ue+15]=z[10],h.instancesEvaluatedElevation[ne]=O[2]}}}let V7,$7;An(g6,"ModelBucket",{omit:["layers"]}),An(U7,"PerModelAttributes"),An(j7,"ModelFeature");class f1{constructor(i,l,h){this._demTile=i,this._dem=this._demTile.dem,this._scale=l,this._offset=h}static create(i,l,h){const p=h||i.findDEMTileFor(l);if(!p||!p.dem)return;const _=p.dem,y=p.tileID,w=1<<l.canonical.z-y.canonical.z;return new f1(p,_.dim/Qt/w,[(l.canonical.x/w-y.canonical.x)*_.dim,(l.canonical.y/w-y.canonical.y)*_.dim])}tileCoordToPixel(i,l){const h=l*this._scale+this._offset[1];return new Ve(Math.floor(i*this._scale+this._offset[0]),Math.floor(h))}getElevationAt(i,l,h,p){const _=i*this._scale+this._offset[0],y=l*this._scale+this._offset[1],w=Math.floor(_),S=Math.floor(y),R=this._dem;return p=!!p,h?br(br(R.get(w,S,p),R.get(w,S+1,p),y-S),br(R.get(w+1,S,p),R.get(w+1,S+1,p),y-S),_-w):R.get(w,S,p)}getElevationAtPixel(i,l,h){return this._dem.get(i,l,!!h)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*N(1,i)*this._dem.stride}}const _6=new Float32Array(262144),_g=new Uint8Array(262144);function H7(c){let i=0;if(c.meshes)for(const l of c.meshes)i=Math.max(i,l.aabb.max[2]);if(c.children)for(const l of c.children)i=Math.max(i,H7(l));return i}function G7(c,i,l){if(c.meshes)for(const h of c.meshes){if(h.aabb.min[0]===1/0)continue;const p=Dn.applyTransform(h.aabb,c.globalMatrix);l.insert(i,p.min[0],p.min[1],p.max[0],p.max[1])}if(c.children)for(const h of c.children)G7(h,i,l)}const q7=["","wall","door","roof","window","lamp","logo"];class W7{constructor(i){this.node=i,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:i.id,geometry:[],properties:{height:H7(i)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let i=0;const l=new Dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const h of this.node.meshes)this.node.lightMeshIndex!==i&&(h.transformedAabb=Dn.applyTransformFast(h.aabb,this.node.globalMatrix),l.encapsulate(h.transformedAabb)),i++;this.aabb=l}return this.aabb}}class jS{constructor(i,l,h,p,_,y,w,S){this.id=h,this.layers=i,this.layerIds=this.layers.map(R=>R.fqid),this.stateDependentLayerIds=this.layers.filter(R=>R.isStateDependent()).map(R=>R.id),this.modelTraits|=i1.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=i1.HasMapboxMeshFeatures),_&&(this.modelTraits|=i1.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=y,this.worldview=S,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const R of l)this.nodesInfo.push(new W7(R)),G7(R,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(i,l){for(const h of this.getNodesInfo()){const p=h.node;p.footprint&&l.push({footprint:p.footprint,id:i})}}updateAppearances(i,l,h,p){}update(i){const l=Object.keys(i).length!==0;if(l&&!this.stateDependentLayers.length)return;const h=l?this.stateDependentLayers:this.layers;if(!or(i,this.states))for(const p of h)this.evaluate(p,i);this.states=structuredClone(i)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(i){if(!this.needsUpload)return;const l=this.getNodesInfo();for(const h of l){const p=h.node;this.uploaded?this.updatePbrBuffer(p):UI(p,i,!0)}for(const h of l)bS(h.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(i){let l=!1;if(!i.meshes)return l;for(const h of i.meshes)h.pbrBuffer&&(h.pbrBuffer.updateData(h.featureArray),l=!0);return l}needsReEvaluation(i,l,h){const p=i.transform.projectionOptions,_=i.style.getBrightness(),y=this.brightness!==_;if(!this.uploaded||this.dirty||p.name!==this.projection.name||aw(h.paint.get("model-color").value,y)||aw(h.paint.get("model-color-mix-intensity").value,y)||aw(h.paint.get("model-roughness").value,y)||aw(h.paint.get("model-emissive-strength").value,y)||aw(h.paint.get("model-height-based-emissive-strength-multiplier").value,y)){this.projection=p,this.brightness=_;const w=this.getNodesInfo();for(const S of w)S.state=null;return!0}return!1}evaluateTransform(i,l){if(i.transform.zoom===this.zoom)return;this.zoom=i.transform.zoom;const h=this.getNodesInfo(),p=this.id.canonical;for(const _ of h){const y=_.feature;_.evaluatedTranslation=l.paint.get("model-translation").evaluate(y,{},p),_.evaluatedScale=l.paint.get("model-scale").evaluate(y,{},p)}}evaluate(i,l){const h=this.getNodesInfo();for(const p of h){if(!p.node.meshes)continue;const _=p.feature,y=l&&l[_.id];if(or(y,p.state))continue;p.state=structuredClone(y);const w=p.node.meshes&&p.node.meshes[0].featureData,S=p.evaluatedColor[2],R=p.evaluatedRMEA[2],O=this.id.canonical;if(p.hasTranslucentParts=!1,w){for(let D=0;D<q7.length;D++){const z=q7[D];z.length&&(_.properties.part=z);const V=i.paint.get("model-color").evaluate(_,y,O).toPremultipliedRenderColor(null),H=i.paint.get("model-color-mix-intensity").evaluate(_,y,O);p.evaluatedColor[D]=[V.r,V.g,V.b,H],p.evaluatedRMEA[D][0]=i.paint.get("model-roughness").evaluate(_,y,O),p.evaluatedRMEA[D][2]=i.paint.get("model-emissive-strength").evaluate(_,y,O),p.evaluatedRMEA[D][3]=V.a,p.emissionHeightBasedParams[D]=i.paint.get("model-height-based-emissive-strength-multiplier").evaluate(_,y,O),!p.hasTranslucentParts&&V.a<1&&(p.hasTranslucentParts=!0)}delete _.properties.part,Mse(p,S!==p.evaluatedColor[2]||R!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=i.paint.get("model-emissive-strength").evaluate(_,y,O);p.evaluatedTranslation=i.paint.get("model-translation").evaluate(_,y,O),p.evaluatedScale=i.paint.get("model-scale").evaluate(_,y,O),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(i,l,h,p){const _=i.findDEMTileFor(h);if(_&&(_.tileID.canonical!==this.terrainTile||l!==this.terrainExaggeration)){if(_.dem&&_.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=_.tileID.overscaledZ;const y=f1.create(i,h,_);if(!y)return;this.modelTraits&i1.HasMapboxMeshFeatures&&this.updateDEM(i,y,h,p);for(const w of this.getNodesInfo()){const S=w.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const R=S.footprint.vertices;let O=y.getElevationAt(R[0].x,R[0].y,!0,!0);for(let D=1;D<R.length;D++)O=Math.min(O,y.getElevationAt(R[D].x,R[D].y,!0,!0));S.elevation=O}}this.terrainTile=_.tileID.canonical,this.terrainExaggeration=l}}updateDEM(i,l,h,p){let _=l._dem._modifiedForSources[p];if(_===void 0&&(l._dem._modifiedForSources[p]=[],_=l._dem._modifiedForSources[p]),_.includes(h.canonical))return;const y=l._dem.dim;_.push(h.canonical);let w=!1;for(const S of this.getNodesInfo()){const R=S.node;if(!R.footprint||!R.footprint.grid)continue;const O=R.footprint.grid,D=l.tileCoordToPixel(O.min.x,O.min.y),z=l.tileCoordToPixel(O.max.x,O.max.y),V=Math.min(Math.min(y-z.y,D.x),Math.min(D.y,y-z.x));if(V<0)continue;const H=ee(V,2,5);let K=Math.max(0,D.x-H),re=Math.max(0,D.y-H),ne=Math.min(z.x+H,y-1),ue=Math.min(z.y+H,y-1);for(let Ee=re;Ee<=ue;++Ee)for(let Me=K;Me<=ne;++Me)_g[Ee*y+Me]=255;let he=0,ge=0;for(let Ee=0;Ee<O.cellsY;++Ee)for(let Me=0;Me<O.cellsX;++Me){if(!O.cells[Ee*O.cellsX+Me])continue;const Be=l.tileCoordToPixel(O.min.x+Me/O.xScale,O.min.y+Ee/O.yScale),$e=l.tileCoordToPixel(O.min.x+(Me+1)/O.xScale,O.min.y+(Ee+1)/O.yScale);for(let pt=Be.y;pt<=Math.min($e.y+1,y-1);++pt)for(let Ye=Be.x;Ye<=Math.min($e.x+1,y-1);++Ye)_g[pt*y+Ye]===255&&(_g[pt*y+Ye]=0,he+=l.getElevationAtPixel(Ye,pt),ge++)}const ke=he/ge;K=Math.max(1,D.x-H),re=Math.max(1,D.y-H),ne=Math.min(z.x+H,y-2),ue=Math.min(z.y+H,y-2),w=!0;for(let Ee=re;Ee<=ue;++Ee)for(let Me=K;Me<=ne;++Me)_g[Ee*y+Me]===0&&(_6[Ee*y+Me]=l._dem.set(Me,Ee,ke));for(let Ee=1;Ee<H;++Ee){K=Math.max(1,D.x-Ee),re=Math.max(1,D.y-Ee),ne=Math.min(z.x+Ee,y-2),ue=Math.min(z.y+Ee,y-2);for(let Me=re;Me<=ue;++Me)for(let Be=K;Be<=ne;++Be){const $e=Me*y+Be;if(_g[$e]===255){let pt=0,Ye=0,vt=-1,kt=-1;for(let It=-1;It<=1;++It)for(let Ft=-1;Ft<=1;++Ft){const jt=(Me+It)*y+Be+Ft;if(_g[jt]>=Ee)continue;const Lt=_6[jt],Dt=Math.abs(Lt);Dt>Ye&&(pt=Lt,Ye=Dt,vt=Ft,kt=It)}if(Ye>.1){const It=1-(Ee+.5*Math.abs(vt*kt))/H;let Ft=l._dem.get(Be,Me)+pt*It;const jt=l._dem.get(Be+vt,Me+kt),Lt=l._dem.get(Be-vt,Me-kt,!0);(Ft-jt)*(Ft-Lt)>0&&(Ft=(jt+Lt)/2),_6[$e]=l._dem.set(Be,Me,Ft),_g[$e]=Ee}}}}}w&&(l._demTile.needsDEMTextureUpload=!0,l._dem._timestamp=fo.now())}setFilter(i){this.filter=i?ky(i):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(i=>this.filter.filter(new Rs(this.id.overscaledZ,{worldview:this.worldview}),i.feature,this.id.canonical)):this.nodesInfo}destroy(){const i=this.getNodesInfo();for(const l of i)bS(l.node),VI(l.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(i,l){if(l.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=l.updateTime;const h=l.getReplacementRegionsForTile(i.toUnwrapped());for(const p of this.getNodesInfo()){const _=p.node.footprint;p.hiddenByReplacement=!!_&&!h.find(y=>y.footprint===_)}}getHeightAtTileCoord(i,l){const h=[],p=[0,0,0],_=q([]);for(const y of this.getNodesInfo()){const w=y.node.meshes[0],S=w.transformedAabb;if(i<S.min[0]||l<S.min[1]||i>S.max[0]||l>S.max[1])continue;if(y.node.hidden===!0)return{height:1/0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};G(_,y.node.globalMatrix),p[0]=i,p[1]=l,nn(p,p,_);const R=(p[0]-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*pg|0,O=Math.min(63,(p[1]-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*pg|0)*pg+Math.min(63,R),D=w.heightmap[O];if(!(D<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:D,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new Ve(i,l),new Ve(i,l),h),h.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function aw(c,i){return c instanceof Up&&!c.isLightConstant&&i}function Rse(c,i,l,h,p,_,y,w){let S=(61440&i|(61440&i)>>4)>>8,R=(3840&i|(3840&i)>>4)>>4,O=240&i|(240&i)>>4;l[3]>0&&(S=br(S,255*l[0],l[3]),R=br(R,255*l[1],l[3]),O=br(O,255*l[2],l[3]));const D=S<<8|R,z=O<<8|Math.floor(255*h[3]),V=function(Ee){const Me=ee(Ee,0,2);return Math.min(Math.round(.5*Me*255),255)}(h[2])<<8|15*h[0]<<4|15*h[1],H=ee(p[0],0,1),K=ee(p[1],0,1),re=ee(p[2],0,1),ne=ee(p[3],0,1);let ue,he,ge,ke;if(H!==K&&y!==_&&K!==H){const Ee=y-_;he=1/(Ee*(K-H)),ge=-(_+Ee*H)/(Ee*(K-H));const Me=ee(p[4],-1,1);ke=Math.pow(10,Me),ue=255*re<<8|255*ne}else ue=65535,he=0,ge=1,ke=1;if(c.emplaceBack(D,z,V,ue,he,ge,ke),w){const Ee=w.length;w.clear();for(let Me=0;Me<Ee;Me++)w.emplaceBack(D,z,V,ue,he,ge,ke)}}function Mse(c,i,l){const h=c.node;let p=0;const _=l&i1.HasMeshoptCompression;for(const y of h.meshes){if(h.lights&&h.lightMeshIndex===p||!y.featureData)continue;y.featureArray=new By,y.featureArray.reserve(y.featureData.length);let w=i;for(const S of y.featureData){const R=_?65535&S:S>>16&65535,O=_?S>>16&65535:65535&S,D=(15&O)<8?15&O:0,z=c.evaluatedRMEA[D],V=c.evaluatedColor[D],H=c.emissionHeightBasedParams[D];let K;if(w&&D===2&&h.lights&&(K=new By,K.resize(10*h.lights.length)),Rse(y.featureArray,R,V,z,H,y.aabb.min[2],y.aabb.max[2],K),K&&w){w=!1;const re=h.meshes[h.lightMeshIndex];re.featureArray=K,re.featureArray._trim()}}y.featureArray._trim(),p++}}An(jS,"Tiled3dModelBucket",{omit:["layers"]}),An(W7,"Tiled3dModelFeature");const Pse=["id","tile","layer","source","sourceLayer","state"];class yg{constructor(i,l,h,p,_){this.type="Feature",this._vectorTileFeature=i,this._z=l,this._x=h,this._y=p,this.properties=i?i.properties:{},this.id=_}clone(){const i=new yg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(i.state=Object.assign({},this.state)),this.layer&&(i.layer=Object.assign({},this.layer)),this.source&&(i.source=this.source),this.sourceLayer&&(i.sourceLayer=this.sourceLayer),i}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const l of Pse)this[l]!==void 0&&(i[l]=this[l]);return i}}class vg extends wf{constructor(i,l,h,p){super(),this.id=i,this.type="model",this.models=[],this._loaded=!1,this._options=l,this._modelsInfo=new Map}load(){const i=[];for(const l in this._options.models){const h=this._options.models[l],p=this._modelsInfo.get(l);if(p){const _=p.model;_.position=h.position!=null?new d(h.position[0],h.position[1]):new d(0,0),_.orientation=h.orientation!=null?h.orientation:[0,0,0],p.modelSpec=h,vg.applyModelSpecification(_,h),_.computeBoundsAndApplyParent(),this.models.push(_)}else{const _=pz(this.map._requestManager.transformRequest(h.uri,C0.Model).url).then(y=>{if(!y)return;const w=HI(y),S=new vz(l,h.uri,h.position,h.orientation,w);vg.applyModelSpecification(S,h),S.computeBoundsAndApplyParent(),this.models.push(S),this._modelsInfo.set(l,{modelSpec:h,model:S})}).catch(y=>{this.fire(new M0(new Error(`Could not load model ${l} from ${h.uri}: ${y.message}`)))});i.push(_)}}Promise.allSettled(i).then(()=>{this._loaded=!0,this.fire(new Uc("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(l=>{this._loaded=!0,this.fire(new M0(new Error(`Could not load models: ${l.message}`)))})}static applyModelSpecification(i,l){l.nodeOverrides&&vg.convertNodeOverrides(i,l.nodeOverrides),l.materialOverrides&&vg.convertMaterialOverrides(i,l.materialOverrides),l.nodeOverrideNames&&(i.nodeOverrideNames=[...l.nodeOverrideNames]),l.materialOverrideNames&&(i.materialOverrideNames=[...l.materialOverrideNames]),l.featureProperties&&(i.featureProperties=l.featureProperties)}static convertNodeOverrides(i,l){if(Array.isArray(l)&&l.every(h=>typeof h=="string")){i.nodeOverrideNames=[];for(const h of l)i.nodeOverrideNames.push(h)}else Object.entries(l).forEach(([h,p])=>{const _={orientation:[0,0,0]};if(p.hasOwnProperty("orientation")){const y=p.orientation;y&&(_.orientation=y)}i.nodeOverrides.set(h,_)})}static convertMaterialOverrides(i,l){if(Array.isArray(l)&&l.every(h=>typeof h=="string")){i.materialOverrideNames=[];for(const h of l)i.materialOverrideNames.push(h)}else Object.entries(l).forEach(([h,p])=>{const _={color:new Yi(1,1,1),colorMix:0,emissionStrength:0,opacity:1},y=p["model-color"];y!==void 0&&(_.color.r=y[0],_.color.g=y[1],_.color.b=y[2]);const w=p["model-color-mix-intensity"];w!==void 0&&(_.colorMix=w);const S=p["model-emissive-strength"];S!==void 0&&(_.emissionStrength=S);const R=p["model-opacity"];R!==void 0&&(_.opacity=R),i.materialOverrides.set(h,_)})}onAdd(i){this.map=i,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(i,l){}serialize(){return this._options}setProperty(i,l){return!1}reload(){const i=fc(this.id,this.scope);this.map.style.clearSource(i),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(i){this.models=[];const l=new Map;for(const h in i){const p=i[h];if(this._modelsInfo.has(h)){const _=this._modelsInfo.get(h);_&&_.modelSpec.uri===p.uri&&l.set(h,_)}}this._modelsInfo=l,this._options.models=i,this._loaded=!1,this.load()}}function y6(c,i,l,h){const p=1<<c.z;i.lat=Z((h/Qt+c.y)/p),i.lng=j((l/Qt+c.x)/p)}function Ose(c,i,l,h){const p=c.getNodesInfo()[i];if(!p||p.hiddenByReplacement||!p.node.meshes)return;let _=Number.MAX_VALUE;const y=p.node,w=l.tile,S=h.calculatePosMatrix(w.tileID.toUnwrapped(),h.worldSize),R=p.evaluatedScale;let O=0;h.elevation&&y.elevation&&(O=y.elevation*h.elevation.exaggeration()),X(S,S,[(y.anchor?y.anchor[0]:0)*(R[0]-1),(y.anchor?y.anchor[1]:0)*(R[1]-1),O]),ie(S,S,R);const D=l.queryGeometry,z=D.isPointQuery()?D.screenBounds:D.screenGeometry,V=function(K){const re=$([],S,K.globalMatrix);$(re,h.expandedFarZProjMatrix,re);for(let ne=0;ne<K.meshes.length;++ne){const ue=K.meshes[ne];if(ne===K.lightMeshIndex)continue;const he=jI(z,h,re,ue.aabb);he!=null&&(_=Math.min(he,_))}if(K.children)for(const ne of K.children)V(ne)};if(V(y),_===Number.MAX_VALUE)return;const H=new d(0,0);return y6(w.tileID.canonical,H,p.node.anchor[0],p.node.anchor[1]),{intersectionZ:_,position:H,feature:p.feature}}const Lse={circle:class extends yl{constructor(c,i,l,h){super(c,{layout:Rl||(Rl=new fa({"circle-sort-key":new sn(Ke.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Zt(Ke.layout_circle["circle-elevation-reference"]),visibility:new Zt(Ke.layout_circle.visibility)})),paint:pa||(pa=new fa({"circle-radius":new sn(Ke.paint_circle["circle-radius"]),"circle-color":new sn(Ke.paint_circle["circle-color"]),"circle-blur":new sn(Ke.paint_circle["circle-blur"]),"circle-opacity":new sn(Ke.paint_circle["circle-opacity"]),"circle-translate":new Zt(Ke.paint_circle["circle-translate"]),"circle-translate-anchor":new Zt(Ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Zt(Ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Zt(Ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new sn(Ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new sn(Ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new sn(Ke.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Zt(Ke.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h)}createBucket(c){return new Ki(c)}queryRadius(c){const i=c;return Qo("circle-radius",this,i)+Qo("circle-stroke-width",this,i)+Po(this.paint.get("circle-translate"))}queryIntersectsFeature(c,i,l,h,p,_,y,w){const S=ju(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,c.pixelToTileUnitsFactor),R=this.paint.get("circle-radius").evaluate(i,l)+this.paint.get("circle-stroke-width").evaluate(i,l);return eN(c,h,_,y,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,R)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,i,l){const h=JD(this);return{config:new Mh(this,{zoom:i,lut:l}),defines:h,overrideFog:!1}}is3D(c){return!c&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends yl{createBucket(c){return new nN(c)}constructor(c,i,l,h){super(c,{layout:rN||(rN=new fa({visibility:new Zt(Ke.layout_heatmap.visibility)})),paint:iN||(iN=new fa({"heatmap-radius":new sn(Ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new sn(Ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Zt(Ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Pf(Ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Zt(Ke.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=kb({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(c){return Qo("heatmap-radius",this,c)}queryIntersectsFeature(c,i,l,h,p,_,y,w){const S=this.paint.get("heatmap-radius").evaluate(i,l);return eN(c,h,_,y,w,!0,!0,new Ve(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,i,l){return c==="heatmap"?{config:new Mh(this,{zoom:i,lut:l}),overrideFog:!1}:{}}},hillshade:class extends yl{constructor(c,i,l,h){super(c,{layout:sN||(sN=new fa({visibility:new Zt(Ke.layout_hillshade.visibility)})),paint:aN||(aN=new fa({"hillshade-illumination-direction":new Zt(Ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Zt(Ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Zt(Ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Zt(Ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Zt(Ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Zt(Ke.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Zt(Ke.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,i,l){return{overrideFog:!1}}},fill:class extends yl{constructor(c,i,l,h){super(c,{layout:bN||(bN=new fa({"fill-sort-key":new sn(Ke.layout_fill["fill-sort-key"]),visibility:new Zt(Ke.layout_fill.visibility),"fill-elevation-reference":new Zt(Ke.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new sn(Ke.layout_fill["fill-construct-bridge-guard-rail"])})),paint:wN||(wN=new fa({"fill-antialias":new Zt(Ke.paint_fill["fill-antialias"]),"fill-opacity":new sn(Ke.paint_fill["fill-opacity"]),"fill-color":new sn(Ke.paint_fill["fill-color"]),"fill-outline-color":new sn(Ke.paint_fill["fill-outline-color"]),"fill-translate":new Zt(Ke.paint_fill["fill-translate"]),"fill-translate-anchor":new Zt(Ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new sn(Ke.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Zt(Ke.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Zt(Ke.paint_fill["fill-emissive-strength"]),"fill-z-offset":new sn(Ke.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new sn(Ke.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new sn(Ke.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h)}getProgramIds(){const c=this.paint.get("fill-pattern"),i=c&&c.constantOr(1),l=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getDefaultProgramParams(c,i,l){return{config:new Mh(this,{zoom:i,lut:l}),overrideFog:!1}}recalculate(c,i){super.recalculate(c,i);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new TI(c)}queryRadius(){return Po(this.paint.get("fill-translate"))}queryIntersectsFeature(c,i,l,h,p,_){return!c.queryGeometry.isAboveHorizon&&Ui(hu(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,c.pixelToTileUnitsFactor),h)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(c){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const i=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return c!=null?i&&!c:i}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends yl{constructor(c,i,l,h){super(c,{layout:ZN||(ZN=new fa({visibility:new Zt(Ke["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Zt(Ke["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:XN||(XN=new fa({"fill-extrusion-opacity":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new sn(Ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sn(Ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new sn(Ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new sn(Ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new sn(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new sn(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new sn(Ke["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new sn(Ke["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Zt(Ke["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new dS(c)}queryRadius(){return Po(this.paint.get("fill-extrusion-translate"))}is3D(c){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,i,l,h,p,_,y,w,S){const R=ju(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,c.pixelToTileUnitsFactor),O=this.paint.get("fill-extrusion-height").evaluate(i,l),D=this.paint.get("fill-extrusion-base").evaluate(i,l),z=[0,0],V=w&&_.elevation,H=_.elevation?_.elevation.exaggeration():1,K=c.tile.getBucket(this);if(V&&K instanceof dS){const ge=K.centroidVertexArray,ke=S+1;ke<ge.length&&(z[0]=ge.geta_centroid_pos0(ke),z[1]=ge.geta_centroid_pos1(ke))}if(z[0]===0&&z[1]===1)return!1;_.projection.name==="globe"&&(h=WN([h],[new Ve(0,0),new Ve(Qt,Qt)],c.tileID.canonical).map(ge=>ge.polygon).flat());const re=V?w:null,[ne,ue]=nz(_,h,D,O,R,y,re,z,H,_.center.lat,c.tileID.canonical),he=c.queryGeometry;return tz(ne,ue,he.isPointQuery()?he.screenBounds:he.screenGeometry)}},building:class extends yl{constructor(c,i,l,h){super(c,{layout:Az||(Az=new fa({visibility:new Zt(Ke.layout_building.visibility),"building-facade":new sn(Ke.layout_building["building-facade"]),"building-facade-floors":new sn(Ke.layout_building["building-facade-floors"]),"building-facade-unit-width":new sn(Ke.layout_building["building-facade-unit-width"]),"building-facade-window":new sn(Ke.layout_building["building-facade-window"]),"building-roof-shape":new sn(Ke.layout_building["building-roof-shape"]),"building-height":new sn(Ke.layout_building["building-height"]),"building-base":new sn(Ke.layout_building["building-base"]),"building-flood-light-wall-radius":new sn(Ke.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new sn(Ke.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new sn(Ke.layout_building["building-flip-roof-orientation"])})),paint:Cz||(Cz=new fa({"building-opacity":new Zt(Ke.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Zt(Ke.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Zt(Ke.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Zt(Ke.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Zt(Ke.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Zt(Ke.paint_building["building-vertical-scale"]),"building-cast-shadows":new Zt(Ke.paint_building["building-cast-shadows"]),"building-color":new sn(Ke.paint_building["building-color"]),"building-emissive-strength":new sn(Ke.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Zt(Ke.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Zt(Ke.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Zt(Ke.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Zt(Ke.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Zt(Ke.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new Sz(c)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(c){return!0}queryRadius(c){return 0}queryIntersectsFeature(c,i,l,h,p,_,y,w,S){let R=this.layout.get("building-height").evaluate(i,l);const O=this.layout.get("building-base").evaluate(i,l),D=c.tile.getBucket(this).getFootprint(i);if(D){if(D.hiddenFlags!==0)return!1;R=D.height}const[z,V]=nz(_,h,O,R,new Ve(0,0),y,null,[0,0],1,_.center.lat,c.tileID.canonical),H=c.queryGeometry;return tz(z,V,H.isPointQuery()?H.screenBounds:H.screenGeometry)}},line:class extends yl{constructor(c,i,l,h){const p=zz();super(c,p,i,l,h),p.layout&&(this.layout=new Mf(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof $0,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(c,i){super.recalculate(c,i),this.paint._values["line-floorwidth"]=(()=>{if(Gb)return Gb;const l=zz();return Gb=new kie(l.paint.properties["line-width"].specification),Gb.useIntegerZoom=!0,Gb})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new WI(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,i,l){const h=Dz(this);return{config:new Mh(this,{zoom:i,lut:l}),defines:h,overrideFog:!1}}queryRadius(c){const i=c,l=Fz(Qo("line-width",this,i),Qo("line-gap-width",this,i)),h=Qo("line-offset",this,i);return l/2+Math.abs(h)+Po(this.paint.get("line-translate"))}queryIntersectsFeature(c,i,l,h,p,_){if(c.queryGeometry.isAboveHorizon)return!1;const y=hu(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,c.pixelToTileUnitsFactor),w=c.pixelToTileUnitsFactor/2*Fz(this.paint.get("line-width").evaluate(i,l),this.paint.get("line-gap-width").evaluate(i,l)),S=this.paint.get("line-offset").evaluate(i,l);return S&&(h=function(R,O){const D=[],z=new Ve(0,0);for(let V=0;V<R.length;V++){const H=R[V],K=[];for(let re=0;re<H.length;re++){const ne=H[re],ue=H[re+1],he=re===0?z:ne.sub(H[re-1])._unit()._perp(),ge=re===H.length-1?z:ue.sub(ne)._unit()._perp(),ke=he._add(ge)._unit();ke._mult(1/(ke.x*ge.x+ke.y*ge.y)),K.push(ke._mult(O)._add(ne))}D.push(K)}return D}(h,S*c.pixelToTileUnitsFactor)),function(R,O,D){for(let z=0;z<O.length;z++){const V=O[z];if(R.length>=3){for(let H=0;H<V.length;H++)if(gs(R,V[H]))return!0}if(aa(R,V,D))return!0}return!1}(y,h,w)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(c){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:NS,background:class extends yl{constructor(c,i,l,h){super(c,{layout:A7||(A7=new fa({visibility:new Zt(Ke.layout_background.visibility)})),paint:C7||(C7=new fa({"background-pitch-alignment":new Zt(Ke.paint_background["background-pitch-alignment"]),"background-color":new Zt(Ke.paint_background["background-color"]),"background-pattern":new Zt(Ke.paint_background["background-pattern"]),"background-opacity":new Zt(Ke.paint_background["background-opacity"]),"background-emissive-strength":new Zt(Ke.paint_background["background-emissive-strength"]),"background-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,i,l){return{overrideFog:!1}}is3D(c){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:P7,"raster-particle":F7,sky:class extends yl{constructor(c,i,l,h){super(c,{layout:D7||(D7=new fa({visibility:new Zt(Ke.layout_sky.visibility)})),paint:N7||(N7=new fa({"sky-type":new Zt(Ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new Zt(Ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Zt(Ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Zt(Ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Zt(Ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new Pf(Ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Zt(Ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Zt(Ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Zt(Ke.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=kb({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(c,i){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),p=!h,_=c.style.light,y=_.properties.get("position");return p&&_.properties.get("anchor")==="viewport"&&un("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?p6(y.azimuthal,90-y.polar,i):p6(h[0],90-h[1],i)}const l=this.paint.get("sky-gradient-center");return p6(l[0],90-l[1],i)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends yl{constructor(c,i,l,h){super(c,{paint:z7||(z7=new fa({}))},i,null)}},model:class extends yl{constructor(c,i,l,h){super(c,{layout:V7||(V7=new fa({visibility:new Zt(Ke.layout_model.visibility),"model-id":new sn(Ke.layout_model["model-id"])})),paint:$7||($7=new fa({"model-opacity":new sn(Ke.paint_model["model-opacity"]),"model-rotation":new sn(Ke.paint_model["model-rotation"]),"model-scale":new sn(Ke.paint_model["model-scale"]),"model-translation":new sn(Ke.paint_model["model-translation"]),"model-color":new sn(Ke.paint_model["model-color"]),"model-color-mix-intensity":new sn(Ke.paint_model["model-color-mix-intensity"]),"model-type":new Zt(Ke.paint_model["model-type"]),"model-cast-shadows":new Zt(Ke.paint_model["model-cast-shadows"]),"model-receive-shadows":new Zt(Ke.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Zt(Ke.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new sn(Ke.paint_model["model-emissive-strength"]),"model-roughness":new sn(Ke.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new sn(Ke.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Zt(Ke.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Zt(Ke.paint_model["model-front-cutoff"]),"model-elevation-reference":new Zt(Ke.paint_model["model-elevation-reference"]),"model-color-use-theme":new sn({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h),this.layer=c,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new g6(c)}getProgramIds(){return["model"]}is3D(c){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof jS?Qt-1:0}queryRenderedFeatures(c,i,l){const h=i.getSource();if(!(h&&h instanceof vg))return{};const p=h,_={};_[this.id]=[];const y=_[this.id];let w=0;for(const S of p.models){const R=i.getFeatureState(this.sourceLayer,S.id),O={type:"Unknown",id:S.id,properties:S.featureProperties},D=this.paint.get("model-rotation").evaluate(O,R),z=this.paint.get("model-scale").evaluate(O,R),V=this.paint.get("model-translation").evaluate(O,R),H=this.paint.get("model-elevation-reference");let K=[];xS(K,S,l,S.position,D,z,V,H==="ground",H==="ground",!1),l.projection.name==="globe"&&(K=vS(K,l));const re=$([],l.projMatrix,K),ne=jI(c.isPointQuery()?c.screenBounds:c.screenGeometry,l,re,S.aabb);if(ne!=null){const ue=new yg(void 0,0,0,0,S.id);ue.layer=this.layer,ue.properties=structuredClone(S.featureProperties),ue.properties.layer=this.id,ue.properties.uri=S.uri,ue.properties.orientation=S.orientation,ue.sourceLayer=this.sourceLayer,ue.geometry={type:"Point",coordinates:[S.position.lng,S.position.lat]},ue.state=R,ue.source=this.source,y.push({featureIndex:w,feature:ue,intersectionZ:ne})}++w}return _}queryIntersectsFeature(c,i,l,h,p,_){if(!this.modelManager)return!1;const y=this.modelManager,w=c.tile.getBucket(this);if(!(w&&w instanceof g6))return!1;for(const S in w.instancesPerModel){const R=w.instancesPerModel[S],O=i.id!==void 0?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(R.idToFeaturesIndex.hasOwnProperty(O)){const D=R.features[R.idToFeaturesIndex[O]],z=y.getModel(S,this.scope);if(!z)return!1;let V=[];const H=new d(0,0),K=w.canonical;let re=Number.MAX_VALUE;for(let ne=0;ne<D.instancedDataCount;++ne){const ue=16*(D.instancedDataOffset+ne),he=R.instancedDataArray.float32,ge=[he[ue+4],he[ue+5],he[ue+6]];y6(K,H,Math.floor(he[ue]),Math.floor(he[ue+1])),xS(V,z,_,H,D.rotation,D.scale,ge,!1,!1,!1),_.projection.name==="globe"&&(V=vS(V,_));const ke=$([],_.projMatrix,V),Ee=c.queryGeometry,Me=jI(Ee.isPointQuery()?Ee.screenBounds:Ee.screenGeometry,_,ke,z.aabb);Me!=null&&(re=Math.min(Me,re))}return re!==Number.MAX_VALUE&&re}}return!1}_handleOverridablePaintPropertyUpdate(c,i,l){return!(!this.layout||i.isDataDriven()||l.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const i=this._transitionablePaint._values[c];return i!=null&&i.value!=null&&i.value.expression!=null&&i.value.expression instanceof kf}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends yl{constructor(c,i,l,h){super(c,{layout:TN||(TN=new fa({"clip-layer-types":new Zt(Ke.layout_clip["clip-layer-types"]),"clip-layer-scope":new Zt(Ke.layout_clip["clip-layer-scope"])})),paint:EN||(EN=new fa({}))},i,l,h)}recalculate(c,i){super.recalculate(c,i)}createBucket(c){return new SN(c)}is3D(c){return!0}}},v6=new Yi(0,0,0),x6={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},b6={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},US={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},Dse={PAINT_ORDER_FILL_AND_STROKE:1},ow={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},Z7={MASK_TYPE_LUMINANCE:1};function Nse(c,i,l){c===1&&i.icons.push(function(h,p){return function(_){if(_.usvg_tree.height||(_.usvg_tree.height=_.usvg_tree.width),!_.metadata)return _;const{metadata:y}=_;if(y.content_area){const{content_area:w}=y;w.left==null&&(w.left=0),w.top==null&&(w.top=w.left),w.width==null&&(w.width=_.usvg_tree.width),w.height==null&&(w.height=w.width)}if(y.text_placeholder){const{text_placeholder:w}=y;w.top==null&&(w.top=w.left),w.height==null&&(w.height=w.width)}return y.stretch_x&&y.stretch_x.length&&X7(y,"x"),y.stretch_y&&y.stretch_y.length&&X7(y,"y"),_}(h.readFields(zse,{name:void 0},p))}(l,l.readVarint()+l.pos))}function X7(c,i){const l=[],h=c[`stretch_${i}`];let p=null;for(let _=0;_<h.length;_++)p===null?p=l.length===0?h[0]:l[l.length-1][1]+h[_]:(l.push([p,p+h[_]]),p=null);c[`stretch_${i}_areas`]=l}function zse(c,i,l){c===1?i.name=l.readString():c===2?i.metadata=function(h,p){return h.readFields(Fse,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)}(l,l.readVarint()+l.pos):c===3&&(i.usvg_tree=function(h,p){return h.readFields(Use,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)}(l,l.readVarint()+l.pos),i.data="usvg_tree")}function Fse(c,i,l){c===1?i.stretch_x=l.readPackedVarint():c===2?i.stretch_y=l.readPackedVarint():c===3?i.content_area=Y7(l,l.readVarint()+l.pos):c===4?i.variables.push(function(h,p){return h.readFields(jse,{name:void 0},p)}(l,l.readVarint()+l.pos)):c===5&&(i.text_placeholder=Y7(l,l.readVarint()+l.pos))}function Y7(c,i){return c.readFields(Bse,{},i)}function Bse(c,i,l){c===1?i.left=l.readVarint():c===2?i.width=l.readVarint():c===3?i.top=l.readVarint():c===4&&(i.height=l.readVarint())}function jse(c,i,l){c===1?i.name=l.readString():c===2&&(i.rgb_color=HS(l.readVarint()),i.value="rgb_color")}function Use(c,i,l){c===1?i.width=i.height=l.readVarint():c===2?i.height=l.readVarint():c===3?i.children.push(VS(l,l.readVarint()+l.pos)):c===4?i.linear_gradients.push(function(h,p){return h.readFields(Zse,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)}(l,l.readVarint()+l.pos)):c===5?i.radial_gradients.push(function(h,p){return h.readFields(Yse,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)}(l,l.readVarint()+l.pos)):c===7?i.clip_paths.push(function(h,p){return h.readFields(Kse,{children:[]},p)}(l,l.readVarint()+l.pos)):c===8&&i.masks.push(function(h,p){const _=h.readFields(Qse,{left:0,width:20,mask_type:Z7.MASK_TYPE_LUMINANCE,children:[]},p);return _.height==null&&(_.height=_.width),_.top==null&&(_.top=_.left),_}(l,l.readVarint()+l.pos))}function VS(c,i){return c.readFields(Vse,{},i)}function Vse(c,i,l){c===1?(i.group=function(h,p){return h.readFields($se,{opacity:255,children:[]},p)}(l,l.readVarint()+l.pos),i.node="group"):c===2&&(i.path=function(h,p){return h.readFields(Gse,{paint_order:1,commands:[],step:1,diffs:[],rule:x6.PATH_RULE_NON_ZERO},p)}(l,l.readVarint()+l.pos),i.node="path")}function $se(c,i,l){c===1?i.transform=$S(l,l.readVarint()+l.pos):c===2?i.opacity=l.readVarint():c===5?i.clip_path_idx=l.readVarint():c===6?i.mask_idx=l.readVarint():c===7&&i.children.push(VS(l,l.readVarint()+l.pos))}function $S(c,i){return c.readFields(Hse,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},i)}function Hse(c,i,l){c===1?i.sx=l.readFloat():c===2?i.ky=l.readFloat():c===3?i.kx=l.readFloat():c===4?i.sy=l.readFloat():c===5?i.tx=l.readFloat():c===6&&(i.ty=l.readFloat())}function Gse(c,i,l){c===1?i.fill=function(h,p){return h.readFields(qse,{rgb_color:v6,paint:"rgb_color",opacity:255},p)}(l,l.readVarint()+l.pos):c===2?i.stroke=function(h,p){return h.readFields(Wse,{rgb_color:v6,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)}(l,l.readVarint()+l.pos):c===3?i.paint_order=l.readVarint():c===5?l.readPackedVarint(i.commands):c===6?i.step=l.readFloat():c===7?l.readPackedSVarint(i.diffs):c===8&&(i.rule=l.readVarint())}function qse(c,i,l){c===1?(i.rgb_color=HS(l.readVarint()),i.paint="rgb_color"):c===2?(i.linear_gradient_idx=l.readVarint(),i.paint="linear_gradient_idx"):c===3?(i.radial_gradient_idx=l.readVarint(),i.paint="radial_gradient_idx"):c===5&&(i.opacity=l.readVarint())}function HS(c){return new Yi((c>>16&255)/255,(c>>8&255)/255,(255&c)/255,1)}function Wse(c,i,l){c===1?(i.rgb_color=HS(l.readVarint()),i.paint="rgb_color"):c===2?(i.linear_gradient_idx=l.readVarint(),i.paint="linear_gradient_idx"):c===3?(i.radial_gradient_idx=l.readVarint(),i.paint="radial_gradient_idx"):c===5?l.readPackedFloat(i.dasharray):c===6?i.dashoffset=l.readFloat():c===7?i.miterlimit=l.readFloat():c===8?i.opacity=l.readVarint():c===9?i.width=l.readFloat():c===10?i.linecap=l.readVarint():c===11&&(i.linejoin=l.readVarint())}function Zse(c,i,l){c===1?i.transform=$S(l,l.readVarint()+l.pos):c===2?i.spread_method=l.readVarint():c===3?i.stops.push(K7(l,l.readVarint()+l.pos)):c===4?i.x1=l.readFloat():c===5?i.y1=l.readFloat():c===6?i.x2=l.readFloat():c===7&&(i.y2=l.readFloat())}function K7(c,i){return c.readFields(Xse,{offset:0,opacity:255,rgb_color:v6},i)}function Xse(c,i,l){c===1?i.offset=l.readFloat():c===2?i.opacity=l.readVarint():c===3&&(i.rgb_color=HS(l.readVarint()))}function Yse(c,i,l){c===1?i.transform=$S(l,l.readVarint()+l.pos):c===2?i.spread_method=l.readVarint():c===3?i.stops.push(K7(l,l.readVarint()+l.pos)):c===4?i.cx=l.readFloat():c===5?i.cy=l.readFloat():c===6?i.r=l.readFloat():c===7?i.fx=l.readFloat():c===8?i.fy=l.readFloat():c===9&&(i.fr=l.readFloat())}function Kse(c,i,l){c===1?i.transform=$S(l,l.readVarint()+l.pos):c===2?i.clip_path_idx=l.readVarint():c===3&&i.children.push(VS(l,l.readVarint()+l.pos))}function Qse(c,i,l){c===1?i.left=i.top=l.readFloat():c===2?i.width=i.height=l.readFloat():c===3?i.top=l.readFloat():c===4?i.height=l.readFloat():c===5?i.mask_type=l.readVarint():c===6?i.mask_idx=l.readVarint():c===7&&i.children.push(VS(l,l.readVarint()+l.pos))}class Jse{static calculate(i={},l=[]){const h=new Map,p=new Map;if(Object.keys(i).length===0)return h;l.forEach(_=>{p.set(_.name,_.rgb_color||new Yi(0,0,0))});for(const[_,y]of Object.entries(i))p.has(_)?h.set(p.get(_).toString(),y):console.warn(`Ignoring unknown image variable "${_}"`);return h}}function p1(c,i=255,l){const h=i/255,p=c.toString(),_=l.has(p)?l.get(p).clone():c.clone();return _.a*=h,_.toString()}function lw(c,i){if(!Fc()){const l=document.createElement("canvas");return l.width=c,l.height=i,l}return new OffscreenCanvas(c,i)}let w6,uw=null;function T6(c,i,l,h,p){for(const _ of h.children)Q7(c,i,l,_,p)}function Q7(c,i,l,h,p){h.group?(c.save(),function(_,y,w,S,R){const O=S.mask_idx!=null?w.masks[S.mask_idx]:null,D=S.clip_path_idx!=null?w.clip_paths[S.clip_path_idx]:null;if(S.transform&&(y=m1(S.transform).preMultiplySelf(y)),!function(H,K,re){return H.opacity!==255||K||re}(S,D!=null,O!=null))return void T6(_,y,w,S,R);const z=lw(_.canvas.width,_.canvas.height),V=z.getContext("2d");T6(V,y,w,S,R),D&&s9(V,y,w,D),O&&a9(V,y,w,O,R),_.globalAlpha=S.opacity/255,_.drawImage(z,0,0)}(c,i,l,h.group,p),c.restore()):h.path&&(c.save(),function(_,y,w,S,R){_.setTransform(y),S.paint_order===Dse.PAINT_ORDER_FILL_AND_STROKE?(J7(_,w,S,R),t9(_,w,S,R)):(t9(_,w,S,R),J7(_,w,S,R))}(c,i,l,h.path,p),c.restore())}function J7(c,i,l,h){const p=l.fill;if(!p)return;const _=p.opacity/255;switch(c.save(),c.beginPath(),o9(l,c),p.paint){case"rgb_color":c.fillStyle=p1(p.rgb_color,p.opacity,h);break;case"linear_gradient_idx":{const y=i.linear_gradients[p.linear_gradient_idx];y.transform&&c.setTransform(m1(y.transform).preMultiplySelf(c.getTransform())),c.fillStyle=n9(c,y,_,h);break}case"radial_gradient_idx":{const y=i.radial_gradients[p.radial_gradient_idx];y.transform&&c.setTransform(m1(y.transform).preMultiplySelf(c.getTransform())),c.fillStyle=r9(c,y,_,h)}}c.fill(e9(l)),c.restore()}function e9(c){return c.rule===x6.PATH_RULE_NON_ZERO?"nonzero":c.rule===x6.PATH_RULE_EVEN_ODD?"evenodd":void 0}function t9(c,i,l,h){const p=l.stroke;if(!p)return;const _=l9(l);c.lineWidth=p.width,c.miterLimit=p.miterlimit,c.setLineDash(p.dasharray),c.lineDashOffset=p.dashoffset;const y=p.opacity/255;switch(p.paint){case"rgb_color":c.strokeStyle=p1(p.rgb_color,p.opacity,h);break;case"linear_gradient_idx":c.strokeStyle=n9(c,i.linear_gradients[p.linear_gradient_idx],y,h,!0);break;case"radial_gradient_idx":c.strokeStyle=r9(c,i.radial_gradients[p.radial_gradient_idx],y,h,!0)}switch(p.linejoin){case US.LINE_JOIN_MITER_CLIP:case US.LINE_JOIN_MITER:c.lineJoin="miter";break;case US.LINE_JOIN_ROUND:c.lineJoin="round";break;case US.LINE_JOIN_BEVEL:c.lineJoin="bevel"}switch(p.linecap){case b6.LINE_CAP_BUTT:c.lineCap="butt";break;case b6.LINE_CAP_ROUND:c.lineCap="round";break;case b6.LINE_CAP_SQUARE:c.lineCap="square"}c.stroke(_)}function n9(c,i,l,h,p=!1){if(i.stops.length===1){const z=i.stops[0];return p1(z.rgb_color,z.opacity*l,h)}const{x1:_,y1:y,x2:w,y2:S}=i;let R=new DOMPoint(_,y),O=new DOMPoint(w,S);if(p){const z=m1(i.transform);R=z.transformPoint(R),O=z.transformPoint(O)}const D=c.createLinearGradient(R.x,R.y,O.x,O.y);for(const z of i.stops)D.addColorStop(z.offset,p1(z.rgb_color,z.opacity*l,h));return D}function r9(c,i,l,h,p=!1){if(i.stops.length===1){const ne=i.stops[0];return p1(ne.rgb_color,ne.opacity*l,h)}const _=m1(i.transform),{fx:y,fy:w,fr:S,cx:R,cy:O,r:D}=i;let z=new DOMPoint(y,w),V=new DOMPoint(R,O),H=S,K=D;if(p){z=_.transformPoint(z),V=_.transformPoint(V);const ne=(_.a+_.d)/2;H=S*ne,K=i.r*ne}const re=c.createRadialGradient(z.x,z.y,H,V.x,V.y,K);for(const ne of i.stops)re.addColorStop(ne.offset,p1(ne.rgb_color,ne.opacity*l,h));return re}function i9(c,i,l,h){const p=h.transform?m1(h.transform).preMultiplySelf(i):i,_=lw(c.canvas.width,c.canvas.height),y=_.getContext("2d");for(const S of h.children)if(S.group)i9(y,p,l,S.group);else if(S.path){const R=S.path,O=new Path2D;O.addPath(l9(R),p),y.fill(O,e9(R))}const w=h.clip_path_idx!=null?l.clip_paths[h.clip_path_idx]:null;w&&s9(y,p,l,w),c.globalCompositeOperation="source-over",c.drawImage(_,0,0)}function s9(c,i,l,h){const p=lw(c.canvas.width,c.canvas.height);i9(p.getContext("2d"),i,l,h),c.globalCompositeOperation="destination-in",c.drawImage(p,0,0)}function a9(c,i,l,h,p){if(h.children.length===0)return;const _=h.mask_idx!=null?l.masks[h.mask_idx]:null;_&&a9(c,i,l,_,p);const y=c.canvas.width,w=c.canvas.height,S=lw(y,w),R=S.getContext("2d"),O=h.width,D=h.height,z=h.left,V=h.top,H=new Path2D,K=new Path2D;K.rect(z,V,O,D),H.addPath(K,i),R.clip(H);for(const ue of h.children)Q7(R,i,l,ue,p);const re=R.getImageData(0,0,y,w),ne=re.data;if(h.mask_type===Z7.MASK_TYPE_LUMINANCE)for(let ue=0;ue<ne.length;ue+=4)ne[ue+3]=ne[ue+3]/255*(.2126*ne[ue]+.7152*ne[ue+1]+.0722*ne[ue+2]);R.putImageData(re,0,0),c.globalCompositeOperation="destination-in",c.drawImage(S,0,0)}function m1(c){return c?new DOMMatrix([c.sx,c.ky,c.kx,c.sy,c.tx,c.ty]):new DOMMatrix}function o9(c,i){const l=c.step;let h=c.diffs[0]*l,p=c.diffs[1]*l;i.moveTo(h,p);for(let _=0,y=2;_<c.commands.length;_++)switch(c.commands[_]){case ow.PATH_COMMAND_MOVE:h+=c.diffs[y++]*l,p+=c.diffs[y++]*l,i.moveTo(h,p);break;case ow.PATH_COMMAND_LINE:h+=c.diffs[y++]*l,p+=c.diffs[y++]*l,i.lineTo(h,p);break;case ow.PATH_COMMAND_QUAD:{const w=h+c.diffs[y++]*l,S=p+c.diffs[y++]*l;h=w+c.diffs[y++]*l,p=S+c.diffs[y++]*l,i.quadraticCurveTo(w,S,h,p);break}case ow.PATH_COMMAND_CUBIC:{const w=h+c.diffs[y++]*l,S=p+c.diffs[y++]*l,R=w+c.diffs[y++]*l,O=S+c.diffs[y++]*l;h=R+c.diffs[y++]*l,p=O+c.diffs[y++]*l,i.bezierCurveTo(w,S,R,O,h,p);break}case ow.PATH_COMMAND_CLOSE:i.closePath()}return i}function l9(c){return o9(c,new Path2D)}class GS{constructor(i){this.capacity=i,this.cache=new Map}get(i){if(!this.cache.has(i))return;const l=this.cache.get(i);return this.cache.delete(i),this.cache.set(i,l),l}put(i,l){this.cache.has(i)?this.cache.delete(i):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(i,l)}delete(i){this.cache.delete(i)}}An(GS,"LRUCache");class E6{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(i){return new Jo(i,i.data)}getFromCache(i,l,h){return this.cacheMap.has(h)||this.cacheMap.set(h,new GS(150)),this.cacheMap.get(h).get(fc(i.toString(),l))}setInCache(i,l,h,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new GS(150));const _=this.cacheDependenciesMap.get(p),y=fc(i.id.toString(),h);_.get(y)||_.set(y,new Set);const w=this.cacheMap.get(p),S=i.toString();_.get(y).add(S),w.put(fc(i.toString(),h),l)}removeImagesFromCacheByIds(i,l,h=0){if(!this.cacheMap.has(h)||!this.cacheDependenciesMap.has(h))return;const p=this.cacheMap.get(h),_=this.cacheDependenciesMap.get(h);for(const y of i){const w=fc(y.toString(),l);if(_.has(w)){for(const S of _.get(w))p.delete(S);_.delete(w)}}}rasterize(i,l,h,p){const _=this.getFromCache(i,h,p);if(_)return _.clone();const y=function(S,R){const O=Jse.calculate(R.params,S.metadata?S.metadata.variables:[]),D=S.usvg_tree,z=D.width,V=D.height,H=Math.max(1,Math.round(z*R.sx)),K=Math.max(1,Math.round(V*R.sy)),re=new DOMMatrix([H/z,0,0,K/V,0,0]);return uw===null&&(uw=lw(10,10),w6=uw.getContext("2d",{willReadFrequently:!0})),uw.width=H,uw.height=K,T6(w6,re,D,D,O),w6.getImageData(0,0,H,K)}(l.icon,i),w=E6._getImage(y);return this.setInCache(i,w,h,p),w.clone()}}class u9{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,l){const h=this.toIdx(i,l);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(i,l){return this.leaves[this.toIdx(i,l)]}toIdx(i,l){return l*this.size+i}}function c9(c,i,l,h){let p=0,_=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(h[y])<1e-15){if(l[y]<c[y]||l[y]>i[y])return null}else{const w=1/h[y];let S=(c[y]-l[y])*w,R=(i[y]-l[y])*w;if(S>R){const O=S;S=R,R=O}if(S>p&&(p=S),R<_&&(_=R),p>_)return null}return p}function d9(c,i,l,h,p,_,y,w,S,R,O){const D=h-c,z=p-i,V=_-l,H=y-c,K=w-i,re=S-l,ne=O[1]*re-O[2]*K,ue=O[2]*H-O[0]*re,he=O[0]*K-O[1]*H,ge=D*ne+z*ue+V*he;if(Math.abs(ge)<1e-15)return null;const ke=1/ge,Ee=R[0]-c,Me=R[1]-i,Be=R[2]-l,$e=(Ee*ne+Me*ue+Be*he)*ke;if($e<0||$e>1)return null;const pt=Me*V-Be*z,Ye=Be*D-Ee*V,vt=Ee*z-Me*D,kt=(O[0]*pt+O[1]*Ye+O[2]*vt)*ke;return kt<0||$e+kt>1?null:(H*pt+K*Ye+re*vt)*ke}function h9(c,i,l){return(c-i)/(l-i)}function f9(c,i,l,h,p,_,y,w,S){const R=1<<l,O=_-h,D=y-p,z=(c+1)/R*O+h,V=(i+0)/R*D+p,H=(i+1)/R*D+p;w[0]=(c+0)/R*O+h,w[1]=V,S[0]=z,S[1]=H}class p9{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(_){const y=Math.ceil(Math.log2(_.dim/8)),w=[];let S=Math.ceil(Math.pow(2,y));const R=1/S,O=(V,H,K,re,ne)=>{const ue=re?1:0,he=(V+1)*K-ue,ge=H*K,ke=(H+1)*K-ue;ne[0]=V*K,ne[1]=ge,ne[2]=he,ne[3]=ke};let D=new u9(S);const z=[];for(let V=0;V<S*S;V++){O(V%S,Math.floor(V/S),R,!1,z);const H=im(z[0],z[1],_),K=im(z[2],z[1],_),re=im(z[2],z[3],_),ne=im(z[0],z[3],_);D.minimums.push(Math.min(H,K,re,ne)),D.maximums.push(Math.max(H,K,re,ne)),D.leaves.push(1)}for(w.push(D),S/=2;S>=1;S/=2){const V=w[w.length-1];D=new u9(S);for(let H=0;H<S*S;H++){O(H%S,Math.floor(H/S),2,!0,z);const K=V.getElevation(z[0],z[1]),re=V.getElevation(z[2],z[1]),ne=V.getElevation(z[2],z[3]),ue=V.getElevation(z[0],z[3]),he=V.isLeaf(z[0],z[1]),ge=V.isLeaf(z[2],z[1]),ke=V.isLeaf(z[2],z[3]),Ee=V.isLeaf(z[0],z[3]),Me=Math.min(K.min,re.min,ne.min,ue.min),Be=Math.max(K.max,re.max,ne.max,ue.max),$e=he&&ge&&ke&&Ee;D.maximums.push(Be),D.minimums.push(Me),D.leaves.push(Be-Me<=5&&$e?1:0)}w.push(D)}return w}(this.dem),h=l.length-1,p=l[h];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(l,0,0,h,0)}raycastRoot(i,l,h,p,_,y,w=1){return c9([i,l,-100],[h,p,this.maximums[0]*w],_,y)}raycast(i,l,h,p,_,y,w=1){if(!this.nodeCount)return null;const S=this.raycastRoot(i,l,h,p,_,y,w);if(S==null)return null;const R=[],O=[],D=[],z=[],V=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:H,t:K,nodex:re,nodey:ne,depth:ue}=V.pop();if(this.leaves[H]){f9(re,ne,ue,i,l,h,p,D,z);const ge=1<<ue,ke=(re+0)/ge,Ee=(re+1)/ge,Me=(ne+0)/ge,Be=(ne+1)/ge,$e=im(ke,Me,this.dem)*w,pt=im(Ee,Me,this.dem)*w,Ye=im(Ee,Be,this.dem)*w,vt=im(ke,Be,this.dem)*w,kt=d9(D[0],D[1],$e,z[0],D[1],pt,z[0],z[1],Ye,_,y),It=d9(z[0],z[1],Ye,D[0],z[1],vt,D[0],D[1],$e,_,y),Ft=Math.min(kt!==null?kt:Number.MAX_VALUE,It!==null?It:Number.MAX_VALUE);if(Ft!==Number.MAX_VALUE)return Ft;{const jt=$t([],_,y,K);if(m9($e,pt,vt,Ye,h9(jt[0],D[0],z[0]),h9(jt[1],D[1],z[1]))>=jt[2])return K}continue}let he=0;for(let ge=0;ge<this._siblingOffset.length;ge++){f9((re<<1)+this._siblingOffset[ge][0],(ne<<1)+this._siblingOffset[ge][1],ue+1,i,l,h,p,D,z),D[2]=-100,z[2]=this.maximums[this.childOffsets[H]+ge]*w;const ke=c9(D,z,_,y);if(ke!=null){const Ee=ke;R[ge]=Ee;let Me=!1;for(let Be=0;Be<he&&!Me;Be++)Ee>=R[O[Be]]&&(O.splice(Be,0,ge),Me=!0);Me||(O[he]=ge),he++}}for(let ge=0;ge<he;ge++){const ke=O[ge];V.push({idx:this.childOffsets[H]+ke,t:R[ke],nodex:(re<<1)+this._siblingOffset[ke][0],nodey:(ne<<1)+this._siblingOffset[ke][1],depth:ue+1})}}return null}_addNode(i,l,h){return this.minimums.push(i),this.maximums.push(l),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(i,l,h,p,_){if(i[p].isLeaf(l,h)===1)return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const y=p-1,w=i[y];let S=0,R=0;for(let O=0;O<this._siblingOffset.length;O++){const D=2*l+this._siblingOffset[O][0],z=2*h+this._siblingOffset[O][1],V=w.getElevation(D,z),H=w.isLeaf(D,z),K=this._addNode(V.min,V.max,H);H&&(S|=1<<O),R||(R=K)}for(let O=0;O<this._siblingOffset.length;O++)S&1<<O||this._construct(i,2*l+this._siblingOffset[O][0],2*h+this._siblingOffset[O][1],y,R+O)}}function m9(c,i,l,h,p,_){return br(br(c,l,_),br(i,h,_),p)}function im(c,i,l){const h=l.dim,p=ee(c*h-.5,0,h-1),_=ee(i*h-.5,0,h-1),y=Math.floor(p),w=Math.floor(_),S=Math.min(y+1,h-1),R=Math.min(w+1,h-1);return m9(l.get(y,w),l.get(S,w),l.get(y,R),l.get(S,R),p-y,_-w)}const eae={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function tae(c,i,l){return(256*c*256+256*i+l)/10-1e4}function nae(c,i,l){return 256*c+i+l/256-32768}class qS{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,l,h,p=!1){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return void un(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const _=this.dim=l.height-2,y=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.floatView=new Float32Array(l.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let S=0;S<_;S++)y[this._idx(-1,S)]=y[this._idx(0,S)],y[this._idx(_,S)]=y[this._idx(_-1,S)],y[this._idx(S,-1)]=y[this._idx(S,0)],y[this._idx(S,_)]=y[this._idx(S,_-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(_,-1)]=y[this._idx(_-1,0)],y[this._idx(-1,_)]=y[this._idx(0,_-1)],y[this._idx(_,_)]=y[this._idx(_-1,_-1)]}const w=h==="terrarium"?nae:tae;for(let S=0;S<y.length;++S){const R=4*S;this.floatView[S]=w(this.pixels[R],this.pixels[R+1],this.pixels[R+2])}this._timestamp=fo.now()}_buildQuadTree(){this._tree=new p9(this)}get(i,l,h=!1){h&&(i=ee(i,-1,this.dim),l=ee(l,-1,this.dim));const p=this._idx(i,l);return this.floatView[p]}set(i,l,h){const p=this._idx(i,l),_=this.floatView[p];return this.floatView[p]=h,h-_}static getUnpackVector(i){return eae[i]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}static pack(i,l){const h=[0,0,0,0],p=qS.getUnpackVector(l);let _=Math.floor((i+p[3])/p[2]);return h[2]=_%256,_=Math.floor(_/256),h[1]=_%256,_=Math.floor(_/256),h[0]=_,h}getPixels(){return new uN({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,l,h){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,_=l*this.dim+this.dim,y=h*this.dim,w=h*this.dim+this.dim;switch(l){case-1:p=_-1;break;case 1:_=p+1}switch(h){case-1:y=w-1;break;case 1:w=y+1}const S=-l*this.dim,R=-h*this.dim;for(let O=y;O<w;O++)for(let D=p;D<_;D++){const z=4*this._idx(D,O),V=4*this._idx(D+S,O+R);this.pixels[z+0]=i.pixels[V+0],this.pixels[z+1]=i.pixels[V+1],this.pixels[z+2]=i.pixels[V+2],this.pixels[z+3]=i.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function rae(c,i,l){c===1?i.headerLength=l.readFixed32():c===2?i.x=l.readVarint():c===3?i.y=l.readVarint():c===4?i.z=l.readVarint():c===5&&i.layers.push(function(h,p){return h.readFields(lae,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(l,l.readVarint()+l.pos))}function iae(c,i,l){c===1?(i.delta_filter=function(h,p){return h.readFields(sae,{blockSize:0},p)}(l,l.readVarint()+l.pos),i.filter="delta_filter"):c===2?(l.readVarint(),i.filter="zigzag_filter"):c===3?(l.readVarint(),i.filter="bitshuffle_filter"):c===4&&(l.readVarint(),i.filter="byteshuffle_filter")}function sae(c,i,l){c===1&&(i.blockSize=l.readVarint())}function aae(c,i,l){c===1?(l.readVarint(),i.codec="gzip_data"):c===2?(l.readVarint(),i.codec="jpeg_image"):c===3?(l.readVarint(),i.codec="webp_image"):c===4&&(l.readVarint(),i.codec="png_image")}function oae(c,i,l){let h=0,p=0;c===1?i.firstByte=l.readFixed64():c===2?i.lastByte=l.readFixed64():c===3?i.filters.push(function(_,y){return _.readFields(iae,{},y)}(l,l.readVarint()+l.pos)):c===4?i.codec=function(_,y){return _.readFields(aae,{},y)}(l,l.readVarint()+l.pos):c===5?p=l.readFloat():c===6?h=l.readFloat():c===7?i.bands.push(l.readString()):c===8?i.offset=l.readDouble():c===9&&(i.scale=l.readDouble()),i.offset===0&&(i.offset=p),i.scale===0&&(i.scale=h)}function lae(c,i,l){c===1?i.version=l.readVarint():c===2?i.name=l.readString():c===3?i.units=l.readString():c===4?i.tileSize=l.readVarint():c===5?i.buffer=l.readVarint():c===6?i.pixelFormat=l.readVarint():c===7&&i.dataIndex.push(function(h,p){return h.readFields(oae,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(l,l.readVarint()+l.pos))}function uae(c,i,l){if(c===2)(function(h,p,_){h.readFields(cae,_,p)})(l,l.readVarint()+l.pos,i);else if(c===3)throw new Error("Not implemented")}function cae(c,i,l){if(c===1){let h=0;const p=l.readVarint()+l.pos;for(;l.pos<p;)i[h++]=l.readVarint()}}function dae(c,i){if(i.length!==4)throw new Error(`Expected data of dimension 4 but got ${i.length}.`);let l=i[3];for(let h=2;h>=1;h--){const p=h===1?1:0,_=h===2?1:0;for(let y=0;y<i[0];y++){const w=i[1]*y;for(let S=p;S<i[1];S++){const R=i[2]*(S+w);for(let O=_;O<i[2];O++){const D=i[3]*(O+R);for(let z=0;z<i[3];z++){const V=D+z;c[V]+=c[V-l]}}}}l*=i[h]}return c}function hae(c){for(let i=0,l=c.length;i<l;i++)c[i]=c[i]>>>1^-(1&c[i]);return c}function fae(c,i){switch(i){case"uint32":return c;case"uint16":for(let l=0;l<c.length;l+=2){const h=c[l],p=c[l+1];c[l]=(240&h)>>4|(61440&h)>>8|(240&p)<<4|61440&p,c[l+1]=15&h|(3840&h)>>4|(15&p)<<8|(3840&p)<<4}return c;case"uint8":for(let l=0;l<c.length;l+=4){const h=c[l],p=c[l+1],_=c[l+2],y=c[l+3];c[l+0]=(192&h)>>6|(192&p)>>4|(192&_)>>2|192&y,c[l+1]=(48&h)>>4|(48&p)>>2|48&_|(48&y)<<2,c[l+2]=(12&h)>>2|12&p|(12&_)<<2|(12&y)<<4,c[l+3]=3&h|(3&p)<<2|(3&_)<<4|(3&y)<<6}return c;default:throw new Error(`Invalid pixel format, "${i}"`)}}An(qS,"DEMData"),An(p9,"DemMinMaxQuadTree",{omit:["dem"]});var _c=Uint8Array,cw=Uint16Array,pae=Int32Array,g9=new _c([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_9=new _c([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),mae=new _c([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),y9=function(c,i){for(var l=new cw(31),h=0;h<31;++h)l[h]=i+=1<<c[h-1];var p=new pae(l[30]);for(h=1;h<30;++h)for(var _=l[h];_<l[h+1];++_)p[_]=_-l[h]<<5|h;return{b:l,r:p}},v9=y9(g9,2),x9=v9.b,gae=v9.r;x9[28]=258,gae[258]=28;for(var _ae=y9(_9,0).b,b9=new cw(32768),ao=0;ao<32768;++ao){var g1=(43690&ao)>>1|(21845&ao)<<1;b9[ao]=((65280&(g1=(61680&(g1=(52428&g1)>>2|(13107&g1)<<2))>>4|(3855&g1)<<4))>>8|(255&g1)<<8)>>1}var dw=function(c,i,l){for(var h=c.length,p=0,_=new cw(i);p<h;++p)c[p]&&++_[c[p]-1];var y,w=new cw(i);for(p=1;p<i;++p)w[p]=w[p-1]+_[p-1]<<1;y=new cw(1<<i);var S=15-i;for(p=0;p<h;++p)if(c[p])for(var R=p<<4|c[p],O=i-c[p],D=w[c[p]-1]++<<O,z=D|(1<<O)-1;D<=z;++D)y[b9[D]>>S]=R;return y},hw=new _c(288);for(ao=0;ao<144;++ao)hw[ao]=8;for(ao=144;ao<256;++ao)hw[ao]=9;for(ao=256;ao<280;++ao)hw[ao]=7;for(ao=280;ao<288;++ao)hw[ao]=8;var w9=new _c(32);for(ao=0;ao<32;++ao)w9[ao]=5;var yae=dw(hw,9),vae=dw(w9,5),S6=function(c){for(var i=c[0],l=1;l<c.length;++l)c[l]>i&&(i=c[l]);return i},jd=function(c,i,l){var h=i/8|0;return(c[h]|c[h+1]<<8)>>(7&i)&l},A6=function(c,i){var l=i/8|0;return(c[l]|c[l+1]<<8|c[l+2]<<16)>>(7&i)},xae=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ud=function(c,i,l){var h=new Error(i||xae[c]);if(h.code=c,Error.captureStackTrace&&Error.captureStackTrace(h,Ud),!l)throw h;return h},bae=new _c(0),wae=typeof TextDecoder<"u"&&new TextDecoder;try{wae.decode(bae,{stream:!0})}catch{}const Tae={gzip_data:"gzip"};class Qc extends Error{constructor(i){super(i),this.name="MRTError"}}const Eae={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},T9={uint32:1,uint16:2,uint8:4},Sae={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let C6;class WS{constructor(i=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=i}getLayer(i){const l=this.layers[i];if(!l)throw new Qc(`Layer '${i}' not found`);return l}getHeaderLength(i){const l=new Uint8Array(i),h=new DataView(i);if(l[0]!==13)throw new Qc("File is not a valid MRT.");return h.getUint32(1,!0)}parseHeader(i){const l=new Uint8Array(i),h=this.getHeaderLength(i);if(l.length<h)throw new Qc(`Expected header with length >= ${h} but got buffer of length ${l.length}`);const p=new C6(l.subarray(0,h)).readFields(rae,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new Qc(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const _ of p.layers)this.layers[_.name]=new E9(_,{cacheSize:this._cacheSize});return this}createDecodingTask(i){const l=[],h=this.getLayer(i.layerName);for(let p of i.blockIndices){const _=h.dataIndex[p],y=_.firstByte-i.firstByte,w=_.lastByte-i.firstByte;if(h._blocksInProgress.has(p))continue;const S={layerName:h.name,firstByte:y,lastByte:w,pixelFormat:h.pixelFormat,blockIndex:p,blockShape:[_.bands.length].concat(h.bandShape),buffer:h.buffer,codec:_.codec.codec,filters:_.filters.map(R=>R.filter)};h._blocksInProgress.add(p),l.push(S)}return new S9(l,()=>{l.forEach(p=>h._blocksInProgress.delete(p.blockIndex))},(p,_)=>{if(l.forEach(y=>h._blocksInProgress.delete(y.blockIndex)),p)throw p;_.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class E9{constructor({version:i,name:l,units:h,tileSize:p,pixelFormat:_,buffer:y,dataIndex:w},S){if(this.version=i,this.version!==1)throw new Qc(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=l,this.units=h,this.tileSize=p,this.buffer=y,this.pixelFormat=Eae[_],this.dataIndex=w,this.bandShape=[p+2*y,p+2*y,T9[this.pixelFormat]],this._decodedBlocks=new GS(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return T9[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:i})=>i).flat()}processDecodedData(i){const l=i.blockIndex.toString();this._decodedBlocks.get(l)||this._decodedBlocks.put(l,i.data)}getBlockForBand(i){let l=0;switch(typeof i){case"string":for(const[h,p]of this.dataIndex.entries()){for(const[_,y]of p.bands.entries())if(y===i)return{bandIndex:l+_,blockIndex:h,blockBandIndex:_};l+=p.bands.length}break;case"number":for(const[h,p]of this.dataIndex.entries()){if(i>=l&&i<l+p.bands.length)return{bandIndex:i,blockIndex:h,blockBandIndex:i-l};l+=p.bands.length}break;default:throw new Qc(`Invalid band \`${JSON.stringify(i)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(i){let l=1/0,h=-1/0;const p=[],_=new Set;for(const y of i){const{blockIndex:w}=this.getBlockForBand(y);if(w<0)throw new Qc(`Invalid band: ${JSON.stringify(y)}`);const S=this.dataIndex[w];p.includes(w)||p.push(w),_.add(w),l=Math.min(l,S.firstByte),h=Math.max(h,S.lastByte)}if(_.size>this.cacheSize)throw new Qc(`Number of blocks to decode (${_.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:l,lastByte:h,blockIndices:p}}hasBand(i){const{blockIndex:l}=this.getBlockForBand(i);return l>=0}hasDataForBand(i){const{blockIndex:l}=this.getBlockForBand(i);return l>=0&&!!this._decodedBlocks.get(l.toString())}getBandView(i){const{blockIndex:l,blockBandIndex:h}=this.getBlockForBand(i);if(l<0)throw new Qc(`Band not found: ${JSON.stringify(i)}`);const p=this._decodedBlocks.get(l.toString());if(!p)throw new Qc(`Data for band ${JSON.stringify(i)} of layer "${this.name}" not decoded.`);const _=this.dataIndex[l],y=this.bandShape.reduce((R,O)=>R*O,1),w=h*y,S=p.subarray(w,w+y);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:_.offset,scale:_.scale}}}WS.setPbf=function(c){C6=c};class S9{constructor(i,l,h){this.tasks=i,this._onCancel=l,this._onComplete=h,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(i,l){this._finalized||(this._onComplete(i,l),this._finalized=!0)}}WS.performDecoding=function(c,i){const l=new Uint8Array(c);return Promise.all(i.tasks.map(h=>{const{layerName:p,firstByte:_,lastByte:y,pixelFormat:w,blockShape:S,blockIndex:R,filters:O,codec:D}=h,z=l.subarray(_,y+1),V=new Uint32Array(S[0]*S[1]*S[2]);let H;if(D!=="gzip_data")throw new Qc(`Unhandled codec: ${D}`);return H=function(K,re){if(!globalThis.DecompressionStream&&re==="gzip_data")return Promise.resolve(((ge=function(Me){Me[0]==31&&Me[1]==139&&Me[2]==8||Ud(6,"invalid gzip data");var Be=Me[3],$e=10;4&Be&&($e+=2+(Me[10]|Me[11]<<8));for(var pt=(Be>>3&1)+(Be>>4&1);pt>0;pt-=!Me[$e++]);return $e+(2&Be)}(he=K))+8>he.length&&Ud(6,"invalid gzip data"),function(Me,Be,$e,pt){var Ye=Me.length;if(!Ye||Be.f&&!Be.l)return $e||new _c(0);var vt=!$e,kt=vt||Be.i!=2,It=Be.i;vt&&($e=new _c(3*Ye));var Ft,jt,Lt=function(ls){var zi=$e.length;if(ls>zi){var qi=new _c(Math.max(2*zi,ls));qi.set($e),$e=qi}},Dt=Be.f||0,yt=Be.p||0,gt=Be.b||0,zt=Be.l,Jt=Be.d,Gt=Be.m,Fn=Be.n,mn=8*Ye;do{if(!zt){Dt=jd(Me,yt,1);var xn=jd(Me,yt+1,3);if(yt+=3,!xn){var Pn=Me[(xt=4+((yt+7)/8|0))-4]|Me[xt-3]<<8,Yr=xt+Pn;if(Yr>Ye){It&&Ud(0);break}kt&&Lt(gt+Pn),$e.set(Me.subarray(xt,Yr),gt),Be.b=gt+=Pn,Be.p=yt=8*Yr,Be.f=Dt;continue}if(xn==1)zt=yae,Jt=vae,Gt=9,Fn=5;else if(xn==2){var Wt=jd(Me,yt,31)+257,On=jd(Me,yt+10,15)+4,Rr=Wt+jd(Me,yt+5,31)+1;yt+=14;for(var fi=new _c(Rr),xi=new _c(19),Fr=0;Fr<On;++Fr)xi[mae[Fr]]=jd(Me,yt+3*Fr,7);yt+=3*On;var os=S6(xi),Se=(1<<os)-1,Ie=dw(xi,os);for(Fr=0;Fr<Rr;){var xt,Bt=Ie[jd(Me,yt,Se)];if(yt+=15&Bt,(xt=Bt>>4)<16)fi[Fr++]=xt;else{var cn=0,dn=0;for(xt==16?(dn=3+jd(Me,yt,3),yt+=2,cn=fi[Fr-1]):xt==17?(dn=3+jd(Me,yt,7),yt+=3):xt==18&&(dn=11+jd(Me,yt,127),yt+=7);dn--;)fi[Fr++]=cn}}var Bn=fi.subarray(0,Wt),Wn=fi.subarray(Wt);Gt=S6(Bn),Fn=S6(Wn),zt=dw(Bn,Gt),Jt=dw(Wn,Fn)}else Ud(1);if(yt>mn){It&&Ud(0);break}}kt&&Lt(gt+131072);for(var Dr=(1<<Gt)-1,$r=(1<<Fn)-1,Wr=yt;;Wr=yt){var ci=(cn=zt[A6(Me,yt)&Dr])>>4;if((yt+=15&cn)>mn){It&&Ud(0);break}if(cn||Ud(2),ci<256)$e[gt++]=ci;else{if(ci==256){Wr=yt,zt=null;break}var yr=ci-254;ci>264&&(yr=jd(Me,yt,(1<<(Li=g9[Fr=ci-257]))-1)+x9[Fr],yt+=Li);var Ir=Jt[A6(Me,yt)&$r],Ci=Ir>>4;if(Ir||Ud(3),yt+=15&Ir,Wn=_ae[Ci],Ci>3){var Li=_9[Ci];Wn+=A6(Me,yt)&(1<<Li)-1,yt+=Li}if(yt>mn){It&&Ud(0);break}kt&&Lt(gt+131072);var Di=gt+yr;if(gt<Wn){var Qi=0-Wn,ys=Math.min(Wn,Di);for(Qi+gt<0&&Ud(3);gt<ys;++gt)$e[gt]=(void 0)[Qi+gt]}for(;gt<Di;++gt)$e[gt]=$e[gt-Wn]}}Be.l=zt,Be.p=Wr,Be.b=gt,Be.f=Dt,zt&&(Dt=1,Be.m=Gt,Be.d=Jt,Be.n=Fn)}while(!Dt);return gt!=$e.length&&vt?(Ft=$e,((jt=gt)==null||jt>Ft.length)&&(jt=Ft.length),new _c(Ft.subarray(0,jt))):$e.subarray(0,gt)}(he.subarray(ge,-8),{i:2},new _c(((ne=he)[(ue=ne.length)-4]|ne[ue-3]<<8|ne[ue-2]<<16|ne[ue-1]<<24)>>>0))));var ne,ue,he,ge;const ke=Tae[re];if(!ke)throw new Error(`Unhandled codec: ${re}`);const Ee=new globalThis.DecompressionStream(ke);return new Response(new Blob([K]).stream().pipeThrough(Ee)).arrayBuffer().then(Me=>new Uint8Array(Me))}(z,D).then(K=>(function(re,ne){re.readFields(uae,ne)}(new C6(K),V),new Sae[w](V.buffer))),H.then(K=>{for(let re=O.length-1;re>=0;re--)switch(O[re]){case"delta_filter":dae(K,S);break;case"zigzag_filter":hae(K);break;case"bitshuffle_filter":fae(K,w);break;default:throw new Qc(`Unhandled filter "${O[re]}"`)}return{layerName:p,blockIndex:R,data:K}}).catch(K=>{throw K})}))},An(S9,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),An(WS,"MapboxRasterTile"),An(E9,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class A9{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const h=i[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}class C9{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Vp(Qt,16,0),this.featureIndexArray=new bb,this.promoteId=l,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(i,l,h,p,_,y=0,w=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,_,y);const R=this.grid;for(let O=0;O<l.length;O++){const D=l[O],z=[1/0,1/0,-1/0,-1/0];for(let V=0;V<D.length;V++){const H=D[V];z[0]=Math.min(z[0],H.x),z[1]=Math.min(z[1],H.y),z[2]=Math.max(z[2],H.x),z[3]=Math.max(z[3],H.y)}w!==0&&(z[0]-=w,z[1]-=w,z[2]+=w,z[3]+=w),z[0]<Qt&&z[1]<Qt&&z[2]>=0&&z[3]>=0&&R.insert(S,z[0],z[1],z[2],z[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new rt(new TS(this.rawTileData)).layers,this.sourceLayerCoder=new A9(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,l){const{tilespaceGeometry:h,transform:p,tileTransform:_,pixelPosMatrix:y,availableImages:w,worldview:S}=l;this.loadVTLayers(),this.serializedLayersCache.clear();const R=l.queryRadius?l.queryRadius:0,O=h.bufferedTilespaceBounds,D=this.grid.query(O.min.x,O.min.y,O.max.x,O.max.y,(K,re,ne,ue)=>vl(h.bufferedTilespaceGeometry,K-R,re-R,ne+R,ue+R));D.sort(Aae);let z=null;p.elevation&&D.length>0&&(z=f1.create(p.elevation,this.tileID));const V={};let H;for(let K=0;K<D.length;K++){const re=D[K];if(re===H)continue;H=re;const ne=this.featureIndexArray.get(re);let ue=null;this.is3DTile?this.loadMatchingModelFeature(V,ne,i,h,p,S):this.loadMatchingFeature(V,ne,i,w,S,(he,ge,ke,Ee=0)=>(ue||(ue=Fe(he,this.tileID.canonical,_)),ge.queryIntersectsFeature(h,he,ke,ue,this.z,p,y,z,Ee)))}return V}loadMatchingFeature(i,l,h,p,_,y){const{featureIndex:w,bucketIndex:S,sourceLayerIndex:R,layoutVertexArrayOffset:O}=l,D=this.bucketLayerIDs[S],z=h.layers,V=Object.keys(z);if(V.length&&!ln(V,D))return;const H=h.sourceCache,K=this.sourceLayerCoder.decode(R),re=this.vtLayers[K].feature(w),ne=this.getId(re,K);for(let ue=0;ue<D.length;ue++){const he=D[ue];if(!z[he])continue;const{styleLayer:ge,targets:ke}=z[he];let Ee={};ne!==void 0&&(Ee=H.getFeatureState(ge.sourceLayer,ne));const Me=!y||y(re,ge,Ee,O);if(!Me)continue;const Be=new yg(re,this.z,this.x,this.y,ne);Be.tile=this.tileID.canonical,Be.state=Ee;let $e=this.serializedLayersCache.get(he);$e||($e=ge.serialize(),$e.id=he,this.serializedLayersCache.set(he,$e)),Be.source=$e.source,Be.sourceLayer=$e["source-layer"],Be.layer=Object.assign({},$e),Be.layer.paint=k9($e.paint,ge.paint,re,Ee,p),Be.layer.layout=k9($e.layout,ge.layout,re,Ee,p);let pt=!1;for(const Ye of ke){this.updateFeatureProperties(Be,Ye);const{filter:vt}=Ye;if(vt){if(re.properties=Be.properties,vt.needGeometry){const kt=Xe(re,!0);if(!vt.filter(new Rs(this.tileID.overscaledZ,{worldview:_}),kt,this.tileID.canonical))continue}else if(!vt.filter(new Rs(this.tileID.overscaledZ,{worldview:_}),re))continue}pt=!0,Ye.targetId&&this.addFeatureVariant(Be,Ye)}pt&&this.appendToResult(i,he,w,Be,Me)}}loadMatchingModelFeature(i,l,h,p,_,y){const{featureIndex:w,bucketIndex:S}=l,R=this.bucketLayerIDs[S],O=h.layers,D=Object.keys(O);if(!D.length||ln(D,R))for(let z=0;z<R.length;z++){const V=R[z],{styleLayer:H,targets:K}=O[V];if(H.type!=="model")continue;const re=p.tile,ne=re.getBucket(H);if(!(ne&&ne instanceof jS))continue;const ue=Ose(ne,w,p,_);if(!ue)continue;const{z:he,x:ge,y:ke}=re.tileID.canonical,{feature:Ee,intersectionZ:Me,position:Be}=ue;let $e={};Ee.id!==void 0&&($e=h.sourceCache.getFeatureState(H.sourceLayer,Ee.id));const pt=new yg({},he,ge,ke,Ee.id);pt.tile=this.tileID.canonical,pt.state=$e,pt.properties=Ee.properties,pt.geometry={type:"Point",coordinates:[Be.lng,Be.lat]};let Ye=this.serializedLayersCache.get(V);Ye||(Ye=H.serialize(),Ye.id=V,this.serializedLayersCache.set(V,Ye)),pt.source=Ye.source,pt.sourceLayer=Ye["source-layer"],pt.layer=Object.assign({},Ye);let vt=!1;for(const kt of K){this.updateFeatureProperties(pt,kt);const{filter:It}=kt;if(It){if(Ee.properties=pt.properties,It.needGeometry){if(!It.filter(new Rs(this.tileID.overscaledZ,{worldview:y}),Ee,this.tileID.canonical))continue}else if(!It.filter(new Rs(this.tileID.overscaledZ,{worldview:y}),Ee))continue}vt=!0,kt.targetId&&this.addFeatureVariant(pt,kt)}vt&&this.appendToResult(i,V,w,pt,Me)}}updateFeatureProperties(i,l,h){if(l.properties){const p={};for(const _ in l.properties){const y=l.properties[_].evaluate({zoom:this.z},i._vectorTileFeature,i.state,i.tile,h);y!=null&&(p[_]=y)}i.properties=p}}addFeatureVariant(i,l,h){const p={target:l.target,namespace:l.namespace,uniqueFeatureID:l.uniqueFeatureID};l.properties&&(p.properties=i.properties),i.variants=i.variants||{},i.variants[l.targetId]=i.variants[l.targetId]||[],i.variants[l.targetId].push(p)}appendToResult(i,l,h,p,_){let y=i[l];y===void 0&&(y=i[l]=[]),y.push({featureIndex:h,feature:p,intersectionZ:_})}lookupSymbolFeatures(i,l,h,p,_,y){const w={};this.loadVTLayers();for(const S of i)this.loadMatchingFeature(w,{bucketIndex:l,sourceLayerIndex:h,featureIndex:S,layoutVertexArrayOffset:0},p,_,y);return w}loadFeature(i){const{featureIndex:l,sourceLayerIndex:h}=i;this.loadVTLayers();const p=this.sourceLayerCoder.decode(h),_=this.vtFeatures[p];if(_[l])return _[l];const y=this.vtLayers[p].feature(l);return _[l]=y,y}hasLayer(i){for(const l of this.bucketLayerIDs)for(const h of l)if(i===h)return!0;return!1}getId(i,l){let h=i.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[l];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const _=Ah(p);if(_.result!=="success"){const y=_.value.map(w=>`${w.key}: ${w.message}`).join(", ");return void un(`Failed to create expression for promoteId: ${y}`)}this.promoteIdExpression=_.value}h=this.promoteIdExpression.evaluate({zoom:0},i)}else h=i.properties[p];typeof h=="boolean"&&(h=Number(h))}return h}}function k9(c,i,l,h,p){return nt(c,(_,y)=>{const w=i instanceof Mf?i.get(y):null;return w&&w.evaluate?w.evaluate(l,h,void 0,p):w})}function Aae(c,i){return i-c}An(C9,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const I9=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class k6{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,h]=new Uint8Array(i,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=h>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const _=I9[15&h];if(!_)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(i,2,1),[w]=new Uint32Array(i,4,1);return new k6(w,y,_,i)}constructor(i,l=64,h=Float64Array,p){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=h,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const _=I9.indexOf(this.ArrayType),y=2*i*this.ArrayType.BYTES_PER_ELEMENT,w=i*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-w%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${h}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+S,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+y+w+S),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+S,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=i)}add(i,l){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=i,this.coords[this._pos++]=l,h}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return I6(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,l,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:y,nodeSize:w}=this,S=[0,_.length-1,0],R=[];for(;S.length;){const O=S.pop()||0,D=S.pop()||0,z=S.pop()||0;if(D-z<=w){for(let re=z;re<=D;re++){const ne=y[2*re],ue=y[2*re+1];ne>=i&&ne<=h&&ue>=l&&ue<=p&&R.push(_[re])}continue}const V=z+D>>1,H=y[2*V],K=y[2*V+1];H>=i&&H<=h&&K>=l&&K<=p&&R.push(_[V]),(O===0?i<=H:l<=K)&&(S.push(z),S.push(V-1),S.push(1-O)),(O===0?h>=H:p>=K)&&(S.push(V+1),S.push(D),S.push(1-O))}return R}within(i,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:y}=this,w=[0,p.length-1,0],S=[],R=h*h;for(;w.length;){const O=w.pop()||0,D=w.pop()||0,z=w.pop()||0;if(D-z<=y){for(let re=z;re<=D;re++)M9(_[2*re],_[2*re+1],i,l)<=R&&S.push(p[re]);continue}const V=z+D>>1,H=_[2*V],K=_[2*V+1];M9(H,K,i,l)<=R&&S.push(p[V]),(O===0?i-h<=H:l-h<=K)&&(w.push(z),w.push(V-1),w.push(1-O)),(O===0?i+h>=H:l+h>=K)&&(w.push(V+1),w.push(D),w.push(1-O))}return S}}function I6(c,i,l,h,p,_){if(p-h<=l)return;const y=h+p>>1;R9(c,i,y,h,p,_),I6(c,i,l,h,y-1,1-_),I6(c,i,l,y+1,p,1-_)}function R9(c,i,l,h,p,_){for(;p>h;){if(p-h>600){const R=p-h+1,O=l-h+1,D=Math.log(R),z=.5*Math.exp(2*D/3),V=.5*Math.sqrt(D*z*(R-z)/R)*(O-R/2<0?-1:1);R9(c,i,l,Math.max(h,Math.floor(l-O*z/R+V)),Math.min(p,Math.floor(l+(R-O)*z/R+V)),_)}const y=i[2*l+_];let w=h,S=p;for(fw(c,i,h,l),i[2*p+_]>y&&fw(c,i,h,p);w<S;){for(fw(c,i,w,S),w++,S--;i[2*w+_]<y;)w++;for(;i[2*S+_]>y;)S--}i[2*h+_]===y?fw(c,i,h,S):(S++,fw(c,i,S,p)),S<=l&&(h=S+1),l<=S&&(p=S-1)}}function fw(c,i,l,h){R6(c,l,h),R6(i,2*l,2*h),R6(i,2*l+1,2*h+1)}function R6(c,i,l){const h=c[i];c[i]=c[l],c[l]=h}function M9(c,i,l,h){const p=c-l,_=i-h;return p*p+_*_}s.$=W_,s.A=bd,s.B=fc,s.C=2,s.D=e1,s.E=wf,s.F=Zb,s.G=r7,s.H=q_,s.I=ll,s.J=BE,s.K=zn,s.L=Ip,s.M=_y,s.N=Z0,s.O=AE,s.P=Ve,s.Q=X0,s.R=C0,s.S=Cy,s.T=FI,s.U=Ah,s.V=BS,s.W=tb,s.X=Lp,s.Y=Op,s.Z=V0,s._=gl,s.a=function(c){return ri.API_CDN_URL_REGEX.test(c)},s.a$=Z,s.a0=kr,s.a1=Pu,s.a2=Wc,s.a3=class extends BS{},s.a4=yy,s.a5=SE,s.a6=Ke,s.a7=function(c){const i=c.value;return i?kr(i)?m6(i,!0)?[]:[new BS(c.key,i,`invalid url "${i}"`)]:[new BS(c.key,i,`string expected, "${zn(i)}" found`)]:[]},s.a8=DE,s.a9=fa,s.aA=ee,s.aB=$,s.aC=$i,s.aD=Yo,s.aE=gs,s.aF=I,s.aG=me,s.aH=function(c,i){const l={};for(let h=0;h<i.length;h++){const p=i[h];p in c&&(l[p]=c[p])}return l},s.aI=g,s.aJ=M,s.aK=class{constructor(c){this.entries={},this.scheduler=c}request(c,i,l,h){const p=this.entries[c]=this.entries[c]||{callbacks:[]};if(p.result){const[_,y]=p.result;return this.scheduler?this.scheduler.add(()=>{h(_,y)},i):h(_,y),()=>{}}return p.callbacks.push(h),p.cancel||(p.cancel=l((_,y)=>{p.result=[_,y];for(const w of p.callbacks)this.scheduler?this.scheduler.add(()=>{w(_,y)},i):w(_,y);setTimeout(()=>delete this.entries[c],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(_=>_!==h),p.callbacks.length||(p.cancel(),delete this.entries[c]))}}},s.aL=function(c,i,l){const h=JSON.stringify(c.request);return c.data&&(this.deduped.entries[h]={result:[null,c.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},p=>{const _=xd(c.request,(y,w,S)=>{y?p(y):w&&p(null,{rawData:w,vectorTile:l?void 0:new rt(new TS(w)),responseHeaders:new Map(S.entries())})});return()=>{_.cancel(),p()}},i)},s.aM=function(c){return c?{cacheControl:c.get("Cache-Control"),expires:c.get("Expires")}:{cacheControl:void 0,expires:void 0}},s.aN=$l,s.aO=function(c){Mu++,Mu>N_&&(c.getActor().send("enforceCacheSizeLimit",D_),Mu=0)},s.aP=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log2(c)))},s.aQ=oa,s.aR=P7,s.aS=F7,s.aT=d,s.aU=M7,s.aV=function(c,i){const l=document.createElement("video");l.muted=!0,l.onloadstart=function(){i(null,l)};for(let h=0;h<c.length;h++){const p=document.createElement("source");Pk(c[h])||(l.crossOrigin="Anonymous"),p.src=c[h],l.appendChild(p)}return{cancel:()=>{}}},s.aW=$b,s.aX=vg,s.aY=We,s.aZ=Qb,s.a_=j,s.aa=Zt,s.ab=class{constructor(c){this.specification=c}possiblyEvaluate(c,i){return Ar(c.expression.evaluate(i))}interpolate(c,i,l){return{x:br(c.x,i.x,l),y:br(c.y,i.y,l),z:br(c.z,i.z,l),azimuthal:br(c.azimuthal,i.azimuthal,l),polar:br(c.polar,i.polar,l)}}},s.ac=Rs,s.ad=kf,s.ae=pe,s.af=nn,s.ag=Pt,s.ah=le,s.ai=Mf,s.aj=Jp,s.ak=br,s.al=Qt,s.am=Ex,s.an=Tn,s.ao=Yi,s.ap=class{constructor(c){this.specification=c}possiblyEvaluate(c,i){return function([l,h]){const p=Ar([1,l,h]);return{x:p.x,y:p.y,z:p.z}}(c.expression.evaluate(i))}interpolate(c,i,l){return{x:br(c.x,i.x,l),y:br(c.y,i.y,l),z:br(c.z,i.z,l)}}},s.aq=function(c,i,l=0,h=!0){const p=new Ve(l,l),_=c.sub(p),y=i.add(p),w=[_,new Ve(y.x,_.y),y,new Ve(_.x,y.y)];return h&&w.push(_.clone()),w},s.ar=function(c,i){const l=[];for(let h=0;h<c.length;h++){const p=ye(h-1,-1,c.length-1),_=ye(h+1,-1,c.length-1),y=c[h],w=c[_],S=c[p].sub(y).unit(),R=w.sub(y).unit(),O=R.angleWithSep(S.x,S.y),D=S.add(R).unit().mult(-1*i/Math.sin(O/2));l.push(y.add(D))}return l},s.as=g7,s.at=vl,s.au=function(c,i,l=0){return Nt(((i.x-l)*c.scale-c.x)*Qt,(i.y*c.scale-c.y)*Qt,W(i.z,i.y))},s.av=Vn,s.aw=Vt,s.ax=In,s.ay=Mz,s.az=function(c){let i=1/0,l=1/0,h=-1/0,p=-1/0;for(const _ of c)i=Math.min(i,_.x),l=Math.min(l,_.y),h=Math.max(h,_.x),p=Math.max(p,_.y);return{min:new Ve(i,l),max:new Ve(h,p)}},s.b=function(c){return ri.API_FONTS_REGEX.test(c)},s.b$=MN,s.b0=Wa,s.b1=Gp,s.b2=je,s.b3=ZE,s.b4=DS,s.b5=function(){kd.isLoading()||kd.isLoaded()||J0()!=="deferred"||LE()},s.b6=ky,s.b7=Xe,s.b8=yg,s.b9=Pi,s.bA=q,s.bB=be,s.bC=F,s.bD=function(c,i){const{x:l,y:h}=c.point,p=YD(l,h,c.worldSize/c._pixelsPerMercatorPixel,0,0);return $(p,p,fI(gc(i)))},s.bE=A,s.bF=ar,s.bG=Cn,s.bH=$t,s.bI=Sn,s.bJ=En,s.bK=l1,s.bL=pu,s.bM=n6,s.bN=function(c,i,l,h,p){const _=5*i+2;c.float32[_+0]=l,c.float32[_+1]=h,c.float32[_+2]=p},s.bO=h1,s.bP=ts,s.bQ=ut,s.bR=Mn,s.bS=ga,s.bT=ye,s.bU=function(c,i,l,h){var p=new x(4);return p[0]=c,p[1]=i,p[2]=l,p[3]=h,p},s.bV=class{isDataAvailableAtPoint(c){const i=this._source();if(this.isUsingMockSource()||!i||c.y<0||c.y>1)return!1;const l=i.getSource().maxzoom,h=1<<l,p=Math.floor(c.x),_=Math.floor((c.x-p)*h),y=Math.floor(c.y*h),w=this.findDEMTileFor(new oa(l,p,l,_,y));return!(!w||!w.dem)}getAtPointOrZero(c,i=0){return this.getAtPoint(c,i)||0}getAtPoint(c,i,l=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const h=this._source();if(!h||c.y<0||c.y>1)return i;const p=h.getSource().maxzoom,_=1<<p,y=Math.floor(c.x),w=c.x-y,S=new oa(p,y,p,Math.floor(w*_),Math.floor(c.y*_)),R=this.findDEMTileFor(S);if(!R||!R.dem)return i;const O=R.dem,D=1<<R.tileID.canonical.z,z=(w*D-R.tileID.canonical.x)*O.dim,V=(c.y*D-R.tileID.canonical.y)*O.dim,H=Math.floor(z),K=Math.floor(V);return(l?this.exaggeration():1)*br(br(O.get(H,K),O.get(H,K+1),V-K),br(O.get(H+1,K),O.get(H+1,K+1),V-K),z-H)}static getAtTileOffset(c,i,l,h){const p=1<<c.canonical.z;return h?h.pointElevation(i):l?l.getAtPointOrZero(new pe(c.wrap+(c.canonical.x+i.x/Qt)/p,(c.canonical.y+i.y/Qt)/p)):0}static getAtTileOffsetFunc(c,i,l,h){return(p,_,y)=>{const w=this.getAtTileOffset(c,p,_,y),S=h.upVector(c.canonical,p.x,p.y);return ze(S,S,w*h.upVectorScale(c.canonical,i,l).metersToTile),S}}getForTilePoints(c,i,l,h){if(this.isUsingMockSource())return!1;const p=f1.create(this,c,h);return!!p&&(i.forEach(_=>{_[2]=this.exaggeration()*p.getElevationAt(_[0],_[1],l)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(c);if(!i||!i.dem)return null;const l=i.dem.tree,h=i.tileID,p=1<<c.canonical.z-h.canonical.z;let _=c.canonical.x/p-h.canonical.x,y=c.canonical.y/p-h.canonical.y,w=0;for(let S=0;S<c.canonical.z-h.canonical.z&&!l.leaves[w];S++){_*=2,y*=2;const R=2*Math.floor(y)+Math.floor(_);w=l.childOffsets[w]+R,_%=1,y%=1}return{min:this.exaggeration()*l.minimums[w],max:this.exaggeration()*l.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,i,l){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let i=!1,l=Number.MAX_VALUE,h=Number.MIN_VALUE;for(const p of c){const _=this.getMinMaxForTile(p.tileID);_&&(l=Math.min(l,_.min),h=Math.max(h,_.max),i=!0)}return i?{min:l,max:h}:null}},s.bW=hS,s.bX=Ri,s.bY=mo,s.bZ=CN,s.b_=B7,s.ba=WI,s.bb=TI,s.bc=Fe,s.bd=kh,s.be=Rh,s.bf=Kp,s.bg=ta,s.bh=Qy,s.bi=f6,s.bj=function(c,i){const l=Jp(i.zoom);if(l===0)return gc(c);const h=tS(c),p=hI(h),_=I(h.getWest())*i.worldSize,y=I(h.getEast())*i.worldSize,w=M(h.getNorth())*i.worldSize,S=M(h.getSouth())*i.worldSize,R=[_,w,0],O=[y,w,0],D=[_,S,0],z=[y,S,0],V=G([],i.globeMatrix);return nn(R,R,V),nn(O,O,V),nn(D,D,V),nn(z,z,V),p[0]=Nd(p[0],D,l),p[1]=Nd(p[1],z,l),p[2]=Nd(p[2],O,l),p[3]=Nd(p[3],R,l),Dn.fromPoints(p)},s.bk=rS,s.bl=G,s.bm=Cb,s.bn=Nd,s.bo=Hp,s.bp=cg,s.bq=ve,s.br=X,s.bs=WS,s.bt=TS,s.bu=xd,s.bv=function(c,i){const l=[];for(const h in c)h in i||l.push(h);return l},s.bw=De,s.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.by=or,s.bz=U,s.c=xo,s.c$=function(c,i,l){let h=0;for(let p=0;p<2;++p)c[p]>0&&(h+=(c[p]-0)*(c[p]-0)),i[p]<0&&(h+=(0-i[p])*(0-i[p]));return h},s.c0=PN,s.c1=JI,s.c2=c7,s.c3=o6,s.c4=k6,s.c5=ze,s.c6=ws,s.c7=tn,s.c8=function(c,i,l){l*=.5;var h=i[0],p=i[1],_=i[2],y=i[3],w=Math.sin(l),S=Math.cos(l);return c[0]=h*S+p*w,c[1]=p*S-h*w,c[2]=_*S+y*w,c[3]=y*S-_*w,c},s.c9=kn,s.cA=ft,s.cB=Ni,s.cC=gz,s.cD=_s,s.cE=WD,s.cF=function(c,i,l,h,p,_,y,w,S){if(S.name==="globe")return WD(c,i,new _s(l,h,p),!1);const R=Qb({z:l,x:h,y:p},S);return new Dn([(_+R.x/R.scale)*i,i*(R.y/R.scale),y],[(_+R.x2/R.scale)*i,i*(R.y2/R.scale),w])},s.cG=function(c,i,l){return c[0]=Math.min(i[0],l[0]),c[1]=Math.min(i[1],l[1]),c[2]=Math.min(i[2],l[2]),c[3]=Math.min(i[3],l[3]),c},s.cH=function(c,i,l){return c[0]=Math.max(i[0],l[0]),c[1]=Math.max(i[1],l[1]),c[2]=Math.max(i[2],l[2]),c[3]=Math.max(i[3],l[3]),c},s.cI=function(c){const i=Math.round((c+45+360)%360/90)%4;return Sr[i]},s.cJ=Y,s.cK=Ai,s.cL=Ky,s.cM=function(c){const i=q(new Float64Array(16));$(i,c.pixelMatrix,c.globeMatrix);const l=[0,Fu,0],h=[0,Bu,0];return nn(l,l,i),nn(h,h,i),[l[0]>0&&l[0]<=c.width&&l[1]>0&&l[1]<=c.height&&!mI(c,new d(c.center.lat,90)),h[0]>0&&h[0]<=c.width&&h[1]>0&&h[1]<=c.height&&!mI(c,new d(c.center.lat,-90))]},s.cN=function(c,i){const{scale:l}=c.tileTransform,h=l*Qt/(c.tileSize*Math.pow(2,i.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return function(p,_,y){var w=_[1],S=_[2],R=_[3],O=y[0],D=y[1];return p[0]=_[0]*O,p[1]=w*O,p[2]=S*D,p[3]=R*D,p}(new Float32Array(4),i.inverseAdjustmentMatrix,[h,h])},s.cO=_S,s.cP=Je,s.cQ=mz,s.cR=function(c){const i=mz(c,!0);return A([],[i[0],i[1],i[4],i[5]])},s.cS=ie,s.cT=pn,s.cU=de,s.cV=function(c){const{x:i,y:l}=c.point,{lng:h,lat:p}=c._center;return YD(i,l,c.worldSize,h,p)},s.cW=Pe,s.cX=ti,s.cY=ra,s.cZ=jo,s.c_=zu,s.ca=Wi,s.cb=function(c,i){return c[0]=-i[0],c[1]=-i[1],c[2]=-i[2],c[3]=i[3],c},s.cc=qe,s.cd=function(c,i,l,h,p){var _=1/Math.tan(i/2);if(c[0]=_/l,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=_,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,p!=null&&p!==1/0){var y=1/(h-p);c[10]=(p+h)*y,c[14]=2*p*h*y}else c[10]=-1,c[14]=-2*h;return c},s.ce=function(c,i,l,h,p,_,y){var w=1/(i-l),S=1/(h-p),R=1/(_-y);return c[0]=-2*w,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*S,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*R,c[11]=0,c[12]=(i+l)*w,c[13]=(p+h)*S,c[14]=(y+_)*R,c[15]=1,c},s.cf=N,s.cg=function(c,i,l){c[4*i+0]=l[0],c[4*i+1]=l[1],c[4*i+2]=l[2],c[4*i+3]=l[3]},s.ch=Wy,s.ci=ig,s.cj=Za,s.ck=Yc,s.cl=ag,s.cm=b7,s.cn=function(){var c=new x(4);return x!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c},s.co=function(c,i,l){var h=i[0],p=i[1],_=i[2],y=i[3],w=Math.sin(l),S=Math.cos(l);return c[0]=h*S+_*w,c[1]=p*S+y*w,c[2]=h*-w+_*S,c[3]=p*-w+y*S,c},s.cp=function(c,i){return c[0]===i[0]&&c[1]===i[1]&&c[2]===i[2]&&c[3]===i[3]},s.cq=tr,s.cr=function(c){var i=c[0],l=c[1],h=c[2],p=c[3];return Math.sqrt(i*i+l*l+h*h+p*p)},s.cs=dt,s.ct=Xr,s.cu=La,s.cv=3,s.cw=2,s.cx=7,s.cy=6,s.cz=Un,s.d=function(c){return ri.API_TILEJSON_REGEX.test(c)},s.d$=class{constructor(c,i,l,h){this.context=c,this.format=h,this.size=l,this.texture=c.gl.createTexture();const[p,_,y]=this.size,{gl:w}=c;w.bindTexture(w.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in i&&i.data&&w.texImage3D(w.TEXTURE_3D,0,this.format,p,_,y,0,NI(this.format),zI(this.format),i.data)}bind(c,i){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_3D,this.texture),c!==this.minFilter&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MAG_FILTER,c),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MIN_FILTER,c),this.minFilter=c),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},s.d0=function(c){return c*c*c*c*c},s.d1=E,s.d2=45,s.d3=Zy,s.d4=function(c,i,l){const h=Math.sqrt(c*c+i*i+l*l),p=h>0?Math.acos(l/h)*Yn:0;let _=c!==0||i!==0?Math.atan2(-i,-c)*Yn+90:0;return _<0&&(_+=360),[h,_,p]},s.d5=Nt,s.d6=Ar,s.d7=ae,s.d8=tt,s.d9=Dn,s.dA=function(c){return c({pluginStatus:_l,pluginURL:Cd}),Sy.on("pluginStateChange",c),c},s.dB=sg,s.dC=class extends Rd{constructor(c){super(c),this.current=Xy}set(c,i,l){if(this.fetchUniformLocation(c,i)){for(let h=0;h<9;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},s.dD=Mi,s.dE=function(c,i,l){const h=Jp(l.zoom),p=c.style.map._antialias,_=c.terrain&&c.terrain.exaggeration()>0;return h===0&&!p&&!_},s.dF=function(c){const i=c.pixelsPerMeter,l=i/N(1,c.center.lat),h=q(new Float64Array(16));return X(h,h,[c.point.x,c.point.y,0]),ie(h,h,[l,l,i]),Float32Array.from(h)},s.dG=tS,s.dH=function(c){const i=Y-5;c=ee(c,-i,i)/i*90;const l=Math.pow(Math.abs(Math.sin(Tn(c))),3);return Math.round(l*(Ab.length-1))},s.dI=function(c,i,l,h){const p=i.getNorth(),_=i.getSouth(),y=i.getWest(),w=i.getEast(),S=1<<c.z,R=w-y,O=p-_,D=R/Xp,z=-O/Ab[l],V=[0,D,0,z,0,0,p,y,0];if(c.z>0){const H=180/h;L(V,V,[H/R+1,0,0,0,H/O+1,0,-.5*H/D,.5*H/z,1])}return V[2]=S,V[5]=c.x,V[8]=c.y,V},s.dJ=gc,s.dK=function(c,i,l){const h=q(new Float64Array(16)),p=(i/(1<<c)-.5)*Math.PI*2;return fe(h,l.globeMatrix,p),Float32Array.from(h)},s.dL=uN,s.dM=Kc,s.dN=function(c,i){return[Math.pow(c[0],2.2)*i,Math.pow(c[1],2.2)*i,Math.pow(c[2],2.2)*i]},s.dO=C,s.dP=function(c,i){var l=Math.sin(i),h=Math.cos(i);return c[0]=h,c[1]=l,c[2]=0,c[3]=-l,c[4]=h,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},s.dQ=wr,s.dR=XD,s.dS=li,s.dT=Is,s.dU=256,s.dV=function(c,i){const l=[0,0,0];return nn(l,l,rS(gc(i.canonical))),nn(l,l,c),l},s.dW=c=>({u_matrix:new ag(c),u_texsize:new Yc(c),u_pixels_to_tile_units:new Yy(c),u_device_pixel_ratio:new Za(c),u_width_scale:new Za(c),u_floor_width_scale:new Za(c),u_image:new Wy(c),u_units_to_pixels:new Yc(c),u_tile_units_to_pixels:new Za(c),u_alpha_discard_threshold:new Za(c),u_trim_offset:new Yc(c),u_trim_fade_range:new Yc(c),u_trim_color:new Zy(c),u_zbias_factor:new Za(c),u_tile_to_meter:new Za(c),u_ground_shadow_factor:new ig(c),u_pattern_transition:new Za(c)}),s.dX=c=>({u_matrix:new ag(c),u_pixels_to_tile_units:new Yy(c),u_device_pixel_ratio:new Za(c),u_width_scale:new Za(c),u_floor_width_scale:new Za(c),u_units_to_pixels:new Yc(c),u_dash_image:new Wy(c),u_gradient_image:new Wy(c),u_image_height:new Za(c),u_texsize:new Yc(c),u_tile_units_to_pixels:new Za(c),u_alpha_discard_threshold:new Za(c),u_trim_offset:new Yc(c),u_trim_fade_range:new Yc(c),u_trim_color:new Zy(c),u_zbias_factor:new Za(c),u_tile_to_meter:new Za(c),u_ground_shadow_factor:new ig(c)}),s.dY=c=>({u_camera_to_center_distance:new Za(c),u_extrude_scale:new Yy(c),u_device_pixel_ratio:new Za(c),u_matrix:new ag(c),u_inv_rot_matrix:new ag(c),u_merc_center:new Yc(c),u_tile_id:new ig(c),u_zoom_transition:new Za(c),u_up_dir:new ig(c),u_emissive_strength:new Za(c)}),s.dZ=Fy,s.d_=zie,s.da=mt,s.db=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},s.dc=pz,s.dd=HI,s.de=vz,s.df=m6,s.dg=function(c,i){return c.readFields(Nse,{icons:[]},i)},s.dh=fS,s.di=u1,s.dj=i6,s.dk=B_,s.dl=Q0,s.dm=Ap,s.dn=U_,s.dp=bt,s.dq=function(c){const i=c.indexOf(Lf);return i>=0?c.slice(0,i):c},s.dr=function(c){return c.indexOf(Lf)>=0},s.ds=function(c){const i=c.lastIndexOf(Lf);return i>=0?c.slice(i+1):""},s.dt=function(c){const i=[],l=c.id;return l===void 0&&i.push({message:`layers.${l}: missing required property "id"`}),c.render===void 0&&i.push({message:`layers.${l}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},s.du=function(c,i,l,h){return c.type==="custom"?new Ise(c,i):new Lse[c.type](c,i,l,h)},s.dv=Rt,s.dw=function(c){const i=c.indexOf(Lf);return i>=0?c.slice(i+1):""},s.dx=class extends yg{constructor(c,i){super(c._vectorTileFeature,c._z,c._x,c._y,c.id),c.state&&(this.state=Object.assign({},c.state)),this.target=i.target,this.namespace=i.namespace,i.properties&&(this.properties=i.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=c.source,this.sourceLayer=c.sourceLayer,this.layer=c.layer)}toJSON(){const c=super.toJSON();return c.target=this.target,c.namespace=this.namespace,c}},s.dy=Sy,s.dz=bf,s.e=ri,s.e$=Kt,s.e0=JD,s.e1=(c,i,l,h,p,_)=>{const y=c.transform,w=y.projection.name==="globe";let S;if(_.paint.get("circle-pitch-alignment")==="map")if(w){const O=XD(y.zoom,i.canonical)*y._pixelsPerMercatorPixel;S=Float32Array.from([O,0,0,O])}else S=y.calculatePixelsToTileUnitsMatrix(l);else S=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(y.projection),u_matrix:c.translatePosMatrix(i.projMatrix,l,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:fo.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:Jne,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:_.paint.get("circle-emissive-strength")};if(w){R.u_inv_rot_matrix=h,R.u_merc_center=p,R.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],R.u_zoom_transition=Jp(y.zoom);const O=p[0]*Qt,D=p[1]*Qt;R.u_up_dir=y.projection.upVector(new _s(0,0,0),O,D)}return R},s.e2=Dz,s.e3=ml,s.e4=(c,i,l,h,p,_,y,w,S,R)=>{const O=c.transform,D=O.pitch<15?Pz(.07,.7,ee((14-O.zoom)/5,0,1)):.07,z=l.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Lz(c,i,l,h),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:O.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:p,u_width_scale:_,u_floor_width_scale:y,u_image:0,u_tile_units_to_pixels:Oz(i,O),u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toPremultipliedRenderColor(z?null:l.lut).toArray01(),u_zbias_factor:D,u_tile_to_meter:ae(i.tileID.canonical,0),u_ground_shadow_factor:S,u_pattern_transition:R}},s.e5=(c,i,l,h,p,_,y,w,S,R)=>{const O=c.transform,D=O.calculatePixelsToTileUnitsMatrix(i),z=l.paint.get("line-trim-color-use-theme").constantOr("default")==="none",V=O.pitch<15?Pz(.07,.7,ee((14-O.zoom)/5,0,1)):.07;return{u_matrix:Lz(c,i,l,h),u_pixels_to_tile_units:D,u_device_pixel_ratio:_,u_width_scale:y,u_floor_width_scale:w,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:Nz(l)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Oz(i,c.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:l.paint.get("line-trim-fade-range"),u_trim_color:l.paint.get("line-trim-color").toPremultipliedRenderColor(z?null:l.lut).toArray01(),u_zbias_factor:V,u_tile_to_meter:ae(i.tileID.canonical,0),u_ground_shadow_factor:R}},s.e6=st,s.e7=kb,s.e8=W,s.e9=Uu,s.eA=function(c,i){var l=2*Math.acos(i[3]),h=Math.sin(l/2);return h>v?(c[0]=i[0]/h,c[1]=i[1]/h,c[2]=i[2]/h):(c[0]=1,c[1]=0,c[2]=0),l},s.eB=y6,s.eC=xS,s.eD=vS,s.eE=[1,1,1],s.eF=f1,s.eG=bi,s.eH=function(c,i,l,h){var p=i[0],_=i[1],y=i[2],w=i[3];return c[0]=p+h*(l[0]-p),c[1]=_+h*(l[1]-_),c[2]=y+h*(l[2]-y),c[3]=w+h*(l[3]-w),c},s.eI=i1,s.eJ=du,s.eK=Xc,s.eL=function(c,i,l,h,p,_,y,w,S,R,O,D,z,V,H,K){var re=new x(16);return re[0]=c,re[1]=i,re[2]=l,re[3]=h,re[4]=p,re[5]=_,re[6]=y,re[7]=w,re[8]=S,re[9]=R,re[10]=O,re[11]=D,re[12]=z,re[13]=V,re[14]=H,re[15]=K,re},s.eM=m,s.eN=Wp,s.eO=gb,s.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ve(1/0,1/0),max:new Ve(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,i=!1){const l=IN(new Ve(0,0),new Ve(Qt,Qt),c),h=[];if(i&&!EI(l,this._globalClipBounds))return h;for(const p of this._activeRegions){if(p.hiddenByOverlap||!EI(l,p))continue;const _=kre(p.min,p.max,c);h.push({min:_.min,max:_.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return h}setSources(c){this._setSources(c.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const l=[];for(const h of i.cache.getVisibleCoordinates()){const p=i.cache.getTile(h).buckets[i.layer];p&&p.updateFootprints(h.toUnwrapped(),l)}return l},getOrder:()=>i.order,getClipMask:()=>i.clipMask,getClipScope:()=>i.clipScope})))}_addSource(c){const i=c.getFootprints();if(i.length===0)return;const l=c.getOrder(),h=c.getClipMask(),p=c.getClipScope();for(const _ of i){if(!_.footprint)continue;const y=IN(_.footprint.min,_.footprint.max,_.id);this._activeRegions.push({min:y.min,max:y.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:_.id,footprint:_.footprint,order:l,clipMask:h,clipScope:p})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((i,l)=>i.priority-l.priority||lS(i.min,l.min)||lS(i.max,l.max)||i.order-l.order||i.clipMask-l.clipMask||function(h,p){const _=(y,w)=>y+w;return h.length-p.length||h.reduce(_,"").localeCompare(p.reduce(_,""))}(i.clipScope,l.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let i=0;for(;!c&&i!==this._activeRegions.length;){const l=this._activeRegions[i],h=this._prevRegions[i];c=l.priority!==h.priority||!kN(l,h)||l.order!==h.order||l.clipMask!==h.clipMask||!or(l.clipScope,h.clipScope),this._activeRegions[i].hiddenByOverlap=h.hiddenByOverlap,++i}}if(c){++this._updateTime;for(const l of this._activeRegions)l.order!==Lb&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,l.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,l.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,l.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,l.max.y));const i=l=>{const h=this._activeRegions;if(l>=h.length)return l;const p=h[l].priority;for(;l<h.length&&h[l].priority===p;)++l;return l};if(this._sourceIds.length>1){let l=0,h=i(l);for(;l!==h;){let p=l;const _=l;for(;p!==h;){const y=this._activeRegions[p];y.hiddenByOverlap=!1;for(let w=0;w<_;w++){const S=this._activeRegions[w];if(!S.hiddenByOverlap&&y.order===Lb&&EI(y,S)&&(y.hiddenByOverlap=RN(y.footprint,y.tileId,S.footprint,S.tileId),y.hiddenByOverlap))break}++p}l=h,h=i(l)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=c.length-1;i>=0;i--)this._addSource(c[i]);this._computeReplacement()}},s.eQ=Lb,s.eR=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,i){const l=new kh,h=new Wa,p=[],_=c+1+2,y=i[0]+1,w=i[0]+1+(1+i.length),S=(R,O,D)=>{let z=R===_-1?R-2:R===0?R:R-1;return z+=D?24575:0,[z,O]};for(let R=0;R<_;++R)l.emplaceBack(...S(R,0,!0));for(let R=0;R<y;++R)for(let O=0;O<_;++O)l.emplaceBack(...S(O,R,(O===0||O===_-1)&&!0));for(let R=0;R<i.length;++R){const O=i[R];for(let D=0;D<_;++D)l.emplaceBack(...S(D,O,!0))}for(let R=0;R<i.length;++R){const O=h.length,D=i[R]+1+2,z=new Wa;for(let K=0;K<D-1;K++){const re=K===D-2,ne=re?_*(w-i.length+R-K):_;for(let ue=0;ue<_-1;ue++){const he=K*_+ue;K===0||re||ue===0||ue===_-2?(z.emplaceBack(he+1,he,he+ne),z.emplaceBack(he+ne,he+ne+1,he+1)):(h.emplaceBack(he+1,he,he+ne),h.emplaceBack(he+ne,he+ne+1,he+1))}}const V=ta.simpleSegment(0,O,l.length,h.length-O);for(let K=0;K<z.uint16.length;K+=3)h.emplaceBack(z.uint16[K],z.uint16[K+1],z.uint16[K+2]);const H=ta.simpleSegment(0,O,l.length,h.length-O);p.push({withoutSkirts:V,withSkirts:H})}return{vertices:l,indices:h,segments:p}}_createGrid(c){const i=this._fillGridMeshWithLods(Xp,Ab);this._gridSegments=i.segments,this._gridBuffer=c.createVertexBuffer(i.vertices,Kp.members),this._gridIndexBuffer=c.createIndexBuffer(i.indices,!0)}_createPoles(c){const i=new Wa;for(let y=0;y<=Xp;y++)i.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=c.createIndexBuffer(i,!0);const l=new Nf,h=new Nf,p=new Nf,_=new Nf;this._poleSegments=[];for(let y=0,w=0;y<zu;y++){const S=360/(1<<y);l.emplaceBack(0,-Yo,0,.5,0),h.emplaceBack(0,-Yo,0,.5,1),p.emplaceBack(0,-Yo,0,.5,.5),_.emplaceBack(0,-Yo,0,.5,.5);for(let R=0;R<=Xp;R++){let O=R/Xp,D=0;const z=br(0,S,O),[V,H,K]=zf(Kne,Qne,z,Yo);l.emplaceBack(V,H,K,O,D),h.emplaceBack(V,H,K,O,1-D);const re=Tn(z);O=.5+.5*Math.sin(re),D=.5+.5*Math.cos(re),p.emplaceBack(V,H,K,O,D),_.emplaceBack(V,H,K,O,1-D)}this._poleSegments.push(ta.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(l,mc,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(h,mc,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(p,mc,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(_,mc,!1)}getGridBuffers(c,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},s.eS=AN,s.eT=da,s.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eV=Ze,s.eW=oe,s.eX=function(c,i,l){return c[0]=i[0]/l[0],c[1]=i[1]/l[1],c[2]=i[2]/l[2],c},s.eY=xr,s.eZ=Yp,s.e_=Nn,s.ea=dS,s.eb=qN,s.ec=Bf,s.ed=NN,s.ee=DN,s.ef=J,s.eg=function(c,i){if(c===i){var l=i[1],h=i[2],p=i[3],_=i[6],y=i[7],w=i[11];c[1]=i[4],c[2]=i[8],c[3]=i[12],c[4]=l,c[6]=i[9],c[7]=i[13],c[8]=h,c[9]=_,c[11]=i[14],c[12]=p,c[13]=y,c[14]=w}else c[0]=i[0],c[1]=i[4],c[2]=i[8],c[3]=i[12],c[4]=i[1],c[5]=i[5],c[6]=i[9],c[7]=i[13],c[8]=i[2],c[9]=i[6],c[10]=i[10],c[11]=i[14],c[12]=i[3],c[13]=i[7],c[14]=i[11],c[15]=i[15];return c},s.eh=kse,s.ei=ui,s.ej=yb,s.ek=256,s.el=fI,s.em=cu,s.en=fe,s.eo=function(c,i){return c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[4],c[4]=i[5],c[5]=i[6],c[6]=i[8],c[7]=i[9],c[8]=i[10],c},s.ep=Nf,s.eq=wE,s.er=mb,s.es=function(c,i,l,h,p){return ee((c-i)/(l-i)*(p-h)+h,h,p)},s.et=Mr,s.eu=function(c,i){var l=i[0],h=i[1],p=i[2],_=i[3],y=i[4],w=i[5],S=i[6],R=i[7],O=i[8],D=O*y-w*R,z=-O*_+w*S,V=R*_-y*S,H=l*D+h*z+p*V;return H?(c[0]=D*(H=1/H),c[1]=(-O*h+p*R)*H,c[2]=(w*h-p*y)*H,c[3]=z*H,c[4]=(O*l-p*S)*H,c[5]=(-w*l+p*_)*H,c[6]=V*H,c[7]=(-R*l+h*S)*H,c[8]=(y*l-h*_)*H,c):null},s.ev=2,s.ew=bn,s.ex=Ts,s.ey=we,s.ez=function(c,i){var l=new x(3);we(l,i);var h=1/l[0],p=1/l[1],_=1/l[2],y=i[0]*h,w=i[1]*p,S=i[2]*_,R=i[4]*h,O=i[5]*p,D=i[6]*_,z=i[8]*h,V=i[9]*p,H=i[10]*_,K=y+O+H,re=0;return K>0?(re=2*Math.sqrt(K+1),c[3]=.25*re,c[0]=(D-V)/re,c[1]=(z-S)/re,c[2]=(w-R)/re):y>O&&y>H?(re=2*Math.sqrt(1+y-O-H),c[3]=(D-V)/re,c[0]=.25*re,c[1]=(w+R)/re,c[2]=(z+S)/re):O>H?(re=2*Math.sqrt(1+O-y-H),c[3]=(z-S)/re,c[0]=(w+R)/re,c[1]=.25*re,c[2]=(D+V)/re):(re=2*Math.sqrt(1+H-y-O),c[3]=(w-R)/re,c[0]=(z+S)/re,c[1]=(D+V)/re,c[2]=.25*re),c},s.f=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(i,l)=>String.fromCharCode(+("0x"+l))))},s.f0=function([c,i,l]){const h=Math.hypot(c,i,l),p=Math.atan2(c,l),_=.5*Math.PI-Math.acos(-i/h);return new d(ti(p),ti(_))},s.f1=ps,s.f2=BI,s.f3=function(c){const i=c.navigator?c.navigator.userAgent:null;return!!function(l){if(ds==null){const h=l.navigator?l.navigator.userAgent:null;ds=!!l.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return ds}(c)&&!(!i||!(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.f4=function(c,i){D_=c,N_=i},s.f5=mI,s.f6=KD,s.f7=function(c){const i=[0,0,0],l=q(new Float64Array(16));return $(l,c.pixelMatrix,c.globeMatrix),nn(i,i,l),new Ve(i[0],i[1])},s.f8=function(){const c=jb;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(RI),jb=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.f9=function(){fS().acquire(RI)},s.fA=qS,s.fB=He,s.fC=function(c){let i=0;if(new Uint32Array(c,0,1)[0]!==uz){const l=new Uint32Array(c,0,7),[,,h,p,_,y]=l;i=l.byteLength+p+_+y+_,(h!==c.byteLength||i>=c.byteLength)&&un("Invalid b3dm header information.")}return fz(c,i)},s.fD=function(c,i){const l=HI(c);for(const h of l){for(const p of h.meshes)sie(p);h.lights&&(h.lightMeshIndex=h.meshes.length,h.meshes.push(aie(h.lights,i)))}return l},s.fE=jS,s.fF=ni,s.fG=iz,s.fH=kd,s.fI=Hl,s.fJ=function(c){lc(),Bc!=null&&Bc.then(i=>{i.keys().then(l=>{for(let h=0;h<l.length-c;h++)i.delete(l[h]).catch(p=>un(p.message))}).catch(l=>un(l.message))}).catch(i=>un(i.message))},s.fa=J0,s.fb=function(c,i,l=!1){if(_l===Hl.deferred||_l===Hl.loading||_l===Hl.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Cd=fo.resolveURL(c),_l=Hl.deferred,sb=i,Ey(),l||LE()},s.fc=function(c){t1=fo.resolveURL(c),n1||(n1=new e1(fS(),new wf)),n1.broadcast("setMeshoptUrl",t1)},s.fd=oz,s.fe=function(c){OI=fo.resolveURL(c),n1||(n1=new e1(fS(),new wf)),n1.broadcast("setDracoUrl",OI)},s.ff=az,s.fg=Bb,s.fh=function(c){const i=oc();if(!i)return;const l=i.delete(L_);c&&l.then(()=>c()).catch(c)},s.fi=fg,s.fj=An,s.fk=em,s.fl=Bd,s.fm=A9,s.fn=C9,s.fo=kz,s.fp=_t,s.fq="hd_road_elevation",s.fr=Hi,s.fs=nt,s.ft=Ff,s.fu=r6,s.fv=gg,s.fw=function(c,i,l,h,p,_,y,w=1,S,R,O){c.createArrays(),c.tilePixelRatio=Qt/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const D=c.layers[0].layout,z=c.layers[0]._unevaluatedLayout._values,V={};V.scaleFactor=w,V.textSizeScaleRange=D.get("text-size-scale-range"),V.iconSizeScaleRange=D.get("icon-size-scale-range");const[H,K]=V.textSizeScaleRange,[re,ne]=V.iconSizeScaleRange;V.textScaleFactor=ee(V.scaleFactor,H,K),V.iconScaleFactor=ee(V.scaleFactor,re,ne);const ue=z["text-size"],he=z["icon-size"];if(c.textSizeData.kind==="composite"){const{minZoom:$e,maxZoom:pt}=c.textSizeData;V.compositeTextSizes=[ue.possiblyEvaluate(new Rs($e,{worldview:O}),_),ue.possiblyEvaluate(new Rs(pt,{worldview:O}),_)]}if(c.iconSizeData.kind==="composite"){const{minZoom:$e,maxZoom:pt}=c.iconSizeData;V.compositeIconSizes=[he.possiblyEvaluate(new Rs($e,{worldview:O}),_),he.possiblyEvaluate(new Rs(pt,{worldview:O}),_)]}V.layoutTextSize=ue.possiblyEvaluate(new Rs(y+1,{worldview:O}),_),V.layoutIconSize=he.possiblyEvaluate(new Rs(y+1,{worldview:O}),_),V.textMaxSize=ue.possiblyEvaluate(new Rs(18,{worldview:O}),_);const ge=D.get("symbol-placement"),ke=D.get("text-rotation-alignment")==="map"&&ge!=="point",Ee=D.get("text-size");let Me=!1;const Be=[];for(const $e of c.features){const pt=D.get("text-font").evaluate($e,{},_).join(","),Ye=Ee.evaluate($e,{},_)*V.textScaleFactor,vt=V.layoutTextSize.evaluate($e,{},_)*V.textScaleFactor,kt=V.layoutIconSize.evaluate($e,{},_)*V.iconScaleFactor,It={horizontal:{},vertical:void 0},Ft=$e.text;let jt,Lt=[0,0];if(Ft){const Fr=Ft.toString(),os=D.get("text-letter-spacing").evaluate($e,{},_)*mo,Se=D.get("text-line-height").evaluate($e,{},_)*mo,Ie=rb(Fr)?os:0,xt=D.get("text-anchor").evaluate($e,{},_),Bt=D.get("text-variable-anchor");if(!Bt){const Dr=D.get("text-radial-offset").evaluate($e,{},_);if(Dr)Lt=c7(xt,[Dr*mo,a6]);else{const $r=D.get("text-offset").evaluate($e,{},_);Lt=[$r[0]*mo,$r[1]*mo]}}let cn=ke?"center":D.get("text-justify").evaluate($e,{},_);const dn=ge==="point",Bn=dn?D.get("text-max-width").evaluate($e,{},_)*mo:1/0,Wn=Dr=>{c.allowVerticalPlacement&&K0(Fr)&&(It.vertical=QI(Ft,i,l,p,pt,Bn,Se,xt,Dr,Ie,Lt,pu.vertical,!0,vt,Ye,S))};if(!ke&&Bt){const Dr=cn==="auto"?Bt.map(Wr=>o6(Wr)):[cn];let $r=!1;for(let Wr=0;Wr<Dr.length;Wr++){const ci=Dr[Wr];if(!It.horizontal[ci])if($r)It.horizontal[ci]=It.horizontal[0];else{const yr=QI(Ft,i,l,p,pt,Bn,Se,"center",ci,Ie,Lt,pu.horizontal,!1,vt,Ye,S);yr&&(It.horizontal[ci]=yr,$r=yr.positionedLines.length===1)}}Wn("left")}else{if(cn==="auto"&&(cn=o6(xt)),dn||D.get("text-writing-mode").indexOf("horizontal")>=0||!K0(Fr)){const Dr=QI(Ft,i,l,p,pt,Bn,Se,xt,cn,Ie,Lt,pu.horizontal,!1,vt,Ye,S);Dr&&(It.horizontal[cn]=Dr)}Wn(dn?"left":cn)}}let Dt,yt,gt,zt,Jt,Gt,Fn=!1;const mn=D.get("icon-text-fit").evaluate($e,{},_);if($e.icon&&$e.icon.hasPrimary()){const Fr=Yb($e.icon,c.iconSizeData,z["icon-size"],_,c.zoom,$e,S,V.iconScaleFactor,O);Dt=Fr.iconPrimary,gt=Fr.iconSecondary;const os=Dt.toString();if(yt=h.get(os),yt&&(Jt=D.get("icon-offset").evaluate($e,{},_),Gt=D.get("icon-anchor").evaluate($e,{},_),jt=SS(p.get(os),gt?p.get(gt.toString()):void 0,Jt,Gt),Fn=yt.sdf,c.sdfIcons===void 0?c.sdfIcons=yt.sdf:c.sdfIcons!==yt.sdf&&un("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(yt.pixelRatio!==c.pixelRatio||D.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0)),gt){const Se=gt.toString();zt=h.get(Se)}}Me=Me||!(!$e.icon||!$e.icon.hasSecondary());const xn=RS(It.horizontal)||It.vertical;c.iconsInText||(c.iconsInText=!!xn&&xn.iconsInText);const Pn=vt*V.textScaleFactor/mo,{defaultShapedIcon:Yr,verticallyShapedIcon:Wt}=pse(c,jt,D,$e,_,It,Pn,Jt,mn);mn!=="none"&&jt&&(Xz(jt)||Yz(jt))&&(IS(0,yt,Dt,jt,Yr,mn,R,h,p),IS(0,zt,gt,jt,Yr,mn,R,h,p),Wt&&(IS(0,yt,Dt,jt,Wt,mn,R,h,p),IS(0,zt,gt,jt,Wt,mn,R,h,p))),jt=Yr;const{iconBBox:On,iconVerticalBBox:Rr,textBBox:fi,textVerticalBBox:xi}=use(c,jt,Wt,D,$e,_,kt,Jt,V,p,Gt,It,vt,Lt);Be.push({feature:$e,shapedTextOrientations:It,shapedText:xn,shapedIcon:jt,iconPrimary:Dt,iconSecondary:gt,iconOffset:Jt,iconAnchor:Gt,verticallyShapedIcon:Wt,layoutTextSize:vt,layoutIconSize:kt,textOffset:Lt,isSDFIcon:Fn,iconTextFit:mn,iconCollisionBounds:On,iconVerticalCollisionBounds:Rr,textCollisionBounds:fi,textVerticalCollisionBounds:xi})}return{featureData:Be,sizes:V,hasAnySecondaryIcon:Me,textAlongLine:ke,symbolPlacement:ge}},s.fx=i7,s.fy=function(c,i,l,h,p,_,y,w,S,R){c.iconAtlasPositions=R.iconPositions;const{featureData:O,hasAnySecondaryIcon:D,sizes:z,textAlongLine:V,symbolPlacement:H}=i;for(const K of O){const{shapedIcon:re,verticallyShapedIcon:ne,feature:ue,shapedTextOrientations:he,shapedText:ge,layoutTextSize:ke,textOffset:Ee,isSDFIcon:Me,iconPrimary:Be,iconSecondary:$e,iconTextFit:pt,iconOffset:Ye,iconCollisionBounds:vt,iconVerticalCollisionBounds:kt,textCollisionBounds:It}=K;h7(re,R.iconPositions,Be,$e),h7(ne,R.iconPositions,Be,$e),fse(he,R.iconPositions),hse(Be,$e,R.iconPositions),(ge||re)&&mse(c,ue,he,re,ne,S,z,ke,0,Ee,Me,h,p,y,w,D,pt,Ye,V,H,vt,kt,It)}l&&c.generateCollisionDebugBuffers(_,c.collisionBoxArray,z.textScaleFactor)},s.fz=rt,s.g=function(c,i){return bf(Object.assign(c,{method:"GET"}),i)},s.h=function(c){return c.indexOf("mapbox:")===0},s.i=function(c){return ri.API_STYLE_REGEX.test(c)&&!xo(c)},s.j=ha,s.k=jc,s.l=function(c){return decodeURIComponent(atob(c).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.m=function(c,i){return bf(Object.assign(c,{type:"json"}),i)},s.n=j_,s.o=fo,s.p=function(c,i){return bf(Object.assign(c,{method:"POST"}),i)},s.q=Jo,s.r=Fc,s.s=function(c){try{const i=self[c];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=function(){return MI||(MI=new fg("ImageRasterizer")),MI},s.u=function(){return function c(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},s.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},s.w=un,s.x=E6,s.y=M0,s.z=Uc}),u(["./shared"],function(s){function v(Ze){const ee=Ze?Ze.url.toString():void 0;return ee?performance.getEntriesByName(ee):[]}function x(Ze){if(typeof Ze=="number"||typeof Ze=="boolean"||typeof Ze=="string"||Ze==null)return JSON.stringify(Ze);if(Array.isArray(Ze)){let le="[";for(const ye of Ze)le+=`${x(ye)},`;return`${le}]`}let ee="{";for(const le of Object.keys(Ze).sort())ee+=`${le}:${x(Ze[le])},`;return`${ee}}`}function A(Ze){let ee="";for(const le of s.bx)ee+=`/${x(Ze[le])}`;return ee}class C{constructor(ee){this.keyCache={},this._layers={},this._layerConfigs={},ee&&this.replace(ee)}replace(ee,le){this._layerConfigs={},this._layers={},this.update(ee,[],le)}update(ee,le,ye){this._options=ye;for(const Oe of ee)this._layerConfigs[Oe.id]=Oe,(this._layers[Oe.id]=s.du(Oe,this.scope,null,this._options)).compileFilter(ye),this.keyCache[Oe.id]&&delete this.keyCache[Oe.id];for(const Oe of le)delete this.keyCache[Oe],delete this._layerConfigs[Oe],delete this._layers[Oe];this.familiesBySource={};const De=function(Oe,je){const st={};for(let nt=0;nt<Oe.length;nt++){const Rt=Oe[nt];let bt=je&&je[Rt.id];bt||(Rt.type==="symbol"?bt=Rt.id:(bt=A(Rt),Rt.type==="line"&&Rt.paint&&function wn(un){return typeof un=="string"&&un==="line-progress"||(Array.isArray(un)?un.some(wn):!(!un||typeof un!="object")&&Object.values(un).some(wn))}(Rt.paint["line-width"])&&(bt+=`/${x(Rt.paint["line-width"])}`))),je&&(je[Rt.id]=bt);let ln=st[bt];ln||(ln=st[bt]=[]),ln.push(Rt)}const We=[];for(const nt in st)We.push(st[nt]);return We}(Object.values(this._layerConfigs),this.keyCache);for(const Oe of De){const je=Oe.map(ln=>this._layers[ln.id]),st=je[0];if(st.visibility==="none")continue;const We=st.source||"";let nt=this.familiesBySource[We];nt||(nt=this.familiesBySource[We]={});const Rt=st.sourceLayer||"_geojsonTileLayer";let bt=nt[Rt];bt||(bt=nt[Rt]=[]),bt.push(je)}}}const P=1*s.fl;class L{constructor(ee){const le={},ye=[];for(const st in ee){const We=ee[st],nt=le[st]={};for(const Rt in We.glyphs){const bt=We.glyphs[+Rt];if(!bt||bt.bitmap.width===0||bt.bitmap.height===0)continue;const ln=bt.metrics.localGlyph?P:1,wn={x:0,y:0,w:bt.bitmap.width+2*ln,h:bt.bitmap.height+2*ln};ye.push(wn),nt[Rt]=wn}}const{w:De,h:Oe}=s.G(ye),je=new s.fk({width:De||1,height:Oe||1});for(const st in ee){const We=ee[st];for(const nt in We.glyphs){const Rt=We.glyphs[+nt];if(!Rt||Rt.bitmap.width===0||Rt.bitmap.height===0)continue;const bt=le[st][nt],ln=Rt.metrics.localGlyph?P:1;s.fk.copy(Rt.bitmap,je,{x:0,y:0},{x:bt.x+ln,y:bt.y+ln},Rt.bitmap)}}this.image=je,this.positions=le}}function F(Ze,ee,le){Ze[ee]?le&&(Ze[ee].center=le):Ze[ee]={floorIds:new Set,center:le||[0,0],floors:{}}}function U(Ze,ee,le,ye){for(const De of ee)F(Ze,De),Ze[De].floors[le]=ye,Ze[De].floorIds.add(le)}function q(Ze){return{id:Ze.properties.id.toString(),center:Ze.properties.center.toString().split(";").map(Number)}}function G(Ze){return{id:Ze.properties.id.toString(),isDefault:!!Ze.properties.is_default&&Ze.properties.is_default,connections:Ze.properties.connected_floor_ids?new Set(Ze.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Ze.properties.conflicted_floor_ids?new Set(Ze.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Ze.properties.building_ids?new Set(Ze.properties.building_ids.toString().split(";")):new Set,name:Ze.properties.name.toString(),zIndex:Ze.properties.z_index}}function $(Ze,ee){return ee.every(le=>Ze.properties&&Ze.properties[le]!=null)}function X(Ze){return $(Ze,["type","id","name"])&&Ze.properties.type==="building"}function ie(Ze){return $(Ze,["type","id","name","z_index"])&&Ze.properties.type==="floor"}s.fj(L,"GlyphAtlas");class de{constructor(ee){this.tileID=new s.aQ(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.lut=ee.lut,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.scope=ee.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.request&&ee.request.collectResourceTiming,this.promoteId=ee.promoteId,this.isSymbolTile=ee.isSymbolTile,this.tileTransform=s.aZ(ee.tileID.canonical,ee.projection),this.projection=ee.projection,this.worldview=ee.worldview,this.localizableLayerIds=ee.localizableLayerIds,this.brightness=ee.brightness,this.extraShadowCaster=!!ee.extraShadowCaster,this.tessellationStep=ee.tessellationStep,this.scaleFactor=ee.scaleFactor,this.worldview=ee.worldview,this.indoor=ee.indoor}parse(ee,le,ye,De,Oe,je){this.status="parsing",this.data=ee,this.collisionBoxArray=new s.b3;const st=new s.fm(Object.keys(ee.layers).sort()),We=new s.fn(this.tileID,this.promoteId);We.bucketLayerIDs=[];const nt={},Rt=new s.fo(256,256),bt={featureIndex:We,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Rt,availableImages:ye,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const fr=this.indoor.indoorState.activeFloorsVisible,Tr=function(Ar,ni,Pi){const ds=function(ji,li){if(!ji)return s.w("No source layers defined in indoor specification"),li;if(ji.size===0)return li;const Is=ji.difference(li);for(const Zi of Is)s.w(`Missing source layer required in indoor specification: ${Zi}`);return li.intersection(li)}(ni.sourceLayers,new Set(Object.keys(Ar.layers))),Wi=ni.indoorState,Es=function(ji,li,Is,Zi){const ri=new Set,ha=new Set,xo=new Set,Ha=new Map,Mo={},vd=bo=>{const ou=Ha.get(bo)||new Set;for(const ol of ri)if((Ha.get(ol)||new Set).has(bo)||ou.has(ol))return!0;return!1};for(const bo of li){const ou=ji.layers[bo];if(ou)for(let ol=0;ol<ou.length;ol++){const Fc=ou.feature(ol);if(X(Fc)){const{id:fo,center:yf}=q(Fc);F(Mo,fo,yf),ri.add(fo)}else if(ie(Fc)){const{id:fo,isDefault:yf,connections:Ap,conflicts:L_,buildings:D_,name:N_,zIndex:A0}=G(Fc);U(Mo,D_,fo,{name:N_,zIndex:A0}),Ha.set(fo,L_),(fo===Zi||Ap.has(Zi))&&ri.add(fo),ha.add(fo),yf&&xo.add(fo)}}else s.w(`indoor source layer not found: ${bo}`)}if(Is)for(const bo of Is)ha.has(bo)&&(vd(bo)||ri.add(bo));for(const bo of xo)ri.has(bo)||vd(bo)||ri.add(bo);return{buildings:Mo,activeFloors:ri}}(Ar,ds,Wi.lastActiveFloors,Wi.selectedFloorId);return Pi.send("setIndoorData",Es),Es}(ee,this.indoor,Oe);bt.activeFloors=fr?Tr.activeFloors:void 0}const ln=[],wn=le.familiesBySource[this.source];for(const fr in wn){const Tr=ee.layers[fr];if(!Tr)continue;let Ar=!1,ni=!1,Pi=!1;for(const li of wn[fr])li[0].type==="symbol"?Ar=!0:ni=!0,li[0].is3D()&&li[0].type!=="model"&&(Pi=!0);if(this.extraShadowCaster&&!Pi||this.isSymbolTile===!0&&!Ar||this.isSymbolTile===!1&&!ni)continue;Tr.version===1&&s.w(`Vector tile source "${this.source}" layer "${fr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ds=st.encode(fr),Wi=[],Es=this.localizableLayerIds&&this.localizableLayerIds.has(fr);let ji=!1;for(let li=0,Is=0;li<Tr.length;li++){const Zi=Tr.feature(li),ri=We.getId(Zi,fr),ha=Zi.properties?Zi.properties.worldview:null;if(Es&&this.worldview&&typeof ha=="string")if(ha==="all")Zi.properties.$localized=!0;else{if(!ha.split(",").includes(this.worldview))continue;Zi.properties.$localized=!0,Zi.properties.worldview=this.worldview}!ji&&Zi.properties&&Zi.properties.hasOwnProperty(s.fp)&&(ji=!0),Wi.push({feature:Zi,id:ri,index:Is,sourceLayerIndex:ds}),Is++}ji&&!bt.elevationFeatures&&ee.layers.hasOwnProperty(s.fq)&&(bt.elevationFeatures=s.fr.parseFrom(ee.layers[s.fq],this.canonical));for(const li of wn[fr]){const Is=li[0];if(this.extraShadowCaster&&(!Is.is3D()||Is.type==="model")||this.isSymbolTile!==void 0&&Is.type==="symbol"!==this.isSymbolTile||Is.minzoom&&this.zoom<Math.floor(Is.minzoom)||Is.maxzoom&&this.zoom>=Is.maxzoom||Is.visibility==="none")continue;fe(li,this.zoom,bt.brightness,ye,this.worldview);const Zi=nt[Is.id]=Is.createBucket({index:We.bucketLayerIDs.length,layers:li,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ds,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:De,worldview:this.worldview,localizable:Es});We.bucketLayerIDs.push(li.map(ha=>s.B(ha.id,ha.scope)));let ri=Zi.prepare?Zi.prepare():null;ri!=null?(ri=ri.then(()=>Zi.populate(Wi,bt,this.tileID.canonical,this.tileTransform)),ln.push(ri)):Zi.populate(Wi,bt,this.tileID.canonical,this.tileTransform)}}const un=()=>{let fr,Tr,Ar,ni,Pi,ds;Rt.trim();const Wi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Es=()=>{if(fr)return this.status="done",je(fr);if(this.extraShadowCaster)this.status="done",je(null,{buckets:Object.values(nt).filter(li=>!li.isEmpty()),featureIndex:We,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:bt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Tr&&Ar&&ni){const li=new L(Tr),Is=new Map;for(const[ha,xo]of Ar.entries()){const{imagePosition:Ha}=s.fu(ha,xo,s.fv);Is.set(ha,Ha)}const Zi={};for(const ha in nt){const xo=nt[ha];xo instanceof s.b4&&(fe(xo.layers,this.zoom,bt.brightness,ye,this.worldview),Zi[ha]=s.fw(xo,Tr,li.positions,Ar,Is,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Pi,this.worldview))}const ri={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Oe,Ar,Pi,()=>{ri.iconsPending=!1,ji(Zi,li,ri)}),this.rasterizeIfNeeded(Oe,ni,ds,()=>{ri.patternsPending=!1,ji(Zi,li,ri)})}},ji=(li,Is,Zi,ri)=>{if(Zi.iconsPending||Zi.patternsPending)return;const ha=new s.fx(Ar,ni,this.lut);for(const xo in nt){const Ha=nt[xo];if(xo in li)s.fy(Ha,li[xo],this.showCollisionBoxes,ye,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Ar,ha);else if(Ha.hasPattern&&(Ha instanceof s.ba||Ha instanceof s.bb||Ha instanceof s.ea)){fe(Ha.layers,this.zoom,bt.brightness,ye,this.worldview);const Mo=Object.fromEntries(ha.patternPositions);Ha.addFeatures(bt,this.tileID.canonical,Mo,ye,this.tileTransform,this.brightness)}}this.status="done",je(null,{buckets:Object.values(nt).filter(xo=>!xo.isEmpty()),featureIndex:We,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Is.image,lineAtlas:Rt,imageAtlas:ha,brightness:bt.brightness})};if(!this.extraShadowCaster){const li=s.fs(bt.glyphDependencies,ri=>Object.keys(ri).map(Number));Object.keys(li).length?Oe.send("getGlyphs",{uid:this.uid,stacks:li},(ri,ha)=>{fr||(fr=ri,Tr=ha,Es())},void 0,!1,Wi):Tr={};const Is=Array.from(bt.iconDependencies.keys()).map(ri=>s.I.parse(ri));Is.length?Oe.send("getImages",{images:Is,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ri,ha)=>{fr||(fr=ri,Ar=new Map,Pi=this.updateImageMapAndGetImageTaskQueue(Ar,ha,bt.iconDependencies),Es())},void 0,!1,Wi):(Ar=new Map,Pi=new Map);const Zi=Array.from(bt.patternDependencies.keys()).map(ri=>s.I.parse(ri));Zi.length?Oe.send("getImages",{images:Zi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ri,ha)=>{fr||(fr=ri,ni=new Map,ds=this.updateImageMapAndGetImageTaskQueue(ni,ha,bt.patternDependencies),Es())},void 0,!1,Wi):(ni=new Map,ds=new Map)}if(bt.elevationFeatures&&bt.elevationFeatures.length>0){const li=[];for(const Zi of Object.values(nt))if(Zi instanceof s.bb){const ri=Zi.getUnevaluatedPortalGraph();ri&&li.push(ri)}const Is=s.ft.evaluate(li);for(const Zi of Object.values(nt))if(Zi instanceof s.bb){const ri=ee.layers[st.decode(Zi.sourceLayerIndex)];Zi.setEvaluatedPortalGraph(Is,ri,this.tileID.canonical,bt.availableImages,bt.brightness)}}Es()};ln.length>0?Promise.allSettled(ln).then(un).catch(je):un()}updateParameters(ee){this.scaleFactor=ee.scaleFactor,this.showCollisionBoxes=ee.showCollisionBoxes,this.projection=ee.projection,this.brightness=ee.brightness,this.tileTransform=s.aZ(ee.tileID.canonical,ee.projection),this.extraShadowCaster=ee.extraShadowCaster,this.lut=ee.lut,this.worldview=ee.worldview,this.indoor=ee.indoor}rasterizeIfNeeded(ee,le,ye,De){Array.from(le.values()).some(Oe=>Oe.usvg)?this.rasterize(ee,le,ye,De):De()}updateImageMapAndGetImageTaskQueue(ee,le,ye){const De=new Map;for(const Oe of le.keys()){const je=ye.get(Oe)||[];for(const st of je){const We=st.toString(),nt=le.get(st.id.toString());nt.usvg?De.has(We)||(De.set(We,st),ee.set(We,Object.assign({},nt))):ee.set(We,nt)}}return De}rasterize(ee,le,ye,De){this.rasterizeTask=ee.send("rasterizeImages",{scope:this.scope,tasks:ye},(Oe,je)=>{if(!Oe)for(const[st,We]of je.entries()){const nt=Object.assign(le.get(st),{data:We});le.set(st,nt)}De()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function fe(Ze,ee,le,ye,De){const Oe=new s.ac(ee,{brightness:le,worldview:De});for(const je of Ze)je.recalculate(Oe,ye)}class be extends s.E{constructor(ee,le,ye,De,Oe,je,st){super(),this.actor=ee,this.layerIndex=le,this.availableImages=ye,this.availableModels=De,this.loadVectorData=je||s.aL,this.loading={},this.loaded={},this.deduped=new s.aK(ee.scheduler),this.isSpriteLoaded=Oe,this.scheduler=ee.scheduler,this.brightness=st}loadTile(ee,le){const ye=ee.uid,De=ee&&ee.request,Oe=De&&De.collectResourceTiming,je=this.loading[ye]=new de(ee);je.abort=this.loadVectorData(ee,(st,We)=>{const nt=!this.loading[ye];if(delete this.loading[ye],je.cancelRasterize(),nt||st||!We)return je.status="done",nt||(this.loaded[ye]=je),le(st);const Rt=We.rawData,bt={},ln=s.aM(We.responseHeaders);ln&&ln.expires&&(bt.expires=ln.expires),ln&&ln.cacheControl&&(bt.cacheControl=ln.cacheControl),je.vectorTile=We.vectorTile||new s.fz(new s.bt(Rt));const wn=()=>{je.parse(je.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(un,fr)=>{if(un||!fr)return le(un);const Tr={};if(Oe){const Ar=v(De);Ar.length>0&&(Tr.resourceTiming=JSON.parse(JSON.stringify(Ar)))}le(null,Object.assign({rawTileData:Rt.slice(0),responseHeaders:We.responseHeaders},fr,bt,Tr))})};this.isSpriteLoaded?wn():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(wn,{type:"parseTile",isSymbolTile:ee.isSymbolTile,zoom:ee.tileZoom}):wn()}),this.loaded=this.loaded||{},this.loaded[ye]=je})}reloadTile(ee,le){const ye=this.loaded,De=ee.uid;if(ye&&ye[De]){const Oe=ye[De];Oe.updateParameters(ee);const je=(st,We)=>{const nt=Oe.reloadCallback;nt&&(delete Oe.reloadCallback,Oe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,nt)),le(st,We)};Oe.status==="parsing"?Oe.reloadCallback=je:Oe.status==="done"&&(Oe.vectorTile?Oe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,je):je())}else le(null,void 0)}abortTile(ee,le){const ye=ee.uid,De=this.loading[ye];De&&(De.abort&&De.abort(),delete this.loading[ye]),le()}removeTile(ee,le){const ye=this.loaded,De=ee.uid;ye&&ye[De]&&delete ye[De],le()}}class ve{loadTile(ee,le){const{uid:ye,encoding:De,rawImageData:Oe,padding:je}=ee,st=ImageBitmap&&Oe instanceof ImageBitmap?this.getImageData(Oe,je):Oe;le(null,new s.fA(ye,st,De,je<1))}reloadTile(ee,le){le(null,null)}abortTile(ee,le){le()}removeTile(ee,le){le()}getImageData(ee,le){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ee.width,ee.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ee.width,this.offscreenCanvas.height=ee.height,this.offscreenCanvasContext.drawImage(ee,0,0,ee.width,ee.height);const ye=this.offscreenCanvasContext.getImageData(-le,-le,ee.width+2*le,ee.height+2*le);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ye}}s.bs.setPbf(s.bt);class Qe{constructor(ee){this._mrt=new s.bs(ee.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ee.uid,this.tileID=ee.tileID,this.source=ee.source}parse(ee,le){const ye=this._mrt;this.status="parsing",this._entireBuffer=ee;try{ye.parseHeader(ee),this._isHeaderLoaded=!0;const De=[];for(const Oe in ye.layers){const je=ye.getLayer(Oe),st=je.getDataRange(je.getBandList()),We=ye.createDecodingTask(st),nt=ee.slice(st.firstByte,st.lastByte+1),Rt=s.bs.performDecoding(nt,We).then(bt=>We.complete(null,bt)).catch(bt=>We.complete(bt,null));De.push(Rt)}Promise.allSettled(De).then(()=>le(null,ye)).catch(Oe=>le(Oe))}catch(De){le(De)}}}class we{constructor(ee){this.actor=ee,this.loading={},this.loaded={}}loadTile(ee,le){const ye=ee.uid,De=ee.request,Oe=this.loading[ye]=new Qe(ee),{cancel:je}=s.bu(De,(st,We,nt)=>{const Rt=!this.loading[ye];if(delete this.loading[ye],Rt||st||!We)return Oe.status="done",Rt||(this.loaded[ye]=Oe),le(st);Oe.parse(We,(bt,ln)=>{if(bt||!ln)return le(bt);le(null,ln,nt)}),this.loaded[ye]=Oe});Oe.abort=je}reloadTile(ee,le){le(null,void 0)}abortTile(ee,le){const ye=ee.uid,De=this.loading[ye];De&&(De.abort&&De.abort(),delete this.loading[ye]),le()}removeTile(ee,le){const ye=ee.uid;this.loaded[ye]&&delete this.loaded[ye],le()}decodeRasterArray(ee,le){s.bs.performDecoding(ee.buffer,ee.task).then(ye=>le(null,ye)).catch(ye=>le(ye))}}const qe=s.fB.prototype.toGeoJSON;class Je{constructor(ee){this._feature=ee,this.extent=s.al,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))}loadGeometry(){if(this._feature.type===1){const ee=[];for(const le of this._feature.geometry)ee.push([new s.P(le[0],le[1])]);return ee}{const ee=[];for(const le of this._feature.geometry){const ye=[];for(const De of le)ye.push(new s.P(De[0],De[1]));ee.push(ye)}return ee}}toGeoJSON(ee,le,ye){return qe.call(this,ee,le,ye)}}class ft{constructor(ee,le){this.name=ee,this.extent=s.al,this.length=le.length,this._jsonFeatures=le}feature(ee){return new Je(this._jsonFeatures[ee])}}class Mt{constructor(ee){this.layers={},this.extent=s.al;for(const le of Object.keys(ee))this.layers[le]=new ft(le,ee[le])}}const Pt=64/4096,Nt=128;class Kt{constructor(){this.features=new Map}clear(){this.features.clear()}load(ee=[],le){for(const ye of ee){const De=ye.id;if(De==null)continue;let Oe=this.features.get(De);Oe&&this.updateCache(Oe,le),ye.geometry?(Oe=mt(ye),this.updateCache(Oe,le),this.features.set(De,Oe)):this.features.delete(De),this.updateCache(Oe,le)}}updateCache(ee,le){for(const{canonical:ye,uid:De}of Object.values(le)){const{z:Oe,x:je,y:st}=ye;tt(ee,Math.pow(2,Oe),je,st)&&delete le[De]}}getTile(ee,le,ye){const De=Math.pow(2,ee),Oe=[];for(const je of this.features.values())tt(je,De,le,ye)&&Oe.push(ze(je,De,le,ye));return{features:Oe}}getFeatures(){return[...this.features.values()]}}function tt({minX:Ze,minY:ee,maxX:le,maxY:ye},De,Oe,je){return Ze<(Oe+1+Pt)/De&&ee<(je+1+Pt)/De&&le>(Oe-Pt)/De&&ye>(je-Pt)/De}function mt(Ze){const{id:ee,geometry:le,properties:ye}=Ze;if(!le)return;if(le.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:De,coordinates:Oe}=le,je={id:ee,type:1,geometry:[],tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},st=je.geometry;if(De==="Point")Pe(Oe,st,je);else if(De==="MultiPoint")for(const We of Oe)Pe(We,st,je);else if(De==="LineString")je.type=2,gn(Oe,st,je);else if(De==="MultiLineString")je.type=2,Et(Oe,st,je);else if(De==="Polygon")je.type=3,Et(Oe,st,je,!0);else{if(De!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");je.type=3;for(const We of Oe)Et(We,st,je,!0)}return je}function Pe([Ze,ee],le,ye){const De=s.aF(Ze);let Oe=s.aJ(ee);Oe=Oe<0?0:Oe>1?1:Oe,le.push(De,Oe),ye.minX=Math.min(ye.minX,De),ye.minY=Math.min(ye.minY,Oe),ye.maxX=Math.max(ye.maxX,De),ye.maxY=Math.max(ye.maxY,Oe)}function gn(Ze,ee,le,ye=!1,De=!1){const Oe=[];for(const je of Ze)Pe(je,Oe,le);ee.push(Oe),ye&&function(je,st){let We=0;for(let nt=0,Rt=je.length,bt=Rt-2;nt<Rt;bt=nt,nt+=2)We+=(je[nt]-je[bt])*(je[nt+1]+je[bt+1]);if(We>0===st)for(let nt=0,Rt=je.length;nt<Rt/2;nt+=2){const bt=je[nt],ln=je[nt+1];je[nt]=je[Rt-2-nt],je[nt+1]=je[Rt-1-nt],je[Rt-2-nt]=bt,je[Rt-1-nt]=ln}}(Oe,De)}function Et(Ze,ee,le,ye=!1){for(let De=0;De<Ze.length;De++)gn(Ze[De],ee,le,ye,De===0)}function ze(Ze,ee,le,ye){const{id:De,type:Oe,geometry:je,tags:st}=Ze,We=[];if(Oe===1)(function(nt,Rt,bt,ln,wn){for(let un=0;un<nt.length;un+=2){const fr=Math.round(s.al*(nt[un+0]*Rt-bt)),Tr=Math.round(s.al*(nt[un+1]*Rt-ln));wn.push([fr,Tr])}})(je,ee,le,ye,We);else if(Oe===2)for(const nt of je)$t(nt,ee,le,ye,We);else if(Oe===3)for(const nt of je)Cn(nt,ee,le,ye,We);return{id:De,type:Oe,geometry:We,tags:st}}function $t(Ze,ee,le,ye,De){const Oe=-Nt,je=s.al+Nt;let st;for(let We=0;We<Ze.length-2;We+=2){let nt=Math.round(s.al*(Ze[We+0]*ee-le)),Rt=Math.round(s.al*(Ze[We+1]*ee-ye)),bt=Math.round(s.al*(Ze[We+2]*ee-le)),ln=Math.round(s.al*(Ze[We+3]*ee-ye));const wn=bt-nt,un=ln-Rt;nt<Oe&&bt<Oe||(nt<Oe?(Rt+=Math.round(un*((Oe-nt)/wn)),nt=Oe):bt<Oe&&(ln=Rt+Math.round(un*((Oe-nt)/wn)),bt=Oe),Rt<Oe&&ln<Oe||(Rt<Oe?(nt+=Math.round(wn*((Oe-Rt)/un)),Rt=Oe):ln<Oe&&(bt=nt+Math.round(wn*((Oe-Rt)/un)),ln=Oe),nt>=je&&bt>=je||(nt>=je?(Rt+=Math.round(un*((je-nt)/wn)),nt=je):bt>=je&&(ln=Rt+Math.round(un*((je-nt)/wn)),bt=je),Rt>=je&&ln>=je||(Rt>=je?(nt+=Math.round(wn*((je-Rt)/un)),Rt=je):ln>=je&&(bt=nt+Math.round(wn*((je-Rt)/un)),ln=je),st&&nt===st[st.length-1][0]&&Rt===st[st.length-1][1]||(st=[[nt,Rt]],De.push(st)),st.push([bt,ln])))))}}function Cn(Ze,ee,le,ye,De){const Oe=(le-Pt)/ee,je=(ye-Pt)/ee,st=(le+1+Pt)/ee,We=(ye+1+Pt)/ee;function nt(ln,wn){let un=0;return ln<Oe?un|=1:ln>st&&(un|=2),wn<je?un|=4:wn>We&&(un|=8),un}let Rt=[];for(let ln=1;ln<=8;ln*=2){let wn=Ze[Ze.length-2],un=Ze[Ze.length-1],fr=!(nt(wn,un)&ln);for(let Tr=0;Tr<Ze.length;Tr+=2){const Ar=Ze[Tr],ni=Ze[Tr+1],Pi=!(nt(Ar,ni)&ln);Pi!==fr&&(8&ln?Rt.push(wn+(Ar-wn)*(We-un)/(ni-un),We):4&ln?Rt.push(wn+(Ar-wn)*(je-un)/(ni-un),je):2&ln?Rt.push(st,un+(ni-un)*(st-wn)/(Ar-wn)):1&ln&&Rt.push(Oe,un+(ni-un)*(Oe-wn)/(Ar-wn))),Pi&&Rt.push(Ar,ni),wn=Ar,un=ni,fr=Pi}if(!(Ze=Rt).length||ln===8)break;Rt=[]}const bt=[];for(let ln=0;ln<Rt.length;ln+=2)bt.push([Math.round(s.al*(Rt[ln]*ee-le)),Math.round(s.al*(Rt[ln+1]*ee-ye))]);De.push(bt)}function fn({name:Ze,features:ee},le){le.writeStringField(1,Ze),le.writeVarintField(5,s.al);const ye=new Map,De=new Map,Oe={keys:ye,values:De,feature:null};for(const je of ee)Oe.feature=je,le.writeMessage(2,Nn,Oe);for(const je of ye.keys())le.writeStringField(3,je);for(const je of De.keys())le.writeMessage(4,Un,je)}function Nn(Ze,ee){const le=Ze.feature;le.id!==void 0&&Number.isSafeInteger(+le.id)&&ee.writeVarintField(1,+le.id),le.tags&&ee.writeMessage(2,bn,Ze),ee.writeVarintField(3,le.type),ee.writeMessage(4,Sn,le)}function bn({keys:Ze,values:ee,feature:le},ye){for(const De of Object.keys(le.tags)){let Oe=le.tags[De];if(Oe===null)continue;let je=Ze.get(De);je===void 0&&(je=Ze.size,Ze.set(De,je)),ye.writeVarint(je);const st=typeof Oe;st!=="string"&&st!=="boolean"&&st!=="number"&&(Oe=JSON.stringify(Oe));let We=ee.get(Oe);We===void 0&&(We=ee.size,ee.set(Oe,We)),ye.writeVarint(We)}}function Vt(Ze,ee){return(ee<<3)+(7&Ze)}function En(Ze){return Ze<<1^Ze>>31}function Sn(Ze,ee){const{geometry:le,type:ye}=Ze;let De=0,Oe=0;if(ye===1){ee.writeVarint(Vt(1,le.length));for(const je of le){const st=je[0]-De,We=je[1]-Oe;ee.writeVarint(En(st)),ee.writeVarint(En(We)),De+=st,Oe+=We}}else for(const je of le){ee.writeVarint(Vt(1,1));const st=je.length-(ye===3?1:0);for(let We=0;We<st;We++){We===1&&ee.writeVarint(Vt(2,st-1));const nt=je[We][0]-De,Rt=je[We][1]-Oe;ee.writeVarint(En(nt)),ee.writeVarint(En(Rt)),De+=nt,Oe+=Rt}ye===3&&ee.writeVarint(Vt(7,1))}}function Un(Ze,ee){const le=typeof Ze;le==="string"?ee.writeStringField(1,Ze):le==="boolean"?ee.writeBooleanField(7,Ze):le==="number"&&(Ze%1!=0?ee.writeDoubleField(3,Ze):Ze<0?ee.writeSVarintField(6,Ze):ee.writeVarintField(5,Ze))}const nn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ze=>Ze},wr=Math.fround||(Xr=new Float32Array(1),Ze=>(Xr[0]=+Ze,Xr[0]));var Xr;const ar=3,tr=5,Vn=6;class xr{constructor(ee){this.options=Object.assign(Object.create(nn),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:le,minZoom:ye,maxZoom:De}=this.options;le&&console.time("total time");const Oe=`prepare ${ee.length} points`;le&&console.time(Oe),this.points=ee;const je=[];for(let We=0;We<ee.length;We++){const nt=ee[We];if(!nt.geometry)continue;const[Rt,bt]=nt.geometry.coordinates,ln=wr(Ai(Rt)),wn=wr(ps(bt));je.push(ln,wn,1/0,We,-1,1),this.options.reduce&&je.push(0)}let st=this.trees[De+1]=this._createTree(je);le&&console.timeEnd(Oe);for(let We=De;We>=ye;We--){const nt=+Date.now();st=this.trees[We]=this._createTree(this._cluster(st,We)),le&&console.log("z%d: %d clusters in %dms",We,st.numItems,+Date.now()-nt)}return le&&console.timeEnd("total time"),this}getClusters(ee,le){let ye=((ee[0]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,ee[1]));let Oe=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)ye=-180,Oe=180;else if(ye>Oe){const bt=this.getClusters([ye,De,180,je],le),ln=this.getClusters([-180,De,Oe,je],le);return bt.concat(ln)}const st=this.trees[this._limitZoom(le)],We=st.range(Ai(ye),ps(je),Ai(Oe),ps(De)),nt=st.data,Rt=[];for(const bt of We){const ln=this.stride*bt;Rt.push(nt[ln+tr]>1?ws(nt,ln,this.clusterProps):this.points[nt[ln+ar]])}return Rt}getChildren(ee){const le=this._getOriginId(ee),ye=this._getOriginZoom(ee),De="No cluster with the specified id.",Oe=this.trees[ye];if(!Oe)throw new Error(De);const je=Oe.data;if(le*this.stride>=je.length)throw new Error(De);const st=this.options.radius/(this.options.extent*Math.pow(2,ye-1)),We=Oe.within(je[le*this.stride],je[le*this.stride+1],st),nt=[];for(const Rt of We){const bt=Rt*this.stride;je[bt+4]===ee&&nt.push(je[bt+tr]>1?ws(je,bt,this.clusterProps):this.points[je[bt+ar]])}if(nt.length===0)throw new Error(De);return nt}getLeaves(ee,le,ye){const De=[];return this._appendLeaves(De,ee,le=le||10,ye=ye||0,0),De}getTile(ee,le,ye){const De=this.trees[this._limitZoom(ee)],Oe=Math.pow(2,ee),{extent:je,radius:st}=this.options,We=st/je,nt=(ye-We)/Oe,Rt=(ye+1+We)/Oe,bt={features:[]};return this._addTileFeatures(De.range((le-We)/Oe,nt,(le+1+We)/Oe,Rt),De.data,le,ye,Oe,bt),le===0&&this._addTileFeatures(De.range(1-We/Oe,nt,1,Rt),De.data,Oe,ye,Oe,bt),le===Oe-1&&this._addTileFeatures(De.range(0,nt,We/Oe,Rt),De.data,-1,ye,Oe,bt),bt.features.length?bt:null}getClusterExpansionZoom(ee){let le=this._getOriginZoom(ee)-1;for(;le<=this.options.maxZoom;){const ye=this.getChildren(ee);if(le++,ye.length!==1)break;ee=ye[0].properties.cluster_id}return le}_appendLeaves(ee,le,ye,De,Oe){const je=this.getChildren(le);for(const st of je){const We=st.properties;if(We&&We.cluster?Oe+We.point_count<=De?Oe+=We.point_count:Oe=this._appendLeaves(ee,We.cluster_id,ye,De,Oe):Oe<De?Oe++:ee.push(st),ee.length===ye)break}return Oe}_createTree(ee){const le=new s.c4(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ye=0;ye<ee.length;ye+=this.stride)le.add(ee[ye],ee[ye+1]);return le.finish(),le.data=ee,le}_addTileFeatures(ee,le,ye,De,Oe,je){for(const st of ee){const We=st*this.stride,nt=le[We+tr]>1;let Rt,bt,ln;if(nt)Rt=bi(le,We,this.clusterProps),bt=le[We],ln=le[We+1];else{const fr=this.points[le[We+ar]];Rt=fr.properties;const[Tr,Ar]=fr.geometry.coordinates;bt=Ai(Tr),ln=ps(Ar)}const wn={type:1,geometry:[[Math.round(this.options.extent*(bt*Oe-ye)),Math.round(this.options.extent*(ln*Oe-De))]],tags:Rt};let un;un=nt||this.options.generateId?le[We+ar]:this.points[le[We+ar]].id,un!==void 0&&(wn.id=un),je.features.push(wn)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,le){const{radius:ye,extent:De,reduce:Oe,minPoints:je}=this.options,st=ye/(De*Math.pow(2,le)),We=ee.data,nt=[],Rt=this.stride;for(let bt=0;bt<We.length;bt+=Rt){if(We[bt+2]<=le)continue;We[bt+2]=le;const ln=We[bt],wn=We[bt+1],un=ee.within(We[bt],We[bt+1],st),fr=We[bt+tr];let Tr=fr;for(const Ar of un){const ni=Ar*Rt;We[ni+2]>le&&(Tr+=We[ni+tr])}if(Tr>fr&&Tr>=je){let Ar,ni=ln*fr,Pi=wn*fr,ds=-1;const Wi=(bt/Rt<<5)+(le+1)+this.points.length;for(const Es of un){const ji=Es*Rt;if(We[ji+2]<=le)continue;We[ji+2]=le;const li=We[ji+tr];ni+=We[ji]*li,Pi+=We[ji+1]*li,We[ji+4]=Wi,Oe&&(Ar||(Ar=this._map(We,bt,!0),ds=this.clusterProps.length,this.clusterProps.push(Ar)),Oe(Ar,this._map(We,ji)))}We[bt+4]=Wi,nt.push(ni/Tr,Pi/Tr,1/0,Wi,-1,Tr),Oe&&nt.push(ds)}else{for(let Ar=0;Ar<Rt;Ar++)nt.push(We[bt+Ar]);if(Tr>1)for(const Ar of un){const ni=Ar*Rt;if(!(We[ni+2]<=le)){We[ni+2]=le;for(let Pi=0;Pi<Rt;Pi++)nt.push(We[ni+Pi])}}}}return nt}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,le,ye){if(ee[le+tr]>1){const je=this.clusterProps[ee[le+Vn]];return ye?Object.assign({},je):je}const De=this.points[ee[le+ar]].properties,Oe=this.options.map(De);return ye&&Oe===De?Object.assign({},Oe):Oe}}function ws(Ze,ee,le){return{type:"Feature",id:Ze[ee+ar],properties:bi(Ze,ee,le),geometry:{type:"Point",coordinates:[(ye=Ze[ee],360*(ye-.5)),$i(Ze[ee+1])]}};var ye}function bi(Ze,ee,le){const ye=Ze[ee+tr],De=ye>=1e4?`${Math.round(ye/1e3)}k`:ye>=1e3?Math.round(ye/100)/10+"k":ye,Oe=Ze[ee+Vn],je=Oe===-1?{}:Object.assign({},le[Oe]);return Object.assign(je,{cluster:!0,cluster_id:Ze[ee+ar],point_count:ye,point_count_abbreviated:De})}function Ai(Ze){return Ze/360+.5}function ps(Ze){const ee=Math.sin(Ze*Math.PI/180),le=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return le<0?0:le>1?1:le}function $i(Ze){const ee=(180-360*Ze)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}function Ts(Ze,ee,le,ye){let De=ye;const Oe=ee+(le-ee>>1);let je,st=le-ee;const We=Ze[ee],nt=Ze[ee+1],Rt=Ze[le],bt=Ze[le+1];for(let ln=ee+3;ln<le;ln+=3){const wn=tn(Ze[ln],Ze[ln+1],We,nt,Rt,bt);if(wn>De)je=ln,De=wn;else if(wn===De){const un=Math.abs(ln-Oe);un<st&&(je=ln,st=un)}}De>ye&&(je-ee>3&&Ts(Ze,ee,je,ye),Ze[je+2]=De,le-je>3&&Ts(Ze,je,le,ye))}function tn(Ze,ee,le,ye,De,Oe){let je=De-le,st=Oe-ye;if(je!==0||st!==0){const We=((Ze-le)*je+(ee-ye)*st)/(je*je+st*st);We>1?(le=De,ye=Oe):We>0&&(le+=je*We,ye+=st*We)}return je=Ze-le,st=ee-ye,je*je+st*st}function kn(Ze,ee,le,ye){const De={id:Ze??null,type:ee,geometry:le,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")Mr(De,le);else if(ee==="Polygon")Mr(De,le[0]);else if(ee==="MultiLineString")for(const Oe of le)Mr(De,Oe);else if(ee==="MultiPolygon")for(const Oe of le)Mr(De,Oe[0]);return De}function Mr(Ze,ee){for(let le=0;le<ee.length;le+=3)Ze.minX=Math.min(Ze.minX,ee[le]),Ze.minY=Math.min(Ze.minY,ee[le+1]),Ze.maxX=Math.max(Ze.maxX,ee[le]),Ze.maxY=Math.max(Ze.maxY,ee[le+1])}function wt(Ze,ee,le,ye){if(!ee.geometry)return;const De=ee.geometry.coordinates;if(De&&De.length===0)return;const Oe=ee.geometry.type,je=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2);let st=[],We=ee.id;if(le.promoteId?We=ee.properties[le.promoteId]:le.generateId&&(We=ye||0),Oe==="Point")Rn(De,st);else if(Oe==="MultiPoint")for(const nt of De)Rn(nt,st);else if(Oe==="LineString")nr(De,st,je,!1);else if(Oe==="MultiLineString"){if(le.lineMetrics){for(const nt of De)st=[],nr(nt,st,je,!1),Ze.push(kn(We,"LineString",st,ee.properties));return}dt(De,st,je,!1)}else if(Oe==="Polygon")dt(De,st,je,!0);else{if(Oe!=="MultiPolygon"){if(Oe==="GeometryCollection"){for(const nt of ee.geometry.geometries)wt(Ze,{id:We,geometry:nt,properties:ee.properties},le,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const nt of De){const Rt=[];dt(nt,Rt,je,!0),st.push(Rt)}}Ze.push(kn(We,Oe,st,ee.properties))}function Rn(Ze,ee){ee.push(Jn(Ze[0]),qr(Ze[1]),0)}function nr(Ze,ee,le,ye){let De,Oe,je=0;for(let We=0;We<Ze.length;We++){const nt=Jn(Ze[We][0]),Rt=qr(Ze[We][1]);ee.push(nt,Rt,0),We>0&&(je+=ye?(De*Rt-nt*Oe)/2:Math.sqrt(Math.pow(nt-De,2)+Math.pow(Rt-Oe,2))),De=nt,Oe=Rt}const st=ee.length-3;ee[2]=1,Ts(ee,0,st,le),ee[st+2]=1,ee.size=Math.abs(je),ee.start=0,ee.end=ee.size}function dt(Ze,ee,le,ye){for(let De=0;De<Ze.length;De++){const Oe=[];nr(Ze[De],Oe,le,ye),ee.push(Oe)}}function Jn(Ze){return Ze/360+.5}function qr(Ze){const ee=Math.sin(Ze*Math.PI/180),le=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return le<0?0:le>1?1:le}function ts(Ze,ee,le,ye,De,Oe,je,st){if(ye/=ee,Oe>=(le/=ee)&&je<ye)return Ze;if(je<le||Oe>=ye)return null;const We=[];for(const nt of Ze){const Rt=nt.geometry;let bt=nt.type;const ln=De===0?nt.minX:nt.minY,wn=De===0?nt.maxX:nt.maxY;if(ln>=le&&wn<ye){We.push(nt);continue}if(wn<le||ln>=ye)continue;let un=[];if(bt==="Point"||bt==="MultiPoint")ms(Rt,un,le,ye,De);else if(bt==="LineString")Mn(Rt,un,le,ye,De,!1,st.lineMetrics);else if(bt==="MultiLineString")ut(Rt,un,le,ye,De,!1);else if(bt==="Polygon")ut(Rt,un,le,ye,De,!0);else if(bt==="MultiPolygon")for(const fr of Rt){const Tr=[];ut(fr,Tr,le,ye,De,!0),Tr.length&&un.push(Tr)}if(un.length){if(st.lineMetrics&&bt==="LineString"){for(const fr of un)We.push(kn(nt.id,bt,fr,nt.tags));continue}bt!=="LineString"&&bt!=="MultiLineString"||(un.length===1?(bt="LineString",un=un[0]):bt="MultiLineString"),bt!=="Point"&&bt!=="MultiPoint"||(bt=un.length===3?"Point":"MultiPoint"),We.push(kn(nt.id,bt,un,nt.tags))}}return We.length?We:null}function ms(Ze,ee,le,ye,De){for(let Oe=0;Oe<Ze.length;Oe+=3){const je=Ze[Oe+De];je>=le&&je<=ye&&on(ee,Ze[Oe],Ze[Oe+1],Ze[Oe+2])}}function Mn(Ze,ee,le,ye,De,Oe,je){let st=Tt(Ze);const We=De===0?qn:Or;let nt,Rt,bt=Ze.start;for(let Tr=0;Tr<Ze.length-3;Tr+=3){const Ar=Ze[Tr],ni=Ze[Tr+1],Pi=Ze[Tr+2],ds=Ze[Tr+3],Wi=Ze[Tr+4],Es=De===0?Ar:ni,ji=De===0?ds:Wi;let li=!1;je&&(nt=Math.sqrt(Math.pow(Ar-ds,2)+Math.pow(ni-Wi,2))),Es<le?ji>le&&(Rt=We(st,Ar,ni,ds,Wi,le),je&&(st.start=bt+nt*Rt)):Es>ye?ji<ye&&(Rt=We(st,Ar,ni,ds,Wi,ye),je&&(st.start=bt+nt*Rt)):on(st,Ar,ni,Pi),ji<le&&Es>=le&&(Rt=We(st,Ar,ni,ds,Wi,le),li=!0),ji>ye&&Es<=ye&&(Rt=We(st,Ar,ni,ds,Wi,ye),li=!0),!Oe&&li&&(je&&(st.end=bt+nt*Rt),ee.push(st),st=Tt(Ze)),je&&(bt+=nt)}let ln=Ze.length-3;const wn=Ze[ln],un=Ze[ln+1],fr=De===0?wn:un;fr>=le&&fr<=ye&&on(st,wn,un,Ze[ln+2]),ln=st.length-3,Oe&&ln>=3&&(st[ln]!==st[0]||st[ln+1]!==st[1])&&on(st,st[0],st[1],st[2]),st.length&&ee.push(st)}function Tt(Ze){const ee=[];return ee.size=Ze.size,ee.start=Ze.start,ee.end=Ze.end,ee}function ut(Ze,ee,le,ye,De,Oe){for(const je of Ze)Mn(je,ee,le,ye,De,Oe,!1)}function on(Ze,ee,le,ye){Ze.push(ee,le,ye)}function qn(Ze,ee,le,ye,De,Oe){const je=(Oe-ee)/(ye-ee);return on(Ze,Oe,le+(De-le)*je,1),je}function Or(Ze,ee,le,ye,De,Oe){const je=(Oe-le)/(De-le);return on(Ze,ee+(ye-ee)*je,Oe,1),je}function Zn(Ze,ee){const le=[];for(let ye=0;ye<Ze.length;ye++){const De=Ze[ye],Oe=De.type;let je;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")je=ns(De.geometry,ee);else if(Oe==="MultiLineString"||Oe==="Polygon"){je=[];for(const st of De.geometry)je.push(ns(st,ee))}else if(Oe==="MultiPolygon"){je=[];for(const st of De.geometry){const We=[];for(const nt of st)We.push(ns(nt,ee));je.push(We)}}le.push(kn(De.id,Oe,je,De.tags))}return le}function ns(Ze,ee){const le=[];le.size=Ze.size,Ze.start!==void 0&&(le.start=Ze.start,le.end=Ze.end);for(let ye=0;ye<Ze.length;ye+=3)le.push(Ze[ye]+ee,Ze[ye+1],Ze[ye+2]);return le}function ga(Ze,ee){if(Ze.transformed)return Ze;const le=1<<Ze.z,ye=Ze.x,De=Ze.y;for(const Oe of Ze.features){const je=Oe.geometry,st=Oe.type;if(Oe.geometry=[],st===1)for(let We=0;We<je.length;We+=2)Oe.geometry.push(Ys(je[We],je[We+1],ee,le,ye,De));else for(let We=0;We<je.length;We++){const nt=[];for(let Rt=0;Rt<je[We].length;Rt+=2)nt.push(Ys(je[We][Rt],je[We][Rt+1],ee,le,ye,De));Oe.geometry.push(nt)}}return Ze.transformed=!0,Ze}function Ys(Ze,ee,le,ye,De,Oe){return[Math.round(le*(Ze*ye-De)),Math.round(le*(ee*ye-Oe))]}function rn(Ze,ee,le,ye,De){const Oe=ee===De.maxZoom?0:De.tolerance/((1<<ee)*De.extent),je={features:[],numPoints:0,numSimplified:0,numFeatures:Ze.length,source:null,x:le,y:ye,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const st of Ze)rr(je,st,Oe,De);return je}function rr(Ze,ee,le,ye){const De=ee.geometry,Oe=ee.type,je=[];if(Ze.minX=Math.min(Ze.minX,ee.minX),Ze.minY=Math.min(Ze.minY,ee.minY),Ze.maxX=Math.max(Ze.maxX,ee.maxX),Ze.maxY=Math.max(Ze.maxY,ee.maxY),Oe==="Point"||Oe==="MultiPoint")for(let st=0;st<De.length;st+=3)je.push(De[st],De[st+1]),Ze.numPoints++,Ze.numSimplified++;else if(Oe==="LineString")Ve(je,De,Ze,le,!1,!1);else if(Oe==="MultiLineString"||Oe==="Polygon")for(let st=0;st<De.length;st++)Ve(je,De[st],Ze,le,Oe==="Polygon",st===0);else if(Oe==="MultiPolygon")for(let st=0;st<De.length;st++){const We=De[st];for(let nt=0;nt<We.length;nt++)Ve(je,We[nt],Ze,le,!0,nt===0)}if(je.length){let st=ee.tags||null;if(Oe==="LineString"&&ye.lineMetrics){st={};for(const nt in ee.tags)st[nt]=ee.tags[nt];st.mapbox_clip_start=De.start/De.size,st.mapbox_clip_end=De.end/De.size}const We={geometry:je,type:Oe==="Polygon"||Oe==="MultiPolygon"?3:Oe==="LineString"||Oe==="MultiLineString"?2:1,tags:st};ee.id!==null&&(We.id=ee.id),Ze.features.push(We)}}function Ve(Ze,ee,le,ye,De,Oe){const je=ye*ye;if(ye>0&&ee.size<(De?je:ye))return void(le.numPoints+=ee.length/3);const st=[];for(let We=0;We<ee.length;We+=3)(ye===0||ee[We+2]>je)&&(le.numSimplified++,st.push(ee[We],ee[We+1])),le.numPoints++;De&&function(We,nt){let Rt=0;for(let bt=0,ln=We.length,wn=ln-2;bt<ln;wn=bt,bt+=2)Rt+=(We[bt]-We[wn])*(We[bt+1]+We[wn+1]);if(Rt>0===nt)for(let bt=0,ln=We.length;bt<ln/2;bt+=2){const wn=We[bt],un=We[bt+1];We[bt]=We[ln-2-bt],We[bt+1]=We[ln-1-bt],We[ln-2-bt]=wn,We[ln-1-bt]=un}}(st,Oe),Ze.push(st)}const or={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class _n{constructor(ee,le){const ye=(le=this.options=function(Oe,je){for(const st in je)Oe[st]=je[st];return Oe}(Object.create(or),le)).debug;if(ye&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");let De=function(Oe,je){const st=[];if(Oe.type==="FeatureCollection")for(let We=0;We<Oe.features.length;We++)wt(st,Oe.features[We],je,We);else wt(st,Oe.type==="Feature"?Oe:{geometry:Oe},je);return st}(ee,le);this.tiles={},this.tileCoords=[],ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),De=function(Oe,je){const st=je.buffer/je.extent;let We=Oe;const nt=ts(Oe,1,-1-st,st,0,-1,2,je),Rt=ts(Oe,1,1-st,2+st,0,-1,2,je);return(nt||Rt)&&(We=ts(Oe,1,-st,1+st,0,-1,2,je)||[],nt&&(We=Zn(nt,1).concat(We)),Rt&&(We=We.concat(Zn(Rt,-1)))),We}(De,le),De.length&&this.splitTile(De,0,0,0),ye&&(De.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ee,le,ye,De,Oe,je,st){const We=[ee,le,ye,De],nt=this.options,Rt=nt.debug;for(;We.length;){De=We.pop(),ye=We.pop(),le=We.pop(),ee=We.pop();const bt=1<<le,ln=Yn(le,ye,De);let wn=this.tiles[ln];if(!wn&&(Rt>1&&console.time("creation"),wn=this.tiles[ln]=rn(ee,le,ye,De,nt),this.tileCoords.push({z:le,x:ye,y:De}),Rt)){Rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,ye,De,wn.numFeatures,wn.numPoints,wn.numSimplified),console.timeEnd("creation"));const li=`z${le}`;this.stats[li]=(this.stats[li]||0)+1,this.total++}if(wn.source=ee,Oe==null){if(le===nt.indexMaxZoom||wn.numPoints<=nt.indexMaxPoints)continue}else{if(le===nt.maxZoom||le===Oe)continue;if(Oe!=null){const li=Oe-le;if(ye!==je>>li||De!==st>>li)continue}}if(wn.source=null,ee.length===0)continue;Rt>1&&console.time("clipping");const un=.5*nt.buffer/nt.extent,fr=.5-un,Tr=.5+un,Ar=1+un;let ni=null,Pi=null,ds=null,Wi=null,Es=ts(ee,bt,ye-un,ye+Tr,0,wn.minX,wn.maxX,nt),ji=ts(ee,bt,ye+fr,ye+Ar,0,wn.minX,wn.maxX,nt);ee=null,Es&&(ni=ts(Es,bt,De-un,De+Tr,1,wn.minY,wn.maxY,nt),Pi=ts(Es,bt,De+fr,De+Ar,1,wn.minY,wn.maxY,nt),Es=null),ji&&(ds=ts(ji,bt,De-un,De+Tr,1,wn.minY,wn.maxY,nt),Wi=ts(ji,bt,De+fr,De+Ar,1,wn.minY,wn.maxY,nt),ji=null),Rt>1&&console.timeEnd("clipping"),We.push(ni||[],le+1,2*ye,2*De),We.push(Pi||[],le+1,2*ye,2*De+1),We.push(ds||[],le+1,2*ye+1,2*De),We.push(Wi||[],le+1,2*ye+1,2*De+1)}}getTile(ee,le,ye){ee=+ee,le=+le,ye=+ye;const De=this.options,{extent:Oe,debug:je}=De;if(ee<0||ee>24)return null;const st=1<<ee,We=Yn(ee,le=le+st&st-1,ye);if(this.tiles[We])return ga(this.tiles[We],Oe);je>1&&console.log("drilling down to z%d-%d-%d",ee,le,ye);let nt,Rt=ee,bt=le,ln=ye;for(;!nt&&Rt>0;)Rt--,bt>>=1,ln>>=1,nt=this.tiles[Yn(Rt,bt,ln)];return nt&&nt.source?(je>1&&(console.log("found parent tile z%d-%d-%d",Rt,bt,ln),console.time("drilling down")),this.splitTile(nt.source,Rt,bt,ln,ee,le,ye),je>1&&console.timeEnd("drilling down"),this.tiles[We]?ga(this.tiles[We],Oe):null):null}}function Yn(Ze,ee,le){return 32*((1<<Ze)*le+ee)+Ze}function Tn(Ze,ee){const le=Ze.tileID.canonical;if(!this._geoJSONIndex)return void ee(null,null);const ye=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!ye)return void ee(null,null);const De=nt=>nt.tags&&"3d_elevation_id"in nt.tags&&"source"in nt.tags&&nt.tags.source==="elevation",Oe=ye.features.filter(nt=>De(nt));let je={_geojsonTileLayer:ye.features};Oe.length>0&&(je={_geojsonTileLayer:ye.features.filter(nt=>!De(nt)),hd_road_elevation:Oe});const st=new Mt(je),We=function(nt){const Rt=new s.bt;for(const bt of Object.keys(nt))Rt.writeMessage(3,fn,{name:bt,features:nt[bt]});return Rt.finish()}(je).buffer;ee(null,{vectorTile:st,rawData:We})}class ti extends be{constructor(ee,le,ye,De,Oe,je,st){super(ee,le,ye,De,Oe,Tn,st),je&&(this.loadGeoJSON=je),this._dynamicIndex=new Kt}loadData(ee,le){const ye=ee&&ee.request,De=ye&&ye.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ee,(Oe,je)=>{if(Oe||!je)return le(Oe);if(typeof je!="object")return le(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));{try{if(ee.filter){const We=s.U(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(We.result==="error")throw new Error(We.value.map(nt=>`${nt.key}: ${nt.message}`).join(", "));je.features=je.features.filter(nt=>We.value.evaluate({zoom:0},nt))}ee.dynamic?(je.type==="Feature"&&(je={type:"FeatureCollection",features:[je]}),ee.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(je.features,this.loaded),ee.cluster&&(je.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ee.cluster?new xr(function({superclusterOptions:We,clusterProperties:nt}){if(!nt||!We)return We;const Rt={},bt={},ln={accumulated:null,zoom:0},wn={properties:null},un=Object.keys(nt);for(const fr of un){const[Tr,Ar]=nt[fr],ni=s.U(Ar),Pi=s.U(typeof Tr=="string"?[Tr,["accumulated"],["get",fr]]:Tr);Rt[fr]=ni.value,bt[fr]=Pi.value}return We.map=fr=>{wn.properties=fr;const Tr={};for(const Ar of un)Tr[Ar]=Rt[Ar].evaluate(ln,wn);return Tr},We.reduce=(fr,Tr)=>{wn.properties=Tr;for(const Ar of un)ln.accumulated=fr[Ar],fr[Ar]=bt[Ar].evaluate(ln,wn)},We}(ee)).load(je.features):ee.dynamic?this._dynamicIndex:function(We,nt){return new _n(We,nt)}(je,ee.geojsonVtOptions)}catch(We){return le(We)}const st={};if(De){const We=v(ye);We&&(st.resourceTiming={},st.resourceTiming[ee.source]=JSON.parse(JSON.stringify(We)))}le(null,st)}})}reloadTile(ee,le){const ye=this.loaded;return ye&&ye[ee.uid]?ee.partial?le(null,void 0):super.reloadTile(ee,le):this.loadTile(ee,le)}loadGeoJSON(ee,le){if(ee.request)s.m(ee.request,le);else{if(typeof ee.data!="string")return le(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return le(null,JSON.parse(ee.data))}catch{return le(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(ee,le){try{le(null,this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId))}catch(ye){le(ye)}}getClusterChildren(ee,le){try{le(null,this._geoJSONIndex.getChildren(ee.clusterId))}catch(ye){le(ye)}}getClusterLeaves(ee,le){try{le(null,this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset))}catch(ye){le(ye)}}}class Sr{constructor(ee,le,ye){this.tileID=new s.aQ(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.tileZoom=ee.tileZoom,this.uid=ee.uid,this.zoom=ee.zoom,this.canonical=ee.tileID.canonical,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ee.projection,this.brightness=le,this.worldview=ye}parse(ee,le,ye,De){this.status="parsing";const Oe=new s.aQ(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),je=[],st=le.familiesBySource[ye.source],We=new s.fn(Oe,ye.promoteId);We.bucketLayerIDs=[],We.is3DTile=!0,s.fC(ee).then(nt=>{if(!nt)return De(new Error("Could not parse tile"));const Rt=nt.json.extensionsUsed&&nt.json.extensionsUsed.includes("MAPBOX_mesh_features")||nt.json.asset.extras&&nt.json.asset.extras.MAPBOX_mesh_features,bt=nt.json.extensionsUsed&&nt.json.extensionsUsed.includes("EXT_meshopt_compression"),ln=new s.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const wn in st)for(const un of st[wn]){const fr=un[0];We.bucketLayerIDs.push(un.map(ni=>s.B(ni.id,ni.scope))),fr.recalculate(ln,[]);const Tr=s.fD(nt,1/s.d7(ye.tileID.canonical)),Ar=new s.fE(un,Tr,Oe,Rt,bt,this.brightness,We,this.worldview);Rt||(Ar.needsUpload=!0),je.push(Ar),Ar.evaluate(fr)}this.status="done",De(null,{buckets:je,featureIndex:We,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(nt=>De(new Error(nt.message)))}}class Mi{constructor(ee,le,ye,De,Oe,je,st,We){this.actor=ee,this.layerIndex=le,this.availableImages=ye,this.availableModels=De,this.brightness=st,this.loading={},this.loaded={},this.worldview=We}loadTile(ee,le){const ye=ee.uid,De=this.loading[ye]=new Sr(ee,this.brightness,this.worldview);s.bu(ee.request,(Oe,je)=>{const st=!this.loading[ye];return delete this.loading[ye],st||Oe?(De.status="done",st||(this.loaded[ye]=De),le(Oe)):je&&je.byteLength!==0?void De.parse(je,this.layerIndex,ee,(We,nt)=>{De.status="done",this.loaded=this.loaded||{},this.loaded[ye]=De,We||!nt?le(We):le(null,nt)}):(De.status="done",this.loaded[ye]=De,le())})}reloadTile(ee,le){const ye=this.loaded,De=ee.uid;if(ye&&ye[De]){const Oe=ye[De];Oe.projection=ee.projection,Oe.brightness=ee.brightness;const je=(st,We)=>{Oe.reloadCallback&&(delete Oe.reloadCallback,this.loadTile(ee,le)),le(st,We)};Oe.status==="parsing"?Oe.reloadCallback=je:Oe.status==="done"&&this.loadTile(ee,le)}}abortTile(ee,le){const ye=ee.uid;this.loading[ye]&&delete this.loading[ye],le()}removeTile(ee,le){const ye=this.loaded,De=ee.uid;ye&&ye[De]&&delete ye[De],le()}}class da{constructor(ee){this.self=ee,this.actor=new s.fG(ee,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cm({name:"mercator"}),this.workerSourceTypes={vector:be,geojson:ti,"raster-dem":ve,"raster-array":we,"batched-model":Mi},this.workerSources={},this.self.registerWorkerSource=(le,ye)=>{if(this.workerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.workerSourceTypes[le]=ye},this.self.registerRTLTextPlugin=le=>{if(s.fH.isParsed())throw new Error("RTL text plugin already registered.");s.fH.setState({pluginStatus:s.fI.parsed,pluginURL:s.fH.getPluginURL()}),s.fH.applyArabicShaping=le.applyArabicShaping,s.fH.processBidirectionalText=le.processBidirectionalText,s.fH.processStyledBidirectionalText=le.processStyledBidirectionalText;for(const ye of this.rtlPluginParsingListeners)ye(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ee,le,ye){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.availableModels[ee],delete this.workerSources[ee],ye()}checkIfReady(ee,le,ye){ye()}setReferrer(ee,le){this.referrer=le}spriteLoaded(ee,le){this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={});const{scope:ye,isLoaded:De}=le;if(this.isSpriteLoaded[ee][ye]=De,this.workerSources[ee]&&this.workerSources[ee][ye])for(const Oe in this.workerSources[ee][ye]){const je=this.workerSources[ee][ye][Oe];for(const st in je){const We=je[st];We instanceof be&&(We.isSpriteLoaded=De,We.fire(new s.z("isSpriteLoaded")))}}}setImages(ee,le,ye){this.availableImages[ee]||(this.availableImages[ee]={});const{scope:De,images:Oe}=le;if(this.availableImages[ee][De]=Oe,this.workerSources[ee]&&this.workerSources[ee][De]){for(const je in this.workerSources[ee][De]){const st=this.workerSources[ee][De][je];for(const We in st)st[We].availableImages=Oe}ye()}else ye()}setModels(ee,{scope:le,models:ye},De){if(this.availableModels[ee]||(this.availableModels[ee]={}),this.availableModels[ee][le]=ye,this.workerSources[ee]&&this.workerSources[ee][le]){for(const Oe in this.workerSources[ee][le]){const je=this.workerSources[ee][le][Oe];for(const st in je)je[st].availableModels=ye}De()}else De()}setProjection(ee,le){this.projections[ee]=s.cm(le)}setBrightness(ee,le,ye){this.brightness=le,ye()}setWorldview(ee,le,ye){this.worldview=le,ye()}setLayers(ee,le,ye){this.getLayerIndex(ee,le.scope).replace(le.layers,le.options),ye()}updateLayers(ee,le,ye){this.getLayerIndex(ee,le.scope).update(le.layers,le.removedIds,le.options),ye()}loadTile(ee,le,ye){le.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,le.type,le.source,le.scope).loadTile(le,ye)}decodeRasterArray(ee,le,ye){this.getWorkerSource(ee,le.type,le.source,le.scope).decodeRasterArray(le,ye)}reloadTile(ee,le,ye){le.projection=this.projections[ee]||this.defaultProjection,this.getWorkerSource(ee,le.type,le.source,le.scope).reloadTile(le,ye)}abortTile(ee,le,ye){this.getWorkerSource(ee,le.type,le.source,le.scope).abortTile(le,ye)}removeTile(ee,le,ye){this.getWorkerSource(ee,le.type,le.source,le.scope).removeTile(le,ye)}removeSource(ee,le,ye){if(!(this.workerSources[ee]&&this.workerSources[ee][le.scope]&&this.workerSources[ee][le.scope][le.type]&&this.workerSources[ee][le.scope][le.type][le.source]))return;const De=this.workerSources[ee][le.scope][le.type][le.source];delete this.workerSources[ee][le.scope][le.type][le.source],De.removeSource!==void 0?De.removeSource(le,ye):ye()}loadWorkerSource(ee,le,ye){try{this.self.importScripts(le.url),ye()}catch(De){ye(De)}}syncRTLPluginState(ee,le,ye){if(s.fH.isParsed())ye(null,!0);else if(s.fH.isParsing())this.rtlPluginParsingListeners.push(ye);else try{s.fH.setState(le);const De=s.fH.getPluginURL();!s.fH.isLoaded()||s.fH.isParsed()||s.fH.isParsing()||De==null||(s.fH.setState({pluginStatus:s.fI.parsing,pluginURL:s.fH.getPluginURL()}),this.self.importScripts(De),s.fH.isParsed()?ye(null,!0):this.rtlPluginParsingListeners.push(ye))}catch(De){ye(De)}}setDracoUrl(ee,le){this.dracoUrl=le}getAvailableImages(ee,le){this.availableImages[ee]||(this.availableImages[ee]={});let ye=this.availableImages[ee][le];return ye||(ye=[]),ye}getAvailableModels(ee,le){this.availableModels[ee]||(this.availableModels[ee]={});let ye=this.availableModels[ee][le];return ye||(ye={}),ye}getLayerIndex(ee,le){this.layerIndexes[ee]||(this.layerIndexes[ee]={});let ye=this.layerIndexes[ee][le];return ye||(ye=this.layerIndexes[ee][le]=new C,ye.scope=le),ye}getWorkerSource(ee,le,ye,De){const Oe=this.workerSources;return Oe[ee]||(Oe[ee]={}),Oe[ee][De]||(Oe[ee][De]={}),Oe[ee][De][le]||(Oe[ee][De][le]={}),this.isSpriteLoaded[ee]||(this.isSpriteLoaded[ee]={}),Oe[ee][De][le][ye]||(Oe[ee][De][le][ye]=new this.workerSourceTypes[le]({send:(je,st,We,nt,Rt,bt)=>this.actor.send(je,st,We,ee,Rt,bt),scheduler:this.actor.scheduler},this.getLayerIndex(ee,De),this.getAvailableImages(ee,De),this.getAvailableModels(ee,De),this.isSpriteLoaded[ee][De],void 0,this.brightness,this.worldview)),Oe[ee][De][le][ye]}rasterizeImagesWorker(ee,le,ye){const De=new Map;for(const[Oe,{image:je,imageVariant:st}]of le.tasks.entries()){const We=this.imageRasterizer.rasterize(st,je,le.scope,ee);De.set(Oe,We)}ye(void 0,De)}removeRasterizedImages(ee,le,ye){this.imageRasterizer.removeImagesFromCacheByIds(le.imageIds,le.scope,ee),ye()}enforceCacheSizeLimit(ee,le){s.fJ(le)}getWorkerPerformanceMetrics(ee,le,ye){ye(void 0,void 0)}}return s.fF(self)&&(self.worker=new da(self)),da}),u(["./shared"],function(s){var v="3.17.0";const x={create:"create",load:"load",fullLoad:"fullLoad"},A={mark(m){performance.mark(m)},measure(m,o,d){performance.measure(m,o,d)}};function C(m){const o=m.name.split("?")[0];return s.a(o)&&o.includes("mapbox-gl.js")?"javascript":s.a(o)&&o.includes("mapbox-gl.css")?"css":s.b(o)?"fontRange":s.c(o)?"sprite":s.i(o)?"style":s.d(o)?"tilejson":"other"}var P,L={},F=function(){if(P)return L;function m(g){return!o(g)}function o(g){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,E,I=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(I);try{E=new Worker(M),T=!0}catch{T=!1}return E&&E.terminate(),URL.revokeObjectURL(M),T}()?function(){var T=document.createElement("canvas");T.width=T.height=1;var E=T.getContext("2d");if(!E)return!1;var I=E.getImageData(0,0,1,1);return I&&I.width===T.width}()?(d[b=g&&g.failIfMajorPerformanceCaveat]===void 0&&(d[b]=function(T){var E,I=function(M){var N=document.createElement("canvas"),j=Object.create(m.webGLContextAttributes);return j.failIfMajorPerformanceCaveat=M,N.getContext("webgl2",j)}(T);if(!I)return!1;try{E=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!E||I.isContextLost())&&(I.shaderSource(E,"void main() {}"),I.compileShader(E),I.getShaderParameter(E,I.COMPILE_STATUS)===!0)}(b)),d[b]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var b}P=1,L.supported=m,L.notSupportedReason=o;var d={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},L}();function U(m,o,d){const g=document.createElement(m);return o!=null&&(g.className=o),d&&d.appendChild(g),g}function q(m,o,d){const g=document.createElementNS("http://www.w3.org/2000/svg",m);for(const b of Object.keys(o))g.setAttributeNS(null,b,String(o[b]));return d&&d.appendChild(g),g}const G=typeof document<"u"?document.documentElement&&document.documentElement.style:null,$=G&&G.userSelect!==void 0?"userSelect":"WebkitUserSelect";let X;function ie(){G&&$&&(X=G[$],G[$]="none")}function de(){G&&$&&(G[$]=X)}function fe(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",fe,!0)}function be(){window.addEventListener("click",fe,!0),window.setTimeout(()=>{window.removeEventListener("click",fe,!0)},0)}function ve(m,o){const d=m.getBoundingClientRect();return qe(m,d,o)}function Qe(m,o){const d=m.getBoundingClientRect(),g=[];for(let b=0;b<o.length;b++)g.push(qe(m,d,o[b]));return g}function we(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&m.button===2&&m.ctrlKey?0:m.button}function qe(m,o,d){const g=m.offsetWidth===o.width?1:m.offsetWidth/o.width;return new s.P((d.clientX-o.left)*g,(d.clientY-o.top)*g)}const Je="01",ft="NO_ACCESS_TOKEN";class Mt{constructor(o,d,g){this._transformRequestFn=o,this._customAccessToken=d,this._silenceAuthErrors=!!g,this._createSkuToken()}_createSkuToken(){const o=function(){let d="";for(let g=0;g<10;g++)d+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Je,d].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,d){return this._transformRequestFn&&this._transformRequestFn(o,d)||{url:o}}normalizeStyleURL(o,d){if(!s.h(o))return o;const g=Nt(o);return g.params.push(`sdk=js-${v}`),g.path=`/styles/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||d)}normalizeGlyphsURL(o,d){if(!s.h(o))return o;const g=Nt(o);return g.path=`/fonts/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||d)}normalizeModelURL(o,d){if(!s.h(o))return o;const g=Nt(o);return g.path=`/models/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||d)}normalizeSourceURL(o,d,g,b){if(!s.h(o))return o;const T=Nt(o);return T.path=`/v4/${T.authority}.json`,T.params.push("secure"),g&&T.params.push(`language=${g}`),b&&T.params.push(`worldview=${b}`),this._makeAPIURL(T,this._customAccessToken||d)}normalizeIconsetURL(o,d){const g=Nt(o);return s.h(o)?(g.path=`/styles/v1${g.path}/iconset.pbf`,this._makeAPIURL(g,this._customAccessToken||d)):Kt(g)}normalizeSpriteURL(o,d,g,b){const T=Nt(o);return s.h(o)?(T.path=`/styles/v1${T.path}/sprite${d}${g}`,this._makeAPIURL(T,this._customAccessToken||b)):(T.path+=`${d}${g}`,Kt(T))}normalizeTileURL(o,d,g){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!s.h(o))return o;const b=Nt(o);b.path=b.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${d||g&&b.authority!=="raster"&&g===512?"@2x":""}${s.k.supported?".webp":"$1"}`),b.authority==="raster"?b.path=`/${s.e.RASTER_URL_PREFIX}${b.path}`:b.authority==="rasterarrays"?b.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${b.path}`:b.authority==="3dtiles"?b.path=`/${s.e.TILES3D_URL_PREFIX}${b.path}`:(b.path=b.path.replace(/^.+\/v4\//,"/"),b.path=`/${s.e.TILE_URL_VERSION}${b.path}`);const T=this._customAccessToken||function(E){for(const I of E){const M=I.match(/^access_token=(.*)$/);if(M)return M[1]}return null}(b.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&T&&this._skuToken&&b.params.push(`sku=${this._skuToken}`),this._makeAPIURL(b,T)}canonicalizeTileURL(o,d){const g=Nt(o);if(!g.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!g.path.match(/\.[\w]+$/))return o;let b="mapbox://";g.path.match(/^\/raster\/v1\//)?b+=`raster/${g.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:g.path.match(/^\/rasterarrays\/v1\//)?b+=`rasterarrays/${g.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:b+=`tiles/${g.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let T=g.params;return d&&(T=T.filter(E=>!E.match(/^access_token=/))),T.length&&(b+=`?${T.join("&")}`),b}canonicalizeTileset(o,d){const g=!!d&&s.h(d),b=[];for(const T of o.tiles||[])s.j(T)?b.push(this.canonicalizeTileURL(T,g)):b.push(T);return b}_makeAPIURL(o,d){const g="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",b=Nt(s.e.API_URL);if(o.protocol=b.protocol,o.authority=b.authority,o.protocol==="http"){const T=o.params.indexOf("secure");T>=0&&o.params.splice(T,1)}if(b.path!=="/"&&(o.path=`${b.path}${o.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Kt(o);if(d=d||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!d)throw new Error(`An API access token is required to use Mapbox GL. ${g}`);if(d[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${g}`)}return o.params=o.params.filter(T=>T.indexOf("access_token")===-1),o.params.push(`access_token=${d||""}`),Kt(o)}}const Pt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Nt(m){const o=m.match(Pt);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Kt(m){const o=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${o}`}const tt="mapbox.eventData";function mt(m){if(!m)return null;const o=m.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(s.l(o[1]))}catch{return null}}class Pe{constructor(o){this.type=o,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const d=mt(s.e.ACCESS_TOKEN);let g="";return g=d&&d.u?s.f(d.u):s.e.ACCESS_TOKEN||"",o?`${tt}.${o}:${g}`:`${tt}:${g}`}fetchEventData(){const o=s.s("localStorage"),d=this.getStorageKey(),g=this.getStorageKey("uuid"),b=this.getStorageKey("uuidTimestamp");if(o)try{const T=localStorage.getItem(d);T&&(this.eventData=JSON.parse(T));const E=localStorage.getItem(g);E&&(this.anonId=E);const I=localStorage.getItem(b);I&&(this.anonIdTimestamp=Number(I));const M=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<M)&&this.refreshUUID()}catch{s.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=s.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const o=s.s("localStorage"),d=this.getStorageKey(),g=this.getStorageKey("uuid"),b=this.getStorageKey("uuidTimestamp"),T=this.anonId,E=this.anonIdTimestamp;if(o&&T)try{localStorage.setItem(g,T),Object.keys(this.eventData).length>=1&&localStorage.setItem(d,JSON.stringify(this.eventData)),E&&localStorage.setItem(b,E.toString())}catch{s.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,d,g,b){if(!s.e.EVENTS_URL)return;const T=Nt(s.e.EVENTS_URL);T.params.push(`access_token=${b||s.e.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(o).toISOString()},I=d?Object.assign(E,d):E,M={url:Kt(T),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=s.p(M,N=>{this.pendingRequest=null,g(N),this.saveEventData(),this.processRequests(b)})}queueRequest(o,d){this.queue.push(o),this.processRequests(d)}}class gn extends Pe{constructor(o){super("metrics"),o&&(this.data=o)}postMetricsEvent(o){if(!s.e.EVENTS_URL||!o&&!s.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID();const d=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:d},o)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:d,payload:g}=this.queue.shift();this.postEvent(d,g,()=>{},o)}}const Et=new class extends Pe{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,o){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(d=>s.h(d)||s.j(d))&&this.queueRequest(Date.now(),o)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=mt(s.e.ACCESS_TOKEN),d=o?o.u:s.e.ACCESS_TOKEN;let g=d!==this.eventData.tokenU;s.v(this.anonId)||(this.refreshUUID(),g=!0);const b=this.queue.shift();if(this.eventData.lastSuccess){const T=new Date(this.eventData.lastSuccess),E=new Date(b),I=(b-this.eventData.lastSuccess)/864e5;g=g||I>=1||I<-1||T.getDate()!==E.getDate()}else g=!0;g?this.postEvent(b,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:Je,"enabled.telemetry":!1,userId:this.anonId},T=>{T||(this.eventData.lastSuccess=b,this.eventData.tokenU=d)},m):this.processRequests()}},ze=Et.postTurnstileEvent.bind(Et),$t=new class extends Pe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,o,d,g){this.skuToken=o,this.errorCb=g,s.e.EVENTS_URL&&(d||s.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},d):this.errorCb(new Error(ft)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:d}=this.queue.shift();o&&this.success[o]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID(),this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:Je,skuToken:this.skuToken,userId:this.anonId},g=>{g?this.errorCb(g):o&&(this.success[o]=!0)},m))}remove(){this.errorCb=null}},Cn=$t.postMapLoadEvent.bind($t),fn=new class extends Pe{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let o=this.mapInstanceIdMap.get(m);return o||(o=s.u(),this.mapInstanceIdMap.set(m,o)),o}getEventId(m){const o=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,o+1),o}postStyleLoadEvent(m,o){const{map:d,style:g,importedStyles:b}=o;if(!s.e.EVENTS_URL||!m&&!s.e.ACCESS_TOKEN)return;const T=this.getMapInstanceId(d),E={mapInstanceId:T,eventId:this.getEventId(T),style:g};b.length&&(E.importedStyles=b),this.queueRequest({timestamp:Date.now(),payload:E},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:d}=this.queue.shift();this.postEvent(o,d,()=>{},m)}},Nn=fn.postStyleLoadEvent.bind(fn),bn=new gn({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Vt=bn.postMetricsEvent.bind(bn),En=new gn({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),Sn=En.postMetricsEvent.bind(En),Un=new class extends Pe{constructor(){super("gljs.performance")}postPerformanceEvent(m,o){s.e.EVENTS_URL&&(m||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,performanceData:d}=this.queue.shift(),g=function(b){const T=performance.getEntriesByType("resource"),E=performance.getEntriesByType("mark"),I=function(Y){const te={};if(Y){for(const J in Y)if(J!=="other")for(const oe of Y[J]){const ae=`${J}ResolveRangeMin`,pe=`${J}ResolveRangeMax`,_e=`${J}RequestCount`,me=`${J}RequestCachedCount`;te[ae]=Math.min(te[ae]||1/0,oe.startTime),te[pe]=Math.max(te[pe]||-1/0,oe.responseEnd);const Le=Ce=>{te[Ce]===void 0&&(te[Ce]=0),++te[Ce]};oe.transferSize!==void 0&&oe.transferSize===0&&Le(me),Le(_e)}}return te}(function(Y,te){const J={};if(Y)for(const oe of Y){const ae=te(oe);J[ae]===void 0&&(J[ae]=[]),J[ae].push(oe)}return J}(T,C)),M=window.devicePixelRatio,N=navigator.connection||navigator.mozConnection||navigator.webkitConnection,j=N?N.effectiveType:void 0,Z={counters:[],metadata:[],attributes:[]},W=(Y,te,J)=>{J!=null&&Y.push({name:te,value:J.toString()})};for(const Y in I)W(Z.counters,Y,I[Y]);if(b.interactionRange[0]!==1/0&&b.interactionRange[1]!==-1/0&&(W(Z.counters,"interactionRangeMin",b.interactionRange[0]),W(Z.counters,"interactionRangeMax",b.interactionRange[1])),E)for(const Y of Object.values(x)){const te=E.find(J=>J.name===Y);te&&W(Z.counters,Y,te.startTime)}return W(Z.counters,"visibilityHidden",b.visibilityHidden),W(Z.attributes,"style",function(Y){if(Y)for(const te of Y){const J=te.name.split("?")[0];if(s.i(J)){const oe=J.split("/").slice(-2);if(oe.length===2)return`mapbox://styles/${oe[0]}/${oe[1]}`}}}(T)),W(Z.attributes,"terrainEnabled",b.terrainEnabled?"true":"false"),W(Z.attributes,"fogEnabled",b.fogEnabled?"true":"false"),W(Z.attributes,"projection",b.projection),W(Z.attributes,"zoom",b.zoom),W(Z.metadata,"devicePixelRatio",M),W(Z.metadata,"connectionEffectiveType",j),W(Z.metadata,"navigatorUserAgent",navigator.userAgent),W(Z.metadata,"screenWidth",window.screen.width),W(Z.metadata,"screenHeight",window.screen.height),W(Z.metadata,"windowWidth",window.innerWidth),W(Z.metadata,"windowHeight",window.innerHeight),W(Z.metadata,"mapWidth",b.width/M),W(Z.metadata,"mapHeight",b.height/M),W(Z.metadata,"webglRenderer",b.renderer),W(Z.metadata,"webglVendor",b.vendor),W(Z.metadata,"sdkVersion",v),W(Z.metadata,"sdkIdentifier","mapbox-gl-js"),Z}(d);for(const b of g.metadata);for(const b of g.counters);for(const b of g.attributes);this.postEvent(o,g,()=>{},m)}},nn=Un.postPerformanceEvent.bind(Un),wr=new class extends Pe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,o,d,g){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const b=Nt(s.e.API_URL+s.e.SESSION_PATH);b.params.push(`sku=${o||""}`),b.params.push(`access_token=${g||s.e.ACCESS_TOKEN||""}`);const T={url:Kt(b),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(T,E=>{this.pendingRequest=null,d(E),this.saveEventData(),this.processRequests(g)})}getSessionAPI(m,o,d,g){this.skuToken=o,this.errorCb=g,s.e.SESSION_PATH&&s.e.API_URL&&(d||s.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},d):this.errorCb(new Error(ft)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:d}=this.queue.shift();o&&this.success[o]||this.getSession(d,this.skuToken,g=>{g?this.errorCb(g):o&&(this.success[o]=!0)},m)}remove(){this.errorCb=null}},Xr=wr.getSessionAPI.bind(wr),ar=new Set;function tr(m,o){o?ar.add(m):ar.delete(m)}class Vn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,d){this._updatedSourceCaches[o]=d,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){const d=o.scope;this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._updatedLayers[d].add(o.id),this.setDirty()}removeLayer(o){const d=o.scope;this._removedLayers[d]=this._removedLayers[d]||{},this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._removedLayers[d][o.id]=o,this._updatedLayers[d].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){const o={};for(const d in this._updatedLayers)o[d]=o[d]||{},o[d].updatedIds=Array.from(this._updatedLayers[d].values());for(const d in this._removedLayers)o[d]=o[d]||{},o[d].removedIds=Object.keys(this._removedLayers[d]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(o){return this._updatedImages[o]?Array.from(this._updatedImages[o].values()):[]}updateImage(o,d){this._updatedImages[d]=this._updatedImages[d]||new Set,this._updatedImages[d].add(s.I.toString(o)),this.setDirty()}resetUpdatedImages(o){this._updatedImages[o]&&this._updatedImages[o].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function xr(m){const{userImage:o}=m;return!!(o&&o.render&&o.render())&&(m.data.replace(new Uint8Array(o.data.buffer)),!0)}class ws extends s.E{constructor(o){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=o,o!=="raster"&&s.r()&&(this.imageRasterizerDispatcher=new s.D(s.t(),this,"Image Rasterizer Worker",1))}addScope(o){this.loaded.set(o,!1),this.imageProviders.set(o,new Map),this.images.set(o,new Map),this.updatedImages.set(o,new Set),this.callbackDispatchedThisFrame.set(o,new Set),this.patterns.set(o,new Map),this.atlasImage.set(o,new s.q({width:1,height:1}))}removeScope(o){this.loaded.delete(o),this.imageProviders.delete(o),this.images.delete(o),this.updatedImages.delete(o),this.callbackDispatchedThisFrame.delete(o),this.patterns.delete(o),this.atlasImage.delete(o);const d=this.atlasTexture.get(o);d&&(d.destroy(),this.atlasTexture.delete(o))}addImageProvider(o,d){this.imageProviders.has(d)||this.imageProviders.set(d,new Map),this.imageProviders.get(d).set(o.id,o)}removeImageProvider(o,d){this.imageProviders.has(d)&&this.imageProviders.get(d).delete(o)}getPendingImageProviders(){const o=[];for(const d of this.imageProviders.values())for(const g of d.values())g.hasPendingRequests()&&o.push(g);return o}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.x),this._imageRasterizer}isLoaded(){for(const o of this.loaded.keys())if(!this.loaded.get(o))return!1;return!0}setLoaded(o,d){if(this.loaded.get(d)!==o&&(this.loaded.set(d,o),o)){for(const{ids:g,callback:b}of this.requestors)this._notify(g,d,b);this.requestors=[]}}hasImage(o,d){return!!this.getImage(o,d)}getImage(o,d){return this.images.get(d).get(o.toString())}addImage(o,d,g){this._validate(o,g)&&this.images.get(d).set(o.toString(),g)}_validate(o,d){let g=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new s.y(new Error(`Image "${o.name}" has invalid "stretchX" value`))),g=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new s.y(new Error(`Image "${o.name}" has invalid "stretchY" value`))),g=!1),this._validateContent(d.content,d)||(this.fire(new s.y(new Error(`Image "${o.name}" has invalid "content" value`))),g=!1),g}_validateStretch(o,d){if(!o)return!0;let g=0;for(const b of o){if(b[0]<g||b[1]<b[0]||d<b[1])return!1;g=b[1]}return!0}_validateContent(o,d){return o?o.length!==4||!d.usvg&&(o[0]<0||d.data.width<o[0]||o[1]<0||d.data.height<o[1]||o[2]<0||d.data.width<o[2]||o[3]<0||d.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,d,g){const b=this.images.get(d).get(o.toString());g.version=b.version+1,this.images.get(d).set(o.toString(),g),this.updatedImages.get(d).add(o),this.removeFromImageRasterizerCache(o,d)}clearUpdatedImages(o){this.updatedImages.get(o).clear()}removeFromImageRasterizerCache(o,d){this.spriteFormat!=="raster"&&(s.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:d}):this.imageRasterizer.removeImagesFromCacheByIds([o],d))}removeImage(o,d){const g=this.images.get(d),b=g.get(o.toString());g.delete(o.toString()),this.patterns.get(d).delete(o.toString()),this.removeFromImageRasterizerCache(o,d),b.userImage&&b.userImage.onRemove&&b.userImage.onRemove()}listImages(o){return Array.from(this.images.get(o).keys()).map(d=>s.I.from(d))}getImages(o,d,g){const b=[],T=[],E=this.imageProviders.get(d);for(const j of o){if(!j.iconsetId){b.push(j);continue}const Z=E.get(j.iconsetId);Z&&(this.getImage(j,d)?T.push(j):Z.addPendingRequest(j))}if(b.length===0)return void this._notify(T,d,g);let I=!0;const M=!!this.loaded.get(d),N=this.images.get(d);if(!M)for(const j of b)N.has(j.toString())||(I=!1);M||I?this._notify(b,d,g):this.requestors.push({ids:b,scope:d,callback:g})}rasterizeImages(o,d){const g=new Map,{tasks:b,scope:T}=o;for(const[E,I]of b.entries()){const M=this.getImage(I.id,T);M&&g.set(E,{image:M,imageVariant:I})}this._rasterizeImages(T,g,d)}_rasterizeImages(o,d,g){if(s.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:d,scope:o},g);else{const b=new Map;for(const[T,{image:E,imageVariant:I}]of d.entries())b.set(T,this.imageRasterizer.rasterize(I,E,o,0));g(void 0,b)}}getUpdatedImages(o){return this.updatedImages.get(o)||new Set}_notify(o,d,g){const b=this.images.get(d),T=new Map;for(const E of o){if(!b.get(E.toString())){if(E.iconsetId)continue;this.fire(new s.z("styleimagemissing",{id:E.name}))}const I=b.get(E.toString());if(!I){s.w(`Image "${E.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const M={data:I.usvg?null:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,usvg:I.usvg,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)};I.usvg&&Object.assign(M,{width:I.icon.usvg_tree.width,height:I.icon.usvg_tree.height}),T.set(s.I.toString(E),M)}g(null,T)}getPixelSize(o){const{width:d,height:g}=this.atlasImage.get(o);return{width:d,height:g}}getPattern(o,d,g){const b=o.toString(),T=this.patterns.get(d),E=T.get(b),I=this.getImage(o,d);if(!I)return null;if(E){if(E.position.version===I.version)return E.position;E.position.version=I.version}else{if(I.usvg&&!I.data){const M=this.getPatternInFlightId(b,d);if(this.patternsInFlight.has(M))return null;this.patternsInFlight.add(M);const N=new s.A(o).scaleSelf(s.o.devicePixelRatio),j=new Map([[N.toString(),{image:I,imageVariant:N}]]);return this._rasterizeImages(d,j,(Z,W)=>this.storePatternImage(N,d,I,g,W)),null}this.storePattern(o,d,I)}return this._updatePatternAtlas(d,g),T.get(b).position}getPatternInFlightId(o,d){return s.B(o,d)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,d,g,b,T){const E=o.toString(),I=T?T.get(E):void 0;I&&(g.data=I,this.storePattern(o.id,d,g),this._updatePatternAtlas(d,b),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),d)))}storePattern(o,d,g){const b={w:g.data.width+2*s.C,h:g.data.height+2*s.C,x:0,y:0},T=new s.F(b,g,s.C);this.patterns.get(d).set(o.toString(),{bin:b,position:T})}destroyAtlasTextures(){for(const o of this.atlasTexture.values())o&&o.destroy();this.atlasTexture.clear()}bind(o,d){const g=o.gl;let b=this.atlasTexture.get(d);b?this.dirty&&(b.update(this.atlasImage.get(d)),this.dirty=!1):(b=new s.T(o,this.atlasImage.get(d),g.RGBA8),this.atlasTexture.set(d,b)),b.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(o,d){const g=this.patterns.get(o),b=Array.from(g.values()).map(({bin:N})=>N),{w:T,h:E}=s.G(b),I=this.atlasImage.get(o);I.resize({width:T||1,height:E||1});const M=this.images.get(o);for(const[N,{bin:j,position:Z}]of g.entries()){let W=Z.padding;const Y=j.x+W,te=j.y+W,J=M.get(N).data,oe=J.width,ae=J.height;W=W>1?W-1:W,s.q.copy(J,I,{x:0,y:0},{x:Y,y:te},{width:oe,height:ae},d),s.q.copy(J,I,{x:0,y:ae-W},{x:Y,y:te-W},{width:oe,height:W},d),s.q.copy(J,I,{x:0,y:0},{x:Y,y:te+ae},{width:oe,height:W},d),s.q.copy(J,I,{x:oe-W,y:0},{x:Y-W,y:te},{width:W,height:ae},d),s.q.copy(J,I,{x:0,y:0},{x:Y+oe,y:te},{width:W,height:ae},d),s.q.copy(J,I,{x:oe-W,y:ae-W},{x:Y-W,y:te-W},{width:W,height:W},d),s.q.copy(J,I,{x:0,y:ae-W},{x:Y+oe,y:te-W},{width:W,height:W},d),s.q.copy(J,I,{x:0,y:0},{x:Y+oe,y:te+ae},{width:W,height:W},d),s.q.copy(J,I,{x:oe-W,y:0},{x:Y-W,y:te+ae},{width:W,height:W},d)}this.dirty=!0}beginFrame(){for(const o of this.images.keys())this.callbackDispatchedThisFrame.set(o,new Set)}dispatchRenderCallbacks(o,d){const g=this.images.get(d);for(const b of o){if(this.callbackDispatchedThisFrame.get(d).has(b.toString()))continue;this.callbackDispatchedThisFrame.get(d).add(b.toString());const T=g.get(b.toString());xr(T)&&this.updateImage(b,d,T)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function bi(m){const o=m.value,d=m.valueSpec,g=m.style,b=m.styleSpec,T=m.key,E=m.arrayElementValidator||Zn;if(!Array.isArray(o))return[new s.V(T,o,`array expected, ${s.K(o)} found`)];if(d.length&&o.length!==d.length)return[new s.V(T,o,`array length ${d.length} expected, length ${o.length} found`)];if(d["min-length"]&&o.length<d["min-length"])return[new s.V(T,o,`array length at least ${d["min-length"]} expected, length ${o.length} found`)];let I={type:d.value,values:d.values,minimum:d.minimum,maximum:d.maximum,function:void 0};b.$version<7&&(I.function=d.function),s.H(d.value)&&(I=d.value);let M=[];for(let N=0;N<o.length;N++)M=M.concat(E({array:o,arrayIndex:N,value:o[N],valueSpec:I,style:g,styleSpec:b,key:`${T}[${N}]`},!0));return M}function Ai(m){const o=m.key,d=m.value,g=m.valueSpec;if(!s.L(d))return[new s.V(o,d,`number expected, ${s.K(d)} found`)];if(d!=d)return[new s.V(o,d,"number expected, NaN found")];if("minimum"in g){let b=g.minimum;if(Array.isArray(g.minimum)&&(b=g.minimum[m.arrayIndex]),d<b)return[new s.V(o,d,`${d} is less than the minimum value ${b}`)]}if("maximum"in g){let b=g.maximum;if(Array.isArray(g.maximum)&&(b=g.maximum[m.arrayIndex]),d>b)return[new s.V(o,d,`${d} is greater than the maximum value ${b}`)]}return[]}function ps(m){const o=m.key,d=m.value;if(!s.H(d))return[new s.V(o,d,`object expected, ${s.K(d)} found`)];const g=m.valueSpec,b=s.J(d.type);let T,E,I,M={};const N=b!=="categorical"&&d.property===void 0,j=!N,Z=function(J){const oe=J.stops;return Array.isArray(oe)&&Array.isArray(oe[0])&&s.H(oe[0][0])}(d),W=ns({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(J){if(b==="identity")return[new s.V(J.key,J.value,'identity function may not have a "stops" property')];let oe=[];const ae=J.value;return oe=oe.concat(bi({key:J.key,value:ae,valueSpec:J.valueSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:Y})),Array.isArray(ae)&&ae.length===0&&oe.push(new s.V(J.key,ae,"array must have at least one stop")),oe},default:function(J){return Zn({key:J.key,value:J.value,valueSpec:g,style:J.style,styleSpec:J.styleSpec})}}});return b==="identity"&&N&&W.push(new s.V(m.key,m.value,'missing required property "property"')),b==="identity"||d.stops||W.push(new s.V(m.key,m.value,'missing required property "stops"')),b==="exponential"&&g.expression&&!s.M(g)&&W.push(new s.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(j&&!s.N(g)?W.push(new s.V(m.key,m.value,"property functions not supported")):N&&!s.O(g)&&W.push(new s.V(m.key,m.value,"zoom functions not supported"))),b!=="categorical"&&!Z||d.property!==void 0||W.push(new s.V(m.key,m.value,'"property" property is required')),W;function Y(J){let oe=[];const ae=J.value,pe=J.key;if(!Array.isArray(ae))return[new s.V(pe,ae,`array expected, ${s.K(ae)} found`)];if(ae.length!==2)return[new s.V(pe,ae,`array length 2 expected, length ${ae.length} found`)];if(Z){if(!s.H(ae[0]))return[new s.V(pe,ae,`object expected, ${s.K(ae[0])} found`)];const _e=ae[0];if(_e.zoom===void 0)return[new s.V(pe,ae,"object stop key must have zoom")];if(_e.value===void 0)return[new s.V(pe,ae,"object stop key must have value")];const me=s.J(_e.zoom);if(typeof me!="number")return[new s.V(pe,_e.zoom,"stop zoom values must be numbers")];if(I&&I>me)return[new s.V(pe,_e.zoom,"stop zoom values must appear in ascending order")];me!==I&&(I=me,E=void 0,M={}),oe=oe.concat(ns({key:`${pe}[0]`,value:ae[0],valueSpec:{zoom:{}},style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:Ai,value:te}}))}else oe=oe.concat(te({key:`${pe}[0]`,value:ae[0],style:J.style,styleSpec:J.styleSpec},ae));return s.Q(s.S(ae[1]))?oe.concat([new s.V(`${pe}[1]`,ae[1],"expressions are not allowed in function stops.")]):oe.concat(Zn({key:`${pe}[1]`,value:ae[1],valueSpec:g,style:J.style,styleSpec:J.styleSpec}))}function te(J,oe){const ae=s.K(J.value),pe=s.J(J.value),_e=J.value!==null?J.value:oe;if(T){if(ae!==T)return[new s.V(J.key,_e,`${ae} stop domain type must match previous stop domain type ${T}`)]}else T=ae;if(ae!=="number"&&ae!=="string"&&ae!=="boolean"&&typeof pe!="number"&&typeof pe!="string"&&typeof pe!="boolean")return[new s.V(J.key,_e,"stop domain value must be a number, string, or boolean")];if(ae!=="number"&&b!=="categorical"){let me=`number expected, ${ae} found`;return s.N(g)&&b===void 0&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(J.key,_e,me)]}return b!=="categorical"||ae!=="number"||typeof pe=="number"&&isFinite(pe)&&Math.floor(pe)===pe?b!=="categorical"&&ae==="number"&&typeof pe=="number"&&typeof E=="number"&&E!==void 0&&pe<E?[new s.V(J.key,_e,"stop domain values must appear in ascending order")]:(E=pe,b==="categorical"&&pe in M?[new s.V(J.key,_e,"stop domain values must be unique")]:(M[pe]=!0,[])):[new s.V(J.key,_e,`integer expected, found ${String(pe)}`)]}}function $i(m){const o=(m.expressionContext==="property"?s.W:s.U)(s.S(m.value),m.valueSpec);if(o.result==="error")return o.value.map(g=>new s.V(`${m.key}${g.key}`,m.value,g.message));const d=o.value.expression||o.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!d.outputDefined())return[new s.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!s.Z(d))return[new s.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return Ts(d,m);if(m.expressionContext==="appearance")return tn(d,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!s.X(d,["zoom","feature-state"]))return[new s.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!s.Y(d))return[new s.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ts(m,o){const d=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const b of o.valueSpec.expression.parameters)d.delete(b);if(d.size===0)return[];const g=[];return m instanceof s._&&d.has(m.name)?[new s.V(o.key,o.value,`["${m.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(m.eachChild(b=>{g.push(...Ts(b,o))}),g)}function tn(m,o){const d=new Set;if(o.valueSpec&&o.valueSpec.expression)for(const b of o.valueSpec.expression.parameters)d.add(b);if(d.size===0)return[];const g=[];return m instanceof s._&&!d.has(m.name)?[new s.V(o.key,o.value,`["${m.name}"] is not an allowed parameter`)]:(m.eachChild(b=>{g.push(...tn(b,o))}),g)}function kn(m){const o=m.key,d=m.value,g=m.valueSpec,b=[];return Array.isArray(g.values)?g.values.indexOf(s.J(d))===-1&&b.push(new s.V(o,d,`expected one of [${g.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(g.values).indexOf(s.J(d))===-1&&b.push(new s.V(o,d,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(d)} found`)),b}function Mr(m){return s.a2(s.S(m.value))?$i(Object.assign({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):wt(m)}function wt(m){const o=m.value,d=m.key;if(!Array.isArray(o))return[new s.V(d,o,`array expected, ${s.K(o)} found`)];if(o.length<1)return[new s.V(d,o,"filter array must have at least 1 element")];const g=m.styleSpec;let b=kn({key:`${d}[0]`,value:o[0],valueSpec:g.filter_operator});const T=()=>{o.length>=2&&(s.a0(o[1])||b.push(new s.V(`${d}[1]`,o[1],`string expected, ${s.K(o[1])} found`)));for(let E=2;E<o.length;E++)s.J(o[1])==="$type"?b=b.concat(kn({key:`${d}[${E}]`,value:o[E],valueSpec:g.geometry_type})):s.a0(o[E])||s.L(o[E])||s.$(o[E])||b.push(new s.V(`${d}[${E}]`,o[E],`string, number, or boolean expected, ${s.K(o[E])} found.`))};switch(s.J(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&s.J(o[1])==="$type"&&b.push(new s.V(d,o,`"$type" cannot be use with operator "${o[0]}"`)),o.length!==3&&b.push(new s.V(d,o,`filter array for operator "${o[0]}" must have 3 elements`)),T();break;case"==":case"!=":o.length!==3&&b.push(new s.V(d,o,`filter array for operator "${o[0]}" must have 3 elements`)),T();break;case"in":case"!in":T();break;case"any":case"all":case"none":for(let E=1;E<o.length;E++)b=b.concat(wt({key:`${d}[${E}]`,value:o[E],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":o.length!==2?b.push(new s.V(d,o,`filter array for "${o[0]}" operator must have 2 elements`)):s.a0(o[1])||b.push(new s.V(`${d}[1]`,o[1],`string expected, ${s.K(o[1])} found`))}return b}function Rn(m,o){const d=m.key,g=m.style,b=m.layer,T=m.styleSpec,E=m.value,I=m.objectKey,M=T[`${o}_${m.layerType}`];if(!M)return[];const N=I.match(/^(.*)-use-theme$/);if(N&&M[N[1]])return s.Q(s.S(E))?[].concat(Zn({key:d,value:E,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:g,styleSpec:T,expressionContext:"property",propertyType:o,propertyKey:I})):Zn({key:d,value:E,valueSpec:{type:"string"},style:g,styleSpec:T});const j=I.match(/^(.*)-transition$/);if(o==="paint"&&j&&M[j[1]]&&M[j[1]].transition)return Zn({key:d,value:E,valueSpec:T.transition,style:g,styleSpec:T});const Z=m.valueSpec||M[I];if(!Z)return[new s.a3(d,E,`unknown property "${I}"`)];let W;if(s.a0(E)&&s.N(Z)&&!Z.tokens&&(W=/^{([^}]+)}$/.exec(E))){const te=`\`{ "type": "identity", "property": ${W?JSON.stringify(W[1]):'"_"'} }\``;return[new s.V(d,E,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${te}.`)]}const Y=[];if(m.layerType==="symbol")I!=="text-field"||!g||g.glyphs||g.imports||Y.push(new s.V(d,E,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&s.a4(s.S(E))&&s.J(E.type)==="identity"&&Y.push(new s.V(d,E,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&o==="paint"&&b&&b.layout&&b.layout.hasOwnProperty("model-id")&&s.N(Z)&&(s.a5(Z)||s.O(Z))){const te=s.W(s.S(E),Z).value,J="expression"in te&&te.expression||"_styleExpression"in te&&te._styleExpression&&te._styleExpression.expression;J&&!s.X(J,["measure-light"])&&(I==="model-emissive-strength"&&s.Y(J)&&s.Z(J)||Y.push(new s.V(d,E,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Y.concat(Zn({key:m.key,value:E,valueSpec:Z,style:g,styleSpec:T,expressionContext:"property",propertyType:o,propertyKey:I}))}function nr(m){return Rn(m,"paint")}function dt(m){return Rn(m,"layout")}function Jn(m){let o=[];const d=m.value,g=m.key,b=m.style,T=m.styleSpec;if(!s.H(d))return[new s.V(g,d,"object expected")];d.type||d.ref||o.push(new s.V(g,d,'either "type" or "ref" is required'));let E=s.J(d.type);const I=s.J(d.ref);if(d.id){const M=s.J(d.id);for(let N=0;N<m.arrayIndex;N++){const j=b.layers[N];s.J(j.id)===M&&o.push(new s.V(g,d.id,`duplicate layer id "${M}", previously used at line ${j.id.__line__}`))}}if("ref"in d){let M;["type","source","source-layer","filter","layout"].forEach(N=>{N in d&&o.push(new s.V(g,d[N],`"${N}" is prohibited for ref layers`))}),b.layers.forEach(N=>{s.J(N.id)===I&&(M=N)}),M?M.ref?o.push(new s.V(g,d.ref,"ref cannot reference another ref layer")):E=s.J(M.type):typeof I=="string"&&o.push(new s.V(g,d.ref,`ref layer "${I}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(d.source)if(s.a0(d.source)){const M=b.sources&&b.sources[d.source],N=M&&s.J(M.type);M?N==="vector"&&E==="raster"?o.push(new s.V(g,d.source,`layer "${d.id}" requires a raster source`)):N==="raster"&&E!=="raster"?o.push(new s.V(g,d.source,`layer "${d.id}" requires a vector source`)):N!=="vector"||d["source-layer"]?N==="raster-dem"&&E!=="hillshade"?o.push(new s.V(g,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="raster-array"||["raster","raster-particle"].includes(E)?E==="line"&&d.paint&&(d.paint["line-gradient"]||d.paint["line-trim-offset"])&&N==="geojson"&&!M.lineMetrics?o.push(new s.V(g,d,`layer "${d.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):E==="raster-particle"&&N!=="raster-array"&&o.push(new s.V(g,d.source,`layer "${d.id}" requires a 'raster-array' source.`)):o.push(new s.V(g,d.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new s.V(g,d,`layer "${d.id}" must specify a "source-layer"`)):o.push(new s.V(g,d.source,`source "${d.source}" not found`))}else o.push(new s.V(`${g}.source`,d.source,'"source" must be a string'));else o.push(new s.V(g,d,'missing required property "source"'));return o=o.concat(ns({key:g,value:d,valueSpec:T.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Zn({key:`${g}.type`,value:d.type,valueSpec:T.layer.type,style:m.style,styleSpec:m.styleSpec,object:d,objectKey:"type"}),filter:M=>Mr(Object.assign({layerType:E},M)),layout:M=>ns({layer:d,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":N=>dt(Object.assign({layerType:E},N))}}),paint:M=>ns({layer:d,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":N=>nr(Object.assign({layerType:E,layer:d},N))}}),appearances(M){const N=bi({key:M.key,value:M.value,valueSpec:M.valueSpec,style:M.style,styleSpec:M.styleSpec,arrayElementValidator:W=>function(Y){const{key:te,layer:J,layerType:oe}=Y,ae=s.J(Y.value),pe=s.J(ae.name),_e=s.J(ae.condition),me=ns({key:te,value:ae,valueSpec:Y.styleSpec.appearance,style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{condition:Le=>function(Ce){const Re=[];return Re.push(...$i({key:Ce.key,value:Ce.object.condition,valueSpec:s.a6.appearance.condition,expressionContext:"appearance"})),Re}(Object.assign({layer:J,layerType:oe},Le)),properties:Le=>function(Ce){const Re=[],{styleSpec:Ae,layer:Te,layerType:Fe}=Ce,Xe=Ae[`paint_${Fe}`],He=Ae[`layout_${Fe}`],ct=Ce.object[Ce.objectKey];for(const ht in ct){const St=ht in Xe?"paint":ht in He?"layout":void 0;if(!St){Re.push(new s.V(Ce.key,ht,`unknown property "${ht}" for layer type "${Fe}"`));continue}const Ut=Object.assign({},Ce,{key:`${Ce.key}.${ht}`,object:ct,objectKey:ht,layer:Te,layerType:Fe,value:ct[ht],valueSpec:St==="paint"?Xe[ht]:He[ht]});Re.push(...Rn(Ut,St))}return Re}(Object.assign({layer:J,layerType:oe},Le))}});return pe!=="hidden"&&_e===void 0&&me.push(new s.V(Y.key,"name",'Appearance with name different than "hidden" must have a condition')),me}(Object.assign({layerType:E,layer:d},W))}),j=Array.isArray(M.value)?M.value:[],Z=new Set;return j.forEach((W,Y)=>{const te=s.J(W.name);if(te)if(Z.has(te)){const J=s.J(d.id);N.push(new s.V(M.key,te,`Duplicated appearance name "${te}" for layer "${J}"`))}else Z.add(te)}),N}}})),o}function qr({key:m,value:o}){return s.a0(o)?[]:[new s.V(m,o,`string expected, ${s.K(o)} found`)]}const ts={promoteId:function m({key:o,value:d}){if(s.a0(d))return qr({key:o,value:d});if(Array.isArray(d)){const b=[],T=s.S(d),E=s.U(T);return E.result==="error"&&E.value.forEach(I=>{b.push(new s.V(`${o}${I.key}`,null,`${I.message}`))}),s.X(E.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||b.push(new s.V(`${o}`,null,"promoteId expression should be only feature dependent")),b}if(!s.H(d))return[new s.V(o,d,`string, expression or object expected, "${s.K(d)}" found`)];const g=[];for(const b in d)g.push(...m({key:`${o}.${b}`,value:d[b]}));return g}};function ms(m){const o=m.value,d=m.key,g=m.styleSpec,b=m.style;if(!s.H(o))return[new s.V(d,o,`object expected, ${s.K(o)} found`)];if(!("type"in o))return[new s.V(d,o,'"type" is required')];const T=s.J(o.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(T)&&("url"in o||"tiles"in o||E.push(new s.a3(d,o,'Either "url" or "tiles" is required.'))),T){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(ns({key:d,value:o,valueSpec:g[`source_${T.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:ts})),E;case"geojson":if(E=ns({key:d,value:o,valueSpec:g.source_geojson,style:b,styleSpec:g,objectElementValidators:ts}),"cluster"in o&&"clusterProperties"in o){if(!s.H(o.clusterProperties))return[new s.V(`${d}.clusterProperties`,o,`object expected, ${s.K(o)} found`)];for(const I in o.clusterProperties){const M=o.clusterProperties[I];if(!Array.isArray(M))return[new s.V(`${d}.clusterProperties.${I}`,M,"array expected")];const[N,j]=M,Z=typeof N=="string"?[N,["accumulated"],["get",I]]:N;E.push(...$i({key:`${d}.${I}.map`,value:j,expressionContext:"cluster-map"})),E.push(...$i({key:`${d}.${I}.reduce`,value:Z,expressionContext:"cluster-reduce"}))}}return E;case"video":return ns({key:d,value:o,valueSpec:g.source_video,style:b,styleSpec:g});case"image":return ns({key:d,value:o,valueSpec:g.source_image,style:b,styleSpec:g});case"canvas":return[new s.V(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return kn({key:`${d}.type`,value:o.type,valueSpec:{values:Mn(g)}})}}function Mn(m){return m.source.reduce((o,d)=>{const g=m[d];return g.type.type==="enum"&&(o=o.concat(Object.keys(g.type.values||{}))),o},[])}function Tt(m){const o=m.value,d=m.styleSpec,g=d.light,b=m.style;if(o===void 0)return[];if(!s.H(o))return[new s.V("light",o,`object expected, ${s.K(o)} found`)];let T=[];for(const E in o){const I=E.match(/^(.*)-transition$/),M=E.match(/^(.*)-use-theme$/);T=T.concat(M&&g[M[1]]?Zn({key:E,value:o[E],valueSpec:{type:"string"},style:b,styleSpec:d}):I&&g[I[1]]&&g[I[1]].transition?Zn({key:E,value:o[E],valueSpec:d.transition,style:b,styleSpec:d}):g[E]?Zn({key:E,value:o[E],valueSpec:g[E],style:b,styleSpec:d}):[new s.V(E,o[E],`unknown property "${E}"`)])}return T}function ut(m){const o=m.value;if(!o)return[];const d=m.key;if(!s.H(o))return[new s.V(d,o,`object expected, ${s.K(o)} found`)];let g=[];const b=m.styleSpec,T=b["light-3d"],E=m.style,I=m.style.lights;for(const j of["type","id"])if(!(j in o))return g=g.concat([new s.V(d,o,`missing property "${j}"`)]),g;if(!s.a0(o.type))return g=g.concat([new s.V(`${d}.type`,o.type,"string expected")]),g;if(I)for(let j=0;j<m.arrayIndex;j++){const Z=s.J(o.type),W=I[j];s.J(W.type)===Z&&g.push(new s.V(d,o.id,`duplicate light type "${o.type}", previously defined at line ${W.id.__line__}`))}const M=`properties_light_${o.type}`;if(!(M in b))return g=g.concat([new s.V(`${d}.type`,o,`Invalid light type ${o.type}`)]),g;const N=b[M];for(const j in o)if(j==="properties"){const Z=o[j];if(!s.H(Z))return g=g.concat([new s.V("properties",Z,`object expected, ${s.K(Z)} found`)]),g;for(const W in Z){const Y=W.match(/^(.*)-transition$/),te=W.match(/^(.*)-use-theme$/);g=g.concat(te&&N[te[1]]?Zn({key:j,value:Z[W],valueSpec:{type:"string"},style:E,styleSpec:b}):Y&&N[Y[1]]&&N[Y[1]].transition?Zn({key:j,value:o[j],valueSpec:b.transition,style:E,styleSpec:b}):N[W]?Zn({key:W,value:Z[W],valueSpec:N[W],style:E,styleSpec:b}):[new s.a3(m.key,Z[W],`unknown property "${W}"`)])}}else g=g.concat(T[j]?Zn({key:j,value:o[j],valueSpec:T[j],style:E,styleSpec:b}):[new s.a3(j,o[j],`unknown property "${j}"`)]);return g}function on(m){const o=m.value,d=m.key,g=m.style,b=m.styleSpec,T=b.terrain;if(o==null)return[];if(!s.H(o))return[new s.V("terrain",o,`object expected, ${s.K(o)} found`)];let E=[];for(const I in o){const M=I.match(/^(.*)-transition$/),N=I.match(/^(.*)-use-theme$/);E=E.concat(N&&T[N[1]]?Zn({key:I,value:o[I],valueSpec:{type:"string"},style:g,styleSpec:b}):M&&T[M[1]]&&T[M[1]].transition?Zn({key:I,value:o[I],valueSpec:b.transition,style:g,styleSpec:b}):T[I]?Zn({key:I,value:o[I],valueSpec:T[I],style:g,styleSpec:b}):[new s.a3(I,o[I],`unknown property "${I}"`)])}if(o.source)if(s.a0(o.source)){const I=g.sources&&g.sources[o.source],M=I&&s.J(I.type);I?M!=="raster-dem"&&E.push(new s.V(`${d}.source`,o.source,`terrain cannot be used with a source of type ${M}, it only be used with a "raster-dem" source type`)):E.push(new s.V(`${d}.source`,o.source,`source "${o.source}" not found`))}else E.push(new s.V(`${d}.source`,o.source,"source must be a string"));else E.push(new s.V(d,o,'terrain is missing required property "source"'));return E}function qn(m){const o=m.value,d=m.style,g=m.styleSpec,b=g.fog;if(o===void 0)return[];if(!s.H(o))return[new s.V("fog",o,`object expected, ${s.K(o)} found`)];let T=[];for(const E in o){const I=E.match(/^(.*)-transition$/),M=E.match(/^(.*)-use-theme$/);T=T.concat(M&&b[M[1]]?Zn({key:E,value:o[E],valueSpec:{type:"string"},style:d,styleSpec:g}):I&&b[I[1]]&&b[I[1]].transition?Zn({key:E,value:o[E],valueSpec:g.transition,style:d,styleSpec:g}):b[E]?Zn({key:E,value:o[E],valueSpec:b[E],style:d,styleSpec:g}):[new s.a3(E,o[E],`unknown property "${E}"`)])}return T}const Or={"*":()=>[],array:bi,boolean:function(m){const o=m.value,d=m.key;return s.$(o)?[]:[new s.V(d,o,`boolean expected, ${s.K(o)} found`)]},number:Ai,color:function({key:m,value:o}){return s.a0(o)?s.a1.parseCSSColor(o)===null?[new s.V(m,o,`color expected, "${o}" found`)]:[]:[new s.V(m,o,`color expected, ${s.K(o)} found`)]},enum:kn,filter:Mr,function:ps,layer:Jn,object:ns,source:ms,model:s.a7,light:Tt,"light-3d":ut,terrain:on,fog:qn,string:qr,formatted:function(m){return qr(m).length===0?[]:$i(m)},resolvedImage:function(m){return qr(m).length===0?[]:$i(m)},projection:function(m){const o=m.value,d=m.styleSpec,g=d.projection,b=m.style;if(s.H(o)){let T=[];for(const E in o)T=T.concat(Zn({key:E,value:o[E],valueSpec:g[E],style:b,styleSpec:d}));return T}return s.a0(o)?[]:[new s.V("projection",o,`object or string expected, ${s.K(o)} found`)]},import:function(m){const o=m.key,{value:d,styleSpec:g}=m;if(!s.H(d))return[new s.V(o,d,"import must be an object")];const{data:b,...T}=d;Object.defineProperty(T,"__line__",{value:d.__line__,enumerable:!1});let E=ns(Object.assign({},m,{value:T,valueSpec:g.import}));return s.J(T.id)===""&&E.push(new s.V(`${m.key}.id`,T,"import id can't be an empty string")),b&&(E=E.concat(Ys(b,g,{key:`${m.key}.data`}))),E},iconset:function(m){const o=m.value,d=m.key,g=m.styleSpec,b=m.style;if(!s.H(o))return[new s.V(d,o,"object expected")];if(!o.type)return[new s.V(d,o,'"type" is required')];const T=s.J(o.type);let E=[];if(E=E.concat(ns({key:d,value:o,valueSpec:g[`iconset_${T}`],style:b,styleSpec:g})),function(I,M){return!(I!=="source"||!M.source)}(T,o)){const I=b.sources&&b.sources[o.source],M=I&&s.J(I.type);I?M!=="raster-array"&&E.push(new s.V(d,o.source,`iconset cannot be used with a source of type ${String(M)}, it only be used with a "raster-array" source type`)):E.push(new s.V(d,o.source,`source "${o.source}" not found`))}return E}};function Zn(m,o=!1){const d=m.value,g=m.valueSpec,b=m.styleSpec;if(g.expression){if(s.a4(s.J(d)))return ps(m);if(s.Q(s.S(d)))return $i(m)}if(g.type&&Or[g.type]){const T=Or[g.type](m);return o===!0&&T.length>0&&Array.isArray(m.value)?$i(m):T}return ns(Object.assign({},m,{valueSpec:g.type?b[g.type]:g}))}function ns(m){const o=m.key,d=m.value,g=m.valueSpec||{},b=m.objectElementValidators||{},T=m.style,E=m.styleSpec;if(!s.H(d))return[new s.V(o,d,`object expected, ${s.K(d)} found`)];let I=[];for(const M in d){const N=M.split(".")[0];let j;b[N]?j=b[N]:g[N]?j=Zn:b["*"]?j=b["*"]:g["*"]&&(j=Zn),j?I=I.concat(j({key:(o&&`${o}.`)+M,value:d[M],valueSpec:g[N]||g["*"],style:T,styleSpec:E,object:d,objectKey:M},d)):I.push(new s.a3(o,d[M],`unknown property "${M}"`))}for(const M in g){if(b[M])continue;const N=g[M];N.required&&N.default===void 0&&d[M]===void 0&&I.push(new s.V(o,d,`missing required property "${M}"`))}return I}function ga({key:m,value:o}){const d=qr({key:m,value:o});if(d.length)return d;const g=o;return g.indexOf("{fontstack}")===-1&&d.push(new s.V(m,o,'"glyphs" url must include a "{fontstack}" token')),g.indexOf("{range}")===-1&&d.push(new s.V(m,o,'"glyphs" url must include a "{range}" token')),d}function Ys(m,o=s.a6,d={}){return ns({key:d.key||"",value:m,valueSpec:Object.assign(o.$root,{"*":{type:"*"}}),styleSpec:o,style:m,objectElementValidators:{glyphs:ga}})}function rn(m,o=s.a6){return le(Ys(m,o))}const rr=m=>le(ms(m)),Ve=m=>le(Tt(m)),or=m=>le(ut(m)),_n=m=>le(on(m)),Yn=m=>le(qn(m)),Tn=m=>le(function(o){const d=o.value,g=o.style,b=o.styleSpec,T=b.snow;if(d===void 0)return[];if(!s.H(d))return[new s.V("snow",d,`object expected, ${s.K(d)} found`)];let E=[];for(const I in d){const M=I.match(/^(.*)-transition$/);E=E.concat(M&&T[M[1]]&&T[M[1]].transition?Zn({key:I,value:d[I],valueSpec:b.transition,style:g,styleSpec:b}):T[I]?Zn({key:I,value:d[I],valueSpec:T[I],style:g,styleSpec:b}):[new s.a3(I,d[I],`unknown property "${I}"`)])}return E}(m)),ti=m=>le(function(o){const d=o.value,g=o.style,b=o.styleSpec,T=b.rain;if(d===void 0)return[];if(!s.H(d))return[new s.V("rain",d,`object expected, ${s.K(d)} found`)];let E=[];for(const I in d){const M=I.match(/^(.*)-transition$/);E=E.concat(M&&T[M[1]]&&T[M[1]].transition?Zn({key:I,value:d[I],valueSpec:b.transition,style:g,styleSpec:b}):T[I]?Zn({key:I,value:d[I],valueSpec:T[I],style:g,styleSpec:b}):[new s.a3(I,d[I],`unknown property "${I}"`)])}return E}(m)),Sr=m=>le(Jn(m)),Mi=m=>le(Mr(m)),da=m=>le(nr(m)),Ze=m=>le(dt(m)),ee=m=>le(s.a7(m));function le(m){return m.slice().sort((o,d)=>o.line&&d.line?o.line-d.line:0)}function ye(m,o){let d=!1;if(o&&o.length)for(const g of o)g instanceof s.a3?s.w(g.message):(m.fire(new s.y(new Error(g.message))),d=!0);return d}const De=s.a6.light;let Oe;class je extends s.E{constructor(o,d="flat"){super(),this._transitionable=new s.a8(Oe||(Oe=new s.a9({anchor:new s.aa(De.anchor),position:new s.ab(De.position),color:new s.aa(De.color),intensity:new s.aa(De.intensity)}))),this.setLight(o,d),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,d,g={}){this._validate(Ve,o,g)||(this._transitionable.setTransitionOrValue(o),this.id=d)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,g){return(!g||g.validate!==!1)&&ye(this,o.call(rn,Object.assign({value:d,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}const st=s.a6.terrain;let We=class extends s.E{constructor(m,o,d,g,b){super(),this.scope=d,this._transitionable=new s.a8(new s.a9({source:new s.aa(st.source),exaggeration:new s.aa(st.exaggeration)}),d,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o,this.worldview=b}get(){return this._transitionable.serialize()}set(m,o){this._transitionable.setTransitionOrValue(m,o)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new s.ac(m,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const o=m.value.expression;if(!o)return null;let d=-1,g=-1,b=1;for(const T of o.zoomStops)b=o.evaluate(new s.ac(T,{worldview:this.worldview})),b>.01?(d=T,g=-1):g=T;return b<.01&&d>0&&g>d?[d,g]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof s.ad}};const nt=45,Rt=65,bt=.05;function ln(m,o,d,g){const b=s.ah(nt,Rt,d),[T,E]=wn(m,g);let I=1-Math.min(1,Math.exp((o-T)/(E-T)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*b*m.alpha}function wn(m,o){const d=.5/Math.tan(.5*o);return[m.range[0]+d,m.range[1]+d]}function un(m,o,d,g,b){const T=s.af([],[o,d,g],b.mercatorFogMatrix);return ln(m,s.ag(T),b.pitch,b._fov)}function fr(m,o,d,g,b,T,E){const I=[[d,g,0],[b,g,0],[b,T,0],[d,T,0]];let M=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(const j of I){const Z=s.af([],j,o),W=s.ag(Z);M=Math.min(M,W),N=Math.max(N,W)}return[ln(m,M,E.pitch,E._fov),ln(m,N,E.pitch,E._fov)]}const Tr=s.a6.fog;class Ar extends s.E{constructor(o,d,g,b){super();const T=new s.a9({range:new s.aa(Tr.range),color:new s.aa(Tr.color),"color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.aa(Tr["high-color"]),"high-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.aa(Tr["space-color"]),"space-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.aa(Tr["horizon-blend"]),"star-intensity":new s.aa(Tr["star-intensity"]),"vertical-range":new s.aa(Tr["vertical-range"])});this._transitionable=new s.a8(T,g,new Map(b)),this.set(o,b),this._transitioning=this._transitionable.untransitioned(),this._transform=d,this.properties=new s.ai(T),this.scope=g}get state(){const o=this._transform,d=o.projection.name==="globe",g=s.aj(o.zoom),b=this.properties.get("range"),T=[.5,3];return{range:d?[s.ak(T[0],b[0],g),s.ak(T[1],b[1],g)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,d,g={}){if(this._validate(Yn,o,g))return;const b=Object.assign({},o);for(const T of Object.keys(Tr))b[T]===void 0&&(b[T]=Tr[T].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,d)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ah(nt,Rt,o))*d.a}getOpacityAtLatLng(o,d){return this._transform.projection.supportsFog?function(g,b,T){const E=s.ae.fromLngLat(b),I=T.elevation?T.elevation.getAtPointOrZero(E):0;return un(g,E.x,E.y,I,T)}(this.state,o,d):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];const d=this._transform.calculateFogTileMatrix(o.toUnwrapped());return fr(this.state,d,0,0,s.al,s.al,this._transform)}getOpacityForBounds(o,d,g,b,T){return this._transform.projection.supportsFog?fr(this.state,o,d,g,b,T,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?wn(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;const d=[4,5,6,7];for(const g of d){const b=o.points[g];let T;if(b[2]>=0)T=b;else{const E=o.points[g-4];T=s.am(E,b,E[2]/(E[2]-b[2]))}if(un(this.state,T[0],T[1],0,this._transform)>=bt)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,g){return(!g||g.validate!==!1)&&ye(this,o.call(rn,Object.assign({value:d,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let ni,Pi,ds,Wi,Es=class extends s.E{constructor(m,o,d,g){super();const b=ni||(ni=new s.a9({density:new s.aa(s.a6.snow.density),intensity:new s.aa(s.a6.snow.intensity),color:new s.aa(s.a6.snow.color),opacity:new s.aa(s.a6.snow.opacity),vignette:new s.aa(s.a6.snow.vignette),"vignette-color":new s.aa(s.a6.snow["vignette-color"]),"center-thinning":new s.aa(s.a6.snow["center-thinning"]),direction:new s.aa(s.a6.snow.direction),"flake-size":new s.aa(s.a6.snow["flake-size"])}));this._transitionable=new s.a8(b,d,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(b),this.scope=d}get state(){const m=this.properties.get("opacity"),o=this.properties.get("color"),d=this.properties.get("direction"),g=s.an(d[0]),b=-Math.max(s.an(d[1]),.01),T=[Math.cos(g)*Math.cos(b),Math.sin(g)*Math.cos(b),Math.sin(b)],E=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=E,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(o.r,o.g,o.b,o.a*m),direction:T,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(m,o,d={}){if(this._validate(Tn,m,d))return;const g=Object.assign({},m),b=s.a6.snow;for(const T of Object.keys(b))g[T]===void 0&&(g[T]=b[T].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,o,d){return(!d||d.validate!==!1)&&ye(this,m.call(rn,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}},ji=class extends s.E{constructor(m,o,d,g){super();const b=Pi||(Pi=new s.a9({density:new s.aa(s.a6.rain.density),intensity:new s.aa(s.a6.rain.intensity),color:new s.aa(s.a6.rain.color),opacity:new s.aa(s.a6.rain.opacity),vignette:new s.aa(s.a6.rain.vignette),"vignette-color":new s.aa(s.a6.rain["vignette-color"]),"center-thinning":new s.aa(s.a6.rain["center-thinning"]),direction:new s.aa(s.a6.rain.direction),"droplet-size":new s.aa(s.a6.rain["droplet-size"]),"distortion-strength":new s.aa(s.a6.rain["distortion-strength"])}));this._transitionable=new s.a8(b,d,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(b),this.scope=d}get state(){const m=this.properties.get("opacity"),o=this.properties.get("color"),d=this.properties.get("direction"),g=s.an(d[0]),b=-Math.max(s.an(d[1]),.01),T=[Math.cos(g)*Math.cos(b),Math.sin(g)*Math.cos(b),Math.sin(b)],E=this.properties.get("vignette-color");return E.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(o.r,o.g,o.b,o.a*m),direction:T,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(m,o,d={}){if(this._validate(ti,m,d))return;const g=Object.assign({},m),b=s.a6.rain;for(const T of Object.keys(b))g[T]===void 0&&(g[T]=b[T].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,o,d){return(!d||d.validate!==!1)&&ye(this,m.call(rn,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}};class li extends s.E{constructor(o,d,g,b){super(),this.scope=g,this._options=o,this.properties=new s.ai(d),this._transitionable=new s.a8(d,g,new Map(b)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,d){this._options=o,this._transitionable.setTransitionOrValue(o.properties,d)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Is{constructor(o,d,g){this.screenBounds=o,this.cameraPoint=g.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(o,d){let g,b;if(o instanceof s.P||typeof o[0]=="number"){const T=s.P.convert(o);g=[T],b=d.isPointAboveHorizon(T)}else{const T=s.P.convert(o[0]),E=s.P.convert(o[1]),I=T.add(E)._div(2);g=[T,E],b=s.aq(T,E).every(M=>d.isPointAboveHorizon(M))&&d.isPointAboveHorizon(I)}return new Is(g,b,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return s.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const d=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],b=s.aq(d,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<g.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),s.ar(b,o)}bufferedCameraGeometryGlobe(o){const d=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],b=s.aq(d,g,o),T=this.cameraPoint.clone();switch(3*((T.y>d.y)+(T.y>g.y))+((T.x>d.x)+(T.x>g.x))){case 0:b[0]=T,b[4]=T.clone();break;case 1:b.splice(1,0,T);break;case 2:b[1]=T;break;case 3:b.splice(4,0,T);break;case 5:b.splice(2,0,T);break;case 6:b[3]=T;break;case 7:b.splice(3,0,T);break;case 8:b[2]=T}return b}containsTile(o,d,g,b=0){const T=Math.max(o.queryPadding,o.evaluateQueryRenderedFeaturePadding())/d._pixelsPerMercatorPixel+1,E=g?this._bufferedCameraMercator(T,d):this._bufferedScreenMercator(T,d);let I=o.tileID.wrap+(E.unwrapped?b:0);const M=E.polygon.map(oe=>s.as(o.tileTransform,oe,I));if(!s.at(M,0,0,s.al,s.al))return;I=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const N=this.screenGeometryMercator.polygon.map(oe=>s.au(o.tileTransform,oe,I)),j=N.map(oe=>new s.P(oe[0],oe[1])),Z=d.getFreeCameraOptions().position||new s.ae(0,0,0),W=s.au(o.tileTransform,Z,I),Y=N.map(oe=>{const ae=s.av(oe,oe,W);return s.aw(ae,ae),new s.ax(W,ae)}),te=s.ay(o,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:j,tilespaceRays:Y,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(J=s.az(M),J.min.x=s.aA(J.min.x,0,s.al),J.min.y=s.aA(J.min.y,0,s.al),J.max.x=s.aA(J.max.x,0,s.al),J.max.y=s.aA(J.max.y,0,s.al),J),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:te};var J}_bufferedScreenMercator(o,d){const g=ha(o);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),d):{polygon:this.bufferedScreenGeometry(o).map(T=>d.pointCoordinate3D(T)),unwrapped:!0},this._screenRaycastCache[g]=b,b}}_bufferedCameraMercator(o,d){const g=ha(o);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),d):{polygon:this.bufferedCameraGeometry(o).map(T=>d.pointCoordinate3D(T)),unwrapped:!0},this._cameraRaycastCache[g]=b,b}}_projectAndResample(o,d){const g=function(T,E){const I=s.aB([],E.pixelMatrix,E.globeMatrix),M=[0,-s.aD,0,1],N=[0,s.aD,0,1],j=[0,0,0,1];s.aC(M,M,I),s.aC(N,N,I),s.aC(j,j,I);const Z=new s.P(M[0]/M[3],M[1]/M[3]),W=new s.P(N[0]/N[3],N[1]/N[3]),Y=s.aE(T,Z)&&M[3]<j[3],te=s.aE(T,W)&&N[3]<j[3];if(!Y&&!te)return null;const J=function(Re,Ae,Te){for(let Fe=1;Fe<Re.length;Fe++){const Xe=ri(Ae.pointCoordinate3D(Re[Fe-1]).x),He=ri(Ae.pointCoordinate3D(Re[Fe]).x);if(Te<0){if(Xe<He)return{idx:Fe,t:-Xe/(He-1-Xe)}}else if(He<Xe)return{idx:Fe,t:(1-Xe)/(He+1-Xe)}}return null}(T,E,Y?-1:1);if(!J)return null;const{idx:oe,t:ae}=J;let pe=oe>1?Zi(T.slice(0,oe),E):[],_e=oe<T.length?Zi(T.slice(oe),E):[];pe=pe.map(Re=>new s.P(ri(Re.x),Re.y)),_e=_e.map(Re=>new s.P(ri(Re.x),Re.y));const me=[...pe];me.length===0&&me.push(_e[_e.length-1]);const Le=s.ak(me[me.length-1].y,(_e.length===0?pe[0]:_e[0]).y,ae);let Ce;return Ce=Y?[new s.P(0,Le),new s.P(0,0),new s.P(1,0),new s.P(1,Le)]:[new s.P(1,Le),new s.P(1,1),new s.P(0,1),new s.P(0,Le)],me.push(...Ce),_e.length===0?me.push(pe[0]):me.push(..._e),{polygon:me.map(Re=>new s.ae(Re.x,Re.y)),unwrapped:!1}}(o,d);if(g)return g;const b=function(T,E){let I=!1,M=-1/0,N=0;for(let Z=0;Z<T.length-1;Z++)T[Z].x>M&&(M=T[Z].x,N=Z);for(let Z=0;Z<T.length-1;Z++){const W=(N+Z)%(T.length-1),Y=T[W],te=T[W+1];Math.abs(Y.x-te.x)>.5&&(Y.x<te.x?(Y.x+=1,W===0&&(T[T.length-1].x+=1)):(te.x+=1,W+1===T.length-1&&(T[0].x+=1)),I=!0)}const j=s.aF(E.center.lng);return I&&j<Math.abs(j-1)&&T.forEach(Z=>{Z.x-=1}),{polygon:T,unwrapped:I}}(Zi(o,d).map(T=>new s.P(ri(T.x),T.y)),d);return{polygon:b.polygon.map(T=>new s.ae(T.x,T.y)),unwrapped:b.unwrapped}}}function Zi(m,o){return s.aG(m,d=>{const g=o.pointCoordinate3D(d);d.x=g.x,d.y=g.y},1/256)}function ri(m){return m<0?1+m%1:m%1}function ha(m){return 100*m|0}function xo(m,o,d,g,b){const T=function(I,M){if(I)return b(I);if(M){if(m.url&&M.tiles&&m.tiles&&delete m.tiles,M.variants){if(!Array.isArray(M.variants))return b(new Error("variants must be an array"));for(const j of M.variants){if(j==null||typeof j!="object"||j.constructor!==Object)return b(new Error("variant must be an object"));if(!Array.isArray(j.capabilities))return b(new Error("capabilities must be an array"));if(j.capabilities.length===1&&j.capabilities[0]==="meshopt"){M=Object.assign(M,j);break}}}const N=s.aH(Object.assign({},M,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);N.tiles=o.canonicalizeTileset(N,m.url),b(null,N)}},E=function(I,M,N){if(!I)return null;if(!M&&!N)return I;N=N||I.worldview_default;const j=Object.values(I.language||{});if(j.length===0)return null;const Z=Object.values(I.worldview||{});if(Z.length===0)return null;const W=j.every(te=>te===M),Y=Z.every(te=>te===N);return W&&Y?I:M in(I.language_options||{})||N in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(m.data,d,g);return E?s.o.frame(()=>T(null,E)):m.url?s.m(o.transformRequest(o.normalizeSourceURL(m.url,null,d,g),s.R.Source),T):s.o.frame(()=>{const{data:I,...M}=m;T(null,M)})}function Ha(m,o){const d=Math.pow(2,o.z),g=Math.floor(s.aF(m.getWest())*d),b=Math.floor(s.aJ(m.getNorth())*d),T=Math.ceil(s.aF(m.getEast())*d),E=Math.ceil(s.aJ(m.getSouth())*d);return o.x>=g&&o.x<T&&o.y>=b&&o.y<E}class Mo{constructor(o,d,g){this.bounds=o?s.aI.convert(this.validateBounds(o)):null,this.minzoom=d||0,this.maxzoom=g||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}addExtraBounds(o){if(o){this.extraBounds||(this.extraBounds=[]);for(const d of o)this.extraBounds.push(s.aI.convert(this.validateBounds(d)))}}contains(o){if(o.z>this.maxzoom||o.z<this.minzoom||this.bounds&&!Ha(this.bounds,o))return!1;if(!this.extraBounds)return!0;for(const d of this.extraBounds)if(Ha(d,o))return!0;return!1}static fromTileJSON(o){if(!o.bounds&&!o.extra_bounds)return null;const d=new Mo(o.bounds,o.minzoom,o.maxzoom);return d.addExtraBounds(o.extra_bounds),d}}class vd extends s.E{constructor(o,d,g,b){if(super(),this.id=o,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,s.aH(d,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},d),this._collectResourceTiming=!!d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new s.aK}load(o){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map.getWorldview();this._tileJSONRequest=xo(this._options,this.map._requestManager,d,g,(b,T)=>{if(this._tileJSONRequest=null,this._loaded=!0,b)d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),g&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new s.y(b));else if(T){if(Object.assign(this,T),this.hasWorldviews=!!T.worldview_options,T.worldview_default&&(this.worldviewDefault=T.worldview_default),T.vector_layers){this.vectorLayers=T.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const E of T.vector_layers)this.vectorLayerIds.push(E.id),T.worldview&&T.worldview[E.source]&&this.localizableLayerIds.add(E.id)}this.tileBounds=Mo.fromTileJSON(T),ze(T.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}o&&o(b)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(o,d){const g=o.tileID.canonical.url(this.tiles,this.scheme),b=this.map._requestManager.normalizeTileURL(g),T=this.map._requestManager.transformRequest(b,s.R.Tile),E=this.map.style?this.map.style.getLut(this.scope):null,I=E?{image:E.image.clone()}:null,M={request:T,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&s.h(g)&&(M.localizableLayerIds=this.localizableLayerIds),M.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=d:o.request=o.actor.send("reloadTile",M,N.bind(this));else if(o.actor=this._tileWorkers[b]=this._tileWorkers[b]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",M,N.bind(this),void 0,!0);else{const j=s.aL.call({deduped:this._deduped},M,(Z,W)=>{if(Z||!W)N.call(this,Z);else{const Y=s.aM(W.responseHeaders);M.data={rawData:W.rawData.slice(0),expires:Y.expires,cacheControl:Y.cacheControl},o.actor&&o.actor.send("loadTile",M,N.bind(this),void 0,!0)}},!0);o.request={cancel:j}}function N(j,Z){return delete o.request,o.aborted?d(null):j&&j instanceof s.aN&&j.status!==404?d(j):(Z&&Z.resourceTiming&&(o.resourceTiming=Z.resourceTiming),this.map._refreshExpiredTiles&&Z&&o.setExpiryData(Z),o.loadVectorData(Z,this.map.painter),s.aO(this.dispatcher),d(null,Z),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,d){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class bo extends s.E{constructor(o,d,g,b){super(),this.id=o,this.dispatcher=g,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},d),Object.assign(this,s.aH(d,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const d=this.map.getWorldview();this._tileJSONRequest=xo(this._options,this.map._requestManager,null,d,(g,b)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new s.y(g)):b&&(Object.assign(this,b),b.raster_layers&&(this.rasterLayers=b.raster_layers,this.rasterLayerIds=this.rasterLayers.map(T=>T.id)),this.tileBounds=Mo.fromTileJSON(b),ze(b.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),o&&o(g)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,d){const g=s.o.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);o.request=s.n(this.map._requestManager.transformRequest(b,s.R.Tile),(T,E,I)=>{if(delete o.request,o.aborted)return o.state="unloaded",d(null);if(T)return o.state="errored",d(T);if(!E)return d(null);const M=s.aM(I);this.map._refreshExpiredTiles&&o.setExpiryData(M),o.setTexture(E,this.map.painter),o.state="loaded",s.aO(this.dispatcher),d(null)})}abortTile(o,d){o.request&&(o.request.cancel(),delete o.request),d&&d()}unloadTile(o,d){o.texture&&o.texture instanceof s.T?(o.destroy(!1),o.texture&&o.texture instanceof s.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),d&&d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ou([m,o],d,g,{scaled:b=!0}={}){const{tileSize:T,buffer:E}=g,{x:I,y:M,z:N}=d;if(!isFinite(I)||!isFinite(M)||!isFinite(N))throw new Error("Invalid MRT header");const j=2**N,Z=j*s.aF(m),W=j*s.aJ(o);return function([Y,te],J,{scaled:oe=!0}={}){if(!J)throw new Error("bandView is undefined");const{data:ae,tileSize:pe,buffer:_e,offset:me,scale:Le,dimension:Ce}=J;if(Y<-_e||Y>pe+_e||te<-_e||te>pe+_e)throw new Error(`Point (${Y}, ${te}) out of bounds for tileSize=${pe}, buffer=${_e}`);const Re=(te+_e)*(pe+2*_e)+(Y+_e);if(new Uint32Array(ae.buffer)[Re]===4294967295)return null;let Ae=[];Ae=oe?[]:new J.data.constructor(Ce);for(let Te=0;Te<Ce;Te++)Ae[Te]=Math.round(1e12*(ae[Ce*Re+Te]*Le+me))/1e12;return Ae}([Math.min(Math.max(-E,Math.floor((Z-I)*T)),T-1+E),Math.min(Math.max(-E,Math.floor((W-M)*T)),T-1+E)],g,{scaled:b})}class ol extends bo{constructor(o,d,g,b){super(o,d,g,b),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},d)}triggerRepaint(o){const d=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);d&&d.enabled&&g&&d._clearRenderCacheForTile(g.id,o.tileID),this.map.triggerRepaint()}loadTile(o,d){const g=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(g,s.R.Tile),T={request:b,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=b,o.actor||(o.actor=this.dispatcher.getActor());const E=(I,M,N)=>{if(delete o.request,o.aborted)return o.state="unloaded",d(null);if(I)return I.name==="AbortError"?void 0:(o.state="errored",d(I));if(this.map._refreshExpiredTiles&&M){const j=s.aM(N);o.setExpiryData(j)}if(this.partial&&o.state!=="expired")o.state="empty";else if(!this.partial){if(!M)return d(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=M}d(null)};o.request=this.partial?o.fetchHeader(void 0,E.bind(this)):o.actor.send("loadTile",T,E.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,d){const g=o.texturePerLayer;if(o.flushAllQueues(),g.size){o.destroy(!1);for(const b of g.values())this.map.painter.saveTileTexture(b)}else o.destroy()}prepareTile(o,d,g,b){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBandForRender(d,g,b,(T,E)=>{if(T)return o.state="errored",this.fire(new s.y(T)),void this.triggerRepaint(o);E&&(o._isHeaderLoaded=!0,o.setTexturePerLayer(g,E,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;const d=this.rasterLayers.find(({id:T})=>T===o),g=d&&d.fields,b=g&&g.bands&&g.bands;return b?b[0]:0}getTextureDescriptor(o,d,g){if(!o)return;const b=d.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!b)return;let T=null;d instanceof s.aR?T=d.paint.get("raster-array-band"):d instanceof s.aS&&(T=d.paint.get("raster-particle-array-band"));const E=T||this.getInitialBand(b);if(E==null)return;if(!o.textureDescriptorPerLayer.get(d.id))return void this.prepareTile(o,b,d.id,E);if(o.updateNeeded(d.id,E)&&!g)return;const I=o.textureDescriptorPerLayer.get(d.id);return Object.assign({},I,{texture:o.texturePerLayer.get(d.id)})}getImages(o,d){const g=new Map;for(const b of o)for(const T of d){const[E,I]=T.split("/"),M=b.getLayer(E);if(!M||!M.hasBand(I)||!M.hasDataForBand(I))continue;const{bytes:N,tileSize:j,buffer:Z}=M.getBandView(I),W=j+2*Z,Y={data:new s.q({width:W,height:W},N),pixelRatio:2,sdf:!1,usvg:!1,version:0};g.set(T,Y)}return g}queryRasterArrayValueByBandId(o,d,g){const b=d._mrt;return new Promise(T=>{const E={},I=new Set;for(const[M,N]of Object.entries(b.layers)){if(g.layerName&&M!==g.layerName)continue;const j={};E[M]=j;for(const{bands:Z}of N.dataIndex)for(const W of Z)g.bands&&!g.bands.includes(W)||(I.add(s.B(M,W)),d.fetchBand(M,null,W,Y=>{s.o.frame(()=>{j[W]=Y?null:ou([o.lng,o.lat],b,N.getBandView(W)),I.delete(s.B(M,W)),I.size===0&&T(E)})},!1))}I.size===0&&T(E)})}_loadTileForQuery(o,d){if(this._loadTileLoaded[o.uid])return void d(null,o._mrt);if(this._loadTilePending[o.uid])return void this._loadTilePending[o.uid].push(d);this._loadTilePending[o.uid]=[d];const g=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(g,s.R.Tile);o.actor.send("loadTile",{request:b,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(T,E,I)=>{if(T)return this._loadTilePending[o.uid].forEach(M=>M(T,null)),void delete this._loadTilePending[o.uid];if(!E)return this._loadTilePending[o.uid].forEach(M=>M(null,null)),void delete this._loadTilePending[o.uid];if(this.map._refreshExpiredTiles&&E){const M=s.aM(I);o.setExpiryData(M)}o._mrt=E,o._isHeaderLoaded=!0,o.state="loaded",this._loadTilePending[o.uid].forEach(M=>M(null,E)),this._loadTileLoaded[o.uid]=!0,delete this._loadTilePending[o.uid]},void 0,!0)}queryRasterArrayValueByAllBands(o,d,g){return new Promise((b,T)=>{this._loadTileForQuery(d,(E,I)=>{E?T(E):b(I?this.queryRasterArrayValueByBandId(o,d,g):null)})})}queryRasterArrayValue(o,d){const g=s.aT.convert(o),b=this.findLoadedParent(g);return b&&b._mrt?d.bands||!this.partial?this.queryRasterArrayValueByBandId(g,b,d):this.queryRasterArrayValueByAllBands(g,b,d):Promise.resolve(null)}findLoadedParent(o){const d=s.ae.fromLngLat(o,this.map.transform.tileSize),g=this.maxzoom+1,b=1<<g,T=Math.floor(d.x),E=Math.floor((d.x-T)*b),I=Math.floor(d.y*b),M=this.map.style.getSourceCache(this.id),N=new s.aQ(g,T,g,E,I);return M.findLoadedParent(N,this.minzoom)}}const Fc={vector:vd,raster:bo,"raster-dem":class extends bo{constructor(m,o,d,g){super(m,o,d,g),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(m,o){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(b,T){b&&(m.state="errored",o(b)),T&&(m.dem=T,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",o(null))}m.request=s.n(this.map._requestManager.transformRequest(d,s.R.Tile),(function(b,T,E){if(delete m.request,m.aborted)m.state="unloaded",o(null);else if(b)m.state="errored",o(b);else if(T){const I=s.aM(E);this.map._refreshExpiredTiles&&m.setExpiryData(I);const M=ImageBitmap&&T instanceof ImageBitmap&&s.r(),N=1-(T.width-s.aP(T.width))/2;N<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const j=M?T:s.o.getImageData(T,N),Z={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:j,encoding:this.encoding,padding:N};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",Z,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const o=m.canonical,d=Math.pow(2,o.z),g=(o.x-1+d)%d,b=o.x===0?m.wrap-1:m.wrap,T=(o.x+1+d)%d,E=o.x+1===d?m.wrap+1:m.wrap,I={};return I[new s.aQ(m.overscaledZ,b,o.z,g,o.y).key]={backfilled:!1},I[new s.aQ(m.overscaledZ,E,o.z,T,o.y).key]={backfilled:!1},o.y>0&&(I[new s.aQ(m.overscaledZ,b,o.z,g,o.y-1).key]={backfilled:!1},I[new s.aQ(m.overscaledZ,m.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},I[new s.aQ(m.overscaledZ,E,o.z,T,o.y-1).key]={backfilled:!1}),o.y+1<d&&(I[new s.aQ(m.overscaledZ,b,o.z,g,o.y+1).key]={backfilled:!1},I[new s.aQ(m.overscaledZ,m.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},I[new s.aQ(m.overscaledZ,E,o.z,T,o.y+1).key]={backfilled:!1}),I}},"raster-array":ol,geojson:class extends s.E{constructor(m,o,d,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(g),this._data=o.data,this._options=Object.assign({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const b=s.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*b,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*b,extent:s.al,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:s.al,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*b,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const o=new Map;for(const d of this._data.features)o.set(d.id,d);for(const d of m.features)o.set(d.id,d);this._data.features=[...o.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},o),this}getClusterChildren(m,o){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},o),this}getClusterLeaves(m,o,d,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:o,offset:d},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const o=Object.assign({append:m},this.workerOptions);o.scope=this.scope;const d=this._data;typeof d=="string"?(o.request=this.map._requestManager.transformRequest(s.o.resolveURL(d),s.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(d),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(g,b)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new s.y(g));else{const T={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(T.resourceTiming=b.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new s.z("data",T)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const m=s.B(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,o){const d=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const g=this.map.style?this.map.style.getLut(this.scope):null,b=g?{image:g.image.clone()}:null,T=this._partialReload,E={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:b,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:m.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:T,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};m.request=this.actor.send(d,E,(I,M)=>T&&!M?(m.state="loaded",o(null)):(delete m.request,m.destroy(!1),m.aborted?o(null):I?o(I):(m.loadVectorData(M,this.map.painter,d==="reloadTile"),o(null))),void 0,d==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,o){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aU{constructor(m,o,d,g){super(m,o,d,g),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const o of m.urls)this.urls.push(this.map._requestManager.transformRequest(o,s.R.Source).url);s.aV(this.urls,(o,d)=>{this._loaded=!0,o?this.fire(new s.y(o)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const o=this.video.seekable;m<o.start(0)||m>o.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,o=m.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(m,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aU,model:s.aX,"batched-model":class extends s.E{constructor(m,o,d,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=d,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(m))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=xo(this._options,this.map._requestManager,o,d,(g,b)=>{this._tileJSONRequest=null,this._loaded=!0,g?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),d&&d.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new s.y(g))):b&&(Object.assign(this,b),b.bounds&&(this.tileBounds=new Mo(b.bounds,this.minzoom,this.maxzoom)),ze(b.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,o){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(d,s.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.o.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=o;else{if(m.buckets){const T=Object.values(m.buckets);for(const E of T)E.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,b.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,b.bind(this),void 0,!0);function b(T,E){return m.aborted?o(null):T&&T.status!==404?o(T):(this.map._refreshExpiredTiles&&E&&m.setExpiryData(E),m.loadModelData(E,this.map.painter),m.state="loaded",void o(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends s.aU{constructor(m,o,d,g){super(m,o,d,g),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(T=>typeof T!="number"))||this.fire(new s.y(new s.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${m}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof s.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends s.E{constructor(m,o,d,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=o,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Mo(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,s.aH(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:o,y:d,z:g}=m.canonical;return this._implementation.hasTile({x:o,y:d,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,o){const{x:d,y:g,z:b}=m.tileID.canonical,T=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:d,y:g,z:b},{signal:T.signal})).then((function(E){return delete m.request,m.aborted?(m.state="unloaded",o(null)):E===void 0?(m.state="errored",o(null)):E===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",o(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(E)?(this.loadTileData(m,E),m.state="loaded",void o(null)):(m.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.name!=="AbortError"&&(m.state="errored",o(E))}),m.request.cancel=()=>T.abort()}loadTileData(m,o){m.setTexture(o,this.map.painter)}unloadTile(m,o){if(m.texture&&m.texture instanceof s.T?(m.destroy(!1),m.texture&&m.texture instanceof s.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:d,y:g,z:b}=m.tileID.canonical;this._implementation.unloadTile({x:d,y:g,z:b})}o&&o()}abortTile(m,o){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=s.B(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},fo=function(m,o,d,g){const b=new Fc[o.type](m,o,d,g);if(b.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${b.id}`);return s.aY(["load","abort","unload","serialize","prepare"],b),b};function yf(m,o,d=""){return`${d}:${o.id||""}:${o.layer.id}:${function(g){if("layerId"in g)return`layer:${g.layerId}`;{const{featuresetId:b,importId:T}=g;return`featureset:${b}${T?`:import:${T}`:""}`}}(m.target)}`}function Ap(m,o,d,g=""){if(m.uniqueFeatureID){const b=yf(m,o,g);if(d.has(b))return!0;d.add(b)}return!1}function L_(m,o,d,g,b=!1){const T=o.sourceCache.transform,E=o.sourceCache.tilesIn(m,o.has3DLayers,b);E.sort(A0);const I=[];for(const M of E){const N=M.tile.queryRenderedFeatures(o,M,d,g,T,b);Object.keys(N).length&&I.push({wrappedTileID:M.tile.tileID.wrapped().key,queryResults:N})}for(const M in o.layers){const N=o.layers[M];if(N.styleLayer){const j=N.styleLayer.queryRenderedFeatures(m,o.sourceCache,g);Object.keys(j).length&&I.push({wrappedTileID:0,queryResults:j})}}return I.length===0?{}:function(M){const N={},j={};for(const Z of M){const W=Z.queryResults,Y=Z.wrappedTileID,te=j[Y]=j[Y]||{};for(const J in W){const oe=W[J],ae=te[J]=te[J]||{},pe=N[J]=N[J]||[];for(const _e of oe)ae[_e.featureIndex]||(ae[_e.featureIndex]=!0,pe.push(_e))}}return N}(I)}function D_(m,o,d,g,b,T){const E={},I=g.queryRenderedSymbols(m),M=[];for(const N of Object.keys(I).map(Number))M.push(b[N]);M.sort(A0);for(const N of M){const j=N.featureIndex.lookupSymbolFeatures(I[N.bucketInstanceId],N.bucketIndex,N.sourceLayerIndex,o,d,T);for(const Z in j){const W=E[Z]=E[Z]||[],Y=j[Z];Y.sort((te,J)=>{const oe=N.featureSortOrder;if(oe){const ae=oe.indexOf(te.featureIndex);return oe.indexOf(J.featureIndex)-ae}return J.featureIndex-te.featureIndex});for(const te of Y)W.push(te)}}return E}function N_(m,o){const d=m.getRenderableIds().map(T=>m.getTileByID(T)),g=[],b={};for(let T=0;T<d.length;T++){const E=d[T],I=E.tileID.canonical.key;b[I]||(b[I]=!0,E.querySourceFeatures(g,o))}return g}function A0(m,o){const d=m.tileID,g=o.tileID;return d.overscaledZ-g.overscaledZ||d.canonical.y-g.canonical.y||d.wrap-g.wrap||d.canonical.x-g.canonical.x}function Bc(m,o){const d={};if(!o)return d;for(const g of m){const b=g.layerIds.map(T=>o.getLayer(T)).filter(Boolean);if(b.length!==0){g.layers=b,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(T=>b.filter(E=>E.id===T)[0]));for(const T of b)d[T.fqid]=g}}return d}const Al=32,oc=33,lc=new Uint16Array(8184);for(let m=0;m<2046;m++){let o=m+2,d=0,g=0,b=0,T=0,E=0,I=0;for(1&o?b=T=E=Al:d=g=I=Al;(o>>=1)>1;){const N=d+b>>1,j=g+T>>1;1&o?(b=d,T=g,d=E,g=I):(d=b,g=T,b=E,T=I),E=N,I=j}const M=4*m;lc[M+0]=d,lc[M+1]=g,lc[M+2]=b,lc[M+3]=T}const Mu=new Uint16Array(2178),jc=new Uint8Array(1089),ph=new Uint16Array(1089);function vf(m){return m===0?-.03125:m===32?.03125:0}const z_={type:2,extent:s.al,loadGeometry:()=>[[new s.P(0,0),new s.P(s.al+1,0),new s.P(s.al+1,s.al+1),new s.P(0,s.al+1),new s.P(0,0)]]};class xf{constructor(o,d,g,b,T,E){this.tileID=o,this.uid=s.b2(),this.uses=0,this.tileSize=d,this.tileZoom=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=T,b&&b.style&&(this._lastUpdatedBrightness=b.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",b&&b.transform&&(this.projection=b.transform.projection),this.worldview=E,this._hasAppearances=null}registerFadeDuration(o){const d=o+this.timeAdded;d<s.o.now()||this.fadeEndTime&&d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,d,g){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=Bc(o.buckets,d.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const T=this.buckets[b];if(T instanceof s.b4){if(this.hasSymbolBuckets=!0,!g)break;T.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const T=this.buckets[b];if(T instanceof s.b4&&T.hasRTLText){this.hasRTLText=!0,s.b5();break}}this.queryPadding=0;for(const b in this.buckets){const T=this.buckets[b],E=d.style.getOwnLayer(b);if(!E)continue;const I=E.queryRadius(T);this.queryPadding=Math.max(this.queryPadding,I)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new s.b3}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,d,g){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,Bc(o.buckets,d.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o,d){for(const T in this.buckets){const E=this.buckets[T];if(E.uploadPending()){let I={},M=[],N={zoom:0,pitch:0,brightness:0,worldview:""};if(d){if(d.style){M=d.style.listImages();const j=E.layers[0],Z=j.sourceLayer||"_geojsonTileLayer",W=d.style.getLayerSourceCache(j);W&&(I=W._state.getState(Z,void 0))}N={zoom:d.transform.zoom||0,pitch:d.transform.pitch||0,brightness:d.style.getBrightness()||0,worldview:d.worldview||""}}E.upload(o,this.tileID.canonical,I,M,N)}}const g=o.gl,b=this.imageAtlas;b&&!b.uploaded&&(this.imageAtlasTexture=new s.T(o,b.image,g.RGBA8,{useMipmap:!!b.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(o,this.glyphAtlasImage,g.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(o,this.lineAtlas.image,g.R8),this.lineAtlas.uploaded=!0)}prepare(o,d,g){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,g),!d||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const b=d.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(d)),(this._lastUpdatedBrightness||b||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&b&&Math.abs(this._lastUpdatedBrightness-b)<.001||(this.updateBuckets(d,this._lastUpdatedBrightness!==b),this._lastUpdatedBrightness=b))}evaluateQueryRenderedFeaturePadding(){let o=0;for(const d in this.buckets){const g=this.buckets[d];g.evaluateQueryRenderedFeaturePadding&&(o=Math.max(o,g.evaluateQueryRenderedFeaturePadding()))}return o}queryRenderedFeatures(o,d,g,b,T,E){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=this.evaluateQueryRenderedFeaturePadding(),M=function(N,j){const Z=s.bq([],[.5*N.width,.5*-N.height,1]);return s.br(Z,Z,[1,-1,0]),s.aB(Z,Z,N.calculateProjMatrix(j.toUnwrapped())),Float32Array.from(Z)}(T,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:d,pixelPosMatrix:M,transform:b,availableImages:g,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:I})}querySourceFeatures(o,d){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const b=g.loadVTLayers(),T=d?d.sourceLayer:"",E=b._geojsonTileLayer||b[T];if(!E)return;const I=s.b6(d&&d.filter),{z:M,x:N,y:j}=this.tileID.canonical,Z={z:M,x:N,y:j};for(let W=0;W<E.length;W++){const Y=E.feature(W);if(I.needGeometry){const oe=s.b7(Y,!0);if(!I.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),oe,this.tileID.canonical))continue}else if(!I.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),Y))continue;const te=g.getId(Y,T),J=new s.b8(Y,M,N,j,te);J.tile=Z,o.push(J)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){const d=this.expirationTime;if(o.cacheControl){const g=s.b9(o.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const g=Date.now();let b=!1;if(this.expirationTime>g)b=!1;else if(d)if(this.expirationTime<d)b=!0;else{const T=this.expirationTime-d;T?this.expirationTime=g+Math.max(T,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}hasAppearances(o){for(const d in this.buckets)if(o.style.hasLayer(d)&&this.buckets[d].layers.some(g=>g.appearances&&g.appearances.length>0))return!0;return!1}updateBuckets(o,d){if(!this.latestFeatureIndex||!o.style)return;const g=o.style.listImages(),b=o.style.getBrightness();for(const T in this.buckets){if(!o.style.hasLayer(T))continue;const E=this.buckets[T],I=E.layers[0],M=I.sourceLayer||"_geojsonTileLayer",N=o.style.getLayerSourceCache(I);let j={};N&&(j=N._state.getState(M,void 0));const Z=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},W=Object.keys(j).length>0&&!d;E.hasAppearances=E.layers.some(J=>J.appearances&&J.appearances.length>0);const Y=W?E.stateDependentLayers:E.layers;if(W&&E.stateDependentLayers.length!==0||d){const J=this.latestFeatureIndex.loadVTLayers();E.update(j,J[M],g,Z,Y,d,b)}if(W&&E.stateDependentLayers.length!==0||d||E.hasAppearances){const J={zoom:o.transform.zoom,pitch:o.transform.pitch,brightness:o.style.getBrightness()||0,worldview:o.worldview};E.updateAppearances(this.tileID.canonical,j,g,J)}(E instanceof s.ba||E instanceof s.bb)&&o._terrain&&o._terrain.enabled&&N&&E.uploadPending()&&o._terrain._clearRenderCacheForTile(N.id,this.tileID);const te=o&&o.style&&o.style.getOwnLayer(T);te&&(this.queryPadding=Math.max(this.queryPadding,te.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=s.o.now()+o}setTexture(o,d){const g=d.context,b=g.gl;this.texture=this.texture||d.getTileTexture(o.width),this.texture&&this.texture instanceof s.T?this.texture.update(o):(this.texture=new s.T(g,o,b.RGBA8,{useMipmap:!0}),this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE))}setDependencies(o,d){const g={};for(const b of d)g[b]=!0;this.dependencies[o]=g}hasDependency(o,d){for(const g of o){const b=this.dependencies[g];if(b){for(const T of d)if(b[T])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,d){if(!d||d.name==="mercator"||this._tileDebugBuffer)return;const g=s.bc(z_,this.tileID.canonical,this.tileTransform)[0],b=new s.bd,T=new s.be;for(let E=0;E<g.length;E++){const{x:I,y:M}=g[E];b.emplaceBack(I,M),T.emplaceBack(E)}T.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(T),this._tileDebugBuffer=o.createVertexBuffer(b,s.bf.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,b.length,T.length)}_makeTileBoundsBuffers(o,d){if(this._tileBoundsBuffer||!d||d.name==="mercator")return;const g=s.bc(z_,this.tileID.canonical,this.tileTransform)[0];let b,T;if(this.isRaster){const E=function(I,M){const N=s.aZ(I,M),j=Math.pow(2,I.z);for(let oe=0;oe<oc;oe++)for(let ae=0;ae<oc;ae++){const pe=s.a_((I.x+(ae+vf(ae))/Al)/j),_e=s.a$((I.y+(oe+vf(oe))/Al)/j),me=M.project(pe,_e),Le=oe*oc+ae;Mu[2*Le+0]=Math.round((me.x*N.scale-N.x)*s.al),Mu[2*Le+1]=Math.round((me.y*N.scale-N.y)*s.al)}jc.fill(0),ph.fill(0);for(let oe=2045;oe>=0;oe--){const ae=4*oe,pe=lc[ae+0],_e=lc[ae+1],me=lc[ae+2],Le=lc[ae+3],Ce=pe+me>>1,Re=_e+Le>>1,Ae=Ce+Re-_e,Te=Re+pe-Ce,Fe=_e*oc+pe,Xe=Le*oc+me,He=Re*oc+Ce,ct=Math.hypot((Mu[2*Fe+0]+Mu[2*Xe+0])/2-Mu[2*He+0],(Mu[2*Fe+1]+Mu[2*Xe+1])/2-Mu[2*He+1])>=16;jc[He]=jc[He]||(ct?1:0),oe<1022&&(jc[He]=jc[He]||jc[(_e+Te>>1)*oc+(pe+Ae>>1)]||jc[(Le+Te>>1)*oc+(me+Ae>>1)])}const Z=new s.b1,W=new s.b0;let Y=0;function te(oe,ae){const pe=ae*oc+oe;return ph[pe]===0&&(Z.emplaceBack(Mu[2*pe+0],Mu[2*pe+1],oe*s.al/Al,ae*s.al/Al),ph[pe]=++Y),ph[pe]-1}function J(oe,ae,pe,_e,me,Le){const Ce=oe+pe>>1,Re=ae+_e>>1;if(Math.abs(oe-me)+Math.abs(ae-Le)>1&&jc[Re*oc+Ce])J(me,Le,oe,ae,Ce,Re),J(pe,_e,me,Le,Ce,Re);else{const Ae=te(oe,ae),Te=te(pe,_e),Fe=te(me,Le);W.emplaceBack(Ae,Te,Fe)}}return J(0,0,Al,Al,Al,0),J(Al,Al,0,0,0,Al),{vertices:Z,indices:W}}(this.tileID.canonical,d);b=E.vertices,T=E.indices}else{b=new s.b1,T=new s.b0;for(const{x:I,y:M}of g)b.emplaceBack(I,M,0,0);const E=s.bh(b.int16.subarray(0,4*b.length),void 0,4);for(let I=0;I<E.length;I+=3)T.emplaceBack(E[I],E[I+1],E[I+2])}this._tileBoundsBuffer=o.createVertexBuffer(b,s.bi.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(T),this._tileBoundsSegments=s.bg.simpleSegment(0,0,b.length,T.length)}_makeGlobeTileDebugBuffers(o,d){const g=d.projection;if(!g||g.name!=="globe"||d.freezeTileCoverage)return;const b=this.tileID.canonical,T=s.bj(b,d),E=s.bk(T),I=s.aj(d.zoom);let M;I>0&&(M=s.bl(new Float64Array(16),d.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,b,d,E,M,I),this._makeGlobeTileDebugTextBuffer(o,b,d,E,M,I)}_globePoint(o,d,g,b,T,E,I){let M=s.bm(o,d,g);if(E){const N=1<<g.z,j=s.aF(b.center.lng),Z=s.aJ(b.center.lat),W=(g.x+.5)/N-j;let Y=0;W>.5?Y=-1:W<-.5&&(Y=1);let te=(o/s.al+g.x)/N+Y,J=(d/s.al+g.y)/N;te=(te-j)*b._pixelsPerMercatorPixel+j,J=(J-Z)*b._pixelsPerMercatorPixel+Z;const oe=[te*b.worldSize,J*b.worldSize,0];s.af(oe,oe,E),M=s.bn(M,oe,I)}return s.af(M,M,T)}_makeGlobeTileDebugBorderBuffer(o,d,g,b,T,E){const I=new s.bd,M=new s.be,N=new s.bo,j=(W,Y,te,J,oe)=>{const ae=(te-W)/(oe-1),pe=(J-Y)/(oe-1),_e=I.length;for(let me=0;me<oe;me++){const Le=W+me*ae,Ce=Y+me*pe;I.emplaceBack(Le,Ce);const Re=this._globePoint(Le,Ce,d,g,b,T,E);N.emplaceBack(Re[0],Re[1],Re[2]),M.emplaceBack(_e+me)}},Z=s.al;j(0,0,Z,0,16),j(Z,0,Z,Z,16),j(Z,Z,0,Z,16),j(0,Z,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(M),this._tileDebugBuffer=o.createVertexBuffer(I,s.bf.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(N,s.bp.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,I.length,M.length)}_makeGlobeTileDebugTextBuffer(o,d,g,b,T,E){const I=s.al/4,M=new s.bd,N=new s.b0,j=new s.bo,Z=25;N.reserve(32),M.reserve(Z),j.reserve(Z);const W=(Y,te)=>Z*Y+te;for(let Y=0;Y<Z;Y++){const te=Y*I;for(let J=0;J<Z;J++){const oe=J*I;M.emplaceBack(oe,te);const ae=this._globePoint(oe,te,d,g,b,T,E);j.emplaceBack(ae[0],ae[1],ae[2])}}for(let Y=0;Y<4;Y++)for(let te=0;te<4;te++){const J=W(Y,te),oe=W(Y,te+1),ae=W(Y+1,te),pe=W(Y+1,te+1);N.emplaceBack(J,oe,ae),N.emplaceBack(ae,oe,pe)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(N),this._tileDebugTextBuffer=o.createVertexBuffer(M,s.bf.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(j,s.bp.members),this._tileDebugTextSegments=s.bg.simpleSegment(0,0,Z,32)}destroy(o=!0){for(const d in this.buckets)this.buckets[d].destroy(o);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),o&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof s.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bs.setPbf(s.bt);class F_ extends xf{constructor(o,d,g,b,T){super(o,d,g,b,T),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexturePerLayer(o,d,g){const b=g.context,T=b.gl;let E=this.texturePerLayer.get(o)||g.getTileTexture(d.width);E&&E instanceof s.T?E.update(d,{premultiply:!1}):E=new s.T(b,d,T.RGBA8,{premultiply:!1}),this.texturePerLayer.has(o)||this.texturePerLayer.set(o,E)}flushQueues(o){const d=this._workQueuePerLayer.get(o)||[],g=this._fetchQueuePerLayer.get(o)||[];for(;d.length;)d.pop()();for(;g.length;)g.pop()()}flushAllQueues(){for(const o of this._workQueuePerLayer.keys()){const d=this._workQueuePerLayer.get(o)||[];for(;d.length;)d.pop()()}for(const o of this._fetchQueuePerLayer.keys()){const d=this._fetchQueuePerLayer.get(o)||[];for(;d.length;)d.pop()()}}fetchHeader(o=16384,d){const g=this._mrt=new s.bs(30),b=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=s.bu(b,(T,E,I)=>{if(T)d(T);else try{const M=g.getHeaderLength(E);if(M>o)return void(this.request=this.fetchHeader(M,d));g.parseHeader(E),this._isHeaderLoaded=!0;let N=0;for(const j of Object.values(g.layers))N=Math.max(N,j.dataIndex[j.dataIndex.length-1].lastByte);E.byteLength>=N&&(this.entireBuffer=E),d(null,this.entireBuffer||E,I)}catch(M){d(M)}}),this.request}fetchBandForRender(o,d,g,b){this.fetchBand(o,d,g,T=>{if(T)return void b(T);this.updateTextureDescriptor(o,d,g);const E=this.textureDescriptorPerLayer.get(d);b(null,E?E.img:null)})}fetchBand(o,d,g,b,T=!0){const E=this._mrt;if(!this._isHeaderLoaded||!E)return void b(new Error("Tile header is not ready"));const I=this.actor;if(!I)return void b(new Error("Can't fetch tile band without an actor"));let M;const N=s.B(String(g),s.B(this.tileID.key,o));let j=this._taskQueue.get(N);j?j.add(b):(j=new Set,j.add(b),this._taskQueue.set(N,j));const Z=(J,oe)=>{M.complete(J,oe),J?b(J):(j.forEach(ae=>ae(null,oe)),this._taskQueue.delete(N))},W=(J,oe)=>{if(J)return b(J);const ae=I.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:oe,task:M},Z,void 0,!0);if(d!==null){const pe=this._workQueuePerLayer.get(d)||[];pe.push(()=>{ae&&ae.cancel(),M.cancel()}),this._workQueuePerLayer.has(d)||this._workQueuePerLayer.set(d,pe)}};let Y;try{Y=E.getLayer(o)}catch(J){if(this.state==="reloading")return;throw J}if(!Y)return void b(new Error(`Unknown sourceLayer "${o}"`));if(Y.hasDataForBand(g))return j.forEach(J=>J(null,null)),void this._taskQueue.delete(N);const te=Y.getDataRange([g]);if(M=E.createDecodingTask(te),!M||M.tasks.length)if(d!==null&&this.flushQueues(d),this.entireBuffer)W(null,this.entireBuffer.slice(te.firstByte,te.lastByte+1));else{const J=Object.assign({},this.requestParams,{headers:{Range:`bytes=${te.firstByte}-${te.lastByte}`}}),oe=s.bu(J,W);if(d!==null){const ae=this._fetchQueuePerLayer.get(d)||[];ae.push(()=>{oe.cancel(),M.cancel()}),this._fetchQueuePerLayer.has(d)||this._fetchQueuePerLayer.set(d,ae)}}}updateNeeded(o,d){return(!this.textureDescriptorPerLayer.get(o)||this.textureDescriptorPerLayer.get(o).band!==d||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(o,d,g){if(!this._mrt)return;const b=this._mrt.getLayer(o);if(!b||!b.hasBand(g)||!b.hasDataForBand(g))return;const{bytes:T,tileSize:E,buffer:I,offset:M,scale:N}=b.getBandView(g),j=E+2*I,Z=new s.q({width:j,height:j},T),W=this.texturePerLayer.get(d);W&&W instanceof s.T&&W.update(Z,{premultiply:!1}),this.textureDescriptorPerLayer.set(d,{layer:o,band:g,img:Z,buffer:I,offset:M,tileSize:E,format:b.pixelFormat,mix:[N,256*N,65536*N,16777216*N]})}destroy(o=!1){if(super.destroy(o),delete this._mrt,!o)for(const d of this.texturePerLayer.values())d&&d instanceof s.T&&d.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class KT{constructor(o,d){this.max=o,this.onRemove=d,this.reset()}reset(){for(const o in this.data)for(const d of this.data[o])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(o,d,g){const b=o.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);const T={value:d,timeout:void 0};if(g!==void 0&&(T.timeout=setTimeout(()=>{this.remove(o,T)},g)),this.data[b].push(T),this.order.push(b),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const d=this.data[o].shift();return d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),d.value}getByKey(o){const d=this.data[o];return d?d[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,d){if(!this.has(o))return this;const g=o.wrapped().key,b=d===void 0?0:this.data[g].indexOf(d),T=this.data[g][b];return this.data[g].splice(b,1),T.timeout&&clearTimeout(T.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(T.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(o){const d=[];for(const g in this.data)for(const b of this.data[g])o(b.value)||d.push(b);for(const g of d)this.remove(g.value.tileID,g)}}class C0{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,d,g){const b=String(d);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][b]=this.stateChanges[o][b]||{},Object.assign(this.stateChanges[o][b],g),this.deletedStates[o]===null){this.deletedStates[o]={};for(const T in this.state[o])T!==b&&(this.deletedStates[o][T]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][b]===null){this.deletedStates[o][b]={};for(const T in this.state[o][b])g[T]||(this.deletedStates[o][b][T]=null)}else for(const T in g)this.deletedStates[o]&&this.deletedStates[o][b]&&this.deletedStates[o][b][T]===null&&delete this.deletedStates[o][b][T]}removeFeatureState(o,d,g){if(this.deletedStates[o]===null)return;const b=String(d);if(this.deletedStates[o]=this.deletedStates[o]||{},g&&d!==void 0)this.deletedStates[o][b]!==null&&(this.deletedStates[o][b]=this.deletedStates[o][b]||{},this.deletedStates[o][b][g]=null);else if(d!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][b])for(g in this.deletedStates[o][b]={},this.stateChanges[o][b])this.deletedStates[o][b][g]=null;else this.deletedStates[o][b]=null;else this.deletedStates[o]=null}getState(o,d){const g=this.state[o]||{},b=this.stateChanges[o]||{},T=this.deletedStates[o];if(T===null)return{};if(d!==void 0){const I=String(d),M=Object.assign({},g[I],b[I]);if(T){const N=T[d];if(N===null)return{};for(const j in N)delete M[j]}return M}const E=Object.assign({},g,b);if(T)for(const I in T)delete E[I];return E}initializeTileState(o,d){o.refreshFeatureState(d)}coalesceChanges(o,d){const g={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const T={};for(const E in this.stateChanges[b])this.state[b][E]||(this.state[b][E]={}),Object.assign(this.state[b][E],this.stateChanges[b][E]),T[E]=this.state[b][E];g[b]=T}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const T={};if(this.deletedStates[b]===null)for(const E in this.state[b])T[E]={},this.state[b][E]={};else for(const E in this.deletedStates[b]){if(this.deletedStates[b][E]===null)this.state[b][E]={};else if(this.state[b][E])for(const I of Object.keys(this.deletedStates[b][E]))delete this.state[b][E][I];T[E]=this.state[b][E]}g[b]=g[b]||{},Object.assign(g[b],T)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const b in o)o[b].refreshFeatureState(d)}}class $l extends s.E{constructor(o,d,g){super(),this.id=o,this._onlySymbols=g,d.on("data",b=>{b.dataType==="source"&&b.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&b.dataType==="source"&&b.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),d.on("error",()=>{this._sourceErrored=!0}),this._source=d,this._tiles={},this._cache=new KT(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new C0,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,d){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,d)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const g=this._tiles[d];g.upload(o,this.map?this.map.painter:void 0),g.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(B_).map(o=>o.key)}getRenderableIds(o,d){const g=[];for(const b in this._tiles)this._isIdRenderable(+b,o,d)&&g.push(this._tiles[b]);return o?g.sort((b,T)=>{const E=b.tileID,I=T.tileID,M=new s.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),N=new s.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-I.overscaledZ||N.y-M.y||N.x-M.x}).map(b=>b.tileID.key):g.map(b=>b.tileID).sort(B_).map(b=>b.key)}hasRenderableParent(o){const d=this.findLoadedParent(o,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(o,d,g){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(d||!this._tiles[o].holdingForFade())&&(g||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,d){const g=this._tiles[o];g&&(g.state!=="loading"&&(g.state=d),this._loadTile(g,this._tileLoaded.bind(this,g,o,d)))}_tileLoaded(o,d,g,b,T){if(b){if(o.state="errored",b.status!==404)this._source.fire(new s.y(b,{tile:o}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const I=this.map.painter.terrain;this.update(this.transform,I.getScaledDemTileSize(),!0),I.resetTileLookupCache(this.id)}else this.update(this.transform)}return}o.timeAdded=s.o.now(),g==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(d,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null);let E=new Map;T&&T.responseHeaders&&(E=T.responseHeaders),this._source.fire(new s.z("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id,responseHeaders:E}))}_backfillDEM(o){const d=this.getRenderableIds();for(let b=0;b<d.length;b++){const T=d[b];if(o.neighboringTiles&&o.neighboringTiles[T]){const E=this.getTileByID(T);g(o,E),g(E,o)}}function g(b,T){if(!b.dem||b.dem.borderReady)return;b.needsHillshadePrepare=!0,b.needsDEMTextureUpload=!0;let E=T.tileID.canonical.x-b.tileID.canonical.x;const I=T.tileID.canonical.y-b.tileID.canonical.y,M=Math.pow(2,b.tileID.canonical.z),N=T.tileID.key;E===0&&I===0||Math.abs(I)>1||(Math.abs(E)>1&&(Math.abs(E+M)===1?E+=M:Math.abs(E-M)===1&&(E-=M)),T.dem&&b.dem&&(b.dem.backfillBorder(T.dem,E,I),b.neighboringTiles&&b.neighboringTiles[N]&&(b.neighboringTiles[N].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,d,g,b){for(const T in this._tiles){let E=this._tiles[T];if(b[T]||!E.hasData()||E.tileID.overscaledZ<=d||E.tileID.overscaledZ>g)continue;let I=E.tileID;for(;E&&E.tileID.overscaledZ>d+1;){const N=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[N.key],E&&E.hasData()&&(I=N)}let M=I;for(;M.overscaledZ>d;)if(M=M.scaledTo(M.overscaledZ-1),o[M.key]){b[I.key]=I;break}}}findLoadedParent(o,d){if(o.key in this._loadedParentTiles){const g=this._loadedParentTiles[o.key];return g&&g.tileID.overscaledZ>=d?g:null}for(let g=o.overscaledZ-1;g>=d;g--){const b=o.scaledTo(g),T=this._getLoadedTile(b);if(T)return T}}_getLoadedTile(o){const d=this._tiles[o.key];return d&&d.hasData()?d:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,d){d=d||this._source.tileSize;const g=Math.ceil(o.width/d)+1,b=Math.ceil(o.height/d)+1,T=Math.floor(g*b*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,T):T,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(I)}handleWrapJump(o){const d=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,d){const g={};for(const b in this._tiles){const T=this._tiles[b];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+d),g[T.tileID.key]=T}this._tiles=g;for(const b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(const b in this._tiles)this._setTileReloadTimer(+b,this._tiles[b])}}update(o,d,g,b,T){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!g)return;this.updateCacheSize(o,d),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const E=this._source.type==="batched-model";let I,M=this._source.maxzoom;const N=this.map&&this.map.painter?this.map.painter._terrain:null;if(N&&N.sourceCache===this&&N.attenuationRange()){const W=N.attenuationRange()[0],Y=Math.floor(W)-Math.log2(N.getDemUpscale());M>Y&&(M=Y)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(W=>new s.aQ(W.canonical.z,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y));else if(this.tileCoverLift!==0){const W=o.clone();W.tileCoverLift=this.tileCoverLift,I=W.coveringTiles({tileSize:d||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.minzoom<=1&&o.projection.name==="globe"&&(I.push(new s.aQ(1,0,1,0,0)),I.push(new s.aQ(1,0,1,1,0)),I.push(new s.aQ(1,0,1,0,1)),I.push(new s.aQ(1,0,1,1,1)))}else if(I=o.coveringTiles({tileSize:d||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.hasTile){const W=this._source.hasTile.bind(this._source);I=I.filter(Y=>W(Y))}}else I=[];if(I.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!bf(this._source.type)){const W=o.coveringZoomLevel({tileSize:d||this._source.tileSize,roundZoom:this._source.roundZoom&&!g}),Y=Math.min(W,this._source.maxzoom);if(E){const te=o.extendTileCover(I,Y);for(const J of te)I.push(J)}else if(T){const te=o.extendTileCoverToNearPlane(I,this.transform.getFrustum(Y),Y);for(const J of te)I.push(J)}else if(this.castsShadows&&b){const te=o.extendTileCover(I,Y,b,16);for(const J of te)this._shadowCasterTiles[J.key]=!0,I.push(J)}}const j=this._updateRetainedTiles(I);if(bf(this._source.type)&&I.length!==0){const W={},Y={},te=Object.keys(j);for(const oe of te){const ae=j[oe],pe=this._tiles[oe];if(!pe||pe.fadeEndTime&&pe.fadeEndTime<=s.o.now())continue;const _e=this.findLoadedParent(ae,Math.max(ae.overscaledZ-$l.maxOverzooming,this._source.minzoom));_e&&(this._addTile(_e.tileID),W[_e.tileID.key]=_e.tileID),Y[oe]=ae}const J=I[I.length-1].overscaledZ;for(const oe in this._tiles){const ae=this._tiles[oe];if(j[oe]||!ae.hasData())continue;let pe=ae.tileID;for(;pe.overscaledZ>J;){pe=pe.scaledTo(pe.overscaledZ-1);const _e=this._tiles[pe.key];if(_e&&_e.hasData()&&Y[pe.key]){j[oe]=ae.tileID;break}}}for(const oe in W)j[oe]||(this._coveredTiles[oe]=!0,j[oe]=W[oe])}for(const W in j)this._tiles[W].clearFadeHold();const Z=s.bv(this._tiles,j);for(const W of Z){const Y=this._tiles[W];Y.hasSymbolBuckets&&!Y.holdingForFade()?Y.setHoldDuration(this.map._fadeDuration):Y.hasSymbolBuckets&&!Y.symbolFadeFinished()||this._removeTile(+W)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const d={};if(o.length===0)return d;const g={},b=o.reduce((N,j)=>Math.min(N,j.overscaledZ),1/0),T=o[0].overscaledZ,E=Math.max(T-$l.maxOverzooming,this._source.minzoom),I=Math.max(T+$l.maxUnderzooming,this._source.minzoom),M={};for(const N of o){const j=this._addTile(N);d[N.key]=N,j.hasData()||b<this._source.maxzoom&&(M[N.key]=N)}this._retainLoadedChildren(M,b,I,d);for(const N of o){let j=this._tiles[N.key];if(j.hasData())continue;if(N.canonical.z>=this._source.maxzoom){const W=N.children(this._source.maxzoom)[0],Y=this.getTile(W);if(Y&&Y.hasData()){d[W.key]=W;continue}}else{const W=N.children(this._source.maxzoom);if(d[W[0].key]&&d[W[1].key]&&d[W[2].key]&&d[W[3].key])continue}let Z=j.wasRequested();for(let W=N.overscaledZ-1;W>=E;--W){const Y=N.scaledTo(W);if(g[Y.key]||(g[Y.key]=!0,j=this.getTile(Y),!j&&Z&&(j=this._addTile(Y)),j&&(d[Y.key]=Y,Z=j.wasRequested(),j.hasData())))break}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const d=[];let g,b=this._tiles[o].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){g=this._loadedParentTiles[b.key];break}d.push(b.key);const T=b.scaledTo(b.overscaledZ-1);if(g=this._getLoadedTile(T),g)break;b=T}for(const T of d)this._loadedParentTiles[T]=g}}_addTile(o){let d=this._tiles[o.key];if(d)return d.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),d;d=this._cache.getAndRemove(o),d&&(this._setTileReloadTimer(o.key,d),d.tileID=o,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,d)));const g=!!d;if(!g){const b=this.map?this.map.painter:null,T=this._source.tileSize*o.overscaleFactor();d=this._source.type==="raster-array"?new F_(o,T,this.transform.tileZoom,b,this._isRaster):new xf(o,T,this.transform.tileZoom,b,this._isRaster,this._source.worldview),this._loadTile(d,this._tileLoaded.bind(this,d,o.key,d.state))}return d.uses++,this._tiles[o.key]=d,g||this._source.fire(new s.z("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(o,d){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const g=d.getExpiryTimeout();g&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},g))}_removeTile(o){const d=this._tiles[o];d&&(d.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),d.uses>0||(d.hasData()&&d.state!=="reloading"||d.state==="empty"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,d,g){const b=[],T=this.transform;if(!T)return b;const E=T.projection.name==="globe",I=s.aF(T.center.lng);for(const M in this._tiles){const N=this._tiles[M];if(g&&N.clearQueryDebugViz(),N.holdingForFade())continue;let j;if(E){const Z=N.tileID.canonical;if(Z.z===0){const W=[Math.abs(s.aA(I,...xd(Z,-1))-I),Math.abs(s.aA(I,...xd(Z,1))-I)];j=[0,2*W.indexOf(Math.min(...W))-1]}else{const W=[Math.abs(s.aA(I,...xd(Z,-1))-I),Math.abs(s.aA(I,...xd(Z,0))-I),Math.abs(s.aA(I,...xd(Z,1))-I)];j=[W.indexOf(Math.min(...W))-1]}}else j=[0];for(const Z of j){const W=o.containsTile(N,T,d,Z);W&&b.push(W)}}return b}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,d){const g=this.getRenderableIds(o,d).map(T=>this._tiles[T].tileID),b=this.transform.projection.name==="globe";for(const T of g)T.projMatrix=this.transform.calculateProjMatrix(T.toUnwrapped()),T.expandedProjMatrix=b?this.transform.calculateProjMatrix(T.toUnwrapped(),!1,!0):T.projMatrix;return g}sortCoordinatesByDistance(o){const d=o.slice(),g=this.transform._camera.position,b=this.transform._camera.forward(),T={};for(const E of d){const I=1/(1<<E.canonical.z);T[E.key]=((E.canonical.x+.5)*I+E.wrap-g[0])*b[0]+((E.canonical.y+.5)*I-g[1])*b[1]-g[2]*b[2]}return d.sort((E,I)=>T[E.key]-T[I.key]),d}hasTransition(){if(this._source.hasTransition())return!0;if(bf(this._source.type))for(const o in this._tiles){const d=this._tiles[o];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=s.o.now())return!0}return!1}setFeatureState(o,d,g){this._state.updateState(o=o||"_geojsonTileLayer",d,g)}removeFeatureState(o,d,g){this._state.removeFeatureState(o=o||"_geojsonTileLayer",d,g)}getFeatureState(o,d){return this._state.getState(o=o||"_geojsonTileLayer",d)}setDependencies(o,d,g){const b=this._tiles[o];b&&b.setDependencies(d,g)}reloadTilesForDependencies(o,d){for(const g in this._tiles)this._tiles[g].hasDependency(o,d)&&this._reloadTile(+g,"reloading");this._cache.filter(g=>!g.hasDependency(o,d))}_preloadTiles(o,d){if(!this._sourceLoaded){const M=()=>{this._sourceLoaded&&(this._source.off("data",M),this._preloadTiles(o,d))};return void this._source.on("data",M)}const g=new Map,b=Array.isArray(o)?o:[o],T=this.map.painter.terrain,E=this.usedForTerrain&&T?T.getScaledDemTileSize():this._source.tileSize;for(const M of b){const N=M.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const j of N)g.set(j.key,j);this.usedForTerrain&&M.updateElevation(!1)}const I=Array.from(g.values());s.bw(I,(M,N)=>{const j=new xf(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(j,Z=>{this._source.type==="raster-dem"&&j.dem&&this._backfillDEM(j),N(Z,j)})},d)}}function B_(m,o){const d=Math.abs(2*m.wrap)-+(m.wrap<0),g=Math.abs(2*o.wrap)-+(o.wrap<0);return m.overscaledZ-o.overscaledZ||g-d||o.canonical.y-m.canonical.y||o.canonical.x-m.canonical.x}function bf(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function xd(m,o){const d=1<<m.z;return[m.x/d+o,(m.x+1)/d+o]}$l.maxOverzooming=10,$l.maxUnderzooming=3;class Pk{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const o=!1,d=!1;for(const g in this.style._mergedLayers){const b=this.style._mergedLayers[g];if(b.type==="fill-extrusion"||b.type==="building")this.layers.push({layer:b,visible:o,visibilityChanged:d});else if(b.type==="model"){const T=this.style.getLayerSource(b);T&&T.type==="batched-model"&&this.layers.push({layer:b,visible:o,visibilityChanged:d})}}}onNewFrame(o){this.layersGotHidden=!1;for(const d of this.layers){const g=d.layer;let b=!1;g.type==="fill-extrusion"?b=!g.isHidden(o)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="building"?b=!g.isHidden(o)&&g.paint.get("building-opacity")>0:g.type==="model"&&(b=!g.isHidden(o)&&g.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!b&&d.visible,d.visible=b}}updateZOffset(o,d){this.currentBuildingBuckets=[];for(const b of this.layers){const T=b.layer,E=this.style.getLayerSourceCache(T);let I=1;T.type==="fill-extrusion"?I=b.visible?T.paint.get("fill-extrusion-vertical-scale"):0:T.type==="building"&&(I=b.visible?T.paint.get("building-vertical-scale"):0);let M=E?E.getTile(d):null;if(!M&&E)for(const N in E._tiles){const j=E._tiles[N];if(d.canonical.isChildOf(j.tileID.canonical)){M=j;break}}this.currentBuildingBuckets.push({bucket:M?M.getBucket(T):null,tileID:M?M.tileID:d,verticalScale:I})}o.hasAnyZOffset=!1;let g=!1;for(let b=0;b<o.symbolInstances.length;b++){const T=o.symbolInstances.get(b),E=T.zOffset,I=this._getHeightAtTileOffset(d,T.tileAnchorX,T.tileAnchorY);T.zOffset=I!==Number.NEGATIVE_INFINITY?I:E,g||E===T.zOffset||(g=!0),o.hasAnyZOffset||T.zOffset===0||(o.hasAnyZOffset=!0)}g&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,d,g,b){let T=d,E=g;if(o.canonical.z!==b.canonical.z){const I=b.canonical,M=1/(1<<o.canonical.z-I.z);T=(d+o.canonical.x*s.al)*M-I.x*s.al|0,E=(g+o.canonical.y*s.al)*M-I.y*s.al|0}return{tileX:T,tileY:E}}_getHeightAtTileOffset(o,d,g){let b,T;for(let E=0;E<this.layers.length;++E){const I=this.layers[E].layer;if(I.type!=="fill-extrusion"&&I.type!=="building")continue;const{bucket:M,tileID:N,verticalScale:j}=this.currentBuildingBuckets[E];if(!M)continue;const{tileX:Z,tileY:W}=this._mapCoordToOverlappingTile(o,d,g,N),Y=M.getHeightAtTileCoord(Z,W);Y&&Y.height!==void 0&&(Y.hidden?b=Y.height:T=Math.max(Y.height*j,T||0))}if(T!==void 0)return T;for(let E=0;E<this.layers.length;++E){const I=this.layers[E];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:M,tileID:N}=this.currentBuildingBuckets[E];if(!M)continue;const{tileX:j,tileY:Z}=this._mapCoordToOverlappingTile(o,d,g,N),W=M.getHeightAtTileCoord(j,Z);if(W&&!W.hidden)return W.height===void 0&&b!==void 0?Math.min(W.maxHeight,b)*W.verticalScale:W.height?W.height*W.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function QT(m,o){const d={};for(const g in m)g!=="ref"&&(d[g]=m[g]);return s.bx.forEach(g=>{g in o&&(d[g]=o[g])}),d}function k0(m){m=m.slice();const o=Object.create(null);for(let d=0;d<m.length;d++)o[m[d].id]=m[d];for(let d=0;d<m.length;d++)"ref"in m[d]&&(m[d]=QT(m[d],o[m[d].ref]));return m}const Ii={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function j_(m,o,d){d.push({command:Ii.addSource,args:[m,o[m]]})}function bx(m,o,d){o.push({command:Ii.removeSource,args:[m]}),d[m]=!0}function JT(m,o,d,g){bx(m,d,g),j_(m,o,d)}function eE(m,o,d){let g;for(g in m[d])if(m[d].hasOwnProperty(g)&&g!=="data"&&!s.by(m[d][g],o[d][g]))return!1;for(g in o[d])if(o[d].hasOwnProperty(g)&&g!=="data"&&!s.by(m[d][g],o[d][g]))return!1;return!0}function mh(m,o,d,g,b,T){let E;for(E in o=o||{},m=m||{})m.hasOwnProperty(E)&&(s.by(m[E],o[E])||d.push({command:T,args:[g,E,o[E],b]}));for(E in o)o.hasOwnProperty(E)&&!m.hasOwnProperty(E)&&(s.by(m[E],o[E])||d.push({command:T,args:[g,E,o[E],b]}))}function I0(m){return m.id}function R0(m,o){return m[o.id]=o,m}function wx(m,o,d){const g=o.createTileMatrix(m,m.worldSize,d.toUnwrapped());return s.aB(new Float32Array(16),m.projMatrix,g)}function U_(m,o,d){if(o.projection.name===d.projection.name)return m.projMatrix;const g=d.clone();return g.setProjection(o.projection),wx(g,o.getProjection(),m)}function Uc(m,o,d){return o.name===d.projection.name?m.projMatrix:wx(d,o,m)}class M0{constructor(o,d){this.reset(o,d)}reset(o,d){this.points=o||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=s.aA(o,0,1);let d=1,g=this._distances[d];const b=o*this.paddedLength+this.padding;for(;g<b&&d<this._distances.length;)g=this._distances[++d];const T=d-1,E=this._distances[T],I=g-E,M=I>0?(b-E)/I:0;return this.points[T].mult(1-M).add(this.points[d].mult(M))}}class Tx{constructor(o,d,g){const b=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(o/g),this.yCellCount=Math.ceil(d/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)b.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=d,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,d,g,b,T){this._forEachCell(d,g,b,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(b),this.bboxes.push(T)}insertCircle(o,d,g,b){this._forEachCell(d-b,g-b,d+b,g+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(d),this.circles.push(g),this.circles.push(b)}_insertBoxCell(o,d,g,b,T,E){this.boxCells[T].push(E)}_insertCircleCell(o,d,g,b,T,E){this.circleCells[T].push(E)}_query(o,d,g,b,T,E){if(g<0||o>this.width||b<0||d>this.height)return!T&&[];const I=[];if(o<=0&&d<=0&&this.width<=g&&this.height<=b){if(T)return!0;for(let M=0;M<this.boxKeys.length;M++)I.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const N=this.circles[3*M],j=this.circles[3*M+1],Z=this.circles[3*M+2];I.push({key:this.circleKeys[M],x1:N-Z,y1:j-Z,x2:N+Z,y2:j+Z})}return E?I.filter(E):I}return this._forEachCell(o,d,g,b,this._queryCell,I,{hitTest:T,seenUids:{box:{},circle:{}}},E),T?I.length>0:I}_queryCircle(o,d,g,b,T){const E=o-g,I=o+g,M=d-g,N=d+g;if(I<0||E>this.width||N<0||M>this.height)return!b&&[];const j=[];return this._forEachCell(E,M,I,N,this._queryCellCircle,j,{hitTest:b,circle:{x:o,y:d,radius:g},seenUids:{box:{},circle:{}}},T),b?j.length>0:j}query(o,d,g,b,T){return this._query(o,d,g,b,!1,T)}hitTest(o,d,g,b,T){return this._query(o,d,g,b,!0,T)}hitTestCircle(o,d,g,b){return this._queryCircle(o,d,g,!0,b)}_queryCell(o,d,g,b,T,E,I,M){const N=I.seenUids,j=this.boxCells[T];if(j!==null){const W=this.bboxes;for(const Y of j)if(!N.box[Y]){N.box[Y]=!0;const te=4*Y;if(o<=W[te+2]&&d<=W[te+3]&&g>=W[te+0]&&b>=W[te+1]&&(!M||M(this.boxKeys[Y]))){if(I.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[Y],x1:W[te],y1:W[te+1],x2:W[te+2],y2:W[te+3]})}}}const Z=this.circleCells[T];if(Z!==null){const W=this.circles;for(const Y of Z)if(!N.circle[Y]){N.circle[Y]=!0;const te=3*Y;if(this._circleAndRectCollide(W[te],W[te+1],W[te+2],o,d,g,b)&&(!M||M(this.circleKeys[Y]))){if(I.hitTest)return E.push(!0),!0;{const J=W[te],oe=W[te+1],ae=W[te+2];E.push({key:this.circleKeys[Y],x1:J-ae,y1:oe-ae,x2:J+ae,y2:oe+ae})}}}}}_queryCellCircle(o,d,g,b,T,E,I,M){const N=I.circle,j=I.seenUids,Z=this.boxCells[T];if(Z!==null){const Y=this.bboxes;for(const te of Z)if(!j.box[te]){j.box[te]=!0;const J=4*te;if(this._circleAndRectCollide(N.x,N.y,N.radius,Y[J+0],Y[J+1],Y[J+2],Y[J+3])&&(!M||M(this.boxKeys[te])))return E.push(!0),!0}}const W=this.circleCells[T];if(W!==null){const Y=this.circles;for(const te of W)if(!j.circle[te]){j.circle[te]=!0;const J=3*te;if(this._circlesCollide(Y[J],Y[J+1],Y[J+2],N.x,N.y,N.radius)&&(!M||M(this.circleKeys[te])))return E.push(!0),!0}}}_forEachCell(o,d,g,b,T,E,I,M){const N=this._convertToXCellCoord(o),j=this._convertToYCellCoord(d),Z=this._convertToXCellCoord(g),W=this._convertToYCellCoord(b);for(let Y=N;Y<=Z;Y++)for(let te=j;te<=W;te++)if(T.call(this,o,d,g,b,this.xCellCount*te+Y,E,I,M))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,d,g,b,T,E){const I=b-o,M=T-d,N=g+E;return N*N>I*I+M*M}_circleAndRectCollide(o,d,g,b,T,E,I){const M=(E-b)/2,N=Math.abs(o-(b+M));if(N>M+g)return!1;const j=(I-T)/2,Z=Math.abs(d-(T+j));if(Z>j+g)return!1;if(N<=M||Z<=j)return!0;const W=N-M,Y=Z-j;return W*W+Y*Y<=g*g}}const gh={unknown:0,flipRequired:1,flipNotRequired:2},wf=Math.tan(85*Math.PI/180);function ll(m,o,d,g,b,T,E){const I=s.bC();if(d)if(T.name==="globe"){const M=s.bD(b,o);s.aB(I,I,M)}else{const M=s.bE([],E);I[0]=M[0],I[1]=M[1],I[4]=M[2],I[5]=M[3],g||s.bB(I,I,b.angle)}else s.aB(I,b.labelPlaneMatrix,m);return I}function V_(m,o,d,g,b,T,E){const I=ll(m,o,d,g,b,T,E);return T.name==="globe"&&d||(I[2]=I[6]=I[10]=I[14]=0),I}function P0(m,o,d,g,b,T,E){if(d){if(T.name==="globe"){const I=ll(m,o,d,g,b,T,E);return s.bl(I,I),s.aB(I,m,I),I}{const I=s.bz(m),M=s.bA([]);return M[0]=E[0],M[1]=E[1],M[4]=E[2],M[5]=E[3],s.aB(I,I,M),g||s.bB(I,I,-b.angle),I}}return b.glCoordMatrix}function Pu(m,o,d,g){const b=[m,o,d,1];d?s.aC(b,b,g):jn(b,b,g);const T=b[3];return b[0]/=T,b[1]/=T,b[2]/=T,b}function Yi(m,o){return Math.min(.5+m/o*.5,1.5)}function tE(m,o){const d=m[0]/m[3],g=m[1]/m[3];return d>=-o[0]&&d<=o[0]&&g>=-o[1]&&g<=o[1]}function nE(m,o,d,g,b,T,E,I,M,N,j=1){const Z=d.transform,W=g?m.textSizeData:m.iconSizeData,Y=s.bK(W,d.transform.zoom,j),te=Z.projection.name==="globe",J=[256/d.width*2+1,256/d.height*2+1],oe=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;oe.clear();let ae=null;te&&(ae=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const pe=m.lineVertexArray,_e=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,me=d.transform.width/d.transform.height;let Le,Ce=!1;for(let Re=0;Re<_e.length;Re++){const Ae=_e.get(Re),{numGlyphs:Te,writingMode:Fe}=Ae;if(Fe!==s.bL.vertical||Ce||Le===s.bL.horizontal||(Ce=!0),Le=Fe,(Ae.hidden||Fe===s.bL.vertical)&&!Ce){uc(Te,oe);continue}Ce=!1;const Xe=new s.P(Ae.tileAnchorX,Ae.tileAnchorY),He=m.elevationType==="road",ct=!!Z.elevation||He;let{x:ht,y:St,z:Ut}=Z.projection.projectTilePoint(Xe.x,Xe.y,N.canonical),rt=null;if(ct){const vn=He?m.getElevationFeatureForText(Re):null;rt={getElevation:M,elevation:Z.elevation,elevationFeature:vn};const[er,Lr,hi]=M(Xe,Z.elevation,vn);ht+=er,St+=Lr,Ut+=hi}const Ue=[ht,St,Ut,1];if(s.aC(Ue,Ue,o),!tE(Ue,J)){uc(Te,oe);continue}const _t=Ue[3],lt=Yi(d.transform.getCameraToCenterDistance(Z.projection),_t),Ot=s.bM(W,Y,Ae),en=E?Ot/lt:Ot*lt,yn=Pu(ht,St,Ut,b);if(yn[3]<=0){uc(Te,oe);continue}let Yt={};const Ht=s.an(m.layers[0].layout.get("text-max-angle")),Ln=Math.cos(Ht),In=E?null:rt,pn=Ex(Ae,en,!1,I,o,b,T,m.glyphOffsetArray,pe,oe,ae,yn,Xe,Yt,me,In,Z.projection,N,E,Ln);Ce=pn.useVertical,In&&pn.needsFlipping&&(Yt={}),(pn.notEnoughRoom||Ce||pn.needsFlipping&&Ex(Ae,en,!0,I,o,b,T,m.glyphOffsetArray,pe,oe,ae,yn,Xe,Yt,me,In,Z.projection,N,E,Ln).notEnoughRoom)&&uc(Te,oe)}g?(m.text.dynamicLayoutVertexBuffer.updateData(oe),ae&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(ae)):(m.icon.dynamicLayoutVertexBuffer.updateData(oe),ae&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(ae))}function rE(m,o,d,g,b,T,E,I,M,N,j,Z,W,Y,te,J,oe){const{lineStartIndex:ae,glyphStartIndex:pe,segment:_e}=I,me=pe+I.numGlyphs,Le=ae+I.lineLength,Ce=o.getoffsetX(pe),Re=o.getoffsetX(me-1),Ae=Cp(m*Ce,d,g,b,T,E,_e,ae,Le,M,N,j,Z,W,!0,Y,te,J,oe);if(!Ae)return null;const Te=Cp(m*Re,d,g,b,T,E,_e,ae,Le,M,N,j,Z,W,!0,Y,te,J,oe);return Te?{first:Ae,last:Te}:null}function br(m,o,d,g){return m===s.bL.horizontal&&Math.abs(g)>Math.abs(d)?{useVertical:!0}:m===s.bL.vertical?g>0?{needsFlipping:!0}:null:o!==gh.unknown&&function(b,T){return b===0||Math.abs(T/b)>wf}(d,g)?o===gh.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null}function Ex(m,o,d,g,b,T,E,I,M,N,j,Z,W,Y,te,J,oe,ae,pe,_e){const me=o/24,Le=m.lineOffsetX*me,Ce=m.lineOffsetY*me,{lineStartIndex:Re,glyphStartIndex:Ae,numGlyphs:Te,segment:Fe,writingMode:Xe,flipState:He}=m,ct=Re+m.lineLength,ht=St=>{if(j){const[_t,lt,Ot]=St.up,en=N.length;s.bN(j,en+0,_t,lt,Ot),s.bN(j,en+1,_t,lt,Ot),s.bN(j,en+2,_t,lt,Ot),s.bN(j,en+3,_t,lt,Ot)}const[Ut,rt,Ue]=St.point;s.bO(N,Ut,rt,Ue,St.angle)};if(Te>1){const St=rE(me,I,Le,Ce,d,Z,W,m,M,T,Y,J,!1,oe,ae,pe,_e);if(!St)return{notEnoughRoom:!0};if(g&&!d){let[Ut,rt,Ue]=St.first.point,[_t,lt,Ot]=St.last.point;[Ut,rt]=Pu(Ut,rt,Ue,E),[_t,lt]=Pu(_t,lt,Ot,E);const en=br(Xe,He,(_t-Ut)*te,lt-rt);if(m.flipState=en&&en.needsFlipping?gh.flipRequired:gh.flipNotRequired,en)return en}ht(St.first);for(let Ut=Ae+1;Ut<Ae+Te-1;Ut++){const rt=Cp(me*I.getoffsetX(Ut),Le,Ce,d,Z,W,Fe,Re,ct,M,T,Y,J,!1,!1,oe,ae,pe,_e);if(!rt)return N.length-=4*(Ut-Ae),{notEnoughRoom:!0};ht(rt)}ht(St.last)}else{if(g&&!d){const Ut=Pu(W.x,W.y,0,b),rt=Re+Fe+1,Ue=new s.P(M.getx(rt),M.gety(rt)),_t=Pu(Ue.x,Ue.y,0,b),lt=_t[3]>0?_t:Ou(W,Ue,Ut,1,b,void 0,oe,ae.canonical),Ot=br(Xe,He,(lt[0]-Ut[0])*te,lt[1]-Ut[1]);if(m.flipState=Ot&&Ot.needsFlipping?gh.flipRequired:gh.flipNotRequired,Ot)return Ot}const St=Cp(me*I.getoffsetX(Ae),Le,Ce,d,Z,W,Fe,Re,ct,M,T,Y,J,!1,!1,oe,ae,pe,_e);if(!St)return{notEnoughRoom:!0};ht(St)}return{}}function O0(m,o,d,g,b){const{x:T,y:E,z:I}=g.projectTilePoint(m.x,m.y,o);if(!b)return Pu(T,E,I,d);const[M,N,j]=b.getElevation(m,b.elevation,b.elevationFeature);return Pu(T+M,E+N,I+j,d)}function Ou(m,o,d,g,b,T,E,I){const M=O0(m.sub(o)._unit()._add(m),I,b,E,T);return s.av(M,d,M),s.aw(M,M),s.bH(M,d,M,g)}function Cp(m,o,d,g,b,T,E,I,M,N,j,Z,W,Y,te,J,oe,ae,pe){const _e=g?m-o:m+o;let me=_e>0?1:-1,Le=0;g&&(me*=-1,Le=Math.PI),me<0&&(Le+=Math.PI);let Ce=I+E+(me>0?0:1)|0,Re=b,Ae=b,Te=0,Fe=0;const Xe=Math.abs(_e),He=[],ct=[];let ht=T,St=ht,Ut=s.bF([]);const rt=()=>Ou(St,ht,Ae,Xe-Te+1,j,W,J,oe.canonical);for(;Te+Fe<=Xe;){if(Ce+=me,Ce<I||Ce>=M)return null;if(Ae=Re,St=ht,He.push(Ae),Y&&ct.push(St),ht=new s.P(N.getx(Ce),N.gety(Ce)),Re=Z[Ce],!Re){const In=O0(ht,oe.canonical,j,J,W);Re=In[3]>0?Z[Ce]=In:rt()}Te+=Fe;const Ht=s.av([],Re,Ae),Ln=s.bG(Ae,Re);if(d&&Ln>0&&Fe>0&&s.bJ(Ut,Ht)/(Fe*Ln)<pe)return null;Fe=Ln,Ut=Ht}te&&W&&(Z[Ce]&&(Re=rt(),Fe=s.bG(Ae,Re),Ut=s.av([],Re,Ae)),Z[Ce]=Re);const Ue=(Xe-Te)/Fe,_t=ht.sub(St)._mult(Ue)._add(St),lt=s.bH([],Ae,Ut,Ue);let Ot=[0,0,1],en=Ut[0],yn=Ut[1];if(ae&&(Ot=J.upVector(oe.canonical,_t.x,_t.y),Ot[0]!==0||Ot[1]!==0||Ot[2]!==1)){const Ht=[Ot[2],0,-Ot[0]],Ln=s.bI([],Ot,Ht);s.aw(Ht,Ht),s.aw(Ln,Ln),en=s.bJ(Ut,Ht),yn=s.bJ(Ut,Ln)}if(d){const Ht=s.bI([],Ot,Ut);s.aw(Ht,Ht),s.bH(lt,lt,Ht,d*me)}const Yt=Le+Math.atan2(yn,en);return He.push(lt),Y&&ct.push(_t),{point:lt,angle:Yt,path:He,tilePath:ct,up:Ot}}function uc(m,o){const d=o.length,g=d+4*m;o.resize(g),o.float32.fill(-1/0,4*d,4*g)}function jn(m,o,d){const g=o[0],b=o[1];return m[0]=d[0]*g+d[4]*b+d[12],m[1]=d[1]*g+d[5]*b+d[13],m[3]=d[3]*g+d[7]*b+d[15],m}const wi=100;class rs{constructor(o,d,g=new Tx(o.width+200,o.height+200,25),b=new Tx(o.width+200,o.height+200,25)){this.transform=o,this.grid=g,this.ignoredGrid=b,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+wi,this.screenBottomBoundary=o.height+wi,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=d}placeCollisionBox(o,d,g,b,T,E,I,M,N,j,Z){let W=g.projectedAnchorX,Y=g.projectedAnchorY,te=g.projectedAnchorZ;const J=g.tileAnchorX,oe=g.tileAnchorY,ae=g.elevation,pe=g.tileID,_e=o.getProjection();if(ae&&pe){const[ct,ht,St]=_e.upVector(pe.canonical,g.tileAnchorX,g.tileAnchorY),Ut=_e.upVectorScale(pe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;W+=ct*ae*Ut,Y+=ht*ae*Ut,te+=St*ae*Ut}const me=o.projection.name==="globe",Le=o.projection.name==="globe"?s.aj(this.transform.zoom):0;if(pe&&me&&Le<1&&!E){const ct=1<<pe.canonical.z,ht=s.bP(J,oe);s.bQ(ht,ht,1/s.al),s.bR(ht,ht,s.bP(pe.canonical.x,pe.canonical.y)),s.bQ(ht,ht,1/ct),s.bS(ht,ht,s.bP(b[0],b[1])),ht[0]=s.bT(ht[0],-.5,.5),s.bQ(ht,ht,s.al);const St=s.bU(ht[0],ht[1],s.al/(2*Math.PI),1);s.aC(St,St,T),W=s.ak(W,St[0],Le),Y=s.ak(Y,St[1],Le),te=s.ak(te,St[2],Le)}const Ce=this.projectAndGetPerspectiveRatio(j,W,Y,te,g.tileID,_e.name==="globe"||!!ae||this.transform.pitch>0,_e),Re=N*Ce.perspectiveRatio,Ae=(g.x1*d+I.x-g.padding)*Re+Ce.point.x,Te=(g.y1*d+I.y-g.padding)*Re+Ce.point.y,Fe=(g.x2*d+I.x+g.padding)*Re+Ce.point.x,Xe=(g.y2*d+I.y+g.padding)*Re+Ce.point.y,He=Ce.perspectiveRatio<=.55||Ce.occluded;return!this.isInsideGrid(Ae,Te,Fe,Xe)||!M&&this.grid.hitTest(Ae,Te,Fe,Xe,Z)||He?{box:[],offscreen:!1,occluded:Ce.occluded}:{box:[Ae,Te,Fe,Xe],offscreen:this.isOffscreen(Ae,Te,Fe,Xe),occluded:!1}}placeCollisionCircles(o,d,g,b,T,E,I,M,N,j,Z,W,Y,te,J,oe){const ae=[],pe=this.transform.elevation,_e=o.getProjection(),me=o.elevationType==="road",Le=!!pe||me,Ce=s.bV.getAtTileOffsetFunc(oe,this.transform.center.lat,this.transform.worldSize,_e),Re=new s.P(g.tileAnchorX,g.tileAnchorY),Ae=new s.P(g.tileAnchorX,g.tileAnchorY);let{x:Te,y:Fe,z:Xe}=_e.projectTilePoint(Ae.x,Ae.y,oe.canonical),He=null;if(Le){const Ln=me?o.getElevationFeatureForText(b):null;He={getElevation:Ce,elevation:pe,elevationFeature:Ln};const[In,pn,vn]=Ce(Re,pe,Ln);Te+=In,Fe+=pn,Xe+=vn}const ct=_e.name==="globe",ht=this.projectAndGetPerspectiveRatio(M,Te,Fe,Xe,oe,ct||!!pe||this.transform.pitch>0,_e),{perspectiveRatio:St}=ht,Ut=(W?I/St:I*St)/s.bY,rt=Pu(Te,Fe,Xe,N),Ue=g.lineOffsetX*Ut,_t=g.lineOffsetY*Ut,lt=s.an(o.layers[0].layout.get("text-max-angle")),Ot=Math.cos(lt),en=ht.signedDistanceFromCamera>0?rE(Ut,E,Ue,_t,me&&g.flipState===1,rt,Ae,g,T,N,{},Le&&!W?He:null,W&&Le,_e,oe,W,Ot):null;let yn=!1,Yt=!1,Ht=!0;if(en&&!ht.occluded){const Ln=.5*te*St+J,In=new s.P(-100,-100),pn=new s.P(this.screenRightBoundary,this.screenBottomBoundary),vn=new M0,{first:er,last:Lr}=en,hi=er.path.length;let Ni=[];for(let Pr=hi-1;Pr>=1;Pr--)Ni.push(er.path[Pr]);for(let Pr=1;Pr<Lr.path.length;Pr++)Ni.push(Lr.path[Pr]);const Dn=2.5*Ln;j&&(Ni=Ni.map(([Pr,Hi,is],Ki)=>(Le&&!ct&&(is=Ce(Ki<hi-1?er.tilePath[hi-1-Ki]:Lr.tilePath[Ki-hi+2],pe,He.elevationFeature)[2]),Pu(Pr,Hi,is,j))),Ni.some(Pr=>Pr[3]<=0)&&(Ni=[]));let Oi=[];if(Ni.length>0){let Pr=1/0,Hi=-1/0,is=1/0,Ki=-1/0;for(const Ri of Ni)Pr=Math.min(Pr,Ri[0]),is=Math.min(is,Ri[1]),Hi=Math.max(Hi,Ri[0]),Ki=Math.max(Ki,Ri[1]);Hi>=In.x&&Pr<=pn.x&&Ki>=In.y&&is<=pn.y&&(Oi=[Ni.map(Ri=>new s.P(Ri[0],Ri[1]))],(Pr<In.x||Hi>pn.x||is<In.y||Ki>pn.y)&&(Oi=s.bW(Oi,In.x,In.y,pn.x,pn.y)))}for(const Pr of Oi){vn.reset(Pr,.25*Ln);let Hi=0;Hi=vn.length<=.5*Ln?1:Math.ceil(vn.paddedLength/Dn)+1;for(let is=0;is<Hi;is++){const Ki=is/Math.max(Hi-1,1),Ri=vn.lerp(Ki),Ur=Ri.x+wi,Ui=Ri.y+wi;ae.push(Ur,Ui,Ln,0);const aa=Ur-Ln,Gs=Ui-Ln,Gi=Ur+Ln,Ei=Ui+Ln;if(Ht=Ht&&this.isOffscreen(aa,Gs,Gi,Ei),Yt=Yt||this.isInsideGrid(aa,Gs,Gi,Ei),!d&&this.grid.hitTestCircle(Ur,Ui,Ln,Y)&&(yn=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:yn,occluded:!1}}}}return{circles:!Z&&yn||!Yt?[]:ae,offscreen:Ht,collisionDetected:yn,occluded:ht.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let g=1/0,b=1/0,T=-1/0,E=-1/0;for(const j of o){const Z=new s.P(j.x+wi,j.y+wi);g=Math.min(g,Z.x),b=Math.min(b,Z.y),T=Math.max(T,Z.x),E=Math.max(E,Z.y),d.push(Z)}const I=this.grid.query(g,b,T,E).concat(this.ignoredGrid.query(g,b,T,E)),M={},N={};for(const j of I){const Z=j.key;if(M[Z.bucketInstanceId]===void 0&&(M[Z.bucketInstanceId]={}),M[Z.bucketInstanceId][Z.featureIndex])continue;const W=[new s.P(j.x1,j.y1),new s.P(j.x2,j.y1),new s.P(j.x2,j.y2),new s.P(j.x1,j.y2)];s.bX(d,W)&&(M[Z.bucketInstanceId][Z.featureIndex]=!0,N[Z.bucketInstanceId]===void 0&&(N[Z.bucketInstanceId]=[]),N[Z.bucketInstanceId].push(Z.featureIndex))}return N}insertCollisionBox(o,d,g,b,T){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:b,collisionGroupID:T},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,d,g,b,T){const E=d?this.ignoredGrid:this.grid,I={bucketInstanceId:g,featureIndex:b,collisionGroupID:T};for(let M=0;M<o.length;M+=4)E.insertCircle(I,o[M],o[M+1],o[M+2])}projectAndGetPerspectiveRatio(o,d,g,b,T,E,I){const M=[d,g,b,1];let N=!1;b||this.transform.pitch>0?(s.aC(M,M,o),this.fogState&&T&&I.name!=="globe"&&(N=function(W,Y,te,J,oe,ae){const pe=ae.calculateFogTileMatrix(oe),_e=[Y,te,J];return s.af(_e,_e,pe),ln(W,s.ag(_e),ae.pitch,ae._fov)}(this.fogState,d,g,b,T.toUnwrapped(),this.transform)>.9)):jn(M,M,o);const j=M[3];return{point:new s.P((M[0]/j+1)/2*this.transform.width+wi,(-M[1]/j+1)/2*this.transform.height+wi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/j*.5,1.5),signedDistanceFromCamera:j,occluded:E&&M[2]>j||N}}isOffscreen(o,d,g,b){return g<wi||o>=this.screenRightBoundary||b<wi||d>this.screenBottomBoundary}isInsideGrid(o,d,g,b){return g>=0&&o<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const o=s.bA([]);return s.br(o,o,[-100,-100,0]),o}}class Cl{constructor(o,d,g,b){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?d:-d))):b&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Vc{constructor(o,d,g,b,T,E=!1){this.text=new Cl(o?o.text:null,d,g,T),this.icon=new Cl(o?o.icon:null,d,b,T),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xi{constructor(o,d,g,b=!1){this.text=o,this.icon=d,this.skipFade=g,this.clipped=b}}class $_{constructor(){this.invProjMatrix=s.bC(),this.viewportMatrix=s.bC(),this.circles=[]}}class L0{constructor(o,d,g,b,T){this.bucketInstanceId=o,this.featureIndex=d,this.sourceLayerIndex=g,this.bucketIndex=b,this.tileID=T}}class D0{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const d=++this.maxGroupID;this.collisionGroups[o]={ID:d,predicate:g=>g.collisionGroupID===d}}return this.collisionGroups[o]}}function Xo(m,o,d,g,b){const{horizontalAlign:T,verticalAlign:E}=s.c1(m),I=-(T-.5)*o,M=-(E-.5)*d,N=s.c2(m,g);return new s.P(I+N[0]*b,M+N[1]*b)}function za(m,o,d,g,b){const T=new s.P(m,o);return d&&T._rotate(g?b:-b),T}class Ok{constructor(o,d,g,b,T,E){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new rs(this.transform,T),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new D0(g),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(o,d,g,b,T=1){const E=g.getBucket(d),I=g.latestFeatureIndex;if(!E||!I||d.fqid!==E.layerIds[0])return;const M=E.layers[0].layout,N=E.layers[0].paint,j=g.collisionBoxArray,Z=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),W=g.tileSize/s.al,Y=g.tileID.toUnwrapped();this.transform.setProjection(E.projection);const te=(J=g.tileID,oe=E.getProjection(),ae=this.transform,oe.name===this.projection?ae.calculateProjMatrix(J.toUnwrapped()):wx(ae,oe,J));var J,oe,ae;const pe=M.get("text-pitch-alignment")==="map",_e=M.get("text-rotation-alignment")==="map";d.compileFilter(d.options);const me=d.dynamicFilter(),Le=d.dynamicFilterNeedsFeature(),Ce=this.transform.calculatePixelsToTileUnitsMatrix(g),Re=V_(te,g.tileID.canonical,pe,_e,this.transform,E.getProjection(),Ce);let Ae=null;const Te=E.getProjection().createInversionMatrix(this.transform,g.tileID.canonical);if(pe){const Ue=P0(te,g.tileID.canonical,pe,_e,this.transform,E.getProjection(),Ce);Ae=s.aB([],this.transform.labelPlaneMatrix,Ue)}let Fe=null;me&&g.latestFeatureIndex&&(Fe={unwrappedTileID:Y,dynamicFilter:me,dynamicFilterNeedsFeature:Le}),this.retainedQueryData[E.bucketInstanceId]=new L0(E.bucketInstanceId,I,E.sourceLayerIndex,E.index,g.tileID);const[Xe,He]=E.layers[0].layout.get("text-size-scale-range"),ct=s.aA(T,Xe,He),[ht,St]=M.get("icon-size-scale-range"),Ut=s.aA(T,ht,St),rt={bucket:E,layout:M,paint:N,posMatrix:te,invMatrix:Te,mercatorCenter:[s.aF(this.transform.center.lng),s.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Re,labelToScreenMatrix:Ae,clippingData:Fe,scale:Z,textPixelRatio:W,holdingForFade:g.holdingForFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:s.bK(E.textSizeData,this.transform.zoom,ct),partiallyEvaluatedIconSize:s.bK(E.iconSizeData,this.transform.zoom,Ut),collisionGroup:this.collisionGroups.get(E.sourceID),latestFeatureIndex:g.latestFeatureIndex};if(b)for(const Ue of E.sortKeyRanges){const{sortKey:_t,symbolInstanceStart:lt,symbolInstanceEnd:Ot}=Ue;o.push({sortKey:_t,symbolInstanceStart:lt,symbolInstanceEnd:Ot,parameters:rt})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:rt})}attemptAnchorPlacement(o,d,g,b,T,E,I,M,N,j,Z,W,Y,te,J,oe,ae,pe,_e,me,Le){const{textOffset0:Ce,textOffset1:Re,crossTileID:Ae}=J,Te=[Ce,Re],Fe=Xo(o,E,I,Te,M),Xe=this.collisionIndex.placeCollisionBox(ae,M,d,g,b,T,za(Fe.x,Fe.y,N,j,this.transform.angle),te,Z,W,Y.predicate);if(_e){const He=ae.getSymbolInstanceIconSize(Le,this.transform.zoom,J.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ae,He,_e,g,b,T,za(Fe.x,Fe.y,N,j,this.transform.angle),te,Z,W,Y.predicate).box.length===0)return}if(Xe.box.length>0){let He;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ae]&&this.prevPlacement.placements[Ae]&&this.prevPlacement.placements[Ae].text&&(He=this.prevPlacement.variableOffsets[Ae].anchor),this.variableOffsets[Ae]={textOffset:Te,width:E,height:I,anchor:o,textScale:M,prevAnchor:He},this.markUsedJustification(ae,o,J,pe),ae.allowVerticalPlacement&&(this.markUsedOrientation(ae,pe,J),this.placedOrientations[Ae]=pe),{shift:Fe,placedGlyphBoxes:Xe}}}placeLayerBucketPart(o,d,g,b,T=1){const{bucket:E,layout:I,paint:M,posMatrix:N,textLabelPlaneMatrix:j,labelToScreenMatrix:Z,clippingData:W,textPixelRatio:Y,mercatorCenter:te,invMatrix:J,holdingForFade:oe,collisionBoxArray:ae,partiallyEvaluatedTextSize:pe,partiallyEvaluatedIconSize:_e,collisionGroup:me,latestFeatureIndex:Le}=o.parameters,Ce=I.get("text-optional"),Re=I.get("icon-optional"),Ae=I.get("text-allow-overlap"),Te=I.get("icon-allow-overlap"),Fe=I.get("text-rotation-alignment")==="map",Xe=I.get("icon-rotation-alignment")==="map",He=I.get("text-pitch-alignment")==="map",ct=M.get("symbol-z-offset"),ht=I.get("symbol-elevation-reference")==="sea",St=I.get("symbol-placement"),[Ut,rt]=I.get("text-size-scale-range"),[Ue,_t]=I.get("icon-size-scale-range"),lt=s.aA(T,Ut,rt),Ot=s.aA(T,Ue,_t),en=I.get("text-variable-anchor"),yn=Fe&&St!=="point",Yt=Xe&&St!=="point",Ht=en&&E.hasTextData(),Ln=E.hasIconTextFit()&&Ht&&E.hasIconData();this.transform.setProjection(E.projection);const In=Ht||yn,pn=Yt||Ln;let vn=Ae&&(Te||!E.hasIconData()||Re),er=Te&&(Ae||!E.hasTextData()||Ce);const Lr=!ct.isConstant();!E.collisionArrays&&ae&&E.deserializeCollisionBoxes(ae),g&&b&&E.updateCollisionDebugBuffers(this.transform.zoom,ae,lt,Ot);const hi=(Dn,Oi,Pr)=>{const{crossTileID:Hi,numVerticalGlyphVertices:is}=Dn;let Ki=null;if(W&&W.dynamicFilterNeedsFeature||Lr){const pa=this.retainedQueryData[E.bucketInstanceId];Ki=Le.loadFeature({featureIndex:Dn.featureIndex,bucketIndex:pa.bucketIndex,sourceLayerIndex:pa.sourceLayerIndex,layoutVertexArrayOffset:0});const Ia=Ki.properties?Ki.properties.worldview:null;if(E.localizable&&E.worldview&&typeof Ia=="string")if(Ia==="all")Ki.properties.$localized=!0;else{if(!Ia.split(",").includes(E.worldview))return;Ki.properties.$localized=!0,Ki.properties.worldview=E.worldview}}if(W&&!(0,W.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:E.worldview},Ki,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new s.P(Dn.tileAnchorX,Dn.tileAnchorY),this.transform.calculateDistanceTileData(W.unwrappedTileID)))return this.placements[Hi]=new Xi(!1,!1,!1,!0),void d.add(Hi);const Ri=ct.evaluate(Ki,{});if(d.has(Hi))return;if(oe)return void(this.placements[Hi]=new Xi(!1,!1,!1));let Ur=!1,Ui=!1,aa=!0,Gs=!1,Gi=!1,Ei=null,Vr={box:null,offscreen:null,occluded:null},Bs={box:null},Ea=null,na=null,gs=null,vl=0,jo=0,Xa=0;Pr.textFeatureIndex?vl=Pr.textFeatureIndex:Dn.useRuntimeCollisionCircles&&(vl=Dn.featureIndex),Pr.verticalTextFeatureIndex&&(jo=Pr.verticalTextFeatureIndex);const Ko=E.elevationFeatures?E.elevationFeatures[Dn.elevationFeatureIndex]:void 0,Qo=pa=>{pa.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const Ia=this.transform.elevation;pa.elevation=ht?Ri:Ri+s.bV.getAtTileOffset(pa.tileID,new s.P(pa.tileAnchorX,pa.tileAnchorY),Ia,Ko),pa.elevation+=Dn.zOffset},Po=Pr.textBox;if(Po){Qo(Po);const pa=_s=>{let La=s.bL.horizontal;if(E.allowVerticalPlacement&&!_s&&this.prevPlacement){const oa=this.prevPlacement.placedOrientations[Hi];oa&&(this.placedOrientations[Hi]=oa,La=oa,this.markUsedOrientation(E,La,Dn))}return La},Ia=(_s,La)=>{if(E.allowVerticalPlacement&&is>0&&Pr.verticalTextBox){for(const oa of E.writingModes)if(oa===s.bL.vertical?(Vr=La(),Bs=Vr):Vr=_s(),Vr&&Vr.box&&Vr.box.length)break}else Vr=_s()};if(en){let _s=en;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Hi]){const ra=this.prevPlacement.variableOffsets[Hi];_s.indexOf(ra.anchor)>0&&(_s=_s.filter(Uu=>Uu!==ra.anchor),_s.unshift(ra.anchor))}const La=(ra,Uu,ug)=>{const mc=E.getSymbolInstanceTextSize(pe,Dn,this.transform.zoom,Oi),cg=(ra.x2-ra.x1)*mc+2*ra.padding,Kp=(ra.y2-ra.y1)*mc+2*ra.padding,Kc=Dn.hasIconTextFit&&!Te?Uu:null;Kc&&Qo(Kc);let Ld={box:[],offscreen:!1,occluded:!1};const Qp=Ae?2*_s.length:_s.length;for(let Ph=0;Ph<Qp;++Ph){const Dd=this.attemptAnchorPlacement(_s[Ph%_s.length],ra,te,J,In,cg,Kp,mc,Fe,He,Y,N,me,Ph>=_s.length,Dn,Oi,E,ug,Kc,pe,_e);if(Dd&&(Ld=Dd.placedGlyphBoxes,Ld&&Ld.box&&Ld.box.length)){Ur=!0,Ei=Dd.shift;break}}return Ld};Ia(()=>La(Po,Pr.iconBox,s.bL.horizontal),()=>{const ra=Pr.verticalTextBox;return ra&&Qo(ra),E.allowVerticalPlacement&&!(Vr&&Vr.box&&Vr.box.length)&&is>0&&ra?La(ra,Pr.verticalIconBox,s.bL.vertical):{box:null,offscreen:null,occluded:null}}),Vr&&(Ur=Vr.box,aa=Vr.offscreen,Gs=Vr.occluded);const oa=pa(!(!Vr||!Vr.box));if(!Ur&&this.prevPlacement){const ra=this.prevPlacement.variableOffsets[Hi];ra&&(this.variableOffsets[Hi]=ra,this.markUsedJustification(E,ra.anchor,Dn,oa))}}else{const _s=(La,oa)=>{const ra=E.getSymbolInstanceTextSize(pe,Dn,this.transform.zoom,Oi),Uu=this.collisionIndex.placeCollisionBox(E,ra,La,te,J,In,new s.P(0,0),Ae,Y,N,me.predicate);return Uu&&Uu.box&&Uu.box.length&&(this.markUsedOrientation(E,oa,Dn),this.placedOrientations[Hi]=oa),Uu};Ia(()=>_s(Po,s.bL.horizontal),()=>{const La=Pr.verticalTextBox;return E.allowVerticalPlacement&&is>0&&La?(Qo(La),_s(La,s.bL.vertical)):{box:null,offscreen:null,occluded:null}}),pa(!!(Vr&&Vr.box&&Vr.box.length))}}if(Ea=Vr,Ur=Ea&&Ea.box&&Ea.box.length>0,aa=Ea&&Ea.offscreen,Gs=Ea&&Ea.occluded,Dn.useRuntimeCollisionCircles){const pa=Dn.centerJustifiedTextSymbolIndex>=0?Dn.centerJustifiedTextSymbolIndex:Dn.verticalPlacedTextSymbolIndex,Ia=E.text.placedSymbolArray.get(pa),_s=s.bM(E.textSizeData,pe,Ia),La=I.get("text-padding");na=this.collisionIndex.placeCollisionCircles(E,Ae,Ia,pa,E.lineVertexArray,E.glyphOffsetArray,_s,N,j,Z,g,He,me.predicate,Dn.collisionCircleDiameter*_s/s.bY,La,this.retainedQueryData[E.bucketInstanceId].tileID),Ur=Ae||na.circles.length>0&&!na.collisionDetected,aa=aa&&na.offscreen,Gs=na.occluded}if(Pr.iconFeatureIndex&&(Xa=Pr.iconFeatureIndex),Pr.iconBox){const pa=Ia=>{Qo(Ia);const _s=Dn.hasIconTextFit&&Ei?za(Ei.x,Ei.y,Fe,He,this.transform.angle):new s.P(0,0),La=E.getSymbolInstanceIconSize(_e,this.transform.zoom,Dn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,La,Ia,te,J,pn,_s,Te,Y,N,me.predicate)};Bs&&Bs.box&&Bs.box.length&&Pr.verticalIconBox?(gs=pa(Pr.verticalIconBox),Ui=gs.box.length>0):(gs=pa(Pr.iconBox),Ui=gs.box.length>0),aa=aa&&gs.offscreen,Gi=gs.occluded}const hu=Ce||Dn.numHorizontalGlyphVertices===0&&is===0,ju=Re||Dn.numIconVertices===0;if(hu||ju?ju?hu||(Ui=Ui&&Ur):Ur=Ui&&Ur:Ui=Ur=Ui&&Ur,Ur&&Ea&&Ea.box&&this.collisionIndex.insertCollisionBox(Ea.box,I.get("text-ignore-placement"),E.bucketInstanceId,Bs&&Bs.box&&jo?jo:vl,me.ID),Ui&&gs&&this.collisionIndex.insertCollisionBox(gs.box,I.get("icon-ignore-placement"),E.bucketInstanceId,Xa,me.ID),na&&(Ur&&this.collisionIndex.insertCollisionCircles(na.circles,I.get("text-ignore-placement"),E.bucketInstanceId,vl,me.ID),g)){const pa=E.bucketInstanceId;let Ia=this.collisionCircleArrays[pa];Ia===void 0&&(Ia=this.collisionCircleArrays[pa]=new $_);for(let _s=0;_s<na.circles.length;_s+=4)Ia.circles.push(na.circles[_s+0]),Ia.circles.push(na.circles[_s+1]),Ia.circles.push(na.circles[_s+2]),Ia.circles.push(na.collisionDetected?1:0)}const Rl=E.projection.name!=="globe";vn=vn&&(Rl||!Gs),er=er&&(Rl||!Gi),this.placements[Hi]=new Xi(Ur||vn,Ui||er,aa||E.justReloaded),d.add(Hi)},Ni=this.retainedQueryData[E.bucketInstanceId].tileID;if(E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,Ni),E.elevationType==="road"&&E.updateRoadElevation(Ni.canonical),E.updateZOffset(),E.sortFeaturesByY){const Dn=E.getSortedSymbolIndexes(this.transform.angle);for(let Oi=Dn.length-1;Oi>=0;--Oi){const Pr=Dn[Oi];hi(E.symbolInstances.get(Pr),Pr,E.collisionArrays[Pr])}E.hasAnyZOffset&&s.w(`${E.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(E.hasAnyZOffset){const Dn=E.getSortedIndexesByZOffset();for(let Oi=0;Oi<Dn.length;++Oi){const Pr=Dn[Oi];hi(E.symbolInstances.get(Pr),Pr,E.collisionArrays[Pr])}}else for(let Dn=o.symbolInstanceStart;Dn<o.symbolInstanceEnd;Dn++)hi(E.symbolInstances.get(Dn),Dn,E.collisionArrays[Dn]);if(g&&E.bucketInstanceId in this.collisionCircleArrays){const Dn=this.collisionCircleArrays[E.bucketInstanceId];s.bl(Dn.invProjMatrix,N),Dn.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(o,d,g,b){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:M,crossTileID:N}=g,j=s.c3(d),Z=b===s.bL.vertical?M:j==="left"?T:j==="center"?E:j==="right"?I:-1;T>=0&&(o.text.placedSymbolArray.get(T).crossTileID=Z>=0&&T!==Z?0:N),E>=0&&(o.text.placedSymbolArray.get(E).crossTileID=Z>=0&&E!==Z?0:N),I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=Z>=0&&I!==Z?0:N),M>=0&&(o.text.placedSymbolArray.get(M).crossTileID=Z>=0&&M!==Z?0:N)}markUsedOrientation(o,d,g){const b=d===s.bL.horizontal||d===s.bL.horizontalOnly?d:0,T=d===s.bL.vertical?d:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:N}=g,j=o.text.placedSymbolArray;E>=0&&(j.get(E).placedOrientation=b),I>=0&&(j.get(I).placedOrientation=b),M>=0&&(j.get(M).placedOrientation=b),N>=0&&(j.get(N).placedOrientation=T)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let g=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const b=d?d.symbolFadeChange(o):1,T=d?d.opacities:{},E=d?d.variableOffsets:{},I=d?d.placedOrientations:{};for(const M in this.placements){const N=this.placements[M],j=T[M];j?(this.opacities[M]=new Vc(j,b,N.text,N.icon,null,N.clipped),g=g||N.text!==j.text.placed||N.icon!==j.icon.placed):(this.opacities[M]=new Vc(null,b,N.text,N.icon,N.skipFade,N.clipped),g=g||N.text||N.icon)}for(const M in T){const N=T[M];if(!this.opacities[M]){const j=new Vc(N,b,!1,!1);j.isHidden()||(this.opacities[M]=j,g=g||N.text.placed||N.icon.placed)}}for(const M in E)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=E[M]);for(const M in I)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=I[M]);g?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:o)}updateLayerOpacities(o,d,g,b){b&&(this.lastReplacementSourceUpdateTime=b.updateTime);const T=new Set;for(const E of d){const I=E.getBucket(o);I&&E.latestFeatureIndex&&o.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,T,E,E.collisionBoxArray,g,b,E.tileID,o.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,E.tileID),I.elevationType==="road"&&I.updateRoadElevation(E.tileID.canonical),I.updateZOffset())}}updateBucketOpacities(o,d,g,b,T,E,I,M){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const N=o.layers[0].layout,j=o.layers[0].paint,Z=!!o.layers[0].dynamicFilter(),W=new Vc(null,0,!1,!1,!0),Y=N.get("text-allow-overlap"),te=N.get("icon-allow-overlap"),J=N.get("text-variable-anchor"),oe=N.get("text-rotation-alignment")==="map",ae=N.get("text-pitch-alignment")==="map",pe=j.get("symbol-z-offset"),_e=N.get("symbol-elevation-reference")==="sea",me=!pe.isConstant(),Le=new Vc(null,0,Y&&(te||!o.hasIconData()||N.get("icon-optional")),te&&(Y||!o.hasTextData()||N.get("text-optional")),!0);!o.collisionArrays&&b&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(b);const Ce=(Ae,Te,Fe)=>{for(let Xe=0;Xe<Te/4;Xe++)Ae.opacityVertexArray.emplaceBack(Fe)};let Re=0;E&&o.updateReplacement(I,E);for(let Ae=0;Ae<o.symbolInstances.length;Ae++){const Te=o.symbolInstances.get(Ae),{numHorizontalGlyphVertices:Fe,numVerticalGlyphVertices:Xe,crossTileID:He,numIconVertices:ct,tileAnchorX:ht,tileAnchorY:St}=Te;let Ut=null;const rt=this.retainedQueryData[o.bucketInstanceId];me&&Te&&rt&&(Ut=g.latestFeatureIndex.loadFeature({featureIndex:Te.featureIndex,bucketIndex:rt.bucketIndex,sourceLayerIndex:rt.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ue=pe.evaluate(Ut,{}),_t=d.has(He);let lt=this.opacities[He];_t?lt=W:lt||(lt=Le,this.opacities[He]=lt),d.add(He);const Ot=Fe>0||Xe>0,en=ct>0,yn=this.placedOrientations[He],Yt=yn===s.bL.vertical,Ht=yn===s.bL.horizontal||yn===s.bL.horizontalOnly;!Ot&&!en||lt.isHidden()||Re++;let Ln=!1;if((Ot||en)&&E)for(const In of o.activeReplacements){if(s.bZ(In,T,s.b_.Symbol,M)||In.min.x>ht||ht>In.max.x||In.min.y>St||St>In.max.y)continue;const pn=s.b$(ht,St,I.canonical,In.footprintTileId.canonical);if(Ln=s.c0(pn,In.footprint),Ln)break}if(Ot){const In=Ln?Tf:ml(lt.text);Ce(o.text,Fe,Yt?Tf:In),Ce(o.text,Xe,Ht?Tf:In);const pn=lt.text.isHidden(),{leftJustifiedTextSymbolIndex:vn,centerJustifiedTextSymbolIndex:er,rightJustifiedTextSymbolIndex:Lr,verticalPlacedTextSymbolIndex:hi}=Te,Ni=o.text.placedSymbolArray,Dn=pn||Yt?1:0;vn>=0&&(Ni.get(vn).hidden=Dn),er>=0&&(Ni.get(er).hidden=Dn),Lr>=0&&(Ni.get(Lr).hidden=Dn),hi>=0&&(Ni.get(hi).hidden=pn||Ht?1:0);const Oi=this.variableOffsets[He];Oi&&this.markUsedJustification(o,Oi.anchor,Te,yn);const Pr=this.placedOrientations[He];Pr&&(this.markUsedJustification(o,"left",Te,Pr),this.markUsedOrientation(o,Pr,Te))}if(en){const In=Ln?Tf:ml(lt.icon),{placedIconSymbolIndex:pn,verticalPlacedIconSymbolIndex:vn}=Te,er=o.icon.placedSymbolArray,Lr=lt.icon.isHidden()?1:0;pn>=0&&(Ce(o.icon,ct,Yt?Tf:In),er.get(pn).hidden=Lr),vn>=0&&(Ce(o.icon,Te.numVerticalIconVertices,Ht?Tf:In),er.get(vn).hidden=Lr)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const In=o.collisionArrays[Ae];if(In){let pn=new s.P(0,0),vn=!0;if(In.textBox||In.verticalTextBox){if(J){const Lr=this.variableOffsets[He];Lr?(pn=Xo(Lr.anchor,Lr.width,Lr.height,Lr.textOffset,Lr.textScale),oe&&pn._rotate(ae?this.transform.angle:-this.transform.angle)):vn=!1}Z&&(vn=!lt.clipped),In.textBox&&_h(o.textCollisionBox.collisionVertexArray,lt.text.placed,!vn||Yt,Ue,_e,pn.x,pn.y),In.verticalTextBox&&_h(o.textCollisionBox.collisionVertexArray,lt.text.placed,!vn||Ht,Ue,_e,pn.x,pn.y)}const er=vn&&!!(!Ht&&In.verticalIconBox);In.iconBox&&_h(o.iconCollisionBox.collisionVertexArray,lt.icon.placed,er,Ue,_e,Te.hasIconTextFit?pn.x:0,Te.hasIconTextFit?pn.y:0),In.verticalIconBox&&_h(o.iconCollisionBox.collisionVertexArray,lt.icon.placed,!er,Ue,_e,Te.hasIconTextFit?pn.x:0,Te.hasIconTextFit?pn.y:0)}}}if(o.fullyClipped=Re===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=Ae.invProjMatrix,o.placementViewportMatrix=Ae.viewportMatrix,o.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,d){const g=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*g>o}isStale(){return this.stale}setStale(){this.stale=!0}}function _h(m,o,d,g,b,T,E){m.emplaceBack(o?1:0,d?1:0,T||0,E||0,g,b?1:0),m.emplaceBack(o?1:0,d?1:0,T||0,E||0,g,b?1:0),m.emplaceBack(o?1:0,d?1:0,T||0,E||0,g,b?1:0),m.emplaceBack(o?1:0,d?1:0,T||0,E||0,g,b?1:0)}const Sx=Math.pow(2,25),N0=Math.pow(2,24),H_=Math.pow(2,17),Ax=Math.pow(2,16),G_=Math.pow(2,9),pl=Math.pow(2,8),bd=Math.pow(2,1);function ml(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const o=m.placed?1:0,d=Math.floor(127*m.opacity);return d*Sx+o*N0+d*H_+o*Ax+d*G_+o*pl+d*bd+o}const Tf=0;class kp{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,d,g,b,T,E){const I=this._bucketParts;for(;this._currentTileIndex<o.length;)if(d.getBucketParts(I,b,o[this._currentTileIndex],this._sortAcrossTiles,E),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((M,N)=>M.sortKey-N.sortKey));this._currentPartIndex<I.length;){const M=I[this._currentPartIndex];if(d.placeLayerBucketPart(M,this._seenCrossTileIDs,g,M.symbolInstanceStart===0,E),this._currentPartIndex++,T())return!0}return!1}}class po{constructor(o,d,g,b,T,E,I,M,N){this.placement=new Ok(o,T,E,I,M,N),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(o,d,g,b,T){const E=s.o.now(),I=()=>{const M=s.o.now()-E;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=d[o[this._currentPlacementIndex]],N=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&M.visibility!=="none"&&(!M.minzoom||M.minzoom<=N)&&(!M.maxzoom||M.maxzoom>N)){const j=M,Z=j.layout.get("symbol-z-elevate"),W=j.layout.get("symbol-sort-key").constantOr(1)!==void 0,Y=j.layout.get("symbol-z-order"),te=Y==="viewport-y"||Y==="auto"&&!(Y!=="viewport-y"&&W),J=j.layout.get("text-allow-overlap")||j.layout.get("icon-allow-overlap")||j.layout.get("text-ignore-placement")||j.layout.get("icon-ignore-placement"),oe=te&&J,ae=this._inProgressLayer=this._inProgressLayer||new kp(j),pe=s.B(M.source,M.scope);if(ae.continuePlacement(Z||oe?b[pe]:g[pe],this.placement,this._showCollisionBoxes,M,I,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Lu=512/s.al/2;class wd{constructor(o,d,g){this.tileID=o,this.bucketInstanceId=g,this.index=new s.c4(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=o.canonical.x*s.al,T=o.canonical.y*s.al;for(let E=0;E<d.length;E++){const{key:I,crossTileID:M,tileAnchorX:N,tileAnchorY:j}=d.get(E),Z=Math.floor((b+N)*Lu),W=Math.floor((T+j)*Lu);this.index.add(Z,W),this.keys.push(I),this.crossTileIDs.push(M)}this.index.finish()}findMatches(o,d,g){const b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),T=Lu/Math.pow(2,d.canonical.z-this.tileID.canonical.z),E=d.canonical.x*s.al,I=d.canonical.y*s.al;for(let M=0;M<o.length;M++){const N=o.get(M);if(N.crossTileID)continue;const{key:j,tileAnchorX:Z,tileAnchorY:W}=N,Y=Math.floor((E+Z)*T),te=Math.floor((I+W)*T),J=this.index.range(Y-b,te-b,Y+b,te+b).sort((oe,ae)=>oe-ae);for(const oe of J){const ae=this.crossTileIDs[oe];if(this.keys[oe]===j&&!g.has(ae)){g.add(ae),N.crossTileID=ae;break}}}}}class so{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Cx{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const d=Math.round((o-this.lng)/360);if(d!==0)for(const g in this.indexes){const b=this.indexes[g],T={};for(const E in b){const I=b[E];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+d),T[I.tileID.key]=I}this.indexes[g]=T}this.lng=o}addBucket(o,d,g){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let T=0;T<d.symbolInstances.length;T++)d.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const b=this.usedCrossTileIDs[o.overscaledZ];for(const T in this.indexes){const E=this.indexes[T];if(Number(T)>o.overscaledZ)for(const I in E){const M=E[I];M.tileID.isChildOf(o)&&M.findMatches(d.symbolInstances,o,b)}else{const I=E[o.scaledTo(Number(T)).key];I&&I.findMatches(d.symbolInstances,o,b)}}for(let T=0;T<d.symbolInstances.length;T++){const E=d.symbolInstances.get(T);E.crossTileID||(E.crossTileID=g.generate(),b.add(E.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new wd(o,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(o,d){for(const g of d.crossTileIDs)this.usedCrossTileIDs[o].delete(g)}removeStaleBuckets(o){let d=!1;for(const g in this.indexes){const b=this.indexes[g];for(const T in b)o[b[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,b[T]),delete b[T],d=!0)}return d}}class cc{constructor(){this.layerIndexes={},this.crossTileIDs=new so,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,d,g,b){let T=this.layerIndexes[o.fqid];T===void 0&&(T=this.layerIndexes[o.fqid]=new Cx);let E=!1;const I={};b.name!=="globe"&&T.handleWrapJump(g);for(const M of d){const N=M.getBucket(o);N&&o.fqid===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(M.tileID,N,this.crossTileIDs)&&(E=!0),I[N.bucketInstanceId]=!0)}return T.removeStaleBuckets(I)&&(E=!0),E}pruneUnusedLayers(o){const d={};o.forEach(g=>{d[g]=!0});for(const g in this.layerIndexes)d[g]||delete this.layerIndexes[g]}}const $c=771;class jr{constructor(o,d,g,b){this.blendFunction=o,this.blendColor=d.toNonPremultipliedRenderColor(null),this.mask=g,this.blendEquation=b}}jr.Replace=[1,0,1,0],jr.disabled=new jr(jr.Replace,s.ao.transparent,[!1,!1,!1,!1]),jr.unblended=new jr(jr.Replace,s.ao.transparent,[!0,!0,!0,!0]),jr.alphaBlended=new jr([1,$c,1,$c],s.ao.transparent,[!0,!0,!0,!0]),jr.alphaBlendedNonPremultiplied=new jr([770,$c,770,$c],s.ao.transparent,[!0,!0,!0,!0]),jr.multiply=new jr([774,0,774,0],s.ao.transparent,[!0,!0,!0,!0]),jr.additive=new jr([1,1,1,1],s.ao.transparent,[!0,!0,!0,!0]);class zn{constructor(o,d,g){this.func=o,this.mask=d,this.range=g}}zn.ReadOnly=!1,zn.ReadWrite=!0,zn.disabled=new zn(519,zn.ReadOnly,[0,1]);const q_=7680;class kr{constructor(o,d,g,b,T,E){this.test=o,this.ref=d,this.mask=g,this.fail=b,this.depthFail=T,this.pass=E}}kr.disabled=new kr({func:519,mask:0},0,0,q_,q_,q_);const Ip=1029,W_=2305;class Cr{constructor(o,d,g){this.enable=o,this.mode=d,this.frontFace=g}}function Hc(m,o){const d=s.ca(m,3);s.cc(m,o),s.cg(m,3,d)}function kx(m,o){const d=s.c7([]);return s.c8(d,d,-o),s.c9(d,d,-m),d}function Z_(m,o){const d=[m[0],m[1],0],g=[o[0],o[1],0];if(s.ag(d)>=1e-15){const E=s.aw([],d);s.c5(g,E,s.bJ(g,E)),o[0]=g[0],o[1]=g[1]}const b=s.bI([],o,m);if(s.c6(b)<1e-15)return null;const T=Math.atan2(-b[1],b[0]);return kx(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),T)}Cr.disabled=new Cr(!1,Ip,W_),Cr.backCCW=new Cr(!0,Ip,W_),Cr.backCW=new Cr(!0,Ip,2304),Cr.frontCW=new Cr(!0,1028,2304),Cr.frontCCW=new Cr(!0,1028,W_);class gl{constructor(o,d){this.position=o,this.orientation=d}get position(){return this._position}set position(o){if(o){const d=o instanceof s.ae?o:new s.ae(o[0],o[1],o[2]);this._renderWorldCopies&&(d.x=s.bT(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(o,d,g){if(this.orientation=null,!this.position)return;const b=this.position,T=g||(this._elevation?this._elevation.getAtPointOrZero(s.ae.fromLngLat(o)):0),E=s.ae.fromLngLat(o,T),I=[E.x-b.x,E.y-b.y,E.z-b.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=Z_(I,d)}setPitchBearing(o,d){this.orientation=kx(s.an(o),s.an(-d))}}class X_{constructor(o,d){this._transform=s.bA([]),this.orientation=d,this.position=o}get mercatorPosition(){const o=this.position;return new s.ae(o[0],o[1],o[2])}get position(){const o=s.ca(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var d;o&&s.cg(this._transform,3,[(d=o)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||s.c7([]),o&&Hc(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,d){this._orientation=kx(o,d),Hc(this._transform,this._orientation)}forward(){const o=s.ca(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=s.ca(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=s.ca(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,d){const g=new Float64Array(16);return s.bl(g,this.getWorldToCamera(o,d)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,d,g){const b=this.position;s.c5(b,b,-o);const T=new Float64Array(16);return s.bq(T,[g,g,g]),s.br(T,T,b),T[10]*=d,T}getWorldToCamera(o,d){const g=new Float64Array(16),b=new Float64Array(4),T=this.position;return s.cb(b,this._orientation),s.c5(T,T,-o),s.cc(g,b),s.br(g,g,T),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=d,g[9]*=d,g[10]*=d,g[11]*=d,g}getCameraToClipPerspective(o,d,g,b){const T=new Float64Array(16);return s.cd(T,o,d,g,b),T}getCameraToClipOrthographic(o,d,g,b,T,E){const I=new Float64Array(16);return s.ce(I,o,d,g,b,T,E),I}getDistanceToElevation(o,d=!1){const g=o===0?0:s.cf(o,d?s.a$(this.position[1]):this.position[1]),b=this.forward();return(g-this.position[2])/b[2]}clone(){return new X_([...this.position],[...this.orientation])}}const wo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Y_{constructor(o=0,d=0,g=0,b=0){if(isNaN(o)||o<0||isNaN(d)||d<0||isNaN(g)||g<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=d,this.left=g,this.right=b}interpolate(o,d,g){return d.top!=null&&o.top!=null&&(this.top=s.ak(o.top,d.top,g)),d.bottom!=null&&o.bottom!=null&&(this.bottom=s.ak(o.bottom,d.bottom,g)),d.left!=null&&o.left!=null&&(this.left=s.ak(o.left,d.left,g)),d.right!=null&&o.right!=null&&(this.right=s.ak(o.right,d.right,g)),this}getCenter(o,d){const g=s.aA((this.left+o-this.right)/2,0,o),b=s.aA((this.top+d-this.bottom)/2,0,d);return new s.P(g,b)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Y_(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const dc=15;class Ix{constructor(o,d,g,b,T,E,I){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=o||0,this._maxZoom=d||22,this._minPitch=g??0,this._maxPitch=b??60,this.setProjection(E),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new s.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Y_,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new X_,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const o=new Ix(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<dc}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,d=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(o||g)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return s.aH(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=s.cm(this.projectionOptions);const g=this.getProjection(),b=!s.by(d,g);return b&&this._calcMatrices(),this.mercatorFromTransition=!1,b}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cm({name:"mercator"});const d=o!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bT(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const d=-o*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=s.cn(),s.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const d=s.aA(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=s.an(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const d=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){const o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,d=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!d||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const g=this._elevation;d||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const o=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(o)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let b=0,T=0;for(let E=0;E<d.length;E++){const I=new s.P(d[E][0]*this.width,g+d[E][1]*(this.height-g)),M=o.pointCoordinate(I);if(!M)continue;const N=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);b+=M[3]*N,T+=N}return T===0?NaN:b/T}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*d,b=this._mercatorZfromZoom(o),T=this._mercatorZfromZoom(this._maxZoom),E=Math.max(b-g,T);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}equals(o){const d=this.elevation,g=o.elevation,b=d!=null!=(g!=null)||d&&g&&d.exaggeration()!==g.exaggeration();return this.width===o.width&&this.height===o.height&&this.center.lng===o.center.lng&&this.center.lat===o.center.lat&&this.zoom===o.zoom&&this.bearing===o.bearing&&this.pitch===o.pitch&&this.fov===o.fov&&this.projection.name===o.projection.name&&this._edgeInsets.equals(o.padding)&&!b}computeZoomRelativeTo(o){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let g;g=o.z<this._camera.position[2]?[d.x,d.y,d.z]:[o.x,o.y,o.z];const b=s.ag(s.av([],this._camera.position,g));return s.aA(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let d=!1;if(o.orientation&&!s.cp(o.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(o.orientation)),o.position){const g=[o.position.x,o.position.y,o.position.z];s.cq(g,this._camera.position)||(this._setCameraPosition(g),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,d=new gl;return d.position=new s.ae(o[0],o[1],o[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(o){if(!s.cr(o))return!1;s.cs(o,o);const d=s.ct([],[0,0,-1],o),g=s.ct([],[0,-1,0],o);if(g[2]<0)return!1;const b=Z_(d,g);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(o){const d=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;o[2]=s.aA(o[2],b/g,b/d),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,d,g){this._unmodified=!1,this._edgeInsets.interpolate(o,d,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const d=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(o){const d=[new s.cu(0,o)];if(this.renderWorldCopies){const g=this.pointCoordinate(new s.P(0,0)),b=this.pointCoordinate(new s.P(this.width,0)),T=this.pointCoordinate(new s.P(this.width,this.height)),E=this.pointCoordinate(new s.P(0,this.height)),I=Math.floor(Math.min(g.x,b.x,T.x,E.x)),M=Math.floor(Math.max(g.x,b.x,T.x,E.x)),N=1;for(let j=I-N;j<=M+N;j++)j!==0&&d.push(new s.cu(j,o))}return d}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,d,g,b){let T=[];const E=g!=null,I=!E;if(I&&this.zoom<d||E&&g[0]===0&&g[1]===0)return T;const M=new Set,N=(Z,W,Y,te,J)=>{const oe=s.cY(W,Z,Y,te,J);M.has(oe)||(T.push(new s.aQ(Z,W,Y,te,J)),M.add(oe))};for(let Z=0;Z<o.length;Z++){const W=o[Z];if(I&&W.canonical.z!==d||E&&b!==void 0&&b>W.canonical.z)continue;const Y=W.canonical,te=W.overscaledZ,J=W.wrap,oe=1<<Y.z,ae=Y.x+1<oe,pe=Y.x>0,_e=Y.y+1<oe,me=Y.y>0,Le=W.wrap-(pe?0:1),Ce=W.wrap+(ae?0:1),Re=pe?Y.x-1:oe-1,Ae=ae?Y.x+1:0;if(E)g[0]<0?(N(te,Ce,Y.z,Ae,Y.y),g[1]<0&&_e&&(N(te,J,Y.z,Y.x,Y.y+1),N(te,Ce,Y.z,Ae,Y.y+1)),g[1]>0&&me&&(N(te,J,Y.z,Y.x,Y.y-1),N(te,Ce,Y.z,Ae,Y.y-1))):g[0]>0?(N(te,Le,Y.z,Re,Y.y),g[1]<0&&_e&&(N(te,J,Y.z,Y.x,Y.y+1),N(te,Le,Y.z,Re,Y.y+1)),g[1]>0&&me&&(N(te,J,Y.z,Y.x,Y.y-1),N(te,Le,Y.z,Re,Y.y-1))):g[1]<0&&_e?N(te,J,Y.z,Y.x,Y.y+1):me&&N(te,J,Y.z,Y.x,Y.y-1);else{const Te=W.visibleQuadrants;1&Te&&(N(te,Le,Y.z,Re,Y.y),me&&(N(te,J,Y.z,Y.x,Y.y-1),N(te,Le,Y.z,Re,Y.y-1))),2&Te&&(N(te,Ce,Y.z,Ae,Y.y),me&&(N(te,J,Y.z,Y.x,Y.y-1),N(te,Ce,Y.z,Ae,Y.y-1))),4&Te&&(N(te,Le,Y.z,Re,Y.y),_e&&(N(te,J,Y.z,Y.x,Y.y+1),N(te,Le,Y.z,Re,Y.y+1))),8&Te&&(N(te,Ce,Y.z,Ae,Y.y),_e&&(N(te,J,Y.z,Y.x,Y.y+1),N(te,Ce,Y.z,Ae,Y.y+1)))}}const j=[];for(const Z of T)T.some(W=>Z.isChildOf(W))||j.push(Z);if(T=j.filter(Z=>!o.some(W=>!!(Z.overscaledZ<d&&W.isChildOf(Z))||Z.equals(W)||Z.isChildOf(W))),I){const Z=1<<d,W=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=[Z*W.x,Z*W.y],te=4,J=te*te;T=T.filter(oe=>{const ae=oe.canonical.x+.5-Y[0],pe=oe.canonical.y+.5-Y[1];return ae*ae+pe*pe<J})}return T}extendTileCoverToNearPlane(o,d,g){const b=[],T=new Set;for(const pe of o)T.add(pe.key);const E=(pe,_e,me,Le,Ce)=>{const Re=s.cY(_e,pe,me,Le,Ce);T.has(Re)||(b.push(new s.aQ(pe,_e,me,Le,Ce)),T.add(Re))},I=o.reduce((pe,_e)=>Math.max(pe,_e.overscaledZ),g),M=1<<g,N=[new s.P(0,0),new s.P(s.al,0),new s.P(s.al,s.al),new s.P(0,s.al)],j=new s.P(0,0),Z=new s.P(0,0),W=(pe,_e)=>{const me=Math.floor(pe[0]),Le=Math.floor(pe[1]),Ce=(pe[0]-me)*s.al,Re=(pe[1]-Le)*s.al,Ae=Math.floor(_e[0]),Te=Math.floor(_e[1]),Fe=(_e[0]-Ae)*s.al,Xe=(_e[1]-Te)*s.al;for(let He=-1;He<=1;He++){const ct=me+He;if(!(ct<0||ct>=M)){j.x=Ce-He*s.al,Z.x=Fe-(ct-Ae)*s.al;for(let ht=-1;ht<=1;ht++){const St=Le+ht;j.y=Re-ht*s.al,Z.y=Xe-(St-Te)*s.al,s.cZ(j,Z,N)&&E(I,0,g,ct,St)}}}},Y=d.points,te=Y[s.cv],J=Y[s.cw],oe=this._projectToGround(te,Y[s.cx]),ae=this._projectToGround(J,Y[s.cy]);return W(te,oe),W(J,ae),b}_projectToGround(o,d){return s.cz(s.cA(),o,d,o[2]/(o[2]-d[2]))}coveringTiles(o){let d=this.coveringZoomLevel(o);const g=d,b=this.elevation&&this.elevation.exaggeration(),T=b&&!o.isTerrainDEM,E=this.projection.name==="mercator";if(o.minzoom!==void 0&&d<o.minzoom)return[];o.maxzoom!==void 0&&d>o.maxzoom&&(d=o.maxzoom);const I=this.locationCoordinate(this.center),M=this.center.lat,N=1<<d,j=[N*I.x,N*I.y,0],Z=this.projection.name==="globe",W=!Z,Y=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,W),te=Z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=N*s.cf(1,this.center.lat),oe=this._camera.position[2]/s.cf(1,this.center.lat),ae=[N*te.x,N*te.y,oe*(W?1:J)],pe=Z||b,_e=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),me=this.isLODDisabled(!0)?d:0;let Le;if(this._elevation&&o.isTerrainDEM)Le=1e4*this._elevation.exaggeration();else if(this._elevation){const Ue=this._elevation.getMinMaxForVisibleTiles();Le=Ue?Ue.max:this._centerAltitude}else Le=this._centerAltitude;const Ce=o.isTerrainDEM?-Le:this._elevation?this._elevation.getMinElevationBelowMSL():0,Re=this.projection.isReprojectedInTileSpace?s.cC(this):1,Ae=Ue=>{const lt=new s.ae(Ue.x+25e-6,Ue.y,Ue.z),Ot=new s.ae(Ue.x,Ue.y+25e-6,Ue.z),en=Ue.toLngLat(),yn=lt.toLngLat(),Yt=Ot.toLngLat(),Ht=this.locationCoordinate(en),Ln=this.locationCoordinate(yn),In=this.locationCoordinate(Yt),pn=Math.hypot(Ln.x-Ht.x,Ln.y-Ht.y),vn=Math.hypot(In.x-Ht.x,In.y-Ht.y);return Math.sqrt(pn*vn)*Re/25e-6},Te=Ue=>{const _t=Le,lt=Ce;return{aabb:s.cF(this,N,0,0,0,Ue,lt,_t,this.projection),zoom:0,x:0,y:0,minZ:lt,maxZ:_t,wrap:Ue,fullyVisible:!1}},Fe=[];let Xe=[];const He=d,ct=o.reparseOverscaled?g:d,ht=(oe-this._centerAltitude)*J,St=Ue=>{if(!this._elevation||!Ue.tileID||!E)return;const _t=this._elevation.getMinMaxForTile(Ue.tileID),lt=Ue.aabb;_t?(lt.min[2]=_t.min,lt.max[2]=_t.max,lt.center[2]=(lt.min[2]+lt.max[2])/2):(Ue.shouldSplit=rt(Ue),Ue.shouldSplit||(lt.min[2]=lt.max[2]=lt.center[2]=this._centerAltitude))},Ut=(Ue,_t)=>{if(.707*_t<Ue)return 1;const lt=_t/Ue;return lt/(1.4144271570014144+(Math.pow(1.1,lt-1.4144271570014144+1)-1)/(1.1-1)-1)},rt=Ue=>{if(Ue.zoom<me)return!0;if(Ue.zoom===He)return!1;if(Ue.shouldSplit!=null)return Ue.shouldSplit;const _t=Ue.aabb.distanceX(ae),lt=Ue.aabb.distanceY(ae);let Ot=ht,en=1;if(Z){Ot=Ue.aabb.distanceZ(ae);const vn=Math.pow(2,Ue.zoom),er=s.a$((Ue.y+1)/vn),Lr=s.a$(Ue.y/vn),hi=Math.min(Math.max(M,er),Lr),Ni=s.d1(hi)/s.d1(M);if(en=hi===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ni/this._mercatorScaleRatio),this.zoom<=s.c_&&Ue.zoom===He-1&&Ni>=.9)return!0}else if(T&&(Ot=Ue.aabb.distanceZ(ae)*J),this.projection.isReprojectedInTileSpace&&g<=5){const vn=Math.pow(2,Ue.zoom),er=Ae(new s.ae((Ue.x+.5)/vn,(Ue.y+.5)/vn));en=er>.85?1:er}if(!E&&!Z){const vn=Math.sqrt(_t*_t+lt*lt+Ot*Ot);let er=(1<<He-Ue.zoom)*_e*en;return er*=Ut(Math.max(Ot,ht),vn),vn<er}let yn=Number.MAX_VALUE,Yt=0;const Ht=Ue.aabb.getCorners(),Ln=[];for(const vn of Ht){s.av(Ln,vn,ae),Z||(T?Ln[2]*=J:Ln[2]=ht);const er=s.bJ(Ln,this._camera.forward());er<yn&&(yn=er,Yt=Math.abs(Ln[2]))}let In=(1<<He-Ue.zoom)*_e*en;if(In*=Ut(Math.max(Yt,ht),yn),yn<In)return!0;const pn=Ue.aabb.closestPoint(j);return pn[0]===j[0]&&pn[1]===j[1]};if(this.renderWorldCopies)for(let Ue=1;Ue<=3;Ue++)Fe.push(Te(-Ue)),Fe.push(Te(Ue));for(Fe.push(Te(0));Fe.length>0;){const Ue=Fe.pop(),_t=Ue.x,lt=Ue.y;let Ot=Ue.fullyVisible;const en=()=>this.projection.name==="globe"&&(Ue.y===0||Ue.y===(1<<Ue.zoom)-1);if(!Ot){let yn=pe?Ue.aabb.intersects(Y):Ue.aabb.intersectsFlat(Y);if(yn===0&&en()){const Yt=new s.cD(Ue.zoom,_t,lt);yn=s.cE(this,N,Yt,!0).intersects(Y)}if(yn===0)continue;Ot=yn===2}if(Ue.zoom!==He&&rt(Ue))for(let yn=0;yn<4;yn++){const Yt=(_t<<1)+yn%2,Ht=(lt<<1)+(yn>>1),Ln={aabb:E?Ue.aabb.quadrant(yn):s.cF(this,N,Ue.zoom+1,Yt,Ht,Ue.wrap,Ue.minZ,Ue.maxZ,this.projection),zoom:Ue.zoom+1,x:Yt,y:Ht,wrap:Ue.wrap,fullyVisible:Ot,tileID:void 0,shouldSplit:void 0,minZ:Ue.minZ,maxZ:Ue.maxZ};T&&!Z&&(Ln.tileID=new s.aQ(Ue.zoom+1===He?ct:Ue.zoom+1,Ue.wrap,Ue.zoom+1,Yt,Ht),St(Ln)),Fe.push(Ln)}else{const yn=Ue.zoom===He?ct:Ue.zoom;if(o.minzoom&&o.minzoom>yn)continue;let Yt=0;if(!Ot){let pn=pe?Ue.aabb.intersectsPrecise(Y):Ue.aabb.intersectsPreciseFlat(Y);if(pn===0&&en()){const vn=new s.cD(Ue.zoom,_t,lt);pn=s.cE(this,N,vn,!0).intersectsPrecise(Y)}if(pn===0)continue;if(o.calculateQuadrantVisibility)if(Y.containsPoint(Ue.aabb.center))Yt=15;else for(let vn=0;vn<4;vn++)Ue.aabb.quadrant(vn).intersects(Y)!==0&&(Yt|=1<<vn)}const Ht=j[0]-(.5+_t+(Ue.wrap<<Ue.zoom))*(1<<d-Ue.zoom),Ln=j[1]-.5-lt,In=Ue.tileID?Ue.tileID:new s.aQ(yn,Ue.wrap,Ue.zoom,_t,lt);o.calculateQuadrantVisibility&&(In.visibleQuadrants=Yt),Xe.push({tileID:In,distanceSq:Ht*Ht+Ln*Ln})}}if(this.fogCullDistSq){const Ue=this.fogCullDistSq,_t=this.horizonLineFromTop();Xe=Xe.filter(lt=>{const Ot=[0,0,0,1],en=[s.al,s.al,0,1],yn=this.calculateFogTileMatrix(lt.tileID.toUnwrapped());s.aC(Ot,Ot,yn),s.aC(en,en,yn);const Yt=s.cG([],Ot,en),Ht=s.cH([],Ot,en),Ln=s.c$(Yt,Ht);if(Ln===0)return!0;let In=!1;const pn=this._elevation;if(pn&&Ln>Ue&&_t!==0){const vn=this.calculateProjMatrix(lt.tileID.toUnwrapped());let er;o.isTerrainDEM||(er=pn.getMinMaxForTile(lt.tileID)),er||(er={min:Ce,max:Le});const Lr=s.cI(this.rotation),hi=[Lr[0]*s.al,Lr[1]*s.al,er.max];s.af(hi,hi,vn),In=(1-hi[1])*this.height*.5<_t}return Ln<Ue||In})}return Xe.sort((Ue,_t)=>Ue.distanceSq-_t.distanceSq).map(Ue=>Ue.tileID)}resize(o,d){this.width=o,this.height=d,this.pixelsToGLUnits=[2/o,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log2(o)}project(o){const d=s.aA(o.lat,-s.cJ,s.cJ),g=this.projection.project(o.lng,d);return new s.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,d){let g,b;const T=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;g=(d.x-T.x)/I,b=(d.y-T.y)/I}else{const I=this.pointCoordinate(d),M=this.pointCoordinate(T);g=I.x-M.x,b=I.y-M.y}const E=this.locationCoordinate(o);this.setLocation(new s.ae(E.x-g,E.y-b))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,d){return this.projection.locationPoint(this,o,d)}locationPoint3D(o,d){return this.projection.locationPoint(this,o,d,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,d){return this.coordinateLocation(this.pointCoordinate3D(o,d))}locationCoordinate(o,d){const g=d?s.cf(d,o.lat):void 0,b=this.projection.project(o.lng,o.lat);return new s.ae(b.x,b.y,g)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,d){const g=d??this._centerAltitude,b=[o.x,o.y,0,1],T=[o.x,o.y,1,1];s.aC(b,b,this.pixelMatrixInverse),s.aC(T,T,this.pixelMatrixInverse);const E=T[3];s.cK(b,b,1/b[3]),s.cK(T,T,1/E);const I=b[2],M=T[2];return{p0:b,p1:T,t:I===M?0:(g-I)/(M-I)}}screenPointToMercatorRay(o){const d=[o.x,o.y,0,1],g=[o.x,o.y,1,1];return s.aC(d,d,this.pixelMatrixInverse),s.aC(g,g,this.pixelMatrixInverse),s.cK(d,d,1/d[3]),s.cK(g,g,1/g[3]),d[2]=s.cf(d[2],this._center.lat)*this.worldSize,g[2]=s.cf(g[2],this._center.lat)*this.worldSize,s.cK(d,d,1/this.worldSize),s.cK(g,g,1/this.worldSize),new s.ax([d[0],d[1],d[2]],s.aw([],s.av([],g,d)))}rayIntersectionCoordinate(o){const{p0:d,p1:g,t:b}=o,T=s.cf(d[2],this._center.lat),E=s.cf(g[2],this._center.lat);return new s.ae(s.ak(d[0],g[0],b)/this.worldSize,s.ak(d[1],g[1],b)/this.worldSize,s.ak(T,E,b))}pointCoordinate(o,d=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,d)}pointCoordinate3D(o,d){if(!this.elevation)return this.pointCoordinate(o,d);let g=this.projection.pointCoordinate3D(this,o.x,o.y);if(g)return new s.ae(g[0],g[1],g[2]);let b=0,T=this.horizonLineFromTop();if(o.y>T)return this.pointCoordinate(o,d);const E=.02*T,I=o.clone();for(let M=0;M<10&&T-b>E;M++){I.y=s.ak(b,T,.66);const N=this.projection.pointCoordinate3D(this,I.x,I.y);N?(T=I.y,g=N):b=I.y}return g?new s.ae(g[0],g[1],g[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=s.cL)return!this.isPointAboveHorizon(o);const d=this.pointCoordinate(o);return d.y>=0&&d.y<=1}_coordinatePoint(o,d){const g=d&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,b=[o.x*this.worldSize,o.y*this.worldSize,g+o.toAltitude(),1];return s.aC(b,b,this.pixelMatrix),b[3]>0?new s.P(b[0]/b[3],b[1]/b[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:d}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,T=this.pointLocation3D(new s.P(d,o)),E=this.pointLocation3D(new s.P(b,o)),I=this.pointLocation3D(new s.P(b,g)),M=this.pointLocation3D(new s.P(d,g));let N=Math.min(T.lng,E.lng,I.lng,M.lng),j=Math.max(T.lng,E.lng,I.lng,M.lng),Z=Math.min(T.lat,E.lat,I.lat,M.lat),W=Math.max(T.lat,E.lat,I.lat,M.lat);const Y=Math.pow(2,-this.zoom)/16*270,te=this.projection.name==="globe"?1:4,J=(oe,ae,pe,_e,me)=>{const Le=(oe+pe)/2,Ce=(ae+_e)/2,Re=new s.P(Le,Ce),{lng:Ae,lat:Te}=this.pointLocation3D(Re),Fe=Math.max(0,N-Ae,Z-Te,Ae-j,Te-W);N=Math.min(N,Ae),j=Math.max(j,Ae),Z=Math.min(Z,Te),W=Math.max(W,Te),(me<te||Fe>Y)&&(J(oe,ae,Le,Ce,me+1),J(Le,Ce,pe,_e,me+1))};if(J(d,o,b,o,1),J(b,o,b,g,1),J(b,g,d,g,1),J(d,g,d,o,1),this.projection.name==="globe"){const[oe,ae]=s.cM(this);oe?(W=90,j=180,N=-180):ae&&(Z=-90,j=180,N=-180)}return new s.aI(new s.aT(N,Z),new s.aT(j,W))}_getBoundsRectangular(o,d){const{top:g,left:b}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,I=new s.P(b,g),M=new s.P(E,g),N=new s.P(E,T),j=new s.P(b,T);let Z=this.pointCoordinate(I,o),W=this.pointCoordinate(M,o);const Y=this.pointCoordinate(N,d),te=this.pointCoordinate(j,d),J=(oe,ae)=>(ae.y-oe.y)/(ae.x-oe.x);return Z.y>1&&W.y>=0?Z=new s.ae((1-te.y)/J(te,Z)+te.x,1):Z.y<0&&W.y<=1&&(Z=new s.ae(-te.y/J(te,Z)+te.x,0)),W.y>1&&Z.y>=0?W=new s.ae((1-Y.y)/J(Y,W)+Y.x,1):W.y<0&&Z.y<=1&&(W=new s.ae(-Y.y/J(Y,W)+Y.x,0)),new s.aI().extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(te)).extend(this.coordinateLocation(Y))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=o.visibleDemTiles.reduce((g,b)=>{if(b.dem){const T=b.dem.tree;g.min=Math.min(g.min,T.minimums[0]),g.max=Math.max(g.max,T.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*o.exaggeration(),d.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-d*(1-this._horizonShift);return o?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-s.cJ,this.maxLat=s.cJ,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aF(this.minLng)*this.tileSize,this.worldMaxX=s.aF(this.maxLng)*this.tileSize,this.worldMinY=s.aJ(this.maxLat)*this.tileSize,this.worldMaxY=s.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,d){return this.projection.createTileMatrix(this,d,o)}calculateDistanceTileData(o){const d=o.key,g=this._distanceTileDataCache;if(g[d])return g[d];const b=o.canonical,T=1/this.height,E=this.cameraWorldSize,I=E/this.zoomScale(b.z),M=(b.x+Math.pow(2,b.z)*o.wrap)*I,N=b.y*I,j=this.point;j.x*=E/this.worldSize,j.y*=E/this.worldSize;const Z=this.angle,W=Math.sin(-Z),Y=-Math.cos(-Z);return g[d]={bearing:[W,Y],center:[(j.x-M)*T,(j.y-N)*T],scale:I/s.al*T},g[d]}calculateFogTileMatrix(o){const d=o.key,g=this._fogTileMatrixCache;if(g[d])return g[d];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return s.aB(b,this.worldToFogMatrix,b),g[d]=new Float32Array(b),g[d]}calculateProjMatrix(o,d=!1,g=!1){const b=o.key;let T;if(T=g?this._expandedProjMatrixCache:d?this._alignedProjMatrixCache:this._projMatrixCache,T[b])return T[b];const E=this.calculatePosMatrix(o,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:d?this.alignedProjMatrix:this.projMatrix,s.aB(E,I,E),T[b]=new Float32Array(E),T[b]}calculatePixelsToTileUnitsMatrix(o){const d=o.tileID.key,g=this._pixelsToTileUnitsCache;if(g[d])return g[d];const b=s.cN(o,this);return g[d]=b,g[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,d=s.bq([],[o,o,o]);return s.aB(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const d=s.cf(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(d),b=this._camera.forward(),T=s.cf(1,this._center.lat);g[2]/=T,b[2]/=T,s.aw(b,b);const E=o.raycast(g,b,o.exaggeration());if(E){const I=s.bH([],g,b,E),M=new s.ae(I[0],I[1],s.cf(I[2],s.a$(I[1]))),N=(M.z+s.ag([M.x-g[0],M.y-g[1],M.z-g[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const d=this._elevation,g=s.cf(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(g),T=d.getAtPointOrZero(new s.ae(...b)),E=this.pixelsPerMeter/this.worldSize*T,I=this._minimumHeightOverTerrain(),M=b[2]-E;if(M<=I)if(M<0||o){const N=this.locationCoordinate(this._center,this._centerAltitude),j=[b[0],b[1],N.z-b[2]],Z=s.ag(j);j[2]-=(I-M)/this._pixelsPerMercatorPixel;const W=s.ag(j);if(W===0)return;s.c5(j,j,Z/W*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],N.z*this._pixelsPerMercatorPixel-j[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const W=this.center;return W.lat=s.aA(W.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(W.lng=s.aA(W.lng,this.minLng,this.maxLng)),this.center=W,void(this._constraining=!1)}const d=this._unmodified,{x:g,y:b}=this.point;let T=0,E=g,I=b;const M=this.width/2,N=this.height/2,j=this.worldMinY*this.scale,Z=this.worldMaxY*this.scale;if(b-N<j&&(I=j+N),b+N>Z&&(I=Z-N),Z-j<this.height&&(T=Math.max(T,this.height/(Z-j)),I=(Z+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const W=this.worldMinX*this.scale,Y=this.worldMaxX*this.scale,te=this.worldSize/2-(W+Y)/2;E=(g+te+this.worldSize)%this.worldSize-te,E-M<W&&(E=W+M),E+M>Y&&(E=Y-M),Y-W<this.width&&(T=Math.max(T,this.width/(Y-W)),E=(Y+W)/2)}E===g&&I===b||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(E,I))),T&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,d=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.cf(1,this.center.lat)/s.cf(1,s.d2));const b=s.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const T=this.projection.zAxisUnit==="meters"?g:1,E=this._camera.getWorldToCamera(this.worldSize,T);let I;const M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-o.x/this.width,M[9]=2*o.y/this.height,this.isOrthographic){let Te=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Fe=Te*this.aspect,Xe=-Fe,He=-Te;Fe-=o.x,Xe-=o.x,Te+=o.y,He+=o.y,I=this._camera.getCameraToClipOrthographic(Xe,Fe,He,Te,this._nearZ,this._farZ),((ct,ht,St,Ut)=>{for(let rt=0;rt<16;rt++)ct[rt]=s.ak(ht[rt],St[rt],Ut)})(I,I,M,s.d0(this.pitch>=dc?1:this.pitch/dc))}else I=M;const N=s.cP([],M,E);let j=s.cP([],I,E);if(this.projection.isReprojectedInTileSpace){const Te=this.locationCoordinate(this.center),Fe=s.bA([]);s.br(Fe,Fe,[Te.x*this.worldSize,Te.y*this.worldSize,0]),s.aB(Fe,Fe,s.cQ(this)),s.br(Fe,Fe,[-Te.x*this.worldSize,-Te.y*this.worldSize,0]),s.aB(j,j,Fe),s.aB(N,N,Fe),this.inverseAdjustmentMatrix=s.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cS([],j,[this.worldSize,this.worldSize,this.worldSize/T,1]),this.projMatrix=j,this.invProjMatrix=s.bl(new Float64Array(16),this.projMatrix),d){const Te=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Te[8]=2*-o.x/this.width,Te[9]=2*o.y/this.height,this.expandedFarZProjMatrix=s.cP([],Te,E)}else this.expandedFarZProjMatrix=this.projMatrix;const Z=s.bl([],I);this.frustumCorners=s.cT.fromInvProjectionMatrix(Z,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!d);const W=new Float32Array(16);s.bA(W),s.cS(W,W,[1,-1,1]),s.cU(W,W,this._pitch),s.bB(W,W,this.angle);const Y=s.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bz(Y);const te=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Y[8]=2*-o.x/this.width,Y[9]=2*(o.y+te)/this.height,this.skyboxMatrix=s.aB(W,Y,W);const J=this.point,oe=J.x,ae=J.y,pe=this.width%2/2,_e=this.height%2/2,me=Math.cos(this.angle),Le=Math.sin(this.angle),Ce=oe-Math.round(oe)+me*pe+Le*_e,Re=ae-Math.round(ae)+me*_e+Le*pe,Ae=new Float64Array(j);if(s.br(Ae,Ae,[Ce>.5?Ce-1:Ce,Re>.5?Re-1:Re,0]),this.alignedProjMatrix=Ae,j=s.bC(),s.cS(j,j,[this.width/2,-this.height/2,1]),s.br(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=s.bC(),s.cS(j,j,[1,-1,1]),s.br(j,j,[-1,-1,0]),s.cS(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=s.aB(new Float64Array(16),this.labelPlaneMatrix,N),this._calcFogMatrices(),this._distanceTileDataCache={},j=s.bl(new Float64Array(16),this.pixelMatrix),!j)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=j,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cV(this);const Te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.af(Te,Te,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=j;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,g=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,T=[o,o,d];s.c5(T,T,b),s.c5(g,g,-1),s.cW(g,g,T);const E=s.bC();s.br(E,E,g),s.cS(E,E,T),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,d,b)}_computeCameraPosition(o){const d=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),b=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-o/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-g[0]*T,b.y/this.worldSize-g[1]*T,o/this.worldSize*this._centerAltitude-g[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],b=o[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(T=Math.min((d-g)/b,1)),this._camera.position=s.bH([],this._camera.position,o,T),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,d=this._camera.forward(),{pitch:g,bearing:b}=this._camera.getPitchBearing(),T=s.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.an(this._maxPitch)),I=Math.max((o[2]-T)/Math.cos(g),E),M=this._zoomFromMercatorZ(I);s.bH(o,o,d,I),this._pitch=s.aA(g,s.an(this.minPitch),s.an(this.maxPitch)),this.angle=s.bT(b,-Math.PI,Math.PI),this._setZoom(s.aA(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ae(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,o)*this.tileSize))}zoomFromMercatorZAdjusted(o){let d=0,g=s.cL,b=0,T=1/0;for(;g-d>1e-6&&g>d;){const E=d+.5*(g-d),I=this.tileSize*Math.pow(2,E),M=this.getCameraToCenterDistance(this.projection,E,I),N=this.scaleZoom(M/(Math.max(0,o)*this.tileSize)),j=Math.abs(E-N);j<T&&(T=j,b=E),E<N?d=E:g=E}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,d){const g=Math.min(o.x,d.x),b=Math.max(o.x,d.x),T=Math.min(o.y,d.y),E=Math.max(o.y,d.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new s.P(g,T),new s.P(b,E),new s.P(g,E),new s.P(b,T)],M=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(const j of I){const Z=this.pointRayIntersection(j);if(Z.t<0)return!0;const W=this.rayIntersectionCoordinate(Z);if(W.x<M||W.y<0||W.x>N||W.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(o,d){const g=s.ag(s.av([],this._camera.position,o)),b=this._zoomFromMercatorZ(g)+d;return g-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([d,g,b],T){const E=[d,g,b,1];s.aC(E,E,T);const I=E[3]=Math.max(E[3],1e-6);return E[0]/=I,E[1]/=I,E[2]/=I,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,o))}}getCameraToCenterDistance(o,d=this.zoom,g=this.worldSize){const b=s.cO(o,d,this.width,this.height,1024),T=o.pixelSpaceConversion(this.center.lat,g,b);let E=.5/Math.tan(.5*this._fov)*this.height*T;return this.isOrthographic&&(E=s.ak(1,E,s.d0(this.pitch>=dc?1:this.pitch/dc))),E}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.aB(o,o,this.globeMatrix),o}getFrustum(o){return s.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}const yh=(m,o)=>{if(o>0&&m.terrain&&s.w("Cutoff is currently disabled on terrain"),o<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const d=m.transform,g=Math.max(Math.abs(d._zoom-(m.minCutoffZoom-1)),1),b=d.isLODDisabled(!1)?s.ah(60,45,d.pitch):s.ah(30,15,d.pitch),T=d._farZ-d._nearZ,E=o*d.height,I=((1-(M=b))*d.cameraToCenterDistance+M*(d._farZ+E))*g;var M;return{shouldRenderCutoff:b<1,uniformValues:{u_cutoff_params:[d._nearZ,d._farZ,(I-d._nearZ)/T,(I-E-d._nearZ)/T]}}},Du=2048;class z0{constructor(o,d){this.aabb=o,this.lastCascade=d}}class Lk{add(o,d){const g=this.receivers[o.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],d.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],d.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],d.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],d.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],d.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],d.max[2])):this.receivers[o.key]=new z0(d,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,d,g){const b=s.d9.fromPoints(o.points);let T=0;for(const E in this.receivers){const I=this.receivers[E];if(!I||!b.intersectsAabb(I.aabb))continue;I.aabb.min=b.closestPoint(I.aabb.min),I.aabb.max=b.closestPoint(I.aabb.max);const M=I.aabb.getCorners();for(let N=0;N<g.length;N++){let j=!0;for(const Z of M){const W=[Z[0]*d,Z[1]*d,Z[2]];if(s.af(W,W,g[N].matrix),W[0]<-1||W[0]>1||W[1]<-1||W[1]>1){j=!1;break}}if(I.lastCascade=N,T=Math.max(T,N),j)break}}return T+1}}class Rp{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Lk,this._depthMode=new zn(o.context.gl.LEQUAL,zn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,d){const g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!d||!d.properties)return;const b=d.properties.get("shadow-intensity");if(!d.shadowsEnabled()||b<=0||(this._shadowLayerCount=g.style.order.reduce((te,J)=>{const oe=g.style._mergedLayers[J];return te+(oe.hasShadowPass()&&!oe.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const T=g.context,E=Du,I=Du;if(this._cascades.length===0||Du!==this._cascades[0].texture.size[0]){this._cascades=[];for(let te=0;te<2;++te){const J=g._shadowMapDebug,oe=T.gl,ae=T.createFramebuffer(E,I,J?1:0,"texture"),pe=new s.T(T,{width:E,height:I,data:null},oe.DEPTH_COMPONENT16);if(ae.depthAttachment.set(pe.texture),J){const _e=new s.T(T,{width:E,height:I,data:null},oe.RGBA8);ae.colorAttachment0.set(_e.texture)}this._cascades.push({framebuffer:ae,texture:pe,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cB,scale:0})}}this.shadowDirection=B0(d);let M=0;if(o.elevation){const te=o.elevation,J=[1e4,-1e4];te.visibleDemTiles.filter(oe=>oe.dem).forEach(oe=>{const ae=oe.dem.tree;J[0]=Math.min(J[0],ae.minimums[0]),J[1]=Math.max(J[1],ae.maximums[0])}),J[0]!==1e4&&(M=(J[1]-J[0])*te.exaggeration())}const N=1.5*o.cameraToCenterDistance,j=3*N,Z=new Float64Array(16);for(let te=0;te<this._cascades.length;++te){const J=this._cascades[te];let oe=o.height/50,ae=1;te===0?ae=N:(oe=N,ae=j);const[pe,_e]=vh(o,this.shadowDirection,oe,ae,Du,M);J.scale=o.scale,J.matrix=pe,J.boundingSphereRadius=_e,s.bl(Z,J.matrix),J.frustum=s.cB.fromInvProjectionMatrix(Z,1,0,!0),J.far=ae}const W=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[W].far,this._cascades[W].far],this._uniformValues.u_shadow_intensity=b,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Du,this._uniformValues.u_shadowmap_0=wo.ShadowMap0,this._uniformValues.u_shadowmap_1=wo.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Y=g.transform.elevation;for(const te of this._groundShadowTiles){let J={min:0,max:0};if(Y){const oe=Y.getMinMaxForTile(te);oe&&(J=oe)}this.addShadowReceiver(te.toUnwrapped(),J.min,J.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,d){if(!this.enabled)return;const g=this.painter,b=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),b.viewport.set([0,0,Du,Du]);for(let T=0;T<this._numCascadesToRender;++T){g.currentShadowCascade=T,b.bindFramebuffer.set(this._cascades[T].framebuffer.framebuffer),b.clear({color:s.ao.white,depth:1});for(const E of o.order){const I=o._mergedLayers[E];if(!I.hasShadowPass()||I.isHidden(g.transform.zoom))continue;const M=o.getLayerSourceCache(I),N=M?d[M.id]:void 0;(I.type==="model"||N&&N.length)&&g.renderLayer(g,M,I,N)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const o=this.painter,d=o.style,g=o.context,b=g.gl,T=d.directionalLight,E=d.ambientLight;if(!T||!E)return;const I=[],M=yh(o,o.longestCutoffRange);M.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const N=Td(d,T,E),j=new zn(b.LEQUAL,zn.ReadOnly,o.depthRangeFor3D),Z=new kr({func:b.EQUAL,mask:255},0,255,b.KEEP,b.KEEP,b.KEEP);for(const W of this._groundShadowTiles){const Y=W.toUnwrapped(),te=o.isTileAffectedByFog(W),J=o.getOrCreateProgram("groundShadow",{defines:I,overrideFog:te});this.setupShadows(Y,J),o.uploadCommonUniforms(g,J,Y,null,M);const oe={u_matrix:o.transform.calculateProjMatrix(Y),u_ground_shadow_factor:N};J.draw(o,b.TRIANGLES,j,Z,jr.multiply,Cr.disabled,oe,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?jr.unblended:jr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){const d=this.painter.transform,g=d.calculatePosMatrix(o,d.worldSize);return s.aB(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(o){const d=s.bz(o);return s.aB(d,this._cascades[this.painter.currentShadowCascade].matrix,o),d}setupShadows(o,d,g){if(!this.enabled)return;const b=this.painter.transform,T=this.painter.context,E=T.gl,I=this._uniformValues,M=new Float64Array(16),N=b.calculatePosMatrix(o,b.worldSize);for(let j=0;j<this._cascades.length;j++)s.aB(M,this._cascades[j].matrix,N),I[j===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),T.activeTexture.set(E.TEXTURE0+wo.ShadowMap0+j),this._cascades[j].texture.bindExtraParam(E.LINEAR,E.LINEAR,E.CLAMP_TO_EDGE,E.CLAMP_TO_EDGE,E.GREATER);if(this.useNormalOffset=!!g,this.useNormalOffset){const j=s.d7(o.canonical),Z=2/b.tileSize*s.al/Du,W=Z*this._cascades[0].boundingSphereRadius,Y=Z*this._cascades[this._cascades.length-1].boundingSphereRadius,te=(g==="vector-tile"?1:3)*function(J,oe,ae,pe,_e){const me=s.aA((J-22)/-22,0,1);return .125*(1-me)+4*me}(b.zoom);I.u_shadow_normal_offset=[j,W*te,Y*te],I.u_shadow_bias=[1e-4,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(T,I)}setupShadowsFromMatrix(o,d,g=!1){if(!this.enabled)return;const b=this.painter.context,T=b.gl,E=this._uniformValues,I=new Float64Array(16);for(let M=0;M<2;M++)s.aB(I,this._cascades[M].matrix,o),E[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),b.activeTexture.set(T.TEXTURE0+wo.ShadowMap0+M),this._cascades[M].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);this.useNormalOffset=g,g?(E.u_shadow_normal_offset=[1,3,3],E.u_shadow_bias=[6e-5,.0012,.012]):E.u_shadow_bias=[36e-5,.0012,.012],d.setShadowUniformValues(b,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,d,g,b){if(b[2]>=0)return{};const T=function(M,N,j){const Z=j/(1<<M.canonical.z);return new s.d9([M.canonical.x*Z+M.wrap*j,M.canonical.y*Z+M.wrap*j,0],[(M.canonical.x+1)*Z+M.wrap*j,(M.canonical.y+1)*Z+M.wrap*j,N])}(o,d,g).getCorners(),E=d/-b[2];b[0]<0?(s.d8(T[0],T[0],[b[0]*E,0,0]),s.d8(T[3],T[3],[b[0]*E,0,0])):b[0]>0&&(s.d8(T[1],T[1],[b[0]*E,0,0]),s.d8(T[2],T[2],[b[0]*E,0,0])),b[1]<0?(s.d8(T[0],T[0],[0,b[1]*E,0]),s.d8(T[1],T[1],[0,b[1]*E,0])):b[1]>0&&(s.d8(T[2],T[2],[0,b[1]*E,0]),s.d8(T[3],T[3],[0,b[1]*E,0]));const I={};return I.vertices=T,I.planes=[F0(T[1],T[0],T[4]),F0(T[2],T[1],T[5]),F0(T[3],T[2],T[6]),F0(T[0],T[3],T[7])],I}addShadowReceiver(o,d,g){this._receivers.add(o,s.d9.fromTileIdAndHeight(o,d,g))}getMaxCascadeForTile(o){const d=this._receivers.get(o);return d&&d.lastCascade?d.lastCascade:0}}function F0(m,o,d){const g=s.av([],d,o),b=s.av([],m,o),T=s.bI([],g,b),E=s.ag(T);return E===0?[0,0,1,0]:(s.c5(T,T,1/E),[T[0],T[1],T[2],-s.bJ(T,o)])}function B0(m){const o=m.properties.get("direction"),d=s.d4(o.x,o.y,o.z);d[2]=s.aA(d[2],0,75);const g=s.d6([d[0],d[1],d[2]]);return s.d5(g.x,g.y,g.z)}function Td(m,o,d){const g=o.properties.get("color-use-theme")==="none",b=o.properties.get("color"),T=o.properties.get("intensity"),E=o.properties.get("direction"),I=[E.x,E.y,E.z],M=d.properties.get("color-use-theme")==="none",N=d.properties.get("color"),j=d.properties.get("intensity"),Z=Math.max(s.bJ([0,0,1],I),0),W=[0,0,0];s.c5(W,N.toPremultipliedRenderColor(M?null:m.getLut(o.scope)).toArray01Linear().slice(0,3),j);const Y=[0,0,0];return s.c5(Y,b.toPremultipliedRenderColor(g?null:m.getLut(d.scope)).toArray01Linear().slice(0,3),Z*T),s.db([W[0]>0?W[0]/(W[0]+Y[0]):0,W[1]>0?W[1]/(W[1]+Y[1]):0,W[2]>0?W[2]/(W[2]+Y[2]):0])}function vh(m,o,d,g,b,T){const E=m.zoom,I=m.scale,M=m.worldSize,N=1/M,j=m.aspect,Z=Math.sqrt(1+j*j)*Math.tan(.5*m.fovX),W=Z*Z,Y=g-d,te=g+d;let J,oe;W>Y/te?(J=g,oe=g*Z):(J=.5*te*(1+W),oe=.5*Math.sqrt(Y*Y+2*(g*g+d*d)*W+te*te*W*W));const ae=m.projection.pixelsPerMeter(m.center.lat,M),pe=m._camera.getCameraToWorldMercator(),_e=[0,0,-J*N];s.af(_e,_e,pe);let me=oe*N;const Le=m._edgeInsets;if(!(Le.left===0&&Le.top===0&&Le.right===0&&Le.bottom===0||Le.left===Le.right&&Le.top===Le.bottom)){const Ot=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?ae:1),en=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,d,g);en[8]=2*-m.centerOffset.x/m.width,en[9]=2*m.centerOffset.y/m.height;const yn=new Float64Array(16);s.cP(yn,en,Ot);const Yt=new Float64Array(16);s.bl(Yt,yn);const Ht=s.cB.fromInvProjectionMatrix(Yt,M,E,!0);for(const Ln of Ht.points){const In=((Ce=Ln)[0]/=I,Ce[1]/=I,Ce[2]=s.cf(Ce[2],m._center.lat),Ce);me=Math.max(me,s.c6(s.da([],_e,In)))}}var Ce;me*=b/(b-1);const Re=Math.acos(o[2]),Ae=Math.atan2(-o[0],-o[1]),Te=new X_;Te.position=_e,Te.setPitchBearing(Re,Ae);const Fe=Te.getWorldToCamera(M,ae),Xe=me*M,He=Math.min(m._mercatorZfromZoom(17)*M*-2,-2*Xe),ct=Te.getCameraToClipOrthographic(-Xe,Xe,-Xe,Xe,He,(Xe+T*ae)/o[2]),ht=new Float64Array(16);s.aB(ht,ct,Fe);const St=s.d5(Math.floor(1e6*_e[0])/1e6*M,Math.floor(1e6*_e[1])/1e6*M,0),Ut=.5*b,rt=[0,0,0];s.af(rt,St,ht),s.c5(rt,rt,Ut);const Ue=[Math.floor(rt[0]),Math.floor(rt[1]),Math.floor(rt[2])],_t=[0,0,0];s.av(_t,rt,Ue),s.c5(_t,_t,-1/Ut);const lt=new Float64Array(16);return s.bA(lt),s.br(lt,lt,_t),s.aB(ht,lt,ht),[ht,Xe]}class Dk extends s.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(o,d){return s.dc(this.requestManager.transformRequest(d,s.R.Model).url).then(g=>{if(!g)return;const b=s.dd(g),T=new s.de(o,d,void 0,void 0,b);return T.computeBoundsAndApplyParent(),T}).catch(g=>{if(g&&g.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${o} from ${d}: ${g.message}`)))})}load(o,d,g={forceReload:!1}){this.models[d]||(this.models[d]={});const b=Object.keys(o),T=[],E=[];for(const I of b){const M=o[I];this.hasURLBeenRequested(M)&&!g.forceReload||(this.modelByURL[M]={modelId:I,scope:d},T.push(this.loadModel(I,M)),E.push(I)),this.models[d][I]||(this.models[d][I]={model:null,numReferences:1})}this.numModelsLoading[d]=(this.numModelsLoading[d]||0)+E.length,Promise.allSettled(T).then(I=>{for(let M=0;M<I.length;M++){const{status:N}=I[M];if(N==="rejected")continue;const{value:j}=I[M];this.models[d][E[M]]||(this.models[d][E[M]]={model:null,numReferences:1}),this.models[d][E[M]].model=j}this.numModelsLoading[d]-=E.length,this.fire(new s.z("data",{dataType:"style"}))}).catch(I=>{this.fire(new s.y(new Error(`Could not load models: ${I.message}`)))})}isLoaded(){for(const o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,d,g={exactIdMatch:!1}){return!!(g.exactIdMatch?this.getModel(o,d):this.getModelByURL(this.modelUris[d][o]))}getModel(o,d){return this.models[d]||(this.models[d]={}),this.models[d][o]?this.models[d][o].model:void 0}getModelByURL(o){if(!o)return null;const d=this.modelByURL[o];return d?this.models[d.scope][d.modelId].model:null}hasModelBeenAdded(o,d){return this.models[d]&&this.models[d][o]!==void 0}getModelURIs(o){return this.modelUris[o]||{}}addModel(o,d,g){this.models[g]||(this.models[g]={}),this.modelUris[g]||(this.modelUris[g]={});const b=this.requestManager.normalizeModelURL(d);if((this.hasModel(o,g,{exactIdMatch:!0})||this.hasModelBeenAdded(o,g))&&this.modelUris[g][o]===b)this.models[g][o].numReferences++;else if(this.hasURLBeenRequested(b)){const{scope:T,modelId:E}=this.modelByURL[b];this.models[T][E].numReferences++}else this.modelUris[g][o]=b,this.load({[o]:this.modelUris[g][o]},g)}addModelURLs(o,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const g=this.modelUris[d];for(const b in o)g[b]=this.requestManager.normalizeModelURL(o[b])}reloadModels(o){this.load(this.modelUris[o],o,{forceReload:!0})}addModelsFromBucket(o,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const g={};for(const b of o)this.hasModel(b,d,{exactIdMatch:!0})||this.hasURLBeenRequested(b)?this.models[d][b].numReferences++:this.modelUris[d][b]&&!this.hasURLBeenRequested(b)?g[b]=this.modelUris[d][b]:!this.hasURLBeenRequested(b)&&s.df(b,!1)&&(this.modelUris[d][b]=this.requestManager.normalizeModelURL(b),g[b]=this.modelUris[d][b]);this.load(g,d)}hasURLBeenRequested(o){return this.modelByURL[o]!==void 0}removeModel(o,d,g=!1,b=!1){if(this.models[d]&&this.models[d][o]&&(this.models[d][o].numReferences--,this.models[d][o].numReferences===0||b)){const T=this.modelUris[d][o];g||delete this.modelUris[d][o],delete this.modelByURL[T];const E=this.models[d][o].model;if(!E)return;delete this.models[d][o],E.destroy()}}destroy(){for(const o of Object.keys(this.models))for(const d of Object.keys(this.models[o])){const g=this.models[o][d].model;delete this.models[o][d],g&&g.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,d){this.models[d]||(this.models[d]={});for(const g in this.models[d])this.models[d][g].model&&this.models[d][g].model.upload(o.context)}}const Rx=s.a6.colorTheme,Nk=new s.a9({data:new s.aa(Rx.data)});function iE(m){if(!m.metadata||!m.metadata.content_area)return;const o=s.o.devicePixelRatio,{left:d,top:g,width:b,height:T}=m.metadata.content_area,E=d*o,I=g*o;return[E,I,E+b*o,I+T*o]}function sE(m){if(m)return m.map(([o,d])=>[o*s.o.devicePixelRatio,d*s.o.devicePixelRatio])}class Mx{constructor(o,d,g){this.id=o,this.scope=d,this.sourceCache=g,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(o){this.missingRequests.has(o.name)||this.pendingRequests.has(o.name)||this.pendingRequests.add(o.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const o=new Map;if(!this.sourceCache.loaded())return o;const d=this.sourceCache.getVisibleCoordinates();if(d.length===0)return o;const g=this.sourceCache.getSource();if(!(g instanceof ol))return o;const b=d.map(E=>this.sourceCache.getTile(E)),T=g.getImages(b,Array.from(this.pendingRequests));for(const[E,I]of T)o.set(s.I.from({name:E,iconsetId:this.id}),I),this.pendingRequests.delete(E);for(const E of this.pendingRequests)this.missingRequests.add(E);return this.pendingRequests.clear(),o}}const xh=(m,o)=>ye(m,o&&o.filter(d=>d.identifier!=="source.canvas")),aE=s.aH(Ii,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),oE=s.aH(Ii,["setCenter","setZoom","setBearing","setPitch"]),K_=new Set(["background","sky","slot","custom"]),bh={version:8,layers:[],sources:{}},j0={duration:300,delay:0};class Nu extends s.E{constructor(o,d={}){super(),this.map=o,this.scope=d.scope||"",this.globalId=null,this.fragments=[],this.importDepth=d.importDepth||0,this.importsCache=d.importsCache||new Map,this.resolvedImports=d.resolvedImports||new Set,this.transition=Object.assign({},j0),this._buildingIndex=new Pk(this),this.crossTileSymbolIndex=new cc,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=d.styleChanges||new Vn,this._hasDataDrivenEmissive=!1,this.dispatcher=d.dispatcher?d.dispatcher:new s.D(s.dh(),this),d.imageManager?this.imageManager=d.imageManager:(this.imageManager=new ws(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=d.glyphManager?d.glyphManager:new s.di(o._requestManager,d.localFontFamily?s.dj.all:d.localIdeographFontFamily?s.dj.ideographs:s.dj.none,d.localFontFamily||d.localIdeographFontFamily),d.modelManager?this.modelManager=d.modelManager:(this.modelManager=new Dk(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=d.configOptions?d.configOptions:new Map,this._configDependentLayers=d.configDependentLayers?d.configDependentLayers:new Set,this._indoorDependentLayers=d.indoorDependentLayers?d.indoorDependentLayers:new Set,this._config=d.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:d.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=d.initialConfig,this.dispatcher.broadcast("setReferrer",s.dk());const g=this;this._rtlTextPluginCallback=Nu.registerForPluginStateChange(b=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(T,E)=>{if(s.dl(T),E&&E.every(I=>I))for(const I in g._sourceCaches){const M=g._sourceCaches[I],N=M.getSource().type;N!=="vector"&&N!=="geojson"||M.reload()}})}),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const T=this.getOwnSource(b.sourceId);if(T&&T.vectorLayerIds)for(const E in this._layers){const I=this._layers[E];I.source===T.id&&this._validateLayer(I)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(s.h(o))return o;const d=s.dm(o);if(!d.startsWith("http"))try{return new URL(d,location.href).toString()}catch{return d}return d}return`json://${s.dn(JSON.stringify(o))}`}_diffStyle(o,d,g){this.globalId=this._getGlobalId(o);const b=(T,E)=>{try{E(null,this.setState(T,g))}catch(I){E(I,!1)}};if(typeof o=="string"){const T=this.map._requestManager.normalizeStyleURL(o),E=this.map._requestManager.transformRequest(T,s.R.Style);s.m(E,(I,M)=>{I?this.fire(new s.y(I)):M&&b(M,d)})}else typeof o=="object"&&b(o,d)}loadURL(o,d={}){this.fire(new s.z("dataloading",{dataType:"style"}));const g=typeof d.validate=="boolean"?d.validate:!s.h(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,d.accessToken),this.resolvedImports.add(o);const b=this.importsCache.get(o);if(b)return this._load(b,g);const T=this.map._requestManager.transformRequest(o,s.R.Style);this._request=s.m(T,(E,I)=>{if(this._request=null,E)this.fire(new s.y(E));else if(I)return this.importsCache.set(o,I),this._load(I,g)})}loadJSON(o,d={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=s.o.frame(()=>{this._request=null,this._load(o,d.validate!==!1)})}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(bh,!1)}_loadImports(o,d,g){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const b=[];for(const T of o){const E=this._createFragmentStyle(T),I=new Promise(j=>{E.once("style.import.load",j),E.once("error",j)}).then(()=>this.mergeAll());if(b.push(I),this.resolvedImports.has(T.url)){E.loadEmpty();continue}const M=T.data||this.importsCache.get(T.url);M?(E.loadJSON(M,{validate:d}),this._isInternalStyle(M)&&(E.globalId=null)):T.url?E.loadURL(T.url,{validate:d}):E.loadEmpty();const N={style:E,id:T.id,config:T.config};if(g){const j=this.fragments.findIndex(({id:Z})=>Z===g);this.fragments=this.fragments.slice(0,j).concat(N).concat(this.fragments.slice(j))}else this.fragments.push(N)}return Promise.allSettled(b)}getImportGlobalIds(o=this,d=new Set){for(const g of o.fragments)g.style.globalId&&d.add(g.style.globalId),this.getImportGlobalIds(g.style,d);return[...d.values()]}_createFragmentStyle(o){const d=this.scope?s.B(o.id,this.scope):o.id;let g;const b=this._initialConfig&&this._initialConfig[d];(o.config||b)&&(g=Object.assign({},o.config,b));const T=new Nu(this.map,{scope:d,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return T.setEventedParent(this.map,{style:T}),T}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,d){if(this._isInternalStyle(o)){const T=Object.assign({},bh,{imports:[{id:"basemap",data:o,url:""}]},o.center?{center:o.center}:{},o.bearing?{bearing:o.bearing}:{},o.pitch?{pitch:o.pitch}:{},o.zoom?{zoom:o.zoom}:{},o.light?{light:o.light}:{});return this._importedAsBasemap=!0,void this._load(T,d)}if(this.updateConfig(this._config,o.schema),d&&xh(this,rn(o)))return;this._loaded=!0,this.stylesheet=s.dp(o);const g=()=>{for(const M in o.sources)this.addSource(M,o.sources[M],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(const M in o.iconsets)this.addIconset(M,o.iconsets[M]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&o.glyphs&&this.glyphManager.setURL(o.glyphs);const T=k0(this.stylesheet.layers);if(this._order=T.map(M=>M.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const M=this.stylesheet.lights[0];this.light=new je(M.properties,M.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new je(this.stylesheet.light)),this._layers={};for(const M of T){const N=s.du(M,this.scope,this._styleColorTheme.lut,this.options);N.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(N.fqid),N.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(N.fqid),this._hasAppearances=this._hasAppearances||N.getAppearances().length!==0,N.setEventedParent(this,{layer:{id:N.id}}),this._layers[N.id]=N;const j=this.getOwnLayerSourceCache(N),Z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();j&&N.canCastShadows()&&Z&&(j.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const E=this.stylesheet.terrain;E&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(E,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const I=this.isRootStyle();o.imports?this._loadImports(o.imports,d).then(()=>{this._reloadImports(),this.fire(new s.z(I?"style.load":"style.import.load"))}).catch(M=>{this.fire(new s.y(new Error("Failed to load imports",M))),this.fire(new s.z(I?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.z(I?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const b=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(b){const T=this._evaluateColorThemeData(b);this._loadColorTheme(T).then(()=>{g()}).catch(E=>{s.w(`Couldn't load color theme from the stylesheet: ${E}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(o=>o.style.hasAppearances())}mergeAll(){let o,d,g,b,T,E,I,M,N,j;const Z={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(W=>{if(W.stylesheet){if(W.light!=null&&(o=W.light),W.stylesheet.lights)for(const Y of W.stylesheet.lights)Y.type==="ambient"&&W.ambientLight!=null&&(d=W.ambientLight),Y.type==="directional"&&W.directionalLight!=null&&(g=W.directionalLight);b=this._prioritizeTerrain(b,W.terrain,W.stylesheet.terrain),W.stylesheet.fog&&W.fog!=null&&(T=W.fog),W.stylesheet.snow&&W.snow!=null&&(E=W.snow),W.stylesheet.rain&&W.rain!=null&&(I=W.rain),W.stylesheet.camera!=null&&(j=W.stylesheet.camera),W.stylesheet.projection!=null&&(M=W.stylesheet.projection),W.stylesheet.transition!=null&&(N=W.stylesheet.transition),Z[W.scope]=W._styleColorTheme}}),this.light=o,this.ambientLight=d,this.directionalLight=g,this.fog=T,this.snow=E,this.rain=I,this._styleColorThemeForScope=Z,b===null?delete this.terrain:this.terrain=b,this.camera=j||{"camera-projection":"perspective"},this.projection=M||{name:"mercator"},this.transition=Object.assign({},j0,N),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(o){const d=g=>{for(const b of g.fragments)d(b.style);o(g)};d(this)}_prioritizeTerrain(o,d,g){const b=o&&o.drapeRenderMode===0;return g===null?d&&d.drapeRenderMode===0?d:b?o:null:d!=null&&(!o||b||d&&d.drapeRenderMode===1)?d:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(d=>{o=this._prioritizeTerrain(o,d.terrain,d.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(d=>{d.stylesheet.projection!=null&&(o=d.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){const o={},d={},g={};this.forEachFragmentStyle(b=>{for(const T in b._sourceCaches){const E=s.B(T,b.scope);o[E]=b._sourceCaches[T]}for(const T in b._otherSourceCaches){const E=s.B(T,b.scope);d[E]=b._otherSourceCaches[T]}for(const T in b._symbolSourceCaches){const E=s.B(T,b.scope);g[E]=b._symbolSourceCaches[T]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=d,this._mergedSymbolSourceCaches=g}mergeIndoor(){this.forEachFragmentStyle(o=>{if(o.stylesheet&&o.stylesheet.indoor)for(const d of Object.values(o.stylesheet.indoor)){const g=d,b=s.B(g.sourceId,o.scope);this._mergedIndoor[b]=new Set(g.sourceLayers||[])}})}mergeLayers(){const o={},d=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(E=>{for(const I of E._order){const M=E._layers[I];if(M.type==="slot"){const N=s.dq(I);if(o[N])continue;o[N]=[]}M.slot&&o[M.slot]?o[M.slot].push(M):d.push(M)}}),this._mergedOrder=[];let b=-1;const T=(E=[])=>{for(const I of E)if(I.type==="slot"){const M=s.dq(I.id);o[M]&&T(o[M]),this._mergedSlots.push(M)}else{const M=s.B(I.id,I.scope);this._mergedOrder.push(M),g[M]=I,I.is3D(!!this.terrain)&&(this._has3DLayers=!0,b=this._mergedOrder.length-1),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&(this._clipLayerPresent=!0)}};if(T(d),this._has3DLayers){const E={};for(let I=0;I<this._mergedOrder.length;++I){const M=this._mergedOrder[I];E[M]=I===b?1:I<b?g[M].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((I,M)=>E[I]-E[M])}this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?function(d,g,b,T){const E=Object.assign({},g);for(const M of Object.keys(Rx))E[M]===void 0&&(E[M]=Rx[M].default);const I=new s.a8(Nk,d,new Map(b));return I.setTransitionOrValue(E,b),I.untransitioned().possiblyEvaluate(new s.ac(0,{worldview:void 0}))}(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const d=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((g,b)=>{const T="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void g();let E=o;E.startsWith(T)||(E=T+E);const I=s.I.from("mapbox-reserved-lut"),M=new Image;M.src=E,M.onerror=()=>{this._styleColorTheme.lutLoading=!1,b(new Error("Failed to load image data"))},M.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==d)return void g();this._styleColorTheme.lutLoading=!1;const{width:N,height:j,data:Z}=s.o.getImageData(M);if(j>32)return void b(new Error("The height of the image must be less than or equal to 32 pixels."));if(N!==j*j)return void b(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new s.q({width:N,height:j},Z),pixelRatio:1,sdf:!1,usvg:!1,version:0});const W=this.imageManager.getImage(I,this.scope);W?(this._styleColorTheme.lut={image:W.data,data:o},g()):b(new Error("Missing LUT image."))}})}getLut(o){const d=this._styleColorThemeForScope[o];return d?d.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(d,g,b){let T,E,I;const M=s.o.devicePixelRatio>1?"@2x":"";let N=s.m(g.transformRequest(g.normalizeSpriteURL(d,M,".json"),s.R.SpriteJSON),(W,Y)=>{N=null,I||(I=W,T=Y,Z())}),j=s.n(g.transformRequest(g.normalizeSpriteURL(d,M,".png"),s.R.SpriteImage),(W,Y)=>{j=null,I||(I=W,E=Y,Z())});function Z(){if(I)b(I);else if(T&&E){const W=s.o.getImageData(E),Y={};for(const te in T){const{width:J,height:oe,x:ae,y:pe,sdf:_e,pixelRatio:me,stretchX:Le,stretchY:Ce,content:Re}=T[te],Ae=new s.q({width:J,height:oe});s.q.copy(W,Ae,{x:ae,y:pe},{x:0,y:0},{width:J,height:oe},null),Y[te]={data:Ae,pixelRatio:me!==void 0?me:1,sdf:_e!==void 0&&_e,stretchX:Le,stretchY:Ce,content:Re,usvg:!1,version:0}}b(null,Y)}}return{cancel(){N&&(N.cancel(),N=null),j&&(j.cancel(),j=null)}}}(o,this.map._requestManager,(d,g)=>{if(this._spriteRequest=null,d)this.fire(new s.y(d));else if(g){const b=new Map;for(const T in g)b.set(s.I.from(T),g[T]);this.addImages(b)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))})}addIconset(o,d){if(d.type==="sprite")return void this._loadSprite(d.url);const g=this.getOwnSourceCache(d.source);if(!g)return void this.fire(new s.y(new Error(`Source "${d.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));const b=g.getSource();if(b.type!=="raster-array")return void this.fire(new s.y(new Error(`Source "${d.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));b.partial=!1;const T=new Mx(o,this.scope,g);this.imageManager.addImageProvider(T,this.scope)}removeIconset(o){this.imageManager.removeImageProvider(o,this.scope)}_loadIconset(o){if(!s.h(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);const d=this.map._spriteFormat==="auto";var g,b;this._spriteRequest=(b=(T,E)=>{if(this._spriteRequest=null,T)d?this._loadSprite(o):this.fire(new s.y(T));else if(E){const I=new Map;for(const M in E)I.set(s.I.from(M),E[M]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bu((g=this.map._requestManager).transformRequest(g.normalizeIconsetURL(o),s.R.Iconset),(T,E)=>{if(T)return void b(T);const I={},M=s.dg(new s.bt(E));for(const N of M.icons){const j={version:1,pixelRatio:s.o.devicePixelRatio,content:iE(N),stretchX:N.metadata?sE(N.metadata.stretch_x_areas):void 0,stretchY:N.metadata?sE(N.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:N};I[N.name]=j}b(null,I)}))}_validateLayer(o){const d=this.getOwnSource(o.source);if(!d)return;const g=o.sourceLayer;g&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(g)===-1)&&this.fire(new s.y(new Error(`Source layer "${g}" does not exist on source "${d.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,d)=>{const g=this.fragments[d];return g&&g.style&&(o.data=g.style.serialize()),o})}_serializeSources(){const o={};for(const d in this._sourceCaches){const g=this._sourceCaches[d].getSource();o[g.id]||(o[g.id]=g.serialize())}return o}_serializeLayers(o){const d=[];for(const g of o){const b=this._layers[g];b&&b.type!=="custom"&&d.push(b.serialize())}return d}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const o in this._mergedLayers){const d=this._mergedLayers[o];if(d._transitionablePaint&&d._transitionablePaint._values){const g=d._transitionablePaint._values["line-emissive-strength"];if(g&&g.value&&g.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){const d=this.getOwnLayer(o);if(d)return d;this.fire(new s.y(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){const d=this.getOwnSource(o);if(d)return d;this.fire(new s.y(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,d){const g=this.map.painter;if(g)for(let b=o.minzoom||0;b<(o.maxzoom||25.5);b++){const T=o.getProgramIds();if(T)for(const E of T){const I=o.getDefaultProgramParams(E,d.zoom,this._styleColorTheme.lut);I&&(g.style=this,this.fog&&(g._fogVisible=!0,I.overrideFog=!0,g.getOrCreateProgram(E,I)),g._fogVisible=!1,I.overrideFog=!1,g.getOrCreateProgram(E,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,g.getOrCreateProgram(E,I)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);const d=this.calculateLightsBrightness();o.brightness=d||0,d!==this._brightness&&(this._brightness=d,this.dispatcher.broadcast("setBrightness",d)),o.worldview!==this._worldview&&(this._worldview=o.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const g=this._changes.isDirty();let b=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const M in I){const{updatedIds:N,removedIds:j}=I[M];(N||j)&&(this._updateWorkerLayers(M,N,j),b=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}const T={};for(const I in this._mergedSourceCaches){const M=this._mergedSourceCaches[I];T[I]=M.used,M.used=!1,M.tileCoverLift=0}for(const I of this._mergedOrder){const M=this._mergedLayers[I];if(M.visibility!=="none"&&M.recalculate(o,this._availableImages),!M.isHidden(o.zoom)){const N=this.getLayerSourceCache(M);N&&(N.used=!0,N.tileCoverLift=Math.max(N.tileCoverLift,M.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(M,o)}):this.precompilePrograms(M,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&b&&this.mergeLayers();const E=this.imageManager.getPendingImageProviders();for(const I of E)I.sourceCache.used=!0;for(const I in T){const M=this._mergedSourceCaches[I];T[I]!==M.used&&M.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),g&&this.fire(new s.z("data",{dataType:"style"}))}updateImageProviders(){const o=this.imageManager.getPendingImageProviders();for(const d of o){const g=d.resolvePendingRequests(),b=this.getFragmentStyle(d.scope);b&&b.addImages(g)}}_updateTilesForChangedImages(){const o={};for(const d in this._mergedSourceCaches){const g=this._mergedSourceCaches[d].getSource().scope;o[g]=o[g]||this._changes.getUpdatedImages(g),o[g].length!==0&&this._mergedSourceCaches[d].reloadTilesForDependencies(["icons","patterns"],o[g])}for(const d in o)this._changes.resetUpdatedImages(d)}_updateWorkerLayers(o,d,g){const b=this.getFragmentStyle(o);b&&this.dispatcher.broadcast("updateLayers",{layers:d?b._serializeLayers(d):[],scope:o,removedIds:g||[],options:b.options})}setState(o,d){if(this._checkLoaded(),xh(this,rn(o)))return!1;(o=s.dp(o)).layers=k0(o.layers);const g=function(E,I){if(!E)return[{command:Ii.setStyle,args:[I]}];let M=[];try{if(!s.by(E.version,I.version))return[{command:Ii.setStyle,args:[I]}];if(s.by(E.center,I.center)||M.push({command:Ii.setCenter,args:[I.center]}),s.by(E.zoom,I.zoom)||M.push({command:Ii.setZoom,args:[I.zoom]}),s.by(E.bearing,I.bearing)||M.push({command:Ii.setBearing,args:[I.bearing]}),s.by(E.pitch,I.pitch)||M.push({command:Ii.setPitch,args:[I.pitch]}),s.by(E.sprite,I.sprite)||M.push({command:Ii.setSprite,args:[I.sprite]}),s.by(E.glyphs,I.glyphs)||M.push({command:Ii.setGlyphs,args:[I.glyphs]}),s.by(E.imports,I.imports)||function(Y=[],te=[],J){te=te||[];const oe=(Y=Y||[]).map(I0),ae=te.map(I0),pe=Y.reduce(R0,{}),_e=te.reduce(R0,{}),me=oe.slice();let Le,Ce,Re,Ae;for(Le=0,Ce=0;Le<oe.length;Le++)Re=oe[Le],_e.hasOwnProperty(Re)?Ce++:(J.push({command:Ii.removeImport,args:[Re]}),me.splice(me.indexOf(Re,Ce),1));for(Le=0,Ce=0;Le<ae.length;Le++)Re=ae[ae.length-1-Le],me[me.length-1-Le]!==Re&&(pe.hasOwnProperty(Re)?(J.push({command:Ii.removeImport,args:[Re]}),me.splice(me.lastIndexOf(Re,me.length-Ce),1)):Ce++,Ae=me[me.length-Le],J.push({command:Ii.addImport,args:[_e[Re],Ae]}),me.splice(me.length-Le,0,Re));for(const Te of te){const Fe=pe[Te.id];Fe&&(delete Fe.data,s.by(Fe,Te)||J.push({command:Ii.updateImport,args:[Te.id,Te]}))}}(E.imports,I.imports,M),s.by(E.transition,I.transition)||M.push({command:Ii.setTransition,args:[I.transition]}),s.by(E.light,I.light)||M.push({command:Ii.setLight,args:[I.light]}),s.by(E.fog,I.fog)||M.push({command:Ii.setFog,args:[I.fog]}),s.by(E.snow,I.snow)||M.push({command:Ii.setSnow,args:[I.snow]}),s.by(E.rain,I.rain)||M.push({command:Ii.setRain,args:[I.rain]}),s.by(E.projection,I.projection)||M.push({command:Ii.setProjection,args:[I.projection]}),s.by(E.lights,I.lights)||M.push({command:Ii.setLights,args:[I.lights]}),s.by(E.camera,I.camera)||M.push({command:Ii.setCamera,args:[I.camera]}),s.by(E.iconsets,I.iconsets)||function(Y,te,J){let oe;for(oe in te=te||{},Y=Y||{})Y.hasOwnProperty(oe)&&(te.hasOwnProperty(oe)||J.push({command:Ii.removeIconset,args:[oe]}));for(oe in te){if(!te.hasOwnProperty(oe))continue;const ae=te[oe];Y.hasOwnProperty(oe)?s.by(Y[oe],ae)||(J.push({command:Ii.removeIconset,args:[oe]}),J.push({command:Ii.addIconset,args:[oe,ae]})):J.push({command:Ii.addIconset,args:[oe,ae]})}}(E.iconsets,I.iconsets,M),!s.by(E["color-theme"],I["color-theme"]))return[{command:Ii.setStyle,args:[I]}];const N={},j=[];(function(Y,te,J,oe){let ae;for(ae in te=te||{},Y=Y||{})Y.hasOwnProperty(ae)&&(te.hasOwnProperty(ae)||bx(ae,J,oe));for(ae in te){if(!te.hasOwnProperty(ae))continue;const pe=te[ae];Y.hasOwnProperty(ae)?s.by(Y[ae],pe)||(Y[ae].type==="geojson"&&pe.type==="geojson"&&eE(Y,te,ae)?J.push({command:Ii.setGeoJSONSourceData,args:[ae,pe.data]}):JT(ae,te,J,oe)):j_(ae,te,J)}})(E.sources,I.sources,j,N);const Z=[];E.layers&&E.layers.forEach(Y=>{Y.source&&N[Y.source]?M.push({command:Ii.removeLayer,args:[Y.id]}):Z.push(Y)});let W=E.terrain;W&&N[W.source]&&(M.push({command:Ii.setTerrain,args:[void 0]}),W=void 0),M=M.concat(j),s.by(W,I.terrain)||M.push({command:Ii.setTerrain,args:[I.terrain]}),function(Y,te,J){te=te||[];const oe=(Y=Y||[]).map(I0),ae=te.map(I0),pe=Y.reduce(R0,{}),_e=te.reduce(R0,{}),me=oe.slice(),Le=Object.create(null);let Ce,Re,Ae,Te,Fe,Xe,He;for(Ce=0,Re=0;Ce<oe.length;Ce++)Ae=oe[Ce],_e.hasOwnProperty(Ae)?Re++:(J.push({command:Ii.removeLayer,args:[Ae]}),me.splice(me.indexOf(Ae,Re),1));for(Ce=0,Re=0;Ce<ae.length;Ce++)Ae=ae[ae.length-1-Ce],me[me.length-1-Ce]!==Ae&&(pe.hasOwnProperty(Ae)?(J.push({command:Ii.removeLayer,args:[Ae]}),me.splice(me.lastIndexOf(Ae,me.length-Re),1)):Re++,Xe=me[me.length-Ce],J.push({command:Ii.addLayer,args:[_e[Ae],Xe]}),me.splice(me.length-Ce,0,Ae),Le[Ae]=!0);for(Ce=0;Ce<ae.length;Ce++)if(Ae=ae[Ce],Te=pe[Ae],Fe=_e[Ae],!Le[Ae]&&!s.by(Te,Fe))if(s.by(Te.source,Fe.source)&&s.by(Te["source-layer"],Fe["source-layer"])&&s.by(Te.type,Fe.type)){for(He in mh(Te.layout,Fe.layout,J,Ae,null,Ii.setLayoutProperty),mh(Te.paint,Fe.paint,J,Ae,null,Ii.setPaintProperty),s.by(Te.slot,Fe.slot)||J.push({command:Ii.setSlot,args:[Ae,Fe.slot]}),s.by(Te.filter,Fe.filter)||J.push({command:Ii.setFilter,args:[Ae,Fe.filter]}),s.by(Te.minzoom,Fe.minzoom)&&s.by(Te.maxzoom,Fe.maxzoom)||J.push({command:Ii.setLayerZoomRange,args:[Ae,Fe.minzoom,Fe.maxzoom]}),Te)Te.hasOwnProperty(He)&&He!=="layout"&&He!=="paint"&&He!=="filter"&&He!=="metadata"&&He!=="minzoom"&&He!=="maxzoom"&&He!=="slot"&&(He.indexOf("paint.")===0?mh(Te[He],Fe[He],J,Ae,He.slice(6),Ii.setPaintProperty):s.by(Te[He],Fe[He])||J.push({command:Ii.setLayerProperty,args:[Ae,He,Fe[He]]}));for(He in Fe)Fe.hasOwnProperty(He)&&!Te.hasOwnProperty(He)&&He!=="layout"&&He!=="paint"&&He!=="filter"&&He!=="metadata"&&He!=="minzoom"&&He!=="maxzoom"&&He!=="slot"&&(He.indexOf("paint.")===0?mh(Te[He],Fe[He],J,Ae,He.slice(6),Ii.setPaintProperty):s.by(Te[He],Fe[He])||J.push({command:Ii.setLayerProperty,args:[Ae,He,Fe[He]]}))}else J.push({command:Ii.removeLayer,args:[Ae]}),Xe=me[me.lastIndexOf(Ae)+1],J.push({command:Ii.addLayer,args:[Fe,Xe]})}(Z,I.layers,M)}catch(N){console.warn("Unable to compute style diff:",N),M=[{command:Ii.setStyle,args:[I]}]}return M}(this.serialize(),o).filter(E=>!(E.command in oE));if(g.length===0)return!1;const b=g.filter(E=>!(E.command in aE));if(b.length>0)throw new Error(`Unimplemented: ${b.map(E=>E.command).join(", ")}.`);const T=[];return g.forEach(E=>{T.push(this[E.command](...E.args))}),d&&Promise.all(T).then(d).catch(d),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(o){if(o.size===0)return this;for(const[d,g]of o.entries()){if(this.getImage(d))return this.fire(new s.y(new Error(`An image with the name "${d.name}" already exists.`)));this.imageManager.addImage(d,this.scope,g),this._changes.updateImage(d,this.scope)}return this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this}addImage(o,d){return this.getImage(o)?this.fire(new s.y(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,d),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this)}updateImage(o,d,g=!1){this.imageManager.updateImage(o,this.scope,d),g&&(this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(o){return this.modelManager.addModelURLs(o,this.getActualScope()),this._updateWorkerModels(),this.fire(new s.z("data",{dataType:"style"})),this}addModel(o,d,g={}){return this._checkLoaded(),this._validate(ee,`models.${o}`,d,null,g)||(this.modelManager.addModel(o,d,this.getActualScope()),this.fire(new s.z("data",{dataType:"style"}))),this}hasModel(o){return this.modelManager.hasModel(o,this.getActualScope())}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.getActualScope(),!1,!0),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(o,d,g={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(rr,`sources.${o}`,d,null,g))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const b=fo(o,d,this.dispatcher,this);b.scope=this.scope,b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(b.id),source:b.serialize(),sourceId:b.id}));const T=E=>{const I=(E?"symbol:":"other:")+b.id,M=s.B(I,this.scope),N=this._sourceCaches[I]=new $l(M,b,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[b.id]=N,N.onAdd(this.map)};T(!1),d.type!=="vector"&&d.type!=="geojson"||T(!0),b.onAdd&&b.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();const d=this.getOwnSource(o);if(!d)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===o)return this.fire(new s.y(new Error(`Source "${o}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new s.y(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const b=Object.entries(this.stylesheet.iconsets).find(([T,E])=>E.type==="source"&&E.source===o);if(b)return this.fire(new s.y(new Error(`Source "${o}" cannot be removed while iconset "${b[0]}" is using it.`)))}const g=this.getOwnSourceCaches(o);for(const b of g){const T=s.dq(b.id);delete this._sourceCaches[T],this._changes.discardSourceCacheUpdate(b.id),b.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,d){this._checkLoaded(),this.getOwnSource(o).setData(d),this._changes.setDirty()}getOwnSource(o){const d=this.getOwnSourceCache(o);return d&&d.getSource()}getOwnSources(){const o=[];for(const d in this._otherSourceCaches){const g=this.getOwnSourceCache(d);g&&o.push(g.getSource())}return o}areTilesLoaded(){const o=this._mergedSourceCaches;for(const d in o){const g=o[d]._tiles;for(const b in g){const T=g[b];if(T.state!=="loaded"&&T.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;const d=this._getTransitionParameters();for(const T of o){if(this._validate(or,"lights",T))return;switch(T.type){case"ambient":if(this.ambientLight){const E=this.ambientLight;E.set(T),E.updateTransitions(d)}else this.ambientLight=new li(T,ds||(ds=new s.a9({color:new s.aa(s.a6.properties_light_ambient.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const E=this.directionalLight;E.set(T),E.updateTransitions(d)}else this.directionalLight=new li(T,Wi||(Wi=new s.a9({direction:new s.ap(s.a6.properties_light_directional.direction),color:new s.aa(s.a6.properties_light_directional.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_directional.intensity),"cast-shadows":new s.aa(s.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new s.aa(s.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.aa(s.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const g=Object.assign(d,{worldview:this.map.getWorldview()}),b=new s.ac(this.z||0,g);this.ambientLight&&this.ambientLight.recalculate(b),this.directionalLight&&this.directionalLight.recalculate(b),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const o=this.directionalLight,d=this.ambientLight;if(!o||!d)return;const g=W=>.2126*(W[0]<=.03928?W[0]/12.92:Math.pow((W[0]+.055)/1.055,2.4))+.7152*(W[1]<=.03928?W[1]/12.92:Math.pow((W[1]+.055)/1.055,2.4))+.0722*(W[2]<=.03928?W[2]/12.92:Math.pow((W[2]+.055)/1.055,2.4)),b=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),T=o.properties.get("intensity"),E=o.properties.get("direction"),I=1-s.d4(E.x,E.y,E.z)[2]/90,M=g(b)*T*I,N=d.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),j=d.properties.get("intensity"),Z=g(N)*j;return Number(((M+Z)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(o==null||o===""&&this.isRootStyle())return this;if(s.dr(o)){const d=s.ds(o),g=this.fragments.find(({id:T})=>T===d);if(!g)return;const b=s.dq(o);return g.style.getFragmentStyle(b)}{const d=this.fragments.find(({id:g})=>g===o);return d?d.style:void 0}}setFeaturesetSelectors(o){if(!o)return;const d={},g=(b,T="")=>`${b}::${T}`;this._featuresetSelectors={};for(const b in o){const T=this._featuresetSelectors[b]=[];for(const E of o[b].selectors){if(E.featureNamespace){const M=this.getOwnLayer(E.layer);if(!M){s.w(`Layer is undefined for selector: ${E.layer}`);continue}const N=g(M.source,M.sourceLayer);if(N in d&&d[N]!==E.featureNamespace){s.w(`"featureNamespace ${E.featureNamespace} of featureset ${b}'s selector is not associated to the same source, skip this selector`);continue}d[N]=E.featureNamespace}let I;if(E.properties)for(const M in E.properties){const N=s.U(E.properties[M]);N.result==="success"&&(I=I||{},I[M]=N.value)}T.push({layerId:E.layer,namespace:E.featureNamespace,properties:I,uniqueFeatureID:E._uniqueFeatureID})}}}getFeaturesetDescriptors(o){const d=this.getFragmentStyle(o);if(!d||!d.stylesheet.featuresets)return[];const g=[];for(const b in d.stylesheet.featuresets)g.push({featuresetId:b,importId:d.scope?d.scope:void 0});return g}getFeaturesetLayers(o,d){const g=this.getFragmentStyle(d),b=g.stylesheet.featuresets;if(!b||!b[o])return this.fire(new s.y(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];const T=[];for(const E of b[o].selectors){const I=g.getOwnLayer(E.layer);I&&T.push(I)}return T}getConfigProperty(o,d){const g=this.getFragmentStyle(o);if(!g)return null;const b=s.B(d,g.scope),T=g.options.get(b),E=T?T.value||T.default:null;return E?E.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(o,d){const g=s.B(o,d);return this._mergedIndoor[g]}setIndoorData(o,d){this.map.indoor.setIndoorData(d)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(o,d,g){const b=this.getFragmentStyle(o);if(!b)return;const T=b.stylesheet.schema;if(!T||!T[d])return;const E=s.U(g);if(E.result!=="success")return void xh(this,E.value);const I=E.value.expression,M=s.B(d,b.scope),N=b.options.get(M);if(!N)return;let j;const{minValue:Z,maxValue:W,stepValue:Y,type:te,values:J}=T[d],oe=s.U(T[d].default);oe.result==="success"&&(j=oe.value.expression),j?(this.options.set(M,Object.assign({},N,{value:I,default:j,minValue:Z,maxValue:W,stepValue:Y,type:te,values:J})),this.updateConfigDependencies(d)):this.fire(new s.y(new Error(`No schema defined for the config option "${d}" in the "${o}" fragment.`)))}getConfig(o){const d=this.getFragmentStyle(o);if(!d)return null;const g=d.stylesheet.schema;if(!g)return null;const b={};for(const T in g){const E=s.B(T,d.scope),I=d.options.get(E),M=I?I.value||I.default:null;b[T]=M?M.serialize():null}return b}setConfig(o,d){const g=this.getFragmentStyle(o);g&&(g.updateConfig(d,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){const d=this.getFragmentStyle(o);return d?d.stylesheet.schema:null}setSchema(o,d){const g=this.getFragmentStyle(o);g&&(g.stylesheet.schema=d,g.updateConfig(g._config,d),this.updateConfigDependencies())}updateConfig(o,d){if(this._config=o,o||d)if(d)for(const g in d){let b,T;const E=s.U(d[g].default);if(E.result==="success"&&(b=E.value.expression),o&&o[g]!==void 0){const W=s.U(o[g]);W.result==="success"&&(T=W.value.expression)}const{minValue:I,maxValue:M,stepValue:N,type:j,values:Z}=d[g];if(b){const W=s.B(g,this.scope);this.options.set(W,{default:b,value:T,minValue:I,maxValue:M,stepValue:N,type:j,values:Z})}else this.fire(new s.y(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(o,d=()=>!0){for(const g of o){const b=this.getLayer(g);b&&d(b)&&(b.possiblyEvaluateVisibility(),this._updateLayer(b),this._changes.setDirty())}}updateConfigDependencies(o){this._updateLayers(this._configDependentLayers,d=>!o||d.expressionDependencies.configDependencies.has(o)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(d=>{const g=d._styleColorTheme.colorThemeOverride?d._styleColorTheme.colorThemeOverride:d._styleColorTheme.colorTheme;if(g){const b=d._evaluateColorThemeData(g);(!d._styleColorTheme.lut&&b!==""||d._styleColorTheme.lut&&b!==d._styleColorTheme.lut.data)&&d.setColorTheme(g)}}),this._changes.setDirty()}addLayer(o,d,g={}){this._checkLoaded();const b=o.id;if(this._layers[b])return void this.fire(new s.y(new Error(`Layer with id "${b}" already exists on this map`)));let T;if(o.type==="custom"){if(xh(this,s.dt(o)))return;T=s.du(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(b,o.source),o=s.dp(o),o=Object.assign(o,{source:b})),this._validate(Sr,`layers.${b}`,o,{arrayIndex:-1},g))return;T=s.du(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(T),T.setEventedParent(this,{layer:{id:b}})}const E=s.B(T.source,T.scope);T.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(E),T.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(E);let I=this._order.length;if(d){const Z=this._order.indexOf(d);if(Z===-1)return void this.fire(new s.y(new Error(`Layer with id "${d}" does not exist on this map.`)));T.slot===this._layers[d].slot?I=Z:s.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(I,0,b),this._layerOrderChanged=!0,this._layers[b]=T;const M=this.getOwnLayerSourceCache(T),N=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&T.canCastShadows()&&N&&(M.castsShadows=!0);const j=this._changes.getRemovedLayer(T);if(j&&T.source&&M&&T.type!=="custom"){this._changes.discardLayerRemoval(T);const Z=s.B(T.source,T.scope);j.type!==T.type?this._changes.updateSourceCache(Z,"clear"):(this._changes.updateSourceCache(Z,"reload"),M.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),T.scope=this.scope,this.mergeLayers()}moveLayer(o,d){this._checkLoaded();const g=this._checkLayer(o);if(!g||o===d)return;const b=this._order.indexOf(o);this._order.splice(b,1);let T=this._order.length;if(d){const E=this._order.indexOf(d);if(E===-1)return void this.fire(new s.y(new Error(`Layer with id "${d}" does not exist on this map.`)));g.slot===this._layers[d].slot?T=E:s.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();const d=this._checkLayer(o);if(!d)return;d.setEventedParent(null);const g=this._order.indexOf(o);this._order.splice(g,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(d.fqid),this._indoorDependentLayers.delete(d.fqid),this._changes.removeLayer(d);const b=this.getOwnLayerSourceCache(d);if(b&&b.castsShadows){let T=!1;for(const E in this._layers)if(this._layers[E].source===d.source&&this._layers[E].canCastShadows()){T=!0;break}b.castsShadows=T}d.onRemove&&d.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(const d in this._layers)if(this._layers[d].type===o)return!0;return!1}setLayerZoomRange(o,d,g){this._checkLoaded();const b=this._checkLayer(o);b&&(b.minzoom===d&&b.maxzoom===g||(d!=null&&(b.minzoom=d),g!=null&&(b.maxzoom=g),this._updateLayer(b)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,d){this._checkLoaded();const g=this._checkLayer(o);g&&g.slot!==d&&(g.slot=d,this._updateLayer(g))}setFilter(o,d,g={}){this._checkLoaded();const b=this._checkLayer(o);if(b&&!s.by(b.filter,d))return d==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(Mi,`layers.${b.id}.filter`,d,{layerType:b.type},g)||(b.filter=s.dp(d),this._updateLayer(b)))}getFilter(o){const d=this._checkLayer(o);if(d)return s.dp(d.filter)}setLayoutProperty(o,d,g,b={}){this._checkLoaded();const T=this._checkLayer(o);if(T&&!s.by(T.getLayoutProperty(d),g)){if(g!=null&&(!b||b.validate!==!1)&&xh(T,Ze.call(rn,{key:`layers.${o}.layout.${d}`,layerType:T.type,objectKey:d,value:g,styleSpec:s.a6,style:{glyphs:!0,sprite:!0}})))return;T.setLayoutProperty(d,g),T.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),T.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T.fqid),this._updateLayer(T)}}setLayerProperty(o,d,g,b={}){this._checkLoaded();const T=this._checkLayer(o);T&&(d==="appearances"?(T.setAppearances(g),this._changes.setDirty()):T.isPaintProperty(d)?this.setPaintProperty(o,d,g,b):this.setLayoutProperty(o,d,g,b))}getLayoutProperty(o,d){const g=this._checkLayer(o);if(g)return g.getLayoutProperty(d)}setPaintProperty(o,d,g,b={}){this._checkLoaded();const T=this._checkLayer(o);if(!T||s.by(T.getPaintProperty(d),g)||g!=null&&(!b||b.validate!==!1)&&xh(T,da.call(rn,{key:`layers.${o}.paint.${d}`,layerType:T.type,objectKey:d,value:g,styleSpec:s.a6})))return;const E=T.setPaintProperty(d,g);T.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),T.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T.fqid),E&&this._updateLayer(T),this._changes.updatePaintProperties(T)}getPaintProperty(o,d){const g=this._checkLayer(o);if(g)return g.getPaintProperty(d)}setFeatureState(o,d){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:M,importId:N}=o.target,j=this.getFragmentStyle(N),Z=j.getFeaturesetLayers(M);for(const{source:W,sourceLayer:Y}of Z)j.setFeatureState({id:o.id,source:W,sourceLayer:Y},d)}else if("layerId"in o.target){const{layerId:M}=o.target,N=this.getLayer(M);this.setFeatureState({id:o.id,source:N.source,sourceLayer:N.sourceLayer},d)}return}const g=o.source,b=o.sourceLayer,T=this._checkSource(g);if(!T)return;const E=T.type;if(E==="geojson"&&b)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!b)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(g);for(const M of I)M.setFeatureState(b,o.id,d)}removeFeatureState(o,d){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:M,importId:N}=o.target,j=this.getFragmentStyle(N),Z=j.getFeaturesetLayers(M);for(const{source:W,sourceLayer:Y}of Z)j.removeFeatureState({id:o.id,source:W,sourceLayer:Y},d)}else if("layerId"in o.target){const{layerId:M}=o.target,N=this.getLayer(M);this.removeFeatureState({id:o.id,source:N.source,sourceLayer:N.sourceLayer},d)}return}const g=o.source,b=this._checkSource(g);if(!b)return;const T=b.type,E=T==="vector"?o.sourceLayer:void 0;if(T==="vector"&&!E)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(g);for(const M of I)M.removeFeatureState(E,o.id,d)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let T;if("featuresetId"in o.target){const{featuresetId:E,importId:I}=o.target,M=this.getFragmentStyle(I),N=M.getFeaturesetLayers(E);for(const{source:j,sourceLayer:Z}of N){const W=M.getFeatureState({id:o.id,source:j,sourceLayer:Z});if(W&&!T)T=W;else if(!s.by(T,W))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){const{layerId:E}=o.target,I=this.getLayer(E);T=this.getFeatureState({id:o.id,source:I.source,sourceLayer:I.sourceLayer})}return T}const d=o.source,g=o.sourceLayer,b=this._checkSource(d);if(b){if(b.type!=="vector"||g)return o.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(d)[0].getFeatureState(g,o.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const o=this.getTerrain(),d=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return s.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:d,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateFilteredLayers(o){for(const d of Object.values(this._mergedLayers))o(d)&&this._updateLayer(d)}_updateLayer(o){this._changes.updateLayer(o);const d=this.getLayerSourceCache(o),g=s.B(o.source,o.scope),b=this._changes.getUpdatedSourceCaches();o.source&&!b[g]&&d&&d.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),d.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const d=I=>this._mergedLayers[I].is3D(!!this.terrain),g=this.order,b={},T=[];for(let I=g.length-1;I>=0;I--){const M=g[I];if(d(M)){b[M]=I;for(const N of o){const j=N[M];if(j)for(const Z of j)T.push(Z)}}}T.sort((I,M)=>M.intersectionZ-I.intersectionZ);const E=[];for(let I=g.length-1;I>=0;I--){const M=g[I];if(d(M))for(let N=T.length-1;N>=0;N--){const j=T[N].feature;if(j.layer&&b[j.layer.id]<I)break;E.push(j),T.pop()}else for(const N of o){const j=N[M];if(j)for(const Z of j)E.push(Z.feature)}}return E}queryRasterValue(o,d,g){const b=this.getOwnSource(o);return b?b.type!=="raster-array"?(this.fire(new s.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):b.queryRasterArrayValue(d,g):(this.fire(new s.y(new Error(`Source with id "${o}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(o,d,g){let b;d&&!Array.isArray(d)&&d.filter&&(this._validate(Mi,"queryRenderedFeatures.filter",d.filter,null,d),b=s.b6(d.filter));const T={},E=j=>{if(K_.has(j.type))return;const Z=this.getOwnLayerSourceCache(j),W=T[Z.id]=T[Z.id]||{sourceCache:Z,layers:{},has3DLayers:!1};j.is3D(!!this.terrain)&&(W.has3DLayers=!0),W.layers[j.fqid]=W.layers[j.fqid]||{styleLayer:j,targets:[]},W.layers[j.fqid].targets.push({filter:b})};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const j of d.layers){const Z=this._layers[j];if(!Z)return this.fire(new s.y(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];E(Z)}}else for(const j in this._layers)E(this._layers[j]);const I=this._queryRenderedFeatures(o,T,g),M=this._flattenAndSortRenderedFeatures(I),N=[];for(const j of M)s.dw(j.layer.id)===this.scope&&N.push(j);return N}queryRenderedFeatureset(o,d,g){let b;d&&!Array.isArray(d)&&d.filter&&(this._validate(Mi,"queryRenderedFeatures.filter",d.filter,null,d),b=s.b6(d.filter));const T="mock",E=[];if(d&&d.target)E.push(Object.assign({},d,{targetId:T,filter:b}));else{const j=this.getFeaturesetDescriptors();for(const Z of j)E.push({targetId:T,filter:b,target:Z});for(const{style:Z}of this.fragments){const W=Z.getFeaturesetDescriptors();for(const Y of W)E.push({targetId:T,filter:b,target:Y})}}const I=this.queryRenderedTargets(o,E,g),M=[],N=new Set;for(const j of I)for(const Z of j.variants[T])Ap(Z,j,N)||M.push(new s.dx(j,Z));return M}queryRenderedTargets(o,d,g){const b={},T=(I,M,N,j)=>{const Z=b[M.id]=b[M.id]||{sourceCache:M,layers:{},has3DLayers:!1};if(Z.layers[I.fqid]=Z.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(Z.has3DLayers=!0),!j)return N.uniqueFeatureID=!1,void Z.layers[I.fqid].targets.push(N);Z.layers[I.fqid].targets.push(Object.assign({},N,{namespace:j.namespace,properties:j.properties,uniqueFeatureID:j.uniqueFeatureID}))};for(const I of d)if("featuresetId"in I.target){const{featuresetId:M,importId:N}=I.target,j=this.getFragmentStyle(N);if(!j||!j._featuresetSelectors)continue;const Z=j._featuresetSelectors[M];if(!Z){this.fire(new s.y(new Error(`The featureset '${M}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const W of Z){const Y=j.getOwnLayer(W.layerId);Y&&!K_.has(Y.type)&&T(Y,j.getOwnLayerSourceCache(Y),I,W)}}else if("layerId"in I.target){const{layerId:M}=I.target,N=this.getLayer(M);if(!N||K_.has(N.type))continue;T(N,this.getLayerSourceCache(N),I)}const E=this._queryRenderedFeatures(o,b,g);return this._flattenAndSortRenderedFeatures(E)}_queryRenderedFeatures(o,d,g){const b=[],T=!!this.map._showQueryGeometry,E=Is.createFromScreenPoints(o,g);for(const I in d){const M=L_(E,d[I],this._availableImages,g,T);Object.keys(M).length&&b.push(M)}if(this.placement)for(const I in d){if(!d[I].sourceCache._onlySymbols)continue;const M=D_(E.screenGeometry,d[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(M).length&&b.push(M)}return b}querySourceFeatures(o,d){const g=d&&d.filter;g&&this._validate(Mi,"querySourceFeatures.filter",g,null,d);let b=[];const T=this.getOwnSourceCaches(o);for(const E of T)b=b.concat(N_(E,d));return b}addSourceType(o,d,g){return Nu.getSourceType(o)?g(new Error(`A source type called "${o}" already exists.`)):(Nu.setSourceType(o,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:d.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,d,g={}){this._checkLoaded();const b=this.light.getLight();let T=!1;for(const I in o)if(!s.by(o[I],b[I])){T=!0;break}if(!T)return;const E=this._getTransitionParameters();this.light.setLight(o,d,g),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,d=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),d===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=o;const b=!("source"in o)||o.source==null;if(d===1){if(this.disableElevatedTerrain)return;if("source"in g&&typeof g.source=="object"){const I="terrain-dem-src";this.addSource(I,g.source),g=s.dp(g),g=Object.assign(g,{source:I})}const T=Object.assign({},g),E={};if(this.terrain&&b){T.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(E.style=I.serialize())}if(this._validate(_n,"terrain",T,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!b||this.terrain&&d!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,d),this.fire(new s.z("data",{dataType:"style"}))}else{const T=this.terrain,E=T.get();for(const I of Object.keys(s.a6.terrain))!g.hasOwnProperty(I)&&s.a6.terrain[I].default&&(g[I]=s.a6.terrain[I].default);for(const I in o)if(!s.by(o[I],E[I])){T.set(o,this.options),this.stylesheet.terrain=o;const M=this._getTransitionParameters({duration:0});T.updateTransitions(M),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const d=this.fog=new Ar(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}_createSnow(o){const d=this.snow=new Es(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}_createRain(o){const d=this.rain=new ji(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog;if(!s.by(d.get(),o)){d.set(o,this.options),this.stylesheet.fog=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const d=this.snow;if(!s.by(d.get(),o)){d.set(o,this.options),this.stylesheet.snow=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const d=this.rain;if(!s.by(d.get(),o)){d.set(o,this.options),this.stylesheet.rain=d.get();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){const o=()=>{for(const b in this._layers)this._layers[b].lut=this._styleColorTheme.lut;for(const b in this._sourceCaches)this._sourceCaches[b].clearTiles()},d=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!d)return this._styleColorTheme.lut=null,void o();const g=this._evaluateColorThemeData(d);this._loadColorTheme(g).then(()=>{this.fire(new s.z("colorthemeset")),o()}).catch(b=>{s.w(`Couldn't set color theme: ${b}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,d){const g=this.getFragmentStyle(o);g&&(g._styleColorTheme.colorThemeOverride=d,g._reloadColorTheme())}_getTransitionParameters(o){return{now:s.o.now(),transition:Object.assign(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;const o=[],d=[];for(const g of this._mergedOrder)this.isLayerDraped(this._mergedLayers[g])?o.push(g):d.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...d)}_createTerrain(o,d){const g=this.terrain=new We(o,d,this.scope,this.options,this.map.getWorldview());d===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const b=this._getTransitionParameters({duration:0});g.updateTransitions(b)}_force3DLayerUpdate(){for(const o in this._layers){const d=this._layers[o];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const d=this._layers[o];d.type==="symbol"&&this._updateLayer(d)}}_validate(o,d,g,b,T={}){if(T&&T.validate===!1)return!1;const E=Object.assign({},this.serialize());return xh(this,o.call(rn,Object.assign({key:d,style:E,value:g,styleSpec:s.a6},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(o){const d=this.getSourceCaches(o);for(const g of d)g.clearTiles()}clearSources(){for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}clearLayers(){for(const o in this._mergedLayers){const d=this._mergedLayers[o];d._clear&&d._clear()}}reloadSource(o){const d=this.getSourceCaches(o);for(const g of d)g.resume(),g.reload()}reloadSources(){for(const o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(o=>{o.modelManager.reloadModels(o.scope)})}updateSources(o){let d;this.directionalLight&&(d=B0(this.directionalLight));const g=new Set,b=new Set;for(const T in this._mergedLayers){const E=this._mergedLayers[T];E.type==="building"&&g.add(E.source),E.hasElevation()&&!b.has(E.source)&&b.add(E.source)}for(const T in this._mergedSourceCaches){const E=this._mergedSourceCaches[T],I=b.has(E._source.id);g.has(E._source.id)&&(E._source.reparseOverscaled=!1),E.update(o,void 0,void 0,d,I)}}_generateCollisionBoxes(){for(const o in this._sourceCaches){const d=this._sourceCaches[o];d.resume(),d.reload()}}_updatePlacement(o,d,g,b,T,E,I=!1){let M=!1,N=!1;const j={},Z={};for(const J of this._mergedOrder){const oe=this._mergedLayers[J];if(oe.type!=="symbol")continue;const ae=s.B(oe.source,oe.scope);let pe=j[ae];if(!pe){const me=this.getLayerSourceCache(oe);if(!me)continue;const Le=me.getRenderableIds(!0).map(Ce=>me.getTileByID(Ce));Z[ae]=Le.slice(),pe=j[ae]=Le.sort((Ce,Re)=>Re.tileID.overscaledZ-Ce.tileID.overscaledZ||(Ce.tileID.isLessThan(Re.tileID)?-1:1))}const _e=this.crossTileSymbolIndex.addLayer(oe,pe,d.center.lng,d.projection);M=M||_e}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new s.z("neworder"));const W=!!(this.placement&&!d.equals(this.placement.transform)),Y=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!E||this.placement.lastReplacementSourceUpdateTime!==E.updateTime)),te=(W||Y||M||this.placement&&this.placement.isStale())&&b===0;if((I||!this.pauseablePlacement||te||b!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.o.now(),d.zoom))&&(this.pauseablePlacement=new po(d,this._mergedOrder,I||b===0,g,b,T,this.placement,this.fog&&d.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,j,Z,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.o.now()),N=!0),M&&this.pauseablePlacement.placement.setStale()),N||M){this._buildingIndex.onNewFrame(d.zoom);for(let J=0;J<this._mergedOrder.length;J++){const oe=this._mergedLayers[this._mergedOrder[J]];if(oe.type!=="symbol"||oe.visibility==="none")continue;const ae=this.isLayerClipped(oe);this.placement.updateLayerOpacities(oe,j[s.B(oe.source,oe.scope)],J,ae?E:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.o.now())}}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,d){this._checkLoaded();const g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:T})=>T===o.id)!==-1)return void this.fire(new s.y(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!d)return g.push(o),this._loadImports([o],!0);const b=g.findIndex(({id:T})=>T===d);return b===-1&&this.fire(new s.y(new Error(`Import with id "${d}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,b).concat(o).concat(g.slice(b)),this._loadImports([o],!0,d)}updateImport(o,d){this._checkLoaded();const g=this.stylesheet.imports||[],b=this.getImportIndex(o);return b===-1?this:typeof d=="string"?(this.setImportUrl(o,d),this):(d.url&&d.url!==g[b].url&&this.setImportUrl(o,d.url),s.by(d.config,g[b].config)||this.setImportConfig(o,d.config,d.data.schema),s.by(d.data,g[b].data)||this.setImportData(o,d.data),this)}moveImport(o,d){this._checkLoaded();let g=this.stylesheet.imports||[];const b=this.getImportIndex(o);if(b===-1)return this;const T=this.getImportIndex(d);if(T===-1)return this;const E=g[b],I=this.fragments[b];return g=g.filter(({id:M})=>M!==o),this.fragments=this.fragments.filter(({id:M})=>M!==o),this.stylesheet.imports=g.slice(0,T).concat(E).concat(g.slice(T)),this.fragments=this.fragments.slice(0,T).concat(I).concat(this.fragments.slice(T)),this.mergeLayers(),this}setImportUrl(o,d){this._checkLoaded();const g=this.stylesheet.imports||[],b=this.getImportIndex(o);if(b===-1)return this;g[b].url=d;const T=this.fragments[b];return T.style=this._createFragmentStyle(g[b]),T.style.on("style.import.load",()=>this.mergeAll()),T.style.loadURL(d),this}setImportData(o,d){this._checkLoaded();const g=this.getImportIndex(o),b=this.stylesheet.imports||[];return g===-1?this:d?(this.fragments[g].style.setState(d),this._reloadImports(),this):(delete b[g].data,this.setImportUrl(o,b[g].url))}setImportConfig(o,d,g){this._checkLoaded();const b=this.getImportIndex(o),T=this.stylesheet.imports||[];if(b===-1)return this;d?T[b].config=d:delete T[b].config;const E=this.fragments[b];g&&E.style.stylesheet&&(E.style.stylesheet.schema=g);const I=E.style.stylesheet&&E.style.stylesheet.schema;return E.config=d,E.style.updateConfig(d,I),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();const d=this.stylesheet.imports||[],g=this.getImportIndex(o);g!==-1&&(d.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(o){const d=(this.stylesheet.imports||[]).findIndex(g=>g.id===o);return d===-1&&this.fire(new s.y(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),d}getLayer(o){return this._mergedLayers[o]}getSources(){const o=[];for(const d in this._mergedOtherSourceCaches){const g=this._mergedOtherSourceCaches[d];g&&o.push(g.getSource())}return o}getSource(o,d){const g=this.getSourceCache(o,d);return g&&g.getSource()}getLayerSource(o){const d=this.getLayerSourceCache(o);return d&&d.getSource()}getSourceCache(o,d){const g=s.B(o,d);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(o){const d=s.B(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[d]:this._mergedOtherSourceCaches[d]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);const d=[];return this._mergedOtherSourceCaches[o]&&d.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&d.push(this._mergedSymbolSourceCaches[o]),d}updateSourceCaches(){const o=this._changes.getUpdatedSourceCaches();for(const d in o){const g=o[d];g==="reload"?this.reloadSource(d):g==="clear"&&this.clearSource(d)}}updateLayers(o){const d=this._changes.getUpdatedPaintProperties();for(const g of d){const b=this.getLayer(g);b&&b.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o)}getImages(o,d,g){this.imageManager.getImages(d.images,d.scope,g),this._updateTilesForChangedImages();const b=E=>{if(E){const I=d.images.map(M=>s.I.toString(M));E.setDependencies(d.tileID.key,d.type,I)}},T=s.B(d.source,d.scope);b(this._mergedOtherSourceCaches[T]),b(this._mergedSymbolSourceCaches[T]),d.images.some(E=>E.iconsetId)&&this.fire(new s.z("data",{dataType:"style"}))}rasterizeImages(o,d,g){this.imageManager.rasterizeImages(d,g)}getGlyphs(o,d,g){this.glyphManager.getGlyphs(d.stacks,g)}getResource(o,d,g){return s.dz(d,g)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){const d=[];return this._otherSourceCaches[o]&&d.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&d.push(this._symbolSourceCaches[o]),d}_isSourceCacheLoaded(o){const d=this.getOwnSourceCaches(o);return d.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${o}'`))),!1):d.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,d){if(!this._clipLayerPresent&&o.type!=="fill-extrusion"&&o.type!=="building")return!1;const g=o.type==="fill-extrusion"&&(o.sourceLayer==="building"||o.sourceLayer==="procedural_buildings"),b=o.type==="building";if(o.is3D(!!this.terrain)){if(g||b||d&&d.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Nu.getSourceType=function(m){return Fc[m]},Nu.setSourceType=function(m,o){Fc[m]=o},Nu.registerForPluginStateChange=s.dA;class lE extends s.E{constructor(o){super(),this._style=o,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},s.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(o){o===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=o,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(o){this._activeFloorsVisible=o,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(o){for(const[d,g]of Object.entries(o.buildings))if(this._buildings[d])for(const b of g.floorIds)this._buildings[d].floors[b]||(this._buildings[d].floors[b]=g.floors[b]);else this._buildings[d]=g;for(const d of o.activeFloors)this._activeFloors.add(d);this._updateIndoorSelector()}getIndoorTileOptions(o,d){const g=this._style.getIndoorSourceLayers(o,d);return g&&this._indoorState?{sourceLayers:g,indoorState:this._indoorState}:null}_updateUI(o,d,g){const b=function(T,E,I,M){let N=null,j=Number.MAX_SAFE_INTEGER;if(M<16)return null;for(const[Z,W]of Object.entries(T)){const Y=W.center;if(Y){const te=E.distanceTo(s.aT.convert(Y));te<j&&I.contains(Y)&&(j=te,N=Z)}}return N}(this._buildings,d,g,o);b!==this._closestBuildingId&&(this._closestBuildingId=b,this._updateIndoorSelector())}_updateIndoorSelector(){const o=this._buildings,d=this._closestBuildingId,g=d&&o?o[d]:void 0;if(!g)return void this.fire(new s.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let b=null;for(const E of g.floorIds)if(this._activeFloors&&this._activeFloors.has(E)){b=E;break}const T=Array.from(g.floorIds).map(E=>({id:E,name:g.floors[E].name,zIndex:g.floors[E].zIndex})).sort((E,I)=>I.zIndex-E.zIndex);this.fire(new s.z("selector-update",{selectedFloorId:b,activeFloorsVisible:this._activeFloorsVisible,floors:T}))}_updateActiveFloors(){const o=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:o,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Mp=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Pp=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Px=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Q_="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",lu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,J_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Qt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ox=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,ey=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,ty=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,Lx=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const U0=/#include\s+"([^"]+)"/g,Gc=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,Dx=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Ef=new Set(["ifdef","ifndef","elif","if","defined"]),Sf=new Set;Th(Mp,Sf),Th(Px,Sf),Th(Pp,Sf);const wh={"_prelude_fog.vertex.glsl":J_,"_prelude_terrain.vertex.glsl":lu,"_prelude_shadow.vertex.glsl":ty,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Qt,"_prelude_shadow.fragment.glsl":Lx,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":Ox,"_prelude_raster_particle.glsl":ey},ny={};Ti("",lu),Ti(Qt,J_),Ti(Lx,ty),Ti(Ox,""),Ti(ey,"");const uE=Ti(Pp,Px),ry=Mp,zk=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",ry,uE.fragmentSource].join(`
`),cE=["precision highp float;",ry,uE.vertexSource].join(`
`);var Nx={background:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:Ti(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Ti(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ti("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ti(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ti(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ti("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ti("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ti("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Ti(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Ti(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ti(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ti(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ti(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ti(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ti("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ti("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ti(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ti(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ti("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ti(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Q_),skyboxGradient:Ti(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Q_),skyboxCapture:Ti(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ti(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ti(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ti(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ti(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Ti("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Ti("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Ti("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ti("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Th(m,o){const d=m.split(`
`);for(let g of d){if(g=g.trimStart(),g[0]!=="#"||!g.includes("if")||g.startsWith("#endif"))continue;const b=g.match(Dx);if(b)for(const T of b)Ef.has(T)||o.add(T)}}function Ti(m,o){const d=new Set,g=[],b=[];m=m.replace(U0,(E,I)=>(b.push(I),"")),o=o.replace(U0,(E,I)=>(g.push(I),""));let T=new Set(Sf);Th(m,T),Th(o,T);for(const E of[...g,...b])ny[E]||(ny[E]=new Set,Th(wh[E],ny[E])),T=new Set([...T,...ny[E]]);return{fragmentSource:m=m.replace(Gc,(E,I,M,N,j)=>(d.add(j),I==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${M} ${N} ${j};
#else
uniform ${M} ${N} u_${j};
#endif
`:I==="initialize"?`
#ifdef HAS_UNIFORM_u_${j}
    ${M} ${N} ${j} = u_${j};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${M} ${N} ${j};
#endif
`:I==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(Gc,(E,I,M,N,j)=>{const Z=`MATERIAL_ATTRIBUTE_OFFSET_${j}`,W=N==="float"?"vec2":N,Y=`GET_ATTRIBUTE_${W}(a_${j}, materialInfo, ${Z})`,te=j.match(/color/)?"color":W;return I==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${j}
in ${M} ${N} a_${j};
#endif
`:d.has(j)?I==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
    #if !defined(${Z})
        in ${M} ${W} a_${j};
    #endif
out ${M} ${N} ${j};
#else
uniform ${M} ${N} u_${j};
#endif
`:I==="initialize"?te==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${M} ${N} ${j} = u_${j};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${j})
    #ifdef ${Z}
        ${j} = unpack_mix_${te}(${Y}, u_${j}_t);
    #else
        ${j} = unpack_mix_${te}(a_${j}, u_${j}_t);
    #endif
#else
    ${M} ${N} ${j} = u_${j};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${M} ${N} a_${j};
    out ${M} ${N} ${j};
#endif
`:I==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${j} = a_${j};
#endif
`:void 0:I==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
    #if !defined(${Z})
        in ${M} ${W} a_${j};
    #endif
#else
uniform ${M} ${N} u_${j};
#endif
`:I==="define-instanced"?te==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${j}0;
in vec4 a_${j}1;
in vec4 a_${j}2;
in vec4 a_${j}3;
#else
uniform ${M} ${N} u_${j};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${M} ${W} a_${j};
#else
uniform ${M} ${N} u_${j};
#endif
`:I==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${M} ${N} ${j} = a_${j};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    #ifdef ${Z}
        ${M} ${N} ${j} = ${Y};
    #else
        ${M} ${N} ${j} = a_${j};
    #endif
#else
    ${M} ${N} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    #ifdef ${Z}
        ${M} ${N} ${j} = unpack_mix_${te}(${Y}, u_${j}_t);
    #else
        ${M} ${N} ${j} = unpack_mix_${te}(a_${j}, u_${j}_t);
    #endif
#else
    ${M} ${N} ${j} = u_${j};
#endif
`}),usedDefines:T,vertexIncludes:g,fragmentIncludes:b}}class Fk{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,d,g,b,T,E,I,M){this.context=o;let N=this.boundPaintVertexBuffers.length!==b.length;for(let Z=0;!N&&Z<b.length;Z++)this.boundPaintVertexBuffers[Z]!==b[Z]&&(N=!0);let j=this.boundDynamicVertexBuffers.length!==I.length;for(let Z=0;!j&&Z<I.length;Z++)this.boundDynamicVertexBuffers[Z]!==I[Z]&&(j=!0);if(!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==g||N||j||this.boundIndexBuffer!==T||this.boundVertexOffset!==E)this.freshBind(d,g,b,T,E,I,M);else{o.bindVertexArrayOES.set(this.vao);for(const Z of I)Z&&(Z.bind(),M&&Z.instanceCount&&Z.setVertexAttribDivisor(o.gl,d,M));T&&T.dynamicDraw&&T.bind()}}freshBind(o,d,g,b,T,E,I){const M=this.context,N=M.gl;this.vao&&this.destroy(),this.vao=M.gl.createVertexArray(),M.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=b,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=E,d.enableAttributes(N,o),d.bind(),d.setVertexAttribPointers(N,o,T);for(const j of g)j.enableAttributes(N,o),j.bind(),j.setVertexAttribPointers(N,o,T);for(const j of E)j&&(j.enableAttributes(N,o),j.bind(),j.setVertexAttribPointers(N,o,T),I&&j.instanceCount&&j.setVertexAttribDivisor(N,o,I));b&&b.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Bk(m,o){const d=Math.pow(2,o.canonical.z),g=o.canonical.y;return[new s.ae(0,g/d).toLngLat().lat,new s.ae(0,(g+1)/d).toLngLat().lat]}function jk(m,o,d,g,b,T,E){const I=m.context,M=I.gl,N=d.hillshadeFBO;if(!N)return;m.prepareDrawTile();const j=m.isTileAffectedByFog(o),Z=[];m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&Z.push("USE_MRT1");const W=m.getOrCreateProgram("hillshade",{overrideFog:j,defines:Z});I.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,N.colorAttachment0.get());const Y=((ae,pe,_e,me)=>{const Le=_e.paint.get("hillshade-shadow-color"),Ce=_e.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Re=_e.paint.get("hillshade-highlight-color"),Ae=_e.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Te=_e.paint.get("hillshade-accent-color"),Fe=_e.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Xe=_e.paint.get("hillshade-emissive-strength");let He=s.an(_e.paint.get("hillshade-illumination-direction"));if(_e.paint.get("hillshade-illumination-anchor")==="viewport")He-=ae.transform.angle;else if(ae.style&&ae.style.enable3dLights()&&ae.style.directionalLight){const ht=ae.style.directionalLight.properties.get("direction"),St=s.d4(ht.x,ht.y,ht.z);He=s.an(St[1])}const ct=!ae.options.moving;return{u_matrix:me||ae.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),ct),u_image:0,u_latrange:Bk(0,pe.tileID),u_light:[_e.paint.get("hillshade-exaggeration"),He],u_shadow:Le.toPremultipliedRenderColor(Ce?null:_e.lut),u_highlight:Re.toPremultipliedRenderColor(Ae?null:_e.lut),u_emissive_strength:Xe,u_accent:Te.toPremultipliedRenderColor(Fe?null:_e.lut)}})(m,d,g,m.terrain?o.projMatrix:null);m.uploadCommonUniforms(I,W,o.toUnwrapped());const{tileBoundsBuffer:te,tileBoundsIndexBuffer:J,tileBoundsSegments:oe}=m.getTileBoundsBuffers(d);W.draw(m,M.TRIANGLES,b,T,E,Cr.disabled,Y,g.id,te,J,oe)}function zx(m,o,d){if(!o.needsDEMTextureUpload)return;const g=m.context,b=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||m.getTileTexture(d.stride);const T=d.getPixels();o.demTexture?o.demTexture.update(T,{premultiply:!1}):o.demTexture=new s.T(g,T,b.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Uk(m,o,d){const g=m.context,b=g.gl;if(!o.dem)return;const T=o.dem;if(g.activeTexture.set(b.TEXTURE1),zx(m,o,T),!o.demTexture)return;o.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const E=T.dim;g.activeTexture.set(b.TEXTURE0);let I=o.hillshadeFBO;if(!I){const W=new s.T(g,{width:E,height:E,data:null},b.RGBA8);W.bind(b.LINEAR,b.CLAMP_TO_EDGE),I=o.hillshadeFBO=g.createFramebuffer(E,E,1,"renderbuffer"),I.colorAttachment0.set(W.texture)}g.bindFramebuffer.set(I.framebuffer),g.viewport.set([0,0,E,E]);const{tileBoundsBuffer:M,tileBoundsIndexBuffer:N,tileBoundsSegments:j}=m.getMercatorTileBoundsBuffers(),Z=[];m.linearFloatFilteringSupported()&&Z.push("TERRAIN_DEM_FLOAT_FORMAT"),m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&Z.push("USE_MRT1"),m.getOrCreateProgram("hillshadePrepare",{defines:Z}).draw(m,b.TRIANGLES,zn.disabled,kr.disabled,jr.unblended,Cr.disabled,((W,Y)=>{const te=Y.stride,J=s.bC();return s.ce(J,0,s.al,-s.al,0,0,1),s.br(J,J,[0,-s.al,0]),{u_matrix:J,u_image:1,u_dimension:[te,te],u_zoom:W.overscaledZ}})(o.tileID,T),d.id,M,N,j),o.needsHillshadePrepare=!1}class Ks{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Vk extends Ks{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class dE extends Ks{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Fx extends Ks{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class iy extends Ks{getDefault(){return[!0,!0,!0,!0]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Bx extends Ks{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Af extends Ks{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Op extends Ks{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const d=this.current;(o.func!==d.func||o.ref!==d.ref||o.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class V0 extends Ks{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Lp extends Ks{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=o,this.dirty=!1}}class hE extends Ks{getDefault(){return[0,1]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class jx extends Ks{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=o,this.dirty=!1}}class fE extends Ks{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Dp extends Ks{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.BLEND):d.disable(d.BLEND),this.current=o,this.dirty=!1}}class sy extends Ks{getDefault(){const o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class ay extends Ks{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Ux extends Ks{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class oy extends Ks{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=o,this.dirty=!1}}class $0 extends Ks{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class pE extends Ks{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let mE=class extends Ks{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class gE extends Ks{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Np extends Ks{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class _E extends Ks{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class $k extends Ks{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Hk extends Ks{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Gk extends Ks{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Vx extends Ks{getDefault(){return null}set(o){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class $x extends Ks{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class Hx extends Ks{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Gx extends Ks{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class yE extends Ks{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class ly extends Ks{constructor(o,d){super(o),this.context=o,this.parent=d}getDefault(){return null}}class uy extends ly{constructor(o,d,g=0){super(o,d),this.attachmentPoint=o.gl.COLOR_ATTACHMENT0+g}setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,this.attachmentPoint,d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class zp extends ly{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class H0 extends ly{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,this.attachment(),d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class vE extends zp{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const uu=(m,o,d,g)=>({u_matrix:m,u_image0:0,u_image1:1,u_skirt_height:o,u_ground_shadow_factor:d,u_emissive_texture_available:g}),cy=(m,o,d,g,b,T,E,I,M,N,j,Z,W,Y,te,J,oe)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:d,u_zoom_transition:b,u_merc_center:T,u_image0:0,u_image1:1,u_frustum_tl:E,u_frustum_tr:I,u_frustum_br:M,u_frustum_bl:N,u_globe_pos:j,u_globe_radius:Z,u_viewport:W,u_grid_matrix:oe?Float32Array.from(oe):new Float32Array(9),u_skirt_height:Y,u_far_z_cutoff:te,u_emissive_texture_available:J});function G0(m,o){return m!=null&&o!=null&&!(!m.hasData()||!o.hasData())&&m.demTexture!=null&&o.demTexture!=null&&m.tileID.key!==o.tileID.key}const Ed=new class{constructor(){this.operations={}}newMorphing(m,o,d,g,b){if(m in this.operations){const T=this.operations[m];T.to.tileID.key!==d.tileID.key&&(T.queued=d)}else this.operations[m]={startTime:g,phase:0,duration:b,from:o,to:d,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const o=this.operations[m];return{from:o.from,to:o.to,phase:o.phase}}update(m){for(const o in this.operations){const d=this.operations[o];for(d.phase=(m-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,m)){delete this.operations[o];break}}}_nextOp(m,o){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=o,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},dy={0:null,1:"TERRAIN_VERTEX_MORPHING"};function hy(m,o,d){if(o===0)return 0;const g=o<1&&d===514?.25/o:1;return 6*Math.pow(1.5,22-m)*Math.max(o,1)*g}function qx(m,o){const d=1<<m.z;return!o&&(m.x===0||m.x===d-1)||m.y===0||m.y===d-1}function Fp(m,o){if(!m.style||!m.style.enable3dLights())return;const d=m.context,g=d.gl;d.activeTexture.set(g.TEXTURE1),o?o.bind(g.LINEAR,g.CLAMP_TO_EDGE):m.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)}const q0=m=>({u_matrix:m});function W0(m,o,d,g,b){if(b>0){const T=s.o.now(),E=(T-m.timeAdded)/b,I=o?(T-o.timeAdded)/b:-1,M=d.getSource(),N=g.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),j=!o||Math.abs(o.tileID.overscaledZ-N)>Math.abs(m.tileID.overscaledZ-N),Z=j&&m.refreshedUponExpiration?1:s.aA(j?E:1-I,0,1);return o?{opacity:1,mix:1-Z,isFading:E<1}:{opacity:Z,mix:0,isFading:E<1}}return{opacity:1,mix:0,isFading:!1}}class fy extends $l{constructor(o){const d=fo("mock-dem",{type:"raster-dem",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("mock-dem",d,!1),d.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,d){o.state="loaded",d(null)}}class Wx extends $l{constructor(o){const d=fo("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,d,g){if(o.freezeTileCoverage)return;this.transform=o;const b=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((T,E)=>{if(T[E.key]="",!this._tiles[E.key]){const I=new xf(E,this._source.tileSize*E.overscaleFactor(),o.tileZoom,void 0,void 0,this._source.worldview);I.state="loaded",this._tiles[E.key]=I}return T},{});for(const T in this._tiles)T in b||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(o){const d=this.proxyCachedFBO[o];if(d!==void 0){const g=Object.values(d);this.renderCachePool.push(...g),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Zx extends s.aQ{constructor(o,d,g){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=d,this.projMatrix=g}}class Xx extends s.bV{constructor(o,d){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,b,T]=function(M){const N=new s.bd,j=new s.b0,Z=131;N.reserve(17161),j.reserve(33800);const W=s.al/128,Y=s.al+W/2,te=Y+W;for(let oe=-W;oe<te;oe+=W)for(let ae=-W;ae<te;ae+=W){const pe=ae<0||ae>Y||oe<0||oe>Y?24575:0,_e=s.aA(Math.round(ae),0,s.al),me=s.aA(Math.round(oe),0,s.al);N.emplaceBack(_e+pe,me)}const J=(oe,ae)=>{const pe=ae*Z+oe;j.emplaceBack(pe+1,pe,pe+Z),j.emplaceBack(pe+Z,pe+Z+1,pe+1)};for(let oe=1;oe<129;oe++)for(let ae=1;ae<129;ae++)J(ae,oe);return[0,129].forEach(oe=>{for(let ae=0;ae<130;ae++)J(ae,oe),J(oe,ae)}),[N,j,32768]}(),E=o.context;this.gridBuffer=E.createVertexBuffer(g,s.bf.members),this.gridIndexBuffer=E.createIndexBuffer(b),this.gridSegments=s.bg.simpleSegment(0,0,g.length,b.length),this.gridNoSkirtSegments=s.bg.simpleSegment(0,0,g.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Wx(d.map),this.orthoMatrix=s.bC(),s.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.al,0,s.al,0,1);const I=E.gl;this._overlapStencilMode=new kr({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new fy(d.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,d,g){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);const b=o.terrain.properties,T=o.terrain.drapeRenderMode===0,E=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.o.now();const I=o.terrain&&o.terrain.scope,M=b.get("source"),N=T?this._mockSourceCache:o.getSourceCache(M,I);if(!N)return void s.w(`Couldn't find terrain source "${M}".`);if(this.sourceCache=N,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=E?this.calculateExaggeration(d):b.get("exaggeration"),!d.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;const j=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Z=this.getScaledDemTileSize();this.sourceCache.update(d,Z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,j(),this._initializing=!0),j(),d.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0,this._previousZoom=d.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);const d=this._previousCameraAltitude,g=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=g;const b=d!=null?g-d:Number.MAX_VALUE;if(Math.abs(b)<2)return this._exaggeration;const T=o.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(T);let I=T-this._previousZoom;const M=this._previousUpdateTimestamp;let N=T;this._evaluationZoom!=null&&(N=this._evaluationZoom,Math.abs(T-N)>.5&&(I=.5*(T-N+I)),I*b<0&&(N+=I)),this._evaluationZoom=N;const j=E.getExaggeration(N),Z=j===E.getExaggeration(Math.max(0,N-.1));if(Z&&Math.abs(j-this._exaggeration)<.01)return j;let W=Math.min(.1,.00375*(this._updateTimestamp-M));return(Z||j<.1||Math.abs(I)<1e-4)&&(W=Math.min(.2,4*W)),s.ak(this._exaggeration,j,W)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.dataType==="source"&&o.coord?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(s.ae.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=d.getIds().map(M=>{const N=d.getTileByID(M).tileID;return N.projMatrix=g.calculateProjMatrix(N.toUnwrapped()),N});(function(M,N){const j=N.transform.pointCoordinate(N.transform.getCameraPoint()),Z=new s.P(j.x,j.y);M.sort((W,Y)=>{if(Y.overscaledZ-W.overscaledZ)return Y.overscaledZ-W.overscaledZ;const te=new s.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),J=new s.P(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),oe=Z.mult(1<<W.canonical.z);return oe.x-=.5,oe.y-=.5,oe.distSqr(te)-oe.distSqr(J)})})(b,this.painter);const T=this.proxyToSource||{};this.proxyToSource={},b.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const M in E){const N=E[M];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,o[M],T),N.usedForTerrain))continue;const j=o[M];N.getSource().reparseOverscaled&&this._assignTerrainTiles(j)}this.proxiedCoords[d.id]=b.map(M=>new Zx(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const N=this.terrainTileForTile[M.key];if(!N)continue;const j=N.tileID.key;j in I||(this._visibleDemTiles.push(N),I[j]=j)}}_assignTerrainTiles(o){this._initializing||o.forEach(d=>{if(this.terrainTileForTile[d.key])return;const g=this._findTileCoveringTileID(d,this.sourceCache);g&&(this.terrainTileForTile[d.key]=g)})}_prepareDEMTextures(){const o=this.painter.context,d=o.gl;for(const g in this.terrainTileForTile){const b=this.terrainTileForTile[g],T=b.dem;!T||b.demTexture&&!b.needsDEMTextureUpload||(o.activeTexture.set(d.TEXTURE1),zx(this.painter,b,T))}}_prepareDemTileUniforms(o,d,g,b){if(!d||d.demTexture==null)return!1;const T=o.tileID.canonical,E=Math.pow(2,d.tileID.canonical.z-T.z),I=b||"";return g[`u_dem_tl${I}`]=[T.x*E%1,T.y*E%1],g[`u_dem_scale${I}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0;const d=this._visibleDemTiles.reduce((g,b)=>{if(!b.dem)return g;const T=b.dem.tree.minimums[0];return T>0&&o++,g+T},0);return o?d/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,d=o.gl;o.activeTexture.set(d.TEXTURE2);const g=this._getLoadedAreaMinimum(),b=new s.dL({width:1,height:1},new Float32Array([g]));this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(b,{premultiply:!1}):T=this._emptyDEMTexture=new s.T(o,b,d.R32F,{premultiply:!1}),T}setupElevationDraw(o,d,g){const b=this.painter.context,T=b.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let I=null,M=null,N=1;if(g&&g.morphing&&this._useVertexMorphing){const Y=g.morphing.srcDemTile,te=g.morphing.dstDemTile;N=g.morphing.phase,Y&&te&&(this._prepareDemTileUniforms(o,Y,E,"_prev")&&(M=Y),this._prepareDemTileUniforms(o,te,E)&&(I=te))}const j=Y=>Y&&Y.demTexture&&this.painter.linearFloatFilteringSupported()?T.LINEAR:T.NEAREST;let Z=null;var W;if(this.enabled?M&&I?(Z=I.demTexture,b.activeTexture.set(T.TEXTURE4),M.demTexture.bind(j(M),T.CLAMP_TO_EDGE),E.u_dem_lerp=N):(I=this.terrainTileForTile[o.tileID.key],Z=this._prepareDemTileUniforms(o,I,E)?I.demTexture:this.emptyDEMTexture):Z=this.emptyDEMTexture,b.activeTexture.set(T.TEXTURE2),Z&&(E.u_dem_size=(W=Z).size[0]===1?1:W.size[0]-2,Z.bind(j(I),T.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(g&&g.useDepthForOcclusion,d,E),g&&g.useMeterToDem&&I){const Y=(1<<I.tileID.canonical.z)*s.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=Y}if(g&&g.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),d.setTerrainUniformValues(b,E),this.painter.transform.projection.name==="globe"){const Y=this.globeUniformValues(this.painter.transform,o.tileID.canonical,g&&g.useDenormalizedUpVectorScale);d.setGlobeUniformValues(b,Y)}}globeUniformValues(o,d,g){const b=o.projection;return{u_tile_tl_up:b.upVector(d,0,0),u_tile_tr_up:b.upVector(d,s.al,0),u_tile_br_up:b.upVector(d,s.al,s.al),u_tile_bl_up:b.upVector(d,0,s.al),u_tile_up_scale:g?s.dM(1):b.upVectorScale(d,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const d=this.painter,g=this.painter.context;o.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,T,E,I,M){if(b.transform.projection.name==="globe")(function(N,j,Z,W,Y){const te=N.context,J=te.gl;let oe,ae;const pe=N.transform,_e=s.dE(N,te,pe),me=(ct,ht)=>{if(ae===ht)return;const St=[dy[ht],"PROJECTION_GLOBE_VIEW"];_e&&St.push("CUSTOM_ANTIALIASING");const Ut=N.isTileAffectedByFog(ct);oe=N.getOrCreateProgram("globeRaster",{defines:St,overrideFog:Ut}),ae=ht},Le=N.colorModeForRenderPass(),Ce=new zn(J.LEQUAL,zn.ReadWrite,N.depthRangeFor3D);Ed.update(Y);const Re=s.dF(pe),Ae=[s.aF(pe.center.lng),s.aJ(pe.center.lat)],Te=N.globeSharedBuffers,Fe=[pe.width*s.o.devicePixelRatio,pe.height*s.o.devicePixelRatio],Xe=Float32Array.from(pe.globeMatrix),He={useDenormalizedUpVectorScale:!0};{const ct=N.transform,ht=hy(ct.zoom,j.exaggeration(),j.sourceCache._source.tileSize);ae=-1;const St=J.TRIANGLES;for(const Ut of W){const rt=Z.getTile(Ut),Ue=kr.disabled,_t=j.prevTerrainTileForTile[Ut.key],lt=j.terrainTileForTile[Ut.key];G0(_t,lt)&&Ed.newMorphing(Ut.key,_t,lt,Y,250),Fp(N,rt.emissiveTexture),te.activeTexture.set(J.TEXTURE0),rt.texture&&rt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const Ot=Ed.getMorphValuesForProxy(Ut.key),en=Ot?1:0;Ot&&Object.assign(He,{morphing:{srcDemTile:Ot.from,dstDemTile:Ot.to,phase:s.dD(Ot.phase)}});const yn=s.dG(Ut.canonical),Yt=s.dH(yn.getCenter().lat),Ht=s.dI(Ut.canonical,yn,Yt,ct.worldSize/ct._pixelsPerMercatorPixel),Ln=s.bk(s.dJ(Ut.canonical)),In=N.emissiveMode==="mrt-fallback"?1:0,pn=cy(ct.expandedFarZProjMatrix,Xe,Re,Ln,s.aj(ct.zoom),Ae,ct.frustumCorners.TL,ct.frustumCorners.TR,ct.frustumCorners.BR,ct.frustumCorners.BL,ct.globeCenterInViewSpace,ct.globeRadius,Fe,ht,ct._farZ,In,Ht);if(me(Ut,en),oe&&(j.setupElevationDraw(rt,oe,He),N.uploadCommonUniforms(te,oe,Ut.toUnwrapped()),Te)){const[vn,er,Lr]=Te.getGridBuffers(Yt,ht!==0);oe.draw(N,St,Ce,Ue,Le,Cr.backCCW,pn,"globe_raster",vn,er,Lr)}}}if(Te&&(N.renderDefaultNorthPole||N.renderDefaultSouthPole)){const ct=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];_e&&ct.push("CUSTOM_ANTIALIASING"),oe=N.getOrCreateProgram("globeRaster",{defines:ct});for(const ht of W){const{x:St,y:Ut,z:rt}=ht.canonical,Ue=Ut===0,_t=Ut===(1<<rt)-1,[lt,Ot,en,yn]=Te.getPoleBuffers(rt,!1);if(yn&&(Ue||_t)){const Yt=Z.getTile(ht);Fp(N,Yt.emissiveTexture),te.activeTexture.set(J.TEXTURE0),Yt.texture&&Yt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let Ht=s.dK(rt,St,pe);const Ln=s.bk(s.dJ(ht.canonical)),In=N.emissiveMode==="mrt-fallback"?1:0,pn=(vn,er)=>vn.draw(N,J.TRIANGLES,Ce,kr.disabled,Le,Cr.disabled,cy(pe.expandedFarZProjMatrix,Ht,Ht,Ln,0,Ae,pe.frustumCorners.TL,pe.frustumCorners.TR,pe.frustumCorners.BR,pe.frustumCorners.BL,pe.globeCenterInViewSpace,pe.globeRadius,Fe,0,pe._farZ,In),"globe_pole_raster",er,en,yn);j.setupElevationDraw(Yt,oe,He),N.uploadCommonUniforms(te,oe,ht.toUnwrapped()),Ue&&N.renderDefaultNorthPole&&pn(oe,lt),_t&&N.renderDefaultSouthPole&&(Ht=s.cS(s.bC(),Ht,[1,-1,1]),pn(oe,Ot))}}}})(b,T,E,I,M);else{const N=b.context,j=N.gl;let Z,W;const Y=b.shadowRenderer,te=yh(b,b.longestCutoffRange),J=Le=>{if(W===Le)return;const Ce=[];Ce.push(dy[Le]),te.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF"),Y&&(Ce.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Y.useNormalOffset&&Ce.push("NORMAL_OFFSET")),Z=b.getOrCreateProgram("terrainRaster",{defines:Ce}),W=Le},oe=b.colorModeForRenderPass(),ae=new zn(j.LEQUAL,zn.ReadWrite,b.depthRangeFor3D);Ed.update(M);const pe=b.transform,_e=hy(pe.zoom,T.exaggeration(),T.sourceCache._source.tileSize);let me=[0,0,0];if(Y){const Le=b.style.directionalLight,Ce=b.style.ambientLight;Le&&Ce&&(me=Td(b.style,Le,Ce))}{W=-1;const Le=j.TRIANGLES,[Ce,Re]=[T.gridIndexBuffer,T.gridSegments];for(const Ae of I){const Te=E.getTile(Ae),Fe=kr.disabled,Xe=T.prevTerrainTileForTile[Ae.key],He=T.terrainTileForTile[Ae.key];G0(Xe,He)&&Ed.newMorphing(Ae.key,Xe,He,M,250),Fp(b,Te.emissiveTexture),N.activeTexture.set(j.TEXTURE0),Te.texture&&Te.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const ct=Ed.getMorphValuesForProxy(Ae.key),ht=ct?1:0;let St;ct&&(St={morphing:{srcDemTile:ct.from,dstDemTile:ct.to,phase:s.dD(ct.phase)}});const Ut=b.emissiveMode==="mrt-fallback"?1:0,rt=uu(Ae.projMatrix,qx(Ae.canonical,pe.renderWorldCopies)?_e/10:_e,me,Ut);if(J(ht),!Z)continue;T.setupElevationDraw(Te,Z,St);const Ue=Ae.toUnwrapped();Y&&Y.setupShadows(Ue,Z),b.uploadCommonUniforms(N,Z,Ue,null,te),Z.draw(b,Le,ae,Fe,oe,Cr.backCCW,rt,"terrain_raster",T.gridBuffer,Ce,Re)}}}}(d,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const d=this.painter,g=this.painter.context,b=this.proxySourceCache,T=this.proxiedCoords[b.id],E=this._drapedRenderBatches.shift(),I=d.style.order,M=[];this._updateFBOs(d.emissiveMode==="mrt-fallback");let N=0;for(const j of T){const Z=b.getTileByID(j.proxyTileKey),W=b.proxyCachedFBO[j.key]?b.proxyCachedFBO[j.key][o]:void 0,Y=W!==void 0?b.renderCache[W]:this.pool[N++],te=W!==void 0;if(Z.texture=Y.tex,Z.emissiveTexture=Y.emissiveTex,te&&!Y.dirty){M.push(Z.tileID);continue}g.bindFramebuffer.set(Y.fb.framebuffer);const J=g.gl;let oe;J.drawBuffers(d.emissiveMode==="mrt-fallback"?[J.COLOR_ATTACHMENT0,J.COLOR_ATTACHMENT1]:[J.COLOR_ATTACHMENT0]),this.renderedToTile=!1,Y.dirty&&(g.clear({color:s.ao.transparent,stencil:0}),Y.dirty=!1);for(let ae=E.start;ae<=E.end;++ae){const pe=d.style._mergedLayers[I[ae]];if(pe.isHidden(d.transform.zoom))continue;const _e=d.style.getLayerSourceCache(pe),me=_e?this.proxyToSource[j.key][_e.id]:[j];if(!me)continue;const Le=me;g.viewport.set([0,0,Y.fb.width,Y.fb.height]),oe!==(_e?_e.id:null)&&(this._setupStencil(Y,me,pe,_e),oe=_e?_e.id:null),d.renderLayer(d,_e,pe,Le)}if(J.drawBuffers([J.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const ae of this._pendingGroundEffectLayers){const pe=d.style._mergedLayers[I[ae]];if(pe.isHidden(d.transform.zoom))continue;const _e=d.style.getLayerSourceCache(pe),me=_e?this.proxyToSource[j.key][_e.id]:[j];if(!me)continue;const Le=me;g.viewport.set([0,0,Y.fb.width,Y.fb.height]),oe!==(_e?_e.id:null)&&(this._setupStencil(Y,me,pe,_e),oe=_e?_e.id:null),d.renderLayer(d,_e,pe,Le)}this.renderedToTile?(Y.dirty=!0,M.push(Z.tileID)):te||--N,N===5&&(N=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,d.width,d.height]),E.end+1}postRender(){}isLayerOrderingCorrect(o){const d=o.order.length;let g=-1,b=d;for(let T=0;T<d;++T)this._style.isLayerDraped(o._mergedLayers[o.order[T]])?g=Math.max(g,T):b=Math.min(b,T);return b>g}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{o=Math.min(o,d.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,d,g){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(T=>T.dem).map(T=>{const E=T.tileID,I=1<<E.overscaledZ,{x:M,y:N}=E.canonical,j=M/I,Z=(M+1)/I,W=N/I,Y=(N+1)/I;return{minx:j,miny:W,maxx:Z,maxy:Y,t:T.dem.tree.raycastRoot(j,W,Z,Y,o,d,g),tile:T}});b.sort((T,E)=>(T.t!==null?T.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const T of b){if(T.t==null)return null;const E=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,o,d,g);if(E!=null)return E}return null}_createFBO(){const o=this.painter.context,d=o.gl,g=this.drapeBufferSize;o.activeTexture.set(d.TEXTURE0);const b=new s.T(o,{width:g[0],height:g[1],data:null},d.RGBA8);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);const T=o.createFramebuffer(g[0],g[1],1,null);let E;return T.colorAttachment0.set(b.texture),this._emissiveTexture&&(E=new s.T(o,{width:g[0],height:g[1],data:null},d.R8),E.bind(d.LINEAR,d.CLAMP_TO_EDGE),T.createColorAttachment(o,1),T.colorAttachment1.set(E.texture)),T.depthAttachment=new vE(o,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:T,tex:b,emissiveTex:E,dirty:!1}}_updateFBOs(o){if(this._emissiveTexture!==o){for(const d of this.pool)this._updateFBO(d,o);for(const d of this.proxySourceCache.renderCache)this._updateFBO(d,o);this._emissiveTexture=o}}_updateFBO(o,d){const g=o.fb,b=this.painter.context,T=b.gl,E=this.drapeBufferSize;if(d){const I=new s.T(b,{width:E[0],height:E[1],data:null},T.R8);I.bind(T.LINEAR,T.CLAMP_TO_EDGE),o.emissiveTex=I,g.createColorAttachment(b,1),g.colorAttachment1.set(I.texture)}else o.emissiveTex=void 0,g.removeColorAttachment(b,1);o.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const d=this._style._mergedLayers[o],g=d.isHidden(this.painter.transform.zoom);return d.type==="hillshade"||d.type==="custom"?!g&&d.shouldRedrape():!g&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const g of this._style.getSources())if(g instanceof vd){o=!0;break}if(!o)return;const d={};for(let g=0;g<this._style.order.length;++g){const b=this._style._mergedLayers[this._style.order[g]],T=this._style.getLayerSourceCache(b);if(!T||d[T.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="line")continue;const E=b.widthExpression(),I=b.emissiveStrengthExpression();if(E instanceof s.ad||I instanceof s.ad){d[T.id]=!0;for(const M of this.proxyCoords){const N=this.proxyToSource[M.key][T.id];if(N)for(const j of N)this._clearRenderCacheForTile(T.id,j)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof bo){o=!0;break}if(!o)return;const d={};for(let g=0;g<this._style.order.length;++g){const b=this._style._mergedLayers[this._style.order[g]],T=this._style.getLayerSourceCache(b);if(!T||d[T.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;const E=b.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const M=this.proxyToSource[I.key][T.id];if(M)for(const N of M){const j=W0(T.getTile(N),T.findLoadedParent(N,0),T,this.painter.transform,E);(j.opacity!==1||j.mix!==0)&&this._clearRenderCacheForTile(T.id,N)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const o=this._style.order,d=o.length;if(d===0)return;const g=[];this._pendingGroundEffectLayers=[];let b,T=0,E=this._style._mergedLayers[o[T]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++T<d;)E=this._style._mergedLayers[o[T]];for(;T<d;++T){const I=this._style._mergedLayers[o[T]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?b===void 0&&(b=T):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(T),b!==void 0&&(g.push({start:b,end:T-1}),b=void 0)))}if(b!==void 0&&g.push({start:b,end:T-1}),g.length!==0){const I=g[g.length-1];this._pendingGroundEffectLayers.every(M=>M>I.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(o){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const E=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let I=0;I<E.length;++I){const M=Object.values(E[I]);d.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,b=this._tilesDirty;for(let E=g.length-1;E>=0;E--){const I=g[E];if(d.getTileByID(I.key),d.proxyCachedFBO[I.key]!==void 0){const M=o[I.key],N=this.proxyToSource[I.key];let j=0;for(const Z in N){const W=N[Z],Y=M[Z];if(!Y||Y.length!==W.length||W.some((te,J)=>te!==Y[J]||b[Z]&&b[Z].hasOwnProperty(te.key))){j=-1;break}++j}for(const Z in d.proxyCachedFBO[I.key])d.renderCache[d.proxyCachedFBO[I.key][Z]].dirty=j<0||j!==Object.values(M).length}}const T=[...this._drapedRenderBatches];T.sort((E,I)=>I.end-I.start-(E.end-E.start));for(const E of T)for(const I of g){if(d.proxyCachedFBO[I.key])continue;let M=d.renderCachePool.pop();M===void 0&&d.renderCache.length<50&&(M=d.renderCache.length,d.renderCache.push(this._createFBO())),M!==void 0&&(d.proxyCachedFBO[I.key]={},d.proxyCachedFBO[I.key][E.start]=M,d.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(o,d,g,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,E=T.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let I;if(g.isTileClipped())I=d.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):kr.disabled}_renderTileClippingMasks(o,d){const g=this.painter,b=this.painter.context,T=b.gl;g._tileClippingMaskIDs={},b.setColorMode(jr.disabled),b.setDepthMode(zn.disabled);const E=g.getOrCreateProgram("clippingMask");for(const I of o){const M=g._tileClippingMaskIDs[I.key]=--d;E.draw(g,T.TRIANGLES,zn.disabled,new kr({func:T.ALWAYS,mask:0},M,255,T.KEEP,T.KEEP,T.REPLACE),jr.disabled,Cr.disabled,q0(I.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(o){const d=this.painter.transform;if(o.x<0||o.x>d.width||o.y<0||o.y>d.height)return null;const g=[o.x,o.y,1,1];s.aC(g,g,d.pixelMatrixInverse),s.cK(g,g,1/g[3]),g[0]/=d.worldSize,g[1]/=d.worldSize;const b=d._camera.position,T=s.cf(1,d.center.lat),E=[b[0],b[1],b[2]/T,0],I=s.da([],g.slice(0,3),E);s.aw(I,I);const M=this.raycast(E,I,this._exaggeration);return M!==null&&M?(s.bH(E,E,I,M),E[3]=E[2],E[2]*=T,E):null}_setupProxiedCoordsForOrtho(o,d,g){if(o.getSource()instanceof s.aU)return this._setupProxiedCoordsForImageSource(o,d,g);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const b=this.proxiedCoords[o.id]=[],T=this.proxyCoords;for(let M=0;M<T.length;M++){const N=T[M],j=this._findTileCoveringTileID(N,o);if(j){const Z=this._createProxiedId(N,j,g[N.key]&&g[N.key][o.id]);b.push(Z),this.proxyToSource[N.key][o.id]=[Z]}}let E=!1;const I=new Set;for(let M=0;M<d.length;M++){const N=o.getTile(d[M]);if(!N||!N.hasData())continue;const j=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(j&&j.tileID.canonical.z!==N.tileID.canonical.z){const Z=this.proxyToSource[j.tileID.key][o.id],W=this._createProxiedId(j.tileID,N,g[j.tileID.key]&&g[j.tileID.key][o.id]);Z?Z.splice(Z.length-1,0,W):this.proxyToSource[j.tileID.key][o.id]=[W];const Y=this.proxyToSource[j.tileID.key][o.id];I.has(Y)||I.add(Y),b.push(W),E=!0}}if(this._sourceTilesOverlap[o.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const M of I)M.sort((N,j)=>j.overscaledZ-N.overscaledZ)}_setupProxiedCoordsForImageSource(o,d,g){if(!o.getSource().loaded())return;const b=this.proxiedCoords[o.id]=[],T=this.proxyCoords,E=o.getSource(),I=E.tileID;if(!I)return;const M=new s.P(I.x,I.y)._div(1<<I.z),N=E.coordinates.map(s.ae.fromLngLat).reduce((Z,W)=>(Z.min.x=Math.min(Z.min.x,W.x-M.x),Z.min.y=Math.min(Z.min.y,W.y-M.y),Z.max.x=Math.max(Z.max.x,W.x-M.x),Z.max.y=Math.max(Z.max.y,W.y-M.y),Z),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),j=(Z,W)=>{const Y=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),te=Z.canonical.y/(1<<Z.canonical.z),J=s.al/(1<<Z.canonical.z),oe=W.wrap+W.canonical.x/(1<<W.canonical.z),ae=W.canonical.y/(1<<W.canonical.z);return Y+J<oe+N.min.x||Y>oe+N.max.x||te+J<ae+N.min.y||te>ae+N.max.y};for(let Z=0;Z<T.length;Z++){const W=T[Z];for(let Y=0;Y<d.length;Y++){const te=o.getTile(d[Y]);if(!te||!te.hasData()||j(W,te.tileID))continue;const J=this._createProxiedId(W,te,g[W.key]&&g[W.key][o.id]),oe=this.proxyToSource[W.key][o.id];oe?oe.push(J):this.proxyToSource[W.key][o.id]=[J],b.push(J)}}}_createProxiedId(o,d,g){let b=this.orthoMatrix;if(g){const T=g.find(E=>E.key===d.tileID.key);if(T)return T}if(d.tileID.key!==o.key){const T=o.canonical.z-d.tileID.canonical.z;let E,I,M;b=s.bC();const N=d.tileID.wrap-o.wrap<<o.overscaledZ;T>0?(E=s.al>>T,I=E*((d.tileID.canonical.x<<T)-o.canonical.x+N),M=E*((d.tileID.canonical.y<<T)-o.canonical.y)):(E=s.al<<-T,I=s.al*(d.tileID.canonical.x-(o.canonical.x+N<<-T)),M=s.al*(d.tileID.canonical.y-(o.canonical.y<<-T))),s.ce(b,0,E,0,E,0,1),s.br(b,b,[I,M,0])}return new Zx(d.tileID,o.key,b)}_findTileCoveringTileID(o,d){let g=d.getTile(o);if(g&&g.hasData())return g;const b=this._findCoveringTileCache[d.id],T=b[o.key];if(g=T?d.getTileByID(T):null,g&&g.hasData()||T===null)return g;let E=g?g.tileID:o,I=E.overscaledZ;const M=d.getSource().minzoom,N=[];if(!T){const Z=d.getSource().maxzoom;if(o.canonical.z>=Z){const W=o.canonical.z-Z;d.getSource().reparseOverscaled?(I=Math.max(o.canonical.z+2,d.transform.tileZoom),E=new s.aQ(I,o.wrap,Z,o.canonical.x>>W,o.canonical.y>>W)):W!==0&&(I=Z,E=new s.aQ(I,o.wrap,Z,o.canonical.x>>W,o.canonical.y>>W))}E.key!==o.key&&(N.push(E.key),g=d.getTile(E))}const j=Z=>{N.forEach(W=>{b[W]=Z}),N.length=0};for(I-=1;I>=M&&(!g||!g.hasData());I--){g&&j(g.tileID.key);const Z=E.calculateScaledKey(I);if(g=d.getTileByID(Z),g&&g.hasData())break;const W=b[Z];if(W===null)break;W===void 0?N.push(Z):g=d.getTileByID(W)}return j(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,d){let g=this._tilesDirty[o];g||(g=this._tilesDirty[o]={}),g[d.key]=!0}}function Bp(m,o,d){const g=function(I,M,N){const j=s.bJ(M,I),Z=s.bJ(N,[.2126,.7152,.0722]),W=(te,J,oe)=>(1-oe)*te+oe*J,Y=W(1-.3*Math.min(Z,1),1,Math.min(j+1,1));return W(.92,1,Math.asin(s.aA(M[2],-1,1))/Math.PI+.5)*Y}(m,[0,0,1],o),b=[0,0,0];s.c5(b,d.slice(0,3),g);const T=[0,0,0];s.c5(T,o.slice(0,3),m[2]);const E=[0,0,0];return s.d8(E,b,T),s.db(E)}const qk=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Wk=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class xE{static cacheKey(o,d,g,b){const T=[d];b&&T.push(b.cacheKey);for(const E of g)o.usedDefines.has(E)&&T.push(E);return T.join("/")}constructor(o,d,g,b,T,E){const I=o.gl;this.program=I.createProgram(),this.configuration=b,this.name=d,this.fixedDefines=[...E];const M=`#version 300 es
${(b?b.defines():[]).concat(E.map(J=>`#define ${J}`)).join(`
`)}`,N=[M,zk];for(const J of g.fragmentIncludes)N.push(wh[J]);N.push(g.fragmentSource);const j=N.join(`
`),Z=[M,cE];for(const J of g.vertexIncludes)Z.push(wh[J]);this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&g.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&Z.push("uniform int u_instanceID;"),Z.push(g.vertexSource);let W=Z.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(W=W.replaceAll("gl_InstanceID","u_instanceID"));const Y=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(Y,j),I.compileShader(Y),I.attachShader(this.program,Y);const te=I.createShader(I.VERTEX_SHADER);I.isContextLost()?this.failedToCreate=!0:(I.shaderSource(te,W),I.compileShader(te),I.attachShader(this.program,te),this.attributes={},I.linkProgram(this.program),I.deleteShader(te),I.deleteShader(Y),this.fixedUniforms=T(o),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=b?b.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(J=>({u_instanceID:new s.ch(J)}))(o)),(E.includes("TERRAIN")||d.includes("symbol")||d.includes("circle"))&&(this.terrainUniforms=(J=>({u_dem:new s.ch(J),u_dem_prev:new s.ch(J),u_dem_tl:new s.ck(J),u_dem_scale:new s.cj(J),u_dem_tl_prev:new s.ck(J),u_dem_scale_prev:new s.cj(J),u_dem_size:new s.cj(J),u_dem_lerp:new s.cj(J),u_exaggeration:new s.cj(J),u_depth:new s.ch(J),u_depth_size_inv:new s.ck(J),u_depth_range_unpack:new s.ck(J),u_occluder_half_size:new s.cj(J),u_occlusion_depth_offset:new s.cj(J),u_meter_to_dem:new s.cj(J),u_label_plane_matrix_inv:new s.cl(J)}))(o)),E.includes("GLOBE")&&(this.globeUniforms=(J=>({u_tile_tl_up:new s.ci(J),u_tile_tr_up:new s.ci(J),u_tile_br_up:new s.ci(J),u_tile_bl_up:new s.ci(J),u_tile_up_scale:new s.cj(J)}))(o)),E.includes("FOG")&&(this.fogUniforms=(J=>({u_fog_matrix:new s.cl(J),u_fog_range:new s.ck(J),u_fog_color:new s.d3(J),u_fog_horizon_blend:new s.cj(J),u_fog_vertical_limit:new s.ck(J),u_fog_temporal_offset:new s.cj(J),u_frustum_tl:new s.ci(J),u_frustum_tr:new s.ci(J),u_frustum_br:new s.ci(J),u_frustum_bl:new s.ci(J),u_globe_pos:new s.ci(J),u_globe_radius:new s.cj(J),u_globe_transition:new s.cj(J),u_is_globe:new s.ch(J),u_viewport:new s.ck(J)}))(o)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(J=>({u_cutoff_params:new s.d3(J)}))(o)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(J=>({u_lighting_ambient_color:new s.ci(J),u_lighting_directional_dir:new s.ci(J),u_lighting_directional_color:new s.ci(J),u_ground_radiance:new s.ci(J)}))(o)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(J=>({u_light_matrix_0:new s.cl(J),u_light_matrix_1:new s.cl(J),u_fade_range:new s.ck(J),u_shadow_normal_offset:new s.ci(J),u_shadow_intensity:new s.cj(J),u_shadow_texel_size:new s.cj(J),u_shadow_map_resolution:new s.cj(J),u_shadow_direction:new s.ci(J),u_shadow_bias:new s.ci(J),u_shadowmap_0:new s.ch(J),u_shadowmap_1:new s.ch(J)}))(o)))}getAttributeLocation(o,d){let g=this.attributes[d];return g===void 0&&(g=this.attributes[d]=o.getAttribLocation(this.program,d)),g}setTerrainUniformValues(o,d){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in d)g[b]&&g[b].set(this.program,b,d[b])}}setGlobeUniformValues(o,d){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in d)g[b]&&g[b].set(this.program,b,d[b])}}setFogUniformValues(o,d){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in d)g[b].set(this.program,b,d[b])}}setCutoffUniformValues(o,d){if(!this.cutoffUniforms)return;const g=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in d)g[b].set(this.program,b,d[b])}}setLightsUniformValues(o,d){if(!this.lightsUniforms)return;const g=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const b in d)g[b].set(this.program,b,d[b])}}setShadowUniformValues(o,d){if(this.failedToCreate||!this.shadowUniforms)return;const g=this.shadowUniforms;o.program.set(this.program);for(const b in d)g[b].set(this.program,b,d[b])}_drawDebugWireframe(o,d,g,b,T,E,I,M,N,j){const Z=o.options.wireframe;if(Z.terrain===!1&&Z.layers2D===!1&&Z.layers3D===!1)return;const W=o.context;if(!(!(!Z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Z.layers2D||o._terrain&&o._terrain.renderingToTexture||!qk.includes(this.name))||!(!Z.layers3D||!Wk.includes(this.name))))return;const Y=W.gl,te=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,T,W);if(!te)return;const J=[...this.fixedDefines,"DEBUG_WIREFRAME"],oe=o.getOrCreateProgram(this.name,{config:this.configuration,defines:J});W.program.set(oe.program);const ae=(me,Le,Ce)=>{if(Le[me]&&Ce[me])for(const Re in Le[me])Ce[me][Re]&&Ce[me][Re].set(Ce.program,Re,Le[me][Re].current)};N&&N.setUniforms(oe.program,W,oe.binderUniforms,I,{zoom:M}),ae("fixedUniforms",this,oe),ae("terrainUniforms",this,oe),ae("globeUniforms",this,oe),ae("fogUniforms",this,oe),ae("lightsUniforms",this,oe),ae("shadowUniforms",this,oe),te.bind(),W.setColorMode(new jr([Y.ONE,Y.ONE_MINUS_SRC_ALPHA,Y.ZERO,Y.ONE],s.ao.transparent,[!0,!0,!0,!1])),W.setDepthMode(new zn(d.func===Y.LESS?Y.LEQUAL:d.func,zn.ReadOnly,d.range)),W.setStencilMode(kr.disabled);const pe=3*E.primitiveLength*2,_e=3*E.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const me=j||1;for(let Le=0;Le<me;++Le)oe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Le),Y.drawElements(Y.LINES,pe,Y.UNSIGNED_SHORT,_e)}else j&&j>1?Y.drawElementsInstanced(Y.LINES,pe,Y.UNSIGNED_SHORT,_e,j):Y.drawElements(Y.LINES,pe,Y.UNSIGNED_SHORT,_e);T.bind(),W.program.set(this.program),W.setDepthMode(d),W.setStencilMode(g),W.setColorMode(b)}checkUniforms(o,d,g){if(this.fixedDefines.includes(d)){for(const b of Object.keys(g))if(!g[b].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${b} not set but required by ${d} being defined`)}}draw(o,d,g,b,T,E,I,M,N,j,Z,W,Y,te,J,oe){const ae=o.context,pe=ae.gl;if(this.failedToCreate)return;ae.program.set(this.program),ae.setDepthMode(g),ae.setStencilMode(b),ae.setColorMode(T),ae.setCullFace(E);for(const[Ae,Te]of this.fixedUniformsEntries)Te.set(this.program,Ae,I[Ae]);te&&te.setUniforms(this.program,ae,this.binderUniforms,W,{zoom:Y});const _e={[pe.POINTS]:1,[pe.LINES]:2,[pe.TRIANGLES]:3,[pe.LINE_STRIP]:1}[d];this.checkUniforms(M,"RENDER_SHADOWS",this.shadowUniforms);const me=J||[],Le=te?te.getPaintVertexBuffers():[],Ce=d===pe.TRIANGLES&&j,Re=oe&&oe>0?1:void 0;for(const Ae of Z.get()){const Te=Ae.vaos||(Ae.vaos={});if((Te[M]||(Te[M]=new Fk)).bind(ae,this,N,Le,j,Ae.vertexOffset,me,Re),this.forceManualRenderingForInstanceIDShaders){const Fe=oe||1;for(let Xe=0;Xe<Fe;++Xe)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Xe),j?pe.drawElements(d,Ae.primitiveLength*_e,pe.UNSIGNED_SHORT,Ae.primitiveOffset*_e*2):pe.drawArrays(d,Ae.vertexOffset,Ae.vertexLength)}else oe&&oe>1?pe.drawElementsInstanced(d,Ae.primitiveLength*_e,pe.UNSIGNED_SHORT,Ae.primitiveOffset*_e*2,oe):j?pe.drawElements(d,Ae.primitiveLength*_e,pe.UNSIGNED_SHORT,Ae.primitiveOffset*_e*2):pe.drawArrays(d,Ae.vertexOffset,Ae.vertexLength);Ce&&this._drawDebugWireframe(o,g,b,T,j,Ae,W,Y,te,oe)}}}function bE(m,o,d=0){const g=Math.pow(2,o.tileID.overscaledZ),b=o.tileSize*Math.pow(2,m.transform.tileZoom)/g,T=b*(o.tileID.canonical.x+o.tileID.wrap*g),E=b*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(o,1,m.transform.tileZoom),u_pixel_coord_upper:[T>>16,E>>16],u_pixel_coord_lower:[65535&T,65535&E],u_pattern_transition:d}}const py={terrain:0,flat:1},Zk=s.bC(),my=(m,o,d,g,b,T,E,I,M,N,j,Z,W,Y,te,J,oe,ae)=>{const pe=o.style.light,_e=pe.properties.get("position"),me=[_e.x,_e.y,_e.z],Le=s.dO();pe.properties.get("anchor")==="viewport"&&(s.dP(Le,-o.transform.angle),s.dQ(me,me,Le));const Ce=pe.properties.get("color").toPremultipliedRenderColor(null),Re=o.transform,Ae={u_matrix:m,u_lightpos:me,u_lightintensity:pe.properties.get("intensity"),u_lightcolor:[Ce.r,Ce.g,Ce.b],u_vertical_gradient:+d,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Zk,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:py[N],u_base_type:py[j],u_ao:b,u_edge_radius:T,u_width_scale:E,u_flood_light_color:te,u_vertical_scale:J,u_flood_light_intensity:oe,u_ground_shadow_factor:ae};return Re.projection.name==="globe"&&(Ae.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],Ae.u_zoom_transition=Z,Ae.u_inv_rot_matrix=Y,Ae.u_merc_center=W,Ae.u_up_dir=Re.projection.upVector(new s.cD(0,0,0),W[0]*s.al,W[1]*s.al),Ae.u_height_lift=M),Ae},Yx=(m,o,d,g,b,T)=>({u_matrix:m,u_edge_radius:o,u_width_scale:d,u_vertical_scale:g,u_height_type:py[b],u_base_type:py[T]}),wE=(m,o,d,g,b,T,E,I,M,N,j,Z,W,Y,te,J,oe,ae)=>{const pe=my(m,o,d,g,b,T,E,I,N,j,Z,W,Y,te,J,oe,1,[0,0,0]),_e={u_height_factor:-Math.pow(2,I.overscaledZ)/M.tileSize/8};return Object.assign(pe,bE(o,M,ae),_e)},jp=(m,o,d,g,b,T,E,I,M,N,j)=>({u_matrix:o,u_opacity:d,u_ao_pass:g?1:0,u_meter_to_tile:b,u_ao:T,u_flood_light_intensity:E,u_flood_light_color:I,u_attenuation:M,u_edge_radius:N,u_fb:0,u_fb_size:j,u_dynamic_offset:1}),Kx=(m,o,d)=>({u_matrix:m,u_emissive_strength:o,u_ground_shadow_factor:d}),Qx=(m,o,d,g,b,T=0)=>Object.assign(Kx(m,o,b),bE(d,g,T)),TE=(m,o,d,g)=>({u_matrix:m,u_world:d,u_emissive_strength:o,u_ground_shadow_factor:g}),Jx=(m,o,d,g,b,T,E=0)=>Object.assign(Qx(m,o,d,g,T,E),{u_world:b}),Eh=(m,o)=>({u_matrix:m,u_ground_shadow_factor:o}),Cf=(m,o,d,g,b)=>({u_matrix:m,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:d,u_height_scale:g,u_reset_depth:b}),gy=(m,o,d,g,b,T,E,I,M)=>({u_matrix:m,u_normal_matrix:o,u_opacity:d,u_faux_facade_ao_intensity:g,u_camera_pos:b,u_tile_to_meter:T,u_facade_emissive_chance:E,u_flood_light_color:I,u_flood_light_intensity:M}),EE=m=>({u_matrix:m}),Sh=m=>({u_matrix:m}),eb=(m,o,d,g,b,T,E,I)=>{const M=s.al/T.tileSize;return{u_matrix:m,u_inv_rot_matrix:o,u_camera_to_center_distance:d.getCameraToCenterDistance(I),u_extrude_scale:[d.pixelsToGLUnits[0]/M,d.pixelsToGLUnits[1]/M],u_zoom_transition:g,u_tile_id:E,u_merc_center:b}},Z0=(m,o,d=1)=>({u_matrix:m,u_color:o,u_overlay:0,u_overlay_scale:d}),SE=s.bC(),AE=(m,o,d,g,b,T,E)=>{const I=m.transform,M=I.projection.name==="globe",N=M?s.dR(I.zoom,o.canonical)*I._pixelsPerMercatorPixel:s.ay(d,1,T),j={u_matrix:o.projMatrix,u_extrude_scale:N,u_intensity:E,u_inv_rot_matrix:SE,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){j.u_inv_rot_matrix=g,j.u_merc_center=b,j.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],j.u_zoom_transition=s.aj(I.zoom);const Z=b[0]*s.al,W=b[1]*s.al;j.u_up_dir=I.projection.upVector(new s.cD(0,0,0),Z,W)}return j};function _y(m,[o,d,g,b],[T,E]){if(T===E)return[0,0,0,0];const I=255*(m-1)/(m*(E-T));return[o*I,d*I,g*I,b*I]}function yy(m,o,[d,g]){return d===g?0:.5/m+(o-d)*(m-1)/(m*(g-d))}const CE=(m,o,d,g,b,T,E,I,M,N,j,Z,W,Y,te,J,oe,ae,pe,_e,me)=>({u_matrix:m,u_normalize_matrix:o,u_globe_matrix:d,u_merc_matrix:g,u_grid_matrix:b,u_tl_parent:T,u_scale_parent:N,u_fade_t:j.mix,u_opacity:j.opacity*Z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Z.paint.get("raster-brightness-min"),u_brightness_high:Z.paint.get("raster-brightness-max"),u_saturation_factor:s.dT(Z.paint.get("raster-saturation")),u_contrast_factor:s.dS(Z.paint.get("raster-contrast")),u_spin_weights:kE(Z.paint.get("raster-hue-rotate")),u_perspective_transform:W,u_raster_elevation:Y,u_zoom_transition:E,u_merc_center:I,u_cutoff_params:M,u_colorization_mix:_y(s.dU,J,ae),u_colorization_offset:yy(s.dU,oe,ae),u_color_ramp:te,u_texture_offset:[_e/(pe+2*_e),pe/(pe+2*_e)],u_texture_res:[pe+2*_e,pe+2*_e],u_emissive_strength:me});function kE(m){m*=Math.PI/180;const o=Math.sin(m),d=Math.cos(m);return[(2*d+1)/3,(-Math.sqrt(3)*o-d+1)/3,(Math.sqrt(3)*o-d+1)/3]}const qc=.05,Xk=(m,o,d,g,b,T,E,I,M,N,j,Z)=>({u_matrix:m,u_normalize_matrix:o,u_globe_matrix:d,u_merc_matrix:g,u_grid_matrix:b,u_tl_parent:T,u_scale_parent:N,u_fade_t:j.mix,u_opacity:j.opacity,u_image0:0,u_image1:1,u_raster_elevation:Z,u_zoom_transition:E,u_merc_center:I,u_cutoff_params:M}),Yk=(m,o,d,g,b,T,E,I,M,N)=>({u_particle_texture:m,u_particle_texture_side_len:o,u_tile_offset:d,u_velocity:g,u_color_ramp:T,u_velocity_res:b,u_max_speed:E,u_uv_offset:I,u_data_scale:[255*M[0],255*M[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[qc,qc]}),IE=(m,o,d,g,b,T,E,I,M,N)=>({u_particle_texture:m,u_particle_texture_side_len:o,u_velocity:d,u_velocity_res:g,u_max_speed:b,u_speed_factor:T,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*M[0],255*M[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[qc,qc]}),RE=s.bC(),vy=(m,o,d,g,b,T,E,I,M,N,j,Z,W,Y,te,J,oe,ae,pe,_e,me,Le,Ce,Re)=>{const Ae=b.transform,Te={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:Ae.getCameraToCenterDistance(pe),u_rotate_symbol:+d,u_aspect_ratio:Ae.width/Ae.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:E,u_coord_matrix:I,u_is_text:+N,u_elevation_from_sea:M?1:0,u_pitch_with_map:+g,u_texsize:j,u_texsize_icon:Z,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:RE,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:RE,u_up_vector:[0,-1,0],u_color_adj_mat:Le,u_icon_transition:Ce||0,u_gamma_scale:g?b.transform.getCameraToCenterDistance(pe)*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:s.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Re||1,u_ground_shadow_factor:_e,u_inv_matrix:s.bl(s.bC(),E),u_normal_scale:me,u_lutTexture:wo.LUT};return pe.name==="globe"&&(Te.u_tile_id=[Y.canonical.x,Y.canonical.y,1<<Y.canonical.z],Te.u_zoom_transition=te,Te.u_inv_rot_matrix=oe,Te.u_merc_center=J,Te.u_camera_forward=Ae._camera.forward(),Te.u_ecef_origin=s.dV(Ae.globeMatrix,Y.toUnwrapped()),Te.u_tile_matrix=Float32Array.from(Ae.globeMatrix),Te.u_up_vector=ae),Te},X0=(m,o,d,g)=>({u_matrix:m,u_emissive_strength:o,u_opacity:d,u_color:g}),Ah=(m,o,d,g,b,T,E,I,M)=>Object.assign(function(N,j,Z,W,Y,te){const{width:J,height:oe}=W.imageManager.getPixelSize(j),ae=Math.pow(2,te.tileID.overscaledZ),pe=te.tileSize*Math.pow(2,W.transform.tileZoom)/ae,_e=pe*(te.tileID.canonical.x+te.tileID.wrap*ae),me=pe*te.tileID.canonical.y;return{u_image:0,u_pattern_tl:Z.tl,u_pattern_br:Z.br,u_texsize:[J,oe],u_pattern_size:Z.displaySize,u_pattern_units_to_pixels:Y?[W.transform.width,-1*W.transform.height]:[1/s.ay(te,1,W.transform.tileZoom),1/s.ay(te,1,W.transform.tileZoom)],u_pixel_coord_upper:[_e>>16,me>>16],u_pixel_coord_lower:[65535&_e,65535&me]}}(0,T,E,g,I,M),{u_matrix:m,u_emissive_strength:o,u_opacity:d}),Up=new Float32Array(s.bA([])),kf=(m,o,d,g,b,T,E,I,M,N,j,Z,W,Y=[0,0,0],te,J,oe)=>{const ae=b.style.light,pe=ae.properties.get("position"),_e=[-pe.x,-pe.y,pe.z],me=s.dO();ae.properties.get("anchor")==="viewport"&&(s.dP(me,-b.transform.angle),s.dQ(_e,_e,me));const Le=j.alphaMode==="MASK",Ce=ae.properties.get("color").toNonPremultipliedRenderColor(null),Re=W.paint.get("model-ambient-occlusion-intensity"),Ae=W.paint.get("model-color").constantOr(s.ao.white).toNonPremultipliedRenderColor(null);return Ae.a=W.paint.get("model-color-mix-intensity").constantOr(0),oe&&(Ae.r=oe[0],Ae.g=oe[1],Ae.b=oe[2],Ae.a=oe[3]),J&&(Ae.r=J.color.r,Ae.g=J.color.g,Ae.b=J.color.b,Ae.a=J.colorMix,Z=J.emissionStrength,T*=J.opacity),{u_matrix:m,u_lighting_matrix:o,u_normal_matrix:d,u_node_matrix:g||Up,u_lightpos:_e,u_lightintensity:ae.properties.get("intensity"),u_lightcolor:[Ce.r,Ce.g,Ce.b],u_camera_pos:Y,u_opacity:T,u_baseTextureIsAlpha:0,u_alphaMask:+Le,u_alphaCutoff:j.alphaCutoff,u_baseColorFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:I.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:M,u_roughnessFactor:N,u_baseColorTexture:wo.BaseColor,u_metallicRoughnessTexture:wo.MetallicRoughness,u_normalTexture:wo.Normal,u_occlusionTexture:wo.Occlusion,u_emissionTexture:wo.Emission,u_lutTexture:wo.LUT,u_color_mix:Ae.toArray01(),u_aoIntensity:Re,u_emissive_strength:Z,u_occlusionTextureTransform:te||[0,0,0,0]}},tb=(m,o=Up,d=Up)=>({u_matrix:m,u_instance:o,u_node_matrix:d}),xy={fillExtrusion:m=>({u_matrix:new s.cl(m),u_lightpos:new s.ci(m),u_lightintensity:new s.cj(m),u_lightcolor:new s.ci(m),u_vertical_gradient:new s.cj(m),u_opacity:new s.cj(m),u_edge_radius:new s.cj(m),u_width_scale:new s.cj(m),u_ao:new s.ck(m),u_height_type:new s.ch(m),u_base_type:new s.ch(m),u_tile_id:new s.ci(m),u_zoom_transition:new s.cj(m),u_inv_rot_matrix:new s.cl(m),u_merc_center:new s.ck(m),u_up_dir:new s.ci(m),u_height_lift:new s.cj(m),u_flood_light_color:new s.ci(m),u_vertical_scale:new s.cj(m),u_flood_light_intensity:new s.cj(m),u_ground_shadow_factor:new s.ci(m)}),fillExtrusionDepth:m=>({u_matrix:new s.cl(m),u_edge_radius:new s.cj(m),u_width_scale:new s.cj(m),u_vertical_scale:new s.cj(m),u_height_type:new s.ch(m),u_base_type:new s.ch(m)}),fillExtrusionPattern:m=>({u_matrix:new s.cl(m),u_lightpos:new s.ci(m),u_lightintensity:new s.cj(m),u_lightcolor:new s.ci(m),u_vertical_gradient:new s.cj(m),u_height_factor:new s.cj(m),u_edge_radius:new s.cj(m),u_width_scale:new s.cj(m),u_ao:new s.ck(m),u_height_type:new s.ch(m),u_base_type:new s.ch(m),u_tile_id:new s.ci(m),u_zoom_transition:new s.cj(m),u_inv_rot_matrix:new s.cl(m),u_merc_center:new s.ck(m),u_up_dir:new s.ci(m),u_height_lift:new s.cj(m),u_image:new s.ch(m),u_texsize:new s.ck(m),u_pixel_coord_upper:new s.ck(m),u_pixel_coord_lower:new s.ck(m),u_tile_units_to_pixels:new s.cj(m),u_opacity:new s.cj(m),u_pattern_transition:new s.cj(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new s.cl(m),u_opacity:new s.cj(m),u_ao_pass:new s.cj(m),u_meter_to_tile:new s.cj(m),u_ao:new s.ck(m),u_flood_light_intensity:new s.cj(m),u_flood_light_color:new s.ci(m),u_attenuation:new s.cj(m),u_edge_radius:new s.cj(m),u_fb:new s.ch(m),u_fb_size:new s.cj(m),u_dynamic_offset:new s.cj(m)}),fill:m=>({u_matrix:new s.cl(m),u_emissive_strength:new s.cj(m),u_ground_shadow_factor:new s.ci(m)}),fillPattern:m=>({u_matrix:new s.cl(m),u_emissive_strength:new s.cj(m),u_image:new s.ch(m),u_texsize:new s.ck(m),u_pixel_coord_upper:new s.ck(m),u_pixel_coord_lower:new s.ck(m),u_tile_units_to_pixels:new s.cj(m),u_ground_shadow_factor:new s.ci(m),u_pattern_transition:new s.cj(m)}),fillOutline:m=>({u_matrix:new s.cl(m),u_emissive_strength:new s.cj(m),u_world:new s.ck(m),u_ground_shadow_factor:new s.ci(m)}),fillOutlinePattern:m=>({u_matrix:new s.cl(m),u_emissive_strength:new s.cj(m),u_world:new s.ck(m),u_image:new s.ch(m),u_texsize:new s.ck(m),u_pixel_coord_upper:new s.ck(m),u_pixel_coord_lower:new s.ck(m),u_tile_units_to_pixels:new s.cj(m),u_ground_shadow_factor:new s.ci(m),u_pattern_transition:new s.cj(m)}),building:m=>({u_matrix:new s.cl(m),u_normal_matrix:new s.cl(m),u_opacity:new s.cj(m),u_faux_facade_ao_intensity:new s.cj(m),u_camera_pos:new s.ci(m),u_tile_to_meter:new s.cj(m),u_facade_emissive_chance:new s.cj(m),u_flood_light_color:new s.ci(m),u_flood_light_intensity:new s.cj(m)}),buildingBloom:m=>({u_matrix:new s.cl(m)}),buildingDepth:m=>({u_matrix:new s.cl(m)}),elevatedStructuresDepth:m=>({u_matrix:new s.cl(m),u_depth_bias:new s.cj(m)}),elevatedStructures:m=>({u_matrix:new s.cl(m),u_ground_shadow_factor:new s.ci(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new s.cl(m),u_camera_pos:new s.ci(m),u_depth_bias:new s.cj(m),u_height_scale:new s.cj(m),u_reset_depth:new s.cj(m)}),circle:s.dY,collisionBox:m=>({u_matrix:new s.cl(m),u_inv_rot_matrix:new s.cl(m),u_camera_to_center_distance:new s.cj(m),u_extrude_scale:new s.ck(m),u_zoom_transition:new s.cj(m),u_merc_center:new s.ck(m),u_tile_id:new s.ci(m)}),collisionCircle:m=>({u_matrix:new s.cl(m),u_inv_matrix:new s.cl(m),u_camera_to_center_distance:new s.cj(m),u_viewport_size:new s.ck(m)}),debug:m=>({u_color:new s.dB(m),u_matrix:new s.cl(m),u_overlay:new s.ch(m),u_overlay_scale:new s.cj(m)}),clippingMask:m=>({u_matrix:new s.cl(m)}),heatmap:m=>({u_extrude_scale:new s.cj(m),u_intensity:new s.cj(m),u_matrix:new s.cl(m),u_inv_rot_matrix:new s.cl(m),u_merc_center:new s.ck(m),u_tile_id:new s.ci(m),u_zoom_transition:new s.cj(m),u_up_dir:new s.ci(m)}),heatmapTexture:m=>({u_image:new s.ch(m),u_color_ramp:new s.ch(m),u_opacity:new s.cj(m)}),hillshade:m=>({u_matrix:new s.cl(m),u_image:new s.ch(m),u_latrange:new s.ck(m),u_light:new s.ck(m),u_shadow:new s.dB(m),u_highlight:new s.dB(m),u_emissive_strength:new s.cj(m),u_accent:new s.dB(m)}),hillshadePrepare:m=>({u_matrix:new s.cl(m),u_image:new s.ch(m),u_dimension:new s.ck(m),u_zoom:new s.cj(m)}),line:s.dX,linePattern:s.dW,raster:m=>({u_matrix:new s.cl(m),u_normalize_matrix:new s.cl(m),u_globe_matrix:new s.cl(m),u_merc_matrix:new s.cl(m),u_grid_matrix:new s.dC(m),u_tl_parent:new s.ck(m),u_scale_parent:new s.cj(m),u_fade_t:new s.cj(m),u_opacity:new s.cj(m),u_image0:new s.ch(m),u_image1:new s.ch(m),u_brightness_low:new s.cj(m),u_brightness_high:new s.cj(m),u_saturation_factor:new s.cj(m),u_contrast_factor:new s.cj(m),u_spin_weights:new s.ci(m),u_perspective_transform:new s.ck(m),u_raster_elevation:new s.cj(m),u_zoom_transition:new s.cj(m),u_merc_center:new s.ck(m),u_cutoff_params:new s.d3(m),u_colorization_mix:new s.d3(m),u_colorization_offset:new s.cj(m),u_color_ramp:new s.ch(m),u_texture_offset:new s.ck(m),u_texture_res:new s.ck(m),u_emissive_strength:new s.cj(m)}),rasterParticle:m=>({u_matrix:new s.cl(m),u_normalize_matrix:new s.cl(m),u_globe_matrix:new s.cl(m),u_merc_matrix:new s.cl(m),u_grid_matrix:new s.dC(m),u_tl_parent:new s.ck(m),u_scale_parent:new s.cj(m),u_fade_t:new s.cj(m),u_opacity:new s.cj(m),u_image0:new s.ch(m),u_image1:new s.ch(m),u_raster_elevation:new s.cj(m),u_zoom_transition:new s.cj(m),u_merc_center:new s.ck(m),u_cutoff_params:new s.d3(m)}),rasterParticleTexture:m=>({u_texture:new s.ch(m),u_opacity:new s.cj(m)}),rasterParticleDraw:m=>({u_particle_texture:new s.ch(m),u_particle_texture_side_len:new s.cj(m),u_tile_offset:new s.ck(m),u_velocity:new s.ch(m),u_color_ramp:new s.ch(m),u_velocity_res:new s.ck(m),u_max_speed:new s.cj(m),u_uv_offset:new s.ck(m),u_data_scale:new s.ck(m),u_data_offset:new s.cj(m),u_particle_pos_scale:new s.cj(m),u_particle_pos_offset:new s.ck(m)}),rasterParticleUpdate:m=>({u_particle_texture:new s.ch(m),u_particle_texture_side_len:new s.cj(m),u_velocity:new s.ch(m),u_velocity_res:new s.ck(m),u_max_speed:new s.cj(m),u_speed_factor:new s.cj(m),u_reset_rate:new s.cj(m),u_rand_seed:new s.cj(m),u_uv_offset:new s.ck(m),u_data_scale:new s.ck(m),u_data_offset:new s.cj(m),u_particle_pos_scale:new s.cj(m),u_particle_pos_offset:new s.ck(m)}),symbol:m=>({u_is_size_zoom_constant:new s.ch(m),u_is_size_feature_constant:new s.ch(m),u_size_t:new s.cj(m),u_size:new s.cj(m),u_camera_to_center_distance:new s.cj(m),u_rotate_symbol:new s.ch(m),u_aspect_ratio:new s.cj(m),u_fade_change:new s.cj(m),u_matrix:new s.cl(m),u_label_plane_matrix:new s.cl(m),u_coord_matrix:new s.cl(m),u_is_text:new s.ch(m),u_elevation_from_sea:new s.ch(m),u_pitch_with_map:new s.ch(m),u_texsize:new s.ck(m),u_texsize_icon:new s.ck(m),u_texture:new s.ch(m),u_texture_icon:new s.ch(m),u_gamma_scale:new s.cj(m),u_device_pixel_ratio:new s.cj(m),u_tile_id:new s.ci(m),u_zoom_transition:new s.cj(m),u_inv_rot_matrix:new s.cl(m),u_merc_center:new s.ck(m),u_camera_forward:new s.ci(m),u_tile_matrix:new s.cl(m),u_up_vector:new s.ci(m),u_ecef_origin:new s.ci(m),u_is_halo:new s.ch(m),u_icon_transition:new s.cj(m),u_color_adj_mat:new s.cl(m),u_scale_factor:new s.cj(m),u_ground_shadow_factor:new s.ci(m),u_inv_matrix:new s.cl(m),u_normal_scale:new s.cj(m),u_lutTexture:new s.ch(m)}),background:m=>({u_matrix:new s.cl(m),u_emissive_strength:new s.cj(m),u_opacity:new s.cj(m),u_color:new s.dB(m)}),backgroundPattern:m=>({u_matrix:new s.cl(m),u_emissive_strength:new s.cj(m),u_opacity:new s.cj(m),u_image:new s.ch(m),u_pattern_tl:new s.ck(m),u_pattern_br:new s.ck(m),u_texsize:new s.ck(m),u_pattern_size:new s.ck(m),u_pixel_coord_upper:new s.ck(m),u_pixel_coord_lower:new s.ck(m),u_pattern_units_to_pixels:new s.ck(m)}),terrainRaster:m=>({u_matrix:new s.cl(m),u_image0:new s.ch(m),u_image1:new s.ch(m),u_skirt_height:new s.cj(m),u_ground_shadow_factor:new s.ci(m),u_emissive_texture_available:new s.cj(m)}),skybox:m=>({u_matrix:new s.cl(m),u_sun_direction:new s.ci(m),u_cubemap:new s.ch(m),u_opacity:new s.cj(m),u_temporal_offset:new s.cj(m)}),skyboxGradient:m=>({u_matrix:new s.cl(m),u_color_ramp:new s.ch(m),u_center_direction:new s.ci(m),u_radius:new s.cj(m),u_opacity:new s.cj(m),u_temporal_offset:new s.cj(m)}),skyboxCapture:m=>({u_matrix_3f:new s.dC(m),u_sun_direction:new s.ci(m),u_sun_intensity:new s.cj(m),u_color_tint_r:new s.d3(m),u_color_tint_m:new s.d3(m),u_luminance:new s.cj(m)}),globeRaster:m=>({u_proj_matrix:new s.cl(m),u_globe_matrix:new s.cl(m),u_normalize_matrix:new s.cl(m),u_merc_matrix:new s.cl(m),u_zoom_transition:new s.cj(m),u_merc_center:new s.ck(m),u_image0:new s.ch(m),u_image1:new s.ch(m),u_grid_matrix:new s.dC(m),u_skirt_height:new s.cj(m),u_far_z_cutoff:new s.cj(m),u_frustum_tl:new s.ci(m),u_frustum_tr:new s.ci(m),u_frustum_br:new s.ci(m),u_frustum_bl:new s.ci(m),u_globe_pos:new s.ci(m),u_globe_radius:new s.cj(m),u_viewport:new s.ck(m),u_emissive_texture_available:new s.cj(m)}),globeAtmosphere:m=>({u_frustum_tl:new s.ci(m),u_frustum_tr:new s.ci(m),u_frustum_br:new s.ci(m),u_frustum_bl:new s.ci(m),u_horizon:new s.cj(m),u_transition:new s.cj(m),u_fadeout_range:new s.cj(m),u_atmosphere_fog_color:new s.d3(m),u_high_color:new s.d3(m),u_space_color:new s.d3(m),u_temporal_offset:new s.cj(m),u_horizon_angle:new s.cj(m)}),model:m=>({u_matrix:new s.cl(m),u_lighting_matrix:new s.cl(m),u_normal_matrix:new s.cl(m),u_node_matrix:new s.cl(m),u_lightpos:new s.ci(m),u_lightintensity:new s.cj(m),u_lightcolor:new s.ci(m),u_camera_pos:new s.ci(m),u_opacity:new s.cj(m),u_baseColorFactor:new s.d3(m),u_emissiveFactor:new s.d3(m),u_metallicFactor:new s.cj(m),u_roughnessFactor:new s.cj(m),u_baseTextureIsAlpha:new s.ch(m),u_alphaMask:new s.ch(m),u_alphaCutoff:new s.cj(m),u_baseColorTexture:new s.ch(m),u_metallicRoughnessTexture:new s.ch(m),u_normalTexture:new s.ch(m),u_occlusionTexture:new s.ch(m),u_emissionTexture:new s.ch(m),u_lutTexture:new s.ch(m),u_color_mix:new s.d3(m),u_aoIntensity:new s.cj(m),u_emissive_strength:new s.cj(m),u_occlusionTextureTransform:new s.d3(m)}),modelDepth:m=>({u_matrix:new s.cl(m),u_instance:new s.cl(m),u_node_matrix:new s.cl(m)}),groundShadow:m=>({u_matrix:new s.cl(m),u_ground_shadow_factor:new s.ci(m)}),stars:m=>({u_matrix:new s.cl(m),u_up:new s.ci(m),u_right:new s.ci(m),u_intensity_multiplier:new s.cj(m)}),snowParticle:m=>({u_modelview:new s.cl(m),u_projection:new s.cl(m),u_time:new s.cj(m),u_cam_pos:new s.ci(m),u_velocityConeAperture:new s.cj(m),u_velocity:new s.cj(m),u_horizontalOscillationRadius:new s.cj(m),u_horizontalOscillationRate:new s.cj(m),u_boxSize:new s.cj(m),u_billboardSize:new s.cj(m),u_simpleShapeParameters:new s.ck(m),u_screenSize:new s.ck(m),u_thinningCenterPos:new s.ck(m),u_thinningShape:new s.ci(m),u_thinningAffectedRatio:new s.cj(m),u_thinningParticleOffset:new s.cj(m),u_particleColor:new s.d3(m),u_direction:new s.ci(m)}),rainParticle:m=>({u_modelview:new s.cl(m),u_projection:new s.cl(m),u_time:new s.cj(m),u_cam_pos:new s.ci(m),u_texScreen:new s.ch(m),u_velocityConeAperture:new s.cj(m),u_velocity:new s.cj(m),u_boxSize:new s.cj(m),u_rainDropletSize:new s.ck(m),u_distortionStrength:new s.cj(m),u_rainDirection:new s.ci(m),u_color:new s.d3(m),u_screenSize:new s.ck(m),u_thinningCenterPos:new s.ck(m),u_thinningShape:new s.ci(m),u_thinningAffectedRatio:new s.cj(m),u_thinningParticleOffset:new s.cj(m),u_shapeDirectionalPower:new s.cj(m),u_shapeNormalPower:new s.cj(m),u_mode:new s.cj(m)}),vignette:m=>({u_vignetteShape:new s.ci(m),u_vignetteColor:new s.d3(m)}),occlusion:m=>({u_matrix:new s.cl(m),u_anchorPos:new s.ci(m),u_screenSizePx:new s.ck(m),u_occluderSizePx:new s.ck(m),u_color:new s.d3(m)})};class hc{constructor(o,d,g,b){this.id=hc.uniqueIdxCounter,hc.uniqueIdxCounter++,this.context=o;const T=o.gl;this.buffer=T.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),T.bufferData(T.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||b||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=hc.uniqueIdxCounter,hc.uniqueIdxCounter++;const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}hc.uniqueIdxCounter=0;const nb={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ME{constructor(o,d,g,b,T,E){this.length=d.length,this.attributes=g,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.instanceCount=E,this.context=o;const I=o.gl;this.buffer=I.createBuffer(),o.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||T||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,d){for(let g=0;g<this.attributes.length;g++){const b=d.getAttributeLocation(o,this.attributes[g].name);b!==-1&&o.enableVertexAttribArray(b)}}setVertexAttribPointers(o,d,g){for(let b=0;b<this.attributes.length;b++){const T=this.attributes[b],E=d.getAttributeLocation(o,T.name);E!==-1&&o.vertexAttribPointer(E,T.components,o[nb[T.type]],!1,this.itemSize,T.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(o,d,g){for(let b=0;b<this.attributes.length;b++){const T=d.getAttributeLocation(o,this.attributes[b].name);T!==-1&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(T,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class PE{constructor(o,d,g,b,T){this.context=o,this.width=d,this.height=g;const E=this.framebuffer=o.gl.createFramebuffer();b>0&&(this.colorAttachment0=new uy(o,E,0)),b>1&&(this.colorAttachment1=new uy(o,E,1)),T&&(this.depthAttachmentType=T,this.depthAttachment=T==="renderbuffer"?new zp(o,E):new H0(o,E))}createColorAttachment(o,d){d===0?this.colorAttachment0=new uy(o,this.framebuffer,0):d===1&&(this.colorAttachment1=new uy(o,this.framebuffer,1))}removeColorAttachment(o,d){const g=this.context.gl;let b;d===0?(b=this.colorAttachment0.get(),this.colorAttachment0=void 0):d===1&&(b=this.colorAttachment1.get(),this.colorAttachment1=void 0),b&&g.deleteTexture(b)}destroy(){const o=this.context.gl;if(this.colorAttachment0){const d=this.colorAttachment0.get();d&&o.deleteTexture(d)}if(this.colorAttachment1){const d=this.colorAttachment1.get();d&&o.deleteTexture(d)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const d=this.depthAttachment.get();d&&o.deleteRenderbuffer(d)}else{const d=this.depthAttachment.get();d&&o.deleteTexture(d)}o.deleteFramebuffer(this.framebuffer)}}class Vp{constructor(o,d){this.gl=o,this.clearColor=new Vk(this),this.clearDepth=new dE(this),this.clearStencil=new Fx(this),this.colorMask=new iy(this),this.depthMask=new Bx(this),this.stencilMask=new Af(this),this.stencilFunc=new Op(this),this.stencilOp=new V0(this),this.stencilTest=new Lp(this),this.depthRange=new hE(this),this.depthTest=new jx(this),this.depthFunc=new fE(this),this.blend=new Dp(this),this.blendFunc=new sy(this),this.blendColor=new ay(this),this.blendEquation=new Ux(this),this.cullFace=new oy(this),this.cullFaceSide=new $0(this),this.frontFace=new pE(this),this.program=new mE(this),this.activeTexture=new gE(this),this.viewport=new Np(this),this.bindFramebuffer=new _E(this),this.bindRenderbuffer=new $k(this),this.bindTexture=new Hk(this),this.bindVertexBuffer=new Gk(this),this.bindElementBuffer=new Vx(this),this.bindVertexArrayOES=new $x(this),this.pixelStoreUnpack=new Hx(this),this.pixelStoreUnpackPremultiplyAlpha=new Gx(this),this.pixelStoreUnpackFlipY=new yE(this),this.options=d?Object.assign({},d):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=d&&!!d.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=o.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,d,g){return new hc(this,o,d,g)}createVertexBuffer(o,d,g,b,T){return new ME(this,o,d,g,b,T)}createRenderbuffer(o,d,g){const b=this.gl,T=b.createRenderbuffer();return this.bindRenderbuffer.set(T),b.renderbufferStorage(b.RENDERBUFFER,o,d,g),this.bindRenderbuffer.set(null),T}createFramebuffer(o,d,g,b){return new PE(this,o,d,g,b)}clear({color:o,depth:d,stencil:g,colorMask:b}){const T=this.gl;let E=0;o&&(E|=T.COLOR_BUFFER_BIT,this.clearColor.set(o.toNonPremultipliedRenderColor(null)),this.colorMask.set(b||[!0,!0,!0,!0])),d!==void 0&&(E|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),g!==void 0&&(E|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),T.clear(E)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){s.by(o.blendFunction,jr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let If;function An(m,o,d,g,b,T,E){const I=m.context,M=I.gl,N=m.transform,j=[s.aF(N.center.lng),s.aJ(N.center.lat)],Z=d.layout.get("symbol-placement"),W=d.layout.get("text-variable-anchor"),Y=d.layout.get("icon-rotation-alignment")==="map",te=d.layout.get("text-rotation-alignment")==="map",J=Z!=="point",oe=[];let ae=0,pe=0;for(let Te=0;Te<g.length;Te++){const Fe=g[Te],Xe=o.getTile(Fe),He=Xe.getBucket(d);if(!He)continue;const ct=He.getProjection().createInversionMatrix(N,Fe.canonical),ht=[],St=U_(Fe,He,N),Ut=!E&&Y&&J,rt=E&&te&&J,Ue=W&&He.hasTextData(),_t=He.hasIconTextFit()&&Ue&&He.hasIconData(),lt=Ut||rt||E&&Ue||_t,Ot=He.projection.name==="globe",en=Ot?s.aj(N.zoom):0;Ot&&(ht.push("PROJECTION_GLOBE_VIEW"),lt&&ht.push("PROJECTED_POS_ON_VIEWPORT"));const yn=m.getOrCreateProgram("collisionBox",{defines:ht});let Yt=St;b[0]===0&&b[1]===0||(Yt=m.translatePosMatrix(St,Xe,b,T));const Ht=E?He.textCollisionBox:He.iconCollisionBox,Ln=He.collisionCircleArray;if(Ln.length>0){const pn=s.bC(),vn=Yt;s.cP(pn,He.placementInvProjMatrix,N.glCoordMatrix),s.cP(pn,pn,He.placementViewportMatrix),oe.push({circleArray:Ln,circleOffset:pe,transform:vn,invTransform:pn,projection:He.getProjection()}),ae+=Ln.length/4,pe=ae}if(!Ht)continue;m.terrain&&m.terrain.setupElevationDraw(Xe,yn);const In=Ot?[Fe.canonical.x,Fe.canonical.y,1<<Fe.canonical.z]:[0,0,0];yn.draw(m,M.LINES,zn.disabled,kr.disabled,m.colorModeForRenderPass(),Cr.disabled,eb(Yt,ct,N,en,j,Xe,In,He.getProjection()),d.id,Ht.layoutVertexBuffer,Ht.indexBuffer,Ht.segments,null,N.zoom,null,[Ht.collisionVertexBuffer,Ht.collisionVertexBufferExt])}if(!E||!oe.length)return;const _e=m.getOrCreateProgram("collisionCircle"),me=new s.dZ;me.resize(4*ae),me._trim();let Le=0;for(const Te of oe)for(let Fe=0;Fe<Te.circleArray.length/4;Fe++){const Xe=4*Fe,He=Te.circleArray[Xe+0],ct=Te.circleArray[Xe+1],ht=Te.circleArray[Xe+2],St=Te.circleArray[Xe+3];me.emplace(Le++,He,ct,ht,St,0),me.emplace(Le++,He,ct,ht,St,1),me.emplace(Le++,He,ct,ht,St,2),me.emplace(Le++,He,ct,ht,St,3)}(!If||If.length<2*ae)&&(If=function(Te){const Fe=2*Te,Xe=new s.b0;Xe.resize(Fe),Xe._trim();for(let He=0;He<Fe;He++){const ct=6*He;Xe.uint16[ct+0]=4*He+0,Xe.uint16[ct+1]=4*He+1,Xe.uint16[ct+2]=4*He+2,Xe.uint16[ct+3]=4*He+2,Xe.uint16[ct+4]=4*He+3,Xe.uint16[ct+5]=4*He+0}return Xe}(ae));const Ce=I.createIndexBuffer(If,!0),Re=I.createVertexBuffer(me,s.d_.members,!0);for(const Te of oe){const Fe={u_matrix:Te.transform,u_inv_matrix:Te.invTransform,u_camera_to_center_distance:(Ae=N).getCameraToCenterDistance(Te.projection),u_viewport_size:[Ae.width,Ae.height]};_e.draw(m,M.TRIANGLES,zn.disabled,kr.disabled,m.colorModeForRenderPass(),Cr.disabled,Fe,d.id,Re,Ce,s.bg.simpleSegment(0,2*Te.circleOffset,Te.circleArray.length,Te.circleArray.length/2),null,N.zoom)}var Ae;Re.destroy(),Ce.destroy()}const Y0=s.bC();function Sd(m){const o=m._camera.getWorldToCamera(m.worldSize,1),d=s.aB([],o,m.globeMatrix);s.bl(d,d);const g=[0,0,0],b=[0,1,0,0];return s.aC(b,b,d),g[0]=b[0],g[1]=b[1],g[2]=b[2],s.aw(g,g),g}function Ch({width:m,height:o,anchor:d,textOffset:g,textScale:b},T){const{horizontalAlign:E,verticalAlign:I}=s.c1(d),M=-(E-.5)*m,N=-(I-.5)*o,j=s.c2(d,g);return new s.P((M/b+j[0])*T,(N/b+j[1])*T)}function pr(m,o,d,g,b,T,E,I,M,N){const j=m.text.placedSymbolArray,Z=m.text.dynamicLayoutVertexArray,W=m.icon.dynamicLayoutVertexArray,Y={},te=m.getProjection(),J=Uc(E,te,b),oe=b.elevation,ae=te.upVectorScale(E.canonical,b.center.lat,b.worldSize).metersToTile;Z.clear();for(let pe=0;pe<j.length;pe++){const _e=j.get(pe),{tileAnchorX:me,tileAnchorY:Le,numGlyphs:Ce}=_e,Re=_e.hidden||!_e.crossTileID||m.allowVerticalPlacement&&!_e.placedOrientation?null:g[_e.crossTileID];if(Re){let Ae=0,Te=0,Fe=0;const Xe=m.elevationType==="road";if(oe||Xe){const lt=Xe?m.getElevationFeatureForText(pe):null,Ot=s.bV.getAtTileOffset(E,new s.P(me,Le),oe,lt),[en,yn,Yt]=te.upVector(E.canonical,me,Le);Ae=Ot*en*ae,Te=Ot*yn*ae,Fe=Ot*Yt*ae}let[He,ct,ht,St]=Pu(_e.projectedAnchorX+Ae,_e.projectedAnchorY+Te,_e.projectedAnchorZ+Fe,d?J:T);const Ut=Yi(b.getCameraToCenterDistance(te),St);let rt=s.bM(m.textSizeData,M,_e)*Ut/s.bY;d&&(rt*=m.tilePixelRatio/I);const Ue=Ch(Re,rt);d?({x:He,y:ct,z:ht}=te.projectTilePoint(me+Ue.x,Le+Ue.y,E.canonical),[He,ct,ht]=Pu(He+Ae,ct+Te,ht+Fe,T)):(o&&Ue._rotate(-b.angle),He+=Ue.x,ct+=Ue.y,ht=0);const _t=m.allowVerticalPlacement&&_e.placedOrientation===s.bL.vertical?Math.PI/2:0;for(let lt=0;lt<Ce;lt++)s.bO(Z,He,ct,ht,_t);N&&_e.associatedIconIndex>=0&&(Y[_e.associatedIconIndex]={x:He,y:ct,z:ht,angle:_t})}else uc(Ce,Z)}if(N){W.clear();const pe=m.icon.placedSymbolArray;for(let _e=0;_e<pe.length;_e++){const me=pe.get(_e),{numGlyphs:Le}=me,Ce=Y[_e];if(me.hidden||!Ce)uc(Le,W);else{const{x:Re,y:Ae,z:Te,angle:Fe}=Ce;for(let Xe=0;Xe<Le;Xe++)s.bO(W,Re,Ae,Te,Fe)}}m.icon.dynamicLayoutVertexBuffer.updateData(W)}m.text.dynamicLayoutVertexBuffer.updateData(Z)}function K0(m,o,d,g,b,T,E={}){const I=d.paint.get("icon-translate"),M=d.paint.get("text-translate"),N=d.paint.get("icon-translate-anchor"),j=d.paint.get("text-translate-anchor"),Z=d.layout.get("icon-rotation-alignment"),W=d.layout.get("text-rotation-alignment"),Y=d.layout.get("icon-pitch-alignment"),te=d.layout.get("text-pitch-alignment"),J=d.layout.get("icon-keep-upright"),oe=d.layout.get("text-keep-upright"),ae=d.paint.get("icon-color-saturation"),pe=d.paint.get("icon-color-contrast"),_e=d.paint.get("icon-color-brightness-min"),me=d.paint.get("icon-color-brightness-max"),Le=d.layout.get("symbol-elevation-reference")==="sea",Ce=d.layout.get("icon-image-use-theme")==="none",Re=m.context,Ae=Re.gl,Te=m.transform,Fe=Z==="map",Xe=W==="map",He=Y==="map",ct=te==="map",ht=d.layout.get("symbol-sort-key").constantOr(1)!==void 0;let St=!1;const Ut=m.depthModeForSublayer(0,zn.ReadOnly),rt=new zn(m.context.gl.LEQUAL,zn.ReadOnly,m.depthRangeFor3D),Ue=[s.aF(Te.center.lng),s.aJ(Te.center.lat)],_t=d.layout.get("text-variable-anchor"),lt=Te.projection.name==="globe",Ot=[],en=[0,-1,0];for(const yn of g){const Yt=o.getTile(yn),Ht=Yt.getBucket(d);if(!Ht||Ht.projection.name==="mercator"&&lt||Ht.fullyClipped)continue;const Ln=Ht.projection.name==="globe",In=Ln?s.aj(Te.zoom):0,pn=Uc(yn,Ht.getProjection(),Te),vn=Te.calculatePixelsToTileUnitsMatrix(Yt),er=_t&&Ht.hasTextData(),Lr=Ht.hasIconTextFit()&&er&&Ht.hasIconData(),hi=Ht.getProjection().createInversionMatrix(Te,yn.canonical),Ni=(1<<Yt.tileID.canonical.z)*s.al/m.transform.worldSize,Dn=Gi=>{let Ei=[0,0,0];if(Gi){const Vr=m.style.directionalLight,Bs=m.style.ambientLight;Vr&&Bs&&(Ei=Td(m.style,Vr,Bs))}return Ei},Oi=Gi=>{Te.depthOcclusionForSymbolsAndCircles&&(d.hasOcclusionOpacityProperties||m.terrain)&&(Gi.push("DEPTH_D24"),Gi.push("DEPTH_OCCLUSION"))},Pr=Gi=>{d.lut&&!Ce&&(d.lut.texture||(d.lut.texture=new s.d$(m.context,d.lut.image,[d.lut.image.height,d.lut.image.height,d.lut.image.height],Re.gl.RGBA8)),Re.activeTexture.set(Re.gl.TEXTURE0+wo.LUT),d.lut.texture&&d.lut.texture.bind(Re.gl.LINEAR,Re.gl.CLAMP_TO_EDGE),Gi.push("APPLY_LUT_ON_GPU"))},Hi=()=>{const Gi=Fe&&d.layout.get("symbol-placement")!=="point",Ei=[];Oi(Ei),Pr(Ei);const Vr=Gi||Lr,Bs=Ht.elevationType==="road",Ea=m.shadowRenderer,na=Bs&&He&&!!Ea&&Ea.enabled,gs=Dn(na),vl=Bs&&He&&!m.terrain?rt:Ut,jo=d.paint.get("icon-image-cross-fade");m.terrainRenderModeElevated()&&He&&Ei.push("PITCH_WITH_MAP_TERRAIN"),Ln&&(Ei.push("PROJECTION_GLOBE_VIEW"),Vr&&Ei.push("PROJECTED_POS_ON_VIEWPORT")),jo>0&&Ht.hasAnySecondaryIcon&&Ei.push("ICON_TRANSITION"),!Ht.icon.zOffsetVertexBuffer||Bs&&m.terrain||Ei.push("Z_OFFSET"),ae===0&&pe===0&&_e===0&&me===1||Ei.push("COLOR_ADJUSTMENT"),Ht.sdfIcons&&Ei.push("RENDER_SDF"),na&&Ei.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Bs&&He&&!m.terrain&&Ht.icon.orientationVertexBuffer&&Ei.push("ELEVATED_ROADS");const Xa=Ht.icon.programConfigurations.get(d.id),Ko=m.getOrCreateProgram("symbol",{config:Xa,defines:Ei}),Qo=Yt.imageAtlasTexture?Yt.imageAtlasTexture.size:[0,0],Po=Ht.iconSizeData,hu=s.bK(Po,Te.zoom),ju=He||!Te.isOrthographic,Rl=ll(pn,Yt.tileID.canonical,He,Fe,Te,Ht.getProjection(),vn),pa=P0(pn,Yt.tileID.canonical,He,Fe,Te,Ht.getProjection(),vn),Ia=m.translatePosMatrix(pa,Yt,I,N,!0),_s=m.translatePosMatrix(pn,Yt,I,N),La=Vr?Y0:Rl,oa=Fe&&!He&&!Gi;let ra=en;!lt&&!Te.mercatorFromTransition||Fe||(ra=Sd(Te));const Uu=Ln?ra:en,ug=d.getColorAdjustmentMatrix(ae,pe,_e,me),mc=vy(Po.kind,hu,oa,He,m,_s,La,Ia,Le,!1,Qo,[0,0],0,yn,In,Ue,hi,Uu,Ht.getProjection(),gs,Ni,ug,jo,null),cg=Yt.imageAtlasTexture?Yt.imageAtlasTexture:null,Kp=d.layout.get("icon-size").constantOr(0)!==1||Ht.iconsNeedLinear,Kc=Ht.sdfIcons||m.options.rotating||m.options.zooming||Kp||ju?Ae.LINEAR:Ae.NEAREST,Ld=Ht.sdfIcons&&d.paint.get("icon-halo-width").constantOr(1)!==0,Qp=m.terrain&&He&&Gi?s.bl(s.bC(),Rl):Y0;if(Gi&&Ht.icon){const Ph=s.bV.getAtTileOffsetFunc(yn,Te.center.lat,Te.worldSize,Ht.getProjection()),Dd=V_(pn,Yt.tileID.canonical,He,Fe,Te,Ht.getProjection(),vn),gc=d.layout.get("icon-size-scale-range"),Nd=s.aA(m.scaleFactor,gc[0],gc[1]);nE(Ht,pn,m,!1,Dd,pa,He,J,Ph,yn,Nd)}return{program:Ko,buffers:Ht.icon,uniformValues:mc,atlasTexture:cg,atlasTextureIcon:null,atlasInterpolation:Kc,atlasInterpolationIcon:null,isSDF:Ht.sdfIcons,hasHalo:Ld,depthMode:vl,tile:Yt,renderWithShadows:na,labelPlaneMatrixInv:Qp}},is=()=>{const Gi=Xe&&d.layout.get("symbol-placement")!=="point",Ei=[],Vr=Gi||_t||Lr,Bs=Ht.elevationType==="road",Ea=m.shadowRenderer,na=Bs&&ct&&!!Ea&&Ea.enabled,gs=Dn(na),vl=Bs&&ct&&!m.terrain?rt:Ut;m.terrainRenderModeElevated()&&ct&&Ei.push("PITCH_WITH_MAP_TERRAIN"),Ln&&(Ei.push("PROJECTION_GLOBE_VIEW"),Vr&&Ei.push("PROJECTED_POS_ON_VIEWPORT")),!Ht.text.zOffsetVertexBuffer||Bs&&m.terrain||Ei.push("Z_OFFSET"),Ht.iconsInText&&Ei.push("RENDER_TEXT_AND_SYMBOL"),Ei.push("RENDER_SDF"),na&&Ei.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Bs&&ct&&!m.terrain&&Ht.text.orientationVertexBuffer&&Ei.push("ELEVATED_ROADS"),Oi(Ei);const jo=Ht.text.programConfigurations.get(d.id),Xa=m.getOrCreateProgram("symbol",{config:jo,defines:Ei});let Ko,Qo=[0,0],Po=null;const hu=Ht.textSizeData;Ht.iconsInText&&(Qo=Yt.imageAtlasTexture?Yt.imageAtlasTexture.size:[0,0],Po=Yt.imageAtlasTexture?Yt.imageAtlasTexture:null,Ko=ct||!Te.isOrthographic||m.options.rotating||m.options.zooming||hu.kind==="composite"||hu.kind==="camera"?Ae.LINEAR:Ae.NEAREST);const ju=Yt.glyphAtlasTexture?Yt.glyphAtlasTexture.size:[0,0],Rl=d.layout.get("text-size-scale-range"),pa=s.aA(m.scaleFactor,Rl[0],Rl[1]),Ia=s.bK(hu,Te.zoom,pa),_s=ll(pn,Yt.tileID.canonical,ct,Xe,Te,Ht.getProjection(),vn),La=P0(pn,Yt.tileID.canonical,ct,Xe,Te,Ht.getProjection(),vn),oa=m.translatePosMatrix(La,Yt,M,j,!0),ra=m.translatePosMatrix(pn,Yt,M,j),Uu=Vr?Y0:_s,ug=Xe&&!ct&&!Gi;let mc=en;!lt&&!Te.mercatorFromTransition||Xe||(mc=Sd(Te));const cg=vy(hu.kind,Ia,ug,ct,m,ra,Uu,oa,Le,!0,ju,Qo,0,yn,In,Ue,hi,Ln?mc:en,Ht.getProjection(),gs,Ni,null,null,pa),Kp=Yt.glyphAtlasTexture?Yt.glyphAtlasTexture:null,Kc=Ae.LINEAR,Ld=d.paint.get("text-halo-width").constantOr(1)!==0,Qp=m.terrain&&ct&&Gi?s.bl(s.bC(),_s):Y0;if(Gi&&Ht.text){const Ph=s.bV.getAtTileOffsetFunc(yn,Te.center.lat,Te.worldSize,Ht.getProjection()),Dd=V_(pn,Yt.tileID.canonical,ct,Xe,Te,Ht.getProjection(),vn);nE(Ht,pn,m,!0,Dd,La,ct,oe,Ph,yn,pa)}return{program:Xa,buffers:Ht.text,uniformValues:cg,atlasTexture:Kp,atlasTextureIcon:Po,atlasInterpolation:Kc,atlasInterpolationIcon:Ko,isSDF:!0,hasHalo:Ld,depthMode:vl,tile:Yt,renderWithShadows:na,labelPlaneMatrixInv:Qp}},Ki=Ht.icon.segments.get().length,Ri=Ht.text.segments.get().length,Ur=Ki&&!E.onlyText?Hi():null,Ui=Ri&&!E.onlyIcons?is():null,aa=d.paint.get("icon-opacity").constantOr(1),Gs=d.paint.get("text-opacity").constantOr(1);if(ht&&Ht.canOverlap){St=!0;const Gi=aa&&!E.onlyText?Ht.icon.segments.get():[],Ei=Gs&&!E.onlyIcons?Ht.text.segments.get():[];for(const Vr of Gi)Ot.push({segments:new s.bg([Vr]),sortKey:Vr.sortKey,state:Ur});for(const Vr of Ei)Ot.push({segments:new s.bg([Vr]),sortKey:Vr.sortKey,state:Ui})}else E.onlyText||Ot.push({segments:aa?Ht.icon.segments:new s.bg([]),sortKey:0,state:Ur}),E.onlyIcons||Ot.push({segments:Gs?Ht.text.segments:new s.bg([]),sortKey:0,state:Ui})}St&&Ot.sort((yn,Yt)=>yn.sortKey-Yt.sortKey);for(const yn of Ot){const Yt=yn.state;if(Yt)if(m.terrain?m.terrain.setupElevationDraw(Yt.tile,Yt.program,{useDepthForOcclusion:Te.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Yt.labelPlaneMatrixInv}):m.setupDepthForOcclusion(Te.depthOcclusionForSymbolsAndCircles,Yt.program),Re.activeTexture.set(Ae.TEXTURE0),Yt.atlasTexture&&Yt.atlasTexture.bind(Yt.atlasInterpolation,Ae.CLAMP_TO_EDGE,!0),Yt.atlasTextureIcon&&(Re.activeTexture.set(Ae.TEXTURE1),Yt.atlasTextureIcon&&Yt.atlasTextureIcon.bind(Yt.atlasInterpolationIcon,Ae.CLAMP_TO_EDGE,!0)),Yt.renderWithShadows&&m.shadowRenderer.setupShadows(Yt.tile.tileID.toUnwrapped(),Yt.program,"vector-tile"),m.uploadCommonLightUniforms(m.context,Yt.program),Yt.hasHalo){const Ht=Yt.uniformValues;Ht.u_is_halo=1,rb(Yt.buffers,yn.segments,d,m,Yt.program,Yt.depthMode,b,T,Ht,2),Ht.u_is_halo=0}else{if(Yt.isSDF){const Ht=Yt.uniformValues;Yt.hasHalo&&(Ht.u_is_halo=1,rb(Yt.buffers,yn.segments,d,m,Yt.program,Yt.depthMode,b,T,Ht,1)),Ht.u_is_halo=0}rb(Yt.buffers,yn.segments,d,m,Yt.program,Yt.depthMode,b,T,Yt.uniformValues,1)}}}function rb(m,o,d,g,b,T,E,I,M,N){const j=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer,m.orientationVertexBuffer];b.draw(g,g.context.gl.TRIANGLES,T,E,I,Cr.disabled,M,d.id,m.layoutVertexBuffer,m.indexBuffer,o,d.paint,g.transform.zoom,m.programConfigurations.get(d.id),j,N)}function OE(m,o){const d=1<<m.canonical.z,g=(o.x*d-m.canonical.x-m.wrap*d)*s.al,b=(o.y*d-m.canonical.y)*s.al,T=s.e8(o.z,o.y);return s.d5(g,b,T)}function by(m,o,d,g,b){if(!d.layout||d.layout.get("fill-elevation-reference")==="none"||d.paint.get("fill-opacity").constantOr(1)===0)return;const T=m.context.gl,E=new zn(m.context.gl.LEQUAL,zn.ReadWrite,m.depthRangeFor3D),I=new zn(m.context.gl.GREATER,zn.ReadWrite,m.depthRangeFor3D),M=function(Y){let te=.01;return Y.isOrthographic&&(te=s.ak(1e-4,te,s.d0(Y.pitch>=dc?1:Y.pitch/dc))),2*te}(m.transform),N=m.transform.getFreeCameraOptions().position,j="elevatedStructuresDepthReconstruct",Z=m.getOrCreateProgram(j,{defines:["DEPTH_RECONSTRUCTION"]}),W=m.getOrCreateProgram(j);for(const Y of g){const te=o.getTile(Y),J=te.getBucket(d);if(!J)continue;const oe=J.elevatedStructures;if(!oe)continue;const ae=J.elevationBufferData.heightRange,pe=OE(Y.toUnwrapped(),N),_e=m.translatePosMatrix(Y.projMatrix,te,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));let me,Le,Ce,Re;if(b==="initialize"){if(!ae||ae.min>=1||oe.depthSegments.segments[0].primitiveLength===0)continue;me=Cf(_e,pe,M,1,0),Le=E,Ce=oe.depthSegments,Re=Z}else if(b==="reset"){if(!ae||ae.min>=0||oe.maskSegments.segments[0].primitiveLength===0)continue;me=Cf(_e,pe,0,0,1),Le=I,Ce=oe.maskSegments,Re=Z}else if(b==="geometry"){if(oe.depthSegments.segments[0].primitiveLength===0)continue;me=Cf(_e,pe,M,1,0),Le=E,Ce=oe.depthSegments,Re=W}Re.draw(m,T.TRIANGLES,Le,kr.disabled,jr.disabled,Cr.disabled,me,d.id,oe.vertexBuffer,oe.indexBuffer,Ce,d.paint,m.transform.zoom)}}function wy(m,o,d,g){const{painter:b,sourceCache:T,layer:E,coords:I,colorMode:M,elevationType:N,terrainEnabled:j,pass:Z}=m,W=b.context.gl,Y=E.paint.get("fill-pattern"),te=E.paint.get("fill-pattern-cross-fade"),J=Y.constantOr(null);let oe=N;N!=="road"||o&&!j||(oe="none");const ae=oe==="road",pe=m.painter.shadowRenderer,_e=ae&&!!pe&&pe.enabled,me=new zn(b.context.gl.LEQUAL,zn.ReadOnly,b.depthRangeFor3D);let Le=[0,0,0];if(_e){const Te=b.style.directionalLight,Fe=b.style.ambientLight;Te&&Fe&&(Le=Td(b.style,Te,Fe))}const Ce=Y&&Y.constantOr(1),Re=b.terrain&&b.terrain.renderingToTexture,Ae=(Te,Fe)=>{let Xe,He,ct,ht,St;Fe?(Xe=Ce&&!E.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ct=W.LINES):(Xe=Ce?"fillPattern":"fill",ct=W.TRIANGLES);for(const Ut of I){const rt=T.getTile(Ut);if(Ce&&!rt.patternsLoaded())continue;const Ue=rt.getBucket(E);if(!Ue)continue;const _t=o?Ue.elevationBufferData:Ue.bufferData;if(_t.isEmpty())continue;b.prepareDrawTile();const lt=_t.programConfigurations.get(E.id),Ot=b.isTileAffectedByFog(Ut),en=[],yn=[];ae&&(en.push("ELEVATED_ROADS"),yn.push(_t.elevatedLayoutVertexBuffer)),_e&&en.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Re&&d&&en.push("USE_MRT1"),Ce&&(b.context.activeTexture.set(W.TEXTURE0),rt.imageAtlasTexture&&rt.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),lt.updatePaintBuffers());let Yt=!1;if(J&&rt.imageAtlas){const vn=rt.imageAtlas,er=s.e3.from(J),Lr=er.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),hi=er.getSecondary(),Ni=vn.patternPositions.get(Lr),Dn=hi?vn.patternPositions.get(hi.scaleSelf(s.o.devicePixelRatio).toString()):null;Yt=!!Ni&&!!Dn,Ni&&lt.setConstantPatternPositions(Ni,Dn)}te>0&&(Yt||lt.getPatternTransitionVertexBuffer("fill-pattern"))&&en.push("FILL_PATTERN_TRANSITION");const Ht=b.getOrCreateProgram(Xe,{config:lt,overrideFog:Ot,defines:en}),Ln=b.translatePosMatrix(Ut.projMatrix,rt,E.paint.get("fill-translate"),E.paint.get("fill-translate-anchor"));_e&&pe.setupShadows(rt.tileID.toUnwrapped(),Ht,"vector-tile");const In=E.paint.get("fill-emissive-strength");if(Fe){ht=_t.lineIndexBuffer,St=_t.lineSegments;const vn=b.terrain&&b.terrain.renderingToTexture?b.terrain.drapeBufferSize:[W.drawingBufferWidth,W.drawingBufferHeight];He=Xe==="fillOutlinePattern"&&Ce?Jx(Ln,In,b,rt,vn,Le,te):TE(Ln,In,vn,Le)}else ht=_t.indexBuffer,St=_t.triangleSegments,He=Ce?Qx(Ln,In,b,rt,Le,te):Kx(Ln,In,Le);b.uploadCommonUniforms(b.context,Ht,Ut.toUnwrapped());let pn=Te;(N==="road"&&!j||N==="offset")&&(pn=me),Ht.draw(b,ct,pn,g||b.stencilModeForClipping(Ut),M,Cr.disabled,He,E.id,_t.layoutVertexBuffer,ht,St,E.paint,b.transform.zoom,lt,yn)}};b.renderPass===Z&&Ae(b.depthModeForSublayer(1,b.renderPass==="opaque"?zn.ReadWrite:zn.ReadOnly),!1),oe==="none"&&b.renderPass==="translucent"&&E.paint.get("fill-antialias")&&Ae(b.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,zn.ReadOnly),!0)}function Ty(m,o,d,g,b,T,E,I){d.resetLayerRenderingStats(m);const M=m.context,N=M.gl,j=m.transform,Z=d.paint.get("fill-extrusion-pattern"),W=d.paint.get("fill-extrusion-pattern-cross-fade"),Y=Z.constantOr(null),te=Z.constantOr(1),J=d.paint.get("fill-extrusion-opacity"),oe=m.style.enable3dLights(),ae=d.paint.get(oe&&!te?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),pe=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),ae],_e=d.layout.get("fill-extrusion-edge-radius"),me=_e>0&&!d.paint.get("fill-extrusion-rounded-roof"),Le=me?0:_e,Ce=j.projection.name==="globe"?s.eb():0,Re=j.projection.name==="globe",Ae=Re?s.aj(j.zoom):0,Te=[s.aF(j.center.lng),s.aJ(j.center.lat)],Fe=d.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Xe=d.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Fe?null:d.lut).toArray01().slice(0,3),He=d.paint.get("fill-extrusion-flood-light-intensity"),ct=d.paint.get("fill-extrusion-vertical-scale"),ht=d.paint.get("fill-extrusion-line-width").constantOr(1)!==0,St=d.paint.get("fill-extrusion-height-alignment"),Ut=d.paint.get("fill-extrusion-base-alignment"),rt=yh(m,d.paint.get("fill-extrusion-cutoff-fade-range")),Ue=[];let _t;Re&&Ue.push("PROJECTION_GLOBE_VIEW"),pe[0]>0&&Ue.push("FAUX_AO"),me&&Ue.push("ZERO_ROOF_RADIUS"),I&&Ue.push("HAS_CENTROID"),He>0&&Ue.push("FLOOD_LIGHT"),rt.shouldRenderCutoff&&Ue.push("RENDER_CUTOFF"),ht&&Ue.push("RENDER_WALL_MODE");const lt=m.renderPass==="shadow",Ot=m.shadowRenderer,en=lt&&!!Ot,yn=lt?Cr.disabled:Cr.backCCW;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let Yt=[0,0,0];if(Ot){const In=m.style.directionalLight,pn=m.style.ambientLight;In&&pn&&(Yt=Td(m.style,In,pn)),lt||(Ue.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ot.useNormalOffset&&Ue.push("NORMAL_OFFSET")),_t=Ue.concat(["SHADOWS_SINGLE_CASCADE"])}const Ht=en?"fillExtrusionDepth":te?"fillExtrusionPattern":"fillExtrusion",Ln=d.getLayerRenderingStats();for(const In of g){const pn=o.getTile(In),vn=pn.getBucket(d);if(!vn||vn.projection.name!==j.projection.name)continue;let er=!1;Ot&&(er=Ot.getMaxCascadeForTile(In.toUnwrapped())===0);const Lr=m.isTileAffectedByFog(In),hi=vn.programConfigurations.get(d.id);let Ni=!1;if(Y&&pn.imageAtlas){const Ri=pn.imageAtlas,Ur=s.e3.from(Y),Ui=Ur.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),aa=Ur.getSecondary(),Gs=Ri.patternPositions.get(Ui),Gi=aa?Ri.patternPositions.get(aa.scaleSelf(s.o.devicePixelRatio).toString()):null;Ni=!!Gs&&!!Gi,Gs&&hi.setConstantPatternPositions(Gs,Gi)}W>0&&(Ni||hi.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ue.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Dn=m.getOrCreateProgram(Ht,{config:hi,defines:er?_t:Ue,overrideFog:Lr});if(m.terrain&&m.terrain.setupElevationDraw(pn,Dn,{useMeterToDem:!0}),!vn.centroidVertexBuffer){const Ri=Dn.getAttributeLocation(N,"a_centroid_pos");Ri!==-1&&N.vertexAttrib2f(Ri,0,0)}!lt&&Ot&&Ot.setupShadows(pn.tileID.toUnwrapped(),Dn,"vector-tile"),te&&(m.context.activeTexture.set(N.TEXTURE0),pn.imageAtlasTexture&&pn.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),hi.updatePaintBuffers());const Oi=d.paint.get("fill-extrusion-vertical-gradient"),Pr=1/vn.tileToMeter;let Hi;if(lt&&Ot){if(Cd(pn.tileID,vn.maxHeight,m))continue;const Ri=Ot.calculateShadowPassMatrixFromTile(pn.tileID.toUnwrapped());Hi=Yx(Ri,Le,Pr,ct,St,Ut)}else{const Ri=m.translatePosMatrix(In.expandedProjMatrix,pn,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Ur=j.projection.createInversionMatrix(j,In.canonical);Hi=te?wE(Ri,m,Oi,J,pe,Le,Pr,In,pn,Ce,St,Ut,Ae,Te,Ur,Xe,ct,W):my(Ri,m,Oi,J,pe,Le,Pr,In,Ce,St,Ut,Ae,Te,Ur,Xe,ct,He,Yt)}m.uploadCommonUniforms(M,Dn,In.toUnwrapped(),null,rt);let is=vn.segments;if(j.projection.name==="mercator"&&!lt&&(is=vn.getVisibleSegments(pn.tileID,m.terrain,m.transform.getFrustum(0)),!is.get().length))continue;if(Ln)if(lt)for(const Ri of is.get())Ln.numRenderedVerticesInShadowPass+=Ri.primitiveLength;else for(const Ri of is.get())Ln.numRenderedVerticesInTransparentPass+=Ri.primitiveLength;const Ki=[];(m.terrain||I)&&Ki.push(vn.centroidVertexBuffer),Re&&Ki.push(vn.layoutVertexExtBuffer),ht&&Ki.push(vn.wallVertexBuffer),Dn.draw(m,M.gl.TRIANGLES,b,T,E,yn,Hi,d.id,vn.layoutVertexBuffer,vn.indexBuffer,is,d.paint,m.transform.zoom,hi,Ki)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}class ib{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Ad(m,o,d,g,b,T,E,I,M,N,j,Z,W,Y,te,J,oe,ae,pe,_e){const me=o.context,Le=me.gl,Ce=o.transform,Re=o.transform.zoom,Ae=[],Te=m.translate,Fe=m.translateAnchor,Xe=m.edgeRadius,He=yh(o,m.cutoffFadeRange);j==="clear"?(Ae.push("CLEAR_SUBPASS"),_e&&(Ae.push("CLEAR_FROM_TEXTURE"),me.activeTexture.set(Le.TEXTURE0),_e.bind(Le.LINEAR,Le.CLAMP_TO_EDGE))):j==="sdf"?Ae.push("SDF_SUBPASS"):j==="emissive"&&(Ae.push("USE_MRT1"),me.activeTexture.set(Le.TEXTURE0),_e.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)),ae&&Ae.push("HAS_CENTROID"),He.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF");const ct=(ht,St,Ut,rt,Ue)=>{let _t=Ae;St.groundRadiusBuffer!=null&&(_t=Ae.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const lt=St.programConfigurations.get(g.id),Ot=o.isTileAffectedByFog(ht),en=o.getOrCreateProgram("fillExtrusionGroundEffect",{config:lt,defines:_t,overrideFog:Ot}),yn=jp(o,rt,Z,N,Ue,[W,Y*Ue],te,J,oe,Re>=17?0:Xe*Ue,_e?_e.size[0]:0),Yt=[];ae&&Yt.push(St.hiddenByLandmarkVertexBuffer),St.groundRadiusBuffer!=null&&Yt.push(St.groundRadiusBuffer),o.uploadCommonUniforms(me,en,ht.toUnwrapped(),null,He),en.draw(o,me.gl.TRIANGLES,T,E,I,M,yn,g.id,St.vertexBuffer,St.indexBuffer,Ut,g.paint,Re,lt,Yt)};for(const ht of b){const St=d.getTile(ht),Ut=St.getBucket(g);if(!Ut||Ut.projection.name!==Ce.projection.name||!Ut.groundEffect||Ut.groundEffect&&!Ut.groundEffect.hasData())continue;const rt=Ut.groundEffect,Ue=1/Ut.tileToMeter;{const _t=o.translatePosMatrix(ht.projMatrix,St,Te,Fe),lt=rt.getDefaultSegment();ct(ht,rt,lt,_t,Ue)}if(pe)for(let _t=0;_t<4;_t++){const lt=s.e9[_t](ht),Ot=d.getTile(lt);if(!Ot)continue;const en=Ot.getBucket(g);if(!en||en.projection.name!==Ce.projection.name||!en.groundEffect||en.groundEffect&&!en.groundEffect.hasData())continue;const yn=en.groundEffect;let Yt,Ht;_t===0?(Yt=[-s.al,0,0],Ht=1):_t===1?(Yt=[s.al,0,0],Ht=0):_t===2?(Yt=[0,-s.al,0],Ht=3):(Yt=[0,s.al,0],Ht=2);const Ln=yn.regionSegments[Ht];if(!Ln)continue;const In=new Float32Array(16);s.br(In,ht.projMatrix,Yt),ct(ht,yn,Ln,o.translatePosMatrix(In,St,Te,Fe),Ue)}}}function Kk(m,o,d,g,b,T,E){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();const I=T?T.findDEMTileFor(d):null;if(!(I&&I.dem||E))return;T&&I&&I.dem&&g.selfDEMTileTimestamp!==I.dem._timestamp&&(g.borderDoneWithNeighborZ=[-1,-1,-1,-1],g.selfDEMTileTimestamp=I.dem._timestamp);const M=ae=>new s.P(Math.ceil((ae+s.ed)*s.ee),0),N=ae=>{const pe=o.getSource().minzoom,_e=Le=>{const Ce=o.getTileByID(Le);if(Ce&&Ce.hasData())return Ce.getBucket(b)},me=[0,-1,1];for(const Le of me){if(ae.overscaledZ+Le<pe)continue;const Ce=_e(ae.calculateScaledKey(ae.overscaledZ+Le));if(Ce)return Ce}},j=[0,0,0],Z=(ae,pe)=>(j[0]=Math.min(ae.min.y,pe.min.y),j[1]=Math.max(ae.max.y,pe.max.y),j[2]=s.al-pe.min.x>ae.max.x?pe.min.x-s.al:ae.max.x,j),W=(ae,pe)=>(j[0]=Math.min(ae.min.x,pe.min.x),j[1]=Math.max(ae.max.x,pe.max.x),j[2]=s.al-pe.min.y>ae.max.y?pe.min.y-s.al:ae.max.y,j),Y=[(ae,pe)=>Z(ae,pe),(ae,pe)=>Z(pe,ae),(ae,pe)=>W(ae,pe),(ae,pe)=>W(pe,ae)],te=(ae,pe,_e,me,Le,Ce,Re)=>{if(!T)return 0;const Ae=[[Ce?_e:ae,Ce?ae:_e,0],[Ce?_e:pe,Ce?pe:_e,0]],Te=Re<0?s.al+Re:Re,Fe=[Ce?Te:(ae+pe)/2,Ce?(ae+pe)/2:Te,0];return _e===0&&Re<0||_e!==0&&Re>0?T.getForTilePoints(Le,[Fe],!0,me):Ae.push(Fe),T.getForTilePoints(d,Ae,!0,I),Math.max(Ae[0][2],Ae[1][2],Fe[2])/T.exaggeration()};for(let ae=0;ae<4;ae++){const pe=g.borderFeatureIndices[ae];if(pe.length===0)continue;const _e=s.e9[ae](d),me=N(_e);if(!(me&&me instanceof s.ea))continue;const Le=T?T.findDEMTileFor(_e):null;if(!(Le&&Le.dem||E)||(T&&Le&&Le.dem&&g.borderDEMTileTimestamp[ae]!==Le.dem._timestamp&&(g.borderDoneWithNeighborZ[ae]=-1,g.borderDEMTileTimestamp[ae]=Le.dem._timestamp),g.borderDoneWithNeighborZ[ae]===me.canonical.z))continue;me.centroidVertexArray.length===0&&me.createCentroidsBuffer();const Ce=(ae<2?1:5)-ae,Re=me.borderDoneWithNeighborZ[Ce]!==g.canonical.z,Ae=me.borderFeatureIndices[Ce];let Te=0;if(g.canonical.z!==me.canonical.z){for(const Fe of pe)g.showCentroid(g.featuresOnBorder[Fe]);if(Re)for(const Fe of Ae)me.showCentroid(me.featuresOnBorder[Fe]);g.borderDoneWithNeighborZ[ae]=me.canonical.z,me.borderDoneWithNeighborZ[Ce]=g.canonical.z}for(const Fe of pe){const Xe=g.featuresOnBorder[Fe],He=g.centroidData[Xe.centroidDataIndex],ct=Xe.borders[ae];let ht;for(;Te<Ae.length;){ht=me.featuresOnBorder[Ae[Te]];const St=ht.borders[Ce];if(St[1]>ct[0]+3||St[0]>ct[0]-3)break;me.showCentroid(ht),Te++}if(ht&&Te<Ae.length){const St=Te;let Ut=0;for(;!(ht.borders[Ce][0]>ct[1]-3)&&(Ut++,++Te!==Ae.length);)ht=me.featuresOnBorder[Ae[Te]];ht=me.featuresOnBorder[Ae[St]];let rt=!1;if(Ut>=1){const lt=ht.borders[Ce];Math.abs(ct[0]-lt[0])<3&&Math.abs(ct[1]-lt[1])<3&&(Ut=1,rt=!0,Te=St+1)}else if(Ut===0){g.showCentroid(Xe);continue}const Ue=me.centroidData[ht.centroidDataIndex];E&&rt&&(((J=He).flags|(oe=Ue).flags)&s.ec?(J.flags|=s.ec,oe.flags|=s.ec):(J.flags&=~s.ec,oe.flags&=~s.ec));const _t=Xe.intersectsCount()>1||ht.intersectsCount()>1;if(Ut>1)Te=St,He.centroidXY=Ue.centroidXY=new s.P(0,0);else if(Le&&Le.dem&&!_t){const lt=Y[ae](He,Ue),Ot=ae%2?s.al-1:0,en=te(lt[0],Math.min(s.al-1,lt[1]),Ot,Le,_e,ae<2,lt[2]);He.centroidXY=Ue.centroidXY=M(en)}else _t?He.centroidXY=Ue.centroidXY=new s.P(0,0):(He.centroidXY=g.encodeBorderCentroid(Xe),Ue.centroidXY=me.encodeBorderCentroid(ht));g.writeCentroidToBuffer(He),me.writeCentroidToBuffer(Ue)}else g.showCentroid(Xe)}g.borderDoneWithNeighborZ[ae]=me.canonical.z,me.borderDoneWithNeighborZ[Ce]=g.canonical.z}var J,oe;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}const Hl=[1,0,0],sb=[0,1,0],_l=[0,0,1];function Cd(m,o,d){const g=d.transform,b=d.shadowRenderer;if(!b)return!0;const T=m.toUnwrapped(),E=g.tileSize*b._cascades[d.currentShadowCascade].scale;let I=o;if(g.elevation){const J=g.elevation.getMinMaxForTile(m);J&&(I+=J.max)}const M=[...b.shadowDirection];M[2]=-M[2];const N=b.computeSimplifiedTileShadowVolume(T,I,E,M);if(!N)return!1;const j=[Hl,sb,_l,M,[M[0],0,M[2]],[0,M[1],M[2]]],Z=g.projection.name==="globe",W=g.scaleZoom(E),Y=s.cB.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,W,!Z),te=b.getCurrentCascadeFrustum();return Y.intersectsPrecise(N.vertices,N.planes,j)===0||te.intersectsPrecise(N.vertices,N.planes,j)===0}function Q0(m){const{painter:o,source:d,layer:g,coords:b}=m;let T=m.defines;const E=o.context,I=o.renderPass==="shadow",M=o.renderPass==="light-beam",N=o.shadowRenderer,j=s.ef(o.transform.center.lat,o.transform.zoom),Z=yh(o,g.paint.get("building-cutoff-fade-range"));Z.shouldRenderCutoff&&(T=T.concat("RENDER_CUTOFF")),m.floodLightIntensity>0&&(T=T.concat("FLOOD_LIGHT"));for(const W of b){const Y=d.getTile(W),te=Y.getBucket(g);if(!te)continue;N&&N.getMaxCascadeForTile(W.toUnwrapped())===0&&(T=T.concat("SHADOWS_SINGLE_CASCADE"));const J=te.programConfigurations.get(g.id);let oe,ae,pe,_e=o.translatePosMatrix(W.expandedProjMatrix,Y,[0,0],"map");if(_e=s.cS(s.bC(),_e,[1,1,m.verticalScale]),I&&N){if(Cd(Y.tileID,te.maxHeight*j,o))continue;let Le=N.calculateShadowPassMatrixFromTile(Y.tileID.toUnwrapped());Le=s.cS(s.bC(),Le,[1,1,m.verticalScale]),pe=Sh(Le),oe=ae=o.getOrCreateProgram("buildingDepth",{config:J,defines:T,overrideFog:!1})}else if(M)oe=ae=o.getOrCreateProgram("buildingBloom",{config:J,defines:T,overrideFog:!1}),pe=EE(_e);else{const Le=o.transform.calculatePosMatrix(W.toUnwrapped(),o.transform.worldSize);s.cS(Le,Le,[1,1,m.verticalScale]);const Ce=s.bC();s.cS(Ce,Le,[1,-1,1/j]),s.bl(Ce,Ce),s.eg(Ce,Ce);const Re=o.transform.getFreeCameraOptions().position,Ae=1<<W.canonical.z;if(pe=gy(_e,Ce,m.opacity,m.facadeAOIntensity,[((Re.x-W.wrap)*Ae-W.canonical.x)*s.al,(Re.y*Ae-W.canonical.y)*s.al,Re.z*Ae*s.al],te.tileToMeter,m.facadeEmissiveChance,m.floodLightColor,m.floodLightIntensity),ae=o.getOrCreateProgram("building",{config:J,defines:T,overrideFog:!1}),m.depthOnly===!0)oe=ae;else{const Te=T.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);oe=o.getOrCreateProgram("building",{config:J,defines:Te,overrideFog:!1})}N&&(N.setupShadowsFromMatrix(Le,ae,!0),oe!==ae&&N.setupShadowsFromMatrix(Le,oe,!0))}const me=(Le,Ce)=>{if(M){const Re=Le.entranceBloom;Ce.draw(o,E.gl.TRIANGLES,m.depthMode,kr.disabled,m.blendMode,Cr.disabled,pe,g.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segmentsBucket,g.paint,o.transform.zoom,J,[Re.layoutAttenuationBuffer,Re.layoutColorBuffer])}else{const Re=Le.segmentsBucket;let Ae=[Le.layoutNormalBuffer,Le.layoutCentroidBuffer,Le.layoutColorBuffer,Le.layoutFloodLightDataBuffer];Le.layoutFacadePaintBuffer&&(Ae=Ae.concat([Le.layoutFacadeDataBuffer,Le.layoutFacadeVerticalRangeBuffer,Le.layoutFacadePaintBuffer])),Ce.draw(o,E.gl.TRIANGLES,m.depthMode,kr.disabled,m.blendMode,I?Cr.disabled:Cr.backCW,pe,g.id,Le.layoutVertexBuffer,Le.indexBuffer,Re,g.paint,o.transform.zoom,J,Ae)}};o.uploadCommonUniforms(E,ae,W.toUnwrapped(),null,Z),te.buildingWithoutFacade&&me(te.buildingWithoutFacade,ae),te.buildingWithFacade&&(oe!==ae&&o.uploadCommonUniforms(E,oe,W.toUnwrapped(),null,Z),me(te.buildingWithFacade,oe))}}function Ey(m,o,d,g,b,T,E,I,M,N,j,Z,W){const Y=m.context.gl,te=m.depthModeForSublayer(1,zn.ReadOnly,Y.LEQUAL,!0),J=.1*(1-(oe=j))+3*oe;var oe;const ae=m._showOverdrawInspector,pe=Z,_e=new ib;ae||Ad(_e,m,o,d,g,te,new kr({func:Y.ALWAYS,mask:255},255,255,Y.KEEP,Y.KEEP,Y.REPLACE),new jr([Y.ONE,Y.ONE,Y.ONE,Y.ONE],s.ao.transparent,[!1,!1,!1,!0],Y.MIN),Cr.disabled,b,"sdf",T,E,I,M,N,J,pe,!1);{const me=ae?kr.disabled:new kr({func:Y.EQUAL,mask:255},255,255,Y.KEEP,Y.DECR,Y.DECR),Le=ae?m.colorModeForRenderPass():new jr([Y.ONE_MINUS_DST_ALPHA,Y.DST_ALPHA,Y.ONE,Y.ONE],s.ao.transparent,[!0,!0,!0,!0]);Ad(_e,m,o,d,g,te,me,Le,Cr.disabled,b,"color",T,E,I,M,N,J,pe,!1)}}function Sy(m){return[m[0]*s.eh,m[1]*s.eh,m[2]*s.eh,0]}function J0(m,o,d,g,b,T,E,I,M){const N=g.getSource(),j=d.globeSharedBuffers;if(!j)return;let Z,W,Y;if(o&&(Z=g.getTile(o)),N instanceof s.aU?(W=N.texture,Y=s.dK(0,0,d.transform)):Z&&o&&(W=Z.texture,Y=s.dK(o.canonical.z,o.canonical.x,d.transform)),!W||!Y)return;m||(Y=s.cS(s.bC(),Y,[1,-1,1]));const te=d.context,J=te.gl,oe=b.paint.get("raster-resampling")==="nearest"?J.NEAREST:J.LINEAR,ae=d.colorModeForDrapableLayerRenderPass(T),pe=E.defines;pe.push("GLOBE_POLES");const _e=new zn(J.LEQUAL,zn.ReadWrite,d.depthRangeFor3D),me=Float32Array.from(d.transform.expandedFarZProjMatrix),Le=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0))));d.terrain&&d.terrain.prepareDrawTile(),te.activeTexture.set(J.TEXTURE0),W.bind(oe,J.CLAMP_TO_EDGE),te.activeTexture.set(J.TEXTURE1),W.bind(oe,J.CLAMP_TO_EDGE),"useMipmap"in W&&te.extTextureFilterAnisotropic&&d.transform.pitch>20&&J.texParameterf(J.TEXTURE_2D,te.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,te.extTextureFilterAnisotropicMax);const[Ce,Re,Ae,Te]=o?j.getPoleBuffers(o.canonical.z,!1):j.getPoleBuffers(0,!0),Fe=b.paint.get("raster-elevation");let Xe;m?(Xe=Ce,d.renderDefaultNorthPole=Fe!==0):(Xe=Re,d.renderDefaultSouthPole=Fe!==0);const He=Sy(E.mix),ct=((St,Ut,rt,Ue,_t,lt,Ot,en,yn,Yt,Ht,Ln,In)=>CE(St,Ut,rt,new Float32Array(16),new Float32Array(9),[0,0],Ue,[0,0],[0,0,0,0],1,{opacity:1,mix:0},lt,[0,0],en,2,Yt,Ht,Ln,1,0,In))(me,Le,Y,s.aj(d.transform.zoom),0,b,0,Fe,0,He,E.offset,E.range,T),ht=d.getOrCreateProgram("raster",{defines:pe});d.uploadCommonUniforms(te,ht,null),ht.draw(d,J.TRIANGLES,_e,M,ae,I,ct,b.id,Xe,Ae,Te)}function LE(m){const o=m._nearZ,d=m.projection.farthestPixelDistance(m),g=d-o,b=.2*m.height,T=o+b;return[o,d,(T-b-o)/g,(T-o)/g]}function kd(m,o,d,g){if(m)return o instanceof ol&&m instanceof F_?o.getTextureDescriptor(m,d,!0):{texture:m.texture,mix:Sy(g.mix),offset:g.offset,buffer:0,tileSize:1}}var Rs=s.ei([{name:"a_index",type:"Int16",components:1}]);class Ay{constructor(o,d,g,b){const T={width:g[0],height:g[1],data:null},E=o.gl;this.targetColorTexture=new s.T(o,T,E.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(o,T,E.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(d,b),this.lastInvalidatedAt=0}updateParticleTexture(o,d){if(this.particleTextureDimension===d.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const g=this.context.gl,b=d.width*d.height;this.particleTexture0=new s.T(this.context,d,g.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,d,g.RGBA8,{premultiply:!1,useMipmap:!1});const T=new s.ej;T.reserve(b);for(let E=0;E<b;E++)T.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(T,Rs.members,!0),this.particleSegment=s.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=d.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=s.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function ab(m,o,d){if(!m)return null;const g=o.getTextureDescriptor(m,d,!0);if(!g)return null;let{texture:b,mix:T,offset:E,tileSize:I,buffer:M,format:N}=g;if(!b||!N)return null;let j=!1;return N==="uint32"&&(j=!0,T[3]=0,T=_y(s.ek,T,[0,d.paint.get("raster-particle-max-speed")]),E=yy(s.ek,E,[0,d.paint.get("raster-particle-max-speed")])),{texture:b,textureOffset:[M/(I+2*M),I/(I+2*M)],tileSize:I,scalarData:j,scale:T,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[N]]}}function DE(m){const o=m._nearZ,d=m.projection.farthestPixelDistance(m),g=d-o,b=.2*m.height,T=o+b;return[o,d,(T-b-o)/g,(T-o)/g]}const NE=new s.ao(1,0,0,1),zE=new s.ao(0,1,0,1),FE=new s.ao(0,0,1,1),Rf=new s.ao(1,0,1,1),Mf=new s.ao(0,1,1,1);function Zt(m,o,d,g,b,T){for(let E=0;E<d.length;E++)if(b){const N=new s.ao(g.r*.8,g.g*.8,g.b*.8,1);sn(m,o,d[E],g,-1,-1,T),sn(m,o,d[E],g,-1,1,T),sn(m,o,d[E],g,1,1,T),sn(m,o,d[E],g,1,-1,T),sn(m,o,d[E],N,0,0,T)}else sn(m,o,d[E],g,0,0,T)}function sn(m,o,d,g,b,T,E){const I=m.context,M=m.transform,N=I.gl,j=M.projection.name==="globe",Z=j?["PROJECTION_GLOBE_VIEW"]:[];let W=s.bz(d.projMatrix);if(j&&s.aj(M.zoom)>0){const He=s.bj(d.canonical,M),ct=s.el(He);W=s.aB(new Float32Array(16),M.globeMatrix,ct),s.aB(W,M.projMatrix,W)}const Y=s.bC();Y[12]+=2*b/(s.o.devicePixelRatio*M.width),Y[13]+=2*T/(s.o.devicePixelRatio*M.height),s.aB(W,Y,W);const te=m.getOrCreateProgram("debug",{defines:Z}),J=o.getTileByID(d.key);m.terrain&&m.terrain.setupElevationDraw(J,te);const oe=zn.disabled,ae=kr.disabled,pe=m.colorModeForRenderPass(),_e="$debug";I.activeTexture.set(N.TEXTURE0),m.emptyTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),j?J._makeGlobeTileDebugBuffers(m.context,M):J._makeDebugTileBoundsBuffers(m.context,M.projection);const me=J._tileDebugBuffer||m.debugBuffer,Le=J._tileDebugIndexBuffer||m.debugIndexBuffer,Ce=J._tileDebugSegments||m.debugSegments;if(te.draw(m,N.LINE_STRIP,oe,ae,pe,Cr.disabled,Z0(W,g.toPremultipliedRenderColor(null)),_e,me,Le,Ce,null,null,null,[J._globeTileDebugBorderBuffer]),E){const He=J.latestRawTileData,ct=Math.floor((He&&He.byteLength||0)/1024);let ht=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ht+=` => ${d.overscaledZ}`),ht+=` ${J.state}`,ht+=` ${ct}kb`,function(St,Ut){St.initDebugOverlayCanvas();const rt=St.debugOverlayCanvas,Ue=St.context.gl,_t=St.debugOverlayCanvas.getContext("2d");_t.clearRect(0,0,rt.width,rt.height),_t.shadowColor="white",_t.shadowBlur=2,_t.lineWidth=1.5,_t.strokeStyle="white",_t.textBaseline="top",_t.font="bold 36px Open Sans, sans-serif",_t.fillText(Ut,5,5),_t.strokeText(Ut,5,5),St.debugOverlayTexture.update(rt),St.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(m,ht)}const Re=o.getTile(d).tileSize,Ae=512/Math.min(Re,512)*(d.overscaledZ/M.zoom)*.5,Te=J._tileDebugTextBuffer||m.debugBuffer,Fe=J._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Xe=J._tileDebugTextSegments||m.debugSegments;te.draw(m,N.TRIANGLES,oe,ae,jr.alphaBlended,Cr.disabled,Z0(W,s.ao.transparent.toPremultipliedRenderColor(null),Ae),_e,Te,Fe,Xe,null,null,null,[J._globeTileDebugTextBuffer])}function Pf(m,o,d,g){Ke(m,0,o+d/2,m.transform.width,d,g)}function fa(m,o,d,g){Ke(m,o-d/2,0,d,m.transform.height,g)}function Ke(m,o,d,g,b,T){const E=m.context,I=E.gl;I.enable(I.SCISSOR_TEST),I.scissor(o*s.o.devicePixelRatio,d*s.o.devicePixelRatio,g*s.o.devicePixelRatio,b*s.o.devicePixelRatio),E.clear({color:T}),I.disable(I.SCISSOR_TEST)}const BE=s.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Cy}=BE;function Wc(m,o,d,g){m.emplaceBack(o,d,g)}class ky{constructor(o){this.vertexArray=new s.em,this.indices=new s.b0,Wc(this.vertexArray,-1,-1,1),Wc(this.vertexArray,1,-1,1),Wc(this.vertexArray,-1,1,1),Wc(this.vertexArray,1,1,1),Wc(this.vertexArray,-1,-1,-1),Wc(this.vertexArray,1,-1,-1),Wc(this.vertexArray,-1,1,-1),Wc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Cy),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=s.bg.simpleSegment(0,0,36,12)}}function Of(m,o,d,g,b,T){const E=m.context.gl,I=o.paint.get("sky-atmosphere-color"),M=o.paint.get("sky-atmosphere-halo-color"),N=o.paint.get("sky-atmosphere-sun-intensity"),j=((Z,W,Y,te,J)=>({u_matrix_3f:Z,u_sun_direction:W,u_sun_intensity:Y,u_color_tint_r:[te.r,te.g,te.b,te.a],u_color_tint_m:[J.r,J.g,J.b,J.a],u_luminance:5e-5}))(s.eo(s.dO(),g),b,N,I.toPremultipliedRenderColor(null),M.toPremultipliedRenderColor(null));E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+T,o.skyboxTexture,0),d.draw(m,E.TRIANGLES,zn.disabled,kr.disabled,jr.unblended,Cr.frontCW,j,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const jE=s.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class $p{constructor(o){const d=new s.ep;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const g=new s.b0;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(d,jE.members),this.indexBuffer=o.createIndexBuffer(g),this.segments=s.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Qk=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Jk{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class UE{constructor(o){this.colorModeAlphaBlendedWriteRGB=new jr([1,$c,1,$c],s.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new jr([1,0,1,0],s.ao.transparent,[!1,!1,!1,!0]),this.params=new Jk,this.updateNeeded=!0}update(o){const d=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new $p(d);const g=this.params.sizeRange,b=this.params.intensityRange,T=function(j){const Z=s.eq(30),W=[];for(let Y=0;Y<j;++Y){const te=2*Math.PI*Z(),J=Math.acos(1-2*Z())-.5*Math.PI;W.push(s.d5(Math.cos(J)*Math.cos(te),Math.cos(J)*Math.sin(te),Math.sin(J)))}return W}(this.params.starsCount),E=s.eq(300),I=new s.er,M=new s.b0;let N=0;for(let j=0;j<T.length;++j){const Z=s.c5([],T[j],200),W=Math.max(0,1+.01*g*(1*E()-.5)),Y=Math.max(0,1+.01*b*(1*E()-.5));I.emplaceBack(Z[0],Z[1],Z[2],-1,-1,W,Y),I.emplaceBack(Z[0],Z[1],Z[2],1,-1,W,Y),I.emplaceBack(Z[0],Z[1],Z[2],1,1,W,Y),I.emplaceBack(Z[0],Z[1],Z[2],-1,1,W,Y),M.emplaceBack(N+0,N+1,N+2),M.emplaceBack(N+0,N+2,N+3),N+=4}this.starsVx=d.createVertexBuffer(I,Qk.members),this.starsIdx=d.createIndexBuffer(M),this.starsSegments=s.bg.simpleSegment(0,0,I.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,d){const g=o.context,b=g.gl,T=o.transform,E=new zn(b.LEQUAL,zn.ReadOnly,[0,1]),I=s.aj(T.zoom),M=o.style.getLut(d.scope),N=d.properties.get("color-use-theme")==="none",j=d.properties.get("color").toNonPremultipliedRenderColor(N?null:M),Z=d.properties.get("high-color-use-theme")==="none",W=d.properties.get("high-color").toNonPremultipliedRenderColor(Z?null:M),Y=d.properties.get("space-color-use-theme")==="none",te=d.properties.get("space-color").toNonPremultipliedRenderColor(Y?null:M),J=5e-4,oe=s.es(d.properties.get("horizon-blend"),0,1,J,.25),ae=s.dE(o,g,T)&&oe===J?T.worldSize/(2*Math.PI*1.025)-1:T.globeRadius,pe=o.frameCounter/1e3%1,_e=s.ag(T.globeCenterInViewSpace),me=Math.sqrt(Math.pow(_e,2)-Math.pow(ae,2)),Le=Math.acos(me/_e),Ce=Re=>{const Ae=T.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Re&&Ae.push("ALPHA_PASS");const Te=o.getOrCreateProgram("globeAtmosphere",{defines:Ae}),Fe=((He,ct,ht,St,Ut,rt,Ue,_t,lt,Ot,en,yn)=>({u_frustum_tl:He,u_frustum_tr:ct,u_frustum_br:ht,u_frustum_bl:St,u_horizon:Ut,u_transition:rt,u_fadeout_range:Ue,u_atmosphere_fog_color:_t.toArray01(),u_high_color:lt.toArray01(),u_space_color:Ot.toArray01(),u_temporal_offset:en,u_horizon_angle:yn}))(T.frustumCorners.TL,T.frustumCorners.TR,T.frustumCorners.BR,T.frustumCorners.BL,T.frustumCorners.horizon,I,oe,j,W,te,pe,Le);o.uploadCommonUniforms(g,Te);const Xe=this.atmosphereBuffer;Xe&&Te.draw(o,b.TRIANGLES,E,kr.disabled,Re?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Cr.backCW,Fe,Re?"atmosphere_glow_alpha":"atmosphere_glow",Xe.vertexBuffer,Xe.indexBuffer,Xe.segments)};Ce(!1),Ce(!0)}drawStars(o,d){const g=s.aA(d.properties.get("star-intensity"),0,1);if(g===0)return;const b=o.context,T=b.gl,E=o.transform,I=o.getOrCreateProgram("stars"),M=s.c7([]);s.c9(M,M,-E._pitch),s.c8(M,M,-E.angle),s.c9(M,M,s.an(E._center.lat)),s.et(M,M,-s.an(E._center.lng));const N=s.cc(new Float32Array(16),M),j=s.aB([],E.starsProjMatrix,N),Z=s.eo([],N),W=s.eu([],Z),Y=[0,1,0];s.dQ(Y,Y,W),s.c5(Y,Y,this.params.sizeMultiplier);const te=[1,0,0];s.dQ(te,te,W),s.c5(te,te,this.params.sizeMultiplier);const J=(oe=Y,ae=te,pe=g,{u_matrix:Float32Array.from(j),u_up:oe,u_right:ae,u_intensity_multiplier:pe});var oe,ae,pe;o.uploadCommonUniforms(b,I),this.starsVx&&this.starsIdx&&I.draw(o,T.TRIANGLES,zn.disabled,kr.disabled,this.colorModeAlphaBlendedWriteRGB,Cr.disabled,J,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Iy{constructor(){this.visibleTiles=[]}updateBorders(o,d){const g=[],b=[],T=o._getRenderableCoordinates(!1,!0);for(const M of T){const N=o.getTile(M);if(!N.hasData())continue;const j=N.getBucket(d);j&&(j.isEmpty()||(g.push(M.key),b.push({bucket:j,tileID:M.canonical})))}let E=g.length!==this.visibleTiles.length;if(!E){g.sort();for(let M=0;M<g.length;M++)if(g[M]!==this.visibleTiles[M]){E=!0;break}}if(!E)return;const I=new Set;this.visibleTiles=g,b.sort((M,N)=>M.tileID.z-N.tileID.z||M.tileID.x-N.tileID.x||M.tileID.y-N.tileID.y);for(const M of b){const N=new Array,j=new Array,Z=M.bucket;for(const W of Z.featuresOnBorder)I.has(W.featureId)?j.push(W.footprintIndex):(I.add(W.featureId),N.push(W.footprintIndex));Z.updateFootprintHiddenFlags(N,s.ev,!1),Z.updateFootprintHiddenFlags(j,s.ev,!0)}}}function Ry(m,o){const d=[...m],g=o.cameraWorldSizeForFog/o.worldSize,b=s.bA([]);return s.cS(b,b,[g,g,1]),s.aB(d,b,d),s.aB(d,o.worldToFogMatrix,d),d}function My(m,o,d,g,b){const T=d.material,E=g.context,{baseColorTexture:I,metallicRoughnessTexture:M}=T.pbrMetallicRoughness,{normalTexture:N,occlusionTexture:j,emissionTexture:Z}=T;function W(te,J,oe){if(te&&(m.push(J),E.activeTexture.set(E.gl.TEXTURE0+oe),te.gfxTexture)){const{minFilter:ae,magFilter:pe,wrapS:_e,wrapT:me}=te.sampler;te.gfxTexture.bindExtraParam(ae,pe,_e,me)}}W(I,"HAS_TEXTURE_u_baseColorTexture",wo.BaseColor),W(M,"HAS_TEXTURE_u_metallicRoughnessTexture",wo.MetallicRoughness),W(N,"HAS_TEXTURE_u_normalTexture",wo.Normal),W(j,"HAS_TEXTURE_u_occlusionTexture",wo.Occlusion),W(Z,"HAS_TEXTURE_u_emissionTexture",wo.Emission),b&&(b.texture||(b.texture=new s.d$(g.context,b.image,[b.image.height,b.image.height,b.image.height],E.gl.RGBA8)),E.activeTexture.set(E.gl.TEXTURE0+wo.LUT),b.texture&&b.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),d.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(d.texcoordBuffer)),d.colorBuffer&&(m.push(d.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(d.colorBuffer)),d.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(d.normalBuffer)),d.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(d.pbrBuffer)),T.alphaMode!=="OPAQUE"&&T.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),T.defined||m.push("DIFFUSE_SHADED");const Y=g.shadowRenderer;Y&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Y.useNormalOffset&&m.push("NORMAL_OFFSET"))}function Py(m,o,d,g,b,T){const E=m.modelOpacity,I=o.context,M=new zn(o.context.gl.LEQUAL,m.isLightMesh?zn.ReadOnly:zn.ReadWrite,o.depthRangeFor3D),N=o.transform,j=m.mesh,Z=j.material,W=Z.pbrMetallicRoughness,Y=o.style.fog;let te;te=o.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:s.aB([],g.zScaleMatrix,m.nodeModelMatrix),s.aB(te,g.negCameraPosMatrix,te);const J=s.bl([],te);s.eg(J,J);const oe=d.paint.get("model-color-use-theme").constantOr("default")==="none",ae=d.paint.get("model-emissive-strength").constantOr(0),pe=kf(new Float32Array(m.worldViewProjection),new Float32Array(te),new Float32Array(J),null,o,E,W.baseColorFactor,Z.emissiveFactor,W.metallicFactor,W.roughnessFactor,Z,ae,d,void 0,void 0,m.materialOverride,m.modelColor),_e={defines:[]},me=[],Le=o.shadowRenderer;Le&&(Le.useNormalOffset=!1),My(_e.defines,me,j,o,oe?null:d.lut);let Ce=null;if(Y){const Te=Ry(m.nodeModelMatrix,o.transform);if(Ce=new Float32Array(Te),N.projection.name!=="globe"){const Fe=j.aabb.min,Xe=j.aabb.max,[He,ct]=Y.getOpacityForBounds(Te,Fe[0],Fe[1],Xe[0],Xe[1]);_e.overrideFog=He>=bt||ct>=bt}}const Re=yh(o,d.paint.get("model-cutoff-fade-range"));Re.shouldRenderCutoff&&_e.defines.push("RENDER_CUTOFF");const Ae=o.getOrCreateProgram("model",_e);o.uploadCommonUniforms(I,Ae,null,Ce,Re),o.renderPass!=="shadow"&&Le&&Le.setupShadowsFromMatrix(m.nodeModelMatrix,Ae),Ae.draw(o,I.gl.TRIANGLES,M,b,T,j.material.doubleSided?Cr.disabled:Cr.backCCW,pe,d.id,j.vertexBuffer,j.indexBuffer,j.segments,d.paint,o.transform.zoom,void 0,me)}function eg(m,o){return m.style._importedAsBasemap?"basemap":o.scope}function Lf(m,o,d,g,b,T,E,I,M,N){const j=m.transform,Z=!!o.isGeometryBloom&&o.isGeometryBloom;if(Z&&m.renderPass==="shadow")return;const W=j.projection.name==="globe"?s.eD(d,j):[...d];s.aB(W,W,o.globalMatrix);const Y=s.aB([],g,W);if(o.meshes)for(const te of o.meshes){const J=I.get(te.material.name);if(J&&J.opacity<=0)continue;if(te.material.alphaMode!=="BLEND"){E.push({mesh:te,depth:0,modelIndex:b,worldViewProjection:Y,nodeModelMatrix:W,isLightMesh:Z,materialOverride:J,modelOpacity:M,modelColor:N});continue}const oe=s.af([],te.centroid,Y);!j.isOrthographic&&oe[2]<=0||T.push({mesh:te,depth:oe[2],modelIndex:b,worldViewProjection:Y,nodeModelMatrix:W,isLightMesh:Z,materialOverride:J,modelOpacity:M,modelColor:N})}if(o.children)for(const te of o.children)Lf(m,te,d,g,b,T,E,I,M,N)}function fc(m,o,d,g){const b=d.shadowRenderer;if(!b)return;const T=b.getShadowPassDepthMode(),E=b.getShadowPassColorMode(),I=b.calculateShadowPassMatrixFromMatrix(o),M=tb(I);d.getOrCreateProgram("modelDepth",{defines:d._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(d,d.context.gl.TRIANGLES,T,kr.disabled,E,Cr.disabled,M,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,d.transform.zoom,void 0,void 0)}function VE(m,o,d,g,b,T){for(const E of b){const I=Object.assign({},g);I.part=E;const M={type:"Unknown",id:o,properties:I},N={orientation:m.paint.get("model-rotation").evaluate(M,d)};T.set(E,N)}}function $E(m,o,d,g,b,T){for(const E of b){const I=Object.assign({},g);I.part=E;const M={type:"Unknown",id:o,properties:I},N={color:m.paint.get("model-color").evaluate(M,d),colorMix:m.paint.get("model-color-mix-intensity").evaluate(M,d),opacity:m.paint.get("model-opacity").evaluate(M,d),emissionStrength:m.paint.get("model-emissive-strength").evaluate(M,d)};T.set(E,N)}}function HE(m,o,d,g,b){let T=!1;for(const I of g)I.modelOpacity!==1&&(Py(I,m,o,b[I.modelIndex],kr.disabled,jr.disabled),T=!0);for(const I of g)Py(I,m,o,b[I.modelIndex],I.modelOpacity!==1?m.stencilModeFor3D():kr.disabled,m.colorModeForRenderPass());T&&m.resetStencilClippingMasks();const E=jr.additive;for(const I of d)Py(I,m,o,b[I.modelIndex],kr.disabled,I.isLightMesh?E:m.colorModeForRenderPass())}function GE(m,o,d){const g=o.updateZoomBasedPaintProperties(),b=function(T,E,I){let M,N,j,Z=T.terrain?T.terrain.exaggeration():0;if(T.terrain&&Z>0){const W=T.terrain,Y=W.findDEMTileFor(I);Y&&Y.dem?M=s.eF.create(W,I,Y):Z=0}if(Z===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),Z===E.validForExaggeration&&(Z===0||M&&M._demTile&&M._demTile.tileID===E.validForDEMTile.id&&M._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const W in E.instancesPerModel){const Y=E.instancesPerModel[W];for(let te=0;te<Y.instancedDataArray.length;++te){const J=(M?Z*M.getElevationAt(0|Y.instancedDataArray.float32[16*te],0|Y.instancedDataArray.float32[16*te+1],!0,!0):0)+Y.instancesEvaluatedElevation[te];Y.instancedDataArray.float32[16*te+6]=J,N=N?Math.min(E.terrainElevationMin,J):J,j=j?Math.max(E.terrainElevationMax,J):J}}return E.terrainElevationMin=N||0,E.terrainElevationMax=j||0,E.validForExaggeration=Z,E.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,o,d);(g||b)&&(o.uploaded=!1,o.upload(m.context))}const Zc={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d9([0,0,0],[s.al,s.al,0])};function yl(m,o){const d=1<<m.canonical.z,g=o.getFreeCameraOptions().position,b=o.elevation,T=m.canonical.x/d,E=(m.canonical.x+1)/d,I=m.canonical.y/d,M=(m.canonical.y+1)/d;let N=o._centerAltitude;if(b){const Y=b.getMinMaxForTile(m);Y&&Y.max>N&&(N=Y.max)}const j=s.aA(g.x,T,E)-g.x,Z=s.aA(g.y,I,M)-g.y,W=s.cf(N,o.center.lat)-g.z;return o._zoomFromMercatorZ(Math.sqrt(j*j+Z*Z+W*W))}function qE(m,o,d,g,b,T,E){const I=m.context,M=m.renderPass==="shadow",N=m.shadowRenderer,j=M&&N?N.getShadowPassDepthMode():new zn(I.gl.LEQUAL,zn.ReadWrite,m.depthRangeFor3D),Z=m.isTileAffectedByFog(T),W=m.transform.projection.name==="globe";if(d.meshes)for(const Y of d.meshes){const te=W?[]:["MODEL_POSITION_ON_GPU"],J=[];let oe,ae,pe;const _e=!W&&g.instancedDataArray.length>20;_e&&te.push("INSTANCED_ARRAYS");const me=yh(m,o.paint.get("model-cutoff-fade-range"));if(me.shouldRenderCutoff&&te.push("RENDER_CUTOFF"),M&&N)oe=m.getOrCreateProgram("modelDepth",{defines:te}),ae=tb(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(d.globalMatrix)),pe=N.getShadowPassColorMode();else{My(te,J,Y,m,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),oe=m.getOrCreateProgram("model",{defines:te,overrideFog:Z});const Ce=Y.material,Re=Ce.pbrMetallicRoughness,Ae=o.paint.get("model-opacity").constantOr(1),Te=o.paint.get("model-emissive-strength").constantOr(0);ae=kf(T.expandedProjMatrix,Float32Array.from(d.globalMatrix),new Float32Array(16),null,m,Ae,Re.baseColorFactor,Ce.emissiveFactor,Re.metallicFactor,Re.roughnessFactor,Ce,Te,o,b),N&&(E.shadowUniformsInitialized?oe.setShadowUniformValues(I,N.getShadowUniformValues()):(N.setupShadows(T.toUnwrapped(),oe,"model-tile"),E.shadowUniformsInitialized=!0)),pe=me.shouldRenderCutoff||Ae<1||Ce.alphaMode!=="OPAQUE"?jr.alphaBlended:jr.unblended}m.uploadCommonUniforms(I,oe,T.toUnwrapped(),null,me);const Le=Y.material.doubleSided?Cr.disabled:Cr.backCCW;if(_e)J.push(g.instancedDataBuffer),oe.draw(m,I.gl.TRIANGLES,j,kr.disabled,pe,Le,ae,o.id,Y.vertexBuffer,Y.indexBuffer,Y.segments,o.paint,m.transform.zoom,void 0,J,g.instancedDataArray.length);else{const Ce=M?"u_instance":"u_normal_matrix";for(let Re=0;Re<g.instancedDataArray.length;++Re)ae[Ce]=new Float32Array(g.instancedDataArray.arrayBuffer,64*Re,16),oe.draw(m,I.gl.TRIANGLES,j,kr.disabled,pe,Le,ae,o.id,Y.vertexBuffer,Y.indexBuffer,Y.segments,o.paint,m.transform.zoom,void 0,J)}}if(d.children)for(const Y of d.children)qE(m,o,Y,g,b,T,E)}const tg=[1,-1,1];function eI(m,o,d,g){if(!d.modelManager)return!0;const b=d.modelManager;if(!d.shadowRenderer)return!0;const T=d.shadowRenderer,E=o.aabb;let I=!0,M=m.maxHeight;if(M===0){let j=0;for(const Z in m.instancesPerModel){const W=b.getModel(Z,g);W?j=Math.max(j,Math.max(Math.max(W.aabb.max[0],W.aabb.max[1]),W.aabb.max[2])):I=!1}M=m.maxScale*j*1.41+m.maxVerticalOffset,I&&(m.maxHeight=M)}E.max[2]=M,E.min[2]+=m.terrainElevationMin,E.max[2]+=m.terrainElevationMax,s.af(E.min,E.min,o.tileMatrix),s.af(E.max,E.max,o.tileMatrix);const N=E.intersects(T.getCurrentCascadeFrustum());return d.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=N===2),N===0}function Hs(m,o){const d=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],b=m.uniformValues.u_cutoff_params[2],T=m.uniformValues.u_cutoff_params[3];return g===d||T===b?1:s.aA(((o-d)/(g-d)-b)/(T-b),0,1)}function ui(m,o,d,g){if(o.pitch<20)return 1;const b=o.getWorldToCameraMatrix();s.aB(b,b,m);const T=s.bU(d.min[0],d.min[1],d.min[2],1);let E=s.aC(s.eG(),T,b),I=E,M=E;T[1]=d.max[1],E=s.aC(s.eG(),T,b),I=E[1]<I[1]?E:I,M=E[1]>M[1]?E:M,T[0]=d.max[0],E=s.aC(s.eG(),T,b),I=E[1]<I[1]?E:I,M=E[1]>M[1]?E:M,T[1]=d.min[1],E=s.aC(s.eG(),T,b),I=E[1]<I[1]?E:I,M=E[1]>M[1]?E:M;const N=s.aA(g[0],0,1),j=100*o.pixelsPerMeter*s.aA(g[1],0,1),Z=s.aA(g[2],0,1),W=s.eH(s.eG(),I,M,N),Y=Math.tan(.5*o.fovX),te=-W[2]*Y;if(j===0)return W[1]<-Math.abs(te)?Z:1;const J=(-Math.abs(te)-W[1])/j,oe=(pe,_e,me)=>(1-me)*pe+me*_e,ae=s.aA(oe(1,Z,J),Z,1);return oe(1,ae,s.aA((o.pitch-20)/20,0,1))}class WE{}class kh{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,d,g){{const Z=this._storage.get(d.id);if(Z)return Z.lastUsedFrameIdx=o,Z.buf}const b=g.gl,T=b.getBufferParameter(b.ELEMENT_ARRAY_BUFFER,b.BUFFER_SIZE),E=new ArrayBuffer(T),I=new Int16Array(E);b.getBufferSubData(b.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const M=new s.eJ;for(let Z=0;Z<T/2;Z+=3){const W=I[Z],Y=I[Z+1],te=I[Z+2];M.emplaceBack(W,Y),M.emplaceBack(Y,te),M.emplaceBack(te,W)}const N=g.bindVertexArrayOES.current,j=new WE;return j.buf=new hc(g,M),j.lastUsedFrameIdx=o,this._storage.set(d.id,j),g.bindVertexArrayOES.set(N),j.buf}update(o){for(const[d,g]of this._storage)o-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(d))}destroy(){for(const[o,d]of this._storage)d.buf.destroy(),this._storage.delete(o)}}class Hp{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const Gp=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Id{constructor(o){this.revealStart=11,this.revealRange=2}}const ob=s.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class lb{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,d){const g=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const E=new s.eK,I=new s.b0;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(1,1),E.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(E,ob.members),this.vignetteIdx=o.context.createIndexBuffer(I)}const b=s.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,g);const E={u_vignetteShape:(T={vignetteShape:[d.start,d.range,Math.pow(10,d.fadePower)],vignetteColor:[d.color.r,d.color.g,d.color.b,d.color.a*d.strength]}).vignetteShape,u_vignetteColor:T.vignetteColor};g.draw(o,o.context.gl.TRIANGLES,zn.disabled,kr.disabled,jr.alphaBlended,Cr.disabled,E,"vignette",this.vignetteVx,this.vignetteIdx,b)}var T}}class ub{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,d){const g=o.getFreeCameraOptions().position,b=g.toAltitude(),T=g.toLngLat(),E=s.an(T.lng),I=s.an(T.lat),M=o.pixelsPerMeter/d,N=E*s.eM,j=s.eM*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Z=-this._offsetYPrev+j,W=-this._elevationPrev+b;this._accumulatedOffsetX+=(-this._offsetXPrev+N)*M,this._accumulatedOffsetY+=Z*M,this._accumulatedElevation+=W*M,this._offsetXPrev=N,this._offsetYPrev=j,this._elevationPrev=b}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Oy(m,o){return[-(m[0]-Math.floor(m[0]/o)*o),-(m[1]-Math.floor(m[1]/o)*o),-(m[2]-Math.floor(m[2]/o)*o)]}function cu(m){const o=s.eq(1323123451230),d=[];for(let g=0;g<m;++g){const b=2*o()-1,T=2*o()-1,E=2*o()-1;d.push(s.d5(b,T,E))}return d}function kl(m,o,d,g,b){const T=s.aA((b-d)/(g-d),0,1);return(1-T)*m+T*o}class Df{constructor(o){this._movement=new ub,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new lb,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,d){const g=o.transform;this._movement.update(g,this._ppmScaleFactor);const b=g.starsProjMatrix,T=s.c7([]);s.c9(T,T,s.an(90)-g._pitch),s.c8(T,T,-g.angle);const E=s.cc(new Float32Array(16),T),I=s.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),M=s.eg([],I),N=s.aB([],M,E),j=Date.now()/1e3;return this._accumulatedTimeFromStart+=(j-this._prevTime)*d,this._prevTime=j,{projectionMatrix:b,modelviewMatrix:N}}}class Ly extends Df{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Id("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){const d=o.context;if(!this.particlesVx){const g=cu(this.particlesCount),b=new s.eN,T=new s.b0;let E=0;const I=s.eq(1323123451230);for(let M=0;M<g.length;++M){const N=g[M],j=[2*I()-1,I(),I(),I()];b.emplaceBack(N[0],N[1],N[2],-1,-1,...j),b.emplaceBack(N[0],N[1],N[2],1,-1,...j),b.emplaceBack(N[0],N[1],N[2],1,1,...j),b.emplaceBack(N[0],N[1],N[2],-1,1,...j),T.emplaceBack(E+0,E+1,E+2),T.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=d.createVertexBuffer(b,Gp.members),this.particlesIdx=d.createIndexBuffer(T)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;const d=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},g=o.transform.zoom;if(d.revealStart>g)return;const b=kl(0,1,d.revealStart,d.revealStart+d.revealRange,g);if(!this.particlesVx||!this.particlesIdx)return;const T=structuredClone(this._params);let E=[-T.direction.x,T.direction.y,-100];s.aw(E,E);const I=structuredClone(this._vignetteParams);I.strength*=b,T.overrideStyleParameters||(T.intensity=o.style.rain.state.density,T.timeFactor=o.style.rain.state.intensity,T.color=structuredClone(o.style.rain.state.color),E=structuredClone(o.style.rain.state.direction),T.screenThinning.intensity=o.style.rain.state.centerThinning,T.dropletSizeX=o.style.rain.state.dropletSize[0],T.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],T.distortionStrength=100*o.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(o.style.rain.state.vignetteColor));const M=this.updateOnRender(o,T.timeFactor),N=o.context,j=N.gl,Z=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new s.T(N,{width:o.width,height:o.height,data:null},j.RGBA8)),T.distortionStrength>0&&(N.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),j.copyTexSubImage2D(j.TEXTURE_2D,0,0,0,0,0,o.width,o.height));const W=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms(N,W),N.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const Y=[T.color.r,T.color.g,T.color.b,T.color.a],te=(J,oe)=>{const ae=Oy(this._movement.getPosition(),J),pe=T.dropletSizeX,_e=T.dropletSizeX*T.dropletSizeYScale,me=o.width/2,Le=o.height/2,Ce=kl(0,T.screenThinning.start,0,1,T.screenThinning.intensity),Re=kl(.001,T.screenThinning.range,0,1,T.screenThinning.intensity),Ae=kl(0,T.screenThinning.particleOffset,0,1,T.screenThinning.intensity),Te=(Fe={modelview:M.modelviewMatrix,projection:M.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ae,velocityConeAperture:T.velocityConeAperture,velocity:T.velocity,boxSize:J,rainDropletSize:[pe,_e],distortionStrength:T.distortionStrength,rainDirection:E,color:Y,screenSize:[Z.width,Z.height],thinningCenterPos:[me,Le],thinningShape:[Ce,Re,Math.pow(10,T.screenThinning.fadePower)],thinningAffectedRatio:T.screenThinning.affectedRatio,thinningParticleOffset:Ae,shapeDirectionalPower:T.shapeDirPower,shapeNormalPower:T.shapeNormalPower,mode:oe?0:1},{u_modelview:Float32Array.from(Fe.modelview),u_projection:Float32Array.from(Fe.projection),u_time:Fe.time,u_cam_pos:Fe.camPos,u_texScreen:0,u_velocityConeAperture:Fe.velocityConeAperture,u_velocity:Fe.velocity,u_boxSize:Fe.boxSize,u_rainDropletSize:Fe.rainDropletSize,u_distortionStrength:Fe.distortionStrength,u_rainDirection:Fe.rainDirection,u_color:Fe.color,u_screenSize:Fe.screenSize,u_thinningCenterPos:Fe.thinningCenterPos,u_thinningShape:Fe.thinningShape,u_thinningAffectedRatio:Fe.thinningAffectedRatio,u_thinningParticleOffset:Fe.thinningParticleOffset,u_shapeDirectionalPower:Fe.shapeDirectionalPower,u_shapeNormalPower:Fe.shapeNormalPower,u_mode:Fe.mode});var Fe;const Xe=Math.round(T.intensity*this.particlesCount),He=s.bg.simpleSegment(0,0,4*Xe,2*Xe);W.draw(o,j.TRIANGLES,zn.disabled,kr.disabled,jr.alphaBlended,Cr.disabled,Te,"rain_particles",this.particlesVx,this.particlesIdx,He)};T.distortionStrength>0&&te(T.boxSize,!0),te(T.boxSize,!1),this._vignette.draw(o,I)}}const cb=s.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class db extends Df{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Id("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){const d=o.context;if(!this.particlesVx){const g=cu(this.particlesCount),b=new s.eO,T=new s.b0;let E=0;const I=s.eq(1323123451230);for(let M=0;M<g.length;++M){const N=g[M],j=I(),Z=I(),W=I(),Y=[M/g.length,j,Z,W],te=[I(),I()];b.emplaceBack(N[0],N[1],N[2],-1,-1,...Y,...te),b.emplaceBack(N[0],N[1],N[2],1,-1,...Y,...te),b.emplaceBack(N[0],N[1],N[2],1,1,...Y,...te),b.emplaceBack(N[0],N[1],N[2],-1,1,...Y,...te),T.emplaceBack(E+0,E+1,E+2),T.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=d.createVertexBuffer(b,cb.members),this.particlesIdx=d.createIndexBuffer(T)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;const d=structuredClone(this._params);let g=[-d.direction.x,d.direction.y,-100];s.aw(g,g);const b=structuredClone(this._vignetteParams),T=d.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},E=o.transform.zoom;if(T.revealStart>E)return;const I=kl(0,1,T.revealStart,T.revealStart+T.revealRange,E);b.strength*=I,d.overrideStyleParameters||(d.intensity=o.style.snow.state.density,d.timeFactor=o.style.snow.state.intensity,d.color=structuredClone(o.style.snow.state.color),g=structuredClone(o.style.snow.state.direction),d.screenThinning.intensity=o.style.snow.state.centerThinning,d.billboardSize=2.79*o.style.snow.state.flakeSize,b.strength=1,b.color=structuredClone(o.style.snow.state.vignetteColor));const M=this.updateOnRender(o,d.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const N=o.context,j=N.gl,Z=o.transform,W=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms(N,W),((Y,te,J)=>{const oe=Oy(this._movement.getPosition(),Y),ae=Z.width/2,pe=Z.height/2,_e=kl(0,J.screenThinning.start,0,1,J.screenThinning.intensity),me=kl(.001,J.screenThinning.range,0,1,J.screenThinning.intensity),Le=kl(0,J.screenThinning.particleOffset,0,1,J.screenThinning.intensity),Ce=(Re={modelview:M.modelviewMatrix,projection:M.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:oe,velocityConeAperture:J.velocityConeAperture,velocity:J.velocity,horizontalOscillationRadius:J.horizontalOscillationRadius,horizontalOscillationRate:J.horizontalOscillationRate,boxSize:Y,billboardSize:1*J.billboardSize,simpleShapeParameters:[J.shapeFadeStart,J.shapeFadePower],screenSize:[Z.width,Z.height],thinningCenterPos:[ae,pe],thinningShape:[_e,me,Math.pow(10,J.screenThinning.fadePower)],thinningAffectedRatio:J.screenThinning.affectedRatio,thinningParticleOffset:Le,color:[J.color.r,J.color.g,J.color.b,J.color.a],direction:g},{u_modelview:Float32Array.from(Re.modelview),u_projection:Float32Array.from(Re.projection),u_time:Re.time,u_cam_pos:Re.camPos,u_velocityConeAperture:Re.velocityConeAperture,u_velocity:Re.velocity,u_horizontalOscillationRadius:Re.horizontalOscillationRadius,u_horizontalOscillationRate:Re.horizontalOscillationRate,u_boxSize:Re.boxSize,u_billboardSize:Re.billboardSize,u_simpleShapeParameters:Re.simpleShapeParameters,u_screenSize:Re.screenSize,u_thinningCenterPos:Re.thinningCenterPos,u_thinningShape:Re.thinningShape,u_thinningAffectedRatio:Re.thinningAffectedRatio,u_thinningParticleOffset:Re.thinningParticleOffset,u_particleColor:Re.color,u_direction:Re.direction});var Re;const Ae=Math.round(J.intensity*this.particlesCount),Te=s.bg.simpleSegment(0,0,4*Ae,2*Ae);this.particlesVx&&this.particlesIdx&&W.draw(o,j.TRIANGLES,zn.disabled,kr.disabled,jr.alphaBlended,Cr.disabled,Ce,"snow_particles",this.particlesVx,this.particlesIdx,Te)})(d.boxSize,0,d),this._vignette.draw(o,b)}}const Ih={symbol:function(m,o,d,g,b){if(m.renderPass!=="translucent")return;const T=kr.disabled,E=m.colorModeForRenderPass(),I=d.layout.get("text-variable-anchor"),M=d.layout.get("text-size-scale-range"),N=s.aA(m.scaleFactor,M[0],M[1]);I&&function(W,Y,te,J,oe,ae,pe,_e){const me=Y.transform,Le=oe==="map",Ce=ae==="map";for(const Re of W){const Ae=J.getTile(Re),Te=Ae.getBucket(te);if(!Te||!Te.text||!Te.text.segments.get().length)continue;const Fe=s.bK(Te.textSizeData,me.zoom,_e),Xe=Uc(Re,Te.getProjection(),me),He=me.calculatePixelsToTileUnitsMatrix(Ae),ct=ll(Xe,Ae.tileID.canonical,Ce,Le,me,Te.getProjection(),He),ht=Te.hasIconTextFit()&&Te.hasIconData();Fe&&pr(Te,Le,Ce,pe,me,ct,Re,Math.pow(2,me.zoom-Ae.tileID.overscaledZ),Fe,ht)}}(g,m,d,o,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b,N);const j=d.paint.get("icon-opacity").constantOr(1)!==0,Z=d.paint.get("text-opacity").constantOr(1)!==0;d.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(j||Z)?K0(m,o,d,g,T,E):(j&&K0(m,o,d,g,T,E,{onlyIcons:!0}),Z&&K0(m,o,d,g,T,E,{onlyText:!0})),o.map.showCollisionBoxes&&(An(m,o,d,g,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),An(m,o,d,g,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(m,o,d,g){if(m.renderPass!=="translucent")return;const b=d.paint.get("circle-opacity"),T=d.paint.get("circle-stroke-width"),E=d.paint.get("circle-stroke-opacity"),I=d.layout.get("circle-sort-key").constantOr(1)!==void 0,M=d.paint.get("circle-emissive-strength");if(b.constantOr(1)===0&&(T.constantOr(1)===0||E.constantOr(1)===0))return;const N=m.context,j=N.gl,Z=m.transform,W=!(!m.terrain||!m.terrain.enabled),Y=d.layout.get("circle-elevation-reference"),te=m.depthModeForSublayer(0,zn.ReadOnly),J=new zn(m.context.gl.LEQUAL,zn.ReadOnly,m.depthRangeFor3D),oe=Y==="none"||W?te:J,ae=kr.disabled,pe=m.colorModeForDrapableLayerRenderPass(M),_e=Z.projection.name==="globe",me=[s.aF(Z.center.lng),s.aJ(Z.center.lat)],Le=[];for(let Re=0;Re<g.length;Re++){const Ae=g[Re],Te=o.getTile(Ae),Fe=Te.getBucket(d);if(!Fe||Fe.projection.name!==Z.projection.name)continue;const Xe=Fe.programConfigurations.get(d.id),He=Fe.layoutVertexBuffer,ct=Fe.globeExtVertexBuffer,ht=Fe.indexBuffer,St=s.e0(d),Ut=[ct],rt=m.isTileAffectedByFog(Ae);_e&&St.push("PROJECTION_GLOBE_VIEW"),St.push("DEPTH_D24"),m.terrain&&Z.depthOcclusionForSymbolsAndCircles&&St.push("DEPTH_OCCLUSION"),Fe.hasElevation&&!m.terrain&&(St.push("ELEVATED_ROADS"),Ut.push(Fe.elevatedLayoutVertexBuffer));const Ue=m.getOrCreateProgram("circle",{config:Xe,defines:St,overrideFog:rt}),_t=Z.projection.createInversionMatrix(Z,Ae.canonical),lt={programConfiguration:Xe,program:Ue,layoutVertexBuffer:He,dynamicBuffers:Ut,indexBuffer:ht,uniformValues:s.e1(m,Ae,Te,_t,me,d),tile:Te};if(I){const Ot=Fe.segments.get();for(const en of Ot)Le.push({segments:new s.bg([en]),sortKey:en.sortKey,state:lt})}else Le.push({segments:Fe.segments,sortKey:0,state:lt})}I&&Le.sort((Re,Ae)=>Re.sortKey-Ae.sortKey);const Ce={useDepthForOcclusion:Z.depthOcclusionForSymbolsAndCircles};for(const Re of Le){const{programConfiguration:Ae,program:Te,layoutVertexBuffer:Fe,dynamicBuffers:Xe,indexBuffer:He,uniformValues:ct,tile:ht}=Re.state,St=Re.segments;m.terrain&&m.terrain.setupElevationDraw(ht,Te,Ce),m.uploadCommonUniforms(N,Te,ht.tileID.toUnwrapped()),Te.draw(m,j.TRIANGLES,oe,ae,pe,Cr.disabled,ct,d.id,Fe,He,St,d.paint,Z.zoom,Ae,Xe)}},heatmap:function(m,o,d,g){if(d.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const b=m.context,T=b.gl,E=kr.disabled,I=new jr([T.ONE,T.ONE,T.ONE,T.ONE],s.ao.transparent,[!0,!0,!0,!0]);(function(Y,te,J,oe){const ae=Y.gl,pe=te.width*oe,_e=te.height*oe;Y.activeTexture.set(ae.TEXTURE1),Y.viewport.set([0,0,pe,_e]);let me=J.heatmapFbo;if(!me||me&&(me.width!==pe||me.height!==_e)){me&&me.destroy();const Le=ae.createTexture();ae.bindTexture(ae.TEXTURE_2D,Le),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MAG_FILTER,ae.LINEAR),me=J.heatmapFbo=Y.createFramebuffer(pe,_e,1,null),function(Ce,Re,Ae,Te,Fe,Xe){const He=Ce.gl;He.texImage2D(He.TEXTURE_2D,0,Ce.extRenderToTextureHalfFloat?He.RGBA16F:He.RGBA,Fe,Xe,0,He.RGBA,Ce.extRenderToTextureHalfFloat?He.HALF_FLOAT:He.UNSIGNED_BYTE,null),Te.colorAttachment0.set(Ae)}(Y,0,Le,me,pe,_e)}else ae.bindTexture(ae.TEXTURE_2D,me.colorAttachment0.get()),Y.bindFramebuffer.set(me.framebuffer)})(b,m,d,m.transform.projection.name==="globe"?.5:.25),b.clear({color:s.ao.transparent});const M=m.transform,N=M.projection.name==="globe",j=N?["PROJECTION_GLOBE_VIEW"]:[],Z=N?Cr.frontCCW:Cr.disabled,W=[s.aF(M.center.lng),s.aJ(M.center.lat)];for(let Y=0;Y<g.length;Y++){const te=g[Y];if(o.hasRenderableParent(te))continue;const J=o.getTile(te),oe=J.getBucket(d);if(!oe||oe.projection.name!==M.projection.name)continue;const ae=m.isTileAffectedByFog(te),pe=oe.programConfigurations.get(d.id),_e=m.getOrCreateProgram("heatmap",{config:pe,defines:j,overrideFog:ae}),{zoom:me}=m.transform;m.terrain&&m.terrain.setupElevationDraw(J,_e),m.uploadCommonUniforms(b,_e,te.toUnwrapped());const Le=M.projection.createInversionMatrix(M,te.canonical);_e.draw(m,T.TRIANGLES,zn.disabled,E,I,Z,AE(m,te,J,Le,W,me,d.paint.get("heatmap-intensity")),d.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,d.paint,m.transform.zoom,pe,N?[oe.globeExtVertexBuffer]:null)}b.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(b,T){const E=b.context,I=E.gl,M=T.heatmapFbo;if(!M)return;E.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,M.colorAttachment0.get()),E.activeTexture.set(I.TEXTURE1);let N=T.colorRampTexture;N||(N=T.colorRampTexture=new s.T(E,T.colorRamp,I.RGBA8)),N.bind(I.LINEAR,I.CLAMP_TO_EDGE),b.getOrCreateProgram("heatmapTexture").draw(b,I.TRIANGLES,zn.disabled,kr.disabled,b.colorModeForRenderPass(),Cr.disabled,((j,Z,W,Y)=>({u_image:0,u_color_ramp:1,u_opacity:Z.paint.get("heatmap-opacity")}))(0,T),T.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,T.paint,b.transform.zoom)}(m,d))},line:function(m,o,d,g){if(m.renderPass!=="translucent")return;const b=d.paint.get("line-opacity"),T=d.paint.get("line-width");if(b.constantOr(1)===0||T.constantOr(1)===0)return;const E=d.paint.get("line-emissive-strength").isConstant(),I=d.paint.get("line-emissive-strength").constantOr(0),M=d.paint.get("line-occlusion-opacity"),N=d.layout.get("line-elevation-reference"),j=d.layout.get("line-width-unit")==="meters",Z=N==="sea",W=!(!m.terrain||!m.terrain.enabled),Y=m.context,te=Y.gl;if(d.hasElevatedBuckets&&m.transform.projection.name==="globe")return;const J=d.layout.get("line-cross-slope"),oe=J!==void 0,ae=J<1,pe=m.colorModeForDrapableLayerRenderPass(E?I:null),_e=m.terrain&&m.terrain.renderingToTexture,me=_e?1:s.o.devicePixelRatio,Le=d.paint.get("line-dasharray"),Ce=Le.constantOr(1),Re=d.layout.get("line-cap"),Ae=Le.constantOr(null),Te=Re.constantOr(null),Fe=d.paint.get("line-pattern"),Xe=Fe.constantOr(1),He=d.paint.get("line-pattern-cross-fade"),ct=Fe.constantOr(null),ht=d.paint.get("line-opacity").constantOr(1);let St=!Xe&&ht!==1||m.depthOcclusion&&M>0&&M<1;const Ut=d.paint.get("line-gradient"),rt=Xe?"linePattern":"line",Ue=s.e2(d);let _t;if(_e&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(St=!1),M!==0&&m.depthOcclusion){const yn=d.paint._values["line-opacity"];yn&&yn.value&&yn.value.kind==="constant"?_t=yn.value:s.w(`Occlusion opacity for layer ${d.id} is supported only when line-opacity isn't data-driven.`)}T.value.kind!=="constant"&&T.value.isLineProgressConstant===!1&&Ue.push("VARIABLE_LINE_WIDTH"),_e&&(m.emissiveMode!=="dual-source-blending"||E?m.emissiveMode==="mrt-fallback"&&Ue.push("USE_MRT1"):Ue.push("DUAL_SOURCE_BLENDING"));const lt=(yn,Yt,Ht,Ln,In,pn)=>{for(const vn of yn){const er=o.getTile(vn);if(Xe&&!er.patternsLoaded())continue;const Lr=er.getBucket(d);if(!Lr||Lr.elevationType!=="none"&&!In||Lr.elevationType==="none"&&In)continue;m.prepareDrawTile();const hi=[...Yt],Ni=m.shadowRenderer,Dn=Lr.elevationType==="road"&&!!Ni&&Ni.enabled;let Oi=[0,0,0];if(Dn){const Vr=m.style.directionalLight,Bs=m.style.ambientLight;Vr&&Bs&&(Oi=Td(m.style,Vr,Bs)),hi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Pr=Lr.programConfigurations.get(d.id);let Hi=!1;if(ct&&er.imageAtlas){const Vr=s.e3.from(ct),Bs=Vr.getPrimary().scaleSelf(me).toString(),Ea=er.imageAtlas.patternPositions.get(Bs),na=Vr.getSecondary(),gs=na?er.imageAtlas.patternPositions.get(na.scaleSelf(me).toString()):null;Hi=!!Ea&&!!gs,Ea&&Pr.setConstantPatternPositions(Ea,gs)}He>0&&(Hi||Pr.getPatternTransitionVertexBuffer("line-pattern"))&&hi.push("LINE_PATTERN_TRANSITION");const is=m.isTileAffectedByFog(vn),Ki=m.getOrCreateProgram(rt,{config:Pr,defines:hi,overrideFog:is});if(!Xe&&Ae&&Te&&er.lineAtlas){const Vr=er.lineAtlas.getDash(Ae,Te);Vr&&Pr.setConstantPatternPositions(Vr)}Dn&&Ni.setupShadows(er.tileID.toUnwrapped(),Ki,"vector-tile");let[Ri,Ur]=d.paint.get("line-trim-offset");(Te==="round"||Te==="square")&&Ri!==Ur&&(Ri===0&&(Ri-=1),Ur===1&&(Ur+=1));const Ui=_e?vn.projMatrix:null,aa=j?1/Lr.tileToMeter/s.ay(er,1,m.transform.zoom):1,Gs=j?1/Lr.tileToMeter/s.ay(er,1,Math.floor(m.transform.zoom)):1,Gi=Xe?s.e4(m,er,d,Ui,me,aa,Gs,[Ri,Ur],Oi,He):s.e5(m,er,d,Ui,Lr.lineClipsArray.length,me,aa,Gs,[Ri,Ur],Oi);if(Ut){const Vr=Lr.gradients[d.id];let Bs=Vr.texture;if(d.gradientVersion!==Vr.version){let Ea=256;if(d.stepInterpolant){const na=o.getSource().maxzoom,gs=vn.canonical.z===na?Math.ceil(1<<m.transform.maxZoom-vn.canonical.z):1;Ea=s.aA(s.e6(Lr.maxLineLength/s.al*1024*gs),256,Y.maxTextureSize)}Vr.gradient=s.e7({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Ea,image:Vr.gradient||void 0,clips:Lr.lineClipsArray}),Vr.texture?Vr.texture.update(Vr.gradient):Vr.texture=new s.T(Y,Vr.gradient,te.RGBA8),Vr.version=d.gradientVersion,Bs=Vr.texture}Y.activeTexture.set(te.TEXTURE1),Bs.bind(d.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}Ce&&(Y.activeTexture.set(te.TEXTURE0),er.lineAtlasTexture&&er.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),Pr.updatePaintBuffers()),Xe&&(Y.activeTexture.set(te.TEXTURE0),er.imageAtlasTexture&&er.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),Pr.updatePaintBuffers()),In&&!Z&&m.terrain.setupElevationDraw(er,Ki),m.uploadCommonUniforms(Y,Ki,vn.toUnwrapped());const Ei=Vr=>{_t!=null&&(_t.value=ht*M),Ki.draw(m,te.TRIANGLES,Ht,Vr,pe,Cr.disabled,Gi,d.id,Lr.layoutVertexBuffer,Lr.indexBuffer,Lr.segments,d.paint,m.transform.zoom,Pr,[Lr.layoutVertexBuffer2,Lr.patternVertexBuffer,Lr.zOffsetVertexBuffer]),_t!=null&&(_t.value=ht)};if(St&&!In){const Vr=m.stencilModeForClipping(vn).ref;Vr===0&&_e&&Y.clear({stencil:0});const Bs={func:te.EQUAL,mask:255};Gi.u_alpha_discard_threshold=.8,Ei(new kr(Bs,Vr,255,te.KEEP,te.KEEP,te.INVERT)),Gi.u_alpha_discard_threshold=0,Ei(new kr(Bs,Vr,255,te.KEEP,te.KEEP,te.KEEP))}else Gi.u_alpha_discard_threshold=St&&In&&pn?.8:0,Ei(In?Ln:m.stencilModeForClipping(vn))}};let Ot=m.depthModeForSublayer(0,zn.ReadOnly);const en=new zn(m.depthOcclusion?te.GREATER:te.LEQUAL,zn.ReadOnly,m.depthRangeFor3D);if(d.hasNonElevatedBuckets){const yn=!_e&&m.terrain;M!==0&&yn?s.w(`Occlusion opacity for layer ${d.id} is supported on terrain only if the layer has line-z-offset enabled.`):yn?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${d.id}.`):lt(g,Ue,Ot,kr.disabled,!1,!0)}if(d.hasElevatedBuckets){N==="hd-road-markup"?W||(Ot=en,Ue.push("ELEVATED_ROADS")):(Ue.push("ELEVATED"),Ot=en,oe&&Ue.push(ae?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),Z&&Ue.push("ELEVATION_REFERENCE_SEA"));const yn=St?m.stencilModeFor3D():kr.disabled;m.forceTerrainMode=!0,lt(g,Ue,Ot,yn,!0,!0),St&&lt(g,Ue,Ot,yn,!0,!1),m.forceTerrainMode=!1}St&&(m.resetStencilClippingMasks(),_e&&Y.clear({stencil:0})),M===0||m.depthOcclusion||_e||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,o,d,g){const b=d.paint.get("fill-color"),T=d.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const E=d.paint.get("fill-emissive-strength"),I=m.colorModeForDrapableLayerRenderPass(E),M=d.paint.get("fill-pattern"),N=m.opaquePassEnabledForLayer()&&!M.constantOr(1)&&b.constantOr(s.ao.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";let j="none";d.layout.get("fill-elevation-reference")!=="none"?j="road":d.paint.get("fill-z-offset").constantOr(1)!==0&&(j="offset");const Z=!(!m.terrain||!m.terrain.enabled),W={painter:m,sourceCache:o,layer:d,coords:g,colorMode:I,elevationType:j,terrainEnabled:Z,pass:N};if(m.renderPass==="shadow")return void(m.shadowRenderer&&j==="road"&&!Z&&function(te){const{painter:J,sourceCache:oe,layer:ae,coords:pe}=te,_e=J.context.gl,me=te.painter.shadowRenderer;for(const Le of pe){const Ce=oe.getTile(Le),Re=Ce.getBucket(ae);if(!Re)continue;const Ae=Re.elevatedStructures;if(!Ae||!Ae.shadowCasterSegments||Ae.shadowCasterSegments.segments[0].primitiveLength===0)continue;J.prepareDrawTile();const Te=Re.bufferData.programConfigurations.get(ae.id),Fe=J.isTileAffectedByFog(Le),Xe=J.getOrCreateProgram("elevatedStructuresDepth",{config:Te,overrideFog:Fe}),He=me.calculateShadowPassMatrixFromTile(Ce.tileID.toUnwrapped());J.uploadCommonUniforms(J.context,Xe,Le.toUnwrapped());const ct={u_matrix:He,u_depth_bias:0};Xe.draw(J,_e.TRIANGLES,me.getShadowPassDepthMode(),kr.disabled,me.getShadowPassColorMode(),Cr.disabled,ct,ae.id,Ae.vertexBuffer,Ae.indexBuffer,Ae.shadowCasterSegments,ae.paint,J.transform.zoom,Te)}}(W));const Y=m.emissiveMode==="mrt-fallback";if(j!=="offset"){if(wy(W,!1,Y),j==="road"){const te=!Z&&m.renderPass==="translucent";te&&by(m,o,d,g,"geometry"),wy(W,!0,Y,kr.disabled),te&&function(J){const{painter:oe,sourceCache:ae,layer:pe,coords:_e,colorMode:me}=J,Le=oe.context.gl,Ce=J.painter.shadowRenderer,Re=!!Ce&&Ce.enabled,Ae=new zn(oe.context.gl.LEQUAL,zn.ReadOnly,oe.depthRangeFor3D);let Te=[0,0,0];if(Re){const Xe=oe.style.directionalLight,He=oe.style.ambientLight;Xe&&He&&(Te=Td(oe.style,Xe,He))}const Fe=Xe=>{for(const He of _e){const ct=ae.getTile(He),ht=ct.getBucket(pe);if(!ht)continue;const St=ht.elevatedStructures;if(!St)continue;let Ut,rt;if(Xe?(Ut=St.renderableBridgeSegments,rt=St.bridgeProgramConfigurations.get(pe.id)):(Ut=St.renderableTunnelSegments,rt=St.tunnelProgramConfigurations.get(pe.id)),!Ut||Ut.segments[0].primitiveLength===0)continue;rt.updatePaintBuffers(),oe.prepareDrawTile();const Ue=oe.isTileAffectedByFog(He),_t=[];Re&&_t.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const lt=oe.getOrCreateProgram("elevatedStructures",{config:rt,overrideFog:Ue,defines:_t}),Ot=oe.translatePosMatrix(He.projMatrix,ct,pe.paint.get("fill-translate"),pe.paint.get("fill-translate-anchor"));Re&&Ce.setupShadows(ct.tileID.toUnwrapped(),lt,"vector-tile");const en=Eh(Ot,Te);oe.uploadCommonUniforms(oe.context,lt,He.toUnwrapped()),lt.draw(oe,Le.TRIANGLES,Ae,kr.disabled,me,Cr.backCCW,en,pe.id,St.vertexBuffer,St.indexBuffer,Ut,pe.paint,oe.transform.zoom,rt,[St.vertexBufferNormal])}};Fe(!0),Fe(!1)}(W)}}else wy(W,!1,Y,m.stencilModeFor3D())},"fill-extrusion":function(m,o,d,g){const b=d.paint.get("fill-extrusion-opacity"),T=m.context,E=T.gl,I=m.terrain,M=I&&I.renderingToTexture;if(b===0)return;const N=m.emissiveMode==="mrt-fallback",j=m.conflationActive&&m.style.isLayerClipped(d,o.getSource()),Z=m.style.order.indexOf(d.fqid);if(j&&function(W,Y,te,J,oe){for(const ae of J){const pe=Y.getTile(ae).getBucket(te);pe&&(pe.updateReplacement(ae,W.replacementSource,oe),pe.uploadCentroid(W.context))}}(m,o,d,g,Z),I||j)for(const W of g){const Y=o.getTile(W).getBucket(d);Y&&Kk(m.context,o,W,Y,d,I,j)}if(m.renderPass==="shadow"&&m.shadowRenderer){const W=m.shadowRenderer;if(I&&b<.65&&d._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ad)return;const Y=W.getShadowPassDepthMode(),te=W.getShadowPassColorMode();Ty(m,o,d,g,Y,kr.disabled,te,j)}else if(m.renderPass==="translucent"){const W=!d.paint.get("fill-extrusion-pattern").constantOr(1),Y=d.paint.get("fill-extrusion-color").constantOr(s.ao.white);if(!M&&Y.a!==0){const te=new zn(m.context.gl.LEQUAL,zn.ReadWrite,m.depthRangeFor3D);b===1&&W?Ty(m,o,d,g,te,kr.disabled,jr.unblended,j):(Ty(m,o,d,g,te,kr.disabled,jr.disabled,j),Ty(m,o,d,g,te,m.stencilModeFor3D(),m.colorModeForRenderPass(),j),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&W&&(!I&&m.transform.projection.name!=="globe"||M)){const te=d.paint.get("fill-extrusion-opacity"),J=d.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe=d.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ae=d.paint.get("fill-extrusion-flood-light-intensity"),pe=d.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",_e=d.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(pe?null:d.lut).toArray01().slice(0,3),me=J>0&&oe>0,Le=ae>0,Ce=(Te,Fe,Xe)=>(1-Xe)*Te+Xe*Fe,Re=new ib;Re.translate=d.paint.get("fill-extrusion-translate"),Re.translateAnchor=d.paint.get("fill-extrusion-translate-anchor"),Re.edgeRadius=d.layout.get("fill-extrusion-edge-radius"),Re.cutoffFadeRange=d.paint.get("fill-extrusion-cutoff-fade-range");const Ae=Te=>{const Fe=m.depthModeForSublayer(1,zn.ReadOnly,E.LEQUAL,!0),Xe=d.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),He=Ce(.1,3,Xe),ct=m._showOverdrawInspector;if(!ct){const ht=new kr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),St=new jr([E.ONE,E.ONE,E.ONE,E.ONE],s.ao.transparent,[!1,!1,!1,!0],E.MIN);Ad(Re,m,o,d,g,Fe,ht,St,Cr.disabled,Te,"sdf",te,J,oe,ae,_e,He,j,!1)}{const ht=ct?kr.disabled:new kr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),St=ct?m.colorModeForRenderPass():new jr([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],s.ao.transparent,[!0,!0,!0,!0]);Ad(Re,m,o,d,g,Fe,ht,St,Cr.disabled,Te,"color",te,J,oe,ae,_e,He,j,!1)}};if(M){const Te=()=>{const Xe=I.drapeBufferSize[0],He=I.drapeBufferSize[1];let ct=I.framebufferCopyTexture;return ct&&(!ct||ct.size[0]===Xe&&ct.size[1]===He)||(ct&&ct.destroy(),ct=I.framebufferCopyTexture=new s.T(T,new s.q({width:Xe,height:He}),E.RGBA8)),ct.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexSubImage2D(E.TEXTURE_2D,0,0,0,0,0,Xe,He),ct},Fe=(Xe,He,ct)=>{const ht=m.depthModeForSublayer(1,zn.ReadOnly,E.LEQUAL,!1),St=d.paint.get(Xe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ut=Ce(.1,3,St);{const rt=new jr([E.ONE,E.ONE,E.ONE,E.ONE],s.ao.transparent,[!1,!1,!1,!0]);Ad(Re,m,o,d,g,ht,kr.disabled,rt,Cr.disabled,Xe,"clear",te,J,oe,ae,_e,Ut,j,He)}{const rt=new kr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Ue=new jr([E.ONE,E.ONE,E.ONE,E.ONE],s.ao.transparent,[!1,!1,!1,!0],E.MIN);Ad(Re,m,o,d,g,ht,rt,Ue,Cr.disabled,Xe,"sdf",te,J,oe,ae,_e,Ut,j,He)}N&&!Xe&&(ct=Te());{const rt=Xe?E.ZERO:E.ONE_MINUS_DST_ALPHA,Ue=new kr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),_t=new jr([rt,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],s.ao.transparent,[!0,!0,!0,!0]);Ad(Re,m,o,d,g,ht,Ue,_t,Cr.disabled,Xe,"color",te,J,oe,ae,_e,Ut,j,He)}if(!N||Xe){const rt=new jr([E.ONE,E.ONE,E.ONE,Xe?E.ZERO:E.ONE],s.ao.transparent,[!1,!1,!1,!0],Xe?E.FUNC_ADD:E.MAX);Ad(Re,m,o,d,g,ht,kr.disabled,rt,Cr.disabled,Xe,"clear",te,J,oe,ae,_e,Ut,j,He,ct)}else{E.drawBuffers([E.NONE,E.COLOR_ATTACHMENT1]);const rt=new kr({func:E.EQUAL,mask:255},254,255,E.KEEP,E.DECR,E.DECR),Ue=new jr([E.ONE,E.ONE,E.ONE,E.ONE],s.ao.transparent,[!0,!1,!1,!1],E.MAX);Ad(Re,m,o,d,g,ht,rt,Ue,Cr.disabled,Xe,"emissive",te,J,oe,ae,_e,Ut,j,He,ct),E.drawBuffers([E.COLOR_ATTACHMENT0])}};if(me||Le){let Xe;m.prepareDrawTile(),N&&!me||(Xe=Te()),me&&Fe(!0,!1,Xe),Le&&Fe(!1,!0,Xe)}}else me&&Ae(!0),Le&&Ae(!1),(me||Le)&&m.resetStencilClippingMasks()}}},building:function(m,o,d,g){m.currentLayer<m.firstLightBeamLayer&&(m.firstLightBeamLayer=m.currentLayer);const b=d.paint.get("building-ambient-occlusion-ground-intensity"),T=d.paint.get("building-ambient-occlusion-ground-radius"),E=d.paint.get("building-ambient-occlusion-ground-attenuation"),I=d.paint.get("building-opacity");if(I<=0)return;let M=b>0&&T>0,N=!0;const j=d.paint.get("building-vertical-scale");if(j<=0)return;m.shadowRenderer||(N=!1);const Z=m.conflationActive&&m.style.isLayerClipped(d,o.getSource()),W=m.style.order.indexOf(d.fqid);if(function(Y,te,J,oe,ae,pe){for(const _e of pe){const me=te.getTile(_e).getBucket(J);me&&(ae&&me.updateReplacement(_e,Y.replacementSource,oe),me.uploadUpdatedIndexBuffer(Y.context))}}(m,o,d,W,Z,g),function(Y,te,J,oe){for(const ae of oe){const pe=te.getTile(ae).getBucket(J);pe&&pe.needsEvaluation()&&pe.uploadUpdatedColorBuffer(Y.context)}}(m,o,d,g),d.resetLayerRenderingStats(m),m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0),m.renderPass==="shadow"&&m.shadowRenderer){const Y=m.shadowRenderer,te=[],J=Y.getShadowPassDepthMode();Q0({painter:m,source:o,layer:d,coords:g,defines:te,blendMode:Y.getShadowPassColorMode(),depthMode:J,opacity:I,verticalScale:j,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(m.renderPass==="translucent"){let Y=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];N&&(Y=Y.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),m.shadowRenderer&&m.shadowRenderer.useNormalOffset&&(Y=Y.concat("NORMAL_OFFSET"));const te=d.paint.get("building-facade-emissive-chance"),J=d.paint.get("building-ambient-occlusion-intensity"),oe=d.paint.get("building-flood-light-intensity"),ae=d.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",pe=d.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ae?null:d.lut).toArray01().slice(0,3),_e=d.paint.get("building-flood-light-ground-attenuation"),me=oe>0,Le=new zn(m.context.gl.LEQUAL,zn.ReadWrite,m.depthRangeFor3D);I<1&&Q0({painter:m,source:o,layer:d,coords:g,defines:Y,blendMode:jr.disabled,depthMode:Le,opacity:I,verticalScale:j,facadeEmissiveChance:te,facadeAOIntensity:J,floodLightIntensity:oe,floodLightColor:pe,depthOnly:!0});const Ce=m.colorModeForRenderPass();Q0({painter:m,source:o,layer:d,coords:g,defines:Y,blendMode:Ce,depthMode:Le,opacity:I,verticalScale:j,facadeEmissiveChance:te,facadeAOIntensity:J,floodLightIntensity:oe,floodLightColor:pe}),M&&Ey(m,o,d,g,!0,I,b,T,oe,pe,E,Z),me&&Ey(m,o,d,g,!1,I,b,T,oe,pe,_e,Z)}else if(m.renderPass==="light-beam"){const Y=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],te=new zn(m.context.gl.LEQUAL,zn.ReadOnly,m.depthRangeFor3D);Q0({painter:m,source:o,layer:d,coords:g,defines:Y,blendMode:jr.alphaBlended,depthMode:te,opacity:I,verticalScale:j,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1),m.resetStencilClippingMasks()},hillshade:function(m,o,d,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const b=m.context,T=m.terrain&&m.terrain.renderingToTexture,[E,I]=m.renderPass!=="translucent"||T?[{},g]:m.stencilConfigForOverlap(g);for(const M of I){const N=o.getTile(M);if(N.needsHillshadePrepare&&m.renderPass==="offscreen")Uk(m,N,d);else if(m.renderPass==="translucent"){const j=m.depthModeForSublayer(0,zn.ReadOnly),Z=d.paint.get("hillshade-emissive-strength"),W=m.colorModeForDrapableLayerRenderPass(Z),Y=T&&m.terrain?m.terrain.stencilModeForRTTOverlap(M):E[M.overscaledZ];jk(m,M,N,d,j,Y,W)}}b.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,o,d,g,b,T){if(m.renderPass!=="translucent"||d.paint.get("raster-opacity")===0)return;const E=m.transform.projection.name==="globe",I=d.paint.get("raster-elevation")!==0,M=I&&E;if(m.renderElevatedRasterBackface&&!M)return;const N=m.context,j=N.gl,Z=o.getSource(),W=function(Ce,Re,Ae,Te,Fe){const Xe=Re.paint.get("raster-color"),He=Ce.type==="raster-array",ct=[],ht=Re.paint.get("raster-resampling"),St=Re.paint.get("raster-color-mix");let Ut=Re.paint.get("raster-color-range");const rt=[St[0],St[1],St[2],0],Ue=St[3];let _t=ht==="nearest"?Te.NEAREST:Te.LINEAR;if(He&&(ct.push("RASTER_ARRAY"),Xe||ct.push("RASTER_COLOR"),ht==="linear"&&ct.push("RASTER_ARRAY_LINEAR"),_t=Te.NEAREST,!Ut&&Ce.rasterLayers)){const lt=Ce.rasterLayers.find(({id:Ot})=>Ot===Re.sourceLayer);lt&&lt.fields&&lt.fields.range&&(Ut=lt.fields.range)}if(Ut=Ut||[0,1],Xe){ct.push("RASTER_COLOR"),Ae.activeTexture.set(Te.TEXTURE2),Re.updateColorRamp(Ut);let lt=Re.colorRampTexture;lt||(lt=Re.colorRampTexture=new s.T(Ae,Re.colorRamp,Te.RGBA8)),lt.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}return Fe&&ct.push("USE_MRT1"),{mix:rt,range:Ut,offset:Ue,defines:ct,resampling:_t}}(Z,d,N,j,m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback");if(Z instanceof s.aU&&!g.length&&!E)return;const Y=d.paint.get("raster-emissive-strength"),te=m.colorModeForDrapableLayerRenderPass(Y),J=m.terrain&&m.terrain.renderingToTexture,oe=!m.options.moving,ae=d.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR;if(Z instanceof s.aU&&!g.length&&(Z.onNorthPole||Z.onSouthPole)){const Ce=I?m.stencilModeFor3D():kr.disabled;return void J0(!!Z.onNorthPole,null,m,o,d,Y,W,Cr.disabled,Ce)}if(!g.length)return;const[pe,_e]=Z instanceof s.aU||J?[{},g]:m.stencilConfigForOverlap(g),me=_e[_e.length-1].overscaledZ;M&&W.defines.push("PROJECTION_GLOBE_VIEW"),I&&W.defines.push("RENDER_CUTOFF");const Le=(Ce,Re,Ae)=>{for(const Te of Ce){const Fe=Te.toUnwrapped(),Xe=o.getTile(Te);if(J&&(!Xe||!Xe.hasData()))continue;N.activeTexture.set(j.TEXTURE0);const He=kd(Xe,Z,d,W);if(!He||!He.texture)continue;const{texture:ct,mix:ht,offset:St,tileSize:Ut,buffer:rt}=He;let Ue,_t;J?(Ue=zn.disabled,_t=Te.projMatrix):I?(Ue=new zn(j.LEQUAL,zn.ReadWrite,m.depthRangeFor3D),_t=E?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(Fe,oe)):(Ue=m.depthModeForSublayer(Te.overscaledZ-me,d.paint.get("raster-opacity")===1?zn.ReadWrite:zn.ReadOnly,j.LESS),_t=m.transform.calculateProjMatrix(Fe,oe));const lt=m.terrain&&J?m.terrain.stencilModeForRTTOverlap(Te):pe[Te.overscaledZ],Ot=T?0:d.paint.get("raster-fade-duration");Xe.registerFadeDuration(Ot);const en=o.findLoadedParent(Te,0),yn=W0(Xe,en,o,m.transform,Ot);let Yt,Ht;!yn.isFading&&Xe.refreshedUponExpiration&&(Xe.refreshedUponExpiration=!1),m.terrain&&m.terrain.prepareDrawTile(),N.activeTexture.set(j.TEXTURE0),ct.bind(ae,j.CLAMP_TO_EDGE),N.activeTexture.set(j.TEXTURE1),en?(en.texture&&en.texture.bind(ae,j.CLAMP_TO_EDGE),Yt=Math.pow(2,en.tileID.overscaledZ-Xe.tileID.overscaledZ),Ht=[Xe.tileID.canonical.x*Yt%1,Xe.tileID.canonical.y*Yt%1]):ct.bind(ae,j.CLAMP_TO_EDGE),"useMipmap"in ct&&N.extTextureFilterAnisotropic&&m.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const Ln=m.transform;let In;const pn=I?LE(Ln):[0,0,0,0];let vn,er,Lr,hi,Ni,Dn=0;if(M&&Z instanceof s.aU&&Z.coordinates.length>3)vn=Float32Array.from(s.bk(s.dJ(new s.cD(0,0,0)))),er=Float32Array.from(Ln.globeMatrix),Lr=Float32Array.from(s.dF(Ln)),hi=[s.aF(Ln.center.lng),s.aJ(Ln.center.lat)],In=Z.elevatedGlobePerspectiveTransform,Ni=Z.elevatedGlobeGridMatrix||new Float32Array(9);else if(M){const is=s.dG(Te.canonical);Dn=s.dH(is.getCenter().lat),vn=Float32Array.from(s.bk(s.dJ(Te.canonical))),er=Float32Array.from(Ln.globeMatrix),Lr=Float32Array.from(s.dF(Ln)),hi=[s.aF(Ln.center.lng),s.aJ(Ln.center.lat)],In=[0,0],Ni=Float32Array.from(s.dI(Te.canonical,is,Dn,Ln.worldSize/Ln._pixelsPerMercatorPixel))}else In=Z instanceof s.aU?Z.perspectiveTransform:[0,0],vn=new Float32Array(16),er=new Float32Array(9),Lr=new Float32Array(16),hi=[0,0],Ni=new Float32Array(9);const Oi=CE(_t,vn,er,Lr,Ni,Ht||[0,0],s.aj(m.transform.zoom),hi,pn,Yt||1,yn,d,In,I?d.paint.get("raster-elevation"):0,2,ht,St,W.range,Ut,rt,Y),Pr=m.isTileAffectedByFog(Te),Hi=m.getOrCreateProgram("raster",{defines:W.defines,overrideFog:Pr});if(m.uploadCommonUniforms(N,Hi,Fe),Z instanceof s.aU){const is=Z.elevatedGlobeVertexBuffer,Ki=Z.elevatedGlobeIndexBuffer;if(J||!E)Z.boundsBuffer&&Z.boundsSegments&&Hi.draw(m,j.TRIANGLES,Ue,kr.disabled,te,Cr.disabled,Oi,d.id,Z.boundsBuffer,m.quadTriangleIndexBuffer,Z.boundsSegments);else if(is&&Ki){const Ri=Ln.zoom<=s.c_?Z.elevatedGlobeSegments:Z.getSegmentsForLongitude(Ln.center.lng);Ri&&Hi.draw(m,j.TRIANGLES,Ue,kr.disabled,te,Re,Oi,d.id,is,Ki,Ri)}}else if(M){Ue=new zn(j.LEQUAL,zn.ReadOnly,m.depthRangeFor3D);const is=m.globeSharedBuffers;if(is){const[Ki,Ri,Ur]=is.getGridBuffers(Dn,!1);Hi.draw(m,j.TRIANGLES,Ue,Ae||lt,m.colorModeForRenderPass(),Re,Oi,d.id,Ki,Ri,Ur)}}else{const{tileBoundsBuffer:is,tileBoundsIndexBuffer:Ki,tileBoundsSegments:Ri}=m.getTileBoundsBuffers(Xe);Hi.draw(m,j.TRIANGLES,Ue,lt,te,Cr.disabled,Oi,d.id,is,Ki,Ri)}}if(!(Z instanceof s.aU)&&M)for(const Te of Ce){const Fe=Te.canonical.y===(1<<Te.canonical.z)-1;Te.canonical.y===0&&J0(!0,Te,m,o,d,Y,W,Re,Ae||kr.disabled),Fe&&J0(!1,Te,m,o,d,Y,W,Re===Cr.frontCW?Cr.backCW:Cr.frontCW,Ae||kr.disabled)}};M?Le(_e,m.renderElevatedRasterBackface?Cr.backCW:Cr.frontCW,m.stencilModeFor3D()):Le(_e,Cr.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,o,d,g,b,T){m.renderPass==="offscreen"&&function(E,I,M,N){if(!N.length)return;const j=E.context,Z=j.gl,W=I.getSource();if(!(W instanceof ol))return;const Y=Math.ceil(Math.sqrt(M.paint.get("raster-particle-count")));let te=M.particlePositionRGBAImage;if(!te||te.width!==Y){const _e=function(me){const Le=me*me,Ce=new Uint8Array(4*Le),Re=function(Te){return Te|=0,Te=Math.imul(2747636419^Te,2654435769),Te=Math.imul(Te^Te>>>16,2654435769),((Te=Math.imul(Te^Te>>>16,2654435769))>>>0)/4294967296},Ae=1/1.1;for(let Te=0;Te<Le;Te++){const Fe=Ae*(Re(2*Te+0)+qc),Xe=Ae*(Re(2*Te+1)+qc),He=255*Fe%1,ct=255*Xe%1,ht=He,St=Xe-ct/255,Ut=ct;Ce[4*Te+0]=255*(Fe-He/255),Ce[4*Te+1]=255*ht,Ce[4*Te+2]=255*St,Ce[4*Te+3]=255*Ut}return Ce}(Y);te=M.particlePositionRGBAImage=new s.q({width:Y,height:Y},_e)}let J=M.particleFramebuffer;J?J.width!==Y&&(J.destroy(),J=M.particleFramebuffer=j.createFramebuffer(Y,Y,1,null)):J=M.particleFramebuffer=j.createFramebuffer(Y,Y,1,null);const oe=[];for(const _e of N){const me=I.getTile(_e);if(!(me instanceof F_))continue;const Le=ab(me,W,M);if(!Le)continue;const Ce=[me.tileSize,me.tileSize];let Re=M.tileFramebuffer;Re||(Re=M.tileFramebuffer=j.createFramebuffer(Ce[0],Ce[1],1,null));let Ae=me.rasterParticleState;Ae||(Ae=me.rasterParticleState=new Ay(j,_e,Ce,te));const Te=Ae.update(M.lastInvalidatedAt);Ae.particleTextureDimension!==Y&&Ae.updateParticleTexture(_e,te);const Fe=Ae.targetColorTexture;Ae.targetColorTexture=Ae.backgroundColorTexture,Ae.backgroundColorTexture=Fe;const Xe=Ae.particleTexture0;Ae.particleTexture0=Ae.particleTexture1,Ae.particleTexture1=Xe,oe.push([_e,Le,Ae,Te])}if(oe.length===0)return;const ae=s.o.now(),pe=M.previousDrawTimestamp?.001*(ae-M.previousDrawTimestamp):.0167;if(M.previousDrawTimestamp=ae,M.hasColorMap()){j.activeTexture.set(Z.TEXTURE0+2);let _e=M.colorRampTexture;_e||(_e=M.colorRampTexture=new s.T(j,M.colorRamp,Z.RGBA8)),_e.bind(Z.LINEAR,Z.CLAMP_TO_EDGE)}j.bindFramebuffer.set(M.tileFramebuffer.framebuffer),function(_e,me,Le){const Ce=_e.context,Re=Ce.gl,Ae=me.tileFramebuffer;Ce.activeTexture.set(Re.TEXTURE0);const Te={u_texture:0,u_opacity:1.05*(Xe=me.paint.get("raster-particle-fade-opacity-factor"))/(Xe+.05)},Fe=_e.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Xe;for(const He of Le){const[,,ct,ht]=He;Ae.colorAttachment0.set(ct.targetColorTexture.texture),Ce.viewport.set([0,0,Ae.width,Ae.height]),Ce.clear({color:s.ao.transparent}),ht&&(ct.backgroundColorTexture.bind(Re.NEAREST,Re.CLAMP_TO_EDGE),Fe.draw(_e,Re.TRIANGLES,zn.disabled,kr.disabled,jr.alphaBlended,Cr.disabled,Te,me.id,_e.viewportBuffer,_e.quadTriangleIndexBuffer,_e.viewportSegments))}}(E,M,oe),function(_e,me,Le,Ce){const Re=_e.context,Ae=Re.gl,Te=Le.tileFramebuffer,Fe=_e.transform.projection.name==="globe",Xe=Le.paint.get("raster-particle-max-speed");for(const He of Ce){const[ct,ht,St]=He;Re.activeTexture.set(Ae.TEXTURE0+0),ht.texture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Te.colorAttachment0.set(St.targetColorTexture.texture);const Ut=_e.getOrCreateProgram("rasterParticleDraw",{defines:ht.defines,overrideFog:!1});Re.activeTexture.set(Ae.TEXTURE0+1);const rt=ht.scalarData?[]:[0,1,2,3].map(lt=>s.e9[lt](ct));rt.push(ct);const Ue=ct.canonical.x,_t=ct.canonical.y;for(const lt of rt){const Ot=me.getTile(Fe?lt.wrapped():lt);if(!Ot)continue;const en=Ot.rasterParticleState;if(!en)continue;const yn=lt.canonical.x+(1<<lt.canonical.z)*(lt.wrap-ct.wrap),Yt=lt.canonical.y;en.particleTexture0.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);const Ht=Yk(1,en.particleTexture0.size[0],[yn-Ue,Yt-_t],0,ht.texture.size,2,Xe,ht.textureOffset,ht.scale,ht.offset);Ut.draw(_e,Ae.POINTS,zn.disabled,kr.disabled,jr.alphaBlended,Cr.disabled,Ht,Le.id,en.particleIndexBuffer,void 0,en.particleSegment)}}}(E,I,M,oe),j.bindFramebuffer.set(M.particleFramebuffer.framebuffer),function(_e,me,Le,Ce){const Re=_e.context,Ae=Re.gl,Te=me.paint.get("raster-particle-max-speed"),Fe=Ce*me.paint.get("raster-particle-speed-factor")*.15,Xe=function(ct){return Math.pow(ct,6)}(.01+1*me.paint.get("raster-particle-reset-rate-factor")),He=me.particleFramebuffer;Re.viewport.set([0,0,He.width,He.height]);for(const ct of Le){const[,ht,St]=ct;Re.activeTexture.set(Ae.TEXTURE0+0),ht.texture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Re.activeTexture.set(Ae.TEXTURE0+1);const Ut=St.particleTexture0;Ut.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);const rt=IE(1,Ut.size[0],0,ht.texture.size,Te,Fe,Xe,ht.textureOffset,ht.scale,ht.offset);He.colorAttachment0.set(St.particleTexture1.texture),Re.clear({color:s.ao.transparent}),_e.getOrCreateProgram("rasterParticleUpdate",{defines:ht.defines}).draw(_e,Ae.TRIANGLES,zn.disabled,kr.disabled,jr.unblended,Cr.disabled,rt,me.id,_e.viewportBuffer,_e.quadTriangleIndexBuffer,_e.viewportSegments)}}(E,M,oe,pe)}(m,o,d,g),m.renderPass==="translucent"&&(function(E,I,M,N,j){const Z=E.context,W=Z.gl,Y=I.getSource().tileSize,te=5*(1-s.ah(s.cL,s.cL+1,E.transform.zoom))*Y+M.paint.get("raster-particle-elevation"),J=!E.options.moving,oe=E.transform.projection.name==="globe";if(!N.length)return;const[ae,pe]=E.stencilConfigForOverlap(N),_e=[];oe&&_e.push("PROJECTION_GLOBE_VIEW");const me=E.stencilModeFor3D();for(const Le of pe){const Ce=Le.toUnwrapped(),Re=I.getTile(Le);if(!Re.rasterParticleState)continue;const Ae=Re.rasterParticleState,Te=100;Re.registerFadeDuration(Te);const Fe=I.findLoadedParent(Le,0),Xe=W0(Re,Fe,I,E.transform,Te);let He,ct;E.terrain&&E.terrain.prepareDrawTile(),Z.activeTexture.set(W.TEXTURE0),Ae.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Z.activeTexture.set(W.TEXTURE1),Fe&&Fe.rasterParticleState?(Fe.rasterParticleState.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),He=Math.pow(2,Fe.tileID.overscaledZ-Re.tileID.overscaledZ),ct=[Re.tileID.canonical.x*He%1,Re.tileID.canonical.y*He%1]):Ae.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const ht=oe?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(Ce,J),St=E.transform,Ut=DE(St),rt=s.dG(Le.canonical),Ue=s.dH(rt.getCenter().lat);let _t,lt,Ot,en,yn;oe?(_t=Float32Array.from(s.bk(s.dJ(Le.canonical))),lt=Float32Array.from(St.globeMatrix),Ot=Float32Array.from(s.dF(St)),en=[s.aF(St.center.lng),s.aJ(St.center.lat)],yn=Float32Array.from(s.dI(Le.canonical,rt,Ue,St.worldSize/St._pixelsPerMercatorPixel))):(_t=new Float32Array(16),lt=new Float32Array(9),Ot=new Float32Array(16),en=[0,0],yn=new Float32Array(9));const Yt=Xk(ht,_t,lt,Ot,yn,ct||[0,0],s.aj(E.transform.zoom),en,Ut,He||1,Xe,te),Ht=E.isTileAffectedByFog(Le),Ln=E.getOrCreateProgram("rasterParticle",{defines:_e,overrideFog:Ht});if(E.uploadCommonUniforms(Z,Ln,Ce),oe){const In=new zn(W.LEQUAL,zn.ReadOnly,E.depthRangeFor3D),pn=0,vn=E.globeSharedBuffers;if(vn){const[er,Lr,hi]=vn.getGridBuffers(Ue,pn!==0);Ln.draw(E,W.TRIANGLES,In,me,jr.alphaBlended,E.renderElevatedRasterBackface?Cr.frontCCW:Cr.backCCW,Yt,M.id,er,Lr,hi)}}else{const In=E.depthModeForSublayer(0,zn.ReadOnly),pn=ae[Le.overscaledZ],{tileBoundsBuffer:vn,tileBoundsIndexBuffer:er,tileBoundsSegments:Lr}=E.getTileBoundsBuffers(Re);Ln.draw(E,W.TRIANGLES,In,pn,jr.alphaBlended,Cr.disabled,Yt,M.id,vn,er,Lr)}}E.resetStencilClippingMasks()}(m,o,d,g),m.style.map.triggerRepaint())},background:function(m,o,d,g){const b=d.paint.get("background-color"),T=d.paint.get("background-color-use-theme").constantOr("default")==="none",E=d.paint.get("background-opacity"),I=d.paint.get("background-emissive-strength"),M=d.paint.get("background-pitch-alignment")==="viewport";if(E===0)return;const N=m.context,j=N.gl,Z=m.transform,W=Z.tileSize,Y=d.paint.get("background-pattern");let te;if(Y!==void 0&&(Y===null||(te=m.imageManager.getPattern(s.I.from(Y.toString()),d.scope,m.style.getLut(d.scope)),!te)))return;const J=!Y&&b.a===1&&E===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==J)return;const oe=kr.disabled,ae=m.depthModeForSublayer(0,J==="opaque"?zn.ReadWrite:zn.ReadOnly),pe=m.colorModeForDrapableLayerRenderPass(I),_e=Y?"backgroundPattern":"background";let me,Le=g;Le||(me=m.getBackgroundTiles(),Le=Object.values(me).map(Re=>Re.tileID)),Y&&(N.activeTexture.set(j.TEXTURE0),m.imageManager.bind(m.context,d.scope));const Ce=[];if(m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&Ce.push("USE_MRT1"),M){const Re=m.getOrCreateProgram(_e,{overrideFog:!1,overrideRtt:!0,defines:Ce}),Ae=new Float32Array(s.bA([])),Te=new s.aQ(0,0,0,0,0),Fe=Y?Ah(Ae,I,E,m,0,d.scope,te,M,{tileID:Te,tileSize:W}):X0(Ae,I,E,b.toPremultipliedRenderColor(T?null:d.lut));Re.draw(m,j.TRIANGLES,ae,oe,pe,Cr.disabled,Fe,d.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const Re of Le){const Ae=m.isTileAffectedByFog(Re),Te=m.getOrCreateProgram(_e,{overrideFog:Ae,defines:Ce}),Fe=Re.toUnwrapped(),Xe=g?Re.projMatrix:m.transform.calculateProjMatrix(Fe);m.prepareDrawTile();const He=o?o.getTile(Re):me?me[Re.key]:new xf(Re,W,Z.zoom,m),ct=Y?Ah(Xe,I,E,m,0,d.scope,te,M,{tileID:Re,tileSize:W}):X0(Xe,I,E,b.toPremultipliedRenderColor(T?null:d.lut));m.uploadCommonUniforms(N,Te,Fe);const{tileBoundsBuffer:ht,tileBoundsIndexBuffer:St,tileBoundsSegments:Ut}=m.getTileBoundsBuffers(He);Te.draw(m,j.TRIANGLES,ae,oe,pe,Cr.disabled,ct,d.id,ht,St,Ut)}},sky:function(m,o,d){const g=m._atmosphere?s.aj(m.transform.zoom):1,b=d.paint.get("sky-opacity")*g;if(b===0)return;const T=m.context,E=d.paint.get("sky-type"),I=new zn(T.gl.LEQUAL,zn.ReadOnly,[0,1]),M=m.frameCounter/1e3%1;E==="atmosphere"?m.renderPass==="offscreen"?d.needsSkyboxCapture(m)&&(function(N,j,Z,W){const Y=N.context,te=Y.gl;let J=j.skyboxFbo;if(!J){J=j.skyboxFbo=Y.createFramebuffer(32,32,1,null),j.skyboxGeometry=new ky(Y),j.skyboxTexture=Y.gl.createTexture(),te.bindTexture(te.TEXTURE_CUBE_MAP,j.skyboxTexture),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MAG_FILTER,te.LINEAR);for(let _e=0;_e<6;++_e)te.texImage2D(te.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,te.RGBA,32,32,0,te.RGBA,te.UNSIGNED_BYTE,null)}Y.bindFramebuffer.set(J.framebuffer),Y.viewport.set([0,0,32,32]);const oe=j.getCenter(N,!0),ae=N.getOrCreateProgram("skyboxCapture"),pe=new Float64Array(16);s.bA(pe),s.en(pe,pe,.5*-Math.PI),Of(N,j,ae,pe,oe,0),s.bA(pe),s.en(pe,pe,.5*Math.PI),Of(N,j,ae,pe,oe,1),s.bA(pe),s.cU(pe,pe,.5*-Math.PI),Of(N,j,ae,pe,oe,2),s.bA(pe),s.cU(pe,pe,.5*Math.PI),Of(N,j,ae,pe,oe,3),s.bA(pe),Of(N,j,ae,pe,oe,4),s.bA(pe),s.en(pe,pe,Math.PI),Of(N,j,ae,pe,oe,5),Y.viewport.set([0,0,N.width,N.height])}(m,d),d.markSkyboxValid(m)):m.renderPass==="sky"&&function(N,j,Z,W,Y){const te=N.context,J=te.gl,oe=N.transform,ae=N.getOrCreateProgram("skybox");te.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,j.skyboxTexture);const pe=((_e,me,Le,Ce,Re)=>({u_matrix:_e,u_sun_direction:me,u_cubemap:0,u_opacity:Ce,u_temporal_offset:Re}))(oe.skyboxMatrix,j.getCenter(N,!1),0,W,Y);N.uploadCommonUniforms(te,ae),ae.draw(N,J.TRIANGLES,Z,kr.disabled,N.colorModeForRenderPass(),Cr.backCW,pe,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(m,d,I,b,M):E==="gradient"&&m.renderPass==="sky"&&function(N,j,Z,W,Y){const te=N.context,J=te.gl,oe=N.transform,ae=N.getOrCreateProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new ky(te)),te.activeTexture.set(J.TEXTURE0);let pe=j.colorRampTexture;pe||(pe=j.colorRampTexture=new s.T(te,j.colorRamp,J.RGBA8)),pe.bind(J.LINEAR,J.CLAMP_TO_EDGE);const _e=((me,Le,Ce,Re,Ae)=>({u_matrix:me,u_color_ramp:0,u_center_direction:Le,u_radius:s.an(Ce),u_opacity:Re,u_temporal_offset:Ae}))(oe.skyboxMatrix,j.getCenter(N,!1),j.paint.get("sky-gradient-radius"),W,Y);N.uploadCommonUniforms(te,ae),ae.draw(N,J.TRIANGLES,Z,kr.disabled,N.colorModeForRenderPass(),Cr.backCW,_e,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(m,d,I,b,M)},custom:function(m,o,d,g){const b=m.context,T=d.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&d.isDraped(o)){if(m.renderPass==="offscreen"){const E=T.prerender;if(E){if(m.setCustomLayerDefaults(),b.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const I=m.transform.pointMerc;E.call(T,b.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),s.aj(m.transform.zoom),[I.x,I.y],m.transform.pixelsPerMeterRatio)}else E.call(T,b.gl,m.transform.customLayerMatrix());b.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const I=T.renderToTile;if(I){const M=g[0].canonical,N={x:M.x+g[0].wrap*(T.wrapTileId?0:1<<M.z),y:M.y,z:M.z};b.setDepthMode(zn.disabled),b.setStencilMode(kr.disabled),b.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),I.call(T,b.gl,N),b.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),b.setColorMode(m.colorModeForRenderPass()),b.setStencilMode(kr.disabled);const E=T.renderingMode==="3d"?new zn(m.context.gl.LEQUAL,zn.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,zn.ReadOnly);if(b.setDepthMode(E),m.transform.projection.name==="globe"){const I=m.transform.pointMerc;T.render(b.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),s.aj(m.transform.zoom),[I.x,I.y],m.transform.pixelsPerMeterRatio)}else T.render(b.gl,m.transform.customLayerMatrix());b.setDirty(),m.setBaseState(),b.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,o,d,g){if(m.renderPass==="opaque")return;const b=d.paint.get("model-opacity").constantOr(1),T=d.paint.get("model-elevation-reference"),E=T==="ground",I=T==="ground";if(b===0)return;const M=d.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!M||m.terrain&&b<.65&&d._transitionablePaint._values["model-opacity"].value.expression instanceof s.ad))return;const N=m.shadowRenderer,j=d.paint.get("model-receive-shadows");N&&(N.useNormalOffset=!0,j||(N.enabled=!1));const Z=()=>{N&&(N.useNormalOffset=!0,j||(N.enabled=!0))},W=o.getSource();if(m.renderPass==="light-beam"&&W.type!=="batched-model")return;if(W.type==="vector"||W.type==="geojson")return function(me,Le,Ce,Re,Ae){const Te=me.transform,Fe=Te.projection.name==="globe",Xe=Te.getFreeCameraOptions().position;if(!me.modelManager)return;const He=me.modelManager;Ce.modelManager=He;const ct=me.shadowRenderer;if(!Ce._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ht=Ce._unevaluatedLayout._values["model-id"],St=Object.assign({},Ce.layout.get("model-id").parameters),Ut=me.style.order.indexOf(Ce.fqid),rt=Ce.paint.get("model-opacity").constantOr(1);for(const Ue of Re){const _t=Le.getTile(Ue).getBucket(Ce);if(!_t||_t.projection.name!==Te.projection.name)continue;const lt=_t.getModelUris();if(lt&&!_t.modelsRequested&&(He.addModelsFromBucket(lt,Ae),_t.modelsRequested=!0),Fe)St.zoom=Ue.overscaledZ;else{const pn=yl(Ue,Te);St.zoom=pn}const Ot=ht.possiblyEvaluate(St);if(GE(me,_t,Ue),Zc.shadowUniformsInitialized=!1,Zc.useSingleShadowCascade=!!ct&&ct.getMaxCascadeForTile(Ue.toUnwrapped())===0,me.renderPass==="shadow"&&ct){if(me.currentShadowCascade===1&&_t.isInsideFirstShadowMapFrustum)continue;const pn=Te.calculatePosMatrix(Ue.toUnwrapped(),Te.worldSize);if(Zc.tileMatrix.set(pn),Zc.shadowTileMatrix=Float32Array.from(ct.calculateShadowPassMatrixFromMatrix(pn)),Zc.aabb.min=[0,0,0],Zc.aabb.max[0]=Zc.aabb.max[1]=s.al,Zc.aabb.max[2]=0,eI(_t,Zc,me,Ce.scope))continue}const en=1<<Ue.canonical.z,yn=[((Xe.x-Ue.wrap)*en-Ue.canonical.x)*s.al,(Xe.y*en-Ue.canonical.y)*s.al,Xe.z*en*s.al];me.conflationActive&&Object.keys(_t.instancesPerModel).length>0&&me.style.isLayerClipped(Ce,Le.getSource())&&_t.updateReplacement(Ue,me.replacementSource,Ut,Ce.scope)&&(_t.uploaded=!1,_t.upload(me.context));let Yt=0;const Ht=new Array,Ln=new Array,In=new Array;for(let pn in _t.instancesPerModel){const vn=_t.instancesPerModel[pn];vn.features.length>0&&!Fe&&(pn=Ot.evaluate(vn.features[0].feature,{}));const er=He.getModel(pn,Ae);if(er||He.hasURLBeenRequested(pn)||_t.modelUris.includes(pn)||(_t.modelUris.push(pn),_t.modelsRequested=!1),er&&er.uploaded)if(Fe){const Lr=s.c5([],[Xe.x,Xe.y,Xe.z],me.transform.worldSize);s.ew(Lr,Lr);for(let hi=0;hi<vn.instancedDataArray.length;++hi){const Ni=[0,0,0],Dn=[1,1,1],Oi=s.ex(),Pr=vn.tileCoordinatesForInstance(hi),Hi=vn.transformForInstance(hi);s.ey(Dn,Hi),s.ez(Oi,Hi),s.eA(Ni,Oi);const is=vn.translationForInstance(hi),Ki=new s.aT(0,0);s.eB(_t.canonical,Ki,Pr.x,Pr.y);const Ri=s.bC();s.eC(Ri,er,me.transform,Ki,Ni,Dn,is,!0,!1,!1);const Ur=vn.colorForInstance(hi),Ui=s.bA([]),aa=s.ef(Ki.lat,me.transform.zoom),Gs=s.bq([],[1,1,1/aa]);s.br(Ui,Ui,Lr),In.push({zScaleMatrix:Gs,negCameraPosMatrix:Ui});for(const Gi of er.nodes)Lf(me,Gi,Ri,me.transform.expandedFarZProjMatrix,Yt,Ht,Ln,er.materialOverrides,rt,Ur);++Yt}}else for(const Lr of er.nodes)qE(me,Ce,Lr,vn,yn,Ue,Zc)}if(Fe)if(me.renderPass==="shadow"){for(const pn of Ln)fc(pn.mesh,pn.nodeModelMatrix,me,Ce);for(const pn of Ht)fc(pn.mesh,pn.nodeModelMatrix,me,Ce)}else HE(me,Ce,Ht,Ln,In)}}(m,o,d,g,eg(m,d)),void Z();if(!W.loaded())return;if(W.type==="batched-model")return function(me,Le,Ce,Re){Ce.resetLayerRenderingStats(me);const Ae=me.context,Te=me.transform,Fe=me.style.fog,Xe=me.shadowRenderer;if(Te.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${Te.projection.name} projection is not yet implemented`);const He=me.transform.getFreeCameraOptions().position,ct=s.c5([],[He.x,He.y,He.z],me.transform.worldSize),ht=s.ew([],ct),St=s.bA([]),Ut=s.ef(Te.center.lat,Te.zoom),rt=s.bq([],[1,1,1/Ut]);s.br(St,St,ht);const Ue=Ce.paint.get("model-opacity").constantOr(1),_t=new zn(Ae.gl.LEQUAL,zn.ReadWrite,me.depthRangeFor3D),lt=new zn(Ae.gl.LEQUAL,zn.ReadOnly,me.depthRangeFor3D),Ot=new s.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),en=me.renderPass==="shadow",yn=en&&Xe?Xe.getCurrentCascadeFrustum():Te.getFrustum(Te.scaleZoom(Te.worldSize)),Yt=Ce.paint.get("model-front-cutoff"),Ht=Yt[2]<1,Ln=yh(me,Ce.paint.get("model-cutoff-fade-range")),In=Ce.getLayerRenderingStats();(function(pn,vn,er,Lr){const hi=pn.terrain?pn.terrain.exaggeration():0,Ni=pn.transform.zoom;for(const Dn of Lr){const Oi=vn.getTile(Dn).getBucket(er);Oi&&(Oi.setFilter(er.filter),pn.conflationActive&&Oi.updateReplacement(Dn,pn.replacementSource),Oi.evaluateTransform(pn,er),pn.terrain&&hi>0&&Oi.elevationUpdate(pn.terrain,hi,Dn,er.source),Oi.needsReEvaluation(pn,Ni,er)&&Oi.evaluate(er))}})(me,Le,Ce,Re),function(){let pn,vn,er;Ht?(pn=Re.length-1,vn=-1,er=-1):(pn=0,vn=Re.length,er=1);const Lr=new Float64Array(16),hi=s.cA(),Ni=new s.P(0,0);for(let Dn=pn;Dn!==vn;Dn+=er){const Oi=Re[Dn],Pr=Le.getTile(Oi).getBucket(Ce);if(!Pr||!Pr.uploaded)continue;let Hi=!1;Xe&&(Hi=Xe.getMaxCascadeForTile(Oi.toUnwrapped())===0);const is=Te.calculatePosMatrix(Oi.toUnwrapped(),Te.worldSize),Ki=Pr.modelTraits;!en&&Ht&&(s.bl(Lr,is),s.af(hi,ct,Lr),Ni.x=hi[0],Ni.y=hi[1]);const Ri=[];Pr.setFilter(Ce.filter);for(const Ur of Pr.getNodesInfo()){if(Ur.hiddenByReplacement||!Ur.node.meshes)continue;const Ui=Ur.node;let aa=0;me.terrain&&Ui.elevation&&(aa=Ui.elevation*me.terrain.exaggeration());const Gs=(()=>{const Ko=Ur.aabb;return Ot.min=[...Ko.min],Ot.max=[...Ko.max],Ot.min[2]+=aa,Ot.max[2]+=aa,s.af(Ot.min,Ot.min,is),s.af(Ot.max,Ot.max,is),Ot})(),Gi=Ur.evaluatedScale;if(Gi[0]<=1&&Gi[1]<=1&&Gi[2]<=1&&Gs.intersects(yn)===0)continue;if(!en&&Ht){const Ko=.16666666666666666;Ur.cameraCollisionOpacity=ct[0]>Gs.min[0]&&ct[0]<Gs.max[0]&&ct[1]>Gs.min[1]&&ct[1]<Gs.max[1]&&ct[2]*Ut<Gs.max[2]&&Ui.footprint&&s.c0(Ni,Ui.footprint)?Math.max(Ur.cameraCollisionOpacity-Ko,0):Math.min(1,Ur.cameraCollisionOpacity+Ko)}const Ei=[...is],Vr=1/s.d7(Oi.canonical),Bs=Ui.anchor?Ui.anchor[0]:0,Ea=Ui.anchor?Ui.anchor[1]:0;s.br(Ei,Ei,[Bs*(Gi[0]-1)+Ur.evaluatedTranslation[0]*Vr,Ea*(Gi[1]-1)+Ur.evaluatedTranslation[1]*Vr,aa+Ur.evaluatedTranslation[2]]),s.cq(Gi,s.eE)||s.cS(Ei,Ei,Gi);const na=s.aB([],Ei,Ui.globalMatrix),gs=s.aB([],Te.expandedFarZProjMatrix,na),vl=s.aB([],Te.expandedFarZProjMatrix,Ei),jo=s.aC([],[Bs,Ea,aa,1],gs)[2];Ui.hidden=!1;let Xa=Ue;en||(Ht&&(Xa*=Ur.cameraCollisionOpacity,Xa*=ui(Ei,Te,Ur.aabb,Yt)),Xa*=Hs(Ln,jo)),Xa!==0?Ri.push({nodeInfo:Ur,depth:jo,opacity:Xa,wvpForNode:gs,wvpForTile:vl,nodeModelMatrix:na,tileModelMatrix:Ei}):Ui.hidden=!0}en||Ri.sort((Ur,Ui)=>!Ht||Ur.opacity===1&&Ui.opacity===1?Ur.depth<Ui.depth?-1:1:Ur.opacity===1?-1:Ui.opacity===1?1:Ur.depth>Ui.depth?-1:1);for(const Ur of Ri){const Ui=Ur.nodeInfo,aa=Ui.node;let Gs=s.aB([],rt,Ur.tileModelMatrix);s.aB(Gs,St,Gs);const Gi=s.bl([],Gs);s.eg(Gi,Gi),s.cS(Gi,Gi,tg),Gs=s.aB(Gs,Gs,aa.globalMatrix);const Ei=me.renderPass==="light-beam",Vr=Ce.paint.get("model-color-use-theme").constantOr("default")==="none",Bs=Ki&s.eI.HasMapboxMeshFeatures,Ea=Bs?0:Ui.evaluatedRMEA[0][2];for(let na=0;na<aa.meshes.length;++na){const gs=aa.meshes[na],vl=na===aa.lightMeshIndex;let jo=Ur.wvpForNode;if(vl){if(!Ei&&!me.terrain&&me.shadowRenderer){me.currentLayer<me.firstLightBeamLayer&&(me.firstLightBeamLayer=me.currentLayer);continue}jo=Ur.wvpForTile}else if(Ei)continue;const Xa={defines:[]},Ko=[];if(!en&&Xe&&(Xe.useNormalOffset=!!gs.normalBuffer),My(Xa.defines,Ko,gs,me,Vr?null:Ce.lut),Bs||Xa.defines.push("DIFFUSE_SHADED"),Hi&&Xa.defines.push("SHADOWS_SINGLE_CASCADE"),In&&(en?In.numRenderedVerticesInShadowPass+=gs.vertexArray.length:In.numRenderedVerticesInTransparentPass+=gs.vertexArray.length),en){fc(gs,Ur.nodeModelMatrix,me,Ce);continue}let Qo=null;if(Fe){const Ia=Ry(Ur.nodeModelMatrix,me.transform);if(Qo=new Float32Array(Ia),Te.projection.name!=="globe"){const _s=gs.aabb.min,La=gs.aabb.max,[oa,ra]=Fe.getOpacityForBounds(Ia,_s[0],_s[1],La[0],La[1]);Xa.overrideFog=oa>=bt||ra>=bt}}const Po=gs.material;let hu;Po.occlusionTexture&&Po.occlusionTexture.offsetScale&&(hu=Po.occlusionTexture.offsetScale,Xa.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ju=me.getOrCreateProgram("model",Xa);!en&&Xe&&Xe.setupShadowsFromMatrix(Ur.tileModelMatrix,ju,Xe.useNormalOffset),me.uploadCommonUniforms(Ae,ju,null,Qo);const Rl=Po.pbrMetallicRoughness;Rl.metallicFactor=.9,Rl.roughnessFactor=.5;const pa=kf(new Float32Array(jo),new Float32Array(Gs),new Float32Array(Gi),new Float32Array(aa.globalMatrix),me,Ur.opacity,Rl.baseColorFactor,Po.emissiveFactor,Rl.metallicFactor,Rl.roughnessFactor,Po,Ea,Ce,[0,0,0],hu);!vl&&(Ui.hasTranslucentParts||Ur.opacity<1)&&ju.draw(me,Ae.gl.TRIANGLES,_t,kr.disabled,jr.disabled,Cr.backCCW,pa,Ce.id,gs.vertexBuffer,gs.indexBuffer,gs.segments,Ce.paint,me.transform.zoom,void 0,Ko),ju.draw(me,Ae.gl.TRIANGLES,vl?lt:_t,kr.disabled,vl||Ur.opacity<1||Ui.hasTranslucentParts?jr.alphaBlended:jr.unblended,Cr.backCCW,pa,Ce.id,gs.vertexBuffer,gs.indexBuffer,gs.segments,Ce.paint,me.transform.zoom,void 0,Ko)}}}}()}(m,o,d,g),void Z();if(W.type!=="model")return;const Y=W.getModels(),te=[],J=m.transform.getFreeCameraOptions().position,oe=s.c5([],[J.x,J.y,J.z],m.transform.worldSize);s.ew(oe,oe);const ae=[],pe=[];let _e=0;for(const me of Y){const Le=o.getFeatureState("",me.id),Ce={type:"Unknown",id:me.id,properties:me.featureProperties},Re=d.paint.get("model-rotation").evaluate(Ce,Le),Ae=d.paint.get("model-scale").evaluate(Ce,Le),Te=d.paint.get("model-translation").evaluate(Ce,Le),Fe=d.paint.get("model-opacity").evaluate(Ce,Le);VE(d,me.id,Le,me.featureProperties,me.nodeOverrideNames,me.nodeOverrides),$E(d,me.id,Le,me.featureProperties,me.materialOverrideNames,me.materialOverrides),me.nodeOverrides.size>0&&me.computeBoundsAndApplyParent(),me.computeModelMatrix(m,Re,Ae,Te,I,E,!1);const Xe=s.bA([]),He=s.ef(me.position.lat,m.transform.zoom),ct=s.bq([],[1,1,1/He]);s.br(Xe,Xe,oe),te.push({zScaleMatrix:ct,negCameraPosMatrix:Xe});for(const ht of me.nodes)Lf(m,ht,me.matrix,m.transform.expandedFarZProjMatrix,_e,ae,pe,me.materialOverrides,Fe);_e++}if(ae.sort((me,Le)=>Le.depth-me.depth),m.renderPass!=="shadow")HE(m,d,ae,pe,te),Z();else{for(const me of pe)fc(me.mesh,me.nodeModelMatrix,m,d);for(const me of ae)fc(me.mesh,me.nodeModelMatrix,m,d);Z()}}},Dy={line:function(m,o,d){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,m._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||m._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){const g=o.getVisibleCoordinates();for(const b of g){const T=o.getTile(b).getBucket(m);if(T&&(T.elevationType!=="none"?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,o,d){const g=o.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(d.modelManager&&d.modelManager.upload(d,eg(d,m)));if(g.type==="batched-model"||g.type!=="model")return;const b=g.getModels();for(const T of b)T.upload(d.context)},raster:function(m,o,d){const g=o.getSource();if(!(g instanceof ol&&g.loaded()))return;const b=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!b)return;const T=m.paint.get("raster-array-band")||g.getInitialBand(b);if(T==null)return;const E=o.getIds().map(I=>o.getTileByID(I));for(const I of E)I.updateNeeded(m.id,T)&&g.prepareTile(I,b,m.id,T)},"raster-particle":function(m,o,d){const g=o.getSource();if(!(g instanceof ol&&g.loaded()))return;const b=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!b)return;const T=m.paint.get("raster-particle-array-band")||g.getInitialBand(b);if(T==null)return;const E=o.getIds().map(I=>o.getTileByID(I));for(const I of E)I.updateNeeded(m.id,T)&&g.prepareTile(I,b,m.id,T)}},du={fill:by},Ny={fill:function(m,o,d,g){if(!d.layout||d.layout.get("fill-elevation-reference")==="none"||d.paint.get("fill-opacity").constantOr(1)===0)return;const b=m.context.gl,T=new zn(b.LEQUAL,zn.ReadOnly,m.depthRangeFor3D),E=new kr({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),I=m.transform.getFreeCameraOptions().position,M=m.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const N of g){const j=o.getTile(N),Z=j.getBucket(d);if(!Z)continue;const W=Z.elevatedStructures;if(!W||W.depthSegments.segments[0].primitiveLength===0)continue;const Y=OE(N.toUnwrapped(),I),te=m.translatePosMatrix(N.projMatrix,j,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor")),J=Cf(te,Y,0,1,0);M.draw(m,b.TRIANGLES,T,E,jr.disabled,Cr.disabled,J,d.id,W.vertexBuffer,W.indexBuffer,W.depthSegments,d.paint,m.transform.zoom)}}};class zy{constructor(o,d,g,b,T){this.context=new Vp(o,d),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=s.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const E=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const M of E)this._debugParams.enabledLayers[M]=!0;for(const M of E);this.occlusionParams=new Hp,this.setup(),this.numSublayers=$l.maxUnderzooming+$l.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Rp(this),this._wireframeDebugCache=new kh,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new s.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,I,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=b,this.worldview=T,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(o,d){const g=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Xx(this,o));const b=this._terrain;this.transform.elevation=g?b:null,b.update(o,this.transform,d),this.transform.elevation&&!b.enabled&&(this.transform.elevation=null)}_updateFog(o){const d=o.fog;if(!d||this.transform.projection.name==="globe"||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,b]=d.getFovAdjustedRange(this.transform._fov);if(g>b)return void(this.transform.fogCullDistSq=null);const T=g+.78*(b-g);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new Xx(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,d){if(this.width=o*s.o.devicePixelRatio,this.height=d*s.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._mergedLayers[g].resize()}setup(){const o=this.context,d=new s.bd;d.emplaceBack(0,0),d.emplaceBack(s.al,0),d.emplaceBack(0,s.al),d.emplaceBack(s.al,s.al),this.tileExtentBuffer=o.createVertexBuffer(d,s.bf.members),this.tileExtentSegments=s.bg.simpleSegment(0,0,4,2);const g=new s.bd;g.emplaceBack(0,0),g.emplaceBack(s.al,0),g.emplaceBack(0,s.al),g.emplaceBack(s.al,s.al),this.debugBuffer=o.createVertexBuffer(g,s.bf.members),this.debugSegments=s.bg.simpleSegment(0,0,4,5);const b=new s.bd;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(b,s.bf.members),this.viewportSegments=s.bg.simpleSegment(0,0,4,2);const T=new s.b1;T.emplaceBack(0,0,0,0),T.emplaceBack(s.al,0,s.al,0),T.emplaceBack(0,s.al,0,s.al),T.emplaceBack(s.al,s.al,s.al,s.al),this.mercatorBoundsBuffer=o.createVertexBuffer(T,s.bi.members),this.mercatorBoundsSegments=s.bg.simpleSegment(0,0,4,2);const E=new s.b0;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(E);const I=new s.be;for(const N of[0,1,3,2,0])I.emplaceBack(N);this.debugIndexBuffer=o.createIndexBuffer(I),this.emptyTexture=new s.T(o,new s.q({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=s.bC();const M=this.context.gl;this.stencilClearMode=new kr({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,zn.disabled,this.stencilClearMode,jr.disabled,Cr.disabled,q0(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,d,g){if(!d||this.currentStencilSource===d.id||!o.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const M of g)if(this._tileClippingMaskIDs[M.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=d.id;const b=this.context,T=b.gl;this.nextStencilID+g.length>256&&this.clearStencil(),b.setColorMode(jr.disabled),b.setDepthMode(zn.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of g){const M=d.getTile(I),N=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:j,tileBoundsIndexBuffer:Z,tileBoundsSegments:W}=this.getTileBoundsBuffers(M);E.draw(this,T.TRIANGLES,zn.disabled,new kr({func:T.ALWAYS,mask:0},N,255,T.KEEP,T.KEEP,T.REPLACE),jr.disabled,Cr.disabled,q0(I.projMatrix),"$clipping",j,Z,W)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,d=this.context.gl;return new kr({func:d.NOTEQUAL,mask:255},o,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const d=this.context.gl;return new kr({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(o){const d=this.context.gl,g=o.sort((E,I)=>I.overscaledZ-E.overscaledZ),b=g[g.length-1].overscaledZ,T=g[0].overscaledZ-b+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const E={};for(let I=0;I<T;I++)E[I+b]=new kr({func:d.GEQUAL,mask:255},I+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=T,[E,g]}return[{[b]:kr.disabled},g]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new jr([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new s.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?jr.unblended:jr.alphaBlended}colorModeForDrapableLayerRenderPass(o){const d=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?o!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new jr([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.CONSTANT_ALPHA,d.ONE_MINUS_SRC_ALPHA],new s.ao(0,0,0,o??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new jr([d.ONE,d.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,d.ONE_MINUS_SRC_ALPHA],s.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(o,d,g,b=!1){if(this.depthOcclusion)return new zn(this.context.gl.GREATER,zn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!b)return zn.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new zn(g||this.context.gl.LEQUAL,d,[T,T])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const o=this.context.gl,d=Math.ceil(this.width),g=Math.ceil(this.height),b=this.context.bindFramebuffer.get(),T=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===d&&this.depthFBO.height===g||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),d!==0&&g!==0&&(this.depthFBO=new PE(this.context,d,g,0,"texture"),this.depthTexture=new s.T(this.context,{width:d,height:g,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(b),o.bindTexture(o.TEXTURE_2D,T),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,d,g,0,0,d,g,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,d)=>o+d/this._fpsHistory.length,0))}render(o,d){const g=s.o.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=d;const b=this.style._mergedLayers,T=!(!this.terrain||!this.terrain.enabled),E=()=>this.style._getOrder(T).filter(rt=>{const Ue=b[rt];return!(Ue.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ue.type]});let I=E(),M=!1,N=!1,j=null,Z=0,W=!1;for(const rt of I){const Ue=b[rt];Ue.visibility!=="none"&&(Ue.type==="circle"?M=!0:Ue.type==="building"?(j=Ue,++Z):Ue.type==="symbol"&&(Ue.hasOcclusionOpacityProperties?N=!0:M=!0))}this.updateEmissiveMode();let Y=I.map(rt=>b[rt]);const te=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(s.o.now()),this.imageManager.beginFrame();for(const rt in te){const Ue=te[rt];Ue.used&&(Ue.prepare(this.context),Ue.getSource().usedInConflation&&++Z)}let J=!1;for(const rt of Y)rt.isHidden(this.transform.zoom)||(rt.type==="clip"&&(J=!0),this.prepareLayer(rt));const oe={},ae={},pe={},_e={},me={};for(const rt in te){const Ue=te[rt];oe[rt]=Ue.getVisibleCoordinates(),ae[rt]=oe[rt].slice().reverse(),pe[rt]=Ue.getVisibleCoordinates(!0).reverse(),_e[rt]=Ue.getShadowCasterCoordinates(),me[rt]=Ue.sortCoordinatesByDistance(oe[rt])}const Le=rt=>{const Ue=this.style.getLayerSourceCache(rt);return Ue&&Ue.used?Ue.getSource():null};if(Z||J||this._clippingActiveLastFrame){const rt=[],Ue=[];let _t=0;for(const lt of Y)this.isSourceForClippingOrConflation(lt,Le(lt))&&(rt.push(lt),Ue.push(_t)),_t++;if(rt&&(J||rt.length>1)||this._clippingActiveLastFrame){J=!1;const lt=[];for(let Ot=0;Ot<rt.length;Ot++){const en=rt[Ot],yn=Ue[Ot],Yt=this.style.getLayerSourceCache(en);if(!Yt||!Yt.used||!Yt.getSource().usedInConflation&&en.type!=="clip"&&en.type!=="building")continue;let Ht=s.eQ,Ln=s.b_.None;const In=[];let pn=!0;if(en.type==="building")Ht=s.eS;else if(en.type==="clip"){Ht=yn;for(const vn of en.layout.get("clip-layer-types"))Ln|=vn==="model"?s.b_.Model:vn==="symbol"?s.b_.Symbol:s.b_.FillExtrusion;for(const vn of en.layout.get("clip-layer-scope"))In.push(vn);en.isHidden(this.transform.zoom)?pn=!1:J=!0}pn&&lt.push({layer:en.fqid,cache:Yt,order:Ht,clipMask:Ln,clipScope:In})}this.replacementSource.setSources(lt),W=!0}}this._clippingActiveLastFrame=J,W||this.replacementSource.clear(),this.conflationActive=W,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let rt=0;rt<Y.length;rt++){const Ue=Y[rt];if(Ue.visibility==="none")continue;const _t=Ue.cutoffRange();if(this.longestCutoffRange=Math.max(_t,this.longestCutoffRange),_t>0){const lt=Le(Ue);lt&&(this.minCutoffZoom=Math.max(lt.minzoom,this.minCutoffZoom)),Ue.minzoom&&(this.minCutoffZoom=Math.max(Ue.minzoom,this.minCutoffZoom))}Ue.is3D(T)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=rt),this._lastOcclusionLayer=rt)}const Ce=this.style&&this.style.fog;Ce?(this._fogVisible=Ce.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ce.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(pe),this.opaquePassCutoff=0,I=E(),Y=I.map(rt=>b[rt]));const Re=this._shadowRenderer;if(Re){Re.updateShadowParameters(this.transform,this.style.directionalLight);for(const rt in te)for(const Ue of oe[rt]){let _t={min:0,max:0};this.terrain&&(_t=this.terrain.getMinMaxForTile(Ue)||_t),Re.addShadowReceiver(Ue.toUnwrapped(),_t.min,_t.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new UE(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Ae=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Ae&&!this._snow&&(this._snow=new db(this)),!Ae&&this._snow&&(this._snow.destroy(),delete this._snow),Te&&!this._rain&&(this._rain=new Ly(this)),!Te&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),j){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Iy);const rt=this.style.getLayerSourceCache(j);this.buildingTileBorderManager.updateBorders(rt,j)}if(!ar.has(this.context.gl))return;this.renderPass="offscreen";for(const rt of Y){const Ue=o.getLayerSourceCache(rt);if(!rt.hasOffscreenPass()||rt.isHidden(this.transform.zoom))continue;const _t=Ue?ae[Ue.id]:void 0;(rt.type==="custom"||rt.type==="raster"||rt.type==="raster-particle"||rt.isSky()||_t&&_t.length)&&this.renderLayer(this,Ue,rt,_t)}this.depthRangeFor3D=[0,1-(Y.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,_e)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Fe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Xe=(()=>{if(d.showOverdrawInspector)return s.ao.black;const rt=this.style.fog;if(rt&&this.transform.projection.supportsFog){const Ue=this.style.getLut(rt.scope);if(!Fe){const _t=rt.properties.get("color-use-theme")==="none",lt=rt.properties.get("color").toNonPremultipliedRenderColor(_t?null:Ue).toArray01();return new s.ao(...lt)}if(Fe){const _t=rt.properties.get("space-color-use-theme")==="none",lt=rt.properties.get("space-color").toNonPremultipliedRenderColor(_t?null:Ue).toArray01();return new s.ao(...lt)}}return s.ao.transparent})();if(this.context.clear({color:Xe,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Fe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const rt=Y[this.currentLayer],Ue=o.getLayerSourceCache(rt);if(rt.isSky())continue;const _t=Ue?(rt.is3D(T)?me:ae)[Ue.id]:void 0;this._renderTileClippingMasks(rt,Ue,_t),this.renderLayer(this,Ue,rt,_t)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Fe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const rt=Y[this.currentLayer],Ue=o.getLayerSourceCache(rt);rt.isSky()&&this.renderLayer(this,Ue,rt,Ue?ae[Ue.id]:void 0)}function He(rt,Ue){let _t;return Ue&&(_t=(rt.type==="symbol"?pe:rt.is3D(T)?me:ae)[Ue.id]),_t}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const rt=Y[this.currentLayer];if(rt.type==="raster"||rt.type==="raster-particle"){const Ue=o.getLayerSourceCache(rt);this.renderLayer(this,Ue,rt,He(rt,Ue))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ct=0;Re&&(ct=Re.getShadowCastingLayerCount());let ht=!1,St=-1;for(let rt=0;rt<I.length;++rt){const Ue=Y[rt];Ue.isHidden(this.transform.zoom)||Ue.is3D(T)&&(St=rt)}N&&St===-1&&(M=!0);let Ut=!1;for(;this.currentLayer<I.length;){const rt=Y[this.currentLayer],Ue=o.getLayerSourceCache(rt);if(rt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(rt)){if(rt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ut&&rt.is3D(T)&&!T){const _t=this.currentLayer,lt=Ot=>{for(this.currentLayer=0;this.currentLayer<Y.length;this.currentLayer++){const en=Y[this.currentLayer];if(du[en.type]){const yn=this.style.getLayerSourceCache(en);du[en.type](this,yn,en,He(en,yn),Ot)}}};lt("initialize"),lt("reset"),this.currentLayer=_t,Ut=!0}if(M&&!ht&&this.terrain&&!this.transform.isOrthographic&&(ht=!0,this.blitDepth()),N&&St!==-1&&this.currentLayer===St+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(rt,Ue,Ue?oe[Ue.id]:void 0),this.renderLayer(this,Ue,rt,He(rt,Ue)),!this.terrain&&Re&&ct>0&&rt.hasShadowPass()&&--ct==0){{this.clearStencil(),this.resetStencilClippingMasks();const _t=this.currentLayer;for(this.currentLayer=0;this.currentLayer<Y.length;this.currentLayer++){const lt=Y[this.currentLayer];if(Ny[lt.type]){const Ot=this.style.getLayerSourceCache(lt);Ny[lt.type](this,Ot,lt,He(lt,Ot))}}this.currentLayer=_t}if(Re.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const _t=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=_t;this.currentLayer++){const lt=Y[this.currentLayer];if(!lt.hasLightBeamPass())continue;const Ot=o.getLayerSourceCache(lt);this.renderLayer(this,Ot,lt,Ot?ae[Ot.id]:void 0)}this.currentLayer=_t,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const _t=this.currentLayer;this.depthOcclusion=!0;for(const lt of this.layersWithOcclusionOpacity){this.currentLayer=lt;const Ot=Y[this.currentLayer],en=o.getLayerSourceCache(Ot),yn=en?ae[en.id]:void 0;this.terrain||this._renderTileClippingMasks(Ot,en,en?oe[en.id]:void 0),this.renderLayer(this,en,Ot,yn)}this.depthOcclusion=!1,this.currentLayer=_t,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let rt=null;Y.forEach(Ue=>{const _t=o.getLayerSourceCache(Ue);_t&&!Ue.isHidden(this.transform.zoom)&&_t.getVisibleCoordinates().length&&(!rt||rt.getSource().maxzoom<_t.getSource().maxzoom)&&(rt=_t)}),rt&&this.options.showTileBoundaries&&Zt(this,rt,rt.getVisibleCoordinates(),s.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Zt(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(rt){const Ue=rt.transform.padding;Pf(rt,rt.transform.height-(Ue.top||0),3,NE),Pf(rt,Ue.bottom||0,3,zE),fa(rt,Ue.left||0,3,FE),fa(rt,rt.transform.width-(Ue.right||0),3,Rf);const _t=rt.transform.centerPoint;(function(lt,Ot,en,yn){Ke(lt,Ot-1,en-10,2,20,yn),Ke(lt,Ot-10,en-1,20,2,yn)})(rt,_t.x,rt.transform.height-_t.y,Mf)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),W||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);const{unsupportedLayers:d}=this.transform.projection,g=!d||!d.includes(o.type);if(Dy[o.type]&&(g||this.terrain&&o.type==="custom")){const b=this.style.getLayerSourceCache(o);Dy[o.type](o,b,this)}this.gpuTimingEnd()}renderLayer(o,d,g,b){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||b&&b.length)&&(this.id=g.id,this.gpuTimingStart(g),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(g.type)&&(!o.terrain||g.type!=="custom")||g.type==="clip"||Ih[g.type](o,d,g,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery,g=this.context.gl;let b=this.gpuTimers[o.id];b||(b=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:g.createQuery()}),b.calls++,g.beginQuery(d.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,d=this.context.gl,g=d.createQuery();this.deferredRenderGpuTimeQueries.push(g),d.beginQuery(o.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const d={};for(const g in o){const b=o[g],T=this.context.extTimerQuery,E=T.getQueryParameter(b.query,this.context.gl.QUERY_RESULT)/1e6;T.deleteQueryEXT(b.query),d[g]=E}return d}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.gl;let g=0;for(const b of o)g+=d.getQueryParameter(b,d.QUERY_RESULT)/1e6,d.deleteQuery(b);return g}translatePosMatrix(o,d,g,b,T){if(!g[0]&&!g[1])return o;const E=T?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(E){const N=Math.sin(E),j=Math.cos(E);g=[g[0]*j-g[1]*N,g[0]*N+g[1]*j]}const I=[T?g[0]:s.ay(d,g[0],this.transform.zoom),T?g[1]:s.ay(d,g[1],this.transform.zoom),0],M=new Float32Array(16);return s.br(M,o,I),M}saveTileTexture(o){if(o.context!==this.context)return;const d=o.size[0],g=this._tileTextures[d];g?g.push(o):this._tileTextures[d]=[o]}getTileTexture(o){const d=this._tileTextures[o];return d&&d.length>0?d.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,d,g){const b=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,T=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(T.push("LIGHTING_3D_MODE"),T.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):b||T.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||T.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(T.push("TERRAIN"),this.linearFloatFilteringSupported()&&T.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&T.push("GLOBE"),!this._fogVisible||b||d!==void 0&&!d||T.push("FOG","FOG_DITHERING"),b&&T.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&T.push("OVERDRAW_INSPECTOR"),T}getOrCreateProgram(o,d){this.cache=this.cache||{};const g=d&&d.defines||[],b=d&&d.config,T=this.currentGlobalDefines(o,d&&d.overrideFog,d&&d.overrideRtt).concat(g),E=xE.cacheKey(Nx[o],o,T,b);return this.cache[E]||(this.cache[E]=new xE(this.context,o,Nx[o],b,xy[o],T)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,d){if(this.style.enable3dLights()){const g=this.style.directionalLight,b=this.style.ambientLight;if(g&&b){const T=((E,I,M)=>{const N=E.properties.get("direction"),j=E.properties.get("color-use-theme")==="none",Z=E.properties.get("color").toNonPremultipliedRenderColor(j?null:M.getLut(E.scope)).toArray01(),W=E.properties.get("intensity"),Y=I.properties.get("color-use-theme")==="none",te=I.properties.get("color").toNonPremultipliedRenderColor(Y?null:M.getLut(I.scope)).toArray01(),J=I.properties.get("intensity"),oe=[N.x,N.y,N.z],ae=s.dN(te,J),pe=s.dN(Z,W);return{u_lighting_ambient_color:ae,u_lighting_directional_dir:oe,u_lighting_directional_color:pe,u_ground_radiance:Bp(oe,pe,ae)}})(g,b,this.style);d.setLightsUniformValues(o,T)}}}uploadCommonUniforms(o,d,g,b,T){if(this.uploadCommonLightUniforms(o,d),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const I=E.getOpacity(this.transform.pitch),M=((N,j,Z,W,Y,te,J,oe,ae,pe,_e,me)=>{const Le=N.transform,Ce=j.properties.get("color-use-theme")==="none",Re=j.properties.get("color").toNonPremultipliedRenderColor(Ce?null:N.style.getLut(j.scope)).toArray01();Re[3]=W;const Ae=N.frameCounter/1e3%1,[Te,Fe]=j.properties.get("vertical-range");return{u_fog_matrix:Z?Le.calculateFogTileMatrix(Z):me||N.identityMat,u_fog_range:j.getFovAdjustedRange(Le._fov),u_fog_color:Re,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Te,Fe),Fe],u_fog_temporal_offset:Ae,u_frustum_tl:Y,u_frustum_tr:te,u_frustum_br:J,u_frustum_bl:oe,u_globe_pos:ae,u_globe_radius:pe,u_viewport:_e,u_globe_transition:s.aj(Le.zoom),u_is_globe:+(Le.projection.name==="globe")}})(this,E,g,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.o.devicePixelRatio,this.transform.height*s.o.devicePixelRatio],b);d.setFogUniformValues(o,M)}T&&d.setCutoffUniformValues(o,T.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,d=o.createTexture();return o.bindTexture(o.TEXTURE_2D,d),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,d=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const b of g)d[b.key]=o[b.key]||new xf(b,512,this.transform.tileZoom,this,void 0,this.worldview);return d}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,d){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&o.type!=="building"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building"&&o.sourceLayer!=="procedural_buildings")&&(!d||d.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let d=this._cachedTileFogOpacities[o.key];return d||(this._cachedTileFogOpacities[o.key]=d=this.style.fog.getOpacityForTile(o)),d[0]>=bt||d[1]>=bt}setupDepthForOcclusion(o,d,g){const b=this.context,T=b.gl,E=!!g;var I;g||(g={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),b.activeTexture.set(T.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),g.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],g.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],g.u_occluder_half_size=.5*this.occlusionParams.occluderSize,g.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),b.activeTexture.set(T.TEXTURE0),E||d.setTerrainUniformValues(b,g)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const o=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=o?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function Fy(m,o){let d=!1,g=null;const b=()=>{g=null,d&&(m(),g=setTimeout(b,o),d=!1)};return()=>(d=!0,g||b(),g)}class hb{constructor(o){this._hashName=o&&encodeURIComponent(o),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Fy(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const d=Wa(o);if(this._hashName){const g=this._hashName;let b=!1;const T=location.hash.slice(1).split("&").map(E=>{const I=E.split("=")[0];return I===g?(b=!0,`${I}=${d}`):E}).filter(E=>E);return b||T.push(`${g}=${d}`),`#${T.join("&")}`}return`#${d}`}_getCurrentHash(){const o=location.hash.replace("#","");if(this._hashName){let d;return o.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(d=g)}),(d&&d[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(g=>isNaN(Number(g)))){const g=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(d[3]||0):o.getBearing();return o.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:g,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Wa(m,o){const d=m.getCenter(),g=Math.round(100*m.getZoom())/100,b=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,b),E=Math.round(d.lng*T)/T,I=Math.round(d.lat*T)/T,M=m.getBearing(),N=m.getPitch();let j=o?`/${E}/${I}/${g}`:`${g}/${I}/${E}`;return(M||N)&&(j+="/"+Math.round(10*M)/10),N&&(j+=`/${Math.round(N)}`),j}const qp={linearity:.3,easing:s.eT(0,0,.3,1)},fb=Object.assign({deceleration:2500,maxSpeed:1400},qp),pb=Object.assign({deceleration:20,maxSpeed:1400},qp),Nf=Object.assign({deceleration:1e3,maxSpeed:360},qp),mb=Object.assign({deceleration:1e3,maxSpeed:90},qp);class gb{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.o.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,d=s.o.now();for(;o.length>0&&d-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)d.zoom+=T.zoomDelta||0,d.bearing+=T.bearingDelta||0,d.pitch+=T.pitchDelta||0,T.panDelta&&d.pan._add(T.panDelta),T.around&&(d.around=T.around),T.pinchAround&&(d.pinchAround=T.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){const T=Xc(d.pan.mag(),g,Object.assign({},fb,o||{}));b.offset=d.pan.mult(T.amount/d.pan.mag()),b.center=this._map.transform.center,Wp(b,T)}if(d.zoom){const T=Xc(d.zoom,g,pb);b.zoom=this._map.transform.zoom+T.amount,Wp(b,T)}if(d.bearing){const T=Xc(d.bearing,g,Nf);b.bearing=this._map.transform.bearing+s.aA(T.amount,-179,179),Wp(b,T)}if(d.pitch){const T=Xc(d.pitch,g,mb);b.pitch=this._map.transform.pitch+T.amount,Wp(b,T)}if(b.zoom||b.bearing){const T=d.pinchAround===void 0?d.around:d.pinchAround;b.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function Wp(m,o){(!m.duration||m.duration<o.duration)&&(m.duration=o.duration,m.easing=o.easing)}function Xc(m,o,d){const{maxSpeed:g,linearity:b,deceleration:T}=d,E=s.aA(m*b/(o/1e3),-g,g),I=Math.abs(E)/(T*b);return{easing:d.easing,duration:1e3*I,amount:E*(I/2)}}class Il extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,g,b={}){const T=ve(d.getCanvasContainer(),g),E=d.unproject(T);super(o,Object.assign({point:T,lngLat:E,originalEvent:g},b)),this._defaultPrevented=!1,this.target=d}}class Rh extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,g){const b=o==="touchend"?g.changedTouches:g.touches,T=Qe(d.getCanvasContainer(),b),E=T.map(M=>d.unproject(M)),I=T.reduce((M,N,j,Z)=>M.add(N.div(Z.length)),new s.P(0,0));super(o,{points:T,point:I,lngLats:E,lngLat:d.unproject(I),originalEvent:g}),this._defaultPrevented=!1}}class _b extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d){super("wheel",{originalEvent:d}),this._defaultPrevented=!1}}class By{constructor(o,d){this._map=o,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new _b(this._map,o))}mousedown(o,d){return this._mousedownPos=d,this._firePreventable(new Il(o.type,this._map,o))}mouseup(o){this._map.fire(new Il(o.type,this._map,o))}preclick(o){const d=new MouseEvent("preclick",o);this._map.fire(new Il(d.type,this._map,d))}click(o,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Il(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Il(o.type,this._map,o))}mouseover(o){this._map.fire(new Il(o.type,this._map,o))}mouseout(o){this._map.fire(new Il(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Rh(o.type,this._map,o))}touchmove(o){this._map.fire(new Rh(o.type,this._map,o))}touchend(o){this._map.fire(new Rh(o.type,this._map,o))}touchcancel(o){this._map.fire(new Rh(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yb{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Il(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Il("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Il(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jy{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,d){this.isEnabled()&&o.shiftKey&&o.button===0&&(ie(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(o,d){if(!this._active)return;const g=d,b=this._startPos,T=this._lastPos;if(!b||!T||T.equals(g)||!this._box&&g.dist(b)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=U("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const E=Math.min(b.x,g.x),I=Math.max(b.x,g.x),M=Math.min(b.y,g.y),N=Math.max(b.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${M}px)`,this._box.style.width=I-E+"px",this._box.style.height=N-M+"px")})}mouseupWindow(o,d){if(!this._active)return;const g=this._startPos,b=d;if(g&&o.button===0){if(this.reset(),be(),g.x!==b.x||g.y!==b.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:o})),{cameraAnimation:T=>T.fitScreenCoordinates(g,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),de(),delete this._startPos,delete this._lastPos}_fireEvent(o,d){return this._map.fire(new s.z(o,{originalEvent:d}))}}function Uy(m,o){const d={};for(let g=0;g<m.length;g++)d[m[g].identifier]=o[g];return d}class ZE{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,d,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),g.length===this.numTouches&&(this.centroid=function(b){const T=new s.P(0,0);for(const E of b)T._add(E);return T.div(b.length)}(d),this.touches=Uy(g,d)))}touchmove(o,d,g){if(this.aborted||!this.centroid)return;const b=Uy(g,d);for(const T in this.touches){const E=b[T];(!E||E.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(o,d,g){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Vy{constructor(o){this.singleTap=new ZE(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,d,g){this.singleTap.touchstart(o,d,g)}touchmove(o,d,g){this.singleTap.touchmove(o,d,g)}touchend(o,d,g){const b=this.singleTap.touchend(o,d,g);if(b){const T=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(b)<30;if(T&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class XE{constructor(){this._zoomIn=new Vy({numTouches:1,numTaps:2}),this._zoomOut=new Vy({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,d,g){this._zoomIn.touchstart(o,d,g),this._zoomOut.touchstart(o,d,g)}touchmove(o,d,g){this._zoomIn.touchmove(o,d,g),this._zoomOut.touchmove(o,d,g)}touchend(o,d,g){const b=this._zoomIn.touchend(o,d,g),T=this._zoomOut.touchend(o,d,g);return b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(b)},{originalEvent:o})}):T?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(T)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const YE={0:1,2:2},vb={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class $y{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,d){return!1}_move(o,d){return{}}mousedown(o,d){if(this._lastPoint)return;const g=we(o);this._correctButton(o,g)&&(this._lastPoint=d,this._eventButton=g)}mousemoveWindow(o,d){const g=this._lastPoint;if(g){if(o.preventDefault(),this._eventButton!=null&&function(b,T){const E=YE[T];return b.buttons===void 0||(b.buttons&E)!==E}(o,this._eventButton))this.reset();else if(this._moved||!(d.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(g,d)}}mouseupWindow(o){this._lastPoint&&we(o)===this._eventButton&&(this._moved&&be(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class KE extends $y{mousedown(o,d){super.mousedown(o,d),this._lastPoint&&(this._active=!0)}_correctButton(o,d){return d===0&&!o.ctrlKey}_move(o,d){return{around:d,panDelta:d.sub(o)}}}class xb extends $y{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?vb[o.pitchRotateKey]:void 0}_correctButton(o,d){return this._pitchRotateKey?d===0&&o[this._pitchRotateKey]:d===0&&o.ctrlKey||d===2}_move(o,d){const g=.8*(d.x-o.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class bb extends $y{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?vb[o.pitchRotateKey]:void 0}_correctButton(o,d){return this._pitchRotateKey?d===0&&o[this._pitchRotateKey]:d===0&&o.ctrlKey||d===2}_move(o,d){const g=-.5*(d.y-o.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class QE{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(o,d,g){return this._calculateTransform(o,d,g)}touchmove(o,d,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!s.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,d,g)}}touchend(o,d,g){this._calculateTransform(o,d,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,d,g){g.length>0&&(this._active=!0);const b=Uy(g,d),T=new s.P(0,0),E=new s.P(0,0);let I=0;for(const N in b){const j=b[N],Z=this._touches[N];Z&&(T._add(j),E._add(j.sub(Z)),I++,b[N]=j)}if(this._touches=b,I<this._minTouches||!E.mag())return;const M=E.div(I);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(I),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Hy{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,d,g){return{}}touchstart(o,d,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([d[0],d[1]]))}touchmove(o,d,g){const b=this._firstTwoTouches;if(!b)return;o.preventDefault();const[T,E]=b,I=ng(g,d,T),M=ng(g,d,E);if(!I||!M)return;const N=this._aroundCenter?null:I.add(M).div(2);return this._move([I,M],N,o)}touchend(o,d,g){if(!this._firstTwoTouches)return;const[b,T]=this._firstTwoTouches,E=ng(g,d,b),I=ng(g,d,T);E&&I||(this._active&&be(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ng(m,o,d){for(let g=0;g<m.length;g++)if(m[g].identifier===d)return o[g]}function JE(m,o){return Math.log2(m/o)}class tI extends Hy{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,d){const g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(JE(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:JE(this._distance,g),pinchAround:d}}}function eS(m,o){return 180*m.angleWith(o)/Math.PI}class ta extends Hy{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,d){const g=this._vector;if(this._vector=o[0].sub(o[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:eS(this._vector,g),pinchAround:d}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const d=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const b=eS(o,g);return Math.abs(b)<d}}function Gy(m){return Math.abs(m.y)>Math.abs(m.x)}class nI extends Hy{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,Gy(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,d,g){const b=this._lastPoints;if(!b)return;const T=o[0].sub(b[0]),E=o[1].sub(b[1]);return this._map._cooperativeGestures&&!s.eU()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(T,E,g.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(T.y+E.y)/2*-.5})}gestureBeginsVertically(o,d,g){if(this._valid!==void 0)return this._valid;const b=o.mag()>=2,T=d.mag()>=2;if(!b&&!T)return;if(!b||!T)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const E=o.y>0==d.y>0;return Gy(o)&&Gy(d)&&E}}const rI={panStep:100,bearingStep:15,pitchStep:10};class iI{constructor(){const o=rI;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let d=0,g=0,b=0,T=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:o.shiftKey?g=-1:(o.preventDefault(),T=-1);break;case 39:o.shiftKey?g=1:(o.preventDefault(),T=1);break;case 38:o.shiftKey?b=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?b=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,b=0),{cameraAnimation:I=>{const M=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:rg,zoom:d?Math.round(M)+d*(o.shiftKey?2:1):M,bearing:I.getBearing()+g*this._bearingStep,pitch:I.getPitch()+b*this._pitchStep,offset:[-T*this._panStep,-E*this._panStep],center:I.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function rg(m){return m*(2-m)}const wb=4.000244140625,Tb=1/450;class qy{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._handler=d,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Tb,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||s.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const g=s.o.now(),b=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,d!==0&&d%wb==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),o.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=o,this._delta-=d,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=ve(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const N=this._type==="wheel"&&Math.abs(this._delta)>wb?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&j!==0&&(j=1/j);const Z=d(),W=Math.pow(2,Z),Y=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):W;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(Y*j))),this._type==="wheel"&&(this._startZoom=Z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:d(),b=this._startZoom,T=this._easing;let E,I=!1;if(this._type==="wheel"&&b&&T){const N=Math.min((s.o.now()-this._lastWheelEventTime)/200,1),j=T(N);E=s.ak(b,g,j),N<1?this._frameId||(this._frameId=!0):I=!0}else E=g,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let M=E-d();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let d=s.eV;if(this._prevEase){const g=this._prevEase,b=(s.o.now()-g.start)/g.duration,T=g.easing(b+.01)-g.easing(b),E=.27/Math.sqrt(T*T+1e-4)*.01,I=Math.sqrt(.0729-E*E);d=s.eT(E,I,.25,1)}return this._prevEase={start:s.o.now(),duration:o,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Rd{constructor(o,d){this._clickZoom=o,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wy{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,d){return o.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(o.shiftKey?-1:1),around:g.unproject(d)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Za{constructor(){this._tap=new Vy({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,d,g){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=d[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(o,d,g))}touchmove(o,d,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const b=d[0],T=b.y-this._swipePoint.y;return this._swipePoint=b,o.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(o,d,g)}touchend(o,d,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(o,d,g)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yc{constructor(o,d,g){this._el=o,this._mousePan=d,this._touchPan=g}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ig{constructor(o,d,g){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=d,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Zy{constructor(o,d,g,b){this._el=o,this._touchZoom=d,this._touchRotate=g,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const sg=m=>m.zoom||m.drag||m.pitch||m.rotate;class sI extends s.z{}class ag{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,d){const g=s.av([],d,o);this.radius=s.ag(g[2]<0?s.eX([],g,this.constants):[g[0],g[1],0])}projectRay(o){s.eX(o,o,this.constants),s.aw(o,o),s.eY(o,o,this.constants);const d=s.c5([],o,this.radius);if(d[2]>0){const g=s.c5([],[0,0,1],s.bJ(d,[0,0,1])),b=s.c5([],s.aw([],[d[0],d[1],0]),this.radius),T=s.d8([],d,s.c5([],s.av([],s.d8([],b,g),d),2));d[0]=T[0],d[1]=T[1]}return d}}function Xy(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class aI{constructor(o,d){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new gb(o),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ag,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),s.aY(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,T,E]of this._listeners){const I=b===document?this.handleWindowEvent:this.handleEvent;b.addEventListener(T,I,E)}}destroy(){for(const[o,d,g]of this._listeners){const b=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(d,b,g)}}_addDefaultHandlers(o){const d=this._map,g=d.getCanvasContainer();this._add("mapEvent",new By(d,o));const b=d.boxZoom=new jy(d,o);this._add("boxZoom",b);const T=new XE,E=new Wy;d.doubleClickZoom=new Rd(E,T),this._add("tapZoom",T),this._add("clickZoom",E);const I=new Za;this._add("tapDragZoom",I);const M=d.touchPitch=new nI(d);this._add("touchPitch",M);const N=new xb(o),j=new bb(o);d.dragRotate=new ig(o,N,j),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);const Z=new KE(o),W=new QE(d,o);d.dragPan=new Yc(g,Z,W),this._add("mousePan",Z),this._add("touchPan",W,["touchZoom","touchRotate"]);const Y=new ta,te=new tI;d.touchZoomRotate=new Zy(g,te,Y,I),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]),this._add("blockableMapEvent",new yb(d));const J=d.scrollZoom=new qy(d,this);this._add("scrollZoom",J,["mousePan"]);const oe=d.keyboard=new iI;this._add("keyboard",oe);for(const ae of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[ae]&&d[ae].enable(o[ae])}_add(o,d,g){this._handlers.push({handlerName:o,handler:d,allowed:g}),this._handlersById[o]=d}stop(o){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!sg(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,d,g){for(const b in o)if(b!==g&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const d=[];for(const g of o)this._el.contains(g.target)&&d.push(g);return d}handleEvent(o,d){this._updatingCamera=!0;const g=o.type==="renderFrame",b=g?void 0:o,T={needsRenderFrame:!1},E={},I={},M=o.touches?this._getMapTouches(o.touches):void 0,N=M?Qe(this._el,M):g?void 0:ve(this._el,o);for(const{handlerName:W,handler:Y,allowed:te}of this._handlers){if(!Y.isEnabled())continue;let J;this._blockedByActive(I,te,W)?Y.reset():Y[d||o.type]&&(J=Y[d||o.type](o,N,M),this.mergeHandlerResult(T,E,J,W,b),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||Y.isActive())&&(I[W]=Y)}const j={};for(const W in this._previousActiveHandlers)I[W]||(j[W]=b);this._previousActiveHandlers=I,(Object.keys(j).length||Xy(T))&&(this._changes.push([T,E,j]),this._triggerRenderFrame()),(Object.keys(I).length||Xy(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=T;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))}mergeHandlerResult(o,d,g,b,T){if(!g)return;Object.assign(o,g);const E={handlerName:b,originalEvent:g.originalEvent||T};g.zoomDelta!==void 0&&(d.zoom=E),g.panDelta!==void 0&&(d.drag=E),g.pitchDelta!==void 0&&(d.pitch=E),g.bearingDelta!==void 0&&(d.rotate=E)}_applyChanges(){const o={},d={},g={};for(const[b,T,E]of this._changes)b.panDelta&&(o.panDelta=(o.panDelta||new s.P(0,0))._add(b.panDelta)),b.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(o.around=b.around),b.aroundCoord!==void 0&&(o.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(o.pinchAround=b.pinchAround),b.noInertia&&(o.noInertia=b.noInertia),Object.assign(d,T),Object.assign(g,E);this._updateMapTransform(o,d,g),this._changes=[]}_updateMapTransform(o,d,g){const b=this._map,T=b.transform,E=pe=>[pe.x,pe.y,pe.z];if((pe=>{const _e=this._eventsInProgress.drag;return _e&&!this._handlersById[_e.handlerName].isActive()})()&&!Xy(o)){const pe=T.zoom;T.cameraElevationReference="sea",this._originalZoom!=null&&T._orthographicProjectionAtLowPitch&&T.projection.name!=="globe"&&T.pitch===0?(T.cameraElevationReference="ground",T.zoom=this._originalZoom):(T.recenterOnTerrain(),T.cameraElevationReference="ground"),pe!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&b._stop(!0),!Xy(o))return void this._fireEvents(d,g,!0);let{panDelta:I,zoomDelta:M,bearingDelta:N,pitchDelta:j,around:Z,aroundCoord:W,pinchAround:Y}=o;T._isCameraConstrained&&(M>0&&(M=0),T._isCameraConstrained=!1),Y!==void 0&&(Z=Y),(M||(pe=>d[pe]&&!this._eventsInProgress[pe])("drag"))&&Z&&(this._dragOrigin=E(T.pointCoordinate3D(Z)),this._originalZoom=T.zoom,this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",b._stop(!0),Z=Z||b.transform.centerPoint,N&&(T.bearing+=N),j&&(T.pitch+=j),T._updateCameraState();const te=[0,0,0];if(I)if(T.projection.name==="mercator"){const pe=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(Z).dir),_e=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(Z.sub(I)).dir);te[0]=_e[0]-pe[0],te[1]=_e[1]-pe[1]}else{const pe=T.pointCoordinate(Z);if(T.projection.name==="globe"){I=I.rotate(-T.angle);const _e=T._pixelsPerMercatorPixel/T.worldSize;te[0]=-I.x*s.eW(s.a$(pe.y))*_e,te[1]=-I.y*s.eW(T.center.lat)*_e}else{const _e=T.pointCoordinate(Z.sub(I));pe&&_e&&(te[0]=_e.x-pe.x,te[1]=_e.y-pe.y)}}const J=T.zoom,oe=[0,0,0];if(M){const pe=E(W||T.pointCoordinate3D(Z)),_e={dir:s.aw([],s.av([],pe,T._camera.position))};if(_e.dir[2]<0){const me=T.zoomDeltaToMovement(pe,M);s.c5(oe,_e.dir,me)}}const ae=s.d8(te,te,oe);T._translateCameraConstrained(ae),M&&Math.abs(T.zoom-J)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(d,g,!0)}_fireEvents(o,d,g){const b=sg(this._eventsInProgress),T=sg(o),E={};for(const j in o){const{originalEvent:Z}=o[j];this._eventsInProgress[j]||(E[`${j}start`]=Z),this._eventsInProgress[j]=o[j]}!b&&T&&this._fireEvent("movestart",T.originalEvent);for(const j in E)this._fireEvent(j,E[j]);T&&this._fireEvent("move",T.originalEvent);for(const j in o){const{originalEvent:Z}=o[j];this._fireEvent(j,Z)}const I={};let M;for(const j in this._eventsInProgress){const{handlerName:Z,originalEvent:W}=this._eventsInProgress[j];this._handlersById[Z].isActive()||(delete this._eventsInProgress[j],M=d[Z]||W,I[`${j}end`]=M)}for(const j in I)this._fireEvent(j,I[j]);const N=sg(this._eventsInProgress);if(g&&(b||T)&&!N){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;j?(Z(j.bearing||this._map.getBearing())&&(j.bearing=0),this._map.easeTo(j,{originalEvent:M})):(this._map.fire(new s.z("moveend",{originalEvent:M})),Z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,d){this._map.fire(new s.z(o,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new sI("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Yy="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Eb extends s.E{constructor(o,d){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=d.respectPrefersReducedMotion!==!1,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(o,d){return this.jumpTo({center:o},d)}panBy(o,d,g){return o=s.P.convert(o).mult(-1),this.panTo(this.transform.center,Object.assign({offset:o},d),g)}panTo(o,d,g){return this.easeTo(Object.assign({center:o},d),g)}getZoom(){return this.transform.zoom}setZoom(o,d){return this.jumpTo({zoom:o},d),this}zoomTo(o,d,g){return this.easeTo(Object.assign({zoom:o},d),g)}zoomIn(o,d){return this.zoomTo(this.getZoom()+1,o,d),this}zoomOut(o,d){return this.zoomTo(this.getZoom()-1,o,d),this}getBearing(){return this.transform.bearing}setBearing(o,d){return this.jumpTo({bearing:o},d),this}getPadding(){return this.transform.padding}setPadding(o,d){return this.jumpTo({padding:o},d),this}rotateTo(o,d,g){return this.easeTo(Object.assign({bearing:o},d),g)}resetNorth(o,d){return this.rotateTo(0,Object.assign({duration:1e3},o),d),this}resetNorthPitch(o,d){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},o),d),this}snapToNorth(o,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,d):this}getPitch(){return this.transform.pitch}setPitch(o,d){return this.jumpTo({pitch:o},d),this}cameraForBounds(o,d){o=s.aI.convert(o);const g=d&&d.bearing||0,b=d&&d.pitch||0,T=o.getNorthWest(),E=o.getSouthEast();return this._cameraForBounds(this.transform,T,E,g,b,d)}_extendPadding(o){const d={top:0,right:0,bottom:0,left:0};return o==null?Object.assign({},d,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:Object.assign({},d,o)}_extendCameraOptions(o){return(o=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,d){const g=d.max[0]-d.min[0],b=d.max[1]-d.min[1];return g/b>o.aspect?g/(2*Math.tan(.5*o.fovX)*o.aspect):b/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,d,g,b,T,E){const I=o.clone(),M=this._extendCameraOptions(E);I.bearing=b,I.pitch=T;const N=s.aT.convert(d),j=s.aT.convert(g),Z=.5*(N.lat+j.lat),W=.5*(N.lng+j.lng),Y=s.eZ(Z,W),te=s.aw([],Y),J=s.aw([],s.bI([],te,[0,1,0])),oe=s.bI([],J,te),ae=[J[0],J[1],J[2],0,oe[0],oe[1],oe[2],0,te[0],te[1],te[2],0,0,0,0,1],pe=[Y,s.eZ(N.lat,N.lng),s.eZ(j.lat,N.lng),s.eZ(j.lat,j.lng),s.eZ(N.lat,j.lng),s.eZ(Z,N.lng),s.eZ(Z,j.lng),s.eZ(N.lat,W),s.eZ(j.lat,W)];let _e=s.d9.fromPoints(pe.map(lt=>[s.bJ(J,lt),s.bJ(oe,lt),s.bJ(te,lt)]));const me=s.af([],_e.center,ae);s.e_(me)===0&&s.e$(me,0,0,1),s.aw(me,me),s.c5(me,me,s.aD),I.center=s.f0(me);const Le=I.getWorldToCameraMatrix(),Ce=s.bl(new Float64Array(16),Le);_e=s.d9.applyTransform(_e,s.aB([],Le,ae));const Re=this._extendAABB(_e,I,M,b);if(!Re)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");_e=Re,s.af(me,me,Le);const Ae=.5*(_e.max[2]-_e.min[2]),Te=this._minimumAABBFrustumDistance(I,_e),Fe=s.c5([],[0,0,1],Ae),Xe=s.d8(Fe,me,Fe),He=Te+(I.pitch===0?0:s.bG(me,Xe)),ct=I.globeCenterInViewSpace,ht=s.av([],me,[ct[0],ct[1],ct[2]]);s.aw(ht,ht),s.c5(ht,ht,He);const St=s.d8([],me,ht);s.af(St,St,Ce);const Ut=s.eM/s.aD,rt=s.ag(St),Ue=s.cf(Math.max(rt*Ut-s.eM,Number.EPSILON),0),_t=Math.min(I.zoomFromMercatorZAdjusted(Ue),M.maxZoom);return _t>.5*(s.c_+s.cL)?(I.setProjection({name:"mercator"}),I.zoom=_t,this._cameraForBounds(I,d,g,b,T,E)):{center:I.center,zoom:_t,bearing:b,pitch:T}}_extendAABB(o,d,g,b){const T=.5*((g.padding.left||0)+(g.padding.right||0)),E=.5*((g.padding.top||0)+(g.padding.bottom||0)),I=E,M=T,N=T,j=E,Z=d.width-(M+N),W=d.height-(I+j),Y=s.av([],o.max,o.min),te=Math.min(Z/Y[0],W/Y[1]),J=Math.min(d.scaleZoom(d.scale*te),g.maxZoom);if(isNaN(J))return null;const oe=d.scale/d.zoomScale(J),ae=new s.d9([o.min[0]-M*oe,o.min[1]-j*oe,o.min[2]],[o.max[0]+N*oe,o.max[1]+I*oe,o.max[2]]),pe=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new s.P(g.offset.x,g.offset.y):s.P.convert(g.offset)).rotate(-s.an(b));return ae.center[0]-=pe.x*oe,ae.center[1]+=pe.y*oe,ae}queryTerrainElevation(o,d){const g=this.transform.elevation;return g?(d=Object.assign({},{exaggerated:!0},d),g.getAtPoint(s.ae.fromLngLat(o),null,d.exaggerated)):null}_cameraForBounds(o,d,g,b,T,E){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,d,g,b,T,E);const I=o.clone(),M=this._extendCameraOptions(E);I.bearing=b,I.pitch=T;const N=s.aT.convert(d),j=s.aT.convert(g),Z=new s.aT(N.lng,j.lat),W=new s.aT(j.lng,N.lat),Y=I.project(N),te=I.project(j),J=this.queryTerrainElevation(N),oe=this.queryTerrainElevation(j),ae=this.queryTerrainElevation(Z),pe=this.queryTerrainElevation(W),_e=[[Y.x,Y.y,Math.min(J||0,oe||0,ae||0,pe||0)],[te.x,te.y,Math.max(J||0,oe||0,ae||0,pe||0)]];let me=s.d9.fromPoints(_e);const Le=I.getWorldToCameraMatrix(),Ce=s.bl(new Float64Array(16),Le);me=s.d9.applyTransform(me,Le);const Re=this._extendAABB(me,I,M,b);if(!Re)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");me=Re;const Ae=.5*s.av([],me.max,me.min)[2],Te=this._minimumAABBFrustumDistance(I,me),Fe=[0,0,1,0];s.aC(Fe,Fe,Le),s.f1(Fe,Fe);const Xe=s.c5([],Fe,Te+Ae),He=s.d8([],me.center,Xe);s.af(me.center,me.center,Ce),s.af(He,He,Ce);const ct=I.unproject(new s.P(me.center[0],me.center[1])),ht=s.f2(I.projection,ct),St=Math.pow(2,ht),Ut=Math.min(I._zoomFromMercatorZ(He[2]*I.pixelsPerMeter*St/I.worldSize),M.maxZoom);return I.mercatorFromTransition&&Ut<.5*(s.c_+s.cL)?(I.setProjection({name:"globe"}),I.zoom=Ut,this._cameraForBounds(I,d,g,b,T,E)):{center:ct,zoom:Ut,bearing:b,pitch:T}}fitBounds(o,d,g){const b=this.cameraForBounds(o,d);return this._fitInternal(b,d,g)}fitScreenCoordinates(o,d,g,b,T){const E=s.P.convert(o),I=s.P.convert(d),M=new s.P(Math.min(E.x,I.x),Math.min(E.y,I.y)),N=new s.P(Math.max(E.x,I.x),Math.max(E.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,I))return this;const j=this.transform.pointLocation3D(M),Z=this.transform.pointLocation3D(N),W=this.transform.pointLocation3D(new s.P(M.x,N.y)),Y=this.transform.pointLocation3D(new s.P(N.x,M.y)),te=[Math.min(j.lng,Z.lng,W.lng,Y.lng),Math.min(j.lat,Z.lat,W.lat,Y.lat)],J=[Math.max(j.lng,Z.lng,W.lng,Y.lng),Math.max(j.lat,Z.lat,W.lat,Y.lat)],oe=b&&b.pitch?b.pitch:this.getPitch(),ae=this._cameraForBounds(this.transform,te,J,g,oe,b);return this._fitInternal(ae,b,T)}_fitInternal(o,d,g){return o?(d=Object.assign(o,d)).linear?this.easeTo(d,g):this.flyTo(d,g):this}jumpTo(o,d){this.stop();const g=o.preloadOnly?this.transform.clone():this.transform;let b=!1,T=!1,E=!1;"zoom"in o&&g.zoom!==+o.zoom&&(b=!0,g.zoom=+o.zoom),o.center!==void 0&&(g.center=s.aT.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(T=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(E=!0,g.pitch=+o.pitch);const I=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!g.isPaddingEqual(I))if(o.retainPadding===!1){const M=g.clone();M.padding=I,g.setLocationAtPoint(g.center,M.centerPoint)}else g.padding=I;return o.preloadOnly?(this._preloadTiles(g),this):(this.fire(new s.z("movestart",d)).fire(new s.z("move",d)),b&&this.fire(new s.z("zoomstart",d)).fire(new s.z("zoom",d)).fire(new s.z("zoomend",d)),T&&this.fire(new s.z("rotatestart",d)).fire(new s.z("rotate",d)).fire(new s.z("rotateend",d)),E&&this.fire(new s.z("pitchstart",d)).fire(new s.z("pitch",d)).fire(new s.z("pitchend",d)),this.fire(new s.z("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Yy),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,d){const g=this.transform;if(!g.projection.supportsFreeCamera)return s.w(Yy),this;this.stop();const b=g.zoom,T=g.pitch,E=g.bearing;g.setFreeCameraOptions(o);const I=b!==g.zoom,M=T!==g.pitch,N=E!==g.bearing;return this.fire(new s.z("movestart",d)).fire(new s.z("move",d)),I&&this.fire(new s.z("zoomstart",d)).fire(new s.z("zoom",d)).fire(new s.z("zoomend",d)),N&&this.fire(new s.z("rotatestart",d)).fire(new s.z("rotate",d)).fire(new s.z("rotateend",d)),M&&this.fire(new s.z("pitchstart",d)).fire(new s.z("pitch",d)).fire(new s.z("pitchend",d)),this.fire(new s.z("moveend",d)),this}easeTo(o,d){this._stop(!1,o.easeId),((o=Object.assign({offset:[0,0],duration:500,easing:s.eV},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const g=this.transform,b=this.getZoom(),T=this.getBearing(),E=this.getPitch(),I=this.getPadding(),M="zoom"in o?+o.zoom:b,N="bearing"in o?this._normalizeBearing(o.bearing,T):T,j="pitch"in o?+o.pitch:E,Z=this._extendPadding(o.padding),W=s.P.convert(o.offset);let Y,te,J;if(g.projection.name==="globe"){const Fe=s.ae.fromLngLat(g.center),Xe=W.rotate(-g.angle);Fe.x+=Xe.x/g.worldSize,Fe.y+=Xe.y/g.worldSize;const He=Fe.toLngLat(),ct=s.aT.convert(o.center||He);this._normalizeCenter(ct),Y=g.centerPoint.add(Xe),te=new s.P(Fe.x,Fe.y).mult(g.worldSize),J=new s.P(s.aF(ct.lng),s.aJ(ct.lat)).mult(g.worldSize).sub(te)}else{Y=g.centerPoint.add(W);const Fe=g.pointLocation(Y),Xe=s.aT.convert(o.center||Fe);this._normalizeCenter(Xe),te=g.project(Fe),J=g.project(Xe).sub(te)}const oe=g.zoomScale(M-b);let ae,pe;o.around&&(ae=s.aT.convert(o.around),pe=g.locationPoint(ae));const _e=this._zooming||M!==b,me=this._rotating||T!==N,Le=this._pitching||j!==E,Ce=!g.isPaddingEqual(Z),Re=o.retainPadding===!1?g.clone():g,Ae=Fe=>Xe=>{if(_e&&(Fe.zoom=s.ak(b,M,Xe)),me&&(Fe.bearing=s.ak(T,N,Xe)),Le&&(Fe.pitch=s.ak(E,j,Xe)),Ce&&(Re.interpolatePadding(I,Z,Xe),Y=Re.centerPoint.add(W)),ae)Fe.setLocationAtPoint(ae,pe);else{const He=Fe.zoomScale(Fe.zoom-b),ct=M>b?Math.min(2,oe):Math.max(.5,oe),ht=Math.pow(ct,1-Xe),St=Fe.unproject(te.add(J.mult(Xe*ht)).mult(He));Fe.setLocationAtPoint(Fe.renderWorldCopies?St.wrap():St,Y)}return o.preloadOnly||this._fireMoveEvents(d),Fe};if(o.preloadOnly){const Fe=this._emulate(Ae,o.duration,g);return this._preloadTiles(Fe),this}const Te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=_e,this._rotating=me,this._pitching=Le,this._padding=Ce,this._easeId=o.easeId,this._prepareEase(d,o.noMoveStart,Te),this._ease(Ae(g),Fe=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(d,Fe)},o),this}_prepareEase(o,d,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),d||g.moving||this.fire(new s.z("movestart",o)),this._zooming&&!g.zooming&&this.fire(new s.z("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new s.z("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new s.z("pitchstart",o))}_fireMoveEvents(o){this.fire(new s.z("move",o)),this._zooming&&this.fire(new s.z("zoom",o)),this._rotating&&this.fire(new s.z("rotate",o)),this._pitching&&this.fire(new s.z("pitch",o))}_afterEase(o,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,b=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new s.z("zoomend",o)),b&&this.fire(new s.z("rotateend",o)),T&&this.fire(new s.z("pitchend",o)),this.fire(new s.z("moveend",o))}flyTo(o,d){if(this._prefersReducedMotion(o)){const lt=s.aH(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(lt,d)}this.stop(),o=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:s.eV},o);const g=this.transform,b=this.getZoom(),T=this.getBearing(),E=this.getPitch(),I=this.getPadding(),M="zoom"in o?s.aA(+o.zoom,g.minZoom,g.maxZoom):b,N="bearing"in o?this._normalizeBearing(o.bearing,T):T,j="pitch"in o?+o.pitch:E,Z=this._extendPadding(o.padding),W=g.zoomScale(M-b),Y=s.P.convert(o.offset);let te=g.centerPoint.add(Y);const J=g.pointLocation(te),oe=s.aT.convert(o.center||J);this._normalizeCenter(oe);const ae=g.project(J),pe=g.project(oe).sub(ae);let _e=o.curve;const me=Math.max(g.width,g.height),Le=me/W,Ce=pe.mag();if("minZoom"in o){const lt=s.aA(Math.min(o.minZoom,b,M),g.minZoom,g.maxZoom),Ot=me/g.zoomScale(lt-b);_e=Math.sqrt(Ot/Ce*2)}const Re=_e*_e;function Ae(lt){const Ot=(Le*Le-me*me+(lt?-1:1)*Re*Re*Ce*Ce)/(2*(lt?Le:me)*Re*Ce);return Math.log(Math.sqrt(Ot*Ot+1)-Ot)}function Te(lt){return(Math.exp(lt)-Math.exp(-lt))/2}function Fe(lt){return(Math.exp(lt)+Math.exp(-lt))/2}const Xe=Ae(0);let He=function(lt){return Fe(Xe)/Fe(Xe+_e*lt)},ct=function(lt){return me*((Fe(Xe)*(Te(Ot=Xe+_e*lt)/Fe(Ot))-Te(Xe))/Re)/Ce;var Ot},ht=(Ae(1)-Xe)/_e;if(Math.abs(Ce)<1e-6||!isFinite(ht)){if(Math.abs(me-Le)<1e-6)return this.easeTo(o,d);const lt=Le<me?-1:1;ht=Math.abs(Math.log(Le/me))/_e,ct=function(){return 0},He=function(Ot){return Math.exp(lt*_e*Ot)}}o.duration="duration"in o?+o.duration:1e3*ht/("screenSpeed"in o?+o.screenSpeed/_e:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const St=T!==N,Ut=j!==E,rt=!g.isPaddingEqual(Z),Ue=o.retainPadding===!1?g.clone():g,_t=lt=>Ot=>{const en=Ot*ht,yn=1/He(en);lt.zoom=Ot===1?M:b+lt.scaleZoom(yn),St&&(lt.bearing=s.ak(T,N,Ot)),Ut&&(lt.pitch=s.ak(E,j,Ot)),rt&&(Ue.interpolatePadding(I,Z,Ot),te=Ue.centerPoint.add(Y));const Yt=Ot===1?oe:lt.unproject(ae.add(pe.mult(ct(en))).mult(yn));return lt.setLocationAtPoint(lt.renderWorldCopies?Yt.wrap():Yt,te),lt._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(d),lt};if(o.preloadOnly){const lt=this._emulate(_t,o.duration,g);return this._preloadTiles(lt),this}return this._zooming=!0,this._rotating=St,this._pitching=Ut,this._padding=rt,this._prepareEase(d,!1),this._ease(_t(g),()=>this._afterEase(d),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,d)}if(!o){const g=this.handlers;g&&g.stop(!1)}return this}_ease(o,d,g){g.animate===!1||g.duration===0?(o(1),d()):(this._easeStart=s.o.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((s.o.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,d){o=s.bT(o,-180,180);const g=Math.abs(o-d);return Math.abs(o-360-d)<g&&(o-=360),Math.abs(o+360-d)<g&&(o+=360),o}_normalizeCenter(o){const d=this.transform;if(d.maxBounds||d.projection.name!=="globe"&&!d.renderWorldCopies)return;const g=o.lng-d.center.lng;o.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&s.o.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,d,g){const b=Math.ceil(15*d/1e3),T=[],E=o(g.clone());for(let I=0;I<=b;I++){const M=E(I/b);T.push(M.clone())}return T}_preloadTiles(o,d){}}class og{constructor(o={}){this.options=o,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const d=this.options&&this.options.compact,g=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",g);const b=U("span","mapboxgl-ctrl-icon",this._compactButton);return b.setAttribute("aria-hidden","true"),b.setAttribute("title",g),this._innerContainer=U("div","mapboxgl-ctrl-attrib-inner",this._container),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(o){const g=d.reduce((b,T,E)=>(T.value&&(b+=`${T.key}=${T.value}${E<d.length-1?"&":""}`),b),"?");o.href=`${s.e.FEEDBACK_URL}/${g}#${Wa(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||(o.dataType!=="source"||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility")&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const d=this._map.style._mergedSourceCaches;for(const b in d){const T=d[b];if(T.used){const E=T.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o.sort((b,T)=>b.length-T.length),o=o.filter((b,T)=>{for(let E=T+1;E<o.length;E++)if(o[E].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const g=o.map(b=>function(T){const E=new DOMParser().parseFromString(T,"text/html");return Array.from(E.body.querySelectorAll("*")).forEach(I=>{const M=I.textContent||"";if(I.tagName!=="A")return void I.replaceWith(E.createTextNode(M));const N=I.getAttribute("href");if(!N||!/^(https?:|mailto:)/i.test(N))return void I.replaceWith(E.createTextNode(M));const j=E.createElement("a");j.href=N,j.textContent=M,j.rel="noopener nofollow";const Z=I.getAttribute("class");Z&&(j.className=Z),I.replaceWith(j)}),E.body.innerHTML}(b)).join(" | ");g!==this._attribHTML&&(this._attribHTML=g,o.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class lg{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=U("div","mapboxgl-ctrl");const d=U("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const d in o){const g=o[d].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const d=o[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class Zp{constructor(){s.aY(["_onIndoorUpdate"],this)}onAdd(o){return this._map=o,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",d=>this._onIndoorUpdate(d)),this._container}_createButton(o,d){const g=U("button",o,this._container);return g.type="button",g.addEventListener("click",d),g}_createSeparator(){return U("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(o,d){this._map&&(o.setAttribute("aria-label",d),o.textContent=d)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(o){if(!o||!o.floors)return this._model=o,void(this._container.style.display="none");const d=this._model;this._model=o,this._container.style.display="inline-block",this._container.style.borderRadius="8px",d&&Array.from(this._container.children).forEach(g=>g.remove()),o.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(o.floors,o.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const o=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const d=this._map;this._model&&d&&d._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});U("span","mapboxgl-ctrl-icon",o).setAttribute("aria-hidden","true"),o.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&o.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(o),this._createSeparator()}_updateBuildingsButtonState(){const o=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");o&&this._model&&(this._model.activeFloorsVisible?o.classList.remove("mapboxgl-ctrl-level-button-selected"):o.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(o,d){for(let g=0;g<o.length;g++){const b=o[g],T=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(b.id)});this._setButtonTitle(T,b.zIndex.toString()),this._model&&b.id===this._model.selectedFloorId&&d&&T.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(T),g<o.length-1&&this._createSeparator()}}}class Md{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const d=++this._id;return this._queue.push({callback:o,id:d,cancelled:!1}),d}remove(o){const d=this._currentlyRunning,g=d?this._queue.concat(d):this._queue;for(const b of g)if(b.id===o)return void(b.cancelled=!0)}run(o=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const g of d)if(!g.cancelled&&(g.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Pd{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const d=s.dD((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,d,g){this._start=this.getValue(d),this._end=o,this._startTime=d,this._endTime=d+g}}const Od={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Mh extends s.z{constructor(o,d,g,b){const{point:T,lngLat:E,originalEvent:I,target:M}=o;super(o.type,{point:T,lngLat:E,originalEvent:I,target:M}),this.preventDefault=()=>{o.preventDefault()},this.id=d,this.interaction=g,this.feature=b}}class pc{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,d){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);const g=d.filter;let b=d.type;g&&this.filters.set(o,s.b6(g)),b==="mouseover"&&(b="mouseenter"),b==="mouseout"&&(b="mouseleave");const T=this.interactionsByType.get(b)||new Map;b==="mouseenter"||b==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,d)):T.size===0&&this.map.on(b,this.handleType),T.size===0&&this.interactionsByType.set(b,T),T.set(o,d),this.typeById.set(o,b)}get(o){const d=this.typeById.get(o);if(!d)return;const g=this.interactionsByType.get(d);return g?g.get(o):void 0}remove(o){const d=this.typeById.get(o);if(!d)return;this.typeById.delete(o),this.filters.delete(o);const g=this.interactionsByType.get(d);g&&(g.delete(o),d==="mouseenter"||d==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):g.size===0&&this.map.off(d,this.handleType))}queryTargets(o,d){const g=[];for(const[b,T]of d)T.target&&g.push({targetId:b,target:T.target,filter:this.filters.get(b)});return this.map.style.queryRenderedTargets(o,g,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const d=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());d.length&&(o.type="mouseenter",this.handleType(o,d));const g=new Map;for(const[b,{feature:T}]of this.prevHoveredFeatures)this.hoveredFeatures.has(b)||g.set(T.id,T);g.size&&(o.type="mouseleave",this.handleType(o,Array.from(g.values())))}handleOut(o){const d=Array.from(this.hoveredFeatures.values()).map(({feature:g})=>g);d.length&&(o.type="mouseleave",this.handleType(o,d)),this.hoveredFeatures.clear()}handleType(o,d){const g=o.type==="mouseenter";if(g&&!this.interactionsByType.has(o.type))return void s.w("mouseenter interaction required for mouseleave to work.");const b=Array.from(this.interactionsByType.get(o.type)).reverse(),T=!!d;d=d||this.queryTargets(o.point,b);let E=!1;const I=new Set;for(const M of d){for(const[N,j]of b){if(!j.target)continue;const Z=M.variants?M.variants[N]:null;if(Z){for(const W of Z){if(Ap(W,M,I,N))continue;const Y=new s.dx(M,W),te=yf(W,M,N);T&&Y.id!==void 0&&(Y.state=this.map.getFeatureState(Y));const J=g?this.prevHoveredFeatures.get(te):null,oe=new Mh(o,N,j,Y),ae=J?J.stop:j.handler(oe);if(g&&this.hoveredFeatures.set(te,{feature:M,stop:ae}),ae!==!1){E=!0;break}}if(E)break}}if(E)break}if(!E)for(const[M,N]of b){const{handler:j,target:Z}=N;if(!Z&&j(new Mh(o,M,N,null))!==!1)break}}}function oI(m,o){if(Array.isArray(m)&&Array.isArray(o)){const d=new Set(m),g=new Set(o);return d.size===g.size&&m.every(b=>g.has(b))}return s.by(m,o)}const lI={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},uI={showCompass:!0,showZoom:!0,visualizePitch:!1};class cI{constructor(o,d,g=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new xb({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,g&&(this.mousePitch=new bb({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(o,d){this.mouseRotate.mousedown(o,d),this.mousePitch&&this.mousePitch.mousedown(o,d),ie()}move(o,d){const g=this.map,b=this.mouseRotate.mousemoveWindow(o,d),T=b&&b.bearingDelta;if(T&&g.setBearing(g.getBearing()+T),this.mousePitch){const E=this.mousePitch.mousemoveWindow(o,d),I=E&&E.pitchDelta;I&&g.setPitch(g.getPitch()+I)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){de(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(Object.assign({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),ve(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,ve(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Qe(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=Qe(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Sb(m,o,d){if(m=new s.aT(m.lng,m.lat),o){const g=new s.aT(m.lng-360,m.lat),b=new s.aT(m.lng+360,m.lat),T=360*Math.ceil(Math.abs(m.lng-d.center.lng)/360),E=d.locationPoint3D(m).distSqr(o),I=o.x<0||o.y<0||o.x>d.width||o.y>d.height;d.locationPoint3D(g).distSqr(o)<E&&(I||Math.abs(g.lng-d.center.lng)<T)?m=g:d.locationPoint3D(b).distSqr(o)<E&&(I||Math.abs(b.lng-d.center.lng)<T)&&(m=b)}for(;Math.abs(m.lng-d.center.lng)>180;){const g=d.locationPoint3D(m);if(g.x>=0&&g.y>=0&&g.x<=d.width&&g.y<=d.height)break;m.lng>d.center.lng?m.lng-=360:m.lng+=360}return m}const Yo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},zu={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Ky extends s.E{constructor(o,d){super(),(o instanceof HTMLElement||d)&&(o=Object.assign({element:o},d)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:g="center",color:b="#3FB1CE",scale:T=1,draggable:E=!1,clickTolerance:I=0,rotation:M=zu.rotation,rotationAlignment:N=zu.rotationAlignment,pitchAlignment:j=zu.pitchAlignment,occludedOpacity:Z=zu.occludedOpacity,altitude:W=zu.altitude}=o||{};this._anchor=g,this._color=b,this._scale=T,this._draggable=E,this._clickTolerance=I,this._rotation=M,this._rotationAlignment=N,this._pitchAlignment=j,this._occludedOpacity=Z,this._altitude=W,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=s.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",J=>{J.preventDefault()}),this._element.addEventListener("mousedown",J=>{J.preventDefault()});const Y=this._element.classList;for(const J in Yo)Y.remove(`mapboxgl-marker-anchor-${J}`);Y.add(`mapboxgl-marker-anchor-${this._anchor}`);const te=o&&o.className?o.className.trim().split(/\s+/):[];Y.add(...te),this._popup=null}_createDefaultMarker(){const o=U("div"),d=q("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){const g=q("radialGradient",{id:"shadowGradient"},q("defs",{},d));q("stop",{offset:"10%","stop-opacity":.4},g),q("stop",{offset:"100%","stop-opacity":.05},g),q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},d)}return q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},d),q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},d),q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},d),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=s.aT.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||zu.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const d=o.code,g=o.charCode||o.keyCode;d!=="Space"&&d!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(o){const d=o.originalEvent.target,g=this._element;this._popup&&(d===g||g.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,d=this._pos;if(!o||!d)return!1;const g=o.unproject(d,this._altitude),b=o.getFreeCameraOptions();if(!b.position)return!1;const T=b.position.toLngLat();return T.distanceTo(g)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const d=this._pos;if(!d||d.x<0||d.x>o.transform.width||d.y<0||d.y>o.transform.height)return void this._clearFadeTimer();const g=o.unproject(d,this._altitude);let b;o._showingGlobe()&&s.f5(o.transform,this._lngLat)?b=0:(b=1-o._queryFogOpacity(g),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${Yo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){const o=this._pos,d=this._map,g=this.getPitchAlignment();if(!d||!o||g!=="map")return"";if(!d._showingGlobe()){const M=d.getPitch();return M?`rotateX(${M}deg)`:""}const b=s.cX(s.f6(d.transform,this._lngLat)),T=o.sub(s.f7(d.transform)),E=Math.abs(T.x)+Math.abs(T.y);if(E===0)return"";const I=b/E;return`rotateX(${-T.y*I}deg) rotateY(${T.x*I}deg)`}_calculateZTransform(){const o=this._pos,d=this._map;if(!d||!o)return"";let g=0;const b=this.getRotationAlignment();if(b==="map")if(d._showingGlobe()){const T=d.project(new s.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),E=d.project(new s.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(T);g=s.cX(Math.atan2(E.y,E.x))-90}else g=-d.getBearing();else if(b==="horizon"){const T=s.ah(4,6,d.getZoom()),E=s.f7(d.transform);E.y+=T*d.transform.height;const I=o.sub(E),M=s.cX(Math.atan2(I.y,I.x));g=(M>90?M-270:M+90)*(1-T)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Sb(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=s.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){const d=this._map;if(!d)return;const g=this._pointerdownPos,b=this._positionDelta;if(g&&b){if(!this._isDragging){const T=this._clickTolerance||d._clickTolerance;if(o.point.dist(g)<T)return;this._isDragging=!0}this._pos=o.point.sub(b),this._lngLat=d.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(o){const d=this._map,g=this._pos;d&&g&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(g),this._pointerdownPos=o.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const d=this._map;return d&&(o?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||zu.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||zu.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||zu.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||zu.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const dI={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Xp={maxWidth:100,unit:"metric"},Ab={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Fu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Bu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function zf(m=new s.P(0,0),o="bottom"){if(typeof m=="number"){const d=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(o){case"top":return new s.P(0,m);case"top-left":return new s.P(d,d);case"top-right":return new s.P(-d,d);case"bottom":return new s.P(0,-m);case"bottom-left":return new s.P(d,-d);case"bottom-right":return new s.P(-d,-d);case"left":return new s.P(m,0);case"right":return new s.P(-m,0)}return new s.P(0,0)}return m instanceof s.P||Array.isArray(m)?s.P.convert(m):s.P.convert(m[o]||[0,0])}return{version:v,supported:F.supported,setRTLTextPlugin:s.fb,getRTLTextPluginStatus:s.fa,Map:class extends Eb{constructor(m){A.mark(x.create);const o=m;if((m=Object.assign({},lI,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&s.f3(window)&&(m.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ix(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Md,this._domRenderTaskQueue=new Md,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.b2(),this._locale=Object.assign({},Od,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Pd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new Mt(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},typeof m.container=="string"){const d=document.getElementById(m.container);if(!d)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=d}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new aI(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||s.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),m.hash&&(this._hash=new hb(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const d=m.bounds;d&&(this.resize(),this.fitBounds(d,Object.assign({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new og({customAttribution:m.customAttribution})),this._logoControl=new lg,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new s.z(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new s.z(`${d.dataType}dataloading`,d))}),this._interactions=new pc(this)}_getMapId(){return this._mapId}addControl(m,o){if(o===void 0&&(o=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[o];return o.indexOf("bottom")!==-1?g.insertBefore(d,g.firstChild):g.appendChild(d),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(m);return o>-1&&this._controls.splice(o,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new s.z("movestart",m)).fire(new s.z("move",m)),this.fire(new s.z("resize",m)),o&&this.fire(new s.z("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(s.aI.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(o=>o==="auto"?navigator.language:o):m}setLanguage(m){const o=this._parseLanguage(m);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,o=m.projection.name;let d;o==="globe"&&m.zoom>=s.cL?(m.setMercatorFromTransition(),d=!0):o==="mercator"&&m.zoom<s.cL&&(m.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(m,o){return this._updateProjection(m||o||{name:"mercator"})}_updateProjection(m){let o;const d=this.transform.mercatorFromTransition;o=m.name==="globe"&&this.transform.zoom>=s.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate();const g=this.transform.getProjection().name==="mercator"&&d!==this.transform.mercatorFromTransition;return(o||g)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,o){return this.transform.locationPoint3D(s.aT.convert(m),o)}unproject(m,o){return this.transform.pointLocation3D(s.P.convert(m),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,o,d){const g=b=>{let T=[];if(Array.isArray(o)){const E=o.filter(I=>this.getLayer(I));T=E.length?this.queryRenderedFeatures(b,{layers:E}):[]}else T=this.queryRenderedFeatures(b,{target:o});return T};if(m==="mouseenter"||m==="mouseover"){let b=!1;return{listener:d,targets:o,delegates:{mousemove:E=>{const I=g(E.point);I.length?b||(b=!0,d.call(this,new Il(m,this,E.originalEvent,{features:I}))):b=!1},mouseout:()=>{b=!1}}}}if(m==="mouseleave"||m==="mouseout"){let b=!1;return{listener:d,targets:o,delegates:{mousemove:I=>{g(I.point).length?b=!0:b&&(b=!1,d.call(this,new Il(m,this,I.originalEvent)))},mouseout:I=>{b&&(b=!1,d.call(this,new Il(m,this,I.originalEvent)))}}}}{const b=T=>{const E=g(T.point);E.length&&(T.features=E,d.call(this,T),delete T.features)};return{listener:d,targets:o,delegates:{[m]:b}}}}on(m,o,d){if(typeof o=="function"||d===void 0)return super.on(m,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const g=this._createDelegatedListener(m,o,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const b in g.delegates)this.on(b,g.delegates[b]);return this}once(m,o,d){if(typeof o=="function"||d===void 0)return super.once(m,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const g=this._createDelegatedListener(m,o,d);for(const b in g.delegates)this.once(b,g.delegates[b]);return this}off(m,o,d){if(typeof o=="function"||d===void 0)return super.off(m,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const g=this._delegatedListeners?this._delegatedListeners[m]:void 0;return g&&(b=>{for(let T=0;T<b.length;T++){const E=b[T];if(E.listener===d&&oI(E.targets,o)){for(const I in E.delegates)this.off(I,E.delegates[I]);return b.splice(T,1),this}}})(g),this}queryRenderedFeatures(m,o){if(!this.style)return[];if(m===void 0||m instanceof s.P||Array.isArray(m)||o!==void 0||(o=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!o){const T=this.style.queryRenderedFeatures(m,void 0,this.transform),E=this.style.queryRenderedFeatureset(m,void 0,this.transform);return T.concat(E)}let d=!0;if(o.target&&(d=this._isTargetValid(o.target),d&&!o.layers))return this.style.queryRenderedFeatureset(m,o,this.transform);let g=!0;if(o.layers&&Array.isArray(o.layers)){for(const T of o.layers)if(!this._isValidId(T)){g=!1;break}if(g&&!o.target)return this.style.queryRenderedFeatures(m,o,this.transform)}let b=[];return g&&(b=b.concat(this.style.queryRenderedFeatures(m,o,this.transform))),d&&(b=b.concat(this.style.queryRenderedFeatureset(m,o,this.transform))),b}querySourceFeatures(m,o){return!m||typeof m=="string"&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,o)}queryRasterValue(m,o,d){return this._isValidId(m)?this.style.queryRasterValue(m,o,d):Promise.resolve(null)}isPointOnSurface(m){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&s.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(m))}addInteraction(m,o){return this._interactions.add(m,o),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,o){return o=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&m&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(m,(d,g)=>{if(d){const b=typeof d=="string"?d:d instanceof Error?d.message:d.error;s.w(`Unable to perform style diff: ${b}. Rebuilding the style from scratch.`),this._updateStyle(m,o)}else g&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(m,o))}_getUIString(m){const o=this._locale[m];if(o==null)throw new Error(`Missing UI string '${m}'`);return o}_updateStyle(m,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const d=Object.assign({},o);o&&o.config&&(d.initialConfig=o.config,delete d.config),this.style=new Nu(this,d).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Nu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.dr(m)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const o of m)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(m)}addSource(m,o){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,o),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,o,d){this._lazyInitEmptyStyle(),this.style.addSourceType(m,o,d)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,o,{pixelRatio:d=1,sdf:g=!1,stretchX:b,stretchY:T,content:E}={}){this._lazyInitEmptyStyle();const I=s.I.from(m);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){const{width:M,height:N,data:j}=s.o.getImageData(o);this.style.addImage(I,{data:new s.q({width:M,height:N},j),pixelRatio:d,stretchX:b,stretchY:T,content:E,sdf:g,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:N}=o,j=o;this.style.addImage(I,{data:new s.q({width:M,height:N},new Uint8Array(j.data)),pixelRatio:d,stretchX:b,stretchY:T,content:E,sdf:g,usvg:!1,version:0,userImage:j}),j.onAdd&&j.onAdd(this,m)}}updateImage(m,o){this._lazyInitEmptyStyle();const d=s.I.from(m),g=this.style.getImage(d);if(!g)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const b=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?s.o.getImageData(o):o,{width:T,height:E,data:I}=b;if(T===void 0||E===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(T!==(g.usvg?g.icon.usvg_tree.width:g.data.width)||E!==(g.usvg?g.icon.usvg_tree.height:g.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${T}, ${E})
                must be that same as the previous version of the image
                (${g.data.width}, ${g.data.height})`)));const M=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);let N=!1;g.usvg?(g.data=new s.q({width:T,height:E},new Uint8Array(I)),g.usvg=!1,g.icon=void 0,N=!0):g.data.replace(I,M),this.style.updateImage(d,g,N)}hasImage(m){return m?!!this.style&&!!this.style.getImage(s.I.from(m)):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(s.I.from(m))}loadImage(m,o){s.n(this._requestManager.transformRequest(m,s.R.Image),(d,g)=>{o(d,g instanceof HTMLImageElement?s.o.getImageData(g):g)})}listImages(){return this.style.listImages().map(m=>m.name)}addModel(m,o){this._lazyInitEmptyStyle(),this.style.addModel(m,o)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,o){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,o),this._update(!0)):this}getSlot(m){const o=this.getLayer(m);return o&&o.slot||null}setSlot(m,o){return this.style.setSlot(m,o),this.style.mergeLayers(),this._update(!0)}addImport(m,o){return this.style.addImport(m,o).catch(d=>this.fire(new s.y(new Error("Failed to add import",d)))),this}updateImport(m,o){return typeof o!="string"&&o.id!==m?(this.removeImport(m),this.addImport(o)):(this.style.updateImport(m,o),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,o){return this.style.moveImport(m,o),this._update(!0)}moveLayer(m,o){return this._isValidId(m)?(this.style.moveLayer(m,o),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const o=this.style.getOwnLayer(m);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,o,d){return this._isValidId(m)?(this.style.setLayerZoomRange(m,o,d),this._update(!0)):this}setFilter(m,o,d={}){return this._isValidId(m)?(this.style.setFilter(m,o,d),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,o,d,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,o,d,g),this._update(!0)):this}getPaintProperty(m,o){return this._isValidId(m)?this.style.getPaintProperty(m,o):null}setLayoutProperty(m,o,d,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,o,d,g),this._update(!0)):this}getLayoutProperty(m,o){return this._isValidId(m)?this.style.getLayoutProperty(m,o):null}setLayerProperty(m,o,d,g={}){return this._isValidId(m)?(o==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(m,o,d,g),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,o){return this.style.setSchema(m,o),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,o){return this.style.setConfig(m,o),this._update(!0)}getConfigProperty(m,o){return this.style.getConfigProperty(m,o)}setConfigProperty(m,o,d){return this.style.setConfigProperty(m,o,d),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const o=m[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,o),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.aT.convert(m),this.transform):0}setFeatureState(m,o){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,o),this._update())}removeFeatureState(m,o){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,o),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_selectIndoorFloor(m){this.indoor.selectFloor(m)}_setIndoorActiveFloorsVisibility(m){this.indoor.setActiveFloorsVisibility(m)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Zp),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let d,g,b,T=this._container;for(;T&&(!g||!b);){const E=window.getComputedStyle(T).transform;E&&E!=="none"&&(d=E.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(g=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(b=d[3])),T=T.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=b?Math.abs(o/b):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new lE(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=U("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=U("div","mapboxgl-canvas-container",m);this._canvas=U("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=U("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(b=>{g[b]=U("div",`mapboxgl-ctrl-${b}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,o){const d=s.o.devicePixelRatio||1;this._canvas.width=d*Math.ceil(m),this._canvas.height=d*Math.ceil(o),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${o}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const o=this._markers.indexOf(m);o!==-1&&this._markers.splice(o,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const o=this._popups.indexOf(m);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const m=Object.assign({},F.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",m);o?(tr(o,!0),this.painter=new zy(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",d=>{d.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.k.testSupport(o)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let o;this.fire(new s.z("renderstart")),++this._frameId;const d=this.painter.context.extTimerQuery,g=s.o.now(),b=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=b.createQuery(),b.beginQuery(d.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const N=this.transform.zoom,j=this.transform.pitch,Z=s.o.now(),W=new s.ac(N,{now:Z,fadeDuration:T,pitch:j,transition:this.style.transition,worldview:this._worldview});this.style.update(W)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(g),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(g);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,A.mark(x.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const N=s.o.now()-g;b.endQuery(d.TIME_ELAPSED_EXT),setTimeout(()=>{const j=b.getQueryParameter(o,b.QUERY_RESULT)/1e6;b.deleteQuery(o),this.fire(new s.z("gpu-timing-frame",{cpuTime:N,gpuTime:j}))},50)}if(this.listens("gpu-timing-layer")){const N=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(N);this.fire(new s.z("gpu-timing-layer",{layerTimes:j}))},50)}if(this.listens("gpu-timing-deferred-render")){const N=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const j=this.painter.queryGpuTimeDeferredRender(N);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:j}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(M||this._repaint)this.triggerRepaint();else{const N=this.idle();if(N&&(E=this._updateAverageElevation(g,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),N&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,A.mark(x.fullLoad),this._performanceMetricsCollection&&nn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const o of this._markers)m&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!m||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(m,o=!1){const d=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);const g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(o||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const b=this.transform.averageElevation;let T=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(T)?T=0:this._averageElevationLastSampledAt=m;const E=Math.abs(b-T);if(E>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(T),d(T);this._averageElevation.easeTo(T,m,300)}else if(E>1e-4)return this._averageElevation.jumpTo(T),d(T)}return!!this._averageElevation.isEasing(m)&&d(this._averageElevation.getValue(m))}_authenticate(){Xr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===ft||m.status===401)){const o=this.painter.context.gl;tr(o,!1),this._logoControl instanceof lg&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Cn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Nn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Vt(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){Sn(this._requestManager._customAccessToken)}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const d=this.painter.context.gl,g=d.createFramebuffer();function b(T){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,T,0);const E=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,E),E}return d.bindFramebuffer(d.FRAMEBUFFER,g),this._canvasPixelComparison(b(m),o.canvasCopies.map(b),o.timeStamps)}_canvasPixelComparison(m,o,d){let g=d[1]-d[0];const b=m.length/4;for(let T=0;T<o.length;T++){const E=o[T];let I=0;for(let M=0;M<E.length;M+=4)E[M]===m[M]&&E[M+1]===m[M+1]&&E[M+2]===m[M+2]&&E[M+3]===m[M+3]&&(I+=1);g+=(d[T+2]-d[T+1])*(1-I/b)}return g}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),ar.delete(this.painter.context.gl),wr.remove(),$t.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=s.o.frame(o=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(o)}))}_preloadTiles(m){const o=this.style?this.style.getSourceCaches():[];return s.bw(o,(d,g)=>d._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this.style&&m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,o){s.f4(m,o)}get version(){return v}},NavigationControl:class{constructor(m={}){this.options=Object.assign({},uI,m),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),U("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),U("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:o}):d.resetNorth({},{originalEvent:o}))}),this._compassIcon=U("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const o=m.getZoom(),d=o===m.getMaxZoom(),g=o===m.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new cI(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,o){const d=U("button",m,this._container);return d.type="button",d.addEventListener("click",o),d}_setButtonTitle(m,o){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${o}`);m.setAttribute("aria-label",d),m.firstElementChild&&m.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends s.E{constructor(m={}){super();const o=navigator.geolocation;this.options=Object.assign({geolocation:o},dI,m),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Fy(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const o=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,m(d)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(d=>o(d.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(m){const o=this._map.getMaxBounds(),d=m.coords;return!!o&&(d.longitude<o.getWest()||d.longitude>o.getEast()||d.latitude<o.getSouth()||d.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",Object.assign({coords:m.coords,timestamp:m.timestamp},m.toJSON?{toJSON:m.toJSON.bind(m)}:{}))),this._finish()}}_updateCamera(m){const o=new s.aT(m.coords.longitude,m.coords.latitude),d=m.coords.accuracy,g=this._map.getBearing(),b=Object.assign({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(d),b,{geolocateSource:!0})}_updateMarker(m){if(m){const o=new s.aT(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,o=s.cf(1,m._center.lat)*m.worldSize,d=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=U("button","mapboxgl-ctrl-geolocate",this._container),U("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U("div","mapboxgl-user-location"),this._dotElement.appendChild(U("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(U("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ky({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=U("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ky({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:og,ScaleControl:class{constructor(m={}){this.options=Object.assign({},Xp,m),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,o=this._map,d=o._containerHeight/2,g=o._containerWidth/2-m/2,b=o.unproject([g,d]),T=o.unproject([g+m,d]),E=b.distanceTo(T);if(this.options.unit==="imperial"){const I=3.2808*E;I>5280?this._setScale(m,I/5280,"mile"):this._setScale(m,I,"foot")}else this.options.unit==="nautical"?this._setScale(m,E/1852,"nautical-mile"):E>=1e3?this._setScale(m,E/1e3,"kilometer"):this._setScale(m,E,"meter")}_setScale(m,o,d){this._map._requestDomTask(()=>{const g=function(T){const E=Math.pow(10,`${Math.floor(T)}`.length-1);let I=T/E;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(M){const N=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*N)/N}(I),E*I}(o),b=g/o;this._container.innerHTML=d!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(g):`${g}&nbsp;${Ab[d]}`,this._container.style.width=m*b+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=U("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Zp,Popup:class extends s.E{constructor(m){super(),this.options=Object.assign(Object.create(Fu),m),this._altitude=this.options.altitude,s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=s.aT.convert(m),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const o=document.createDocumentFragment(),d=document.createElement("body");let g;for(d.innerHTML=m;g=d.firstChild,g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=U("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(m),this.options.closeButton){const d=this._closeButton=U("button","mapboxgl-popup-close-button",o);d.type="button",d.setAttribute("aria-label","Close popup"),d.innerHTML='<span aria-hidden="true">&#215;</span>',d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let o;return this._classList.delete(m)?o=!1:(this._classList.add(m),o=!0),this._updateClassList(),o}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const o=this._map,d=this._container,g=this._pos;if(!o||!d||!g)return"bottom";const b=d.offsetWidth,T=d.offsetHeight,E=g.x<b/2,I=g.x>o.transform.width-b/2;if(g.y+m<T)return E?"top-left":I?"top-right":"top";if(g.y>o.transform.height-T){if(E)return"bottom-left";if(I)return"bottom-right"}return E?"left":I?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),m.className=o.join(" ")}_update(m){const o=this._map,d=this._content;if(!o||!this._lngLat&&!this._trackPointer||!d)return;let g=this._container;if(g||(g=this._container=U("div","mapboxgl-popup",o.getContainer()),this._tip=U("div","mapboxgl-popup-tip",g),g.appendChild(d)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Sb(this._lngLat,this._pos,o.transform)),!this._trackPointer||m){const b=this._pos=this._trackPointer&&m instanceof s.P?m:o.project(this._lngLat,this._altitude),T=zf(this.options.offset),E=this._anchor=this._getAnchor(T.y),I=zf(this.options.offset,E),M=b.add(I).round();o._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${Yo[E]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&o._showingGlobe()){const b=s.f5(o.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Bu);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Ky,Style:Nu,LngLat:s.aT,LngLatBounds:s.aI,Point:s.P,MercatorCoordinate:s.ae,FreeCameraOptions:gl,Evented:s.E,config:s.e,prewarm:s.f9,clearPrewarmedResources:s.f8,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(m){s.e.ACCESS_TOKEN=m},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(m){s.e.API_URL=m},get workerCount(){return s.fi.workerCount},set workerCount(m){s.fi.workerCount=m},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){s.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){s.fh(m)},get workerUrl(){return s.fg.workerUrl},set workerUrl(m){s.fg.workerUrl=m},get workerClass(){return s.fg.workerClass},set workerClass(m){s.fg.workerClass=m},get workerParams(){return s.fg.workerParams},set workerParams(m){s.fg.workerParams=m},get dracoUrl(){return s.ff()},set dracoUrl(m){s.fe(m)},get meshoptUrl(){return s.fd()},set meshoptUrl(m){s.fc(m)},setNow:s.o.setNow,restoreNow:s.o.restoreNow}});var f=a;return f})})(Zne);var VLe=Zne.exports;const gm=fT(VLe);function $Le({onSelect:e,placeholder:t="Cerca indirizzo...",style:n}){const[r,a]=B.useState(""),[u,f]=B.useState([]),[s,v]=B.useState(!1),[x,A]=B.useState(!1),[C,P]=B.useState(-1),L=B.useRef(null),F=B.useRef(null),U=B.useRef(null);B.useEffect(()=>{if(U.current&&clearTimeout(U.current),r.length<3){f([]),A(!1);return}return U.current=setTimeout(async()=>{v(!0);try{const $=await Xn.geocodeSearch(r,5);f($.results||[]),A(!0),P(-1)}catch($){console.error("Errore geocoding:",$),f([])}finally{v(!1)}},300),()=>{U.current&&clearTimeout(U.current)}},[r]),B.useEffect(()=>{function $(X){F.current&&!F.current.contains(X.target)&&A(!1)}return document.addEventListener("mousedown",$),()=>document.removeEventListener("mousedown",$)},[]);const q=$=>{if(!(!x||u.length===0))switch($.key){case"ArrowDown":$.preventDefault(),P(X=>X<u.length-1?X+1:X);break;case"ArrowUp":$.preventDefault(),P(X=>X>0?X-1:-1);break;case"Enter":$.preventDefault(),C>=0&&u[C]&&G(u[C]);break;case"Escape":A(!1);break}},G=$=>{a($.formatted.split(",")[0]),A(!1),e($)};return k.jsxs("div",{ref:F,style:{position:"relative",...n},children:[k.jsxs("div",{style:{position:"relative"},children:[k.jsx("input",{ref:L,type:"text",value:r,onChange:$=>a($.target.value),onKeyDown:q,onFocus:()=>r.length>=3&&u.length>0&&A(!0),placeholder:t,style:{width:"100%",padding:"10px 36px 10px 12px",borderRadius:"8px",border:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"14px",outline:"none"}}),k.jsx("div",{style:{position:"absolute",right:"10px",top:"50%",transform:"translateY(-50%)",color:"var(--text-secondary)",fontSize:"16px"},children:s?k.jsx("span",{style:{animation:"spin 1s linear infinite"},children:"..."}):k.jsx("span",{children:""})})]}),x&&u.length>0&&k.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"8px",marginTop:"4px",maxHeight:"300px",overflowY:"auto",zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},children:u.map(($,X)=>k.jsxs("div",{onClick:()=>G($),onMouseEnter:()=>P(X),style:{padding:"10px 12px",cursor:"pointer",backgroundColor:X===C?"var(--bg-hover)":"transparent",borderBottom:X<u.length-1?"1px solid var(--border)":"none"},children:[k.jsx("div",{style:{fontSize:"14px",color:"var(--text-primary)",marginBottom:"2px"},children:$.formatted.split(",")[0]}),k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:$.formatted.split(",").slice(1).join(",")})]},X))}),x&&u.length===0&&r.length>=3&&!s&&k.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border)",borderRadius:"8px",marginTop:"4px",padding:"12px",textAlign:"center",color:"var(--text-secondary)",fontSize:"14px",zIndex:1e3},children:"Nessun risultato trovato"})]})}gm.accessToken="pk.eyJ1IjoiZ2VuYWdlbnRhIiwiYSI6ImNtamR6a3UwazBjNHEzZnF4aWxhYzlqMmUifQ.0RcP-1pxFW7rHYvVoJQG5g";const qH="#64748b",WH={commerciale:"#3b82f6",fornisce:"#f97316",influencer:"#eab308",prescrittore:"#a855f7",tecnico:"#6b7280",partner:"#22c55e",collabora:"#14b8a6"},HLe=[{id:"light-v11",nome:"Chiaro",icon:""},{id:"dark-v11",nome:"Scuro",icon:""},{id:"streets-v12",nome:"Strade",icon:""},{id:"outdoors-v12",nome:"Outdoor",icon:""},{id:"satellite-streets-v12",nome:"Satellite",icon:""}];function GLe(e,t,n,r=24){const a=[];for(let f=0;f<=r;f++){const s=f/r*2*Math.PI,v=n*Math.cos(s),A=n*Math.sin(s)/6371e3*(180/Math.PI),C=v/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);a.push([e+C,t+A])}return a}function SR(e,t,n,r,a=15,u=50,f=0,s=0){const v=[],x=[],C=n-e,P=r-t,L=-C,F=P,U=Math.sqrt(L*L+F*F);let q=0,G=0;U>0&&s!==0&&(q=L/U*(s/6371e3)*(180/Math.PI),G=F/U*(s/(6371e3*Math.cos((t+r)/2*Math.PI/180)))*(180/Math.PI));for(let $=0;$<=a;$++){const X=$/a,ie=e+(n-e)*X+G,de=t+(r-t)*X+q;v.push([ie,de]);const fe=f+4*u*X*(1-X);x.push(fe)}return{coordinates:v,elevation:x}}function qLe(e,t,n,r,a=15,u=30){const s=n-e,v=r-t,x=v*(Math.PI/180)*6371e3,A=s*(Math.PI/180)*6371e3*Math.cos((t+r)/2*Math.PI/180),C=Math.sqrt(x*x+A*A),L=Math.min(u,C*.2)/C,F=e+s*L,U=t+v*L,q=n-s*L,G=r-v*L,$=-s,X=v,ie=Math.sqrt($*$+X*X);if(ie===0)return[];const de=a/2,fe=$/ie*(de/6371e3)*(180/Math.PI),be=X/ie*(de/(6371e3*Math.cos((t+r)/2*Math.PI/180)))*(180/Math.PI);return[[F-be,U-fe],[q-be,G-fe],[q+be,G+fe],[F+be,U+fe],[F-be,U-fe]]}function WLe(e,t,n){const a=n/2,u=a/6371e3*(180/Math.PI),f=a/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);return[[e-f,t-u],[e+f,t-u],[e+f,t+u],[e-f,t+u],[e-f,t-u]]}function ZLe(e,t,n){const a=n/2,u=[];for(let f=0;f<3;f++){const s=f/3*2*Math.PI-Math.PI/2,v=a*Math.cos(s),A=a*Math.sin(s)/6371e3*(180/Math.PI),C=v/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);u.push([e+C,t+A])}return u.push(u[0]),u}function XLe(e,t,n){const a=n/2,u=a*.4,f=[];for(let s=0;s<10;s++){const v=s/10*2*Math.PI-Math.PI/2,x=s%2===0?a:u,A=x*Math.cos(v),P=x*Math.sin(v)/6371e3*(180/Math.PI),L=A/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);f.push([e+L,t+P])}return f.push(f[0]),f}function YLe(e,t,n){const a=n/2,u=a*.3,f=(s,v)=>{const x=v/6371e3*(180/Math.PI),A=s/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);return[e+A,t+x]};return[f(-u,a),f(u,a),f(u,u),f(a,u),f(a,-u),f(u,-u),f(u,-a),f(-u,-a),f(-u,-u),f(-a,-u),f(-a,u),f(-u,u),f(-u,a)]}function KLe(e,t,n){const a=n/2,u=[];for(let f=0;f<6;f++){const s=f/6*2*Math.PI,v=a*Math.cos(s),A=a*Math.sin(s)/6371e3*(180/Math.PI),C=v/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);u.push([e+C,t+A])}return u.push(u[0]),u}function AR(e,t){var u,f;if(e.potenziale&&e.potenziale>0){const s=35+e.potenziale/500;return Math.min(Math.max(s,35),350)}let a=0;return e.tipo==="impresa"?a=(((u=e.dati_extra)==null?void 0:u.fatturato_annuo)||0)/1500:e.tipo==="luogo"?a=(((f=e.dati_extra)==null?void 0:f.importo_lavori)||0)/750:a=t*20,Math.min(Math.max(35+a,35),350)}function QLe(e,t){return!e.potenziale||e.potenziale<=0||!e.venduto_totale||e.venduto_totale<=0?0:Math.min(e.venduto_totale/e.potenziale,1)*t}function JLe(e,t,n,r,a=24){const f=[],s=[];for(let v=0;v<=a;v++){const x=v/a*2*Math.PI,A=r*Math.cos(x),P=r*Math.sin(x)/6371e3*(180/Math.PI),L=A/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);f.push([e+L,t+P]);const F=n*Math.cos(x),q=n*Math.sin(x)/6371e3*(180/Math.PI),G=F/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI);s.push([e+G,t+q])}return[f,s.reverse()]}function eDe(e,t,n,r){const u=n/2,f=r/2,s=u/6371e3*(180/Math.PI),v=u/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI),x=f/6371e3*(180/Math.PI),A=f/(6371e3*Math.cos(t*Math.PI/180))*(180/Math.PI),C=[[e-A,t-x],[e+A,t-x],[e+A,t+x],[e-A,t+x],[e-A,t-x]],P=[[e-v,t-s],[e-v,t+s],[e+v,t+s],[e+v,t-s],[e-v,t-s]];return[C,P]}function tDe({neuroni:e,sinapsi:t,categorie:n,tipiNeurone:r,selectedId:a,filterSelectedId:u,onSelectNeurone:f,onFocusNeurone:s,onClearFocus:v,onMapMove:x,filtri:A,pickingMode:C=!1,onPickPosition:P,flyToPosition:L,aiStyleChange:F,onAiStyleApplied:U,pickedPosition:q,connectionPickingMode:G=!1,connectionSourceId:$=null,onPickConnectionTarget:X,quickMapMode:ie=!1,onQuickMapClick:de,onQuickEntityClick:fe,onSelectSinapsi:be,aiMarkers:ve=[],onRemoveAiMarker:Qe}){const we=B.useRef(null),qe=B.useRef(null),Je=B.useRef(null),ft=B.useRef(null),Mt=B.useRef(null),[Pt,Nt]=B.useState(!1),[Kt,tt]=B.useState("light-v11"),[mt,Pe]=B.useState(0),[gn,Et]=B.useState(100),[ze,$t]=B.useState(!1),[Cn,fn]=B.useState(!1),[Nn,bn]=B.useState(!1),[Vt,En]=B.useState(!1),Sn=B.useRef(null),Un=B.useRef(null),nn=B.useRef(null),wr=B.useRef(()=>{}),Xr=B.useRef(e),ar=B.useRef(!1),tr=B.useRef(C),Vn=B.useRef(P),xr=B.useRef(f),ws=B.useRef(G),bi=B.useRef($),Ai=B.useRef(X),ps=B.useRef(ie),$i=B.useRef(de),Ts=B.useRef(fe),tn=B.useRef(be),kn=B.useRef(x),Mr=B.useRef(null),wt=B.useRef(a),Rn=B.useRef(s),nr=B.useRef(v),dt=B.useRef(new Map),Jn=["#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#3b82f6","#8b5cf6","#ec4899"];B.useEffect(()=>{tr.current=C,Vn.current=P},[C,P]),B.useEffect(()=>{xr.current=f},[f]),B.useEffect(()=>{wt.current=a},[a]),B.useEffect(()=>{Rn.current=s,nr.current=v},[s,v]),B.useEffect(()=>{ws.current=G,bi.current=$,Ai.current=X,console.log("DEBUG MapView: connectionPickingMode aggiornato a:",G,"sourceId:",$)},[G,$,X]),B.useEffect(()=>{ps.current=ie,$i.current=de,Ts.current=fe},[ie,de,fe]),B.useEffect(()=>{tn.current=be},[be]),B.useEffect(()=>{kn.current=x},[x]),B.useEffect(()=>{Xr.current=e},[e]);const qr=B.useCallback(Tt=>t.filter(ut=>ut.neurone_da===Tt||ut.neurone_a===Tt).length,[t]),ts=B.useCallback(Tt=>{qe.current&&(qe.current.setStyle(`mapbox://styles/mapbox/${Tt}`),tt(Tt),qe.current.once("style.load",()=>{Pe(ut=>ut+1)}),Xn.savePreferenze({mappa_stile:Tt}).catch(console.error))},[]);B.useEffect(()=>{if(!qe.current||!Pt)return;const Tt=qe.current,ut=Tt.getStyle();if(!(ut!=null&&ut.layers))return;const on=gn/100,qn=["neuroni-3d","neuroni-borders","venduto-rings","sinapsi-lines","sinapsi-lines-shadow","sinapsi-hit"];ut.layers.forEach(Or=>{if(!qn.some(Zn=>Or.id.includes(Zn)))try{switch(Or.type){case"background":Tt.setPaintProperty(Or.id,"background-opacity",on);break;case"fill":Tt.setPaintProperty(Or.id,"fill-opacity",on);break;case"line":Tt.setPaintProperty(Or.id,"line-opacity",on);break;case"symbol":Tt.setPaintProperty(Or.id,"icon-opacity",on),Tt.setPaintProperty(Or.id,"text-opacity",on);break;case"raster":Tt.setPaintProperty(Or.id,"raster-opacity",on);break;case"fill-extrusion":Tt.setPaintProperty(Or.id,"fill-extrusion-opacity",on);break}}catch{}})},[gn,Pt,mt]);const ms=B.useCallback(()=>{qe.current&&(Sn.current&&clearTimeout(Sn.current),Sn.current=setTimeout(()=>{if(!qe.current)return;const Tt=qe.current.getCenter(),ut=qe.current.getZoom(),on=qe.current.getPitch(),qn=qe.current.getBearing();Xn.savePreferenze({mappa_center:[Tt.lng,Tt.lat],mappa_zoom:ut,mappa_pitch:on,mappa_bearing:qn}).catch(console.error)},1e3))},[]);B.useEffect(()=>{wr.current=ms},[ms]),B.useEffect(()=>{if(Vt)return nn.current&&clearTimeout(nn.current),nn.current=setTimeout(()=>{Xn.savePreferenze({mappa_trasparenza:gn}).catch(console.error)},500),()=>{nn.current&&clearTimeout(nn.current)}},[gn,Vt]);const Mn=B.useCallback(()=>{Un.current&&clearTimeout(Un.current),fn(!1),Un.current=setTimeout(()=>{fn(!0),setTimeout(()=>{$t(!1),fn(!1)},300)},2e3)},[]);return B.useEffect(()=>(ze?Mn():Un.current&&clearTimeout(Un.current),()=>{Un.current&&clearTimeout(Un.current)}),[ze,Mn]),B.useEffect(()=>{Pt&&!Vt&&(async()=>{try{const ut=await Xn.getPreferenze();qe.current&&Vt===!1&&(ut!=null&&ut.mappa_stile&&(qe.current.setStyle(`mapbox://styles/mapbox/${ut.mappa_stile}`),tt(ut.mappa_stile),qe.current.once("style.load",()=>{Pe(on=>on+1)})),ut!=null&&ut.mappa_center&&(ut!=null&&ut.mappa_zoom)&&qe.current.jumpTo({center:ut.mappa_center,zoom:ut.mappa_zoom,pitch:ut.mappa_pitch??60,bearing:ut.mappa_bearing??-17.6}),(ut==null?void 0:ut.mappa_trasparenza)!=null&&Et(ut.mappa_trasparenza)),En(!0)}catch(ut){console.error("Errore caricamento preferenze:",ut),En(!0)}})()},[Pt,Vt]),B.useEffect(()=>{if(!(!we.current||qe.current))return qe.current=new gm.Map({container:we.current,style:"mapbox://styles/mapbox/light-v11",center:[9.19,45.46],zoom:12,pitch:60,bearing:-17.6,antialias:!0}),qe.current.addControl(new gm.NavigationControl,"top-right"),Je.current=new gm.Popup({closeButton:!1,closeOnClick:!1,offset:15}),ft.current=new gm.Popup({closeButton:!0,closeOnClick:!0,offset:[0,-20],maxWidth:"280px",className:"sales-popup"}),qe.current.on("load",()=>{console.log("Mappa caricata"),Nt(!0)}),qe.current.on("click",Tt=>{var qn;if(tr.current&&Vn.current){Vn.current(Tt.lngLat.lat,Tt.lngLat.lng);return}const ut=(qn=qe.current)==null?void 0:qn.queryRenderedFeatures(Tt.point,{layers:["neuroni-3d"]});(!ut||ut.length===0)&&(Je.current&&Je.current.remove(),nr.current&&nr.current(Tt.lngLat.lat,Tt.lngLat.lng),ps.current&&$i.current&&$i.current(Tt.lngLat.lat,Tt.lngLat.lng,Tt.point.x,Tt.point.y))}),qe.current.on("moveend",()=>{wr.current(),Mr.current&&clearTimeout(Mr.current),Mr.current=setTimeout(()=>{if(qe.current&&kn.current){const Tt=qe.current.getCenter(),ut=qe.current.getZoom();kn.current({lat:Tt.lat,lng:Tt.lng},ut)}},1e3)}),()=>{var Tt,ut,on;(Tt=Je.current)==null||Tt.remove(),(ut=ft.current)==null||ut.remove(),Sn.current&&clearTimeout(Sn.current),Mr.current&&clearTimeout(Mr.current),(on=qe.current)==null||on.remove(),qe.current=null}},[]),B.useEffect(()=>{!qe.current||!Pt||!L||qe.current.flyTo({center:[L.lng,L.lat],zoom:L.zoom??14,pitch:L.pitch??60,bearing:L.bearing??qe.current.getBearing(),duration:1500})},[L,Pt]),B.useEffect(()=>{!qe.current||!Pt||!F||(console.log("AI: Cambio stile mappa a",F),qe.current.setStyle(`mapbox://styles/mapbox/${F}`),tt(F),qe.current.once("style.load",()=>{Pe(Tt=>Tt+1),U==null||U()}))},[F,Pt,U]),B.useEffect(()=>{if(!qe.current||!Pt)return;const Tt=qe.current.getCanvas(),ut=qe.current.getContainer();C?(Tt.style.cursor="crosshair",ut.style.cursor="crosshair",ut.classList.add("picking-mode")):ie?(Tt.style.cursor="crosshair",ut.style.cursor="crosshair",ut.classList.add("quick-map-mode")):(Tt.style.cursor="",ut.style.cursor="",ut.classList.remove("picking-mode"),ut.classList.remove("quick-map-mode"))},[C,ie,Pt]),B.useEffect(()=>{if(!(!qe.current||!Pt)){if(Mt.current&&(Mt.current.remove(),Mt.current=null),q){const Tt=document.createElement("div");Tt.innerHTML=`
        <svg width="30" height="40" viewBox="0 0 30 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 0C6.716 0 0 6.716 0 15c0 10.5 15 25 15 25s15-14.5 15-25C30 6.716 23.284 0 15 0z" fill="#ef4444"/>
          <circle cx="15" cy="14" r="6" fill="white"/>
        </svg>
      `,Tt.style.cursor="pointer",Mt.current=new gm.Marker({element:Tt,anchor:"bottom"}).setLngLat([q.lng,q.lat]).addTo(qe.current)}return()=>{Mt.current&&(Mt.current.remove(),Mt.current=null)}}},[q,Pt]),B.useEffect(()=>{if(!qe.current||!Pt)return;const Tt=qe.current;if(!Tt.isStyleLoaded()){console.log("DEBUG MapView: stile non ancora caricato, riprovo tra 100ms...");const on=setTimeout(()=>{console.log("DEBUG MapView: riprovo dopo delay, isStyleLoaded:",Tt.isStyleLoaded()),Pe(qn=>qn+1)},100);return()=>clearTimeout(on)}let ut=e.filter(on=>on.lat&&on.lng);if(console.log("DEBUG MapView neuroni:",{totali:e.length,conCoordinate:ut.length,tipiNeuroneCaricati:r.length,primi:e.slice(0,2).map(on=>({id:on.id,nome:on.nome,lat:on.lat,lng:on.lng}))}),A.tipiSelezionati.length>0){const on=A.tipiSelezionati.map(qn=>qn.toLowerCase());ut=ut.filter(qn=>{var Or;return on.includes((Or=qn.tipo)==null?void 0:Or.toLowerCase())})}if(A.categorieSelezionate.length>0&&(ut=ut.filter(on=>on.categorie.some(qn=>A.categorieSelezionate.some(Or=>Or.toLowerCase()===qn.toLowerCase())))),A.ricerca.trim()){const on=A.ricerca.toLowerCase().trim();ut=ut.filter(qn=>{var Or;return qn.nome.toLowerCase().includes(on)||((Or=qn.indirizzo)==null?void 0:Or.toLowerCase().includes(on))||qn.categorie.some(Zn=>Zn.toLowerCase().includes(on))})}if(r.length!==0){console.log("DEBUG MapView: inizia creazione features, neuroniConCoord:",ut.length);try{const on=_n=>{if(!_n||_n.length===0)return qH;const Yn=_n[0].toLowerCase(),Tn=n.find(ti=>ti.nome.toLowerCase()===Yn);return(Tn==null?void 0:Tn.colore)||qH},qn=_n=>{const Yn=r.find(Tn=>Tn.nome.toLowerCase()===_n.toLowerCase());return Yn!=null&&Yn.forma&&["cerchio","quadrato","triangolo","stella","croce","esagono"].includes(Yn.forma)?Yn.forma:"cerchio"},Or=(_n,Yn,Tn,ti)=>{switch(_n){case"quadrato":return WLe(Yn,Tn,ti);case"triangolo":return ZLe(Yn,Tn,ti);case"stella":return XLe(Yn,Tn,ti);case"croce":return YLe(Yn,Tn,ti);case"esagono":return KLe(Yn,Tn,ti);case"cerchio":default:return GLe(Yn,Tn,ti/2,24)}},ns={type:"FeatureCollection",features:ut.map(_n=>{const Yn=qn(_n.tipo),ti=Yn!=="cerchio"?50:40,Sr=_n.dimensione?Number(_n.dimensione):ti,Mi=AR(_n,qr(_n.id)),da=Number(_n.lng),Ze=Number(_n.lat),ee=Or(Yn,da,Ze,Sr),le=Array.isArray(_n.categorie)?_n.categorie:[],ye=on(le);return{type:"Feature",properties:{id:_n.id,nome:_n.nome,tipo:_n.tipo,categorie:le.join(", "),color:ye,height:Mi,base_height:0},geometry:{type:"Polygon",coordinates:[ee]}}})},ga=Tt.getSource("neuroni");console.log("DEBUG MapView source neuroni:",ga?"esiste, aggiorno dati":"non esiste, creo layer"),ga?ga.setData(ns):(Tt.addSource("neuroni",{type:"geojson",data:ns}),Tt.addLayer({id:"neuroni-3d",type:"fill-extrusion",source:"neuroni",paint:{"fill-extrusion-color":["get","color"],"fill-extrusion-height":["get","height"],"fill-extrusion-base":0,"fill-extrusion-opacity":.9,"fill-extrusion-vertical-gradient":!0}}),Tt.addLayer({id:"neuroni-outline",type:"line",source:"neuroni",paint:{"line-color":"#1e293b","line-width":2,"line-opacity":.6}}));const Ys=ut.filter(_n=>_n.venduto_totale&&_n.venduto_totale>0&&_n.potenziale&&_n.potenziale>0).map(_n=>{const Tn=qn(_n.tipo)==="quadrato",ti=Tn?50:40,Sr=_n.dimensione?Number(_n.dimensione):ti,Mi=AR(_n,qr(_n.id)),da=QLe(_n,Mi),Ze=Number(_n.lng),ee=Number(_n.lat),le=3,ye=Tn?eDe(Ze,ee,Sr,Sr+le*2):JLe(Ze,ee,Sr/2,Sr/2+le,24);return{type:"Feature",properties:{id:_n.id,venduto_height:da,ring_height:4},geometry:{type:"Polygon",coordinates:ye}}}),rn={type:"FeatureCollection",features:Ys},rr=Tt.getSource("venduto-rings");rr?rr.setData(rn):Ys.length>0&&(Tt.addSource("venduto-rings",{type:"geojson",data:rn}),Tt.addLayer({id:"venduto-ring",type:"fill-extrusion",source:"venduto-rings",paint:{"fill-extrusion-color":"#22c55e","fill-extrusion-height":["+",["get","venduto_height"],["get","ring_height"]],"fill-extrusion-base":["get","venduto_height"],"fill-extrusion-opacity":.95}}));let Ve=t.filter(_n=>{const Yn=_n.lat_da&&_n.lng_da&&_n.lat_a&&_n.lng_a;return Yn||console.warn("DEBUG sinapsi senza coordinate:",{id:_n.id,nome_da:_n.nome_da,nome_a:_n.nome_a,lat_da:_n.lat_da,lng_da:_n.lng_da,lat_a:_n.lat_a,lng_a:_n.lng_a}),Yn});const or=u??a;if(console.log("DEBUG MapView sinapsi - stato completo:",{mostraConnessioni:A.mostraConnessioni,soloConnessioniSelezionate:A.soloConnessioniSelezionate,selectedId:a,filterSelectedId:u,idPerFiltro:or,sinapsiTotali:t.length,sinapsiConCoord:Ve.length}),!A.mostraConnessioni)console.log("DEBUG: mostraConnessioni=false -> nascondo tutte"),Ve=[];else if(A.soloConnessioniSelezionate)if(or){const _n=Ve.length;console.log("DEBUG soloConnessioniSelezionate: filtro per idPerFiltro=",or),Ve=Ve.filter(Yn=>Yn.neurone_da===or||Yn.neurone_a===or),console.log("DEBUG soloConnessioniSelezionate: da",_n,"a",Ve.length)}else console.log("DEBUG soloConnessioniSelezionate=true ma idPerFiltro=null -> nascondo tutte"),Ve=[];if(Ve.length>0){const _n=new Map(e.map(De=>[De.id,De])),Yn=40,Tn=20,ti=8,Sr=["#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#3b82f6","#8b5cf6","#ec4899"],Mi=[],da=[];Ve.forEach(De=>{const Oe=_n.get(De.neurone_da),je=_n.get(De.neurone_a),st=(Oe==null?void 0:Oe.lng)??Number(De.lng_da),We=(Oe==null?void 0:Oe.lat)??Number(De.lat_da),nt=(je==null?void 0:je.lng)??Number(De.lng_a),Rt=(je==null?void 0:je.lat)??Number(De.lat_a),bt=De.famiglie_transazioni||[],ln=Array.isArray(De.tipo_connessione)&&De.tipo_connessione.length>0?De.tipo_connessione.filter(Pi=>Pi.toLowerCase()!=="commerciale"):[],wn={id:De.id,tipo:De.tipo_connessione,valore:Number(De.valore)||1,certezza:De.certezza,neurone_da_nome:(Oe==null?void 0:Oe.nome)||"Sconosciuto",neurone_a_nome:(je==null?void 0:je.nome)||"Sconosciuto",neurone_da_tipo:(Oe==null?void 0:Oe.tipo)||"",neurone_a_tipo:(je==null?void 0:je.tipo)||""},un=bt.length>0,fr=(De.tipo_connessione||[]).some(Pi=>Pi.toLowerCase()==="commerciale");if(un){const Wi=-((bt.length-1)*ti)/2;bt.forEach((Es,ji)=>{const li=Wi+ji*ti,Is=Es.famiglia_colore||Sr[ji%Sr.length],Zi=SR(st,We,nt,Rt,15,Yn,0,li),ri={...wn,tipoSingolo:"transazione",famigliaNome:Es.famiglia_nome,famigliaId:Es.famiglia_id,tipoColor:Is,baseHeight:0,elevation:Zi.elevation,volume:Es.volume};Mi.push({type:"Feature",properties:ri,geometry:{type:"LineString",coordinates:Zi.coordinates}})})}else if(fr||ln.length===0){const Pi=SR(st,We,nt,Rt,15,Yn,0,0),ds={...wn,tipoSingolo:fr?"commerciale":"connessione",tipoColor:fr?WH.commerciale||"#3b82f6":"#94a3b8",baseHeight:0,elevation:Pi.elevation};Mi.push({type:"Feature",properties:ds,geometry:{type:"LineString",coordinates:Pi.coordinates}})}ln.forEach((Pi,ds)=>{const Wi=(ds+1)*(Yn+Tn),Es=SR(st,We,nt,Rt,15,Yn,Wi,0),ji=Pi.toLowerCase(),li=WH[ji]||"#94a3b8",Is={...wn,tipoSingolo:Pi,tipoColor:li,baseHeight:Wi,elevation:Es.elevation};Mi.push({type:"Feature",properties:Is,geometry:{type:"LineString",coordinates:Es.coordinates}})});const Ar=(1+ln.length)*(Yn+Tn),ni=qLe(st,We,nt,Rt,20,35);ni.length>0&&da.push({type:"Feature",properties:{...wn,maxHeight:Ar},geometry:{type:"Polygon",coordinates:[ni]}})});const Ze={type:"FeatureCollection",features:Mi},ee={type:"FeatureCollection",features:da},le=Tt.getSource("sinapsi"),ye=Tt.getSource("sinapsi-volumes");le&&ye?(le.setData(Ze),ye.setData(ee)):(Tt.addSource("sinapsi",{type:"geojson",lineMetrics:!0,data:Ze}),Tt.addSource("sinapsi-volumes",{type:"geojson",data:ee}),Tt.addLayer({id:"sinapsi-lines-shadow",type:"line",source:"sinapsi",layout:{"line-z-offset":["+",["coalesce",["get","baseHeight"],0],["interpolate",["linear"],["line-progress"],...Array.from({length:16},(De,Oe)=>{const je=Oe/15;return[je,4*40*je*(1-je)-3]}).flat()]]},paint:{"line-color":"#000000","line-width":6,"line-opacity":.3,"line-blur":2}}),Tt.addLayer({id:"sinapsi-lines",type:"line",source:"sinapsi",layout:{"line-z-offset":["+",["coalesce",["get","baseHeight"],0],["interpolate",["linear"],["line-progress"],...Array.from({length:16},(De,Oe)=>{const je=Oe/15;return[je,4*40*je*(1-je)]}).flat()]]},paint:{"line-color":["coalesce",["get","tipoColor"],"#94a3b8"],"line-width":4,"line-opacity":.9}}),Tt.addLayer({id:"sinapsi-hit",type:"fill-extrusion",source:"sinapsi-volumes",paint:{"fill-extrusion-color":"#ff0000","fill-extrusion-height":["coalesce",["get","maxHeight"],60],"fill-extrusion-base":0,"fill-extrusion-opacity":0}}))}else{const _n=Tt.getSource("sinapsi"),Yn=Tt.getSource("sinapsi-volumes");_n&&_n.setData({type:"FeatureCollection",features:[]}),Yn&&Yn.setData({type:"FeatureCollection",features:[]})}if(!ar.current){let _n=null;Tt.on("mouseenter","neuroni-3d",Yn=>{if(Tt.getCanvas().style.cursor="pointer",Yn.features&&Yn.features[0]&&Je.current){const Tn=Yn.features[0].properties,ti=(Tn==null?void 0:Tn.height)||35,Sr=Tt.getPitch(),Mi=Tt.getZoom(),da=Math.pow(2,(Mi-14)*.7),Ze=Math.sin(Sr*Math.PI/180),ee=ti*da*Ze*.35,le=20+Math.min(ee,120);Je.current.setOffset([0,-le]),Je.current.setLngLat(Yn.lngLat).setHTML(`<strong>${Tn==null?void 0:Tn.nome}</strong><br/><span style="color:#64748b;font-size:12px">${Tn==null?void 0:Tn.categorie}</span>`).addTo(Tt)}}),Tt.on("mouseleave","neuroni-3d",()=>{var Yn;Tt.getCanvas().style.cursor="",(Yn=Je.current)==null||Yn.remove()}),Tt.on("click","neuroni-3d",Yn=>{var Tn;if(!tr.current&&Yn.features&&Yn.features[0]){const ti=(Tn=Yn.features[0].properties)==null?void 0:Tn.id,Sr=Xr.current.find(Mi=>Mi.id===ti);if(ws.current&&Sr){if(console.log("DEBUG MapView click: connectionPickingMode attivo, neurone:",Sr.nome,"sourceId:",bi.current),Sr.id===bi.current){alert("Non puoi collegare un'entit a se stessa!");return}Ai.current&&(console.log("DEBUG MapView: chiamando onPickConnectionTarget per:",Sr.nome),Ai.current(Sr));return}if(ps.current&&Sr&&Ts.current){Ts.current(Sr,Yn.point.x,Yn.point.y);return}_n?(clearTimeout(_n),_n=null,Sr!=null&&Sr.lat&&(Sr!=null&&Sr.lng)&&Tt.flyTo({center:[Sr.lng,Sr.lat],zoom:16,pitch:60,duration:1e3})):_n=setTimeout(async()=>{var Mi,da,Ze,ee,le;if(_n=null,Sr&&wt.current&&Sr.id!==wt.current){(Mi=ft.current)==null||Mi.remove(),xr.current(Sr);return}if(Sr&&Sr.lat&&Sr.lng&&ft.current){(da=Je.current)==null||da.remove(),Rn.current&&Rn.current(Sr.id);const ye=AR(Sr,qr(Sr.id)),De=Tt.getPitch(),Oe=Tt.getZoom(),je=Math.pow(2,(Oe-14)*.7),st=Math.sin(De*Math.PI/180),We=ye*je*st*.35,nt=20+Math.min(We,120);ft.current.setOffset([0,-nt]);const Rt=`
                  <div style="padding: 8px; min-width: 200px;">
                    <div style="font-weight: 600; font-size: 14px; margin-bottom: 8px;">${Sr.nome}</div>
                    <div style="color: #64748b; font-size: 12px;">Caricamento...</div>
                  </div>
                `;ft.current.setLngLat([Sr.lng,Sr.lat]).setHTML(Rt).addTo(Tt);try{const bt=await Xn.get(`/vendite?neurone_id=${Sr.id}`),ln=bt.data.data||[],wn=bt.data.potenziale||0,un=bt.data.totale_venduto||0,fr=wn>0?Math.round(un/wn*100):0;let Tr="";if(ln.length>0){Tr='<div style="display: flex; align-items: flex-end; gap: 3px; height: 50px; margin: 8px 0;">';const Pi=wn>0?wn:Math.max(...ln.map(ds=>ds.importo),1);ln.forEach((ds,Wi)=>{const Es=Math.max(ds.importo/Pi*100,5),ji=Jn[Wi%Jn.length];Tr+=`<div title="${ds.famiglia_nome||"Prodotto"}: ${ds.importo.toLocaleString("it-IT")}" style="width: 20px; height: ${Es}%; background: ${ji}; border-radius: 2px 2px 0 0;"></div>`}),Tr+="</div>"}const Ar=un>0||wn>0,ni=`
                    <div style="padding: 8px; min-width: 220px;">
                      <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">${Sr.nome}</div>
                      <div style="color: #64748b; font-size: 11px; margin-bottom: 8px;">${Sr.tipo} ${(Ze=Sr.categorie)!=null&&Ze.length?" "+Sr.categorie.join(", "):""}</div>

                      ${Ar?`
                        <div style="margin-bottom: 4px;">
                          <div style="display: flex; justify-content: space-between; font-size: 11px; color: #64748b;">
                            <span>Venduto: ${un.toLocaleString("it-IT")}</span>
                            ${wn>0?`<span style="font-weight: 600; color: ${fr>=100?"#22c55e":"#1e293b"};">${fr}%</span>`:""}
                          </div>
                          ${wn>0?`
                            <div style="height: 6px; background: #e2e8f0; border-radius: 3px; margin-top: 2px;">
                              <div style="height: 100%; width: ${Math.min(fr,100)}%; background: ${fr>=100?"#22c55e":fr>=50?"#eab308":"#ef4444"}; border-radius: 3px;"></div>
                            </div>
                            <div style="font-size: 10px; color: #94a3b8; margin-top: 2px;">Potenziale: ${wn.toLocaleString("it-IT")}</div>
                          `:""}
                        </div>
                        ${Tr}
                      `:`
                        <div style="font-size: 11px; color: #94a3b8; margin-bottom: 8px;">Nessun dato vendite</div>
                      `}

                      <div style="display: flex; gap: 8px; margin-top: 8px;">
                        <button id="btn-quick-${Sr.id}" style="width: 40px; padding: 8px; background: #f59e0b; color: white; border: none; border-radius: 6px; font-size: 18px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                          +
                        </button>
                        <button id="btn-dettagli-${Sr.id}" style="flex: 1; padding: 8px 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer;">
                          Dettagli 
                        </button>
                      </div>
                    </div>
                  `;(ee=ft.current)==null||ee.setHTML(ni),setTimeout(()=>{const Pi=document.getElementById(`btn-dettagli-${Sr.id}`);Pi&&(Pi.onclick=()=>{var Wi;(Wi=ft.current)==null||Wi.remove(),xr.current(Sr)});const ds=document.getElementById(`btn-quick-${Sr.id}`);ds&&Ts.current&&qe.current&&(ds.onclick=()=>{var Es,ji;const Wi=(Es=qe.current)==null?void 0:Es.project([Sr.lng,Sr.lat]);(ji=ft.current)==null||ji.remove(),Wi&&Ts.current(Sr,Wi.x,Wi.y)})},50)}catch(bt){console.error("Errore caricamento vendite per popup:",bt);const ln=`
                    <div style="padding: 8px; min-width: 200px;">
                      <div style="font-weight: 600; font-size: 14px; margin-bottom: 8px;">${Sr.nome}</div>
                      <div style="display: flex; gap: 8px;">
                        <button id="btn-quick-${Sr.id}" style="width: 40px; padding: 8px; background: #f59e0b; color: white; border: none; border-radius: 6px; font-size: 18px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                          +
                        </button>
                        <button id="btn-dettagli-${Sr.id}" style="flex: 1; padding: 8px 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer;">
                          Dettagli 
                        </button>
                      </div>
                    </div>
                  `;(le=ft.current)==null||le.setHTML(ln),setTimeout(()=>{const wn=document.getElementById(`btn-dettagli-${Sr.id}`);wn&&(wn.onclick=()=>{var fr;(fr=ft.current)==null||fr.remove(),xr.current(Sr)});const un=document.getElementById(`btn-quick-${Sr.id}`);un&&Ts.current&&qe.current&&(un.onclick=()=>{var Tr,Ar;const fr=(Tr=qe.current)==null?void 0:Tr.project([Sr.lng,Sr.lat]);(Ar=ft.current)==null||Ar.remove(),fr&&Ts.current(Sr,fr.x,fr.y)})},50)}}},250)}}),Tt.on("mouseenter","sinapsi-hit",Yn=>{if(Tt.getCanvas().style.cursor="pointer",Yn.features&&Yn.features[0]&&Je.current){const Tn=Yn.features[0].properties,ti=(Tn==null?void 0:Tn.tipo)||"Connessione",Sr=(Tn==null?void 0:Tn.certezza)||"",Mi=(Tn==null?void 0:Tn.neurone_da_nome)||"",da=(Tn==null?void 0:Tn.neurone_a_nome)||"",Ze=ti.charAt(0).toUpperCase()+ti.slice(1),ee=Sr==="certo"?"#22c55e":Sr==="probabile"?"#eab308":"#94a3b8";Je.current.setOffset([0,-10]),Je.current.setLngLat(Yn.lngLat).setHTML(`
              <div style="padding: 4px 8px;">
                <strong style="font-size: 13px;">${Ze}</strong>
                <div style="font-size: 11px; color: #64748b; margin-top: 2px;">
                  ${Mi}  ${da}
                </div>
                ${Sr?`<div style="font-size: 10px; color: ${ee}; margin-top: 2px;"> ${Sr}</div>`:""}
              </div>
            `).addTo(Tt)}}),Tt.on("mouseleave","sinapsi-hit",()=>{var Yn;Tt.getCanvas().style.cursor="",(Yn=Je.current)==null||Yn.remove()}),Tt.on("click","sinapsi-hit",async Yn=>{var Tn,ti,Sr;if(!(tr.current||ws.current||ps.current)&&Yn.features&&Yn.features[0]&&ft.current){const Mi=Yn.features[0].properties,da=Mi==null?void 0:Mi.id;let Ze=(Mi==null?void 0:Mi.tipo)||"Connessione";const ee=(Mi==null?void 0:Mi.certezza)||"",le=(Mi==null?void 0:Mi.neurone_da_nome)||"Sconosciuto",ye=(Mi==null?void 0:Mi.neurone_a_nome)||"Sconosciuto",De=(Mi==null?void 0:Mi.neurone_da_tipo)||"",Oe=(Mi==null?void 0:Mi.neurone_a_tipo)||"";(Tn=Je.current)==null||Tn.remove();let je="Connessione";try{if(typeof Ze=="string"&&Ze.startsWith("[")){const ln=JSON.parse(Ze);Array.isArray(ln)&&ln.length>0&&(je=ln.map(wn=>wn.charAt(0).toUpperCase()+wn.slice(1)).join(", "))}else typeof Ze=="string"&&(je=Ze.charAt(0).toUpperCase()+Ze.slice(1))}catch{je=String(Ze)}const st=ee==="certo"?"#22c55e":ee==="probabile"?"#eab308":"#94a3b8",We=ee==="certo"?"Certo":ee==="probabile"?"Probabile":"Ipotetico";let nt="";const Rt=je.toLowerCase();Rt.includes("vendita")||Rt.includes("acquisto")||Rt.includes("commerciale")?nt="":Rt.includes("collabora")?nt="":Rt.includes("influencer")||Rt.includes("influenza")||Rt.includes("prescrittore")?nt="":Rt.includes("partner")?nt="":Rt.includes("forni")?nt="":Rt.includes("client")?nt="":Rt.includes("tecnico")&&(nt="");const bt=`
            <div style="padding: 10px; min-width: 220px;">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <span style="font-size: 20px;">${nt}</span>
                <span style="font-weight: 600; font-size: 15px;">${je}</span>
              </div>
              <div style="background: #f8fafc; border-radius: 6px; padding: 8px; margin-bottom: 8px;">
                <div style="font-size: 13px; font-weight: 500;">${le}</div>
                <div style="text-align: center; color: #94a3b8; margin: 4px 0;"></div>
                <div style="font-size: 13px; font-weight: 500;">${ye}</div>
              </div>
              <div style="text-align: center; color: #94a3b8; font-size: 11px;">Caricamento dati...</div>
            </div>
          `;ft.current.setOffset([0,-10]),ft.current.setLngLat(Yn.lngLat).setHTML(bt).addTo(Tt);try{const wn=await Xn.getSinapsiById(da),un=wn.dati_oggettivi||{volume_totale:0,numero_transazioni:0,ultima_transazione:null},fr=un.volume_totale||0,Tr=un.numero_transazioni||0,Ar=un.ultima_transazione,ni=wn.influenza||0,Pi=wn.qualita_relazione||0,ds=wn.importanza_strategica||0,Wi=wn.affidabilita||0,Es=wn.potenziale||0,ji=(Ha,Mo)=>{if(Ha===0)return"";const vd="".repeat(Ha)+"".repeat(5-Ha);return`<div style="display: flex; justify-content: space-between; font-size: 11px; margin: 2px 0;">
                <span style="color: #64748b;">${Mo}</span>
                <span style="color: #f59e0b;">${vd}</span>
              </div>`},li=ni||Pi||ds||Wi||Es,Is=li?`
              <div style="margin-top: 8px; padding-top: 8px; border-top: 1px dashed #e2e8f0;">
                <div style="font-size: 10px; color: #94a3b8; margin-bottom: 4px; text-transform: uppercase;">Valutazione Soggettiva</div>
                ${ji(ni,"Influenza")}
                ${ji(Pi,"Qualit rel.")}
                ${ji(ds,"Strategicit")}
                ${ji(Wi,"Affidabilit")}
                ${ji(Es,"Potenziale")}
              </div>
            `:"",Zi=fr>0||Tr>0,ri=Zi?`
              <div style="margin-top: 8px; padding: 8px; background: #f0fdf4; border-radius: 6px;">
                <div style="font-size: 10px; color: #22c55e; margin-bottom: 4px; text-transform: uppercase;">Dati Oggettivi</div>
                <div style="display: flex; justify-content: space-between; font-size: 12px;">
                  <span>Volume</span>
                  <span style="font-weight: 600;">${fr.toLocaleString("it-IT")}</span>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 12px;">
                  <span>Transazioni</span>
                  <span style="font-weight: 600;">${Tr}</span>
                </div>
                ${Ar?`<div style="font-size: 10px; color: #64748b; margin-top: 4px;">Ultima: ${new Date(Ar).toLocaleDateString("it-IT")}</div>`:""}
              </div>
            `:"",ha=!Zi&&!li?`
              <div style="margin-top: 8px; padding: 8px; background: #f8fafc; border-radius: 6px; text-align: center;">
                <div style="font-size: 11px; color: #94a3b8;">Nessun dato registrato</div>
              </div>
            `:"",xo=`
              <div style="padding: 10px; min-width: 220px; max-width: 280px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                  <span style="font-size: 20px;">${nt}</span>
                  <span style="font-weight: 600; font-size: 15px;">${je}</span>
                  <span style="margin-left: auto; font-size: 10px; color: ${st};"> ${We}</span>
                </div>

                <div style="background: #f8fafc; border-radius: 6px; padding: 8px;">
                  <div style="font-size: 13px; font-weight: 500;">${le}</div>
                  ${De?`<div style="font-size: 10px; color: #94a3b8;">${De}</div>`:""}
                  <div style="text-align: center; color: #94a3b8; margin: 4px 0;"></div>
                  <div style="font-size: 13px; font-weight: 500;">${ye}</div>
                  ${Oe?`<div style="font-size: 10px; color: #94a3b8;">${Oe}</div>`:""}
                </div>

                ${ri}
                ${Is}
                ${ha}

                <button id="btn-sinapsi-dettagli-${da}" style="
                  width: 100%;
                  margin-top: 10px;
                  padding: 8px 12px;
                  background: #6366f1;
                  color: white;
                  border: none;
                  border-radius: 6px;
                  font-size: 13px;
                  font-weight: 500;
                  cursor: pointer;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  gap: 6px;
                ">
                  Dettagli <span style="font-size: 16px;"></span>
                </button>
              </div>
            `;(ti=ft.current)==null||ti.setHTML(xo),setTimeout(()=>{const Ha=document.getElementById(`btn-sinapsi-dettagli-${da}`);Ha&&tn.current&&(Ha.onclick=()=>{var Mo;(Mo=ft.current)==null||Mo.remove(),tn.current(da)})},50)}catch(ln){console.error("Errore caricamento dati sinapsi:",ln);const wn=`
              <div style="padding: 10px; min-width: 220px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                  <span style="font-size: 20px;">${nt}</span>
                  <span style="font-weight: 600; font-size: 15px;">${je}</span>
                </div>
                <div style="background: #f8fafc; border-radius: 6px; padding: 8px;">
                  <div style="font-size: 13px; font-weight: 500;">${le}</div>
                  <div style="text-align: center; color: #94a3b8; margin: 4px 0;"></div>
                  <div style="font-size: 13px; font-weight: 500;">${ye}</div>
                </div>
                <div style="font-size: 11px; color: ${st}; margin-top: 8px;"> ${We}</div>
              </div>
            `;(Sr=ft.current)==null||Sr.setHTML(wn)}}}),ar.current=!0}}catch(on){console.error("DEBUG MapView ERRORE nella creazione layer:",on)}}},[e,t,n,r,a,u,Pt,A,qr,mt]),B.useEffect(()=>{if(!qe.current||!Pt)return;const Tt=new Set(ve.map(on=>on.id));new Set(dt.current.keys()).forEach(on=>{if(!Tt.has(on)){const qn=dt.current.get(on);qn&&(qn.remove(),dt.current.delete(on))}}),ve.forEach(on=>{if(!dt.current.has(on.id)){const qn=document.createElement("div");qn.className="ai-marker",qn.style.cssText=`
          width: 30px;
          height: 40px;
          cursor: pointer;
          display: flex;
          flex-direction: column;
          align-items: center;
        `,qn.innerHTML=`
          <svg width="30" height="40" viewBox="0 0 30 40" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 40V2" stroke="${on.color}" stroke-width="3" stroke-linecap="round"/>
            <path d="M4 2L26 8L4 16" fill="${on.color}"/>
          </svg>
        `;const Or=document.createElement("div");Or.style.cssText="padding: 8px; min-width: 120px;",Or.innerHTML=`
          <div style="font-weight: 600; margin-bottom: 4px;">${on.label}</div>
          <div style="font-size: 11px; color: #666; margin-bottom: 8px;">
            Piazzato da Agea
          </div>
          <button id="remove-marker-${on.id}" style="
            background: #ef4444;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            width: 100%;
          ">
            Rimuovi
          </button>
        `;const Zn=new gm.Popup({offset:[0,-35],closeButton:!0,closeOnClick:!1}).setDOMContent(Or),ns=new gm.Marker({element:qn,anchor:"bottom"}).setLngLat([on.lng,on.lat]).setPopup(Zn).addTo(qe.current);qn.addEventListener("click",()=>{ns.togglePopup()}),Zn.on("open",()=>{const ga=document.getElementById(`remove-marker-${on.id}`);ga&&(ga.onclick=()=>{Qe==null||Qe(on.id),ns.remove()})}),dt.current.set(on.id,ns)}})},[ve,Pt,Qe]),k.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[k.jsx("div",{ref:we,style:{width:"100%",height:"100%"}}),k.jsx("div",{style:{position:"absolute",top:"10px",left:"50%",transform:"translateX(-50%)",width:"320px",maxWidth:"calc(100% - 20px)",zIndex:10},children:k.jsx($Le,{placeholder:"Cerca indirizzo sulla mappa...",onSelect:Tt=>{qe.current&&Tt.lat&&Tt.lng&&qe.current.flyTo({center:[Tt.lng,Tt.lat],zoom:17,pitch:60,duration:2e3})}})}),n.length>0&&Nn&&k.jsxs("div",{style:{position:"absolute",bottom:"66px",left:"10px",background:"white",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",fontSize:"12px",zIndex:10,padding:"10px 12px",maxHeight:"180px",overflowY:"auto"},children:[n.slice(0,10).map(Tt=>k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[k.jsx("div",{style:{width:10,height:10,borderRadius:"3px",background:Tt.colore,flexShrink:0}}),k.jsx("span",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"90px",fontSize:"11px",color:"#334155"},children:Tt.nome})]},Tt.id)),n.length>10&&k.jsxs("div",{style:{fontSize:"10px",color:"#64748b"},children:["+",n.length-10," altre..."]}),k.jsx("div",{style:{fontSize:"9px",color:"#64748b",borderTop:"1px solid #e2e8f0",paddingTop:"6px",marginTop:"4px"},children:"Altezza = valore/relazioni"})]}),n.length>0&&k.jsxs("div",{onClick:()=>bn(!Nn),style:{position:"absolute",bottom:"30px",left:"10px",background:"white",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",padding:"8px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",userSelect:"none",zIndex:10},children:[k.jsx("span",{style:{fontWeight:600,fontSize:"11px",color:"#1e293b"},children:"Legenda"}),k.jsx("span",{style:{fontSize:"8px",color:"#64748b",transform:Nn?"rotate(180deg)":"none",transition:"transform 0.2s ease"},children:""})]}),k.jsxs("div",{style:{position:"absolute",bottom:"30px",right:"10px",display:"flex",flexDirection:"column",gap:"8px",zIndex:10},children:[ze&&k.jsxs("div",{onMouseMove:Mn,onTouchStart:Mn,style:{background:"white",padding:"10px 12px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",minWidth:"180px",opacity:Cn?0:1,transition:"opacity 0.3s ease"},children:[k.jsxs("div",{style:{fontSize:"11px",color:"#64748b",marginBottom:"6px",display:"flex",justifyContent:"space-between"},children:[k.jsx("span",{children:"Trasparenza mappa"}),k.jsxs("span",{style:{fontWeight:600},children:[100-gn,"%"]})]}),k.jsx("input",{type:"range",min:"10",max:"100",value:gn,onChange:Tt=>{Et(Number(Tt.target.value)),Mn()},style:{width:"100%",height:"6px",cursor:"pointer",accentColor:"#3b82f6"}}),k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"9px",color:"#94a3b8",marginTop:"2px"},children:[k.jsx("span",{children:"3D visibile"}),k.jsx("span",{children:"Mappa solida"})]})]}),k.jsxs("div",{style:{display:"flex",gap:"4px",background:"white",padding:"6px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:[k.jsx("button",{onClick:()=>$t(!ze),title:ze?"Nascondi controlli":"Trasparenza mappa",style:{width:"32px",height:"32px",border:ze?"2px solid #3b82f6":"1px solid #e2e8f0",borderRadius:"6px",background:ze?"#eff6ff":"white",cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),k.jsx("div",{style:{width:"1px",background:"#e2e8f0",margin:"4px 2px"}}),HLe.map(Tt=>k.jsx("button",{onClick:()=>ts(Tt.id),title:Tt.nome,style:{width:"32px",height:"32px",border:Kt===Tt.id?"2px solid #3b82f6":"1px solid #e2e8f0",borderRadius:"6px",background:Kt===Tt.id?"#eff6ff":"white",cursor:"pointer",fontSize:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:Tt.icon},Tt.id))]})]})]})}function nDe({excludeId:e,onSelect:t,onClose:n,onSwitchToMap:r}){const[a,u]=B.useState([]),[f,s]=B.useState(!0),[v,x]=B.useState(""),[A,C]=B.useState(null);B.useEffect(()=>{(async()=>{s(!0);try{const{data:U}=await Xn.getNeuroni({limit:500});u(U.filter(q=>q.id!==e).map(q=>({id:q.id,nome:q.nome,tipo:q.tipo,categorie:q.categorie||[],indirizzo:q.indirizzo||void 0})))}catch(U){console.error("Errore caricamento entit:",U)}finally{s(!1)}})()},[e]);const P=B.useMemo(()=>{const F=new Set(a.map(U=>U.tipo));return Array.from(F).sort()},[a]),L=B.useMemo(()=>{let F=a;if(A&&(F=F.filter(U=>U.tipo===A)),v.trim()){const U=v.toLowerCase();F=F.filter(q=>q.nome.toLowerCase().includes(U)||q.tipo.toLowerCase().includes(U)||q.categorie.some(G=>G.toLowerCase().includes(U))||q.indirizzo&&q.indirizzo.toLowerCase().includes(U))}return F},[a,A,v]);return k.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,padding:"16px"},onClick:n,children:k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"12px",width:"100%",maxWidth:"600px",maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden"},onClick:F=>F.stopPropagation(),children:[k.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[k.jsx("h2",{style:{fontSize:"18px",fontWeight:600,margin:0},children:"Seleziona entit"}),k.jsx("button",{onClick:n,style:{background:"transparent",border:"none",fontSize:"24px",cursor:"pointer",color:"var(--text-secondary)",padding:"4px 8px"},children:""})]}),k.jsxs("div",{style:{padding:"12px 20px",borderBottom:"1px solid var(--border-color)"},children:[k.jsx("input",{type:"text",className:"form-input",placeholder:"Cerca per nome, tipo, categoria, indirizzo...",value:v,onChange:F=>x(F.target.value),autoFocus:!0,style:{fontSize:"15px"}}),k.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"12px",flexWrap:"wrap"},children:[k.jsxs("button",{onClick:()=>C(null),style:{padding:"6px 12px",borderRadius:"16px",border:"none",fontSize:"13px",cursor:"pointer",background:A===null?"var(--primary)":"var(--bg-primary)",color:A===null?"white":"var(--text-primary)"},children:["Tutti (",a.length,")"]}),P.map(F=>{const U=a.filter(q=>q.tipo===F).length;return k.jsxs("button",{onClick:()=>C(A===F?null:F),style:{padding:"6px 12px",borderRadius:"16px",border:"none",fontSize:"13px",cursor:"pointer",background:A===F?"var(--primary)":"var(--bg-primary)",color:A===F?"white":"var(--text-primary)"},children:[F," (",U,")"]},F)})]})]}),k.jsx("div",{style:{flex:1,overflowY:"auto",padding:"8px 12px"},children:f?k.jsx("div",{style:{padding:"40px",textAlign:"center",color:"var(--text-secondary)"},children:"Caricamento..."}):L.length===0?k.jsx("div",{style:{padding:"40px",textAlign:"center",color:"var(--text-secondary)"},children:"Nessuna entit trovata"}):L.map(F=>k.jsxs("div",{onClick:()=>t(F),style:{padding:"12px 16px",marginBottom:"4px",borderRadius:"8px",cursor:"pointer",background:"var(--bg-primary)",transition:"background 0.15s"},onMouseEnter:U=>{U.currentTarget.style.background="var(--primary)",U.currentTarget.style.color="white"},onMouseLeave:U=>{U.currentTarget.style.background="var(--bg-primary)",U.currentTarget.style.color="inherit"},children:[k.jsx("div",{style:{fontWeight:500,marginBottom:"2px"},children:F.nome}),k.jsxs("div",{style:{fontSize:"12px",opacity:.8},children:[F.tipo,F.categorie.length>0&&`  ${F.categorie.join(", ")}`]}),F.indirizzo&&k.jsx("div",{style:{fontSize:"11px",opacity:.6,marginTop:"4px"},children:F.indirizzo})]},F.id))}),r&&k.jsxs("div",{style:{padding:"12px 20px",borderTop:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"center",gap:"12px"},children:[k.jsx("span",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:"oppure"}),k.jsx("button",{onClick:r,className:"btn btn-primary",style:{fontSize:"14px"},children:"Seleziona su mappa"})]})]})})}function rDe({neuroneCorrente:e,sinapsiDaModificare:t,personalAccess:n,onClose:r,onSaved:a,onRequestMapPick:u,preselectedEntity:f}){var Un;const s=!!t,[v,x]=B.useState((f==null?void 0:f.id)||(t?t.neurone_da===e.id?t.neurone_a:t.neurone_da:"")),[A,C]=B.useState((f==null?void 0:f.nome)||(t?t.neurone_da===e.id?t.nome_a||"":t.nome_da||"":"")),[P,L]=B.useState((t==null?void 0:t.tipo_connessione)||[]),[F,U]=B.useState((t==null?void 0:t.data_inizio)||new Date().toISOString().split("T")[0]),[q,G]=B.useState((t==null?void 0:t.data_fine)||""),[$,X]=B.useState(((Un=t==null?void 0:t.valore)==null?void 0:Un.toString())||""),[ie,de]=B.useState((t==null?void 0:t.certezza)||"ipotesi"),[fe,be]=B.useState((t==null?void 0:t.fonte)||""),[ve,Qe]=B.useState((t==null?void 0:t.data_verifica)||""),[we,qe]=B.useState((t==null?void 0:t.livello)||"aziendale"),[Je,ft]=B.useState((t==null?void 0:t.note)||""),[Mt,Pt]=B.useState((t==null?void 0:t.famiglia_prodotto_id)||null),[Nt,Kt]=B.useState(!1),[tt,mt]=B.useState([]),[Pe,gn]=B.useState([]),[Et,ze]=B.useState(!1),[$t,Cn]=B.useState(null);B.useEffect(()=>{(async()=>{try{const[wr,Xr]=await Promise.all([Xn.getTipiSinapsi(),Xn.getFamiglieProdotto()]);mt(wr.data),gn(Xr.data)}catch(wr){console.error("Errore caricamento dati:",wr)}})()},[]);const fn=nn=>{x(nn.id),C(nn.nome),Kt(!1)},Nn=()=>{Kt(!1),r(),u==null||u()},bn=nn=>{L(wr=>wr.includes(nn)?wr.filter(Xr=>Xr!==nn):[...wr,nn])},Vt=async nn=>{var wr,Xr;if(nn.preventDefault(),Cn(null),!v){Cn("Seleziona un neurone da collegare");return}if(P.length===0){Cn("Seleziona almeno un tipo di connessione");return}ze(!0);try{const ar={neurone_da:e.id,neurone_a:v,tipo_connessione:P,famiglia_prodotto_id:Mt||null,data_inizio:F,data_fine:q||null,valore:$?parseFloat($):null,certezza:ie,fonte:fe||null,data_verifica:ve||null,livello:we,note:Je||null};if(console.log("DEBUG sinapsi submit:",ar),s&&t)await Xn.updateSinapsi(t.id,ar);else{const tr=await Xn.createSinapsi(ar);console.log("DEBUG sinapsi created:",tr)}a(),r()}catch(ar){console.error("Errore salvataggio sinapsi:",ar);let tr="Errore durante il salvataggio";if(ar&&typeof ar=="object"){const Vn=ar;(Xr=(wr=Vn.response)==null?void 0:wr.data)!=null&&Xr.error?tr=Vn.response.data.error:Vn.message&&(tr=Vn.message)}Cn(tr)}finally{ze(!1)}},En=(nn,wr=0)=>nn.flatMap(Xr=>[{id:Xr.id,nome:Xr.nome,level:wr},...Xr.children?En(Xr.children,wr+1):[]]),Sn=En(Pe);return k.jsxs(k.Fragment,{children:[k.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:r,children:k.jsxs("div",{className:"card",style:{width:"100%",maxWidth:"500px",maxHeight:"90vh",overflow:"auto",padding:"24px"},onClick:nn=>nn.stopPropagation(),children:[k.jsx("h2",{style:{marginBottom:"16px",fontSize:"18px",fontWeight:600},children:s?"Modifica Connessione":"Nuova Connessione"}),k.jsxs("form",{onSubmit:Vt,children:[k.jsxs("div",{style:{marginBottom:"16px",padding:"12px",background:"var(--bg-secondary)",borderRadius:"8px"},children:[k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:"Da"}),k.jsx("div",{style:{fontWeight:500},children:e.nome})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Collega a"}),v?k.jsxs("div",{style:{padding:"12px 16px",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--primary)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[k.jsx("div",{children:k.jsx("div",{style:{fontWeight:600,color:"var(--primary)"},children:A})}),k.jsx("button",{type:"button",onClick:()=>{x(""),C("")},style:{background:"none",border:"none",color:"var(--text-secondary)",cursor:"pointer",fontSize:"18px"},children:""})]}):k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("button",{type:"button",onClick:()=>Kt(!0),className:"btn",style:{flex:1,padding:"12px"},children:"Cerca nella lista"}),u&&k.jsx("button",{type:"button",onClick:Nn,className:"btn btn-primary",style:{flex:1,padding:"12px"},children:"Seleziona su mappa"})]})]}),k.jsxs("div",{className:"form-group",children:[k.jsxs("label",{className:"form-label",children:["Tipi Connessione",P.length>0&&k.jsxs("span",{style:{fontWeight:400,color:"var(--text-secondary)",marginLeft:"8px"},children:["(",P.length," selezionati)"]})]}),tt.length===0?k.jsxs("div",{style:{padding:"12px",background:"#fef3c7",border:"1px solid #f59e0b",borderRadius:"8px",color:"#92400e",fontSize:"13px"},children:["Nessun tipo connessione configurato.",k.jsx("br",{}),k.jsx("span",{style:{fontWeight:500},children:"Menu utente (in alto a destra)  Impostazioni  Connessioni"})]}):k.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",padding:"12px",background:"var(--bg-primary)",borderRadius:"8px",border:"1px solid var(--border-color)",maxHeight:"200px",overflowY:"auto"},children:tt.map(nn=>{const wr=P.includes(nn.nome);return k.jsxs("button",{type:"button",onClick:()=>bn(nn.nome),style:{padding:"6px 12px",borderRadius:"16px",border:"none",cursor:"pointer",fontSize:"13px",fontWeight:wr?600:400,background:wr?nn.colore||"var(--primary)":"var(--bg-secondary)",color:wr?"white":"var(--text-primary)",transition:"all 0.15s ease"},children:[wr&&" ",nn.nome.replace(/_/g," ")]},nn.id)})})]}),Sn.length>0&&k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Prodotto (opzionale)"}),k.jsxs("select",{className:"form-input",value:Mt||"",onChange:nn=>Pt(nn.target.value||null),children:[k.jsx("option",{value:"",children:"-- Nessun prodotto --"}),Sn.map(nn=>k.jsxs("option",{value:nn.id,children:["  ".repeat(nn.level),nn.nome]},nn.id))]})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Certezza"}),k.jsx("div",{style:{display:"flex",gap:"8px"},children:["ipotesi","probabile","certo"].map(nn=>k.jsxs("button",{type:"button",className:`btn ${ie===nn?"btn-primary":""}`,onClick:()=>de(nn),style:{flex:1},children:[nn==="ipotesi"&&""," ",nn==="probabile"&&""," ",nn==="certo"&&""," ",nn]},nn))})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Fonte informazione"}),k.jsx("input",{type:"text",className:"form-input",placeholder:"Es: visto sul cantiere, me l'ha detto Mario...",value:fe,onChange:nn=>be(nn.target.value)})]}),k.jsxs("div",{style:{display:"flex",gap:"12px"},children:[k.jsxs("div",{className:"form-group",style:{flex:1},children:[k.jsx("label",{className:"form-label",children:"Data inizio"}),k.jsx("input",{type:"date",className:"form-input",value:F,onChange:nn=>U(nn.target.value),required:!0})]}),k.jsxs("div",{className:"form-group",style:{flex:1},children:[k.jsx("label",{className:"form-label",children:"Data fine"}),k.jsx("input",{type:"date",className:"form-input",value:q,onChange:nn=>G(nn.target.value)})]})]}),ie==="certo"&&k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Data verifica"}),k.jsx("input",{type:"date",className:"form-input",value:ve,onChange:nn=>Qe(nn.target.value)})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Valore economico (opzionale)"}),k.jsx("input",{type:"number",className:"form-input",placeholder:"Es: 5000",value:$,onChange:nn=>X(nn.target.value),step:"0.01"})]}),n&&k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Visibilit"}),k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("button",{type:"button",className:`btn ${we==="aziendale"?"btn-primary":""}`,onClick:()=>qe("aziendale"),style:{flex:1},children:"Aziendale"}),k.jsx("button",{type:"button",className:`btn ${we==="personale"?"btn-primary":""}`,onClick:()=>qe("personale"),style:{flex:1},children:" Personale"})]})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Note"}),k.jsx("textarea",{className:"form-input",placeholder:"Note aggiuntive...",value:Je,onChange:nn=>ft(nn.target.value),rows:3,style:{resize:"vertical"}})]}),$t&&k.jsx("div",{style:{padding:"12px",background:"#fee",color:"#c00",borderRadius:"4px",marginBottom:"16px"},children:$t}),k.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[k.jsx("button",{type:"button",className:"btn",onClick:r,disabled:Et,children:"Annulla"}),k.jsx("button",{type:"submit",className:"btn btn-primary",disabled:Et||!v||P.length===0,children:Et?"Salvataggio...":s?"Salva modifiche":"Crea connessione"})]})]})]})}),Nt&&k.jsx(nDe,{excludeId:e.id,onSelect:fn,onClose:()=>Kt(!1),onSwitchToMap:u?Nn:void 0})]})}function iDe({neurone:e,personalAccess:t,categorie:n,onClose:r,onSelectNeurone:a,onEdit:u,onRequestConnectionMapPick:f,connectionTargetEntity:s,onClearConnectionTarget:v,onSinapsiCreated:x}){console.log("DEBUG DetailPanel render, connectionTargetEntity:",s);const{data:A}=kLe(e.id),{data:C=[],isLoading:P}=qne(e.id),{data:L=[],isLoading:F}=LLe(t?e.id:null),{invalidateSinapsiNeurone:U,invalidateNote:q}=ZT(),G=A||e,[$,X]=B.useState("info"),ie=P||F,fe=(()=>{if(G.categorie.length>0&&n.length>0){const Qe=G.categorie[0],we=n.find(qe=>qe.nome===Qe);if(we!=null&&we.colore)return we.colore}return{persona:"#3b82f6",impresa:"#22c55e",cantiere:"#f97316",ente:"#8b5cf6"}[G.tipo]||"#6b7280"})();ELe("detail-panel-state","panel","Pannello Dettaglio Entit",{entita:G.nome,tipo:G.tipo,tabAttiva:$==="vendite"?"transazioni":$,tabDisponibili:["info","transazioni","connessioni","note"],numeroConnessioni:C.length,numeroNote:L.length,haAccessoPersonale:t},"Il pannello laterale destro che mostra i dettagli dell'entit selezionata"),ER({id:"panel_switch_tab",name:"Cambia Tab Pannello",description:"Cambia la tab attiva nel pannello dettagli. Tab disponibili: info, transazioni, connessioni, note",parameters:[{name:"tab",type:"select",options:["info","transazioni","connessioni","note"],description:"La tab da attivare",required:!0}],handler:async({tab:ve})=>{const we={info:"info",transazioni:"vendite",connessioni:"connessioni",note:"note"}[ve];return we?ve==="note"&&!t?{success:!1,message:"Tab Note richiede accesso personale (PIN)"}:(X(we),{success:!0,message:`Tab cambiata in "${ve}"`}):{success:!1,message:`Tab "${ve}" non valida. Usa: info, transazioni, connessioni, note`}}}),ER({id:"panel_edit_entity",name:"Modifica Entit",description:"Apre il form di modifica per l'entit correntemente visualizzata",parameters:[],handler:async()=>u?(u(),{success:!0,message:`Aperto form modifica per "${G.nome}"`}):{success:!1,message:"Modifica non disponibile per questa entit"}}),ER({id:"panel_close",name:"Chiudi Pannello",description:"Chiude il pannello dettagli",parameters:[],handler:async()=>(r(),{success:!0,message:"Pannello chiuso"})}),B.useEffect(()=>{s&&X("connessioni")},[s]);const be=()=>`badge badge-${G.tipo}`;return k.jsxs("div",{className:"detail-panel",children:[k.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"flex-start",gap:"12px",background:`linear-gradient(135deg, ${fe}20 0%, ${fe}05 100%)`,borderLeft:`4px solid ${fe}`},children:[k.jsxs("div",{style:{flex:1},children:[k.jsxs("h2",{style:{fontSize:"18px",fontWeight:600,marginBottom:"4px",color:fe},children:[G.nome,G.has_note&&!t&&k.jsx("span",{className:"icon-lock",title:"Ha note personali (richiede PIN)",children:""})]}),k.jsxs("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:[k.jsx("span",{className:be(),children:G.tipo}),G.categorie.map(ve=>k.jsx("span",{className:"badge",children:ve},ve))]})]}),k.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[u&&k.jsx("button",{onClick:u,style:{background:fe,border:"none",color:"white",padding:"6px 12px",borderRadius:"6px",fontSize:"12px",cursor:"pointer",fontWeight:500},children:" Modifica"}),k.jsx("button",{onClick:r,style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:fe,lineHeight:1},children:""})]})]}),k.jsx("div",{role:"tablist","aria-label":"Sezioni dettaglio entit","data-ai-container":"tabs",style:{display:"flex",borderBottom:"1px solid var(--border-color)"},children:["info","vendite","connessioni","note"].map(ve=>{const Qe=ve==="vendite"?"transazioni":ve,we=$===ve;return k.jsxs("button",{role:"tab","aria-selected":we,"aria-controls":`tabpanel-${ve}`,"data-ai-name":`Tab ${Qe}`,onClick:()=>X(ve),style:{flex:1,padding:"12px",border:"none",background:we?"var(--bg-secondary)":"transparent",borderBottom:we?"2px solid var(--color-primary)":"2px solid transparent",cursor:"pointer",fontWeight:we?600:400,textTransform:"capitalize",fontSize:"13px"},children:[Qe,ve==="connessioni"&&` (${C.length})`,ve==="note"&&t&&` (${L.length})`,ve==="note"&&!t&&G.has_note&&" "]},ve)})}),k.jsx("div",{style:{padding:"16px",overflowY:"auto"},children:ie?k.jsx("p",{style:{color:"var(--text-secondary)"},children:"Caricamento..."}):k.jsxs(k.Fragment,{children:[$==="info"&&k.jsx(sDe,{neurone:G}),$==="vendite"&&k.jsx(lDe,{neurone:G}),$==="connessioni"&&k.jsx(aDe,{sinapsi:C,neurone:G,personalAccess:t,onSelectNeurone:a,onSinapsiChange:()=>{U(G.id),x==null||x()},onRequestMapPick:f,preselectedEntity:s,onClearPreselected:v}),$==="note"&&k.jsx(oDe,{note:L,personalAccess:t,neuroneId:G.id,onNoteChange:()=>q(G.id)})]})})]})}function sDe({neurone:e}){const{invalidateNeurone:t}=ZT(),[n,r]=B.useState(!1),[a,u]=B.useState({is_acquirente:e.is_acquirente,is_venditore:e.is_venditore,is_intermediario:e.is_intermediario,is_influencer:e.is_influencer}),{data:f=[]}=Wne(),s=f.find(L=>L.nome.toLowerCase()===e.tipo.toLowerCase()),v=(s==null?void 0:s.id)||null,{data:x=[],isLoading:A}=PLe(v);B.useEffect(()=>{u({is_acquirente:e.is_acquirente,is_venditore:e.is_venditore,is_intermediario:e.is_intermediario,is_influencer:e.is_influencer})},[e.is_acquirente,e.is_venditore,e.is_intermediario,e.is_influencer]);const C=async L=>{r(!0);const F=!a[L];try{await Xn.updateNeurone(e.id,{[L]:F}),u(U=>({...U,[L]:F})),t(e.id)}catch(U){console.error("Errore aggiornamento natura:",U)}finally{r(!1)}},P=L=>{if(!e.dati_extra)return null;const F=e.dati_extra[L.nome];return F==null||F===""?null:String(F)};return k.jsxs("div",{children:[k.jsxs("div",{style:{marginBottom:"20px",padding:"12px",background:"var(--bg-secondary)",borderRadius:"8px"},children:[k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"8px"},children:"Natura commerciale"}),k.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",background:a.is_acquirente?"rgba(59, 130, 246, 0.15)":"var(--bg-primary)",border:`1px solid ${a.is_acquirente?"#3b82f6":"var(--border-color)"}`,borderRadius:"6px",cursor:n?"wait":"pointer",fontSize:"13px",opacity:n?.6:1},children:[k.jsx("input",{type:"checkbox",checked:!!a.is_acquirente,onChange:()=>C("is_acquirente"),disabled:n})," Acquirente"]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",background:a.is_venditore?"rgba(34, 197, 94, 0.15)":"var(--bg-primary)",border:`1px solid ${a.is_venditore?"#22c55e":"var(--border-color)"}`,borderRadius:"6px",cursor:n?"wait":"pointer",fontSize:"13px",opacity:n?.6:1},children:[k.jsx("input",{type:"checkbox",checked:!!a.is_venditore,onChange:()=>C("is_venditore"),disabled:n})," Venditore"]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",background:a.is_intermediario?"rgba(234, 179, 8, 0.15)":"var(--bg-primary)",border:`1px solid ${a.is_intermediario?"#eab308":"var(--border-color)"}`,borderRadius:"6px",cursor:n?"wait":"pointer",fontSize:"13px",opacity:n?.6:1},children:[k.jsx("input",{type:"checkbox",checked:!!a.is_intermediario,onChange:()=>C("is_intermediario"),disabled:n})," Intermediario"]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 10px",background:a.is_influencer?"rgba(168, 85, 247, 0.15)":"var(--bg-primary)",border:`1px solid ${a.is_influencer?"#a855f7":"var(--border-color)"}`,borderRadius:"6px",cursor:n?"wait":"pointer",fontSize:"13px",opacity:n?.6:1},children:[k.jsx("input",{type:"checkbox",checked:!!a.is_influencer,onChange:()=>C("is_influencer"),disabled:n})," Influencer"]})]}),k.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)",marginTop:"8px",fontStyle:"italic"},children:"Modifica la natura commerciale specifica per questa entit"})]}),e.indirizzo&&k.jsx(C1,{label:"Indirizzo",value:e.indirizzo}),e.telefono&&k.jsx(C1,{label:"Telefono",value:e.telefono}),e.email&&k.jsx(C1,{label:"Email",value:e.email}),e.sito_web&&k.jsx(C1,{label:"Sito web",value:e.sito_web}),e.lat&&e.lng&&k.jsx(C1,{label:"Coordinate",value:`${e.lat}, ${e.lng}`}),A?k.jsx("div",{style:{marginTop:"16px",color:"var(--text-secondary)",fontSize:"13px"},children:"Caricamento campi..."}):x.length>0?k.jsxs("div",{style:{marginTop:"16px"},children:[k.jsx("h4",{style:{fontSize:"14px",fontWeight:600,marginBottom:"8px"},children:"Dettagli aggiuntivi"}),x.map(L=>{const F=P(L);return k.jsxs("div",{style:{marginBottom:"12px"},children:[k.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"2px",display:"flex",alignItems:"center",gap:"4px"},children:[L.etichetta,L.obbligatorio&&k.jsx("span",{style:{color:"#ef4444",fontSize:"10px"},children:"*"})]}),k.jsx("div",{style:{fontSize:"14px",color:F?"var(--text-primary)":"var(--text-secondary)",fontStyle:F?"normal":"italic",padding:F?"0":"4px 8px",background:F?"transparent":"var(--bg-secondary)",borderRadius:"4px",border:F?"none":"1px dashed var(--border-color)"},children:F||"Non compilato"})]},L.id)})]}):e.dati_extra&&Object.keys(e.dati_extra).length>0?k.jsxs("div",{style:{marginTop:"16px"},children:[k.jsx("h4",{style:{fontSize:"14px",fontWeight:600,marginBottom:"8px"},children:"Dettagli aggiuntivi"}),Object.entries(e.dati_extra).map(([L,F])=>k.jsx(C1,{label:L.replace(/_/g," "),value:String(F)},L))]}):null]})}function C1({label:e,value:t}){return k.jsxs("div",{style:{marginBottom:"12px"},children:[k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"2px"},children:e}),k.jsx("div",{style:{fontSize:"14px"},children:t})]})}function aDe({sinapsi:e,neurone:t,personalAccess:n,onSelectNeurone:r,onSinapsiChange:a,onRequestMapPick:u,preselectedEntity:f,onClearPreselected:s}){const[v,x]=B.useState(!1),[A,C]=B.useState(void 0);B.useEffect(()=>{console.log("DEBUG ConnessioniTab preselectedEntity:",f),f&&(console.log("DEBUG: Aprendo form con preselectedEntity:",f.nome),C(void 0),x(!0))},[f]);const P=()=>{C(void 0),x(!0)},L=()=>{x(!1),s==null||s()},F=(G,$)=>{$.stopPropagation(),C(G),x(!0)},U=async(G,$)=>{if($.stopPropagation(),!!window.confirm(`Eliminare la connessione con "${G.neurone_da===t.id?G.nome_a:G.nome_da}"?`))try{await Xn.deleteSinapsi(G.id),a()}catch(X){console.error("Errore eliminazione sinapsi:",X),alert("Errore durante l'eliminazione")}},q=G=>{switch(G){case"ipotesi":return"";case"probabile":return"";case"certo":return"";default:return""}};return k.jsxs("div",{children:[k.jsx("button",{className:"btn btn-primary",onClick:P,style:{width:"100%",marginBottom:"16px"},children:"+ Aggiungi connessione"}),e.length===0?k.jsx("p",{style:{color:"var(--text-secondary)"},children:"Nessuna connessione"}):e.map(G=>{const $=G.neurone_da===t.id,X=$?G.nome_a:G.nome_da,ie=$?G.neurone_a:G.neurone_da;return k.jsxs("div",{className:"card",style:{padding:"12px",cursor:r?"pointer":"default",transition:"background 0.15s"},onClick:()=>r==null?void 0:r(ie),onMouseEnter:de=>{r&&(de.currentTarget.style.background="var(--bg-secondary)")},onMouseLeave:de=>{r&&(de.currentTarget.style.background="")},children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[k.jsxs("div",{children:[k.jsxs("div",{style:{fontWeight:500,marginBottom:"4px",color:"var(--color-primary)"},children:[$?"":""," ",X]}),k.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:[Array.isArray(G.tipo_connessione)?G.tipo_connessione.map(de=>de.replace(/_/g," ")).join("  "):String(G.tipo_connessione||"").replace(/_/g," "),G.prodotto_nome&&k.jsxs("span",{style:{marginLeft:"6px",background:"var(--bg-tertiary)",padding:"2px 6px",borderRadius:"4px"},children:[" ",G.prodotto_nome]})]})]}),k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("span",{title:G.certezza,children:q(G.certezza)}),k.jsx("button",{onClick:de=>F(G,de),style:{background:"none",border:"none",cursor:"pointer",fontSize:"14px",opacity:.6},title:"Modifica",children:""}),k.jsx("button",{onClick:de=>U(G,de),style:{background:"none",border:"none",cursor:"pointer",fontSize:"14px",opacity:.6,color:"#ef4444"},title:"Elimina",children:""})]})]}),k.jsxs("div",{style:{marginTop:"8px",fontSize:"12px",color:"var(--text-secondary)"},children:[G.data_inizio," ",G.data_fine?` ${G.data_fine}`:" oggi",G.valore&&`  ${G.valore.toLocaleString()}`]}),G.fonte&&k.jsxs("div",{style:{marginTop:"6px",fontSize:"11px",color:"var(--text-secondary)",fontStyle:"italic"},children:[" ",G.fonte]}),G.certezza==="certo"&&G.data_verifica&&k.jsxs("div",{style:{marginTop:"4px",fontSize:"11px",color:"var(--color-success)"},children:[" Verificato il ",G.data_verifica]}),G.note&&k.jsx("div",{style:{marginTop:"8px",padding:"8px",background:"var(--bg-secondary)",borderRadius:"4px",fontSize:"13px"},children:G.note})]},G.id)}),v&&k.jsx(rDe,{neuroneCorrente:t,sinapsiDaModificare:A,personalAccess:n,onClose:L,onSaved:()=>{a(),s==null||s()},onRequestMapPick:u,preselectedEntity:f})]})}function oDe({note:e,personalAccess:t,neuroneId:n,onNoteChange:r}){const[a,u]=B.useState(""),[f,s]=B.useState(!1);if(!t)return k.jsxs("div",{style:{textAlign:"center",padding:"32px",color:"var(--text-secondary)"},children:[k.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),k.jsx("p",{children:"Inserisci il PIN per vedere le note personali"})]});const v=async()=>{if(a.trim()){s(!0);try{await Xn.createNota(n,a),r(),u("")}catch(x){console.error("Errore salvataggio nota:",x)}finally{s(!1)}}};return k.jsxs("div",{children:[k.jsxs("div",{style:{marginBottom:"16px"},children:[k.jsx("textarea",{className:"form-input",placeholder:"Aggiungi una nota personale...",value:a,onChange:x=>u(x.target.value),rows:3,style:{resize:"vertical"}}),k.jsx("button",{className:"btn btn-primary",onClick:v,disabled:!a.trim()||f,style:{marginTop:"8px"},children:f?"Salvataggio...":"Aggiungi nota"})]}),e.length===0?k.jsx("p",{style:{color:"var(--text-secondary)"},children:"Nessuna nota personale"}):e.map(x=>k.jsxs("div",{className:"card",style:{padding:"12px"},children:[k.jsx("div",{style:{whiteSpace:"pre-wrap"},children:x.testo}),k.jsx("div",{style:{marginTop:"8px",fontSize:"11px",color:"var(--text-secondary)"},children:new Date(x.data_modifica).toLocaleString("it-IT")})]},x.id))]})}function lDe({neurone:e}){const{data:t,isLoading:n}=DLe(e.id),{data:r=[]}=OLe(),{data:a=[]}=qne(e.id),{invalidateVendite:u,invalidateNeuroniESinapsi:f}=ZT(),[s,v]=B.useState(!1),[x,A]=B.useState(!1),[C,P]=B.useState(""),L=(t==null?void 0:t.data)||[],F=(t==null?void 0:t.potenziale)||0,U=(t==null?void 0:t.totale_venduto)||0,q=a.map(ve=>{const Qe=ve.neurone_da===e.id;return{id:Qe?ve.neurone_a:ve.neurone_da,nome:Qe?ve.nome_a||"Sconosciuto":ve.nome_da||"Sconosciuto",sinapsi_id:ve.id}}).filter((ve,Qe,we)=>Qe===we.findIndex(qe=>qe.id===ve.id)),G=()=>e.is_intermediario||e.is_influencer?"Valore Potenziale":e.is_venditore&&!e.is_acquirente?"Potenziale di vendita":"Potenziale di acquisto",$=["#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#3b82f6","#8b5cf6","#ec4899","#6366f1","#84cc16"],X=n,ie=async()=>{v(!0);try{await Xn.post("/vendite",{neurone_id:e.id,potenziale:parseFloat(C)||0}),A(!1),u(e.id)}catch(ve){console.error("Errore salvataggio potenziale:",ve)}finally{v(!1)}},de=async(ve,Qe,we,qe,Je,ft="vendita")=>{v(!0);try{await Xn.post("/vendite",{neurone_id:e.id,famiglia_id:ve,importo:Qe,data_vendita:we||new Date().toISOString().split("T")[0],controparte_id:qe||null,sinapsi_id:Je||null,tipo_transazione:ft}),u(e.id),qe&&f()}catch(Mt){console.error("Errore salvataggio vendita:",Mt)}finally{v(!1)}},fe=async ve=>{if(window.confirm("Sei sicuro di voler eliminare questa vendita?")){v(!0);try{await Xn.delete(`/vendite/${ve}`),u(e.id),f()}catch(Qe){console.error("Errore eliminazione vendita:",Qe)}finally{v(!1)}}},be=F>0?Math.round(U/F*100):0;return X?k.jsx("p",{style:{color:"var(--text-secondary)"},children:"Caricamento..."}):k.jsxs("div",{children:[k.jsxs("div",{style:{marginBottom:"20px",padding:"16px",background:"var(--bg-secondary)",borderRadius:"8px"},children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[k.jsx("label",{style:{fontWeight:600,fontSize:"14px"},children:G()}),x?k.jsxs("div",{style:{display:"flex",gap:"4px"},children:[k.jsx("button",{onClick:ie,disabled:s,style:{background:"var(--primary)",color:"white",border:"none",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",cursor:"pointer"},children:"Salva"}),k.jsx("button",{onClick:()=>A(!1),style:{background:"var(--bg-primary)",border:"1px solid var(--border-color)",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",cursor:"pointer"},children:""})]}):k.jsx("button",{onClick:()=>{A(!0),P(F.toString())},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:"12px"},children:" Modifica"})]}),x?k.jsx("input",{type:"number",className:"form-input",value:C,onChange:ve=>P(ve.target.value),placeholder:"es: 100000",style:{fontSize:"18px",fontWeight:600},autoFocus:!0}):k.jsxs("div",{style:{fontSize:"24px",fontWeight:700,color:"var(--primary)"},children:["",F.toLocaleString("it-IT")]})]}),k.jsxs("div",{style:{marginBottom:"20px"},children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[k.jsxs("span",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:["Venduto: ",U.toLocaleString("it-IT")]}),k.jsxs("span",{style:{fontSize:"12px",fontWeight:600,color:be>=100?"#22c55e":"var(--text-primary)"},children:[be,"%"]})]}),k.jsx("div",{style:{height:"12px",background:"var(--bg-secondary)",borderRadius:"6px",overflow:"hidden"},children:k.jsx("div",{style:{height:"100%",width:`${Math.min(be,100)}%`,background:be>=100?"#22c55e":be>=50?"#eab308":"#ef4444",borderRadius:"6px",transition:"width 0.3s ease"}})})]}),k.jsx(uDe,{famiglie:r,controparti:q,neurone:e,onSave:de,saving:s}),k.jsxs("div",{style:{marginTop:"20px"},children:[k.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,marginBottom:"12px"},children:["Storico vendite (",L.length,")"]}),L.length===0?k.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"13px"},children:"Nessuna transazione registrata. Usa il form sopra per aggiungerne una."}):k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:L.map((ve,Qe)=>{const we=r.find(Mt=>Mt.id===ve.famiglia_id),qe=ve.colore||(we==null?void 0:we.colore)||$[Qe%$.length],Je=ve.tipo_transazione==="acquisto",ft=!!ve.controparte_id;return k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 12px",background:"var(--bg-primary)",borderRadius:"6px",borderLeft:`4px solid ${qe}`},children:[k.jsx("div",{style:{fontSize:"16px",width:"24px",textAlign:"center"},children:Je?"":""}),k.jsxs("div",{style:{flex:1},children:[k.jsxs("div",{style:{fontSize:"13px",fontWeight:500,display:"flex",alignItems:"center",gap:"6px"},children:[ve.famiglia_nome||(we==null?void 0:we.nome)||"Prodotto",ft&&k.jsx("span",{style:{fontSize:"10px",padding:"2px 6px",background:Je?"rgba(59, 130, 246, 0.15)":"rgba(34, 197, 94, 0.15)",color:Je?"#3b82f6":"#22c55e",borderRadius:"4px"},children:" Bilaterale"})]}),k.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:[" ",ve.data_vendita?new Date(ve.data_vendita).toLocaleDateString("it-IT"):"-",ve.controparte_nome&&k.jsxs("span",{children:["  ",Je?"da":"a"," ",k.jsx("strong",{children:ve.controparte_nome})]})]})]}),k.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:Je?"#ef4444":qe},children:[Je?"-":"+","",ve.importo.toLocaleString("it-IT")]}),k.jsx("button",{onClick:()=>fe(ve.id),disabled:s,style:{background:"none",border:"none",color:"#ef4444",cursor:"pointer",padding:"4px",fontSize:"12px",opacity:.6},title:"Elimina transazione",children:""})]},ve.id)})})]}),F>0&&L.length>0&&(()=>{const ve=L.reduce((Qe,we)=>(Qe[we.famiglia_id]=(Qe[we.famiglia_id]||0)+we.importo,Qe),{});return k.jsxs("div",{style:{marginTop:"24px",padding:"16px",background:"var(--bg-secondary)",borderRadius:"8px"},children:[k.jsx("h4",{style:{fontSize:"13px",fontWeight:600,marginBottom:"12px",color:"var(--text-secondary)"},children:"Anteprima 3D (totale per prodotto)"}),k.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:"4px",height:"100px",padding:"0 20px"},children:Object.entries(ve).map(([Qe,we],qe)=>{var Pt;const Je=r.find(Nt=>Nt.id===Qe),ft=(Je==null?void 0:Je.colore)||$[qe%$.length],Mt=F>0?we/F*100:0;return k.jsx("div",{title:`${((Pt=Je==null?void 0:Je.nome)==null?void 0:Pt.trim())||"Prodotto"}: ${we.toLocaleString("it-IT")}`,style:{width:"24px",height:`${Math.max(Mt,5)}%`,background:ft,borderRadius:"2px 2px 0 0",transition:"height 0.3s ease"}},Qe)})}),k.jsxs("div",{style:{borderTop:"2px dashed var(--border-color)",marginTop:"8px",paddingTop:"8px",fontSize:"11px",color:"var(--text-secondary)",textAlign:"center"},children:["Linea venduto totale: ",be,"%"]})]})})()]})}function uDe({famiglie:e,controparti:t,neurone:n,onSave:r,saving:a}){var X;const[u,f]=B.useState(""),[s,v]=B.useState(""),[x,A]=B.useState(new Date().toISOString().split("T")[0]),[C,P]=B.useState(""),[L,F]=B.useState("vendita"),[U,q]=B.useState(!1);B.useEffect(()=>{n.is_acquirente&&!n.is_venditore?F("acquisto"):F("vendita")},[n.is_acquirente,n.is_venditore]),B.useEffect(()=>{t.length===1&&!C&&P(t[0].id)},[t,C]);const G=()=>{if(!u||!s)return;const ie=t.find(fe=>fe.id===C),de=ie==null?void 0:ie.sinapsi_id;r(u,parseFloat(s),x,C||void 0,de,L),v("")},$=()=>L==="acquisto"?n.is_venditore?"Acquistato da":"Comprato da":n.is_acquirente?"Venduto a":"Fornito a";return U?k.jsxs("div",{style:{padding:"16px",background:"var(--bg-secondary)",borderRadius:"8px",marginBottom:"12px"},children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[k.jsx("h4",{style:{fontSize:"14px",fontWeight:600},children:"Nuova transazione"}),k.jsx("button",{onClick:()=>q(!1),style:{background:"none",border:"none",fontSize:"18px",cursor:"pointer",color:"var(--text-secondary)"},children:""})]}),k.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"4px",display:"block"},children:"Tipo transazione"}),k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("button",{type:"button",onClick:()=>F("vendita"),style:{flex:1,padding:"8px",border:"none",borderRadius:"6px",cursor:"pointer",background:L==="vendita"?"#22c55e":"var(--bg-primary)",color:L==="vendita"?"white":"var(--text-primary)",fontWeight:L==="vendita"?600:400},children:" Vendita"}),k.jsx("button",{type:"button",onClick:()=>F("acquisto"),style:{flex:1,padding:"8px",border:"none",borderRadius:"6px",cursor:"pointer",background:L==="acquisto"?"#3b82f6":"var(--bg-primary)",color:L==="acquisto"?"white":"var(--text-primary)",fontWeight:L==="acquisto"?600:400},children:" Acquisto"})]})]}),k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"4px",display:"block"},children:"Prodotto *"}),k.jsxs("select",{className:"form-input",value:u,onChange:ie=>f(ie.target.value),children:[k.jsx("option",{value:"",children:"Seleziona prodotto..."}),e.map(ie=>k.jsx("option",{value:ie.id,children:ie.nome.trim()},ie.id))]})]}),k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"4px",display:"block"},children:$()}),k.jsxs("select",{className:"form-input",value:C,onChange:ie=>P(ie.target.value),children:[k.jsx("option",{value:"",children:" Cliente generico/occasionale"}),t.map(ie=>k.jsx("option",{value:ie.id,children:ie.nome},ie.id))]}),C?k.jsxs("div",{style:{marginTop:"6px",padding:"8px",background:L==="acquisto"?"rgba(59, 130, 246, 0.1)":"rgba(34, 197, 94, 0.1)",borderRadius:"4px",fontSize:"11px",color:L==="acquisto"?"#3b82f6":"#22c55e"},children:[' Transazione bilaterale: verr registrata anche su "',(X=t.find(ie=>ie.id===C))==null?void 0:X.nome,'"']}):k.jsx("div",{style:{marginTop:"6px",padding:"8px",background:"rgba(156, 163, 175, 0.1)",borderRadius:"4px",fontSize:"11px",color:"#6b7280"},children:" Per tracciare chi compra/vende, prima crea una connessione con l'entit"})]}),k.jsxs("div",{style:{display:"flex",gap:"12px"},children:[k.jsxs("div",{style:{flex:1},children:[k.jsx("label",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"4px",display:"block"},children:"Importo () *"}),k.jsx("input",{type:"number",className:"form-input",value:s,onChange:ie=>v(ie.target.value),placeholder:"es: 5000"})]}),k.jsxs("div",{style:{flex:1},children:[k.jsx("label",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"4px",display:"block"},children:"Data *"}),k.jsx("input",{type:"date",className:"form-input",value:x,onChange:ie=>A(ie.target.value)})]})]}),k.jsx("button",{onClick:G,disabled:a||!u||!s,className:"btn btn-primary",style:{marginTop:"8px"},children:a?"Salvataggio...":C?"Salva (bilaterale)":"Salva (cliente generico)"})]})]}):k.jsx("button",{onClick:()=>q(!0),className:"btn btn-primary",style:{width:"100%",marginBottom:"12px"},children:"+ Nuova transazione"})}const dm=24*60*60*1e3,cDe=[{label:"1 anno",years:1},{label:"3 anni",years:3},{label:"5 anni",years:5},{label:"10 anni",years:10}],Zl=e=>{const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`};function dDe({dataInizio:e,dataFine:t,onChange:n}){const r=new Date;r.setHours(12,0,0,0);const[a,u]=B.useState(3),[f,s]=B.useState(!1),[v,x]=B.useState(e),[A,C]=B.useState(t),P=new Date(r.getTime()-a*365*dm),L=new Date(r.getTime()+365*dm),F=P.getTime(),U=L.getTime(),q=Math.round((r.getTime()-F)/dm),G=bn=>Math.round((bn-F)/dm),$=bn=>F+bn*dm,X=0,ie=G(U),de=(bn,Vt,En)=>Math.max(Vt,Math.min(En,bn)),fe=e?de(G(new Date(e).getTime()),X,ie):X,be=t?de(G(new Date(t).getTime()),X,ie):ie,[ve,Qe]=B.useState(fe),[we,qe]=B.useState(be),[Je,ft]=B.useState(!1),[Mt,Pt]=B.useState(!1),[Nt,Kt]=B.useState(!1);B.useEffect(()=>{if(!Je){const bn=e?de(G(new Date(e).getTime()),X,ie):X,Vt=t?de(G(new Date(t).getTime()),X,ie):ie;Qe(bn),qe(Vt)}},[e,t,Je,a,F,U]),B.useEffect(()=>{x(e),C(t)},[e,t]);const tt=bn=>{const Vt=$(bn);return new Date(Vt).toLocaleDateString("it-IT",{day:"2-digit",month:"short",year:"numeric"})},mt=bn=>{const Vt=$(bn);return new Date(Vt).toLocaleDateString("it-IT",{month:"short",year:"numeric"})},Pe=()=>{ft(!1);const bn=Zl(new Date($(ve))),Vt=Zl(new Date($(we)));n(bn,Vt)},gn=bn=>{const Vt=de(ve+bn,X,we-1);Qe(Vt),n(Zl(new Date($(Vt))),Zl(new Date($(we))))},Et=bn=>{const Vt=de(we+bn,ve+1,ie);qe(Vt),n(Zl(new Date($(ve))),Zl(new Date($(Vt))))},ze=bn=>{const Vt=new Date(bn).getTime(),En=de(G(Vt),X,we-1);Qe(En),Pt(!1),n(Zl(new Date($(En))),Zl(new Date($(we))))},$t=bn=>{const Vt=new Date(bn).getTime(),En=de(G(Vt),ve+1,ie);qe(En),Kt(!1),n(Zl(new Date($(ve))),Zl(new Date($(En))))},Cn=bn=>{const Vt=$(we),En=new Date(Vt),Sn=new Date(Vt-bn*30*dm),Un=Math.max(Sn.getTime(),F),nn=new Date(Un),wr=G(Un);Qe(wr),n(Zl(nn),Zl(En))},fn=()=>{if(v&&A){const bn=new Date(v),Vt=new Date(A);if(bn<=Vt){const En=bn.getTime();if(En<F){const Sn=Math.ceil((r.getTime()-En)/(365*dm));u(Math.max(Sn,a))}n(v,A),s(!1)}}},Nn={flex:1,height:"8px",borderRadius:"4px",background:"linear-gradient(to right, #e2e8f0 0%, #3b82f6 50%, #e2e8f0 100%)",cursor:"pointer",WebkitAppearance:"none",appearance:"none"};return k.jsxs("div",{className:"time-slider",style:{background:"var(--bg-primary)",borderTop:"1px solid var(--border)",padding:"12px 16px"},children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px",flexWrap:"wrap",gap:"8px"},children:[k.jsxs("button",{onClick:()=>s(!f),style:{fontSize:"14px",fontWeight:600,color:"var(--text-primary)",background:f?"var(--bg-secondary)":"transparent",border:"1px solid transparent",borderColor:f?"var(--border)":"transparent",padding:"4px 8px",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",transition:"all 0.2s"},title:"Clicca per impostare date personalizzate",children:[k.jsxs("span",{children:["Periodo: ",tt(ve)," - ",tt(we)]}),k.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:k.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),k.jsxs("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:[k.jsx("button",{className:"btn",style:{padding:"4px 10px",fontSize:"12px",fontWeight:600,borderRadius:"4px",minWidth:"40px",background:"#22c55e",color:"white",border:"none"},onClick:()=>{const bn=Zl(r),Vt=Zl(new Date(r.getTime()-365*dm));n(Vt,bn)},title:"Imposta periodo: ultimo anno fino a oggi",children:"Oggi"}),[{label:"1M",months:1},{label:"3M",months:3},{label:"6M",months:6},{label:"1A",months:12},{label:"2A",months:24},{label:"Tutto",months:36}].map(({label:bn,months:Vt})=>k.jsx("button",{className:"btn btn-secondary",style:{padding:"4px 10px",fontSize:"12px",fontWeight:500,borderRadius:"4px",minWidth:"40px"},onClick:()=>Cn(Vt),children:bn},bn))]})]}),k.jsxs("div",{style:{display:"flex",gap:"16px",alignItems:"center",background:"var(--bg-secondary)",padding:"12px",borderRadius:"8px"},children:[k.jsx("span",{style:{fontSize:"11px",color:"var(--text-secondary)",minWidth:"65px"},children:mt(X)}),k.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"12px"},children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[k.jsx("span",{style:{fontSize:"12px",fontWeight:500,width:"25px",color:"#3b82f6"},children:"Da:"}),k.jsx("button",{onClick:()=>gn(-1),style:{padding:"2px 6px",fontSize:"14px",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",cursor:"pointer",color:"var(--text-primary)"},title:"-1 giorno",children:""}),k.jsx("input",{type:"range",min:X,max:ie,step:1,value:ve,onChange:bn=>{ft(!0);let Vt=Number(bn.target.value);Vt>=we&&(Vt=we-1),Qe(Vt)},onMouseUp:Pe,onTouchEnd:Pe,onBlur:Pe,style:Nn}),k.jsx("button",{onClick:()=>gn(1),style:{padding:"2px 6px",fontSize:"14px",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",cursor:"pointer",color:"var(--text-primary)"},title:"+1 giorno",children:""}),Mt?k.jsx("input",{type:"date",defaultValue:Zl(new Date($(ve))),onChange:bn=>bn.target.value&&ze(bn.target.value),onBlur:()=>Pt(!1),autoFocus:!0,style:{fontSize:"11px",padding:"2px 4px",width:"110px"}}):k.jsx("span",{onClick:()=>Pt(!0),style:{fontSize:"11px",color:"var(--text-secondary)",minWidth:"80px",textAlign:"right",cursor:"pointer",textDecoration:"underline dotted"},title:"Clicca per modificare",children:tt(ve)})]}),k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[k.jsx("span",{style:{fontSize:"12px",fontWeight:500,width:"25px",color:"#22c55e"},children:"A:"}),k.jsx("button",{onClick:()=>Et(-1),style:{padding:"2px 6px",fontSize:"14px",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",cursor:"pointer",color:"var(--text-primary)"},title:"-1 giorno",children:""}),k.jsx("input",{type:"range",min:X,max:ie,step:1,value:we,onChange:bn=>{ft(!0);let Vt=Number(bn.target.value);Vt<=ve&&(Vt=ve+1),qe(Vt)},onMouseUp:Pe,onTouchEnd:Pe,onBlur:Pe,style:Nn}),k.jsx("button",{onClick:()=>Et(1),style:{padding:"2px 6px",fontSize:"14px",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"4px",cursor:"pointer",color:"var(--text-primary)"},title:"+1 giorno",children:""}),Nt?k.jsx("input",{type:"date",defaultValue:Zl(new Date($(we))),onChange:bn=>bn.target.value&&$t(bn.target.value),onBlur:()=>Kt(!1),autoFocus:!0,style:{fontSize:"11px",padding:"2px 4px",width:"110px"}}):k.jsxs("span",{onClick:()=>Kt(!0),style:{fontSize:"11px",color:we>q?"#f97316":"var(--text-secondary)",fontWeight:we>q?600:400,minWidth:"80px",textAlign:"right",cursor:"pointer",textDecoration:"underline dotted"},title:"Clicca per modificare",children:[tt(we),we>q?" (futuro)":""]})]})]}),k.jsx("span",{style:{fontSize:"11px",color:"var(--text-secondary)",minWidth:"65px",textAlign:"right"},children:mt(ie)})]}),f&&k.jsxs("div",{style:{marginTop:"12px",padding:"12px",background:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border)"},children:[k.jsxs("div",{style:{display:"flex",gap:"16px",flexWrap:"wrap",alignItems:"flex-end"},children:[k.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[k.jsx("div",{style:{fontSize:"12px",fontWeight:500,marginBottom:"8px",color:"var(--text-secondary)"},children:"Date personalizzate"}),k.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[k.jsx("input",{type:"date",value:v,onChange:bn=>x(bn.target.value),style:{padding:"6px 8px",borderRadius:"4px",border:"1px solid var(--border)",background:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"13px"}}),k.jsx("span",{style:{color:"var(--text-secondary)"},children:"-"}),k.jsx("input",{type:"date",value:A,onChange:bn=>C(bn.target.value),style:{padding:"6px 8px",borderRadius:"4px",border:"1px solid var(--border)",background:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"13px"}}),k.jsx("button",{onClick:fn,className:"btn btn-primary",style:{padding:"6px 12px",fontSize:"12px"},children:"Applica"})]})]}),k.jsxs("div",{children:[k.jsx("div",{style:{fontSize:"12px",fontWeight:500,marginBottom:"8px",color:"var(--text-secondary)"},children:"Estensione slider"}),k.jsx("div",{style:{display:"flex",gap:"4px"},children:cDe.map(({label:bn,years:Vt})=>k.jsx("button",{onClick:()=>u(Vt),className:`btn ${a===Vt?"btn-primary":"btn-secondary"}`,style:{padding:"6px 10px",fontSize:"11px"},children:bn},Vt))})]})]}),k.jsx("div",{style:{marginTop:"10px",fontSize:"11px",color:"var(--text-secondary)",fontStyle:"italic"},children:'I preset (1M, 3M, ecc.) calcolano indietro dalla data "A:" selezionata'})]}),k.jsx("style",{children:`
        .time-slider input[type="range"] {
          -webkit-appearance: none;
          appearance: none;
          background: #e2e8f0;
          height: 6px;
          border-radius: 3px;
          outline: none;
        }
        .time-slider input[type="range"]::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
          width: 18px;
          height: 18px;
          border-radius: 50%;
          background: #3b82f6;
          cursor: pointer;
          border: 2px solid white;
          box-shadow: 0 2px 6px rgba(0,0,0,0.2);
          transition: transform 0.1s;
        }
        .time-slider input[type="range"]::-webkit-slider-thumb:hover {
          transform: scale(1.15);
        }
        .time-slider input[type="range"]::-webkit-slider-thumb:active {
          transform: scale(1.25);
          background: #2563eb;
        }
        .time-slider input[type="range"]::-moz-range-thumb {
          width: 18px;
          height: 18px;
          border-radius: 50%;
          background: #3b82f6;
          cursor: pointer;
          border: 2px solid white;
          box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        .time-slider input[type="range"]::-moz-range-thumb:hover {
          transform: scale(1.15);
        }
      `})]})}function hDe({onVerify:e,onClose:t}){const[n,r]=B.useState(""),[a,u]=B.useState(""),[f,s]=B.useState(!1),v=B.useRef(null);B.useEffect(()=>{setTimeout(()=>{var A;return(A=v.current)==null?void 0:A.focus()},100)},[]),B.useEffect(()=>{const A=C=>{C.key==="Escape"&&t()};return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[t]);const x=async A=>{var C;if(A.preventDefault(),!!n.trim()){u(""),s(!0);try{await e(n),t()}catch{u("PIN non valido"),r(""),(C=v.current)==null||C.focus()}finally{s(!1)}}};return k.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:A=>{A.target===A.currentTarget&&t()},children:k.jsxs("div",{style:{background:"white",padding:"32px",borderRadius:"16px",width:"100%",maxWidth:"360px",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[k.jsxs("div",{style:{textAlign:"center",marginBottom:"24px"},children:[k.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),k.jsx("h2",{style:{fontSize:"20px",fontWeight:600,marginBottom:"8px"},children:"Area Personale"}),k.jsx("p",{style:{color:"#6b7280",fontSize:"14px"},children:"Inserisci il PIN per vedere i tuoi dati privati"})]}),k.jsxs("form",{onSubmit:x,children:[k.jsx("input",{ref:v,type:"password",inputMode:"numeric",value:n,onChange:A=>r(A.target.value.replace(/\D/g,"")),placeholder:"PIN",maxLength:10,style:{width:"100%",fontSize:"32px",textAlign:"center",letterSpacing:"12px",padding:"16px",border:"2px solid #e5e7eb",borderRadius:"12px",marginBottom:"16px",boxSizing:"border-box"}}),a&&k.jsx("div",{style:{padding:"12px",marginBottom:"16px",background:"#fef2f2",color:"#dc2626",borderRadius:"8px",fontSize:"14px",textAlign:"center"},children:a}),k.jsxs("div",{style:{display:"flex",gap:"12px"},children:[k.jsx("button",{type:"button",onClick:t,style:{flex:1,padding:"14px",border:"1px solid #e5e7eb",borderRadius:"10px",background:"white",fontSize:"15px",cursor:"pointer"},children:"Annulla"}),k.jsx("button",{type:"submit",disabled:!n.trim()||f,style:{flex:1,padding:"14px",border:"none",borderRadius:"10px",background:"#6366f1",color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",opacity:!n.trim()||f?.5:1},children:f?"...":"Sblocca"})]})]})]})})}function fDe({onSetPin:e,onClose:t}){const[n,r]=B.useState(""),[a,u]=B.useState(""),[f,s]=B.useState(""),[v,x]=B.useState(!1),A=B.useRef(null);B.useEffect(()=>{setTimeout(()=>{var P;return(P=A.current)==null?void 0:P.focus()},100)},[]),B.useEffect(()=>{const P=L=>{L.key==="Escape"&&t()};return window.addEventListener("keydown",P),()=>window.removeEventListener("keydown",P)},[t]);const C=async P=>{if(P.preventDefault(),!!n.trim()){if(n.length<4){s("PIN deve essere almeno 4 cifre");return}if(!/^[0-9]+$/.test(n)){s("PIN deve contenere solo numeri");return}if(n!==a){s("I PIN non coincidono");return}s(""),x(!0);try{await e(n),t()}catch{s("Errore nel salvare il PIN")}finally{x(!1)}}};return k.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:P=>{P.target===P.currentTarget&&t()},children:k.jsxs("div",{style:{background:"white",padding:"32px",borderRadius:"16px",width:"100%",maxWidth:"360px",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"},children:[k.jsxs("div",{style:{textAlign:"center",marginBottom:"24px"},children:[k.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),k.jsx("h2",{style:{fontSize:"20px",fontWeight:600,marginBottom:"8px"},children:"Crea il tuo PIN"}),k.jsx("p",{style:{color:"#6b7280",fontSize:"14px"},children:"Il PIN protegge i tuoi dati personali. Solo tu potrai vederli."})]}),k.jsxs("form",{onSubmit:C,children:[k.jsxs("div",{style:{marginBottom:"12px"},children:[k.jsx("label",{style:{fontSize:"13px",color:"#6b7280",display:"block",marginBottom:"4px"},children:"Nuovo PIN (min 4 cifre)"}),k.jsx("input",{ref:A,type:"password",inputMode:"numeric",value:n,onChange:P=>r(P.target.value.replace(/\D/g,"")),placeholder:"",maxLength:10,style:{width:"100%",fontSize:"24px",textAlign:"center",letterSpacing:"8px",padding:"12px",border:"2px solid #e5e7eb",borderRadius:"10px",boxSizing:"border-box"}})]}),k.jsxs("div",{style:{marginBottom:"16px"},children:[k.jsx("label",{style:{fontSize:"13px",color:"#6b7280",display:"block",marginBottom:"4px"},children:"Conferma PIN"}),k.jsx("input",{type:"password",inputMode:"numeric",value:a,onChange:P=>u(P.target.value.replace(/\D/g,"")),placeholder:"",maxLength:10,style:{width:"100%",fontSize:"24px",textAlign:"center",letterSpacing:"8px",padding:"12px",border:"2px solid #e5e7eb",borderRadius:"10px",boxSizing:"border-box"}})]}),f&&k.jsx("div",{style:{padding:"12px",marginBottom:"16px",background:"#fef2f2",color:"#dc2626",borderRadius:"8px",fontSize:"14px",textAlign:"center"},children:f}),k.jsxs("div",{style:{display:"flex",gap:"12px"},children:[k.jsx("button",{type:"button",onClick:t,style:{flex:1,padding:"14px",border:"1px solid #e5e7eb",borderRadius:"10px",background:"white",fontSize:"15px",cursor:"pointer"},children:"Annulla"}),k.jsx("button",{type:"submit",disabled:!n||!a||v,style:{flex:1,padding:"14px",border:"none",borderRadius:"10px",background:"#22c55e",color:"white",fontSize:"15px",fontWeight:600,cursor:"pointer",opacity:!n||!a||v?.5:1},children:v?"...":"Salva PIN"})]})]})]})})}function pDe(){const[e,t]=B.useState([]),[n,r]=B.useState(!0),[a,u]=B.useState(!1),[f,s]=B.useState(null),[v,x]=B.useState(!1),[A,C]=B.useState(""),[P,L]=B.useState(null),[F,U]=B.useState(""),[q,G]=B.useState("aziendale"),[$,X]=B.useState("#3b82f6"),[ie,de]=B.useState(null),[fe,be]=B.useState(""),[ve,Qe]=B.useState(""),[we,qe]=B.useState(""),[Je,ft]=B.useState(new Set);B.useEffect(()=>{Mt()},[]);const Mt=async()=>{r(!0);try{const{data:$t}=await Xn.getFamiglieProdotto();t($t);const Cn=new Set,fn=Nn=>{Nn.forEach(bn=>{bn.children&&bn.children.length>0&&(Cn.add(bn.id),fn(bn.children))})};fn($t),ft(Cn)}catch($t){console.error("Errore caricamento famiglie:",$t),s({type:"error",text:"Errore caricamento famiglie prodotto"})}finally{r(!1)}},Pt=async()=>{var $t,Cn;if(A.trim()){u(!0),s(null);try{await Xn.createFamigliaProdotto({nome:A.trim(),parent_id:P,descrizione:F.trim()||void 0,visibilita:q,colore:$}),s({type:"success",text:"Famiglia creata!"}),C(""),L(null),U(""),G("aziendale"),X("#3b82f6"),x(!1),Mt()}catch(fn){s({type:"error",text:((Cn=($t=fn.response)==null?void 0:$t.data)==null?void 0:Cn.error)||"Errore creazione famiglia"})}finally{u(!1)}}},Nt=async $t=>{var Cn,fn;if(fe.trim()){u(!0);try{await Xn.updateFamigliaProdotto($t,{nome:fe.trim(),descrizione:ve.trim()||void 0,colore:we||void 0}),de(null),Mt()}catch(Nn){s({type:"error",text:((fn=(Cn=Nn.response)==null?void 0:Cn.data)==null?void 0:fn.error)||"Errore modifica famiglia"})}finally{u(!1)}}},Kt=async($t,Cn,fn)=>{var bn,Vt;const Nn=fn>0?`Eliminare "${Cn}" e le sue ${fn} sottofamiglie?`:`Eliminare "${Cn}"?`;if(confirm(Nn)){u(!0);try{await Xn.deleteFamigliaProdotto($t),Mt()}catch(En){s({type:"error",text:((Vt=(bn=En.response)==null?void 0:bn.data)==null?void 0:Vt.error)||"Errore eliminazione famiglia"})}finally{u(!1)}}},tt=$t=>{ft(Cn=>{const fn=new Set(Cn);return fn.has($t)?fn.delete($t):fn.add($t),fn})},mt=$t=>{de($t.id),be($t.nome),Qe($t.descrizione||""),qe($t.colore||"#3b82f6")},Pe=$t=>{L($t),x(!0)},gn=($t,Cn=0)=>$t.flatMap(fn=>[{id:fn.id,nome:fn.nome,level:Cn},...fn.children?gn(fn.children,Cn+1):[]]),Et=gn(e),ze=($t,Cn=0)=>$t.map(fn=>k.jsxs("div",{children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 12px",paddingLeft:`${12+Cn*24}px`,background:Cn===0?"var(--bg-primary)":"transparent",borderRadius:Cn===0?"8px":"0",borderBottom:Cn>0?"1px solid var(--border-color)":"none"},children:[fn.children&&fn.children.length>0?k.jsx("button",{onClick:()=>tt(fn.id),style:{background:"none",border:"none",cursor:"pointer",fontSize:"12px",color:"var(--text-secondary)",width:"20px"},children:Je.has(fn.id)?"":""}):k.jsx("span",{style:{width:"20px"}}),ie===fn.id?k.jsxs(k.Fragment,{children:[k.jsx("input",{type:"color",value:we,onChange:Nn=>qe(Nn.target.value),style:{width:"32px",height:"32px",padding:"0",border:"2px solid var(--border-color)",borderRadius:"6px",cursor:"pointer"},title:"Colore parabola sulla mappa"}),k.jsx("input",{type:"text",className:"form-input",value:fe,onChange:Nn=>be(Nn.target.value),style:{flex:1},autoFocus:!0}),k.jsx("button",{className:"btn btn-primary",onClick:()=>Nt(fn.id),disabled:a,style:{padding:"4px 12px",fontSize:"12px"},children:"Salva"}),k.jsx("button",{className:"btn btn-secondary",onClick:()=>de(null),style:{padding:"4px 12px",fontSize:"12px"},children:""})]}):k.jsxs(k.Fragment,{children:[k.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"50%",backgroundColor:fn.colore||"#94a3b8",border:"2px solid rgba(255,255,255,0.3)",flexShrink:0},title:`Colore: ${fn.colore||"default"}`}),k.jsxs("div",{style:{flex:1},children:[k.jsx("span",{style:{fontWeight:Cn===0?600:400},children:fn.nome}),fn.descrizione&&k.jsxs("span",{style:{fontSize:"12px",color:"var(--text-secondary)",marginLeft:"8px"},children:["- ",fn.descrizione]})]}),k.jsx("button",{onClick:()=>Pe(fn.id),title:"Aggiungi sottofamiglia",style:{padding:"4px 8px",background:"var(--bg-secondary)",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"+"}),k.jsx("button",{onClick:()=>mt(fn),style:{padding:"4px 8px",background:"var(--bg-secondary)",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"Modifica"}),k.jsx("button",{onClick:()=>Kt(fn.id,fn.nome,fn.num_figli||0),style:{padding:"4px 8px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:""})]})]}),fn.children&&fn.children.length>0&&Je.has(fn.id)&&k.jsx("div",{style:{marginLeft:"0"},children:ze(fn.children,Cn+1)})]},fn.id));return k.jsxs("div",{children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[k.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"13px",margin:0},children:"Organizza i prodotti in famiglie e sottofamiglie gerarchiche"}),k.jsx("button",{className:"btn btn-primary",onClick:()=>{x(!0),L(null)},style:{padding:"6px 12px",fontSize:"13px"},children:"+ Nuova Famiglia"})]}),f&&k.jsx("div",{style:{padding:"12px",borderRadius:"8px",background:f.type==="success"?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:f.type==="success"?"#22c55e":"#ef4444",marginBottom:"16px"},children:f.text}),v&&k.jsxs("div",{style:{background:"var(--bg-primary)",padding:"16px",borderRadius:"8px",marginBottom:"16px"},children:[k.jsx("h4",{style:{fontSize:"14px",fontWeight:600,marginBottom:"12px"},children:P?"Nuova sottofamiglia":"Nuova famiglia principale"}),k.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",marginBottom:"12px"},children:[k.jsxs("div",{style:{flex:1,minWidth:"150px"},children:[k.jsx("label",{style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"var(--text-secondary)"},children:"Nome"}),k.jsx("input",{type:"text",className:"form-input",value:A,onChange:$t=>C($t.target.value),placeholder:"es: Pitture",autoFocus:!0})]}),k.jsxs("div",{style:{flex:1,minWidth:"150px"},children:[k.jsx("label",{style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"var(--text-secondary)"},children:"Famiglia padre"}),k.jsxs("select",{className:"form-input",value:P||"",onChange:$t=>L($t.target.value||null),children:[k.jsx("option",{value:"",children:"-- Nessuna (radice) --"}),Et.map($t=>k.jsxs("option",{value:$t.id,children:["  ".repeat($t.level),$t.nome]},$t.id))]})]})]}),k.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap",marginBottom:"12px"},children:[k.jsxs("div",{style:{flex:2,minWidth:"200px"},children:[k.jsx("label",{style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"var(--text-secondary)"},children:"Descrizione (opzionale)"}),k.jsx("input",{type:"text",className:"form-input",value:F,onChange:$t=>U($t.target.value),placeholder:"es: Tutte le pitture per interni ed esterni"})]}),k.jsxs("div",{style:{minWidth:"80px"},children:[k.jsx("label",{style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"var(--text-secondary)"},children:"Colore mappa"}),k.jsx("input",{type:"color",value:$,onChange:$t=>X($t.target.value),style:{width:"100%",height:"38px",padding:"2px",border:"1px solid var(--border-color)",borderRadius:"6px",cursor:"pointer"}})]}),k.jsxs("div",{style:{minWidth:"120px"},children:[k.jsx("label",{style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"var(--text-secondary)"},children:"Visibilit"}),k.jsxs("select",{className:"form-input",value:q,onChange:$t=>G($t.target.value),children:[k.jsx("option",{value:"aziendale",children:"Aziendale"}),k.jsx("option",{value:"personale",children:"Personale"})]})]})]}),k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("button",{className:"btn btn-primary",onClick:Pt,disabled:a||!A.trim(),children:a?"...":"Crea"}),k.jsx("button",{className:"btn btn-secondary",onClick:()=>{x(!1),C(""),L(null),U(""),G("aziendale"),X("#3b82f6")},children:"Annulla"})]})]}),n?k.jsx("p",{style:{color:"var(--text-secondary)"},children:"Caricamento..."}):e.length===0?k.jsxs("div",{style:{textAlign:"center",padding:"48px",color:"var(--text-secondary)"},children:[k.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:""}),k.jsx("p",{children:"Nessuna famiglia prodotto definita."}),k.jsx("p",{style:{fontSize:"13px"},children:"Crea la prima famiglia per organizzare i tuoi prodotti."})]}):k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:ze(e)}),e.length===0&&!v&&k.jsxs("div",{style:{marginTop:"24px",padding:"16px",background:"var(--bg-primary)",borderRadius:"8px"},children:[k.jsx("h4",{style:{fontSize:"13px",fontWeight:600,marginBottom:"8px"},children:"Esempio struttura:"}),k.jsx("pre",{style:{fontSize:"12px",color:"var(--text-secondary)",margin:0},children:`PITTURE
 Idropitture
 Smalti
 Primer/Fissativi

CAPPOTTO
 Pannelli EPS
 Rasante
 Finitura`})]})]})}const CR={cerchio:"",quadrato:"",triangolo:"",stella:"",croce:"",esagono:""};function mDe(){const[e,t]=B.useState([]),[n,r]=B.useState([]),[a,u]=B.useState({}),[f,s]=B.useState([]),[v,x]=B.useState(!0),[A,C]=B.useState(new Set),[P,L]=B.useState(null),[F,U]=B.useState(""),[q,G]=B.useState(!1),[$,X]=B.useState(null),[ie,de]=B.useState(!1),[fe,be]=B.useState(null),[ve,Qe]=B.useState(!1),[we,qe]=B.useState(""),[Je,ft]=B.useState("cerchio"),[Mt,Pt]=B.useState("#3b82f6"),[Nt,Kt]=B.useState(""),[tt,mt]=B.useState(""),[Pe,gn]=B.useState("testo"),[Et,ze]=B.useState(!1),[$t,Cn]=B.useState(!1),[fn,Nn]=B.useState(!1),[bn,Vt]=B.useState(!1),[En,Sn]=B.useState(!1),[Un,nn]=B.useState(null);B.useEffect(()=>{wr()},[]);const wr=async()=>{x(!0);try{const[wt,Rn,nr]=await Promise.all([Xn.get("/tipi"),Xn.get("/tipologie"),Xn.get("/tipi-connessione")]);t(wt.data.data),r(Rn.data.data),s(nr.data.data),C(new Set(wt.data.data.map(dt=>dt.id)))}catch(wt){console.error("Errore caricamento:",wt),ar("error","Errore caricamento dati")}finally{x(!1)}},Xr=async wt=>{try{const Rn=await Xn.get(`/campi?tipo=${wt}`);u(nr=>({...nr,[wt]:Rn.data.data}))}catch(Rn){console.error("Errore caricamento campi:",Rn)}},ar=(wt,Rn)=>{nn({type:wt,text:Rn}),setTimeout(()=>nn(null),3e3)},tr=wt=>{C(Rn=>{const nr=new Set(Rn);return nr.has(wt)?nr.delete(wt):nr.add(wt),nr})},Vn=async()=>{if(we.trim()){Sn(!0);try{const wt=await Xn.post("/tipi",{nome:we.trim(),forma:Je,is_acquirente:Et,is_venditore:$t,is_intermediario:fn,is_influencer:bn});t(Rn=>[...Rn,{id:wt.data.id,nome:we.trim(),forma:Je,ordine:Rn.length,is_acquirente:Et,is_venditore:$t,is_intermediario:fn,is_influencer:bn}]),C(Rn=>new Set([...Rn,wt.data.id])),qe(""),ze(!1),Cn(!1),Nn(!1),Vt(!1),G(!1),ar("success","Tipo creato")}catch{ar("error","Errore creazione tipo")}finally{Sn(!1)}}},xr=async(wt,Rn)=>{Sn(!0);try{await Xn.put(`/tipi/${wt}`,Rn),t(nr=>nr.map(dt=>dt.id===wt?{...dt,...Rn}:dt)),L(null),ar("success","Tipo aggiornato")}catch{ar("error","Errore aggiornamento")}finally{Sn(!1)}},ws=async wt=>{var Rn,nr;if(confirm("Eliminare questo tipo e tutte le sue tipologie?")){Sn(!0);try{await Xn.delete(`/tipi/${wt}`),t(dt=>dt.filter(Jn=>Jn.id!==wt)),r(dt=>dt.filter(Jn=>Jn.tipo_id!==wt)),ar("success","Tipo eliminato")}catch(dt){ar("error",((nr=(Rn=dt.response)==null?void 0:Rn.data)==null?void 0:nr.error)||"Errore eliminazione")}finally{Sn(!1)}}},bi=async wt=>{if(we.trim()){Sn(!0);try{const Rn=await Xn.post("/tipologie",{tipo_id:wt,nome:we.trim(),colore:Mt});r(nr=>[...nr,{id:Rn.data.id,tipo_id:wt,nome:we.trim(),colore:Mt,ordine:nr.filter(dt=>dt.tipo_id===wt).length}]),qe(""),Pt("#3b82f6"),X(null),ar("success","Tipologia creata")}catch{ar("error","Errore creazione tipologia")}finally{Sn(!1)}}},Ai=async(wt,Rn)=>{Sn(!0);try{await Xn.put(`/tipologie/${wt}`,Rn),r(nr=>nr.map(dt=>dt.id===wt?{...dt,...Rn}:dt)),L(null),ar("success","Tipologia aggiornata")}catch{ar("error","Errore aggiornamento")}finally{Sn(!1)}},ps=async wt=>{if(confirm("Eliminare questa tipologia?")){Sn(!0);try{await Xn.delete(`/tipologie/${wt}`),r(Rn=>Rn.filter(nr=>nr.id!==wt)),ar("success","Tipologia eliminata")}catch{ar("error","Errore eliminazione")}finally{Sn(!1)}}},$i=async()=>{if(we.trim()){Sn(!0);try{const wt=await Xn.post("/tipi-connessione",{nome:we.trim(),colore:Mt});s(Rn=>[...Rn,{id:wt.data.id,nome:we.trim(),colore:Mt,ordine:Rn.length}]),qe(""),Pt("#64748b"),de(!1),ar("success","Tipo connessione creato")}catch{ar("error","Errore creazione")}finally{Sn(!1)}}},Ts=async wt=>{var Rn,nr;if(confirm("Eliminare questo tipo connessione?")){Sn(!0);try{await Xn.delete(`/tipi-connessione/${wt}`),s(dt=>dt.filter(Jn=>Jn.id!==wt)),ar("success","Tipo connessione eliminato")}catch(dt){ar("error",((nr=(Rn=dt.response)==null?void 0:Rn.data)==null?void 0:nr.error)||"Errore eliminazione")}finally{Sn(!1)}}},tn=async wt=>{var Rn;if(!(!Nt.trim()||!tt.trim())){Sn(!0);try{const dt={id:(await Xn.post("/campi",{tipo_id:wt,nome:Nt.trim().toLowerCase().replace(/\s+/g,"_"),etichetta:tt.trim(),tipo_dato:Pe})).data.id,tipo_id:wt,nome:Nt.trim().toLowerCase().replace(/\s+/g,"_"),etichetta:tt.trim(),tipo_dato:Pe,obbligatorio:!1,ordine:((Rn=a[wt])==null?void 0:Rn.length)||0};u(Jn=>({...Jn,[wt]:[...Jn[wt]||[],dt]})),Kt(""),mt(""),gn("testo"),Qe(!1),ar("success","Campo creato")}catch{ar("error","Errore creazione campo")}finally{Sn(!1)}}},kn=async(wt,Rn,nr)=>{Sn(!0);try{await Xn.put(`/campi/${wt}`,nr),u(dt=>({...dt,[Rn]:dt[Rn].map(Jn=>Jn.id===wt?{...Jn,...nr}:Jn)})),L(null),ar("success","Campo aggiornato")}catch{ar("error","Errore aggiornamento campo")}finally{Sn(!1)}},Mr=async(wt,Rn)=>{if(confirm("Eliminare questo campo?")){Sn(!0);try{await Xn.delete(`/campi/${wt}`),u(nr=>({...nr,[Rn]:nr[Rn].filter(dt=>dt.id!==wt)})),ar("success","Campo eliminato")}catch{ar("error","Errore eliminazione")}finally{Sn(!1)}}};return v?k.jsx("div",{style:{padding:24,color:"var(--text-secondary)"},children:"Caricamento..."}):k.jsxs("div",{style:{padding:16,maxWidth:600},children:[Un&&k.jsx("div",{style:{padding:12,marginBottom:16,borderRadius:8,background:Un.type==="success"?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:Un.type==="success"?"#22c55e":"#ef4444"},children:Un.text}),k.jsxs("div",{style:{marginBottom:32},children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[k.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:600},children:"Tipi Entit"}),k.jsx("button",{className:"btn btn-primary",onClick:()=>G(!0),style:{padding:"6px 12px",fontSize:13},children:"+ Nuovo Tipo"})]}),q&&k.jsxs("div",{style:{background:"var(--bg-secondary)",padding:16,borderRadius:8,marginBottom:16,border:"1px solid var(--border-color)"},children:[k.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"flex-end"},children:[k.jsxs("div",{style:{flex:1,minWidth:150},children:[k.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4,color:"var(--text-secondary)"},children:"Nome"}),k.jsx("input",{type:"text",className:"form-input",value:we,onChange:wt=>qe(wt.target.value),placeholder:"es: Cantiere",autoFocus:!0})]}),k.jsxs("div",{style:{width:120},children:[k.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4,color:"var(--text-secondary)"},children:"Forma"}),k.jsx("select",{className:"form-input",value:Je,onChange:wt=>ft(wt.target.value),children:Object.entries(CR).map(([wt,Rn])=>k.jsxs("option",{value:wt,children:[Rn," ",wt]},wt))})]})]}),k.jsxs("div",{style:{marginTop:12},children:[k.jsx("label",{style:{display:"block",fontSize:12,marginBottom:8,color:"var(--text-secondary)"},children:"Natura commerciale (default per questo tipo)"}),k.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap"},children:[k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13,cursor:"pointer"},children:[k.jsx("input",{type:"checkbox",checked:Et,onChange:wt=>ze(wt.target.checked)}),k.jsx("span",{title:"Compra prodotti/servizi",children:" Acquirente"})]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13,cursor:"pointer"},children:[k.jsx("input",{type:"checkbox",checked:$t,onChange:wt=>Cn(wt.target.checked)}),k.jsx("span",{title:"Vende prodotti/servizi",children:" Venditore"})]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13,cursor:"pointer"},children:[k.jsx("input",{type:"checkbox",checked:fn,onChange:wt=>Nn(wt.target.checked)}),k.jsx("span",{title:"Compra e rivende",children:" Intermediario"})]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,fontSize:13,cursor:"pointer"},children:[k.jsx("input",{type:"checkbox",checked:bn,onChange:wt=>Vt(wt.target.checked)}),k.jsx("span",{title:"Prescrive/influenza acquisti",children:" Influencer"})]})]})]}),k.jsxs("div",{style:{display:"flex",gap:12,marginTop:16},children:[k.jsx("button",{className:"btn btn-primary",onClick:Vn,disabled:En||!we.trim(),children:"Crea"}),k.jsx("button",{className:"btn btn-secondary",onClick:()=>{G(!1),qe("")},children:"Annulla"})]})]}),k.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.map(wt=>{const Rn=A.has(wt.id),nr=n.filter(dt=>dt.tipo_id===wt.id);return k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:8,border:"1px solid var(--border-color)",overflow:"hidden"},children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"12px 16px",cursor:"pointer",background:Rn?"var(--bg-primary)":"transparent"},onClick:()=>tr(wt.id),children:[k.jsx("span",{style:{fontSize:12,color:"var(--text-secondary)",width:16,textAlign:"center"},children:Rn?"":""}),k.jsx("span",{style:{fontSize:20,width:28,textAlign:"center"},children:CR[wt.forma]||""}),P===wt.id?k.jsx("input",{type:"text",className:"form-input",value:F,onChange:dt=>U(dt.target.value),onBlur:()=>{F.trim()&&F!==wt.nome?xr(wt.id,{nome:F.trim()}):L(null)},onKeyDown:dt=>{dt.key==="Enter"?xr(wt.id,{nome:F.trim()}):dt.key==="Escape"&&L(null)},onClick:dt=>dt.stopPropagation(),autoFocus:!0,style:{flex:1}}):k.jsx("span",{style:{flex:1,fontWeight:500},onDoubleClick:dt=>{dt.stopPropagation(),L(wt.id),U(wt.nome)},children:wt.nome}),k.jsxs("span",{style:{fontSize:11,color:"var(--text-secondary)"},children:[nr.length," tipologie"]}),k.jsxs("div",{style:{display:"flex",gap:4},onClick:dt=>dt.stopPropagation(),children:[k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:2,fontSize:11,cursor:"pointer",padding:"2px 4px",background:wt.is_acquirente?"rgba(59, 130, 246, 0.2)":"var(--bg-primary)",borderRadius:4},title:"Acquirente",children:[k.jsx("input",{type:"checkbox",checked:!!wt.is_acquirente,onChange:dt=>xr(wt.id,{is_acquirente:dt.target.checked}),style:{width:12,height:12}}),""]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:2,fontSize:11,cursor:"pointer",padding:"2px 4px",background:wt.is_venditore?"rgba(34, 197, 94, 0.2)":"var(--bg-primary)",borderRadius:4},title:"Venditore",children:[k.jsx("input",{type:"checkbox",checked:!!wt.is_venditore,onChange:dt=>xr(wt.id,{is_venditore:dt.target.checked}),style:{width:12,height:12}}),""]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:2,fontSize:11,cursor:"pointer",padding:"2px 4px",background:wt.is_intermediario?"rgba(234, 179, 8, 0.2)":"var(--bg-primary)",borderRadius:4},title:"Intermediario",children:[k.jsx("input",{type:"checkbox",checked:!!wt.is_intermediario,onChange:dt=>xr(wt.id,{is_intermediario:dt.target.checked}),style:{width:12,height:12}}),""]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:2,fontSize:11,cursor:"pointer",padding:"2px 4px",background:wt.is_influencer?"rgba(168, 85, 247, 0.2)":"var(--bg-primary)",borderRadius:4},title:"Influencer",children:[k.jsx("input",{type:"checkbox",checked:!!wt.is_influencer,onChange:dt=>xr(wt.id,{is_influencer:dt.target.checked}),style:{width:12,height:12}}),""]})]}),k.jsx("select",{className:"form-input",value:wt.forma,onChange:dt=>{dt.stopPropagation(),xr(wt.id,{forma:dt.target.value})},onClick:dt=>dt.stopPropagation(),style:{width:100,padding:"4px 8px",fontSize:12},children:Object.entries(CR).map(([dt,Jn])=>k.jsxs("option",{value:dt,children:[Jn," ",dt]},dt))}),k.jsx("button",{onClick:dt=>{dt.stopPropagation(),be(fe===wt.id?null:wt.id),a[wt.id]||Xr(wt.id)},style:{padding:"4px 8px",background:fe===wt.id?"var(--primary)":"var(--bg-primary)",color:fe===wt.id?"white":"var(--text-primary)",border:"none",borderRadius:4,cursor:"pointer",fontSize:11},title:"Campi personalizzati",children:"Campi"}),k.jsx("button",{onClick:dt=>{dt.stopPropagation(),ws(wt.id)},style:{padding:"4px 8px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",border:"none",borderRadius:4,cursor:"pointer",fontSize:11},children:""})]}),fe===wt.id&&k.jsxs("div",{style:{padding:16,background:"var(--bg-primary)",borderTop:"1px solid var(--border-color)"},children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[k.jsx("span",{style:{fontSize:13,fontWeight:500},children:"Campi personalizzati"}),k.jsx("button",{className:"btn btn-primary",onClick:()=>Qe(!0),style:{padding:"4px 8px",fontSize:11},children:"+ Campo"})]}),ve&&k.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"},children:[k.jsx("input",{type:"text",className:"form-input",placeholder:"Etichetta (es: Progettista)",value:tt,onChange:dt=>{mt(dt.target.value),Kt(dt.target.value.toLowerCase().replace(/\s+/g,"_"))},style:{flex:1,minWidth:150}}),k.jsxs("select",{className:"form-input",value:Pe,onChange:dt=>gn(dt.target.value),style:{width:100},children:[k.jsx("option",{value:"testo",children:"Testo"}),k.jsx("option",{value:"textarea",children:"Area testo"}),k.jsx("option",{value:"numero",children:"Numero"}),k.jsx("option",{value:"data",children:"Data"}),k.jsx("option",{value:"email",children:"Email"}),k.jsx("option",{value:"telefono",children:"Telefono"}),k.jsx("option",{value:"url",children:"URL"}),k.jsx("option",{value:"select",children:"Select"})]}),k.jsx("button",{className:"btn btn-primary",onClick:()=>tn(wt.id),disabled:En,children:"Crea"}),k.jsx("button",{className:"btn btn-secondary",onClick:()=>Qe(!1),children:""})]}),(a[wt.id]||[]).length===0?k.jsx("p",{style:{color:"var(--text-secondary)",fontSize:12,margin:0},children:"Nessun campo personalizzato"}):k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:(a[wt.id]||[]).map(dt=>k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 8px",background:"var(--bg-secondary)",borderRadius:4,fontSize:12},children:[P===dt.id?k.jsx("input",{type:"text",className:"form-input",value:F,onChange:Jn=>U(Jn.target.value),onBlur:()=>{F.trim()&&F!==dt.etichetta?kn(dt.id,wt.id,{etichetta:F.trim()}):L(null)},onKeyDown:Jn=>{Jn.key==="Enter"?kn(dt.id,wt.id,{etichetta:F.trim()}):Jn.key==="Escape"&&L(null)},autoFocus:!0,style:{flex:1,fontSize:12}}):k.jsx("span",{style:{flex:1},children:dt.etichetta}),k.jsxs("select",{className:"form-input",value:dt.tipo_dato,onChange:Jn=>kn(dt.id,wt.id,{tipo_dato:Jn.target.value}),style:{width:90,padding:"2px 4px",fontSize:11},children:[k.jsx("option",{value:"testo",children:"Testo"}),k.jsx("option",{value:"textarea",children:"Area testo"}),k.jsx("option",{value:"numero",children:"Numero"}),k.jsx("option",{value:"data",children:"Data"}),k.jsx("option",{value:"email",children:"Email"}),k.jsx("option",{value:"telefono",children:"Telefono"}),k.jsx("option",{value:"url",children:"URL"}),k.jsx("option",{value:"select",children:"Select"})]}),k.jsx("button",{onClick:()=>{L(dt.id),U(dt.etichetta)},style:{background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:12},title:"Modifica etichetta",children:""}),k.jsx("button",{onClick:()=>Mr(dt.id,wt.id),style:{background:"none",border:"none",color:"#ef4444",cursor:"pointer",fontSize:11},title:"Elimina campo",children:""})]},dt.id))})]}),Rn&&k.jsxs("div",{style:{padding:"0 16px 12px 48px"},children:[nr.map(dt=>k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 0",borderBottom:"1px solid var(--border-color)"},children:[k.jsx("span",{style:{fontSize:10,color:"var(--text-secondary)"},children:""}),k.jsx("input",{type:"color",value:dt.colore,onChange:Jn=>Ai(dt.id,{colore:Jn.target.value}),style:{width:24,height:24,padding:0,border:"none",borderRadius:4,cursor:"pointer"}}),P===dt.id?k.jsx("input",{type:"text",className:"form-input",value:F,onChange:Jn=>U(Jn.target.value),onBlur:()=>{F.trim()&&F!==dt.nome?Ai(dt.id,{nome:F.trim()}):L(null)},onKeyDown:Jn=>{Jn.key==="Enter"?Ai(dt.id,{nome:F.trim()}):Jn.key==="Escape"&&L(null)},autoFocus:!0,style:{flex:1,fontSize:13}}):k.jsx("span",{style:{flex:1,fontSize:13},onDoubleClick:()=>{L(dt.id),U(dt.nome)},children:dt.nome}),k.jsx("button",{onClick:()=>ps(dt.id),style:{padding:"2px 6px",background:"none",color:"#ef4444",border:"none",cursor:"pointer",fontSize:11,opacity:.6},children:""})]},dt.id)),$===wt.id?k.jsxs("div",{style:{display:"flex",gap:8,padding:"8px 0",alignItems:"center"},children:[k.jsx("span",{style:{fontSize:10,color:"var(--text-secondary)"},children:""}),k.jsx("input",{type:"color",value:Mt,onChange:dt=>Pt(dt.target.value),style:{width:24,height:24,padding:0,border:"none",borderRadius:4}}),k.jsx("input",{type:"text",className:"form-input",placeholder:"Nome tipologia",value:we,onChange:dt=>qe(dt.target.value),onKeyDown:dt=>{dt.key==="Enter"&&bi(wt.id),dt.key==="Escape"&&(X(null),qe(""))},autoFocus:!0,style:{flex:1,fontSize:13}}),k.jsx("button",{className:"btn btn-primary",onClick:()=>bi(wt.id),style:{padding:"4px 8px",fontSize:11},children:""}),k.jsx("button",{className:"btn btn-secondary",onClick:()=>{X(null),qe("")},style:{padding:"4px 8px",fontSize:11},children:""})]}):k.jsxs("button",{onClick:()=>X(wt.id),style:{display:"flex",alignItems:"center",gap:8,padding:"8px 0",background:"none",border:"none",color:"var(--primary)",cursor:"pointer",fontSize:12,width:"100%"},children:[k.jsx("span",{style:{fontSize:10,color:"var(--text-secondary)"},children:""}),"+ Aggiungi tipologia"]})]})]},wt.id)}),e.length===0&&k.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",padding:24},children:"Nessun tipo definito. Crea il primo tipo per iniziare."})]})]}),k.jsx("hr",{style:{border:"none",borderTop:"1px solid var(--border-color)",margin:"24px 0"}}),k.jsxs("div",{children:[k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[k.jsx("h3",{style:{margin:0,fontSize:16,fontWeight:600},children:"Tipi Connessione"}),k.jsx("button",{className:"btn btn-primary",onClick:()=>de(!0),style:{padding:"6px 12px",fontSize:13},children:"+ Nuovo Tipo"})]}),ie&&k.jsx("div",{style:{background:"var(--bg-secondary)",padding:16,borderRadius:8,marginBottom:16,border:"1px solid var(--border-color)"},children:k.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-end"},children:[k.jsxs("div",{style:{flex:1},children:[k.jsx("label",{style:{display:"block",fontSize:12,marginBottom:4,color:"var(--text-secondary)"},children:"Nome"}),k.jsx("input",{type:"text",className:"form-input",value:we,onChange:wt=>qe(wt.target.value),placeholder:"es: Fornisce",autoFocus:!0})]}),k.jsx("input",{type:"color",value:Mt,onChange:wt=>Pt(wt.target.value),style:{width:40,height:38,padding:0,border:"none",borderRadius:4}}),k.jsx("button",{className:"btn btn-primary",onClick:$i,disabled:En||!we.trim(),children:"Crea"}),k.jsx("button",{className:"btn btn-secondary",onClick:()=>{de(!1),qe(""),Pt("#64748b")},children:"Annulla"})]})}),k.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[f.map(wt=>k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"12px 16px",background:"var(--bg-secondary)",borderRadius:8,border:"1px solid var(--border-color)"},children:[k.jsx("div",{style:{width:40,height:4,background:wt.colore,borderRadius:2}}),k.jsx("input",{type:"color",value:wt.colore,onChange:Rn=>{const nr={colore:Rn.target.value};Xn.put(`/tipi-connessione/${wt.id}`,nr),s(dt=>dt.map(Jn=>Jn.id===wt.id?{...Jn,...nr}:Jn))},style:{width:24,height:24,padding:0,border:"none",borderRadius:4,cursor:"pointer"}}),k.jsx("span",{style:{flex:1,fontWeight:500},children:wt.nome}),wt.num_connessioni!==void 0&&k.jsxs("span",{style:{fontSize:11,color:"var(--text-secondary)"},children:[wt.num_connessioni," connessioni"]}),k.jsx("button",{onClick:()=>Ts(wt.id),style:{padding:"4px 8px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",border:"none",borderRadius:4,cursor:"pointer",fontSize:11},children:""})]},wt.id)),f.length===0&&k.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",padding:24},children:"Nessun tipo connessione definito."})]})]})]})}function gDe({user:e,onClose:t,onUserUpdate:n}){var wt,Rn,nr;const[r,a]=B.useState("profilo"),u=B.useRef(null),[f,s]=B.useState(e.nome),[v,x]=B.useState(e.foto_url||""),[A,C]=B.useState(null),[P,L]=B.useState(!1),[F,U]=B.useState(!1),[q,G]=B.useState(null),[$,X]=B.useState(""),[ie,de]=B.useState(""),[fe,be]=B.useState(""),[ve,Qe]=B.useState(!1),[we,qe]=B.useState(null),[Je,ft]=B.useState([]),[Mt,Pt]=B.useState(!1),[Nt,Kt]=B.useState(null),[tt,mt]=B.useState(!1),[Pe,gn]=B.useState(!1),[Et,ze]=B.useState(""),[$t,Cn]=B.useState(!1),[fn,Nn]=B.useState(null),bn=e.ruolo_azienda==="admin",[Vt,En]=B.useState(null),[Sn,Un]=B.useState(!1),[nn,wr]=B.useState(!1),[Xr,ar]=B.useState(null),tr=e.codice_pairing?`${window.location.origin}/genagenta/register?codice=${e.codice_pairing}`:"",Vn=async()=>{try{await navigator.clipboard.writeText(tr),gn(!0),setTimeout(()=>gn(!1),2e3)}catch{const dt=document.createElement("textarea");dt.value=tr,document.body.appendChild(dt),dt.select(),document.execCommand("copy"),document.body.removeChild(dt),gn(!0),setTimeout(()=>gn(!1),2e3)}},xr=()=>{const dt=`Unisciti al team ${e.nome_azienda||"aziendale"} su GenAgenTa!

Clicca qui per registrarti:
${tr}

Oppure usa il codice: ${e.codice_pairing}`;window.open(`https://wa.me/?text=${encodeURIComponent(dt)}`,"_blank")},ws=async()=>{var dt,Jn;if(Et.trim()){Cn(!0),Nn(null);try{const qr=await Xn.invitaCollega(Et.trim());Nn({type:"success",text:qr.message}),ze("")}catch(qr){Nn({type:"error",text:((Jn=(dt=qr.response)==null?void 0:dt.data)==null?void 0:Jn.error)||"Errore invio invito"})}finally{Cn(!1)}}};B.useEffect(()=>{r==="team"&&e.azienda_id&&ps()},[r,e.azienda_id]),B.useEffect(()=>{r==="agea"&&bi()},[r]);const bi=async()=>{Un(!0),ar(null);try{const dt=await Xn.getAgeaMemory();En(dt.memory)}catch(dt){console.error("Errore caricamento memoria Agea:",dt),ar({type:"error",text:"Errore caricamento memoria"})}finally{Un(!1)}},Ai=async()=>{if(confirm("Sei sicuro di voler cancellare la memoria di Agea? Non ricorder pi le conversazioni passate.")){wr(!0),ar(null);try{await Xn.resetAgeaMemory(),ar({type:"success",text:"Memoria di Agea azzerata!"}),await bi()}catch(dt){console.error("Errore reset memoria:",dt),ar({type:"error",text:"Errore reset memoria"})}finally{wr(!1)}}},ps=async()=>{Pt(!0);try{const dt=await Xn.getAziendaMembri();ft(dt.data)}catch(dt){console.error("Errore caricamento membri:",dt)}finally{Pt(!1)}},$i=async dt=>{var ts,ms,Mn;const Jn=(ts=dt.target.files)==null?void 0:ts[0];if(!Jn)return;if(Jn.size>2*1024*1024){G({type:"error",text:"File troppo grande (max 2MB)"});return}if(!["image/jpeg","image/png","image/gif","image/webp"].includes(Jn.type)){G({type:"error",text:"Tipo file non permesso. Usa JPG, PNG, GIF o WebP"});return}const qr=new FileReader;qr.onload=Tt=>{var ut;return C((ut=Tt.target)==null?void 0:ut.result)},qr.readAsDataURL(Jn),L(!0),G(null);try{const Tt=await Xn.uploadFoto(Jn);x(Tt.foto_url),C(null),n({foto_url:Tt.foto_url}),G({type:"success",text:"Foto caricata!"})}catch(Tt){G({type:"error",text:((Mn=(ms=Tt.response)==null?void 0:ms.data)==null?void 0:Mn.error)||"Errore caricamento foto"}),C(null)}finally{L(!1),u.current&&(u.current.value="")}},Ts=async()=>{var dt,Jn;U(!0),G(null);try{await Xn.updateProfile({nome:f}),n({nome:f}),G({type:"success",text:"Profilo aggiornato!"})}catch(qr){G({type:"error",text:((Jn=(dt=qr.response)==null?void 0:dt.data)==null?void 0:Jn.error)||"Errore aggiornamento profilo"})}finally{U(!1)}},tn=async()=>{var dt,Jn;if(ie!==fe){qe({type:"error",text:"Le password non coincidono"});return}if(ie.length<6){qe({type:"error",text:"La password deve essere di almeno 6 caratteri"});return}Qe(!0),qe(null);try{await Xn.changePassword({password_attuale:$,nuova_password:ie,conferma_password:fe}),qe({type:"success",text:"Password aggiornata!"}),X(""),de(""),be("")}catch(qr){qe({type:"error",text:((Jn=(dt=qr.response)==null?void 0:dt.data)==null?void 0:Jn.error)||"Errore cambio password"})}finally{Qe(!1)}},kn=async(dt,Jn)=>{var qr,ts;if(confirm(`Sei sicuro di voler rimuovere ${Jn} dall'azienda?`)){Kt(dt);try{await Xn.removeAziendaMembro(dt),ft(Je.filter(ms=>ms.id!==dt))}catch(ms){alert(((ts=(qr=ms.response)==null?void 0:qr.data)==null?void 0:ts.error)||"Errore rimozione membro")}finally{Kt(null)}}},Mr=dt=>dt.split(" ").map(Jn=>Jn[0]).join("").toUpperCase().slice(0,2);return k.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},onClick:dt=>dt.target===dt.currentTarget&&t(),children:k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"16px",width:"100%",maxWidth:"600px",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:[k.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[k.jsx("h2",{style:{fontSize:"18px",fontWeight:600},children:"Impostazioni"}),k.jsx("button",{onClick:t,style:{background:"transparent",border:"none",fontSize:"24px",cursor:"pointer",color:"var(--text-secondary)",lineHeight:1},children:""})]}),k.jsx("div",{style:{display:"flex",borderBottom:"1px solid var(--border-color)",padding:"0 24px"},children:[{id:"profilo",label:" Profilo"},{id:"categorie",label:" Entit"},{id:"prodotti",label:" Prodotti"},...e.azienda_id?[{id:"team",label:" Team"}]:[],{id:"agea",label:" Agea"},{id:"password",label:" Password"},{id:"info",label:" Info"}].map(dt=>k.jsx("button",{onClick:()=>a(dt.id),style:{padding:"12px 16px",background:"transparent",border:"none",borderBottom:r===dt.id?"2px solid var(--primary)":"2px solid transparent",color:r===dt.id?"var(--primary)":"var(--text-secondary)",cursor:"pointer",fontSize:"14px",fontWeight:500},children:dt.label},dt.id))}),k.jsxs("div",{style:{padding:"24px",overflowY:"auto",flex:1},children:[r==="profilo"&&k.jsxs("div",{children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"24px"},children:[k.jsxs("div",{style:{position:"relative"},children:[k.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:A||v?`url(${A||v}) center/cover`:"linear-gradient(135deg, var(--primary), #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",fontWeight:600,color:"white",opacity:P?.5:1},children:!(A||v)&&Mr(f)}),P&&k.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center"},children:k.jsx("div",{style:{fontSize:"12px"},children:"..."})})]}),k.jsxs("div",{children:[k.jsx("div",{style:{fontWeight:600,fontSize:"16px"},children:f}),k.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"13px",marginBottom:"8px"},children:e.email}),k.jsx("input",{ref:u,type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",onChange:$i,style:{display:"none"}}),k.jsx("button",{type:"button",onClick:()=>{var dt;return(dt=u.current)==null?void 0:dt.click()},disabled:P,style:{padding:"6px 12px",background:"var(--bg-primary)",border:"1px solid var(--border-color)",borderRadius:"6px",color:"var(--text-primary)",cursor:"pointer",fontSize:"12px"},children:P?"Caricamento...":"Cambia foto"})]})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Nome visualizzato"}),k.jsx("input",{type:"text",className:"form-input",value:f,onChange:dt=>s(dt.target.value),placeholder:"Il tuo nome"})]}),q&&k.jsx("div",{style:{padding:"12px",borderRadius:"8px",background:q.type==="success"?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:q.type==="success"?"#22c55e":"#ef4444",marginBottom:"16px"},children:q.text}),k.jsx("button",{className:"btn btn-primary",onClick:Ts,disabled:F||!f.trim(),style:{width:"100%"},children:F?"Salvataggio...":"Salva modifiche"})]}),r==="password"&&k.jsxs("div",{children:[k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Password attuale"}),k.jsx("input",{type:"password",className:"form-input",value:$,onChange:dt=>X(dt.target.value),placeholder:"Inserisci la password attuale"})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Nuova password"}),k.jsx("input",{type:"password",className:"form-input",value:ie,onChange:dt=>de(dt.target.value),placeholder:"Minimo 6 caratteri"})]}),k.jsxs("div",{className:"form-group",children:[k.jsx("label",{className:"form-label",children:"Conferma nuova password"}),k.jsx("input",{type:"password",className:"form-input",value:fe,onChange:dt=>be(dt.target.value),placeholder:"Ripeti la nuova password"})]}),we&&k.jsx("div",{style:{padding:"12px",borderRadius:"8px",background:we.type==="success"?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:we.type==="success"?"#22c55e":"#ef4444",marginBottom:"16px"},children:we.text}),k.jsx("button",{className:"btn btn-primary",onClick:tn,disabled:ve||!$||!ie||!fe,style:{width:"100%"},children:ve?"Aggiornamento...":"Cambia password"})]}),r==="team"&&k.jsxs("div",{children:[bn&&e.codice_pairing&&k.jsx("div",{style:{marginBottom:"24px"},children:k.jsxs("button",{className:"btn btn-primary",onClick:()=>mt(!0),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[k.jsx("span",{style:{fontSize:"18px"},children:"+"}),"Invita collega"]})}),tt&&k.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3},onClick:dt=>dt.target===dt.currentTarget&&mt(!1),children:k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"16px",padding:"24px",width:"90%",maxWidth:"400px"},children:[k.jsx("h3",{style:{marginBottom:"16px",fontSize:"18px",fontWeight:600},children:"Invita un collega"}),k.jsxs("div",{style:{marginBottom:"24px"},children:[k.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"14px",marginBottom:"12px"},children:"Inserisci l'email del collega. Quando aprir l'app vedr la richiesta di unirsi al team."}),k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("input",{type:"email",className:"form-input",value:Et,onChange:dt=>ze(dt.target.value),placeholder:"email@collega.it",style:{flex:1}}),k.jsx("button",{className:"btn btn-primary",onClick:ws,disabled:$t||!Et.trim(),children:$t?"...":"Invita"})]}),fn&&k.jsx("div",{style:{marginTop:"8px",padding:"8px 12px",borderRadius:"6px",fontSize:"13px",background:fn.type==="success"?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:fn.type==="success"?"#22c55e":"#ef4444"},children:fn.text})]}),k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[k.jsx("div",{style:{flex:1,height:"1px",background:"var(--border-color)"}}),k.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:"oppure condividi"}),k.jsx("div",{style:{flex:1,height:"1px",background:"var(--border-color)"}})]}),k.jsxs("div",{style:{textAlign:"center",marginBottom:"16px"},children:[k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"4px"},children:"Codice team:"}),k.jsx("div",{style:{fontFamily:"monospace",fontSize:"20px",fontWeight:700,color:"var(--primary)",letterSpacing:"2px"},children:e.codice_pairing})]}),k.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:[k.jsx("button",{className:"btn btn-secondary",onClick:Vn,style:{flex:1},children:Pe?" Copiato!":"Copia link"}),k.jsx("button",{className:"btn btn-primary",onClick:xr,style:{flex:1,background:"#25D366"},children:"WhatsApp"})]}),k.jsx("button",{className:"btn btn-secondary",onClick:()=>{mt(!1),Nn(null),ze("")},style:{width:"100%"},children:"Chiudi"})]})}),k.jsxs("h3",{style:{fontSize:"14px",fontWeight:600,marginBottom:"16px"},children:["Membri del team (",Je.length,")"]}),Mt?k.jsx("p",{style:{color:"var(--text-secondary)"},children:"Caricamento..."}):k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:Je.map(dt=>k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",background:"var(--bg-primary)",borderRadius:"8px"},children:[k.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:dt.foto_url?`url(${dt.foto_url}) center/cover`:"linear-gradient(135deg, var(--primary), #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:600,color:"white",flexShrink:0},children:!dt.foto_url&&Mr(dt.nome)}),k.jsxs("div",{style:{flex:1,minWidth:0},children:[k.jsxs("div",{style:{fontWeight:500,display:"flex",alignItems:"center",gap:"8px"},children:[dt.nome,dt.is_me&&k.jsx("span",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:"(tu)"}),dt.ruolo_azienda==="admin"&&k.jsx("span",{style:{background:"var(--primary)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"10px"},children:"Admin"})]}),k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:dt.email})]}),bn&&!dt.is_me&&dt.ruolo_azienda!=="admin"&&k.jsx("button",{onClick:()=>kn(dt.id,dt.nome),disabled:Nt===dt.id,style:{padding:"6px 12px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"12px"},children:Nt===dt.id?"...":"Rimuovi"})]},dt.id))})]}),r==="categorie"&&k.jsx(mDe,{}),r==="prodotti"&&k.jsx(pDe,{}),r==="agea"&&k.jsxs("div",{children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"24px",padding:"16px",background:"linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1))",borderRadius:"12px"},children:[k.jsx("div",{style:{width:"60px",height:"60px",borderRadius:"50%",background:"linear-gradient(135deg, #6366f1, #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"28px"},children:""}),k.jsxs("div",{children:[k.jsx("div",{style:{fontSize:"18px",fontWeight:600},children:"Agea"}),k.jsx("div",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:"La tua assistente AI personale"})]})]}),Xr&&k.jsx("div",{style:{padding:"12px",borderRadius:"8px",background:Xr.type==="success"?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:Xr.type==="success"?"#22c55e":"#ef4444",marginBottom:"16px"},children:Xr.text}),Sn?k.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",padding:"40px 0"},children:"Caricamento memoria..."}):Vt?k.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[Vt.ultimo_aggiornamento&&k.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:["Ultimo aggiornamento: ",new Date(Vt.ultimo_aggiornamento).toLocaleString("it-IT")]}),k.jsxs("div",{style:{background:"var(--bg-primary)",borderRadius:"12px",padding:"16px"},children:[k.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("span",{children:""})," Argomenti recenti"]}),(Rn=(wt=Vt.utente)==null?void 0:wt.interessi_recenti)!=null&&Rn.length?k.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:Vt.utente.interessi_recenti.map((dt,Jn)=>k.jsx("span",{style:{padding:"4px 12px",background:"rgba(99, 102, 241, 0.1)",color:"var(--primary)",borderRadius:"20px",fontSize:"13px"},children:dt},Jn))}):k.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"13px",margin:0},children:"Nessun argomento memorizzato ancora"})]}),k.jsxs("div",{style:{background:"var(--bg-primary)",borderRadius:"12px",padding:"16px"},children:[k.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("span",{children:""})," Entit seguite"]}),Vt.entita_importanti&&Object.keys(Vt.entita_importanti).length>0?k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:Object.entries(Vt.entita_importanti).slice(0,5).map(([dt,Jn])=>k.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",background:"var(--bg-secondary)",borderRadius:"8px"},children:[k.jsxs("div",{children:[k.jsx("div",{style:{fontWeight:500,fontSize:"13px"},children:Jn.nome}),Jn.note_agea&&k.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:Jn.note_agea})]}),Jn.volte_menzionata&&k.jsxs("span",{style:{fontSize:"11px",color:"var(--text-secondary)",background:"var(--bg-primary)",padding:"2px 8px",borderRadius:"10px"},children:[Jn.volte_menzionata,"x"]})]},dt))}):k.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"13px",margin:0},children:"Nessuna entit importante memorizzata"})]}),k.jsxs("div",{style:{background:"var(--bg-primary)",borderRadius:"12px",padding:"16px"},children:[k.jsxs("h4",{style:{fontSize:"14px",fontWeight:600,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("span",{children:""})," Insights salvati"]}),(nr=Vt.insights_salvati)!=null&&nr.length?k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:Vt.insights_salvati.slice(0,3).map((dt,Jn)=>k.jsxs("div",{style:{padding:"10px 12px",background:"var(--bg-secondary)",borderRadius:"8px",borderLeft:"3px solid var(--primary)"},children:[k.jsx("div",{style:{fontSize:"13px"},children:dt.insight}),k.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)",marginTop:"4px"},children:[dt.entita&&k.jsxs("span",{children:[dt.entita,"  "]}),new Date(dt.data).toLocaleDateString("it-IT")]})]},Jn))}):k.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"13px",margin:0},children:"Nessun insight salvato ancora"})]}),k.jsxs("div",{style:{marginTop:"8px",paddingTop:"16px",borderTop:"1px solid var(--border-color)"},children:[k.jsx("button",{onClick:Ai,disabled:nn,style:{width:"100%",padding:"12px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.2)",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:500},children:nn?"Cancellazione...":" Cancella memoria di Agea"}),k.jsx("p",{style:{fontSize:"11px",color:"var(--text-secondary)",textAlign:"center",marginTop:"8px"},children:"Agea non ricorder pi le conversazioni passate"})]})]}):k.jsx("p",{style:{color:"var(--text-secondary)",textAlign:"center",padding:"40px 0"},children:"Memoria non disponibile"})]}),r==="info"&&k.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",padding:"40px 20px",minHeight:"300px"},children:[k.jsx("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",background:"linear-gradient(135deg, var(--primary), #8b5cf6)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"GenAgenTa"}),k.jsx("div",{style:{fontSize:"13px",color:"var(--text-secondary)",marginBottom:"32px"},children:"v1.0.1"}),k.jsx("div",{style:{fontSize:"14px",color:"var(--text-primary)",marginBottom:"8px"},children:" 2025 Gennaro Colacioppo. All rights reserved."}),k.jsx("div",{style:{fontSize:"13px",color:"var(--text-secondary)",marginBottom:"24px"},children:"Interface Design Registered."}),k.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[k.jsx("a",{href:"https://www.gruppogea.net",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--primary)",textDecoration:"none",fontSize:"14px"},children:"www.gruppogea.net"}),k.jsx("a",{href:"mailto:infoph@gruppogea.net",style:{color:"var(--primary)",textDecoration:"none",fontSize:"14px"},children:"infoph@gruppogea.net"})]})]})]})]})})}function _De({user:e,onLogout:t,onUserUpdate:n}){const[r,a]=B.useState(!1),[u,f]=B.useState(!1),[s,v]=B.useState(!1),[x,A]=B.useState(()=>localStorage.getItem("theme")||"dark"),C=B.useRef(null);B.useEffect(()=>{const q=G=>{C.current&&!C.current.contains(G.target)&&a(!1)};return document.addEventListener("mousedown",q),()=>document.removeEventListener("mousedown",q)},[]),B.useEffect(()=>{document.documentElement.setAttribute("data-theme",x),localStorage.setItem("theme",x)},[x]);const P=async()=>{e.codice_pairing&&(await navigator.clipboard.writeText(e.codice_pairing),f(!0),setTimeout(()=>f(!1),2e3))},L=()=>{A(q=>q==="dark"?"light":"dark")},F=e.nome.split(" ").map(q=>q[0]).join("").toUpperCase().slice(0,2),U=q=>({width:`${q}px`,height:`${q}px`,borderRadius:"50%",background:e.foto_url?`url(${e.foto_url}) center/cover`:"linear-gradient(135deg, var(--primary), #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${q*.375}px`,fontWeight:600,color:"white"});return k.jsxs(k.Fragment,{children:[k.jsxs("div",{ref:C,style:{position:"relative"},children:[k.jsxs("button",{onClick:()=>a(!r),style:{display:"flex",alignItems:"center",gap:"10px",padding:"6px 12px 6px 6px",background:r?"var(--bg-secondary)":"transparent",border:"1px solid var(--border-color)",borderRadius:"24px",color:"var(--text-primary)",cursor:"pointer",fontSize:"14px",transition:"all 0.2s"},onMouseEnter:q=>{r||(q.currentTarget.style.background="var(--bg-secondary)")},onMouseLeave:q=>{r||(q.currentTarget.style.background="transparent")},children:[k.jsx("div",{style:U(32),children:!e.foto_url&&F}),k.jsx("span",{style:{fontWeight:500},children:e.nome}),k.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",style:{transform:r?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},children:k.jsx("path",{d:"M2.5 4.5L6 8L9.5 4.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]}),r&&k.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",right:0,minWidth:"300px",background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"16px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",zIndex:1e3,overflow:"hidden"},children:[k.jsxs("div",{style:{padding:"20px",background:"linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1))",borderBottom:"1px solid var(--border-color)"},children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[k.jsx("div",{style:U(48),children:!e.foto_url&&F}),k.jsxs("div",{children:[k.jsx("div",{style:{fontWeight:600,fontSize:"15px"},children:e.nome}),k.jsx("div",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:e.email})]})]}),e.nome_azienda&&k.jsxs("div",{style:{marginTop:"12px",padding:"8px 12px",background:"var(--bg-primary)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("span",{style:{fontSize:"16px"},children:""}),k.jsx("span",{style:{fontSize:"13px",fontWeight:500},children:e.nome_azienda})]}),e.ruolo_azienda==="admin"&&k.jsx("span",{style:{background:"var(--primary)",color:"white",padding:"3px 8px",borderRadius:"4px",fontSize:"10px",fontWeight:600,textTransform:"uppercase"},children:"Admin"})]})]}),e.codice_pairing&&e.ruolo_azienda==="admin"&&k.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--border-color)"},children:[k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)",marginBottom:"8px",fontWeight:500},children:" Invita colleghi"}),k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("div",{style:{flex:1,padding:"10px 12px",background:"var(--bg-primary)",borderRadius:"8px",fontFamily:"monospace",fontSize:"15px",letterSpacing:"2px",color:"var(--primary)",fontWeight:600,textAlign:"center"},children:e.codice_pairing}),k.jsx("button",{onClick:P,style:{padding:"10px 14px",background:u?"#22c55e":"var(--primary)",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"12px",fontWeight:600,transition:"all 0.2s",whiteSpace:"nowrap"},children:u?" Copiato!":"Copia"})]})]}),k.jsxs("div",{style:{padding:"8px"},children:[k.jsxs("button",{onClick:()=>{a(!1),v(!0)},style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",borderRadius:"8px",color:"var(--text-primary)",cursor:"pointer",fontSize:"14px",textAlign:"left",display:"flex",alignItems:"center",gap:"10px",transition:"background 0.2s"},onMouseEnter:q=>{q.currentTarget.style.background="var(--bg-hover)"},onMouseLeave:q=>{q.currentTarget.style.background="transparent"},children:[k.jsx("span",{style:{fontSize:"16px"},children:""}),k.jsx("span",{children:"Impostazioni"})]}),k.jsxs("button",{onClick:L,style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",borderRadius:"8px",color:"var(--text-primary)",cursor:"pointer",fontSize:"14px",textAlign:"left",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"background 0.2s"},onMouseEnter:q=>{q.currentTarget.style.background="var(--bg-hover)"},onMouseLeave:q=>{q.currentTarget.style.background="transparent"},children:[k.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[k.jsx("span",{style:{fontSize:"16px"},children:x==="dark"?"":""}),k.jsxs("span",{children:["Tema ",x==="dark"?"scuro":"chiaro"]})]}),k.jsx("div",{style:{width:"44px",height:"24px",background:x==="dark"?"var(--primary)":"#94a3b8",borderRadius:"12px",position:"relative",transition:"background 0.2s"},children:k.jsx("div",{style:{width:"20px",height:"20px",background:"white",borderRadius:"50%",position:"absolute",top:"2px",left:x==="dark"?"22px":"2px",transition:"left 0.2s"}})})]}),k.jsx("div",{style:{height:"1px",background:"var(--border-color)",margin:"8px 0"}}),k.jsxs("button",{onClick:()=>{a(!1),t()},style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",borderRadius:"8px",color:"#ef4444",cursor:"pointer",fontSize:"14px",textAlign:"left",display:"flex",alignItems:"center",gap:"10px",transition:"background 0.2s"},onMouseEnter:q=>{q.currentTarget.style.background="rgba(239, 68, 68, 0.1)"},onMouseLeave:q=>{q.currentTarget.style.background="transparent"},children:[k.jsx("span",{style:{fontSize:"16px"},children:""}),k.jsx("span",{children:"Esci"})]})]})]})]}),s&&k.jsx(gDe,{user:e,onClose:()=>v(!1),onUserUpdate:q=>{n==null||n(q)}})]})}function yDe({invito:e,onAccept:t,onDecline:n}){const[r,a]=B.useState(!1),[u,f]=B.useState(""),s=async()=>{var x,A;a(!0),f("");try{await Xn.accettaInvito(e.id),t()}catch(C){f(((A=(x=C.response)==null?void 0:x.data)==null?void 0:A.error)||"Errore durante l'accettazione"),a(!1)}},v=async()=>{a(!0);try{await Xn.rifiutaInvito(e.id),n()}catch{n()}};return k.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3},children:k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"16px",padding:"32px",width:"90%",maxWidth:"400px",textAlign:"center"},children:[k.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"50%",background:"linear-gradient(135deg, var(--primary), #8b5cf6)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px",fontSize:"28px"},children:""}),k.jsx("h2",{style:{fontSize:"20px",fontWeight:600,marginBottom:"12px"},children:"Hai ricevuto un invito!"}),k.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"15px",marginBottom:"8px"},children:[k.jsx("strong",{children:e.invitato_da})," ti ha invitato a unirti al team:"]}),k.jsx("div",{style:{background:"var(--bg-primary)",padding:"16px",borderRadius:"12px",marginBottom:"24px"},children:k.jsx("div",{style:{fontSize:"18px",fontWeight:600,color:"var(--primary)"},children:e.nome_azienda})}),u&&k.jsx("div",{style:{padding:"12px",borderRadius:"8px",background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",marginBottom:"16px",fontSize:"14px"},children:u}),k.jsxs("div",{style:{display:"flex",gap:"12px"},children:[k.jsx("button",{className:"btn btn-secondary",onClick:v,disabled:r,style:{flex:1},children:"Rifiuta"}),k.jsx("button",{className:"btn btn-primary",onClick:s,disabled:r,style:{flex:1},children:r?"Un momento...":"Accetta"})]})]})})}const ZH={cerchio:"",quadrato:"",triangolo:"",stella:"",croce:"",L:"L",C:"C",W:"W",Z:"Z"};function vDe({neurone:e,categorie:t=[],onSave:n,onClose:r,onDelete:a,onRequestMapPick:u,pickedPosition:f,isPickingMap:s=!1,onPositionFound:v}){const x=!!e,[A,C]=B.useState(window.innerWidth<=768),[P,L]=B.useState(0),[F,U]=B.useState(!1),G=x?(()=>{if(e!=null&&e.categorie&&e.categorie.length>0&&t.length>0){const on=e.categorie[0],qn=t.find(Or=>Or.nome.toLowerCase()===on.toLowerCase());if(qn!=null&&qn.colore)return qn.colore}return{persona:"#3b82f6",impresa:"#22c55e",cantiere:"#f97316",ente:"#8b5cf6"}[(e==null?void 0:e.tipo)||""]||"#6366f1"})():"#6366f1",$=async()=>{if(P===0){L(1);return}if(P===1){L(2);return}U(!0);try{await(a==null?void 0:a())}catch(ut){console.error("Errore eliminazione:",ut),alert("Errore durante l'eliminazione")}finally{U(!1),L(0)}},X=()=>{L(0)},[ie,de]=B.useState([]),[fe,be]=B.useState([]),[ve,Qe]=B.useState(!0),[we,qe]=B.useState(""),[Je,ft]=B.useState(""),[Mt,Pt]=B.useState(""),[Nt,Kt]=B.useState(""),[tt,mt]=B.useState((e==null?void 0:e.nome)||""),[Pe,gn]=B.useState((e==null?void 0:e.indirizzo)||""),[Et,ze]=B.useState((e==null?void 0:e.telefono)||""),[$t,Cn]=B.useState((e==null?void 0:e.email)||""),[fn,Nn]=B.useState((e==null?void 0:e.visibilita)||"aziendale"),[bn,Vt]=B.useState(!1),[En,Sn]=B.useState(""),[Un,nn]=B.useState(!1),[wr,Xr]=B.useState(!1),[ar,tr]=B.useState((e==null?void 0:e.lat)!=null?Number(e.lat):null),[Vn,xr]=B.useState((e==null?void 0:e.lng)!=null?Number(e.lng):null),[ws,bi]=B.useState((e==null?void 0:e.dimensione)!=null?String(e.dimensione):""),[Ai,ps]=B.useState([]),[$i,Ts]=B.useState(!1),tn=(e==null?void 0:e.dati_extra)||{},[kn,Mr]=B.useState(Object.fromEntries(Object.entries(tn).map(([ut,on])=>[ut,on!=null?String(on):""])));B.useEffect(()=>{if(e){mt(e.nome||""),gn(e.indirizzo||""),ze(e.telefono||""),Cn(e.email||""),Nn(e.visibilita||"aziendale"),tr(e.lat!=null?Number(e.lat):null),xr(e.lng!=null?Number(e.lng):null),bi(e.dimensione!=null?String(e.dimensione):"");const ut=e.dati_extra||{};if(Mr(Object.fromEntries(Object.entries(ut).map(([on,qn])=>[on,qn!=null?String(qn):""]))),L(0),Sn(""),ie.length>0){const on=ie.find(qn=>{var Or;return qn.nome.toLowerCase()===((Or=e.tipo)==null?void 0:Or.toLowerCase())});if(on){qe(on.id),Pt(on.id);const qn=fe.find(Or=>{var Zn;return Or.tipo_id===on.id&&((Zn=e.categorie)==null?void 0:Zn.includes(Or.nome.toLowerCase()))});qn?(ft(qn.id),Kt(qn.id)):(ft(""),Kt(""))}}}},[e==null?void 0:e.id]),B.useEffect(()=>{wt()},[]);const wt=async()=>{Qe(!0);try{const[ut,on]=await Promise.all([Xn.get("/tipi"),Xn.get("/tipologie")]),qn=ut.data.data.map(Zn=>({id:Zn.id,nome:Zn.nome,forma:Zn.forma,ordine:Zn.ordine})),Or=on.data.data.map(Zn=>({id:Zn.id,tipo_id:Zn.tipo_id,nome:Zn.nome,colore:Zn.colore,ordine:Zn.ordine}));if(de(qn),be(Or),e){const Zn=qn.find(ns=>{var ga;return ns.nome.toLowerCase()===((ga=e.tipo)==null?void 0:ga.toLowerCase())});if(Zn){qe(Zn.id),Pt(Zn.id);const ns=Or.find(ga=>{var Ys;return ga.tipo_id===Zn.id&&((Ys=e.categorie)==null?void 0:Ys.includes(ga.nome.toLowerCase()))});ns&&(ft(ns.id),Kt(ns.id))}}else qn.length>0&&qe(qn[0].id)}catch(ut){console.error("Errore caricamento tipi:",ut),Sn("Errore caricamento tipi. Vai in Impostazioni  Categorie per crearli.")}finally{Qe(!1)}},Rn=fe.filter(ut=>ut.tipo_id===we),nr=ie.find(ut=>ut.id===we);B.useEffect(()=>{if(!we){ps([]);return}(async()=>{Ts(!0);try{const on=await Xn.get(`/campi?tipo=${we}`);ps(on.data.data||[])}catch(on){console.error("Errore caricamento campi:",on),ps([])}finally{Ts(!1)}})()},[we]);const dt=(ut,on)=>{Mr(qn=>({...qn,[ut]:on}))},Jn=ut=>{if(!x||ut===Mt){qe(ut),ft("");return}window.confirm("Attenzione: stai cambiando il tipo dell'entit. Questo potrebbe influenzare la visualizzazione sulla mappa e i campi personalizzati. Vuoi procedere?")&&(qe(ut),ft(""))},qr=ut=>{if(!x||ut===Nt){ft(ut);return}window.confirm("Attenzione: stai cambiando la categoria dell'entit. Questo potrebbe influenzare il colore e il raggruppamento. Vuoi procedere?")&&ft(ut)};B.useEffect(()=>{const ut=()=>C(window.innerWidth<=768);return window.addEventListener("resize",ut),()=>window.removeEventListener("resize",ut)},[]),B.useEffect(()=>{f&&(tr(f.lat),xr(f.lng),fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${f.lat}&lon=${f.lng}`).then(ut=>ut.json()).then(ut=>{ut.display_name&&gn(ut.display_name)}).catch(()=>{}))},[f]);const ts=async()=>{if(Pe.trim()){nn(!0),Sn("");try{const on=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(Pe)}&limit=1`)).json();if(on.length>0){const qn=parseFloat(on[0].lat),Or=parseFloat(on[0].lon);tr(qn),xr(Or),gn(on[0].display_name),v==null||v(qn,Or)}else Sn("Indirizzo non trovato")}catch{Sn("Errore ricerca indirizzo")}finally{nn(!1)}}},ms=()=>{if(!navigator.geolocation){Sn("GPS non supportato");return}Xr(!0),Sn(""),navigator.geolocation.getCurrentPosition(async ut=>{const on=ut.coords.latitude,qn=ut.coords.longitude;tr(on),xr(qn),v==null||v(on,qn);try{const Zn=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${on}&lon=${qn}`)).json();Zn.display_name&&gn(Zn.display_name)}catch{}Xr(!1)},ut=>{Sn("Errore GPS: "+ut.message),Xr(!1)},{enableHighAccuracy:!0,timeout:1e4})},Mn=async()=>{var Or,Zn,ns,ga;if(Sn(""),!tt.trim()){Sn("Il nome  obbligatorio");return}if(!we){Sn("Seleziona un tipo");return}if(!Je){Sn("Seleziona una categoria");return}const ut=((Or=ie.find(Ys=>Ys.id===we))==null?void 0:Or.nome)||"",on=((Zn=fe.find(Ys=>Ys.id===Je))==null?void 0:Zn.nome)||"";let qn=null;if(Ai.length>0){qn={};for(const Ys of Ai){const rn=kn[Ys.nome];rn!==void 0&&rn!==""&&(Ys.tipo_dato==="numero"?qn[Ys.nome]=parseFloat(rn)||null:qn[Ys.nome]=rn)}Object.keys(qn).length===0&&(qn=null)}Vt(!0);try{const Ys={nome:tt.trim(),tipo:ut,categorie:[on],visibilita:fn,indirizzo:Pe||null,lat:ar||null,lng:Vn||null,telefono:Et||null,email:$t||null,dimensione:ws?parseFloat(ws):null,dati_extra:qn};if(x&&e)await Xn.updateNeurone(e.id,Ys),n({...e,...Ys});else{const rn=await Xn.createNeurone(Ys);n({id:rn.id,...Ys})}}catch(Ys){Sn(((ga=(ns=Ys.response)==null?void 0:ns.data)==null?void 0:ga.error)||"Errore salvataggio")}finally{Vt(!1)}},Tt=(ut,on=!1)=>{const qn=kn[ut.nome]||"",Or=on?{fontSize:"12px",padding:"6px 8px"}:{};switch(ut.tipo_dato){case"textarea":return k.jsx("textarea",{className:"form-input",value:qn,onChange:Zn=>dt(ut.nome,Zn.target.value),placeholder:ut.etichetta,rows:3,style:{...Or,resize:"vertical"}});case"numero":return k.jsx("input",{type:"number",className:"form-input",value:qn,onChange:Zn=>dt(ut.nome,Zn.target.value),placeholder:ut.etichetta,style:Or});case"data":return k.jsx("input",{type:"date",className:"form-input",value:qn,onChange:Zn=>dt(ut.nome,Zn.target.value),style:Or});case"email":return k.jsx("input",{type:"email",className:"form-input",value:qn,onChange:Zn=>dt(ut.nome,Zn.target.value),placeholder:ut.etichetta,style:Or});case"telefono":return k.jsx("input",{type:"tel",className:"form-input",value:qn,onChange:Zn=>dt(ut.nome,Zn.target.value),placeholder:ut.etichetta,style:Or});case"url":return k.jsx("input",{type:"url",className:"form-input",value:qn,onChange:Zn=>dt(ut.nome,Zn.target.value),placeholder:ut.etichetta,style:Or});case"select":return k.jsxs("select",{className:"form-input",value:qn,onChange:Zn=>dt(ut.nome,Zn.target.value),style:Or,children:[k.jsx("option",{value:"",children:"Seleziona..."}),(ut.opzioni||[]).map(Zn=>k.jsx("option",{value:Zn,children:Zn},Zn))]});default:return k.jsx("input",{type:"text",className:"form-input",value:qn,onChange:Zn=>dt(ut.nome,Zn.target.value),placeholder:ut.etichetta,style:Or})}};return s?k.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,background:"var(--primary)",color:"white",padding:"12px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",zIndex:2e3,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:[k.jsx("span",{style:{fontWeight:600},children:"Tocca la mappa per selezionare la posizione"}),k.jsx("button",{onClick:r,style:{background:"rgba(255,255,255,0.2)",border:"none",color:"white",padding:"6px 12px",borderRadius:"6px",cursor:"pointer",fontSize:"13px"},children:"Annulla"})]}):!ve&&ie.length===0?k.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},onClick:r,children:k.jsxs("div",{style:{background:"var(--bg-secondary)",padding:"24px",borderRadius:"12px",maxWidth:"400px",textAlign:"center"},onClick:ut=>ut.stopPropagation(),children:[k.jsx("h3",{style:{marginBottom:"12px"},children:"Configura prima le entit"}),k.jsxs("p",{style:{color:"var(--text-secondary)",marginBottom:"16px"},children:["Per creare entit devi prima definire almeno un tipo e una tipologia. Vai in ",k.jsx("strong",{children:"Impostazioni  Entit"})," per configurarli."]}),k.jsx("button",{className:"btn btn-primary",onClick:r,children:"Ho capito"})]})}):A?k.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:2e3,display:"flex",flexDirection:"column"},children:[k.jsxs("div",{style:{background:"var(--bg-secondary)",maxHeight:"60vh",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 4px 20px rgba(0,0,0,0.3)",borderRadius:"0 0 12px 12px"},children:[k.jsxs("div",{style:{padding:"10px 14px",borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0,background:x?`linear-gradient(135deg, ${G}20 0%, ${G}05 100%)`:void 0,borderLeft:x?`4px solid ${G}`:void 0},children:[k.jsxs("h2",{style:{fontSize:"15px",fontWeight:600,margin:0,color:x?G:void 0},children:[x?"Modifica":"Nuovo"," ",nr?nr.nome:"Neurone"]}),k.jsx("button",{onClick:r,style:{background:"transparent",border:"none",fontSize:"18px",cursor:"pointer",color:x?G:"var(--text-secondary)",padding:"2px 6px"},children:""})]}),ve?k.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:"Caricamento..."}):k.jsxs(k.Fragment,{children:[k.jsxs("div",{style:{padding:"10px 14px",overflowY:"auto",flex:1},children:[k.jsxs("div",{style:{marginBottom:"10px"},children:[k.jsx("label",{style:{fontSize:"11px",color:"var(--text-secondary)",marginBottom:"4px",display:"block"},children:"Tipo"}),k.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:ie.map(ut=>k.jsxs("button",{type:"button",onClick:()=>Jn(ut.id),style:{padding:"6px 10px",border:"none",borderRadius:"6px",fontSize:"12px",fontWeight:we===ut.id?600:400,cursor:"pointer",background:we===ut.id?"var(--primary)":"var(--bg-primary)",color:we===ut.id?"white":"var(--text-primary)",display:"flex",alignItems:"center",gap:"4px"},children:[k.jsx("span",{children:ZH[ut.forma]})," ",ut.nome]},ut.id))})]}),we&&k.jsxs("div",{style:{marginBottom:"10px"},children:[k.jsx("label",{style:{fontSize:"11px",color:"var(--text-secondary)",marginBottom:"4px",display:"block"},children:"Categoria"}),Rn.length===0?k.jsx("p",{style:{fontSize:"11px",color:"#f59e0b"},children:"Nessuna categoria per questo tipo. Creala in Impostazioni."}):k.jsx("div",{style:{display:"flex",gap:"4px",flexWrap:"wrap"},children:Rn.map(ut=>k.jsx("button",{type:"button",onClick:()=>qr(ut.id),style:{padding:"4px 8px",borderRadius:"8px",border:Je===ut.id?"2px solid white":"none",boxShadow:Je===ut.id?"0 0 0 2px var(--primary)":"none",fontSize:"11px",cursor:"pointer",background:ut.colore,color:"white",fontWeight:500},children:ut.nome},ut.id))})]}),k.jsx("input",{type:"text",className:"form-input",value:tt,onChange:ut=>mt(ut.target.value),placeholder:"Nome *",style:{fontSize:"13px",marginBottom:"8px",padding:"8px 10px"}}),k.jsxs("div",{style:{display:"flex",gap:"4px",marginBottom:"8px"},children:[k.jsx("input",{type:"text",className:"form-input",value:Pe,onChange:ut=>{gn(ut.target.value),tr(null),xr(null)},placeholder:"Indirizzo...",style:{flex:1,fontSize:"12px",padding:"6px 8px"}}),k.jsx("button",{type:"button",onClick:ts,disabled:Un||!Pe.trim(),style:{padding:"6px 8px",border:"none",borderRadius:"6px",background:"var(--bg-primary)",cursor:"pointer",fontSize:"12px"},children:Un?"...":""})]}),k.jsxs("div",{style:{display:"flex",gap:"4px",marginBottom:"8px"},children:[k.jsx("button",{type:"button",onClick:ms,disabled:wr,style:{flex:1,padding:"6px",border:"none",borderRadius:"6px",background:"var(--bg-primary)",cursor:"pointer",fontSize:"11px"},children:wr?"...":" GPS"}),u&&k.jsx("button",{type:"button",onClick:u,style:{flex:1,padding:"6px",border:"none",borderRadius:"6px",background:"var(--primary)",color:"white",cursor:"pointer",fontSize:"11px",fontWeight:600},children:" Mappa"})]}),ar!=null&&Vn!=null&&k.jsxs("div",{style:{fontSize:"10px",color:"var(--text-secondary)",marginBottom:"6px"},children:[" ",Number(ar).toFixed(4),", ",Number(Vn).toFixed(4)]}),k.jsxs("div",{style:{display:"flex",gap:"4px",marginBottom:"8px"},children:[k.jsx("input",{type:"tel",className:"form-input",value:Et,onChange:ut=>ze(ut.target.value),placeholder:"Telefono",style:{flex:1,fontSize:"12px",padding:"6px 8px"}}),k.jsx("input",{type:"email",className:"form-input",value:$t,onChange:ut=>Cn(ut.target.value),placeholder:"Email",style:{flex:1,fontSize:"12px",padding:"6px 8px"}})]}),k.jsxs("div",{style:{display:"flex",gap:"10px",fontSize:"11px",marginBottom:"6px"},children:[k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"3px",cursor:"pointer"},children:[k.jsx("input",{type:"radio",name:"visibilita",checked:fn==="aziendale",onChange:()=>Nn("aziendale")})," Aziendale"]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"3px",cursor:"pointer"},children:[k.jsx("input",{type:"radio",name:"visibilita",checked:fn==="personale",onChange:()=>Nn("personale")})," Personale"]})]}),k.jsxs("div",{style:{marginBottom:"8px"},children:[k.jsx("label",{style:{fontSize:"10px",color:"var(--text-secondary)"},children:"Dimensione (m)"}),k.jsx("input",{type:"number",className:"form-input",value:ws,onChange:ut=>bi(ut.target.value),placeholder:"Auto",min:"10",max:"200",step:"5",style:{fontSize:"12px",padding:"6px 8px"}})]}),Ai.length>0&&k.jsxs("div",{style:{marginTop:"10px",padding:"10px",background:"var(--bg-primary)",borderRadius:"8px"},children:[k.jsxs("label",{style:{fontSize:"11px",color:"var(--text-secondary)",marginBottom:"6px",display:"block",fontWeight:500},children:["Dettagli ",(nr==null?void 0:nr.nome)||"entit"]}),$i?k.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:"Caricamento..."}):k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:Ai.map(ut=>k.jsxs("div",{children:[k.jsxs("label",{style:{fontSize:"10px",color:"var(--text-secondary)"},children:[ut.etichetta,ut.obbligatorio&&" *"]}),Tt(ut,!0)]},ut.id))})]}),En&&k.jsx("div",{style:{padding:"6px",borderRadius:"4px",background:"rgba(239,68,68,0.1)",color:"#ef4444",fontSize:"11px"},children:En}),x&&a&&k.jsxs("div",{style:{marginTop:"16px",paddingTop:"12px",borderTop:"1px dashed var(--border-color)"},children:[P>0&&k.jsx("div",{style:{padding:"8px",marginBottom:"8px",background:P===1?"#fef3c7":"#fee2e2",borderRadius:"6px",fontSize:"11px",color:P===1?"#92400e":"#b91c1c"},children:P===1?k.jsxs(k.Fragment,{children:[k.jsx("strong",{children:"Attenzione!"}),' Stai per eliminare "',e==null?void 0:e.nome,'". Clicca di nuovo per confermare.']}):k.jsxs(k.Fragment,{children:[k.jsx("strong",{children:"ULTIMA CONFERMA!"})," L'eliminazione  irreversibile."]})}),k.jsxs("div",{style:{display:"flex",gap:"6px"},children:[k.jsx("button",{onClick:$,disabled:F,style:{flex:1,padding:"8px",border:P>0?"none":"1px solid #ef4444",borderRadius:"6px",background:P>0?"#ef4444":"transparent",color:P>0?"white":"#ef4444",cursor:"pointer",fontSize:"12px",fontWeight:500},children:F?"...":P===0?" Elimina":P===1?"Conferma?":"ELIMINA!"}),P>0&&k.jsx("button",{onClick:X,style:{padding:"8px 12px",border:"1px solid var(--border-color)",borderRadius:"6px",background:"transparent",cursor:"pointer",fontSize:"12px"},children:"Annulla"})]})]})]}),k.jsxs("div",{style:{padding:"10px 14px",borderTop:"1px solid var(--border-color)",display:"flex",gap:"6px",flexShrink:0},children:[k.jsx("button",{onClick:r,style:{flex:1,padding:"8px",border:"1px solid var(--border-color)",borderRadius:"6px",background:"transparent",cursor:"pointer",fontSize:"13px"},children:"Annulla"}),k.jsx("button",{onClick:Mn,disabled:bn,style:{flex:1,padding:"8px",border:"none",borderRadius:"6px",background:x?G:"var(--primary)",color:"white",cursor:"pointer",fontSize:"13px",fontWeight:600},children:bn?"...":"Salva"})]})]})]}),k.jsx("div",{style:{flex:1,background:"rgba(0,0,0,0.3)"},onClick:r})]}):k.jsxs("div",{style:{position:"fixed",top:0,left:"280px",bottom:0,width:"380px",background:"var(--bg-secondary)",boxShadow:"4px 0 20px rgba(0,0,0,0.15)",zIndex:1500,display:"flex",flexDirection:"column",animation:"slideInLeft 0.3s ease-out"},children:[k.jsx("style",{children:`
        @keyframes slideInLeft {
          from { transform: translateX(-100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
      `}),k.jsxs("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:[k.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"space-between",background:x?`linear-gradient(135deg, ${G}20 0%, ${G}05 100%)`:void 0,borderLeft:x?`4px solid ${G}`:void 0},children:[k.jsxs("h2",{style:{fontSize:"18px",fontWeight:600,margin:0,color:x?G:void 0},children:[x?"Modifica":"Nuovo"," ",nr?nr.nome:"Neurone"]}),k.jsx("button",{onClick:r,style:{background:"transparent",border:"none",fontSize:"22px",cursor:"pointer",color:x?G:"var(--text-secondary)",padding:"4px 8px"},children:""})]}),ve?k.jsx("div",{style:{padding:"40px",textAlign:"center",color:"var(--text-secondary)"},children:"Caricamento tipi..."}):k.jsxs(k.Fragment,{children:[k.jsxs("div",{style:{padding:"20px",overflowY:"auto",flex:1},children:[k.jsxs("div",{style:{marginBottom:"16px"},children:[k.jsx("label",{style:{fontSize:"13px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:"Tipo *"}),k.jsx("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:ie.map(ut=>k.jsxs("button",{type:"button",onClick:()=>Jn(ut.id),style:{padding:"10px 16px",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:we===ut.id?600:400,cursor:"pointer",background:we===ut.id?"var(--primary)":"var(--bg-primary)",color:we===ut.id?"white":"var(--text-primary)",display:"flex",alignItems:"center",gap:"6px"},children:[k.jsx("span",{style:{fontSize:"18px"},children:ZH[ut.forma]})," ",ut.nome]},ut.id))})]}),we&&k.jsxs("div",{style:{marginBottom:"16px"},children:[k.jsx("label",{style:{fontSize:"13px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:"Categoria *"}),Rn.length===0?k.jsx("p",{style:{fontSize:"13px",color:"#f59e0b",padding:"12px",background:"rgba(245, 158, 11, 0.1)",borderRadius:"8px"},children:"Nessuna categoria per questo tipo. Vai in Impostazioni  Categorie per crearne."}):k.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:Rn.map(ut=>k.jsx("button",{type:"button",onClick:()=>qr(ut.id),style:{padding:"8px 14px",borderRadius:"10px",border:Je===ut.id?"2px solid white":"2px solid transparent",boxShadow:Je===ut.id?"0 0 0 2px var(--primary)":"none",fontSize:"13px",cursor:"pointer",background:ut.colore,color:"white",fontWeight:500},children:ut.nome},ut.id))})]}),k.jsxs("div",{style:{marginBottom:"16px"},children:[k.jsx("label",{style:{fontSize:"13px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:"Nome *"}),k.jsx("input",{type:"text",className:"form-input",value:tt,onChange:ut=>mt(ut.target.value),placeholder:"Inserisci nome..."})]}),k.jsxs("div",{style:{marginBottom:"16px"},children:[k.jsx("label",{style:{fontSize:"13px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:"Posizione"}),k.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[k.jsx("input",{type:"text",className:"form-input",value:Pe,onChange:ut=>{gn(ut.target.value),tr(null),xr(null)},placeholder:"Via Roma 1, Milano",style:{flex:1}}),k.jsx("button",{type:"button",onClick:ts,disabled:Un||!Pe.trim(),style:{padding:"8px 12px",border:"none",borderRadius:"8px",background:"var(--bg-primary)",cursor:"pointer"},children:Un?"...":""})]}),k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("button",{type:"button",onClick:ms,disabled:wr,style:{flex:1,padding:"10px",border:"none",borderRadius:"8px",background:"var(--bg-primary)",cursor:"pointer",fontSize:"13px"},children:wr?"Localizzazione...":" Posizione GPS"}),u&&k.jsx("button",{type:"button",onClick:u,style:{flex:1,padding:"10px",border:"none",borderRadius:"8px",background:"var(--primary)",color:"white",cursor:"pointer",fontSize:"13px",fontWeight:600},children:" Scegli su mappa"})]}),ar!=null&&Vn!=null&&k.jsxs("div",{style:{marginTop:"8px",fontSize:"12px",color:"var(--text-secondary)"},children:["Coordinate: ",Number(ar).toFixed(5),", ",Number(Vn).toFixed(5)]})]}),k.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginBottom:"16px"},children:[k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"13px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:"Telefono"}),k.jsx("input",{type:"tel",className:"form-input",value:Et,onChange:ut=>ze(ut.target.value),placeholder:"+39 333 1234567"})]}),k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"13px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:"Email"}),k.jsx("input",{type:"email",className:"form-input",value:$t,onChange:ut=>Cn(ut.target.value),placeholder:"email@esempio.it"})]})]}),k.jsxs("div",{style:{marginBottom:"16px"},children:[k.jsx("label",{style:{fontSize:"13px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:"Visibilit"}),k.jsxs("div",{style:{display:"flex",gap:"16px"},children:[k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",fontSize:"14px"},children:[k.jsx("input",{type:"radio",name:"visibilita-desktop",checked:fn==="aziendale",onChange:()=>Nn("aziendale")})," Aziendale (visibile ai colleghi)"]}),k.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",fontSize:"14px"},children:[k.jsx("input",{type:"radio",name:"visibilita-desktop",checked:fn==="personale",onChange:()=>Nn("personale")})," Personale (solo tu)"]})]})]}),k.jsxs("div",{style:{marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("label",{style:{fontSize:"13px",color:"var(--text-secondary)",whiteSpace:"nowrap"},children:"Dimensione (m)"}),k.jsx("input",{type:"number",className:"form-input",value:ws,onChange:ut=>bi(ut.target.value),placeholder:"50",min:"10",max:"200",step:"10",style:{width:"80px"}}),k.jsx("span",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:"10-200"})]}),Ai.length>0&&k.jsxs("div",{style:{marginBottom:"12px",padding:"10px",background:"var(--bg-primary)",borderRadius:"6px"},children:[k.jsxs("label",{style:{fontSize:"12px",fontWeight:500,marginBottom:"6px",display:"block",color:"var(--text-secondary)"},children:["Dettagli ",(nr==null?void 0:nr.nome)||""]}),$i?k.jsx("div",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:"Caricamento..."}):k.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:Ai.map(ut=>k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[k.jsxs("label",{style:{fontSize:"11px",color:"var(--text-secondary)",width:"100px",flexShrink:0},children:[ut.etichetta,ut.obbligatorio&&"*"]}),k.jsx("div",{style:{flex:1},children:Tt(ut)})]},ut.id))})]}),En&&k.jsx("div",{style:{padding:"10px",borderRadius:"8px",background:"rgba(239,68,68,0.1)",color:"#ef4444",fontSize:"13px"},children:En}),x&&a&&k.jsxs("div",{style:{marginTop:"24px",paddingTop:"16px",borderTop:"1px dashed var(--border-color)"},children:[P>0&&k.jsx("div",{style:{padding:"12px",marginBottom:"12px",background:P===1?"#fef3c7":"#fee2e2",borderRadius:"8px",fontSize:"13px",color:P===1?"#92400e":"#b91c1c"},children:P===1?k.jsxs(k.Fragment,{children:[k.jsx("strong",{children:"Attenzione!"}),' Stai per eliminare "',e==null?void 0:e.nome,'". Clicca di nuovo per confermare.']}):k.jsxs(k.Fragment,{children:[k.jsx("strong",{children:"ULTIMA CONFERMA!"})," L'eliminazione  irreversibile."]})}),k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("button",{onClick:$,disabled:F,style:{padding:"10px 16px",border:P>0?"none":"1px solid #ef4444",borderRadius:"8px",background:P>0?"#ef4444":"transparent",color:P>0?"white":"#ef4444",cursor:"pointer",fontSize:"13px",fontWeight:500},children:F?"Eliminazione...":P===0?" Elimina entit":P===1?"Conferma?":"ELIMINA!"}),P>0&&k.jsx("button",{onClick:X,style:{padding:"10px 16px",border:"1px solid var(--border-color)",borderRadius:"8px",background:"transparent",cursor:"pointer",fontSize:"13px"},children:"Annulla"})]})]})]}),k.jsxs("div",{style:{padding:"16px 20px",borderTop:"1px solid var(--border-color)",display:"flex",gap:"12px"},children:[k.jsx("button",{onClick:r,style:{flex:1,padding:"12px",border:"1px solid var(--border-color)",borderRadius:"8px",background:"transparent",cursor:"pointer",fontSize:"14px"},children:"Annulla"}),k.jsx("button",{onClick:Mn,disabled:bn,style:{flex:1,padding:"12px",border:"none",borderRadius:"8px",background:x?G:"var(--primary)",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:600},children:bn?"Salvataggio...":"Salva"})]})]})]})]})}function Pw({value:e,onChange:t,label:n,disabled:r=!1}){const[a,u]=B.useState(0);return k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[k.jsx("span",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:n}),k.jsx("div",{style:{display:"flex",gap:"2px"},children:[1,2,3,4,5].map(f=>k.jsx("button",{type:"button",disabled:r,onClick:()=>t(e===f?0:f),onMouseEnter:()=>u(f),onMouseLeave:()=>u(0),style:{background:"none",border:"none",cursor:r?"default":"pointer",fontSize:"18px",color:f<=(a||e)?"#f59e0b":"#d1d5db",transition:"color 0.15s",padding:"0 1px"},children:""},f))})]})}const XH=[{value:"commerciale",label:"Commerciale",icon:""},{value:"fornisce",label:"Fornisce",icon:""},{value:"influencer",label:"Influencer",icon:""},{value:"prescrittore",label:"Prescrittore",icon:""},{value:"tecnico",label:"Tecnico",icon:""},{value:"partner",label:"Partner",icon:""},{value:"collabora",label:"Collabora",icon:""}];function xDe({sinapsiId:e,onClose:t,onSaved:n}){const{data:r,isLoading:a}=RLe(e),{invalidateSinapsiById:u,invalidateSinapsi:f}=ZT(),[s,v]=B.useState(!1),[x,A]=B.useState(""),[C,P]=B.useState([]),[L,F]=B.useState("ipotesi"),[U,q]=B.useState(0),[G,$]=B.useState(0),[X,ie]=B.useState(0),[de,fe]=B.useState(0),[be,ve]=B.useState(0),[Qe,we]=B.useState(""),qe=(r==null?void 0:r.dati_oggettivi)||null;B.useEffect(()=>{if(r){const mt=Array.isArray(r.tipo_connessione)?r.tipo_connessione:[];P(mt),F(r.certezza||"ipotesi"),q(r.influenza||0),$(r.qualita_relazione||0),ie(r.importanza_strategica||0),fe(r.affidabilita||0),ve(r.potenziale||0),we(r.note_relazione||"")}},[r]);const Je=async()=>{v(!0),A("");try{await Xn.updateSinapsi(e,{tipo_connessione:C.length>0?C:void 0,certezza:L,influenza:U||void 0,qualita_relazione:G||void 0,importanza_strategica:X||void 0,affidabilita:de||void 0,potenziale:be||void 0,note_relazione:Qe||void 0}),u(e),f(),n==null||n(),t()}catch(mt){console.error("Errore salvataggio:",mt),A("Errore salvataggio"),v(!1)}},ft=()=>C.length>0?C.map(mt=>mt.charAt(0).toUpperCase()+mt.slice(1)).join(", "):"Connessione",Mt=()=>{if(C.length===0)return"";const mt=C[0].toLowerCase(),Pe=XH.find(gn=>gn.value===mt);return(Pe==null?void 0:Pe.icon)||""},Pt=()=>{switch(L){case"certo":return{color:"#22c55e",label:"Certo"};case"probabile":return{color:"#eab308",label:"Probabile"};default:return{color:"#94a3b8",label:"Ipotetico"}}},Nt=mt=>{C.includes(mt)?P(C.filter(Pe=>Pe!==mt)):P([...C,mt])};if(a)return k.jsx("div",{className:"detail-panel",children:k.jsx("div",{style:{padding:"40px",textAlign:"center",color:"var(--text-secondary)"},children:"Caricamento..."})});if(!r)return k.jsx("div",{className:"detail-panel",children:k.jsxs("div",{style:{padding:"20px"},children:[k.jsx("button",{onClick:t,style:{float:"right",background:"none",border:"none",fontSize:"24px",cursor:"pointer"},children:""}),k.jsx("p",{style:{color:"var(--text-secondary)"},children:"Connessione non trovata"})]})});const Kt=Pt(),tt=(mt,Pe)=>{const gn=parseInt(mt.slice(1,3),16),Et=parseInt(mt.slice(3,5),16),ze=parseInt(mt.slice(5,7),16);return`rgba(${gn}, ${Et}, ${ze}, ${Pe})`};return k.jsxs("div",{className:"detail-panel",children:[k.jsx("div",{style:{padding:"16px",borderBottom:"1px solid var(--border-color)",background:`linear-gradient(135deg, ${tt(Kt.color,.15)} 0%, ${tt(Kt.color,.02)} 100%)`,borderLeft:`4px solid ${Kt.color}`},children:k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[k.jsx("div",{children:k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[k.jsx("span",{style:{fontSize:"24px"},children:Mt()}),k.jsx("h2",{style:{fontSize:"18px",fontWeight:600,margin:0,color:Kt.color},children:ft()}),k.jsxs("span",{style:{fontSize:"12px",color:Kt.color},children:[" ",Kt.label]})]})}),k.jsx("button",{onClick:t,style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:Kt.color},children:""})]})}),k.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"16px"},children:[k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"8px",padding:"12px",marginBottom:"16px"},children:[k.jsx("div",{style:{fontWeight:500,fontSize:"14px"},children:r.nome_da||"Entit 1"}),r.tipo_da&&k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:r.tipo_da}),k.jsx("div",{style:{textAlign:"center",color:"var(--text-secondary)",margin:"8px 0",fontSize:"16px"},children:""}),k.jsx("div",{style:{fontWeight:500,fontSize:"14px"},children:r.nome_a||"Entit 2"}),r.tipo_a&&k.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:r.tipo_a})]}),k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"8px",padding:"12px",marginBottom:"16px"},children:[k.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)",fontWeight:600,marginBottom:"8px",textTransform:"uppercase"},children:"Tipo Connessione"}),k.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:XH.map(mt=>k.jsxs("button",{onClick:()=>Nt(mt.value),style:{padding:"6px 10px",borderRadius:"16px",border:C.includes(mt.value)?"2px solid var(--primary)":"1px solid var(--border-color)",background:C.includes(mt.value)?"rgba(99, 102, 241, 0.1)":"transparent",cursor:"pointer",fontSize:"12px",display:"flex",alignItems:"center",gap:"4px"},children:[k.jsx("span",{children:mt.icon}),k.jsx("span",{children:mt.label})]},mt.value))})]}),k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"8px",padding:"12px",marginBottom:"16px"},children:[k.jsx("div",{style:{fontSize:"11px",color:"var(--text-secondary)",fontWeight:600,marginBottom:"8px",textTransform:"uppercase"},children:"Certezza"}),k.jsx("div",{style:{display:"flex",gap:"8px"},children:[{value:"ipotesi",label:"Ipotetico",color:"#94a3b8"},{value:"probabile",label:"Probabile",color:"#eab308"},{value:"certo",label:"Certo",color:"#22c55e"}].map(mt=>k.jsxs("button",{onClick:()=>F(mt.value),style:{flex:1,padding:"8px 12px",borderRadius:"8px",border:L===mt.value?`2px solid ${mt.color}`:"1px solid var(--border-color)",background:L===mt.value?`${mt.color}15`:"transparent",cursor:"pointer",fontSize:"12px",fontWeight:L===mt.value?600:400,color:L===mt.value?mt.color:"var(--text-primary)",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[k.jsx("span",{style:{color:mt.color},children:""}),mt.label]},mt.value))})]}),qe&&(qe.volume_totale>0||qe.numero_transazioni>0)&&k.jsxs("div",{style:{background:"#f0fdf4",borderRadius:"8px",padding:"12px",marginBottom:"16px"},children:[k.jsx("div",{style:{fontSize:"11px",color:"#22c55e",fontWeight:600,marginBottom:"8px",textTransform:"uppercase"},children:"Dati Oggettivi"}),k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[k.jsx("span",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:"Volume totale"}),k.jsxs("span",{style:{fontSize:"13px",fontWeight:600},children:["",qe.volume_totale.toLocaleString("it-IT")]})]}),k.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[k.jsx("span",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:"Transazioni"}),k.jsx("span",{style:{fontSize:"13px",fontWeight:600},children:qe.numero_transazioni})]}),qe.ultima_transazione&&k.jsxs("div",{style:{fontSize:"11px",color:"var(--text-secondary)",marginTop:"8px"},children:["Ultima: ",new Date(qe.ultima_transazione).toLocaleDateString("it-IT")]})]}),k.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"8px",padding:"12px",marginBottom:"16px"},children:[k.jsx("div",{style:{fontSize:"11px",color:"#f59e0b",fontWeight:600,marginBottom:"12px",textTransform:"uppercase"},children:"Valutazione Soggettiva"}),k.jsx(Pw,{label:"Influenza",value:U,onChange:q}),k.jsx(Pw,{label:"Qualit relazione",value:G,onChange:$}),k.jsx(Pw,{label:"Importanza strategica",value:X,onChange:ie}),k.jsx(Pw,{label:"Affidabilit",value:de,onChange:fe}),k.jsx(Pw,{label:"Potenziale",value:be,onChange:ve}),k.jsxs("div",{style:{marginTop:"12px"},children:[k.jsx("label",{style:{fontSize:"13px",color:"var(--text-secondary)",display:"block",marginBottom:"4px"},children:"Note sulla relazione"}),k.jsx("textarea",{value:Qe,onChange:mt=>we(mt.target.value),placeholder:"Appunti sulla relazione...",style:{width:"100%",padding:"8px",borderRadius:"6px",border:"1px solid var(--border-color)",fontSize:"13px",resize:"vertical",minHeight:"60px",background:"var(--bg-primary)"}})]})]}),k.jsxs("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:[r.data_inizio&&k.jsxs("div",{style:{marginBottom:"4px"},children:[k.jsx("strong",{children:"Dal:"})," ",new Date(r.data_inizio).toLocaleDateString("it-IT")]}),r.fonte&&k.jsxs("div",{style:{marginBottom:"4px"},children:[k.jsx("strong",{children:"Fonte:"})," ",r.fonte]})]}),x&&k.jsx("div",{style:{padding:"8px",background:"rgba(239,68,68,0.1)",borderRadius:"6px",color:"#ef4444",fontSize:"12px",marginTop:"12px"},children:x})]}),k.jsxs("div",{style:{padding:"12px 16px",borderTop:"1px solid var(--border-color)",display:"flex",gap:"8px"},children:[k.jsx("button",{onClick:t,style:{flex:1,padding:"10px",border:"1px solid var(--border-color)",borderRadius:"8px",background:"transparent",cursor:"pointer",fontSize:"14px"},children:"Chiudi"}),k.jsx("button",{onClick:Je,disabled:s,style:{flex:1,padding:"10px",border:"none",borderRadius:"8px",background:"#6366f1",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:600},children:s?"Salvataggio...":"Salva"})]})]})}function bDe({position:e,onClose:t,onCreateEntity:n,tipiNeurone:r=[],categorieDisponibili:a=[]}){const[u,f]=B.useState("tipo"),[s,v]=B.useState(null),[x,A]=B.useState([]),[C,P]=B.useState(""),L=r,U=s?a.filter(de=>de.tipo_id===s.id):[],q=de=>{A(fe=>fe.includes(de)?fe.filter(be=>be!==de):[...fe,de])},G=de=>{v(de),A([]),f("categoria")},$=()=>{x.length!==0&&f("nome")},X=()=>{!s||x.length===0||n({nome:C||`${s.nome} ${new Date().toLocaleDateString("it-IT")}`,tipo:s.nome,categorie:x,lat:e.lat,lng:e.lng})},ie=de=>{switch(de){case"quadrato":return"";case"cerchio":return"";case"triangolo":return"";case"stella":return"";case"croce":return"";default:return""}};return k.jsxs("div",{style:y_,children:[k.jsxs("div",{style:XT,children:[k.jsxs("span",{style:{fontWeight:600},children:[u==="tipo"&&"Scegli tipo",u==="categoria"&&`${s==null?void 0:s.nome} - Categorie`,u==="nome"&&"Nome (opzionale)"]}),k.jsx("button",{onClick:t,style:YT,children:""})]}),u==="tipo"&&k.jsx("div",{style:Kg,children:L.map(de=>k.jsxs("button",{onClick:()=>G(de),style:ADe,children:[k.jsx("span",{style:{marginRight:"8px"},children:ie(de.forma)}),de.nome]},de.id))}),u==="categoria"&&k.jsxs("div",{style:Kg,children:[k.jsx("div",{style:{marginBottom:"8px",fontSize:"12px",color:"#6b7280"},children:"Seleziona una o pi categorie"}),k.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:U.map(de=>{const fe=x.includes(de.nome);return k.jsxs("button",{onClick:()=>q(de.nome),style:{...Yne,background:fe?de.colore:"#e5e7eb",color:fe?"white":"#374151",fontWeight:fe?600:400},children:[fe&&" ",de.nome]},de.id)})}),k.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"12px"},children:[k.jsx("button",{onClick:()=>f("tipo"),style:YH,children:" Indietro"}),k.jsx("button",{onClick:$,disabled:x.length===0,style:{...AC,opacity:x.length===0?.5:1},children:"Avanti "})]})]}),u==="nome"&&k.jsxs("div",{style:Kg,children:[k.jsx("input",{type:"text",value:C,onChange:de=>P(de.target.value),placeholder:`${s==null?void 0:s.nome} ${new Date().toLocaleDateString("it-IT")}`,style:H4,autoFocus:!0}),k.jsx("div",{style:{fontSize:"11px",color:"#6b7280",marginBottom:"12px"},children:"Lascia vuoto per nome automatico"}),k.jsxs("div",{style:{display:"flex",gap:"8px"},children:[k.jsx("button",{onClick:()=>f("categoria"),style:YH,children:" Indietro"}),k.jsx("button",{onClick:X,style:AC,children:"Crea"})]})]})]})}function wDe({neurone:e,onClose:t,onVendi:n,onCompra:r,onConnetti:a}){return k.jsxs("div",{style:y_,children:[k.jsxs("div",{style:XT,children:[k.jsx("span",{style:{fontWeight:600,fontSize:"14px"},children:e.nome}),k.jsx("button",{onClick:t,style:YT,children:""})]}),k.jsxs("div",{style:Kg,children:[k.jsx("button",{onClick:n,style:{..._2,background:"#10b981"},children:" Vendi a..."}),k.jsx("button",{onClick:r,style:{..._2,background:"#3b82f6"},children:" Compra da..."}),k.jsx("button",{onClick:a,style:{..._2,background:"#8b5cf6"},children:" Connetti con..."})]})]})}function TDe({action:e,onClose:t,onSelectOnMap:n,onSelectFromList:r}){const a={vendi:"A chi vendi?",compra:"Da chi compri?",connetti:"Con chi connetti?"};return k.jsxs("div",{style:y_,children:[k.jsxs("div",{style:XT,children:[k.jsx("span",{style:{fontWeight:600},children:a[e]}),k.jsx("button",{onClick:t,style:YT,children:""})]}),k.jsxs("div",{style:Kg,children:[k.jsx("button",{onClick:n,style:{..._2,background:"#f59e0b"},children:" Clicca su mappa"}),k.jsx("button",{onClick:r,style:{..._2,background:"#6366f1"},children:" Cerca nella lista"})]})]})}function EDe({onClose:e,onConfirm:t}){const[n,r]=B.useState([]),[a,u]=B.useState([]),[f,s]=B.useState(!0);B.useEffect(()=>{(async()=>{try{const A=await Xn.getTipiSinapsi();r(A.data)}catch(A){console.error("Errore:",A)}finally{s(!1)}})()},[]);const v=x=>{u(A=>A.includes(x)?A.filter(C=>C!==x):[...A,x])};return f?k.jsx("div",{style:y_,children:k.jsx("div",{style:{padding:"20px"},children:"Caricamento..."})}):k.jsxs("div",{style:y_,children:[k.jsxs("div",{style:XT,children:[k.jsx("span",{style:{fontWeight:600},children:"Tipo connessione"}),k.jsx("button",{onClick:e,style:YT,children:""})]}),k.jsxs("div",{style:Kg,children:[k.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",marginBottom:"12px"},children:n.map(x=>{const A=a.includes(x.nome);return k.jsxs("button",{onClick:()=>v(x.nome),style:{...Yne,background:A?x.colore:"#e5e7eb",color:A?"white":"#374151",fontWeight:A?600:400},children:[A&&" ",x.nome]},x.id)})}),k.jsx("button",{onClick:()=>t(a),disabled:a.length===0,style:{...AC,opacity:a.length===0?.5:1},children:"Conferma"})]})]})}function SDe({sourceNeurone:e,targetNeurone:t,action:n,onClose:r,onConfirm:a}){const[u,f]=B.useState([]),[s,v]=B.useState(""),[x,A]=B.useState(""),[C,P]=B.useState(new Date().toISOString().split("T")[0]),[L,F]=B.useState(!0);B.useEffect(()=>{(async()=>{try{const $=await Xn.getFamiglieProdotto();f($.data),$.data.length>0&&v($.data[0].id)}catch($){console.error("Errore:",$)}finally{F(!1)}})()},[]);const U=()=>{!s||!x||a({famigliaId:s,importo:parseFloat(x),data:C})},q=n==="vendi"?`${e.nome} vende a ${t.nome}`:`${e.nome} compra da ${t.nome}`;return L?k.jsx("div",{style:y_,children:k.jsx("div",{style:{padding:"20px"},children:"Caricamento..."})}):k.jsxs("div",{style:{...y_,minWidth:"280px"},children:[k.jsxs("div",{style:XT,children:[k.jsx("span",{style:{fontWeight:600,fontSize:"13px"},children:q}),k.jsx("button",{onClick:r,style:YT,children:""})]}),k.jsx("div",{style:Kg,children:u.length===0?k.jsx("div",{style:{padding:"12px",background:"#fef3c7",borderRadius:"8px",fontSize:"13px",color:"#92400e"},children:"Nessuna famiglia prodotto configurata."}):k.jsxs(k.Fragment,{children:[k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"12px",color:"#6b7280",marginBottom:"4px",display:"block"},children:"Prodotto"}),k.jsx("select",{value:s,onChange:G=>v(G.target.value),style:{...H4,marginBottom:"8px"},children:u.map(G=>k.jsx("option",{value:G.id,children:G.nome},G.id))})]}),k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"12px",color:"#6b7280",marginBottom:"4px",display:"block"},children:"Importo ()"}),k.jsx("input",{type:"number",value:x,onChange:G=>A(G.target.value),placeholder:"0.00",style:{...H4,marginBottom:"8px"},autoFocus:!0})]}),k.jsxs("div",{children:[k.jsx("label",{style:{fontSize:"12px",color:"#6b7280",marginBottom:"4px",display:"block"},children:"Data"}),k.jsx("input",{type:"date",value:C,onChange:G=>P(G.target.value),style:{...H4,marginBottom:"12px"}})]}),k.jsx("button",{onClick:U,disabled:!s||!x,style:{...AC,opacity:!s||!x?.5:1,background:n==="vendi"?"#10b981":"#3b82f6"},children:n==="vendi"?"Registra Vendita":"Registra Acquisto"})]})})]})}const y_={background:"white",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.25)",minWidth:"220px",maxWidth:"300px",overflow:"hidden"},XT={display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #e5e7eb",background:"#f9fafb"},YT={background:"none",border:"none",fontSize:"16px",cursor:"pointer",color:"#6b7280",padding:"4px"},Kg={padding:"12px 16px",display:"flex",flexDirection:"column",gap:"8px"},ADe={display:"flex",alignItems:"center",width:"100%",padding:"10px 12px",border:"none",borderRadius:"8px",background:"#f3f4f6",cursor:"pointer",fontSize:"14px",textAlign:"left",transition:"background 0.15s"},_2={display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",padding:"12px",border:"none",borderRadius:"8px",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:500},Yne={padding:"6px 12px",borderRadius:"16px",border:"none",cursor:"pointer",fontSize:"13px",transition:"all 0.15s"},YH={flex:1,padding:"10px",border:"1px solid #d1d5db",borderRadius:"8px",background:"white",cursor:"pointer",fontSize:"13px"},AC={flex:1,padding:"10px",border:"none",borderRadius:"8px",background:"#3b82f6",color:"white",cursor:"pointer",fontSize:"13px",fontWeight:500},H4={width:"100%",padding:"10px 12px",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"14px",marginBottom:"4px"},KH=[e=>`Ciao ${e}! `,e=>`Ben rivisto, ${e}!`,e=>`Eccomi ${e}!`,e=>`Ehi ${e}!`,e=>`Buongiorno ${e}!`,e=>`Ciao ${e}, sono qui!`],CDe=[{label:" Analizza i dati",prompt:"Fammi un'analisi generale sui miei dati: clienti, vendite, trend..."},{label:" Cerca qualcosa",prompt:""},{label:" Esplora la mappa",prompt:"Mostrami una panoramica della mappa con le entit principali"},{label:" Dammi un consiglio",prompt:"Guardando i miei dati, c' qualcosa che dovrei sapere? Clienti dormienti, opportunit, problemi?"}],V3="genagenta_ai_chat_history";function kDe({isOpen:e,onClose:t,onAction:n,selectedEntity:r,visibilityContext:a,userActions:u,userName:f="utente",initialMessage:s,onInitialMessageSent:v,aiMarkers:x=[],onClearAiMarkers:A,copilotContext:C}){const[P,L]=B.useState([]),[F,U]=B.useState(""),[q,G]=B.useState(!1),[$,X]=B.useState("thinking"),[ie,de]=B.useState({messagesCount:0,threshold:25}),fe=B.useRef(null),be=B.useRef(null),{exportForAi:ve,executeAction:Qe}=GD(),[we,qe]=B.useState({x:20,y:20}),[Je,ft]=B.useState(!1),Mt=B.useRef({x:0,y:0,posX:0,posY:0}),Pt=Et=>{Et.target.closest("button")||(ft(!0),Mt.current={x:Et.clientX,y:Et.clientY,posX:we.x,posY:we.y},Et.preventDefault())};B.useEffect(()=>{if(!Je)return;const Et=$t=>{const Cn=Mt.current.x-$t.clientX,fn=Mt.current.y-$t.clientY;qe({x:Math.max(0,Mt.current.posX+Cn),y:Math.max(0,Mt.current.posY+fn)})},ze=()=>{ft(!1)};return document.addEventListener("mousemove",Et),document.addEventListener("mouseup",ze),()=>{document.removeEventListener("mousemove",Et),document.removeEventListener("mouseup",ze)}},[Je]);const Nt=B.useMemo(()=>{const Et=KH[Math.floor(Math.random()*KH.length)];return Et(f.split(" ")[0])},[f]);B.useEffect(()=>{try{const Et=localStorage.getItem(V3);if(Et){const $t=JSON.parse(Et).map(Cn=>({...Cn,timestamp:new Date(Cn.timestamp)}));L($t)}}catch(Et){console.error("Errore caricamento chat salvata:",Et)}},[]),B.useEffect(()=>{P.length>0&&localStorage.setItem(V3,JSON.stringify(P))},[P]),B.useEffect(()=>{var Et;(Et=fe.current)==null||Et.scrollIntoView({behavior:"smooth"})},[P]),B.useEffect(()=>{e&&setTimeout(()=>{var Et;return(Et=be.current)==null?void 0:Et.focus()},100)},[e]),B.useEffect(()=>{e&&s&&!q&&(U(s),v==null||v(),setTimeout(()=>{const Et=document.querySelector("[data-ai-submit]");Et==null||Et.click()},100))},[e,s]);const Kt=()=>{L([]),localStorage.removeItem(V3),A==null||A()},tt=(Et,ze)=>{if(!a)return{visible:!0};const{activeFilters:$t}=a;return $t.tipoNeurone&&Et&&$t.tipoNeurone.toLowerCase()!==Et.toLowerCase()?{visible:!1,filteredOutBy:`filtro tipo attivo: "${$t.tipoNeurone}"`}:$t.categoria&&ze&&$t.categoria!==ze?{visible:!1,filteredOutBy:`filtro categoria attivo: "${$t.categoria}"`}:{visible:!0}},mt=async Et=>{var ze,$t,Cn,fn,Nn,bn,Vt,En,Sn,Un;console.log("Eseguo pending_action:",Et);try{let nn,wr,Xr;switch(Et.action_type){case"createNeurone":nn=await Xn.createNeurone(Et.payload),wr=(ze=Et.payload)==null?void 0:ze.tipo,Xr=(Cn=($t=Et.payload)==null?void 0:$t.categorie)==null?void 0:Cn[0];break;case"updateNeurone":if(!Et.entity_id)throw new Error("entity_id mancante");await Xn.updateNeurone(Et.entity_id,Et.payload),nn={success:!0,id:Et.entity_id},wr=(fn=Et.payload)==null?void 0:fn.tipo;break;case"deleteNeurone":if(!Et.entity_id)throw new Error("entity_id mancante");await Xn.deleteNeurone(Et.entity_id),nn={success:!0,deleted:Et.entity_id};break;case"createSinapsi":nn=await Xn.createSinapsi(Et.payload);break;case"deleteSinapsi":if(!Et.sinapsi_id)throw new Error("sinapsi_id mancante");await Xn.deleteSinapsi(Et.sinapsi_id),nn={success:!0,deleted:Et.sinapsi_id};break;case"createVendita":nn=await Xn.createVendita(Et.payload);break;case"deleteSale":if(!Et.sale_id)throw new Error("sale_id mancante");nn=await Xn.deleteVendita(Et.sale_id);break;case"createNota":const tr=Et.payload;nn=await Xn.createNota(tr.neurone_id,tr.testo);break;case"callApi":Et.method==="POST"?(nn=(await Xn.post(Et.endpoint,Et.payload)).data,(Nn=Et.endpoint)!=null&&Nn.includes("neuroni")&&(wr=(bn=Et.payload)==null?void 0:bn.tipo,Xr=(En=(Vt=Et.payload)==null?void 0:Vt.categorie)==null?void 0:En[0])):Et.method==="PUT"?nn=(await Xn.put(Et.endpoint,Et.payload)).data:Et.method==="DELETE"&&(nn=(await Xn.delete(Et.endpoint)).data);break;default:throw new Error(`Tipo azione non supportato: ${Et.action_type}`)}if(console.log("Pending action completata:",nn),["createNeurone","updateNeurone"].includes(Et.action_type)||Et.action_type==="callApi"&&((Sn=Et.endpoint)==null?void 0:Sn.includes("neuroni"))&&Et.method==="POST"){const tr=tt(wr,Xr);return console.log("Visibility check:",{entityType:wr,entityCategoria:Xr,visibility:tr}),{success:!0,data:nn,visibility:tr}}return{success:!0,data:nn}}catch(nn){console.error("Errore esecuzione pending_action:",nn);let wr="Errore sconosciuto";if(nn&&typeof nn=="object"&&"response"in nn){const Xr=nn;(Un=Xr.response)!=null&&Un.data&&(wr=Xr.response.data.error||Xr.response.data.message||"Errore API")}else nn instanceof Error&&(wr=nn.message);return{success:!1,error:wr}}},Pe=async()=>{var $t,Cn,fn,Nn,bn;if(!F.trim()||q)return;const Et={role:"user",content:F.trim(),timestamp:new Date};L(Vt=>[...Vt,Et]),U(""),G(!0);const ze=P.length>=25;X(ze?"compacting":"thinking");try{const En=P.slice(-30).map(ar=>({role:ar.role,content:ar.content.length>1500?ar.content.substring(0,1500)+"...[troncato]":ar.content,tool_summary:ar.tool_summary}));ze&&(X("compacting"),await new Promise(ar=>setTimeout(ar,500))),X("thinking");let Sn=!0,Un=null,nn=null,wr=0;const Xr=10;for(;Sn&&wr<Xr;){if(wr++,nn){const tr=nn._actionResult;delete nn._actionResult,Un=await Xn.aiChatContinue(nn,tr)}else{const tr=ve(),Vn={};r&&(Vn.selectedEntity=r),u&&u.length>0&&(Vn.userActions=u),x&&x.length>0&&(Vn.aiMarkers=x),C&&(Vn.copilotContext=C),tr&&(Vn.uiState=tr),console.log("=== AI CHAT CONTEXT DEBUG ==="),console.log("selectedEntity:",r),console.log("userActions count:",(u==null?void 0:u.length)||0),console.log("aiMarkers count:",(x==null?void 0:x.length)||0),console.log("copilotContext length:",(C==null?void 0:C.length)||0),console.log("uiState length:",(tr==null?void 0:tr.length)||0),console.log("=============================");try{const xr=await Xn.aiDualBrain(Et.content,Object.keys(Vn).length>0?Vn:void 0);if(xr.success)Un={response:(xr.delegated?`${xr.agea_message||""}

${xr.engineer_result||""}`:xr.response||"").trim(),status:"complete",actions:[{agent:xr.agent,delegated:xr.delegated}]};else throw new Error(xr.error||"Dual Brain error")}catch(xr){console.warn("Dual Brain fallback to old API:",xr),Un=await Xn.aiChat(Et.content,En,Object.keys(Vn).length>0?Vn:void 0)}}if(Un.status==="pending_action"&&Un.pending_action){if(console.log("Pending action ricevuta:",Un.pending_action),Un.partial_response){const Vn={role:"assistant",content:Un.partial_response+" ",timestamp:new Date};L(xr=>[...xr.filter(bi=>!bi.content.endsWith(" ")),Vn])}const tr=await mt(Un.pending_action);if(nn={...Un.resume_context||{},_actionResult:tr},tr.success){const Vn=Un.pending_action.action_type,xr=Un.pending_action.endpoint||"",ws=Un.pending_action.method||"",bi=["createNeurone","updateNeurone","deleteNeurone"].includes(Vn),Ai=["createSinapsi","deleteSinapsi"].includes(Vn),ps=Vn==="callApi"&&(xr.includes("neuroni")||xr.includes("sinapsi"));console.log("DEBUG refresh check:",{actionType:Vn,endpoint:xr,method:ws,isNeuroniAction:bi,isSinapsiAction:Ai,isCallApiOnNeuroni:ps,willRefresh:bi||Ai||ps}),(bi||Ai||ps)&&(console.log("TRIGGERING refresh_neuroni!"),n==null||n({type:"refresh_neuroni"}))}continue}if(Sn=!1,L(tr=>tr.filter(Vn=>!Vn.content.endsWith(" "))),Un.context&&(de({messagesCount:Un.context.messages_count||0,threshold:Un.context.compaction_threshold||25}),Un.context.did_compaction&&Un.context.compaction_summary)){console.log("Compaction ricevuta, reset history con riassunto");const tr={role:"assistant",content:`[Riassunto: ${Un.context.compaction_summary}]`,timestamp:new Date},Vn={role:"assistant",content:Un.response||"Fatto!",timestamp:new Date},xr=[tr,Et,Vn];if(L(xr),localStorage.setItem(V3,JSON.stringify(xr)),Un.actions&&Array.isArray(Un.actions))for(const ws of Un.actions){const bi=ws;console.log("Eseguo azione AI (post-compaction):",bi),bi.type==="ui_action"&&bi.action_id?await Qe(bi.action_id,bi.action_params||{}):n&&n(bi)}return}const ar={role:"assistant",content:Un.response||"Fatto!",timestamp:new Date,tool_summary:Un.tool_summary};if(L(tr=>[...tr,ar]),Un.actions&&Array.isArray(Un.actions))for(const tr of Un.actions){const Vn=tr;if(console.log("Eseguo azione AI:",Vn),Vn.type==="ui_action"&&Vn.action_id){console.log("Eseguo UI action:",Vn.action_id,Vn.action_params);const xr=await Qe(Vn.action_id,Vn.action_params||{});console.log("UI action result:",xr)}else n&&n(Vn)}}if(wr>=Xr){console.warn("Frontend execution: raggiunto limite loop");const ar={role:"assistant",content:"Ho completato diverse operazioni. C' altro che posso fare?",timestamp:new Date};L(tr=>[...tr,ar])}}catch(Vt){console.error("Errore AI:",Vt);let En="";if(Vt&&typeof Vt=="object"){const Un=Vt;(Cn=($t=Un.response)==null?void 0:$t.data)!=null&&Cn.error?En=Un.response.data.error:(Nn=(fn=Un.response)==null?void 0:fn.data)!=null&&Nn.message?En=Un.response.data.message:(bn=Un.response)!=null&&bn.status?En=`Errore HTTP ${Un.response.status}`:Un.message&&(En=Un.message)}if(En)try{X("thinking");const Un=`[ERRORE SISTEMA] Ho ricevuto questo errore tecnico mentre provavo a eseguire la tua richiesta:

"${En}"

Spiega all'utente cosa  successo in modo semplice e, se possibile, suggerisci come risolvere o cosa provare.`,nn=await Xn.aiChat(Un,P.slice(-5),{selectedEntity:r||void 0});if(nn.response){const wr={role:"assistant",content:nn.response,timestamp:new Date};L(Xr=>[...Xr,wr]);return}}catch{console.error("Anche la chiamata di interpretazione errore  fallita")}const Sn={role:"assistant",content:En?`Ops!  C' stato un problema tecnico:

**${En}**

Potrebbe essere un problema temporaneo - riprova tra poco.`:"Ahia!  Mi sa che ho fatto un pasticcio... Forse dovremmo dare un'occhiata lato software, da qui non riesco proprio!",timestamp:new Date};L(Un=>[...Un,Sn])}finally{G(!1),X("thinking"),setTimeout(()=>{var Vt;return(Vt=be.current)==null?void 0:Vt.focus()},100)}},gn=Et=>{Et.key==="Enter"&&!Et.shiftKey&&(Et.preventDefault(),Pe())};return e?k.jsxs("div",{style:{position:"fixed",bottom:`${we.y}px`,right:`${we.x}px`,width:"400px",height:"500px",backgroundColor:"var(--bg-secondary)",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",display:"flex",flexDirection:"column",zIndex:1e3,border:"1px solid var(--border)"},children:[k.jsxs("div",{onMouseDown:Pt,style:{padding:"12px 16px",borderBottom:"1px solid var(--border)",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"var(--bg-primary)",borderRadius:"12px 12px 0 0",cursor:Je?"grabbing":"grab",userSelect:"none"},children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[k.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",background:"linear-gradient(135deg, #3b82f6, #8b5cf6)",boxShadow:"0 0 12px rgba(59, 130, 246, 0.6), 0 0 24px rgba(139, 92, 246, 0.3)"}}),k.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:"Agea"}),P.length>0&&k.jsx("span",{style:{marginLeft:"8px",padding:"2px 8px",backgroundColor:"rgba(59, 130, 246, 0.1)",borderRadius:"10px",fontSize:"11px",color:"var(--text-secondary)"},children:P.length}),r&&k.jsx("span",{title:`Contesto: ${r.nome}`,style:{marginLeft:"4px",padding:"2px 6px",backgroundColor:"rgba(34, 197, 94, 0.15)",borderRadius:"10px",fontSize:"10px",color:"#22c55e",maxWidth:"100px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.nome})]}),k.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[x.length>0&&k.jsxs("button",{onClick:A,title:`Rimuovi ${x.length} segnaposto`,style:{background:"none",border:"1px solid #f97316",borderRadius:"6px",fontSize:"11px",cursor:"pointer",color:"#f97316",padding:"4px 8px",display:"flex",alignItems:"center",gap:"4px"},children:[" ",x.length]}),P.length>0&&k.jsx("button",{onClick:Kt,title:"Nuova sessione",style:{background:"none",border:"1px solid var(--border-color)",borderRadius:"6px",fontSize:"11px",cursor:"pointer",color:"var(--text-secondary)",padding:"4px 8px"},children:"Nuova"}),k.jsx("button",{onClick:t,style:{background:"none",border:"none",fontSize:"20px",cursor:"pointer",color:"var(--text-secondary)",padding:"4px"},children:""})]})]}),k.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"12px",display:"flex",flexDirection:"column",gap:"12px"},children:[P.length===0&&k.jsxs("div",{style:{textAlign:"center",color:"var(--text-secondary)",padding:"20px",fontSize:"14px"},children:[k.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"50%",background:"linear-gradient(135deg, #3b82f6, #8b5cf6)",margin:"0 auto 16px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 20px rgba(59, 130, 246, 0.4)"},children:k.jsx("span",{style:{fontSize:"24px"},children:""})}),k.jsx("p",{style:{marginBottom:"8px",fontSize:"16px",fontWeight:600,color:"var(--text-primary)"},children:Nt}),k.jsx("p",{style:{fontSize:"13px",opacity:.8,marginBottom:"20px"},children:"Hai gi qualche idea, o partiamo da un'analisi?"}),k.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"},children:CDe.map((Et,ze)=>k.jsx("button",{onClick:()=>{var $t;Et.prompt?(U(Et.prompt),setTimeout(()=>{var fn;const Cn=new KeyboardEvent("keydown",{key:"Enter"});(fn=be.current)==null||fn.dispatchEvent(Cn)},100)):($t=be.current)==null||$t.focus()},style:{padding:"12px 10px",background:"var(--bg-primary)",border:"1px solid var(--border)",borderRadius:"10px",cursor:"pointer",color:"var(--text-primary)",fontSize:"12px",fontWeight:500,transition:"all 0.2s ease",textAlign:"center"},onMouseOver:$t=>{$t.currentTarget.style.background="var(--bg-hover)",$t.currentTarget.style.borderColor="var(--primary)"},onMouseOut:$t=>{$t.currentTarget.style.background="var(--bg-primary)",$t.currentTarget.style.borderColor="var(--border)"},children:Et.label},ze))})]}),P.map((Et,ze)=>k.jsx("div",{style:{display:"flex",justifyContent:Et.role==="user"?"flex-end":"flex-start"},children:k.jsx("div",{style:{maxWidth:"85%",padding:"10px 14px",borderRadius:"12px",backgroundColor:Et.role==="user"?"#3b82f6":"var(--bg-primary)",color:Et.role==="user"?"white":"var(--text-primary)",fontSize:"14px",lineHeight:"1.5",whiteSpace:"pre-wrap"},children:Et.content})},ze)),q&&k.jsx("div",{style:{display:"flex",justifyContent:"flex-start"},children:k.jsx("div",{style:{padding:"10px 14px",borderRadius:"12px",backgroundColor:"var(--bg-primary)",color:"var(--text-secondary)",fontSize:"14px"},children:$==="compacting"?k.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("span",{style:{fontSize:"12px"},children:""}),"Sto riassumendo la conversazione",k.jsx("span",{className:"dots-animation",children:"..."})]}):k.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[k.jsx("span",{className:"thinking-dot"}),"Sto pensando",k.jsx("span",{className:"dots-animation",children:"..."})]})})}),k.jsx("div",{ref:fe})]}),k.jsxs("div",{style:{padding:"12px",borderTop:"1px solid var(--border)",display:"flex",gap:"8px"},children:[k.jsx("textarea",{ref:be,value:F,onChange:Et=>U(Et.target.value),onKeyDown:gn,placeholder:"Scrivi un messaggio...",disabled:q,style:{flex:1,padding:"10px 12px",borderRadius:"8px",border:"1px solid var(--border)",backgroundColor:"var(--bg-primary)",color:"var(--text-primary)",fontSize:"14px",resize:"none",minHeight:"44px",maxHeight:"100px"},rows:1}),k.jsx("button",{"data-ai-submit":!0,onClick:Pe,disabled:!F.trim()||q,style:{padding:"10px 16px",borderRadius:"8px",border:"none",backgroundColor:F.trim()&&!q?"#3b82f6":"#6b7280",color:"white",cursor:F.trim()&&!q?"pointer":"not-allowed",fontSize:"14px",fontWeight:500},children:"Invia"})]})]}):null}function IDe({selectedEntity:e,focusedEntity:t,activeFilters:n,sinapsi:r=[],neuroni:a=[],onSuggestionClick:u,isChatOpen:f=!1}){const[s,v]=B.useState([]),[x,A]=B.useState(!0);B.useEffect(()=>{v([]),A(!0)},[e==null?void 0:e.id,t==null?void 0:t.id]);const C=B.useMemo(()=>{var q,G,$,X;const F=[],U=e||t;if(U){const ie=r.filter(de=>de.neurone_da===U.id||de.neurone_a===U.id);ie.length>0?F.push({id:"analizza-connessioni",text:`Analizza ${ie.length} connessioni`,icon:"",action:`Analizza le connessioni di ${U.nome}`,priority:10}):F.push({id:"suggerisci-connessioni",text:"Suggerisci connessioni",icon:"",action:`Quali connessioni potrei creare per ${U.nome}?`,priority:8}),((q=U.tipo)!=null&&q.toLowerCase().includes("cliente")||(G=U.tipo)!=null&&G.toLowerCase().includes("impresa"))&&F.push({id:"storico-vendite",text:"Vedi storico vendite",icon:"",action:`Mostrami lo storico vendite di ${U.nome}`,priority:9}),(($=U.tipo)!=null&&$.toLowerCase().includes("cantiere")||(X=U.tipo)!=null&&X.toLowerCase().includes("luogo"))&&F.push({id:"attivita-cantiere",text:"Analizza attivit",icon:"",action:`Quali attivit ci sono state su ${U.nome}?`,priority:9}),F.push({id:"info-entita",text:"Maggiori info",icon:"",action:`Dimmi tutto quello che sai su ${U.nome}`,priority:5})}if(n){const ie=[...n.tipiAttivi,...n.categorieAttive].filter(Boolean);ie.length>0&&a.length>0&&F.push({id:"analizza-filtro",text:`Analizza ${a.length} risultati`,icon:"",action:`Analizza le ${a.length} entit filtrate: ${ie.join(", ")}`,priority:7}),n.ricerca&&n.ricerca.length>2&&F.push({id:"espandi-ricerca",text:"Espandi ricerca",icon:"",action:`Cerca entit simili a "${n.ricerca}"`,priority:6})}return!U&&(!n||n.tipiAttivi.length===0)&&(a.length>10&&F.push({id:"overview-generale",text:"Panoramica generale",icon:"",action:"Dammi una panoramica generale della mia rete",priority:4}),F.push({id:"trend-vendite",text:"Trend vendite",icon:"",action:"Come stanno andando le vendite questo mese?",priority:3})),F.filter(ie=>!s.includes(ie.id)).sort((ie,de)=>de.priority-ie.priority).slice(0,3)},[e,t,n,r,a,s]);if(f||!x||C.length===0)return null;const P=F=>{u(F.action),v(U=>[...U,F.id])},L=()=>{A(!1)};return k.jsxs("div",{style:{position:"fixed",bottom:"100px",right:"24px",zIndex:1500,display:"flex",flexDirection:"column",gap:"8px",maxWidth:"280px"},children:[k.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:"4px"},children:[k.jsx("span",{style:{fontSize:"11px",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.5px"},children:" Suggerimenti"}),k.jsx("button",{onClick:L,style:{background:"transparent",border:"none",color:"var(--text-secondary)",cursor:"pointer",fontSize:"14px",padding:"2px 6px",borderRadius:"4px"},title:"Chiudi suggerimenti",children:""})]}),C.map((F,U)=>k.jsxs("button",{onClick:()=>P(F),style:{display:"flex",alignItems:"center",gap:"10px",padding:"10px 14px",background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"12px",cursor:"pointer",textAlign:"left",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease",animation:`slideIn 0.3s ease ${U*.1}s both`},onMouseEnter:q=>{q.currentTarget.style.background="var(--bg-primary)",q.currentTarget.style.borderColor="var(--primary)",q.currentTarget.style.transform="translateX(-4px)"},onMouseLeave:q=>{q.currentTarget.style.background="var(--bg-secondary)",q.currentTarget.style.borderColor="var(--border-color)",q.currentTarget.style.transform="translateX(0)"},children:[k.jsx("span",{style:{fontSize:"18px"},children:F.icon}),k.jsx("span",{style:{fontSize:"13px",color:"var(--text-primary)",fontWeight:500},children:F.text})]},F.id)),k.jsx("style",{children:`
        @keyframes slideIn {
          from {
            opacity: 0;
            transform: translateX(20px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
      `})]})}function RDe(){const{user:e,personalAccess:t,verifyPin:n,exitPersonalMode:r,logout:a,updateUser:u}=HD(),[f,s]=B.useState({dataInizio:new Date(Date.now()-365*24*60*60*1e3).toISOString().split("T")[0],dataFine:new Date().toISOString().split("T")[0],tipoNeurone:null,categoria:null,certezza:null,valoreMin:null,raggio:null,centro:null,mostraConnessioni:!0,soloConnessioniSelezionate:!1,tipiSelezionati:[],categorieSelezionate:[],ricerca:""}),{data:v=[],isLoading:x}=CLe(f),{data:A=[],isLoading:C}=ILe(f),{data:P=[]}=Wne(),{data:L=[]}=MLe(),{invalidateNeuroniESinapsi:F,invalidateNeuroni:U,invalidateSinapsi:q}=ZT(),G=x||C,[$,X]=B.useState(null),[ie,de]=B.useState(!1),[fe,be]=B.useState(null),[ve,Qe]=B.useState(null),[we,qe]=B.useState(!1),[Je,ft]=B.useState(!1),[Mt,Pt]=B.useState(!1),[Nt,Kt]=B.useState(null),[tt,mt]=B.useState(!1),[Pe,gn]=B.useState(null),[Et,ze]=B.useState(null),[$t,Cn]=B.useState(null),[fn,Nn]=B.useState([]),[bn,Vt]=B.useState(null),[En,Sn]=B.useState(!1),[Un,nn]=B.useState(null),[wr,Xr]=B.useState(null),[ar,tr]=B.useState(!1),[Vn,xr]=B.useState(null),[ws,bi]=B.useState(null),[Ai,ps]=B.useState(null),[$i,Ts]=B.useState(null),[tn,kn]=B.useState(null),[Mr,wt]=B.useState(null),[Rn,nr]=B.useState(null),[dt,Jn]=B.useState([]),qr=(rn,rr)=>{const Ve={type:rn,timestamp:new Date().toISOString(),data:rr};Jn(or=>rn==="map_move"?[...or.filter(Yn=>Yn.type!=="map_move").slice(-9),Ve]:[...or.slice(-9),Ve]),console.log("User action logged:",Ve)},ts=B.useRef(!1),ms=B.useRef(null),Mn=B.useRef(null);B.useEffect(()=>{ts.current=En},[En]),B.useEffect(()=>{ms.current=wr},[wr]),B.useEffect(()=>{Mn.current=$i,console.log("DEBUG quickAction aggiornato a:",$i)},[$i]),B.useEffect(()=>{ie&&$&&fe&&$.id!==fe.id&&be($)},[$,ie,fe]),B.useEffect(()=>{$&&nr($.id)},[$]);const Tt=rn=>{s(rr=>{const Ve=typeof rn=="function"?rn(rr):rn,or=[];return rr.tipoNeurone!==Ve.tipoNeurone&&or.push(`tipo: ${Ve.tipoNeurone||"tutti"}`),rr.categoria!==Ve.categoria&&or.push(`categoria: ${Ve.categoria||"tutte"}`),rr.ricerca!==Ve.ricerca&&or.push(`ricerca: "${Ve.ricerca}"`),JSON.stringify(rr.tipiSelezionati)!==JSON.stringify(Ve.tipiSelezionati)&&or.push(`tipi: ${Ve.tipiSelezionati.length>0?Ve.tipiSelezionati.join(", "):"tutti"}`),JSON.stringify(rr.categorieSelezionate)!==JSON.stringify(Ve.categorieSelezionate)&&or.push(`categorie: ${Ve.categorieSelezionate.length>0?Ve.categorieSelezionate.join(", "):"tutte"}`),or.length>0&&qr("filter_change",{filterName:"filtri",filterValue:or.join("; ")}),Ve})},ut=FLe({neuroni:v,sinapsi:A,filtri:f,selectedNeurone:$,selectedSinapsiId:Mr,aiMarkers:fn,userActions:dt,tipiNeurone:P,mapViewport:bn,categorie:L}),on=BLe(ut);H8e({description:"Current state of the GenAgenta CRM application",value:on}),B.useEffect(()=>{(async()=>{try{const rr=await Xn.getInvitiPendenti();rr.has_invite&&rr.invito&&Qe(rr.invito)}catch(rr){console.error("Errore controllo inviti:",rr)}})()},[]);const qn=async rn=>{try{const rr=await Xn.getNeurone(rn.id);X(rr),wt(null),qr("panel_open",{panelName:"detail_panel"})}catch(rr){console.error("Errore caricamento dettaglio:",rr)}},Or=async rn=>{try{await n(rn),window.location.reload()}catch{throw new Error("PIN non valido")}},Zn=async rn=>{await Xn.setPin(rn),e&&u({...e,has_pin:!0})},ns=()=>{Nn([])},ga=rn=>{Nn(rr=>rr.filter(Ve=>Ve.id!==rn))},Ys=rn=>{switch(console.log("AI Action ricevuta:",rn),rn.type){case"map_fly_to":rn.lat!==void 0&&rn.lng!==void 0&&ze({lat:rn.lat,lng:rn.lng,zoom:rn.zoom,pitch:rn.pitch,bearing:rn.bearing});break;case"map_set_style":rn.style&&Cn(rn.style);break;case"map_select_entity":if(rn.entity_id){const rr=v.find(Ve=>Ve.id===rn.entity_id);rr&&(X(rr),nr(rr.id),rr.lat&&rr.lng&&ze({lat:rr.lat,lng:rr.lng}))}break;case"map_show_connections":if(rn.entity_id){const rr=v.find(Ve=>Ve.id===rn.entity_id);rr&&(nr(rr.id),X(rr))}break;case"ui_open_panel":if(rn.panel==="entity_detail"&&rn.entity_id){const rr=v.find(Ve=>Ve.id===rn.entity_id);rr&&X(rr)}break;case"ui_notification":rn.notification_message&&console.log(`[${rn.notification_type||"info"}] ${rn.notification_message}`);break;case"refresh_neuroni":console.log("AI Action: refresh_neuroni (+ sinapsi) via invalidation"),F();break;case"map_place_marker":rn.lat!==void 0&&rn.lng!==void 0&&(Nn(rr=>{if(rr.length>=20)return console.warn("Limite di 20 marker raggiunto"),rr;const Ve={id:crypto.randomUUID(),lat:rn.lat,lng:rn.lng,label:rn.label||"Segnaposto",color:rn.color||"red",timestamp:new Date().toISOString()};return[...rr,Ve]}),rn.fly_to&&ze({lat:rn.lat,lng:rn.lng,zoom:16}));break;case"map_remove_marker":rn.marker_id&&Nn(rr=>rr.filter(Ve=>Ve.id!==rn.marker_id));break;case"map_clear_markers":Nn([]);break}};return k.jsxs("div",{className:"app-container",children:[k.jsx(jLe,{neuroni:v,selectedId:($==null?void 0:$.id)||null,onSelect:qn,filtri:f,onFiltriChange:Tt,loading:G,onAddNeurone:()=>de(!0),onQuickMapMode:()=>tr(!0),tipiNeurone:P,categorie:L}),k.jsxs("div",{className:"main-content",children:[k.jsxs("header",{className:"header",children:[k.jsx("h1",{style:{fontSize:"18px",fontWeight:600},children:"GenAgenTa 7"}),k.jsx("div",{style:{flex:1}}),k.jsx("button",{onClick:()=>{t?r():e!=null&&e.has_pin?qe(!0):ft(!0)},title:t?"Chiudi area personale":e!=null&&e.has_pin?"Sblocca area personale":"Imposta PIN",style:{background:t?"rgba(34, 197, 94, 0.2)":"transparent",border:t?"2px solid #22c55e":"1px solid rgba(255,255,255,0.2)",borderRadius:"8px",padding:"8px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:t?"#22c55e":"rgba(255,255,255,0.7)",fontSize:"14px",marginRight:"12px"},children:t?"":""}),k.jsx("button",{onClick:()=>{const rn=!Mt;qr(rn?"panel_open":"panel_close",{panelName:"agea_chat"}),Pt(rn)},title:"Agea - Assistente AI",style:{background:Mt?"rgba(59, 130, 246, 0.15)":"transparent",border:"none",borderRadius:"50%",width:"36px",height:"36px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",marginRight:"12px",transition:"all 0.3s ease"},children:k.jsx("div",{style:{width:Mt?"14px":"10px",height:Mt?"14px":"10px",borderRadius:"50%",background:Mt?"linear-gradient(135deg, #3b82f6, #8b5cf6)":"linear-gradient(135deg, #60a5fa, #a78bfa)",boxShadow:Mt?"0 0 16px rgba(59, 130, 246, 0.7), 0 0 32px rgba(139, 92, 246, 0.4)":"0 0 8px rgba(96, 165, 250, 0.5)",transition:"all 0.3s ease",animation:Mt?"none":"pulse 2s ease-in-out infinite"}})}),e&&k.jsx(_De,{user:e,onLogout:a,onUserUpdate:u})]}),k.jsxs("div",{className:"content-area",style:En?{cursor:"crosshair"}:void 0,children:[k.jsx(tDe,{neuroni:v,sinapsi:A,categorie:L,tipiNeurone:P,selectedId:($==null?void 0:$.id)||null,filterSelectedId:Rn||($==null?void 0:$.id)||null,onSelectNeurone:qn,onFocusNeurone:rn=>{nr(rn);const rr=v.find(Ve=>Ve.id===rn);rr&&qr("select_entity",{entityId:rr.id,entityName:rr.nome,entityType:rr.tipo||void 0})},onClearFocus:(rn,rr)=>{nr(null),rn!==void 0&&rr!==void 0?qr("map_click",{lat:rn,lng:rr}):qr("deselect",{})},onMapMove:(rn,rr)=>{qr("map_move",{center:rn,zoom:rr}),Vt({center:rn,zoom:rr})},filtri:f,pickingMode:tt,onPickPosition:(rn,rr)=>{gn({lat:rn,lng:rr}),mt(!1)},flyToPosition:Et,aiStyleChange:$t,onAiStyleApplied:()=>Cn(null),pickedPosition:Pe,connectionPickingMode:En,connectionSourceId:(wr==null?void 0:wr.id)||null,onPickConnectionTarget:rn=>{const rr=Mn.current;if(console.log("DEBUG onPickConnectionTarget:",rn.nome,"quickAction:",rr),rr==="vendi"||rr==="compra"){kn(rn),Sn(!1),tr(!0),xr("transactionForm"),bi({lat:rn.lat||0,lng:rn.lng||0,x:window.innerWidth/2-140,y:window.innerHeight/2-150});return}const Ve={id:rn.id,nome:rn.nome,tipo:rn.tipo};nn(Ve),Sn(!1),wr&&X(wr)},quickMapMode:ar,onQuickMapClick:(rn,rr,Ve,or)=>{bi({lat:rn,lng:rr,x:Ve,y:or}),xr("create")},onQuickEntityClick:(rn,rr,Ve)=>{tr(!0),ps(rn),bi({lat:rn.lat||0,lng:rn.lng||0,x:rr,y:Ve}),xr("entityActions")},onSelectSinapsi:rn=>{wt(rn),X(null)},aiMarkers:fn,onRemoveAiMarker:ga}),En&&k.jsxs("div",{style:{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",background:"var(--primary)",color:"white",padding:"12px 24px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:1e3,display:"flex",alignItems:"center",gap:"12px"},children:[k.jsx("span",{children:"Clicca su un'entit per collegarla"}),k.jsx("button",{onClick:()=>{ts.current=!1,ms.current=null,Sn(!1),nn(null),wr&&X(wr),Xr(null)},style:{background:"rgba(255,255,255,0.2)",border:"none",color:"white",padding:"4px 12px",borderRadius:"4px",cursor:"pointer"},children:"Annulla"})]}),ar&&!Vn&&k.jsxs("div",{style:{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",background:"#f59e0b",color:"white",padding:"12px 24px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:1e3,display:"flex",alignItems:"center",gap:"12px"},children:[k.jsx("span",{children:" Clicca sulla mappa o su un'entit"}),k.jsx("button",{onClick:()=>{tr(!1),xr(null),bi(null)},style:{background:"rgba(255,255,255,0.2)",border:"none",color:"white",padding:"4px 12px",borderRadius:"4px",cursor:"pointer"},children:"Annulla"})]}),Vn&&ws&&k.jsxs("div",{style:{position:"absolute",left:Math.min(ws.x,window.innerWidth-320),top:Math.min(ws.y,window.innerHeight-400),zIndex:1001},children:[Vn==="create"&&k.jsx(bDe,{position:{lat:ws.lat,lng:ws.lng},tipiNeurone:P,categorieDisponibili:L,onClose:()=>{xr(null),bi(null)},onCreateEntity:async rn=>{try{const rr=await Xn.createNeurone({nome:rn.nome,tipo:rn.tipo,categorie:rn.categorie,visibilita:"aziendale",lat:rn.lat,lng:rn.lng}),Ve=await Xn.getNeurone(rr.id);U(),X(Ve),tr(!1),xr(null),bi(null)}catch(rr){console.error("Errore creazione:",rr)}}}),Vn==="entityActions"&&Ai&&k.jsx(wDe,{neurone:Ai,onClose:()=>{xr(null),bi(null),ps(null)},onVendi:()=>{Ts("vendi"),xr("selectTarget")},onCompra:()=>{Ts("compra"),xr("selectTarget")},onConnetti:()=>{Ts("connetti"),xr("selectTarget")}}),Vn==="selectTarget"&&Ai&&$i&&k.jsx(TDe,{sourceNeurone:Ai,action:$i,onClose:()=>{xr(null),Ts(null),ps(null),bi(null)},onSelectOnMap:()=>{xr(null),tr(!1),Xr(Ai),Sn(!0)},onSelectFromList:()=>{X(Ai),tr(!1),xr(null),Ts(null),ps(null),bi(null)}}),Vn==="connectionType"&&k.jsx(EDe,{onClose:()=>{xr(null),kn(null),ps(null),Ts(null),bi(null)},onConfirm:async rn=>{if(!(!Ai||!tn))try{await Xn.createSinapsi({neurone_da:Ai.id,neurone_a:tn.id,tipo_connessione:rn,data_inizio:new Date().toISOString().split("T")[0],certezza:"ipotesi",livello:"aziendale"}),q(),tr(!1),xr(null),kn(null),ps(null),Ts(null),bi(null)}catch(rr){console.error("Errore creazione connessione:",rr)}}}),Vn==="transactionForm"&&Ai&&tn&&$i&&($i==="vendi"||$i==="compra")&&k.jsx(SDe,{sourceNeurone:Ai,targetNeurone:tn,action:$i,onClose:()=>{xr(null),kn(null),ps(null),Ts(null),bi(null),tr(!1)},onConfirm:async rn=>{try{const rr=$i==="vendi",Ve=rr?Ai.id:tn.id,or=rr?tn.id:Ai.id,_n=await Xn.getNeuroneSinapsi(Ai.id);let Yn;const Tn=_n.data.find(ti=>ti.neurone_da===Ai.id&&ti.neurone_a===tn.id||ti.neurone_da===tn.id&&ti.neurone_a===Ai.id);Tn?(Yn=Tn.id,console.log("DEBUG: Usando sinapsi esistente:",Yn)):(Yn=(await Xn.createSinapsi({neurone_da:Ai.id,neurone_a:tn.id,tipo_connessione:["commerciale"],certezza:"certo",data_inizio:new Date().toISOString().split("T")[0]})).id,console.log("DEBUG: Creata nuova sinapsi:",Yn)),await Xn.createVendita({neurone_id:Ve,famiglia_id:rn.famigliaId,importo:rn.importo,data_vendita:rn.data,controparte_id:or,sinapsi_id:Yn,tipo_transazione:"vendita"}),F(),tr(!1),xr(null),kn(null),ps(null),Ts(null),bi(null)}catch(rr){console.error("Errore creazione vendita:",rr)}}})]}),$&&!En&&k.jsx(iDe,{neurone:$,personalAccess:t,categorie:L,onClose:()=>{qr("panel_close",{panelName:"detail_panel"}),X(null),Sn(!1),nn(null)},onSelectNeurone:async rn=>{const rr=v.find(Ve=>Ve.id===rn);if(rr)qn(rr);else try{const Ve=await Xn.getNeurone(rn);X(Ve)}catch(Ve){console.error("Errore caricamento neurone:",Ve)}},onEdit:()=>{be($),de(!0)},onRequestConnectionMapPick:()=>{ms.current=$,ts.current=!0,Xr($),Sn(!0)},connectionTargetEntity:Un,onClearConnectionTarget:()=>{ms.current=null,nn(null),Xr(null)},onSinapsiCreated:q}),Mr&&!En&&k.jsx(xDe,{sinapsiId:Mr,onClose:()=>{qr("panel_close",{panelName:"sinapsi_panel"}),wt(null)},onSaved:q})]}),k.jsx(dDe,{dataInizio:f.dataInizio||"",dataFine:f.dataFine||"",onChange:(rn,rr)=>Tt(Ve=>({...Ve,dataInizio:rn,dataFine:rr}))})]}),we&&k.jsx(hDe,{onVerify:Or,onClose:()=>qe(!1)}),Je&&k.jsx(fDe,{onSetPin:Zn,onClose:()=>ft(!1)}),ve&&k.jsx(yDe,{invito:ve,onAccept:()=>{Qe(null),window.location.reload()},onDecline:()=>Qe(null)}),ie&&k.jsx(vDe,{neurone:fe||void 0,categorie:L,onSave:rn=>{U(),X(rn),de(!1),be(null),gn(null),mt(!1),ze(null)},onClose:()=>{de(!1),be(null),mt(!1),gn(null),ze(null)},onDelete:fe?async()=>{try{await Xn.deleteNeurone(fe.id),F(),X(null),de(!1),be(null)}catch(rn){console.error("Errore eliminazione:",rn),alert("Errore durante l'eliminazione")}}:void 0,onRequestMapPick:()=>mt(!0),pickedPosition:Pe,isPickingMap:tt,onPositionFound:(rn,rr)=>ze({lat:rn,lng:rr})}),k.jsx(IDe,{selectedEntity:$,focusedEntity:Rn?v.find(rn=>rn.id===Rn):null,activeFilters:{tipiAttivi:f.tipiSelezionati||[],categorieAttive:f.categorieSelezionate||[],ricerca:f.ricerca||""},sinapsi:A,neuroni:v,isChatOpen:Mt,onSuggestionClick:rn=>{Kt(rn),Pt(!0)}}),k.jsx(kDe,{isOpen:Mt,onClose:()=>Pt(!1),onAction:Ys,selectedEntity:$||(Rn?v.find(rn=>rn.id===Rn):null)||null,visibilityContext:{visibleNeuroniIds:v.map(rn=>rn.id),activeFilters:{tipoNeurone:f.tipoNeurone,categoria:f.categoria}},userActions:dt,userName:e==null?void 0:e.nome,initialMessage:Nt,onInitialMessageSent:()=>Kt(null),aiMarkers:fn,onClearAiMarkers:ns,copilotContext:on})]})}const MDe=new Fce({defaultOptions:{queries:{staleTime:1e3*60*5,refetchOnWindowFocus:!0}}});function PDe({children:e}){const{isAuthenticated:t,isLoading:n}=HD();return n?k.jsx("div",{className:"login-container",children:k.jsx("div",{className:"login-card",children:k.jsx("p",{style:{textAlign:"center"},children:"Caricamento..."})})}):t?k.jsx(k.Fragment,{children:e}):k.jsx(ece,{to:"/login",replace:!0})}function ODe(){return k.jsx(Bce,{client:MDe,children:k.jsx(B8e,{runtimeUrl:"/api/ai/copilot-runtime",agent:"default",children:k.jsx(TLe,{children:k.jsx(cce,{children:k.jsxs(nce,{children:[k.jsx(n4,{path:"/login",element:k.jsx(SLe,{})}),k.jsx(n4,{path:"/register",element:k.jsx(ALe,{})}),k.jsx(n4,{path:"/*",element:k.jsx(PDe,{children:k.jsx(RDe,{})})})]})})})})})}const LDe=localStorage.getItem("theme")||"dark";document.documentElement.setAttribute("data-theme",LDe);kR.createRoot(document.getElementById("root")).render(k.jsx(ca.StrictMode,{children:k.jsx(ODe,{})}));const DDe=Object.freeze(Object.defineProperty({__proto__:null,Mermaid:Kte},Symbol.toStringTag,{value:"Module"}));export{uh as C,NRe as D,TT as _,uZ as a,n$ as b,ep as c,M8 as d,fT as g,q2e as h,k as j,UNe as k,B as r,cZ as s,zs as u,I1 as v,gJ as z};
